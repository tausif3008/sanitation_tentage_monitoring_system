"use strict";(self.webpackChunkskype4life=self.webpackChunkskype4life||[]).push([[789],{287659:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(638260)),l=i(460515),c=o.__importDefault(i(541367)),d=o.__importDefault(i(340724)),u=i(154235),h=o.__importDefault(i(958868)),p=i(815146),g=o.__importStar(i(85385)),C=i(26703),m=o.__importStar(i(704704)),S=i(966666),_=o.__importDefault(i(466321)),f=o.__importDefault(i(740794)),y=o.__importDefault(i(960282)),T=o.__importStar(i(223815)),b=o.__importDefault(i(791384)),v=o.__importDefault(i(660401)),I=i(16549),w=o.__importDefault(i(20758)),P=i(641400),M=o.__importDefault(i(827361)),D=o.__importDefault(i(19973)),A=i(262725),k=o.__importDefault(i(760989)),R=o.__importDefault(i(150343)),x=(0,C.lazyProperties)({commonTextStyle:()=>n.Styles.createTextStyle({textAlign:"center",color:I.Color.white,font:w.default.font.uiDisplayRegular,fontSize:w.default.controlFontSize.body}),headerStyle:()=>n.Styles.createTextStyle({marginTop:0,marginBottom:16}),subTextStyle:()=>n.Styles.createTextStyle({paddingTop:5,maxWidth:360,marginBottom:20}),containerStyle:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",paddingHorizontal:10,paddingBottom:105,backgroundColor:I.Color.transparent}),containerStyleDesktop:()=>n.Styles.createViewStyle({paddingBottom:125}),hyperLinkText:()=>n.Styles.createTextStyle({marginTop:8,marginBottom:0,color:I.Color.avatarBlueLight,font:w.default.font.uiDisplayBold}),hyperLinkStyle:()=>n.Styles.createTextStyle({marginTop:-15}),subTextContainer:()=>n.Styles.createTextStyle({alignItems:"center",justifyContent:"center",marginTop:-5}),innerContainer:()=>n.Styles.createViewStyle({padding:16,marginHorizontal:16,borderRadius:16,backgroundColor:I.Color.gray400Overlay70,alignItems:"center",alignSelf:"stretch"}),innerContainerCentered:()=>n.Styles.createViewStyle({alignSelf:"center",minWidth:360})});class L extends h.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._shareInviteButtonRef=e||void 0},this._getShareInviteButtonRef=()=>this._shareInviteButtonRef,this._onShareInvitePress=e=>{this.state.joinLink?_.default.show({anchor:this._getShareInviteButtonRef,event:e,rootViewId:this._getRootViewId(),positionPriorities:["bottom","top"],threadId:this.props.conversationMri,joinLink:this.state.joinLink,meetNowParameters:{origin:S.MeetNowOrigin.MessageStream},allowJoiningLink:!0}):g.log(p.LogTraceArea.JoinLink,`AloneInTheCallInformationView._onShareInvitePress cannot show the menu because join link is not defined joinLink: ${this.state.joinLink}, threadId: ${this.props.conversationMri}`)},this._onHyperLinkPress=e=>{const t=k.default.newCauseId();g.log(p.LogTraceArea.CallingUI,"GoLiveInformationView._onHyperLinkPress, causeId: "+t),f.default.openCallRoster(this.props.conversationMri,this.props.callId,t,this._getContext()),D.default.createSession(this.props.callId,l.CallRosterOrigin.GoLiveInformationView,!1),r.default.updateCallTelemetry(this.props.callId,t,(e=>e.callRosterOpenedCount()))},this._onRingTheGroupButtonPress=()=>{T.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=m.getString("CallPanel.GroupCallRingingStatusMessage");n.Accessibility.announceForAccessibility(e),r.default.trackRingTheGroup(this.props.callId)},this._getHeaderText=()=>{switch(this.state.ringlessCallType){case T.LocallyStartedRinglessCallType.OnePerson:case T.LocallyStartedRinglessCallType.SmallGroup:return m.getString("CallPanel.GroupCallWithOnlyCallInitiatorMessage");case T.LocallyStartedRinglessCallType.LargeGroup:return m.getString("CallPanel.RinglessCallHeader");default:return}},this._getText=()=>{switch(this.state.ringlessCallType){case T.LocallyStartedRinglessCallType.OnePerson:return;case T.LocallyStartedRinglessCallType.SmallGroup:return this.state.hasRingingParticipants?m.getString("CallPanel.GroupCallRingingStatusMessage"):m.getString("CallPanel.GroupCallNotifiedTheGroupMessage");case T.LocallyStartedRinglessCallType.LargeGroup:return m.getString("CallPanel.RinglessCallDescription");default:return}}}_buildState(e,t){const i=s.default.CallingStore.hasRingingParticipants(e.callId,!0),o=s.default.CallingStore.isCallConnected(e.callId),a=R.default.getS4LUiFeatures().enableRefreshedPalette,n=T.default.getRinglessCallType(e.conversationMri,e.callId);return{hasRingingParticipants:i,isCallConnected:o,ringlessCallType:n,joinLink:n===T.LocallyStartedRinglessCallType.OnePerson?c.default.getLink(e.conversationMri):void 0,enableRefreshedPalette:a,isViewCentered:!y.default.isWidthSmallerThanThreshold(392,this._getRootViewId())}}componentDidMount(){super.componentDidMount(),this._announceForAccessibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.state.hasRingingParticipants&&t.hasRingingParticipants&&this._announceForAccessibility()}render(){const e=this._getHeaderText(),t=(0,a.jsx)(n.Text,{style:this._getHeaderStyles(),children:e}),i=this._renderSubText(),o=this._renderRingTheGroupButton(),s=this.state.ringlessCallType===T.LocallyStartedRinglessCallType.OnePerson?this._renderInviteButton():void 0;return this._renderNewCallScreenStageView(t,i,o,s)}_renderNewCallScreenStageView(e,t,i,o){if(void 0===this.state.ringlessCallType||this.state.ringlessCallType===T.LocallyStartedRinglessCallType.GoLive||this.state.ringlessCallType===T.LocallyStartedRinglessCallType.None)return null;const s=[x.innerContainer];return this.state.isViewCentered&&s.push(x.innerContainerCentered),(0,a.jsx)(n.View,{style:this._getContainerStyles(),ignorePointerEvents:!0,children:(0,a.jsxs)(n.View,{style:s,children:[e,t,i,o]})})}_announceForAccessibility(){let e;e=this._isRingTheGroupAvailable()||this.state.ringlessCallType===T.LocallyStartedRinglessCallType.LargeGroup?this._getAdditionalScreenReaderText():this._getText();const t=d.default.combinedAccessibilityLabel(this._getHeaderText(),e);b.default.maybeAnnounceForAccessibility(t,100)}_renderInviteButton(){return(0,a.jsx)(v.default,{ref:this._onInviteButtonRef,title:m.getString("MeetNow.ShareInvite"),onPress:this._onShareInvitePress,buttonSize:u.SXButtonSize.Medium,iconSize:P.IconSize.size14,iconPositon:u.SXButtonIconPosition.End,disabled:!this.state.joinLink},"invite")}_renderRingTheGroupButton(){if(!this._isRingTheGroupAvailable())return;const e=this.state.enableRefreshedPalette?{}:{buttonStyle:u.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:I.AgnosticGradientFillButtonColors.blue};return(0,a.jsx)(v.default,Object.assign({},e,{buttonSize:u.SXButtonSize.Medium,title:m.getString("CallPanel.GroupCallRingTheGroupButtonTitle"),allowTextWrap:!0,onPress:this._onRingTheGroupButtonPress,disabled:!this.state.isCallConnected}))}_renderSubText(){const e=this._getText();if(!e)return;if(this.state.ringlessCallType===T.LocallyStartedRinglessCallType.SmallGroup&&!this.state.hasRingingParticipants)return;const t=[x.subTextStyle,x.commonTextStyle];return(0,a.jsxs)(n.View,{style:x.subTextContainer,children:[(0,a.jsx)(n.Text,{style:t,children:e}),this._renderHyperLink()]})}_renderHyperLink(){if(this.state.ringlessCallType!==T.LocallyStartedRinglessCallType.LargeGroup)return;const e=[x.subTextStyle,x.commonTextStyle,x.hyperLinkText],t=m.getString("CallPanel.RinglessCallHyperLink");return(0,a.jsx)(n.Button,{onPress:this._onHyperLinkPress,style:x.hyperLinkStyle,accessibilityLabel:t,children:(0,a.jsx)(A.BodyText,{style:e,children:t})})}_getAdditionalScreenReaderText(){return this.state.ringlessCallType===T.LocallyStartedRinglessCallType.LargeGroup?m.getString("CallPanel.RinglessCallHyperLinkScreenReaderText"):m.getString("CallPanel.GroupCallRingTheGroupButtonDescriptiveScreenReaderText")}_isRingTheGroupAvailable(){return!this.state.hasRingingParticipants&&this.state.ringlessCallType===T.LocallyStartedRinglessCallType.SmallGroup}_getContainerStyles(){const e=[x.containerStyle,M.default.absoluteFill];return this.props.useDesktopCallControls&&e.push(x.containerStyleDesktop),this.props.style&&e.push(n.Styles.createViewStyle(this.props.style,!1)),e}_getHeaderStyles(){return[x.headerStyle,x.commonTextStyle]}}t.default=L},588896:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(331654),s=o.__importStar(i(380157)),r=o.__importStar(i(516778)),l=o.__importStar(i(317588)),c=i(16549),d=o.__importDefault(i(54720)),u=o.__importDefault(i(808467)),h=i(154235),p=o.__importStar(i(170881)),g=i(815146),C=o.__importStar(i(85385)),m=i(26703),S=o.__importStar(i(704704)),_=o.__importDefault(i(251733)),f=o.__importDefault(i(960282)),y=o.__importDefault(i(117475)),T=o.__importDefault(i(377556)),b=o.__importDefault(i(525864)),v=o.__importDefault(i(660401)),I=o.__importDefault(i(827361)),w=i(262725),P=o.__importDefault(i(760989)),M=(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",alignItems:"center"}),containerLandscape:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center"}),innerContainer:()=>r.Styles.createViewStyle({flexBasis:0,flex:1,justifyContent:"center",alignItems:"stretch",alignSelf:"stretch"}),imageContainer:()=>r.Styles.createViewStyle({flexBasis:0,flex:1,alignSelf:"stretch"}),headerText:()=>r.Styles.createTextStyle({marginVertical:15,marginHorizontal:10,textAlign:"center"}),descriptionText:()=>r.Styles.createTextStyle({marginBottom:15,marginHorizontal:10,textAlign:"center"}),button:()=>r.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"})});class D extends u.default{constructor(){super(...arguments),this._onBack=()=>(this._submitPressedTrue(),!0),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1)}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:f.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape,safeAreaHorizontalInsets:y.default.horizontalInsets()}}componentDidMount(){super.componentDidMount(),p.dismissAll(),d.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),d.default.unsubscribe(this._onBack)}render(){const e=this._getHeaderText(this.state),t=[M.innerContainer];this.state.safeAreaHorizontalInsets.right&&t.push(T.default.horizontalPaddingStyle({right:this.state.safeAreaHorizontalInsets.right,left:0}));const i=(0,a.jsxs)(r.View,{style:this.state.isLandscape?M.containerLandscape:M.container,children:[(0,a.jsx)(r.View,{style:M.imageContainer,children:(0,a.jsx)(r.Image,{source:l.Collection.ANDROID_CALL_MONITOR_PERM_ILLUSTRATION,style:I.default.flexOne,resizeMode:"cover"})}),(0,a.jsxs)(r.View,{style:t,children:[(0,a.jsx)(w.PanelHeader,{style:M.headerText,children:e}),(0,a.jsx)(w.BodyText,{style:M.descriptionText,children:S.getString("AndroidCallMonitorPermissionsPanel.DescriptionText")}),(0,a.jsx)(v.default,{style:M.button,buttonStyle:h.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:c.AgnosticGradientFillButtonColors.blue,onPress:this._submitPressedFalse,title:S.getString("AndroidCallMonitorPermissionsPanel.GrantPermissionButtonTitle")}),(0,a.jsx)(v.default,{buttonStyle:h.SXButtonStyle.ThemeNoBackground,buttonSize:h.SXButtonSize.Medium,style:M.button,onPress:this._submitPressedTrue,title:S.getString("AndroidCallMonitorPermissionsPanel.NotNowButtonTitle")})]})]});return(0,a.jsx)(b.default,{dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:void 0,maxHeight:void 0,fullScreen:!0,useFullSizeContainer:!0,accessibilityLabel:e,children:(0,a.jsx)(r.View,{style:[I.default.flexOne,this._themeStyles.primaryBackgroundColorStyle],children:i})})}_submitPressed(e){const t=P.default.newCauseId();C.log(g.LogTraceArea.Navigation,"AndroidCallMonitorPermissionPanel._submitPressed, causeId"+t),this.isComponentMounted(),_.default.updateDrawOverPrePermissionStatus(e?s.PermissionStatus.Denied:s.PermissionStatus.Granted),e||s.default.requestDrawOverPermission(),this._goBack(t)}_getHeaderText(e){return S.getString("AndroidCallMonitorPermissionsPanel.HeaderText")}}t.default=D},119914:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=(o.__importDefault(i(119557)),o.__importStar(i(859745))),s=o.__importStar(i(516778)),r=i(217041),l=o.__importDefault(i(290598)),c=o.__importDefault(i(369347)),d=i(843890),u=o.__importDefault(i(970035)),h=o.__importDefault(i(510130)),p=i(26703),g=o.__importDefault(i(942724)),C=o.__importDefault(i(377556)),m=o.__importDefault(i(791384)),S=i(16549),_=o.__importDefault(i(139221)),f=i(641400),y=i(262725),T=(0,p.lazyProperties)({warningContainer:()=>s.Styles.createViewStyle({position:"absolute",left:0,right:0,height:30,alignItems:"center",bottom:10,backgroundColor:S.Color.transparent}),innerContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:5,marginHorizontal:50,paddingHorizontal:10,borderRadius:5,backgroundColor:S.Color.gray400Overlay70}),statusText:()=>s.Styles.createTextStyle({color:S.Color.white,backgroundColor:S.Color.transparent}),iconPadding:()=>s.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>s.Styles.createViewStyle({paddingLeft:10}),desktopCallControlsStyle:()=>s.Styles.createViewStyle({bottom:85})});class b extends r.ComponentBase{constructor(){super(...arguments),this._onAnimatedWaringRef=e=>{this._animatedView=e||void 0}}_buildState(e,t){const i=g.default.isUsingStackNavigationContext(),o=d.CallingCapabilities.speakerVolumeControlSupported();return{isNotificationHidden:e.hideNotification||i&&l.default.isOverflowMenuVisible(),showMicrophoneMuted:e.isMicrophoneMutedWhileSpeaking||c.default.CallingStore.isMicrophoneMuted(e.callId),callAudioOutputRoute:c.default.CallControlsStore.getAudioOutput(),speakerVolumeControlSupported:o,isSpeakerMuted:!!o&&(c.default.CallingStore.isSpeakerMuted(e.callId)||0===c.default.DeviceStore.getSpeakerVolume())}}componentDidMount(){super.componentDidMount(),this._getWarningViewinfo(),this.state.viewInformation&&m.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._getWarningViewinfo(),this.state.isNotificationHidden!==t.isNotificationHidden&&this._showOrHideWarningView(!this.state.isNotificationHidden,!1),!this.state.viewInformation||t.viewInformation&&t.viewInformation.warningText===this.state.viewInformation.warningText||m.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}_showOrHideWarningView(e,t=!0,i=0){this.isComponentMounted()&&this._animatedView&&(this._animatedView.stop(),t?e?this._animatedView.fadeIn(void 0,void 0,{delay:i}):this._animatedView.fadeOut(void 0,void 0,{delay:i}):this._animatedView.setValue({opacity:e?1:0}))}render(){if(!this.state.viewInformation)return null;const e=[T.warningContainer];let t,i;return this.props.bottomPadding&&(e.push(C.default.paddingBottomStyle(this.props.bottomPadding)),e.push(C.default.heightStyle(30+this.props.bottomPadding))),this.state.viewInformation&&(i=this.state.viewInformation.warningText?this._getWarningText(this.state.viewInformation.warningText):void 0,t=this.state.viewInformation.icon?this._getWarningIcon(this.state.viewInformation.icon):void 0),this.props.useDesktopCallControls&&e.push(T.desktopCallControlsStyle),e.push(this.props.style),(0,a.jsx)(s.View,{style:e,blockPointerEvents:!0,ignorePointerEvents:!0,children:(0,a.jsxs)(n.View,{ref:this._onAnimatedWaringRef,style:T.innerContainer,children:[t,i]})})}_getWarningViewinfo(){let e;(this.state.speakerVolumeControlSupported||this.state.showMicrophoneMuted)&&(e=h.default.getViewInformationForAudioMuted(this.state.showMicrophoneMuted,this.state.isSpeakerMuted)),this.setState({viewInformation:e})}_getWarningText(e){return(0,a.jsx)(y.BodyText,{style:T.statusText,children:e})}_getWarningIcon(e){let t=S.Color.white;return this.state.viewInformation&&this.state.viewInformation.optionalIconColor&&(t=this.state.viewInformation.optionalIconColor),(0,a.jsx)(u.default,{icon:e,size:f.IconSize.size15,color:t,style:_.default.isRTL()?T.iconPaddingRTL:T.iconPadding})}}t.default=b},794444:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioOutputRouteHelper=void 0;const o=i(197582),a=o.__importDefault(i(119557)),n=o.__importDefault(i(150343)),s=o.__importStar(i(704704)),r=(o.__importDefault(i(655192)),o.__importDefault(i(139221)),i(641400));t.AudioOutputRouteHelper=class{static displayInfoForOutputRoute(e){let t=r.SkypeIcon.VolumeMax,i="CallControls.CallButtonSpeaker",o="CallControls.CallButtonSpeakerAccessibilityLabel";return e&&(e===a.default.AudioOutputEarpiece?(t=r.SkypeIcon.VolumeOff,i="CallControls.CallButtonEarpiece",o="CallControls.CallButtonEarpieceAccessibilityLabel"):e===a.default.AudioOutputWiredHeadset?(t=r.SkypeIcon.Headset,i="CallControls.CallButtonHeadset",o="CallControls.CallButtonHeadsetAccessibilityLabel"):e===a.default.AudioOutputBluetooth&&(t=r.SkypeIcon.Bluetooth,i="CallControls.CallButtonBluetooth",o="CallControls.CallButtonBluetoothAccessibilityLabel")),{icon:t,title:s.getString(i),accessibilityLabel:s.getString(o)}}static useiOSRoutePicker(){n.default.getSkypeAudioLibraryFeatures().ECS_AudioDL_DisableRouteChangeNotification;return!1}}},995042:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioRouteSelectionPresenter=t.AudioOutputRouteStrings=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(119557)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(638260)),l=i(815146),c=o.__importStar(i(85385)),d=o.__importStar(i(704704)),u=o.__importDefault(i(888500));var h;!function(e){e.CallButtonEarpiece="CallControls.CallButtonEarpiece",e.CallButtonSpeaker="CallControls.CallButtonSpeaker",e.CallButtonBluetooth="CallControls.CallButtonBluetooth",e.CallButtonHeadset="CallControls.CallButtonHeadset"}(h||(t.AudioOutputRouteStrings=h={}));const p={[n.default.AudioOutputEarpiece]:h.CallButtonEarpiece,[n.default.AudioOutputSpeaker]:h.CallButtonSpeaker,[n.default.AudioOutputBluetooth]:h.CallButtonBluetooth,[n.default.AudioOutputWiredHeadset]:h.CallButtonHeadset},g={[n.default.AudioOutputEarpiece]:"Earpiece",[n.default.AudioOutputSpeaker]:"Speaker",[n.default.AudioOutputBluetooth]:"Bluetooth",[n.default.AudioOutputWiredHeadset]:"WiredHeadset",[n.default.AudioOutputOther]:"Other"};t.AudioRouteSelectionPresenter=class{constructor(e){this._causeId=e,this._providingVideo=!1,this._onMenuCancelled=()=>{const e=s.default.CallControlsStore.getAudioOutput(),t=g[e];r.default.trackAudioOutputRouteChange(t,t)},this._onMenuItemSelected=e=>{switch(c.log(l.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter,_onMenuItemSelected command: ${e} causeId: ${this._causeId}`),e){case h.CallButtonEarpiece:this._requestAudioOutputRoute(n.default.AudioOutputEarpiece);break;case h.CallButtonSpeaker:this._requestAudioOutputRoute(n.default.AudioOutputSpeaker);break;case h.CallButtonBluetooth:this._requestAudioOutputRoute(n.default.AudioOutputBluetooth);break;case h.CallButtonHeadset:this._requestAudioOutputRoute(n.default.AudioOutputWiredHeadset)}this._resumeCallControlTimer&&this._resumeCallControlTimer()}}setUserProvidingVideo(e){this._providingVideo=e}setControlTimerHandlers(e,t){this._suspendCallControlTimer=e,this._resumeCallControlTimer=t}show(e,t,i){const o=s.default.CallControlsStore.getAudioOutput();n.default.requestAvailableOutputRoutesArray(o).then((s=>{this._providingVideo&&(s=a.filter(s,(e=>e!==n.default.AudioOutputEarpiece))),s.length>2?this._showMenu(e,t,i,s):2===s.length?this._toggleRoutes(s,o):c.log(l.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter.show() only single route option available current: ${o} available: ${s} causeId: ${this._causeId}`)}))}_toggleRoutes(e,t){e[0]===t?this._requestAudioOutputRoute(e[1]):this._requestAudioOutputRoute(e[0]),this._resumeCallControlTimer&&this._resumeCallControlTimer()}_showMenu(e,t,i,o){const n=[];a.each(o,(e=>{e?n.push({text:d.getString(p[e]),command:p[e]}):c.warn(l.LogTraceArea.CallingUI,"AudioRouteSelectionPresenter._showMenu invalid route in outputRoutes")})),this._suspendCallControlTimer&&this._suspendCallControlTimer(),u.default.showWithActionMenuConfig({options:{anchor:i,buttons:n,title:d.getString("CallPanel.SelectAudioRouteTitle")},callback:this._onMenuItemSelected,maintainAnchor:!0,rootViewId:e,onCancel:this._onMenuCancelled,invokingEvent:t})}_requestAudioOutputRoute(e){const t=s.default.CallControlsStore.getAudioOutput();r.default.trackAudioOutputRouteChange(g[t],g[e]),n.default.requestOutput(e)}}},50633:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(962234),r=o.__importDefault(i(369347)),l=o.__importStar(i(873324)),c=o.__importDefault(i(638260)),d=o.__importDefault(i(186325)),u=i(119302),h=i(26703),p=o.__importStar(i(704704)),g=o.__importDefault(i(628703)),C=o.__importDefault(i(411862)),m=i(262725),S=(0,h.lazyProperties)({popupContainer:()=>n.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,opacity:.85}),popupTitleRow:()=>n.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"})});class _ extends u.HoverPopup{constructor(){super(...arguments),this._allowShowPopup=()=>this._defaultAllowShowPopupConditions()&&!this.state.isAwaitingCameraConfirmation,this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onMicrophoneSelected=e=>{c.default.updateCallAudioSettingsPopupEvent((t=>{e&&t.markDidChangeMicDevice()}))},this._onSpeakerSelected=e=>{c.default.updateCallAudioSettingsPopupEvent((t=>{e&&t.markDidChangeSpeakerDevice()}))},this._onAdjustSpeakerVolume=()=>{c.default.updateCallAudioSettingsPopupEvent((e=>e.markDidAdjustSpeakerVolume()))},this._onAdjustMicVolume=()=>{c.default.updateCallAudioSettingsPopupEvent((e=>e.markDidAdjustMicVolume()))},this._onToggleMusicMode=e=>{c.default.updateCallAudioSettingsPopupEvent((e=>e.markDidChangeMusicMode()))},this._onToggleAECMode=e=>{c.default.updateCallAudioSettingsPopupEvent((e=>e.markDidChangeAECMode()))}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingCameraConfirmation:r.default.CallControlsStore.isAwaitingCameraConfirmation()})}componentWillUnmount(){super.componentWillUnmount(),this.onClosed()}renderContent(){return(0,a.jsxs)(n.View,{style:[S.popupContainer,this._themeStyles.primaryBackgroundColorStyle],children:[(0,a.jsx)(n.View,{style:S.popupTitleRow,children:(0,a.jsx)(m.Subtitle,{children:p.getString("CallControlsOverFlowMenu.AdjustAudioSettings")})}),(0,a.jsx)(g.default,{callId:this.props.callId,colorThemeOverride:this._currentTheme,hideAutoAdjustSetting:!0,micLevelMeterSteps:13,labelMaxWidth:166,onMicrophoneSelected:this._onMicrophoneSelected,onAdjustVolume:this._onAdjustMicVolume,onToggleMusicMode:this._onToggleMusicMode,onToggleAEC:this._onToggleAECMode,origin:s.MicrophoneSettingsOrigin.InCallPopup}),(0,a.jsx)(d.default,{colorThemeOverride:this._currentTheme}),(0,a.jsx)(C.default,{colorThemeOverride:this._currentTheme,compactView:!0,labelMaxWidth:166,onSpeakerSelected:this._onSpeakerSelected,onAdjustVolume:this._onAdjustSpeakerVolume})]})}popupDescription(){return"AudioSettings"}onOpened(e){c.default.setCallAudioSettingsPopupEvent(new l.CallAudioSettingsPopup(this.props.callId,e)),r.default.CallControlsStore.setSettingsPopupVisibility(!0)}onClosed(){r.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=_},328410:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.show=function(e,t,i,o,n,s){g.log(p.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.show permissionType: "+i+" causeId: "+o);const r=(0,a.jsx)(x,{causeId:o,modalId:e,permissionType:i,onContinueAfterPermissionsDenied:s});return d.default.showModal(r,e,t),e=>R(e,t.rootViewId,o)},t.dismiss=R;const o=i(197582),a=i(785893),n=i(815063),s=i(380157),r=o.__importStar(i(516778)),l=(o.__importDefault(i(754296)),o.__importDefault(i(369347))),c=i(509979),d=o.__importDefault(i(266311)),u=i(154235),h=i(154235),p=i(815146),g=o.__importStar(i(85385)),C=i(26703),m=o.__importStar(i(704704)),S=i(44557),_=o.__importDefault(i(201721)),f=o.__importDefault(i(251733)),y=o.__importDefault(i(246230)),T=o.__importDefault(i(525864)),b=i(963254),v=o.__importDefault(i(660401)),I=i(331079),w=i(262725),P=o.__importDefault(i(760989)),M=o.__importDefault(i(960282)),D=o.__importDefault(i(497910)),A=o.__importStar(i(972830)),k=(0,C.lazyProperties)({panel:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),mainDisplayText:()=>r.Styles.createTextStyle({marginTop:35,textAlign:"center",maxWidth:640,paddingHorizontal:10}),mainDisplayTextSafari:()=>r.Styles.createTextStyle({fontSize:16}),downloadSuggestionText:()=>r.Styles.createTextStyle({marginRight:10}),chromeDisplayImage:()=>r.Styles.createImageStyle({width:612,height:266}),downloadButton:()=>r.Styles.createButtonStyle({alignSelf:"center",minWidth:h.SXButtonSize.Small}),continueWithoutAVButton:()=>r.Styles.createButtonStyle({alignSelf:"center",minWidth:h.SXButtonSize.Small,margin:20}),suggestionContent:()=>r.Styles.createViewStyle({position:"absolute",top:30,right:30,alignItems:"center",flexDirection:"row",overflow:"visible"})});function R(e,t,i){g.log(p.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.dismiss dismiss causeId: "+i),d.default.dismissModal(e,t)}class x extends D.default{constructor(){super(...arguments),this._onJoinCallWithoutAVPermissions=()=>{this.props.onContinueAfterPermissionsDenied&&this.props.onContinueAfterPermissionsDenied(),this._setTelemetryAction(c.AVPermissionsAction.ContinueWithoutAV),this._dismissAndCleanup()},this._dismissAndCleanup=()=>{R(this.props.modalId,u.MainRootViewId,""),s.PermissionsPromptHelper.resetPermissionPromptsState()},this._onCancelButtonClick=()=>{this._setTelemetryAction(c.AVPermissionsAction.Cancel),this._dismissAndCleanup()}}_buildState(e,t){const i={permissionStatus:f.default.permissionStatus(e.permissionType),isContinueWithoutPermission:l.default.CallingFeaturesHelper.isCallWithoutAVPermissionsBrowserEnabled()};return t&&(i.permissionStatus===s.PermissionStatus.Unknown?f.default.getPermissionStatusFetchIfUnavailable(e.permissionType).then((e=>{i.permissionStatus=e,this._initializeTelemetry(i)})):this._initializeTelemetry(i)),i}componentDidMount(){if(super.componentDidMount(),f.default.permissionStatus(this.props.permissionType)===s.PermissionStatus.Unknown)switch(this.props.permissionType){case I.PermissionType.Microphone:_.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0});break;case I.PermissionType.Camera:_.default.setUserPreferencesLocal({wasInstructedAboutCameraWebPermissions:!0});break;case I.PermissionType.MicrophoneAndCamera:_.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0,wasInstructedAboutCameraWebPermissions:!0})}}componentWillUnmount(){super.componentWillUnmount(),this._callPermissionDeniedEvent&&(this._isGranted(this.state.permissionStatus)&&this._callPermissionDeniedEvent.setAction(c.AVPermissionsAction.PermissionGranted),g.track(this._callPermissionDeniedEvent))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.permissionStatus!==s.PermissionStatus.Granted&&t.permissionStatus===s.PermissionStatus.Granted&&(this._setTelemetryAction(c.AVPermissionsAction.PermissionGranted),this._dismissAndCleanup())}render(){const{primaryTextColorStyle:e,primaryBackgroundColorStyle:t}=A.themeStyles(this._getContext(),this.props.colorThemeOverride);return(0,a.jsx)(T.default,{dialogId:this.props.modalId,containerStyle:S.MeetNowStyle.bgColorStyle,closeOnClickOutside:!1,maxWidth:void 0,fullScreen:!0,useFullSizeContainer:!0,children:(0,a.jsxs)(r.View,{style:[k.panel,t],children:[this._renderMainDisplayImage(),this._renderMainDisplayText(e),this._renderContinueWithoutPermissionButton(),!1]})})}_renderMainDisplayImage(){if(this._isDeniedScreen(this.state)){const e=y.default.getDeniedImageSourceBrowser(this._useDarkTheme()),t=n.BrowserEnvironment.isSafari()||M.default.isTinyScreenSizeNoSubscription(this._getRootViewId())?u.ImageResizeModeEnum.contain:u.ImageResizeModeEnum.cover;return e?(0,a.jsx)(r.Image,{style:k.chromeDisplayImage,resizeMode:t,source:e}):void 0}return(0,a.jsx)(b.SkypeLogo,{})}_renderMainDisplayText(e){const t=this._isDeniedScreen(this.state),i=t?this._renderMainDisplayTextDenied():this._renderMainDisplayTextRequest(),o=[k.mainDisplayText,e,t&&n.BrowserEnvironment.isSafari()?k.mainDisplayTextSafari:void 0];return(0,a.jsx)(w.Header,{style:o,size:5,selectable:!0,allowFontScaling:!1,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,children:i})}_assertAndWarnUnsupportedBrowser(){g.warn(p.LogTraceArea.Permissions,"AugmentedPermissions UI is not supported for other browsers")}_renderMainDisplayTextRequest(){const e=n.BrowserEnvironment.isEngineChromium()||n.BrowserEnvironment.isEngineWebkit()||n.BrowserEnvironment.isEngineGecko();switch(this.props.permissionType){case I.PermissionType.Microphone:return e?m.getString("AugmentedPermissions.RequestPermissionsChromeTextMic"):m.getString("AugmentedPermissions.RequestPermissionsEdgeTextMic");case I.PermissionType.Camera:return e?m.getString("AugmentedPermissions.RequestPermissionsChromeTextCam"):m.getString("AugmentedPermissions.RequestPermissionsEdgeTextCam");default:return e?m.getString("AugmentedPermissions.RequestPermissionsChromeTextBoth"):m.getString("AugmentedPermissions.RequestPermissionsEdgeTextBoth")}}_renderMainDisplayTextDenied(){const e=y.default.getPermissionDeniedText(I.PermissionType.Camera),t=y.default.getPermissionDeniedText(I.PermissionType.Microphone),i=y.default.getPermissionDeniedText(I.PermissionType.MicrophoneAndCamera),o=y.default.getPermissionDeniedText(I.PermissionType.Notifications);if(!e||!t||!i)return this._assertAndWarnUnsupportedBrowser(),"";if(this.state.permissionStatus===s.PermissionStatus.MicGrantedAndCameraDenied)return e;if(this.state.permissionStatus===s.PermissionStatus.MicDeniedAndCameraGranted)return t;switch(this.props.permissionType){case I.PermissionType.Camera:return e;case I.PermissionType.Microphone:return t;case I.PermissionType.MicrophoneAndCamera:return i;case I.PermissionType.Notifications:return null!=o?o:"";default:P.default.switchStatementExhaustiveChecking(this.props.permissionType,"AugmentedPermissions called for an incorrect permission type")}}_isDeniedScreen(e){return e.permissionStatus===s.PermissionStatus.Denied||e.permissionStatus===s.PermissionStatus.MicDeniedAndCameraGranted||this.props.permissionType===I.PermissionType.Notifications&&e.permissionStatus!==s.PermissionStatus.Granted}_renderContinueWithoutPermissionButton(){if(this.state.isContinueWithoutPermission)return(0,a.jsx)(v.default,{allowTextWrap:!0,buttonSize:h.SXButtonSize.Medium,buttonStyle:h.SXButtonStyle.ThemeStroke,onPress:this.props.permissionType===I.PermissionType.Notifications?this._dismissAndCleanup:this._onJoinCallWithoutAVPermissions,style:k.continueWithoutAVButton,title:this.props.onContinueAfterPermissionsDenied?m.getString("AugmentedPermissions.JoinCallWithoutAV"):m.getString("Global.DoneButtonTitle")})}_initializeTelemetry(e){const t=this._isDeniedScreen(e)?c.InitialScreen.DenyPrompt:c.InitialScreen.AllowPrompt;this._callPermissionDeniedEvent=new c.CallPermissionsBrowserEvent(t)}_setTelemetryAction(e){this._callPermissionDeniedEvent&&this._callPermissionDeniedEvent.setAction(e)}_isGranted(e){switch(this.props.permissionType){case I.PermissionType.Camera:return e===s.PermissionStatus.Granted||e===s.PermissionStatus.MicDeniedAndCameraGranted;case I.PermissionType.Microphone:return e===s.PermissionStatus.Granted||e===s.PermissionStatus.MicGrantedAndCameraDenied;case I.PermissionType.MicrophoneAndCamera:case I.PermissionType.Notifications:return e===s.PermissionStatus.Granted}}}t.default=x},800426:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(526849),r=o.__importDefault(i(491196)),l=i(460515),c=o.__importDefault(i(48123)),d=o.__importDefault(i(132680)),u=o.__importDefault(i(760989)),h=o.__importDefault(i(369347)),p=i(736267);t.default=(0,s.WithResub)(n.memo((e=>{const t=(0,p.useCommonContext)(),i=[];return e.banners.forEach((o=>{const n=d.default.getDeviceStatusBannerButtons(o,e.callId),s=d.default.getToastInformation(o,void 0,n);if(s){if(s.showAvSettingsLink){const i=()=>{(0,r.default)().removeDeviceQualityBannerType(e.callId,o,l.ToastActionType.Actioned),h.default.CallNavigationHelper.navigateToAVDesktopSettings(t.rootViewId,u.default.newCauseId())};n.push({labelKey:"DesktopProfileMenu.AudioVideoSettingsTitle",callback:i})}let d;s.timeout&&(d=()=>{(0,r.default)().removeDeviceQualityBannerType(e.callId,o,l.ToastActionType.AutoDismissed)});const p=()=>{(0,r.default)().removeDeviceQualityBannerType(e.callId,o,l.ToastActionType.ManualDismissed)};i.push((0,a.jsx)(c.default,{text:s.notificationText,icon:s.icon,buttons:n,onBannerDismiss:p,timeout:s.timeout,onTimeout:d},"bannerView"+o))}})),(0,a.jsxs)(a.Fragment,{children:[" ",i," "]})})),(e=>{const t=(0,r.default)().getDeviceQualityBannerTypes(e.callId);return Object.assign(Object.assign({},e),{banners:t})}))},272792:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.rxTextStyles=t.buttonBackgroundStyles=void 0,t.useTextStyles=function(){return(0,s.useSkypeStyles)((({themeColors:{textLightFixed:e}})=>({textStyle:Object.assign(Object.assign({},r),{color:e})})),[])};const o=i(197582),a=o.__importStar(i(516778)),n=o.__importDefault(i(20758)),s=i(964414),r={fontSize:n.default.fontSize.size14,fontFamily:n.default.fontFamily.uidDisplayRegular,fontWeight:"500",letterSpacing:-.24,lineHeight:20};t.buttonBackgroundStyles={paddingLeft:0,paddingRight:0,marginRight:20,paddingTop:4,borderRadius:0},t.rxTextStyles=a.Styles.createTextStyle(Object.assign(Object.assign({},r),{whiteSpace:"normal"}))},48123:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(537180),s=i(667294),r=o.__importStar(i(704704)),l=i(764611),c=i(272792),d=i(601910),u=o.__importDefault(i(601274)),h=n.StyleSheet.create({innerView:{flexDirection:"row"},buttonGroup:{flexDirection:"row",flexWrap:"wrap"}});t.default=e=>{var t;const{textStyle:i}=(0,c.useTextStyles)();(0,s.useEffect)((()=>{let t;return e.timeout&&e.onTimeout&&(t=u.default.setTimeout(e.onTimeout,e.timeout)),()=>{t&&u.default.clearTimeout(t)}}),[e.timeout,e.onTimeout]);const o=(null===(t=e.buttons)||void 0===t?void 0:t.map(((e,t)=>{const i=r.getString(e.labelKey);return(0,a.jsx)(d.BannerViewButton,{buttonBackgroundStyles:c.buttonBackgroundStyles,onPress:e.callback,title:i},"bannerButton"+(t+1))})))||[];return(0,a.jsxs)(l.PopupBanner,{onDismissPopup:e.onBannerDismiss,icon:e.icon,children:[(0,a.jsx)(n.Text,{style:i,children:e.text}),(0,a.jsx)(n.View,{style:h.buttonGroup,children:o})]})}},601910:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BannerViewButton=void 0;const o=i(197582),a=i(785893),n=o.__importDefault(i(660401)),s=i(206315),r=i(154235),l=i(16549),c=i(272792);t.BannerViewButton=({onPress:e,title:t,buttonBackgroundStyles:i,buttonStyles:o})=>{const{themeColors:{textAccentFixed:d}}=(0,s.useSkypeTheme)();return(0,a.jsx)(n.default,{style:[{flexShrink:1},o],textStyleOverride:[c.rxTextStyles],backgroundStyle:i,buttonConfig:{textColor:d,backgroundColor:l.Color.transparent},buttonStyle:r.SXButtonStyle.Custom,buttonSize:r.SXButtonSize.Small,onPress:e,title:t,minHeight:20})}},165248:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(537180),s=o.__importDefault(i(260718)),r=o.__importDefault(i(800426)),l=n.StyleSheet.create({outerContainer:{position:"absolute",top:62,left:0,right:0,flexDirection:"column",justifyContent:"center",pointerEvents:"box-none"}});t.default=e=>{const t=[];return e.enableCallRecorderUINew&&t.push((0,a.jsx)(s.default,{callId:e.callId,conversationMri:e.conversationMri})),e.enableRedesignedDeviceQualityBanners&&t.push((0,a.jsx)(r.default,{callId:e.callId})),(0,a.jsx)(n.View,{style:l.outerContainer,children:t},"bannersView")}},764611:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PopupBanner=void 0;const o=i(197582),a=i(785893),n=i(537180),s=i(667294),r=o.__importStar(i(704704)),l=i(641400),c=i(206315),d=o.__importDefault(i(970035)),u=o.__importDefault(i(660401)),h=i(154235),p=i(16549),g=i(661644),C={paddingLeft:4,paddingRight:4},m=n.StyleSheet.create({contentContainer:{flex:1,paddingHorizontal:8}});t.PopupBanner=({icon:e,onDismissPopup:t,children:i})=>{const{themeColors:{textLightFixed:o,iconLightFixed:S}}=(0,c.useSkypeTheme)(),{container:_}=(0,g.useSkypeThemesStyles)((({themeColors:{surfaceDarkFixed:e,strokeDarkFixed:t}})=>({container:{alignSelf:"center",justifyContent:"center",padding:16,paddingRight:12,borderRadius:16,flexDirection:"row",flex:1,width:"90%",maxWidth:450,borderWidth:1,marginHorizontal:24,marginVertical:8,alignItems:"flex-start",backgroundColor:e,borderColor:t}})),[]),f=(0,s.useMemo)((()=>({backgroundColor:p.Color.transparent,textColor:o})),[o]);return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(n.View,{style:_,children:[e&&(0,a.jsx)(d.default,{icon:e,size:l.IconSize.size20,color:S}),(0,a.jsx)(n.View,{style:m.contentContainer,children:i}),(0,a.jsx)(u.default,{backgroundStyle:C,buttonConfig:f,buttonStyle:h.SXButtonStyle.Custom,buttonSize:h.SXButtonSize.Small,onPress:t,title:"",minHeight:20,icon:l.SkypeIcon.ClosePanel,iconSize:l.IconSize.size18,accessibilityLabel:r.getString("Global.CloseButtonTitle")})]})})}},736667:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(217041),l=i(513800),c=o.__importDefault(i(566700)),d=i(460515),u=o.__importDefault(i(132680)),h=i(815146),p=o.__importStar(i(85385)),g=o.__importDefault(i(924849)),C=o.__importDefault(i(139221)),m=o.__importDefault(i(760989));class S extends r.ComponentBase{constructor(){super(...arguments),this._itemPrefix="item_",this._lastReactionPostTime=0,this._isRTL=C.default.isRTL(),this._mountedRefsMap=new g.default,this._onPositionDrawer=(e,t)=>{p.log(h.LogTraceArea.CallReactionsDrawer,"_positionDrawer isOpen: "+t.isOpen+" animated: "+e)},this._onPositionDrawerAnimationCompleted=()=>{p.log(h.LogTraceArea.CallReactionsDrawer,"_onPositionDrawerAnimationCompleted isOpen: "+this.state.isOpen),this._drawerAnimation=void 0;const e=this._mountedRefsMap.ref(this._itemPrefix+0);this.isComponentMounted()&&e&&this.state.isOpen&&e.requestFocus(),this.props.onOpenCloseAnimationComplete&&this.props.onOpenCloseAnimationComplete(this.state.isOpen)},this._renderReactionItem=(e,t)=>{switch(e.type){case d.ReactionsItemType.Animation:case d.ReactionsItemType.Emoticon:case d.ReactionsItemType.Sticker:return this._renderItem(e,t)}},this._onToggleOpen=()=>{const e=!this.state.isOpen;p.log(h.LogTraceArea.CallReactionsDrawer,"_onToggleOpen shouldOpen: "+e),this.setState({isOpen:e})},this._onReactionPressed=(e,t)=>{const i=m.default.newCauseId();p.log(h.LogTraceArea.CallReactionsDrawer,"_onReactionPressed causeId: "+i);const o=Date.now();if(o-this._lastReactionPostTime>=500){const a={reactionInfo:e,causeId:i,timestamp:t,postSource:h.PostSource.CallReactionPressed,callId:this.props.callId,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationMri,logTraceArea:h.LogTraceArea.CallReactionsDrawer};l.CallReactionPostingHelpers.postReaction(a),this._selectedReactionInfo=e,this._lastReactionPostTime=o}this._onHandleReactionPressed()},this._onReactionPanHorizontal=e=>{}}_buildState(e,t){const i={isOpen:!t&&this.state.isOpen,emoticonReactionKey:u.default.getEmoticonReactionKey(e.celebrationData),reactions:u.default.getReactionItems(e.celebrationData)};return t&&this._positionDrawer(!1,i),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=this.state.isOpen!==t.isOpen;o&&this._positionDrawer(!0,this.state),p.log(h.LogTraceArea.CallReactionsDrawer,"componentDidUpdate  openStateChanged: "+o+" isOpen: "+this.state.isOpen+" emoticonReactionKey: "+this.state.emoticonReactionKey)}_renderContent(){let e=0,t=n.map(this.state.reactions,((t,i)=>this._renderReactionItem(t,i+e)));return e+=t.length,this._isRTL&&(t=n.reverse(t)),this._renderReactionViews(n.compact(t))}_renderItem(e,t){if(!e.key)return;const i=this.state.isOpen?void 0:s.Types.ImportantForAccessibility.NoHideDescendants,o=this.state.isOpen?void 0:-1;return(0,a.jsx)(c.default,{ref:this._mountedRefsMap.onComponentRef(this._itemPrefix+t),info:e,isAnimated:this.state.isOpen,onPress:this._onReactionPressed,onPanHorizontal:this.state.isOpen?void 0:this._onReactionPanHorizontal,importantForAccessibility:i,tabIndex:o,celebrationData:this.props.celebrationData},e.key)}openDrawer(){this.state.isOpen||this._onToggleOpen()}openDrawerOnHover(){}closeDrawer(){return this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0),!!this.state.isOpen&&(p.log(h.LogTraceArea.CallReactionsDrawer,"closeDrawer"),this._onToggleOpen(),!0)}isOpen(){return this.state.isOpen}_onHandleReactionPressed(){}}t.default=S},843822:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalBaseCallRecorderToast=t.RemoteBaseCallRecorderToast=void 0;const o=i(197582),a=o.__importStar(i(516778)),n=o.__importDefault(i(150343)),s=o.__importDefault(i(389659)),r=i(815146),l=o.__importStar(i(85385)),c=(o.__importStar(i(50350)),o.__importStar(i(704704))),d=o.__importDefault(i(497910)),u=o.__importDefault(i(601274)),h=o.__importDefault(i(760989));class p extends d.default{constructor(){super(...arguments),this.recordingStartedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(c.getString(this.props.startedAccessibilityLabelTextPath,{name:e}))}},this.recordingStoppedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(c.getString(this.props.stoppedAccessibilityLabelTextPath,{name:e}))}}}componentDidMount(){super.componentDidMount(),this.state.initiatorDisplayName&&this.recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.recordingStoppedAnnounceForAccessibility()}}t.RemoteBaseCallRecorderToast=p;class g extends d.default{constructor(){super(...arguments),this._onStopPress=e=>{const t=h.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"BaseCallRecorderToast.onStopPress causeId:"+t),this.props.onStopPress(this.state.callId,t)},this._onMorePrivacyInfoPress=e=>{a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies)},this._onDismissPrivacyInfoPress=()=>{l.log(r.LogTraceArea.CallingUI,"BaseCallRecorderToast.onDismissPrivacyInfoPress"),this.setState({showPrivacyLink:!1})},this._getElapsedTime=()=>s.default.getElapsedTimeStringFromMs(this.state.recordingElapsedTimeMs),this._recordingStartedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(c.getString(this.props.startedAccessibilityLabelTextPath))},this._recordingStoppedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(c.getString(this.props.stoppedAccessibilityLabelTextPath))}}componentDidMount(){super.componentDidMount(),this.callRecordingTimer=u.default.setInterval((()=>{let e=0;const t=this.state.recordingTimestamp?this.state.recordingTimestamp:void 0;if(t){const i=s.default.getUnixMillisecondsTimestamp(t);e=Date.now()-i,e<0&&(e=0)}this.isComponentMounted()&&this.setState({recordingElapsedTimeMs:e})}),1e3),this._recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.privacyInfoDisplayTimer&&(u.default.clearTimeout(this.privacyInfoDisplayTimer),this.privacyInfoDisplayTimer=void 0),this.callRecordingTimer&&(u.default.clearTimeout(this.callRecordingTimer),this.callRecordingTimer=void 0),this._recordingStoppedAnnounceForAccessibility()}}t.LocalBaseCallRecorderToast=g},26178:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallButton=t.CallButtonSpacing=t.CallButtonBackgroundStyle=t.CallButtonSize=void 0;const o=i(197582),a=i(667294),n=i(785893),s=o.__importStar(i(496486)),r=o.__importStar(i(859745)),l=o.__importStar(i(516778)),c=o.__importStar(i(85385)),d=i(460515),u=i(315742),h=o.__importDefault(i(453761)),p=i(641400),g=i(815146),C=o.__importDefault(i(631681)),m=i(16549),S=o.__importDefault(i(958868)),_=o.__importDefault(i(313333)),f=i(26703),y=o.__importDefault(i(139221)),T=o.__importDefault(i(20758)),b=o.__importDefault(i(827361)),v=o.__importDefault(i(760989));var I,w,P;!function(e){e[e.ExtraSmall=0]="ExtraSmall",e[e.Small=1]="Small",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge"}(I||(t.CallButtonSize=I={})),function(e){e[e.None=0]="None",e[e.Solid=1]="Solid",e[e.Overlay=2]="Overlay"}(w||(t.CallButtonBackgroundStyle=w={})),function(e){e[e.Default=0]="Default",e[e.Small=1]="Small",e[e.None=2]="None"}(P||(t.CallButtonSpacing=P={}));const M=d.CallButtonSizes.callbuttonExtraLargeSize,D=d.CallButtonSizes.callbuttonLargeSize,A=d.CallButtonSizes.callbuttonSmallSize,k=d.CallButtonSizes.callbuttonExtraSmallSize,R=y.default.getPlatformType()===g.PlatformType.iOS,x=(0,f.lazyProperties)({buttonSolidBackground:()=>l.Styles.createViewStyle({backgroundColor:m.Color.gray400}),buttonOverlayBackground:()=>l.Styles.createViewStyle({backgroundColor:m.Color.gray400Overlay10}),callingButtonExtraLarge:()=>l.Styles.createViewStyle({width:M,height:M,borderRadius:M/2}),callingButtonLarge:()=>l.Styles.createViewStyle({width:D,height:D,borderRadius:D/2}),callingButtonSmall:()=>l.Styles.createViewStyle({width:A,height:A,borderRadius:A/2}),callingButtonExtraSmall:()=>l.Styles.createViewStyle({width:k,height:k,borderRadius:k/2}),squareButtonExtraLarge:()=>l.Styles.createViewStyle({width:M,height:M,borderRadius:M/4}),squareButtonLarge:()=>l.Styles.createViewStyle({width:D,height:D,borderRadius:D/4}),squareButtonSmall:()=>l.Styles.createViewStyle({width:A,height:A,borderRadius:A/4}),squareButtonExtraSmall:()=>l.Styles.createViewStyle({width:k,height:k,borderRadius:k/4}),startCallButton:()=>l.Styles.createButtonStyle({backgroundColor:R?m.Color.greenIOS:m.Color.green}),endCallButton:()=>l.Styles.createButtonStyle({backgroundColor:R?m.Color.redIOS:m.Color.red}),mergeCallButton:()=>l.Styles.createButtonStyle({backgroundColor:m.Color.gray200}),innerContainer:()=>l.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"visible"}),innerContainerMargin:()=>l.Styles.createViewStyle({marginHorizontal:8}),smallButtonMargin:()=>l.Styles.createViewStyle({marginHorizontal:5}),noButtonMargin:()=>l.Styles.createViewStyle({marginHorizontal:0}),mergeIconColor:()=>l.Styles.createTextStyle({color:m.Color.black}),selected:()=>l.Styles.createViewStyle({backgroundColor:m.Color.white}),modernChatIconBadge:()=>l.Styles.createViewStyle({height:8,width:8,backgroundColor:m.Color.red,borderRadius:4,position:"absolute",right:7,top:7,justifyContent:"center",alignItems:"center"}),containerWithCaption:()=>l.Styles.createViewStyle({justifyContent:"center"}),buttonWithCaption:()=>l.Styles.createViewStyle({width:70,justifyContent:"center",overflow:"visible"}),caption:()=>l.Styles.createTextStyle({paddingTop:0,textAlign:"center",fontSize:T.default.controlFontSize.actionButtonLabel,color:m.Color.white,width:70}),iconButtonWithCaption:()=>l.Styles.createViewStyle({justifyContent:"center"}),mainAndAdditionalImageWrapper:()=>l.Styles.createViewStyle({overflow:"visible"})});class L extends S.default{constructor(){super(...arguments),this._pressed=!1,this._hovered=!1,this._onAnimatedViewRef=e=>{this._animatedView=e||void 0},this._onPressIn=()=>{this._updateButton(!0),this._pressed=!0,this.props.onPressIn&&this.props.onPressIn()},this._onPressOut=()=>{this._pressed&&(this._updateButton(!1),this._pressed=!1),this.props.onPressOut&&this.props.onPressOut()},this._onPress=e=>{e.stopPropagation(),this.props.showToolTip&&_.default.clearToolTip(),this.props.onPress&&this.props.onPress(e)},this._onContentIconButtonRef=e=>{this._contentIconButton=e||void 0},this._onHover=e=>{this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.showToolTip&&this.props.title&&this._hovered)||l.UserInterface.isNavigatingWithKeyboard());t()?s.delay((()=>{t()&&_.default.showToolTip((()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),t,this.props.title||"",this.props.toolTipConfig)}),150):_.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}}static sizeForCallButtonSize(e){switch(e){case I.ExtraLarge:return M;case I.Large:return D;case I.Small:return A;case I.ExtraSmall:return k}}componentWillUnmount(){super.componentWillUnmount(),this.props.showToolTip&&this._hovered&&_.default.clearToolTip()}componentDidMount(){super.componentDidMount(),this._updateButtonVisibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.show!==e.show&&this._updateButtonVisibility()}_updateButtonVisibility(){var e,t;void 0!==this.props.show&&(this.props.show?null===(e=this._animatedView)||void 0===e||e.fadeIn():null===(t=this._animatedView)||void 0===t||t.fadeOut())}_updateButton(e){const t=e?.8:1,i=e?.92:1;this._internalUpdateButton(t,i)}_internalUpdateButton(e,t){const i=v.default.newCauseId();c.log(g.LogTraceArea.SXAnimated,"CallButton._internalUpdateButton causeId: "+i),this._animatedView&&this._animatedView.getAnimation({opacity:e,scale:t},i).start()}_renderIconButton(e,t,i,o,s={}){var r,l,c,d;const p=null!=i?i:this.props.colorConfig?o?this.props.colorConfig.selectedIconColor:this.props.colorConfig.iconColor:o?m.Color.gray400:m.Color.white,g=null===(r=this.props.colorConfig)||void 0===r?void 0:r.hoverStyle,S=Object.assign(Object.assign({},s),{style:e,size:t,title:this.props.showToolTip?void 0:this.props.title,icon:this.props.icon,hoverStyle:g,hoverIcon:null===(l=this.props.colorConfig)||void 0===l?void 0:l.hoverIcon,hoverColor:null===(c=this.props.colorConfig)||void 0===c?void 0:c.hoverColor,color:p,onHover:this.props.onHover||this.props.showToolTip?this._onHover:void 0,showHoverEffect:null===(d=this.props.colorConfig)||void 0===d?void 0:d.showHoverEffect,disabled:this.props.isDisabled,tabIndex:this.props.caption?-1:0,renderIcon:this.props.renderIcon});return this.props.coachMarkType&&this.props.anchorAccessibilityLabel?this.props.caption?(0,n.jsx)(C.default.View,{anchorRef:this._onContentIconButtonRef,coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[u.PopupAnchorPositon.Top],children:(0,n.jsx)(h.default,Object.assign({},S))},this.props.coachMarkType):(0,a.createElement)(C.default.IconButton,Object.assign({anchorRef:this._onContentIconButtonRef},S,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[u.PopupAnchorPositon.Top],key:this.props.coachMarkType})):(0,n.jsx)(h.default,Object.assign({ref:this._onContentIconButtonRef},S))}requestFocus(){this._contentIconButton&&this._contentIconButton.requestFocus()}render(){const{caption:e,isToggledOn:t,colorConfig:i,borderWidth:o,isBadgeOn:a,additionalImage:s}=this.props,c=[b.default.overflowVisible,b.default.noncollapsibleView,b.default.alignItemsCenter,this.props.style],d=t||this.props.colorConfig&&(this.props.isCallEndButton||this.props.isCallStartButton||this.props.isCallMergeButton),u=this._getIconButtonStylesBySize(),h=[u,this._getIconButtonBackgroundStyle(),d?this._getIconButtonToggledBackgroundStyle():void 0],p=[u,x.innerContainer,this.props.doNotAddHorizontalMargin?void 0:x.innerContainerMargin,this._getSpacing()];if(i){if(i.borderColor){const e=l.Styles.createViewStyle({borderColor:i.borderColor,borderWidth:null!=o?o:1},!1);p.push(e),h.push(e)}}else this.props.isCallEndButton&&h.push(x.endCallButton),this.props.isCallStartButton&&h.push(x.startCallButton),this.props.isCallMergeButton&&h.push(x.mergeCallButton);e&&(h.push(x.iconButtonWithCaption),c.push(x.containerWithCaption));const g=this._getIconBySize();let C;a&&(C=(0,n.jsx)(l.View,{style:x.modernChatIconBadge}));const S=this._getDefaultButtonProps(),_=null==i?void 0:i.showHoverEffect;let f=(0,n.jsxs)(r.View,{ref:this._onAnimatedViewRef,style:c,children:[(0,n.jsxs)(l.View,{onMouseLeave:this._onPressOut,style:x.mainAndAdditionalImageWrapper,children:[(0,n.jsxs)(l.View,{style:p,children:[this._renderIconButton(h,g,this.props.isCallMergeButton?m.Color.black:void 0,!!d,!e||_?S:void 0),C]}),s]}),this._getOptionalCaption()]});return e&&(f=(0,n.jsx)(l.Button,Object.assign({},S,{importantForAccessibility:l.Types.ImportantForAccessibility.Yes,style:x.buttonWithCaption,children:f}))),f}_getOptionalCaption(){if(!this.props.caption)return;const e=[x.caption,...this.props.colorConfig&&this.props.colorConfig.captionColor?[{color:this.props.colorConfig.captionColor}]:[]];return(0,n.jsx)(l.Text,{style:e,ellipsizeMode:"head",numberOfLines:1,children:this.props.caption})}_getDefaultButtonProps(){return{onPress:this._onPress,onPressIn:this._onPressIn,onPressOut:this._onPressOut,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,disabled:this.props.isDisabled,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility}}_getIconButtonStylesBySize(){let e;switch(this.props.size){case I.ExtraSmall:e=this.props.isSquareButton?x.squareButtonExtraSmall:x.callingButtonExtraSmall;break;case I.Small:e=this.props.isSquareButton?x.squareButtonSmall:x.callingButtonSmall;break;case I.Large:e=this.props.isSquareButton?x.squareButtonLarge:x.callingButtonLarge;break;case I.ExtraLarge:e=this.props.isSquareButton?x.squareButtonExtraLarge:x.callingButtonExtraLarge}return e}_getIconButtonBackgroundStyle(){return this.props.colorConfig?l.Styles.createViewStyle({backgroundColor:this.props.colorConfig.backgroundColor},!1):this.props.backgroundStyle===w.Solid?x.buttonSolidBackground:this.props.backgroundStyle===w.Overlay?x.buttonOverlayBackground:void 0}_getIconButtonToggledBackgroundStyle(){return this.props.colorConfig?l.Styles.createViewStyle({backgroundColor:this.props.colorConfig.selectedBackgroundColor},!1):x.selected}_getIconBySize(){switch(this.props.size){case I.ExtraSmall:return p.IconSize.size16;case I.Small:return p.IconSize.size20;case I.Large:return p.IconSize.size24;case I.ExtraLarge:return p.IconSize.size28}}_getSpacing(){let e;switch(this.props.spacing){case P.Small:e=x.smallButtonMargin;break;case P.None:e=x.noButtonMargin}return e}}t.CallButton=L,t.default=L},702814:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(354676)),s=i(154235),r=o.__importStar(i(808164)),l=o.__importDefault(i(660401)),c=o.__importDefault(i(497910));class d extends c.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){let i;if(r.default.isValidNumberString(e.phoneNumber)){const t=r.default.stripPlusSign(e.phoneNumber);i=n.default.getCallRateByPhoneNumber(t)}return{callRate:i}}render(){const e=r.default.parseAndFormat(this.props.phoneNumber,r.PhoneNumberFormat.INTERNATIONAL)||this.props.phoneNumber;return(0,a.jsx)(l.default,{ref:this._onComponentRef,buttonSize:s.SXButtonSize.Large,icon:this.props.icon,title:e,subtitle:this.state.callRate,accessibilityLabel:this.props.accessibilityLabel,allowTextWrap:!0,onPress:this.props.onPress},"callingbutton_"+this.props.phoneNumber)}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}}t.default=d},614360:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallButtonIconSize=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(369347)),l=i(619429),c=o.__importDefault(i(549173)),d=i(460515),u=o.__importStar(i(44717)),h=o.__importDefault(i(601976)),p=i(815146),g=o.__importDefault(i(453761)),C=o.__importStar(i(85385)),m=i(26703),S=o.__importDefault(i(432091)),_=o.__importStar(i(704704)),f=o.__importDefault(i(740794)),y=o.__importDefault(i(942724)),T=o.__importStar(i(69848)),b=o.__importDefault(i(223815)),v=o.__importDefault(i(184457)),I=i(36381),w=i(16549),P=i(641400),M=o.__importDefault(i(497910)),D=o.__importDefault(i(685734)),A=o.__importDefault(i(760989));var k;!function(e){e[e.Default=0]="Default",e[e.Compact=1]="Compact",e[e.ExtraCompact=2]="ExtraCompact"}(k||(t.CallButtonIconSize=k={}));const R=(0,m.lazyProperties)({hiddenContainer:()=>s.Styles.createViewStyle({width:0,justifyContent:"flex-end"}),button:()=>s.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:w.Color.transparent})});class x extends M.default{constructor(){super(...arguments),this._onAudioButtonRef=e=>{this._audioButtonRef=e||void 0},this._onVideoButtonRef=e=>{this._videoButtonRef=e||void 0},this._onUpcomingCallDetailsButtonPress=e=>{if(e.stopPropagation(),!this.props.scheduledCallId)return;const t=A.default.newCauseId();C.log(p.LogTraceArea.CallNavigation,"CallButtons._onUpcomingCallDetailsButtonPress, causeId: "+t),!this.state.isUsingStackNav&&this.props.mri&&f.default.navigateToConversation({convId:this.props.mri,causeId:t,origin:p.NavigationConversationOrigin.Search});const i=v.default.ScheduledCallsStore.getScheduledCallById(this.props.scheduledCallId);i&&v.default.NavigationActions.navigateToScheduledOverviewPanel({scheduledCallId:i.id,entryPoint:I.ScheduleCallEntryPoint.UpcomingCallComponent},this._getRootViewId())},this._onCallButtonPress=e=>{e.stopPropagation();const t=A.default.newCauseId();C.log(p.LogTraceArea.CallNavigation,"SearchItem._onCallButtonPress causeId: "+t);const i=()=>this._audioButtonRef;this.props.mri&&u.isPhoneMri(this.props.mri)&&(!this.props.addressBookContactOverride||this.props.addressBookContactOverride&&this.props.addressBookContactOverride.shortCircuitMriMatch)?this._handlePstnOnlyClick(i):this._startCall(!1,t,i)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=A.default.newCauseId();C.log(p.LogTraceArea.CallNavigation,"SearchItem._onVideoCallButtonPress causeId: "+t);this._startCall(!0,t,(()=>this._videoButtonRef))}}_buildState(e,t){const i={};let o=!1;return e.addressBookContactOverride?(i.isEncrypted=!1,i.displayName=e.addressBookContactOverride.getDisplayName()):e.mri?(i.isEncrypted=u.isEncryptedThread(e.mri),i.displayName=h.default.getDisplayName(e.mri)||"",i.activeCallStatus=r.default.ActiveCallUIHelper.activeCallStatus(e.mri),o=u.isPhoneMri(e.mri)):(i.isEncrypted=!1,i.displayName=""),i.isUsingStackNav=y.default.isUsingStackNavigationContext(),i.multipleAudioCallOptionsAvailable=e.mri&&!u.isEncryptedThread(e.mri)&&u.isOneOnOneConversation(e.mri)&&x._areMultipleAudioCallOptionsAvailable(e),i.callingNotAllowed=!e.mri||!u.isMri(e.mri)||!r.default.CallNavigationHelper.isOutgoingCallingAllowed(e.mri),i.allowOutboundVideo=e.mri&&!e.scheduledCallId&&u.isMri(e.mri)&&r.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:o,isEncryptedCall:i.isEncrypted,conversationMri:e.mri}),i}render(){let e,t,i,o,r;const l=this._themeColors.iconHoverColor,c=this.props.iconColor||this._themeColors.primaryIconColor,u=this.state.activeCallStatus===d.ActiveCallStatus.OnHold;this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?(o=!n.isEmpty(this.props.addressBookContactOverride.phones),r=!1):(o=!0,r=this.state.allowOutboundVideo);const h=[R.button];let p=P.IconSize.size24;if(this.props.iconSize&&(p=this.props.iconSize===k.Compact?P.IconSize.size20:P.IconSize.size16),o){let e,i;u?e=P.SkypeIcon.Pause:this.state.isEncrypted?e=P.SkypeIcon.PrivateCallFill:this.state.multipleAudioCallOptionsAvailable?(e=P.SkypeIcon.CallOptions,i=[s.Types.AccessibilityTrait.Button,s.Types.AccessibilityTrait.HasPopup]):e=P.SkypeIcon.CallStart,t=(0,a.jsx)(g.default,{ref:this._onAudioButtonRef,size:p,onPress:this._onCallButtonPress,color:c,hoverColor:l,icon:e,style:h,disabled:this.state.callingNotAllowed,title:_.getString("SkypeUserListItem.StartAudioCallButtonLabel"),accessibilityLabel:_.getString("AccessibilityLabel.StartAudioCallButtonAccessibilityLabel",{displayName:this.state.displayName}),accessibilityTraits:i})}this.props.scheduledCallId&&(i=(0,a.jsx)(g.default,{size:p,onPress:this._onUpcomingCallDetailsButtonPress,color:c,hoverColor:l,icon:P.SkypeIcon.Schedule,style:h,title:_.getString("SkypeUserListItem.ViewUpcomingCallDetailsButtonLabel"),accessibilityLabel:_.getString("AccessibilityLabel.ViewUpcomingCallDetailsButtonAccessibilityLabel",{displayName:this.state.displayName})})),r&&(e=(0,a.jsx)(g.default,{ref:this._onVideoButtonRef,size:p,onPress:this._onVideoCallButtonPress,color:c,hoverColor:l,icon:P.SkypeIcon.Video,style:h,disabled:this.state.callingNotAllowed,title:_.getString("SkypeUserListItem.StartVideoCallButtonLabel"),accessibilityLabel:_.getString("AccessibilityLabel.StartVideoCallButtonAccessibilityLabel",{displayName:this.state.displayName})}));const C=[T.styles.optionalCallButtonsContainer,this.props.hidden?R.hiddenContainer:void 0];return(0,a.jsxs)(s.View,{style:C,importantForAccessibility:this.props.hidden?s.Types.ImportantForAccessibility.NoHideDescendants:void 0,children:[i,e,t]})}_handlePstnOnlyClick(e){const t=this.props.mri;t&&D.default.getFullUserProfileByMriAsync(t).then((i=>{var o;if(!i)return;const a=u.getPhoneNumberFromMri(t);if(!a)return;const n=S.default.getContactByPhoneNumber(a),s=n?n.getDisplayName():i.getDisplayName(),r=null===(o=i.emails)||void 0===o?void 0:o.map((e=>e.address));c.default.showForAddressContact(e,this._getRootViewId(),s,p.ContactInviteOrigin.CallPanelSearch,p.NavigationCallOrigin.SkypeUserListItem,i.phones,r)}))}_startCall(e,t,i){const o={skypeMri:this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?void 0:this.props.mri,phones:this.props.addressBookContactOverride?this.props.addressBookContactOverride.phones:void 0,userIntent:e?l.StartCallOrMaybePromptUserIntent.Video:l.StartCallOrMaybePromptUserIntent.Audio,inviteOrigin:p.ContactInviteOrigin.SearchItem,callOrigin:p.NavigationCallOrigin.SearchItem},a=this.props.mri;a&&b.default.shouldShowInterstitial(a,e)?b.default.maybeShowRinglessCallInterstitial(a,e,o.callOrigin,t):c.default.startCallOrMaybePrompt(i,this._getRootViewId(),o,t)}static _areMultipleAudioCallOptionsAvailable(e){return!!e.mri&&(!!u.isPhoneMri(e.mri)||D.default.getDisplayableUserByMri(e.mri).getHasPhoneNumbers())}}t.default=x},957895:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(657784),l=i(619429),c=o.__importDefault(i(549173)),d=o.__importDefault(i(306794)),u=o.__importStar(i(873324)),h=o.__importDefault(i(167492)),p=o.__importStar(i(44717)),g=o.__importDefault(i(604266)),C=o.__importDefault(i(734468)),m=o.__importDefault(i(389659)),S=o.__importStar(i(170881)),_=o.__importDefault(i(601976)),f=i(815146),y=o.__importDefault(i(970035)),T=o.__importStar(i(85385)),b=i(26703),v=o.__importStar(i(704704)),I=o.__importDefault(i(848633)),w=o.__importDefault(i(211124)),P=o.__importDefault(i(363091)),M=o.__importDefault(i(808164)),D=o.__importDefault(i(421334)),A=o.__importStar(i(122671)),k=o.__importStar(i(888500)),R=i(16549),x=o.__importDefault(i(139221)),L=o.__importDefault(i(20758)),B=i(641400),V=i(331079),O=o.__importDefault(i(827361)),E=i(262725),N=o.__importDefault(i(497910)),F=o.__importDefault(i(760989)),U=200,H=110,j=k.default.menuId(),z=(0,b.lazyProperties)({container:()=>s.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:U}),cardFooterContainer:()=>s.Styles.createViewStyle({alignItems:"stretch"}),cardFooterContainerEnded:()=>s.Styles.createViewStyle({minHeight:72}),messageText:()=>s.Styles.createTextStyle({paddingHorizontal:10,textAlignVertical:"center",marginTop:3}),messageTextIOS:()=>s.Styles.createTextStyle({paddingVertical:3,marginTop:0}),durationContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingBottom:3}),durationIconMargins:()=>s.Styles.createViewStyle({marginRight:3}),optionalButton:()=>s.Styles.createButtonStyle({paddingVertical:13,borderTopWidth:2,borderStyle:"solid"}),optionalButtonText:()=>s.Styles.createTextStyle({textAlign:"center"}),optionalButtonHover:()=>s.Styles.createTextStyle({color:R.Color.gray300}),participantsText:()=>s.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:3}),picturesContainer:()=>s.Styles.createViewStyle({height:H,flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",backgroundColor:R.Color.gray200}),pictureTripleMain:()=>s.Styles.createViewStyle({height:110,width:100}),pictureTripleStack:()=>s.Styles.createViewStyle({height:55,width:100}),pictureDouble:()=>s.Styles.createViewStyle({height:110,width:100}),pictureSingle:()=>s.Styles.createViewStyle({height:110,width:200}),rightPicturesStackContainer:()=>s.Styles.createViewStyle({justifyContent:"space-between"}),lastPictureOverlay:()=>s.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",backgroundColor:R.Color.blackOverlay20}),lastPictureOverlayText:()=>s.Styles.createTextStyle({color:R.Color.white})});class G extends N.default{constructor(){super(...arguments),this._mediaThumbnailNodes={},this._onCallBackButtonRef=e=>{this._callBackButton=e||void 0},this._onInviteButtonRef=e=>{this._inviteButton=e||void 0},this._onHoverStartCallBack=()=>{this.setState({hoveringOverCallBack:!0})},this._onHoverEndCallBack=()=>{this.setState({hoveringOverCallBack:!1})},this._onHoverStartInvite=()=>{this.setState({hoveringOverInvite:!0})},this._onHoverEndInvite=()=>{this.setState({hoveringOverInvite:!1})},this._onPicturePress=e=>{T.log(f.LogTraceArea.CallCard,"Loading MediaViewer for CallCard"),T.track(new u.CallActionEnterFromCallCard),w.default.showWithMessageConfig({initialMessage:e,animateOpenClose:!0,rootViewId:this._getRootViewId(),getContentNode:e=>this._mediaThumbnailNodes[e],origin:f.NavigationMediaViewerOrigin.CallCard}),S.dismissAll()},this._onCallBackButtonPress=()=>{const e=F.default.newCauseId();T.log(f.LogTraceArea.CallCard,"CallCard._onCallBackButtonPress causeId: "+e),c.default.startCallOrMaybePrompt((()=>this._callBackButton),this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:l.StartCallOrMaybePromptUserIntent.Generic,callOrigin:f.NavigationCallOrigin.CallCard,inviteOrigin:f.ContactInviteOrigin.Unknown},e)},this._onInviteButtonPress=e=>{const t=p.getPhoneNumberFromMri(this.props.conversationId)||"",i=[{text:M.default.formatNumberWithType({number:t,type:V.PhoneNumberTypes.Other}),command:`sms:${t}`}],o={anchor:()=>this._inviteButton,useTheme:!0};k.default.showWithOptions({id:j,config:o,getMenuItems:()=>i,handleMenuCommand:this._handleInviteActionCommand,menuTitle:v.getString("CallCard.InviteActionTitle"),rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleInviteActionCommand=e=>{if(e===k.SXActionMenuCancel)return;const t=e.split(":")[1];A.default.initiateJoinLinkInvite({target:new A.SmsInvite(t),origin:f.ContactInviteOrigin.CallCard,showLoadingModalWhileGettingJoinLink:!0,rootViewId:this._getRootViewId()})}}static getConstrainedWidth(){return U}_buildState(e,t){const i=P.default.isMyMri(e.creatorMri),o={creatorUserColor:i?void 0:C.default.getColorInfo(e.creatorMri),isCreatedByUser:i};if(t&&(o.hoveringOverInvite=!1,o.hoveringOverCallBack=!1),h.default.hasVisibleCall()&&h.default.isCallVisible(e.callId))o.pictures=t?[]:this.state.pictures,o.participants=t?[]:this.state.participants,o.isLargeCard=!t&&this.state.isLargeCard,o.participantsText=t?"":this.state.participantsText,o.shouldShowInviteButton=!t&&this.state.shouldShowInviteButton,o.isMobileScreenReaderEnabled=!t&&this.state.isMobileScreenReaderEnabled;else{let i;if(i=e.cardType===r.CallCardType.Cast?e.conversationId:p.getReactionsThreadMriForCallId(e.callId),i){const t=d.default.getPictureReactions(e.callId,0,!0);o.pictures=n.sortBy(t,(e=>e.createdTime)),o.reactionsConversationId=i}else o.pictures=t?[]:this.state.pictures;if(o.participants=n.compact(n.map(e.userParticipantMris,(e=>e?_.default.getDisplayableProfile(e):void 0))),o.isLargeCard=e.cardType===r.CallCardType.Ended||e.cardType===r.CallCardType.Cast,o.participantsText=this._getFormattedParticipantNames(e.conversationId,e.creatorMri),o.isMobileScreenReaderEnabled=D.default.isMobileScreenReaderEnabled(),e.isPSTN){const t=p.getPhoneNumberFromMri(e.conversationId);if(t){const e=g.default.getSortedUsersByPhoneNumber(t);o.shouldShowInviteButton=0===e.length&&!1}else o.shouldShowInviteButton=!1}}return o}render(){return(0,a.jsxs)(s.View,{style:[z.container,this.props.containerRadiusStyles],onPress:this.state.isMobileScreenReaderEnabled&&!this.state.isLargeCard?this._onCallBackButtonPress:void 0,children:[this._renderPictures(),this._renderCardFooter()]})}_renderPictures(){const e=this.state.pictures.length;if(e){const t=[],i=[],o=2;this._mediaThumbnailNodes={},n.each(this.state.pictures,((n,r)=>{if(r>o)return!1;let l,c=0,d=0;e>=3?0===r?(l=z.pictureTripleMain,c=110,d=100):(l=z.pictureTripleStack,c=55,d=100):2===e?(l=z.pictureDouble,c=110,d=100):1===e&&(l=z.pictureSingle,c=110,d=200);const u=(0,a.jsx)(I.default,{ref:e=>{this._mediaThumbnailNodes[n.cuid]={component:e}},message:n,width:d,height:c});let h;r===o&&3!==e&&(h=(0,a.jsx)(s.View,{style:z.lastPictureOverlay,blockPointerEvents:!0,children:(0,a.jsx)(E.BodyText,{bold:!0,style:z.lastPictureOverlayText,children:"+"+(e-r)})}));const p=(0,a.jsxs)(s.View,{style:l,onPress:()=>this._onPicturePress(n),children:[u,h]},"callPicture"+r);return e<3||0===r?t.push(p):i.push(p),!0}));const r=i.length?(0,a.jsx)(s.View,{style:z.rightPicturesStackContainer,children:i}):null,l=[z.picturesContainer];return!this.state.isCreatedByUser&&this._themeStyles.bubbleColorOtherStyle&&l.push(this._themeStyles.bubbleColorOtherStyle),(0,a.jsxs)(s.View,{style:l,children:[t,r]})}}_renderCardFooter(){const e=this._isMissedCall(),t=p.isBlockedPSTNMri(this.props.conversationId),i=[L.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,z.optionalButtonText];this.state.hoveringOverCallBack&&i.push(z.optionalButtonHover);const o=e&&!t?(0,a.jsx)(s.Button,{ref:this._onCallBackButtonRef,style:[z.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onCallBackButtonPress,onHoverStart:this._onHoverStartCallBack,onHoverEnd:this._onHoverEndCallBack,underlayColor:this._themeColors.rowHighlightColor,children:(0,a.jsx)(s.Text,{style:i,numberOfLines:1,children:v.getString("CallCard.CallBackButton")})}):null,n=[L.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,z.optionalButtonText];this.state.hoveringOverInvite&&n.push(z.optionalButtonHover);const r=this.state.shouldShowInviteButton&&!t?(0,a.jsx)(s.Button,{ref:this._onInviteButtonRef,style:[z.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onInviteButtonPress,onHoverStart:this._onHoverStartInvite,onHoverEnd:this._onHoverEndInvite,children:(0,a.jsx)(s.Text,{style:n,children:v.getString("CallCard.InviteButton")})}):null,l=[z.cardFooterContainer,this._themeStyles.cardColorStyle];e?l.push(O.default.flexOne):l.push(z.cardFooterContainerEnded);const c=[z.messageText];return x.default.getPlatformType()===f.PlatformType.iOS&&c.push(z.messageTextIOS),(0,a.jsxs)(s.View,{style:l,children:[(0,a.jsx)(E.Subtitle,{style:c,numberOfLines:1,children:this.props.messageText}),(0,a.jsx)(E.CardTitle,{style:z.participantsText,numberOfLines:1,children:this.state.participantsText}),(0,a.jsxs)(s.View,{style:z.durationContainer,children:[(0,a.jsx)(y.default,{icon:this.props.iconText,size:B.IconSize.size12,color:this._themeColors.secondaryTextColor,style:z.durationIconMargins}),(0,a.jsx)(E.Caption,{children:this.props.durationText?this.props.durationText:m.default.getDisplayTimeString(this.props.createdTime)})]}),r,o]})}_getFormattedParticipantNames(e,t){const i=p.isThread(e),o=v.getString("DisplayInfoStore.ListMyName"),a=P.default.isMyMri(t)?o:_.default.getShortDisplayName(t);let n="";if(i)n=v.getString("CallCard.CallParticipantsString",{nameA:a,nameB:_.default.getDisplayName(e)||v.getString("Notifications.UnknownUserShort")});else{const i=P.default.isMyMri(t)?_.default.getShortDisplayName(e):o;n=v.getString("CallCard.CallParticipantsString",{nameA:a,nameB:i})}return n}_isMissedCall(){return this.props.cardType===r.CallCardType.Missed}}t.default=G},484591:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(369347)),l=o.__importDefault(i(758117)),c=o.__importDefault(i(638260)),d=i(815146),u=o.__importDefault(i(970035)),h=o.__importStar(i(85385)),p=i(26703),g=o.__importStar(i(704704)),C=i(16549),m=i(641400),S=i(262725),_=o.__importDefault(i(760989)),f=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>n.Styles.createViewStyle({marginRight:10})});class y extends s.ComponentBase{constructor(){super(...arguments),this._onStartAudioOnlyPress=e=>{const t=_.default.newCauseId();h.log(d.LogTraceArea.CallingUI,"CallConnectionQualityBanner starting AudioOnly mode. causeId:"+t),r.default.CallingStore.startAudioOnly(this.props.callId,t)},this._onStopAudioOnlyPress=e=>{const t=_.default.newCauseId();h.log(d.LogTraceArea.CallingUI,"CallConnectionQualityBanner stopping AudioOnlyMode. causeId:"+t),r.default.CallingStore.stopAudioOnly(this.props.callId,t)}}_buildState(e,t){const i={callId:e.callId,conversationMri:e.conversationMri,isPSTNCall:r.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:r.default.CallingStore.isEncryptedCall(e.callId)},o=r.default.CallingStore.isProvidingVideo(e.callId)||r.default.RemoteStreamHelper.isStreamAvailableForAnyParticipant(e.callId),a=(0,l.default)();return{allowAudioOnly:r.default.CallingFeaturesHelper.allowAudioOnly(i)&&o,audioOnlyEnabled:r.default.CallingStore.isAudioOnly(e.callId),callNetworkQualityPoor:a.isCallQualityPoor(e.callId),callNetworkCatastrophic:a.isCallCatastrophic(e.callId)}}_renderHyperlink(){const e=_.default.newCauseId();if(this.state.audioOnlyEnabled){h.log(d.LogTraceArea.CallingUI,`CallConnectionQualityBanner shows stop audio only. causeId: ${e}`);const t=g.getString("CallConnectionQualityToast.StopAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStopAudioOnlyPress)}if(this.state.allowAudioOnly&&this.state.callNetworkCatastrophic){h.log(d.LogTraceArea.CallingUI,`CallConnectionQualityBanner audio only suggestion. causeId: ${e}`),c.default.updateCallTelemetry(this.props.callId,e,(e=>e.suggestAudioOnly()));const t=g.getString("CallConnectionQualityToast.StartAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStartAudioOnlyPress)}}_renderHyperlinkButton(e,t){return(0,a.jsx)(n.Button,{onPress:t,children:(0,a.jsx)(S.BodyText,{style:this.props.linkStyle,children:e})})}_renderIcon(){var e;if(this.state.callNetworkQualityPoor)return(0,a.jsx)(u.default,{style:f.icon,icon:m.SkypeIcon.CallQualityIndicator,size:m.IconSize.size24,color:null!==(e=this.props.iconColor)&&void 0!==e?e:C.Color.white})}_getTitleText(){return this.state.callNetworkQualityPoor&&this.state.audioOnlyEnabled?g.getString("CallConnectionQualityToast.PoorConnectionAndAudioOnlyEnabledTitle"):this.state.audioOnlyEnabled?g.getString("CallConnectionQualityToast.AudioOnlyTitle"):g.getString("CallConnectionQualityToast.PoorConnectionTitle")}render(){return(0,a.jsxs)(n.View,{style:f.container,children:[this._renderIcon(),(0,a.jsxs)(n.View,{style:this.props.containerStyle,children:[(0,a.jsx)(S.BodyText,{style:this.props.textStyle,numberOfLines:1,children:this._getTitleText()}),this._renderHyperlink()]})]})}}t.default=y},737298:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EndAllCallsInConversationCommand=t.StopScreenShareCommand=t.RequestScreenShareCommand=t.ToggleVideoCommand=t.ChangeCallLayoutCommand=t.MuteEveryoneCommand=t.EndCallForEveryoneCommand=t.EndCallCommand=t.ToggleScreenShareCommand=t.ToggleMuteCommand=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(148540),s=o.__importStar(i(397691)),r=o.__importDefault(i(150343)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(99741)),d=o.__importDefault(i(947878)),u=o.__importDefault(i(638260)),h=i(460515),p=o.__importDefault(i(132680)),g=o.__importDefault(i(615364)),C=i(815146),m=o.__importStar(i(85385)),S=i(675862),_=o.__importDefault(i(363091)),f=o.__importDefault(i(740794)),y=o.__importDefault(i(246230)),T=o.__importDefault(i(655192)),b=i(331079),v=o.__importDefault(i(989819)),I=o.__importDefault(i(760989)),w=o.__importDefault(i(92179));t.ToggleMuteCommand=class{constructor(e,t,i,o,a,n,s=I.default.newCauseId()){this._callId=e,this._muted=t,this._serverMuted=i,this._isPermissionDenied=o,this._rootViewId=a,this._scenarioId=n,this._causeId=s}execute(){const e=`ToggleMuteCommand.execute causeId: ${this._causeId}`,t=`this.state.isMuted: ${this._muted}`,i=`this.state.isServerMuted: ${this._serverMuted}`;m.log(C.LogTraceArea.CallingUI,`${e}, ${t}, ${i}`),l.default.CallPermissionsUtils.requestPermissionStatus(b.PermissionType.Microphone,this._causeId).then((e=>{e?this._toggleMic(this._causeId):this._showMicDeniedPrompt()}))}_showMicDeniedPrompt(){y.default.showDeniedPromptWithSettingsOption(b.PermissionType.Microphone,this._rootViewId)}_toggleMic(e,t){this._muted?(l.default.CallingStore.unmute(this._callId,e).then((()=>{t&&w.default.markActionDoneAndRemoveTracker(t)})),p.default.announceMicrophoneState(!1,!1)):(l.default.CallingStore.mute(this._callId,e).then((()=>{t&&w.default.markActionDoneAndRemoveTracker(t)})),p.default.announceMicrophoneState(!0,!1))}};t.ToggleScreenShareCommand=class{constructor(e,t){this._callInfo=e,this._screenSharing=t}canExecute(){return l.default.CallingFeaturesHelper.allowScreenSharing(this._callInfo)}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallMonitor,`ToggleScreenShareCommand.execute causeId: ${e}`),this._screenSharing?l.default.CallMonitorService.onStopSharing(e):l.default.CallMonitorService.onSwitchToMainView(e).then((()=>{l.default.CallMonitorService.onStartSharing(e)}),(t=>{m.warn(C.LogTraceArea.CallMonitor,`CallMonitorCallControls.onSwitchToMainView failed ${T.default.errorAsString(t)} causeId: ${e}`)}))}};t.EndCallCommand=class{constructor(e,t=I.default.newCauseId(),i){this._callId=e,this._causeId=t,this._failedHandler=i}execute(){m.log(C.LogTraceArea.CallingUI,`EndCallCommand.execute causeId: ${this._causeId}`),l.default.CallingStore.endCall(this._callId,this._causeId).catch((e=>{m.warn(C.LogTraceArea.CallingUI,`EndCallCommand: endCall failed: ${T.default.errorAsString(e)} causeId: ${this._causeId}`),this._failedHandler&&this._failedHandler(this._causeId)})),u.default.trackHangUpStateChange(this._callId,this._causeId)}};t.EndCallForEveryoneCommand=class{constructor(e,t,i,o){this._callId=e,this._callInfo=t,this._callUIState=i,this._failedHandler=o}canExecute(){const e=l.default.CallingStore.isCallHostlessNoSubscription(this._callId),t=l.default.CallingFeaturesHelper.allowEndCallForEveryone(this._callInfo);let i=!1;return this._callUIState!==h.CallUIState.IncomingRing&&this._callUIState!==h.CallUIState.OutgoingRing&&(i=e&&t),m.log(C.LogTraceArea.CallingUI,`EndCallForEveryoneCommand.canExecute returns "${i}" for call with callId ${this._callId}, isCallHostless: ${e}, callUIState: ${h.CallUIState[this._callUIState]}, allowEndCallForEveryone: ${t}`),i}execute(){const e=I.default.newCauseId();m.log(C.LogTraceArea.CallingUI,`EndCallForEveryoneCommand.execute causeId: ${e}`),l.default.CallingStore.endCallForEveryone(this._callId,e).catch((t=>{m.warn(C.LogTraceArea.CallingUI,`EndCallForEveryoneCommand: endCall failed: ${T.default.errorAsString(t)} causeId: ${e}`),this._failedHandler&&this._failedHandler(e)})),u.default.trackHangUpStateChange(this._callId,e)}};t.MuteEveryoneCommand=class{constructor(e){this._callId=e}canExecute(){const e=l.default.CallingStore.getCallConversationMri(this._callId),t=e&&(0,g.default)().getConversation(e);return(e?c.default.getActiveParticipants(this._callId,e).length:0)>1&&(0,S.isCurrentUserAdminInModeratedGroup)(t)}execute(){this.canExecute()?l.default.CallingStore.muteParticipants(this._callId,n.MuteScope.All,[],I.default.newCauseId()):m.error(C.LogTraceArea.CallingUI,"[MuteEveryoneCommand] tried execute muting everyone but canExecute is false")}};t.ChangeCallLayoutCommand=class{constructor(e,t,i){this._callInfo=e,this._isIncomingOrOutgoingRing=t,this._fromStageMode=i}canExecute(){return!(!this._callInfo.conversationMri||!this._callInfo.callId)&&(!this._isIncomingOrOutgoingRing&&l.default.CallingStore.getRemoteCallMembers(this._callInfo.callId).length>0)}canExecuteForStageMode(e){switch(e){case h.StageMode.TogetherMode:return l.default.CallingFeaturesHelper.allowCallAudienceBot(this._callInfo);case h.StageMode.LargeGrid:return l.default.CallingFeaturesHelper.allowCallGridViewBot(this._callInfo);default:return!0}}execute(e){const t=I.default.newCauseId();if(m.log(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute switching stage mode from'\n            + '${h.StageMode[this._fromStageMode]} to ${h.StageMode[e]} causeId ${t}`),!this._callInfo.callId)return void m.error(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute no callId causeId ${t}`);const i=s.Defer();let o=!0;if(e===h.StageMode.TogetherMode)o=this._handleTogetherModeStage(i,this._callInfo.callId,t);else if(e===h.StageMode.LargeGrid){l.default.CallingStore.isPossiblyNotConnectedGridViewBotInCall(this._callInfo.callId)||(o=!1,l.default.InCallBotService.startGridViewMode(this._callInfo.callId,t).then((()=>{i.resolve()})).catch((e=>{i.reject("failed to start GridViewMode: "+e)})))}o&&i.resolve(),i.promise().then((()=>{this._callInfo.callId?(d.default.setStageMode(this._callInfo.callId,e,t),p.default.announceStageMode(e)):m.error(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute no callId causeId ${t}`)})).catch((e=>{m.warn(C.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute ${e} causeId ${t}`)}))}_handleTogetherModeStage(e,t,i){if(l.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(t))return!0;const o=o=>{l.default.InCallBotService.startAudienceMode(t,i).then((()=>{a.isUndefined(o)||l.default.AudienceBotService.selectAudienceScene(t,i,o.sceneId),e.resolve()})).catch((t=>{e.reject("failed to start AudienceMode:"+t)}))},{enabledBackgroundSelection:n}=r.default.getS4LCMCFeatures().callAudienceBotConfig;if(!n)return o(void 0),!1;const s=v.default.getTogetherModeBackgrounds();if(a.isEmpty(s))return m.warn(C.LogTraceArea.CallingUI,"ChangeCallLayoutCommand.execute no TogetherMode backgrounds to choose from"),o(void 0),!1;const c={conversationMri:this._callInfo.conversationMri,onChangeBackground:o,onStartTogetherMode:o,onClose:()=>{e.reject("Together Mode Panel got closed")},isAudienceBotInCall:!1,selectedBackground:undefined};return f.default.navigateToTogetherModePanel(c,v.default.getPanelId()),!1}};t.ToggleVideoCommand=class{constructor(e,t,i=I.default.newCauseId()){this._callId=e,this._callInfo=t,this._causeId=i}canExecute(){return l.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}execute(){m.log(C.LogTraceArea.CallMonitor,`ToggleVideoCommand.execute causeId: ${this._causeId}`),l.default.CallControlsStore.toggleVideo(this._callId,this._causeId),u.default.trackVideoStateChange(this._callId,this._causeId)}};t.RequestScreenShareCommand=class{constructor(e){this._screenShareControl=e}canExecute(){return void 0!==this._screenShareControl&&this._screenShareControl.canRequestControl()}execute(){return this._screenShareControl?this._screenShareControl.requestControl().then((()=>{m.log(C.LogTraceArea.ScreenSharing,"request control succeeded")})).catch((e=>{m.log(C.LogTraceArea.ScreenSharing,`request control failed with ${T.default.errorAsString(e)}`)})):s.Resolved()}};t.StopScreenShareCommand=class{constructor(e){this._screenShareControl=e,this.viewerInControl=this._screenShareControl?this._screenShareControl.viewerInControl():void 0}canExecute(){return void 0!==this.viewerInControl&&_.default.isMyMri(this.viewerInControl.mri)}execute(){return this._screenShareControl&&this.viewerInControl?this._screenShareControl.terminateControl(this.viewerInControl.mri).then((()=>{m.log(C.LogTraceArea.ScreenSharing,"terminate control succeeded")})).catch((e=>{m.log(C.LogTraceArea.ScreenSharing,`terminate control failed with ${T.default.errorAsString(e)}`)})):s.Resolved()}};t.EndAllCallsInConversationCommand=class{constructor(e,t){this._conversationMri=e,this._failedHandler=t}execute(){const{enableEndCallsWhenLeavingGroup:e}=r.default.getS4LCMCFeaturesNoSubscription();if(!e)return;const t=I.default.newCauseId();m.log(C.LogTraceArea.CallingUI,`EndCallInConversationCommand.execute conversationMri: ${this._conversationMri} causeId: ${t}`),l.default.CallingStore.getCallIdsForConversationMri(this._conversationMri).forEach((e=>{l.default.CallingStore.endCall(e,t).catch((i=>{m.warn(C.LogTraceArea.CallingUI,`EndCallInConversationCommand: endCall failed: ${T.default.errorAsString(i)} causeId: ${t}`),this._failedHandler&&this._failedHandler(e,t)})),u.default.trackHangUpStateChange(e,t)}))}}},74081:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(290598)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(638260)),d=i(460515),u=o.__importDefault(i(132680)),h=o.__importDefault(i(473304)),p=i(154235),g=o.__importDefault(i(958868)),C=o.__importDefault(i(397232)),m=o.__importDefault(i(531829)),S=o.__importStar(i(225511)),_=o.__importDefault(i(288547)),f=i(815146),y=o.__importStar(i(85385)),T=o.__importDefault(i(201721)),b=o.__importDefault(i(960282)),v=(o.__importDefault(i(791384)),o.__importDefault(i(702141))),I=o.__importStar(i(888500)),w=i(16549),P=i(972830),M=o.__importDefault(i(760989)),D=o.__importDefault(i(337249)),A=i(26703),k=54,R=(0,A.lazyProperties)({toggleRowContainer:()=>s.Styles.createViewStyle({paddingVertical:0})}),x=b.default.isSmallDeviceNoSubscription(p.MainRootViewId)?3:4;class L extends g.default{constructor(){super(...arguments),this._recentActions=[]}static menuHeight(e){const t=this._stateForProps(e);let i=0;if(t.toggleItems&&(i+=k*t.toggleItems.length),t.listItems&&(i+=k*t.listItems.length),t.rowButtonsItems&&(i+=k*t.rowButtonsItems.length),i>0){const e={marginTop:8,marginBottom:8};i+=C.default.rowHeight(e)}const o=t.buttonItems;return o&&(o.length>2?i+=m.default.rowHeight(o.length,x):i+=o.length*k),i}static _stateForProps(e){const t=h.default.getCelebrationData(e.conversationMri,e.callId),i=l.default.DeviceStore.isBackgroundBlurEnabled(),o=l.default.DeviceStore.getNoiseSuppressionMode(),{primaryIconColor:a}=(0,P.themeColors)(e.callerContext(),e.colorThemeOverride),n={celebrationData:t,isIncomingVideoDisabled:u.default.isIncomingVideoDisabled(e.callId),isAudioOnlyEnabled:l.default.CallingStore.isAudioOnly(e.callId),noiseSuppressionMode:o,isTranslating:l.default.InCallBotService.isTranslating(e.callId),isSkypeTranslating:l.default.InCallBotService.isSkypeTranslationEnabled(e.callId),isRecording:l.default.CallingStore.isRecording(e.callId),isAudienceMode:l.default.CallingStore.isFullScreenBotInCall(e.callId),isScreenShareActive:l.default.CallingStore.isScreenSharing(e.callId),isVideoActive:l.default.CallingStore.isProvidingVideo(e.callId),isBackroundBlurEnabled:i,isBackgroundBlurSelected:l.default.DeviceStore.isBackgroundBlurred(),isBackgroundBlurNewItem:!1},s=Object.assign(Object.assign(Object.assign({},e),n),{iconColor:a});return n.toggleItems=u.default.overflowMenuToggleDescriptors(s),n.listItems=u.default.overflowMenuListDescriptors(s),n.rowButtonsItems=u.default.overflowMenuRowButtonsDescriptors(s),n.buttonItems=u.default.overflowMenuButtonDescriptors(s,e.callerContext()),n}_buildState(e,t){return L._stateForProps(e)}componentDidMount(){super.componentDidMount();const e=M.default.newCauseId();y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.componentDidMount Menu open causeId: ${e}`),r.default.setOverflowMenuVisiblity(!0,e)}componentWillUnmount(){super.componentWillUnmount();const e=M.default.newCauseId();y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.componentWillUnMount Menu close causeId: ${e}`),r.default.setOverflowMenuVisiblity(!1,e),c.default.trackOverflowMenuActions(this._recentActions),this.state.isBackroundBlurEnabled&&this.state.isBackgroundBlurNewItem&&T.default.setUserPreferencesLocal(Object.assign({},{}))}_executeDescriptorAndClose(e,t){this._executeDescriptor(e,t),y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.ClosingMenu causeId: ${t}`),_.default.close(this._getRootViewId(),t)}_expandList(e,t){const i=d.CallControlsOverflowItem[e.key];y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`);const o={anchor:()=>{},useTheme:!0,positionPriorities:["bottom","top"]};return I.default.showWithOptions({id:"listContextMenuItem",config:o,getMenuItems:()=>e.menuItems.map((e=>({text:e.label,command:e.value,isCheckbox:!0}))),handleMenuCommand:t=>{t!==I.SXActionMenuCancel&&(this._recentActions.push(i),e.onItemSelected(t))},rootViewId:this._getRootViewId(),invokingEvent:void 0})}_executeDescriptor(e,t){if(e.onPress){const i=d.CallControlsOverflowItem[e.key];y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`),this._recentActions.push(i),e.onPress()}}_createOnRowButtonPress(e){return()=>{const t=M.default.newCauseId();y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onRowPress causeId: ${t}`),_.default.close(this._getRootViewId(),t),this._executeDescriptor(e,t)}}render(){const e=[];if(n.each(this.state.toggleItems,(t=>{const i={key:t.key,disabled:!!t.disabled,rowType:S.CustomActionMenuRowType.Toggle,isSelected:t.selected,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=M.default.newCauseId();y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Toggle.onRowPress causeId: ${e}`),this._executeDescriptor(t,e)},rowHeight:k,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:w.Color.black,isNew:!!t.isNew,containerStyleOverride:R.toggleRowContainer};e.push({props:i,builder:S.default.buildRow})})),n.each(this.state.listItems,(t=>{const i={key:t.key,disabled:!!t.disabled,rowType:S.CustomActionMenuRowType.List,listLabel:t.listLabel,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=M.default.newCauseId();this._expandList(t,e)},rowHeight:k,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:w.Color.black,isNew:!!t.isNew};e.push({props:i,builder:S.default.buildRow})})),n.each(this.state.rowButtonsItems,(t=>{const i={key:t.key,rowType:S.CustomActionMenuRowType.Default,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:this._createOnRowButtonPress(t),rowHeight:k,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:S.default.buildRow})})),e.length){const t={marginTop:8,marginBottom:8},i=(0,P.themeColors)(this.props.callerContext(),this.props.colorThemeOverride).secondaryTextColor,o=Object.assign(Object.assign({},t),{key:"divider",rowHeight:C.default.rowHeight(t),color:i});e.push({props:o,builder:C.default.buildRow})}const t=this.state.buttonItems;if(t.length-n.filter(t,(e=>!!e.doesNotInfluenceMenuLayout)).length>2){const i={key:"grid",buttonDescriptors:n.map(t,(e=>Object.assign(Object.assign({},e),{onPress:()=>{const t=M.default.newCauseId();y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onPress causeId: ${t}`),this._executeDescriptorAndClose(e,t)}}))),rowHeight:m.default.rowHeight(t.length),columnCount:x,estimatedWidth:D.default.measureWindow(this._getRootViewId()).width};e.push({props:i,builder:m.default.buildRow})}else n.each(t,(t=>{const i={key:t.key,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=M.default.newCauseId();y.log(f.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onRowPress causeId: ${e}`),this._executeDescriptorAndClose(t,e)},rowHeight:k,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:S.default.buildRow})}));return(0,a.jsx)(v.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride})}}t.default=L},518083:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioOutputButton=t.AudioOutputButtonInternal=void 0;const o=i(197582),a=(i(785893),o.__importStar(i(667294))),n=(o.__importDefault(i(740275)),i(794444)),s=(o.__importStar(i(187140)),i(512992)),r=(i(995042),o.__importDefault(i(760989)),i(82485),i(815146),o.__importDefault(i(369347))),l=i(736267),c=i(526849);t.AudioOutputButtonInternal=({callId:e,useiOSRoutePicker:t,moreOutputRoutesAvailable:i,outputRoute:o})=>{(0,s.useActionButtonColorConfig)(!1);const{rootViewId:n}=(0,l.useCommonContext)();a.useRef(null);return null},t.AudioOutputButton=(0,c.WithResub)(a.memo(t.AudioOutputButtonInternal),(e=>{r.default.CallControlsStore.getAvailableAudioRoutes();return Object.assign(Object.assign({},e),{useiOSRoutePicker:n.AudioOutputRouteHelper.useiOSRoutePicker(),moreOutputRoutesAvailable:!1,outputRoute:r.default.CallControlsStore.getAudioOutput()})}))},859337:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=o.__importStar(i(704704)),r=o.__importStar(i(187140)),l=i(641400),c=o.__importDefault(i(369347)),d=i(512992),u=i(526849),h=i(737298),p=o.__importDefault(i(92179)),g=i(96575),C=o.__importDefault(i(760989)),m=o.__importDefault(i(638260));t.default=(0,u.WithResub)(n.memo((e=>{const t=(0,d.useActionButtonColorConfig)(e.isVideoActive),i=(e=>n.useCallback((t=>{const i=C.default.newCauseId();m.default.trackVideoButtonClick(e.callId,i),p.default.createTrackerAndMarkPressTime(i,g.ScenarioName.ResponsivenessToggleVideoCall,t),new h.ToggleVideoCommand(e.callId,e).execute(),p.default.markActionDoneAndRemoveTracker(i)}),[e]))(e),o=s.getString(e.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel");return(0,a.jsx)(r.default,{icon:e.isVideoActive?l.SkypeIcon.Video:l.SkypeIcon.VideoOff,accessibilityLabel:o,title:o,size:r.ActionButtonSize.Medium,backgroundColor:null==t?void 0:t.backgroundColor,iconColor:null==t?void 0:t.iconColor,onPress:i,disabled:!e.isVideoButtonEnabled,reverseGradientColor:!0})})),(e=>{const t=new h.ToggleVideoCommand(e.callId,e).canExecute(),i=c.default.CallingStore.isProvidingVideo(e.callId);return Object.assign(Object.assign({},e),{isVideoButtonEnabled:t,isVideoActive:i})}))},27460:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importDefault(i(119557)),r=i(224807),l=o.__importDefault(i(331654)),c=o.__importStar(i(516778)),d=i(148540),u=o.__importDefault(i(150343)),h=o.__importDefault(i(438752)),p=i(22478),g=i(26178),C=i(737298),m=o.__importDefault(i(369347)),S=o.__importDefault(i(566700)),_=o.__importDefault(i(306794)),f=o.__importStar(i(873324)),y=o.__importDefault(i(638260)),T=i(460515),b=o.__importDefault(i(132680)),v=i(843890),I=o.__importDefault(i(473304)),w=o.__importStar(i(44717)),P=i(315742),M=o.__importDefault(i(266311)),D=i(154235),A=o.__importDefault(i(10966)),k=i(729827),R=i(741020),x=o.__importStar(i(170881)),L=i(815146),B=o.__importDefault(i(524526)),V=o.__importStar(i(85385)),O=o.__importDefault(i(612285)),E=o.__importDefault(i(97595)),N=i(26703),F=o.__importStar(i(704704)),U=o.__importDefault(i(740794)),H=o.__importDefault(i(469469)),j=i(812822),z=i(276602),G=o.__importDefault(i(246230)),W=i(231817),K=o.__importStar(i(634859)),$=i(602370),q=o.__importDefault(i(791384)),Q=o.__importDefault(i(655192)),X=o.__importStar(i(888500)),Z=o.__importDefault(i(799585)),J=i(16549),Y=o.__importDefault(i(20758)),ee=i(641400),te=i(331079),ie=o.__importDefault(i(827361)),oe=o.__importDefault(i(497910)),ae=o.__importDefault(i(989819)),ne=o.__importDefault(i(760989)),se=o.__importDefault(i(599757)),re=o.__importDefault(i(144708)),le=i(97570),ce="_screenSharingModalId",de=g.CallButtonSize.Small,ue=(0,N.lazyProperties)({spinner:()=>c.Styles.createViewStyle({minWidth:80,alignItems:"center",flex:1,justifyContent:"center",overflow:"visible"}),spinnerMargin:()=>c.Styles.createViewStyle({margin:6,overflow:"visible"}),container:()=>c.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-between",flexDirection:"row",overflow:"visible"}),chatPanelButton:()=>c.Styles.createViewStyle({alignItems:"center",overflow:"visible"}),reactionsPickerButton:()=>c.Styles.createViewStyle({overflow:"visible",alignItems:"center",justifyContent:"center",width:70}),secondaryControlsContainer:()=>c.Styles.createViewStyle({flexDirection:"row",alignItems:"center",width:"50%",flexGrow:1,flexShrink:1,overflow:"visible"}),secondaryControlsContainerRight:()=>c.Styles.createViewStyle({justifyContent:"flex-end"}),caption:()=>c.Styles.createTextStyle({textAlign:"center",fontSize:Y.default.controlFontSize.caption,paddingHorizontal:10,color:J.Color.white}),raiseHandImageWrapper:()=>c.Styles.createViewStyle({position:"absolute",top:-7,left:3,overflow:"visible"}),customCallReactionsButton:()=>c.Styles.createViewStyle({position:"absolute",bottom:8,right:0,overflow:"visible"}),hoverStyleLight:()=>[c.Styles.createButtonStyle({backgroundColor:J.Color.gray100})],hoverStyleDark:()=>[c.Styles.createButtonStyle({backgroundColor:J.Color.black})],tooltipStyleDark:()=>c.Styles.createViewStyle({backgroundColor:J.Color.gray400,paddingHorizontal:14,paddingVertical:7})}),he={style:ue.tooltipStyleDark,showArrow:!0,arrowColor:J.Color.gray400,containerOffsetY:8};class pe extends oe.default{constructor(){super(...arguments),this._overflowMenuId=X.default.menuId(),this._screenshareOverflowMenuId=X.default.menuId(),this._secondaryCallControlsManager=new R.DesktopSecondaryCallControlsManager,this._onReactionsPickerHovered=e=>{n.delay((()=>{!this.state.isReactionsPickerSelected&&e&&this.props.onReactionPickerButtonHover()}),50)},this._setMainCallControlsRef=e=>{this._mainCallControls=e},this._getShareCallLinkButton=()=>(0,a.jsx)(se.default,{colorConfig:this._colorConfig(),isShowingAloneInCall:this.props.isShowingAloneInCall,conversationMri:this.props.conversationMri,callId:this.props.callId,isShowingRecents:this.props.isShowingRecents,useLightTheme:this.props.useLightTheme,callButtonSize:de},T.CallControlsKeys.ShareLink),this._getShareQRButton=e=>{const t=F.getString("MeetNowCallControls.Twincam"),i=this._hideCaption()?void 0:t,o=this._colorConfig();return o.hoverIcon=ee.SkypeIcon.TwincamMidGradient,(0,a.jsx)(re.default,{colorConfig:o,conversationMri:this.props.conversationMri,callId:this.props.callId,isDisabled:!this.state.allowTwincam,isShowingRecents:this.props.isShowingRecents,callButtonSize:de,caption:i,title:t,showToolTip:!i,toolTipConfig:he,onStopTwincamPressed:()=>this._twincamCommand.execute(!0),isTwincamConnected:e},T.CallControlsKeys.Twincam)},this._getRequestScreenShareControlButton=()=>{const e=F.getString("CallControls.CallButtonRequestScreenShareControl"),t=this._hideCaption()?void 0:e,i=this._colorConfig();return(0,a.jsx)(g.CallButton,{icon:ee.SkypeIcon.ScreenSharingRequestControl,accessibilityLabel:e,caption:t,title:e,size:de,anchorAccessibilityLabel:e,colorConfig:i,onPress:()=>this._requestScreenShareCommand.execute(),showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.ScreenShareControl)},this._getStopScreenShareControlButton=()=>{const e=F.getString("CallControls.CallButtonStopScreenShareControlFromViewer"),t=this._hideCaption()?void 0:e;return(0,a.jsx)(g.CallButton,{icon:ee.SkypeIcon.ScreenSharingStopControl,accessibilityLabel:e,caption:t,title:e,size:de,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),onPress:()=>this._stopScreenShareCommand.execute(),showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.ScreenShareControl)},this._getScreenShareControlRequestInProgressIndicator=()=>{let e=(0,a.jsx)(Z.default,{style:ie.default.overflowVisible,size:D.SXActivityIndicatorSize.Small,useRXIndicator:!0});return e=(0,a.jsx)(c.View,{style:ue.spinnerMargin,children:e}),(0,a.jsxs)(c.View,{style:ue.spinner,children:[e,(0,a.jsx)(c.Text,{style:ue.caption,children:F.getString("CallControls.ScreenShareControlRequesting")})]})},this._onChatPanelButtonPress=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"_onChatPanelButtonPress causeId: "+e),this.props.onChatPanelButtonPress(e)},this._onRaiseHandPressed=()=>{this.setState({isRaisedHandDisabled:!0}),this._raiseHandCommand.execute().finally((()=>{this.setState({isRaisedHandDisabled:!1})}))},this._onLowerHandPressed=()=>{this.setState({isRaisedHandDisabled:!0}),this._lowerHandCommand.execute().finally((()=>{this.setState({isRaisedHandDisabled:!1})}))},this._onOverflowMenuButtonRef=e=>{this._overflowButton=e||void 0},this._onScreenShareOverflowMenuButtonRef=e=>{this._screenShareOverflowMenuButton=e||void 0},this._onCallReactionsDrawerItemRef=e=>{this._reactionsEntryPoint=e||void 0,this._setEngagementTooltipAnchor(e)},this._setEngagementTooltipAnchor=e=>{h.default.setAnchor(p.EngagementTooltipType.CallReactionsBar,e)},this._onReactionsPickerPressed=()=>{this.props.onReactionsPickerButtonPress(),this.props.onInteracting(this.state.isReactionsPickerSelected)},this._onParticipantsButtonPress=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._onParticipantsButtonPress "+e),this.props.onShowParticipants(e,T.CallRosterOrigin.CallControls,this.state.isHandRaised)},this._onAddParticipantsButtonPress=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._onAddParticipantsButtonPress "+e),this.props.onAddToCall(e,L.NavigationAddToCallOrigin.CallControls)},this._onLiveCaptionsButtonPress=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._onLiveCaptionsButtonPress "+e),this.state.isCaptioning?this._stopTranslator():this._startTranslator()},this._onSkypeTranslateButtonPress=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._onSkypeTranslateButtonPress "+e),this.state.isSkypeTranslating?m.default.InCallBotService.stopSkypeTranslationConsent(this.props.callId,e):m.default.InCallBotService.startSkypeTranslationConsent(this.props.callId,e)},this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()},this._getOverflowMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}),this._showOverflowMenuPopup=e=>{const t=this._getOverflowMenuConfig(this._getAnchorForOverflowMenu);X.default.showWithOptions({id:this._overflowMenuId,config:t,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})},this._overflowMenuDismissed=()=>{y.default.trackOverflowMenuActions([])},this._getOverflowMenuItems=()=>this._getOverflowMenuItemsForCommands(this._secondaryCallControlsManager.getOverflowControls()),this._getActiveScreenShareOverflowItems=()=>{const e=[R.OverflowMenuCommands.ConfirmStopSharing];return m.default.CallingFeaturesHelper.allowSwitchingScreenSharing()&&e.push(R.OverflowMenuCommands.SwitchScreen),this._getOverflowMenuItemsForCommands(e)},this._getReactionPickerText=()=>this.state.isReactionsPickerSelected?F.getString("ReactionsStream.ReactionBarCloseDrawerTitle"):F.getString("ReactionsStream.ReactionBarOpenDrawerTitle"),this._getScreenshareButtonTooltip=()=>this.state.isScreenShareActive?F.getString("CallControlsOverFlowMenu.StopShareScreen"):F.getString("CallControlsOverFlowMenu.ShareScreen"),this._getSnapshotText=()=>F.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),this._selectOverflowMenuItem=e=>{const t=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._selectOverflowMenuItem "+t);const i=this._getRootViewId();switch(X.default.dismiss(this._overflowMenuId,i),X.default.dismiss(this._screenshareOverflowMenuId,i),y.default.trackOverflowMenuActions([e]),e){case R.OverflowMenuCommands.Blur:m.default.DeviceStore.setBackgroundEffectType(L.BackgroundEffect.Blur),V.track(new f.LocalVideoActionsEvent(f.LocalVideoActions.BackgroundBlur,this.props.callId));break;case R.OverflowMenuCommands.Unblur:m.default.DeviceStore.setBackgroundEffectType(L.BackgroundEffect.Off),V.track(new f.LocalVideoActionsEvent(f.LocalVideoActions.BackgroundUnBlur,this.props.callId));break;case R.OverflowMenuCommands.OnAddToCall:this.props.onAddToCall(t,L.NavigationAddToCallOrigin.OverflowMenu);break;case R.OverflowMenuCommands.OnShowParticipants:this.props.onShowParticipants(t,T.CallRosterOrigin.OverflowMenu,!1);break;case R.OverflowMenuCommands.BackgroundEffectsSettings:case R.OverflowMenuCommands.OnShowAVSettings:this._showAVSettings();break;case R.OverflowMenuCommands.OnShowAudioSettings:this._showAudioSettings();break;case R.OverflowMenuCommands.ShareScreen:this._onNewScreenShareButtonPress(void 0,t);break;case R.OverflowMenuCommands.ShareScreenAndSounds:this.state.isScreenShareActive?this._startSoundSharing():this._openScreenSharingModal(!0,t);break;case R.OverflowMenuCommands.ConfirmStopSharing:case R.OverflowMenuCommands.StopSharing:this._stopScreenSharing();break;case R.OverflowMenuCommands.SwitchScreen:this._onSwitchScreen(t);break;case R.OverflowMenuCommands.ScreenShareControl:this._requestScreenShareCommand.execute();break;case R.OverflowMenuCommands.StopScreenShareControl:this._stopScreenShareCommand.execute();break;case R.OverflowMenuCommands.HoldCall:case R.OverflowMenuCommands.ResumeCall:this._toggleHoldState();break;case R.OverflowMenuCommands.StartRecording:this._startRecording();break;case R.OverflowMenuCommands.StopRecording:this._stopRecording();break;case R.OverflowMenuCommands.StartCaptions:this._startTranslator();break;case R.OverflowMenuCommands.StopCaptions:this._stopTranslator();break;case R.OverflowMenuCommands.LiveCaptions:this._onLiveCaptionsButtonPress();break;case R.OverflowMenuCommands.SkypeTranslate:case R.OverflowMenuCommands.StopSkypeTranslate:this._onSkypeTranslateButtonPress();break;case R.OverflowMenuCommands.EnableIncomingVideo:this._enableIncomingVideo();break;case R.OverflowMenuCommands.DisableIncomingVideo:this._disableIncomingVideo();break;case X.SXActionMenuCancel:break;case R.OverflowMenuCommands.Snap:this.props.onMomentsPress();break;case R.OverflowMenuCommands.React:this._onReactionsPickerPressed();break;case R.OverflowMenuCommands.CustomReact:break;case R.OverflowMenuCommands.CallStats:this._onCallStatsPressed();break;case R.OverflowMenuCommands.Invite:this._invitePeopleCommand.execute();break;case R.OverflowMenuCommands.MuteEveryone:this._muteEveryoneCommand.execute(),V.track(new f.CallMuteEveryoneEvent(f.MuteEveryoneOrigin.OverflowMenu));break;case R.OverflowMenuCommands.RaiseHand:this._onRaiseHandPressed();break;case R.OverflowMenuCommands.LowerHand:this._onLowerHandPressed();break;case R.OverflowMenuCommands.ChangeTogetherModeBackground:this._onTogetherModeBackgroundChangeButtonPress();break;case R.OverflowMenuCommands.Twincam:this._onTwincamPressed();break;case R.OverflowMenuCommands.StopTwincam:this._onStopTwincamPressed()}},this._getAnchorForOverflowMenu=()=>this._overflowButton,this._getAnchorForActiveScreenShareOverflowMenu=()=>this._screenShareOverflowMenuButton,this._toggleHoldState=()=>{const e=ne.default.newCauseId(),t=new z.ToggleHoldCallCommand(this.props,e);t.canExecute()?(V.log(L.LogTraceArea.CallingUI,`DesktopCallControls._toggleHoldState executing ToggleHoldCommand, causeId: ${e}`),t.execute()):V.warn(L.LogTraceArea.CallingUI,"DesktopCallControls._toggleHoldState ToggleHoldCallCommand.canExecute returned false")},this._onCallStatsPressed=()=>{this._callStatsCommand.execute()},this._onTwincamPressed=()=>{(0,le.trackTwincamShareIntent)(this.props.callId,"overflow_menu"),this._maybeExecuteTwincamCommand(!1)},this._onStopTwincamPressed=()=>{this._maybeExecuteTwincamCommand(!0)},this._onNewScreenShareButtonPress=(e,t)=>{const i=t||ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"_onNewScreenShareButtonPress causeId: "+i),m.default.CallingFeaturesHelper.isScreenSharingPermissionEnabled(i).then((t=>{if(t)if(this.state.isScreenShareActive)if(this.state.numberAvailableScreens>1||this.state.windowSharingEnabled){const t=this._getOverflowMenuConfig(this._getAnchorForActiveScreenShareOverflowMenu);X.default.showWithOptions({id:this._screenshareOverflowMenuId,config:t,getMenuItems:this._getActiveScreenShareOverflowItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})}else this._stopScreenSharing();else this._onShareScreen(i);else G.default.showDeniedPromptWithSettingsOption(te.PermissionType.ScreenRecording,this._getRootViewId(),l.default.openScreenRecordingPrivacyPane)}))},this._openScreenSharingModal=(e,t)=>{V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._openScreenSharingModal causeId: "+t),y.default.updateCallTelemetry(this.props.callId,t,(e=>e.displayScreenSharingDialogCount())),x.dismissAll(),V.log(L.LogTraceArea.CallingUI,"got windows count 0 will navigate to screen share panel"),U.default.navigateToScreenSharePanel({conversationMri:this.props.conversationMri,currentScreenSharingSource:this._currentScreenSharingSource,currentScreenSharingSourceType:this._currentScreenSharingSourceType,isScreenSharingActive:this.state.isScreenShareActive,onSelectSource:this._selectScreenShareSource,onClose:this._closeScreenSharingModal,shareSounds:e},ce)},this._showAVSettings=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._showAVSettings causeId: "+e),U.default.navigateToDesktopSettingsGroup(j.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._showAudioSettings=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._showAudioSettings causeId: "+e),U.default.navigateToDesktopSettingsGroup(j.SettingsGroup.AudioSettings,this._getRootViewId(),e)},this._closeScreenSharingModal=()=>{M.default.dismissModal(ce,this._getRootViewId())},this._selectScreenShareSource=(e,t,i)=>{const o=ne.default.newCauseId();if(V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._selectScreenShareSource causeId: "+o),y.default.updateCallTelemetry(this.props.callId,o,(e=>e.didUserDisplayScreenSharingDialog())),this.state.isScreenShareActive){if(this._currentScreenSharingSource&&e.getId()===this._currentScreenSharingSource.getId())return void this._closeScreenSharingModal();m.default.CallingStore.setSwitchingScreen(!0),m.default.CallingStore.stopScreenSharing(this.props.callId,o).then((()=>{m.default.CallingStore.startScreenSharing(this.props.callId,o,e,t).then((()=>m.default.CallingStore.setSwitchingScreen(!1))),this._currentScreenSharingSource=e,this._currentScreenSharingSourceType=i})),this._incrementSourceTypeTelemetryCounts(i,o),y.default.updateCallTelemetry(this.props.callId,o,(e=>e.switchScreenWhileSharing()))}else this._startScreenSharing(o,t,e,i);q.default.maybeAnnounceForAccessibility(F.getString("AccessibilityLabel.ScreenShareStarted")),this._closeScreenSharingModal()},this._stopScreenSharing=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._stopScreenSharing causeId: "+e);const t=m.default.CallingStore.stopScreenSharing(this.props.callId,e,r.StopSharingOrigin.CallView);return q.default.maybeAnnounceForAccessibility(F.getString("AccessibilityLabel.ScreenShareStopped")),this._currentScreenSharingSource=void 0,this._currentScreenSharingSourceType=void 0,y.default.updateCallTelemetry(this.props.callId,e,(e=>e.stopScreenSharing())),this._shouldDisableVideoDuringScreenSharing()&&this.props.showHideOutgoingVideoDisabledToast(!1,e),t},this._startSoundSharing=()=>{const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._startSoundSharing causeId: "+e),m.default.CallingStore.startSoundSharing(this.props.callId,e).then((()=>{y.default.updateCallTelemetry(this.props.callId,e,(e=>e.startSoundSharing()))}))},this._togglePstnDialpadShortcut=(e,t)=>!(t!==this._getRootViewId()||!this.props.isPSTNCall)&&(this.props.onOpenDialpad(),!0),this._toggleCallStatsShortcut=(e,t)=>t===this._getRootViewId()&&(this._onCallStatsPressed(),!0),this._onScreenShareEvent=(e,t)=>{this._openScreenSharingModal(e,t)},this._mediaActionEvent=e=>{m.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(V.track(new f.MediaActionEvent(f.CallControlContext.DesktopCallControls,f.MediaActionEventResult.EndCall)),V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent ending call (causeId: "+e+")"),m.default.CallingStore.endCall(this.props.callId,e)):(V.track(new f.MediaActionEvent(f.CallControlContext.DesktopCallControls,f.MediaActionEventResult.Ignore)),V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent no action (causeId: "+e+")"))}}_buildState(e,t){var i,o;this._callStatsCommand=new z.ToggleCallStatsCommand(e.callId,this._getContext()),this._twincamCommand=new z.TwincamCommand(e.callId,{conversationMri:e.conversationMri,callId:e.callId,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall}),this._muteEveryoneCommand=new C.MuteEveryoneCommand(e.callId),this._changeTogetherModeBackgroundCommand=new z.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri),this._invitePeopleCommand=new z.InvitePeopleCommand(e.conversationMri,this._getRootViewId());const a=m.default.CallingStore.isRecording(e.callId),n=m.default.InCallBotService.isTranslating(e.callId),s=m.default.InCallBotService.isCaptioningEnabled(e.callId),r=m.default.InCallBotService.isSkypeTranslationEnabled(e.callId),l=B.default.isConversationTranslated(e.conversationMri),c=m.default.InCallBotService.isPstnTranslationEnabled(e.callId),h=b.default.isIncomingVideoDisabled(e.callId),p=m.default.CallingStore.isAudioOnly(e.callId),g=u.default.getS4LCMCFeatures(),S=g.customCallReactions,_=g.enableNewCustomCallReactions,f=m.default.CallingStore.getCallRecordingInitiator(e.callId),y=I.default.getCelebrationData(e.conversationMri,e.callId),P=e.callUIState===T.CallUIState.Default,M=m.default.CallingStore.getCallState(e.callId),D=M===d.CallState.Connected?m.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(e.callId):void 0;this._requestScreenShareCommand=new C.RequestScreenShareCommand(D),this._stopScreenShareCommand=new C.StopScreenShareCommand(D);const A=g.enableAllCallButtonsVisible,k=e.callUIState===T.CallUIState.Default||e.callUIState===T.CallUIState.OutgoingRing||e.callUIState===T.CallUIState.GoLiveSinglePlayer,R=A&&!w.isGroupConversation(e.conversationMri)&&!m.default.CallingFeaturesHelper.hasConnectedParticipants(e),x=m.default.CallingFeaturesHelper.allowRecording(e),L=x&&P,V=m.default.CallingFeaturesHelper.allowScreenSharing(e),E=V&&!R,N=V&&P;this._lowerHandCommand=new W.LowerHandCommand(e.callId,$.LowerHandOrigin.CallControls),this._raiseHandCommand=new W.RaiseHandCommand(e.callId,e);const F=this._requestScreenShareCommand.canExecute(),U=this._stopScreenShareCommand.canExecute(),H=A?x&&k:L,j=A?V&&k:N,G=this._lowerHandCommand.canExecute(),K=P&&m.default.CallingFeaturesHelper.allowCaptioning(e)&&!l&&!c&&!r,q=m.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId(),Q=m.default.DeviceStore.isBackgroundBlurCapable(),X=m.default.CallingStore.isProvidingVideo(e.callId),Z=m.default.DeviceStore.isBackgroundReplacementEnabled(),J=P&&m.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(e),Y=this._muteEveryoneCommand.canExecute(),ee=P&&m.default.CallingFeaturesHelper.allowHoldCall(e),te=m.default.CallingStore.isCallOnHoldResumeable(e.callId),ie=this._callStatsCommand.canExecute(),oe=m.default.CallingStore.isOneOnOneCall(e.callId),ae=m.default.CallingStore.isScreenSharing(e.callId),ne=m.default.DeviceStore.getAvailableScreens().length,se=v.CallingCapabilities.applicationSharingSupported(),re=m.default.InCallBotUtils.isCallRecordingInitiator(f),le=m.default.CallingFeaturesHelper.allowTwincam(e),ce=le&&(P||g.twinCamEnabledForSingleParticipant&&k),de=A?le&&k:ce,ue=m.default.CallingStore.hasConnectedTwincam(e.callId),he=K,pe=null!==(o=null===(i=this.state)||void 0===i?void 0:i.isRaisedHandDisabled)&&void 0!==o&&o,ge={isVideoActive:X,isScreenShareActive:ae,isReactionsPickerSelected:!t&&!!this.state&&this.state.isReactionsPickerSelected,connectedAndNotOnHoldCallId:q,isRecording:a,isIncomingVideoDisabled:h,audioOnlyEnabled:p,numberAvailableScreens:ne,emoticonReactionKey:b.default.getEmoticonReactionKey(y),callState:M,isChatBadgeOn:this._isUnreadInCallIncomingMessageAndPhoto(),allowScreenSharing:A?E:N,allowRecording:L,isNavigatingWithKeyboard:O.default.isNavigatingWithKeyboard(),windowSharingEnabled:se,isMinDesktop:b.default.isMinDesktop(e.controlsType),canRequestScreenShareControl:F,canStopScreenShareControl:U,screenShareRequestControlInProgress:D&&D.requestControlInProgress(),isConnecting1on1:R,isHandRaisedForCurrentUser:G,isHandRaised:m.default.CallingStore.isAnyHandRaised(e.callId),isOneOnOneCall:oe,enableNewCustomCallReactions:_,showCustomizeReactionsPencilButton:S&&S.enabled&&!S.useNewAddEmojiIcon,allowTwincam:ce,isTwincamConnected:ue,isCaptioning:s,isPstnTranslationEnabled:c,isSkypeTranslating:r,isRaisedHandDisabled:pe},Ce=m.default.CallingFeaturesHelper.allowSkypeTranslation(e),me=!oe||oe&&m.default.CallingFeaturesHelper.allowAddToCall(e),Se={idealLeftControls:this._getIdealLeftControls(H,F,U,!1,oe,de,ue,me,he,Ce),idealRightControls:this._getIdealRightControls(j,this._raiseHandCommand.isFeatureEnabled(),G,_),idealOverflowControls:this._getIdealOverflowControls(!1,K,n,q,Q,X,Z,J,h,p,Y,ee,te,ie),leftControlForDesktopMinSmallest:this._getLeftControlForDesktopMinSmallest(),controlsType:e.controlsType,isOneOnOneCall:oe,isScreenShareActive:ae,numberAvailableScreens:ne,windowSharingEnabled:se,canRequestScreenShareControl:F,allowRecording:L,isRecording:a,connectedAndNotOnHoldCallId:q,callId:e.callId,isCallRecordingInitiator:re,allowLiveCaptions:he,isCaptioning:s,allowSkypeTranslate:Ce,isSkypeTranslating:r};return this._secondaryCallControlsManager.configure(Se),ge}componentDidMount(){super.componentDidMount(),this._screenSharingEventSub=m.default.dangerouslyGetCallNavigationUtils().screenSharePopupEvent.subscribe(this._onScreenShareEvent),this._mediaActionEventSub=s.default.mediaActionEvent.subscribe(this._mediaActionEvent),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.isChatBadgeOn!==t.isChatBadgeOn&&V.log(L.LogTraceArea.CallingUI,"DesktopCallControls.UNSAFE_componentWillUpdate isChatBadgeOn changed from "+this.state.isChatBadgeOn+" to "+t.isChatBadgeOn),e.isShowingChat!==this.props.isShowingChat&&e.isShowingChat&&(_.default.resetUnSeenIncomingPhotoCount(this.props.callId),_.default.resetUnSeenIncomingTextCount(this.props.callId))}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._shouldDisableVideoDuringScreenSharing()&&t.isScreenShareActive&&!this.state.isScreenShareActive){const e=ne.default.newCauseId();this.props.showHideOutgoingVideoDisabledToast(!1,e)}}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers(),this._screenSharingEventSub&&(this._screenSharingEventSub.unsubscribe(),this._screenSharingEventSub=void 0),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0)}toggleReactionsPickerButton(e,t){V.log(L.LogTraceArea.CallingUI,"toggleReactionsPickerButton selected: "+e),this.setState({isReactionsPickerSelected:e},(()=>{t&&this.isComponentMounted()&&!e&&this._reactionsEntryPoint&&this.state.isNavigatingWithKeyboard&&this._reactionsEntryPoint.requestFocus()}))}focusCallEndButton(){this._mainCallControls&&this._mainCallControls.focusCallEndButton()}render(){const e=[ue.container,this.props.opacityStyle];return(0,a.jsxs)(c.Animated.View,{style:e,ignorePointerEvents:!0,children:[(0,a.jsx)(c.View,{style:ue.secondaryControlsContainer,children:this._renderControls(this._secondaryCallControlsManager.getLeftControls())}),(0,a.jsx)(H.default,{ref:this._setMainCallControlsRef,callId:this.props.callId,callUIState:this.props.callUIState,conversationMri:this.props.conversationMri,onOpenDialpad:this.props.onOpenDialpad,onInteracting:this.props.onInteracting,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,disableMic:this.props.disableMic,onEndCallFailure:this.props.onEndCallFailure,useLightTheme:this.props.useLightTheme,shouldDisableVideoDuringScreenSharing:this._shouldDisableVideoDuringScreenSharing()}),(0,a.jsx)(c.View,{style:[ue.secondaryControlsContainer,ue.secondaryControlsContainerRight],ignorePointerEvents:!0,children:this._renderControls(this._secondaryCallControlsManager.getRightControls())})]})}_getIdealLeftControls(e,t,i,o,a,n,s,r,l,c){const d=[];return a||d.push({priority:1,type:T.CallControlsKeys.ShareLink}),e&&d.push({priority:1,type:T.CallControlsKeys.Record}),(t||i)&&d.push({priority:2,type:T.CallControlsKeys.ScreenShareControl}),this.props.showParticipantsButton&&r&&d.push({priority:1,type:T.CallControlsKeys.Participants}),o&&d.push({priority:3,type:T.CallControlsKeys.ChangeScene}),n&&d.push({priority:1,type:s?T.CallControlsKeys.StopTwincam:T.CallControlsKeys.Twincam}),c&&d.push({priority:2,type:T.CallControlsKeys.SkypeTranslate}),l&&d.push({priority:2,type:T.CallControlsKeys.LiveCaptions}),d}_getIdealRightControls(e,t,i,o){const a=[];return a.push({priority:2,type:T.CallControlsKeys.Chat}),e&&a.push({priority:5,type:T.CallControlsKeys.ScreenShare}),t&&a.push({priority:4,type:i?T.CallControlsKeys.LowerHand:T.CallControlsKeys.RaiseHand}),this.props.shouldShowReactions&&(o?a.push({priority:3,type:T.CallControlsKeys.ReactionsPopover}):a.push({priority:3,type:T.CallControlsKeys.ReactionsDrawer})),a.push({priority:1,type:T.CallControlsKeys.Overflow}),a}_getIdealOverflowControls(e,t,i,o,a,n,s,r,l,c,d,u,h,p){const g=[];if(e&&g.push(R.OverflowMenuCommands.Snap),a&&n&&!s&&(m.default.DeviceStore.isBackgroundBlurred()?g.push(R.OverflowMenuCommands.Unblur):g.push(R.OverflowMenuCommands.Blur)),o===this.props.callId&&s&&g.push(R.OverflowMenuCommands.BackgroundEffectsSettings),r){const e=!l&&!c;e&&o===this.props.callId?g.push(R.OverflowMenuCommands.DisableIncomingVideo):e||g.push(R.OverflowMenuCommands.EnableIncomingVideo)}return d&&g.push(R.OverflowMenuCommands.MuteEveryone),u?g.push(R.OverflowMenuCommands.HoldCall):h&&g.push(R.OverflowMenuCommands.ResumeCall),this.props.isEncryptedCall||this.props.isPSTNCall||this.props.isOutgoingVideoDisabled?g.push(R.OverflowMenuCommands.OnShowAudioSettings):g.push(R.OverflowMenuCommands.OnShowAVSettings),p&&g.push(R.OverflowMenuCommands.CallStats),g}_getLeftControlForDesktopMinSmallest(){return T.CallControlsKeys.Chat}_renderControls(e){return n.map(e,(e=>this._renderControl(e)))}_renderControl(e){switch(e){case T.CallControlsKeys.Mic:case T.CallControlsKeys.MicQuickSettings:case T.CallControlsKeys.Video:case T.CallControlsKeys.VideoQuickSettings:case T.CallControlsKeys.Dialpad:return;case T.CallControlsKeys.Participants:return this._getAppropriateParticipantsButton();case T.CallControlsKeys.ScreenShare:return this._getScreenshareButton();case T.CallControlsKeys.ScreenShareControl:return this._getScreenShareControlButton();case T.CallControlsKeys.EndCall:return;case T.CallControlsKeys.RaiseHand:return this._getRaiseOrLowerHandButton(!0);case T.CallControlsKeys.LowerHand:return this._getRaiseOrLowerHandButton(!1);case T.CallControlsKeys.ShareLink:return this._getShareCallLinkButton();case T.CallControlsKeys.Twincam:return this._getShareQRButton(!1);case T.CallControlsKeys.StopTwincam:return this._getShareQRButton(!0);case T.CallControlsKeys.ChangeScene:return this._getTogetherModeBackgroundChangeButton();case T.CallControlsKeys.Record:return this._getRecordCallButton();case T.CallControlsKeys.ReactionsDrawer:return this._getReactionsDrawer();case T.CallControlsKeys.ReactionsPopover:return this._getReactionsPopover();case T.CallControlsKeys.Overflow:return this._renderMoreButton();case T.CallControlsKeys.Moments:return;case T.CallControlsKeys.Chat:return this._getChatPanelButton();case T.CallControlsKeys.LiveCaptions:return this._getLiveCaptionsButton();case T.CallControlsKeys.SkypeTranslate:return this._getSkypeTranslateButton();default:return ne.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getChatPanelButton(){const e=F.getString("CallPanel.ChatButton"),t=this._hideCaption()?void 0:e,i=this.props.isShowingChat?F.getString("CallPanel.CloseConversation"):F.getString("CallPanel.OpenConversation"),o=this._colorConfig();return o.hoverIcon=ee.SkypeIcon.MessageGradient,(0,a.jsx)(c.View,{style:ue.chatPanelButton,children:(0,a.jsx)(g.CallButton,{ref:this.props.onChatButtonRef,icon:this.props.isShowingChat?ee.SkypeIcon.MessageGradient:ee.SkypeIcon.Message,accessibilityLabel:i,size:de,onPress:this._onChatPanelButtonPress,isToggledOn:this.props.isShowingChat,colorConfig:o,isBadgeOn:this.state.isChatBadgeOn,caption:t,title:e,showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.Chat)},T.CallControlsKeys.Chat+"Wrapper")}_getScreenShareControlButton(){return this.state.canRequestScreenShareControl?this._getRequestScreenShareControlButton():this.state.canStopScreenShareControl?this._getStopScreenShareControlButton():this.state.screenShareRequestControlInProgress?this._getScreenShareControlRequestInProgressIndicator():void 0}_getScreenshareButton(){const{allowScreenSharing:e,isScreenShareActive:t}=this.state,i=this._getScreenshareButtonTooltip(),o=this._hideCaption()?void 0:this._getScreenshareButtonTooltip(),n=this._colorConfig();n.hoverIcon=t?void 0:ee.SkypeIcon.ScreenShareGradient;const s=t?ee.SkypeIcon.ScreenShareStopGradient:ee.SkypeIcon.ScreenShare;return(0,a.jsx)(g.CallButton,{ref:this._onScreenShareOverflowMenuButtonRef,icon:s,accessibilityLabel:i,isDisabled:!e,size:de,isToggledOn:t,onPress:e=>this._onNewScreenShareButtonPress(e,void 0),coachMarkType:P.CoachMarkType.CallPanelScreenShareButton,anchorAccessibilityLabel:i,colorConfig:n,caption:o,title:i,showToolTip:!o,toolTipConfig:he},T.CallControlsKeys.ScreenShare)}_getTogetherModeBackgroundChangeButton(){const e=F.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t=this._hideCaption()?void 0:e;return(0,a.jsx)(g.CallButton,{icon:ae.default.getBackgroundChangeButtonIcon(),accessibilityLabel:e,size:de,onPress:this._onTogetherModeBackgroundChangeButtonPress,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:t,title:e,showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.ChangeScene)}_getAppropriateParticipantsButton(){return this.state.isOneOnOneCall?this._getAddParticipantsButton():this._getParticipantsButton()}_getParticipantsButton(){const e=this._getParticipantsTitle(),t=this._hideCaption()?void 0:e,i=this.state.isHandRaised?(0,a.jsx)(c.View,{style:ue.raiseHandImageWrapper,children:(0,a.jsx)(K.default,{type:K.RaiseHandImageType.SmallSizeTopLeftAligned})}):void 0;return(0,a.jsx)(g.CallButton,{icon:ee.SkypeIcon.ContactGroupTwoPersonas,accessibilityLabel:e,size:de,onPress:this._onParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:this._getParticipantsButtonColorConfig(),caption:t,title:e,additionalImage:i,borderWidth:2,showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.Participants)}_getParticipantsButtonColorConfig(){var e;const t=ee.SkypeIcon.ContactGroupTwoPersonasGradient;if(this.state.isHandRaised){const i=this._colorConfig();return Object.assign(Object.assign({},i),{borderColor:J.Color.raiseHandOrange,hoverIcon:t,hoverStyle:[...null!==(e=i.hoverStyle)&&void 0!==e?e:[],c.Styles.createButtonStyle({borderWidth:2,borderColor:J.Color.raiseHandOrange},!1)]})}{const e=this._colorConfig();return e.hoverIcon=t,e}}_hideCaption(){const{controlsType:e}=this.props;return e===T.CallControlsType.DesktopMinSmallest||e===T.CallControlsType.DesktopMedium}_getAddParticipantsButton(){const e=this._getAddParticipantsTitle(),t=this._hideCaption()?void 0:e,i=this._colorConfig();return i.hoverIcon=ee.SkypeIcon.PersonAddGradient,(0,a.jsx)(g.CallButton,{icon:ee.SkypeIcon.ContactAdd,accessibilityLabel:e,size:de,onPress:this._onAddParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.Participants)}_getAddParticipantsTitle(){return F.getString("CallControls.AddParticipants")}_getParticipantsTitle(){return F.getString("CallControls.Participants")}_getLiveCaptionsButton(){const e=F.getString("CallControls.LiveCaptions"),t=this._hideCaption()?void 0:e,i=this._colorConfig(),o=ee.SkypeIcon.ClosedCaption;return(0,a.jsx)(g.CallButton,{icon:o,accessibilityLabel:e,size:de,onPress:this._onLiveCaptionsButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,isToggledOn:this.state.isCaptioning,title:e,showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.LiveCaptions)}_getSkypeTranslateButton(){const e=F.getString("CallControls.Translate"),t=this._hideCaption()?void 0:e,i=this._colorConfig(),o=ee.SkypeIcon.Translate;return(0,a.jsx)(g.CallButton,{icon:o,accessibilityLabel:e,size:de,onPress:this._onSkypeTranslateButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,isToggledOn:this.state.isSkypeTranslating,title:e,showToolTip:!t,toolTipConfig:he},T.CallControlsKeys.SkypeTranslate)}_getReactionsDrawer(){const e={key:this.state.emoticonReactionKey,type:T.ReactionsItemType.Emoticon},t=this._getReactionPickerText(),i=F.getString("MeetNowCallControls.ReactionBarDrawerTitle"),o=this._hideCaption()?void 0:i,n=this.state.isConnecting1on1?(0,a.jsx)(g.CallButton,{ref:this._setEngagementTooltipAnchor,size:de,icon:ee.SkypeIcon.HeartOutline,isDisabled:!0,caption:o,title:i,accessibilityLabel:t,showToolTip:!0,colorConfig:this._colorConfig()}):(0,a.jsx)(S.default,{ref:this._onCallReactionsDrawerItemRef,info:e,isAnimated:!this.props.isHidden,importantForAccessibility:c.Types.ImportantForAccessibility.Yes,accessibilityLabel:t,onPress:this._onReactionsPickerPressed,onHover:this.state.isNavigatingWithKeyboard?void 0:this._onReactionsPickerHovered,caption:o,title:i,useDesktopCallControls:!0,isCallMenuItem:!0,useLightTheme:this.props.useLightTheme,hideIcon:this.state.isReactionsPickerSelected,showToolTip:!o},e.key);return(0,a.jsxs)(c.View,{style:ue.reactionsPickerButton,children:[n,this.state.showCustomizeReactionsPencilButton&&(0,a.jsx)(A.default,{styles:ue.customCallReactionsButton,iconSize:ee.IconSize.size12,origin:k.CustomReactionsType.Call})]},T.CallControlsKeys.ReactionsDrawer)}_getReactionsPopover(){const e=F.getString("MeetNowCallControls.ReactionBarDrawerTitle"),t=this._hideCaption()?void 0:e,i=this._colorConfig();return i.hoverIcon=ee.SkypeIcon.EmojiAddGradient,(0,a.jsx)(c.View,{style:ue.reactionsPickerButton,children:(0,a.jsx)(g.CallButton,{icon:ee.SkypeIcon.EmojiAdd,accessibilityLabel:this._getReactionPickerText(),isDisabled:this.state.isConnecting1on1,size:de,onPress:()=>{},colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:he})},T.CallControlsKeys.ReactionsPopover)}_renderMoreButton(){const e=F.getString("CallControls.CallButtonOverflowMenu"),t=F.getString("Global.MoreButtonTitle"),i=this._hideCaption()?void 0:t;return(0,a.jsx)(g.CallButton,{ref:this._onOverflowMenuButtonRef,icon:this._hideCaption()?ee.SkypeIcon.MoreVertical:ee.SkypeIcon.More,accessibilityLabel:e,size:de,onPress:this._showOverflowMenuPopup,coachMarkType:this.state.isMinDesktop&&this.state.allowScreenSharing?P.CoachMarkType.CallPanelScreenShareButton:void 0,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:i,title:t,showToolTip:!i,toolTipConfig:he},T.CallControlsKeys.Overflow)}_getRecordCallButton(){const e=this.state.isRecording?F.getString("CallControlsOverFlowMenu.StopRecording"):F.getString("CallControlsOverFlowMenu.StartRecording"),t=this.state.isRecording?F.getString("CallControlsOverFlowMenu.StopRecording"):F.getString("MeetNowCallControls.StartRecording"),i=this._hideCaption()?void 0:t,o=this._colorConfig();return o.hoverIcon=ee.SkypeIcon.CallRecordGradient,(0,a.jsx)(g.CallButton,{icon:this.state.isRecording?ee.SkypeIcon.CallRecordGradient:ee.SkypeIcon.CallRecord,accessibilityLabel:e,isDisabled:!this.state.allowRecording,isToggledOn:this.state.isRecording,size:de,colorConfig:o,onPress:this.props.onRecordCallPress,caption:i,title:t,showToolTip:!i,toolTipConfig:he},T.CallControlsKeys.Record)}_isUnreadInCallIncomingMessageAndPhoto(){return _.default.getUnseenIncomingTextCount(this.props.callId)>0||_.default.getUnseenIncomingPhotoCount(this.props.callId)>0}_colorConfig(){return this.props.useLightTheme?this._lightThemeColorConfig():{iconColor:J.Color.gray50,backgroundColor:J.Color.transparent,selectedIconColor:this._getContext().themeColors.iconInteractive,selectedBackgroundColor:J.Color.black,showHoverEffect:!0,hoverStyle:ue.hoverStyleDark,hoverColor:this._getContext().themeColors.iconInteractive}}_lightThemeColorConfig(){return{iconColor:J.Color.gray400,backgroundColor:J.Color.transparent,selectedIconColor:this._getContext().themeColors.iconInteractive,selectedBackgroundColor:J.Color.gray100,borderColor:J.Color.transparent,captionColor:J.Color.gray400,showHoverEffect:!0,hoverStyle:ue.hoverStyleLight,hoverColor:this._getContext().themeColors.iconInteractive}}_getRaiseOrLowerHandButton(e){const{key:t,icon:i,buttonLabel:o,a11yLabel:n,onButtonPress:s}=e?this._getRaiseHandProps():this._getLowerHandProps(),r=this._colorConfig();r.hoverIcon=ee.SkypeIcon.LowerHandGradient;const l=this._hideCaption()?void 0:o;return(0,a.jsx)(g.CallButton,{icon:i,title:o,size:de,isToggledOn:this.state.isHandRaisedForCurrentUser,onPress:s,accessibilityLabel:n,colorConfig:r,anchorAccessibilityLabel:n,caption:l,isDisabled:this.state.isRaisedHandDisabled||!(this.state.callState===d.CallState.Connected),showToolTip:!l,toolTipConfig:he},t)}_getRaiseHandProps(){const e=F.getString("CallControls.RaiseHand"),t=F.getString("CallControls.RaiseHandLabel"),i=this._onRaiseHandPressed,o=ee.SkypeIcon.RaiseHand;return{key:T.CallControlsKeys.RaiseHand,icon:o,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getLowerHandProps(){const e=F.getString("CallControls.LowerHand"),t=F.getString("CallControls.LowerHandLabel"),i=this._onLowerHandPressed,o=ee.SkypeIcon.LowerHandGradient;return{key:T.CallControlsKeys.LowerHand,icon:o,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getOverflowMenuItemsForCommands(e){const t=n.map(e,(e=>{const t=this._menuTextForCommand(e),i=this._menuIconForCommand(e);return t?{text:t,command:e,icon:i}:void 0}));return n.compact(t)}_menuIconForCommand(e){switch(e){case R.OverflowMenuCommands.BackgroundEffectsSettings:case R.OverflowMenuCommands.Blur:case R.OverflowMenuCommands.Unblur:return D.SXMenuIcon.BlurBackground;case R.OverflowMenuCommands.ConfirmStopSharing:case R.OverflowMenuCommands.StopSharing:return D.SXMenuIcon.ScreenshareOff;case R.OverflowMenuCommands.ShareScreen:case R.OverflowMenuCommands.ShareScreenAndSounds:return D.SXMenuIcon.Screenshare;case R.OverflowMenuCommands.SwitchScreen:return D.SXMenuIcon.ViewSwitch;case R.OverflowMenuCommands.ScreenShareControl:return D.SXMenuIcon.ScreenSharingRequestControl;case R.OverflowMenuCommands.StopScreenShareControl:return D.SXMenuIcon.ScreenSharingStopControl;case R.OverflowMenuCommands.Snap:return D.SXMenuIcon.Snapshot;case R.OverflowMenuCommands.React:return D.SXMenuIcon.React;case R.OverflowMenuCommands.CustomReact:return D.SXMenuIcon.CustomReact;case R.OverflowMenuCommands.RaiseHand:return D.SXMenuIcon.RaiseHand;case R.OverflowMenuCommands.LowerHand:return D.SXMenuIcon.LowerHand;case R.OverflowMenuCommands.OnAddToCall:return D.SXMenuIcon.SkypeContacts;case R.OverflowMenuCommands.OnShowParticipants:return D.SXMenuIcon.ContactGroupPair;case R.OverflowMenuCommands.OnShowAudioSettings:case R.OverflowMenuCommands.OnShowAVSettings:case R.OverflowMenuCommands.CallStats:return D.SXMenuIcon.Settings;case R.OverflowMenuCommands.Invite:return D.SXMenuIcon.AddSkypeContacts;case R.OverflowMenuCommands.HoldCall:return D.SXMenuIcon.HoldCall;case R.OverflowMenuCommands.ResumeCall:return D.SXMenuIcon.ResumeCall;case R.OverflowMenuCommands.StartRecording:case R.OverflowMenuCommands.StopRecording:return D.SXMenuIcon.Record;case R.OverflowMenuCommands.StartCaptions:case R.OverflowMenuCommands.StopCaptions:case R.OverflowMenuCommands.LiveCaptions:return D.SXMenuIcon.Subtitles;case R.OverflowMenuCommands.SkypeTranslate:case R.OverflowMenuCommands.StopSkypeTranslate:return D.SXMenuIcon.Translate;case R.OverflowMenuCommands.EnableIncomingVideo:return D.SXMenuIcon.VideoEnable;case R.OverflowMenuCommands.DisableIncomingVideo:return D.SXMenuIcon.VideoOff;case R.OverflowMenuCommands.MuteEveryone:return D.SXMenuIcon.MicrophoneOff;case R.OverflowMenuCommands.ChangeTogetherModeBackground:return D.SXMenuIcon.Picture;case R.OverflowMenuCommands.BingBackgrounds:return D.SXMenuIcon.Bing;case R.OverflowMenuCommands.Twincam:return D.SXMenuIcon.Twincam;case R.OverflowMenuCommands.StopTwincam:return D.SXMenuIcon.StopTwincam;default:return}}_menuTextForCommand(e){switch(e){case R.OverflowMenuCommands.Blur:case R.OverflowMenuCommands.Unblur:return m.default.DeviceStore.isBackgroundBlurred()?F.getString("CallControls.CallMenuUnBlurBackground"):F.getString("CallControls.CallMenuBlurBackground");case R.OverflowMenuCommands.ConfirmStopSharing:return F.getString("CallControlsOverFlowMenu.ConfirmStopShareScreen");case R.OverflowMenuCommands.StopSharing:case R.OverflowMenuCommands.ShareScreen:return this.state.isScreenShareActive?F.getString("CallControlsOverFlowMenu.StopShareScreen"):F.getString("CallControlsOverFlowMenu.ShareScreen");case R.OverflowMenuCommands.ShareScreenAndSounds:return F.getString("CallControlsOverFlowMenu.ShareScreenAndSounds");case R.OverflowMenuCommands.ScreenShareControl:return F.getString("CallControls.CallButtonRequestScreenShareControl");case R.OverflowMenuCommands.StopScreenShareControl:return F.getString("CallControls.CallButtonStopScreenShareControlFromViewer");case R.OverflowMenuCommands.SwitchScreen:return this.state.windowSharingEnabled?F.getString("CallControlsOverFlowMenu.SwitchScreenOrWindow"):F.getString("CallControlsOverFlowMenu.SwitchScreen");case R.OverflowMenuCommands.Snap:return this._getSnapshotText();case R.OverflowMenuCommands.React:case R.OverflowMenuCommands.CustomReact:return this._getReactionPickerText();case R.OverflowMenuCommands.RaiseHand:return F.getString("CallControls.RaiseHandLabel");case R.OverflowMenuCommands.LowerHand:return F.getString("CallControls.LowerHandLabel");case R.OverflowMenuCommands.OnAddToCall:return this._getAddParticipantsTitle();case R.OverflowMenuCommands.OnShowParticipants:return this._getParticipantsTitle();case R.OverflowMenuCommands.OnShowAudioSettings:return F.getString("CallControlsOverFlowMenu.AdjustAudioSettings");case R.OverflowMenuCommands.OnShowAVSettings:return F.getString("CallControlsOverFlowMenu.AdjustAVSettings");case R.OverflowMenuCommands.BackgroundEffectsSettings:return F.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings");case R.OverflowMenuCommands.HoldCall:return F.getString("CallControlsOverFlowMenu.HoldCall");case R.OverflowMenuCommands.ResumeCall:return F.getString("CallControlsOverFlowMenu.ResumeCall");case R.OverflowMenuCommands.StartRecording:return F.getString("CallControlsOverFlowMenu.StartRecording");case R.OverflowMenuCommands.StopRecording:return F.getString("CallControlsOverFlowMenu.StopRecording");case R.OverflowMenuCommands.StartCaptions:return F.getString("CallControlsOverFlowMenu.StartSubtitles");case R.OverflowMenuCommands.StopCaptions:return F.getString("CallControlsOverFlowMenu.StopSubtitles");case R.OverflowMenuCommands.EnableIncomingVideo:return F.getString("CallControlsOverFlowMenu.StartIncomingVideo");case R.OverflowMenuCommands.DisableIncomingVideo:return F.getString("CallControlsOverFlowMenu.StopIncomingVideo");case R.OverflowMenuCommands.CallStats:return F.getString("CallPanel.CallStats");case R.OverflowMenuCommands.Invite:return F.getString("MeetNow.ShareInvite");case R.OverflowMenuCommands.MuteEveryone:return F.getString("CallControls.CallButtonMuteEveryone");case R.OverflowMenuCommands.ChangeTogetherModeBackground:return F.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");case R.OverflowMenuCommands.BingBackgrounds:return F.getString("CallControls.BingBackgrounds");case R.OverflowMenuCommands.Twincam:return F.getString("CallControlsOverFlowMenu.Twincam");case R.OverflowMenuCommands.StopTwincam:return F.getString("CallControlsOverFlowMenu.StopTwincam");case R.OverflowMenuCommands.LiveCaptions:return F.getString("CallControlsOverFlowMenu.LiveCaptionsStart");case R.OverflowMenuCommands.SkypeTranslate:return F.getString("CallControlsOverFlowMenu.Translate");case R.OverflowMenuCommands.StopSkypeTranslate:return F.getString("CallControlsOverFlowMenu.StopTranslate");default:return}}_maybeExecuteTwincamCommand(e){this._twincamCommand&&this._twincamCommand.canExecute()&&this._twincamCommand.execute(e)}_onSwitchScreen(e){this._stopScreenSharing().then((()=>{this._startBrowserScreenSharing(e),y.default.updateCallTelemetry(this.props.callId,e,(e=>e.switchScreenWhileSharing()))}))}_onShareScreen(e){this._startBrowserScreenSharing(e)}_startBrowserScreenSharing(e){var t;if(V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._startBrowserScreenSharing for browser causeId: "+e),this._shouldDisableVideoDuringScreenSharing()&&this.state.isVideoActive)return null===(t=m.default.CallingStore.getLocalVideoState(this.props.callId))||void 0===t||t.setLocalVideoEnabled(!1),this.props.showHideOutgoingVideoDisabledToast(!0,e),void this._startScreenSharing(e,!1,void 0,void 0);this._startScreenSharing(e,!1,void 0,void 0)}_shouldDisableVideoDuringScreenSharing(){return!0}_startScreenSharing(e,t,i,o){m.default.CallingStore.startScreenSharing(this.props.callId,e,i,t).catch((t=>{t&&"permissionDeniedError"===t.type&&y.default.updateCallTelemetry(this.props.callId,e,(e=>{e.cancelScreenSharing()}))})),this._currentScreenSharingSource=i,this._currentScreenSharingSourceType=o,y.default.updateCallTelemetry(this.props.callId,e,(e=>{e.startScreenSharing(),t&&e.startSoundSharing()})),o&&this._incrementSourceTypeTelemetryCounts(o,e)}_incrementSourceTypeTelemetryCounts(e,t){y.default.updateCallTelemetry(this.props.callId,t,(t=>e===d.SharingSourceType.Monitor?t.wholeScreenSharedCount():t.appWindowSharedCount()))}_registerKeyboardHandlers(){E.default.addHandler(L.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_unregisterKeyboardHandlers(){E.default.removeHandler(L.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_startRecording(){const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._startRecording causeId: "+e),m.default.InCallBotService.startRecording(this.props.callId,e)}_stopRecording(){const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._stopRecording causeId: "+e),m.default.InCallBotService.stopRecording(this.props.callId,e)}_startTranslator(){const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator causeId: "+e),b.default.announceSubtitleState(true,!1),m.default.InCallBotService.startTranslator(this.props.callId,e).then((()=>{b.default.announceSubtitleState(true,!0)})).catch((t=>{V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator error: "+Q.default.errorAsString(t)+" causeId: "+e)}))}_stopTranslator(){const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._stopTranslator causeId: "+e),b.default.announceSubtitleState(false,!1),m.default.InCallBotService.stopTranslator(this.props.callId,e).then((()=>{b.default.announceSubtitleState(false,!0)}))}_enableIncomingVideo(){const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._startIncomingVideo causeId: "+e),this.state.audioOnlyEnabled?m.default.CallingStore.stopAudioOnly(this.props.callId,e):b.default.enableIncomingVideo(this.props.callId,e)}_disableIncomingVideo(){const e=ne.default.newCauseId();V.log(L.LogTraceArea.CallingUI,"DesktopCallControls._stopIncomingVideo causeId: "+e),b.default.disableIncomingVideo(this.props.callId,e)}}t.default=pe},469469:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(667294),s=o.__importStar(i(516778)),r=i(148540),l=o.__importStar(i(85385)),c=o.__importStar(i(704704)),d=o.__importStar(i(446574)),u=o.__importStar(i(187140)),h=i(26178),p=i(460515),g=i(154235),C=i(641400),m=i(815146),S=i(737298),_=o.__importDefault(i(50633)),f=o.__importDefault(i(369347)),y=o.__importDefault(i(132680)),T=i(16549),b=o.__importDefault(i(438752)),v=i(22478),I=i(69964),w=o.__importDefault(i(453761)),P=o.__importDefault(i(612285)),M=o.__importDefault(i(97595)),D=i(26703),A=o.__importDefault(i(740794)),k=i(812822),R=i(206197),x=o.__importDefault(i(497910)),L=o.__importDefault(i(760989)),B=o.__importDefault(i(215687)),V=i(364038),O=o.__importDefault(i(150343)),E=o.__importDefault(i(638260)),N=(0,D.lazyProperties)({container:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center"}),buttonGroupContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center",marginHorizontal:8,backgroundColor:T.Color.gray400,borderRadius:46,height:40}),buttonGroupContainerLightTheme:()=>s.Styles.createViewStyle({backgroundColor:T.Color.gray100Overlay80}),chevron:()=>s.Styles.createViewStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:4}),extraChevronMargin:()=>s.Styles.createViewStyle({marginRight:8}),micButtonExtraStyles:()=>s.Styles.createViewStyle({marginLeft:-2})});class F extends x.default{constructor(){super(...arguments),this._hangUpButtonAnchor=(0,n.createRef)(),this._renderMicrophoneActivityIcon=e=>(0,a.jsx)(V.MicrophoneActivityIcon,Object.assign({},e,{isMuted:this.state.isMuted})),this._onMicButtonPopupRef=e=>{this._micButtonPopup=e||void 0},this._onVideoButtonPopupRef=e=>{this._videoButtonPopup=e||void 0},this._onMicButtonPopupClosed=()=>{this.setState({isMicPopupOpen:!1})},this._onVideoButtonPopupClosed=()=>{this.setState({isVideoPopupOpen:!1})},this._onMicButtonPopupAnchor=e=>{this._micButtonPopupAnchor=e||void 0},this._onVideoButtonPopupAnchor=e=>{this._videoButtonPopupAnchor=e||void 0,d.EnsureStarted(b.default).then((()=>{b.default.setAnchor(v.EngagementTooltipType.CallVideoSettings,e)}))},this._onMicQuickSettings=()=>{this.setState({isMicPopupOpen:!this.state.isMicPopupOpen},(()=>{this._micButtonPopup&&(this.state.isMicPopupOpen?this._micButtonPopup.showImmediately():this._micButtonPopup.hideImmediately())}))},this._onVideoQuickSettings=()=>{this.setState({isVideoPopupOpen:!this.state.isVideoPopupOpen},(()=>{this._videoButtonPopup&&(this.state.isVideoPopupOpen?this._videoButtonPopup.showImmediately():this._videoButtonPopup.hideImmediately())}))},this._onToggleMicrophone=()=>{const e=L.default.newCauseId();E.default.trackMicButtonClick(this.props.callId,e,this.props.callUIState),this._micButtonPopup&&this._micButtonPopup.onAnchorPress();new S.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId(),void 0,e).execute(),this.props.onInteracting(!1)},this._onToggleVideo=()=>{const e=L.default.newCauseId();E.default.trackVideoButtonClick(this.props.callId,e),this._videoButtonPopup&&this._videoButtonPopup.onAnchorPress(),this.state.isAwaitingCameraConfirmation?(f.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),f.default.DeviceStore.choosePreselectedDevices(e)):(this._videoCommand.execute(),this.props.onInteracting(!1))},this._showAVSettings=()=>{const e=L.default.newCauseId();l.log(m.LogTraceArea.CallingUI,"DesktopMainCallControls._showAVSettings causeId: "+e),A.default.navigateToDesktopSettingsGroup(k.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)}}_buildState(e,t){this._videoCommand=new S.ToggleVideoCommand(e.callId,e);return{isMuted:y.default.isLocalOrServerMuted(e.callId),isServerMuted:f.default.CallingStore.isServerMuted(e.callId),isVideoButtonEnabled:this._videoCommand.canExecute(),isVideoActive:f.default.CallingStore.isProvidingVideo(e.callId),isOutgoingVideoDisabled:f.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),callState:f.default.CallingStore.getCallState(e.callId),isNavigatingWithKeyboard:P.default.isNavigatingWithKeyboard(),isAwaitingCameraConfirmation:f.default.CallControlsStore.isAwaitingCameraConfirmation(),isScreenShareActive:f.default.CallingStore.isScreenSharing(e.callId),enableMicSoundIndicator:O.default.getS4LCMCFeatures().enableMicSoundIndicator}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||y.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}focusCallEndButton(){var e;null===(e=this._hangUpButtonAnchor.current)||void 0===e||e.requestFocus()}render(){const e=(0,a.jsx)(_.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onMicButtonPopupRef,callId:this.props.callId,onClosed:this._onMicButtonPopupClosed,isSticky:!0,popupId:"AudioSettingsPopup",anchor:()=>this._micButtonPopupAnchor}),t=(0,a.jsx)(B.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onVideoButtonPopupRef,callId:this.props.callId,isVideoButtonEnabled:this.state.isVideoButtonEnabled,onClosed:this._onVideoButtonPopupClosed,isVideoDisabledDuringScreenSharing:this._isVideoDisabledDuringScreenSharing(),onChangeBackgroundPress:this._showAVSettings,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled,isSticky:!0,popupId:"VideoSettingsPopup",anchor:()=>this._videoButtonPopupAnchor,useLightTheme:this.props.useLightTheme});return this._renderNewMainCallControls(e,t)}_shouldRenderVideoButton(){return!this.props.isPSTNCall&&!this.props.isEncryptedCall}_renderNewMainCallControls(e,t){const i=[N.buttonGroupContainer,...this.props.useLightTheme?[N.buttonGroupContainerLightTheme]:[]];let o,n;return this._shouldRenderVideoButton()?o=[this._getVideoButton(),this._getChevronButton(p.CallControlsKeys.VideoQuickSettings,c.getString("CallControls.CallButtonCameraQuickSettings"),this.state.isVideoPopupOpen?g.FontWeight.bold:g.FontWeight.regular,this._onVideoQuickSettings,this._onVideoButtonPopupAnchor,this.state.isOutgoingVideoDisabled,N.extraChevronMargin)]:this.props.isPSTNCall&&(n=[this._getDialPadButton()]),(0,a.jsxs)(s.View,{style:N.container,children:[(0,a.jsxs)(s.View,{style:i,ignorePointerEvents:!0,children:[e,t,this._getMicButton(),this._getChevronButton(p.CallControlsKeys.MicQuickSettings,c.getString("CallControls.CallButtonMicrophoneQuickSettings"),this.state.isMicPopupOpen?g.FontWeight.bold:g.FontWeight.regular,this._onMicQuickSettings,this._onMicButtonPopupAnchor,void 0),this._shouldRenderVideoButton()?o:n]}),this._getHangUpButton()]})}_getMicButton(){const{enableMicSoundIndicator:e,isMuted:t}=this.state,i=c.getString(t?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),o=M.default.generateTooltipLabelWithShortcutForCondition(i,m.KeyboardShortcut.ToggleMicrophone),n=this._getActionButtonColorConfig(!t,this.props.useLightTheme);return(0,a.jsx)(u.default,{icon:t?C.SkypeIcon.MicrophoneOff:C.SkypeIcon.Microphone,size:u.ActionButtonSize.Small,renderIcon:e?this._renderMicrophoneActivityIcon:void 0,onPress:this._onToggleMicrophone,title:o,accessibilityLabel:i,backgroundColor:null==n?void 0:n.backgroundColor,iconColor:null==n?void 0:n.iconColor,style:N.micButtonExtraStyles,reverseGradientColor:!0},p.CallControlsKeys.Mic)}_getChevronButton(e,t,i,o,n,s,r){return(0,a.jsx)(w.default,{ref:n,icon:C.SkypeIcon.UpChevron,title:t,disabled:s,size:C.IconSize.size12,onPress:o,accessibilityLabel:t,hoverColor:this.props.useLightTheme?T.Color.gray400Overlay50:T.Color.whiteOverlay50,color:this.props.useLightTheme?T.Color.gray400:T.Color.white,style:[N.chevron,r]},e)}_getActionButtonColorConfig(e,t){if(e)return;const i={iconColor:T.Color.white,backgroundColor:T.Color.transparent};return t&&(i.iconColor=T.Color.gray400),i}_getVideoButton(){let e,t;this.props.isOutgoingVideoDisabled?e=t=c.getString("AudioVideoSettings.OutgoingVideoDisabled"):(e=c.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),t=M.default.generateTooltipLabelWithShortcutForCondition(e,m.KeyboardShortcut.ToggleCamera));const i=this._getActionButtonColorConfig(this.state.isVideoActive||this.state.isAwaitingCameraConfirmation,this.props.useLightTheme);return(0,a.jsx)(u.default,{icon:this.state.isAwaitingCameraConfirmation?C.SkypeIcon.Ok:this.state.isVideoActive?C.SkypeIcon.Video:C.SkypeIcon.VideoOff,size:u.ActionButtonSize.Small,onPress:this._onToggleVideo,title:t,accessibilityLabel:e,backgroundColor:null==i?void 0:i.backgroundColor,iconColor:null==i?void 0:i.iconColor,reverseGradientColor:!0},p.CallControlsKeys.Video)}_getDialPadButton(){const e=c.getString("CallPanel.DialpadTooltipTitle");return(0,a.jsx)(h.CallButton,{icon:C.SkypeIcon.Dialpad,title:e,size:h.CallButtonSize.Small,isDisabled:!(this.state.callState===r.CallState.Connected||this.state.callState===r.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,accessibilityLabel:e,backgroundStyle:h.CallButtonBackgroundStyle.Overlay,doNotAddHorizontalMargin:!0},p.CallControlsKeys.Dialpad)}_getHangUpButton(){return(0,a.jsx)(I.HangUpButton,{ref:this._hangUpButtonAnchor,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,conversationMri:this.props.conversationMri,connectedCallId:this.props.connectedCallId,callUIState:this.props.callUIState,callId:this.props.callId,onEndCallFailure:this.props.onEndCallFailure,focusOnMount:this.state.isNavigatingWithKeyboard,rootViewId:this._getRootViewId()})}_isVideoDisabledDuringScreenSharing(){return this.props.shouldDisableVideoDuringScreenSharing&&this.state.isScreenShareActive}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&l.log(m.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&l.log(m.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}}t.default=F},509310:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(148540),r=i(167606),l=o.__importStar(i(704704)),c=o.__importStar(i(85385)),d=o.__importDefault(i(760989)),u=o.__importStar(i(187140)),h=i(641400);t.default=n.memo((e=>{const t=(i=e.onOpenDialpad,n.useCallback((()=>{const e=d.default.newCauseId();c.log(r.LogTraceArea.CallingUI,`useDialpadButtonPress, causeId: ${e}`),i()}),[i]));var i;const o=l.getString("CallPanel.DialpadTooltipTitle"),p=!(e.callState===s.CallState.Connected||e.callState===s.CallState.EarlyMedia);return(0,a.jsx)(u.default,{icon:h.SkypeIcon.Dialpad,accessibilityLabel:o,title:o,size:u.ActionButtonSize.Medium,onPress:t,reverseGradientColor:!0,disabled:p})}))},69964:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HangUpButton=void 0;const o=i(197582),a=i(785893),n=i(667294),s=o.__importStar(i(85385)),r=o.__importStar(i(704704)),l=o.__importStar(i(187140)),c=i(460515),d=i(16549),u=i(737298),h=i(815146),p=o.__importDefault(i(625209)),g=o.__importDefault(i(97595)),C=i(641400),m=o.__importDefault(i(601274)),S=o.__importDefault(i(760989)),_=o.__importDefault(i(638260));t.HangUpButton=(0,n.memo)((0,n.forwardRef)((({callId:e,isPSTNCall:t,isEncryptedCall:i,conversationMri:o,connectedCallId:f,callUIState:y,onEndCallFailure:T,focusOnMount:b,rootViewId:v},I)=>{const w=(0,n.useRef)(null);((e,t)=>{const i=(0,n.useRef)(!1),o=(0,n.useRef)(0);(0,n.useEffect)((()=>(e.current&&t&&!i.current&&(o.current=m.default.setTimeout((()=>{var t;null===(t=e.current)||void 0===t||t.requestFocus()}),1e3)),i.current=!0,()=>{m.default.clearTimeout(o.current)})),[t,e])})(w,b);const P=new u.EndCallForEveryoneCommand(e,{callId:e,isPSTNCall:t,isEncryptedCall:i,conversationMri:o,connectedCallId:f},y,T),M=P.canExecute(),D=new u.EndCallCommand(e,void 0,T),A=(e,t)=>{s.log(h.LogTraceArea.CallingUI,"DesktopCallControls._endCall forEveryone: "+e+" causeId: "+t),e?P.execute():D.execute()},k=e=>{e.stopPropagation(),e.preventDefault(),M&&p.default.showEndCallMenuPopup(v,e,(()=>w.current),(e=>{p.default.selectEndCallMenuItem(e,v,A)}))},R=r.getString("CallControls.CallButtonEndCall"),x=g.default.generateTooltipLabelWithShortcutForCondition(R,h.KeyboardShortcut.HangupOrRejectCall);return(0,a.jsx)(l.default,{ref:(L=[w,I],function(e){for(const t of L)"function"==typeof t?t(e):null!==t&&(t.current=e)}),icon:C.SkypeIcon.CallEnd,title:x,size:l.ActionButtonSize.Small,backgroundColor:d.Color.red,onPress:()=>{const t=S.default.newCauseId();s.log(h.LogTraceArea.CallingUI,"DesktopCallControls._onEndCallButtonPress "+t),_.default.trackHangUpButtonClick(e,t),A(!1,t)},onLongPress:k,onContextMenu:k,accessibilityLabel:R},c.CallControlsKeys.EndCall);var L}))),t.HangUpButton.displayName="HangUpButton"},176101:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=o.__importStar(i(704704)),r=o.__importStar(i(187140)),l=i(641400),c=o.__importDefault(i(369347)),d=i(512992),u=i(526849),h=i(737298),p=o.__importDefault(i(92179)),g=i(96575),C=o.__importDefault(i(760989)),m=o.__importDefault(i(150343)),S=o.__importDefault(i(132680)),_=o.__importDefault(i(638260)),f=i(736267),y=i(364038);t.default=(0,u.WithResub)(n.memo((e=>{const t=((e,t)=>n.useCallback((i=>{const o=C.default.newCauseId();p.default.createTrackerAndMarkPressTime(o,g.ScenarioName.ResponsivenessMuteCall,i),_.default.trackMicButtonClick(e.callId,o,e.callUIState),new h.ToggleMuteCommand(e.callId,e.isMuted,e.isServerMuted,!!e.disableMic,t,o,o).execute(),e.isMuted&&e.onLocalUnmute&&e.onLocalUnmute()}),[e,t]))(e,(0,f.useCommonContext)().rootViewId),i=(0,d.useActionButtonColorConfig)(!e.isMuted),o=s.getString(e.isMuted?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),c=e.isMuted,u=n.useCallback((e=>(0,a.jsx)(y.MicrophoneActivityIcon,Object.assign({},e,{isMuted:c,legacy:!0}))),[c]);return(0,a.jsx)(r.default,{icon:e.isMuted?l.SkypeIcon.MicrophoneOff:l.SkypeIcon.Microphone,accessibilityLabel:o,title:o,size:r.ActionButtonSize.Medium,backgroundColor:null==i?void 0:i.backgroundColor,iconColor:null==i?void 0:i.iconColor,onPress:t,renderIcon:e.enableMicSoundIndicator?u:void 0,reverseGradientColor:!0})})),(e=>{const t=m.default.getS4LCMCFeatures().enableMicSoundIndicator,i=c.default.CallingStore.isServerMuted(e.callId),o=S.default.isLocalOrServerMuted(e.callId);return Object.assign(Object.assign({},e),{enableMicSoundIndicator:t,isServerMuted:i,isMuted:o})}))},991244:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=i(312502),l=i(526849),c=o.__importDefault(i(369347)),d=o.__importDefault(i(859337)),u=o.__importDefault(i(176101)),h=o.__importDefault(i(240534)),p=o.__importDefault(i(165785)),g=i(518083),C=o.__importDefault(i(509310)),m=o.__importDefault(i(48076));t.default=(0,l.WithResub)(n.memo((e=>{const t=(0,a.jsxs)(a.Fragment,{children:[e.isPSTNCall?(0,a.jsx)(C.default,{callState:e.callState,onOpenDialpad:e.onOpenDialpad}):(0,a.jsx)(d.default,{callId:e.callId,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,connectedCallId:e.connectedCallId}),(0,a.jsx)(u.default,{callId:e.callId,callUIState:e.callUIState,disableMic:e.disableMic,onLocalUnmute:e.onLocalUnmute}),(0,a.jsx)(p.default,{callId:e.callId,callUIState:e.callUIState,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,connectedCallId:e.connectedCallId}),(0,a.jsx)(g.AudioOutputButton,{callId:e.callId}),(0,a.jsx)(h.default,{isEncryptedCall:e.isEncryptedCall,callUIState:e.callUIState,onOverflowPressed:e.onOverflowPressed})]});if(m.default.isTabletNoSubscription()){const i=e.showCallControlsVertically?r.styles.tabletWrapperLandscape:r.styles.tabletWrapper,o=e.showCallControlsVertically?r.styles.tabletContainerLandscape:r.styles.tabletContainer;return(0,a.jsx)(s.View,{style:i,children:(0,a.jsx)(s.View,{style:o,children:t})})}{const i=e.showCallControlsVertically?r.styles.defaultContainerLandscape:r.styles.defaultContainer;return(0,a.jsx)(s.View,{style:i,children:t})}})),(e=>{const t=c.default.CallingStore.getCallState(e.callId);return Object.assign(Object.assign({},e),{callState:t})}))},240534:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(167606),r=o.__importStar(i(187140)),l=i(460515),c=o.__importStar(i(85385)),d=o.__importStar(i(704704)),u=i(641400),h=i(512992);t.default=n.memo((e=>{const t=n.useRef(null),i=(o=t,p=e.onOverflowPressed,n.useCallback((()=>{c.log(s.LogTraceArea.CallingUI,"MobileCallPanelControls._showOverflowMenu"),p((()=>o.current),!0,!1)}),[o,p]));var o,p;const g=(0,h.useActionButtonColorConfig)(!1),C=e.isEncryptedCall||e.callUIState===l.CallUIState.None,m=d.getString("CallControls.CallButtonOverflowMenu");return(0,a.jsx)(r.default,{ref:t,icon:u.SkypeIcon.More,title:m,accessibilityLabel:m,backgroundColor:null==g?void 0:g.backgroundColor,iconColor:null==g?void 0:g.iconColor,size:r.ActionButtonSize.Medium,onPress:i,disabled:C})}))},165785:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=o.__importStar(i(187140)),r=o.__importDefault(i(132680)),l=o.__importDefault(i(369347)),c=i(460515),d=o.__importStar(i(44717)),u=i(526849),h=i(512992);t.default=(0,u.WithResub)(n.memo((e=>{const t=(0,h.useActionButtonColorConfig)(!1);if(void 0===e.reactionButtonType||void 0===e.reactionCommand)return null;const i=e.callUIState===c.CallUIState.None,o=r.default.getReactionButtonDescriptors(e.reactionButtonType,e.reactionCommand);return(0,a.jsx)(s.default,{icon:o.icon,title:o.accessibilityLabel,accessibilityLabel:o.accessibilityLabel,backgroundColor:null==t?void 0:t.backgroundColor,iconColor:null==t?void 0:t.iconColor,size:s.ActionButtonSize.Medium,onPress:o.onPress,disabled:i})})),(e=>{const t=l.default.CallingFeaturesHelper.allowReactionsInCallStageMobile();let i,o;return t&&(i=r.default.getReactionButtonType(e.conversationMri,e.callId),o=r.default.getReactionCommand(i,e.callId,e,d.getReactionsThreadMriForCallId(e.callId))),Object.assign(Object.assign({},e),{isReactButtonEnabledInCallControls:t,reactionButtonType:i,reactionCommand:o})}))},312502:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;const o=i(537180);t.styles=o.StyleSheet.create({defaultContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},defaultContainerLandscape:{display:"flex",flexDirection:"column",flexGrow:1,flexShrink:0,alignItems:"center",justifyContent:"space-between"},tabletWrapper:{display:"flex",flexDirection:"row",justifyContent:"center"},tabletContainer:{width:340,flexDirection:"row",alignItems:"center",justifyContent:"space-between"},tabletWrapperLandscape:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:0,flexBasis:"100%"},tabletContainerLandscape:{height:340,flexDirection:"column",alignItems:"center",justifyContent:"space-between"}})},253413:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallConversationPanel=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=o.__importDefault(i(192478)),l=i(873324),c=i(843890),d=i(897704),u=o.__importStar(i(926101)),h=o.__importDefault(i(340724)),p=o.__importDefault(i(615364)),g=o.__importStar(i(170881)),C=o.__importStar(i(242561)),m=i(815146),S=i(560099),_=o.__importDefault(i(524526)),f=o.__importStar(i(85385)),y=i(26703),T=o.__importStar(i(704704)),b=i(106333),v=o.__importDefault(i(647780)),I=o.__importDefault(i(740794)),w=o.__importDefault(i(450312)),P=o.__importDefault(i(322094)),M=i(375258),D=o.__importDefault(i(20758)),A=i(641400),k=o.__importDefault(i(827361)),R=o.__importDefault(i(760989)),x=(0,y.lazyProperties)({base:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch",paddingBottom:20}),baseTablet:()=>n.Styles.createViewStyle({paddingBottom:0}),headerPanelStyle:()=>n.Styles.createViewStyle({paddingHorizontal:0}),centeredText:()=>n.Styles.createTextStyle({textAlign:"center"}),centeredView:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center",flex:1,flexDirection:"row"})});class L extends r.default{constructor(){super(...arguments),this._onToggleFindPanelWithOverflowConfig=e=>{const t=R.default.newCauseId();return f.log(m.LogTraceArea.FindPanel,"CallConversationPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing?(f.track(new b.MessageOverflowEvent(b.MessageOverflowAction.MessageOverflowCloseButtonClicked)),I.default.closeFindPanel(t,this._getContext())):(f.track(new b.MessageOverflowEvent(b.MessageOverflowAction.MessageOverflowOpenButtonClicked)),I.default.navigateToFindPanel(this.props.conversationId,e,this._getContext(),t)),!0},this._handleLaunchCamera=()=>{c.UICapabilities.cameraSupported()&&(g.dismissAll(),u.navigateToCaptureComboModalWithParams({capturedContentHandler:new d.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0},this._getContext()))},this._onClosePress=()=>{const e=R.default.newCauseId();f.log(m.LogTraceArea.Navigation,"CallConversationPanel._onClosePress, causeId: "+e),this.props.onClose?this.props.onClose(e):I.default.closeConversationInCall(e,this._getContext())},this._onExpandPress=()=>{f.log(m.LogTraceArea.Navigation,"Going to full screen conversation"),f.track(new l.FullChatUXTelemetryEvent(l.FullChatUXNavigation.Enter,this.props.conversationId,this.props.callId)),I.default.navigateToConversation({convId:this.props.conversationId,origin:m.NavigationConversationOrigin.Call,causeId:R.default.newCauseId()})}}_buildState(e){const t=(0,p.default)().getConversation(e.conversationId);return{otherPartyMri:t&&t.isOneOnOne()?t.getOtherPartyMri():void 0,sideBarWidth:P.default.getWidth(),isFindPanelShowing:w.default.isFindPanelShowing(this._getRootViewId()),enableFullChatUx:s.default.getS4LMessagingFeatures().enableFullChatUx,isTranslatedConversation:_.default.isConversationTranslated(e.conversationId),enableRefreshedPalette:s.default.getS4LUiFeatures().enableRefreshedPalette}}_getTitleView(){return(0,a.jsx)(n.View,{style:x.centeredView,children:(0,a.jsx)(S.HiddenText,{style:[x.centeredText,D.default.fontStyle.h5,this._themeStyles.headerTextColorStyle],children:T.getString("CallPanel.ChatTitle")})})}render(){const e=h.default.applyShouldGroupAccessibilityChildren({style:[x.base,this._themeStyles.messageStreamBackgroundColorStyle,void 0,this.state.enableRefreshedPalette?n.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1):void 0]}),t={closeButtonType:M.CloseButtonType.Close,onPress:this._onClosePress,title:T.getString("CallPanel.CloseConversation")},i=[];this.state.enableFullChatUx&&i.push({icon:A.SkypeIcon.Expand,text:T.getString("CallPanel.Expand"),onPress:this._onExpandPress});const o=this._getContext().isPresentedInDesktopRightNav?{leftButton:t,rightButtons:i,titleView:this.state.enableFullChatUx?this._getTitleView():void 0,titleTextStyle:this.state.enableFullChatUx?k.default.flexNegativeOne:void 0}:{leftButton:void 0,rightButtons:t,titleView:(0,a.jsx)(n.View,{style:k.default.flexOne})};return(0,a.jsxs)(n.View,Object.assign({},e,{children:[(0,a.jsx)(M.SimplePanelHeader,Object.assign({style:x.headerPanelStyle,hideBottomBorder:!0,useCenteredControls:!0},o)),(0,a.jsx)(v.default,{conversationId:this.props.conversationId,otherPartyMri:this.state.otherPartyMri,renderOrigin:C.MessageRenderOrigin.CallCanvas,allowUploads:!0,hasConnectedCalls:!0,availableWidth:this.state.sideBarWidth,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanelWithOverflowConfig,isFindPanelHidden:!this.state.isFindPanelShowing,isTranslatedConversation:this.state.isTranslatedConversation})]}))}}t.CallConversationPanel=L,t.default=L},974059:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(541367)),r=i(16549),l=o.__importDefault(i(933905)),c=i(44557),d=o.__importDefault(i(172609)),u=o.__importDefault(i(363091)),h=i(26703),p=o.__importStar(i(704704)),g=i(641400),C=o.__importDefault(i(970035)),m=i(815146),S=o.__importDefault(i(584307)),_=o.__importDefault(i(97595)),f=o.__importStar(i(85385)),y=o.__importDefault(i(685734)),T=i(190697),b=o.__importDefault(i(99741)),v=o.__importDefault(i(601274)),I=o.__importDefault(i(540227)),w=o.__importDefault(i(497910)),P=i(85755),M=o.__importDefault(i(615364)),D=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:40,left:0,right:0,margin:6,padding:24,borderRadius:16,maxWidth:400,minHeight:180}),headerView:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",overflow:"visible"}),joinLinkButton:()=>n.Styles.createViewStyle({marginBottom:16}),inviteButton:()=>n.Styles.createButtonStyle({alignSelf:"center",alignContent:"center",alignItems:"center",flexDirection:"row"}),inviteButtonText:()=>n.Styles.createTextStyle({color:r.Color.blue,fontSize:16,lineHeight:24}),nameInput:()=>n.Styles.createViewStyle({marginTop:10}),primaryLabel:()=>n.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:15,lineHeight:22,fontWeight:"600"}),primaryLabelGuestFlow:()=>n.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:16,lineHeight:22}),secondaryLabel:()=>n.Styles.createTextStyle({marginBottom:16,fontSize:16,lineHeight:21}),closeButton:()=>n.Styles.createTextStyle({marginTop:-8,marginRight:-6})});class A extends w.default{constructor(){super(...arguments),this._autoCloseTimeoutMs=5e3,this._isAutoCloseBlocked=!1,this._getContainerBackgroundStyles=()=>{const e=this._useDarkTheme()?r.Color.gray400overlay95:r.Color.gray50overlay95;let t;if(!this.props.isProvidingVideo){const e={backgroundColor:r.Color.whiteOverlay50,shadowColor:r.Color.blackOverlay10,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:6},i={backgroundColor:this._themeColors.secondaryBackgroundColor};t=this._useDarkTheme()?i:e}return[D.container,n.Styles.createViewStyle(Object.assign({backgroundColor:e},t))]},this._onClose=()=>(!this.state.isGuestFlow||!this.state.isUserNameRequiredErrorVisible)&&(this._trackCloseEvent(T.MeetNowSharePopupCloseActionType.Manual),this.props.onClose(),!0),this._onUserNameChange=e=>{const t=e.trim();this.setState({isUserNameRequiredErrorVisible:!t.length,guestUserName:t})},this._onInviteSkypeContactsClick=()=>{this._isAutoCloseBlocked=!0},this._inviteByEmail=()=>{if(f.log(m.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail "+c.MeetNowShareInviteCommands.DefaultMail),!this.state.joinLink)return f.log(m.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail abort, no joinLink");S.default.clickShare(c.MeetNowShareInviteCommands.DefaultMail,{joinLink:this.state.joinLink,threadId:this._threadId,rootViewId:this._getRootViewId(),meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:c.MeetNowOrigin.CreatorPanelPopup})})},this._enableAutoCloseFlow=()=>{const e=b.default.getActiveParticipants(this.props.callId,this.props.conversationMri).length>1,t=!(this._autoCloseTimer||this._isAutoCloseBlocked);e&&t&&this._startAutoCloseTimer(),this._autoCloseTimer&&this._isAutoCloseBlocked&&v.default.clearTimeout(this._autoCloseTimer)},this._startAutoCloseTimer=()=>{this._autoCloseTimer=v.default.setTimeout((()=>{this.isComponentMounted()&&(this._trackCloseEvent(T.MeetNowSharePopupCloseActionType.Auto),this.props.onClose())}),this._autoCloseTimeoutMs)},this._trackCloseEvent=e=>{const t=this._createdAt-(new Date).getTime();f.track(new T.MeetNowSharePopupCloseEvent(this.props.meetNowParameters,e,this.state.isGuestFlow,t))}}_buildState(e,t){var i;const o=u.default.getSkypeMri(),a=y.default.getDisplayableUserByMri(o),n=P.MeetNowHelpers.isGuestFlow();this._threadId=this.props.conversationMri,this._defaultGuestUserName=a.displayName;const r=null===(i=(0,M.default)().getConversation(this._threadId))||void 0===i?void 0:i.isJoinEnabled();return t&&(this._createdAt=(new Date).getTime()),n||this._enableAutoCloseFlow(),{isGuestFlow:n,showLinkCopied:!t&&this.state.showLinkCopied,guestUserName:t?this._defaultGuestUserName:this.state.guestUserName,joinLink:s.default.getLink(this._threadId),isUserNameRequiredErrorVisible:!1,isJoinEnabled:r}}componentDidMount(){super.componentDidMount(),_.default.addEscapeHandler(this._onClose)}componentWillUnmount(){super.componentWillUnmount(),_.default.removeEscapeHandler(this._onClose)}render(){return this.state.isGuestFlow?this._renderGuestPopup():this._renderPopup()}_renderCloseButton(){const e=[D.closeButton];return this._getContext().isRTL&&e.push(n.Styles.createTextStyle({marginRight:0,marginLeft:-6})),(0,a.jsx)(n.Button,{accessibilityLabel:p.getString("CallCreatorShareOverlayPopup.CloseButtonAccessibilityLabel"),style:e,onPress:this._onClose,children:(0,a.jsx)(C.default,{color:this._themeColors.primaryIconColor,size:g.IconSize.size24,icon:g.SkypeIcon.Cancel},"dismissButton")})}_renderShareInviteEmail(){const e=n.Styles.createTextStyle({textDecorationLine:"underline",alignSelf:"center",color:r.Color.blue});return(0,a.jsx)(n.Button,{accessibilityLabel:p.getString("CallCreatorShareOverlayPopup.ShareByEmailLabelAccessibilityLabel"),style:e,onPress:this._inviteByEmail,children:(0,a.jsx)(n.Text,{style:D.inviteButtonText,children:p.getString("CallCreatorShareOverlayPopup.ShareByEmailLabel")})})}_renderMeetNowJoinLinkButton(){return(0,a.jsx)(l.default,{threadId:this._threadId,joinLink:this.state.joinLink,partnerParameters:this.props.meetNowParameters,useVerboseView:!0,style:[D.joinLinkButton],useAppTheme:!0})}_renderGuestPopup(){const e=this.state.isJoinEnabled&&(0,a.jsxs)(n.View,{children:[(0,a.jsx)(n.Text,{style:[D.secondaryLabel,{color:this._themeColors.primaryTextColor}],children:p.getString("CallCreatorShareOverlayPopup.SecondaryLabel")}),this._renderMeetNowJoinLinkButton(),this._renderShareInviteEmail()]});return(0,a.jsxs)(n.View,{style:this._getContainerBackgroundStyles(),children:[(0,a.jsxs)(n.View,{style:D.headerView,children:[(0,a.jsx)(n.Text,{style:[D.primaryLabelGuestFlow,{color:this._themeColors.primaryTextColor}],children:p.getString("CallCreatorShareOverlayPopup.PrimaryLabelGuestFlow")}),this._renderCloseButton()]}),(0,a.jsx)(d.default,{threadId:this._threadId,isErrorVisible:this.state.isUserNameRequiredErrorVisible,meetNowParameters:this.props.meetNowParameters,onChangeValue:this._onUserNameChange}),e]})}_renderPopup(){return(0,a.jsxs)(n.View,{style:this._getContainerBackgroundStyles(),children:[(0,a.jsxs)(n.View,{style:D.headerView,children:[(0,a.jsx)(n.Text,{style:[D.primaryLabel,{color:this._themeColors.secondaryTextColor}],children:p.getString("CallCreatorShareOverlayPopup.PrimaryLabel")}),this._renderCloseButton()]}),(0,a.jsx)(n.Text,{style:[D.secondaryLabel,{color:this._themeColors.primaryTextColor}],children:p.getString("CallCreatorShareOverlayPopup.SecondaryLabel")}),this._renderMeetNowJoinLinkButton(),this.state.joinLink&&(0,a.jsx)(I.default,{joinLink:this.state.joinLink,conversationMri:this.props.conversationMri,meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:c.MeetNowOrigin.CreatorPanelPopup}),logSource:"CallCreatorShareOverlayPopup",onClick:this._onInviteSkypeContactsClick})]})}}t.default=A},12713:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventStreamItem=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=(o.__importStar(i(623627)),o.__importDefault(i(835697)),i(26703)),l=o.__importStar(i(634859)),c=i(16549),d=i(262725),u=i(403396),h=i(596648).UserIconSize.Size26,p=(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",left:16,right:16,paddingTop:12,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),contentContainer:()=>n.Styles.createViewStyle({flex:-1,alignItems:"stretch",alignSelf:"center",paddingLeft:5,paddingRight:10}),middleContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),middleContentInner:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-start",overflow:"visible"}),contentText:()=>n.Styles.createTextStyle({color:c.Color.black,paddingVertical:8}),contentTextLight:()=>n.Styles.createTextStyle({color:c.Color.white}),wrapper:()=>n.Styles.createViewStyle({flex:-1,paddingHorizontal:8,flexDirection:"row",minHeight:40,borderRadius:20,backgroundColor:c.Color.blackOverlay50,justifyContent:"center",alignItems:"center",overflow:"visible"}),flipSide:()=>n.Styles.createViewStyle({height:h,width:h,alignItems:"center",justifyContent:"center"}),flipContainer:()=>n.Styles.createViewStyle({height:h,width:h,overflow:"visible"}),raiseHandBorderStyle:()=>n.Styles.createViewStyle({borderColor:c.Color.raiseHandOrange,borderWidth:2})});class g extends s.ComponentBase{constructor(){super(...arguments),this._onLayoutChange=e=>{this.props.layoutController&&this.props.layoutController.setIntrinsicHeight(e.height)}}_getColorStyle(){return n.Styles.createViewStyle({backgroundColor:this.props.backgroundColor},!1)}_getUserIconElement(){if(!this.props.mri)return;const e=(0,a.jsx)(u.UserIcon,{size:h,userMri:this.props.mri,imageBorderStyleOverride:this.props.isRaiseHandEvent?p.raiseHandBorderStyle:void 0});return this.props.isLeaveEvent||this.props.isRaiseHandEvent||this.props.isTextEvent,e}componentDidMount(){super.componentDidMount(),n.Accessibility.announceForAccessibility(this.props.displayString)}render(){const e=[p.wrapper,this._getColorStyle()],t=[p.contentText];(this.props.isLeaveEvent||this.props.useLightText)&&t.push(p.contentTextLight);const i=this.props.isRaiseHandEvent?(0,a.jsx)(l.default,{type:l.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0,o=(0,a.jsxs)(n.View,{style:e,children:[this._getUserIconElement(),i,(0,a.jsx)(n.View,{style:p.contentContainer,children:(0,a.jsx)(d.BodyText,{size:d.BodyTextSize.SmallDeprecated,style:t,children:this.props.displayString})},"contentContainer")]},"contentContainerWrapper"),s=(0,a.jsx)(n.View,{style:p.middleContentInner,ignorePointerEvents:!0,children:o},"middleContentInner"),r=[p.container];return this.props.layoutController&&r.push(this.props.layoutController.getStyles()),this.props.horizontalSafeAreaInsets&&this.props.horizontalSafeAreaInsets.left>16&&r.push(n.Styles.createViewStyle({left:this.props.horizontalSafeAreaInsets.left,right:this.props.horizontalSafeAreaInsets.right},!1)),(0,a.jsx)(n.Animated.View,{style:r,ignorePointerEvents:!0,onLayout:this._onLayoutChange,children:(0,a.jsx)(n.View,{style:p.middleContainer,ignorePointerEvents:!0,children:s},"middleContent")})}}t.CallEventStreamItem=g,t.default=g},712486:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importStar(i(317588)),l=o.__importDefault(i(150343)),c=o.__importDefault(i(369347)),d=o.__importDefault(i(132680)),u=i(815146),h=o.__importStar(i(85385)),p=i(77395),g=i(26703),C=o.__importStar(i(704704)),m=i(16549),S=o.__importDefault(i(20758)),_=i(262725),f=o.__importDefault(i(497910)),y=o.__importDefault(i(760989)),T=i(403396),b=i(596648),v=(0,g.lazyProperties)({bingBackgroundsContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16,width:void 0}),bingBackgroundsIcon:()=>s.Styles.createViewStyle({width:16,height:16}),bingBackgroundsIconSmall:()=>s.Styles.createViewStyle({width:12,height:12}),bingBackgroundsIconMargin:()=>s.Styles.createViewStyle({marginRight:5}),bingBackgroundsText:()=>s.Styles.createTextStyle({backgroundColor:m.Color.transparent,textAlign:"center",textAlignVertical:"center",marginRight:5,paddingBottom:1}),bingBackgroundsFont:()=>s.Styles.createTextStyle({fontSize:S.default.fontSize.size13Deprecated,font:S.default.font.uiDisplayRegular}),bingBackgroundsFontColor:()=>s.Styles.createTextStyle({color:m.Color.white}),bingBackgroundsFontColorLight:()=>s.Styles.createTextStyle({color:m.Color.gray400}),bingBackgroundsUserIcon:()=>s.Styles.createViewStyle({marginRight:1}),plusCountContainer:()=>s.Styles.createTextStyle({height:20,minWidth:20,textAlign:"center"})});class I extends f.default{constructor(){super(...arguments),this._onBingBackgroundsPressed=()=>{const e=y.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"CallPanelHeaderV2._onBingBackgroundsPressed, causeId: "+e),this.props.onBingBackgroundsPressed&&this.props.onBingBackgroundsPressed(e)}}_buildState(e,t){const i=c.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.callId),o=l.default.getS4LCMCFeatures().bingBackgrounds;return{captions:i,bingBackgroundsUsers:this._getUserIconList(i),showIconCount:o.iconCountInHeader,compactView:d.default.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}_getUserIconList(e){const t=[];for(const i of n.values(e))""!==i.isoDate&&t.push(i.userId);return t}render(){var e;const t=null!==(e=this.props.textStyleOverride)&&void 0!==e?e:v.bingBackgroundsFont,i=this.props.useLightTheme?v.bingBackgroundsFontColorLight:v.bingBackgroundsFontColor;let o,n,l=b.UserIconSize.Size20,c=20,d=14;this.props.v1&&(l=b.UserIconSize.Size14,c=14,d=void 0,o=4,n=2);const u=s.Styles.createViewStyle({height:c,width:c}),h=s.Styles.createViewStyle({marginTop:n}),g=this.props.v1?v.bingBackgroundsIconSmall:v.bingBackgroundsIcon,m=s.Styles.createViewStyle({height:this.props.height,marginLeft:o,marginRight:d}),S=[];if(this.state.bingBackgroundsUsers&&this.state.bingBackgroundsUsers.length>0&&this.state.showIconCount&&this.state.showIconCount>0){const e=this.state.bingBackgroundsUsers.length>this.state.showIconCount?this.state.showIconCount:this.state.bingBackgroundsUsers.length;for(let t=0;t<e;t++){const e=this.state.bingBackgroundsUsers[t];S.push((0,a.jsx)(T.UserIcon,{userMri:e,size:l,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,style:[v.bingBackgroundsUserIcon,h]},"userIcon-"+t))}const o=this.state.bingBackgroundsUsers.length-this.state.showIconCount;o>0&&S.push((0,a.jsx)(_.BodyText,{style:[v.bingBackgroundsUserIcon,v.plusCountContainer,i,t,u,h],children:`+${o}`},"userIcon-hidden"))}const f=C.getString("CallControls.BingBackgrounds");let y;return this.state.compactView||(y=(0,a.jsx)(_.BodyText,{style:[v.bingBackgroundsText,t],children:f})),(0,a.jsxs)(p.HoverableButton,{style:[v.bingBackgroundsContainer,m],title:f,accessibilityLabel:f,onPress:this._onBingBackgroundsPressed,children:[(0,a.jsx)(s.Image,{source:r.Collection.BING_LOGO_SMALL,style:[g,v.bingBackgroundsIconMargin],resizeMode:"cover"}),y,S]})}}t.default=I},594688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackButton=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(919640),r=i(167606),l=o.__importStar(i(704704)),c=o.__importStar(i(85385)),d=o.__importDefault(i(760989)),u=i(512992),h=i(490815);t.BackButton=e=>{const t=(i=e.onBackButtonPress,n.useCallback((()=>{const e=d.default.newCauseId();c.log(r.LogTraceArea.CallingUI,`useBackButtonPress, causeId: ${e}`),i(e)}),[i]));var i;const{textColorPrimary:o}=(0,u.useThemeColors)();return(0,a.jsx)(s.HeaderBackButton,{style:h.styles.backButton,tintColor:o,onPress:t,accessibilityLabel:l.getString("Global.BackButtonTitle")})}},493477:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallInfo=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=i(167606),l=i(526849),c=o.__importStar(i(85385)),d=o.__importDefault(i(99741)),u=i(379465),h=i(512992),p=i(705102),g=i(490815),C=o.__importDefault(i(740794)),m=o.__importDefault(i(760989)),S=i(736267);t.CallInfo=(0,l.WithResub)((e=>{const{textColorSecondary:t}=(0,h.useThemeColors)(),i=(0,S.useCommonContext)(),o=n.useMemo((()=>[g.styles.textSecondary,{color:t}]),[t]),l=e.participantCount>0,d=e.isCallActive,f=l&&d,y=n.useCallback((()=>{const t=m.default.newCauseId();c.log(r.LogTraceArea.CallingUI,`CallInfoView onParticipantCountPress, callId ${e.callId}, causeId: ${t}`),C.default.openCallRoster(e.conversationMri,e.callId,t,i)}),[e.conversationMri,e.callId,i]);return(0,a.jsxs)(s.View,{style:g.styles.defaultContainer,children:[l?(0,a.jsx)(u.ParticipantsCount,{onPress:y,participantCount:e.participantCount,style:o}):null,f?(0,a.jsx)(_,{style:o}):null,d?(0,a.jsx)(p.CallTimer,{style:o,callId:e.callId,isCallActive:e.isCallActive}):null]})}),(e=>{var t;return{participantCount:null!==(t=d.default.getActiveParticipants(e.callId,e.conversationMri).length)&&void 0!==t?t:0,callId:e.callId,conversationMri:e.conversationMri,isCallActive:e.isCallActive}}));const _=e=>(0,a.jsx)(s.View,{style:g.styles.separator,children:(0,a.jsx)(s.Text,{style:e.style,children:"|"})})},705102:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTimer=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=o.__importDefault(i(601274)),l=o.__importDefault(i(389659)),c=o.__importDefault(i(369347));t.CallTimer=e=>{const t=((e,t)=>{var i;const[o,a]=n.useState(Date.now()),s=n.useRef(0),l=null!==(i=c.default.OngoingCallService.getCallConnectedTime(e))&&void 0!==i?i:Date.now();return n.useEffect((()=>(t&&(s.current=r.default.setInterval((()=>{a(Date.now())}),1e3)),()=>{r.default.clearInterval(s.current)})),[t]),o-l})(e.callId,e.isCallActive);return(0,a.jsx)(s.Text,{style:e.style,numberOfLines:1,accessibilityLabel:l.default.getFormattedDuration(t/1e3,!0),children:l.default.getElapsedTimeStringFromMs(t)})}},708292:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationTitle=void 0;const o=i(197582),a=i(785893),n=i(537180),s=i(167606),r=i(736267),l=o.__importDefault(i(760989)),c=i(82485),d=o.__importDefault(i(740794)),u=i(490815),h=i(512992),p=i(641400),g=i(16549),C=o.__importDefault(i(970035));t.ConversationTitle=({callId:e,conversationId:t,conversationTitle:i,canAccessConversationDetails:o,showRecordingIcon:m,isLandscape:S})=>{const{textColorPrimary:_}=(0,h.useThemeColors)(),f=(0,r.useCommonContext)(),y=[S?u.styles.textPrimaryAlt:u.styles.textPrimary,{color:_}],T=()=>{const i=l.default.newCauseId();c.Instrumentation.log(s.LogTraceArea.CallingUI,`ConversationTitle onConversationTitlePress, callId ${e}, causeId: ${i}`),d.default.showDetailsPanelWithParams({mri:t,showConversationSettings:!0,rootViewId:f.rootViewId,causeId:i})},b=m?(0,a.jsx)(n.View,{style:u.styles.titleIconView,children:(0,a.jsx)(C.default,{icon:p.SkypeIcon.CallRecord,size:p.IconSize.size16,color:g.Color.red})}):null;return o?(0,a.jsxs)(n.View,{style:u.styles.titleWrapper,children:[(0,a.jsx)(n.Pressable,{accessibilityRole:"button",onPress:T,style:u.styles.textContainer,children:(0,a.jsx)(n.Text,{numberOfLines:1,style:y,children:i})}),b]}):(0,a.jsxs)(n.View,{style:u.styles.titleWrapper,children:[(0,a.jsx)(n.View,{style:u.styles.textContainer,children:(0,a.jsx)(n.Text,{numberOfLines:1,style:y,children:i})}),b]})}},744660:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(167606),r=i(737298),l=o.__importStar(i(85385)),c=o.__importStar(i(704704)),d=o.__importDefault(i(660401)),u=i(154235),h=i(641400),p=i(16549),g=o.__importDefault(i(760989)),C=i(736267),m=o.__importDefault(i(638260)),S=o.__importDefault(i(625209)),_=i(526849);t.default=(0,_.WithResub)((e=>{const t=n.useRef(null),{rootViewId:i}=(0,C.useCommonContext)(),o=(()=>{const{themeColors:e,mode:t}=(0,C.useCommonContext)();return n.useMemo((()=>({backgroundColor:t.isAccessible?e.secondaryTextColor:p.Color.red,textColor:e.coloredBackgroundTextColor})),[e,t])})(),r=(t,i)=>{l.log(s.LogTraceArea.CallingUI,`EndCallButton.onEndCall forEveryone: ${t} causeId: ${i}`),t?e.endCallForEveryoneCommand.execute():e.endCallCommand.execute()};return(0,a.jsx)(d.default,{ref:t,title:c.getString("CallControls.CallButtonEndCall"),accessibilityLabel:c.getString("CallControls.CallButtonEndCall"),buttonSize:u.SXButtonSize.Small,minHeight:32,icon:h.SkypeIcon.CallEnd,buttonStyle:u.SXButtonStyle.ColorFill,buttonConfig:o,onPress:()=>{const t=g.default.newCauseId();m.default.trackHangUpButtonClick(e.callId,t),r(!1,t)},onLongPress:o=>{o.stopPropagation(),o.preventDefault(),e.allowEndCallForEveryone&&S.default.showEndCallMenuPopup(i,o,(()=>t.current),(e=>{S.default.selectEndCallMenuItem(e,i,r)}))}})}),(e=>{const t=t=>{l.error(s.LogTraceArea.CallingUI,`EndCallButton endCallAction failed for ${e.callId}, causeId: ${t}`)},i=new r.EndCallCommand(e.callId,void 0,t),o=new r.EndCallForEveryoneCommand(e.callId,{isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId,connectedCallId:e.connectedCallId},e.callUIState,t),a=o.canExecute();return Object.assign(Object.assign({},e),{endCallCommand:i,endCallForEveryoneCommand:o,allowEndCallForEveryone:a})}))},398212:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileCallPanelHeader=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=i(526849),l=o.__importDefault(i(601976)),c=o.__importStar(i(704704)),d=o.__importDefault(i(744660)),u=i(594688),h=i(493477),p=i(490815),g=o.__importDefault(i(859545)),C=i(708292);t.MobileCallPanelHeader=({isLandscape:e,conversationTitle:t,canAccessConversationDetails:i,callId:o,isCallActive:r,onBackButtonPress:l,conversationMri:c,isPSTNCall:g,isEncryptedCall:m,connectedCallId:S,callUIState:_,showRecordingIcon:f,style:y})=>{const T=(0,a.jsx)(C.ConversationTitle,{callId:o,conversationId:c,conversationTitle:t,canAccessConversationDetails:i,showRecordingIcon:f});return(0,a.jsx)(s.View,{style:[p.styles.defaultContainer,p.styles.headerContainer,y],children:(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)(s.View,{style:e?[p.styles.containerSideCommonLandscape,p.styles.containerLeftLandscape]:void 0,children:[(0,a.jsx)(u.BackButton,{onBackButtonPress:l}),e?T:null]}),(0,a.jsxs)(s.View,{style:e?p.styles.containerCenterLandscape:p.styles.containerCenterPortrait,children:[e?null:T,(0,a.jsx)(h.CallInfo,{callId:o,conversationMri:c,isCallActive:r})]}),(0,a.jsx)(s.View,{style:e?[p.styles.containerSideCommonLandscape,p.styles.containerRightLandscape]:void 0,children:(0,a.jsx)(d.default,{callId:o,conversationMri:c,isPSTNCall:g,isEncryptedCall:m,connectedCallId:S,callUIState:_})})]})})},t.default=(0,r.WithResub)(n.memo(t.MobileCallPanelHeader),(e=>{var t;const i=null!==(t=l.default.getDisplayName(e.conversationMri))&&void 0!==t?t:c.getString("Notifications.UnknownUserShort"),o=g.default.navigation().canAccessConversationDetails;return Object.assign(Object.assign({},e),{conversationTitle:i,canAccessConversationDetails:o})}))},379465:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantsCount=void 0;const o=i(197582),a=i(785893),n=i(537180),s=o.__importStar(i(704704));t.ParticipantsCount=e=>(0,a.jsx)(n.Text,{style:e.style,numberOfLines:1,onPress:e.onPress,accessibilityRole:e.onPress?"button":"text",accessibilityHint:e.onPress?s.getString("ContentPanelHeaderTitle.ManageGroup"):void 0,accessible:!0,children:s.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:e.participantCount})})},512992:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useActionButtonColorConfig=t.useThemeColors=void 0;const o=i(206315);t.useThemeColors=()=>{const{themeColors:e}=(0,o.useSkypeTheme)();return{textColorPrimary:e.headerTextColor,textColorSecondary:e.secondaryTextColor}};t.useActionButtonColorConfig=e=>{const{themeColors:t}=(0,o.useSkypeTheme)();if(e)return;return{iconColor:t.headerIconColor,backgroundColor:t.buttonBackgroundColor}}},882878:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileCallPanelHeader=void 0;const o=i(197582);var a=i(398212);Object.defineProperty(t,"MobileCallPanelHeader",{enumerable:!0,get:function(){return o.__importDefault(a).default}})},490815:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;const o=i(537180);t.styles=o.StyleSheet.create({defaultContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},headerContainer:{justifyContent:"space-between",paddingHorizontal:12},textContainer:{flexShrink:1},textPrimary:{lineHeight:22,fontSize:18,fontWeight:"600",letterSpacing:-.408},textPrimaryAlt:{lineHeight:20,fontSize:15,fontWeight:"400",letterSpacing:-.24},textSecondary:{fontSize:13,lineHeight:18,fontWeight:"400",letterSpacing:-.078},separator:{marginHorizontal:4},backButton:{marginHorizontal:0},titleWrapper:{flexShrink:1,flexDirection:"row"},titleIconView:{flexShrink:1,marginHorizontal:8,alignItems:"center",justifyContent:"center"},containerCenterPortrait:{marginRight:"auto",flexGrow:1,flexBasis:"50%",display:"flex",flexDirection:"column",justifyContent:"flex-start",paddingHorizontal:4},containerSideCommonLandscape:{flexGrow:1,flexShrink:1,flexBasis:"50%",alignItems:"center",flexDirection:"row"},containerLeftLandscape:{justifyContent:"flex-start",overflow:"hidden"},containerRightLandscape:{justifyContent:"flex-end"},containerCenterLandscape:{display:"flex",alignItems:"center",flexDirection:"row",flexShrink:0,flexGrow:0,paddingHorizontal:4}})},333284:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallItemLayoutController=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(516778)),s=o.__importDefault(i(974634)),r=i(460515),l=o.__importDefault(i(132680)),c=i(26703),d=i(16549),u=o.__importDefault(i(139221)),h=o.__importDefault(i(827361)),p=(0,c.lazyProperties)({elementBase:()=>n.Styles.createViewStyle({position:"absolute",overflow:"visible"}),stageElementBase:()=>n.Styles.createViewStyle({position:"relative",overflow:"visible",flexGrow:0,flexShrink:1}),stageBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:d.Color.callStageLight}),lightThemeBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:d.Color.gray50,borderColor:d.Color.gray200}),lightThemeVideoBorderStyle:()=>n.Styles.createViewStyle({backgroundColor:d.Color.gray100Overlay80})});class g{constructor(e){this._isHidden=!1,this._currentBorderRadius=r.RibbonSizes.ribbonItemSizeSmall/2,this._currentBackgroundOffset=0,this._hasPositionedView=!1,this._fullStageRect={x:0,y:0,width:0,height:0},this._currentRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._animatedHorizontalValue=new n.Animated.Value(this._currentRect.x),this._animatedVerticalValue=new n.Animated.Value(this._currentRect.y),this._animatedWidthValue=new n.Animated.Value(this._currentRect.width),this._animatedHeightValue=new n.Animated.Value(this._currentRect.height),this._animatedBorderRadiusValue=new n.Animated.Value(this._currentBorderRadius),this._animatedBackgroundValue=new n.Animated.Value(this._currentBackgroundOffset),this._rectChangedEvent=new s.default,this._isRTL=u.default.isRTL(),this._animatedStageHeightValue=new n.Animated.Value(1),this._animatedStageWidthValue=new n.Animated.Value(1),this._baseAnimatedStyle=n.Styles.createAnimatedViewStyle({width:this._animatedWidthValue,height:this._animatedHeightValue,top:this._animatedVerticalValue}),this._animatedStyleLTR=n.Styles.createAnimatedViewStyle({right:this._animatedHorizontalValue}),this._animatedStyleRTL=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue}),this._animatedInnerStyle=n.Styles.createAnimatedViewStyle({borderRadius:this._animatedBorderRadiusValue}),this._animatedStageContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedStageHeightValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]}),width:this._animatedStageWidthValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]})}),this._key=e}setHidden(e){this._isHidden!==e&&(this._isHidden=e,this._hiddenChangedCallback&&this._hiddenChangedCallback(e))}setStagePosition(e,t,i,o,a,n=!1,s){this._fullStageRect=a,this._updateAnimatedValues(t,this._borderRadius(!0,o,0),n,void 0,void 0,void 0,s),this._animatedBackgroundValue.setValue(i/e)}getStyles(e){return e?this._getStageStyles():[p.elementBase,this._baseAnimatedStyle,this._isRTL&&this._key===r.CallStageElementKeys.localUserKey?this._animatedStyleRTL:this._animatedStyleLTR]}getInnerStyles(){return[h.default.flexOne,this._animatedInnerStyle]}getBackgroundColorStyle(e){return e?p.lightThemeBackgroundStyle:p.stageBackgroundStyle}getVideoBorderColorStyle(e){return e?p.lightThemeVideoBorderStyle:p.stageBackgroundStyle}onDimensionsChanged(e){this._dimensionsChangedCallback=e}onRectChanged(e){return this._rectChangedEvent.subscribe(e)}onHiddenChanged(e){this._hiddenChangedCallback=e}isHidden(){return this._isHidden}viewRect(e){if(e){const e=l.default.translateRect(this._currentRect,this._fullStageRect.width);return Object.assign(Object.assign({},e),{x:e.x+this._fullStageRect.x,y:e.y})}return this._currentRect}_getStageStyles(){return[p.stageElementBase,this._animatedStageContainerStyle]}_borderRadius(e,t,i){return e?0:t?r.RibbonSizes.ribbonItemRectBorderRadius:i/2}_updateAnimatedValues(e,t,i,o,s,c,d){if(!a.isUndefined(this._latestViewCanAnimate)&&!this._latestViewCanAnimate)return;if(i&&this._hasPositionedView&&l.default.enableLayoutAnimation()){const i=s||r.CallStageConfig.animationDuration,a=o||n.Animated.Easing.InOut(),l=[];l.push(n.Animated.timing(this._animatedVerticalValue,{toValue:e.y,duration:i,easing:a})),l.push(n.Animated.timing(this._animatedHorizontalValue,{toValue:e.x,duration:i,easing:a})),d&&(l.push(n.Animated.timing(this._animatedStageWidthValue,{toValue:d.width,duration:i,easing:a})),l.push(n.Animated.timing(this._animatedStageHeightValue,{toValue:d.height,duration:i,easing:a}))),c||(l.push(n.Animated.timing(this._animatedWidthValue,{toValue:e.width,duration:i,easing:a})),l.push(n.Animated.timing(this._animatedHeightValue,{toValue:e.height,duration:i,easing:a})),l.push(n.Animated.timing(this._animatedBorderRadiusValue,{toValue:t,duration:i,easing:a}))),l.length&&n.Animated.parallel(l).start()}else this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),d&&(this._animatedStageWidthValue.setValue(d.width),this._animatedStageHeightValue.setValue(d.height)),c||(this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height),this._animatedBorderRadiusValue.setValue(t));!this._dimensionsChangedCallback||this._currentRect.height===e.height&&this._currentRect.width===e.width?this._currentRect.x===e.x&&this._currentRect.y===e.y||this._rectChangedEvent.fire(e):(this._dimensionsChangedCallback(e),this._rectChangedEvent.fire(e)),this._currentRect=e,this._currentBorderRadius=t,this._hasPositionedView=!0}}t.CallItemLayoutController=g,t.default=g},460072:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=o.__importStar(i(603094)),l=o.__importDefault(i(851692)),c=o.__importStar(i(788286)),d=i(154235),u=o.__importStar(i(624471)),h=o.__importDefault(i(389659)),p=o.__importDefault(i(601976)),g=o.__importDefault(i(37679)),C=o.__importStar(i(85385)),m=i(26703),S=o.__importStar(i(704704)),_=o.__importDefault(i(363091)),f=o.__importDefault(i(740794)),y=o.__importDefault(i(942724)),T=o.__importDefault(i(52066)),b=i(262725),v=o.__importDefault(i(497910)),I=o.__importDefault(i(760989)),w=(0,m.lazyProperties)({textStyle:()=>n.Styles.createTextStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:10}),textStyleSelected:()=>n.Styles.createTextStyle({justifyContent:"center",alignItems:"center"}),markerTextPadding:()=>n.Styles.createViewStyle({paddingTop:4}),container:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10}),containerComposite:()=>n.Styles.createViewStyle({marginLeft:50,marginRight:0})});class P extends v.default{constructor(){super(...arguments),this._getCallForwardingActionLink=()=>(0,a.jsx)(T.default,{style:[w.textStyle,w.markerTextPadding],onPress:this._onCallForwardingButtonPress,url:"#",blue:!0,linkTextStyle:d.LinkTextStyle.Caption,children:S.getString("CallCard.SetupCallForwardingLink")},"callForwardingCTALinkId"),this._onCallForwardingButtonPress=()=>{C.track(new u.SetUpCallForwardingClicked),f.default.navigateToCallingSettingsPanel(!1,this._getContext())}}_buildState(e,t){const i=g.default.getCreditEntitlement(),o=!!r.getPositiveCreditBalance(i)||g.default.userHasSubscriptions(),a=l.default.getCallLog(e.callId),n=c.default.calculateCallMarkerInfoFromPath(a,e.callId,e.conversationId,e.markerType,e.duration);return{isUsingStackNavigationContext:y.default.isUsingStackNavigationContext(),callerFirstName:p.default.getMemberShortNameForConversation(e.conversationId,e.callerMri),isCallerTheCurrentUser:_.default.isMyMri(e.callerMri),isPayingUser:o,enablePaidUsersCallForwardingUpsell:s.default.getS4LCommerceFeatures().creditUpsell.enablePaidUsersCallForwardingUpsell,enableAllUsersCallForwardingUpsell:s.default.getS4LCommerceFeatures().creditUpsell.enableAllUsersCallForwardingUpsell,markerType:n.type,duration:n.duration}}render(){let e,t,i,o;const s=this.state.markerType;switch(s){case c.CallMarkerType.Started:e=S.getString("CallCard.CallStartedMarker");break;case c.CallMarkerType.Missed:this.state.isCallerTheCurrentUser?e=S.getString("CallCard.MissedCallMarker"):(e=S.getString("CallCard.MissedCallFromCallerMarker",{caller:this.state.callerFirstName}),(this.state.enablePaidUsersCallForwardingUpsell&&this.state.isPayingUser||this.state.enableAllUsersCallForwardingUpsell)&&(o=this._getCallForwardingActionLink()));break;case c.CallMarkerType.Ended:e=this.props.messagesSentDuringCall?S.getString("CallCard.CallEndedMarker"):S.getString("CallCard.CallMarker"),this.state.duration&&(t=h.default.getFormattedDuration(this.state.duration,!1),i=h.default.getFormattedDuration(this.state.duration,!0));break;case c.CallMarkerType.Declined:e=S.getString("CallCard.CallDeclinedStatusMessage");break;case c.CallMarkerType.NoAnswer:e=S.getString("CallCard.CallNoAnswerStatusMessage");break;case c.CallMarkerType.Failed:e=S.getString("CallCard.CallFailedStatusMessage");break;default:I.default.switchStatementExhaustiveChecking(s)}const r=(0,a.jsx)(b.Caption,{selected:!0,style:[w.textStyleSelected,this.props.style],children:e},"callMarkerText"),l=t?S.getParts("CallCard.Marker",{markerText:r,markerValue:t}):r;let d=e;e&&i&&(d=S.getString("AccessibilityLabel.CallMarker",{markerText:e,duration:i}));const u=(0,a.jsx)(n.View,{accessibilityLabel:d,accessibilityTraits:n.Types.AccessibilityTrait.Text,children:(0,a.jsx)(b.Caption,{style:[w.textStyle,w.markerTextPadding,this.props.style],accessibilityHidden:!0,children:l})}),p=[w.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||p.push(w.containerComposite);const g=(0,a.jsx)(b.Caption,{style:[w.textStyle,this.props.style],children:h.default.getDisplayTimeString(this.props.timestamp)});return(0,a.jsxs)(n.View,{style:p,children:[g,u,o]},`callMarker-${this.props.callId}`)}}t.default=P},157579:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(537180),s=i(854646),r=i(701025),l=i(16549),c=o.__importDefault(i(827361)),d=[l.Color.gray400Overlay70,l.Color.transparent];t.default=({direction:e=s.GradientDirection.BOTTOM,hidden:t=!1,style:i})=>{const{top:o,bottom:l,left:u,right:h}=(0,r.useSafeAreaInsets)(),p=n.PixelRatio.get();if(t)return null;const g=[e===s.GradientDirection.BOTTOM?{top:-p*o}:{bottom:-p*l},{left:-p*u,right:-p*h}];return(0,a.jsx)(s.GradientView,{ignorePointerEvents:!0,style:[c.default.absoluteFill,g,i],colors:d,direction:e})}},877743:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopMinTopMargin=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importDefault(i(119557)),r=o.__importStar(i(516778)),l=i(148540),c=o.__importDefault(i(331654)),d=o.__importDefault(i(150343)),u=i(794444),h=i(737298),p=o.__importDefault(i(369347)),g=o.__importDefault(i(157579)),C=o.__importDefault(i(454647)),m=o.__importDefault(i(947878)),S=i(460515),_=o.__importDefault(i(132680)),f=o.__importDefault(i(859545)),y=o.__importStar(i(44717)),T=i(154235),b=i(410098),v=o.__importDefault(i(288547)),I=i(815146),w=o.__importDefault(i(453761)),P=o.__importStar(i(85385)),M=(o.__importDefault(i(740275)),o.__importDefault(i(583604))),D=i(26703),A=o.__importStar(i(704704)),k=o.__importDefault(i(459172)),R=o.__importDefault(i(450312)),x=i(16549),L=i(641400),B=o.__importStar(i(179582)),V=o.__importDefault(i(827361)),O=o.__importDefault(i(497910)),E=i(206197),N=o.__importDefault(i(601274)),F=o.__importDefault(i(760989));var U;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(U||(U={})),t.DesktopMinTopMargin=S.RibbonSizes.ribbonItemSizeSmall+S.RibbonSizes.ribbonItemModernStageTopMargin;const H=(0,D.lazyProperties)({callPanelHeader:()=>r.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",height:S.CallPanelHeaderHeight.mobile,overflow:"visible"}),callPanelHeaderDesktop:()=>r.Styles.createViewStyle({backgroundColor:x.Color.transparent,alignItems:"center",height:S.CallPanelHeaderHeight.window}),callPanelHeaderDesktopMin:()=>r.Styles.createViewStyle({marginTop:t.DesktopMinTopMargin,justifyContent:"center"}),leftControl:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:17,height:52,backgroundColor:x.Color.transparent}),leftControlDesktop:()=>r.Styles.createViewStyle({paddingTop:0,paddingLeft:16,paddingRight:0}),leftControlDesktopMin:()=>r.Styles.createViewStyle({position:"absolute",left:0,transform:[{translateY:-1*t.DesktopMinTopMargin}]}),recentsButton:()=>r.Styles.createViewStyle({width:L.IconSize.default,height:L.IconSize.default,borderRadius:L.IconSize.default/2,backgroundColor:x.Color.white,paddingLeft:0,marginLeft:16}),rightControls:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",paddingTop:10}),rightControlsButton:()=>r.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:52}),titleContainerInner:()=>r.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingHorizontal:20}),titleContainer:()=>r.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:x.Color.transparent,overflow:"visible",marginRight:16}),titleContainerStackNav:()=>r.Styles.createViewStyle({flex:1,height:S.CallPanelHeaderHeight.mobile}),titleContainerTablet:()=>V.default.flexOne,titleContainerDesktopMin:()=>r.Styles.createViewStyle({justifyContent:"center"}),undraggableRegion:()=>r.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>r.Styles.createViewStyle({width:64})});class j extends O.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=F.default.newCauseId();P.log(I.LogTraceArea.CallingUI,"CallPanelHeader._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=F.default.newCauseId();P.log(I.LogTraceArea.CallingUI,"CallPanelHeader._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=(e,t)=>{P.log(I.LogTraceArea.CallingUI,"CallPanelHeader._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,t)},this._onOpenRoster=()=>{const e=F.default.newCauseId();P.log(I.LogTraceArea.CallingUI,"CallPanelHeader._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,S.CallRosterOrigin.FromParticipantCount)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,(()=>this._audioOutputButton))},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();c.default.isFullScreenMode(this._getRootViewId()).then((i=>{v.default.showWithContent({menuId:v.default.menuId(),anchor:e,rootViewId:t,menuHeight:M.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(M.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems,isInFullscreenMode:i,itemColor:this.props.isUsingSkypeTheme?this._themeColors.primaryTextColor:void 0,dividerColor:this.props.isUsingSkypeTheme?this._themeColors.dividerColor:void 0}),useBlurredBackground:!this.props.isUsingSkypeTheme,colorThemeOverride:this.props.isUsingSkypeTheme?void 0:E.Theme.DelphiDark,backgroundColor:this.props.isUsingSkypeTheme?this._themeColors.primaryBackgroundColor:void 0,headerConfig:{headerType:b.HeaderType.Slim},staticContent:!0,useTransparentShim:!this.props.isUsingSkypeTheme,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>v.default.close(t,e),onMenuClosed:this._onMenuClosed},F.default.newCauseId())}))},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?S.StageMode.FocusedScreenShare:S.StageMode.Speaker,t=_.default.isInGridStageMode(this.state.stageMode)?e:S.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=m.default.getStageMode(e.callId),o=p.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),a={isPSTNCall:p.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:y.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new h.ChangeCallLayoutCommand(a,e.incomingOrOutgoingRing,i);const n=p.default.CallingStore.isProvidingVideo(e.callId),s=e.useMobileControls&&n;let r=l.CameraPosition.Unknown;if(s){const e=p.default.DeviceStore.getSelectedCamera();r=e?e.position:l.CameraPosition.Unknown}const c=d.default.getS4LCMCFeatures().enableFullScreenOnWeb,g=_.default.getAvailableMenuItems(e.callId,c,e.useMobileControls,e.conversationId),C={showCameraToggle:s,cameraPosition:r,showRecentsButton:!e.isUsingStackNavigationContext&&f.default.navigation().canAccessRecentsList,isDesktopMin:_.default.isDesktopMinCallPanelHeader(this._getRootViewId()),isGalleryShowing:R.default.isGalleryShowing(),outputRoute:p.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:u.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:o,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:d.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:p.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:g};return!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===U.Closed&&(C.recentsOpenState=U.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=N.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({recentsOpenState:U.Open}),this._isRecentsOpeUpEdgeTimeout=void 0}),300)):(C.recentsOpenState=e.isRecentsOpen?U.Open:U.Closed,this._clearIsRecentsOpenTimeout()),C}_areMoreAudioOutputsAvailable(e){if(!d.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return P.log(I.LogTraceArea.CallingUI,"CallPanelHeader.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=p.default.CallControlsStore.getAvailableAudioRoutes();P.log(I.LogTraceArea.CallingUI,`CallPanelHeader.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=n.size(t);return e&&n.includes(t,s.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(N.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.isUsingSkypeTheme?this._themeColors.primaryIconColor:x.Color.white,t=this.props.isUsingSkypeTheme?this._themeColors.iconHoverColor:x.Color.gray200,i=this._renderNavigationButton(e,t),o=this._renderTitleView(),n=this._renderFlipCameraButton(e,t),s=this._renderSpeakerButton(e,t),l=this._renderGridFocusToggleButton(e,t),c=[H.titleContainer,H.undraggableRegion];this.props.useMobileControls&&(this.props.isUsingStackNavigationContext?c.push(H.titleContainerStackNav):c.push(H.titleContainerTablet)),this.state.isDesktopMin&&c.push(H.titleContainerDesktopMin);const d=[(0,a.jsx)(r.Animated.View,{style:c,ignorePointerEvents:!0,children:o},"titleControls"),(0,a.jsxs)(r.View,{style:[H.rightControls,H.undraggableRegion],children:[l,s,n]},"rightControls")],u=[H.callPanelHeader];return this.props.isUsingStackNavigationContext||(u.push(H.callPanelHeaderDesktop),this.state.isDesktopMin&&u.push(H.callPanelHeaderDesktopMin)),(0,a.jsxs)(r.View,{style:u,ignorePointerEvents:!0,children:[this.props.hideGradient||!this.props.useMobileControls?null:(0,a.jsx)(g.default,{}),i,d]})}_renderNavigationButton(e,t){let i,o;if(!this.props.hideBackButton){const o=[H.leftControl];if(this.props.isUsingStackNavigationContext||o.push(H.leftControlDesktop),this.state.showRecentsButton){let n,s=e;this._getRootViewType()===T.RootViewType.SplitViewContent?n=A.getString("CallPanel.ShowRecentsButtonTitle"):(n=this.state.recentsOpenState===U.Open?A.getString("CallPanel.CloseRecentsButtonTitle"):A.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==U.Closed&&(o.push(H.recentsButton),s=x.Color.gray400)),i=(0,a.jsx)(w.default,{style:o,size:L.IconSize.size24,onPress:this._handleRecentsButtonPress,color:s,hoverColor:t,icon:L.SkypeIcon.Menu,title:n},"recents")}else{const n=this.props.isUsingStackNavigationContext?L.SkypeIcon.Message:B.backIcon(),s=this.props.isUsingStackNavigationContext?A.getString("CallPanel.OpenConversation"):A.getString("Global.BackButtonTitle");i=(0,a.jsx)(w.default,{style:o,size:L.IconSize.size24,onPress:this._handleBackButtonClick,color:e,hoverColor:t,icon:n,title:s},"back")}}if(this.props.isUsingStackNavigationContext||i){const e=[H.undraggableRegion];this.props.isUsingStackNavigationContext?e.push(H.backButtonSpacer):this.state.isDesktopMin&&e.push(H.leftControlDesktopMin),o=(0,a.jsx)(r.View,{style:e,children:i},"leftControl")}return o}_renderTitleView(){if(this.props.isUsingStackNavigationContext)return(0,a.jsx)(k.default,{callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,isLandscape:this.props.isLandscape,isRecording:this.props.isRecording,isRecordingToastVisible:this.props.isRecordingToastVisible,isMobileScreenShareActive:this.props.isMobileScreenShareActive,isScreenSharingToastVisible:this.props.isScreenSharingToastVisible,isUsingSkypeTheme:this.props.isUsingSkypeTheme});const e=this.state.isGalleryShowing?A.getString("CallReactionsBar.CloseGallery"):A.getString("CallReactionsBar.OpenGallery");return(0,a.jsx)(C.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:H.titleContainerInner,onGalleryPress:this.props.onGalleryPress,isDesktopMin:this.state.isDesktopMin,useLightTheme:!1,renderGalleryIfAllowed:!0,galleryButtonAccessibilityLabel:e})}_renderSpeakerButton(e,t){}_renderFlipCameraButton(e,t){if(this.props.useMobileControls&&this.state.showCameraToggle){let i;return i=this.state.cameraPosition===l.CameraPosition.Front?A.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):A.getString("CallControls.CallButtonSwitchCameraForwardLabel"),(0,a.jsx)(w.default,{style:H.rightControlsButton,size:L.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:L.SkypeIcon.SwitchCamera,title:A.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:i},"camera")}}_renderGridFocusToggleButton(e,t){if(this.state.changeCallLayoutEnabled)return(0,a.jsx)(w.default,{ref:this._onLayoutButtonRef,icon:this._getIcon(),title:this._getTitle(),size:L.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:H.rightControlsButton},"changeLayoutButton")}_getTitle(){if(this.state.newLayoutPickerEnabled)return _.default.getStageModeItemTitle(this.state.stageMode);return _.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?A.getString("CallControls.CallButtonSwitchToContentView"):A.getString("CallControls.CallButtonSwitchToSpeakerView"):A.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return _.default.getIconForStageMode(this.state.stageMode);return _.default.isInGridStageMode(this.state.stageMode)?L.SkypeIcon.GridView:L.SkypeIcon.FocusedView3}}t.default=j},563501:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(389659)),l=i(77395),c=i(262725),d=o.__importDefault(i(497910));class u extends d.default{_buildState(e){return{elapsedTimeSec:s.default.CallDurationStore.getCallDurationInSeconds(e.callId)}}_shouldRender(){return this.props.participantCountText||this.state.elapsedTimeSec||this.props.isTimerActive}render(){if(this._shouldRender()){const e=this.state.elapsedTimeSec||this.props.isTimerActive,t=this.state.elapsedTimeSec||0;let i=e?r.default.getElapsedTimeStringFromS(t):void 0,o=e?r.default.getFormattedDuration(Math.floor(t),!0):void 0;return this.props.participantCountText&&(o=this.props.participantCountText+(o?", "+o:""),i=this.props.participantCountText+(i?" | "+i:"")),(0,a.jsx)(l.HoverableView,{accessibilityLabel:o,accessibilityTraits:n.Types.AccessibilityTrait.Text,importantForAccessibility:n.Types.ImportantForAccessibility.Auto,onPress:this.props.onPress,children:(0,a.jsx)(c.Subtitle,{style:this.props.baseSubtitleStyle,accessibilityHidden:!0,numberOfLines:1,children:i})})}return null}}t.default=u},454647:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(712486)),l=o.__importDefault(i(947878)),c=o.__importDefault(i(563501)),d=o.__importDefault(i(99741)),u=i(460515),h=o.__importStar(i(44717)),p=o.__importDefault(i(601976)),g=i(815146),C=o.__importStar(i(800662)),m=o.__importDefault(i(912135)),S=i(77395),_=o.__importStar(i(85385)),f=i(26703),y=o.__importStar(i(704704)),T=i(16549),b=o.__importDefault(i(20758)),v=o.__importDefault(i(235885)),I=i(262725),w=o.__importDefault(i(497910)),P=o.__importDefault(i(760989)),M=o.__importDefault(i(150343)),D=o.__importDefault(i(487803)),A=o.__importDefault(i(859545)),k=i(641400),R=o.__importDefault(i(453761)),x=o.__importStar(i(840709)),L=T.Color.gray400,B=(0,f.lazyProperties)({headerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch"}),alignDesktopMin:()=>n.Styles.createViewStyle({justifyContent:"center"}),firstRow:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginBottom:0}),conversationNameText:()=>n.Styles.createTextStyle({flex:-1,color:T.Color.white,marginHorizontal:2}),conversationNameTextLightTheme:()=>n.Styles.createTextStyle({color:L}),divider:()=>n.Styles.createTextStyle({marginLeft:5}),timerRowContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),timerRowContainerV2:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),galleryButtonText:()=>n.Styles.createTextInputStyle({marginTop:2}),baseSubtitleStyleV1:()=>n.Styles.createTextStyle({color:T.Color.whiteOverlay50}),baseSubtitleStyleLightTheme:()=>n.Styles.createTextStyle({color:T.Color.blackOverlay60})});class V extends w.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==C.FocusEvent.CloseRightPanel||!this._galleryButton)&&(this._galleryButton.requestFocus(),!0),this._onTitlePress=()=>{if(this.props.onTitlePress){const e=P.default.newCauseId();_.log(g.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onTitlePress, causeId: "+e),this.props.onTitlePress(e,u.CallRosterOrigin.FromGroupTitle)}},this._onOpenRoster=()=>{if(this.props.onOpenRoster){const e=P.default.newCauseId();_.log(g.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onOpenRoster, causeId: "+e),this.props.onOpenRoster(e,u.CallRosterOrigin.FromParticipantCount)}},this._onGalleryPress=e=>{_.log(g.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onGalleryPress"),this.props.onGalleryPress&&this.props.onGalleryPress()},this._onGalleryButtonRef=e=>{this._galleryButton=e||void 0},this._onManageGroupPress=e=>{const t=P.default.newCauseId();_.log(g.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onManageGroupPress, causeId: "+t),this.props.onTitlePress&&this.props.onTitlePress(t,u.CallRosterOrigin.FromManageGroupButton)},this._getIconColor=e=>this.props.useLightTheme?L:e,this._onClickRecordingIcon=e=>{x.default.getCallRecordingViewShowStatus(this.props.callId)===x.RecordingViewShowStatus.Dismissed&&x.default.setCallRecordingViewShowStatus(x.RecordingViewShowStatus.TriggeredFromHeader,this.props.callId)}}_buildState(e,t){const i=M.default.getS4LCMCFeatures().bingBackgrounds,o=s.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId),a=l.default.getStageMode(e.callId);return{conversationName:p.default.getDisplayName(e.conversationMri)||y.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?d.default.getActiveParticipants(e.callId,e.conversationMri).length:0,totalParticipantCount:e.showParticipantCount?d.default.getRosterForConversation(e.conversationMri).length:0,allowCallGallery:e.renderGalleryIfAllowed&&s.default.CallingFeaturesHelper.allowCallGallery({isEncryptedCall:h.isEncryptedThread(e.conversationMri),isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),conversationMri:e.conversationMri,callId:e.callId}),allowManageGroup:M.default.getS4LCMCFeatures().enableLockMeeting&&!!e.onTitlePress&&h.isGroupConversation(e.conversationMri)&&A.default.navigation().canAccessConversationDetails,stageMode:a,allowBingBackgrounds:!e.v2&&o>0&&(a===u.StageMode.LargeGrid||a!==u.StageMode.TogetherMode&&a!==u.StageMode.FocusedScreenShare&&i.showInCallHeader),isRecording:s.default.CallingStore.isRecording(e.callId)}}componentDidMount(){super.componentDidMount(),C.register(C.FocusEvent.CloseRightPanel,this)}componentWillUnMount(){super.componentWillUnmount(),C.unregister(C.FocusEvent.CloseRightPanel,this)}render(){const e=!!this.props.onTitlePress,t=e?S.HoverableButton:n.View,i=[B.firstRow];let o;this.props.isDesktopMin&&i.push(B.alignDesktopMin),e&&(o=h.isOneOnOneConversation(this.props.conversationMri)?this.state.conversationName:y.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName}));const s=[this.props.v2?b.default.fontStyle.callHeaderTitleV2:b.default.fontStyle.messagingHeader,[B.conversationNameText,this.props.useLightTheme?B.conversationNameTextLightTheme:void 0]],l=this.state.allowManageGroup?(0,a.jsx)(D.default,{iconColorOverride:this._getIconColor(T.Color.white),hoverColor:this._getIconColor(T.Color.whiteOverlay80),onPress:this._onManageGroupPress,accessibilityLabel:y.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!!this.props.showCompactManageGroup},`manageGroupButton-${this.props.conversationMri}`):void 0,d=(0,a.jsxs)(n.View,{style:i,children:[this.state.isRecording&&this.props.enableCallRecorderUINew&&(0,a.jsx)(R.default,{onPress:this._onClickRecordingIcon,accessibilityLabel:y.getString("CallRecorderToast.HeaderRecordingIconAccessibilityLabel"),icon:k.SkypeIcon.CallRecord,color:T.Color.red,size:k.IconSize.size12}),(0,a.jsx)(t,{onPress:e?this._onTitlePress:void 0,title:o,accessibilityLabel:o,accessibilityTraits:e?n.Types.AccessibilityTrait.Button:n.Types.AccessibilityTrait.Header,tabIndex:e?void 0:-1,disableHoverOpacityStyles:!e,disableCursor:!e,children:(0,a.jsx)(n.Text,{style:s,numberOfLines:1,children:this.state.conversationName})}),l]});let u;this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(u=y.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const p=[b.default.fontStyle.callHeaderSubtitleV2,this.props.useLightTheme?B.baseSubtitleStyleLightTheme:void 0],g=this.props.v2?p:[b.default.fontStyle.subtitle,B.baseSubtitleStyleV1];let C,_=(0,a.jsx)(c.default,{callId:this.props.callId,isTimerActive:!!this.props.isCallActive&&!!this.props.isSeen,participantCountText:u,baseSubtitleStyle:g,subtitleV2:this.props.v2,onPress:this.props.onOpenRoster?this._onOpenRoster:void 0});if(this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length){const e=[g,this.props.isDesktopMin?B.alignDesktopMin:void 0];C=(0,a.jsx)(I.Subtitle,{style:e,numberOfLines:1,children:this.props.outgoingRingStatus})}const f=[this.props.containerStyle];if(this.props.maxTitleWidth&&f.push(n.Styles.createViewStyle({maxWidth:this.props.maxTitleWidth},!1)),this.props.isCallActive){const e=[g,this.props.v2?B.timerRowContainerV2:B.timerRowContainer];this.props.isDesktopMin&&e.push(B.alignDesktopMin);const t=[g,B.divider],i=this.state.allowCallGallery?[(0,a.jsx)(v.default,{style:t},`galleryDivider-${this.props.conversationMri}`),(0,a.jsx)(m.default,{ref:this._onGalleryButtonRef,textStyle:[g,B.galleryButtonText],iconColorOverride:this._getIconColor(T.Color.whiteOverlay50),onPress:this._onGalleryPress,accessibilityLabel:this.props.galleryButtonAccessibilityLabel},`galleryButton-${this.props.conversationMri}`)]:void 0,o=this.state.allowBingBackgrounds?[(0,a.jsx)(v.default,{style:t},`bing-Divider-${this.props.conversationMri}`),(0,a.jsx)(r.default,{callId:this.props.callId,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,textStyleOverride:[g,B.galleryButtonText],v1:!0,useLightTheme:this.props.useLightTheme},`bingBackgroundsButton-${this.props.conversationMri}`)]:void 0;_=(0,a.jsxs)(n.View,{style:e,children:[_,i,o]})}return(0,a.jsx)(n.View,{style:f,ignorePointerEvents:!0,onLayout:this.props.onLayout,children:(0,a.jsxs)(n.View,{style:B.headerContainer,ignorePointerEvents:!0,children:[d,C,_]})})}}t.default=V},508370:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importDefault(i(119557)),r=o.__importStar(i(516778)),l=i(148540),c=o.__importDefault(i(331654)),d=o.__importDefault(i(150343)),u=i(794444),h=i(737298),p=o.__importDefault(i(369347)),g=o.__importDefault(i(712486)),C=o.__importDefault(i(454647)),m=o.__importDefault(i(947878)),S=i(460515),_=o.__importDefault(i(132680)),f=o.__importDefault(i(859545)),y=o.__importStar(i(44717)),T=i(154235),b=i(410098),v=o.__importDefault(i(288547)),I=i(815146),w=o.__importDefault(i(453761)),P=o.__importStar(i(85385)),M=(o.__importDefault(i(740275)),o.__importDefault(i(583604))),D=i(26703),A=o.__importStar(i(704704)),k=i(16549),R=o.__importDefault(i(20758)),x=i(641400),L=o.__importStar(i(179582)),B=o.__importDefault(i(827361)),V=o.__importDefault(i(497910)),O=i(206197),E=o.__importDefault(i(601274)),N=o.__importDefault(i(6609)),F=o.__importDefault(i(760989)),U=o.__importDefault(i(848822)),H=i(596648),j=o.__importDefault(i(992435)),z=o.__importDefault(i(601976));var G;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(G||(G={}));const W=(0,D.lazyProperties)({callPanelHeaderDesktop:()=>r.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",overflow:"visible",backgroundColor:k.Color.transparent,alignItems:"center",height:S.DesktopNewHeaderHeight}),leftControlDesktop:()=>r.Styles.createViewStyle({width:x.IconSize.size28,height:x.IconSize.size28,flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:k.Color.transparent,paddingTop:0,paddingLeft:10,paddingRight:0}),recentsButton:()=>r.Styles.createViewStyle({borderRadius:x.IconSize.size28/2,backgroundColor:k.Color.white,paddingLeft:0,marginLeft:10}),rightControls:()=>r.Styles.createViewStyle({flexGrow:1,flexDirection:"row",justifyContent:"flex-end",marginRight:10}),rightControlsButton:()=>r.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:30}),conversationIcon:()=>r.Styles.createViewStyle({marginLeft:6,marginRight:4}),titleContainerInner:()=>r.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingRight:20}),titleContainer:()=>r.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:k.Color.transparent,overflow:"visible",marginRight:16}),titleContainerTablet:()=>B.default.flexOne,undraggableRegion:()=>r.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>r.Styles.createViewStyle({width:64}),bingBackgroundsFontLightTheme:()=>r.Styles.createTextStyle({color:k.Color.gray400,fontSize:R.default.fontSize.size13Deprecated,font:R.default.font.uiDisplayRegular})});class K extends V.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=F.default.newCauseId();P.log(I.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=F.default.newCauseId();P.log(I.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=()=>{const e=F.default.newCauseId();P.log(I.LogTraceArea.CallingUI,"CallPanelHeaderV2._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,S.CallRosterOrigin.FromGroupTitle)},this._onOpenRosterFromConversationIcon=()=>{const e=F.default.newCauseId();this._onOpenRoster(e,S.CallRosterOrigin.FromConversationIcon)},this._onOpenRoster=(e,t)=>{P.log(I.LogTraceArea.CallingUI,"CallPanelHeaderV2._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,t)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,(()=>this._audioOutputButton))},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();c.default.isFullScreenMode(this._getRootViewId()).then((i=>{v.default.showWithContent({menuId:v.default.menuId(),anchor:e,rootViewId:t,menuHeight:M.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(M.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems,isInFullscreenMode:i}),useBlurredBackground:!0,colorThemeOverride:O.Theme.DelphiDark,headerConfig:{headerType:b.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>v.default.close(t,e),onMenuClosed:this._onMenuClosed},F.default.newCauseId())}))},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?S.StageMode.FocusedScreenShare:S.StageMode.Speaker,t=_.default.isInGridStageMode(this.state.stageMode)?e:S.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=m.default.getStageMode(e.callId),o=p.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),a={isPSTNCall:p.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:y.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new h.ChangeCallLayoutCommand(a,e.incomingOrOutgoingRing,i);const n=p.default.CallingStore.isProvidingVideo(e.callId),s=e.useMobileControls&&n;let r=l.CameraPosition.Unknown;if(s){const e=p.default.DeviceStore.getSelectedCamera();r=e?e.position:l.CameraPosition.Unknown}const c=d.default.getS4LCMCFeatures().enableFullScreenOnWeb,g=_.default.getAvailableMenuItemsV2(e.callId,c,e.useMobileControls,e.conversationId),C={showCameraToggle:s,cameraPosition:r,showRecentsButton:f.default.navigation().canAccessRecentsList,outputRoute:p.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:u.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:o,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:d.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:p.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:g,isOneOnOneConversation:y.isOneOnOneConversation(e.conversationId),conversationName:z.default.getDisplayName(e.conversationId)||A.getString("Notifications.UnknownUserShort")};!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===G.Closed&&(C.recentsOpenState=G.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=E.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({recentsOpenState:G.Open}),this._isRecentsOpeUpEdgeTimeout=void 0}),300)):(C.recentsOpenState=e.isRecentsOpen?G.Open:G.Closed,this._clearIsRecentsOpenTimeout());const T=d.default.getS4LCMCFeatures().bingBackgrounds,b=p.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId);return C.shouldShowBingBackgrounds=b>0&&(i===S.StageMode.LargeGrid||i!==S.StageMode.TogetherMode&&i!==S.StageMode.FocusedScreenShare&&T.showInCallHeader),C}_areMoreAudioOutputsAvailable(e){if(!d.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return P.log(I.LogTraceArea.CallingUI,"CallPanelHeaderV2.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=p.default.CallControlsStore.getAvailableAudioRoutes();P.log(I.LogTraceArea.CallingUI,`CallPanelHeaderV2.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=n.size(t);return e&&n.includes(t,s.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(E.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.useLightTheme,t=e?this._themeColors.headerIconColor:k.Color.white,i=e?this._themeColors.iconHoverColor:k.Color.gray200,o=this._renderNavigationButton(t,e),n=this._renderConversationIcon(),s=this._renderTitleView(),l=this._renderLayoutButton(),c=this._renderTogetherModeBackgroundChangeButton(t),d=this._renderFlipCameraButton(t,i),u=this._renderSpeakerButton(t,i),h=this._renderGridFocusToggleButton(t,i),p=this._renderBingBackgroundsButton(),g=[W.titleContainer,W.undraggableRegion];this.props.useMobileControls&&g.push(W.titleContainerTablet);const C=[n,(0,a.jsx)(r.Animated.View,{style:g,ignorePointerEvents:!0,children:s},"titleControls"),(0,a.jsxs)(r.View,{style:[W.rightControls,W.undraggableRegion],children:[p,h,u,d,c,l]},"rightControls")];return(0,a.jsxs)(r.View,{style:W.callPanelHeaderDesktop,ignorePointerEvents:!0,children:[o,C]},"callPanelHeaderWrapper")}_renderNavigationButton(e,t){if(this.props.hideBackButton)return null;let i;const o=this._getRootViewType()===T.RootViewType.SplitViewContent,n=this.state.recentsOpenState===G.Closed,s=t?this._themeColors.iconHoverColor:o||n?k.Color.gray200:k.Color.gray300,l=[W.leftControlDesktop];if(this.state.showRecentsButton){let o,n=e,r=s;this._getRootViewType()===T.RootViewType.SplitViewContent?o=A.getString("CallPanel.ShowRecentsButtonTitle"):(o=this.state.recentsOpenState===G.Open?A.getString("CallPanel.CloseRecentsButtonTitle"):A.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==G.Closed&&(l.push(W.recentsButton),t?(l.push(this._themeStyles.primaryViewColorStyle),n=this._themeColors.primaryBackgroundColor,r=n):n=k.Color.gray400)),i=(0,a.jsx)(w.default,{style:l,size:x.IconSize.size15,onPress:this._handleRecentsButtonPress,color:n,hoverColor:r,icon:x.SkypeIcon.Menu,title:o},"recents")}else i=(0,a.jsx)(w.default,{style:l,size:x.IconSize.size15,onPress:this._handleBackButtonClick,color:e,hoverColor:s,icon:L.backIcon(),title:A.getString("Global.BackButtonTitle")},"back");const c=[W.undraggableRegion];return(0,a.jsx)(r.View,{style:c,children:i},"leftControl")}_renderConversationIcon(){const e=this.state.isOneOnOneConversation?this.state.conversationName:A.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName});return(0,a.jsx)(r.View,{style:W.conversationIcon,children:(0,a.jsx)(U.default,{conversationId:this.props.conversationId,size:H.ConversationIconSize.Size28,onPress:this._onOpenRosterFromConversationIcon,accessibilityLabel:e})},"conversationIconWrapper")}_renderTitleView(){return(0,a.jsx)(C.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:W.titleContainerInner,v2:!0,useLightTheme:this.props.useLightTheme,renderGalleryIfAllowed:!1,showCompactManageGroup:!0,enableCallRecorderUINew:this.props.enableCallRecorderUINew})}_renderLayoutButton(){return(0,a.jsx)(j.default,{availableLayoutModes:_.default.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),ref:this.props.onLayoutPickerButtonRef,callId:this.props.callId,conversationMri:this.props.conversationId,useLightTheme:this.props.useLightTheme,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,useMobileCallControls:this.props.useMobileControls,height:S.DesktopNewHeaderHeight})}_renderTogetherModeBackgroundChangeButton(e){return(0,a.jsx)(N.default,{callId:this.props.callId,conversationMri:this.props.conversationId,labelColor:e})}_renderSpeakerButton(e,t){return null}_renderFlipCameraButton(e,t){if(!this.props.useMobileControls||!this.state.showCameraToggle)return null;const i=this.state.cameraPosition===l.CameraPosition.Front?A.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):A.getString("CallControls.CallButtonSwitchCameraForwardLabel");return(0,a.jsx)(w.default,{style:W.rightControlsButton,size:x.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:x.SkypeIcon.SwitchCamera,title:A.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:i},"camera")}_renderGridFocusToggleButton(e,t){return this.state.changeCallLayoutEnabled?(0,a.jsx)(w.default,{ref:this._onLayoutButtonRef,icon:this._getIcon(),title:this._getTitle(),size:x.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:W.rightControlsButton},"changeLayoutButton"):null}_getTitle(){if(this.state.newLayoutPickerEnabled)return _.default.getStageModeItemTitle(this.state.stageMode);return _.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?A.getString("CallControls.CallButtonSwitchToContentView"):A.getString("CallControls.CallButtonSwitchToSpeakerView"):A.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return _.default.getIconForStageMode(this.state.stageMode);return _.default.isInGridStageMode(this.state.stageMode)?x.SkypeIcon.GridView:x.SkypeIcon.FocusedView3}_renderBingBackgroundsButton(){return this.state.shouldShowBingBackgrounds?(0,a.jsx)(g.default,{callId:this.props.callId,height:S.DesktopNewHeaderHeight,textStyleOverride:this.props.useLightTheme?W.bingBackgroundsFontLightTheme:void 0,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,useLightTheme:this.props.useLightTheme}):null}}t.default=K},494025:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({children:e}){return(0,o.jsx)(o.Fragment,{children:e})};const o=i(785893)},948710:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({children:e}){return(0,o.jsx)(o.Fragment,{children:e})};const o=i(785893)},823759:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=i(701025),l=o.__importStar(i(496486)),c=o.__importDefault(i(119557)),d=o.__importDefault(i(224807)),u=o.__importStar(i(331654)),h=i(149374),p=i(380157),g=o.__importStar(i(859745)),C=o.__importStar(i(516778)),m=i(398861),S=i(148540),_=i(279211),f=i(854646),y=i(815063),T=o.__importDefault(i(206483)),b=o.__importDefault(i(287659)),v=o.__importDefault(i(659938)),I=o.__importDefault(i(150343)),w=o.__importDefault(i(119914)),P=i(995042),M=i(192478),D=i(737298),A=o.__importDefault(i(74081)),k=o.__importDefault(i(290598)),R=o.__importDefault(i(974059)),x=(o.__importDefault(i(724063)),i(149950)),L=o.__importDefault(i(741338)),B=o.__importDefault(i(369347)),V=o.__importDefault(i(60433)),O=o.__importStar(i(619429)),E=o.__importDefault(i(758117)),N=o.__importDefault(i(877743)),F=o.__importDefault(i(445958)),U=o.__importDefault(i(306794)),H=o.__importDefault(i(99741)),j=o.__importDefault(i(53179)),z=o.__importDefault(i(947878)),G=i(668154),W=o.__importStar(i(873324)),K=o.__importDefault(i(638260)),$=(o.__importDefault(i(78451)),o.__importDefault(i(368427))),q=o.__importDefault(i(780676)),Q=o.__importStar(i(382880)),X=o.__importStar(i(860936)),Z=i(460515),J=o.__importStar(i(132680)),Y=o.__importDefault(i(167492)),ee=i(843890),te=o.__importDefault(i(645)),ie=i(897704),oe=o.__importStar(i(926101)),ae=o.__importStar(i(44717)),ne=o.__importDefault(i(135372)),se=i(315742),re=o.__importDefault(i(633958)),le=i(154235),ce=i(68210),de=o.__importDefault(i(615364)),ue=i(410098),he=o.__importDefault(i(288547)),pe=o.__importDefault(i(313333)),ge=o.__importStar(i(170881)),Ce=o.__importDefault(i(601976)),me=o.__importDefault(i(651843)),Se=i(815146),_e=o.__importStar(i(800662)),fe=o.__importDefault(i(970035)),ye=o.__importDefault(i(524526)),Te=o.__importDefault(i(914889)),be=o.__importDefault(i(551890)),ve=o.__importDefault(i(510130)),Ie=o.__importDefault(i(305931)),we=o.__importStar(i(85385)),Pe=o.__importDefault(i(214295)),Me=o.__importDefault(i(612285)),De=o.__importDefault(i(97595)),Ae=i(26703),ke=o.__importStar(i(704704)),Re=o.__importDefault(i(211124)),xe=i(85755),Le=i(44557),Be=o.__importDefault(i(503411)),Ve=o.__importDefault(i(842628)),Oe=o.__importDefault(i(878524)),Ee=o.__importDefault(i(788980)),Ne=i(675862),Fe=o.__importDefault(i(201721)),Ue=o.__importDefault(i(341994)),He=o.__importDefault(i(740794)),je=o.__importStar(i(812822)),ze=o.__importDefault(i(942724)),Ge=o.__importDefault(i(450312)),We=o.__importDefault(i(327400)),Ke=o.__importDefault(i(251733)),$e=o.__importDefault(i(102771)),qe=o.__importDefault(i(663627)),Qe=o.__importDefault(i(960282)),Xe=o.__importStar(i(437782)),Ze=o.__importDefault(i(117475)),Je=o.__importDefault(i(377556)),Ye=o.__importDefault(i(421334)),et=o.__importDefault(i(791384)),tt=o.__importDefault(i(393443)),it=o.__importDefault(i(848829)),ot=i(112184),at=o.__importDefault(i(391083)),nt=o.__importDefault(i(792163)),st=o.__importDefault(i(174401)),rt=o.__importDefault(i(638438)),lt=o.__importDefault(i(874599)),ct=o.__importDefault(i(293356)),dt=o.__importDefault(i(876974)),ut=o.__importDefault(i(949633)),ht=o.__importDefault(i(664821)),pt=o.__importDefault(i(655192)),gt=i(16549),Ct=o.__importDefault(i(139221)),mt=i(641400),St=i(331079),_t=o.__importDefault(i(827361)),ft=o.__importStar(i(535775)),yt=o.__importDefault(i(19973)),Tt=i(206197),bt=o.__importDefault(i(601274)),vt=o.__importDefault(i(760989)),It=o.__importDefault(i(508370)),wt=i(510054),Pt=o.__importDefault(i(916256)),Mt=o.__importDefault(i(363091)),Dt=o.__importDefault(i(859545)),At=o.__importDefault(i(27460)),kt=i(477195),Rt=i(844086),xt=i(794637),Lt=o.__importDefault(i(869622)),Bt=o.__importDefault(i(157579)),Vt=o.__importStar(i(128249)),Ot=o.__importDefault(i(938068)),Et=o.__importDefault(i(762356)),Nt=i(882878),Ft=o.__importDefault(i(878575)),Ut=(o.__importDefault(i(503332)),o.__importDefault(i(395527))),Ht=i(717583),jt=o.__importDefault(i(991244)),zt=o.__importDefault(i(583604)),Gt=i(443789),Wt=o.__importStar(i(840709)),Kt=i(450989),$t=o.__importDefault(i(494025)),qt=o.__importDefault(i(948710)),Qt=o.__importDefault(i(165248)),Xt=390,Zt="callToast",Jt={x:0,y:0,width:0,height:0},Yt=(0,Ae.lazyProperties)({callPanel:()=>C.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch"}),callPanelBackgroundDark:()=>C.Styles.createViewStyle({backgroundColor:gt.Color.callStageDark}),callPanelBackgroundLight:()=>C.Styles.createViewStyle({backgroundColor:gt.Color.gray200Overlay20}),headerContainer:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:120,overflow:"visible"}),headerContainerV2:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:Z.DesktopNewHeaderHeight,overflow:"visible"}),buttonsContainer:()=>C.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,overflow:"visible"}),mobileButtonsContainer:()=>C.Styles.createViewStyle({paddingBottom:20}),buttonsWithNotificationContainer:()=>C.Styles.createViewStyle({bottom:Z.AudioNotificationOffset}),modernStageButtonsContainer:()=>C.Styles.createViewStyle({height:Z.DesktopCallControlsHeight,backgroundColor:gt.Color.callStageDark,justifyContent:"flex-end"}),lightThemeButtonsContainer:()=>C.Styles.createViewStyle({backgroundColor:gt.Color.transparent}),callingAnimationContainer:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),fullScreenView:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:gt.Color.transparent,overflow:"visible"}),innerViewBase:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,backgroundColor:gt.Color.transparent,overflow:"visible"}),mobileInnerViewBase:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:gt.Color.transparent,overflow:"visible"}),reactionsBar:()=>C.Styles.createViewStyle({overflow:"visible",position:"absolute",left:0,right:0,bottom:0,backgroundColor:gt.Color.transparent,height:360,alignItems:"stretch"}),reactionsBarCompositeInner:()=>C.Styles.createViewStyle({overflow:"visible",minHeight:360,backgroundColor:gt.Color.transparent}),dialpadContainer:()=>C.Styles.createViewStyle({position:"absolute",right:0,bottom:0,left:0,top:0,alignItems:"center",justifyContent:"center",backgroundColor:gt.Color.transparent}),dialpadInnerContainer:()=>C.Styles.createViewStyle({position:"absolute",bottom:0,alignItems:"stretch",justifyContent:"center",backgroundColor:gt.Color.gray400}),dialpadShim:()=>C.Styles.createViewStyle({backgroundColor:gt.Color.blackOverlay50}),topBanner:()=>C.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:150}),skypeLogo:()=>C.Styles.createViewStyle({position:"absolute",left:20,bottom:20,opacity:.2}),skypeLogoV2:()=>C.Styles.createViewStyle({bottom:Z.AudioNotificationOffset+Z.DesktopCallControlsHeight+10}),hiddenControls:()=>C.Styles.createViewStyle({opacity:0}),callControlsContainerNewStage:()=>C.Styles.createViewStyle({paddingHorizontal:8})}),ei=s.StyleSheet.create({safeAreaContainer:{position:"absolute",top:0,bottom:0,left:0,right:0},safeAreaContentWrapper:{height:"100%",width:"100%",overflow:"visible"}});class ti extends M.BaseNavigationView{constructor(){super(...arguments),this._orientationLockKey=l.uniqueId("CallPanel:"),this._hasConnected=!1,this._coachMarkContext={coachMarkArea:se.CoachMarkAreaType.CallPanel},this._callReactionsDisplayHelper=new Ut.default,this._reactionsBarHeight=90,this._subscriptions=[],this._endCallNavigationRequested=!1,this._shouldDelayCameraToggle=!0,this._callSnapshotSound=tt.default.SkypeCameraCapture,this._callHeaderAnimatedOpacityValue=new C.Animated.Value(1),this._callHeaderAnimatedTranslateYValue=new C.Animated.Value(0),this._callHeaderAnimatedStyle=C.Styles.createAnimatedViewStyle({opacity:this._callHeaderAnimatedOpacityValue,transform:[{translateY:this._callHeaderAnimatedTranslateYValue}]}),this._callControlsAnimatedTranslateYValue=new C.Animated.Value(-10),this._callControlsAnimatedTranslateYStyle=C.Styles.createAnimatedViewStyle({transform:[{translateY:this._callControlsAnimatedTranslateYValue}]}),this._callControlsAnimatedOpacityValue=new C.Animated.Value(1),this._callControlsOpacityAnimatedStyle=C.Styles.createAnimatedViewStyle({opacity:this._callControlsAnimatedOpacityValue}),this._callStageOverlayOpacityValue=new C.Animated.Value(1),this._callParticipantTooltipOpacityValue=new C.Animated.Value(1),this._callParticipantNameTooltipStyle=C.Styles.createAnimatedViewStyle({opacity:this._callParticipantTooltipOpacityValue}),this._callParticipantAccessoryOpacityValue=new C.Animated.Value(1),this._newCompositeReactionsAnimatedOpacityValue=new C.Animated.Value(1),this._newCompositeReactionsAnimatedOpacityStyle=C.Styles.createAnimatedViewStyle({opacity:this._newCompositeReactionsAnimatedOpacityValue}),this._reactionsPanelAnimatedBottomValue=new C.Animated.Value(90),this._reactionsPanelAnimatedBottomValueVisitor=new C.Animated.Value(90-Kt.CallControlsHeight),this._reactionsPanelAnimatedBottomStyle=C.Styles.createAnimatedViewStyle({bottom:this._reactionsPanelAnimatedBottomValue}),this._reactionsPanelAnimatedBottomStyleVisitor=C.Styles.createAnimatedViewStyle({bottom:this._reactionsPanelAnimatedBottomValueVisitor}),this._dialpadAnimatedOpacityValue=new C.Animated.Value(0),this._dialpadAnimatedOpacityStyle=C.Styles.createAnimatedViewStyle({opacity:this._dialpadAnimatedOpacityValue}),this._dialpadAnimatedTransformValue=new C.Animated.Value(Xt),this._dialpadAnimatedTransformStyle=C.Styles.createAnimatedViewStyle({transform:[{translateY:this._dialpadAnimatedTransformValue}]}),this._topBannerAnimatedOpacityValue=new C.Animated.Value(0),this._leftNoneStateOnce=!1,this._isInteractingWithCallControls=!1,this._hasShownNoMicrophoneConnectedToast=!1,this._hasShownNoSpeakerConnectedToast=!1,this._deviceErrorToasts={},this._hasShownCameraDeniedToast=!1,this._hasShownTeamsInteropBanner=!1,this._hasShownTogetherModeNoticeBannerForCallId=!1,this._KEY_METHOD_MAP={ZStack:null,Column:null,LayoutAnimationContainer:null,StageAnimationContainer:null,ControlsAnimationContainer:null,AloneInTheCallInformation:this._renderOptionalAloneInTheCallInformationView,AudioNotifications:this._renderAudioNotification,CallControls:this._renderCallControls,CallingAnimation:this._renderCallingAnimation,CallPanelHeader:this._renderCallPanelHeader,CallPanelHeaderFlex:this._renderCallPanelHeaderFlex,CallStage:this._renderCallStage,Dialpad:this._renderDialpad,InCallPstnTranslatorButton:this._renderFooterPstnTranslatorButton,FlexCallControls:this._intRenderCallControls,LocalParticipantView:this._renderLocalParticipantView,LocalParticipantGestureView:this._renderLocalParticipantGestureView,MobileTopBanner:this._renderMobileTopBanner,OptionalNetworkInCallWarning:this._renderOptionalNetworkInCallWarning,ReactionsPanel:this._renderReactionsPanel,TranscriptionView:this._renderTranscriptionViewMobileCallPanel,TranscriptionNotifications:this._renderTranscriptionNotificationsMobileCallPanel,TransientView:this._renderTransientView,Tray:this._renderTray},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onKeyUp=e=>{const t=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onKeyUp causeId:"+t),this._showOrHideControls(!0,t),!1},this._onEscape=()=>this._toggleFullScreenMode(!1),this._toggleFullScreenMode=e=>!!this.state.showFullScreenOptionInRibbonSettings&&(u.default.isFullScreenMode(this._getRootViewId()).then((t=>{const i=void 0!==e?e:!t;i!==t?i?u.default.tryEnterFullScreenMode(this._getRootViewId()).then((e=>{e?(we.track(new W.RibbonSettingsMenuActionEvent(W.RibbonSettingsMenuActions.EnterFullScreen)),K.default.trackCallViewMenuActions(W.CallViewMenuActions.EnterFullScreen)):we.error(Se.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to enter full screen mode")})):u.default.exitFullScreenMode(this._getRootViewId()).catch((e=>{we.error(Se.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to exit full screen mode")})):we.log(Se.LogTraceArea.CallingUI,"_toggleFullScreenMode to "+i+" abort, fullScreenMode is already",t)})),!0),this._closeCameraDeniedToast=()=>{this._hasShownCameraDeniedToast=!0,this.setState({hideCameraDeniedToast:!0})},this._onPstnTranslationNoticeDismiss=()=>{this.setState({pstnTranslationBannerBeenDismissed:!0})},this._onPstnParticipantRingNoticeDismiss=()=>{this.setState({pstnParticipantRingBeenDismissed:!0})},this._closeTeamsInteropToast=()=>{this._hasShownTeamsInteropBanner=!0,this.setState({hideTeamsInteropToast:!0})},this._closeVideoRestrictedToast=()=>{this.setState({hideVideoRestrictedToast:!0})},this._closeTogetherModeNoticeToast=()=>{this._hasShownTogetherModeNoticeBannerForCallId=!0,this.setState({hideTogetherModeNoticeToastForCallId:this.props.route.params.callId}),Fe.default.setTogetherModeNoticePresentedForCallId(this.props.route.params.callId)},this._updateServerMutedState=e=>{if(e.callId===this.props.route.params.callId){if(this.isComponentMounted()&&e.serverMuted)if(we.log(Se.LogTraceArea.CallingUI,"_updateServerMutedState: Received serverMuted event for call ID "+e.callId+" causeId: "+e.causeId),ti._useMobileControls(this.state.controlsType))this.setState({showServerMutedToastOnMobile:!0}),bt.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})}),J.ServerMutedToastTimeout);else{const t=Z.DeviceStatusToastType.MicrophoneServerMuted;this._showDeviceErrorToast(t,e.causeId)}}else we.warn(Se.LogTraceArea.CallingUI,"_updateServerMutedState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._updateDeviceQualityState=e=>{if(e.callId===this.props.route.params.callId){if(we.log(Se.LogTraceArea.CallingUI,"_updateDeviceQualityState device: "+e.eventType+" state: "+O.CallDeviceState[e.deviceState]+" causeId: "+e.causeId),this.isComponentMounted()){if(e.eventType===O.CallDeviceQualityEventType.AudioDeviceMuted&&e.deviceState===O.CallDeviceState.NotWorking)return void this._showMicrophoneMutedPill();if(this.state.enableRedesignedDeviceQualityBanners)return;const t=J.default.getErrorToastType(e.eventType),i=[];switch(t){case Z.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:case Z.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:i.push({labelKey:"NotificationsPrompt.ButtonLabel",callback:()=>{J.default.toggleVoiceIsolation(!1,I.default.getS4LCMCFeaturesNoSubscription().enableForceGlobalVoiceIsolationSetting,e.callId),this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS),this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS)}})}t&&(e.deviceState===O.CallDeviceState.NotWorking?this._showDeviceErrorToast(t,e.causeId,void 0,i):e.deviceState===O.CallDeviceState.Working&&(V.default.isEventTypeTriggeringMuteAction(e.eventType)||this._hideDeviceErrorToastOfType(t)))}}else we.warn(Se.LogTraceArea.CallingUI,"_updateDeviceQualityState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._showMicrophoneMutedPill=()=>{(B.default.CallingStore.isMutedNoSubscription(this.props.route.params.callId)||B.default.CallingStore.isServerMuted(this.props.route.params.callId))&&(this.setState({isMicrophoneMutedWhileSpeaking:!0}),l.isUndefined(this._microphoneMutedTimeout)||bt.default.clearTimeout(this._microphoneMutedTimeout),this._microphoneMutedTimeout=bt.default.setTimeout((()=>{this._microphoneMutedTimeout=void 0,this.isComponentMounted()&&this.setState({isMicrophoneMutedWhileSpeaking:!1})}),5e3))},this._updateDeviceNearEndQuality=(e,t,i)=>{e===this.props.route.params.callId?(t===S.QualityLevel.Bad&&B.default.CallingStore.isSharingSound(e)?this._showDeviceErrorToast(Z.DeviceStatusToastType.SoundSharingStopped,i):t===S.QualityLevel.Good&&this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.SoundSharingStopped),we.log(Se.LogTraceArea.CallingUI,"_updateDeviceNearEndQuality level: "+t+" causeId: "+i)):we.warn(Se.LogTraceArea.CallingUI,"_updateDeviceNearEndQualityState: Received event for unexpected call ID "+e+" causeId: "+i)},this._selectedDevicesChanged=(e,t,i)=>{this._devicesChanged(e,t,!0,i)},this._availableDevicesChanged=(e,t)=>{this._devicesChanged(e,!1,!1,t)},this._onVideoEffectsQualityChangedEvent=(e,t,i)=>{this._showDeviceErrorToast(Z.DeviceStatusToastType.VideoEffectsQualityChange,i,{deviceName:e})},this._devicesChanged=(e,t,i,o)=>{t||(this._showDeviceChangeToast(e,i,o),we.log(Se.LogTraceArea.CallingUI,"_devicesChanged selected "+i+":"+Xe.trustMeThisJsonIsSafe(e)+" causeId: "+o))},this._navigateToChatNotBack=e=>{we.log(Se.LogTraceArea.CallingUI,"_navigateToChatNotBack, causeId: "+e),this._navigateToChat(!1,!0,e)},this._toggleChatPanel=e=>{we.log(Se.LogTraceArea.CallingUI,"_toggleChatPanel causeId: "+e);const t=!this.state.isChatOpen;t&&Ct.default.isEdgeShoreline()&&He.default.navigateToConversation({convId:this.state.conversationMri,causeId:e,origin:Se.NavigationConversationOrigin.Call});const i=()=>{He.default.closeConversationInCall(e,this._getContext())};t?(()=>{K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.chatOpened())),this._onNavigatedAwayFromCall(e),He.default.openConversationInCall(e,this.state.conversationMri,this.props.route.params.callId,this._getContext(),this._toggleChatPanel),this.state.isGalleryPanelOpen?et.default.maybeAnnounceForAccessibility(ke.getString("AccessibilityLabel.GalleryClosed")):B.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&et.default.maybeAnnounceForAccessibility(ke.getString("AccessibilityLabel.SubtitlesClosed"))})():this._closeRightPanel(i,e)},this._toggleGalleryPanel=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_toggleGalleryPanel causeId: "+e),this._intToggleGalleryPanel(e)},this._intToggleGalleryPanel=e=>{we.log(Se.LogTraceArea.CallingUI,"_intToggleGalleryPanel causeId: "+e),this.state.isGalleryPanelOpen?(this._closeRightPanel((()=>He.default.closeGalleryPanel(e,this._getContext())),e),et.default.maybeAnnounceForAccessibility(ke.getString("AccessibilityLabel.GalleryClosed"))):(this.state.isChatOpen?et.default.maybeAnnounceForAccessibility(ke.getString("AccessibilityLabel.ChatClosed")):B.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&et.default.maybeAnnounceForAccessibility(ke.getString("AccessibilityLabel.SubtitlesClosed")),K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.galleryOpened())),this._onNavigatedAwayFromCall(e),this._showOrHideControls(!1,e),He.default.navigateToGallery(this.state.conversationMri,je.GalleryViewMode.All,this._getContext(),this.props.route.params.callId,this.state.conversationMri,this._intToggleGalleryPanel),et.default.maybeAnnounceForAccessibility(ke.getString("AccessibilityLabel.GalleryOpened")))},this._showReactionsDrawerOnHover=()=>{this._reactionsBar&&this._reactionsBar.toggleReactionsPickerHovered()},this._showOrHideReactionsDrawer=e=>{e=l.isUndefined(e)?this._reactionsBar&&!this._reactionsBar.isDrawerOpen():e;const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_showOrHideReactionsDrawer show: "+e+" causeId: "+t),e?this._reactionsBar&&this._reactionsBar.openReactionsDrawer(t):this._reactionsBar&&this._reactionsBar.close(),this._callControls&&this._callControls.toggleReactionsPickerButton(!!e,!0)},this._onAppStateChange=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onAppStateChange, causeId: "+e),this._updateAudioState(e);const t=C.App.getActivationState();t===C.Types.AppActivationState.Background?K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.backgroundAppInCall())):t===C.Types.AppActivationState.Active&&this._showOrHideControls(!0,e)},this._callParticipantActionsMenuOpened=()=>{if(this.isComponentMounted()){const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuOpened causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!0}),this._clearHideControlsTimer()}},this._callParticipantActionsMenuClosed=()=>{if(this.isComponentMounted()){const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuClosed causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!1}),this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onHideRecordingToast=()=>{this.setState({isRecordingToastVisible:!1}),this._onRecordingBannerHeightChanged(0)},this._onHideScreenSharingToast=()=>{this.setState({isScreenSharingToastVisible:!1}),this._onMobileScreenShareBannerHeightChanged(0)},this._onInCallWarningViewRef=e=>{this._inCallWarningView=e||void 0},this._onAudioNotificationViewRef=e=>{this._audioNotificationView=e||void 0},this._onShowHideDisableOutgoingVideoToast=(e,t)=>{e?(we.log(Se.LogTraceArea.CallingUI,`CallPanel._onShowHideDisableOutgoingVideoToast: show causeId ${t}`),this._showDeviceErrorToast(Z.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing,t)):(we.log(Se.LogTraceArea.CallingUI,`CallPanel._onShowHideDisableOutgoingVideoToast: hide causeId ${t}`),this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing))},this._renderSkypeLogo=()=>{const e=[Yt.skypeLogo,Yt.skypeLogoV2];this.state.userCaptionsLeftViewWidth&&this.state.userCaptionsLeftViewWidth>0&&e.push(C.Styles.createViewStyle({left:this.state.userCaptionsLeftViewWidth+20},!1));const t=this._isLightTheme()?gt.Color.gray300:gt.Color.white;return(0,a.jsx)(fe.default,{icon:mt.SkypeIcon.SkypeIcon,size:mt.IconSize.size48,color:t,style:e},"skypeLogo")},this._onLocalUnmute=()=>{this.isComponentMounted()&&ti._useMobileControls(this.state.controlsType)&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})},this._onReactionsDrawerOpen=e=>{const t=vt.default.newCauseId();if(we.log(Se.LogTraceArea.CallingUI,"_onReactionsDrawerOpen open: "+e+" causeId: "+t),!this.isComponentMounted())return;if(ti._useMobileControls(this.state.controlsType)){const i=e&&this.state.isUsingStackNavigationContext,o=i!==this.state.hideCallControlsForActivity?{hideCallControlsForActivity:i}:void 0;this._showOrHideControls(!1,t,o)}else this._inCallWarningView&&this._inCallWarningView.showOrHideWarningView(!e),this._callControls&&this._callControls.toggleReactionsPickerButton(e,!0)},this._onEndCallFailure=e=>{this._exitCall(!0,!1,e)},this._onCallTitleLayout=e=>{this.isComponentMounted()&&e.width!==this.state.titleWidth&&this.setState({titleWidth:e.width})},this._onHeaderBackButtonPressed=e=>{we.log(Se.LogTraceArea.CallingUI,`_onHeaderBackButtonPressed causedId: ${e}`),this._navigateToChat(this._isIncomingOrOutgoingRing(),!1,e)},this._onMobileBackButtonPressed=e=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._onMobileBackButtonPressed causeId: "+e),K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.chatOpened())),this._exitCall(this._isIncomingOrOutgoingRing(),!1,e)},this._onOpenChatButtonPressed=e=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._onOpenChatButtonPressed causeId: "+e),K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.chatOpened())),this._exitCall(!1,!1,e)},this._onRecentsButtonPressed=e=>{if(we.log(Se.LogTraceArea.CallingUI,"_onRecentsButtonPressed causeId: "+e),this.state.isSplitNavCollapsed&&this._getRootViewType()!==le.RootViewType.SplitViewContent)He.default.mainStageContextPopToRoot(!1,e);else{const t=this.state.isRecentsOpen,i=()=>{const i=He.default.toggleRecentsInCall(!t,e,this._getContext());return K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>t?e.navBarClosed():e.navBarOpened())),{willToggle:i.willToggle,completeAction:()=>{i.completeAction(),!t&&i.willToggle&&(_e.setFocusWithDelay(_e.FocusEvent.OpenCallSideBar,100),_e.setFocusWithDelay(_e.FocusEvent.Recent,100))}}};this._toggleLeftPanelForAction(i,!t,e)}},this._onShowOrHideProfile=e=>{this.isComponentMounted()&&He.default.showDetailsPanelWithParams({mri:this.state.conversationMri,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onShowParticipants=(e,t,i)=>{this._onShowOrHideRoster(e,t,i)},this._onShowOrHideRoster=(e,t,i)=>{if(!this._isIncomingOrOutgoingRing()&&this.state.rosterAvailble&&this.isComponentMounted()){const{callId:o}=this.props.route.params;we.log(Se.LogTraceArea.CallingUI,`CallPanel._onShowOrHideRoster, callId ${o}, causeId: ${e}`),He.default.openCallRoster(this.state.conversationMri,o,e,this._getContext()),yt.default.createSession(o,t||Z.CallRosterOrigin.FromGroupTitle,!!i),K.default.updateCallTelemetry(o,e,(e=>e.callRosterOpenedCount()))}},this._toggleMobileOverflowMenu=(e,t,i=!0)=>{const o=vt.default.newCauseId();if(we.log(Se.LogTraceArea.CallingUI,`_toggleMobileOverflowMenu causeId: ${o}`),e){const n={callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,callerContext:()=>this._getContext(),callUIState:this.state.callUIState,onChatButtonPress:this._onOpenChatButtonPressed,onChangeViewButtonPress:this._showMobileChangeViewMenu},s=t?void 0:Tt.Theme.DelphiDark,r=(0,a.jsx)(A.default,Object.assign({colorThemeOverride:s},n)),l=this._getRootViewId(),c=A.default.menuHeight(n);if(he.default.showWithContent({menuId:he.default.menuId(),anchor:e,rootViewId:this._getRootViewId(),menuHeight:c,content:r,useBlurredBackground:!t,colorThemeOverride:s,backgroundColor:t?this._getContext().themeColors.primaryBackgroundColor:void 0,headerConfig:{headerType:ue.HeaderType.Slim},staticContent:!0,useTransparentShim:!t,hidePopupArrow:!0,useDesktopPopup:!this.state.isUsingStackNavigationContext&&!this.state.isMobileScreenReaderEnabled&&!this.state.enableExperimentalCallControls,getTitle:()=>{},onCloseMenu:e=>{we.log(Se.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),he.default.close(l,e)}},o),i){const e=!this.state.isUsingStackNavigationContext;this._showOrHideControls(e,o)}ge.dismissAll()}},this._showMobileChangeViewMenu=()=>{const e=vt.default.newCauseId(),t=()=>{},i=this._getRootViewId(),o=this.props.route.params.callId,n=this.state.conversationMri,s=this._getContext().themeColors;he.default.closeIfNeeded(i,e),bt.default.setTimeout((()=>{const r=J.default.getAvailableMenuItems(o,!1,!0,n),l=(0,a.jsx)(zt.default,{anchor:t,availableItems:r,callId:o,rootViewId:i,conversationMri:n,useMobileControls:!0,itemColor:s.primaryTextColor,dividerColor:s.dividerColor}),c={menuId:he.default.menuId(),anchor:t,rootViewId:i,menuHeight:zt.default.getLayoutPickerHeight(r),content:l,headerConfig:{headerType:ue.HeaderType.Slim},staticContent:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>he.default.close(i,e)};he.default.showWithContent(c,e)}),400)},this._onAddToCallKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onAddToCallKeyboardShortcut causeId: "+i),this._onAddToCallPressed(i,Se.NavigationAddToCallOrigin.KeyboardShortcut),!0},this._onAddToCallPressed=(e,t)=>{we.log(Se.LogTraceArea.CallingUI,"_onAddToCallPressed causeId: "+e),this._onNavigatedAwayFromCall(e),He.default.openAddToCall(this.state.conversationMri,this.props.route.params.callId,t,this._getContext(),e),yt.default.updateCallRosterTelemetry(this.props.route.params.callId,e,(e=>e.callRosterAddToCall()))},this._onBingBackgroundsPressed=e=>{we.log(Se.LogTraceArea.CallingUI,"_onBingBackgroundsPressed causeId: "+e),this._onNavigatedAwayFromCall(e),He.default.openBingBackgroundsOverview(this.props.route.params.callId,this._getContext())},this._onOpenDialpad=()=>{const e=vt.default.newCauseId();if(we.log(Se.LogTraceArea.CallingUI,`CallPanel._onOpenDialpad causeId: ${e}`),!this.state.enableDialpadOnPSTNSubtitlesCalls&&B.default.CallingStore.isTranslating(this.props.route.params.callId))return K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.displayedDtmfWarning())),void T.default.showOKAlert(ke.getString("CallPanel.DialpadUnavailableTitle"),ke.getString("CallPanel.DialpadUnavailableMessage"),this._getRootViewId());this._onShowOrHideDialpad(!0,e)},this._onCloseDialpad=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,`CallPanel._onCloseDialpad causeId: ${e}`),this._onShowOrHideDialpad(!1,e)},this._onShowOrHideDialpad=(e,t)=>{e!==this.state.showDialpad&&(e?(K.default.updateCallTelemetry(this.props.route.params.callId,t,(e=>e.accessedDialpad())),this.setState({showDialpad:!0})):this._animateDialpad(!1,t,(()=>{this.isComponentMounted()&&this.setState({showDialpad:!1})})))},this._onLayoutChange=e=>{this.setState({panelLayout:{x:e.x,y:e.y,width:e.width,height:e.height},callStageMobileLayoutWithCaptions:this.state.enableExperimentalCallControls?this._callStageMobileLayoutWithCaptions(e):Jt})},this._onToggleLocalVideoSource=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onToggleLocalVideoSource causeId: "+e),this._startHideControlsTimer(!0,0,e),this._shouldDelayCameraToggle?bt.default.setTimeout((()=>{this.isComponentMounted()&&this._updateVideoSource()}),500):this._updateVideoSource()},this._updateVideoSource=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_updateVideoSource causeId: "+e);const t=this.state.selectedCamera&&this.state.selectedCamera.position,i=this.state.selectedCamera&&this.state.selectedCamera.id,o=l.find(this.state.cameras,(e=>e.id!==i&&e.position!==t)),a=o&&o.id,n=o&&o.position;B.default.DeviceStore.choosePreferredDevices({camera:a},e),we.log(Se.LogTraceArea.CallingUI,"_updateVideoSource "+i+" position "+t+" -> "+a+" position "+n+" causeId: "+e),K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.toggleCamera()))},this._onMouseMove=()=>{if(!y.BrowserEnvironment.isMobile()&&(this.state.callUIState===Z.CallUIState.Default||this.state.callUIState===Z.CallUIState.Voicemail)){const e=vt.default.newCauseId();this.state.buttonsAndInfoHidden?this._showOrHideControls(!0,e):this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onStageTapped=e=>{const t=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onStageTapped causeId: "+t),this.state.isGalleryPanelOpen&&this._intToggleGalleryPanel(t),this.state.enableReactionBarWithEditButtonByClickingStage&&this._showOrHideReactionsDrawer(!1),!(this.state.callUIState!==Z.CallUIState.Default&&this.state.callUIState!==Z.CallUIState.Voicemail||this._shouldKeepControlsVisible())&&(this.state.enableVisitor?this._showOrHideControlsDebounced(this.state.buttonsAndInfoHidden,t,void 0,!1,e):this._showOrHideControls(this.state.buttonsAndInfoHidden,t,void 0,!1,e),!0)},this._onCallControls=e=>{this._callControls=e||void 0},this._onCallControlsInteracting=e=>{const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onCallControlsInteracting causeId: "+t),this._isInteractingWithCallControls=e,this._isInteractingWithCallControls?this._clearHideControlsTimer():this._startHideControlsTimer(!0,this._callControlTimeoutMs,t)},this._showOrHideControlsDebounced=l.debounce(this._showOrHideControls,500,{leading:!0,trailing:!1}),this._onReactionsBarDesiredHeight=e=>{this._reactionsBarHeight=e;const t=this.state&&ti._useMobileControls(this.state.controlsType)?this._callControlsVisualHeight():this._reactionsBarHeight;this._reactionsPanelAnimatedBottomValue.setValue(t),this._reactionsPanelAnimatedBottomValueVisitor.setValue(t)},this._onToggleVideo=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onToggleVideo causeId: "+e),B.default.CallControlsStore.toggleVideo(this.props.route.params.callId,e),this._startHideControlsTimer(!0,this._callControlExtraShortTimeoutMs,e)},this._onDynamicAudioChoice=(e,t)=>{const i=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"CallPanel._onDynamicAudioChoice causeId: "+i);const o=new P.AudioRouteSelectionPresenter(i);o.setUserProvidingVideo(B.default.CallingStore.isProvidingVideo(this.props.route.params.callId)),o.setControlTimerHandlers((()=>{this._clearHideControlsTimer()}),(()=>{this._startHideControlsTimer(!0,this._callControlTimeoutMs,i)})),o.show(this._getRootViewId(),e,t)},this._onCaptureMomentKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"CallPanel._onCaptureMomentKeyboardShortcut causeId: "+i),this._intOnCaptureMomentPress(i),!0},this._callControlsOnCaptureMomentPress=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"CallPanel._callControlsOnCaptureMomentPress causeId: "+e),this._intOnCaptureMomentPress(e)},this._intOnCaptureMomentPress=e=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._intOnCaptureMomentPress causeId: "+e);const t=[this._galleryMri()],i=this.props.route.params.callId,o=this.state.conversationMri,a=this.state.reactionsConversationMri;if(ee.CallingCapabilities.callSnapshotSupported()){const n=B.default.CallingStore.getRankedSpeakerMris(this.props.route.params.callId);this._callSnapshotSound.playOnce(e),j.default.takeSnapshot(e,i,o,a,n,t),et.default.maybeAnnounceForAccessibility(ke.getString("CallPanel.SnapshotPosted")),K.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.postPhotoSnapshot()))}},this._onEmptyCallGalleryViewPhotoButtonPress=()=>{this._onPhotoButtonPress(W.CallAddPhotosEntryPoint.CallGalleryEmptyView)},this._onPhotoButtonPress=e=>{const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onPhotoButtonPress causeId: "+t);const i=ti._useMobileControls(this.state.controlsType),o={capturedContentHandler:new ie.CapturedContentHandlerForPosting(this._galleryMri(),this.props.route.params.callId),conversationId:this._galleryMri(),callId:this.props.route.params.callId,allowVideo:!1,allowMultiple:!0,defaultToAlbums:!1,mediaPickerOnly:!0,disableMarkup:!0,onSendFlowComplete:this._onReactionsPhotoSendComplete};K.default.initCallAddPhotosEvent(this.props.route.params.callId,this.state.conversationMri,e),i&&this._onNavigatedAwayFromCall(t),this.state.isUsingStackNavigationContext?oe.navigateToCaptureComboWithParams(o,this._getContext(),(()=>{He.default.reduceNavStack([je.ConversationMediaViewerPanelNavigationId])})):i?oe.navigateToCaptureComboModalWithParams(o,this._getContext(),this._setAsVideoTargetWithDelay):this._intToggleGalleryPanel(t)},this._setAsVideoTargetWithDelay=()=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._setAsVideoTargetWithDelay, isCallPanelVisible before update: "+this.state.isCallPanelVisible),this.isComponentMounted()&&!this.state.isCallPanelVisible&&(we.log(Se.LogTraceArea.CallingUI,"Setting isCallPanelVisible: true"),this.setState({isCallPanelVisible:!0,isInCallGalleryOpenOnMobile:!1}))},this._onCallRecordingPress=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"CallPanel._onCallRecordingPress causeId: "+e),this._intOnCallRecordingPress(e)},this._intOnCallRecordingPress=e=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._intOnCallRecordingPress causeId: "+e),this.state.isRecording?B.default.InCallBotService.stopRecording(this.props.route.params.callId,e):B.default.InCallBotService.startRecording(this.props.route.params.callId,e)},this._onOpenGallery=(e,t,i)=>{if(we.log(Se.LogTraceArea.CallingUI,"onOpenGallery causeId: "+i),this.state.isUsingStackNavigationContext){const t=e?e.conversationId:this._galleryMri();this.state.isUsingStackNavigationContext&&Y.default.setCallViewVisible(this.props.route.params.callId,!1,i),K.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.galleryOpened())),He.default.navigateToConversationMediaViewer({conversationMri:t,initialMessage:e,defaultToLastItem:!0,useOpaqueBackground:!0,emptyMediaDescriptor:{mediaType:x.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},onClose:this._onGalleryClosed,origin:Se.NavigationMediaViewerOrigin.CallSharedPhoto},i,this._getRootViewId()),this.setState({isInCallGalleryOpenOnMobile:!0})}else e?(K.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.galleryOpened())),this._onNavigatedAwayFromCall(i),Re.default.showWithMessageConfig({initialMessage:e,defaultToLastItem:!0,rootViewId:this._getRootViewId(),initFromComponent:t,closeToComponent:this._getChatButtonRef,animateOpenClose:!0,onClose:this._onMediaViewerClosed,emptyMediaDescriptor:{mediaType:x.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},origin:Se.NavigationMediaViewerOrigin.CallSharedPhoto})):this._intToggleGalleryPanel(i)},this._onMediaViewerClosed=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),this.state.isUsingStackNavigationContext||ti._useMobileControls(this.state.controlsType)||this._showOrHideControls(!0,e)},this._onChatButtonRef=e=>{this._chatButton=e||void 0},this._getChatButtonRef=()=>this.isComponentMounted()?this._chatButton:void 0,this._onGalleryClosed=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),Y.default.setCallViewVisible(this.props.route.params.callId,!0,e),He.default.closeConversationMediaViewer(e,this._getContext())},this._onReactionsPhotoSendComplete=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onReactionsPhotoSendComplete, causeId: "+e),K.default.markPhotosSentCallAddPhotosEvent(this.props.route.params.callId,!0),K.default.completeCallAddPhotosEvent(this.props.route.params.callId),this.state.isUsingStackNavigationContext?oe.closeCaptureCombo(e,this._getContext()):ti._useMobileControls(this.state.controlsType)&&te.default.close()},this._onReactionsBarRef=e=>{this._reactionsBar=e||void 0},this._goBack=e=>(we.log(Se.LogTraceArea.CallingUI,"_goBack causeId: "+e),this.state.callUIState===Z.CallUIState.IncomingRing?(B.default.CallingStore.rejectCall(this.props.route.params.callId,e),!0):this.state.isChatOpen?(this._toggleChatPanel(e),!0):(this._exitCall(this._isIncomingOrOutgoingRing(),!1,e),!0)),this._requestEndInterruption=()=>c.default.requestEndToInterruption(),this._requestResumeCall=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_requestResumeCall, causeId: "+e),d.default.requestResumeCall(this.props.route.params.callId,e)},this._onToggleVideoKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onToggleVideoKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),this._onToggleVideo(),!0},this._onToggleMicrophoneKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onToggleMicrophoneKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i);return new D.ToggleMuteCommand(this.props.route.params.callId,B.default.CallingStore.isMuted(this.props.route.params.callId),B.default.CallingStore.isServerMuted(this.props.route.params.callId),this.state.microphonePermissionStatus!==p.PermissionStatus.Granted,this._getRootViewId(),void 0,i).execute(),!0},this._onAnnounceMuteStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onAnnounceMuteStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),B.default.CallingStore.isMuted(this.props.route.params.callId)?J.default.announceMicrophoneState(!0):J.default.announceMicrophoneState(!1),!0},this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onAnnounceSelfVideoOnOffStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),B.default.CallingStore.isProvidingVideo(this.props.route.params.callId)?J.default.announceVideoState(!0):J.default.announceVideoState(!1),!0},this._hangupCallShortcut=(e,t)=>t===this._getRootViewId()&&(this._hangupCall("CallPanel._hangupCallShortcut"),!0),this._hangupCall=e=>{const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_hangupCall: "+e+t),this.state.callUIState===Z.CallUIState.IncomingRing?B.default.CallingStore.rejectCall(this.props.route.params.callId,t):this._endCall(!1,t)},this._closeSubtitleHistory=()=>{{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onPressCloseSubtitleHistory, close subtitles panel causeId: "+e),this.state.isUsingStackNavigationContext?this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!1}):this._closeRightPanel((()=>He.default.closeSubtitlesPanel(e,this._getContext())),e)}},this._openSubtitleHistory=()=>{if(this.state.isTranslating){const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onPressOpenSubtitleHistory, open subtitles panel causeId: "+e),He.default.openSubtitles(this.state.reactionsConversationMri,this.state.conversationMri,this.props.route.params.callId,this._getContext(),e),this.state.isUsingStackNavigationContext&&this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!0}),this.forceUpdate()}},this._onCameraDeniedToastHeightChanged=e=>{this._onToastHeightChanged(e,"cameraDeniedBannerHeight")},this._onRecordingBannerHeightChanged=e=>{this._onToastHeightChanged(e,"recordingBannerHeight")},this._onNdiUsedBannerHeightChanged=e=>{this._onToastHeightChanged(e,"ndiUsedBannerHeight")},this._onCallMediaCapturedBannerHeightChanged=e=>{this._onToastHeightChanged(e,"callMediaCapturedBannerHeight")},this._onIncomingVideoDisabledBannerHeightChanged=e=>{this._onToastHeightChanged(e,"incomingVideoDisabledBannerHeight")},this._onCallConnectionQualityBannerHeightChanged=e=>{this._onToastHeightChanged(e,"callConnectionQualityBannerHeight")},this._onServerMuteNotificationBannerHeightChanged=e=>{this._onToastHeightChanged(e,"serverMuteNotificationBannerHeight")},this._onMobileScreenShareBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileScreenShareBannerHeight")},this._onMobileTeamsInteropBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileTeamsInteropBannerHeight")},this._onMobileTogetherModeNoticeBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileTogetherModeNoticeBannerHeight")},this._onPstnTranslationNoticeBannerHeightChanged=e=>{this._onToastHeightChanged(e,"pstnTranslationNoticeBannerHeight")},this._onVideoRestrictedBannerHeightChanged=e=>{this._onToastHeightChanged(e,"videoRestrictedBannerHeight")},this._onPstnParticipantRingNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.pstnParticipantRingNoticeBannerHeight||0)&&this.setState({pstnParticipantRingNoticeBannerHeight:t})},this._onMobileTranslationBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileTranslationBannerHeight")},this._closeCallCreatorShareOverlayPopup=()=>{this.setState({hasCallCreatorShareOverlayPopup:!1})},this._onLayoutPickerButtonRef=e=>{this._layoutPickerButton=e||void 0}}_buildState(e,t){const i=ze.default.isUsingStackNavigationContextNoSubscription(),{callId:o,initialConversationMri:a,navigationReason:n}=e.route.params,s=I.default.getS4LCMCFeatures();let r=Z.CallUIState.Default,c=!1,d=!1;const h="user"===B.default.CallingStore.getForwardingDestinationType(o),p=B.default.CallingStore.getCallConversationMri(o)||(t?a:this.state.conversationMri),g=ae.isOneOnOneConversation(p),C=B.default.CallingStore.isPSTNCall(o),m=ae.isEncryptedThread(p),_=ae.isS4BBridgeMri(p),f=B.default.CallingStore.hasStartedCallLocallyGoLive(o),y=B.default.CallingStore.getCallState(o),T=!!y&&V.default.isCallStateActive(y),b=B.default.CallingStore.isProvidingVideo(o),v=this._getRootViewId(),w=!t&&this.state.isCallCreator||B.default.CallingStore.isCallCreator(o),P=!(t||!this.state.hasBeenPresented)||!We.default.isAnimationPending(),M=B.default.CallingStore.hasRejectedCallLocally(o);let D,A=!t&&(this.state.exitingCall||M);switch(y){case S.CallState.None:if(B.default.CallingStore.isCallIncoming(o)&&n!==je.CallNavigationReason.AutoAnsweredRing)r=Z.CallUIState.IncomingRing;else{const e=this._leftNoneStateOnce||B.default.CallingStore.callDidExist(o);r=e?Z.CallUIState.Disconnected:Z.CallUIState.None,A=A||e&&P,e&&!A&&we.log(Se.LogTraceArea.CallingUI,"_buildState: CallState.None, waiting for hasBeenPresented to exit")}c=!0;break;case S.CallState.Connected:case S.CallState.LocalHold:case S.CallState.RemoteHold:d=V.default.isCallStateOnHold(y),"voicemail"===B.default.CallingStore.getForwardingDestinationType(o)?r=Z.CallUIState.Voicemail:B.default.CallingStore.hasConnectedParticipants(o)?r=Z.CallUIState.Default:(r=t?Z.CallUIState.None:this.state.callUIState,f&&(r=Z.CallUIState.GoLiveSinglePlayer),c=!t&&this.state.skipRenderingParticipants);break;case S.CallState.Disconnecting:r=t?Z.CallUIState.None:this.state.callUIState,c=!0,A=A||P,P||we.log(Se.LogTraceArea.CallingUI,"_buildState: CallState.Disconnecting, waiting for hasBeenPresented to exit");break;case S.CallState.Disconnected:r=Z.CallUIState.Disconnected,c=!0,A=A||P,P||we.log(Se.LogTraceArea.CallingUI,"_buildState: CallState.Disconnected, waiting for hasBeenPresented to exit");break;case S.CallState.Connecting:case S.CallState.EarlyMedia:w&&(c=!g&&!b,r=f?Z.CallUIState.GoLiveSinglePlayer:Z.CallUIState.OutgoingRing);break;case S.CallState.Notified:n===je.CallNavigationReason.AnsweredRing||n===je.CallNavigationReason.AutoAnsweredRing?r=Z.CallUIState.Default:(r=Z.CallUIState.IncomingRing,c=!0)}const R=()=>m?ke.getString("CallPanel.EncryptedConnectingStatusMessage"):ke.getString("CallPanel.ConnectingStatusMessage");r===Z.CallUIState.OutgoingRing&&(D=y===S.CallState.EarlyMedia?!t&&this.state.outgoingRingStatus?this.state.outgoingRingStatus:R():y!==S.CallState.Connecting||B.default.CallingStore.hasRingingParticipants(o,!1)||B.default.CallingStore.hasConnectedParticipants(o)?ke.getString("CallPanel.RingingStatusMessage"):R());const x=ae.getReactionsThreadMriForCallId(o),L=B.default.DeviceStore.getCameras(),O=B.default.DeviceStore.getSelectedCamera();let N;if(g&&C){const e=ae.getPhoneNumberFromMri(p);e&&(N=$e.default.getConversationMri(e))}const F=J.default.getControlsType(v),U=ti._useMobileControls(F),j=t?Jt:this.state.panelLayout,G=t?Jt:this.state.callStageMobileLayoutWithCaptions;let W;if(U&&s.enableNewCallPanel.enableExperimentalCallControls){W=Qe.default.getWidth(v)/Qe.default.getHeight(v)>1.2}else W=Qe.default.getDeviceOrientation(v)===u.DeviceOrientation.Landscape;const K=Ze.default.statusBarHeight(),$=I.default.getS4LCMCFeatures().enableFullScreenOnWeb,q=J.default.isLeftPanelOpen(),Q=J.default.isRightPanelOpen(),X=J.default.isGalleryPanelOpen(),te=J.default.isSubtitlesPanelOpen(),ie=Ye.default.isMobileScreenReaderEnabled(),oe=!i&&Ge.default.isDesktopSplitNavStackCollapsed(),ne=!i&&Q&&Ge.default.isCallChatShowing(),se=!s.enableTapToMoveCallParticipant&&F===Z.CallControlsType.Mobile,re=B.default.InCallBotService.isTranslating(o),ce=B.default.InCallBotService.isPstnTranslationEnabled(o),ue=B.default.InCallBotService.isVoiceTranslationEnabled(o),he=B.default.InCallBotService.isSkypeTranslationEnabled(o),pe=B.default.InCallBotService.isSkypeTranslationPaused(o),ge=s.enableMobileSubtitlesRightPanel,Ce=B.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(p)&&ye.default.isConversationTranslated(p),me=B.default.InCallBotService.isCaptioningEnabled(o),_e=B.default.CallingFeaturesHelper.allowReactions({isPSTNCall:C,isEncryptedCall:m,conversationMri:p,callId:o}),fe=r===Z.CallUIState.Default||r===Z.CallUIState.OutgoingRing||r===Z.CallUIState.GoLiveSinglePlayer,Te=r===Z.CallUIState.Default,be=_e&&s.enableAllCallButtonsVisible?fe:Te,ve=(0,E.default)(),Ie=(0,de.default)().getConversation(p),Pe=B.default.CallingStore.getRemoteCallMemberMris(o),De=Ie&&Ie.isGroupConversation()?[...Ie.getThreadMembers()]:[],Ae=(0,xt.countInactivePstnParticipantInThread)(Pe,De),Re=[],Le=z.default.getStageMode(o),Be=B.default.CallingStore.isRecording(o),Ve=!i,Oe={conversationMri:p,isProvidingVideo:b,cameras:L,selectedCamera:O,isCallCreator:w,microphonePermissionStatus:Ke.default.permissionStatus(St.PermissionType.Microphone),isRecording:Be,isVideoRestricted:B.default.CallingStore.getListOfBlockedVideoFeedParticipantsIds(o,!t&&!this.state.isVideoRestricted).length>0,remoteParticipantsThatAreCapturingCallMedia:B.default.CallingStore.getRemoteMembersCapturingCallMedia(o),isNdiBeingUsed:B.default.NdiHookupService.isInUse(),isTranslating:re,isIncomingVideoDisabled:J.default.isIncomingVideoDisabled(o),audioOnlyEnabled:B.default.CallingStore.isAudioOnly(o),isScreenShareActive:B.default.CallScreenShareStore.isActive(o),isMobileScreenShareActive:!1,callUIState:r,outgoingRingStatus:D,terminatedReason:B.default.CallingStore.getCallTerminatedReason(o),skipRenderingParticipants:c,rosterAvailble:!g,isCallOnHold:d,isCallBeingForwarded:h&&r===Z.CallUIState.OutgoingRing,isUsingStackNavigationContext:i,reactionsConversationMri:x,exitingCall:A,isCallActive:T,isLandscape:W,panelLayout:j,callStageMobileLayoutWithCaptions:G,hasBeenPresented:P,isMobileScreenReaderEnabled:ie,knownPSTNContactMri:N,isPSTNCall:C,isS4BCall:_,isEncryptedCall:m,statusBarHeight:K,hasMicrophones:B.default.DeviceStore.hasMicrophones(),hasSpeakers:B.default.DeviceStore.hasSpeakers(),isAudioOutputSelectionSupported:B.default.DeviceStore.getIsAudioOutputSelectionSupported(),topSafeAreaHeight:se||Ze.default.keepStatusBarVisible()?Ze.default.statusBarPadding():0,bottomSafeAreaInset:Ze.default.bottomSafeAreaInset(le.BottomInsetDefault),isSpeakerMuted:!!ee.CallingCapabilities.speakerVolumeControlSupported()&&(B.default.CallingStore.isSpeakerMuted(o)||0===B.default.DeviceStore.getSpeakerVolume()),callAudioOutputRoute:B.default.CallControlsStore.getAudioOutput(),isNavigatingWithKeyboard:Me.default.isNavigatingWithKeyboard(),isRecentsOpen:!oe&&Ge.default.isLeftPanelShowing(),isChatOpen:ne,isRightPanelOpen:Q,isGalleryPanelOpen:X,isSubtitlesPanelOpen:te,isLeftPanelOpen:q,isSplitNavCollapsed:oe,isRinglessCall:f,controlsType:F,lockOrientationForIncomingRing:r===Z.CallUIState.IncomingRing&&i,isDesktopMin:J.default.isDesktopMinCallPanelHeader(v),isTranscriptionEnabled:B.default.InCallBotUtils.isCallTranslatorBotEnabled(p),isInCallGalleryOpenOnMobile:!t&&this.state.isInCallGalleryOpenOnMobile,shouldShowReactions:be,showFullScreenOptionInRibbonSettings:$,callNetworkQualityPoor:ve.isCallQualityPoor(o),callReconnectionState:ve.getCallReconnectionState(o),newMobileOverflowOpen:k.default.isOverflowMenuVisible(),mobileSubtitlesRightPanelEnabled:ge,isInCallSubtitleHistoryModeOnMobile:!t&&this.state.isInCallSubtitleHistoryModeOnMobile&&!Y.default.isCallVisible(o),showAloneInCall:f&&w&&H.default.getActiveParticipants(o,p).length+Re.length===1,isTranslated:Ce,translationBannerBeenDismissed:Ue.default.getInCallTranslationBannerDismissState(p),enableDoubleTapToFullScreen:$&&s.enableDoubleTapToFullScreen,enableDialpadOnPSTNSubtitlesCalls:s.enableDialpadOnPSTNSubtitlesCalls,isOutgoingVideoDisabled:B.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),stageLayoutMode:Le,activeCallsCount:B.default.CallingStore.getCallIds().filter((e=>B.default.CallingStore.isCallActive(e))).length,hideTogetherModeNoticeToastForCallId:Fe.default.getTogetherModeNoticePresentedForCallId(),isPossiblyNotConnectedAudienceBotInCall:B.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(o),renderHeaderV2:F!==Z.CallControlsType.Mobile,shouldShowTray:!z.default.isTopTrayHidden(o)&&Pt.default.trayHasParticipants(o),showMyselfInTheGrid:z.default.getSelfInTheGrid(o),isOneOnOneConversation:g,canAccessConversationDetails:Dt.default.navigation().canAccessConversationDetails,pstnTranslationEnabled:ce,voiceTranslationEnabled:ue,skypeTranslationEnabled:he,skypeTranslationPaused:pe,captioningEnabled:me,countInactivePstnParticipantsInCall:Ae,enableVisitor:U&&s.enableNewCallPanel.enableVisitor,enableExperimentalHeader:U&&s.enableNewCallPanel.enableExperimentalHeader,enableExperimentalCallControls:U&&s.enableNewCallPanel.enableExperimentalCallControls,traySizeMultiplier:U&&W?Z.MobileTopTraySizeMultiplier:1,enableCallRecorderUINew:Ve,enableRedesignedDeviceQualityBanners:s.enableRedesignedDeviceQualityBanners,hasStartedHideControlsTimer:z.default.hasStartedHideControlsTimer(o),enableReactionBarWithEditButtonByClickingStage:I.default.getS4LMessagingFeatures().enableReactionBarExperienceFixInNarrowView};Oe.isCallMediaBeingCaptured=!!Oe.remoteParticipantsThatAreCapturingCallMedia&&Oe.remoteParticipantsThatAreCapturingCallMedia.length>0,Oe.callPanelHeaderLayout=z.default.getCallHeaderLayoutMode(o);const Ee=Ue.default.getCallTranslatorCaptionsPositionMode();if(Oe.userCaptionPositionMode=this._getDefaultCaptionPositionMode(s,ce,i,Oe.enableExperimentalCallControls?W:Qe.default.getDeviceOrientation(v)===u.DeviceOrientation.Landscape,Ee,Oe.enableExperimentalCallControls),t)if(this._callControlTimeoutMs=s.callControlTimeoutMs,this._callControlShortTimeoutMs=s.callControlShortTimeoutMs,this._callControlExtraShortTimeoutMs=500,Oe.recordingBannerHeight=0,Oe.cameraDeniedBannerHeight=0,Oe.ndiUsedBannerHeight=0,Oe.incomingVideoDisabledBannerHeight=0,Oe.serverMuteNotificationBannerHeight=0,Oe.callMediaCapturedBannerHeight=0,Oe.callConnectionQualityBannerHeight=0,Oe.mobileScreenShareBannerHeight=0,Oe.mobileTeamsInteropBannerHeight=0,Oe.mobileTogetherModeNoticeBannerHeight=0,Oe.mobileTranslationBannerHeight=0,Oe.pstnTranslationNoticeBannerHeight=0,Oe.videoRestrictedBannerHeight=0,Oe.pstnParticipantRingNoticeBannerHeight=0,Oe.hideCameraDeniedToast=!1,Oe.hideCallControlsForActivity=!1,Oe.useImmersiveMode=!1,Oe.showDialpad=!1,Oe.buttonsAndInfoHidden=!1,Oe.suppressParticipantAnimation=!1,Oe.titleWidth=0,Oe.isMicrophoneMutedWhileSpeaking=!1,Oe.showSpeakerOnWarning=!1,Oe.showServerMutedToastOnMobile=!1,Oe.isCallParticipantActionsMenuOpened=!1,Oe.hideTeamsInteropToast=!1,Oe.hideVideoRestrictedToast=!1,Oe.hasCallCreatorShareOverlayPopup=!0,Oe.isRecordingToastVisible=!0,Oe.isScreenSharingToastVisible=!0,i){const e=this._getContext().componentVisibilityStatus;e&&(Oe.isCallPanelVisible=e.isVisible(),this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{we.log(Se.LogTraceArea.CallingUI,"visibility changed, isVisible: "+e+", isCallPanelVisible: "+this.state.isCallPanelVisible),this.isComponentMounted()&&e!==this.state.isCallPanelVisible&&(e?this._setAsVideoTargetWithDelay():(we.log(Se.LogTraceArea.CallingUI,"Setting isCallPanelVisible: "+e),this.setState({isCallPanelVisible:e})))})))}else Oe.isCallPanelVisible=!0;else Oe.isRecording||(Oe.recordingBannerHeight=0),Oe.isNdiBeingUsed||(Oe.ndiUsedBannerHeight=0),Oe.isCallMediaBeingCaptured||(Oe.callMediaCapturedBannerHeight=0),Oe.isIncomingVideoDisabled||(Oe.incomingVideoDisabledBannerHeight=0),this._showMobileServerMutedToast(Oe)||(Oe.serverMuteNotificationBannerHeight=0),this._showCallConnectionQualityToast(Oe)||(Oe.callConnectionQualityBannerHeight=0),Oe.isMobileScreenShareActive||(Oe.mobileScreenShareBannerHeight=0),Oe.isTranslated&&!Oe.translationBannerBeenDismissed||(Oe.mobileTranslationBannerHeight=0);this._callState=y,this._mustUpdateSpeakerMutedAsync(o,Oe)&&l.defer((()=>{this._updateSpeakerMutedAsync(o).then((e=>{this.isComponentMounted()&&this.setState({isSpeakerMuted:e})}))}));return!(null==Ie?void 0:Ie.isJoinEnabled())&&!xe.MeetNowHelpers.isGuestFlow()&&(Oe.hasCallCreatorShareOverlayPopup=!1),Oe.isConversationCreator=Mt.default.getSkypeMri()===(null==Ie?void 0:Ie.creator()),Oe.isMobileEnvironmentWithStackNavigation=ze.default.isMobileEnvironmentWithStackNavigation(),Oe}render(){const e=ti._useMobileControls(this.state.controlsType),t=this._isLightTheme()?Yt.callPanelBackgroundLight:Yt.callPanelBackgroundDark,i=[Yt.callPanel,t];C.StatusBar.isOverlay()&&!this.state.enableExperimentalHeader&&i.push(Je.default.paddingTopStyle(this.state.statusBarHeight));let o=Vt.BarStyle.LIGHT_CONTENT,l=gt.Color.black;if(this.state.enableExperimentalHeader){const e=this._getContext().themeColors.surfacePrimary;o=this._getContext().mode.isDark?Vt.BarStyle.LIGHT_CONTENT:Vt.BarStyle.DARK_CONTENT,l=e,i.push(C.Styles.createViewStyle({backgroundColor:e},!1))}const c=this._getCallStageViewRect(e),d=C.Styles.createViewStyle({width:c.width,height:c.height},!1);let u;if(e&&this.state.callUIState===Z.CallUIState.IncomingRing)u=[(0,a.jsxs)(C.View,{style:[Yt.innerViewBase,d],children:[(0,a.jsx)(Et.default,{}),this._renderCallingAnimation(c,{top:240}),(0,a.jsx)(Oe.default,{conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,useLightTheme:this._isLightTheme()})]},"controlscontainer")];else if(e)u=this.state.enableVisitor?(0,a.jsx)(Kt.CallPanelLayout,{getCallPanelLayout:this._visitLayout.bind(this),viewRect:c,isFocusModeOn:this.state.buttonsAndInfoHidden,isTranslating:this.state.isTranslating,isLandscape:this.state.isLandscape}):[(0,a.jsxs)(C.View,{style:Yt.mobileInnerViewBase,children:[this._renderCallStage(c),this._renderTray(c),this._renderReactionsPanel(),this._renderCallingAnimation(c,{top:0,bottom:0}),this._renderTranscriptionView(c),this._renderTranscriptionNotifications(c),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderCallControls(c),this._renderMobileTopBanner(c)]},"controlscontainer"),(0,a.jsx)(r.SafeAreaView,{edges:["top"],style:ei.safeAreaContainer,pointerEvents:"box-none",children:(0,a.jsxs)(s.View,{style:ei.safeAreaContentWrapper,pointerEvents:"box-none",children:[this._renderCallPanelHeader(c),this._renderDialpad(c),this._renderAudioNotification()]})},"safe-area-view")];else{const e=this.state.enableDoubleTapToFullScreen?C.GestureView:C.View,t={};this.state.enableDoubleTapToFullScreen&&(t.onDoubleTap=()=>this._toggleFullScreenMode()),u=[(0,a.jsxs)(e,Object.assign({style:[Yt.innerViewBase,d]},t,{children:[this._renderCallStage(c),this._renderCallingAnimation(c,{top:0,bottom:0}),this._renderCallPanelHeader(c),this._renderTray(c),(0,a.jsx)(Qt.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,enableCallRecorderUINew:this.state.enableCallRecorderUINew,enableRedesignedDeviceQualityBanners:this.state.enableRedesignedDeviceQualityBanners}),this._renderSkypeLogo(),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderTranscriptionView(c),this._renderTranscriptionNotifications(c),this._renderAudioNotification(),this._renderReactionsBar(c),this._renderReactionsPanel(),this._renderCallControls(c),this._renderDialpad(c),this._renderCallCreatorShareOverlayPopup(),this._renderOptionalFullScreenTooltip()]}),"controlscontainer")]}return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsx)(Ht.TouchBar,{callId:this.props.route.params.callId,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,conversationMri:this.state.conversationMri}),(0,a.jsxs)(re.default,{goBack:this._goBack,children:[(0,a.jsx)(Vt.default,{statusBarKey:"CallPanel",backgroundColor:l,barStyle:o,hidden:!!this.state.hideStatusBarPadding,animated:!0}),(0,a.jsx)(Rt.KeyboardAvoidingView,{children:(0,a.jsx)(C.View,{style:i,onLayout:this._onLayoutChange,onMouseMove:this._onMouseMove,children:(0,a.jsx)(se.CoachMarkContext.Provider,{value:this._coachMarkContext,children:u})})})]})]})}_renderCallPanelHeaderFlex(e,t){const i=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.state.conversationMri;return this.state.enableExperimentalHeader?(0,a.jsx)(Nt.MobileCallPanelHeader,{isLandscape:null==t?void 0:t.isLandscape,callId:this.props.route.params.callId,conversationMri:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,isCallActive:this.state.callUIState===Z.CallUIState.Default||this.state.callUIState===Z.CallUIState.Voicemail,onBackButtonPress:this._onMobileBackButtonPressed,style:null==t?void 0:t.style,showRecordingIcon:this.state.isRecording&&!this.state.isRecordingToastVisible},"mobileCallPanelHeader"):this._renderCallPanelHeaderV1(i,e,!0,!0,void 0,void 0,void 0,!0,t)}_shouldShowLocalParticipantView(){return!(!this.state.isOneOnOneConversation||this.state.stageLayoutMode!==Z.StageMode.Grid||this.state.showMyselfInTheGrid||this.state.pstnTranslationEnabled||this._isIncomingOrOutgoingRing()&&!this.state.isProvidingVideo)}_renderLocalParticipantView(e,t){return this._shouldShowLocalParticipantView()?(0,a.jsx)(Ft.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,isLightTheme:this._isLightTheme(),style:null==t?void 0:t.style,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,isProvidingVideo:this.state.isProvidingVideo},"localParticipantView"):null}_renderLocalParticipantGestureView(e,t){return this._shouldShowLocalParticipantView(),null}_visitLayout(e,t,i=0){return e.map((e=>{var o;const n=e.key||i++;switch(e.name){case"Column":return(0,a.jsx)(s.View,Object.assign({},e.props,{children:this._visitLayout(e.children,t,i)}),n);case"ZStack":return(0,a.jsx)(s.View,Object.assign({},e.props,{children:this._visitLayout(null!==(o=e.children)&&void 0!==o?o:[],t,i)}),n);case"LayoutAnimationContainer":return(0,a.jsx)(Lt.default,{style:e.props.style,hidden:e.props.hidden,children:this._visitLayout(e.children,t,i)},n);case"ControlsAnimationContainer":return(0,a.jsx)($t.default,{style:e.props.style,wrapperStyle:e.props.wrapperStyle,hidden:e.props.hidden,fadeAnimationDirection:e.props.fadeAnimationDirection,componentKey:e.props.componentKey,children:this._visitLayout(e.children,t,i)},n);case"StageAnimationContainer":return(0,a.jsx)(qt.default,{margin:e.props.margin,marginLeft:e.props.marginLeft,style:e.props.style,children:this._visitLayout(e.children,t,i)},n);default:const r=this._KEY_METHOD_MAP[e.name],l=(null==e?void 0:e.props)||{};return null==r?void 0:r.apply(this,[t,l])}}))}_renderDialpad(e){if(this.state.showDialpad){const t=[Yt.dialpadContainer,Yt.dialpadShim,this._dialpadAnimatedOpacityStyle],i=[Yt.dialpadInnerContainer],o=Math.min(414,e.width),n=this.state.bottomSafeAreaInset+Z.AudioNotificationOffset;return i.push(C.Styles.createViewStyle({height:Math.min(Xt+n,e.height),width:o,left:(e.width-o)/2,paddingBottom:n},!1)),i.push(this._dialpadAnimatedTransformStyle),(0,a.jsxs)(C.View,{style:Yt.dialpadContainer,children:[(0,a.jsx)(C.Animated.View,{style:t,children:(0,a.jsx)(C.GestureView,{style:Yt.dialpadContainer,onTap:this._onCloseDialpad})},"shim"),(0,a.jsx)(C.Animated.View,{style:i,children:(0,a.jsx)(me.default,{callId:this.props.route.params.callId,onClose:this._onCloseDialpad})},"dialpad")]},"dialpadcontainer")}}componentDidMount(){var e,t;super.componentDidMount();const{callId:i}=this.props.route.params,o=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,`[CallPanel][componentDidMount][${o}]`,`callUIState: ${Z.CallUIState[this.state.callUIState]}`),u.default.enableLowProfileMode().catch((e=>{we.warn(Se.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+pt.default.errorAsString(e))})),Y.default.setCallViewVisible(i,!0,o),null===(e=B.default.CallingStore.getVideoOverrides(i))||void 0===e||e.clearRemoteStreamOverride(O.VideoOverrideReason.InBackground),null===(t=B.default.CallingStore.getLocalVideoState(i))||void 0===t||t.clearLocalVideoOverride(O.VideoOverrideReason.InBackground),this.state.isIncomingVideoDisabled&&J.default.disableIncomingVideo(i,o),this.state.buttonsAndInfoHidden||this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY()),this._subscriptions.push(v.default.subscribeForChanges("CallPanel",this._onAppStateChange)),this._updateAudioState(o),B.default.OngoingCallService.updateVideoState(i,C.App.getActivationState()),this._updateLeftNoneStateOnce(o),this.state.callUIState!==Z.CallUIState.Default&&this.state.callUIState!==Z.CallUIState.Voicemail||this._startParticipantAnimationSuppressionTimeout(),this.state.lockOrientationForIncomingRing&&(we.log(Se.LogTraceArea.CallingUI,"componentDidMount, entered IncomingRing state, locking orientation causeId: "+o),this._lockOrientationForIncomingRing()),this._callParticipantAccessoryOpacityValue.setValue(this.state.buttonsAndInfoHidden?1:0),this.state.isUsingStackNavigationContext&&(we.log(Se.LogTraceArea.CallingUI,"componentDidMount, setting keyboard resize mode to None causeId: "+o),Pe.default.setResizeMode(h.KeyboardAwareResizeMode.None)),this._subscriptions.push(B.default.CallingStore.callDeviceQualityEvent().subscribe(this._updateDeviceQualityState)),this._subscriptions.push(B.default.CallingStore.serverMutedEvent().subscribe(this._updateServerMutedState)),this._subscriptions.push(B.default.CallingStore.deviceNearEndQualityEvent().subscribe(this._updateDeviceNearEndQuality)),this._subscriptions.push(B.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._selectedDevicesChanged)),this._subscriptions.push(B.default.DeviceStore.availableDevicesChangedEvent().subscribe(this._availableDevicesChanged)),this._subscriptions.push(B.default.DeviceStore.onVideoEffectsQualityChangedEvent().subscribe(this._onVideoEffectsQualityChangedEvent)),ge.dismissAll(),this._startOrStopOrientationListener(!0),this._registerKeyboardHandlers(),this.state.isChatOpen||U.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri);const a=ti._useMobileControls(this.state.controlsType);a||C.Input.keyUpEvent.subscribe(this._onKeyUp),Be.default.addOrUpdateBottomMargin(Zt,a?82:100),this._maybeShowOrHideDeviceErrorToast(!0,!0,o),this._maybeShowCompositeCallRecordingToast(!1),this._maybeShowCompositeIncomingVideoDisabledToast(!1,o),this._maybeShowCompositeCallConnectionQualityToast(!1,o),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(o),this._maybeShowCompositeTogetherModeNoticeInCallToast(o),this._maybeShowCompositePstnTranslationInCallToast(o),this._maybeShowCompositePstnParticipantRingInCallToast(o),this._maybeShowCompositeTranslationInCallToast(o),this.state.controlsType===Z.CallControlsType.DesktopMin&&K.default.updateCallTelemetry(i,o,(e=>e.setEnterMinWidth())),B.default.OngoingCallService.getIsChatSidebarOpen(i)&&!this.state.isChatOpen&&this._toggleChatPanel(o),ht.default.callPanelRendered(),K.default.onCallPanelRendered(this.props.route.params.callId),_.PushNotifications.onCallScreenRendered(i)}componentWillUnmount(){super.componentWillUnmount();const{callId:e}=this.props.route.params;this._hideAllDeviceErrorToasts(),ne.default.closeCoachMark({});const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"componentWillUnmount causeId: "+t),u.default.disableLowProfileMode().catch((e=>{we.warn(Se.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+pt.default.errorAsString(e))})),B.default.CallingStore.isCallConnected(e)?K.default.updateCallTelemetry(e,t,(e=>e.sideNavigateInCall())):this.state.enableCallRecorderUINew&&Wt.default.setCallRecordingViewShowStatus(Wt.RecordingViewShowStatus.TriggeredByDefault,e),U.default.setHasPostedReactions(e,!1),this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],Y.default.setCallViewVisible(e,!1,t),k.default.resetAllVisibility(t),Pe.default.setResizeMode(h.KeyboardAwareResizeMode.Default),Ee.default.removeOrientationLock(this._orientationLockKey),this._startOrStopOrientationListener(!1),this._unregisterKeyboardHandlers(),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),ti._useMobileControls(this.state.controlsType)||C.Input.keyUpEvent.unsubscribe(this._onKeyUp),Be.default.removeBottomMargin(Zt),this.state.newMobileOverflowOpen&&he.default.closeIfNeeded(this._getRootViewId(),t)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const{callId:o}=this.props.route.params,a=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate causeId: "+a);const n=ti._useMobileControls(this.state.controlsType);if(t.callReconnectionState!==O.NetworkConnectionState.Connecting&&this.state.callReconnectionState===O.NetworkConnectionState.Connecting){we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, Call started to reconnect");const e=B.default.CallingStore.callStartTime(o);K.default.updateCallTelemetry(o,a,(e=>e.setCallReconnectStart())),K.default.trackReconnectCallSinceCallStarted(o,a,e)}else t.callReconnectionState===O.NetworkConnectionState.Connecting&&this.state.callReconnectionState===O.NetworkConnectionState.Connected&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, Call reconnected successfully"),K.default.updateCallTelemetry(o,a,(e=>e.setCallReconnectEnd())));if(!t.hasBeenPresented&&this.state.hasBeenPresented&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, hasBeenPresented: true"),bt.default.setTimeout((()=>{ge.dismissAll()}),1e3)),t.callUIState!==this.state.callUIState&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, callUIState changed: "+Z.CallUIState[t.callUIState]+" -> "+Z.CallUIState[this.state.callUIState]+" causeId: "+a),this._updateLeftNoneStateOnce(a),t.callUIState===Z.CallUIState.GoLiveSinglePlayer&&this.state.callUIState===Z.CallUIState.Default)){const e=l.filter(B.default.CallingStore.getRemoteCallMembers(o),(e=>V.default.isParticipantConnected(e)));if(!l.isEmpty(e)){const t=e[0],i=B.default.CallingStore.getRemoteCallMemberMri(o,t),a=Ce.default.getDisplayName(i)||"";et.default.maybeAnnounceForAccessibility(ke.getString("CallPanel.FirstParticipantJoinAccessibility",{name:a}))}}if(t.lockOrientationForIncomingRing!==this.state.lockOrientationForIncomingRing&&(this.state.lockOrientationForIncomingRing?(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, entered IncomingRing state, locking orientation causeId: "+a),this._lockOrientationForIncomingRing()):(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, left IncomingRing state, unlocking orientation causeId: "+a),Ee.default.removeOrientationLock(this._orientationLockKey))),t.outgoingRingStatus!==this.state.outgoingRingStatus&&we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, outgoingRingStatus changed: "+t.outgoingRingStatus+" -> "+this.state.outgoingRingStatus+" causeId: "+a),this.state.exitingCall&&!t.exitingCall&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, call disconnected, callState = "+this._callState+" terminatedReason = "+this.state.terminatedReason+" endCallNavigationRequested = "+this._endCallNavigationRequested),this._onEscape(),!this._endCallNavigationRequested)){this._endCallNavigationRequested=!0;const e=vt.default.newCauseId();if(this.state.terminatedReason===S.TerminatedReason.PstnInvalidNumber)we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, exit call with invalid number causeId: "+e),this.state.isUsingStackNavigationContext?He.default.navigateToHub(e):He.default.navigateToWelcomeScreen(e);else{we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, exit call causeId: "+e);const t=this.state.activeCallsCount>1||this.state.terminatedReason===S.TerminatedReason.Declined||this.state.terminatedReason===S.TerminatedReason.Missed||this.state.terminatedReason===S.TerminatedReason.Cancelled&&!this.state.isCallCreator;this._exitCall(t,!1,e)}}const s=this.state.callUIState===Z.CallUIState.Default||this.state.callUIState===Z.CallUIState.Voicemail,r=s&&!this._hasConnected,d=!this.state.newMobileOverflowOpen&&t.newMobileOverflowOpen;if(s&&(this.state.buttonsAndInfoHidden!==t.buttonsAndInfoHidden||r||d)&&!this._shouldKeepControlsVisible()){const e=ti._useMobileControls(this.state.controlsType)&&!r?this._callControlTimeoutMs:this._callControlShortTimeoutMs;this._startHideControlsTimer(r||!this.state.buttonsAndInfoHidden,e,a),this._hasConnected=!0}if(t.callUIState!==Z.CallUIState.Default&&t.callUIState!==Z.CallUIState.Voicemail&&s&&(this.state.isCallCreator&&ae.isOneOnOneConversation(this.state.conversationMri)&&B.default.CallPostMessageService.postOneOnOneCallStartedPartListMessage(this.state.conversationMri,o),this._startParticipantAnimationSuppressionTimeout()),!this.state.isCallParticipantActionsMenuOpened&&(t.buttonsAndInfoHidden!==this.state.buttonsAndInfoHidden||this.state.isMobileScreenReaderEnabled!==t.isMobileScreenReaderEnabled||this.state.useImmersiveMode!==t.useImmersiveMode||this.state.hideCallControlsForActivity!==t.hideCallControlsForActivity)){const e=this._areControlsVisible()||this.state.isMobileScreenReaderEnabled;this._animateShowOrHideControls(e,!0,a),this.setState({hideStatusBarPadding:!Ze.default.keepStatusBarVisible()&&!e}),pe.default.clearToolTip()}this.state.isLandscape===t.isLandscape&&this.state.bottomSafeAreaInset===t.bottomSafeAreaInset||this.state.buttonsAndInfoHidden||(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate updating call controls bottom, causeId: "+a),this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY())),this.state.showDialpad&&!t.showDialpad&&this._animateDialpad(!0,a),(this._isIncomingOrOutgoingRing()||this.state.callUIState===Z.CallUIState.GoLiveSinglePlayer)&&this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,a),ti._useMobileControls(this.state.controlsType)||this._areControlsVisible()||this._showOrHideControls(!0,a,{},!0),this.state.conversationMri===t.conversationMri&&this.state.isChatOpen===t.isChatOpen||(this.state.isOneOnOneConversation!==t.isOneOnOneConversation&&z.default.setSelfInTheGrid(!this.state.isOneOnOneConversation,o),this.state.conversationMri!==t.conversationMri&&this.state.isChatOpen&&(He.default.closeConversationInCall(a,this._getContext()),He.default.openConversationInCall(a,this.state.conversationMri,o,this._getContext(),this._toggleChatPanel)),U.default.setChatIsOpen(this.props.route.params.callId,this.state.isChatOpen)),this.state.isTranslating!==t.isTranslating&&(this.state.isTranslating?$.default.assignCallId(this.state.reactionsConversationMri,o):(this.state.pstnTranslationEnabled||$.default.clearCallIdAssignment(o),B.default.OngoingCallService.setIsSubtitleHistoryOpen(o,!1))),this._maybeShowOrHideDeviceErrorToast(t.hasMicrophones,t.hasSpeakers,a),this._maybeShowCompositeCallRecordingToast(t.isRecording),this._maybeShowCompositeIncomingVideoDisabledToast(t.isIncomingVideoDisabled,a),this._maybeShowCompositeCallConnectionQualityToast(t.callNetworkQualityPoor,a),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(a),this._maybeShowCompositeTogetherModeNoticeInCallToast(a),this._maybeShowCompositeTranslationInCallToast(a),this._maybeShowCompositePstnTranslationInCallToast(a),this._maybeShowCompositePstnParticipantRingInCallToast(a),this._maybeShowCompositeVideoRestrictedToast(o,a),t.controlsType!==this.state.controlsType&&this.state.controlsType===Z.CallControlsType.DesktopMin&&K.default.updateCallTelemetry(o,a,(e=>e.setEnterMinWidth())),this.state.isProvidingVideo!==t.isProvidingVideo&&J.default.announceVideoState(this.state.isProvidingVideo),this.state.isCallOnHold!==t.isCallOnHold&&(J.default.announceHoldState(this.state.isCallOnHold),!this.state.isCallOnHold&&this._callControls&&this._callControls.toggleReactionsPickerButton(!1,!1));const u=t.selectedCamera&&t.selectedCamera.position,h=this.state.selectedCamera&&this.state.selectedCamera.position;u!==S.CameraPosition.Unknown&&h!==S.CameraPosition.Unknown&&u!==h&&J.default.announceCameraDirectionState(h),this.state.callAudioOutputRoute!==c.default.AudioOutputEarpiece&&t.callAudioOutputRoute===c.default.AudioOutputEarpiece&&(this.setState({showSpeakerOnWarning:!0}),l.isUndefined(this._speakerOnWarningTimeout)||bt.default.clearTimeout(this._speakerOnWarningTimeout),this._speakerOnWarningTimeout=bt.default.setTimeout((()=>{this._speakerOnWarningTimeout=void 0,this.isComponentMounted()&&this.setState({showSpeakerOnWarning:!1})}),5e3)),this.state.isNavigatingWithKeyboard!==t.isNavigatingWithKeyboard&&this._showOrHideControls(this.state.isNavigatingWithKeyboard,a),this.state.isChatOpen!==t.isChatOpen&&B.default.OngoingCallService.setIsChatSidebarOpen(o,this.state.isChatOpen);const p=this._getCallStageViewRect(n);if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom||this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float){const e=this._innerViewStyleHeight(p,n),t=this._getTransciptionBottomViewHeight(e);this.setState({userCaptionsBottomViewHeight:t})}if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left){const e=p.width,t=this._getTransciptionLeftViewWidth(e);this.setState({userCaptionsLeftViewWidth:t})}else this.setState({userCaptionsLeftViewWidth:0});B.default.InCallBotService.subscribe((()=>{B.default.InCallBotService.getCaptionHistoryOpen(this.props.route.params.callId)?(this._openSubtitleHistory(),this.setState({userCaptionPositionMode:kt.CaptionsPositionMode.float})):(this._closeSubtitleHistory(),this.setState({userCaptionPositionMode:Ue.default.getCallTranslatorCaptionsPositionMode()||this.state.userCaptionPositionMode}))}),kt.TriggerKeys.TranslatorHistory),!0===t.isRecording&&!1===this.state.isRecording&&this.setState({isRecordingToastVisible:!0}),!0===t.isMobileScreenReaderEnabled&&!1===this.state.isMobileScreenReaderEnabled&&this.setState({isScreenSharingToastVisible:!0}),this.state.isScreenShareActive!==t.isScreenShareActive&&J.default.announceScreenShareState(this.state.isScreenShareActive)}_getDefaultCaptionPositionMode(e,t,i,o,a,n){if(t)return kt.CaptionsPositionMode.float;if(i||n)return a!==kt.CaptionsPositionMode.float?o?kt.CaptionsPositionMode.left:kt.CaptionsPositionMode.bottom:kt.CaptionsPositionMode.float;{const t=e.callCaptionsPositionModeDefault?e.callCaptionsPositionModeDefault:kt.CaptionsPositionMode.float;return a||t}}_lockOrientationForIncomingRing(){Ee.default.addOrUpdateOrientationLock(this._orientationLockKey,u.DeviceOrientation.Portrait),this.setState({isLandscape:!1})}_exitCall(e,t,i){we.log(Se.LogTraceArea.CallingUI,"_exitCall shouldNavigateBack: "+e+" causeId: "+i),this._onNavigatedAwayFromCall(i);const o=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.props.route.params.initialConversationMri;He.default.navigateCallComplete(o,e,t,this._getContext(),i,this.props.route.params.callId)}_maybeShowCompositeCameraDeniedToast(){!ti._useMobileControls(this.state.controlsType)&&this._shouldShowCameraDeniedToast()&&(we.log(Se.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeCameraDeniedToast, showing toast"),this._hasShownCameraDeniedToast=!0,B.default.CallNavigationHelper.showCameraDeniedToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri}))}_shouldShowCameraDeniedToast(){return!!this.props.route.params.convertedVideoToAudio&&!this._hasShownCameraDeniedToast&&!this.state.hideCameraDeniedToast&&this.state.isCallActive}_maybeShowCompositeCallRecordingToast(e){ti._useMobileControls(this.state.controlsType)||!this.state.isRecording||e||this.state.enableCallRecorderUINew||(we.log(Se.LogTraceArea.CallingUI,"CallPanel._maybeShowCallRecordingToast, showing toast"),B.default.CallNavigationHelper.showCallRecorderToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,action:(e,t)=>{t&&this._callControls&&this._callControls.focusCallEndButton()}}))}_maybeShowCompositeVideoRestrictedToast(e,t){ti._useMobileControls(this.state.controlsType)||!this.state.isVideoRestricted||this.state.hideVideoRestrictedToast||(we.log(Se.LogTraceArea.CallingUI,`[CallPanel][_maybeShowCallRecordingToast][${t}] showing video restricted toast callId: ${e}`),B.default.CallNavigationHelper.showVideoRestrictedToast({callId:e,conversationMri:this.state.conversationMri,onDismiss:this._closeVideoRestrictedToast},t))}_maybeShowCompositeIncomingVideoDisabledToast(e,t){ti._useMobileControls(this.state.controlsType)||!this.state.isIncomingVideoDisabled||e||(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowIncomingVideoDisabledToast.  causeId ${t}`),B.default.CallNavigationHelper.showIncomingVideoDisabledToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},t))}_maybeShowCompositeTeamsInteropInCallToast(e){!ti._useMobileControls(this.state.controlsType)&&this._shouldShowTeamsInteropToast()&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTeamsInteropInCallToast.  causeId ${e}`),this._hasShownTeamsInteropBanner=!0,B.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ce.ToastType.TeamsInterop,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeTogetherModeNoticeInCallToast(e){!ti._useMobileControls(this.state.controlsType)&&this._shouldShowTogetherModeNoticeToast()&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTogetherModeNoticeInCallToast.  causeId ${e}`),this._hasShownTogetherModeNoticeBannerForCallId=!0,Fe.default.setTogetherModeNoticePresentedForCallId(this.props.route.params.callId),B.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ce.ToastType.TogetherModeNotice,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositePstnTranslationInCallToast(e){!ti._useMobileControls(this.state.controlsType)&&this.state.pstnTranslationEnabled&&!this.state.pstnTranslationBannerBeenDismissed&&I.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.showToast&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositePstnTranslationInCallToast.  causeId ${e}`),B.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ce.ToastType.PstnTranslation,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,onDismiss:this._onPstnTranslationNoticeDismiss},e))}_maybeShowCompositePstnParticipantRingInCallToast(e){!ti._useMobileControls(this.state.controlsType)&&!this.state.pstnParticipantRingBeenDismissed&&this.state.countInactivePstnParticipantsInCall>0&&I.default.getS4LCMCFeaturesNoSubscription().enableParticipantsButtonPstnMobile&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositePstnParticipantRingInCallToast. causeId ${e}`),B.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:ce.ToastType.PstnParticipantRing,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,onDismiss:this._onPstnParticipantRingNoticeDismiss},e))}_shouldShowTeamsInteropToast(){return ae.isS4BBridgeMri(this.state.conversationMri)&&!this._hasShownTeamsInteropBanner&&!this.state.hideTeamsInteropToast&&this.state.isCallActive}_shouldShowVideoRestrictedToast(){return this.state.isVideoRestricted&&!this.state.hideVideoRestrictedToast&&this.state.isCallActive}_shouldShowTogetherModeNoticeToast(){return this.state.isPossiblyNotConnectedAudienceBotInCall&&!this._hasShownTogetherModeNoticeBannerForCallId&&this.state.hideTogetherModeNoticeToastForCallId!==this.props.route.params.callId&&this.state.isCallActive}_shouldShowPSTNTranslationToast(){return this.state.pstnTranslationEnabled&&!this.state.pstnTranslationBannerBeenDismissed&&I.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.showToast}_maybeShowCompositeTranslationInCallToast(e){ti._useMobileControls(this.state.controlsType)||!this.state.isTranslated||this.state.translationBannerBeenDismissed||(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTranslationInCallToast.  causeId ${e}`),B.default.CallNavigationHelper.showTranslationInCallToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeCallConnectionQualityToast(e,t){ti._useMobileControls(this.state.controlsType)||!this.state.callNetworkQualityPoor||e||(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCallConnectionQualityToast.  causeId ${t}`),B.default.CallNavigationHelper.showCallConnectionQualityToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},t))}_maybeShowOrHideDeviceErrorToast(e,t,i){this.state.callUIState!==Z.CallUIState.Default&&this.state.callUIState!==Z.CallUIState.Voicemail||(this.state.hasMicrophones||!e&&this._hasShownNoMicrophoneConnectedToast?this.state.hasSpeakers||!this.state.isAudioOutputSelectionSupported||!t&&this._hasShownNoSpeakerConnectedToast||(this._showDeviceErrorToast(Z.DeviceStatusToastType.SpeakerDisconnected,i),this._hasShownNoSpeakerConnectedToast||(this._hasShownNoSpeakerConnectedToast=!0)):(this._showDeviceErrorToast(Z.DeviceStatusToastType.MicrophoneDisconnected,i),this._hasShownNoMicrophoneConnectedToast||(this._hasShownNoMicrophoneConnectedToast=!0))),this.state.hasSpeakers&&!t&&this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.SpeakerDisconnected),this.state.hasMicrophones&&!e&&this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.MicrophoneDisconnected)}_hideAllDeviceErrorToasts(){l.each(this._deviceErrorToasts,(e=>B.default.CallNavigationHelper.hideToast(e))),this._deviceErrorToasts={}}_hideDeviceErrorToastOfType(e){this._deviceErrorToasts[e]&&(B.default.CallNavigationHelper.hideToast(this._deviceErrorToasts[e]),delete this._deviceErrorToasts[e])}_showDeviceErrorToast(e,t,i,o){const a=J.default.getToastInformation(e,i,o,(i=>{K.default.trackInCallUFD(this.props.route.params.callId,e,i),K.default.updateCallTelemetry(this.props.route.params.callId,t,(e=>e.ufdDisplayed(i)))}));if(a){this._hideDeviceErrorToastOfType(e);const t=B.default.CallNavigationHelper.showNotificationToast(a);t&&(this._deviceErrorToasts[e]=t)}}_showDeviceChangeToast(e,t,i){const o=B.default.DeviceStore.isSelectedCompositeAudioDevice(e);o&&e.push(o),l.isEmpty(l.filter(e,(e=>e.kind!==S.DeviceType.Camera)))||(we.log(Se.LogTraceArea.CallingUI,"_showDeviceChangeToast: remove composite audio device toast if presented"),this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.CompositeAudioAvailable)),e.forEach((e=>{switch(e.kind){case S.DeviceType.Camera:this._showDeviceErrorToast(Z.DeviceStatusToastType.CameraChanged,i,{deviceName:e.label});break;case S.DeviceType.Microphone:o||this._showDeviceErrorToast(Z.DeviceStatusToastType.MicrophoneChanged,i,{deviceName:e.label});break;case S.DeviceType.Speaker:o||this._showDeviceErrorToast(Z.DeviceStatusToastType.SpeakerChanged,i,{deviceName:e.label});break;case S.DeviceType.CompositeAudioDevice:if(o)this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.MicrophoneChanged),this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.SpeakerChanged),this._showDeviceErrorToast(Z.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:o.label});else if(!t){const t=e,o=()=>this._hideDeviceErrorToastOfType(Z.DeviceStatusToastType.CompositeAudioAvailable),a=[{labelKey:"StartCallUtils.ConfirmButtonText",callback:()=>{B.default.DeviceStore.choosePreferredDevices({microphone:t.microphoneId,speaker:t.speakerId},i),o()}},{labelKey:"StartCallUtils.CancelButtonText",callback:o}];this._showDeviceErrorToast(Z.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:t.label},a)}}}))}_navigateToChat(e,t,i){we.log(Se.LogTraceArea.CallingUI,"_navigateToChat, causeId: "+i),this.state.isUsingStackNavigationContext?(we.log(Se.LogTraceArea.CallingUI,"_navigateToChat, exit to conversation, causeId: "+i),K.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.chatOpened())),this._exitCall(e,t,i)):this._toggleChatPanel(i)}_toggleLeftPanelForAction(e,t,i){we.log(Se.LogTraceArea.CallingUI,"_toggleLeftPanelForAction causeId: "+i);e().completeAction()}_closeRightPanel(e,t){we.log(Se.LogTraceArea.CallingUI,"_closeRightPanel causeId: "+t),e()}_animateShowOrHideControls(e,t,i){const o=e?1:0,a=e?0:-1e3,n=e?0:1,s=this._isIncomingOrOutgoingRing()?0:1-n,r=ti._useMobileControls(this.state.controlsType);let l,c;if(r||e||r&&!this.state.hideCallControlsForActivity&&!this.state.useImmersiveMode?(l=!0,c=this._controlsTranslateY()):(l=!1,c=r?55+Z.AudioNotificationOffset:Z.DesktopCallControlsHeight+Z.AudioNotificationOffset),we.log(Se.LogTraceArea.CallingUI,"_animateShowOrHideControls showControls:"+e+" adjustedShowControls: "+l+" hideCallControlsForActivity "+this.state.hideCallControlsForActivity+" useImmersiveMode: "+this.state.useImmersiveMode+" animated: "+t+" causeId: "+i),r||this._newCompositeReactionsAnimatedOpacityValue.setValue(e?1:0),e&&(this._callHeaderAnimatedTranslateYValue.setValue(a),this._callControlsAnimatedTranslateYValue.setValue(c)),this._controlsAnimation&&this._controlsAnimation.stop(),t){this._controlsAnimation=C.Animated.parallel([g.timing.easeOut({value:this._callHeaderAnimatedOpacityValue,toValue:o}),g.timing.easeOut({value:this._callControlsAnimatedOpacityValue,toValue:s}),g.timing.easeOut({value:this._topBannerAnimatedOpacityValue,toValue:n}),g.timing.easeOut({value:this._callStageOverlayOpacityValue,toValue:s}),g.timing.easeOut({value:this._callParticipantAccessoryOpacityValue,toValue:n}),g.timing.easeOut({value:this._callParticipantTooltipOpacityValue,toValue:s})]),this._controlsAnimation.start((t=>{this._maybeCompleteRenderCallControlsScenario(),t.finished?(delete this._controlsAnimation,this._callHeaderAnimatedTranslateYValue.setValue(a),this._callControlsAnimatedTranslateYValue.setValue(c)):(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate buttonsAndInfoHidden animation did not complete, causeId "+i),e===this._areControlsVisible()&&this._animateShowOrHideControls(!this.state.buttonsAndInfoHidden,!1,i))}));const t=this._renderCallControlsScenario;t&&t.markStepCompleted("StartedAnimation")}else this._topBannerAnimatedOpacityValue.setValue(n),this._callHeaderAnimatedOpacityValue.setValue(o),this._callHeaderAnimatedTranslateYValue.setValue(a),this._callControlsAnimatedTranslateYValue.setValue(c),this._callParticipantAccessoryOpacityValue.setValue(n),this._callParticipantTooltipOpacityValue.setValue(s),this._callStageOverlayOpacityValue.setValue(s),this._maybeCompleteRenderCallControlsScenario()}_maybeCompleteRenderCallControlsScenario(){const e=this._renderCallControlsScenario;e&&(e.markStepCompleted("MadeOpaque"),this._renderCallControlsScenario=void 0,l.defer((()=>{e.markStepCompleted("backOnJSThread"),e.finish()})))}_areControlsVisible(){return!this.state.buttonsAndInfoHidden}_coachMarksBeingShown(){return ne.default.isCoachMarkBeingShown({areaType:se.CoachMarkAreaType.CallPanel})}_clearHideControlsTimer(){this._hideControlsTimer&&(bt.default.clearTimeout(this._hideControlsTimer),this._hideControlsTimer=void 0)}_startHideControlsTimer(e,t,i){this._isIncomingOrOutgoingRing()||!this.isComponentMounted()||this.state.isCallParticipantActionsMenuOpened||this.state.enableExperimentalHeader&&this.state.hasStartedHideControlsTimer||(this._clearHideControlsTimer(),e&&!this.state.buttonsAndInfoHidden&&(z.default.setHasStartedHideControlsTimer(!0,this.props.route.params.callId),this._hideControlsTimer=bt.default.setTimeout((()=>{this.isComponentMounted()&&!this._isIncomingOrOutgoingRing()&&this._showOrHideControls(!1,i)}),t)))}_renderTranscriptionNotificationsMobileCallPanel(e,t){const i={marginTop:0};return(0,a.jsx)(C.View,{style:[null==t?void 0:t.style,_t.default.overflowVisible,i],children:(0,a.jsx)(Ot.default,{callId:this.props.route.params.callId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,useLightTheme:this._isLightTheme(),rootViewId:this._getRootViewId(),paddingTop:0,maxHeight:(null==t?void 0:t.bottomInset)?e.height-(null==t?void 0:t.bottomInset):e.height,headerHeight:null==t?void 0:t.headerHeight})},"transcriptionNotificationsWrapper")}_renderTranscriptionNotifications(e){const t=e.width,i=Q.default.getHorizontalPadding(t,this.state.isUsingStackNavigationContext,this.state.userCaptionPositionMode,this.state.pstnTranslationEnabled),o=this._getTranscriptionLeftViewTop(),n=this._getTranscriptionBottomPadding()+(this.state.isUsingStackNavigationContext?0:Z.DesktopCallControlsHeight),s=(this.state.isUsingStackNavigationContext?this._getTopInset():0)+10,r=e.height-o-n-s,l=C.Styles.createViewStyle({position:"absolute",left:i,right:i,top:o},!1);return(0,a.jsx)(C.View,{style:[l,_t.default.overflowVisible],children:(0,a.jsx)(Ot.default,{callId:this.props.route.params.callId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,useLightTheme:this._isLightTheme(),rootViewId:this._getRootViewId(),paddingTop:s,maxHeight:r})})}_renderTranscriptionViewMobileCallPanel(e,t){if(!("float"===(null==t?void 0:t.position)&&this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float||"bottom"===(null==t?void 0:t.position)&&this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom||"left"===(null==t?void 0:t.position)&&this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left)||this.state.isSubtitlesPanelOpen||!this._canShowTranscription())return;const i=null==t?void 0:t.paddingTop;let o=(null==t?void 0:t.paddingBottom)||0;this.state.pstnTranslationEnabled||"float"!==(null==t?void 0:t.position)||(o+=Q.SettingsBarSafezone);let n=null==t?void 0:t.style;if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom){const t=this._getTransciptionBottomViewHeight(e.height,!0);n=C.Styles.combine([n,C.Styles.createViewStyle({height:t},!1)])}else if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left){const t=this._getTransciptionLeftViewWidth(e.width);n=C.Styles.combine([n,C.Styles.createViewStyle({width:t},!1)])}else if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float){const t=this.state.pstnTranslationEnabled?e.height:this._getTransciptionBottomViewHeight(e.height);n=C.Styles.combine([n,C.Styles.createViewStyle({height:t},!1)])}return(0,a.jsx)(Q.default,{style:n,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsMri:this.state.reactionsConversationMri,topPadding:i,bottomPadding:o,showControls:!this.state.buttonsAndInfoHidden,useLightTheme:!!this.state.pstnTranslationEnabled&&this._isLightTheme(),captionPositionMode:this.state.userCaptionPositionMode,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,rootViewId:this._getRootViewId(),onStageTap:this._onStageTapped},"callTranscriptionView")}_renderTranscriptionView(e){if(this.state.isSubtitlesPanelOpen||!this._canShowTranscription())return;const t=this._transcriptionLayout(false,ti._useMobileControls(this.state.controlsType)),i=q.default.getTranscriptionLayoutRects(e,t),o=this._getTranscriptionBottomPadding();let n=this.state.isUsingStackNavigationContext?this._getTopInset():0;const s=this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left?this._getTransciptionLeftViewWidth(e.width):e.width,r=Q.default.getHorizontalPadding(s,this.state.isUsingStackNavigationContext,this.state.userCaptionPositionMode,this.state.pstnTranslationEnabled),l=2*r;let c=C.Styles.createViewStyle({position:"absolute",left:i.isHorizontal?r:i.stage.width,right:r,top:i.isHorizontal?i.stage.height:i.subtitles.y,bottom:0},!1);if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float)n=10,c=C.Styles.createViewStyle({position:"absolute",height:this.state.userCaptionsBottomViewHeight,left:r,right:r,bottom:this.state.isUsingStackNavigationContext?0:Z.DesktopCallControlsHeight,paddingTop:n},!1);else if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom)n=10,c=C.Styles.createViewStyle({position:"absolute",left:r,right:r,height:this.state.userCaptionsBottomViewHeight,bottom:this.state.isUsingStackNavigationContext?0:Z.DesktopCallControlsHeight,paddingTop:n},!1);else if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left){const t=this._getTransciptionLeftViewWidth(e.width);n=10,c=C.Styles.createViewStyle({position:"absolute",left:r,width:t-l,top:this._getTranscriptionLeftViewTop(),bottom:0,paddingTop:n},!1)}return(0,a.jsx)(Q.default,{style:c,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsMri:this.state.reactionsConversationMri,topPadding:n,bottomPadding:o,showControls:!this.state.buttonsAndInfoHidden,useLightTheme:this._isLightTheme(),captionPositionMode:this.state.userCaptionPositionMode,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,rootViewId:this._getRootViewId(),onStageTap:this._onStageTapped},"callTranscriptionView")}_renderTransientView(){let e;const{callId:t}=this.props.route.params;if(this.state.isCallOnHold){const i=B.default.OngoingCallService.getOnHoldForInterruption(t)?()=>{B.default.CallingStore.isCallKitCall(t).then((e=>{e?this._requestResumeCall():this._requestEndInterruption}))}:void 0;e=(0,a.jsx)(X.default,{type:X.CallTransientStateViewType.Hold,header:ke.getString("CallPanel.OnHoldHeader"),onPress:i,ignorePointerEvents:!0},"callTransientStateView")}else this.state.callReconnectionState===O.NetworkConnectionState.Connecting?e=(0,a.jsx)(X.default,{type:X.CallTransientStateViewType.Reconnect,header:ke.getString("CallPanel.ReconnectingHeader"),body:I.default.getS4LCMCFeaturesNoSubscription().showSimpleReconnectingLostMessage?"":ke.getString("CallPanel.ReconnectingBody"),blockPointerEvents:!0},"callTransientStateView"):this.state.callReconnectionState===O.NetworkConnectionState.LostConnection&&(e=(0,a.jsx)(X.default,{type:X.CallTransientStateViewType.Reconnect,header:ke.getString("CallPanel.NoNetworkHeader"),body:I.default.getS4LCMCFeaturesNoSubscription().showSimpleReconnectingLostMessage?"":ke.getString("CallPanel.NoNetworkBody"),blockPointerEvents:!0},"callTransientStateView"));return e}_renderMobileTopBanner(e,t){var i;const{callId:o}=this.props.route.params;if(!ti._useMobileControls(this.state.controlsType))return;let n,s,r,c,d,u,h,p,g,m=this.state.hideStatusBarPadding?0:this.state.topSafeAreaHeight;if(this._shouldShowCameraDeniedToast()&&(s=(0,a.jsx)(nt.default,{closeToast:this._closeCameraDeniedToast,onDesiredHeightChanged:this._onCameraDeniedToastHeightChanged,topInset:m,style:null==t?void 0:t.bannerStyle}),m=0),this.state.isRecording&&this.state.isRecordingToastVisible&&(n=(0,a.jsx)(at.default,{callId:o,conversationMri:this.state.conversationMri,topInset:m,viewWidth:e.width,onDesiredHeightChanged:this._onRecordingBannerHeightChanged,onPress:this._onCallRecordingPress,style:null==t?void 0:t.bannerStyle,onHideRecordingToast:this._onHideRecordingToast}),m=0),this.state.isNdiBeingUsed&&(r=(0,a.jsx)(ot.LocalStackNavCallMediaCapturerToast,{topInset:m,viewWidth:e.width,onDesiredHeightChanged:this._onNdiUsedBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),m=0),this.state.isCallMediaBeingCaptured&&!this.state.isCallOnHold){const i=this.state.remoteParticipantsThatAreCapturingCallMedia[0];c=(0,a.jsx)(ot.RemoteStackNavCallMediaCapturerToast,{callId:o,conversationMri:this.state.conversationMri,initiatorMri:i,topInset:m,viewWidth:e.width,onDesiredHeightChanged:this._onCallMediaCapturedBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),m=0}this.state.isIncomingVideoDisabled&&!this.state.isCallOnHold&&(d=(0,a.jsx)(rt.default,{callId:o,conversationMri:this.state.conversationMri,topInset:m,onDesiredHeightChanged:this._onIncomingVideoDisabledBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),m=0),this._showCallConnectionQualityToast(this.state)&&(u=(0,a.jsx)(it.default,{callId:o,conversationMri:this.state.conversationMri,topInset:m,onDesiredHeightChanged:this._onCallConnectionQualityBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),m=0),this._showMobileServerMutedToast(this.state)&&(h=(0,a.jsx)(ct.default,{callId:o,conversationMri:this.state.conversationMri,topInset:m,onDesiredHeightChanged:this._onServerMuteNotificationBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),m=0),this.state.isMobileScreenShareActive&&!this.state.isCallOnHold&&this.state.isScreenSharingToastVisible&&(p=(0,a.jsx)(lt.default,{callId:o,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,topInset:m,onDesiredHeightChanged:this._onMobileScreenShareBannerHeightChanged,style:null==t?void 0:t.bannerStyle,isMobileScreenShareActive:this.state.isMobileScreenShareActive,onHideScreenSharingToast:this._onHideScreenSharingToast}),m=0),this._shouldShowTeamsInteropToast()&&(g=(0,a.jsx)(dt.default,{closeToast:this._closeTeamsInteropToast,onDesiredHeightChanged:this._onMobileTeamsInteropBannerHeightChanged,topInset:m,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle}),m=0);const S=[];let _;if(this._shouldShowTogetherModeNoticeToast()&&(S.push((0,a.jsx)(st.default,{type:ce.ToastType.TogetherModeNotice,closeToast:this._closeTogetherModeNoticeToast,onDesiredHeightChanged:this._onMobileTogetherModeNoticeBannerHeightChanged,topInset:m,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),m=0),this.state.isTranslated&&!this.state.translationBannerBeenDismissed&&this.state.isCallActive&&(_=(0,a.jsx)(ut.default,{callId:o,onDesiredHeightChanged:this._onMobileTranslationBannerHeightChanged,topInset:m,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle}),m=0),this._shouldShowPSTNTranslationToast()&&(S.push((0,a.jsx)(st.default,{type:ce.ToastType.PstnTranslation,closeToast:this._onPstnTranslationNoticeDismiss,onDesiredHeightChanged:this._onPstnTranslationNoticeBannerHeightChanged,topInset:m,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),m=0),!this.state.pstnParticipantRingBeenDismissed&&this.state.countInactivePstnParticipantsInCall>0&&I.default.getS4LCMCFeaturesNoSubscription().enableParticipantsButtonPstnMobile&&(S.push((0,a.jsx)(st.default,{type:ce.ToastType.PstnParticipantRing,closeToast:this._onPstnParticipantRingNoticeDismiss,onDesiredHeightChanged:this._onPstnParticipantRingNoticeBannerHeightChanged,topInset:m,conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,style:null==t?void 0:t.bannerStyle})),m=0),this._shouldShowVideoRestrictedToast()&&(S.push((0,a.jsx)(st.default,{type:ce.ToastType.VideoRestricted,closeToast:this._closeVideoRestrictedToast,onDesiredHeightChanged:this._onVideoRestrictedBannerHeightChanged,topInset:m,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),m=0),n||r||c||d||s||h||u||p||_||g||!l.isEmpty(S)){const e=null!==(i=null==t?void 0:t.style)&&void 0!==i?i:Yt.topBanner;return(0,a.jsxs)(C.Animated.View,{style:e,ignorePointerEvents:!0,children:[n,d,h,r,c,u,s,p,_,g,S]},"mobileTopBanner")}}_renderReactionsBar(e){if(!this.state.shouldShowReactions)return;const t=[Yt.reactionsBar,this._newCompositeReactionsAnimatedOpacityStyle,_t.default.floatingStyle];return(0,a.jsx)(C.Animated.View,{style:t,ignorePointerEvents:!0,children:(0,a.jsx)(F.default,{ref:this._onReactionsBarRef,style:Yt.reactionsBarCompositeInner,ignorePointerEvents:!0,conversationMri:this.state.conversationMri,reactionsConversationId:this.state.reactionsConversationMri,callId:this.props.route.params.callId,minDrawerHeight:360,controlsType:this.state.controlsType,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,viewDimensions:e,bottomSafeAreaInset:this.state.isLandscape?0:this.state.bottomSafeAreaInset,audioNotificationOffset:Z.AudioNotificationOffset,onDesiredHeightChanged:this.state.isUsingStackNavigationContext?this._onReactionsBarDesiredHeight:void 0,onReactionsDrawerOpen:this._onReactionsDrawerOpen,useDesktopCallControls:!ti._useMobileControls(this.state.controlsType)})},"reactionsBar")}_renderReactionsPanel(e,t){if(!this.state.shouldShowReactions)return;const i=ti._useMobileControls(this.state.controlsType),o=this.state.isUsingStackNavigationContext&&i?void 0:85,n=this.state.isUsingStackNavigationContext&&i?void 0:70;return(0,a.jsx)(C.Animated.View,{style:Yt.fullScreenView,ignorePointerEvents:!0,children:(0,a.jsx)(qe.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,bottomStyle:this.state.enableVisitor&&!this.state.buttonsAndInfoHidden?this._reactionsPanelAnimatedBottomStyleVisitor:this._reactionsPanelAnimatedBottomStyle,reactionsConversationMri:this.state.reactionsConversationMri,isDesktop:!this.state.isUsingStackNavigationContext,desktopBottomMargin:o,desktopSideMargin:n,sizePhotosToFit:!this.state.isUsingStackNavigationContext&&i,photoTapDelay:this.state.isUsingStackNavigationContext||i?0:500,onPhotoTap:this._onOpenGallery,areMobileCallControlsVisible:i&&this._areControlsVisible(),style:null==t?void 0:t.style})},"reactionsPanel")}_getCallStageViewRect(e){if(this.state.enableExperimentalCallControls&&this.state.isTranslating&&(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left||this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom))return this.state.callStageMobileLayoutWithCaptions;const t=this._getTanscriptionRects(e);return t&&this._canShowTranscription()&&!e&&this._canShowTranscriptionPanel(t),this.state.panelLayout}_innerViewStyleHeight(e,t){return t?e.height-(this.state.shouldShowTray?Z.DesktopTopTrayHeight*this.state.traySizeMultiplier:0):e.height-Z.DesktopCallControlsHeight-Z.DesktopNewHeaderHeight-(this.state.shouldShowTray?Z.DesktopTopTrayHeight:0)}_getTransciptionBottomViewHeight(e,t=!1){const i=this.state.isUsingStackNavigationContext?this._getTopInset():0,o=t?0:i;if(this.state.pstnTranslationEnabled){if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float)return e-o}else if(this.state.isTranslating||this.state.skypeTranslationPaused){let t=0;this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom?t=I.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.desktopSizePercentage:this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float&&(t=I.default.getS4LCMCFeaturesNoSubscription().callCaptionsFloatPanel.desktopSizePercentage);return Math.max(Z.CallTranscriptionBottomViewMinHeight,e*t)-o}return 0}_getTransciptionLeftViewWidth(e){if((this.state.isTranslating||this.state.skypeTranslationPaused)&&this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left){const t=I.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.desktopSizePercentage;return Math.max(Z.CallTranscriptionLeftViewMinWidth,e*t)}return 0}_getCallStageHeight(e,t){const i=this._innerViewStyleHeight(e,t);if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom){return i-(this.state.userCaptionsBottomViewHeight||0)}return i}_getCallStageWidth(e){return e.width-(this.state.userCaptionsLeftViewWidth||0)}_getCallStageLeft(){return this.state.userCaptionPositionMode!==kt.CaptionsPositionMode.left||this.state.enableExperimentalCallControls?0:this.state.userCaptionsLeftViewWidth||0}_getCallStageTop(){return ti._useMobileControls(this.state.controlsType)?Z.MobileNewHeaderHeight+(this.state.shouldShowTray?Z.DesktopTopTrayHeight*this.state.traySizeMultiplier:0):Z.DesktopNewHeaderHeight+(this.state.shouldShowTray?Z.DesktopTopTrayHeight:0)}_getTranscriptionLeftViewTop(){return this._getCallStageTop()}_renderTray(e,t){const i=(null==t?void 0:t.style)?C.Styles.createViewStyle(t.style,!1):void 0,o=(null==t?void 0:t.participantsStyle)?C.Styles.createViewStyle(t.participantsStyle,!1):void 0;return this.state.shouldShowTray?(0,a.jsx)(wt.CallTrayView,{conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,hideNameTag:this.state.callUIState===Z.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this._callParticipantActionsMenuOpened,onCallParticipantContextMenuDismissed:this._callParticipantActionsMenuClosed,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,viewRect:e,onOverflowButtonPress:this._onShowParticipants,stageMode:this.state.stageLayoutMode,useLightTheme:this._isLightTheme(),useMobileControls:ti._useMobileControls(this.state.controlsType),isLandscape:this.state.isLandscape,style:i,onTrayTap:this._onStageTapped,traySizeMultiplier:(null==t?void 0:t.traySizeMultiplier)||this.state.traySizeMultiplier,showTrayVertically:null==t?void 0:t.showTrayVertically,showCompactReactions:null==t?void 0:t.showCompactReactions,participantsAccessoryPosition:null==t?void 0:t.participantsAccessoryPosition,participantsViewStyle:o,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,enableRedesignedTrayButton:this.state.enableExperimentalCallControls},"callTrayView"):void 0}_renderCallStage(e,t){var i;const{callId:o}=this.props.route.params,n=ti._useMobileControls(this.state.controlsType),s=[Yt.fullScreenView],r=this.state.mobileSubtitlesRightPanelEnabled?e:(null===(i=this._getTanscriptionRects(n))||void 0===i?void 0:i.stage)||e,l=this._getCallStageTop();s.push(C.Styles.createViewStyle({top:l},!1));const c=C.Styles.createViewStyle({left:this._getCallStageLeft(),width:this._getCallStageWidth(r),height:this._getCallStageHeight(r,n)},!1);s.push(c),(null==t?void 0:t.style)&&s.push(C.Styles.createViewStyle(t.style,!1));const d=(null==t?void 0:t.participantsStyle)?C.Styles.createViewStyle(t.participantsStyle,!1):void 0,u=this._isIncomingOrOutgoingRing()&&!this.state.isProvidingVideo,h=u&&this.state.isOneOnOneConversation;return(0,a.jsx)(G.CallStageViewV2,{style:s,conversationMri:this.state.conversationMri,callId:o,viewRect:r,hideNameTag:this.state.callUIState===Z.CallUIState.GoLiveSinglePlayer||this.state.pstnTranslationEnabled,onCallParticipantContextMenuOpened:this._callParticipantActionsMenuOpened,onCallParticipantContextMenuDismissed:this._callParticipantActionsMenuClosed,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,isLandscape:this.state.isLandscape,stageLayoutMode:this.state.stageLayoutMode,useLightTheme:this._isLightTheme(),hideLocalVideo:(null==t?void 0:t.hideLocalVideo)||this.state.pstnTranslationEnabled||u,hideParticipantBackground:this.state.pstnTranslationEnabled,hideParticipantIcon:this.state.pstnTranslationEnabled||h,onStageTap:this._onStageTapped,isCompactView:ti._useMobileControls(this.state.controlsType),isVideoFullScreenMode:this.state.buttonsAndInfoHidden,participantsAccessoryPosition:null==t?void 0:t.participantsAccessoryPosition,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,forceVideoToCrop:null==t?void 0:t.forceVideoToCrop,participantsViewStyle:d,participantsIconSize:null==t?void 0:t.participantsIconSize},"callStageView")}_renderCallingAnimation(e,{top:t,bottom:i}){if(!this._isIncomingOrOutgoingRing()||this.state.isProvidingVideo||!e.width||!e.height)return;const o=[Yt.callingAnimationContainer,C.Styles.createViewStyle({top:t,bottom:i},!1)];return(0,a.jsx)(C.View,{style:o,children:(0,a.jsx)(L.default,{conversationId:this.state.conversationMri})},"callAnimation")}_renderCallPanelHeader(e){const t=ti._useMobileControls(this.state.controlsType),i=!this._isIncomingOrOutgoingRing()&&!this.state.isUsingStackNavigationContext&&ae.isThread(this.state.conversationMri)&&!this.state.isEncryptedCall,o=[this.state.renderHeaderV2?Yt.headerContainerV2:Yt.headerContainer,this._callHeaderAnimatedStyle];let n,s;t&&o.push(Je.default.marginTopStyle(this._getBannersHeight())),this.state.isUsingStackNavigationContext||(n=this._onShowOrHideRoster,s=this._onCallTitleLayout);const r=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.state.conversationMri,l=this.state.canAccessConversationDetails?this._onShowOrHideProfile:void 0;return(0,a.jsx)(C.Animated.View,{style:o,ignorePointerEvents:!0,children:this.state.renderHeaderV2?this._renderCallPanelHeaderV2(r,e,i,t,l,n,s):this._renderCallPanelHeaderV1(r,e,i,t,l,n,s)},"callpanelheader"+this.state.callPanelHeaderLayout)}_renderCallPanelHeaderV1(e,t,i,o,n,s,r,l,c){return(0,a.jsx)(N.default,{callId:this.props.route.params.callId,conversationId:e,maxTitleWidth:this._maxTitleWidth(t),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===Z.CallUIState.Default||this.state.callUIState===Z.CallUIState.Voicemail,isRecording:this.state.isRecording,isRecordingToastVisible:this.state.isRecordingToastVisible,isMobileScreenShareActive:this.state.isMobileScreenShareActive,isScreenSharingToastVisible:this.state.isScreenSharingToastVisible,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:i,hideBackButton:this.state.callUIState===Z.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,useMobileControls:o,onTitlePress:n,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,onGalleryPress:this._toggleGalleryPanel,callPanelHeaderLayout:this.state.callPanelHeaderLayout,onDynamicAudioChoice:this._onDynamicAudioChoice,hideGradient:l,isUsingSkypeTheme:null==c?void 0:c.isUsingSkypeTheme})}_renderCallPanelHeaderV2(e,t,i,o,n,s,r){return(0,a.jsx)(It.default,{callId:this.props.route.params.callId,conversationId:e,maxTitleWidth:this._maxTitleWidth(t),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===Z.CallUIState.Default||this.state.callUIState===Z.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:i,hideBackButton:this.state.callUIState===Z.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,useMobileControls:o,onTitlePress:n,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,useLightTheme:this._isLightTheme(),callPanelHeaderLayout:this.state.callPanelHeaderLayout,onDynamicAudioChoice:this._onDynamicAudioChoice,onLayoutPickerButtonRef:this._onLayoutPickerButtonRef,enableCallRecorderUINew:this.state.enableCallRecorderUINew})}_maxTitleWidth(e){if(this.state.callPanelHeaderLayout===Z.CallPanelHeaderLayout.Window||this.state.callPanelHeaderLayout===Z.CallPanelHeaderLayout.Float)return this.state.renderHeaderV2?Math.max(e.width/2,180):Math.max(e.width/2,350)}_renderOptionalNetworkInCallWarning(e,t){let i;return this.state.callUIState===Z.CallUIState.Voicemail?i=ve.default.getViewInformationForVoicemail():this.state.isCallBeingForwarded&&(i=ve.default.getViewInformationForForwarding()),i?(0,a.jsx)(be.default,{viewInformation:i,ref:this._onInCallWarningViewRef,style:null==t?void 0:t.style}):void 0}_renderFooterPstnTranslatorButton(e,t){return(0,a.jsx)(Te.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,marginBottom:this._getPstnTranslationButtonsBottomPadding(),useLightTheme:this._isLightTheme(),style:null==t?void 0:t.style},"inCallPstnTranslatorButton")}_renderOptionalAloneInTheCallInformationView(e,t){if(this.state.showAloneInCall)return(0,a.jsx)(b.default,{conversationMri:this.state.conversationMri,isCallCreator:this.state.isCallCreator,callId:this.props.route.params.callId,isProvidingVideo:this.state.isProvidingVideo,isRinglessCall:this.state.isRinglessCall,callControlsType:this.state.controlsType,isLandscape:this.state.isLandscape,useDesktopCallControls:!ti._useMobileControls(this.state.controlsType),style:null==t?void 0:t.style},"goliveinfo")}_shouldShowCallCreatorShareOverlayPopup(){var e;const t=!0===(null===(e=this.props.route.params.meetNowParameters)||void 0===e?void 0:e.call),i=xe.MeetNowHelpers.isGuestFlow()&&this.state.isConversationCreator;return this.state.hasCallCreatorShareOverlayPopup&&!this.state.isMobileEnvironmentWithStackNavigation&&(t||i)}_renderCallCreatorShareOverlayPopup(){if(this._shouldShowCallCreatorShareOverlayPopup())return(0,a.jsx)(R.default,{conversationMri:this.state.conversationMri,meetNowParameters:this.props.route.params.meetNowParameters||{origin:Le.MeetNowOrigin.CallPanel},callId:this.props.route.params.callId,isProvidingVideo:this.state.isProvidingVideo,onClose:this._closeCallCreatorShareOverlayPopup})}_intRenderCallControls(e,t){const{callId:i}=this.props.route.params;if(this.state.callUIState===Z.CallUIState.IncomingRing)return(0,a.jsx)(Ie.default,{conversationMri:this.state.conversationMri,callId:i,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,forMobile:this.state.controlsType===Z.CallControlsType.Mobile});if(ti._useMobileControls(this.state.controlsType)){const e=this.state.buttonsAndInfoHidden;let o;return(null==t?void 0:t.style)&&(o=C.Styles.createViewStyle(t.style,!1)),o=C.Styles.combine(e?Yt.hiddenControls:void 0,o),this.state.enableExperimentalCallControls?(0,a.jsx)(jt.default,{conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,callId:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==p.PermissionStatus.Granted,onOpenDialpad:this._onOpenDialpad,onOverflowPressed:this._toggleMobileOverflowMenu,onLocalUnmute:this._onLocalUnmute,showCallControlsVertically:null==t?void 0:t.showCallControlsVertically},"mobileCallPanelControls"):(0,a.jsx)(Ve.default,{style:o,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,callId:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==p.PermissionStatus.Granted,onOpenDialpad:this._onOpenDialpad,onOverflowPressed:this._toggleMobileOverflowMenu,onEndCallFailure:this._onEndCallFailure,onLocalUnmute:this._onLocalUnmute,onInteracting:this._onCallControlsInteracting,blockPointerEvents:e,isShowingChat:this.state.isChatOpen,onChatPanelButtonPress:this._toggleChatPanel,enableNewButtons:!0,showCallControlsVertically:null==t?void 0:t.showCallControlsVertically,hideEndCallButton:this.state.enableExperimentalHeader,isUsingSkypeTheme:null==t?void 0:t.isUsingSkypeTheme})}return e.width===this.state.panelLayout.width&&(e=this.state.panelLayout),(0,a.jsx)(At.default,{ref:this._onCallControls,conversationMri:this.state.conversationMri,callId:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==p.PermissionStatus.Granted,opacityStyle:this._callControlsOpacityAnimatedStyle,isShowingChat:this.state.isChatOpen,isShowingRecents:this.state.isRecentsOpen,shouldShowReactions:this.state.shouldShowReactions,isHidden:this.state.buttonsAndInfoHidden,onOpenDialpad:this._onOpenDialpad,onInteracting:this._onCallControlsInteracting,onAddToCall:this._onAddToCallPressed,onShowParticipants:this._onShowParticipants,onChatPanelButtonPress:this._toggleChatPanel,onReactionsPickerButtonPress:this._showOrHideReactionsDrawer,onReactionPickerButtonHover:this._showReactionsDrawerOnHover,onChatButtonRef:this._onChatButtonRef,onEndCallFailure:this._onEndCallFailure,onMomentsPress:this._callControlsOnCaptureMomentPress,onRecordCallPress:this._onCallRecordingPress,controlsType:this.state.controlsType,showHideOutgoingVideoDisabledToast:this._onShowHideDisableOutgoingVideoToast,isShowingAloneInCall:this.state.showAloneInCall,isOutgoingVideoDisabled:this.state.isOutgoingVideoDisabled,showParticipantsButton:!0,useLightTheme:this._isLightTheme()})}_renderCallControls(e){const t=ti._useMobileControls(this.state.controlsType),i=[Yt.buttonsContainer];if(t){i.push(this._callControlsAnimatedTranslateYStyle),i.push(Yt.mobileButtonsContainer);this._audioNotificationView&&this.state.callUIState===Z.CallUIState.IncomingRing&&i.push(Yt.buttonsWithNotificationContainer)}else i.push(Yt.modernStageButtonsContainer),this._isLightTheme()&&i.push(Yt.lightThemeButtonsContainer);return this.state.isUsingStackNavigationContext&&i.push(Yt.callControlsContainerNewStage),(0,a.jsxs)(C.Animated.View,{style:i,ignorePointerEvents:!0,importantForAccessibility:t&&this.state.showDialpad?m.ImportantForAccessibility.NoHideDescendants:void 0,children:[this.state.buttonsAndInfoHidden?null:(0,a.jsx)(Bt.default,{hidden:!ti._useMobileControls(this.state.controlsType),direction:f.GradientDirection.TOP}),this._renderOptionalNetworkInCallWarning(),this._renderFooterPstnTranslatorButton(),this._intRenderCallControls(e)]},"callControls")}_renderAudioNotification(e,t){let i=this.state.bottomSafeAreaInset;ti._useMobileControls(this.state.controlsType)&&this._areControlsVisible()&&(i+=60);const o=this.state.hideCallControlsForActivity||this.state.showDialpad||this._isIncomingOrOutgoingRing();return(0,a.jsx)(C.Animated.View,{style:Yt.buttonsContainer,ignorePointerEvents:!0,children:(0,a.jsx)(w.default,{ref:this._onAudioNotificationViewRef,bottomPadding:i,callId:this.props.route.params.callId,showSpeakerOnWarning:this.state.showSpeakerOnWarning,isMicrophoneMutedWhileSpeaking:this.state.isMicrophoneMutedWhileSpeaking,hideNotification:o,useDesktopCallControls:!ti._useMobileControls(this.state.controlsType),style:null==t?void 0:t.style})},"audioNotification")}_callStageMobileLayoutWithCaptions(e){const t=2*Kt.StagePadding;return this.state.isLandscape?{x:e.x,y:e.y,width:e.width/3*2-t-Kt.CallControlsHeight,height:e.height-t-Kt.HeaderCompactHeight}:{x:e.x,y:e.y,width:e.width-t,height:e.height/3*2-t-Kt.HeaderHeight-Kt.CallControlsHeight}}_animateDialpad(e,t,i){we.log(Se.LogTraceArea.CallingUI,`_showOrHideDialpad causeId: ${t}`);const o=e?1:0,a=this.state.isUsingStackNavigationContext?0:-150,n=this.state.isUsingStackNavigationContext?Xt:540;let s;if(e){const e=this.state.isUsingStackNavigationContext?0:(this.state.panelLayout.height-Xt)/2*-1;s=Math.max(e,a)}else s=n;let r=!0;!this.state.isUsingStackNavigationContext&&e&&(r=!1),r?C.Animated.parallel([g.timing.easeOut({value:this._dialpadAnimatedOpacityValue,toValue:o,useNativeDriver:!0}),g.timing.easeOut({value:this._dialpadAnimatedTransformValue,toValue:s,useNativeDriver:!0})]).start(i):(this._dialpadAnimatedOpacityValue.setValue(o),this._dialpadAnimatedTransformValue.setValue(s),i&&i())}_showOrHideControls(e,t,i={},o,a){if(!ti._useMobileControls(this.state.controlsType)&&!o)return;this._reactionsBar&&this._reactionsBar.setOverflowCoachMarksEnabled(!e);const n=this._shouldKeepControlsVisible(),s=()=>` showControls: ${e} buttonsAndInfoHidden: ${i.buttonsAndInfoHidden} shouldKeepControlsVisible: ${n}`;o||this.state.buttonsAndInfoHidden!==!e&&!n?(i.buttonsAndInfoHidden=!e,e&&a&&(this._renderCallControlsScenario=new ft.default(ft.ScenarioName.RenderCallControls),this._renderCallControlsScenario.start(void 0,a),this._renderCallControlsScenario.markStepCompleted("ShowControls")),this.setState(i),we.log(Se.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)):(n&&(i.buttonsAndInfoHidden=!1),this.setState(i),we.log(Se.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)),k.default.setCallControlsVisible(e,t)}_shouldKeepControlsVisible(){const e=this._coachMarksBeingShown(),t=this.state.callUIState===Z.CallUIState.OutgoingRing||this.state.callUIState===Z.CallUIState.GoLiveSinglePlayer,i=ti._useMobileControls(this.state.controlsType)&&this.state.newMobileOverflowOpen&&!this.state.isUsingStackNavigationContext,o=e||this._isInteractingWithCallControls||this._endCallNavigationRequested||this.state.isPSTNCall||this.state.isMobileScreenReaderEnabled||this.state.isNavigatingWithKeyboard||t||i;return o&&we.log(Se.LogTraceArea.CallingUI,"_shouldKeepControlsVisible isInteractingWithCallControls: "+this._isInteractingWithCallControls+" endCallNavigationRequested: "+this._endCallNavigationRequested+" isPSTNCall: "+this.state.isPSTNCall+" isMobileScreenReaderEnabled: "+this.state.isMobileScreenReaderEnabled+" isNavigatingWithKeyboard: "+this.state.isNavigatingWithKeyboard+" coachMarksBeingShown: "+e+" isInOutgoingRingOrWaitState: "+t+" overflowMenuOpenOnTablet: "+i),o}_startParticipantAnimationSuppressionTimeout(){this.state.suppressParticipantAnimation&&bt.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantAnimation:!1})}),2e3)}_updateLeftNoneStateOnce(e){we.log(Se.LogTraceArea.CallingUI,"_updateLeftNoneStateOnce callUIState: "+Z.CallUIState[this.state.callUIState]+" causeId: "+e),this._leftNoneStateOnce||this.state.callUIState===Z.CallUIState.None||(this._leftNoneStateOnce=!0)}_updateAudioState(e){this.isComponentMounted()?(we.log(Se.LogTraceArea.CallingUI,"_updateAudioState causeId: "+e),B.default.CallControlsStore.updateAudioState(this.props.route.params.callId,e)):we.log(Se.LogTraceArea.CallingUI,"_updateAudioState - component no longer mounted, causeId: "+e)}_callControlsVisualHeight(){const e=ti._useMobileControls(this.state.controlsType)?55:Z.DesktopCallControlsHeight;return Math.max(this._reactionsBarHeight,e+40+-1*this._controlsTranslateY())}_componentId(){return"CapturePanel"}_galleryMri(){return this.state.conversationMri}_isIncomingOrOutgoingRing(){const{callUIState:e}=this.state;return e===Z.CallUIState.IncomingRing||e===Z.CallUIState.OutgoingRing}_startOrStopOrientationListener(e){}_endCall(e,t){we.log(Se.LogTraceArea.CallingUI,"_endCall forEveryone: "+e+" causeId: "+t);(e?B.default.CallingStore.endCallForEveryone(this.props.route.params.callId,t):B.default.CallingStore.endCall(this.props.route.params.callId,t)).catch((e=>{we.log(Se.LogTraceArea.CallingUI,"_endCall failed: "+pt.default.errorAsString(e)+" causeId: "+t),this._onEndCallFailure(t)}))}_controlsTranslateY(){return ti._useMobileControls(this.state.controlsType)?10-this.state.bottomSafeAreaInset:this.state.bottomSafeAreaInset}_registerKeyboardHandlers(){const e=(0,de.default)().getConversation(this.state.conversationMri);(0,Ne.isRegularMemberInModeratedGroup)(e)||(De.default.addHandler(Se.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),De.default.addHandler(Se.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),De.default.addHandler(Se.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||De.default.addHandler(Se.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),De.default.addHandler(Se.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),De.default.addHandler(Se.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),De.default.addHandler(Se.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_unregisterKeyboardHandlers(){const e=(0,de.default)().getConversation(this.state.conversationMri);(0,Ne.isRegularMemberInModeratedGroup)(e)||(De.default.removeHandler(Se.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),De.default.removeHandler(Se.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),De.default.removeHandler(Se.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||De.default.removeHandler(Se.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),De.default.removeHandler(Se.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),De.default.removeHandler(Se.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),De.default.removeHandler(Se.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_mustUpdateSpeakerMutedAsync(e,t){return Ct.default.isElectronOsx()&&"true"!==I.default.getSkypeAudioLibraryFeatures().ECS_ADSP_VirtualSessionVolume&&t.isSpeakerMuted!==B.default.CallingStore.isSpeakerMuted(e)}_updateSpeakerMutedAsync(e){return B.default.DeviceStore.getSpeakerVolumeAsync(!0).then((t=>0===t||B.default.CallingStore.isSpeakerMuted(e)))}_onNavigatedAwayFromCall(e){var t;we.log(Se.LogTraceArea.CallingUI,"onNavigateAwayFrom Call onCallScreenClose, causeId: "+e),this.state.isDesktopMin&&(null===(t=this._reactionsBar)||void 0===t?void 0:t.isDrawerOpen())&&this._showOrHideReactionsDrawer(!1),_.PushNotifications.onCallScreenClose()}_transcriptionLayout(e,t){return q.default.getTranscriptionLayout(e,!!t,this.state.isLandscape)}_getTanscriptionRects(e){const t=B.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)||!1;if(this.state.isTranslating&&t&&!this.state.isRightPanelOpen){const i=this._transcriptionLayout(t,e);return q.default.getTranscriptionLayoutRects(this.state.panelLayout,i)}}_canShowTranscriptionPanel(e){return!!B.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&(!e||!e.isHorizontal)}_canShowTranscription(){return!(!this.state.pstnTranslationEnabled&&!this.state.skypeTranslationEnabled)||!(!this.state.isTranscriptionEnabled||!this.state.isTranslating)}_getTranscriptionBottomPadding(){let e=0;if(ti._useMobileControls(this.state.controlsType))this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom||this.state.userCaptionPositionMode===kt.CaptionsPositionMode.left?e+=this.state.bottomSafeAreaInset+Z.AudioNotificationOffset:e+=90,this._areControlsVisible()&&(e+=45),this.state.pstnTranslationEnabled&&(this._areControlsVisible()?e+=40:e+=60);else if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.bottom)e=20;else if(this.state.userCaptionPositionMode===kt.CaptionsPositionMode.float)e=85;else if(this._areControlsVisible()){const t=0;e=this._callControlsVisualHeight()+t}else e=this._audioNotificationView?40:20;return!ti._useMobileControls(this.state.controlsType)&&this.state.pstnTranslationEnabled&&(e+=25),e}_getPstnTranslationButtonsBottomPadding(){let e=0;return this.state.isUsingStackNavigationContext?this._areControlsVisible()&&(e+=40):e=Z.AudioNotificationOffset+Z.DesktopCallControlsHeight+10,e}_showMobileServerMutedToast(e){return!!e.showServerMutedToastOnMobile&&!e.isCallOnHold}_showCallConnectionQualityToast(e){return(e.callNetworkQualityPoor||e.audioOnlyEnabled)&&!e.isCallOnHold}_onToastHeightChanged(e,t){const i=e?e+this._getBannerHeightAdjustment():0;this._shouldUpdateBannerHeight(i,this.state[t]||0)&&this.setState({[t]:i})}_shouldUpdateBannerHeight(e,t){return this.isComponentMounted()&&e!==t}_getBannersHeight(){return this.state.recordingBannerHeight+this.state.cameraDeniedBannerHeight+this.state.ndiUsedBannerHeight+this.state.callMediaCapturedBannerHeight+this.state.incomingVideoDisabledBannerHeight+this.state.callConnectionQualityBannerHeight+this.state.serverMuteNotificationBannerHeight+this.state.mobileScreenShareBannerHeight+this.state.mobileTeamsInteropBannerHeight+this.state.mobileTranslationBannerHeight+this.state.mobileTogetherModeNoticeBannerHeight+this.state.pstnTranslationNoticeBannerHeight+this.state.pstnParticipantRingNoticeBannerHeight+this.state.videoRestrictedBannerHeight}_getBannerHeightAdjustment(){return this.state.isUsingStackNavigationContext?20:10}_getTopInset(){let e=this.state.hideStatusBarPadding?0:this.state.topSafeAreaHeight;const t=this._getBannersHeight();return this._areControlsVisible()?ti._useMobileControls(this.state.controlsType)?(e+=this.state.renderHeaderV2?Z.DesktopNewHeaderHeight:Z.CallPanelHeaderHeight.mobile,e+=t):Ze.default.keepStatusBarVisibleNoSubscription()||(e+=17):e+=t,e}_renderOptionalFullScreenTooltip(){return Ct.default.isEdgeShoreline()?(0,a.jsx)(Gt.FullScreenTooltip,{anchor:()=>this._layoutPickerButton,callId:this.props.route.params.callId}):null}_isLightTheme(){return!this._getContext().mode.isDark}}ti._useMobileControls=e=>e===Z.CallControlsType.Mobile,t.default=ti},450989:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallPanelLayout=t.CallPanelLayoutInternal=t.HeaderCompactHeight=t.HeaderHeight=t.CallControlsHeight=t.StagePadding=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(701025),r=i(206315),l=o.__importDefault(i(150343)),c=i(16549),d=i(460515),u=o.__importDefault(i(48076)),h=i(526849);t.StagePadding=16,t.CallControlsHeight=54+t.StagePadding,t.HeaderHeight=56,t.HeaderCompactHeight=44;const p="#444444",g=10,C=16,m={margin:4,borderRadius:8,overflow:"hidden"},S={margin:0,borderRadius:0},_={margin:2,borderRadius:8,overflow:"hidden"};var f;!function(e){e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape"}(f||(f={}));function y(e,t,i){if(e)return t?Math.max(C,i):C}function T(e,t,i){if(!e)return t?Math.max(C,i):C}t.CallPanelLayoutInternal=({getCallPanelLayout:e,viewRect:i,isFocusModeOn:o,isTranslating:l,isLandscape:u,isTablet:h,enablePortraitFlex:b,enableLandscapeFlex:v,enableAnimationV2:I,enableAutoLetterBoxOnMobiles:w})=>{const P=u?f.Landscape:f.Portrait,M=(0,r.useSkypeTheme)(),D=(0,s.useSafeAreaInsets)(),A=!w,k=n.useMemo((()=>{let e;const i={isFocusModeOn:o,skypeTheme:M,safeAreaInsets:D,isTranslating:l,isTablet:h,forceVideoToCrop:A};switch(P){case f.Landscape:e=v?(({isFocusModeOn:e,skypeTheme:i,safeAreaInsets:o,isTranslating:a,isTablet:n,forceVideoToCrop:s})=>[{name:"Column",key:"root-column",props:{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:i.themeColors.surfacePrimary}},children:[{name:"LayoutAnimationContainer",key:"call-header-container",props:{hidden:e,style:n?{marginTop:o.top}:{borderBottomWidth:1,borderBottomColor:i.themeColors.dividerPrimary}},children:[{name:"CallPanelHeaderFlex",props:{isLandscape:!n,style:n?{height:t.HeaderHeight}:{height:t.HeaderCompactHeight,paddingLeft:Math.max(24,o.left),paddingRight:Math.max(24,o.right)},isUsingSkypeTheme:!0}}]},{name:"Column",key:"call-panel-and-controls-wrapper",props:{style:{flex:1,flexDirection:"row",backgroundColor:c.Color.transparent}},children:[{name:"ZStack",key:"call-stage-wrapper",props:{style:{flex:1,position:"relative",backgroundColor:c.Color.transparent,margin:e?0:12,marginLeft:e?0:Math.max(24,o.left),borderRadius:e?0:8,overflow:"hidden"}},children:[{name:"CallStage",props:{style:{height:void 0,width:void 0,top:0,padding:0},hideLocalVideo:!0,forceVideoToCrop:s,participantsAccessoryPosition:d.CallAccessoryPosition.BottomLeft,participantsStyle:e?S:m,participantsIconSize:96}},{name:"LocalParticipantView",props:{style:{position:"absolute",bottom:T(a,e,o.bottom),top:y(a,e,o.top),right:e?Math.max(C,o.right):C}}},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"Column",key:"optional-in-call-buttons",props:{style:{position:"absolute",bottom:0,left:0,right:0,padding:16,paddingBottom:42},pointerEvents:"box-none"},children:[{name:"TranscriptionView",props:{position:"float",paddingBottom:4,paddingTop:4,style:{marginTop:16,marginLeft:0,marginRight:0,marginBottom:0,bottom:0,position:"relative",backgroundColor:c.Color.transparent}}},{name:"InCallPstnTranslatorButton",props:{style:{position:"relative",marginTop:0,marginLeft:0,marginRight:0,marginBottom:4,bottom:0}}},{name:"AloneInTheCallInformation",props:{style:{position:"relative",backgroundColor:c.Color.transparent,paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:4}}},{name:"OptionalNetworkInCallWarning",props:{style:{position:"relative",marginTop:0,marginLeft:0,marginRight:0,marginBottom:2,height:void 0}}},{name:"AudioNotifications",props:{style:{bottom:0,paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:12,height:void 0,margin:0}}}]},{name:"LocalParticipantGestureView",props:{gesturesWrapperStyle:e?{marginTop:Math.max(C,o.top),marginRight:Math.max(C,o.right),marginBottom:Math.max(C,o.bottom),marginLeft:Math.max(C,o.left)}:void 0}},{name:"MobileTopBanner",props:{style:{position:"absolute",top:0,width:364,paddingTop:8,paddingLeft:0,paddingRight:0,paddingBottom:0,alignSelf:"center"},bannerStyle:{margin:2,borderRadius:8,paddingTop:g,paddingBottom:g,paddingLeft:g,paddingRight:g,backgroundColor:i.themeColors.surfaceDarkFixed}}},{name:"ReactionsPanel",props:{style:{paddingBottom:0}}},{name:"TransientView"}]},{name:"Tray",props:{showTrayVertically:!0,traySizeMultiplier:.8,showCompactReactions:!1,style:{flex:0,marginVertical:e?8:14,marginLeft:e?8:4,marginRight:e?8:4},participantsAccessoryPosition:d.CallAccessoryPosition.BottomLeftSmallPadding,participantsStyle:_}},{name:"TranscriptionView",props:{position:"left",paddingBottom:8,paddingTop:0,style:{paddingLeft:4,paddingRight:4,marginRight:e?0:12,marginTop:e?0:t.StagePadding,marginBottom:e?0:t.StagePadding,borderRadius:e?0:8,backgroundColor:p,flexBasis:"35%"}}},{name:"TranscriptionNotifications",props:{headerHeight:e?0:96,style:{position:"absolute",top:20+o.top,left:6+o.left,right:(e?8:84)+o.right}}},{name:"LayoutAnimationContainer",key:"call-controls-container",props:{hidden:e,style:{paddingVertical:8,paddingRight:Math.max(24,o.right),paddingLeft:12}},children:[{name:"FlexCallControls",props:{style:{opacity:1},showCallControlsVertically:!0,isUsingSkypeTheme:!0}}]}]},{name:"Dialpad"}]}])(i):[{name:"ZStack",props:{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}},children:[{name:"CallStage"},{name:"Tray"},{name:"ReactionsPanel"},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"TranscriptionView"},{name:"AloneInTheCallInformation"},{name:"TransientView"},{name:"CallControls"},{name:"MobileTopBanner"}]},{name:"CallPanelHeader"},{name:"Dialpad"},{name:"AudioNotifications"}];break;case f.Portrait:default:e=b?(({isFocusModeOn:e,skypeTheme:i,safeAreaInsets:o,isTranslating:a,isTablet:n,forceVideoToCrop:s})=>[{name:"Column",key:"root-column",props:{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:i.themeColors.surfacePrimary}},children:[{name:"LayoutAnimationContainer",key:"call-header-container",props:{hidden:e,style:{marginTop:o.top}},children:[{name:"CallPanelHeaderFlex",props:{style:{height:t.HeaderHeight},isUsingSkypeTheme:!0}}]},{name:"Column",key:"call-panel-wrapper",props:{style:{flex:1,backgroundColor:c.Color.transparent}},children:[{name:"ZStack",key:"call-stage-wrapper",props:{style:{flex:1,position:"relative",margin:e?0:12,borderRadius:e?0:8,overflow:"hidden",backgroundColor:c.Color.transparent}},children:[{name:"CallStage",props:{style:{height:void 0,width:void 0,top:0,padding:0},hideLocalVideo:!0,forceVideoToCrop:s,participantsAccessoryPosition:d.CallAccessoryPosition.BottomLeft,participantsStyle:e?S:m,participantsIconSize:96}},{name:"LocalParticipantView",props:{style:{position:"absolute",bottom:T(a,e,o.bottom),top:y(a,e,o.top),right:e?Math.max(C,o.right):C}}},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"MobileTopBanner",props:{style:{position:"relative",marginTop:e?o.top:0,top:0,left:0,right:0,padding:8},bannerStyle:{margin:2,paddingTop:g,paddingBottom:g,paddingLeft:g,paddingRight:g,borderRadius:8,backgroundColor:i.themeColors.surfaceDarkFixed}}},{name:"LocalParticipantGestureView",props:{gesturesWrapperStyle:e?{marginTop:Math.max(C,o.top),marginRight:Math.max(C,o.right),marginBottom:Math.max(C,o.bottom),marginLeft:Math.max(C,o.left)}:void 0}},{name:"Column",key:"optional-in-call-buttons",props:{style:{position:"absolute",bottom:0,left:0,right:0,padding:16,paddingBottom:48},pointerEvents:"box-none"},children:[{name:"TranscriptionView",props:{position:"float",paddingBottom:4,paddingTop:4,style:{marginTop:16,marginLeft:0,marginRight:0,marginBottom:0,bottom:0,position:"relative",backgroundColor:c.Color.transparent}}},{name:"InCallPstnTranslatorButton",props:{style:{marginTop:16,marginLeft:0,marginRight:0,marginBottom:0,bottom:0,position:"relative"}}},{name:"AudioNotifications",props:{style:{position:"relative",paddingTop:8,paddingLeft:8,paddingRight:8,paddingBottom:8,height:void 0,bottom:0,margin:0}}},{name:"AloneInTheCallInformation",props:{style:{position:"relative",backgroundColor:c.Color.transparent,paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:16}}},{name:"OptionalNetworkInCallWarning",props:{style:{marginTop:0,marginLeft:0,marginRight:0,marginBottom:0,height:void 0}}}]}]},{name:"Tray",props:{showTrayVertically:!1,traySizeMultiplier:.8,showCompactReactions:!1,style:{flex:0,position:"relative",alignSelf:"auto",borderTopWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,marginHorizontal:e?8:14,marginTop:e?8:0,marginBottom:e?8:14,top:0},participantsAccessoryPosition:d.CallAccessoryPosition.BottomLeftSmallPadding,participantsStyle:_}},{name:"TranscriptionView",props:{position:"bottom",paddingBottom:4,paddingTop:0,style:{paddingLeft:4,paddingRight:4,marginBottom:e?0:t.StagePadding,marginLeft:e?0:t.StagePadding,marginRight:e?0:t.StagePadding,borderRadius:e?0:8,backgroundColor:p,flexBasis:"35%"}}},{name:"TranscriptionNotifications",props:{headerHeight:e?0:192,bottomInset:e?0:o.bottom,style:{position:"absolute",top:e?8:t.StagePadding,left:e?8:t.StagePadding,right:e?8:t.StagePadding,marginBottom:e?0:70,padding:12}}},{name:"ReactionsPanel"},{name:"TransientView"}]},{name:"Column",key:"call-controls-wrapper",props:{style:{backgroundColor:c.Color.transparent}},children:[{name:"LayoutAnimationContainer",key:"call-controls-container",props:{hidden:e,style:{paddingTop:0,paddingBottom:Math.max(t.StagePadding,o.bottom),paddingLeft:t.StagePadding,paddingRight:t.StagePadding}},children:[{name:"FlexCallControls",props:{style:{opacity:1,paddingVertical:0,paddingHorizontal:0},isUsingSkypeTheme:!0}}]}]},{name:"Dialpad"}]}])(i):[{name:"ZStack",props:{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}},children:[{name:"CallStage"},{name:"Tray"},{name:"ReactionsPanel"},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"TranscriptionView"},{name:"AloneInTheCallInformation"},{name:"TransientView"},{name:"CallControls"},{name:"MobileTopBanner"}]},{name:"CallPanelHeader"},{name:"Dialpad"},{name:"AudioNotifications"}]}return e}),[P,o,b,v,I,M,D,l,h,A]);return(0,a.jsx)(a.Fragment,{children:e(k,i,0)})},t.CallPanelLayout=(0,h.WithResub)(t.CallPanelLayoutInternal,(e=>{const t=u.default.isTablet(),i=l.default.getS4LCMCFeatures(),{enableAutoLetterBoxOnMobile:o}=i,{enablePortraitFlex:a,enableLandscapeFlex:n,enableAnimationV2:s}=i.enableNewCallPanel;return Object.assign(Object.assign({},e),{isTablet:t,enablePortraitFlex:a,enableLandscapeFlex:n,enableAnimationV2:s,enableAutoLetterBoxOnMobiles:o})}))},869622:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({hidden:e,style:t,children:i,duration:o=250}){const[r,l]=n.useState(e);if(n.useEffect((()=>{s.LayoutAnimation.configureNext({duration:o,create:{type:s.LayoutAnimation.Types.easeInEaseOut,property:s.LayoutAnimation.Properties.opacity},update:{type:s.LayoutAnimation.Types.easeInEaseOut}}),l(e)}),[e,o]),r)return null;return(0,a.jsx)(s.View,{style:Object.assign({},t||{}),children:i})};const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180);"android"===s.Platform.OS&&s.UIManager.setLayoutAnimationEnabledExperimental&&s.UIManager.setLayoutAnimationEnabledExperimental(!0)},503332:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=i(167606),l=i(132680),c=i(82485),d=o.__importDefault(i(878575)),u=o.__importDefault(i(201721)),h=o.__importDefault(i(638260)),p=o.__importDefault(i(760989)),g=i(170938),C=i(93352),m=i(276602);t.default=e=>{const[t,i]=n.useState({width:0,height:0}),[o,S]=n.useState({width:0,height:0}),[_,f]=n.useState((0,C.getDefaultPosition)()),[y,T]=n.useState(1),b=(0,C.getMaxScale)(t.width,t.height),v=n.useRef(new s.Animated.ValueXY).current,I=n.useRef(new s.Animated.Value(1)).current,w=n.useRef(new s.Animated.Value(1)).current,P=n.useRef(t),M=n.useRef(o),D=n.useRef(_),A=n.useRef(y),k=n.useRef(b),R=n.useRef(e.callId),x=n.useRef(!!e.isProvidingVideo);n.useEffect((()=>{P.current=t,k.current=(0,C.getMaxScale)(t.width,t.height)}),[t]),n.useEffect((()=>{M.current=o}),[o]),n.useEffect((()=>{D.current=_}),[_]),n.useEffect((()=>{A.current=y}),[y]),n.useEffect((()=>{f((0,C.getDefaultPosition)(e.isTranslating))}),[e.isTranslating]),n.useEffect((()=>{R.current=e.callId,x.current=!!e.isProvidingVideo}),[e.callId,e.isProvidingVideo]);const L=t=>{if(A.current!==t&&(c.Instrumentation.log(r.LogTraceArea.CallingUI,`LocalParticipantGestureView._changeViewScaling: ${t}`),I.setValue(t),T(t),.6===t||t===k.current)){const t=p.default.newCauseId();h.default.updateCallTelemetry(e.callId,t,(e=>e.resizeOwnPreview()))}},B=n.useRef(s.PanResponder.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:()=>!0,onPanResponderMove:(e,t)=>{w.setValue(.8);const i=e.nativeEvent.changedTouches.length;if(1===i)v.setValue({x:t.dx,y:t.dy});else if(i>=2){const t=e.nativeEvent.changedTouches,i=t[0],o=t[1],a=(0,C.getTouchDistance)([i.pageX,i.pageY],[o.pageX,o.pageY])/(l.LocalPreviewLongerSideSize/2);a<=.6?L(.6):a>=k.current?L(k.current):L(a)}},onPanResponderRelease:(t,i)=>{if(0===i.dx&&0===i.dy)return x.current&&(()=>{c.Instrumentation.log(r.LogTraceArea.CallingUI,"LocalParticipantGestureView._onLocalParticipantTap");const e=new m.SwitchCameraCommand(R.current,x.current);e.canExecute()&&e.execute()})(),void w.setValue(1);((t,i)=>{if(D.current!==t){c.Instrumentation.log(r.LogTraceArea.CallingUI,`LocalParticipantGestureView._changeViewPosition: ${t}`),f(t),v.setValue((0,C.convertTranslateValue)({x:i.dx,y:i.dy},D.current,t,P.current,M.current,A.current)),u.default.setUserPreferencesLocal({localCallParticipantViewPosition:t});const o=p.default.newCauseId();h.default.updateCallTelemetry(e.callId,o,(e=>e.moveOwnPreview()))}})((0,C.getNewViewPosition)(D.current,i,P.current),i),s.Animated.timing(v,{toValue:{x:0,y:0},duration:200,easing:s.Easing.out(s.Easing.ease),useNativeDriver:!0}).start(),w.setValue(1)}})).current;return(0,a.jsx)(s.View,{style:[g.localParticipantGestureViewStyles.wrapper,e.gesturesWrapperStyle],pointerEvents:"box-none",onLayout:e=>{var{width:t,height:o}=e.nativeEvent.layout;i({width:t,height:o})},children:(0,a.jsx)(s.Animated.View,Object.assign({},B.panHandlers,{style:[g.viewPostitionStyles[_],{transform:[{translateX:v.x},{translateY:v.y},{scale:I}]},{opacity:w},{marginHorizontal:(o.width*y-o.width)/2},{marginVertical:(o.height*y-o.height)/2}],onLayout:e=>{var{width:t,height:i}=e.nativeEvent.layout;S({width:t,height:i})},children:(0,a.jsx)(d.default,Object.assign({},e,{style:void 0}))}))})}},93352:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMaxScale=t.getDefaultPosition=t.getTouchDistance=t.convertTranslateValue=t.getNewViewPosition=t.DefaultPadding=void 0;const o=i(197582).__importDefault(i(201721)),a=i(132680),n=i(460515);t.DefaultPadding=16;const s={topLeft:{xy:n.LocalParticipantViewPosition.bottomRight,x:n.LocalParticipantViewPosition.topRight,y:n.LocalParticipantViewPosition.bottomLeft},topRight:{xy:n.LocalParticipantViewPosition.bottomLeft,x:n.LocalParticipantViewPosition.topLeft,y:n.LocalParticipantViewPosition.bottomRight},bottomLeft:{xy:n.LocalParticipantViewPosition.topRight,x:n.LocalParticipantViewPosition.bottomRight,y:n.LocalParticipantViewPosition.topLeft},bottomRight:{xy:n.LocalParticipantViewPosition.topLeft,x:n.LocalParticipantViewPosition.bottomLeft,y:n.LocalParticipantViewPosition.topRight}};t.getNewViewPosition=(e,t,i)=>{const o=((e,t)=>{switch(e){case n.LocalParticipantViewPosition.topLeft:case n.LocalParticipantViewPosition.bottomLeft:return t.dx;case n.LocalParticipantViewPosition.topRight:case n.LocalParticipantViewPosition.bottomRight:return-t.dx}})(e,t),a=((e,t)=>{switch(e){case n.LocalParticipantViewPosition.topLeft:case n.LocalParticipantViewPosition.topRight:return t.dy;case n.LocalParticipantViewPosition.bottomLeft:case n.LocalParticipantViewPosition.bottomRight:return-t.dy}})(e,t),r=i.width/3,l=i.height/3,c=s[e];return o>=r?a>=l?c.xy:c.x:a>=l?c.y:e};t.convertTranslateValue=(e,t,i,o,a,s)=>{const r=e,l=a.width*s,c=a.height*s;switch(t+i){case n.LocalParticipantViewPosition.topLeft+n.LocalParticipantViewPosition.topRight:case n.LocalParticipantViewPosition.topLeft+n.LocalParticipantViewPosition.bottomRight:case n.LocalParticipantViewPosition.bottomLeft+n.LocalParticipantViewPosition.bottomRight:case n.LocalParticipantViewPosition.bottomLeft+n.LocalParticipantViewPosition.topRight:r.x=-o.width+e.x+l;break;case n.LocalParticipantViewPosition.bottomRight+n.LocalParticipantViewPosition.topLeft:case n.LocalParticipantViewPosition.bottomRight+n.LocalParticipantViewPosition.bottomLeft:case n.LocalParticipantViewPosition.topRight+n.LocalParticipantViewPosition.bottomLeft:case n.LocalParticipantViewPosition.topRight+n.LocalParticipantViewPosition.topLeft:r.x=o.width+e.x-l}switch(t+i){case n.LocalParticipantViewPosition.topLeft+n.LocalParticipantViewPosition.bottomLeft:case n.LocalParticipantViewPosition.topLeft+n.LocalParticipantViewPosition.bottomRight:case n.LocalParticipantViewPosition.topRight+n.LocalParticipantViewPosition.bottomLeft:case n.LocalParticipantViewPosition.topRight+n.LocalParticipantViewPosition.bottomRight:r.y=-o.height+e.y+c;break;case n.LocalParticipantViewPosition.bottomRight+n.LocalParticipantViewPosition.topLeft:case n.LocalParticipantViewPosition.bottomRight+n.LocalParticipantViewPosition.topRight:case n.LocalParticipantViewPosition.bottomLeft+n.LocalParticipantViewPosition.topLeft:case n.LocalParticipantViewPosition.bottomLeft+n.LocalParticipantViewPosition.topRight:r.y=o.height+e.y-c}return r};t.getTouchDistance=([e,t],[i,o])=>Math.sqrt(Math.pow(e-i,2)+Math.pow(t-o,2));t.getDefaultPosition=e=>{var t;return e?n.LocalParticipantViewPosition.topRight:null!==(t=o.default.getUserPreferencesLocalNoSubscription().localCallParticipantViewPosition)&&void 0!==t?t:n.LocalParticipantViewPosition.bottomRight};t.getMaxScale=(e,i)=>0===e||0===i?1:(Math.min(e,i)-2*t.DefaultPadding)/a.LocalPreviewLongerSideSize},170938:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.viewPostitionStyles=t.localParticipantGestureViewStyles=void 0;const o=i(537180),a=i(93352);t.localParticipantGestureViewStyles=o.StyleSheet.create({wrapper:{flexGrow:1,flexShrink:1,margin:a.DefaultPadding},topLeft:{position:"absolute",top:0,left:0},topRight:{position:"absolute",top:0,right:0},bottomLeft:{position:"absolute",bottom:0,left:0},bottomRight:{position:"absolute",bottom:0,right:0}}),t.viewPostitionStyles={topLeft:t.localParticipantGestureViewStyles.topLeft,topRight:t.localParticipantGestureViewStyles.topRight,bottomLeft:t.localParticipantGestureViewStyles.bottomLeft,bottomRight:t.localParticipantGestureViewStyles.bottomRight}},878575:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(667294)),r=i(537180),l=i(152803),c=i(460515),d=o.__importDefault(i(132680)),u=i(26703),h=i(16549),p=o.__importDefault(i(827361)),g=i(641400),C=i(276602),m=(0,u.lazyProperties)({participantView:()=>n.Styles.createViewStyle({borderRadius:g.IconSize.size8,overflow:"hidden",shadowOffset:{width:0,height:4},shadowRadius:4,shadowColor:h.Color.blackOverlay70}),participantViewDark:()=>n.Styles.createViewStyle({backgroundColor:h.Color.callStageLight}),participantViewLight:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray50})});t.default=s.memo((({callId:e,conversationMri:t,isLightTheme:i,style:o,isProvidingVideo:n,getCallReactionsDisplayHelper:u})=>{const[h]=s.useState((()=>({getStyles:(e,t,i)=>[p.default.flexOne,m.participantView,d.default.getLocalPreviewMobilesShape(t)],getInnerStyles:()=>[p.default.flexOne],getBackgroundColorStyle:e=>e?m.participantViewLight:m.participantViewDark,isHidden:()=>!1}))),g=s.useCallback(((t,i)=>{const o=new C.SwitchCameraCommand(e,!!n);o.canExecute()&&o.execute()}),[e,n]);return(0,a.jsx)(r.View,{style:o,children:(0,a.jsx)(l.CallParticipantView,{renderKey:c.CallStageElementKeys.localUserKey,parentViewId:"LocalParticipantView",getCallReactionsDisplayHelper:u,callId:e,conversationMri:t,useDarkBackground:!0,desktopNameTag:!0,showContextMenu:!0,layoutController:()=>h,iconSize:64,iconOpacity:1,isGroupCall:!1,useLightTheme:i,onTap:g},c.CallStageElementKeys.localUserKey)})}))},741338:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(537180),r=o.__importStar(i(44717)),l=i(848822),c=o.__importDefault(i(252089)),d=i(403396),u=i(596648),h=s.StyleSheet.create({container:{flex:1,paddingHorizontal:50,alignItems:"center",justifyContent:"center",overflow:"visible"},fullWidthAndHeight:{width:"100%",height:"100%"},circlePosition:{position:"absolute",top:8,right:8,bottom:8,left:8},roundContainer:{borderRadius:99999999},overflowHidden:{overflow:"hidden"}});t.default=n.memo((({conversationId:e})=>{const t=n.useRef(new s.Animated.Value(0)),i=n.useRef(new s.Animated.Value(0)),o=n.useRef();n.useEffect((()=>(o.current=s.Animated.sequence([s.Animated.timing(t.current,{toValue:1,duration:200,delay:50,useNativeDriver:!0}),s.Animated.loop(s.Animated.sequence([s.Animated.timing(i.current,{easing:s.Easing.cubic,toValue:1,duration:2e3,useNativeDriver:!0}),s.Animated.spring(i.current,{toValue:0,stiffness:200,useNativeDriver:!0})]))]),o.current.start(),o.current.stop)),[]);const p=r.isOneOnOneConversation(e)?(0,a.jsx)(d.UserIcon,{userMri:e,forceMediumAvatarSize:!0,size:u.UserIconSize.Size160}):(0,a.jsx)(l.ConversationIcon,{conversationId:e,size:u.ConversationIconSize.Size160});return(0,a.jsx)(s.View,{style:[h.container,h.fullWidthAndHeight],children:(0,a.jsxs)(s.Animated.View,{style:{opacity:t.current},children:[(0,a.jsx)(s.Animated.View,{style:[h.circlePosition,h.roundContainer,h.overflowHidden,{borderColor:c.default.getPrimaryColorNoSubscription(),borderWidth:4,transform:[{scale:i.current.interpolate({inputRange:[0,1],outputRange:[1,1.5]})}]}]}),(0,a.jsx)(s.Animated.View,{style:[h.roundContainer,h.overflowHidden,{transform:[{scale:i.current.interpolate({inputRange:[0,1],outputRange:[1,.8]})}]}],children:p})]})})}))},37392:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallPanel=void 0;const o=i(197582);var a=i(823759);Object.defineProperty(t,"CallPanel",{enumerable:!0,get:function(){return o.__importDefault(a).default}})},768877:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(460515),r=o.__importDefault(i(970035)),l=i(26703),c=o.__importDefault(i(117475)),d=o.__importDefault(i(377556)),u=i(16549),h=i(641400),p=o.__importDefault(i(760989)),g=o.__importDefault(i(958868)),C=12,m=(0,l.lazyProperties)({accessory:()=>n.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:u.Color.blackOverlay50,alignItems:"center",justifyContent:"center"}),redesignedAccessoryDark:()=>n.Styles.createViewStyle({backgroundColor:u.Color.blackOverlay50,borderRadius:5}),redesignedAccessoryLight:()=>n.Styles.createViewStyle({backgroundColor:u.Color.whiteOverlay80,borderRadius:5}),accessoryTopLeft:()=>n.Styles.createViewStyle({left:C,top:C}),accessoryTopRight:()=>n.Styles.createViewStyle({position:"absolute",right:C,top:C}),accessoryBottomLeft:()=>n.Styles.createViewStyle({position:"absolute",left:C,bottom:C}),accessoryBottomLeftSmallPadding:()=>n.Styles.createViewStyle({position:"absolute",left:8,bottom:8}),accessoryBottomRight:()=>n.Styles.createViewStyle({position:"absolute",right:C,bottom:C}),accessoryBottomRightSmallPadding:()=>n.Styles.createViewStyle({position:"absolute",right:8,bottom:8}),accessoryCenterContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:100,height:24,alignItems:"center",justifyContent:"center"})});class S extends g.default{_buildState(e,t){return{safeAreaHorizontalInsets:c.default.horizontalInsets({left:C,right:30})}}_styleForAccessoryPosition(e){switch(e){case s.CallAccessoryPosition.BottomLeft:return m.accessoryBottomLeft;case s.CallAccessoryPosition.BottomRight:return m.accessoryBottomRight;case s.CallAccessoryPosition.BottomLeftSmallPadding:return m.accessoryBottomLeftSmallPadding;case s.CallAccessoryPosition.BottomRightSmallPadding:return m.accessoryBottomRightSmallPadding;case s.CallAccessoryPosition.TopLeft:return m.accessoryTopLeft;case s.CallAccessoryPosition.TopRight:return m.accessoryTopRight}}render(){const e=this.props.position===s.CallAccessoryPosition.Center,t=[m.accessory];if(this.props.enableRedesignedStyle&&t.push(this._getContext().mode.isDark?m.redesignedAccessoryDark:m.redesignedAccessoryLight),!e&&this.props.position){const e=this._styleForAccessoryPosition(this.props.position);if(e&&t.push(e),this.props.position===s.CallAccessoryPosition.BottomRight||this.props.position===s.CallAccessoryPosition.TopRight){!!this.state.safeAreaHorizontalInsets&&d.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&t.push(d.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets))}}let i;switch(this.props.type){case s.CallAccessoryType.Mute:i=h.SkypeIcon.MicrophoneOff;break;case s.CallAccessoryType.OnHold:i=h.SkypeIcon.Pause;break;case s.CallAccessoryType.Screensharing:i=h.SkypeIcon.ScreenShare;break;default:i=p.default.switchStatementExhaustiveChecking(this.props.type)}let o=(0,a.jsx)(n.View,{style:t,blockPointerEvents:!0,ignorePointerEvents:!0,children:(0,a.jsx)(r.default,{icon:i,size:h.IconSize.size12,color:this.props.enableRedesignedStyle?this._getContext().themeColors.textPrimary:u.Color.white})});return e&&(o=(0,a.jsx)(n.View,{style:m.accessoryCenterContainer,blockPointerEvents:!0,ignorePointerEvents:!0,children:o})),o}}t.default=S},898290:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantBackgroundReplaceCaption=void 0;const o=i(197582),a=i(785893),n=i(174958),s=o.__importStar(i(516778)),r=i(148540),l=o.__importStar(i(317588)),c=o.__importDefault(i(150343)),d=o.__importDefault(i(196687)),u=o.__importDefault(i(433035)),h=o.__importDefault(i(369347)),p=o.__importDefault(i(60433)),g=o.__importStar(i(873324)),C=o.__importDefault(i(638260)),m=o.__importDefault(i(543915)),S=i(815146),_=o.__importDefault(i(970035)),f=o.__importStar(i(85385)),y=o.__importStar(i(50350)),T=o.__importStar(i(704704)),b=i(26703),v=o.__importDefault(i(363091)),I=i(641400),w=i(262725),P=o.__importDefault(i(497910)),M=i(16549),D=o.__importDefault(i(760989)),A=o.__importDefault(i(827361)),k=o.__importDefault(i(220534)),R=(0,b.lazyProperties)({modernStageBackgroundInfo:()=>s.Styles.createViewStyle({position:"absolute",overflow:"hidden",alignItems:"flex-start",justifyContent:"flex-start"}),bgInfoContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),topContainer:()=>s.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",borderRadius:4,paddingHorizontal:8,paddingVertical:8,marginRight:6}),topContainerBg:()=>s.Styles.createViewStyle({backgroundColor:M.Color.blackOverlay70}),topContainerBgLight:()=>s.Styles.createViewStyle({backgroundColor:M.Color.whiteOverlay80}),topContainerBgLightTray:()=>s.Styles.createViewStyle({backgroundColor:M.Color.gray50overlay95}),topLineContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),bottomLineContainer:()=>s.Styles.createViewStyle({paddingTop:0,flexDirection:"column-reverse",alignItems:"flex-start",height:16}),bingLineContainer:()=>s.Styles.createViewStyle({paddingTop:4,marginTop:6,flexDirection:"column-reverse",alignItems:"flex-start",borderTopWidth:1,flexGrow:1,borderColor:M.Color.whiteOverlay50}),bingLineText:()=>s.Styles.createTextStyle({color:M.Color.whiteOverlay70}),bingLineTextLight:()=>s.Styles.createTextStyle({color:M.Color.gray400}),nameText:()=>s.Styles.createTextStyle({color:M.Color.white}),nameTextLight:()=>s.Styles.createTextStyle({color:M.Color.gray400}),nameTextHover:()=>s.Styles.createTextStyle({textDecorationLine:"underline"}),iconLeft:()=>s.Styles.createViewStyle({margin:0}),iconLeftAlone:()=>s.Styles.createViewStyle({margin:0}),bingIconLeft:()=>s.Styles.createViewStyle({height:16,width:16})});class x extends P.default{constructor(e){super(e),this._onClick=()=>{if(this.state.backgroundEffectImageInfo){const e=this.state.backgroundEffectImageInfo,t=e.link;if(f.log(S.LogTraceArea.CallingUI,`Clicking other user Bing background effect info. IsoDate: ${e.isoDate}, Info exists: ${!!t}, IsCollapsed: ${this.state.isCollapsed}, EffectUser: ${n.pii.Mri(this.state.mri)}`),this.props.callId){const t=D.default.newCauseId();C.default.updateCallTelemetry(this.props.callId,t,(e=>e.bingBackgroundEffectCaptionClick())),f.track(new g.BackgroundEffectsBingInfoClickEvent(this.props.callId,e.isoDate,this.state.mri,e.market,this.state.isCollapsed))}if(t){const e=c.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;let i=`${e.host}${t}`;e.clickLinkPartnerCode&&""!==e.clickLinkPartnerCode&&k.default.isUrlValid(i)&&(i=k.default.addUrlParameter(i,"pc",e.clickLinkPartnerCode));const o={browserTitle:T.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!d.default.canNavigateInApp(),conversationId:this.props.conversationMri,openInExternalBrowser:!e.tryOpenInAppBrowser,useBingMiniCanvas:!0};y.openUrlWithParams({origin:S.BrowserOrigin.LinkNode,url:i,options:o,rootViewId:this._getRootViewId()})}}},this._onMouseEnter=e=>{this.props.onMouseEnter&&this.props.onMouseEnter(e),this.setState({hover:!0})},this._onMouseLeave=e=>{this.props.onMouseLeave&&this.props.onMouseLeave(e),this.setState({hover:!1})},this._onKeyPress=e=>m.default.maybeHandleKeyPress(e,(()=>{this._onClick()}));const t=this._layoutController();t.onRectChanged&&t.onRectChanged((e=>{this._findSizeAndOffset(e)}))}_buildState(e,t){let i=e.renderInfo;e.callId&&!e.renderInfo&&(i=h.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const o=(null==i?void 0:i.mri)||this._extractMriForKey(i,e.renderKey,!1),a={renderInfo:i,mri:o,streamType:(null==i?void 0:i.renderScreenShare)?r.StreamType.ScreenSharing:r.StreamType.Video,backgroundEffectId:h.default.DeviceStore.getBackgroundEffectType()};e.callId&&(a.backgroundEffectImageInfo=h.default.CallParticipantBackgroundInfoStore.getBackgroundInfo(e.callId,o),a.backgroundEffectImageInfo||h.default.CallingStore.isCallConnected(e.callId)||!a.backgroundEffectId||(a.backgroundEffectImageInfo=u.default.getBingBackgroundImageInfoFromId(a.backgroundEffectId,e.callId,o)));const n=this._layoutController();if(n.viewRect){const e=n.viewRect();a.width=e.width,a.height=e.height}return a.isCollapsed=this._isCollapsed(a.width,e.noExpand),a}componentDidMount(){super.componentDidMount(),this._findSizeAndOffset()}_isCollapsed(e,t){return c.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.captionAlwaysCollapsed||e&&e<500||!!t}_getOptionalBackgroundEffectInfo(){if(!this.state.backgroundEffectImageInfo)return;const e=this.state.backgroundEffectImageInfo,t=e.caption,i=e.copyright;if(!t)return;const o=this._getCaptionOffset(),n=this.state.width?Math.round(this.state.width-2*o.left):void 0,r=s.Styles.createViewStyle({top:o.top,left:o.left,maxWidth:n},!1),l=n?Math.round(n-16-44):void 0,c=s.Styles.createViewStyle({maxWidth:l},!1),d=[R.modernStageBackgroundInfo,r];this.props.nametagOpacityStyle&&d.push(this.props.nametagOpacityStyle);const u=[this.props.useLightTheme?R.nameTextLight:R.nameText,c,A.default.pointerCursor];this.state.hover&&u.push(R.nameTextHover);const h=I.SkypeIcon.Search,p=this.state.isCollapsed&&(!this.state.hover||this.props.noExpand),g=this._iconView(h,p?R.iconLeftAlone:R.iconLeft),C=this.props.useLightTheme?this.props.isInTray?R.topContainerBgLightTray:R.topContainerBgLight:R.topContainerBg,m=this.props.useLightTheme?R.bingLineTextLight:R.bingLineText,S=(0,a.jsx)(s.Animated.View,{style:[R.topContainer,C,A.default.pointerCursor],children:g});let _;if(p)_=(0,a.jsx)(s.Animated.View,{style:R.bgInfoContainer,children:S});else{const e=(0,a.jsxs)(s.Animated.View,{style:[R.topContainer,C],children:[(0,a.jsx)(s.Animated.View,{style:[R.topLineContainer],children:(0,a.jsx)(w.Caption,{style:u,numberOfLines:1,children:t})}),(0,a.jsx)(s.Animated.View,{style:R.bottomLineContainer,children:(0,a.jsx)(w.Caption,{small:!0,numberOfLines:1,style:c,children:i})}),(0,a.jsx)(s.Animated.View,{style:R.bingLineContainer,children:(0,a.jsx)(w.Caption,{small:!0,numberOfLines:1,style:[c,m],children:T.getString("AudioVideoSettings.BackgroundEffectCategoryBing")})})]});_=(0,a.jsxs)(s.Animated.View,{style:R.bgInfoContainer,children:[S,e]})}return(0,a.jsx)(s.Animated.View,{style:d,ignorePointerEvents:!0,onPress:this._onClick,onKeyPress:this._onKeyPress,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,accessibilityTraits:s.Types.AccessibilityTrait.Button,blockPointerEvents:!1,tabIndex:0,children:_},"BingCaptionWrapper-"+this.state.mri)}render(){var e,t,i,o;const a=c.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,n=0===(null===(t=null===(e=this.state.renderInfo)||void 0===e?void 0:e.videoDimensions)||void 0===t?void 0:t.height)||0===(null===(o=null===(i=this.state.renderInfo)||void 0===i?void 0:i.videoDimensions)||void 0===o?void 0:o.width);return this.props.hideCaption||!a.showBackgroundCaptions||this.state.streamType!==r.StreamType.Video||n?[void 0]:[this._getOptionalBackgroundEffectInfo()]}_getCaptionOffset(){const e=this.props.isInTray?10:12;return{top:e,left:e}}_extractMriForKey(e,t,i=!1){return(null==e?void 0:e.isLocal)?v.default.getSkypeMri():p.default.extractMriFromKey(t,i)}_layoutController(){var e,t;return this.props.layoutController(this.props.renderKey,!!(null===(t=null===(e=this.state)||void 0===e?void 0:e.renderInfo)||void 0===t?void 0:t.renderScreenShare))}_findSizeAndOffset(e){var t,i;if(this.isComponentMounted()){const o=e||(null===(i=(t=this._layoutController()).viewRect)||void 0===i?void 0:i.call(t));o&&this.setState({width:o.width,height:o.height,isCollapsed:this._isCollapsed(o.width,this.props.noExpand)})}}_iconView(e,t){return c.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.useBingLogoInsteadOfSearchIcon?(0,a.jsx)(s.Image,{source:l.Collection.BING_LOGO_SMALL,style:[t,R.bingIconLeft],resizeMode:"cover"}):e?(0,a.jsx)(_.default,{icon:e,color:M.Color.white,size:I.IconSize.size16,style:t}):void 0}}t.CallParticipantBackgroundReplaceCaption=x,t.default=x},389219:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(496486)),r=i(815063),l=o.__importDefault(i(827361)),c=i(16549),d=i(26703),u=o.__importDefault(i(638260)),h=o.__importStar(i(85385)),p=o.__importStar(i(873324)),g=o.__importDefault(i(497910)),C=o.__importDefault(i(554715)),m=o.__importDefault(i(18983)),S=(0,d.lazyProperties)({gestureButton:()=>n.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:c.Color.transparent}),gestureButtonInsets:()=>n.Styles.createViewStyle({left:-20,right:-20,top:0,bottom:-40}),innerContainer:()=>l.default.absoluteFill,innerContainerCentered:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"flex-end",paddingBottom:5})});class _ extends g.default{constructor(){super(...arguments),this._isPanning=!1,this._handleMouseCursorChange=e=>{this.setState({mouseCursor:e})},this._handleZoomLevelChange=e=>{this.setState({zoomLevel:e})},this._setZoomLevelFromUIControls=e=>{var t;null===(t=this._zoomController)||void 0===t||t.handleUIControlsZoom(e)},this._handleLayoutChange=e=>{var t;null===(t=this._zoomController)||void 0===t||t.updateScreenShareElementSizes(e)},this._onLongPressHandler=()=>this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this.props.getContextMenuHandler(!1):this._onLongPress,this._onMultiTouchGesture=e=>{if(this.isComponentMounted()&&this.props.zoomEnabled){if(!this._isPanning){Math.abs(e.initialCenterPageX-e.centerPageX)>20&&(this._isPanning=!0)}if(this._isPanning){const t=this._panPosition||{x:e.centerPageX,y:e.initialCenterPageY},i={x:e.centerPageX,y:e.centerPageY},o=i.x-t.x,a=i.y-t.y,n=this.props.getCallParticipantVideoViews();s.each(n,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:o,y:a})})),this._panPosition=i}else{const t=e.distance/e.initialDistance;this.props.sizeToFit?t>=1.3&&(u.default.onZoomIn(this.props.callId||""),h.track(new p.Zoom),this.props.setSizeToFit(!1)):t<=.7&&(u.default.onZoomOut(this.props.callId||""),h.track(new p.Zoom),this.props.setSizeToFit(!0))}}e.isComplete&&(this._panPosition=void 0,this._isPanning=!1)},this._onLongPress=()=>{},this._onScrollWheel=e=>{var t;null===(t=this._zoomController)||void 0===t||t.handleScrollZoom(e)},this._onPan=e=>{if(this._zoomController)this._zoomController.handleDragging(e);else if(this.props.zoomEnabled&&!this.props.isCompact){const t=this._panPosition||{x:e.pageX,y:e.initialPageY},i={x:e.pageX,y:e.pageY},o=i.x-t.x,a=i.y-t.y,n=this.props.getCallParticipantVideoViews();s.each(n,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:o,y:a})})),this._panPosition=i,e.isComplete&&(this._panPosition=void 0)}},this._onTap=e=>{const t=this._getNormalizedTimestamp(e);this._sendTapEvent(t)},this._sendTapEvent=e=>{this.props.onTap&&this.props.onTap(this.props.renderKey,e)}}_buildState(e,t){const i={};return t&&(i.mouseCursor=void 0,i.zoomLevel=0),i}componentDidMount(){super.componentDidMount(),this.props.isScreenShareZoomEnabled&&(this._zoomController=new C.default({getVideoElement:this.props.getScreenShareVideoElement,onMouseCursorChange:this._handleMouseCursorChange,onZoomLevelChange:this._handleZoomLevelChange,callId:this.props.callId||""}))}componentWillUnmount(){super.componentWillUnmount(),this._stopZoomController()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.props.zoomEnabled&&e.zoomEnabled&&(this._isPanning=!1,this._panPosition=void 0)}render(){const e=[S.gestureButton],t=!r.BrowserEnvironment.isMobile(),i=t?[S.innerContainer,l.default.overflowVisible,n.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)]:[S.innerContainerCentered,l.default.overflowVisible];return(0,a.jsxs)(n.View,{style:{flex:1},onLayout:this._handleLayoutChange,children:[(0,a.jsxs)(n.GestureView,{style:i,onPan:this._onPan,onPinchZoom:this.props.zoomEnabled?this._onMultiTouchGesture:void 0,onScrollWheel:this._onScrollWheel,panPixelThreshold:this.props.isCompact?void 0:25,mouseOverCursor:this.state.mouseCursor,importantForAccessibility:this._getImportantForAccessibility(t),children:[this.props.contentView,this.props.accessoryView,this.props.optionalRaiseHandAccessory,t?(0,a.jsx)(n.View,{style:e,onPress:this.props.onTap?this._onTap:void 0,onLongPress:this.props.onTap?this._onLongPress:void 0,accessibilityLabel:this.props.displayName,accessibilityTraits:n.Types.AccessibilityTrait.Button,onContextMenu:this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this.props.getContextMenuHandler(!1):void 0}):(0,a.jsx)(n.Button,{style:e,onPress:this.props.onTap?this._onTap:void 0,onLongPress:this.props.enableActionMenuOnMobile&&this.props.onTap?this._onLongPressHandler():void 0,accessibilityLabel:this.props.displayName,onContextMenu:this.props.showContextMenu?this.props.getContextMenuHandler(!1):void 0,tabIndex:this.props.isCompact?void 0:-1}),this.props.optionalNameTagLine,this.props.optionalBackgroundInfo]},"gestureView"),this._renderScreenShareZoomControls()]})}_stopZoomController(){this._zoomController&&(this._zoomController.stop(),this._zoomController=void 0)}_renderScreenShareZoomControls(){return this.props.isScreenShareZoomEnabled?(0,a.jsx)(m.default,{setZoomLevel:this._setZoomLevelFromUIControls,currentZoomLevel:this.state.zoomLevel,isNavigatingWithKeyboard:this.props.isNavigatingWithKeyboard}):void 0}_getImportantForAccessibility(e){return this.props.isNavigatingWithKeyboard&&this.props.isCompact?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No}_shouldShowContextMenuForNewStage(){return!this.props.isLargeGridBot&&!this.props.isScreenSharing&&(!this.props.isTogetherModeBot||this.props.showChangeTogetherModeBackgroundOption)}_getNormalizedTimestamp(e){return Date.now()}}t.default=_},313311:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(497910)),r=i(16549),l=i(26703),c=o.__importDefault(i(132680)),d=i(812119),u=(0,l.lazyProperties)({nameTag:()=>n.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:10,alignItems:"center",justifyContent:"center",overflow:"visible"}),nametagAndAccessoriesLine:()=>n.Styles.createViewStyle({position:"absolute",flexDirection:"row",justifyContent:"space-between",bottom:12,left:12,right:12,alignSelf:"stretch",flexBasis:0,flexGrow:1,overflow:"hidden",alignItems:"flex-end"}),nametagAndAccessoriesLineTray:()=>n.Styles.createViewStyle({bottom:10,left:10,right:10}),presenterAccessory:()=>n.Styles.createViewStyle({width:24,height:24,borderRadius:12,backgroundColor:r.Color.white,alignItems:"center",justifyContent:"center",marginLeft:8,overflow:"hidden"}),smallAccessoryInnerView:()=>n.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:r.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>n.Styles.createViewStyle({backgroundColor:r.Color.white}),desktopNameTag:()=>n.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),desktopNameTagLeft:()=>n.Styles.createViewStyle({position:"relative",alignItems:"flex-end",alignSelf:"stretch",flexDirection:"row",flexShrink:1,left:0,right:0,overflow:"hidden"})});class h extends s.default{render(){let e;if(this.props.isPresenter){const t=c.default.getShareScreenIcon(!0),i=[u.smallAccessoryInnerView,u.smallAccessoryInnerScreenshareView];e=(0,a.jsx)(n.Animated.View,{style:u.presenterAccessory,ignorePointerEvents:!0,children:this.props.getDesktopAccessory(i,t)})}const t=[u.nametagAndAccessoriesLine,this.props.isInTray?u.nametagAndAccessoriesLineTray:void 0];return(0,a.jsxs)(n.View,{style:t,children:[this._getOptionalNameTag(),e]})}_getOptionalNameTag(){var e;const t=[this.props.desktopNameTag?u.desktopNameTag:u.nameTag,u.desktopNameTagLeft];this.props.nametagOpacityStyle&&t.push(this.props.nametagOpacityStyle);const i=null===(e=this.props.nametagPosition)||void 0===e?void 0:e.offset;if(i&&t.push(n.Styles.createViewStyle({bottom:i},!1)),this.props.callId&&this.props.conversationMri)return(0,a.jsx)(n.Animated.View,{style:t,ignorePointerEvents:!0,children:(0,a.jsx)(d.CallParticipantNametagView,{hoveringKey:this.props.renderScreenShare?void 0:this.props.renderKey,callId:this.props.callId,isLocal:this.props.isLocal,conversationMri:this.props.conversationMri,onToggleCropVideoClicked:this.props.toggleCropUncropVideo,sizeToFit:this.props.sizeToFit,isRenderingVideo:this.props.isRenderingVideo,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,showMoreIcon:this.props.hovering,isOnHold:this.props.isOnHold,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray})})}}t.default=h},812119:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantNametagView=t.CallParticipantNametag=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(7371)),r=o.__importDefault(i(369347)),l=o.__importDefault(i(907880)),c=i(460515),d=o.__importDefault(i(132680)),u=o.__importDefault(i(859545)),h=o.__importStar(i(44717)),p=i(315742),g=o.__importDefault(i(958868)),C=o.__importDefault(i(601976)),m=i(26703),S=o.__importDefault(i(363091)),_=o.__importDefault(i(211618)),f=o.__importStar(i(634859)),y=i(16549),T=i(641400),b=o.__importDefault(i(101476)),v=o.__importDefault(i(984263)),I=o.__importDefault(i(543915)),w=(0,m.lazyProperties)({floatingNameTag:()=>n.Styles.createViewStyle({marginTop:10}),toolTipContainer:()=>n.Styles.createViewStyle({height:24}),toolTipContainerRaiseHand:()=>n.Styles.createViewStyle({overflow:"hidden",paddingLeft:35}),nametagBgColorStyle:()=>n.Styles.createViewStyle({backgroundColor:y.Color.blackOverlay50}),nametagBgColorStyleLightThemeStage:()=>n.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay80}),nametagBgColorStyleLightThemeTray:()=>n.Styles.createViewStyle({backgroundColor:y.Color.gray50overlay95}),nametagBgColorStyleHover:()=>n.Styles.createViewStyle({backgroundColor:y.Color.blackOverlay80}),nametagBgColorStyleHoverLightTheme:()=>n.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay90}),raisedHandIcon:()=>n.Styles.createViewStyle({position:"absolute",left:0,bottom:-6}),wrapperStage:()=>n.Styles.createViewStyle({height:36,justifyContent:"flex-end",flexGrow:0,flexShrink:1})});class P extends g.default{constructor(){super(...arguments),this._updateAnchorRect=e=>{!e&&this.state.hoveringKey&&this.props.getAnchorInfo&&(e=this.props.getAnchorInfo(this.state.hoveringKey)),this._popupView&&e&&this._popupView.updatePosition(e)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getPopUpPositions=e=>[p.PopupAnchorPositon.Bottom],this._getAnchorInfo=()=>{if(this.props.getAnchorInfo&&this.state.hoveringKey)return this.props.getAnchorInfo(this.state.hoveringKey)},this._renderPopupContent=()=>(0,a.jsx)(M,{style:w.floatingNameTag,opacityStyle:this.props.opacityStyle,hoveringKey:this.state.hoveringKey,callId:this.props.callId,conversationMri:this.props.conversationMri,isLocal:this.state.hoveringKey===c.CallStageElementKeys.localUserKey,isRenderingVideo:!1,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this.props.onNametagMouseEnter,onNametagMouseLeave:this.props.onNametagMouseLeave,isCompact:!0,isOnHold:this.props.isOnHold})}_buildState(e,t){const i=s.default.getCurrentHoveringParticipantConfig();return{hoveringKey:i?i.key:void 0}}componentDidMount(){super.componentDidMount(),this._updateAnchorRect(),this.state.hoveringKey&&this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.hoveringKey===t.hoveringKey&&this.props.parentDimensions===e.parentDimensions||(this.state.hoveringKey?this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey):this._unsubscribeFromAnchorRectChanges())}componentWillUnmount(){super.componentWillUnmount(),this._unsubscribeFromAnchorRectChanges()}_updateAnchorRectAndSubscribeForChanges(e){this._updateAnchorRect(),this._unsubscribeFromAnchorRectChanges(),this.props.getAnchorInfoChanges&&(this._rectChangeSubscriptionToken=this.props.getAnchorInfoChanges(e,this._updateAnchorRect))}_unsubscribeFromAnchorRectChanges(){this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}render(){return this.state.hoveringKey?(0,a.jsx)(_.default,{ref:this._onPopupViewRef,disablePositionAnimation:!0,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,renderPopup:this._renderPopupContent,allowTaps:!0,ignorePointerEvents:!0},this.state.hoveringKey):null}}t.CallParticipantNametag=P;class M extends g.default{constructor(){super(...arguments),this._onUserNameChevronOverflowPress=e=>{"key"in e?I.default.measureLayoutRelativeToWindow((()=>this._nametagRef)).then((({x:e,y:t})=>{this.props.isLocal?l.default.showLocalVideoActionsContextMenuOnPosition({x:e,y:t},this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked):l.default.showParticipantActionsContextMenuOnPosition({x:e,y:t},this._getRootViewId(),this._getCallParticipantContextMenuOptions(),this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)})):this.props.isLocal?l.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked):l.default.showParticipantActionsContextMenu(e,this._getRootViewId(),this._getCallParticipantContextMenuOptions(),this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)},this._onMouseEnter=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._onMouseLeave=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._setNametagRef=e=>{this._nametagRef=e||void 0}}_buildState(e,t){const i=!e.isLocal&&e.hoveringKey?h.asMriMaybe(e.hoveringKey):void 0,o=!e.isLocal;let a,n,s;if(o&&e.hoveringKey&&(a=r.default.CallingStore.findRemoteCallMember(e.callId,e.hoveringKey)),e.isLocal){const e=S.default.getSkypeMri();n=C.default.getDisplayName(e),s=e}else i&&(n=C.default.getDisplayName(i),s=i);const l=!!s&&!!e.callId&&r.default.CallingStore.isHandRaisedForMri(s,e.callId),u=h.isGroupConversation(e.conversationMri),p={displayName:n,participantViewMuteIconEnabled:o,isServerMutedSupported:!!a&&r.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(e.callId,a),isLocalMuteSupported:r.default.CallingStore.getLocalMuteSupported(e.callId),isMuted:e.isLocal?d.default.isLocalOrServerMuted(e.callId):!!a&&a.isServerMuted,isGroupCall:u,isCallConnected:r.default.CallingStore.isCallConnected(e.callId),isHandRaised:l};{const t=r.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:r.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:r.default.CallingStore.isEncryptedCall(e.callId),conversationMri:e.conversationMri,callId:e.callId});p.participantViewActionsEnabled=!e.isLocal,p.tooltipsShowing=v.default.getToolTipConfig(this._getRootViewId()).displayText.length>0,p.localVideoActionsEnabled=e.isLocal&&t,p.isPinned=d.default.isCallParticipantPinned(e.isLocal?c.CallStageElementKeys.localUserKey:s,e.callId)}return p}_getCallParticipantContextMenuOptions(){const e=this.props.hoveringKey;return{callId:this.props.callId,conversationMri:this.props.conversationMri,userMri:e,isLocal:this.props.isLocal,isGroupCall:this.state.isGroupCall,isLocalMuteSupported:this.state.isLocalMuteSupported,isMuted:this.state.isMuted,isServerMutedSupported:this.state.isServerMutedSupported,sizeToFit:this.props.sizeToFit,isCompact:!!this.props.isCompact,isInTray:!!this.props.isInTray,isRenderingVideo:this.props.isRenderingVideo,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:u.default.call().canSendMessageToParticipant,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:u.default.navigation().canAccessUserDetails,showLowerHandOption:this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!1,showPinOption:d.default.shouldShowCallParticipantPinOption(e,this.props.callId),showUnpinOption:d.default.shouldShowCallParticipantUnpinOption(e,this.props.callId)}}_getCallLocalVideoContextMenuOptions(){return l.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.props.isRenderingVideo,this.props.sizeToFit,this.state.isHandRaised,!1,this.props.isInTray)}_getToolTipColorStyle(){return this.props.useLightTheme?this.props.isInTray?w.nametagBgColorStyleLightThemeTray:w.nametagBgColorStyleLightThemeStage:w.nametagBgColorStyle}render(){const e=this.state.displayName?this.state.displayName:void 0,t=!this.props.isCompact&&this.state.isMuted?T.SkypeIcon.MicrophoneOff:void 0;if(!this.state.isCallConnected||!e)return null;const i=d.default.getUserOptionsAccessibilityLabel(e,this.state.isMuted,this.state.isHandRaised),o=[this.props.style,this.props.opacityStyle,w.toolTipContainer,this._getToolTipColorStyle()];let s;this.state.isHandRaised&&!this.props.isCompact&&(o.push(w.toolTipContainerRaiseHand),s=(0,a.jsx)(n.View,{style:w.raisedHandIcon,children:(0,a.jsx)(f.default,{type:f.RaiseHandImageType.MediumSizeCenterAligned})}));const r=[];this.state.isPinned&&r.push(T.SkypeIcon.Pin);let l=t;this.props.isOnHold&&(l=T.SkypeIcon.Pause),r.push(l);let c=T.SkypeIcon.More;this.props.showMoreIcon?o.push(this.props.useLightTheme?w.nametagBgColorStyleHoverLightTheme:w.nametagBgColorStyleHover):c=void 0,r.push(c);const u=this.props.useLightTheme?y.Color.gray400:void 0,h=(0,a.jsx)(b.default,{style:o,displayText:e,rightIcons:r,onPress:this._onUserNameChevronOverflowPress,accessibilityLabel:i,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,ellipseCaption:!0,textColor:u,ref:this._setNametagRef});return(0,a.jsxs)(n.View,{style:w.wrapperStage,children:[h,s]})}}t.CallParticipantNametagView=M,t.default=P},395045:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(150343)),l=o.__importDefault(i(306794)),c=o.__importDefault(i(683973)),d=i(975881),u=i(815146),h=o.__importStar(i(85385)),p=i(26703),g=i(331079),C=o.__importDefault(i(220534)),m=o.__importStar(i(971988)),S=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center"})});class _ extends s.ComponentBase{constructor(){super(...arguments),this._onMaybeHandleReaction=e=>{if(h.log(u.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid),!this.isComponentMounted())return h.log(u.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (not mounted)"),!1;const t=!e.reaction.isEmoticonCallReaction()&&e.reactionsTextStyle===g.ReactionsTextStyle.Default;return this.state.enableSimpleTextReactions?(h.log(u.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (simple text reactions enabled)"),!1):t&&this.props.isCompact?(h.log(u.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (compact text reaction)"),!1):(this.setState({reactionInfo:e}),h.log(u.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" handled"),!0)}}_buildState(e,t){const i=r.default.getS4LCMCFeatures(),o={enableSimpleTextReactions:i.enableSimpleTextReactions};return t&&(o.reactionInfo=void 0),o.newAnimatedReaction=i.callAnimatedReactionsConfig.callAnimatedReactionsKeys,o}componentDidMount(){if(super.componentDidMount(),this.props.getCallReactionsDisplayHelper){this.props.getCallReactionsDisplayHelper().registerParticipantReactionCallback(this.props.participantMri,this._onMaybeHandleReaction)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),t.reactionInfo&&t.reactionInfo.isLocal){const e=l.default.maybeGetAndClearReactionPressedScenario();e&&(e.markPerfTargetStepCompleted("componentDidUpdate"),Promise.resolve().then((()=>{e.markStepCompleted("backOnJSThread"),e.finish()})))}}componentWillUnmount(){if(super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper){const e=this.props.getCallReactionsDisplayHelper();e.unregisterParticipantReactionCallback(this.props.participantMri),e.dismissReaction(this.props.participantMri)}}render(){let e;if(this.state.reactionInfo){let t,i=this.state.reactionInfo.content;if(this.state.reactionInfo.reaction.isEmoticonCallReaction())t=d.CallReactionType.Emoji,i=this.state.reactionInfo.reaction.getEmoticonCallReactionKey();else if(m.hasQuote(this.state.reactionInfo.reaction.content))t=d.CallReactionType.Quote;else if(C.default.isUrlValid(this.state.reactionInfo.content))t=d.CallReactionType.Link;else if(this.state.reactionInfo.reactionsTextStyle===g.ReactionsTextStyle.Sticker)t=d.CallReactionType.Sticker;else if(this.state.reactionInfo.reactionsTextStyle===g.ReactionsTextStyle.Snapshot)t=d.CallReactionType.Snapshot;else{if(this.state.reactionInfo.reactionsTextStyle===g.ReactionsTextStyle.Animation)return null;if(this.state.reactionInfo.isLocal)return null;t=d.CallReactionType.Text}const o=[];this.props.borderRadius&&o.push(n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)),i&&(e=(0,a.jsx)(c.default,{style:o,reactionType:t,cuid:this.state.reactionInfo.reaction.cuid,callId:this.props.callId,content:i,reaction:this.state.reactionInfo.reaction,showBackgroundGradient:this.state.reactionInfo.reactionsTextStyle!==g.ReactionsTextStyle.Animation,gradientColors:this.state.reactionInfo.gradientColors,isCompact:this.props.isCompact,borderRadius:this.props.borderRadius,ignorePointerEvents:!0}))}return(0,a.jsx)(n.View,{style:S.container,ignorePointerEvents:!0,children:e})}}t.default=_},991148:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(264596)),r=o.__importStar(i(216837)),l=i(167606),c=i(148540),d=o.__importDefault(i(369347)),u=o.__importDefault(i(638260)),h=o.__importDefault(i(296114)),p=o.__importDefault(i(734468)),g=o.__importDefault(i(827361)),C=o.__importStar(i(85385)),m=o.__importDefault(i(760989)),S=o.__importDefault(i(914339)),_=o.__importDefault(i(252089)),f=o.__importDefault(i(497910)),y=i(16549),T=i(26703),b=i(718317),v=o.__importStar(i(437782)),I=o.__importDefault(i(659938)),w=i(677982),P=(0,T.lazyProperties)({innerContainer:()=>g.default.absoluteFill,hiddenContainer:()=>n.Styles.createViewStyle({opacity:0}),mainContainer:()=>n.Styles.createViewStyle({position:"relative",flex:1})});class M extends h.default{constructor(e){super(),this.value=e}isImmutable(){return!0}equals(e){return e instanceof M&&this.value===e.value}}class D extends f.default{constructor(){super(...arguments),this._useNewVideoView=!1,this._onCallingVideoView=e=>{this._resetRenderer(e);const t=m.default.newCauseId(),i=e||void 0;C.log(l.LogTraceArea.CallingUI,this._componentTag+"._onCallingVideoView "+v.mriOrId(this.props.mri)+" has video view: "+!!i+" causeId: "+t),this._callingVideoView!==i&&(this._callingVideoView=i,this.props.onCallingVideoView&&this.props.onCallingVideoView(this._callingVideoView,t))},this._rendererPromise=null}_buildState(e,t){let i;if(t&&(this._componentTag=D._generateComponentTag(e)),!e.isLocal&&!e.showOnlyAvatar&&e.mri){const t=e.renderScreenShare?c.StreamType.ScreenSharing:c.StreamType.Video;i=d.default.CallingStore.getBestStreamForMri(e.callId,e.mri,t,e.endpointId)}return{gradientColors:D._getGradientColors(e),remoteStream:i&&new M(i),isRendering:!t&&this.state.isRendering,isUnmountInBackgroundEnabled:w.AppConfigStore.getS4LCMCFeatures().enableUnmountVideoViewInBackground}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=m.default.newCauseId();C.log(l.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate:  causeId: "+o),!this.props.isLocal&&this.state.isRendering>t.isRendering&&u.default.updateCallTelemetry(this.props.callId,o,(e=>{e.didRenderRemoteVideo()})),this._rendererPromise&&this.props.scalingMode!==e.scalingMode&&this._rendererPromise.then((e=>{e.setScalingMode(this.props.scalingMode,o)}))}componentDidMount(){super.componentDidMount(),this._appActivationStateListener=I.default.subscribeForChanges(this._componentTag,(e=>this._onAppActivationStateChanged(e)))}componentWillUnmount(){var e;super.componentWillUnmount(),null===(e=this._appActivationStateListener)||void 0===e||e.unsubscribe()}getVideoElement(){return this._callingVideoView}getEndpointId(){return this.props.streamType!==c.StreamType.Video||this.props.isLocal?void 0:this.props.endpointId}render(){const e=this.props.showOnlyAvatar?"icon_":"video_",t=e+this.props.renderKey,i=e+this._getVideoKey(!0);let o,s;return this.props.showOnlyAvatar?this.props.renderScreenShare||(o=this._renderStaticSurface(!0)):this.state.isRendering||this.props.renderScreenShare?s=this._renderVideoSurface(t,i,!1):(s=this._renderVideoSurface(t,i,!0),o=this._renderStaticSurface(!1)),(0,a.jsxs)(n.View,{style:[P.innerContainer,P.mainContainer,this.props.videoBorderColorStyle],children:[!this.state.hideVideo&&s,o,!1]})}_renderVideoSurface(e,t,i){var o;C.log(l.LogTraceArea.CallingUI,this._componentTag+"._renderVideoSurface "+t+" hidden "+i+" local:"+this.props.isLocal);const n=`video${(null===(o=this.state.remoteStream)||void 0===o?void 0:o.value.id)||""}_${e}`;return this._useNewVideoView&&r.VideoView?(0,a.jsx)(r.VideoView,{ref:this._onCallingVideoView},n):r.default&&(0,a.jsx)(r.default,{ref:this._onCallingVideoView,nametag:e,style:[P.innerContainer].concat(i?[P.hiddenContainer]:[]),isLocal:this.props.isLocal,videoBorderRadius:this.props.videoBorderRadius,parentView:this._componentTag,renderScreenShare:this.props.renderScreenShare},n)}static _getGradientColors(e){if(e.useDarkBackground){const t=e.useLightTheme?y.Color.gray50:y.Color.callStageLight;return[t,t]}return e.isLocal||e.renderScreenShare?_.default.getGradientColors():p.default.getGradientColors(e.mri)}_renderStaticSurface(e){const t=this.props.mri?(0,a.jsx)(S.default,{style:P.innerContainer,backgroundColorStyle:this.props.backgroundColorStyle,userMri:this.props.mri,iconOpacity:this.props.iconOpacity||0,backgroundOpacity:this.props.isCompact?0:1,isConnecting:this.props.isRinging,size:this.props.iconSize,gradientColors:this.state.gradientColors,showAudioParticipantBackground:this.props.showAudioParticipantBackground&&e,hideIcon:this.props.hideIcon}):void 0;return(0,a.jsx)(n.View,{style:P.innerContainer,children:t})}_resetRenderer(e){var t;if(this._rendererPromise){const e=this._rendererPromise;e.cancel(),e.then((t=>{var i;e.remoteStream?d.default.CallingStore.updateRemoteVideoRenderInfoForCall(e.callId,e.participantMri,e.remoteStream,e.renderTarget,null):d.default.CallingStore.updateLocalPreviewRenderInfoForCall(e.callId,e.renderTarget,null),null===(i=e.rendererSubscription)||void 0===i||i.dispose(),t.dispose()})),this._rendererPromise=null,this.setState({isRendering:!1})}if(e){const i=e.getVideoContainer(),o={scalingMode:this.props.scalingMode,transparent:this.props.enableTransparentVideoStream},a=this._getRendererPromise(i,o);a&&(this._rendererPromise=Object.assign(a,{renderTarget:i,callId:this.props.callId,participantMri:this.props.mri,remoteStream:null===(t=this.state.remoteStream)||void 0===t?void 0:t.value}),a.then((e=>{this._rendererPromise===a&&(this.setState({rendererDiagnostic:"Renderer created",isRendering:e.isRendering}),u.default.onCallParticipantRendererCreated(this.props.callId,"callParticipantVideoView",this.props.mri,e.isRendering),C.log(l.LogTraceArea.CallingUI,`${this._componentTag} + '._resetRenderer: Renderer created callId: ${this.props.callId} participantMri: ${v.mriOrId(this.props.mri)} isRendering: ${e.isRendering}`),this._rendererPromise.rendererSubscription=e.changed((()=>{this.setState({isRendering:e.isRendering}),e.isRendering&&(u.default.onCallParticipantRendererIsRendering(this.props.callId,"callParticipantVideoView",this.props.mri),C.log(l.LogTraceArea.CallingUI,`${this._componentTag} + '._resetRenderer: Renderer is rendering now for callId: ${this.props.callId} participantMri: ${v.mriOrId(this.props.mri)} isRendering: ${e.isRendering}`))})),this._rendererPromise.remoteStream?d.default.CallingStore.updateRemoteVideoRenderInfoForCall(this._rendererPromise.callId,this._rendererPromise.participantMri,this._rendererPromise.remoteStream,this._rendererPromise.renderTarget,e):d.default.CallingStore.updateLocalPreviewRenderInfoForCall(this._rendererPromise.callId,this._rendererPromise.renderTarget,e))}),(e=>this._setRendererDiagnostic(e))))}}_createRendererFactory(e,t){var i;if(this.props.isLocal)return()=>s.default.getStack().getDeviceManager().createPreviewRenderer(e,t);const o=null===(i=this.state.remoteStream)||void 0===i?void 0:i.value;if(o){const i=d.default.CallingStore.getRemoteStreamStarter(this.props.callId,o.type);if(i)return()=>i.startStream((e=>this.setState({rendererDiagnostic:e})),o,e,t)}return null}_setRendererDiagnostic(e,t){let i="Failed to create renderer.";void 0!==t&&(i+=` Retry in ${t} s...`),i+=`\n${e}`,this.setState({rendererDiagnostic:i})}_getRendererPromise(e,t){const i=this._createRendererFactory(e,t);if(!i)return null;const o=(0,b.progressiveDelayTrigger)(((e,t)=>{this._setRendererDiagnostic(e,t)}));let a;const n=(0,b.retry)((()=>(this.setState({rendererDiagnostic:"Creating renderer..."}),a=i())),o);return Object.assign(n,{cancel:()=>{var e;o.cancel(),null===(e=a.cancel)||void 0===e||e.call(a)}})}_getVideoKey(e=!1){return this.props.endpointId&&this.props.streamType===c.StreamType.Video&&!this.props.isLocal?(e?v.mriOrId(this.props.renderKey):this.props.renderKey)+"_"+this.props.endpointId:e?v.mriOrId(this.props.renderKey):this.props.renderKey}_onAppActivationStateChanged(e){this.state.isUnmountInBackgroundEnabled&&(e===n.Types.AppActivationState.Active?this.setState({hideVideo:!1}):e===n.Types.AppActivationState.Background&&this.setState({hideVideo:!0}))}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantVideoView":"CallParticipantVideoView"}}t.default=D},152803:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantView=void 0;const o=i(197582),a=i(785893),n=i(667294),s=o.__importStar(i(496486)),r=o.__importStar(i(516778)),l=i(148540),c=i(815063),d=o.__importDefault(i(150343)),u=o.__importDefault(i(991148)),h=o.__importDefault(i(724063)),p=o.__importDefault(i(369347)),g=o.__importDefault(i(60433)),C=(o.__importDefault(i(768877)),o.__importDefault(i(907880))),m=o.__importDefault(i(395045)),S=o.__importDefault(i(898290)),_=o.__importStar(i(873324)),f=i(460515),y=i(132680),T=o.__importDefault(i(859545)),b=o.__importDefault(i(543915)),v=o.__importDefault(i(601976)),I=i(815146),w=o.__importDefault(i(970035)),P=o.__importStar(i(85385)),M=o.__importDefault(i(612285)),D=i(26703),A=o.__importStar(i(704704)),k=o.__importStar(i(634859)),R=o.__importStar(i(437782)),x=o.__importDefault(i(421334)),L=o.__importDefault(i(655192)),B=i(16549),V=i(641400),O=o.__importDefault(i(827361)),E=o.__importDefault(i(497910)),N=o.__importDefault(i(760989)),F=o.__importDefault(i(389219)),U=o.__importDefault(i(313311)),H=o.__importDefault(i(638260)),j=o.__importDefault(i(947878)),z=(0,D.lazyProperties)({innerContainer:()=>O.default.absoluteFill,ringingContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:B.Color.blackOverlay50}),backgroundActivityContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),keyboardNavigatorPosition:()=>r.Styles.createViewStyle({bottom:0,left:0}),smallAccessory:()=>r.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:B.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryPosition:()=>r.Styles.createViewStyle({bottom:0,right:0}),smallAccessoryLocalVideo:()=>r.Styles.createViewStyle({backgroundColor:B.Color.transparent}),smallAccessoryInnerView:()=>r.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:B.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>r.Styles.createViewStyle({backgroundColor:B.Color.white}),smallAccessoryInnerLocalVideoView:()=>r.Styles.createViewStyle({backgroundColor:B.Color.white}),debugContainer:()=>r.Styles.createViewStyle({padding:10}),debugTextStyle:()=>r.Styles.createTextStyle({color:B.Color.greenIOS}),activeTalkingOuterBorderStyle:()=>r.Styles.createViewStyle({borderWidth:3}),raisedHandOuterBorderStyle:()=>r.Styles.createViewStyle({borderColor:B.Color.raiseHandOrange,borderWidth:3}),horizontalMultipleStreamsLayout:()=>r.Styles.createViewStyle({flexDirection:"row"})});class G extends E.default{constructor(){super(...arguments),this._callParticipantVideoViews={},this._containerId=0,this._animatedAccessoryOpacityValue=new r.Animated.Value(1),this._animatedAccessoryOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._animatedAccessoryOpacityValue}),this._fetchRendererStats=s.throttle((()=>h.default.fetchRendererStats(this.props.callId,this.state.renderKey,this.state.streamType)),5e3),this._setKeyboardNavigatorRef=e=>{this._keyboardNavigatorRef=e||void 0},this._onDimensionsChanged=e=>{e!==this._renderedDimensions&&(this._renderedDimensions=e,this._updateSizeToFitV2())},this._onHiddenChanged=e=>{this.isComponentMounted()&&this.setState({hidden:e})},this._onCallParticipantVideoView=(e,t)=>{e?(this._callParticipantVideoViews[t]=e,e.props.renderScreenShare&&(this._screenShareVideoViewKey=t)):(delete this._callParticipantVideoViews[t],this._screenShareVideoViewKey===t&&(this._screenShareVideoViewKey=void 0))},this._toggleCropUncropVideo=e=>{this.isComponentMounted()&&this.setState({isSizeToFitExplicitlySet:!0},(()=>{P.log(I.LogTraceArea.CallingUI,this._componentTag+"._toggleCropUncropVideo isSizeToFitExplicitlySet="+this.state.isSizeToFitExplicitlySet),this._updateSizeToFitByConextMenuOption(e)}))},this._setSizeToFit=(e,t)=>{this.setState({sizeToFit:e},t)},this._onParticipantContextMenuFromKeyboard=()=>{const e=this._getCallParticipantContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&b.default.measureLayoutRelativeToWindow((()=>this._keyboardNavigatorRef)).then((({x:t,y:i})=>C.default.showParticipantActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)))},this._onParticipantContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallParticipantContextMenuOptions();C.default.showParticipantActionsContextMenu(e,this._getRootViewId(),t,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)}},this._onLocalVideoContextMenuFromKeyboard=()=>{const e=this._getCallLocalVideoContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&b.default.measureLayoutRelativeToWindow((()=>this._keyboardNavigatorRef)).then((({x:t,y:i})=>C.default.showLocalVideoActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this._toggleCropUncropVideo)))},this._onLocalVideoContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallLocalVideoContextMenuOptions();t&&C.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),t,this._toggleCropUncropVideo)}},this._getContextMenuHandler=e=>e?this.state.isLocal?this._onLocalVideoContextMenuFromKeyboard:this._onParticipantContextMenuFromKeyboard:this.state.isLocal?this._onLocalVideoContextMenuHandler:this._onParticipantContextMenuHandler,this._renderOptionalNameTagLine=e=>{if(this._shouldShowOptionalNameTag(e))return(0,a.jsx)(U.default,{isPresenter:this.state.isPresenter,isInTray:this.props.isInTray,desktopNameTag:this.props.desktopNameTag,nametagPosition:this.props.nametagPosition,callId:this.props.callId,conversationMri:this.props.conversationMri,renderScreenShare:this.state.renderScreenShare,renderKey:this.state.renderKey,isLocal:!!this.state.isLocal,sizeToFit:this.state.sizeToFit,isRenderingVideo:this.state.shouldRenderVideo,isOnHold:this.state.isOnHold,useLightTheme:this.props.useLightTheme,nametagOpacityStyle:this.props.nametagOpacityStyle,getDesktopAccessory:(e,t)=>this._getDesktopAccessory(e,t),onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,toggleCropUncropVideo:this._toggleCropUncropVideo,hovering:this.state.hovering})}}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantView":"CallParticipantView"}_buildState(e,t){const{autoLetterBoxThresholdRatioForNewStage:i,enableAutoLetterBoxOnMobile:o,autoLetterBoxThresholdRatioOnMobile:a,enableAudioParticipantsBackground:n,enableAudioParticipantsBackgroundInTray:s,enableScreenShareZoom:r,enableTransparentVideoStream:c,enableNewCallPanel:u}=d.default.getS4LCMCFeatures(),{enableRefreshedPalette:h}=d.default.getS4LUiFeatures();let g,C=e.renderInfo;e.callId&&!e.renderInfo&&(C=p.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const m=(null==C?void 0:C.mri)||this._extractMriForKey(e.renderKey,!1),S=(null==C?void 0:C.isLocal)||e.renderKey===f.CallStageElementKeys.localUserKey,_=p.default.CallingStore.getLocalVideoStreamSize(e.callId),T=(null==C?void 0:C.videoDimensions)||_;S?g=A.getString("DisplayInfoStore.ListMyName"):(g=v.default.getDisplayName(m),(null==C?void 0:C.renderScreenShare)&&(g=A.getString("CallPanel.CallParticipantScreenshareLabel",{displayName:g||""})));const b=(null==C?void 0:C.renderScreenShare)?l.StreamType.ScreenSharing:l.StreamType.Video,w=y.CallUIUtils.isFullScreenBot(m),D=(null==C?void 0:C.renderScreenShare)||(null==C?void 0:C.streamsStatus)===f.CallParticipantStreamsStatus.Multiple||w,k=r&&(null==C?void 0:C.isScreenSharing)&&!0,R=!e.isCompact&&n,L=R&&s,B=e.isInTray?L:R,V=Object.assign(Object.assign({zoomEnabled:D,isScreenShareZoomEnabled:k,isMobileScreenReaderEnabled:x.default.isMobileScreenReaderEnabled(),isNavigatingWithKeyboard:M.default.isNavigatingWithKeyboard(),hideNameTag:e.hideNameTag||p.default.CallControlsStore.isSettingsPopupVisible()||w,displayName:g,streamType:b,metricEnabled:!1,rendererMetrics:void 0,enableTransparentVideoStream:c,showMyselfInTheGrid:j.default.getSelfInTheGrid(e.callId),autoLetterBoxThresholdRatio:i,enableAutoLetterBoxOnMobile:o,autoLetterBoxThresholdRatioOnMobile:a,isFullScreenBot:w},C),{renderKey:e.renderKey,mri:m,isLocal:S,forceSizeToFit:D,showAudioParticipantBackground:B,videoDimensions:T,enableRefreshedPalette:h,isNewCallPanelEnabled:y.CallUIUtils.isMobileUI()&&u.enableExperimentalCallControls});return t?(V.sizeToFit=V.zoomEnabled,V.isSizeToFitExplicitlySet=!1,V.hidden=e.layoutController(e.renderKey,!!(null==C?void 0:C.renderScreenShare),null==C?void 0:C.shouldRenderVideo).isHidden(),this._componentTag=G._generateComponentTag(e)):(null==C?void 0:C.videoDimensions)&&(C.videoDimensions.width||(V.sizeToFit=V.zoomEnabled&&this._sizeToFit(e,V.zoomEnabled))),(t||e.isCompact)&&(P.log(I.LogTraceArea.CallingUI,"## setting hovering to false"),V.hovering=!1),V}componentDidMount(){super.componentDidMount(),this._updateBadgeOpacity();const e=this._layoutController();e.onDimensionsChanged&&e.onDimensionsChanged(this._onDimensionsChanged),e.onHiddenChanged&&e.onHiddenChanged(this._onHiddenChanged)}componentWillUnmount(){super.componentWillUnmount();const e=this._layoutController();e.onDimensionsChanged&&e.onDimensionsChanged(void 0),e.onHiddenChanged&&e.onHiddenChanged(void 0),P.log(I.LogTraceArea.CallingUI,this._componentTag+".componentWillUnmount "+this._participantKeyForLogging())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const o=N.default.newCauseId();if(t.isLocal||t.shouldRenderVideo||!this.state.shouldRenderVideo||this._containerId++,s.each(this._callParticipantVideoViews,(i=>{var a;e.callId&&e.conversationMri&&this.state.shouldRenderVideo!==t.shouldRenderVideo&&(P.log(I.LogTraceArea.CallingUI,this._componentTag+".UNSAFE_componentWillUpdate: shouldRenderVideo from "+this.state.shouldRenderVideo+" to "+t.shouldRenderVideo+" causeId: "+o),p.default.RemoteStreamHelper.logStreamAndRendererStatus(e.callId,e.conversationMri,this.state.streamType,null===(a=i.getVideoElement())||void 0===a?void 0:a.getVideoContainer(),o))})),this.state.shouldRenderVideo!==t.shouldRenderVideo||this.state.videoDimensions!==t.videoDimensions){const e=t.shouldRenderVideo?"video_":"icon_"+this._participantKeyForLogging();P.log(I.LogTraceArea.CallingUI,this._componentTag+"._renderContentView key:"+e+" shouldRenderVideo: "+t.shouldRenderVideo+" videoDimensions:"+L.default.asString(t.videoDimensions))}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.isCompact!==e.isCompact&&this._updateBadgeOpacity(!0),(this.state.shouldRenderVideo&&!t.shouldRenderVideo||this.state.videoDimensions&&t.videoDimensions&&this.state.videoDimensions.width!==t.videoDimensions.width)&&(this.state.isSizeToFitExplicitlySet?this.setState({isSizeToFitExplicitlySet:!1}):this._updateSizeToFitV2())}_updateBadgeOpacity(e=!1){const t=this._currentBadgeOpacity();e&&t>0?r.Animated.timing(this._animatedAccessoryOpacityValue,{toValue:t,duration:250,delay:250,easing:r.Animated.Easing.InOut()}).start((e=>{e.finished||t===this._currentBadgeOpacity()&&this._animatedAccessoryOpacityValue.setValue(t)})):this._animatedAccessoryOpacityValue.setValue(t)}_currentBadgeOpacity(){return this.props.isCompact?1:0}_getScreenShareVideoElement(){var e;return this._screenShareVideoViewKey&&(null===(e=this._callParticipantVideoViews[this._screenShareVideoViewKey])||void 0===e?void 0:e.getVideoElement())||null}_participantKeyForLogging(){return this._extractMriForKey(this.props.renderKey,!0)}_extractMriForKey(e,t=!1){return g.default.extractMriFromKey(e,t)}_renderContentView(){const e=this.state.streamsStatus===f.CallParticipantStreamsStatus.Multiple;let t=!1,i=!1;const o=[],{renderKey:n,streams:s}=this.state;if(this.state.isFullScreenBot||void 0===s)o.push(this._renderVideoView(n,{isStreamAvailable:this.state.shouldRenderVideo,videoDimensions:this.state.videoDimensions}));else if(this.state.streamsStatus===f.CallParticipantStreamsStatus.None)o.push(this._renderVideoView(n,{isStreamAvailable:!1,videoDimensions:y.DummyVideoSize}));else for(const a of s)s.length>1&&!a.isStreamAvailable||(y.CallUIUtils.isPortraitVideo(a.videoDimensions)&&(t=!0),a.isTwincamEndpoint&&(i=!0),o.push(this._renderVideoView(n,a,e?0:void 0)));const l=[z.innerContainer,e?this._getOptionalMultipleStreamsStylesForCompactView():void 0,t?z.horizontalMultipleStreamsLayout:void 0];let c,d=(0,a.jsx)(r.View,{style:l,children:o},"contentcontainer"+this._containerId);if(this.state.isRinging&&this.props.isCompact){const e=[z.ringingContainer,r.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)];c=(0,a.jsx)(r.View,{style:e,children:(0,a.jsx)(w.default,{icon:V.SkypeIcon.CallAnimSmall4,color:B.Color.white,size:V.IconSize.size20})})}const u=this._layoutController().getInnerStyles();u&&(d=(0,a.jsx)(r.Animated.View,{style:u,children:d}));const h=(0,a.jsx)(m.default,{ignorePointerEvents:!0,callId:this.props.callId,participantMri:n,borderRadius:this.props.videoBorderRadius,isCompact:!!this.props.isCompact||!!this.props.forceCompactReactions,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper});return i&&H.default.updateCallTelemetry(this.props.callId,G.name,(e=>e.setDidRenderTwincamEndpoint())),(0,a.jsxs)(r.View,{style:[z.innerContainer,O.default.overflowVisible,this.props.contentViewStyles],children:[d,this._getActivityIndicationView(),h,c]})}_getOptionalMultipleStreamsStylesForCompactView(){return this.props.isCompact?r.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius,overflow:"hidden"},!1):void 0}_getActivityIndicationView(){const e=this._isRaisedHand(),t=this._isActiveTalking();if(!e&&!t)return;let i;this.props.contentViewStyles&&"object"==typeof this.props.contentViewStyles&&"borderRadius"in this.props.contentViewStyles&&(i=r.Styles.createViewStyle({borderRadius:this.props.contentViewStyles.borderRadius},!1));const o=[z.backgroundActivityContainer,i];return e&&o.push(z.raisedHandOuterBorderStyle),t&&o.push(z.activeTalkingOuterBorderStyle,this._getActiveCallFrameColorStyles()),(0,a.jsx)(r.View,{style:o})}_getActiveCallFrameColorStyles(){const e=this.props.useLightTheme?B.Color.blue:B.Color.white,t=this.state.enableRefreshedPalette?this._themeColors.surfaceInteractive:e;return r.Styles.createViewStyle({borderColor:t},!1)}_renderVideoView(e,t,i){var o;const n=t.endpointId||e,r=this.props.layoutController(e),c=!this.props.hideBackground&&this.state.showAudioParticipantBackground;return(0,a.jsx)(u.default,{ref:e=>this._onCallParticipantVideoView(e,n),renderKey:e,mri:this.state.mri,showOnlyAvatar:!t.isStreamAvailable,isRinging:this.state.isRinging,renderScreenShare:this.state.renderScreenShare,parentViewId:this._componentTag,videoBorderRadius:s.isUndefined(i)?this.props.videoBorderRadius:i,isCompact:this.props.isCompact,iconOpacity:this.props.iconOpacity,useDarkBackground:this.props.useDarkBackground,iconSize:this.props.iconSize,isLocal:n===f.CallStageElementKeys.localUserKey,useLightTheme:this.props.useLightTheme,showAudioParticipantBackground:c,backgroundColorStyle:r.getBackgroundColorStyle(this.props.useLightTheme),videoBorderColorStyle:null===(o=r.getVideoBorderColorStyle)||void 0===o?void 0:o.call(r,this.props.useLightTheme),enableTransparentVideoStream:this.state.enableTransparentVideoStream,onCallingVideoView:this.props.onCallingVideoView,streamType:this.state.streamType,callId:this.props.callId,endpointId:t.endpointId,hideIcon:this.props.hideIcon,scalingMode:this.state.sizeToFit?l.ScalingMode.Fit:l.ScalingMode.Crop},n)}_isActiveTalking(){return this.props.isGroupCall&&this.state.isTalking&&!this.state.isScreenSharing}_isRaisedHand(){return this.state.isHandRaised&&!this.state.isScreenSharing}_isPresenterScreenSharing(){return Boolean(this.state.isScreenSharing||this.state.isPresenter)}_hasToShowKeyboardNavigator(){return this.state.isNavigatingWithKeyboard}_renderAccessoryView(){if(!this.state.renderScreenShare&&(this.state.isMuted||this.state.isOnHold||this.state.isScreenSharing||this.state.isPresenter||this.state.isNavigatingWithKeyboard)&&this.props.isCompact){const e=this.state.isLocal&&this.state.shouldRenderVideo;let t;const i=[z.smallAccessoryInnerView];this.state.isOnHold?t=V.SkypeIcon.Pause:this.state.isMuted&&!this._showOptionalNameTagForMobile()?t=V.SkypeIcon.MicrophoneOff:this._isPresenterScreenSharing()&&(t=y.CallUIUtils.getShareScreenIcon(!0),i.push(z.smallAccessoryInnerScreenshareView)),e&&i.push(z.smallAccessoryInnerLocalVideoView);const o=[z.smallAccessory,z.smallAccessoryPosition,this._animatedAccessoryOpacityStyle];e&&o.push(z.smallAccessoryLocalVideo);const s=y.CallUIUtils.getUserOptionsAccessibilityLabel(this.state.displayName,this.state.isMuted,this.state.isHandRaised);return(0,a.jsxs)(n.Fragment,{children:[this._hasToShowKeyboardNavigator()&&(0,a.jsx)(r.Button,{style:[z.smallAccessory,z.keyboardNavigatorPosition],onPress:this._getContextMenuHandler(!0),title:s,ref:this._setKeyboardNavigatorRef,children:"..."}),t&&(0,a.jsx)(r.Animated.View,{style:o,ignorePointerEvents:!0,children:this._getDesktopAccessory(i,t)})]})}}_getDesktopAccessory(e,t){return(0,a.jsx)(r.View,{style:e,children:(0,a.jsx)(w.default,{icon:t,size:V.IconSize.size12,color:B.Color.gray400})})}_renderRaisedHandOnRibbonParticipant(){if(this.state.isHandRaised&&this.props.isCompact&&!this.state.renderScreenShare)return(0,a.jsx)(k.default,{type:k.RaiseHandImageType.SmallSizeTopLeftAligned})}_setHovering(e){this.isComponentMounted()&&this.state.hovering!==e&&this.setState({hovering:e})}_isLandscape(e){return e.width>=e.height}_sizeToFit(e,t){if(!this._renderedDimensions||!this.state.videoDimensions||!this.state.videoDimensions.width||this.state.renderScreenShare||this.state.streamsStatus===f.CallParticipantStreamsStatus.Multiple)return t;const i=this._isLandscape(this._renderedDimensions),o=this._isLandscape(this.state.videoDimensions),a=i!==o;const n=this._getResizingFactor(this.state.videoDimensions,this._renderedDimensions),s=Math.abs(1-n)>this.state.autoLetterBoxThresholdRatio,r=!o,l=r||a||s;return P.log(I.LogTraceArea.CallingUI,this._componentTag+" _sizeToFit::isPortrait="+r+" isDifferentOrientation="+a+" forceUncrop="+s+" resizingFactor="+n+" incoming video width="+this.state.videoDimensions.width+" container width="+this._renderedDimensions.width+" sizeToFitRet="+l),l}_getResizingFactor(e,t){try{const i=e.width/e.height,o=Math.floor(t.height*i);return t.width/o}catch(e){const t=L.default.asString(e);return P.error(I.LogTraceArea.CallingUI,`${this._componentTag}_getResizingFactor error: ${t}`),0}}_canUpdateSizeToFit(){return!(!this.isComponentMounted()||!this.state.shouldRenderVideo||this.state.isFullScreenBot)&&(this.props.isCompact||this.props.isInTray?(P.log(I.LogTraceArea.CallingUI,this._componentTag+"._canUpdateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+R.mriOrId(this.state.renderKey)),this.setState({sizeToFit:!1}),!1):!(this.state.isNewCallPanelEnabled&&this.state.isScreenSharing&&this.state.zoomEnabled&&!this.state.sizeToFit))}_updateSizeToFitByConextMenuOption(e){this._canUpdateSizeToFit()&&!s.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet&&(P.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitByConextMenuOption sizeToFitSelected="+e+" user="+R.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e},(()=>{this.props.callId&&p.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?P.track(new _.CanvasAndRibbonActionsEvent(_.CanvasAndRibbonActions.FullVideo,this.props.callId)):P.track(new _.CanvasAndRibbonActionsEvent(_.CanvasAndRibbonActions.CropVideo,this.props.callId))})))}_updateSizeToFitV2(){if(!this._canUpdateSizeToFit())return;let e;if(this.props.callId&&(e=p.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),s.isUndefined(e))if(this.props.forceVideoToCrop&&!this.state.isScreenSharing)this.setState({sizeToFit:!1,isSizeToFitExplicitlySet:!1});else{const e=this.state.forceSizeToFit||this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==e&&(P.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 "+this._participantKeyForLogging()+" "+e+" user="+R.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e,isSizeToFitExplicitlySet:!1}),this.props.callId&&p.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}else P.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 sizeToFitPersistence="+e+" user="+R.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e})}_layoutController(){return this.props.layoutController(this.state.renderKey,!!this.state.renderScreenShare,this.state.shouldRenderVideo)}_getOptionalBackgroundEffectInfo(){return(0,a.jsx)(S.default,{renderKey:this.props.renderKey,renderInfo:this.props.renderInfo,callId:this.props.callId,conversationMri:this.props.conversationMri,nametagOpacityStyle:this.props.nametagOpacityStyle,hideCaption:this.props.isCompact||this.state.streamsStatus===f.CallParticipantStreamsStatus.None,noExpand:this.props.isCompact||this.props.isInTray,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray,layoutController:this.props.layoutController})}_isLocalMuteSupported(){return!!this.props.callId&&p.default.CallingStore.getLocalMuteSupported(this.props.callId)}_isServerMuteSupported(){let e;return this.props.callId&&(e=p.default.CallingStore.findRemoteCallMember(this.props.callId,this.state.renderKey)),!(!e||!this.props.callId)&&p.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(this.props.callId,e)}_getCallParticipantContextMenuOptions(){var e,t;const i=this.state.renderKey,o=null!==(e=this.props.callId)&&void 0!==e?e:"";return{callId:o,conversationMri:null!==(t=this.props.conversationMri)&&void 0!==t?t:"",userMri:i,isLocal:this.state.isLocal,isGroupCall:!!this.props.isGroupCall,isLocalMuteSupported:this._isLocalMuteSupported(),isMuted:!!this.state.isMuted&&this.state.isMuted,isServerMutedSupported:this._isServerMuteSupported(),sizeToFit:this.state.sizeToFit,isCompact:!!this.props.isCompact,isInTray:!!this.props.isInTray,isRenderingVideo:this.state.shouldRenderVideo,displayName:void 0,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:T.default.call().canSendMessageToParticipant&&!this.props.showChangeTogetherModeBackgroundOption,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:T.default.navigation().canAccessUserDetails&&!this.props.showChangeTogetherModeBackgroundOption,showLowerHandOption:!!this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!!this.props.showChangeTogetherModeBackgroundOption,showPinOption:y.CallUIUtils.shouldShowCallParticipantPinOption(i,o),showUnpinOption:y.CallUIUtils.shouldShowCallParticipantUnpinOption(i,o)}}_isCropVideoEnabledOn1On1MobileCall(){return Boolean(this.state.isNewCallPanelEnabled&&!this.props.isGroupCall&&!this.props.isInTray&&(!this.state.isLocal||this.state.showMyselfInTheGrid))}_enableContextMenuOn1On1MobileCall(){return Boolean(this.state.isNewCallPanelEnabled&&!this.props.isGroupCall&&(!this.state.isLocal||this.state.showMyselfInTheGrid||this.props.isInTray))}_getCallLocalVideoContextMenuOptions(){if(this.props.callId&&this.props.conversationMri)return C.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.state.shouldRenderVideo,this.state.sizeToFit,!!this.state.isHandRaised,this._isCropVideoEnabledOn1On1MobileCall(),this.props.isInTray)}_showOptionalNameTagForDesktop(){return!this.props.isCompact&&!this.state.hideNameTag&&!this.props.hideNameTag}_showOptionalNameTagForMobile(){return!1}_renderDebugInfo(){var e,t,i,o,n;if(this.state.metricEnabled&&void 0!==this.state.rendererMetrics)return(0,a.jsxs)(r.View,{style:[O.default.absoluteFill,z.debugContainer],children:[(0,a.jsxs)(r.Text,{style:z.debugTextStyle,children:["FrameType: ",null===(e=this.state.rendererMetrics)||void 0===e?void 0:e.frameType]}),(0,a.jsxs)(r.Text,{style:z.debugTextStyle,children:["RendererType: ",null===(t=this.state.rendererMetrics)||void 0===t?void 0:t.rendererType]}),(0,a.jsxs)(r.Text,{style:z.debugTextStyle,children:["StreamSize: ",null===(i=this.state.rendererMetrics)||void 0===i?void 0:i.streamSize]}),(0,a.jsxs)(r.Text,{style:z.debugTextStyle,children:["FramesDropped: ",null===(o=this.state.rendererMetrics)||void 0===o?void 0:o.framesDropped]}),(0,a.jsxs)(r.Text,{style:z.debugTextStyle,children:["FramesTotal: ",null===(n=this.state.rendererMetrics)||void 0===n?void 0:n.framesTotal]})]})}_shouldShowOptionalNameTag(e){return!!(this._showOptionalNameTagForDesktop()||s.isUndefined(e)&&this._showOptionalNameTagForMobile())}render(){if(this.state.hidden)return null;const e=this._renderAccessoryView(),t=this._renderRaisedHandOnRibbonParticipant(),i=!this.props.isCompact,o=[this.props.style,this._layoutController().getStyles(i,this.state.videoDimensions,this.props.renderKey)];return(0,a.jsxs)(r.Animated.View,{style:o,onLayout:this._onDimensionsChanged,onMouseEnter:()=>{this._setHovering(!0)},onMouseLeave:()=>{this._setHovering(!1)},children:[this._renderCallParticipantGestureView(e,t),void 0,void 0,this._renderDebugInfo()]})}_renderCallParticipantGestureView(e,t){const i=this._renderContentView(),o=this._getOptionalBackgroundEffectInfo(),n=c.BrowserEnvironment.isMobile()&&(this.props.isGroupCall||this._enableContextMenuOn1On1MobileCall());return(0,a.jsx)(F.default,{isCompact:this.props.isCompact,enableActionMenuOnMobile:n,videoBorderRadius:this.props.videoBorderRadius,renderKey:this.state.renderKey,showContextMenu:this.props.showContextMenu,callId:this.props.callId,displayName:this.state.displayName,isLargeGridBot:this.state.isLargeGridBot,isScreenSharing:this.state.isScreenSharing,isTogetherModeBot:this.state.isTogetherModeBot,showChangeTogetherModeBackgroundOption:this.props.showChangeTogetherModeBackgroundOption,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,zoomEnabled:this.state.zoomEnabled,isScreenShareZoomEnabled:this.state.isScreenShareZoomEnabled,sizeToFit:this.state.sizeToFit,onTap:this.props.onTap,getContextMenuHandler:this._getContextMenuHandler,setSizeToFit:this._setSizeToFit,getScreenShareVideoElement:()=>this._getScreenShareVideoElement(),getCallParticipantVideoViews:()=>this._callParticipantVideoViews,optionalNameTagLine:this._renderOptionalNameTagLine(e),accessoryView:e,contentView:i,optionalRaiseHandAccessory:t,optionalBackgroundInfo:o})}}t.CallParticipantView=G,t.default=G},135806:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentCallPreviewPanel=function(e,t){Q.default.newCauseId();0;const i=k.default.getS4LCMCFeatures().enableCallPreviewPermissionOnLoad,o=()=>v.default.navigateToCallPreviewViewModal({callOrigin:e.callOrigin,conversationMri:e.conversationMri,callId:e.callId,callJoinContext:e.callJoinContext,isGoLive:e.isGoLive,isTwincam:e.isTwincam,twincamInitUser:e.twincamInitUser,skipPermissionPanel:e.skipPermissionPanel,permissionsAlreadyChecked:!0},Q.default.newCauseId());i?h.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(o,o,e.conversationMri):o()};const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(496486)),r=i(331654),l=i(380157),c=i(148540),d=o.__importStar(i(397691)),u=o.__importDefault(i(815063)),h=o.__importDefault(i(369347)),p=o.__importDefault(i(455907)),g=i(44557),C=o.__importDefault(i(808467)),m=o.__importDefault(i(453761)),S=o.__importDefault(i(660401)),_=i(262725),f=o.__importDefault(i(827361)),y=o.__importStar(i(437782)),T=o.__importDefault(i(97595)),b=o.__importDefault(i(363091)),v=o.__importDefault(i(740794)),I=o.__importStar(i(873324)),w=o.__importStar(i(353831)),P=o.__importDefault(i(246230)),M=o.__importDefault(i(377556)),D=o.__importDefault(i(20758)),A=o.__importStar(i(179582)),k=o.__importDefault(i(150343)),R=o.__importDefault(i(13816)),x=o.__importDefault(i(601976)),L=o.__importDefault(i(201721)),B=o.__importDefault(i(942724)),V=o.__importDefault(i(251733)),O=o.__importDefault(i(960282)),E=o.__importDefault(i(117475)),N=o.__importStar(i(85385)),F=o.__importStar(i(704704)),U=i(154235),H=i(815146),j=i(16549),z=i(641400),G=i(331079),W=i(403396),K=i(596648),$=o.__importStar(i(170881)),q=i(26703),Q=(o.__importDefault(i(601274)),o.__importDefault(i(760989))),X=o.__importDefault(i(638260)),Z=o.__importDefault(i(132680)),J=o.__importDefault(i(167492)),Y=i(460515),ee=i(26178),te=o.__importDefault(i(351695)),ie=o.__importStar(i(128249)),oe=i(418926);var ae;!function(e){e[e.None=0]="None",e[e.Join=1]="Join",e[e.TwincamAvailable=2]="TwincamAvailable",e[e.TwincamConnected=3]="TwincamConnected"}(ae||(ae={}));const ne=(0,q.lazyProperties)({dialog:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),videoShadow:()=>n.Styles.createViewStyle({backgroundColor:j.Color.blackOverlay20}),dialogHeaderContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),controlsWrapper:()=>n.Styles.createViewStyle({flexDirection:"column",overflow:"visible",flex:1,justifyContent:"flex-end"}),previewControl:()=>n.Styles.createViewStyle({alignItems:"center",alignSelf:"center",paddingVertical:20}),previewControlOnMobile:()=>n.Styles.createViewStyle({maxWidth:300,marginBottom:10}),previewControlOnMobileLandscape:()=>n.Styles.createViewStyle({maxWidth:500,marginBottom:10}),previewControlLandscape:()=>n.Styles.createViewStyle({paddingVertical:10}),iconTogglesContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),convIcon:()=>n.Styles.createTextStyle({alignItems:"center",justifyContent:"center",backgroundColor:j.Color.black}),closeButton:()=>n.Styles.createViewStyle({justifyContent:"center",height:50,paddingLeft:15,paddingRight:15}),conversationHeader:()=>n.Styles.createViewStyle({flex:1,backgroundColor:"transparent"}),conversationTitle:()=>n.Styles.createTextStyle({color:j.Color.white,font:D.default.font.uiDisplayBold,fontSize:D.default.controlFontSize.messagingHeaderSmall,flexShrink:1}),conversationTitleMargin:()=>n.Styles.createTextStyle({marginRight:15}),conversationSubtitle:()=>n.Styles.createTextStyle({color:j.Color.white,flexShrink:1,lineHeight:25,height:25}),footer:()=>n.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerLandscape:()=>n.Styles.createViewStyle({height:70,alignSelf:"stretch"}),wideFooter:()=>n.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerWideLandscape:()=>n.Styles.createViewStyle({height:70,alignSelf:"stretch",flexDirection:"row",justifyContent:"center"}),wideButtonStyle:()=>n.Styles.createViewStyle({margin:10}),mediumButtonStyle:()=>n.Styles.createViewStyle({paddingLeft:65,paddingRight:65,margin:10}),settingsButtonStyleOnDesktop:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",top:0,right:0,paddingRight:15}),videoCanvasWrapper:()=>n.Styles.createViewStyle({backgroundColor:j.Color.black}),videoBorderRadius:()=>n.Styles.createViewStyle({borderRadius:10}),videoBoxShadow:()=>n.Styles.createViewStyle({shadowColor:j.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10}),cameraAndMicrophoneDetails:()=>n.Styles.createTextStyle({color:j.Color.white,fontSize:12,backgroundColor:"transparent",marginBottom:12}),backgroundReplacementButtonStyles:()=>n.Styles.createViewStyle({marginVertical:8}),backgroundReplacementButtonLabelStyles:()=>n.Styles.createTextStyle({color:j.Color.white,paddingLeft:5}),iconTogglesModernContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32}),iconTogglesModernContainerLandscape:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32,marginLeft:100,marginRight:100}),emptyView:()=>n.Styles.createViewStyle({height:0})});class se extends C.default{constructor(){super(...arguments),this._isCameraChanged=!1,this._isStartOrJoinCallBtnPressed=!1,this._wasToggleBackgroundBlurChanged=!1,this._wasToggleCameraChanged=!1,this._wasToggleMicrophoneChanged=!1,this._maybeCloseModal=()=>{const e=Q.default.newCauseId();N.log(H.LogTraceArea.CallingUI,"CallPreview _closeModal, causeId: "+e),B.default.isUsingStackNavigationContextNoSubscription()?v.default.goBack(e,this._getContext()):v.default.closeGenericDesktopModal(e,this._getRootViewId())},this._onLocalVideoPreviewRef=e=>{this.props.onVideoRenderingChange&&this.props.onVideoRenderingChange(!!e)},this._isLightAccessibleThemeUnderCamera=()=>this.props.displayControlsUnderVideoCanvas&&this._useAccessibleTheme()&&!this._useDarkTheme(),this._renderIconButtonWithSubtitle=(e,t,i,o,n)=>{let s=ne.backgroundReplacementButtonLabelStyles,r=j.Color.white,l=j.Color.whiteOverlay70;this._isLightAccessibleThemeUnderCamera()&&(r=g.MeetNowColors.getButtonColors(!0).backgroundColor,l=j.Color.blackOverlay70,s=g.MeetNowStyle.getStyle(!0).background);const c=(0,a.jsx)(_.Subtitle,{numberOfLines:1,style:s,children:t});return(0,a.jsx)(m.default,{icon:o,size:z.IconSize.size24,title:i,color:r,hoverColor:l,onPress:n,style:[...e,ne.backgroundReplacementButtonStyles],accessoryView:c})},this._renderAvSettingsButton=e=>this._renderIconButtonWithSubtitle(e,F.getString("AudioVideoSettings.Title"),F.getString("AudioVideoSettings.Title"),z.SkypeIcon.Settings,this._showAVSettings),this._switchCameraButtonPressed=()=>{if(this.isComponentMounted()){const e=Q.default.newCauseId(),t=this.state.selectedCamera,i=this.state.cameras.find((e=>e.id!==(null==t?void 0:t.id)&&e.position!==(null==t?void 0:t.position)));i?(h.default.DeviceStore.choosePreferredDevices({camera:i.id},e,this.props.isTwincam),N.log(H.LogTraceArea.CallingUI,"CallPreview _updateVideoSource "+t+" -> "+i+" causeId: "+e),this._isCameraChanged=!0):N.error(H.LogTraceArea.CallingUI,"CallPreview _updateVideoSource new camera not found causeId: "+e)}},this._closeButtonPressed=()=>{this.props.conversationMri&&!this.props.isTwincam&&p.default.trackLobbyClosed(this.props.conversationMri),N.log(H.LogTraceArea.CallingUI,"CallPreview closeButtonPressed"),this._maybeCloseModal()},this.onStartOrJoinCall=e=>{var t;const i=Q.default.newCauseId();if(N.log(H.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall callId: "+this.props.callId+" conversationMri: "+this.props.conversationMri+" isMicrophoneOn: "+this.state.isMicrophoneOn+" isCameraOn: "+this.state.isCameraOn+" transferCall: "+e+" activeEndpoints: "+this.state.activeUserEndpoints+" causeId: "+i),this._saveSettings(),this.props.conversationMri){this.props.hideActionButton||p.default.trackStartOrJoinMeetNowButtonClicked(this.props.conversationMri);let o=this.state.isMicrophoneOn?void 0:c.MuteFlags.MuteMicrophone;const a={conversationMri:this.props.conversationMri,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,callId:this._getCallId(),muteFlag:o,isCameraSelected:this.state.isCameraOn&&!!(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id),permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};if(!this.state.isProtocolLaunchCallPreview&&this.props.isGoLive||this.props.callId)if(this.props.callId){this.props.isTwincam&&(o=c.MuteFlags.MuteAll);const t={conversationMri:this.props.conversationMri,callId:this.props.callId,callJoinContext:this.props.callJoinContext,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,isGoLive:this.props.isGoLive,muteFlag:o,isCameraSelected:!0,transferCall:e,skipNavigation:this.props.isTwincam,isTwincam:!!this.props.isTwincam,permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};let a;if(t.isTwincam||this._maybeCloseModal(),this._shouldAnswerOrJoinCall()){a=h.default.CallNavigationHelper.answerOrJoinCall(t,i);const e=this.state.isCameraOn?I.CallPreviewActions.JoinWithVideo:I.CallPreviewActions.JoinWithoutVideo;X.default.trackCallPreview(e,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId())}else N.log(H.LogTraceArea.CallingUI,"CallPreview answerOrJoinCall call is already ended causeId: "+i),a=d.Rejected();a.catch((()=>{t.isTwincam||this._maybeCloseModal()}))}else this._maybeCloseModal(),h.default.CallNavigationHelper.startGoLiveCall(a,i);else this._maybeCloseModal(),h.default.CallNavigationHelper.startCall(a,i)}else N.log(H.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall stopped, conversationMri is undefined causeId: "+i);this._isStartOrJoinCallBtnPressed=!0},this.onEndCall=()=>{const e=Q.default.newCauseId(),t=this.props.callId,i=this.props.conversationMri;t&&i&&h.default.CallingStore.endCall(t,e).then((()=>{var t,i;N.log(H.LogTraceArea.CallingUI,"CallPreview onEndCall call is ended causeId: "+e),this.props.isTwincam&&(null===(i=(t=this.props).onTwincamStopped)||void 0===i||i.call(t)),this._updateCallState(e)}))},this._onCallEnded=e=>{this.props.isTwincam&&e.callId===this.props.callId&&(N.track(new oe.TwincamCallDisconnected(e.callId)),h.default.CallingStore.hasEndedCallLocally(e.callId)||this._maybeCloseModal())},this._focusOn=e=>{0},this._onToggleMic=(e,t)=>{const i=Q.default.newCauseId();if(N.log(H.LogTraceArea.CallingUI,"CallPreview._onToggleMic causeId: "+i),t)h.default.CallPermissionsUtils.requestPermissionStatus(G.PermissionType.Microphone,i).then((e=>{if(e){const e=!0;this.setState({isMicrophoneOn:e},(()=>this._focusOn(this._microphoneToggleRef))),this._wasToggleMicrophoneChanged=!0,this.props.callId&&this.state.callState===c.CallState.Connected?h.default.CallingStore.unmute(this.props.callId,i):L.default.setCallPreviewMicSettings(e)}else N.log(H.LogTraceArea.CallingUI,"CallPreview._onToggleMic cannot obtain microphone permission current state: "+V.default.permissionStatus(G.PermissionType.Microphone)+" causeId: "+i),P.default.showDeniedPromptWithSettingsOption(G.PermissionType.Microphone,U.MainRootViewId)}));else{const e=!1;this.setState({isMicrophoneOn:e},(()=>this._focusOn(this._microphoneToggleRef))),this._wasToggleMicrophoneChanged=!0,this.props.callId&&this.state.callState===c.CallState.Connected?h.default.CallingStore.mute(this.props.callId,i):L.default.setCallPreviewMicSettings(e)}},this._onToggleVideo=(e,t)=>{var i,o,a;const n=Q.default.newCauseId();if(N.log(H.LogTraceArea.CallingUI,"CallPreview._onToggleVideo causeId: "+n),t)h.default.CallPermissionsUtils.requestPermissionStatus(G.PermissionType.Camera,n).then((e=>{if(e){const e=!0;if(this.setState({isCameraOn:e},(()=>this._focusOn(this._cameraToggleRef))),this._wasToggleCameraChanged=!0,this.props.callId&&this.state.callState===c.CallState.Connected){const e=h.default.CallingStore.getLocalVideoState(this.props.callId);null==e||e.setLocalVideoEnabled(!0)}else L.default.setCallPreviewCameraSettings(e)}else N.log(H.LogTraceArea.CallingUI,"CallPreview._onToggleVideo cannot obtain camera permission current state: "+V.default.permissionStatus(G.PermissionType.Camera)+" causeId: "+n),P.default.showDeniedPromptWithSettingsOption(G.PermissionType.Camera,U.MainRootViewId)}));else if(this.isComponentMounted()){const e=!1;this.setState({isCameraOn:e},(()=>this._focusOn(this._cameraToggleRef))),this._wasToggleCameraChanged=!0,this.props.callId&&this.state.callState===c.CallState.Connected?null===(i=h.default.CallingStore.getLocalVideoState(this.props.callId))||void 0===i||i.setLocalVideoEnabled(!1):L.default.setCallPreviewCameraSettings(e)}null===(a=(o=this.props).onVideoStateChanged)||void 0===a||a.call(o,t)},this._onToggleBlur=(e,t)=>{const i=Q.default.newCauseId();this._wasToggleBackgroundBlurChanged=!0,N.log(H.LogTraceArea.CallingUI,"CallPreview blur toggle isBackgroundBlurred"+t+" activeCallId: "+this._getCallId()+" causeId: "+i),h.default.DeviceStore.setBackgroundEffectType(t?H.BackgroundEffect.Blur:H.BackgroundEffect.Off),this.state.isCameraOn||this.state.isBackgroundBlurred?this.setState({isBackgroundBlurred:t},(()=>this._focusOn(this._backgroundBlurToggleRef))):this.setState({isBackgroundBlurred:t,isCameraOn:!0},(()=>this._focusOn(this._backgroundBlurToggleRef)))},this._showAVSettings=()=>{const e=Q.default.newCauseId();N.log(H.LogTraceArea.CallingUI,"CallPreviewView._showAVSettings causeId: "+e),h.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),e)},this._canObserveActiveCall=()=>this.state.enableObservingCall&&this.props.conversationMri&&this.props.callId&&this.props.callJoinContext,this._canDisposeObservingCall=()=>!this._isStartOrJoinCallBtnPressed&&this.state.enableObservingCall&&this.state.callState===c.CallState.Observing,this._canPreheatActiveCall=()=>this.state.enablePreHeatCall&&this.props.conversationMri&&this.props.callId&&this.props.callJoinContext,this._canDisposePreheatedCall=e=>!this._isStartOrJoinCallBtnPressed&&this.state.callState!==c.CallState.Connected&&h.default.CallingStore.isPreheated(e),this._onMicrophoneToggleRef=e=>{this._microphoneToggleRef=e||void 0},this._onCameraToggleRef=e=>{this._cameraToggleRef=e||void 0},this._onBackgroundBlurToggleRef=e=>{this._backgroundBlurToggleRef=e||void 0},this._onSwitchCameraRef=e=>{this._switchCameraToggleRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),o=e.conversationMri?x.default.getDisplayName(e.conversationMri):void 0,a=k.default.getS4LCMCFeatures(),d=L.default.getUserPreferencesLocal(),u=R.default.getAppState()===n.Types.AppActivationState.Background||B.default.isUsingStackNavigationContext()&&!1===e.currentScreenIsFocused,p=e.isTwincam?void 0:d.callPreviewBlurSetting,g={isLandscape:!this._getContext().isPresentedInDesktopSubview&&O.default.getDeviceOrientation(i)===r.DeviceOrientation.Landscape,isMobileScreenSize:O.default.isMobileScreenSize(i)||B.default.isUsingStackNavigationContext(),isCameraDisabled:!h.default.DeviceStore.hasCameras()&&!h.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isMicrophoneDisabled:!h.default.DeviceStore.hasMicrophones(),selectedCamera:h.default.DeviceStore.getSelectedCamera(),cameras:h.default.DeviceStore.getCameras(),statusBarHeight:E.default.leavePaddingForStatusBar()?E.default.statusBarHeight():0,userMri:b.default.getSkypeMri(),conversationName:o,isProtocolLaunchCallPreview:e.callOrigin===H.NavigationCallOrigin.DeepLink,enableBlurBackgroundCallPreview:h.default.DeviceStore.isBackgroundBlurEnabled(),blurBackgroundOverride:p,isBackgroundBlurred:h.default.DeviceStore.isBackgroundBlurred(),enableBackgroundReplacement:h.default.DeviceStore.isBackgroundReplacementEnabled(),enablePreHeatCall:a.enablePreHeatCall,enableObservingCall:a.enableObservingCall,enableCallHandoff:a.enableCallHandoff,multipleEndpoints:void 0!==e.callId&&h.default.CallingStore.hasActiveEndpoints(e.callId),disableTransferIfCurrentInMeeting:a.disableTransferIfCurrentInMeeting,mutipleEndpointsExcludingLocal:void 0!==e.callId&&h.default.CallingStore.hasActiveEndpointsExcludingLocal(e.callId),callState:e.callId?h.default.CallingStore.getCallState(e.callId):void 0,isOutgoingVideoDisabled:h.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),shouldAskPermissionOnLoad:!e.permissionAlreadyAsked&&a.enableCallPreviewPermissionOnLoad,isAwaitingCameraConfirmation:h.default.CallControlsStore.isAwaitingCameraConfirmation(),noPreview:u};if(s.includes([c.CallState.Disconnecting,c.CallState.Disconnected,c.CallState.Connecting],g.callState)||(g.screenMode=ae.Join),!this._wasToggleCameraChanged){const t=!0;g.isCameraOn=!g.isOutgoingVideoDisabled&&!g.isCameraDisabled&&t&&V.default.permissionStatus(G.PermissionType.Camera)===l.PermissionStatus.Granted&&(s.isUndefined(d.callPreviewCameraSetting)||!!d.callPreviewCameraSetting||e.isTwincam)}return g.callState===c.CallState.Connected&&e.callId?g.isMicrophoneOn=!Z.default.isLocalOrServerMuted(e.callId):this._wasToggleMicrophoneChanged||(g.isMicrophoneOn=!g.isMicrophoneDisabled&&V.default.permissionStatus(G.PermissionType.Microphone)===l.PermissionStatus.Granted&&(s.isUndefined(d.callPreviewMicSetting)||!!d.callPreviewMicSetting)),g.isVideoInactive=Boolean(e.isTwincam&&e.callId&&g.callState===c.CallState.Connected&&!h.default.CallingStore.isProvidingVideo(e.callId)),g}componentDidMount(){var e,t;super.componentDidMount();const i=Q.default.newCauseId();N.log(H.LogTraceArea.CallingUI,"CallPreview componentDidMount causeId: "+i),$.dismissAll(),J.default.setCallPreviewViewSeen(this._getCallId()),w.registerModalDialogDismissalException(this.props.dialogId),this._callEndedEvent=h.default.CallingStore.callEndedEvent().subscribe(this._onCallEnded),this._updateBlurBackground(i),this._updateCallState(i),this.state.shouldAskPermissionOnLoad&&h.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(s.noop,s.noop,this.props.conversationMri,this.props.skipPermissionPanel),this.props.conversationMri&&!this.props.isTwincam&&p.default.trackLobbyOpen(this.props.conversationMri),null===(t=(e=this.props).onVideoStateChanged)||void 0===t||t.call(e,this.state.isCameraOn)}componentDidUpdate(e,t,i){var o,a,n,s,r;super.componentDidUpdate(e,t,i);const l=Q.default.newCauseId();if(t.enableBlurBackgroundCallPreview===this.state.enableBlurBackgroundCallPreview&&t.enableBackgroundReplacement===this.state.enableBackgroundReplacement&&t.isCameraDisabled===this.state.isCameraDisabled&&(null===(o=t.selectedCamera)||void 0===o?void 0:o.position)===(null===(a=this.state.selectedCamera)||void 0===a?void 0:a.position)&&t.blurBackgroundOverride===this.state.blurBackgroundOverride||this._updateBlurBackground(l),e.callId!==this.props.callId?(e.callId&&this._canDisposePreheatedCall(e.callId)&&this._disposePreheatedCall(e.callId),this._updateCallState(l)):this.state.callState!==t.callState&&this.state.callState===c.CallState.Observing&&this._updateCallState(l),this._isCameraChanged&&(null===(n=this._switchCameraToggleRef)||void 0===n||n.requestFocus()),this.props.isTwincam&&!this._isCameraChanged&&(null===(r=null===(s=this.state)||void 0===s?void 0:s.selectedCamera)||void 0===r?void 0:r.position)!==c.CameraPosition.Back){const e=h.default.DeviceStore.getCameras().find((e=>e.position===c.CameraPosition.Back));if(e){const t=Q.default.newCauseId();N.log(H.LogTraceArea.CallingUI,"CallPreview componentDidUpdate select back camera for Twincam causeId: "+t),h.default.DeviceStore.choosePreferredDevices({camera:e.id},t,!0)}}}componentWillUnmount(){var e;super.componentWillUnmount();const t=Q.default.newCauseId();N.log(H.LogTraceArea.CallingUI,"CallPreview componentWillUnmount causeId: "+t),J.default.setCallPreviewViewNotSeen(this._getCallId()),null===(e=this._callEndedEvent)||void 0===e||e.unsubscribe(),this.props.callId&&this._canDisposePreheatedCall(this.props.callId)&&this._disposePreheatedCall(this.props.callId),this._canDisposeObservingCall()&&h.default.CallingStore.disposeObservingCalls(t),this._isStartOrJoinCallBtnPressed||X.default.trackCallPreview(I.CallPreviewActions.Cancel,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId()),this._isStartOrJoinCallBtnPressed||p.default.finishScenario(),this._saveSettings()}_saveSettings(){if(this.props.isTwincam)return;const e={callPreviewMicSetting:this.state.isMicrophoneOn,callPreviewCameraSetting:this.state.isCameraOn};this._wasToggleBackgroundBlurChanged&&(e.callPreviewBlurSetting=this.state.isBackgroundBlurred),L.default.setUserPreferencesLocal(e)}_updateCallState(e){!this.state.enableObservingCall||this._canDisposeObservingCall()?this._canPreheatActiveCall()&&!this._preheatedCallCauseId&&this._startPreheatingActiveCall():this._canObserveActiveCall()&&this._startObservingActiveCall(e)}render(){const e=this.props.isModal?(0,a.jsx)(m.default,{style:ne.closeButton,icon:A.closeIcon(),size:z.IconSize.size24,title:F.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:j.Color.white,hoverColor:j.Color.whiteOverlay70}):this._renderEmptyForFlexboxView();let t,i,o;const s=this._renderConversationTitle();if(!u.default.isMobile()){const e=[ne.settingsButtonStyleOnDesktop];i=this._renderAvSettingsButton(e)}!this.state.isCameraOn||this.state.isCameraDisabled||this.state.isVideoInactive?this.props.fullScreenMode||(o=(0,a.jsx)(n.View,{style:[ne.convIcon,f.default.absoluteFill],children:(0,a.jsx)(W.UserIcon,{userMri:this.state.userMri,placeholderIcon:this.props.useAvatarPlaceholderIcon?z.SkypeIcon.Contact:void 0,size:this.props.avatarSize?this.props.avatarSize:this.state.isLandscape?K.UserIconSize.Size100:K.UserIconSize.Size160})})):this.state.noPreview||(t=(0,a.jsx)(te.default,{ref:this._onLocalVideoPreviewRef,nametag:"video_local_preview",options:this.props.videoPreviewOptions}));const r=this._getCallPreviewControl(),l=[ne.dialogHeaderContainer],c=this._getHeaderTopMargin(!!s);c&&l.push(M.default.marginTopStyle(c));const d=[f.default.absoluteFill,ne.videoCanvasWrapper];this.props.fullScreenMode||this.state.isMobileScreenSize||(d.push(ne.videoBorderRadius),d.push(ne.videoBoxShadow));return(0,a.jsxs)(n.View,{style:ne.dialog,children:[(0,a.jsx)(ie.default,{statusBarKey:"CallPreviewView",backgroundColor:j.Color.black,barStyle:ie.BarStyle.LIGHT_CONTENT,animated:!0}),(0,a.jsxs)(n.View,{style:d,children:[t,(0,a.jsx)(n.View,{style:[ne.videoShadow,f.default.absoluteFill]}),o]}),(0,a.jsxs)(n.View,{style:l,children:[e,s]}),this.props.displayControlsUnderVideoCanvas?(0,a.jsxs)(n.View,{style:ne.controlsWrapper,children:[r,i]}):(0,a.jsxs)(n.View,{style:ne.controlsWrapper,children:[i,r]}),undefined]})}_renderEmptyForFlexboxView(){const e=[ne.closeButton];return e.push(ne.emptyView),(0,a.jsx)(n.View,{style:e},"emptyForFlexbox")}_getHeaderTopMargin(e){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:e&&!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderOptionalCameraAndMicrophoneDetails(){if(!this.props.showCameraAndMicrophoneDetails||this.state.isMicrophoneOn&&this.state.isCameraOn)return;let e;return e=!this.state.isMicrophoneOn&&this.state.isCameraOn?F.getString("CallPreview.MicrophoneOff"):this.state.isMicrophoneOn&&!this.state.isCameraOn?F.getString("CallPreview.CameraOff"):F.getString("CallPreview.CameraAndMicrophoneOff"),(0,a.jsx)(n.Text,{style:ne.cameraAndMicrophoneDetails,children:e})}_renderConversationTitle(){if(this.props.callOrigin&&H.NavigationCallOrigin[this.props.callOrigin]===H.NavigationCallOrigin[H.NavigationCallOrigin.InviteLink]){const e=[ne.conversationTitle];return this.state.isCameraOn,(0,a.jsxs)(n.View,{style:ne.conversationHeader,children:[(0,a.jsx)(n.Text,{style:e,ellipsizeMode:"tail",numberOfLines:1,children:this.state.conversationName}),(0,a.jsx)(_.Caption,{style:ne.conversationSubtitle,children:F.getString("CallPreview.CallPreviewCallInProgressSubtitle")})]})}}_renderOptionalActionButton(){if(this.props.hideActionButton)return;const e=this.props.callOrigin===H.NavigationCallOrigin.LegacyJoinLobby||this.props.callOrigin===H.NavigationCallOrigin.LegacyCreateLobby||this.props.callOrigin===H.NavigationCallOrigin.JoinLobby||this.props.callOrigin===H.NavigationCallOrigin.CreateLobby||this.props.callOrigin===H.NavigationCallOrigin.DeeplinkWithCallTrue,t=e&&!this.props.callId||this.state.isProtocolLaunchCallPreview,i={backgroundColor:t?j.Color.blue:j.Color.green,textColor:j.Color.white};if(this.state.screenMode===ae.TwincamConnected){const e={backgroundColor:j.Color.red,textColor:j.Color.white};return(0,a.jsx)(n.View,{style:this.state.isLandscape?ne.footerLandscape:ne.footer,children:(0,a.jsx)(S.default,{buttonSize:U.SXButtonSize.Medium,buttonStyle:U.SXButtonStyle.Custom,title:F.getString("CallPreview.StopTwincam"),onPress:()=>this.onEndCall(),buttonConfig:e,autoFocus:!1,disabled:!this.props.conversationMri})})}if(this.state.screenMode!==ae.None){if(e||this.props.isTwincam)return;const o=t?F.getString("CallPreview.StartCallButtonTitle"):F.getString("CallPreview.JoinButtonTitle");let s=this.state.enableCallHandoff&&this.state.multipleEndpoints;this.state.disableTransferIfCurrentInMeeting,0;const r=s,l=s&&!r?this.state.isLandscape?ne.footerWideLandscape:ne.wideFooter:this.state.isLandscape?ne.footerLandscape:ne.footer;return(0,a.jsxs)(n.View,{style:l,children:[!r&&(0,a.jsx)(S.default,{buttonSize:U.SXButtonSize.Medium,buttonStyle:U.SXButtonStyle.Custom,title:o,buttonConfig:i,onPress:()=>this.onStartOrJoinCall(!1),autoFocus:!1,disabled:!this.props.conversationMri,style:void 0}),(s||r)&&(0,a.jsx)(S.default,{buttonSize:U.SXButtonSize.Medium,buttonStyle:U.SXButtonStyle.LightFill,title:F.getString("CallPreview.HandoffCallTransfer"),onPress:()=>this.onStartOrJoinCall(!0),icon:z.SkypeIcon.CallTransfer,disabled:!this.props.conversationMri,style:void 0})]})}}_shouldAnswerOrJoinCall(){if(this.props.isTwincam||k.default.getS4LCMCFeaturesNoSubscription().disableCallPreviewJoinCallCheck)return!0;if(!this.props.conversationMri)return!1;return h.default.ActiveCallUIHelper.getActiveCallId(this.props.conversationMri)===this.props.callId}_getCallPreviewControl(){const e=[ne.previewControl];return this.state.isLandscape&&e.push(ne.previewControlLandscape),this.props.previewControlStyle&&e.push(this.props.previewControlStyle),(0,a.jsxs)(n.View,{style:e,children:[this._renderOptionalCameraAndMicrophoneDetails(),this._renderControlSection(),this._renderOptionalActionButton()]})}_renderControlSection(){const e=this._getCallControlMicButton(),t=this._getCallControlVideoButton(),i=this._getCallControlBackgroundBlurButton(),o=this.state.screenMode===ae.TwincamAvailable;if(u.default.isMobile()){const s=this._getCallControlCameraReverseButton();return(0,a.jsxs)(n.View,{style:this.state.isLandscape&&o?ne.iconTogglesModernContainerLandscape:ne.iconTogglesModernContainer,children:[e,t,s,i]})}return(0,a.jsxs)(n.View,{style:ne.iconTogglesContainer,children:[e,t,i]})}_getCallControlCameraReverseButton(){const{isTwincam:e}=this.props,{isProtocolLaunchCallPreview:t}=this.state;if(t&&!e)return;let i;return i=this.state.selectedCamera?this.state.selectedCamera.position===c.CameraPosition.Front?F.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):F.getString("CallControls.CallButtonSwitchCameraForwardLabel"):F.getString("CallControls.CallButtonSwitchCameraLabel"),(0,a.jsx)(ee.CallButton,{ref:this._onSwitchCameraRef,icon:z.SkypeIcon.SwitchCamera,title:F.getString("CapturePanel.SwitchCameraButtonTitle"),size:ee.CallButtonSize.Large,onPress:this._switchCameraButtonPressed,accessibilityLabel:i,backgroundStyle:ee.CallButtonBackgroundStyle.Solid},Y.CallControlsKeys.VideoQuickSettings)}_getCallControlVideoButton(){const e=!this.state.isCameraDisabled&&this.state.isCameraOn&&!this.state.isVideoInactive;let t,i;const o=u.default.isMobile()?ee.CallButtonSize.Large:ee.CallButtonSize.Small;return this.state.isOutgoingVideoDisabled?t=i=F.getString("AudioVideoSettings.OutgoingVideoDisabled"):(t=F.getString(e?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),i=T.default.generateTooltipLabelWithShortcutForCondition(t,H.KeyboardShortcut.ToggleCamera)),(0,a.jsx)(ee.CallButton,{ref:this._onCameraToggleRef,icon:this.state.isAwaitingCameraConfirmation?z.SkypeIcon.Ok:e?z.SkypeIcon.Video:z.SkypeIcon.VideoOff,title:i,size:o,isDisabled:this.state.isCameraDisabled,isToggledOn:e,onPress:t=>this._onToggleVideo(t,!e),accessibilityLabel:t,backgroundStyle:e?ee.CallButtonBackgroundStyle.Overlay:ee.CallButtonBackgroundStyle.Solid,colorConfig:this.state.isAwaitingCameraConfirmation?this._cameraConfirmColorConfig():void 0,doNotAddHorizontalMargin:!1},Y.CallControlsKeys.Video)}_getCallControlMicButton(){const e=!this.state.isMicrophoneDisabled&&this.state.isMicrophoneOn,t=u.default.isMobile()?ee.CallButtonSize.Large:ee.CallButtonSize.Small,i=F.getString(e?"CallControls.CallButtonMute":"CallControls.CallButtonUnmuteLabel"),o=T.default.generateTooltipLabelWithShortcutForCondition(i,H.KeyboardShortcut.ToggleMicrophone);return(0,a.jsx)(ee.CallButton,{ref:this._onMicrophoneToggleRef,icon:e?z.SkypeIcon.Microphone:z.SkypeIcon.MicrophoneOff,title:o,size:t,isToggledOn:e,onPress:t=>this._onToggleMic(t,!e),accessibilityLabel:i,backgroundStyle:e?ee.CallButtonBackgroundStyle.Overlay:ee.CallButtonBackgroundStyle.Solid,doNotAddHorizontalMargin:!1},Y.CallControlsKeys.Mic)}_getCallControlBackgroundBlurButton(){this.state.enableBlurBackgroundCallPreview,!this.state.isCameraDisabled&&this.state.isCameraOn&&this.state.isBackgroundBlurred,F.getString("CallPreview.CallPreviewBlurToggleLabel"),u.default.isMobile()?ee.CallButtonSize.Large:ee.CallButtonSize.Small}_getHeaderText(e){return se.getHeaderText()}static getHeaderText(){return F.getString("CallPreview.CallPreviewViewLabel")}_updateBlurBackground(e){if(!this.state.enableBlurBackgroundCallPreview)return void N.log(H.LogTraceArea.CallingUI,"Not changing background blur; background blur is not available.");if(this.state.enableBackgroundReplacement)return void N.log(H.LogTraceArea.CallingUI,"Not changing background blur; background replacement is enabled.");if(this.state.isCameraDisabled)return void N.log(H.LogTraceArea.CallingUI,"Not changing background blur; camera is disabled.");if(this._wasToggleBackgroundBlurChanged)return void N.log(H.LogTraceArea.CallingUI,"Not changing background blur; background blur was set by user.");const{blurBackgroundOverride:t,selectedCamera:i}=this.state,o=void 0!==t?t:(null==i?void 0:i.position)===c.CameraPosition.Front;h.default.DeviceStore.setBackgroundEffectType(o?H.BackgroundEffect.Blur:H.BackgroundEffect.Off)}_cameraConfirmColorConfig(){return{iconColor:j.Color.white,backgroundColor:j.Color.blue,selectedIconColor:j.Color.white,selectedBackgroundColor:j.Color.blue}}_getCallId(){return this.props.callId||Q.default.newGuid()}_startObservingActiveCall(e){const{conversationMri:t,callId:i,callJoinContext:o,callOrigin:a}=this.props;if(N.log(H.LogTraceArea.CallingUI,"CallPreview._startObservingActiveCall conversationMri: "+y.mriOrId(t)+" callId: "+i+" causeId: "+e),t&&i&&o)this.state.callState!==c.CallState.Observing?h.default.CallingStore.subscribeToCall(t,i,o,a,e).then((()=>{!this.isComponentMounted()&&this._canDisposeObservingCall()&&this._disposeObservingCall(e)})):N.log(H.LogTraceArea.CallingUI,"CallPreview._startObservingActiveCall abort, call already observed callId: "+i+" causeId: "+e);else{const o="CallPreview._startObservingActiveCall abort, conversationMri, callId, and callJoinContext cannot be undefined conversationMri: "+y.mriOrId(t)+" callId: "+i+" causeId: "+e;N.error(H.LogTraceArea.CallingUI,o)}}_disposeObservingCall(e=Q.default.newCauseId()){N.log(H.LogTraceArea.CallingUI,`CallPreview._disposeObservingCalls causeId: ${e}`),h.default.CallingStore.disposeObservingCalls(e)}_startPreheatingActiveCall(){const e=Q.default.newCauseId(),{conversationMri:t,callId:i,callJoinContext:o,callOrigin:a}=this.props;if(N.log(H.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall conversationMri: "+t+" callId: "+i+" causeId: "+e),t&&i&&o)h.default.CallingStore.isPreheatedNoSubscription(i)?N.log(H.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall abort, call already preheated callId: "+i+" causeId: "+e):(h.default.CallingStore.startPreheating(t,i,o,{withVideo:this.state.isCameraOn,muteFlags:this.state.isMicrophoneOn?void 0:c.MuteFlags.MuteMicrophone},a,e).then((()=>{!this.isComponentMounted()&&this._canDisposePreheatedCall(i)&&this._disposePreheatedCall(i)})),this._preheatedCallCauseId=e);else{const o="CallPreview._startPreheatingActiveCall abort, conversationMri, callId, and callJoinContext cannot be undefined conversationMri: "+t+" callId: "+i+" causeId: "+e;N.error(H.LogTraceArea.CallingUI,o)}}_disposePreheatedCall(e){const t=this._preheatedCallCauseId||Q.default.newCauseId();N.log(H.LogTraceArea.CallingUI,`CallPreview._disposePreheatedCall callId: ${e} causeId: ${t}`),h.default.CallingStore.stopPreheating(e,t)}}t.default=se},556434:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.testableSubmitPressed=Q;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importDefault(i(264596)),r=i(331654),l=o.__importStar(i(516778)),c=i(623627),d=o.__importStar(i(265801)),u=o.__importDefault(i(54720)),h=o.__importDefault(i(808467)),p=i(760053),g=o.__importStar(i(873324)),C=o.__importStar(i(44717)),m=o.__importDefault(i(340724)),S=i(154235),_=i(848822),f=o.__importStar(i(761393)),y=o.__importStar(i(170881)),T=o.__importDefault(i(601976)),b=i(815146),v=o.__importDefault(i(560099)),I=i(77395),w=o.__importDefault(i(970035)),P=o.__importStar(i(85385)),M=i(26703),D=o.__importDefault(i(11252)),A=o.__importStar(i(704704)),k=o.__importDefault(i(960282)),R=o.__importDefault(i(117475)),x=o.__importDefault(i(377556)),L=o.__importDefault(i(525864)),B=i(375258),V=o.__importDefault(i(660401)),O=i(16549),E=o.__importDefault(i(20758)),N=i(641400),F=o.__importDefault(i(827361)),U=i(262725),H=i(403396),j=i(596648),z=o.__importDefault(i(760989)),G=i(677982),W=o.__importDefault(i(92477)),K=(0,M.lazyProperties)({starsPage:()=>l.Styles.createViewStyle({flex:1,alignItems:"center"}),starsPageInnerContainer:()=>l.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingTop:20}),starsPageInner:()=>l.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-around"}),starsContainer:()=>l.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between"}),problemSectionContainer:()=>l.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",paddingLeft:10}),problemSectionTitle:()=>l.Styles.createTextStyle({paddingTop:20,paddingBottom:10}),checkboxAndTextContainer:()=>l.Styles.createViewStyle({justifyContent:"center",paddingVertical:5,paddingRight:5,borderBottomWidth:1,minHeight:50}),checkbox:()=>l.Styles.createViewStyle({position:"absolute",right:0,top:12}),problem:()=>l.Styles.createTextStyle({marginRight:48}),starIconSmall:()=>l.Styles.createViewStyle({alignItems:"center"}),starIconDeselected:()=>l.Styles.createViewStyle({opacity:.7}),starText:()=>l.Styles.createTextStyle({textAlign:"center",width:200}),footer:()=>l.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerLandscape:()=>l.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerButton:()=>l.Styles.createViewStyle({height:60,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),titleContainer:()=>l.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",alignItems:"center",paddingTop:10}),title:()=>l.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginBottom:5,marginTop:10,marginHorizontal:15}),subtitle:()=>l.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginHorizontal:15}),body:()=>l.Styles.createTextStyle({marginVertical:20,marginHorizontal:10}),rateUsPage:()=>l.Styles.createViewStyle({flex:1,paddingVertical:10}),rateUsSectionContainer:()=>l.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:10}),rateUsButton:()=>l.Styles.createButtonStyle({flex:1,alignSelf:"stretch"}),rateUsFooter:()=>l.Styles.createViewStyle({height:120,marginHorizontal:10,alignSelf:"stretch"}),rateUsFooterLandscape:()=>l.Styles.createViewStyle({height:60,marginHorizontal:10,alignSelf:"stretch",flexDirection:"row"}),rateUsText:()=>l.Styles.createTextStyle({marginTop:20,marginHorizontal:10,textAlign:"center"})}),$="CallQualityFeedback.";class q extends h.default{constructor(){super(...arguments),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1),this._toggleForStar1=e=>this._starToggled(e,1),this._toggleForStar2=e=>this._starToggled(e,2),this._toggleForStar3=e=>this._starToggled(e,3),this._toggleForStar4=e=>this._starToggled(e,4),this._toggleForStar5=e=>this._starToggled(e,5),this._contentForSection=e=>{const t=A.getStringUnsafe($+e.title);return(0,a.jsxs)(l.View,{style:K.problemSectionContainer,children:[(0,a.jsx)(U.Subtitle,{style:K.problemSectionTitle,children:t}),n.map(e.problems,this._contentForProblem)]},e.title)},this._contentForProblem=e=>{const t=$+e,i=A.getStringUnsafe(t),o=n.includes(this.state.checkedProblems,e),s=[l.Types.AccessibilityTrait.CheckBox];o&&s.push(l.Types.AccessibilityTrait.Checked);const r=i;return(0,a.jsx)(l.Button,{accessibilityTraits:s,accessibilityLabel:r,onPress:t=>this._problemTokenToggled(t,e),children:(0,a.jsxs)(v.default,{style:[K.checkboxAndTextContainer,this._themeStyles.dividerBorderColorStyle],children:[(0,a.jsx)(U.BodyText,{style:K.problem,children:i}),(0,a.jsx)(l.View,{style:K.checkbox,children:(0,a.jsx)(D.default,{isOn:o})})]})},e)},this._onBack=()=>(this._submitPressedTrue(),P.log(b.LogTraceArea.HardwareBackButton,"goBack: true componentId: CallQualityFeedbackPanel"),!0)}_buildState(e,t){const{appRatingPromptConfig:i}=G.AppConfigStore.getS4LUiFeatures(),o=Object.assign({top:R.default.statusBarPadding(),bottom:R.default.bottomSafeAreaInset(S.BottomInsetDefault)},R.default.horizontalInsets(S.HorizontalInsetDefault)),a=this._getRootViewId(),n={displayName:T.default.getDisplayName(e.conversationMri),isOneOnOne:C.isOneOnOneConversation(e.conversationMri),isLandscape:!this._getContext().isPresentedInDesktopSubview&&k.default.getDeviceOrientation(a)===r.DeviceOrientation.Landscape,isSmallDevice:k.default.isSmallDevice(a),isMobileScreenSize:k.default.isMobileScreenSize(a),safeAreaInsets:o,enableAppRatingPrompt:i.enabled};return t&&(n.stars=0,n.renderingProblems=!1,n.renderingRateUs=!1,n.checkedProblems=[],n.enableAppRatingPrompt=i.enabled),n}componentDidMount(){super.componentDidMount(),y.dismissAll(),u.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),u.default.unsubscribe(this._onBack)}render(){const e=this.state.renderingProblems?this._contentForProblemsPage():this.state.renderingRateUs&&!this.state.enableAppRatingPrompt?this._contentForRateUsPage():this._contentForStarsPage();return(0,a.jsx)(L.default,{dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:f.DefaultWidth,maxHeight:this.state.isMobileScreenSize?void 0:f.DefaultHeight,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:e.accessibilityLabel,children:(0,a.jsx)(l.View,{style:[F.default.flexOne,this._themeStyles.primaryBackgroundColorStyle],children:e.content})})}_headerCloseButton(){return{closeButtonType:B.CloseButtonType.Close,title:A.getString("Global.CloseButtonTitle"),onPress:this._submitPressedTrue,color:this._themeColors.primaryIconColor}}_contentForStarsPage(){let e;e=this.state.isOneOnOne?(0,a.jsx)(H.UserIcon,{userMri:this.props.conversationMri,size:this.state.isLandscape?j.UserIconSize.Size60:j.UserIconSize.Size120}):(0,a.jsx)(_.ConversationIcon,{conversationId:this.props.conversationMri,altName:this.state.displayName,size:this.state.isLandscape?j.ConversationIconSize.Size60:j.ConversationIconSize.Size120});const t=[E.default.messagingHeaderFontStyle(!!this.state.isLandscape),this._themeStyles.primaryTextColorStyle,K.title],i=[K.titleContainer];this.state.safeAreaInsets.top&&i.push(x.default.paddingTopStyle(this.state.safeAreaInsets.top));const o=(0,a.jsxs)(l.View,{style:i,children:[(0,a.jsx)(l.Text,{style:t,numberOfLines:1,children:this.state.displayName}),(0,a.jsx)(U.Subtitle,{style:K.subtitle,children:C.isEncryptedThread(this.props.conversationMri)?A.getString("CallQualityFeedback.SubtitleEncrypted"):A.getString("CallQualityFeedback.Subtitle")})]}),n=A.getString("CallQualityFeedback.Title");return{content:(0,a.jsxs)(l.View,{style:K.starsPage,children:[o,(0,a.jsx)(l.View,{style:K.starsPageInnerContainer,children:(0,a.jsxs)(l.View,{style:K.starsPageInner,children:[e,(0,a.jsx)(U.BodyText,{bold:!0,style:K.starText,children:n}),(0,a.jsxs)(l.View,{style:K.starsContainer,children:[this._contentForStar(1,this._toggleForStar1),this._contentForStar(2,this._toggleForStar2),this._contentForStar(3,this._toggleForStar3),this._contentForStar(4,this._toggleForStar4),this._contentForStar(5,this._toggleForStar5)]})]})}),this._renderFooter()]}),accessibilityLabel:n}}_accessibilityLabelForStarNum(e){switch(e){case 1:return A.getString("CallQualityFeedback.1-StarAccessibilityLabel");case 2:return A.getString("CallQualityFeedback.2-StarAccessibilityLabel");case 3:return A.getString("CallQualityFeedback.3-StarAccessibilityLabel");case 4:return A.getString("CallQualityFeedback.4-StarAccessibilityLabel");default:return A.getString("CallQualityFeedback.5-StarAccessibilityLabel")}}_contentForStar(e,t){const i=this.state.stars||0,o=[K.starIconSmall],n=i<e;n&&o.push(K.starIconDeselected);let s=this._accessibilityLabelForStarNum(e);return i===e&&(s+=", "+A.getString("Global.SelectedAccessibilityLabel")),(0,a.jsx)(I.HoverableButton,{onPress:t,accessibilityLabel:s,children:(0,a.jsx)(w.default,{icon:n?N.SkypeIcon.Favourite:N.SkypeIcon.FavouriteFilled,size:N.IconSize.size32,color:O.Color.blue,style:o})})}_contentForProblemsPage(){const e=this._headerCloseButton(),t={icon:N.SkypeIcon.Send,title:A.getString("Global.SendButtonTitle"),disabled:n.isEmpty(this.state.checkedProblems),onPress:this._submitPressedFalse,flipIcon:this._getContext().isRTL},i=(0,a.jsx)(B.SimplePanelHeader,{panelName:A.getString("CallQualityFeedback.ProblemsTitle"),leftButton:e,rightButtons:t});let o;o=1===n.size(this.props.problemSections)?this.props.problemSections[0].type===p.ProblemSectionType.Audio?A.getString("CallQualityFeedback.ProblemsAudioBody"):A.getString("CallQualityFeedback.ProblemsVideoBody"):A.getString("CallQualityFeedback.ProblemsAudioAndVideoBody");const s=[K.problemSectionContainer];x.default.hasHorizontalSafeAreas(this.state.safeAreaInsets)&&s.push(x.default.horizontalPaddingStyle(this.state.safeAreaInsets));return{content:(0,a.jsxs)(l.View,{style:F.default.flexOne,children:[i,(0,a.jsx)(l.ScrollView,{style:F.default.flexOne,children:(0,a.jsxs)(l.View,{style:s,children:[(0,a.jsx)(U.BodyText,{style:K.body,children:o}),n.map(this.props.problemSections,this._contentForSection)]})})]}),accessibilityLabel:o}}_contentForRateUsPage(){const e=[K.rateUsPage];this.state.safeAreaInsets.top&&e.push(x.default.paddingTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&e.push(x.default.paddingBottomStyle(this.state.safeAreaInsets.bottom));const t=A.getString("CallQualityFeedback.RateTheAppBody");return{content:(0,a.jsxs)(l.View,{style:e,children:[(0,a.jsx)(U.PanelHeader,{landscape:this.state.isLandscape,style:K.rateUsText,children:A.getString("CallQualityFeedback.Thanks")}),(0,a.jsx)(U.BodyText,{style:K.rateUsText,children:t}),(0,a.jsx)(l.View,{style:K.rateUsSectionContainer,children:(0,a.jsx)(c.AnimatedEmoticon,{size:this.state.isLandscape?c.Size.ExtraLarge:c.Size.ExtraExtraLarge,innerText:"like",emoticonName:"like",showPlaceHolder:!0,standaloneAnimation:!0})}),(0,a.jsxs)(l.View,{style:this.state.isLandscape?K.rateUsFooterLandscape:K.rateUsFooter,children:[(0,a.jsx)(V.default,{style:K.rateUsButton,buttonStyle:S.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:O.AgnosticGradientFillButtonColors.blue,onPress:this._submitPressedFalse,title:A.getString("CallQualityFeedback.RateTheApp")}),(0,a.jsx)(V.default,{style:K.rateUsButton,buttonSize:S.SXButtonSize.Medium,buttonStyle:S.SXButtonStyle.ThemeNoBackground,title:A.getString("CapturePermissions.PrePromptCancelButtonTitle"),onPress:this._submitPressedTrue})]})]}),accessibilityLabel:t}}_renderFooter(){let e;this.state.renderingProblems||this.state.renderingRateUs||(e={title:this.state.stars?A.getString("Global.SendButtonTitle"):A.getString("Global.CancelLabel"),onPress:this.state.stars?this._submitPressedFalse:this._submitPressedTrue});const t=e?(0,a.jsx)(V.default,{style:K.footerButton,buttonSize:S.SXButtonSize.Medium,buttonStyle:S.SXButtonStyle.ThemeNoBackground,title:e.title,onPress:e.onPress}):void 0;return(0,a.jsx)(l.View,{style:this.state.isLandscape?K.footerLandscape:K.footer,children:t})}_submitPressed(e){const t=z.default.newCauseId();P.log(b.LogTraceArea.Navigation,"CallQualityFeedbackPanel._submitPressed,  causeId: "+t),this.isComponentMounted(),Q(this.props,this.state,(e=>{this.isComponentMounted()&&this.setState(e)}),e)&&this._goBack(t)}_problemTokenToggled(e,t){e.stopPropagation();let i=!1;const o=this.state.checkedProblems?n.clone(this.state.checkedProblems):[];n.includes(o,t)?n.remove(o,(e=>e===t)):(o.push(t),i=!0);const a=$+t,s=A.getStringUnsafe(a)+", "+(i?A.getString("FeedbackMechanism.AccLabelCheckboxChecked"):A.getString("FeedbackMechanism.AccLabelCheckboxUnchecked"));l.Accessibility.announceForAccessibility(s),this.setState({checkedProblems:o})}_starToggled(e,t){e.stopPropagation();const i=m.default.combinedAccessibilityLabel(this._accessibilityLabelForStarNum(t),A.getString("Global.SelectedAccessibilityLabel"));i&&l.Accessibility.announceForAccessibility(i),this.setState({stars:t})}_getCheckboxAccessibilityLabel(e,t){const i=this._getCheckboxCheckedState(t);return A.getString("FeedbackMechanism.AccLabelCheckbox",{checkboxTitle:e,state:i})}_getCheckboxCheckedState(e){return e?A.getString("FeedbackMechanism.AccLabelCheckboxChecked"):A.getString("FeedbackMechanism.AccLabelCheckboxUnchecked")}_getHeaderText(e){return q.getHeaderText()}static getHeaderText(){return A.getString("CallQualityFeedback.Title")}}function Q(e,t,i,o){if(t.renderingRateUs)return o||(d.openAppStore(),W.default.saveRateAppTime()),!0;if(o||t.renderingProblems||5===t.stars||4===t.stars&&t.enableAppRatingPrompt){const i=t.stars?"random":"cancel",o=t.stars||void 0,a=t.stars&&t.stars<5?(0,p.tokensString)(t.checkedProblems||[]):void 0,n=C.isGroupConversation(e.conversationMri),r=e.problemSections.filter((e=>e.type===p.ProblemSectionType.Video)).length>0,l=C.isPhoneMri(e.conversationMri),c=new g.CQF(e.callId,e.endpointId,e.nodeId,e.participantId,o,a,105,i,e.pstnCdrId,e.maxConnectedParticipants,n,r,l);return P.log(b.LogTraceArea.CallQualityFeedback,"CQF: submitting event. reason: "+i+", stars: "+o+", problemTokens: "+a),P.track(c),s.default.provideCallQualityFeedback(e.callId,e.participantId,"105",i,o?o-1:0,a),!0}return i({renderingProblems:!0}),!1}t.default=q},891903:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(667294),r=i(854646),l=(0,i(26703).lazyProperties)({gradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,opacity:.8})});t.default=(0,s.memo)((({gradientColors:e,borderRadius:t,showBackgroundGradient:i})=>{if(!(null==e?void 0:e.length)||!i)return null;const o=[l.gradient];return t&&o.push(n.Styles.createViewStyle({borderRadius:t},!1)),(0,a.jsx)(r.GradientView,{style:o,direction:r.GradientDirection.BOTTOM,colors:e})}))},975881:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionType=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(667294),r=o.__importStar(i(623627)),l=i(16549),c=o.__importStar(i(873324)),d=i(26703),u=i(815146),h=o.__importStar(i(85385)),p=i(154235),g=i(262725),C=o.__importDefault(i(740794)),m=o.__importDefault(i(341126)),S=o.__importDefault(i(20758)),_=o.__importStar(i(920710)),f=o.__importDefault(i(760989)),y=i(186907);var T;!function(e){e[e.Text=0]="Text",e[e.Emoji=1]="Emoji",e[e.Sticker=2]="Sticker",e[e.Animation=3]="Animation",e[e.Snapshot=4]="Snapshot",e[e.Quote=5]="Quote",e[e.Link=6]="Link"}(T||(t.CallReactionType=T={}));const b=(0,d.lazyProperties)({textReaction:()=>n.Styles.createTextStyle({color:l.Color.white,textAlign:"center",lineHeight:S.default.controlFontSize.h3}),textWithScreenSharing:()=>n.Styles.createTextStyle({lineHeight:20,fontSize:S.default.fontSize.size14,font:S.default.font.uiDisplayBold,alignItems:"center",width:"100%",maxHeight:"100%"}),containerScreenSharing:()=>n.Styles.createViewStyle({marginTop:16,marginBottom:"auto",alignItems:"center",width:"100%",justifyContent:"center",height:60})}),v={renderMedia:!1,allowTextFallbackEmoticons:!0,allowLargeEmoticons:!0,allowHugeEmoticons:!0,allowClickableLinks:!1},I=Object.assign({textOverrideStyle:[S.default.fontStyle.h4,b.textReaction]},v),w=[b.textReaction,b.textWithScreenSharing,{textOverflow:"ellipsis",WebkitLineClamp:3,WebkitBoxOrient:"vertical",display:"-webkit-box"}],P=Object.assign({textOverrideStyle:w,emoticonsOnlyEmoticonSize:y.EmoticonSize.Medium},v);t.default=(0,s.memo)((({reactionType:e,callId:t,content:i,reaction:o,isCompact:l,hasIncomingScreenShare:d})=>{const S=(0,s.useCallback)((e=>{e.stopPropagation();const i=f.default.newCauseId();h.log(u.LogTraceArea.CallReactions,"CallReactionItemContent.onPressTextReaction, causeId: "+i),h.track(new c.CanvasAndRibbonActionsEvent(c.CanvasAndRibbonActions.OpenChat,t)),o.conversationId&&o.createdTime&&C.default.navigateToConversation({convId:o.conversationId,scrollToTimestamp:o.createdTime,forceRefreshFocus:!0,origin:u.NavigationConversationOrigin.Call,causeId:i})}),[o.conversationId,o.createdTime,t]);if(e===T.Emoji){const e=_.separateReactionNameAndTone(i);let t=r.Size.ExtraExtraLarge;l&&(t=r.Size.Large),d&&(t=r.Size.Medium);const o=(0,a.jsx)(r.AnimatedEmoticon,{size:t,innerText:i,emoticonName:e.reactionNameWithoutTone,standaloneAnimation:!0,tone:e.reactionTone});return d?(0,a.jsx)(n.View,{style:b.containerScreenSharing,children:o}):o}if(!(e!==T.Text&&e!==T.Quote&&e!==T.Link||l)){let t;switch(e){case T.Text:t=(0,a.jsx)(m.default,{message:o,options:d?P:I});break;case T.Quote:case T.Link:t=(0,a.jsx)(g.Header,{size:p.HeaderSize.h4,style:d?w:b.textReaction,children:i})}return(0,a.jsx)(n.Button,{onPress:S,style:d?b.containerScreenSharing:void 0,children:t})}if(e===T.Snapshot&&!l){const e=(0,a.jsx)(g.Header,{size:p.HeaderSize.h4,style:d?w:b.textReaction,children:i});return d?(0,a.jsx)(n.View,{style:b.containerScreenSharing,children:e}):e}return null}))},683973:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(667294),r=o.__importDefault(i(891903)),l=o.__importDefault(i(975881)),c=i(975881),d=o.__importDefault(i(395527)),u=i(26703),h=o.__importDefault(i(363091)),p=o.__importDefault(i(670363)),g=o.__importDefault(i(827361)),C=o.__importDefault(i(601274)),m=i(526849),S=o.__importDefault(i(369347)),_=350,f=n.Animated.Easing.CubicBezier(1,0,.78,1),y=n.Animated.Easing.CubicBezier(.33,0,0,1),T=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,paddingHorizontal:16,alignItems:"center",justifyContent:"center"}),containerCompact:()=>n.Styles.createViewStyle({paddingHorizontal:0,paddingVertical:0}),containerWithScreenSharing:()=>n.Styles.createViewStyle({paddingHorizontal:12})});t.default=(0,m.WithResub)((({reactionType:e,cuid:t,callId:i,content:o,reaction:u,isCompact:m,gradientColors:S,borderRadius:b,showBackgroundGradient:v,hasIncomingScreenShare:I})=>{const w=(0,s.useRef)(new n.Animated.Value(.25)),P=(0,s.useRef)(new n.Animated.Value(0)),M=(0,s.useRef)(n.Styles.createAnimatedViewStyle({opacity:P.current})),D=(0,s.useMemo)((()=>e!==c.CallReactionType.Text&&(m&&h.default.isMyMri(u.creator)||!m)?1.5:1.2),[m,u.creator,e]),A=(0,s.useRef)(0),k=[T.container,g.default.overflowVisible,M.current,m?T.containerCompact:void 0];I&&k.push(T.containerWithScreenSharing);const R=(0,s.useRef)(),x=(0,s.useCallback)((()=>{const t=p.default.timing(w.current,{toValue:D,duration:_,easing:f,useNativeDriver:!0}),i=e===c.CallReactionType.Text?d.default.getTextTimeoutBasedOnContent(o):2e3;1!==P._value?R.current=n.Animated.parallel([p.default.timing(P.current,{toValue:1,duration:_,easing:f,useNativeDriver:!0}),t]):R.current=t,R.current.start((e=>{R.current=p.default.timing(w.current,{toValue:1,duration:_,easing:y,useNativeDriver:!0}),R.current.start((e=>{A.current=C.default.setTimeout((()=>{R.current=n.Animated.parallel([p.default.timing(P.current,{toValue:0,duration:_,easing:f,useNativeDriver:!0}),p.default.timing(w.current,{toValue:.25,duration:_,easing:f,useNativeDriver:!0})]),R.current.start((()=>{R.current=void 0}))}),i)}))}))}),[o,e,D]),L=(0,s.useCallback)((()=>{var e;null===(e=R.current)||void 0===e||e.stop(),C.default.clearTimeout(A.current),A.current=-1}),[]),B=(0,s.useRef)(t);return(0,s.useEffect)((()=>{B.current!==t&&(B.current=t,L(),x())}),[x,L,t]),(0,s.useEffect)((()=>(x(),()=>{L()})),[x,L]),(0,a.jsxs)(n.Animated.View,{style:k,ignorePointerEvents:!0,children:[(0,a.jsx)(r.default,{gradientColors:S,borderRadius:b,showBackgroundGradient:v}),(0,a.jsx)(l.default,{reactionType:e,callId:i,content:o,reaction:u,isCompact:m,hasIncomingScreenShare:I})]})}),(e=>{const t=S.default.CallScreenShareStore.hasIncomingScreensharing(e.callId);return Object.assign(Object.assign({},e),{hasIncomingScreenShare:t})}))},222120:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionsActionSheet=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(513800),s=i(815146),r=o.__importStar(i(85385)),l=o.__importDefault(i(597285)),c=o.__importStar(i(888500)),d=o.__importDefault(i(760989));t.CallReactionsActionSheet=class{constructor(e){this._onActionButtonPress=(e,t)=>{if(t===c.SXActionMenuCancel)r.log(s.LogTraceArea.CallingUI,"Dismissing call reaction action sheet");else this._reactionPressed(t)},this._reactionSheetOptions=e,this._reactions=a.map(e.reactions,(e=>({key:e.key,info:e})))}showReactionActionSheet(e,t){a.isEmpty(this._reactions)?r.warn(s.LogTraceArea.CallingUI,"ReactionPack is empty, not showing action sheet"):(r.log(s.LogTraceArea.CallingUI,"showing reactions menu"),this._showReactionActionMenu(e,t))}_showReactionActionMenu(e,t){const i=a.map(this._reactions,(e=>({text:l.default.localizedAccessibilityTextForEmoticon(e.key)||e.key,command:e.key})));c.default.showWithActionMenuConfig({options:{anchor:e,buttons:i},callback:t=>this._onActionButtonPress(e,t),rootViewId:t,invokingEvent:void 0})}_reactionPressed(e){const t=d.default.newCauseId();r.log(s.LogTraceArea.CallingUI,"_onReactionPressed causeId: "+t);const i=a.find(this._reactions,(t=>t.key===e));if(i){const e={reactionInfo:i.info,causeId:t,timestamp:Date.now(),postSource:s.PostSource.CallReactionPressed,callId:this._reactionSheetOptions.callId,conversationMri:this._reactionSheetOptions.conversationMri,reactionsConversationMri:this._reactionSheetOptions.reactionsConversationMri,logTraceArea:s.LogTraceArea.CallingUI};n.CallReactionPostingHelpers.postReaction(e)}}}},445958:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(331654)),r=o.__importStar(i(516778)),l=o.__importDefault(i(150343)),c=i(222120),d=o.__importDefault(i(638260)),u=i(460515),h=o.__importDefault(i(132680)),p=o.__importDefault(i(473304)),g=i(315742),C=i(154235),m=o.__importDefault(i(475935)),S=o.__importDefault(i(958868)),_=i(815146),f=o.__importStar(i(85385)),y=i(26703),T=o.__importDefault(i(670363)),b=o.__importDefault(i(960282)),v=o.__importDefault(i(117475)),I=o.__importDefault(i(421334)),w=o.__importDefault(i(872799)),P=i(16549),M=o.__importDefault(i(760989)),D=(0,y.lazyProperties)({barContainer:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,paddingLeft:8,flexDirection:"row",overflow:"visible",backgroundColor:P.Color.transparent}),tabletReactionsContainer:()=>r.Styles.createViewStyle({justifyContent:"flex-end",height:340})});class A extends S.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:g.CoachMarkAreaType.CallReactionsBar},this._menuAnimatedTansformValue=new r.Animated.Value(0),this.closeReactionsDrawer=()=>{this._reactionsDrawer&&this._reactionsDrawer.closeDrawer()},this.setOverflowCoachMarksEnabled=e=>{this.setState({overflowCoachMarksEnabled:e})},this._onOpenCloseAnimationCompleteForStackNav=e=>{T.default.timing(this._menuAnimatedTansformValue,{toValue:e?this.props.minDrawerHeight+(this.props.audioNotificationOffset||0):0,duration:150,easing:r.Animated.Easing.Out(),useNativeDriver:!0}).start(),f.log(_.LogTraceArea.CallReactions,"ReactionsBar._onToggleOpen open: "+e),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onOpenCloseAnimationCompleteForComposite=e=>{this.state.compositeReactionsDrawerOpen!==e&&this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:e}),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onLayoutChanged=e=>{var t,i;null===(i=(t=this.props).onDesiredHeightChanged)||void 0===i||i.call(t,Math.max(this.props.minDrawerHeight,e.height))},this._onReactionsDrawerRef=e=>{this._reactionsDrawer=e||void 0}}_buildState(e,t){var i,o;const a=l.default.getS4LCMCFeatures(),n=this._getRootViewId(),r=p.default.getCelebrationData(e.conversationMri,e.callId),c={horizontalInsets:e.isUsingStackNavigationContext?v.default.horizontalInsets(C.HorizontalInsetDefault):{left:15,right:15},emoticonReactionKey:h.default.getEmoticonReactionKey(r),isMobileScreenReaderEnabled:I.default.isMobileScreenReaderEnabled(),celebrationData:r,showCustomizeReactionsButton:(null===(i=a.customCallReactions)||void 0===i?void 0:i.enabled)&&(null===(o=a.customCallReactions)||void 0===o?void 0:o.useNewAddEmojiIcon)};return t&&(c.rootViewId=n,c.isLandscape=b.default.getDeviceOrientation(n)===s.DeviceOrientation.Landscape,c.compositeReactionsDrawerOpen=!1,c.overflowCoachMarksEnabled=!1),c}componentDidMount(){super.componentDidMount();const e=M.default.newCauseId();f.log(_.LogTraceArea.CallReactions,"CallReactionsBar.componentDidMount causeId: "+e),this._startOrStopOrientationListener(!0,e),this.props.controlsType===u.CallControlsType.Mobile&&T.default.markAnimatedValue(this._menuAnimatedTansformValue,0)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._reactionsDrawer&&this.state.compositeReactionsDrawerOpen!==t.compositeReactionsDrawerOpen&&(this.state.compositeReactionsDrawerOpen?this._reactionsDrawer.openDrawer():this._reactionsDrawer.closeDrawer())}componentWillUnmount(){super.componentWillUnmount();const e=M.default.newCauseId();f.log(_.LogTraceArea.CallReactions,"CallReactionsBar.componentWillUnmount causeId: "+e),this._startOrStopOrientationListener(!1,e)}close(){return!(!this._reactionsDrawer||this.props.controlsType===u.CallControlsType.Mobile)&&this._reactionsDrawer.closeDrawer()}openReactionsDrawer(e){f.log(_.LogTraceArea.CallReactions,"CallReactionsBar.openReactionsDrawer causeId: "+e);const t=()=>{};if(this.state.isMobileScreenReaderEnabled){new c.CallReactionsActionSheet({reactionsConversationMri:this.props.reactionsConversationId,conversationMri:this.props.conversationMri,callId:this.props.callId,reactions:h.default.getReactionItems(this.state.celebrationData)}).showReactionActionSheet(t,this._getRootViewId())}else this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!1})}toggleReactionsPickerHovered(){this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!0})}isDrawerOpen(){return!!this._reactionsDrawer&&this._reactionsDrawer.isOpen()}_startOrStopOrientationListener(e,t){e?this._deviceOrientationKey||(this._deviceOrientationKey=n.uniqueId("ReactionsBar"),s.default.addOrientationEventListener(this._deviceOrientationKey,(e=>{const i=e===s.DeviceOrientation.Landscape;this.isComponentMounted()&&this.state.isLandscape!==i&&(this.setState({isLandscape:i}),d.default.updateCallTelemetry(this.props.callId,t,(e=>e.orientationChanged(i))))}))):this._deviceOrientationKey&&(s.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0)}_renderReactionsDrawer(){if(!this.state.compositeReactionsDrawerOpen&&!this.props.isUsingStackNavigationContext)return null;let e;const t=this.props.controlsType===u.CallControlsType.Mobile;e=this.props.isUsingStackNavigationContext?(0,a.jsx)(w.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,bottomSafeAreaInset:this.props.bottomSafeAreaInset,horizontalInsets:this.state.horizontalInsets,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForStackNav,celebrationData:this.state.celebrationData,audioNotificationOffset:this.props.audioNotificationOffset}):(0,a.jsx)(m.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForComposite,drawerOpenedOnHover:this.state.openReactionsOnHover,celebrationData:this.state.celebrationData,showCustomizeReactionsButton:this.state.showCustomizeReactionsButton,rootViewId:this.state.rootViewId});const i=!this.props.isUsingStackNavigationContext&&t?[D.tabletReactionsContainer]:this._barContainerStyles();return(0,a.jsx)(r.View,{style:i,ignorePointerEvents:!0,children:e})}_barContainerStyles(){return[D.barContainer,r.Styles.createViewStyle({height:this.props.minDrawerHeight+this.props.bottomSafeAreaInset,paddingBottom:this.props.bottomSafeAreaInset},!1)]}render(){return(0,a.jsx)(r.View,{style:this.props.style,onLayout:this._onLayoutChanged,ignorePointerEvents:!0,children:(0,a.jsx)(g.CoachMarkContext.Provider,{value:this._coachMarkContext,children:this._renderReactionsDrawer()})})}}t.default=A},566700:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stickerMargin=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importStar(i(623627)),l=o.__importDefault(i(150343)),c=i(460515),d=o.__importDefault(i(958868)),u=o.__importDefault(i(313333)),h=i(26703),p=o.__importStar(i(920710)),g=o.__importDefault(i(597285)),C=(o.__importDefault(i(960282)),i(16549)),m=o.__importDefault(i(20758)),S=o.__importDefault(i(827361));t.stickerMargin=4;const _=(0,h.lazyProperties)({sticker:()=>s.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible",marginHorizontal:t.stickerMargin}),stickerInnerView:()=>s.Styles.createViewStyle({flex:1,overflow:"visible"}),imageSticker:()=>s.Styles.createViewStyle({position:"absolute",top:3,left:3,height:38,width:38}),modernImageSticker:()=>s.Styles.createViewStyle({height:28,width:28}),menuItemPosition:()=>s.Styles.createViewStyle({height:40,padding:3}),scaledEmoticon:()=>s.Styles.createViewStyle({transform:[{scale:.8}]}),caption:()=>s.Styles.createTextStyle({textAlign:"center",fontSize:m.default.controlFontSize.actionButtonLabel,color:C.Color.white,height:15,paddingHorizontal:4,width:70}),captionLightTheme:()=>s.Styles.createTextStyle({color:C.Color.gray400}),hidden:()=>s.Styles.createTextStyle({opacity:0})});class f extends d.default{constructor(){super(...arguments),this._hovered=!1,this._onReactionButtonRef=e=>{this._reactionButton=e||void 0},this._onPress=e=>{this.props.onPress(this.props.info,e.timeStamp)},this._onHoverStart=e=>{this._onHover(!0)},this._onHoverEnd=e=>{this._onHover(!1)}}_buildState(e,t){return{isSmallDevice:!1}}componentWillUnmount(){super.componentWillUnmount(),this._hovered&&u.default.clearToolTip()}_stickerView(){const e=g.default.localizedAccessibilityTextForImageSticker(this.props.info.key),t=[_.imageSticker];return this.props.useDesktopCallControls&&t.push(_.modernImageSticker),(0,a.jsx)(s.Image,{style:t,source:g.default.imageForSticker(this.props.info.key),title:e,accessibilityLabel:e})}_emoticonView(){const e=p.separateReactionNameAndTone(this.props.info.key);let t=g.default.localizedAccessibilityTextForEmoticon(e.reactionNameWithoutTone);this.props.celebrationData&&this.props.info.key===l.default.getS4LCMCFeaturesNoSubscription().callCelebrationConfig.callCelebrateButtonKey&&(t=this.props.celebrationData.celebrationText);const i=this.state.isSmallDevice||this.props.useDesktopCallControls?r.Size.Medium:r.Size.Large,o=[_.scaledEmoticon];return this.props.hideIcon&&o.push(_.hidden),this.props.isCallMenuItem&&o.push(_.menuItemPosition),(0,a.jsx)(s.View,{style:o,accessibilityLabel:t,title:t,children:(0,a.jsx)(r.AnimatedEmoticon,{size:i,innerText:t,emoticonName:e.reactionNameWithoutTone,standaloneAnimation:!0,isStatic:!this.props.isAnimated,preventSelectable:!0,tone:e.reactionTone})})}_getStickerDimesionStyles(){let e,t;return this.state.isSmallDevice||this.props.useDesktopCallControls?(e=34,t=34):(e=44,t=44),this.props.caption&&(t+=15),s.Styles.createViewStyle({width:e,height:t},!1)}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}_onHover(e){this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.title&&this.props.showToolTip&&this._hovered)||s.UserInterface.isNavigatingWithKeyboard());t()?n.delay((()=>{t()&&u.default.showToolTip((()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),t,this.props.title||"")}),150):u.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}render(){const e=!!this.props.onPanHorizontal,t=[_.sticker,S.default.noncollapsibleView],i=e?[_.stickerInnerView]:[t,this._getStickerDimesionStyles()];let o,n;if(this.props.info.type===c.ReactionsItemType.Sticker?o=this._stickerView():this.props.info.type!==c.ReactionsItemType.Emoticon&&this.props.info.type!==c.ReactionsItemType.Animation||(o=this._emoticonView()),this.props.caption){const e=[_.caption];this.props.useLightTheme&&e.push(_.captionLightTheme),n=(0,a.jsx)(s.Text,{style:e,ellipsizeMode:"tail",numberOfLines:1,children:this.props.caption})}let r=(0,a.jsxs)(s.Button,{ref:this._onReactionButtonRef,style:i,activeOpacity:.5,tabIndex:this.props.tabIndex,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,children:[o,n]});return e&&(r=(0,a.jsx)(s.GestureView,{style:[t,this._getStickerDimesionStyles()],onPanHorizontal:this.props.onPanHorizontal,releaseOnRequest:!1,importantForAccessibility:this.props.importantForAccessibility,children:r})),r}}f.stickerSize=44,f.stickerMargin=t.stickerMargin,t.default=f},46291:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(614080),r=i(148540),l=o.__importStar(i(516778)),c=o.__importDefault(i(369347)),d=o.__importDefault(i(275353)),u=o.__importDefault(i(99741)),h=i(154235),p=o.__importDefault(i(186325)),g=i(815146),C=i(653305),m=o.__importDefault(i(479629)),S=o.__importStar(i(85385)),_=i(26703),f=o.__importStar(i(704704)),y=o.__importStar(i(223815)),T=o.__importDefault(i(117475)),b=i(884853),v=i(16549),I=o.__importDefault(i(827361)),w=o.__importDefault(i(19973)),P=i(262725),M=o.__importDefault(i(497910)),D=o.__importDefault(i(760989)),A=i(677982),k="groupShareButton",R="activeParticipantHeader",x="inactiveParticipantHeader",L=(0,_.lazyProperties)({itemDivider:()=>l.Styles.createViewStyle({height:1}),itemContainer:()=>l.Styles.createViewStyle({paddingHorizontal:20}),participantDividerPadding:()=>l.Styles.createViewStyle({marginLeft:50}),sectionTitle:()=>l.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),sectionTitleWithButton:()=>l.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),ringAllButton:()=>l.Styles.createTextStyle({color:v.Color.blue})});class B extends M.default{constructor(){super(...arguments),this._isParticipantOnHold=e=>{var t;const i=n.filter(this.state.activeParticipants,(t=>t.key===e));if(i.length>0)return(null===(t=n.first(i))||void 0===t?void 0:t.participantState)===r.ParticipantState.OnHold},this._handleRingAgain=e=>{c.default.CallParticipantUtils.addUsersToCallOrRing([e],this.props.callId,this.props.conversationMri,[e],g.NavigationAddToCallOrigin.RosterView);const t=D.default.newCauseId();S.log(g.LogTraceArea.CallingUI,`[CallRosterContent] _addParticipantsToCall, causeId: ${t}`),w.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRangUser())),n.every(this.state.inactiveParticipants,(t=>!0===t.isRinging||t.key===e))&&this.props.onCloseRoster&&this.props.onCloseRoster()},this._onRingTheGroupButtonPress=()=>{y.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=f.getString("CallPanel.GroupCallRingingStatusMessage");l.Accessibility.announceForAccessibility(e);const t=D.default.newCauseId();S.log(g.LogTraceArea.CallingUI,`[CallRosterContent] _onRingTheGroupButtonPress, causeId: ${t}`),w.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRingTheGroup())),this.props.onCloseRoster&&this.props.onCloseRoster()},this._renderItem=e=>{if(e.key===R){const t=f.getString("CallPanel.CallRosterPresentTitle");return(0,a.jsx)(l.View,{style:[L.sectionTitle,L.itemContainer],children:(0,a.jsx)(b.SectionTitle,{title:t,titleStyles:I.default.flexOne},e.key)},e.key)}const t=this._renderRingTheGroupButton();if(e.key===x){const i=f.getString("CallPanel.CallRosterAbsentTitle"),o=t?L.sectionTitleWithButton:L.sectionTitle;return(0,a.jsxs)(l.View,{style:[o,L.itemContainer],children:[(0,a.jsx)(b.SectionTitle,{title:i,titleStyles:I.default.flexOne},e.key),t]},e.key)}let i;const o=[L.itemDivider,this._themeStyles.dividerColorStyle];if(e.key===k)i=(0,a.jsx)(m.default,{conversationId:this.props.conversationMri,callId:this.props.callId,origin:C.ShareGroupButtonOrigin.CallRosterPanel,hideDivider:!0,renderAsListItem:!0},e.key);else{const t=this.state.allParticipants[e.key];i=(0,a.jsx)(d.default,{userMri:e.key,callId:this.props.callId,isPresent:t.isActive,isTalking:t.isTalking,isLocal:t.isLocal,isLocalMuteSupported:t.isLocalMuteSupported,isRinging:t.isRinging,isServerMuted:t.isServerMuted,isServerMutedSupported:t.isServerMutedSupported,isLocalMuted:t.isLocalMuted,isOnHold:this._isParticipantOnHold(e.key),onRingAgainClicked:this._handleRingAgain},e.key),o.push(L.participantDividerPadding)}return(0,a.jsxs)(l.View,{style:L.itemContainer,children:[i,(0,a.jsx)(p.default,{style:o},"itemDivider")]})}}_buildState(e,t){const i=c.default.CallingStore.isCallConnected(e.callId),o=u.default.getAllMembersWithActiveAndInactiveParticipants(e.conversationMri,e.callId,t?{}:this.state.allParticipants),a=o.activeParticipants,n=o.inactiveParticipants,s=o.allParticipants,{enableUpdatingParticipantStatusInCallRoster:r}=A.AppConfigStore.getS4LCMCFeatures();return{allParticipants:s,activeParticipants:a,inactiveParticipants:n,isCallConnected:i,safeAreaHorizontalInsets:T.default.horizontalInsets(h.HorizontalInsetDefault),ringlessCallType:y.default.getRinglessCallType(e.conversationMri,e.callId),enableUpdatingParticipantStatusInCallRoster:r}}_retrieveTemplateFromParticipantInfo(e){let t="crv_participant";return this.state.enableUpdatingParticipantStatusInCallRoster?(Object.keys(e).forEach((i=>{const o=e[i];"participantState"===i&&o?t+=`_participantState(${o})`:"boolean"==typeof o&&o&&(t+=`_${i}`)})),t):t}render(){const e=[];e.push({key:k,height:70,template:"dcrp_action",accessibilityTrait:l.Types.AccessibilityTrait.Button});const t=[];this.state.activeParticipants.length&&(t.push({key:R,height:48,template:"crv_header"}),n.each(this.state.activeParticipants,(e=>{t.push({key:e.key,height:55,template:this._retrieveTemplateFromParticipantInfo(e)})})));const i=[];return this.state.inactiveParticipants.length&&(i.push({key:x,height:48,template:"crv_header"}),n.each(this.state.inactiveParticipants,(e=>{i.push({key:e.key,height:55,template:this._retrieveTemplateFromParticipantInfo(e)})}))),(0,a.jsx)(l.View,{style:I.default.flexOne,children:(0,a.jsx)(s.VirtualListView,{itemList:n.union(e,t,i),renderItem:this._renderItem,animateChanges:!0,keyboardShouldPersistTaps:!0,horizontalPadding:this.state.safeAreaHorizontalInsets})})}_renderRingTheGroupButton(){if(!y.default.isLocallyStartedRinglessCall(this.props.conversationMri,this.props.callId)||!this.state.isCallConnected||c.default.CallingStore.hasRingingParticipants(this.props.callId,!0)||this.state.ringlessCallType!==y.LocallyStartedRinglessCallType.SmallGroup)return;const e=f.getString("CallPanel.GroupCallRingAllButtonTitle");return(0,a.jsx)(l.Button,{accessibilityLabel:e,onPress:this._onRingTheGroupButtonPress,children:(0,a.jsx)(P.Caption,{style:L.ringAllButton,selected:!0,children:e})})}}t.default=B},275353:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(99741)),l=o.__importDefault(i(132680)),c=o.__importStar(i(44717)),d=o.__importDefault(i(615364)),u=i(815146),h=o.__importDefault(i(560099)),p=o.__importDefault(i(970035)),g=o.__importStar(i(85385)),C=i(26703),m=o.__importStar(i(704704)),S=o.__importDefault(i(998929)),_=i(675862),f=i(231817),y=o.__importStar(i(634859)),T=i(602370),b=i(16549),v=i(641400),I=o.__importDefault(i(827361)),w=o.__importDefault(i(19973)),P=i(262725),M=o.__importDefault(i(497910)),D=i(403396),A=i(596648),k=o.__importDefault(i(685734)),R=o.__importStar(i(500645)),x=o.__importDefault(i(760989)),L=i(721748),B=i(460515),V=o.__importStar(i(26178)),O=i(493680),E=A.UserIconSize.Size40,N=(0,C.lazyProperties)({listItem:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),userIconContainer:()=>n.Styles.createViewStyle({width:50,height:50,alignItems:"flex-start",justifyContent:"center",overflow:"visible"}),ringingView:()=>n.Styles.createViewStyle({position:"absolute",width:E,height:E,borderRadius:E/2,alignItems:"center",justifyContent:"center",backgroundColor:b.Color.blackOverlay50}),optionalIconButton:()=>n.Styles.createViewStyle({marginHorizontal:6}),optionalButton:()=>n.Styles.createViewStyle({alignItems:"center",backgroundColor:b.Color.transparent,paddingLeft:25}),raiseHandBorderStyle:()=>n.Styles.createViewStyle({borderColor:b.Color.raiseHandOrange,borderWidth:2})});class F extends M.default{constructor(){super(...arguments),this._handleLocalHangup=e=>{const t=x.default.newCauseId();g.log(u.LogTraceArea.CallingUI,`[CallRosterListItem] _handleLocalHangup, causeId: ${t}`),s.default.CallingStore.endCall(this.props.callId,t),w.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRemovedUser()))},this._handleRemoteHangup=e=>{const t=x.default.newCauseId();g.log(u.LogTraceArea.CallingUI,`[CallRosterListItem] _handleRemoteHangup, causeId: ${t}`),r.default.handleRemoteHangup(e,this.props.callId,t),w.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRemovedUser()))},this._onMuteOrUnMuteButtonPress=e=>{e.stopPropagation();const t=x.default.newCauseId();this.props.isLocal?(g.log(u.LogTraceArea.CallingUI,`[CallRosterListItem:_onMuteOrUnMuteButtonPress] handleLocalMuteOrUnmute, causeId: ${t}`),l.default.announceMicrophoneState(r.default.handleLocalMuteOrUnmute(this.props.callId,t))):(g.log(u.LogTraceArea.CallingUI,`[CallRosterListItem:_onMuteOrUnMuteButtonPress] _handleRemoteMute, causeId: ${t}`),r.default.handleRemoteMute(this.props.userMri,this.props.callId,t))},this._onRingAgainOrHangUpButtonPress=e=>{e.stopPropagation(),this.props.isPresent?this.props.isLocal?this._handleLocalHangup(this.props.userMri):this._handleRemoteHangup(this.props.userMri):this.props.onRingAgainClicked(this.props.userMri)},this._onPinUnpinPressed=()=>{this._pinUnpinCommand.execute()},this._onLowerHandPressed=()=>{this._lowerHandParticipantCommand.execute(),l.default.announceLoweredHandState(!!this.props.isLocal,this.state.displayName)},this._onHoverStart=e=>{this.setState({isHovering:!0})},this._onHoverEnd=e=>{this.setState({isHovering:!1})}}_buildState(e,t){const i=k.default.getDisplayableUserByMri(e.userMri),o=s.default.CallingStore.getCallConversationMri(e.callId),a=o&&(0,d.default)().getConversation(o),n=i?i.getDisplayName():m.getString("DisplayInfoStore.ListMyName"),r=e.isLocal?B.CallStageElementKeys.localUserKey:e.userMri;return t&&(this._lowerHandParticipantCommand=new f.LowerHandParticipantCommand(e.callId,e.userMri,T.LowerHandOrigin.ParticipantsPanel,!!e.isLocal,n),this._pinUnpinCommand=new L.PinUnpinCommand(r,e.callId)),{userProfile:c.isAgent(e.userMri)?void 0:i,displayName:n,hideMuteIcon:(0,_.isRegularMemberInModeratedGroup)(a)&&!e.isLocal,hideCallIcon:(0,_.isRegularMemberInModeratedGroup)(a),canHandBeLowered:this._lowerHandParticipantCommand.canExecute(),isHandRaised:this._lowerHandParticipantCommand.isHandRaised(),isPinned:l.default.isCallParticipantPinned(r,e.callId),isPinningFeatureAllowed:e.isPresent&&(l.default.shouldShowCallParticipantPinOption(r,e.callId)||l.default.shouldShowCallParticipantUnpinOption(r,e.callId))}}_renderRingAgainOrHangUpIcon(){let e;if(!this.props.isRinging&&!this.state.hideCallIcon){let t,i,o=this._onRingAgainOrHangUpButtonPress,a=!1;this.props.isPresent?(t=v.SkypeIcon.PersonDelete,i=m.getString("CallControls.RemoveFromCall")):(t=v.SkypeIcon.CallStart,i=m.getString("SkypeUserListItem.RingButtonLabel"),this.props.userMri===(0,O.getMagicBotId)()&&(i=m.getString("CallControls.MagicBotNotCallable"),o=()=>{},a=!0)),e=this._renderIconButton(o,t,i,a)}return e}_renderOptionalRemoteMuteOrUnMuteIcon(){if(!this.state.hideMuteIcon&&!this.props.isRinging&&this.props.isPresent){const e=r.default.getIconTitleForMuteOrUnMute(this.props.isLocalMuteSupported,this.props.isLocal,this.props.isLocalMuted,this.props.isServerMutedSupported,this.props.isServerMuted);return this._renderIconButton(this._onMuteOrUnMuteButtonPress,e.icon,e.title,e.disableIcon)}}_renderOptionalLowerHandIcon(){if(!this.state.canHandBeLowered)return;const e=m.getString("CallControls.LowerHand");return this._renderIconButton(this._onLowerHandPressed,v.SkypeIcon.RaiseHandCrossed,e)}_renderOnHoldIcon(){return this.props.isOnHold?this._renderIconButton((()=>{}),v.SkypeIcon.Pause,m.getString("CallPanel.OnHoldHeader"),!0):void 0}_renderOptionalPinUnpinButton(){if(!this.state.isPinningFeatureAllowed)return;if(!this.state.isPinned&&!this.state.isHovering)return;const e=this.state.isPinned?m.getString("CallControls.UnpinParticipant"):m.getString("CallControls.PinParticipant"),t=this.state.isPinned?v.SkypeIcon.PinOff:v.SkypeIcon.Pin;return this._renderIconButton(this._onPinUnpinPressed,t,e)}_renderIconButton(e,t,i,o=!1){const n=o?this._themeColors.iconDisabledColor:this._themeColors.primaryIconColor;return(0,a.jsx)(V.default,{size:V.CallButtonSize.Small,icon:t,title:i,onPress:o?()=>{}:e,accessibilityLabel:this.state.displayName+","+i,colorConfig:{iconColor:n,backgroundColor:b.Color.transparent,selectedIconColor:n,selectedBackgroundColor:b.Color.transparent},style:N.optionalIconButton,showToolTip:!0,toolTipConfig:{showArrow:!0,style:{backgroundColor:b.Color.gray400,paddingHorizontal:12,paddingVertical:7},arrowColor:b.Color.gray400},doNotAddHorizontalMargin:!0})}render(){const e=this.props.isRinging?(0,a.jsx)(n.View,{style:N.ringingView,children:(0,a.jsx)(p.default,{icon:v.SkypeIcon.CallAnimSmall4,color:b.Color.white,size:v.IconSize.size20})}):void 0,t=this.state.isHandRaised?(0,a.jsx)(y.default,{type:y.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0;return(0,a.jsxs)(S.default.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,style:[N.listItem,I.default.defaultCursor],importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.state.displayName,children:[(0,a.jsxs)(h.default,{style:N.userIconContainer,children:[(0,a.jsx)(D.UserIcon,{userMri:this.props.userMri,size:E,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,statusTypes:R.getAllowedStatuses(this.props.userMri),imageBorderStyleOverride:this.state.isHandRaised?N.raiseHandBorderStyle:void 0},"userIcon"),e,t]}),(0,a.jsx)(n.View,{style:I.default.flexOne,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,children:(0,a.jsx)(P.RowTitle,{numberOfLines:1,textThemeColor:P.TextThemeColor.Primary,children:this.state.displayName})},"text"),this._renderOptionalPinUnpinButton(),this._renderOnHoldIcon(),this._renderOptionalLowerHandIcon(),this._renderOptionalRemoteMuteOrUnMuteIcon(),this._renderRingAgainOrHangUpIcon()]})}}t.default=F},554715:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(516778)),n=o.__importStar(i(496486)),s=i(789352),r=o.__importDefault(i(638260)),l=o.__importStar(i(85385)),c=i(815146),d=o.__importDefault(i(54945)),u=o.__importDefault(i(139221));t.default=class{constructor(e){this._zoomLevel=s.ZoomLevelBoundaries.DefaultLevel,this._zoomPositionSizes={originalHeight:0,originalWidth:0,centerX:0,centerY:0,mouseX:0,mouseY:0,mouseCenterDistanceX:0,mouseCenterDistanceY:0},this._active=!1,this._callId="",this._isCtrlPressed=!1,this._isDragging=!1,this._dragInitCoords={x:0,y:0},this._dragFinalCoords={x:0,y:0},this._currentTopDragDifference=0,this._currentLeftDragDifference=0,this._currentTopPosition=0,this._currentLeftPosition=0,this._lastZoomTimestamp=0,this._minZoomDelay=s.ZoomDelayValues.MinDelay,this._zoomedStartTimestamp=0,this._hasDraggedOnce=!1,this._isZoomedIn=!1,this._onKeyDown=e=>(!this._isCtrlPressed&&this._isKeyCtrl(e)&&(l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController CtrlPressed ${e.keyCode}`),this._isCtrlPressed=e.keyCode),!1),this._onKeyUp=e=>this._isCtrlPressed===e.keyCode?(l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController CtrlReleased ${e.keyCode}`),this._isCtrlPressed=!1,!1):!(u.default.getPlatformType()!==c.PlatformType.OSX||e.keyCode!==d.default.MINUS&&e.keyCode!==d.default.PLUS||!e.ctrlKey)&&(this.handleKeyboardZoom(e.keyCode),!0),this.stop=()=>{this._active&&(this._active=!1,a.Input.keyDownEvent.unsubscribe(this._onKeyDown),a.Input.keyUpEvent.unsubscribe(this._onKeyUp),l.log(c.LogTraceArea.ScreenSharing,"ScreenShareZoomController stop"),this._resetZoom(!0),this._resetDragValues(!0),this._callId="",this._isZoomedIn=!1)},this.handleKeyboardZoom=e=>{const t=e===d.default.MINUS;l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController handleKeyboardZoom isZoomOut: ${t}`);const i=t?this._zoomLevel-1:this._zoomLevel+1;this._isZoomLevelAllowed(i)&&this._handleZoom(void 0,i,s.ScreenShareZoomType.Keyboard)},this.handleUIControlsZoom=e=>{l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController handleUIControlsZoom zoomLevel: ${e}`),this._handleZoom(void 0,e,s.ScreenShareZoomType.UIControls)},this.handleScrollZoom=e=>{if(this._isKeyCtrl(e)){const t=this._isCtrlPressed?s.ScreenShareZoomType.ScrollWheel:s.ScreenShareZoomType.TrackPad;this._handleZoom(e,void 0,t)}},this.updateScreenShareElementSizes=e=>{l.log(c.LogTraceArea.ScreenSharing,"ScreenShareZoomController updateScreenShareElementSizes resize"),this._setZoomPositionSizes(e)},this.handleDragging=e=>{if(this._zoomLevel){if(!this._isDragging)return void this._startDragging(e);if(e.isComplete)return void this._stopDragging();this._handleDragging(e)}},this._handleZoom=(e,t,i)=>{const o=this._getVideoElement();if(!o||this._isDragging||this._zoomLevel===t)return;l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController _handleZoom zoomLevelValue: ${t}, zoomType:${i}`);let a=t||s.ZoomLevelBoundaries.DefaultLevel;if(e&&void 0!==a){if(!this._isZoomAllowed(e.timeStamp,i===s.ScreenShareZoomType.TrackPad))return;const t=e.scrollAmount>0,o=t?-1:1;a=this._zoomLevel+o,l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController _handleZoom zoomLevel: ${a}, scrolledDown: ${t}`)}if(!this._isZoomLevelAllowed(a))return;const n=this._zoomLevel===s.ZoomLevelBoundaries.DefaultLevel;this._setZoomLevel(a,i);const r=-25*this._zoomLevel+"%";o.handleZoom(r),this._zoomLevel!==s.ZoomLevelBoundaries.DefaultLevel?this._repositionZoom(e,n,!1):this._resetZoom()},this._sendZoomChangeToTelemetry=(e,t,i,o)=>{const a=t>0&&!this._isZoomedIn,n=0===t&&this._isZoomedIn;void 0!==i&&r.default.onZoomChangeType(e,i),a?this._sendZoomInTelemetry(e,o):n&&this._sendZoomOutTelemetry(e,o)},this._sendZoomInTelemetry=(e,t)=>{this._zoomedStartTimestamp=t,this._isZoomedIn=!0,r.default.onZoomIn(e)},this._sendZoomOutTelemetry=(e,t,i)=>{const o=t-this._zoomedStartTimestamp;this._zoomedStartTimestamp=0,this._isZoomedIn=!1,r.default.onZoomOut(e,o,i)},this._sendZoomChangeToTelemetryDebounce=n.debounce(this._sendZoomChangeToTelemetry,1e3),this._resetZoom=e=>{this._zoomLevel!==s.ZoomLevelBoundaries.DefaultLevel&&this._setZoomLevel(s.ZoomLevelBoundaries.DefaultLevel),this._zoomPositionSizes.mouseCenterDistanceX=0,this._zoomPositionSizes.mouseCenterDistanceY=0,this._setPosition({x:0,y:0},void 0,e)},this._getCurrentSizes=()=>{const{originalHeight:e,originalWidth:t}=this._zoomPositionSizes,i=1+this._zoomLevel/2,o=e*i,a=t*i,n=(o-e)/2,s=(a-t)/2;return{currentHeight:o,currentWidth:a,minT:n,minL:-s,maxT:-n,maxL:s}},this._handleDragging=({clientX:e,clientY:t})=>{this._isDragging&&(this._currentTopDragDifference=t-this._dragInitCoords.y,this._currentLeftDragDifference=e-this._dragInitCoords.x,this._dragFinalCoords.y=this._currentTopPosition+this._currentTopDragDifference,this._dragFinalCoords.x=this._currentLeftPosition+this._currentLeftDragDifference,this._setPosition(this._dragFinalCoords,!0))},this._stopDragging=()=>{if(this._isDragging){this._isDragging=!1,l.log(c.LogTraceArea.ScreenSharing,"ScreenShareZoomController _stopDragging"),this._handleToggleZoomPositionAnimation(!0);const e=1+this._zoomLevel/2,t=this._zoomPositionSizes.mouseCenterDistanceX+this._currentLeftDragDifference/e,i=this._zoomPositionSizes.mouseCenterDistanceY+this._currentTopDragDifference/e;this._zoomPositionSizes.mouseCenterDistanceY=i,this._zoomPositionSizes.mouseCenterDistanceX=t,this._zoomPositionSizes.mouseX=this._zoomPositionSizes.centerX-this._zoomPositionSizes.mouseCenterDistanceX,this._zoomPositionSizes.mouseY=this._zoomPositionSizes.centerY-this._zoomPositionSizes.mouseCenterDistanceY,this._setPosition(this._dragFinalCoords),this._resetDragValues()}},this._onMouseCursorChange=e.onMouseCursorChange,this._onZoomLevelChange=e.onZoomLevelChange,this._getVideoElementCallback=e.getVideoElement,this._callId=e.callId,this._active=!0,a.Input.keyDownEvent.subscribe(this._onKeyDown),a.Input.keyUpEvent.subscribe(this._onKeyUp)}_isKeyCtrl(e){return e.ctrlKey||u.default.getPlatformType()===c.PlatformType.OSX&&e.metaKey}_isZoomLevelAllowed(e){return e>=s.ZoomLevelBoundaries.DefaultLevel&&e<=s.ZoomLevelBoundaries.MaxLevel}_isZoomAllowed(e,t){const i=e-this._lastZoomTimestamp;if(i<this._minZoomDelay){const e=t?s.ZoomDelayValues.TrackPadDelay:s.ZoomDelayValues.MaxDelay;return this._minZoomDelay!==e&&(this._minZoomDelay=e),l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController zoom rejected, durationSinceLastZoom: ${i}`),!1}return this._minZoomDelay!==s.ZoomDelayValues.MinDelay&&(this._minZoomDelay=s.ZoomDelayValues.MinDelay),this._lastZoomTimestamp=e,!0}_setZoomLevel(e,t){this._zoomLevel=e,this._onZoomLevelChange&&this._onZoomLevelChange(this._zoomLevel),l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController new zoom level  _zoomLevel: ${this._zoomLevel}, zoomType:${t}`);const i=Date.now();this._active?this._sendZoomChangeToTelemetryDebounce(this._callId,this._zoomLevel,t,i):this._isZoomedIn&&this._sendZoomOutTelemetry(this._callId,i,!0),this._toggleHandCursor()}_getVideoElement(){if(this._getVideoElementCallback){return this._getVideoElementCallback()}return null}_setZoomPositionSizes(e){const t=this._getVideoElement();if(!t)return;l.log(c.LogTraceArea.ScreenSharing,"ScreenShareZoomController _setZoomPositionSizes");const i=e||t.getZoomControllerRect();if(i){const[t,o]=[i.width,i.height];if(!t||!o)return l.log(c.LogTraceArea.ScreenSharing,"ScreenShareZoomController _setZoomPositionSizes width/height bug"),void this._resetZoom();const[a,n]=[t/2,o/2],s=this._zoomPositionSizes.centerX/a,r=this._zoomPositionSizes.centerY/n,d=this._zoomPositionSizes.mouseX/s,u=this._zoomPositionSizes.mouseY/r;this._zoomPositionSizes=Object.assign(Object.assign({},this._zoomPositionSizes),{originalHeight:o,originalWidth:t,centerX:a,centerY:n,mouseX:d,mouseY:u}),e&&(this._handleToggleZoomPositionAnimation(!1),this._isDragging||this._repositionZoom(void 0,!0,!0))}}_repositionZoom(e,t,i){const{centerX:o,centerY:a}=this._zoomPositionSizes;let{mouseX:s,mouseY:r}=this._zoomPositionSizes;t&&(i||([s,r]=e?[e.clientX,e.clientY]:[o,a],this._zoomPositionSizes.mouseX=s,this._zoomPositionSizes.mouseY=r),this._zoomPositionSizes.mouseCenterDistanceX=o-s,this._zoomPositionSizes.mouseCenterDistanceY=a-r);const{mouseCenterDistanceY:l,mouseCenterDistanceX:c}=this._zoomPositionSizes,d=l+this._zoomLevel/2*l,u=c+this._zoomLevel/2*c;this._setPosition({y:d,x:u}),i&&n.delay((()=>this._handleToggleZoomPositionAnimation(!0)),50)}_setPosition(e,t,i){if(i)return this._currentTopPosition=e.y,void(this._currentLeftPosition=e.x);const o=this._getVideoElement();if(o){const{minT:i,maxT:a,minL:n,maxL:s}=this._getCurrentSizes(),r=i<e.y?i:a>e.y?a:e.y,l=n<e.x?e.x>s?s:e.x:n;t||(this._currentTopPosition=r,this._currentLeftPosition=l),o.handleZoomPositionUpdate(l+"px",r+"px")}}_startDragging({clientX:e,clientY:t}){this._isDragging=!0,l.log(c.LogTraceArea.ScreenSharing,"ScreenShareZoomController _startDragging"),this._hasDraggedOnce||(r.default.onZoomDragUsed(this._callId),this._hasDraggedOnce=!0),this._dragInitCoords={x:e,y:t},this._toggleHandCursor(!0),this._handleToggleZoomPositionAnimation(!1)}_resetDragValues(e){this._isDragging=!1,this._hasDraggedOnce=!1,this._dragInitCoords={x:0,y:0},this._dragFinalCoords={x:0,y:0},this._currentTopDragDifference=0,this._currentLeftDragDifference=0,e||this._toggleHandCursor()}_toggleHandCursor(e){if(!this._onMouseCursorChange)return;let t=a.Types.GestureMouseCursor.Default;this._zoomLevel>s.ZoomLevelBoundaries.DefaultLevel&&(t=e?a.Types.GestureMouseCursor.Grabbing:a.Types.GestureMouseCursor.Grab),this._onMouseCursorChange(t),l.log(c.LogTraceArea.ScreenSharing,`ScreenShareZoomController apply cursor: ${t}`)}_handleToggleZoomPositionAnimation(e){const t=this._getVideoElement();t&&t.togglePositionChangeAnimation(e)}}},823355:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageLayoutController=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(150343)),s=i(333284),r=i(460515),l=o.__importDefault(i(132680)),c=o.__importDefault(i(114818)),d=o.__importDefault(i(942724)),u=o.__importDefault(i(48076));class h{constructor(){this._controllers={},this._maxStageElements=4,this._maxElementsInRow=2,this._maxElementsInColumn=2,this._totalStageElements=0,this._videosDimensionsList=[],this._isStageLandscape=!0,this._isGridSquare=!1,this._narrowOrWide=!1}updateLayoutInfoForStage(e,t){const i=(0,c.default)(this._stageRect,t);this._updateStageElements(t.width,t.height,e.length),this._updateStageLayout(e,t,i),this._stageRect=t}controllerForKey(e){let t=this._controllers[e];return t||(t=new s.CallItemLayoutController(e),this._controllers[e]=t),t}getMaxNumberOfStageElements(){return this._maxStageElements}isStageLandscape(){return this._isStageLandscape}isGridSquare(){return this._isGridSquare}shouldSwitchOrientation(){return this.isStageLandscape()&&!this._narrowOrWide&&!this.isGridSquare()||!this.isStageLandscape()&&(this._narrowOrWide||this.isGridSquare())}_updateStageElements(e,t,i){if(0===e||0===t)return;const o=e/t,a=n.default.getS4LCMCFeaturesNoSubscription().modernCallStage,s=d.default.isUsingStackNavigationContextNoSubscription(),r=s?a.mobileMinVideoSize.width:a.minVideoSize.width,c=s?a.mobileMinVideoSize.height:a.minVideoSize.height;if(0===r||0===c)return;let h,p;if(s){const i=u.default.isTablet()?3:2,a=4;h=o>1?Math.min(a,Math.round(e/r)):i,p=o>1?i:Math.min(a,Math.round(t/c))}else h=Math.round(e/r),p=Math.round(t/c);if(this._maxElementsInColumn!==p||this._maxElementsInRow!==h||this._totalStageElements!==i){this._maxElementsInRow=h,this._maxElementsInColumn=p;const e=this._maxElementsInRow*this._maxElementsInColumn;this._maxStageElements=Math.min(a.maxStageElements,e);const t=l.default.getStageVideoCount(i,this._maxElementsInRow,this._maxElementsInColumn,o>1);this._totalStageElements=i,this._isGridSquare=t.width===t.height,this._isStageLandscape=o>1,this._narrowOrWide=!this._isGridSquare&&(o>2||o<1),this._videosDimensionsList=l.default.getSizesForStageElements([],i,t,this._isGridSquare?!this._isStageLandscape:this._isStageLandscape,t,this._narrowOrWide)}}_updateStageLayout(e,t,i=!1){a.each(e,(e=>{const o=e.stagePosition,a=this.controllerForKey(e.key),n=this._videosDimensionsList[o],s=l.default.stageLayoutRect(t,n);a.setStagePosition(this._maxStageElements,s,o,e.videoType!==r.LayoutInfoVideoType.None,t,i,n),a.setHidden(!1)}))}}t.CallStageLayoutController=h,t.default=h},668154:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageViewV2=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(667294)),r=o.__importStar(i(516778)),l=i(701025),c=i(537180),d=o.__importDefault(i(369347)),u=i(619429),h=i(460515),p=i(815146),g=o.__importStar(i(85385)),C=i(26703),m=o.__importDefault(i(405716)),S=i(16549),_=o.__importDefault(i(827361)),f=o.__importDefault(i(497910)),y=o.__importDefault(i(760989)),T=o.__importDefault(i(823355)),b=o.__importDefault(i(802791)),v=i(757293),I=o.__importDefault(i(924849)),w=o.__importDefault(i(152803)),P=o.__importDefault(i(916256)),M=i(276602),D=o.__importDefault(i(947878)),A=o.__importDefault(i(150343)),k=(0,C.lazyProperties)({reactionsView:()=>_.default.absoluteFill,stageContainerStyle:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:S.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center"}),optionalPaddingStyle:()=>r.Styles.createViewStyle({padding:4}),modernStageLandscapeContainerStyle:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})}),R=(0,C.lazyProperties)({contentView:()=>r.Styles.createViewStyle({margin:4,borderRadius:8,overflow:"hidden"})}),x=c.StyleSheet.create({localParticipantViewPosition:{position:"absolute",right:16},localParticipantViewFullScreen:{top:16},localParticipantViewWithControls:{top:64}});class L extends f.default{constructor(){super(...arguments),this._layoutController=new T.default,this._mountedRefsMap=new I.default,this._onStageTapBinder=(e,t)=>this.props.onStageTap&&this.props.onStageTap(t),this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._getCallParticipantAccesoryPosition=()=>this.props.participantsAccessoryPosition?this.props.participantsAccessoryPosition:this.props.isCompactView?h.CallAccessoryPosition.BottomRight:void 0,this._getContentViewStyles=()=>this.props.participantsViewStyle?this.props.participantsViewStyle:this.state.stageElements.length>1?R.contentView:void 0,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e)}_buildState(e,t){return{stageElements:P.default.getStageElements(e.callId),showChangeTogetherModeBackgroundOption:M.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),showMyselfInTheGrid:D.default.getSelfInTheGrid(e.callId),enableShowParticipantNamesOnMobiles:A.default.getS4LCMCFeatures().enableShowParticipantNamesOnMobiles}}componentDidMount(){super.componentDidMount(),g.log(p.LogTraceArea.CallingUI,"CallStageView.componentDidMount"),d.default.SpeakerViewTelemetryService.startTracking(this.props.callId)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const o=y.default.newCauseId();g.log(p.LogTraceArea.CallingUI,"CallStageView.UNSAFE_componentWillUpdate causeId: "+o),this._updateElementLayout(t,e,o)}componentWillUnmount(){super.componentWillUnmount();const e=y.default.newCauseId();g.log(p.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),d.default.SpeakerViewTelemetryService.stopTracking(this.props.callId)}_renderCelebrationAnimationView(){return(0,a.jsx)(b.default,{conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape},"celebrationAnimationView")}_updateElementLayout(e,t,i){if(g.log(p.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+i),0===t.viewRect.width||0===t.viewRect.height)return;const o=n.map(e.stageElements,(t=>{const i=n.indexOf(e.stageElements,t);return{key:t,videoType:h.LayoutInfoVideoType.None,isLocal:h.CallStageElementKeys.localUserKey===t,isHostOfScreenshare:0===t.indexOf(u.ScreenSharingPrefix),stagePosition:i}}));this._layoutController.updateLayoutInfoForStage(o,this._adjustedStageViewRectV2(t.viewRect)),P.default.setStageCapacity(t.callId,this._layoutController.getMaxNumberOfStageElements())}_renderStageParticipant(e){var t;const i=this._renderMobileNameTag(e);return(0,a.jsx)(w.default,{renderKey:e,ref:t=>{this._onParticipantViewRef(t,e)},callId:this.props.callId,conversationMri:this.props.conversationMri,iconOpacity:1,isGroupCall:!this.props.isOneOnOneConversation,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag,useDarkBackground:!0,desktopNameTag:!0,useLightTheme:this.props.useLightTheme,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,layoutController:this._layoutControllerForKey,iconSize:null!==(t=this.props.participantsIconSize)&&void 0!==t?t:120,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,contentViewStyles:this._getContentViewStyles(),hideBackground:this.props.hideParticipantBackground,hideIcon:this.props.hideParticipantIcon,onTap:this._onStageTapBinder,accessoryPosition:i?void 0:this._getCallParticipantAccesoryPosition(),forceVideoToCrop:this.props.forceVideoToCrop,renderMobileNameTag:i},e)}_renderMobileNameTag(e){const t=e===h.CallStageElementKeys.localUserKey;return this.state.enableShowParticipantNamesOnMobiles&&!this.props.isVideoFullScreenMode&&!this.props.isOneOnOneConversation&&!t}_adjustedStageViewRectV2(e){return{x:e.x,y:e.y+(this.props.isCompactView?0:h.DesktopNewHeaderHeight),width:e.width,height:e.height-(this.props.isCompactView?0:h.DesktopCallControlsHeight+h.DesktopNewHeaderHeight)}}_onParticipantViewRef(e,t){this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderStage(){const e=n.map(this.state.stageElements,(e=>this._renderStageParticipant(e))),t=[k.stageContainerStyle];return this._layoutController.shouldSwitchOrientation()&&t.push(k.modernStageLandscapeContainerStyle),e.length>1&&t.push(k.optionalPaddingStyle),(0,a.jsxs)(r.View,{style:[t,this.props.style],ref:this._onViewRef,children:[e,this._maybeRenderLocalVideoView()]},"callStage")}_renderReactionsView(){return(0,a.jsx)(v.NewCallReactionsView,{reactionsConversationId:this.props.reactionsConversationId,callId:this.props.callId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper})}_maybeRenderLocalVideoView(){if(!this.props.isOneOnOneConversation||this.props.stageLayoutMode!==h.StageMode.Grid||this.state.showMyselfInTheGrid||this.props.hideLocalVideo)return;const e=(0,a.jsx)(m.default,{getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useLightTheme:this.props.useLightTheme,isCompactView:this.props.isCompactView},"localVideoView");return this.props.isCompactView?(0,a.jsx)(l.SafeAreaView,{pointerEvents:"box-none",style:c.StyleSheet.flatten([x.localParticipantViewPosition,this.props.isVideoFullScreenMode?x.localParticipantViewFullScreen:x.localParticipantViewWithControls]),children:(0,a.jsx)(c.View,{children:e})},"localVideoViewPosition"):e}render(){return(0,a.jsxs)(s.Fragment,{children:[this._renderStage(),this._renderReactionsView(),this._renderCelebrationAnimationView()]})}}t.CallStageViewV2=L},581670:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importStar(i(44717)),l=o.__importDefault(i(601976)),c=i(477195),d=i(26703),u=o.__importStar(i(704704)),h=o.__importDefault(i(363091)),p=i(16549),g=i(262725),C=i(403396),m=i(596648),S=o.__importDefault(i(150343)),_=o.__importDefault(i(139221)),f=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"flex-start",marginBottom:2}),userIcon:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,overflow:"visible"}),textSize20:()=>n.Styles.createTextStyle({fontSize:20})});class y extends s.ComponentBase{_buildState(e,t){let i=u.getString("Notifications.UnknownUserShort");if(e.transcription.senderMri){const t=r.sanitizeMri(e.transcription.senderMri,r.Namespaces.SkypeId);t&&(i=h.default.isMyMri(t)?u.getString("DisplayInfoStore.ListMyName"):l.default.getShortDisplayName(t)||u.getString("Notifications.UnknownUserShort"))}return{displayName:i}}render(){let e;if(this.props.transcription.messages&&this.props.transcription.messages.length>0&&this.props.transcription.payloads&&this.props.transcription.payloads.length>0&&this.props.transcription.sentences&&this.props.transcription.sentences.length>0){e="";for(let t=0;t<this.props.transcription.messages.length;t++){const i=this.props.isInterimCaptionConcatenated?this.props.transcription.sentences[t]:this.props.transcription.payloads[t].translation||this.props.transcription.payloads[t].message;i&&(e+=i+" ")}}else e=this.props.isInterimCaptionConcatenated?this.props.transcription.sentence:this.props.transcription.payload.translation||this.props.transcription.payload.message;if(!e)return null;const t=!(this.props.uiPstn&&this.props.callParticipantCount&&1===this.props.callParticipantCount),i=this.props.captionPositionMode===c.CaptionsPositionMode.left?m.UserIconSize.Size24:m.UserIconSize.Size40,o=t?i/2:0;let s,r=!this.props.isInterimCaptionHighlightEnabled||this.props.transcription.payload.isFinal?p.Color.white:p.Color.gray300,l=p.Color.blackOverlay80,d=p.Color.blackOverlay80;this.props.uiPstn?r=this.props.useLightTheme?p.Color.delphiPrimaryTextColor:p.Color.gray50:this.props.useLightTheme?(r=!this.props.isInterimCaptionHighlightEnabled||this.props.transcription.payload.isFinal?p.Color.black:p.Color.blackOverlay80,s=p.Color.blackOverlay50,l=p.Color.whiteOverlay80,d=p.Color.whiteOverlay80):(s=p.Color.gray50Overlay50,this.props.captionPositionMode===c.CaptionsPositionMode.float&&(s=p.Color.white,l=p.Color.gray600,d=p.Color.gray400));const h=[f.userIcon,n.Styles.createViewStyle({alignItems:this.props.isRTL?"flex-end":"flex-start"},!1)],y=[f.container,n.Styles.createViewStyle({alignItems:this.props.isRTL?"flex-end":"flex-start"},!1)],T=[n.Styles.createViewStyle({alignItems:this.props.isRTL?"flex-end":"flex-start",marginLeft:this.props.isRTL?void 0:o,marginRight:this.props.isRTL?o:void 0},!1)],b=[],v=[n.Styles.createTextStyle({paddingLeft:this.props.isRTL?10:o+10,paddingRight:this.props.isRTL?o+10:10,color:r},!1)];if(this.props.uiPstn)v.push(n.Styles.createTextStyle({fontSize:25,paddingVertical:6},!1));else{const e=i+16;if(this.props.captionPositionMode===c.CaptionsPositionMode.bottom)y.push(n.Styles.createViewStyle({marginTop:10,minHeight:e},!1)),this.props.isUsingStackNavigationContext||v.push(f.textSize20);else if(this.props.captionPositionMode===c.CaptionsPositionMode.left)y.push(n.Styles.createViewStyle({marginBottom:10,minHeight:e},!1));else{if(_.default.isElectronWindows()){const e=S.default.getS4LCMCFeaturesNoSubscription().callCaptionsFloatPanel.letterSpacingWindows;e>0&&v.push(n.Styles.createTextStyle({letterSpacing:e},!1))}const o=t?i+8:8;y.push(n.Styles.createViewStyle({paddingHorizontal:12,marginBottom:4,minHeight:e},!1)),T.push(n.Styles.createViewStyle({marginLeft:this.props.isRTL?void 0:o,marginRight:this.props.isRTL?o:void 0,marginBottom:2,borderRadius:8,paddingHorizontal:8,paddingVertical:4},!1)),b.push(n.Styles.createViewStyle({backgroundColor:l},!1)),v.push(n.Styles.createTextStyle({paddingLeft:0,paddingRight:0,color:r},!1)),v.push(f.textSize20),h.push(n.Styles.createViewStyle({marginLeft:this.props.isRTL?void 0:12,marginRight:this.props.isRTL?12:void 0,marginTop:8},!1))}}let I,w;t&&(I=(0,a.jsx)(n.View,{style:h,children:(0,a.jsx)(C.UserIcon,{userMri:this.props.transcription.senderMri,size:i})},"icon"));let P=u.getString("CallTranscription.CaptionText")+", ";if(this.props.uiPstn)w=void 0;else{P=P+this.state.displayName+", ";const e=n.Styles.createViewStyle({backgroundColor:this.props.captionPositionMode===c.CaptionsPositionMode.bottom||this.props.captionPositionMode===c.CaptionsPositionMode.left?void 0:d},!1),t=n.Styles.createTextStyle({fontSize:12,paddingBottom:this.props.captionPositionMode===c.CaptionsPositionMode.bottom||this.props.captionPositionMode===c.CaptionsPositionMode.left?0:2,color:s||r},!1);w=(0,a.jsx)(n.View,{style:[T,t,e],children:(0,a.jsx)(g.BodyText,{style:[v,t],children:this.state.displayName})},"nametag")}return(0,a.jsxs)(n.View,{style:y,disableTouchOpacityAnimation:!0,accessibilityLabel:P+e,children:[w,(0,a.jsx)(n.View,{style:[T,b],children:(0,a.jsx)(g.BodyText,{style:v,children:e})},"text"),I]})}}t.default=y},78451:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(150343)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(581670)),d=o.__importDefault(i(368427)),u=i(780676),h=o.__importDefault(i(958868)),p=o.__importDefault(i(844104)),g=o.__importDefault(i(453761)),C=o.__importDefault(i(114818)),m=i(26703),S=o.__importStar(i(704704)),_=o.__importDefault(i(942724)),f=o.__importDefault(i(140334)),y=i(16549),T=i(641400),b=i(597542),v=o.__importDefault(i(740794)),I=o.__importDefault(i(760989)),w=T.IconSize.default,P=T.IconSize.size24,M=T.IconSize.size40,D=T.IconSize.size20,A=(0,m.lazyProperties)({scroll:()=>s.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:y.Color.black}),buttonIconsContainer:()=>s.Styles.createViewStyle({height:w,alignItems:"flex-start",flexDirection:"row",justifyContent:"space-between"}),buttonIcon:()=>s.Styles.createViewStyle({width:w,height:w,justifyContent:"center",alignItems:"center",alignSelf:"flex-start",opacity:.9,overflow:"visible"}),buttonJumpContainer:()=>s.Styles.createViewStyle({position:"absolute",right:12,width:M,height:M,overflow:"visible"}),buttonJump:()=>s.Styles.createViewStyle({width:M,height:M,borderWidth:1,borderRadius:M/2,borderColor:y.Color.blackOverlay10,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible",backgroundColor:y.Color.gray400}),buttonHovered:()=>s.Styles.createViewStyle({opacity:1})});class k{constructor(e,t,i){this.key=e,this.transcription=t,this.height=i,this.focusable=!1}}class R extends h.default{constructor(){super(...arguments),this._renderItem=(e,t)=>e instanceof k?(0,a.jsx)(c.default,{transcription:e.transcription,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:this.state.isInterimCaptionHighlightEnabled,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext},e.key):(0,a.jsx)(s.View,{}),this._onPressClose=e=>{if(e.stopPropagation(),this.state.canJumpToEnd||d.default.setConsumptionHorizon(this.props.callId,this.state.lastMessageTime+1),this.state.isUsingStackNavigationContext){const e=I.default.newCauseId();v.default.goBack(e,this._getContext())}l.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.callId,!1)},this._onPressClosedCaptionSettings=e=>{e.stopPropagation(),l.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,!1,this._getRootViewId())},this._onPressJump=e=>{e.stopPropagation(),this._listView&&this._listView.scrollToBottom()},this._onVisibleRangeChanged=(e,t,i,o)=>{if(!this._itemList)return;const a=o!==this._itemList.getItemList().length-1;n.defer((()=>{this.isComponentMounted()&&(this.state.canJumpToEnd!==a?this.setState({canJumpToEnd:a}):d.default.resetUnseenTranscriptionCount(this.props.callId))}))},this._equalsItemInfo=(e,t)=>e instanceof k&&t instanceof k?e.key===t.key&&e.transcription.payload.message===t.transcription.payload.message&&e.transcription.payload.translation===t.transcription.payload.translation&&e.transcription.payload.isFinal===t.transcription.payload.isFinal:(0,C.default)(e,t),this._shouldUpdateItem=(e,t)=>!this._equalsItemInfo(e,t),this._onListViewRef=e=>{this._listView=e||void 0}}_buildState(e,t){var i,o;const a=r.default.getS4LCMCFeatures(),s=d.default.getTranscriptions(e.callId),l=n.map(s,(e=>new k(e.payload.cid,e))),c=null!==(o=null===(i=n.maxBy(s.map((e=>e.message)),(e=>e.createdTime)))||void 0===i?void 0:i.createdTime)&&void 0!==o?o:0;if(t||!this._itemList)this._itemList=new f.default,this._itemList.addItems(0,l);else{const e=this._itemList.getItemList(),t=p.default.calculateModifications(e,l,!0,!1,this._equalsItemInfo),i=p.default.convertToListModifications(t);this._itemList.applyMany(i)}return{isInterimCaptionConcatenated:a.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:a.isInterimCaptionHighlightEnabled,lastMessageTime:c,isUsingStackNavigationContext:_.default.isUsingStackNavigationContext()}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),d.default.assignCallId(this.props.reactionsMri,this.props.callId)}render(){if(!this._itemList)return null;const e=this.props.bottomPadding||10,t=this.props.topPadding,i=s.Styles.createViewStyle({paddingBottom:e,paddingTop:t},!1),o=this.state.canJumpToEnd?this._renderJumpButton():void 0;return(0,a.jsxs)(s.View,{style:[this.props.style,A.scroll,i],children:[(0,a.jsxs)(s.View,{style:A.buttonIconsContainer,children:[(0,a.jsx)(g.default,{style:A.buttonIcon,size:P,color:y.Color.gray50,hoverColor:y.Color.white,hoverStyle:A.buttonHovered,icon:T.SkypeIcon.ClosePanel,onPress:this._onPressClose,title:S.getString("CallTranscription.Collapse")}),(0,a.jsx)(g.default,{style:A.buttonIcon,size:P,color:y.Color.gray50,hoverColor:y.Color.white,hoverStyle:A.buttonHovered,icon:T.SkypeIcon.ClosedCaptionSettings,onPress:this._onPressClosedCaptionSettings,title:S.getString("CallingSettingsPanel.SubtitlesButtonLabel")})]},"buttonIconsContainer"),(0,a.jsx)(b.VirtualMessageView,{ref:this._onListViewRef,observableList:this._itemList,renderItem:this._renderItem,onVisibleRangeChanged:this._onVisibleRangeChanged,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:u.SubtitleMaxWidth,horizontalPadding:{left:30,right:30},useWideLayout:!1,leftSpacerWidth:0,rightSpacerWidth:0,canShowSuggestions:!1}),o]},"subtitleHistory")}_renderJumpButton(){const e=this.props.bottomPadding||10,t=s.Styles.createViewStyle({bottom:e},!1);return(0,a.jsx)(s.View,{style:[A.buttonJumpContainer,t],children:(0,a.jsx)(g.default,{style:A.buttonJump,hoverStyle:A.buttonHovered,size:D,onPress:this._onPressJump,color:y.Color.gray100,hoverColor:y.Color.white,icon:T.SkypeIcon.DownChevron,title:S.getString("CallTranscription.JumpToLast")})},"jumpToEnd")}}t.default=R},382880:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsBarSafezone=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=(i(854646),o.__importDefault(i(612094)),o.__importStar(i(516778))),r=i(537180),l=o.__importStar(i(667294)),c=o.__importDefault(i(150343)),d=o.__importDefault(i(369347)),u=o.__importDefault(i(581670)),h=o.__importDefault(i(368427)),p=i(780676),g=o.__importDefault(i(114818)),C=o.__importStar(i(94534)),m=i(26703),S=o.__importStar(i(704704)),_=i(16549),f=o.__importDefault(i(827361)),y=i(262725),T=o.__importDefault(i(601274)),b=i(477195),v=o.__importDefault(i(942724)),I=o.__importDefault(i(524526)),w=o.__importDefault(i(638260)),P=o.__importDefault(i(760989)),M=o.__importStar(i(341994)),D=o.__importDefault(i(384229)),A=o.__importDefault(i(3352)),k=o.__importDefault(i(958868)),R=o.__importStar(i(939304)),x=o.__importStar(i(44717)),L=o.__importDefault(i(421334)),B=o.__importDefault(i(117475));t.SettingsBarSafezone=45;_.Color.black,_.Color.black,_.Color.black,_.Color.transparent,_.Color.black,_.Color.black,_.Color.black,_.Color.black,_.Color.black,_.Color.black,_.Color.black,_.Color.black,_.Color.black,_.Color.transparent;const V=(0,m.lazyProperties)({container:()=>s.Styles.createViewStyle({alignItems:"stretch",overflow:"visible"}),captionsContainer:()=>s.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"}),captionsContainerUiV2:()=>s.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"stretch",overflow:"hidden"}),scrollInsideContainer:()=>s.Styles.createViewStyle({flexGrow:0,flexShrink:1,justifyContent:"flex-end",alignItems:"stretch"}),scrollInsideContainerDesktop:()=>s.Styles.createViewStyle({flexGrow:0,flexShrink:1,justifyContent:"flex-end",alignItems:"stretch"}),preview:()=>s.Styles.createViewStyle({position:"relative",flex:1,justifyContent:"flex-end",alignItems:"stretch"}),messageContainer:()=>s.Styles.createViewStyle({position:"absolute",bottom:0,borderRadius:15,alignItems:"center",alignSelf:"center",backgroundColor:_.Color.blackOverlay70,marginLeft:15,marginRight:15}),messageText:()=>s.Styles.createTextStyle({paddingHorizontal:16,paddingVertical:5,color:_.Color.white,textAlign:"center"}),gradientStyle:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row"}),maskedView:()=>s.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"stretch"}),settingsButtonIcon:()=>s.Styles.createViewStyle({width:24,height:24}),settingsButton:()=>s.Styles.createViewStyle({position:"absolute",flexDirection:"row",top:15,right:15,justifyContent:"center",alignItems:"flex-start",alignSelf:"flex-start",opacity:.8,overflow:"visible"}),settingsPanelContainer:()=>s.Styles.createViewStyle({position:"absolute",flex:1,flexDirection:"row",alignItems:"center",alignSelf:"flex-start",overflow:"visible",left:0,right:0}),settingsButtonIconHovered:()=>s.Styles.createViewStyle({opacity:1}),settingsButtonText:()=>s.Styles.createTextStyle({marginLeft:10}),settingsPanelPart:()=>s.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",alignSelf:"flex-start"}),jumpToBottomButton:()=>s.Styles.createViewStyle({bottom:-4,right:8})});class O extends k.default{constructor(){super(...arguments),this._prefSubscriptions=[],this._contentPreviousScrollValue=0,this._contentPreviousHeightValue=0,this._captionsStopScroll=!1,this._contentScrollRef=l.createRef(),this._jumpToEndButtonRef=l.createRef(),this._firstPstnTranslationArrived=()=>this.state.isPstnTranslation&&this.state.hasHistory,this._pstnTranslationStopped=()=>!this.state.isPstnTranslation,this._setSpokenLanguage=()=>{let e;if(this.state.isCaptioning||this.state.isSkypeTranslation?e=I.default.getCallTranslatorSpokenLanguage(this.props.conversationMri):this.state.isVoiceTranslation?e=I.default.getLocalCallTranslatorBotSubtitleLanguageLocale():this.state.isPstnTranslation&&(e=I.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(this.props.conversationMri)),e){e&&this.state.spokenLocale&&S.isRTLLanguage(e)!==S.isRTLLanguage(this.state.spokenLocale)&&this._sendConsumptionHorizon();const t=C.getShortLanguageTitle(e);this.setState({spokenLocale:e,spokenLang:t})}},this._onJumpToBottom=e=>{this._captionsStopScroll=!1,this._scrollToBottom(),this._showHideJumpToBottomButton(!0)},this._resetCaptionsScroll=()=>{this._captionsStopScroll=!1,this._contentPreviousScrollValue=0,this._contentPreviousHeightValue=0,this._scrollToBottomAnimated(!1),this._showHideJumpToBottomButton(!0)},this._onScrollViewScroll=e=>{var t,i,o,a,n,s;const r=(null===(i=null===(t=e.nativeEvent)||void 0===t?void 0:t.contentOffset)||void 0===i?void 0:i.y)||0,l=(null===(a=null===(o=e.nativeEvent)||void 0===o?void 0:o.contentSize)||void 0===a?void 0:a.height)||0,c=(null===(s=null===(n=e.nativeEvent)||void 0===n?void 0:n.layoutMeasurement)||void 0===s?void 0:s.height)||0;let d=!0;this._shouldStopAutoScrolling(r,l)?this._captionsStopScroll=!0:this._shouldStartAutoScrolling(l,c,r)?this._captionsStopScroll=!1:d=!1,this._contentPreviousHeightValue=l,this._contentPreviousScrollValue=r,d&&this._showHideJumpToBottomButton()},this._onScrollViewScrollDebounced=n.debounce(this._onScrollViewScroll,c.default.getS4LCMCFeaturesNoSubscription().callCaptionsScrolling.scrollingCallbackDebounce),this._shouldStartAutoScrolling=(e,t,i)=>this._captionsStopScroll&&this._isScrollEndReached(e,t,i),this._shouldStopAutoScrolling=(e,t)=>!this._captionsStopScroll&&this._isCaptionsScrollUp(e)&&!this._isContentHeightReduced(t)&&this._isStopScrollThresholdReached(e),this._isContentHeightReduced=e=>e<this._contentPreviousHeightValue,this._isScrollEndReached=(e,t,i)=>e-t-i<=this.state.callCaptionsScrolling.stopScrollingThreshold,this._isStopScrollThresholdReached=e=>Math.abs(e-this._contentPreviousScrollValue)>this.state.callCaptionsScrolling.stopScrollingThreshold,this._isCaptionsScrollUp=e=>e<this._contentPreviousScrollValue,this._setJumpToEndButtonVisibilityAndClearTimer=e=>{var t,i;null===(i=null===(t=this._jumpToEndButtonRef)||void 0===t?void 0:t.current)||void 0===i||i.setVisible(e),this._showButtonTimer=void 0},this._onPress=e=>{!this.props.onStageTap||this.state.isPstnTranslation&&x.isPhoneMri(this.props.conversationMri)||this.props.onStageTap(Date.now())},this._renderItem=({item:e,index:t})=>(0,a.jsx)(u.default,{transcription:e,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:this.state.isInterimCaptionHighlightEnabled,uiPstn:this.state.uiPstn,callParticipantCount:this.state.callParticipantCount,useLightTheme:this.props.useLightTheme&&!this.state.uiv2AlwaysBlack,captionPositionMode:this.props.captionPositionMode,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isRTL:S.isRTLLanguage(this.state.spokenLocale)},"item"+t),this._onLayout=e=>{!(0,g.default)(e,this.state.viewRect)&&this.isComponentMounted()&&this.setState({viewRect:e})},this._onPressOpenSettings=e=>{this.props.rootViewId&&d.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,!1,this.props.rootViewId);const t=P.default.newCauseId();w.default.onCaptionsStartingMessageClick(this.props.callId,t)}}_buildState(e,t){var i,o;const a=c.default.getS4LCMCFeatures(),n=d.default.InCallBotService.isPstnTranslationEnabled(e.callId),s=d.default.InCallBotService.isCaptioningEnabled(e.callId),r=this._getLimit(e.captionPositionMode,a,n),l=s&&a.callCaptionsMerge?h.default.getTranscriptionsMerged(e.callId,r):h.default.getTranscriptions(e.callId,r),u=this._getTimeout(e.captionPositionMode,a,n),p=this._getContext().isPresentedByMobileStackNavigator?B.default.bottomSafeAreaInset():e.bottomPadding;return{hasHistory:0!==h.default.transcriptionCount(e.callId),viewRect:t?{x:0,y:0,width:0,height:0}:this.state.viewRect,isInterimCaptionConcatenated:a.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:a.isInterimCaptionHighlightEnabled,callParticipantCount:d.default.CallingStore.connectedParticipantsCount(e.callId),uiPstn:n,uiv2AlwaysBlack:!n&&e.captionPositionMode===b.CaptionsPositionMode.float,uiv2DynWidth:!n,contentHeight:null===(i=this.state)||void 0===i?void 0:i.contentHeight,contentVisibleHeight:null===(o=this.state)||void 0===o?void 0:o.contentVisibleHeight,transcriptionsCount:h.default.transcriptionCount(e.callId),captionsClearTimeout:u,transcriptions:l,isUsingStackNavigationContext:v.default.isUsingStackNavigationContext(),isCaptioning:s,isVoiceTranslation:d.default.InCallBotService.isVoiceTranslationEnabled(e.callId),isSkypeTranslation:d.default.InCallBotService.isSkypeTranslationEnabled(e.callId),isSkypeTranslationPaused:d.default.InCallBotService.isSkypeTranslationPaused(e.callId),isPstnTranslation:n,callCaptionsScrolling:a.callCaptionsScrolling,isTranslating:d.default.InCallBotService.isTranslating(e.callId),isMobileScreenReaderEnabled:L.default.isMobileScreenReaderEnabled(),safeAreaPadding:p}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._setSpokenLanguage(),n.isEmpty(this.state.transcriptions)||(0,g.default)(this.state.transcriptions,t.transcriptions)||(h.default.resetUnseenTranscriptionCount(this.props.callId),this._scheduleCaptionsClearTimer()),e.captionPositionMode!==this.props.captionPositionMode?this._resetCaptionsScroll():!this.state.isPstnTranslation&&this._captionsStopScroll||this._scrollToBottom(),this._startMessage()}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),h.default.assignCallId(this.props.reactionsMri,this.props.callId)}componentDidMount(){super.componentDidMount(),this._scheduleCaptionsClearTimer(),this._prefSubscriptions.push(M.default.subscribe(this._setSpokenLanguage,M.TriggerKeys.PstnTranslationSettings)),this._prefSubscriptions.push(M.default.subscribe(this._setSpokenLanguage,M.TriggerKeys.CallTranslatorBotSubtitleLanguageLocale)),this._prefSubscriptions.push(M.default.subscribe(this._setSpokenLanguage,M.TriggerKeys.CallTranslatorSpokenLanguage)),n.isEmpty(this.state.transcriptions)||this._resetCaptionsScroll()}componentWillUnmount(){super.componentWillUnmount(),this._prefSubscriptions.forEach((e=>M.default.unsubscribe(e))),this._showButtonTimer&&T.default.clearTimeout(this._showButtonTimer),this._stopCaptionsClearTimer(),this._startMessageSub&&(R.removeId(this._startMessageSub),this._startMessageSub=void 0)}_getTimeout(e,t,i){if(i)return t.pstnTranslation.captionsTimeout;switch(e){case b.CaptionsPositionMode.bottom:return t.callCaptionsBottomPanel.timeout;case b.CaptionsPositionMode.left:return t.callCaptionsLeftPanel.timeout;case b.CaptionsPositionMode.float:default:return t.callCaptionsFloatPanel.timeout}}_getLimit(e,t,i){if(i)return t.pstnTranslation.captionsLimit;let o;switch(e){case b.CaptionsPositionMode.bottom:o=t.callCaptionsBottomPanel.limit;break;case b.CaptionsPositionMode.left:o=t.callCaptionsLeftPanel.limit;break;case b.CaptionsPositionMode.float:o=t.callCaptionsFloatPanel.limit}return o>0?o:void 0}_startMessage(){!this.state.isPstnTranslation||this._startMessageSub||this.state.hasHistory?(this._firstPstnTranslationArrived()||this._pstnTranslationStopped())&&this._startMessageSub&&(R.removeId(this._startMessageSub),this._startMessageSub=void 0):this._startMessageSub=R.addStartMessage(this.props.callId,this._getMessageText())}_showHideJumpToBottomButton(e=!1){this._showButtonTimer&&T.default.clearTimeout(this._showButtonTimer),e?this._setJumpToEndButtonVisibilityAndClearTimer(!1):this._showButtonTimer=T.default.setTimeout((()=>{const e=this._captionsStopScroll;this._setJumpToEndButtonVisibilityAndClearTimer(e)}),this.state.callCaptionsScrolling.jumpToAndButtonDisplayDelay)}_scrollToBottom(){this._scrollToBottomAnimated(this.state.callCaptionsScrolling.allowScrollingAnimation)}_scrollToBottomAnimated(e){var t,i;null===(i=null===(t=this._contentScrollRef)||void 0===t?void 0:t.current)||void 0===i||i.scrollToEnd({animated:e})}render(){return(0,a.jsxs)(s.View,{style:[V.container,this.props.style],onLayout:this._onLayout,onPress:this._onPress,children:[this._renderPreviewList(),this._renderMessage(),this._renderSettingsButton()]})}_renderSettingsButton(){if(this.state.isCaptioning||this.state.isVoiceTranslation||this.state.isSkypeTranslation){if(this.props.captionPositionMode===b.CaptionsPositionMode.float){const e=s.Styles.createViewStyle({bottom:this.props.bottomPadding,marginBottom:-t.SettingsBarSafezone,justifyContent:"center"},!1);return(0,a.jsx)(s.View,{style:[V.settingsPanelContainer,e],children:(0,a.jsx)(D.default,Object.assign({},this.props,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,isPstnTranslation:this.state.isPstnTranslation,isVoiceTranslation:this.state.isVoiceTranslation,isSkypeTranslation:this.state.isSkypeTranslation,isSkypeTranslationPaused:this.state.isSkypeTranslationPaused,isTranslating:this.state.isTranslating,spokenLang:this.state.spokenLang,showText:!0,showBg:!0}))},"settings")}if(this.props.captionPositionMode===b.CaptionsPositionMode.bottom||this.props.captionPositionMode===b.CaptionsPositionMode.left){const e=this.state.isUsingStackNavigationContext||this.props.captionPositionMode===b.CaptionsPositionMode.left&&this.state.isVoiceTranslation,t=this.props.captionPositionMode===b.CaptionsPositionMode.bottom,i=s.Styles.createViewStyle({top:0,justifyContent:e?"flex-end":"center"},!1);return(0,a.jsx)(s.View,{style:[V.settingsPanelContainer,i],children:(0,a.jsx)(D.default,Object.assign({},this.props,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,isPstnTranslation:this.state.isPstnTranslation,isVoiceTranslation:this.state.isVoiceTranslation,isSkypeTranslation:this.state.isSkypeTranslation,isSkypeTranslationPaused:this.state.isSkypeTranslationPaused,isTranslating:this.state.isTranslating,spokenLang:this.state.spokenLang,showText:t,showBg:!1}))},"settings")}}}_getMessageText(){let e;return e=this.state.spokenLang?S.getString("CallTranscription.StartSubtitlesV2Lang",{language:this.state.spokenLang}):S.getString("CallTranscription.StartSubtitlesV2"),e}_renderMessage(){if(!this.state.hasHistory&&!this.state.isPstnTranslation&&!this.state.isSkypeTranslation){const e=(0,a.jsx)(y.BodyText,{style:V.messageText,children:this._getMessageText()}),t=this.state.isCaptioning||this.state.isVoiceTranslation,i=[V.messageContainer,t?f.default.pointerCursor:void 0],o=this.props.captionPositionMode===b.CaptionsPositionMode.bottom&&!this.state.isUsingStackNavigationContext;if(this.props.bottomPadding){const e=this.state.uiPstn||o?this.props.bottomPadding+15:this.props.bottomPadding;i.push(s.Styles.createViewStyle({bottom:e},!1))}return(0,a.jsx)(s.View,{style:i,onPress:t?this._onPressOpenSettings:void 0,children:e},"message")}}_renderPreviewList(){const e=this.props.captionPositionMode===b.CaptionsPositionMode.bottom||this.props.captionPositionMode===b.CaptionsPositionMode.left?40:0;var t=this.state.safeAreaPadding;this.props.captionPositionMode===b.CaptionsPositionMode.float&&(t=this.state.safeAreaPadding+25);const i=s.Styles.createViewStyle({marginLeft:0,marginRight:0,marginBottom:t,marginTop:e},!1);V.captionsContainer;let o;{const e=100*(1-(this.state.isPstnTranslation?.25:.1)),t={maskImage:`linear-gradient(0deg, black ${e}%, transparent 100%)`,WebkitMaskImage:`linear-gradient(0deg, black ${e}%, transparent 100%)`},i=this.state.callCaptionsScrolling.allowStopScrolling?(0,a.jsx)(A.default,{ref:this._jumpToEndButtonRef,onPressCallback:this._onJumpToBottom,style:V.jumpToBottomButton},"jumpToEndButton"):void 0,l=this.state.transcriptions.map(((e,t)=>this._renderItem({item:e,index:t}))),c=this.props.captionPositionMode===b.CaptionsPositionMode.left,d=this.state.isPstnTranslation||this.props.captionPositionMode===b.CaptionsPositionMode.left;o=(0,a.jsxs)(s.View,{style:[V.captionsContainerUiV2,n.isEmpty(this.state.transcriptions)?void 0:t],children:[(0,a.jsx)(s.View,{style:V.scrollInsideContainerDesktop,children:(0,a.jsx)(r.ScrollView,{ref:this._contentScrollRef,style:f.default.flexOne,onScroll:c?this._onScrollViewScrollDebounced:void 0,scrollEnabled:d,removeClippedSubviews:!0,showsVerticalScrollIndicator:!1,scrollsToTop:!1,children:l},"captionsList-"+this.props.captionPositionMode.toString())}),i]},"captionsContainer"+this.props.captionPositionMode.toString())}return(0,a.jsx)(s.View,{style:[V.preview,i],children:o},"subtitlePreview")}static getHorizontalPadding(e,t,i,o){let a=p.SubtitleMaxWidth;const n=c.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.captionsWidthDesktopPercentage,s=c.default.getS4LCMCFeaturesNoSubscription().callCaptionsLeftPanel.captionsWidthDesktopPercentage;a=!t&&i===b.CaptionsPositionMode.bottom&&n>0?e*n:t||i!==b.CaptionsPositionMode.float?!t&&i===b.CaptionsPositionMode.left&&s>0?e*s:p.SubtitleMaxWidthV2:p.SubtitleMaxWidthV3;let r=30;return o||i!==b.CaptionsPositionMode.left?o||i!==b.CaptionsPositionMode.float?o&&t&&i===b.CaptionsPositionMode.float&&(r=16):r=12:r=20,Math.max((e-a)/2,r)}_sendConsumptionHorizon(){var e,t;const i=null!==(t=null===(e=n.maxBy(this.state.transcriptions.map((e=>e.message)),(e=>e.createdTime)))||void 0===e?void 0:e.createdTime)&&void 0!==t?t:0;h.default.setConsumptionHorizon(this.props.callId,i+1)}_scheduleCaptionsClearTimer(){this._stopCaptionsClearTimer(),this.state.captionsClearTimeout>0&&(this._onCaptionsClearTimer=T.default.setTimeout((()=>{this._sendConsumptionHorizon(),this._onCaptionsClearTimer=void 0}),this.state.captionsClearTimeout))}_stopCaptionsClearTimer(){this._onCaptionsClearTimer&&(T.default.clearTimeout(this._onCaptionsClearTimer),this._onCaptionsClearTimer=void 0)}}t.default=O},938068:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(217041),s=o.__importStar(i(667294)),r=i(537180),l=i(344175),c=i(331654),d=o.__importDefault(i(970035)),u=o.__importDefault(i(660401)),h=o.__importStar(i(68210)),p=i(154235),g=i(641400),C=i(460515),m=o.__importStar(i(206315)),S=i(206197),_=i(262725),f=o.__importDefault(i(827361)),y=i(483753),T=o.__importDefault(i(150343)),b=o.__importDefault(i(960282)),v=i(964414),I=r.StyleSheet.create({notificationGeneralContainer:{flex:1,flexShrink:0,flexDirection:"column",alignSelf:"stretch",borderWidth:1,borderRadius:16,marginHorizontal:6,marginVertical:3,padding:16},notificationPanel:{position:"absolute",top:0,flexShrink:1,flexDirection:"column"},notificationPanelDesktop:{maxWidth:440,width:"100%",alignSelf:"center"},notificationPanelMobile:{left:0,right:0,alignSelf:"stretch"},notificationIcon:{alignItems:"center",alignSelf:"center",marginRight:16},notificationDismiss:{alignItems:"center",alignSelf:"flex-start",marginLeft:16},notificationButtonWrapper:{flex:1,flexDirection:"row"},notificationButtonMobileWrapper:{flexDirection:"row"},notificationInnerContainer:{flex:1,flexDirection:"row",alignSelf:"stretch"},notificationInnerButtonsContainer:{flex:1,flexDirection:"row",alignSelf:"center"},notificationInnerButtonsContainerMargin:{marginTop:8},notificationButton:{alignItems:"center"},notificationTextWrapper:{flex:1},notificationConsentContainer:{flex:1,flexShrink:1,flexDirection:"column",alignSelf:"stretch",borderWidth:1,borderRadius:24,marginHorizontal:6,marginVertical:3,minHeight:100},notificationConsentContainerPadding:{padding:35},notificationConsentContainerPaddingMobileLandscape:{padding:10},consentTextBox:{alignSelf:"center"},consentText:{textAlign:"center"},flexDirectionColumn:{flexDirection:"column"},bulletMargin:{marginRight:5},flexShrinkZero:{flexShrink:0},overflowHidden:{overflow:"hidden"}}),w=(e,t)=>s.useCallback((()=>{null==t||t(e),h.default.removeToast(e,C.ToastActionType.ManualDismissed)}),[e,t]),P=({toastId:e})=>{const t=w(e),{secondaryTextColor:i}=(0,m.useSkypeTheme)().themeColors;return(0,a.jsx)(d.default,{icon:g.SkypeIcon.ClosePanel,size:g.IconSize.size20,color:i,onPress:t})},M=({toastId:e,title:t,action:i,marginRight:o,marginLeft:n,marginTop:s,marginBottom:r,buttonStyle:l,buttonConfig:c,innerStyle:d})=>{const h=w(e,i);return(0,a.jsx)(u.default,{buttonStyle:l,buttonSize:p.SXButtonSize.Small,buttonConfig:c,backgroundStyle:{marginRight:o,marginLeft:n,marginBottom:r,marginTop:s},title:t,innerContainerStyle:d,style:I.notificationButton,onPress:h,children:t})},D=({toastItem:e,useLightTheme:t})=>{var i,o,n,s,c,u,h;const{themeColors:{iconInteractive:C}}=(0,m.useSkypeTheme)(),y=t?S.Theme.Delphi:S.Theme.DelphiDark,{primaryBackgroundColor:T,secondaryBackgroundColor:b,secondaryTextColor:w}=m.default.themeColorsForTheme(y),D=m.default.themeStylesForTheme(y).primaryTextColorStyle,{containerStyle:A}=(0,v.useSkypeStyles)((()=>({containerStyle:{flex:1,flexShrink:0,flexDirection:"column",alignSelf:"stretch",borderWidth:1,borderRadius:16,marginHorizontal:6,marginVertical:3,padding:16,backgroundColor:b,borderColor:T}})),[T,b]),k=e.state,R=k.icon?(0,a.jsx)(l.Box,{style:I.notificationIcon,children:(0,a.jsx)(d.default,{icon:k.icon,size:g.IconSize.size20,color:k.iconColorOverride?k.iconColorOverride:C})}):void 0,x=k.dismissable?(0,a.jsx)(l.Box,{style:I.notificationDismiss,children:(0,a.jsx)(P,{toastId:e.id})}):void 0,L=(null===(i=k.buttons)||void 0===i?void 0:i[0])?(0,a.jsx)(M,{toastId:e.id,title:null===(o=k.buttons)||void 0===o?void 0:o[0].label,action:null===(n=k.buttons)||void 0===n?void 0:n[0].action,buttonStyle:p.SXButtonStyle.GradientFill,marginRight:(null===(s=k.buttons)||void 0===s?void 0:s.length)>1?8:0}):void 0,B=(null===(c=k.buttons)||void 0===c?void 0:c[1])?(0,a.jsx)(M,{toastId:e.id,title:null===(u=k.buttons)||void 0===u?void 0:u[1].label,action:null===(h=k.buttons)||void 0===h?void 0:h[1].action,buttonStyle:p.SXButtonStyle.ColorStroke,buttonConfig:{textColor:w,borderColor:w},marginLeft:8}):void 0,V=L||B?(0,a.jsxs)(l.Box,{style:I.notificationButtonWrapper,children:[L,B]}):void 0;return(0,a.jsxs)(l.Box,{style:A,accessibilityRole:"alert",accessibilityLabel:k.text,importantForAccessibility:"auto",children:[(0,a.jsxs)(l.Box,{style:I.notificationInnerContainer,children:[R,(0,a.jsx)(l.Box,{style:I.notificationTextWrapper,importantForAccessibility:"no",children:(0,a.jsx)(_.BodyText,{style:r.StyleSheet.flatten([f.default.flexOne,D]),children:k.text})}),x]}),(0,a.jsx)(l.Box,{style:[I.notificationInnerButtonsContainer,L||B?I.notificationInnerButtonsContainerMargin:void 0],children:V})]},"CaptionsGenericToast"+e.id)},A=({toastItem:e,consentSameButton:t,useLightTheme:i,isMobileLandscape:o})=>{var n,s,c,u,h,C;const{themeColors:{iconOnAccent:T}}=(0,m.useSkypeTheme)(),b=i?S.Theme.Delphi:S.Theme.DelphiDark,{primaryBackgroundColor:v,secondaryBackgroundColor:w,secondaryTextColor:P}=m.default.themeColorsForTheme(b),D=m.default.themeStylesForTheme(b).primaryTextColorStyle,A=e.state,k=r.StyleSheet.flatten([I.notificationInnerContainer,I.consentTextBox]),R=r.StyleSheet.flatten([f.default.flexOne,f.default.textAlignCenter]),x=r.StyleSheet.flatten([R,D]);let L,B=4;o&&(B=2);const V=o?void 0:(0,a.jsx)(l.Box,{style:k,children:(0,a.jsx)(d.default,{icon:A.icon,size:g.IconSize.size20,color:T})}),O=A.text?(0,a.jsx)(l.Box,{style:k,paddingTop:B,children:(0,a.jsx)(_.Caption,{style:R,children:A.text})}):void 0,E=A.subtitle?(0,a.jsx)(l.Box,{style:k,paddingTop:B,children:(0,a.jsx)(_.BodyText,{bold:!0,style:x,children:A.subtitle})}):void 0;let N;if(A.subtext){const e=A.subtext.map((e=>(0,a.jsxs)(l.Box,{flexDirection:"row",children:[(0,a.jsx)(_.Caption,{style:I.bulletMargin,children:"• "}),(0,a.jsx)(_.Caption,{style:[f.default.flexOne],children:e})]})));N=(0,a.jsx)(l.Box,{style:[I.notificationInnerContainer,I.consentTextBox,I.flexDirectionColumn],paddingTop:B,paddingLeft:L,paddingRight:L,children:e})}const F=A.link?(0,a.jsx)(l.Box,{style:k,paddingTop:B,color:"iconOnAccent",children:(0,a.jsx)(_.Caption,{style:R,children:(0,a.jsx)(y.AccessibleLink,{url:A.link.url,textElement:_.Caption,children:A.link.text})})}):void 0;let U;if(A.buttons&&A.buttons.length>0){const i=(null===(n=A.buttons)||void 0===n?void 0:n[0])?(0,a.jsx)(M,{toastId:e.id,title:null===(s=A.buttons)||void 0===s?void 0:s[0].label,action:null===(c=A.buttons)||void 0===c?void 0:c[0].action,buttonStyle:p.SXButtonStyle.GradientFill,innerStyle:{},marginBottom:o?void 0:8,marginRight:o?8:void 0}):void 0,d=t?void 0:{textColor:P,borderColor:P},g=(null===(u=A.buttons)||void 0===u?void 0:u[1])?(0,a.jsx)(M,{toastId:e.id,title:null===(h=A.buttons)||void 0===h?void 0:h[1].label,action:null===(C=A.buttons)||void 0===C?void 0:C[1].action,buttonStyle:p.SXButtonStyle.ColorStroke,buttonConfig:d,innerStyle:{}}):void 0;U=o?(0,a.jsx)(l.Box,{style:r.StyleSheet.flatten([I.notificationInnerButtonsContainer,I.flexShrinkZero]),paddingTop:B,children:(0,a.jsxs)(l.Box,{style:r.StyleSheet.flatten([I.notificationButtonWrapper]),children:[i,g]})}):(0,a.jsxs)(l.Box,{style:r.StyleSheet.flatten([I.notificationInnerContainer,I.flexDirectionColumn,I.flexShrinkZero]),paddingTop:B,children:[i,g]})}const H=r.StyleSheet.flatten([I.notificationConsentContainer,I.overflowHidden,o?I.notificationConsentContainerPaddingMobileLandscape:I.notificationConsentContainerPadding,{backgroundColor:w,borderColor:v}]);return(0,a.jsxs)(l.Box,{style:H,accessibilityRole:"alert",accessibilityLabel:A.title,importantForAccessibility:"auto",children:[(0,a.jsxs)(r.ScrollView,{style:I.flexDirectionColumn,importantForAccessibility:"no",children:[V,(0,a.jsx)(l.Box,{style:k,paddingTop:B,children:(0,a.jsx)(_.Header,{size:p.HeaderSize.h4,style:x,children:A.title})}),O,E,N,F]}),U]},"CaptionsGenericConsentNotification"+e.id)};var k;t.default=(k=({notifications:e,consentSameButtons:t,isUsingStackNavigationContext:i,useLightTheme:o,paddingTop:n,maxHeight:r,isMobileLandscape:c,headerHeight:d})=>{const u=s.useMemo((()=>((e,t,i,o)=>e.reverse().map((e=>e.type===h.ToastType.CaptionsTranslationConsent||e.type===h.ToastType.CaptionsTruVoiceConsent||e.type===h.ToastType.CaptionsTranslationConsentRequest||e.type===h.ToastType.CaptionsTruVoiceConsentRequest?(0,a.jsx)(A,{toastItem:e,consentSameButton:t,useLightTheme:i,isMobileLandscape:o},"ConsentNotification"+e.id):(0,a.jsx)(D,{toastItem:e,useLightTheme:i},"GenericNotification"+e.id))))(e,t,!!o,c)),[e,t,o,c]),p=[I.notificationPanel,i?I.notificationPanelMobile:I.notificationPanelDesktop],g=(r=r&&d?r-d:r)||void 0;return(0,a.jsx)(l.Box,{style:p,paddingTop:n,maxHeight:g,children:u})},class extends n.ComponentBase{_buildState(e){const t=b.default.getDeviceOrientation(e.rootViewId)===c.DeviceOrientation.Landscape,i=e.isUsingStackNavigationContext&&t;return{notifications:h.default.getToasts(e.rootViewId,h.ToastCategory.Captions,e.callId),consentSameButtons:T.default.getS4LCMCFeatures().translationFeatures.consentButtonsSameColor,isLandscape:t,isMobileLandscape:i}}render(){return(0,a.jsx)(k,Object.assign({},this.props,{notifications:this.state.notifications,consentSameButtons:this.state.consentSameButtons,isMobileLandscape:this.state.isMobileLandscape}))}})},384229:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAlertForDesktop=t.getMenuButtons=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(667294),r=o.__importDefault(i(150343)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(453761)),d=o.__importStar(i(94534)),u=i(26703),h=o.__importStar(i(704704)),p=i(16549),g=i(641400),C=i(477195),m=o.__importDefault(i(524526)),S=o.__importDefault(i(341994)),_=o.__importStar(i(85385)),f=o.__importDefault(i(888500)),y=i(815146),T=o.__importDefault(i(760989)),b=o.__importDefault(i(638260)),v=i(548087),I=i(736267),w=o.__importDefault(i(360718)),P=o.__importDefault(i(740794)),M=o.__importDefault(i(139221)),D=o.__importDefault(i(960282)),A=i(526849),k=o.__importDefault(i(132680)),R=(0,u.lazyProperties)({settingsIcon20:()=>n.Styles.createViewStyle({width:20,height:20}),settingsIcon16:()=>n.Styles.createViewStyle({width:16,height:16}),settingsButton20:()=>n.Styles.createViewStyle({width:30,height:40}),settingsButton16:()=>n.Styles.createViewStyle({width:24,height:32}),settingsIconMarginLeft:()=>n.Styles.createViewStyle({marginLeft:5}),settingsPanel:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",alignSelf:"flex-start",borderRadius:8,flexShrink:1}),settingsPanelPadding:()=>n.Styles.createViewStyle({paddingHorizontal:10}),settingsOpacity:()=>n.Styles.createViewStyle({opacity:.35}),settingsIcons20Paddings:()=>n.Styles.createViewStyle({paddingBottom:10,paddingTop:10,paddingLeft:5,paddingRight:5}),settingsIcons16Paddings:()=>n.Styles.createViewStyle({paddingBottom:8,paddingTop:8,paddingLeft:4,paddingRight:4}),settingsIcons20Margins:()=>n.Styles.createViewStyle({marginBottom:10,marginTop:10,marginLeft:5,marginRight:5}),settingsIcons16Margins:()=>n.Styles.createViewStyle({marginBottom:8,marginTop:8,marginLeft:4,marginRight:4}),settingsDivider:()=>n.Styles.createViewStyle({height:20,width:1}),settingsButtonIconHovered:()=>n.Styles.createViewStyle({opacity:1}),settingsButtonText:()=>n.Styles.createTextStyle({marginLeft:10}),settingsPanelPart:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",alignSelf:"flex-start"}),settingsLangButton:()=>n.Styles.createViewStyle({flex:1,maxWidth:250}),settingsLangText:()=>n.Styles.createViewStyle({flexGrow:1,maxWidth:230,minWidth:30,flexShrink:1}),justifyContentCenter:()=>n.Styles.createViewStyle({justifyContent:"center"}),menuPadding:()=>n.Styles.createViewStyle({paddingHorizontal:16})}),x=e=>d.getShortLanguageTitle(e)||e;t.getMenuButtons=e=>{const t=h.getLanguageFromLocale();return[...e].sort(((e,i)=>{const o=x(e),a=x(i);return o.localeCompare(a,t)})).map((e=>({text:x(e),command:e})))};t.useAlertForDesktop=()=>!0;t.default=(0,A.WithResub)((({callId:e,conversationMri:i,useLightTheme:o,isUsingStackNavigationContext:r,isMobileScreenReaderEnabled:d,isTranslating:u,isPstnTranslation:D,isVoiceTranslation:A,isSkypeTranslation:k,isSkypeTranslationPaused:x,captionPositionMode:L,spokenLang:B,rootViewId:V,callUIState:O,isPstnCall:E,showText:N,showBg:F,languages:U,enableExperimentalCallControls:H,enableNewLanguageSelectors:j,isMinDesktopWidth:z})=>{const[G,W]=(0,s.useState)(!1),K=(0,s.useMemo)((()=>(0,t.getMenuButtons)([...U])),[U]),$=!D&&L===C.CaptionsPositionMode.float,q=(0,I.useCommonContext)(),Q=(0,s.useRef)(null),X=()=>{const t=T.default.newCauseId();u?l.default.InCallBotService.stopSkypeTranslationConsent(e,t):l.default.InCallBotService.startSkypeTranslationConsent(e,t)},Z=t=>{l.default.InCallBotService.refreshConfig(e,t)},J=()=>{const a={causeId:T.default.newCauseId(),rootViewId:V,callId:e,conversationMri:i,anchor:()=>(null==Q?void 0:Q.current)||void 0,isUsingStackNavigationContext:r,isMobileScreenReaderEnabled:d,useLightTheme:o,isPstnCall:E,callerContext:()=>q,callUIState:O,menuComponentStyle:R.menuPadding,update:Z,useAlertForDesktop:t.useAlertForDesktop,changeLanguage:Y,startTranslation:X,isPstnTranslation:!1,isSkypeTranslation:!0};(0,v.showTranslationMenu)(a)};k&&w.default.setUpMenu(J);const Y=(e,t,o)=>{U.includes(t)?m.default.setCallTranslatorSpokenLanguage(i,t):_.log(y.LogTraceArea.CallingUI,`_toggleCaptionsLanguageMenu newLocale ${t} not in supported langs list. causeId: ${o}`)},ee=t=>i=>{if(i.stopPropagation(),L!==t){const i=T.default.newCauseId();S.default.setCallTranslatorCaptionsPositionMode(t),b.default.onCaptionPositionModeChanged(e,t,i)}},te=r,ie=o&&!$?p.Color.blackOverlay80:p.Color.gray50;let oe;F&&(oe=p.Color.blackOverlay80,oe=o&&!$?p.Color.whiteOverlay80:p.Color.gray600);const ae=L===C.CaptionsPositionMode.left||M.default.isEdgeShoreline()&&z,ne=ae?14:16,se=ae?g.IconSize.size16:g.IconSize.size20,re=ae?R.settingsIcon16:R.settingsIcon20,le=ae?R.settingsButton16:R.settingsButton20,ce=ae?R.settingsIcons16Paddings:R.settingsIcons20Paddings,de=ae?R.settingsIcons16Margins:R.settingsIcons20Margins,ue=R.justifyContentCenter,he=n.Styles.createViewStyle({backgroundColor:oe},!1),pe=n.Styles.createTextStyle({color:ie,fontSize:ne},!1),ge=n.Styles.createViewStyle({backgroundColor:ie},!1);let Ce;L!==C.CaptionsPositionMode.left||A||(Ce=1);const me=n.Styles.createViewStyle({flexGrow:Ce},!1),Se=h.getString("CallControls.LiveCaptions"),_e=B,fe=Se+", "+(_e?h.getString("CaptionsSettings.LanguageSelectedAccessibility",{language:null!=_e?_e:""}):h.getString("CaptionsSettings.SelectLanguageAccessibility")),ye=[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.Selected],Te=[n.Types.AccessibilityTrait.Button],be=Se+", "+h.getString("CaptionsSettings.ShowFloat"),ve=!L||L===C.CaptionsPositionMode.float,Ie=ve?ye:Te,we=Se+", "+h.getString("CaptionsSettings.ShowOnBottom"),Pe=L===C.CaptionsPositionMode.bottom,Me=Pe?ye:Te,De=Se+", "+h.getString("CaptionsSettings.ShowOnLeft"),Ae=L===C.CaptionsPositionMode.left,ke=Ae?ye:Te,Re=Se+", "+h.getString("LanguageAndTranslationSettingsPanel.TranslationPause"),xe=h.getString("CaptionsSettings.CaptionsSettingsSettingsText"),Le=Se+", "+xe,Be=N?(0,a.jsx)(n.Text,{style:[de,pe],children:h.getString("CaptionsSettings.CaptionsSettingsViewText")+": "},"viewLabel"):void 0,Ve=A?void 0:[(0,a.jsxs)(n.Button,{style:n.Styles.combine([de,R.settingsPanelPart,R.settingsLangButton]),onPress:j?()=>{P.default.navigateToSpokenLanguagePicker(!1,V,!1,i,Y)}:e=>{e.stopPropagation();const i=T.default.newCauseId();_.log(y.LogTraceArea.CallingUI,`_toggleCaptionsLanguageMenu causeId: ${i}`);const o=h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle"),a={anchor:()=>{},buttons:K,title:o};f.default.showWithActionMenuConfig({options:a,callback:e=>Y(!0,e,i),maintainAnchor:!1,rootViewId:V,useAlertForMobile:!0,useAlertForDesktop:(0,t.useAlertForDesktop)(),invokingEvent:void 0,allowScrolling:(0,t.useAlertForDesktop)()})},title:fe,accessibilityLabel:fe,accessibilityTraits:n.Types.AccessibilityTrait.Button,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0,children:[(0,a.jsx)(n.Text,{style:[pe,R.settingsLangText,{textOverflow:"ellipsis",overflowWrap:"normal"}],numberOfLines:2,children:B},"langLabel"),(0,a.jsx)(c.default,{style:[re,R.settingsIconMarginLeft],size:se,color:ie,icon:g.SkypeIcon.DownChevron,title:xe},"langIcon")]},"captionsSettingslangButton"),(0,a.jsx)(n.View,{style:[R.settingsDivider,de,ge]},"captionsSettingsLangButtonDivider")],Oe=(0,a.jsx)(n.Button,{style:[le,ce],onPress:ee(C.CaptionsPositionMode.float),title:be,accessibilityLabel:be,accessibilityTraits:Ie,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0,children:(0,a.jsx)(c.default,{style:[re],size:se,color:ve?p.Color.blueLight:ie,icon:g.SkypeIcon.PanelFloatingFilled})},"captionsSettingsFloatMode"),Ee=(0,a.jsx)(n.Button,{style:[le,ce],onPress:ee(C.CaptionsPositionMode.bottom),title:we,accessibilityLabel:we,accessibilityTraits:Me,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0,children:(0,a.jsx)(c.default,{style:[re],size:se,color:Pe?p.Color.blueLight:ie,icon:g.SkypeIcon.PanelBottomFilled})},"captionsSettingsBottomMode"),Ne=(0,a.jsx)(n.Button,{style:[le,ce],onPress:ee(C.CaptionsPositionMode.left),title:De,accessibilityLabel:De,accessibilityTraits:ke,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0,children:(0,a.jsx)(c.default,{style:[re],size:se,color:Ae?p.Color.blueLight:ie,icon:g.SkypeIcon.PanelLeftFilled})},"captionsSettingsLeftMode"),Fe=(0,a.jsx)(n.View,{style:[R.settingsDivider,de,ge]},"captionsSettingsDivider"),Ue=te||H?[Be,Oe,Ee,Fe]:[Be,Oe,Ne,Ee,Fe],He=k?(0,a.jsx)(n.Button,{style:[le,ce],onPress:t=>{if(k){const t=T.default.newCauseId();l.default.InCallBotService.setSkypeTranslationPause(e,!x,t)}},title:Re,accessibilityLabel:Re,accessibilityTraits:n.Types.AccessibilityTrait.Button,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0,children:(0,a.jsx)(c.default,{style:[re],size:se,color:x?p.Color.blueLight:ie,icon:g.SkypeIcon.Pause})},"captionsPauseButton"):void 0,je=[R.settingsPanel,undefined,he,me,ue];return L===C.CaptionsPositionMode.float&&je.push(R.settingsPanelPadding),(0,a.jsxs)(n.View,{ref:Q,style:n.Styles.combine(je),onMouseEnter:()=>W(!0),onMouseLeave:()=>W(!1),children:[Ve,Ue,He,(0,a.jsx)(n.Button,{style:[le,ce],onPress:e=>{A?l.default.CallNavigationHelper.navigateToTranslationSettingsPanel(!1,V):k?J():l.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,!0,V)},title:Le,accessibilityLabel:Le,accessibilityTraits:n.Types.AccessibilityTrait.Button,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,tabIndex:0,children:(0,a.jsx)(c.default,{style:[re],size:se,color:ie,icon:g.SkypeIcon.Settings})},"captionsSettingsButton")]})}),(e=>{const{enableNewLanguageSelectors:t,enableNewCallPanel:{enableExperimentalCallControls:i},callTranslatorBotConfig:{languageSupport:{speech:o}}}=r.default.getS4LCMCFeatures();return Object.assign(Object.assign({},e),{languages:o,enableExperimentalCallControls:k.default.isMobileUI()&&i,enableNewLanguageSelectors:t,isMinDesktopWidth:D.default.isMinDesktopWidth(e.rootViewId)})}))},860936:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTransientStateViewType=void 0;const o=i(197582),a=i(785893),n=(i(464291),o.__importStar(i(516778))),s=i(217041),r=o.__importDefault(i(970035)),l=i(26703),c=i(16549),d=i(641400),u=o.__importDefault(i(827361)),h=i(262725);var p;!function(e){e[e.Hold=0]="Hold",e[e.Reconnect=1]="Reconnect"}(p||(t.CallTransientStateViewType=p={}));const g=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),innerContainer:()=>n.Styles.createViewStyle({height:160,width:160,borderRadius:10,paddingHorizontal:20,alignItems:"center",justifyContent:"center",backgroundColor:c.Color.blackOverlay50}),innerContainerIOS:()=>n.Styles.createViewStyle({backgroundColor:c.Color.transparent}),messageHeaderText:()=>n.Styles.createTextStyle({color:c.Color.white,textAlign:"center",backgroundColor:c.Color.transparent,marginTop:8}),messageText:()=>n.Styles.createTextStyle({color:c.Color.white,textAlign:"center",backgroundColor:c.Color.transparent,marginTop:4})});class C extends s.ComponentBase{constructor(){super(...arguments),this._opacityAnimationValue=new n.Animated.Value(0),this._opacityAnimationStyle=n.Styles.createAnimatedViewStyle({opacity:this._opacityAnimationValue})}componentDidMount(){super.componentDidMount(),n.Animated.timing(this._opacityAnimationValue,{duration:200,toValue:1,easing:n.Animated.Easing.Linear()}).start()}render(){const e=[u.default.absoluteFill,g.container,this._opacityAnimationStyle];this.props.style&&e.push(this.props.style);const t=[g.innerContainer,void 0],i=this.props.body?(0,a.jsx)(h.BodyText,{style:g.messageText,allowFontScaling:!1,children:this.props.body}):void 0,o=this.props.type===p.Reconnect?d.SkypeIcon.Connecting:d.SkypeIcon.Pause;let s=(0,a.jsxs)(n.View,{style:t,children:[undefined,(0,a.jsx)(r.default,{icon:o,size:d.IconSize.default,color:c.Color.white}),(0,a.jsx)(h.RowTitle,{style:g.messageHeaderText,allowFontScaling:!1,children:this.props.header}),i]});return this.props.onPress&&(s=(0,a.jsx)(n.Button,{onPress:this.props.onPress,children:s})),(0,a.jsx)(n.Animated.View,{style:e,blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents,children:s})}}t.default=C},510054:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTrayView=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(369347)),l=i(152803),c=i(460515),d=i(26703),u=i(16549),h=o.__importDefault(i(827361)),p=o.__importDefault(i(497910)),g=o.__importDefault(i(924849)),C=i(757293),m=i(712416),S=i(145149),_=o.__importDefault(i(916256)),f=o.__importDefault(i(132680)),y=(0,d.lazyProperties)({reactionsView:()=>h.default.absoluteFill,participantVideoContainer:()=>s.Styles.createViewStyle({width:c.BigTrayCallParticipantMainAxisSize.video,flexGrow:0,flexShrink:0}),participantAudioContainer:()=>s.Styles.createViewStyle({width:c.BigTrayCallParticipantMainAxisSize.audio,flexGrow:0,flexShrink:0}),trayContainer:()=>s.Styles.createViewStyle({position:"absolute",top:c.DesktopNewHeaderHeight,left:0,right:0,backgroundColor:u.Color.transparent,flex:1,flexDirection:"row-reverse",alignSelf:"center",justifyContent:"space-between",borderBottomWidth:8,borderLeftWidth:8,borderRightWidth:8,borderColor:u.Color.transparent,height:c.DesktopTopTrayHeight,alignItems:"stretch"}),trayContainerMobile:()=>s.Styles.createViewStyle({borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,top:0}),trayContainerVertical:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column-reverse",justifyContent:"space-between",backgroundColor:u.Color.transparent,alignItems:"stretch"}),participantsContainer:()=>s.Styles.createViewStyle({flexDirection:"row-reverse",justifyContent:"flex-start",alignSelf:"stretch",flexBasis:0,flexGrow:1}),participantsContainerVertical:()=>s.Styles.createViewStyle({flexDirection:"column-reverse"}),presenterContainer:()=>s.Styles.createViewStyle({flexGrow:0,flexShrink:0,alignSelf:"stretch",flexDirection:"row"}),presenterContainerVertical:()=>s.Styles.createViewStyle({flexDirection:"column"}),participantBackgroundStyle:()=>s.Styles.createViewStyle({backgroundColor:u.Color.callStageLight}),participantBackgroundStyleLightTheme:()=>s.Styles.createViewStyle({backgroundColor:u.Color.gray100Overlay80}),participantViewStyle:()=>s.Styles.createViewStyle({margin:2,borderRadius:2,overflow:"hidden"})});class T extends p.default{constructor(){super(...arguments),this._mountedRefsMap=new g.default,this._onTrayTapBinder=(e,t)=>this.props.onTrayTap&&this.props.onTrayTap(t),this._onTrayTap=()=>this.props.onTrayTap&&this.props.onTrayTap(void 0),this._videoParticipantLayoutController={getStyles:()=>[y.participantVideoContainer],getInnerStyles:()=>[h.default.flexOne],getBackgroundColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,getVideoBorderColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,isHidden:()=>!1},this._audioParticipantLayoutController={getStyles:()=>[y.participantAudioContainer],getInnerStyles:()=>[h.default.flexOne],getBackgroundColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,getVideoBorderColorStyle:e=>e?y.participantBackgroundStyleLightTheme:y.participantBackgroundStyle,isHidden:()=>!1},this._audioParticipantLayoutControllerMobile=Object.assign(Object.assign({},this._audioParticipantLayoutController),{getStyles:()=>[y.participantAudioContainer,this._getParticipantSizeStyle()]}),this._videoParticipantLayoutControllerMobile=Object.assign(Object.assign({},this._audioParticipantLayoutControllerMobile),{getStyles:(e,t,i)=>[h.default.flexOne,y.participantAudioContainer,this._getParticipantSizeStyle()]}),this._layoutController=(e,t,i)=>i?this._videoParticipantLayoutController:this._audioParticipantLayoutController,this._layoutControllerMobile=(e,t,i)=>i?this._videoParticipantLayoutControllerMobile:this._audioParticipantLayoutControllerMobile,this._getCallParticipantAccesoryPosition=()=>this.props.participantsAccessoryPosition?this.props.participantsAccessoryPosition:this.props.useMobileControls?c.CallAccessoryPosition.BottomRightSmallPadding:void 0,this._getContentViewStyles=()=>this.props.participantsViewStyle?this.props.participantsViewStyle:y.participantViewStyle,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e),this._onTrayLayout=e=>{if(this.isComponentMounted()){const t=this.props.showTrayVertically?e.height:e.width;_.default.setTrayParameters(this.props.callId,t,this.props.traySizeMultiplier,this.props.showTrayVertically)}},this._onTrayLayoutDebounced=n.debounce(this._onTrayLayout,150)}_getParticipantSizeStyle(){const{traySizeMultiplier:e=1,showTrayVertically:t=!1}=this.props,i=c.BigTrayCallParticipantMainAxisSize.audio*e;return t?s.Styles.createViewStyle({width:i,height:i},!1):s.Styles.createViewStyle({width:i},!1)}_buildState(e,t){const i=_.default.getTrayElements(e.callId),o=f.default.isInIncomingScreenshareMode(e.stageMode)?r.default.CallScreenShareStore.getPresenter(e.callId):void 0;return{presenter:o,nonPresentingParticipants:n.compact(n.without(i,o)),hiddenParticipantsNumber:_.default.getTrayRemainder(e.callId)}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}_renderTrayParticipant(e){var t;const{traySizeMultiplier:i=1}=this.props;return(0,a.jsx)(l.CallParticipantView,{ref:t=>this._onParticipantViewRef(t,e),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:{offset:0},renderKey:e,isGroupCall:!this.props.isOneOnOneConversation,iconOpacity:1,nametagOpacityStyle:this.props.callParticipantTooltipStyle,parentViewId:"CallTrayView#TrayView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag||i<1,useDarkBackground:!0,desktopNameTag:!0,useLightTheme:this.props.useLightTheme,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,layoutController:this.props.useMobileControls||1!==i||this.props.showTrayVertically?this._layoutControllerMobile:this._layoutController,iconSize:c.BigTrayCallParticipantAvatarSize*i,forceCompactReactions:null!==(t=this.props.showCompactReactions)&&void 0!==t?t:i<1,isInTray:!0,onTap:this._onTrayTapBinder,accessoryPosition:this._getCallParticipantAccesoryPosition(),contentViewStyles:this._getContentViewStyles()},e)}_onParticipantViewRef(e,t){this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderPresenterPart(){return this.state.presenter?(0,a.jsx)(s.View,{style:this._getPresenterContainerStyle(),children:this._renderTrayParticipant(this.state.presenter)},"presenter"):void 0}_renderNonPresentingParticipants(){const e=n.map(this.state.nonPresentingParticipants,(e=>this._renderTrayParticipant(e))),t=this.props.enableRedesignedTrayButton?(0,a.jsx)(S.TrayOverflowButtonV2,{hiddenParticipantsNumber:this.state.hiddenParticipantsNumber,onOverflowButtonPress:this.props.onOverflowButtonPress}):(0,a.jsx)(m.TrayOverflowButton,{hiddenParticipantsNumber:this.state.hiddenParticipantsNumber,onOverflowButtonPress:this.props.onOverflowButtonPress,useLightTheme:this.props.useLightTheme,buttonSizeMultiplier:this.props.traySizeMultiplier,showTrayVertically:this.props.showTrayVertically});return(0,a.jsxs)(s.View,{style:this._getParticipantsContainerStyle(),children:[e,t,(0,a.jsx)(s.View,{style:h.default.flexOne,onPress:this._onTrayTap})]},"nonPresenters")}_renderTray(){const e=[this.props.showTrayVertically?y.trayContainerVertical:y.trayContainer,this._getMobileContainerStyle(),this._getContainerSizeStyle(),this.props.style];return(0,a.jsxs)(s.View,{ref:this._onViewRef,style:e,onLayout:this._onTrayLayoutDebounced,children:[this._renderNonPresentingParticipants(),this._renderPresenterPart()]},"callTray")}_getMobileContainerStyle(){return this.props.useMobileControls?y.trayContainerMobile:void 0}_getContainerSizeStyle(){const{traySizeMultiplier:e=1,showTrayVertically:t=!1}=this.props;return 1===e||t?void 0:s.Styles.createViewStyle({height:c.DesktopTopTrayHeight*e},!1)}_renderReactionView(){return(0,a.jsx)(C.NewCallReactionsView,{reactionsConversationId:this.props.reactionsConversationId,callId:this.props.callId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper},"reactionView")}_getPresenterContainerStyle(){return[y.presenterContainer,...this.props.showTrayVertically?[y.presenterContainerVertical]:[]]}_getParticipantsContainerStyle(){return[y.participantsContainer,...this.props.showTrayVertically?[y.participantsContainerVertical]:[]]}render(){return[this._renderTray(),this._renderReactionView()]}}t.CallTrayView=T},697088:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(460515),r=i(154235),l=o.__importDefault(i(453761)),c=i(26703),d=o.__importStar(i(704704)),u=o.__importDefault(i(942724)),h=o.__importDefault(i(246230)),p=i(16549),g=i(641400),C=i(331079),m=i(262725),S=o.__importDefault(i(497910)),_=i(483753),f=o.__importDefault(i(340724)),y=(o.__importDefault(i(827361)),o.__importDefault(i(95114))),T=i(520539),b=g.IconSize.size20,v=r.CompositeNotificationToastInfo.horizontal,I=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:v,paddingVertical:r.CompositeNotificationToastInfo.vertical}),containerStack:()=>n.Styles.createViewStyle({backgroundColor:p.Color.transparent}),containerComposite:()=>n.Styles.createViewStyle({backgroundColor:p.Color.transparent,paddingRight:20}),textContainerComposite:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textComposite:()=>n.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),buttonTextComposite:()=>n.Styles.createTextStyle({marginLeft:4}),blueText:()=>n.Styles.createTextStyle({color:p.Color.sxBlue})});class w extends S.default{constructor(){super(...arguments),this._onLearnMorePress=()=>{h.default.showDeniedPromptWithSettingsOption(C.PermissionType.Camera,this._getRootViewId())},this._onClosePress=()=>{this.props.closeToast(s.ToastActionType.ManualDismissed)},this._onLayout=e=>{e.width!==this.state.containerWidth&&this.setState({containerWidth:e.width})}}_buildState(e,t){const i={isUsingStackNavigationContext:u.default.isUsingStackNavigationContext()};return t&&(i.containerWidth=0),i}render(){let e,t;const i=[this._themeStyles.primaryTextColorStyle],o=[this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:I.blueText];this.state.isUsingStackNavigationContext?(e=n.Styles.createViewStyle({maxWidth:this.state.containerWidth-b-v-4},!1),t=I.containerStack,i.push(T.CommonToastStyles.titleStyle),o.push(T.CommonToastStyles.titleStyle)):(e=I.textContainerComposite,t=I.containerComposite,i.push(I.textComposite),o.push(I.textComposite,I.buttonTextComposite));const s=d.getString("AudioVideoSettings.LearnMore"),r=f.default.linkAccessibilityInfo(s);return(0,a.jsxs)(n.View,{style:[I.container,t],onLayout:this._onLayout,children:[(0,a.jsxs)(n.View,{style:e,children:[(0,a.jsx)(m.BodyText,{style:i,bold:!1,children:d.getString("AudioVideoSettings.CameraDeniedBannerSuggestion")}),(0,a.jsx)(n.View,{accessibilityLabel:r.label,accessibilityTraits:r.traits,importantForAccessibility:void 0,style:o,onPress:void 0,children:(0,a.jsx)(m.Caption,{style:y.default.subtitleMediumSemiLarge,children:this._getPrivacyLink(s)})})]}),(0,a.jsx)(l.default,{icon:g.SkypeIcon.ClosePanel,size:b,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:d.getString("Global.CloseButtonTitle"),onPress:this._onClosePress})]})}_getPrivacyLink(e){return(0,a.jsx)(_.AccessibleLink,{url:"#",textElement:m.Caption,correctiveMargin:-3,children:e},"videoLearnMore")}}t.default=w},802791:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(198243)),s=o.__importStar(i(516778)),r=i(217041),l=o.__importDefault(i(150343)),c=o.__importDefault(i(306794)),d=i(815146),u=o.__importDefault(i(151398)),h=o.__importStar(i(85385)),p=i(26703),g=o.__importDefault(i(597285)),C=i(331079),m=o.__importDefault(i(827361)),S=o.__importDefault(i(601274)),_=(0,p.lazyProperties)({reactionContainer:()=>[m.default.absoluteFill,m.default.flexOne],animationStyle:()=>s.Styles.createViewStyle({position:"absolute",top:0,bottom:0,overflow:"visible",alignSelf:"center",alignContent:"center"})});class f extends r.ComponentBase{constructor(){super(...arguments),this._isAnimationPlaying=!1,this._reactionKey="",this._animationTimeout=0,this._onAEAnimationRef=e=>{this._aeAnimatedView=e||void 0},this._startAnimation=()=>{this._aeAnimatedView&&!this._isAnimationPlaying&&(h.log(d.LogTraceArea.CallReactions,"CelebrationAnimationView._startAnimation"),this._isAnimationPlaying=!0,this._aeAnimatedView.play(),c.default.setAnimationIsPlaying(this._isAnimationPlaying),this._animationTimeout=S.default.setTimeout((()=>{this.props.onAnimationOut&&this.props.onAnimationOut(),this._isAnimationPlaying=!1,c.default.setAnimationIsPlaying(this._isAnimationPlaying),this.isComponentMounted()&&this.setState({shouldRenderAEAnimationView:!1})}),this.state.animationTimeoutInMs))},this._resetAnimation=()=>{h.log(d.LogTraceArea.CallReactions,"CelebrationAnimationView._resetAnimation"),this._aeAnimatedView&&this._aeAnimatedView.reset()}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutOff;let o=t?void 0:this.state.animationReactionInfo,a=!t&&this.state.shouldRenderAEAnimationView,n=!1;const s=l.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsTimeoutsinMs;let r=s.default;const d=c.default.getLastReaction(e.callId,i);if(!this._isAnimationPlaying&&d){const e=g.default.callReactionInfoForReaction(d);if(this._reactionKey=this._getReactionKey(e),(e.reactionsTextStyle===C.ReactionsTextStyle.Animation||this._isNewAnimatedReaction(e))&&(n=!0,t||this._didReceiveNewAnimation(o,e))){o=e;const t=this._reactionKey;a=!0,t&&s[t]&&(r=s[t])}}return{reactionsCutOff:i,animationTimeoutInMs:r,animationReactionInfo:o,shouldRenderAEAnimationView:a,isReactionNewAnimation:n}}_isNewAnimatedReaction(e){return(null==e?void 0:e.reactionsTextStyle)===C.ReactionsTextStyle.Default&&g.default.isSuperAnimationReaction(this._reactionKey)}_getReactionKey(e){return(null==e?void 0:e.reaction.getEmoticonCallReactionKey())||""}componentWillUnmount(){h.log(d.LogTraceArea.CallReactions,"CelebrationAnimationView.componentWillUnmount"),super.componentWillUnmount(),S.default.clearTimeout(this._animationTimeout),this._resetAnimation(),this.props.onAnimationOut&&this.props.onAnimationOut()}componentDidMount(){h.log(d.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidMount"),super.componentDidMount(),this.state.animationReactionInfo&&this._startAnimation()}_didReceiveNewAnimation(e,t){let i=!1;return t&&(e?t.reaction.createdTime>e.reaction.createdTime&&t.reaction.cuid!==e.reaction.cuid&&(i=!0):i=!0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=this._didReceiveNewAnimation(t.animationReactionInfo,this.state.animationReactionInfo);h.log(d.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidUpdate CallReactionsStore.isAnimationPlaying() "+c.default.isAnimationPlaying()+"; shouldUpdateAnimation "+o),o&&(this._resetAnimation(),this._startAnimation())}shouldComponentUpdate(){return!c.default.isAnimationPlaying()}render(){let e;if(this.state.shouldRenderAEAnimationView&&this.state.animationReactionInfo&&this.state.isReactionNewAnimation){const t=g.default.animationInfoForKey(this.state.animationReactionInfo.content||this._reactionKey,!0);if(t){let i=[m.default.absoluteFill,m.default.flexOne];{const e=s.Styles.createViewStyle({width:t.intrinsicSize.width,height:this.props.height},!1);i=[_.animationStyle,e]}const o=u.default.getAssetSourceWithColor(t);e=(0,a.jsx)(n.default,Object.assign({},o,{style:i,source:t.source,ref:this._onAEAnimationRef}))}}return(0,a.jsx)(s.Animated.View,{style:_.reactionContainer,blockPointerEvents:!0,ignorePointerEvents:!0,children:e})}}t.default=f},344562:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(484591)),r=o.__importDefault(i(369347)),l=o.__importDefault(i(60433)),c=o.__importDefault(i(758117)),d=i(154235),u=o.__importDefault(i(68210)),h=i(815146),p=o.__importStar(i(85385)),g=i(26703),C=i(16549),m=o.__importDefault(i(827361)),S=o.__importDefault(i(497910)),_=(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:d.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:C.Color.blue})});class f extends S.default{_buildState(e,t){const i={},o=u.default.getToast(e.toastId);if(o&&o.state){const e=o.state,t=e.callId;i.callId=t,i.callState=r.default.CallingStore.getCallState(t),i.audioOnlyEnabled=r.default.CallingStore.isAudioOnly(t),i.callNetworkQualityPoor=(0,c.default)().isCallQualityPoor(t),i.conversationMri=e.conversationMri}return i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=this.state.callState&&l.default.isCallStateActive(this.state.callState)&&!l.default.isCallStateOnHold(this.state.callState);(this.state.audioOnlyEnabled||this.state.callNetworkQualityPoor)&&o||(p.log(h.LogTraceArea.CallingUI,"CompositeCallConnectionQualityToast.componentDidUpdate removing toast"),u.default.removeToast(this.props.toastId))}render(){return(0,a.jsx)(n.View,{style:_.container,children:(0,a.jsx)(s.default,{callId:this.state.callId,conversationMri:this.state.conversationMri,containerStyle:[_.metadataContainer,m.default.flexNegativeOne],iconColor:this._themeColors.headerIconColor,textStyle:[_.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:_.linkStyle})})}}t.default=f},521691:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalCompositeCallMediaCapturerToast=t.RemoteCompositeCallMediaCapturerToast=void 0;const o=i(197582),a=i(785893),n=i(217041),s=i(148540),r=o.__importDefault(i(369347)),l=o.__importDefault(i(60433)),c=o.__importDefault(i(68210)),d=o.__importDefault(i(912201)),u=i(307293),h=o.__importDefault(i(497910)),p=i(641400);class g extends h.default{constructor(){super(...arguments),this._shouldToastBeRemoved=e=>!this.state.callId||e!==s.CallState.Connected||!this.state.initiatorMri||!r.default.CallingStore.isCallMediaCaptured(this.state.callId,this.state.initiatorMri)}_buildState(e,t){const i=c.default.getToast(e.toastId);let o,a;if(i&&i.state){const e=i.state;a=e.callId,o=e.initiatorMri}return{initiatorMri:o,callId:a}}render(){const e=[{icon:p.SkypeIcon.CallRemoteNdiRecord,color:this._themeColors.headerIconColor}];return(0,a.jsx)(u.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldToastBeRemoved,icons:e})}}t.RemoteCompositeCallMediaCapturerToast=g;class C extends n.ComponentBase{constructor(){super(...arguments),this._getTimeStamp=()=>{},this._onStopPress=(e,t)=>{d.default.setNdiEnabled(!1)},this._shouldToastBeRemoved=e=>{const t=l.default.isCallStateActive(e)&&!l.default.isCallStateOnHold(e);return!d.default.isNdiEnabled()||!t}}render(){return(0,a.jsx)(u.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel",shouldToastBeRemoved:this._shouldToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp})}}t.LocalCompositeCallMediaCapturerToast=C},475935:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(736667)),l=i(460515),c=i(16549),d=i(729827),u=i(73018),h=o.__importDefault(i(453761)),p=i(641400),g=o.__importStar(i(85385)),C=o.__importDefault(i(54945)),m=i(26703),S=o.__importStar(i(704704)),_=o.__importDefault(i(740794)),f=o.__importDefault(i(10966)),y=o.__importDefault(i(150343)),T=34,b=12,v=(0,m.lazyProperties)({drawerContainer:()=>s.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"center"}),drawer:()=>s.Styles.createViewStyle({width:52,borderRadius:26,backgroundColor:c.Color.whiteOverlay70}),containerMobile:()=>s.Styles.createViewStyle({bottom:5,right:15}),innerContainer:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",paddingTop:6,backgroundColor:c.Color.transparent}),closeButtonContainer:()=>s.Styles.createViewStyle({position:"relative"}),customizeReactionButtonContainer:()=>s.Styles.createViewStyle({position:"relative"}),closeButton:()=>s.Styles.createViewStyle({width:T,height:T,borderRadius:17,marginTop:6,marginHorizontal:9,alignItems:"center",backgroundColor:c.Color.gray400Overlay10}),customizeReactionButton:()=>s.Styles.createViewStyle({width:T,height:T,alignItems:"center",marginTop:6,marginHorizontal:9}),customCallReactionsButtonForNarrowView:()=>s.Styles.createViewStyle({width:T,height:T,alignItems:"center",borderRadius:17,marginHorizontal:9,marginVertical:5}),minContainer:()=>s.Styles.createViewStyle({position:"absolute",right:10,bottom:95}),container:()=>s.Styles.createViewStyle({position:"absolute",right:80,bottom:24}),divider:()=>s.Styles.createViewStyle({position:"relative",flex:1,marginVertical:6,marginHorizontal:10,height:1,flexDirection:"row",opacity:.3,backgroundColor:c.Color.blackOverlay35})});class I extends r.default{constructor(){super(...arguments),this._animatedHeightValue=new s.Animated.Value(0),this._animatedOpacityValue=new s.Animated.Value(0),this._animatedContainerStyle=s.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=s.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onCloseButtonPress=()=>{this.closeDrawer()},this._onCustomizeReactionsButton=()=>{_.default.navigateToCustomReactionsPanel(d.CustomReactionsType.Call,this.props.rootViewId),g.track(new u.CustomReactionsManipulationTelemetry(u.CustomReactionsManipulationAction.CustomReactionsPanelOpened,{customReactionsType:d.CustomReactionsType.Call}))},this._onMouseLeave=()=>{this.state.isOpen&&this.props.drawerOpenedOnHover&&this.closeDrawer()},this._onKeyPress=e=>!(!this.isComponentMounted()||e.keyCode!==C.default.ESCAPE||!this.state.isOpen)&&(this.closeDrawer(),!0),this._onContainerRef=e=>{this._container=e||void 0}}_positionDrawer(e,t){const i=t.isOpen,o=this._getDrawerHeight(t.reactions.length),a=i?o:0,n=i?1:0;if(this._onPositionDrawer(e,t),this._animatedHeightValue&&this._animatedOpacityValue)if(e){const e=s.Animated.timing(this._animatedHeightValue,{toValue:a,easing:s.Animated.Easing.Linear(),duration:i?I.heightAnimationDurationOnOpen:I.heightAnimationDurationOnClose}),t=s.Animated.timing(this._animatedOpacityValue,{toValue:n,easing:s.Animated.Easing.Linear(),duration:i?I.opacityAnimationDurationOnOpen:I.opacityAnimationDurationOnClose});let o,r;i?(o=e,r=t):(o=t,r=e),this._drawerAnimation=o,this._drawerAnimation.start((()=>{this._drawerAnimation=r,this._drawerAnimation.start((()=>{this._onPositionDrawerAnimationCompleted()}))}))}else this._animatedHeightValue.setValue(a),this._animatedOpacityValue.setValue(n)}_renderReactionViews(e){return n.compact(e)}_getDrawerHeight(e){let t=44*e+b;return this.props.showCustomizeReactionsButton&&(t+=53),this.props.drawerOpenedOnHover||(t+=46,y.default.getS4LMessagingFeaturesNoSubscription().enableReactionBarExperienceFixInNarrowView&&(t+=46)),t}_renderCloseButton(){if(this.props.controlsType!==l.CallControlsType.Mobile&&!this.props.drawerOpenedOnHover)return(0,a.jsx)(s.View,{ignorePointerEvents:!0,style:v.closeButtonContainer,children:(0,a.jsx)(h.default,{icon:p.SkypeIcon.DownChevron,style:v.closeButton,size:p.IconSize.size20,color:c.Color.gray400,hoverColor:c.Color.gray400,onPress:this._onCloseButtonPress,title:void 0,accessibilityLabel:S.getString("ReactionsStream.ReactionBarCloseDrawerTitle")})})}_renderCustomizeReactionsButton(){if(this.props.showCustomizeReactionsButton)return(0,a.jsxs)(s.View,{ignorePointerEvents:!0,style:v.customizeReactionButtonContainer,children:[(0,a.jsx)(h.default,{icon:p.SkypeIcon.EmojiAdd,style:v.customizeReactionButton,size:p.IconSize.size32,color:c.Color.gray400,hoverColor:c.Color.gray400,onPress:this._onCustomizeReactionsButton,title:S.getString("ReactionsPanel.CustomCallReactionsTitle"),accessibilityLabel:S.getString("ReactionsPanel.CustomCallReactionsTitle")}),(0,a.jsx)(s.View,{style:v.divider})]})}_renderCustomizeReactionsButtonForNarrowView(){if(y.default.getS4LMessagingFeaturesNoSubscription().enableReactionBarExperienceFixInNarrowView&&!this.props.drawerOpenedOnHover)return g.track(new u.CustomReactionsManipulationTelemetry(u.CustomReactionsManipulationAction.CustomReactionsButtonInNarrowViewShown,{customReactionsType:d.CustomReactionsType.Call})),(0,a.jsx)(f.default,{styles:v.customCallReactionsButtonForNarrowView,iconSize:p.IconSize.size20,origin:d.CustomReactionsType.Call,isInNarrowView:!0,optionalReactionBarClose:this._onCloseButtonPress})}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);this.state.isOpen!==t.isOpen&&this._resetFocus(this.state.isOpen)}_resetFocus(e){this._container&&this._container.setFocusRestricted(e)}componentDidMount(){super.componentDidMount(),this.state.isOpen||this._resetFocus(!1)}render(){const e=this.props.controlsType===l.CallControlsType.DesktopMinSmallest,t=[v.drawer];this._animatedContainerStyle&&t.push(this._animatedContainerStyle);const i=this._getDrawerHeight(this.state.reactions.length),o=s.Styles.createViewStyle({height:i},!1);let n;n=e?v.minContainer:v.container;const r=[o,n],c=[v.innerContainer];let d;this._animatedInnerContainerStyle&&c.push(this._animatedInnerContainerStyle),this.props.controlsType===l.CallControlsType.Mobile&&r.push(v.containerMobile),this.state.isOpen&&(d=this._renderCloseButton());const u=this._renderCustomizeReactionsButton();return(0,a.jsx)(s.View,{style:r,onKeyPress:this._onKeyPress,onMouseLeave:this._onMouseLeave,restrictFocusWithin:!0,ref:this._onContainerRef,children:(0,a.jsx)(s.View,{style:v.drawerContainer,ignorePointerEvents:!0,children:(0,a.jsx)(s.Animated.View,{style:t,ignorePointerEvents:!0,children:(0,a.jsxs)(s.Animated.View,{style:c,ignorePointerEvents:!0,children:[u,this._renderContent(),this._renderCustomizeReactionsButtonForNarrowView(),d]})})})})}}I.heightAnimationDurationOnOpen=150,I.opacityAnimationDurationOnOpen=150,I.heightAnimationDurationOnClose=50,I.opacityAnimationDurationOnClose=50,t.default=I},708213:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(369347)),s=o.__importDefault(i(60433)),r=o.__importDefault(i(68210)),l=i(307293),c=o.__importDefault(i(497910)),d=i(16549),u=i(641400);class h extends c.default{constructor(){super(...arguments),this._onStopPress=(e,t)=>{n.default.InCallBotService.stopRecording(e,t)},this._getTimeStamp=()=>n.default.CallingStore.getCallRecordingTimestamp(this.state.callId),this._shouldLocalToastBeRemoved=e=>!this.state.callId||!n.default.CallingStore.isRecording(this.state.callId)||!s.default.isCallStateActive(e),this._shouldRemoteToastBeRemoved=()=>!n.default.CallingStore.isRecording(this.state.callId)}_buildState(e,t){const i=r.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId,t=this.state&&this.state.initiatorMri?this.state.initiatorMri:n.default.CallingStore.getCallRecordingInitiator(e);return{initiatorMri:t,callId:e,isLocalInitiator:n.default.InCallBotUtils.isCallRecordingInitiator(t)}}return{}}render(){if(this.state.initiatorMri&&this.state.isLocalInitiator)return(0,a.jsx)(l.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable",shouldToastBeRemoved:this._shouldLocalToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp});const e=[{icon:u.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:u.SkypeIcon.CallRecordDot,color:d.Color.red}];return(0,a.jsx)(l.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotificationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldRemoteToastBeRemoved,icons:e})}}t.default=h},146568:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(369347)),s=o.__importDefault(i(60433)),r=i(460515),l=o.__importDefault(i(697088)),c=o.__importDefault(i(68210)),d=o.__importDefault(i(497910));class u extends d.default{constructor(){super(...arguments),this._closeToast=e=>{c.default.removeToast(this.props.toastId,e)}}_buildState(e,t){const i=c.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);!!this.state.callState&&s.default.isCallStateActive(this.state.callState)||this._closeToast(r.ToastActionType.AutoDismissed)}render(){return(0,a.jsx)(l.default,{closeToast:this._closeToast,colorThemeOverride:this.props.colorThemeOverride})}}t.default=u},23829:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(60433)),l=i(460515),c=i(154235),d=o.__importDefault(i(68210)),u=i(815146),h=o.__importDefault(i(200020)),p=o.__importStar(i(85385)),g=i(26703),C=i(641400),m=o.__importDefault(i(497910)),S=(0,g.lazyProperties)({metadataContainer:()=>n.Styles.createViewStyle({paddingHorizontal:c.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word"})});class _ extends m.default{constructor(){super(...arguments),this._dismiss=e=>{p.log(u.LogTraceArea.CallingUI,"CompositeGeneralPurposeInCallToast._dismiss type: "+this.props.toastType),d.default.removeToast(this.props.toastId,e),this.props.onDismiss&&e===l.ToastActionType.ManualDismissed&&this.props.onDismiss()},this._onManualDismiss=()=>{this._dismiss(l.ToastActionType.ManualDismissed)}}_buildState(e,t){const i=d.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,o=e.conversationMri;return{callId:t,callState:s.default.CallingStore.getCallState(t),conversationMri:o}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);!!this.state.callState&&r.default.isCallStateActive(this.state.callState)||this._dismiss(l.ToastActionType.AutoDismissed)}render(){return(0,a.jsx)(h.default,{toastType:this.props.toastType,containerStyle:S.metadataContainer,textStyle:[S.notificationTextStyle,this._themeStyles.headerTextColorStyle],onDismiss:this._onManualDismiss,conversationMri:this.state.conversationMri,iconColor:this._themeColors.headerIconColor,iconSize:C.IconSize.size20,callId:this.state.callId})}}t.default=_},407652:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=i(26178),l=o.__importDefault(i(369347)),c=i(843890),d=o.__importStar(i(44717)),u=i(154235),h=o.__importDefault(i(68210)),p=o.__importDefault(i(848822)),g=o.__importDefault(i(601976)),C=i(815146),m=o.__importDefault(i(560099)),S=o.__importDefault(i(305931)),_=o.__importStar(i(85385)),f=o.__importDefault(i(97595)),y=i(26703),T=o.__importStar(i(704704)),b=o.__importDefault(i(827361)),v=o.__importDefault(i(206315)),I=i(262725),w=i(206197),P=o.__importDefault(i(266872)),M=i(596648),D=(0,y.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:u.CompositeNotificationToastInfo.horizontal,paddingVertical:u.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),userIcon:()=>n.Styles.createViewStyle({marginRight:10}),callButtonsContainer:()=>n.Styles.createViewStyle({justifyContent:"center"})});class A extends s.ComponentBase{constructor(){super(...arguments),this._onComponentRef=e=>{this._view=e||void 0},this._getIncomingCallStrings=()=>{let e;e=this.state.isEncrypted?{message:T.getString("CallBanner.IncomingCallEncryptedCaption"),accessibilityLabel:T.getString("CallBanner.IncomingCallEncryptedAccessibilityLabel",{callerName:this.state.callerDisplayName})}:d.isGroupConversation(this.state.conversationMri)?{message:T.getString("CallBanner.IncomingCallGroupCaption",{callerName:this.state.callerDisplayName}),accessibilityLabel:T.getString("CallBanner.IncomingCallGroupAccessibilityLabel",{groupName:this.state.conversationDisplayName,callerName:this.state.callerDisplayName})}:{message:T.getString("CallBanner.IncomingCallOneOnOneCaption"),accessibilityLabel:T.getString("CallBanner.IncomingCallOneOnOneAccessibilityLabel",{callerName:this.state.callerDisplayName})};{const t=f.default.shortcutListItemForShortcut(C.KeyboardShortcut.AcceptIncomingCall),i=f.default.shortcutListItemForShortcut(C.KeyboardShortcut.HangupOrRejectCall);if(t&&i){const o=T.getString("CallBanner.KeyboardShortcutAccessibilityLabel",{acceptCall:t.command,rejectCall:i.accessibleCommand});e.accessibilityLabel=T.getString("CallBanner.IncomingCallAccessibilityLabelWithKeyboardShortcut",{incomingCall:e.accessibilityLabel,keyboardShortcut:o})}}return e}}_buildState(e){const t=h.default.getToast(e.id);if(t){let e;e=P.default.isDarkTheme()?w.Theme.Colorful:w.Theme.ColorfulDark;const i=l.default.CallingStore.getConnectedAndNotOnHoldCallId(),o=t.state,a=l.default.CallingStore.isEncryptedCall(o.callId),n=l.default.CallingStore.isPSTNCall(o.callId),s=l.default.CallingFeaturesHelper.allowMergeCall({isEncryptedCall:a,isPSTNCall:n,conversationMri:o.conversationMri,callId:o.callId,connectedCallId:i});return{callId:o.callId,conversationMri:o.conversationMri,callerMri:o.callerMri,isCallIncoming:l.default.CallingStore.isCallIncoming(o.callId),callerDisplayName:g.default.getDisplayName(o.callerMri),conversationDisplayName:g.default.getDisplayName(o.conversationMri),connectedToAnotherCall:!!i&&i!==o.callId,themeOverride:e,isEncrypted:a,isPSTN:n,hasAnsweredCallLocally:l.default.CallingStore.hasAnsweredCallLocally(o.callId),callDidExist:l.default.CallingStore.callDidExist(o.callId),isMergePossible:s,callMergeSupported:c.CallingCapabilities.callMergeSupported()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._shouldIgnore()&&(_.log(C.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidUpdate removing toast for callId: "+this.state.callId),h.default.removeToast(this.props.id))}componentDidMount(){super.componentDidMount(),this._shouldIgnore()&&(_.log(C.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidMount removing toast for callId: "+this.state.callId),h.default.removeToast(this.props.id)),this._view&&this._view.requestFocus(),this.state.connectedToAnotherCall&&n.Accessibility.announceForAccessibility(this.state.isMergePossible?T.getString("CallBanner.IncomingCallMergeCallWarning"):T.getString("CallBanner.IncomingCallMultiCallWarning"))}_shouldIgnore(){return!this.state.isCallIncoming||this.state.hasAnsweredCallLocally||this.state.callDidExist}renderCallControls(){return(0,a.jsx)(S.default,{conversationMri:this.state.conversationMri,callId:this.state.callId,forMobile:!1,isEncryptedCall:!!this.state.isEncrypted,isPSTNCall:!!this.state.isPSTN,buttonSize:r.CallButtonSize.Small,colorThemeOverride:this.state.themeOverride,showMergeButton:this.state.connectedToAnotherCall&&this.state.callMergeSupported,isMergePossible:this.state.isMergePossible})}render(){if(this._shouldIgnore())return null;const e=v.default.themeStylesForTheme(this.state.themeOverride),t=this.state.isMergePossible?T.getString("CallBanner.IncomingCallMergeCallWarning"):T.getString("CallBanner.IncomingCallMultiCallWarning"),i=this.state.connectedToAnotherCall?(0,a.jsx)(I.Caption,{style:e.headerTextColorStyle,children:t}):void 0,o=this._getIncomingCallStrings();return(0,a.jsxs)(n.View,{style:[D.container,e.buttonBackgroundColorStyle],ref:this._onComponentRef,tabIndex:0,accessibilityLabel:o.accessibilityLabel,children:[(0,a.jsxs)(n.View,{style:[D.metadataContainer,b.default.flexNegativeOne],children:[(0,a.jsx)(m.default,{style:D.userIcon,children:(0,a.jsx)(p.default,{size:M.ConversationIconSize.Size40,conversationId:this.state.conversationMri})}),(0,a.jsxs)(n.View,{style:b.default.flexNegativeOne,children:[(0,a.jsx)(I.BodyText,{bold:!0,style:[b.default.flexNegativeOne,e.primaryTextColorStyle],numberOfLines:1,children:this.state.conversationDisplayName}),(0,a.jsx)(I.Caption,{style:[b.default.flexNegativeOne,e.secondaryTextColorStyle],children:o.message}),i]})]}),(0,a.jsx)(n.View,{style:D.callButtonsContainer,children:this.renderCallControls()})]})}}t.default=A},136917:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToastHeight=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(60433)),l=i(154235),c=o.__importDefault(i(68210)),d=i(815146),u=o.__importDefault(i(532747)),h=o.__importStar(i(85385)),p=i(26703),g=i(16549),C=o.__importDefault(i(827361)),m=o.__importDefault(i(497910)),S=o.__importDefault(i(132680));t.ToastHeight=40;const _=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:l.CompositeNotificationToastInfo.vertical,height:t.ToastHeight}),metadataContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:g.Color.blue})});class f extends m.default{_buildState(e,t){const i=c.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:s.default.CallingStore.getCallState(e),shouldBeRemoved:!S.default.isIncomingVideoDisabled(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=this.state.callState&&r.default.isCallStateActive(this.state.callState)&&r.default.isCallStateOnHold(this.state.callState);!this.state.shouldBeRemoved&&o||(h.log(d.LogTraceArea.CallingUI,"CompositeIncomingVideoDisabledToast.componentDidUpdate removing toast"),c.default.removeToast(this.props.toastId))}render(){return(0,a.jsx)(n.View,{style:[_.container],children:(0,a.jsx)(u.default,{callId:this.state.callId,containerStyle:[_.metadataContainer,C.default.flexNegativeOne],textStyle:[_.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:_.linkStyle})})}}f.height=t.ToastHeight,t.default=f},652162:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(266872)),l=i(460515),c=i(154235),d=o.__importDefault(i(68210)),u=i(815146),h=o.__importDefault(i(453761)),p=o.__importDefault(i(970035)),g=o.__importStar(i(85385)),C=i(26703),m=o.__importStar(i(704704)),S=o.__importDefault(i(660401)),_=i(16549),f=i(641400),y=i(262725),T=o.__importDefault(i(497910)),b=o.__importDefault(i(601274)),v=o.__importDefault(i(760989)),I=f.IconSize.size20,w=(0,C.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:10}),contentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textComposite:()=>n.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),avSettingsLinkStyle:()=>n.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word",marginLeft:4,color:_.Color.sxBlue}),buttonContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingLeft:10}),buttonStyle:()=>n.Styles.createButtonStyle({paddingLeft:10})});class P extends T.default{constructor(){super(...arguments),this._onCloseButtonPress=e=>{d.default.removeToast(this.props.toastId,l.ToastActionType.ManualDismissed)},this._onAVSettingsLinkPress=e=>{const t=v.default.newCauseId();g.log(u.LogTraceArea.Navigation,"CompositeNotificationToast._onAVSettingsLinkPress causeId: "+t),s.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),t),d.default.removeToast(this.props.toastId,l.ToastActionType.Actioned)}}_buildState(e){const t=d.default.getToast(e.toastId);if(t&&t.state){const e=t.state;return{notificationText:e.notificationText,showAvSettingsLink:e.showAvSettingsLink,timeout:e.buttons?void 0:e.timeout,icon:e.icon,isDarkTheme:r.default.isDarkTheme(),buttons:e.buttons}}return{}}_getIcon(){if(this.state.icon)return(0,a.jsx)(p.default,{icon:this.state.icon,size:f.IconSize.size24,color:this._themeColors.headerIconColor})}render(){const e=this._getIcon(),t=this.state.notificationText,i=this.state.showAvSettingsLink?(0,a.jsx)(y.BodyText,{style:w.avSettingsLinkStyle,onPress:this._onAVSettingsLinkPress,children:m.getString("DesktopProfileMenu.AudioVideoSettingsTitle")}):void 0,o=this.state.buttons?(0,a.jsx)(n.View,{style:w.buttonContainer,children:this.state.buttons.map((e=>(0,a.jsx)(S.default,{style:w.buttonStyle,buttonStyle:this.state.isDarkTheme?c.SXButtonStyle.LightFill:void 0,buttonSize:c.SXButtonSize.Small,title:m.getString(e.labelKey),onPress:e.callback})))}):void 0,s=[this._themeStyles.headerTextColorStyle,w.textComposite];return(0,a.jsxs)(n.View,{style:w.container,children:[e,(0,a.jsxs)(n.View,{style:w.contentContainer,children:[(0,a.jsx)(y.BodyText,{style:s,children:t}),i,o]}),(0,a.jsx)(h.default,{icon:f.SkypeIcon.ClosePanel,size:I,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:m.getString("Global.CloseButtonTitle"),onPress:this._onCloseButtonPress})]})}componentDidMount(){super.componentDidMount(),this.state.timeout&&(this._timeoutId=b.default.setTimeout((()=>{d.default.removeToast(this.props.toastId,l.ToastActionType.AutoDismissed),this._timeoutId=void 0}),this.state.timeout))}componentWillUnmount(){super.componentWillUnmount(),this._timeoutId&&(b.default.clearTimeout(this._timeoutId),this._timeoutId=void 0)}}t.default=P},958321:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(60433)),l=i(154235),c=o.__importDefault(i(68210)),d=i(815146),u=o.__importStar(i(85385)),h=i(26703),p=i(16549),g=i(641400),C=o.__importDefault(i(157786)),m=o.__importDefault(i(497910)),S=(0,h.lazyProperties)({metadataContainer:()=>n.Styles.createViewStyle({paddingHorizontal:l.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word"}),linkStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:p.Color.blue})});class _ extends m.default{constructor(){super(...arguments),this._dismiss=()=>{u.log(d.LogTraceArea.CallingUI,"CompositeTranslationInCallToast._dismiss"),c.default.removeToast(this.props.toastId)}}_buildState(e,t){const i=c.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,o=e.conversationMri;return{callId:t,callState:s.default.CallingStore.getCallState(t),conversationMri:o}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);this.state.callState&&r.default.isCallStateActive(this.state.callState)&&r.default.isCallStateOnHold(this.state.callState)||this._dismiss()}render(){return(0,a.jsx)(C.default,{containerStyle:S.metadataContainer,textStyle:[S.notificationTextStyle,this._themeStyles.headerTextColorStyle],callId:this.state.callId,linkStyle:S.linkStyle,iconColor:this._themeColors.headerIconColor,iconSize:g.IconSize.size20,onDismiss:this._dismiss,conversationMri:this.state.conversationMri})}}t.default=_},716854:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({toastId:e,callId:t,onDismiss:i}){return(0,a.jsx)(r.RemotePrivacyToastComponent,{id:e,notificationTextPath:"VideoDisabledToast.VideoDisabled",initialNotificationTextPath:"VideoDisabledToast.VideoDisabled",startedAccessibilityLabelTextPath:"VideoDisabledToast.VideoDisabled",stoppedAccessibilityLabelTextPath:"VideoDisabledToast.VideoDisabled",shouldToastBeRemoved:e=>{const i=d.default.CallingStore.getListOfBlockedVideoFeedParticipantsIds(t).length;return u.Instrumentation.log(s.LogTraceArea.CallingUI,`[CompositeVideoRestrictedToast][shouldToastBeRemoved] callState: ${e} blocked video feed participants count: ${i}`),e!==n.CallState.Connected||0===i},icons:h,onDismiss:i})};const o=i(197582),a=i(785893),n=i(148540),s=i(167606),r=i(307293),l=i(16549),c=i(641400),d=o.__importDefault(i(369347)),u=i(82485),h=[{icon:c.SkypeIcon.VideoOff,color:l.Color.red}]},651843:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DTMFDialpad=void 0;const o=i(197582),a=i(785893),n=i(174958),s=o.__importStar(i(496486)),r=o.__importStar(i(516778)),l=i(217041),c=o.__importDefault(i(369347)),d=o.__importDefault(i(988773)),u=o.__importDefault(i(477069)),h=o.__importStar(i(236530)),p=i(815146),g=o.__importDefault(i(453761)),C=o.__importStar(i(85385)),m=o.__importDefault(i(114818)),S=i(26703),_=o.__importStar(i(704704)),f=i(16549),y=o.__importDefault(i(139221)),T=o.__importDefault(i(20758)),b=i(641400),v=o.__importDefault(i(760989)),I=i(240265),w=(0,S.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:f.Color.transparent}),dialpadContainer:()=>r.Styles.createViewStyle({flex:1,backgroundColor:f.Color.transparent}),inputDisplayContainer:()=>r.Styles.createViewStyle({flexDirection:"row",height:60,alignSelf:"stretch",justifyContent:"center",paddingLeft:12}),inputDisplayContainerDesktop:()=>r.Styles.createViewStyle({alignSelf:"stretch"}),inputDisplayInnerContainer:()=>r.Styles.createScrollViewStyle({flex:1,backgroundColor:f.Color.transparent}),inputDisplayInnerContainerRTL:()=>r.Styles.createScrollViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),inputTextDisplay:()=>r.Styles.createTextStyle({color:f.Color.white,fontSize:T.default.controlFontSize.dialpadInput,font:T.default.font.uiDisplayRegular,backgroundColor:f.Color.transparent,textAlignVertical:"center",alignSelf:"center"}),inputTextDisplayDesktop:()=>r.Styles.createViewStyle({flex:1,borderWidth:0,height:32,alignSelf:"center"}),inputFieldButton:()=>r.Styles.createButtonStyle({flex:0,width:60,height:60}),gestureCatcher:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:f.Color.transparent}),flippedView:()=>r.Styles.createViewStyle({transform:[{scaleX:-1}]})});class P extends l.ComponentBase{constructor(){super(...arguments),this._onDialpadButtonPress=e=>{const t=v.default.newCauseId();C.log(p.LogTraceArea.DialerPanel,"DTMFDialpad._onDialpadButtonPress callId: "+this.props.callId+" input: "+n.pii.Omit(e)+" causeId: "+t),e&&this._sendDtmfTonesAndUpdateState(e,t)},this._onDialpadButtonLongPress=e=>{if("0"===e){const e=this.state.inputText+"+";this._setInputAndFocus(e),this.setState({inputText:e})}},this._onKeyPress=e=>{const t=e.keyCode,i=v.default.newCauseId();if(C.log(p.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" keyCode: "+n.pii.Omit(t)+" causeId: "+i),h.isDialPadKeyCode(t,e.shiftKey)){const i=h.getStringFromKeyCode(t,e.shiftKey),o=v.default.newCauseId();C.log(p.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" input: "+n.pii.Omit(i)+" causeId: "+o),this._sendDtmfTonesAndUpdateState(i,o)}},this._onPasteDesktop=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=s.find(e.clipboardData.items,(e=>"text/plain"===e.type));t&&t.getAsString((e=>{this._onPaste(e)}))},this._onPasteNative=()=>{(0,I.getTextFromClipboard)().then((e=>{e&&this._onPaste(e)}))},this._onScrollViewContentSizeChanged=(e,t)=>{if(!this.state.viewDimensions.width)return;const i=this.state.viewDimensions.width;this._scrollView&&e>i&&(y.default.isRTL()?this._scrollView.setScrollLeft(0):this._scrollView.setScrollLeft(e-i))},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onDialpadInputRef=e=>{this._dialPadInput=e||void 0},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};(0,m.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})}}_buildState(e,t){const i={};return t&&(i.inputText="",i.viewDimensions={width:0,height:0}),i}componentDidMount(){super.componentDidMount(),this._setInputAndFocus(this.state.inputText,!0)}_sendDtmfTonesAndUpdateState(e,t){c.default.PstnUtils.sendDTMFTones(this.props.callId,e,t);const i=this.state.inputText+e;this._setInputAndFocus(i),this.setState({inputText:i})}_onPaste(e){const t=d.default.normalizePhoneNumber(e),i=v.default.newCauseId();C.log(p.LogTraceArea.DialerPanel,"DTMFDialpad._onPaste callId: "+this.props.callId+" pasted: "+n.pii.Omit(t)+" causeId: "+i),this._sendDtmfTonesAndUpdateState(t,i)}_setInputAndFocus(e,t){this._dialPadInput&&(this._dialPadInput.setValue(e),s.defer((()=>{if(this.isComponentMounted()&&this._dialPadInput){t||this._dialPadInput.requestFocus();const i=e.length;i>0&&this._dialPadInput.selectRange(i,i)}})))}render(){const e=y.default.isRTL(),t=[w.inputDisplayContainer],i=[w.inputTextDisplay],o=[w.inputDisplayInnerContainer];e&&(o.push(w.inputDisplayInnerContainerRTL),i.push(w.flippedView));let n=(0,a.jsx)(r.ScrollView,{ref:this._onScrollViewRef,style:o,horizontal:!0,showsHorizontalScrollIndicator:!1,onLayout:this._onLayoutChange,onContentSizeChange:this._onScrollViewContentSizeChanged,children:(0,a.jsx)(r.Text,{style:i,numberOfLines:1,children:this.state.inputText})});return t.push(w.inputDisplayContainerDesktop),i.push(w.inputTextDisplayDesktop),n=(0,a.jsx)(r.TextInput,{style:i,ref:this._onDialpadInputRef,autoFocus:!0,onKeyPress:this._onKeyPress,value:this.state.inputText,clearButtonMode:"never",blurOnSubmit:!0,onPaste:this._onPasteDesktop}),(0,a.jsxs)(r.View,{style:w.container,children:[(0,a.jsx)(r.GestureView,{style:w.gestureCatcher}),(0,a.jsxs)(r.View,{style:t,children:[n,undefined,(0,a.jsx)(g.default,{style:w.inputFieldButton,size:b.IconSize.size20,onPress:this.props.onClose,color:f.Color.white,hoverColor:f.Color.gray300,icon:b.SkypeIcon.Cancel,title:_.getString("Global.CloseButtonTitle")})]}),(0,a.jsx)(r.View,{style:w.dialpadContainer,children:(0,a.jsx)(u.default,{onKeyPress:this._onDialpadButtonPress,onKeyLongPress:this._onDialpadButtonLongPress,isDtmfDialpad:!0,disableFontScaling:!0,enableExtensionDialing:!0})})]})}}t.DTMFDialpad=P,t.default=P},587853:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(873324),n=o.__importDefault(i(513983)),s=o.__importDefault(i(225511)),r=i(815146),l=i(918642),c=o.__importStar(i(85385)),d=o.__importStar(i(704704)),u=i(16549);class h extends n.default{constructor(e){super(e),this._messages=[],this._onMessageBack=e=>{this.props.onClose(),this._rejectCommand.execute(),this._messageCommand.execute(this._messages[e],r.PostSource.DeclineAndMessageMenu),c.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,e+1))},this._onDefaultOption=()=>{this.props.onClose(),this._rejectCommand.execute(),c.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,this._messages.length+1))},this._messages.push(d.getString("MobileIncomingCallPanel.CantTalkMessage")),this._messages.push(d.getString("MobileIncomingCallPanel.CallRightBackMessage")),this._messages.push(d.getString("MobileIncomingCallPanel.CallLaterMessage")),this._messages.push(d.getString("MobileIncomingCallPanel.CallMeLaterMessage")),this._rejectCommand=new l.RejectIncomingCallCommand(e.callId,!1),this._messageCommand=new l.MessageConversationCommand(e.conversationMri)}_buildRows(e,t){const i=[];for(let e=0;e<this._messages.length;e++){const t=this._messages[e],o={key:"Message: "+t,titleText:t,accessibilityLabel:t,hideBorder:!0,onRowPress:this._onMessageBack.bind(this,e),titleTextColor:u.Color.white};i.push({props:o,builder:s.default.buildRow})}const o=d.getString("MobileIncomingCallPanel.DefaultOption"),a={key:"DefaultOption",titleText:o,accessibilityLabel:o,hideBorder:!0,onRowPress:this._onDefaultOption,titleTextColor:u.Color.blue};return i.push({props:a,builder:s.default.buildRow}),i}static getMenuHeight(){return 5*s.default.getMenuItemHeight()}}t.default=h},945302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(174958),s=o.__importStar(i(496486)),r=o.__importStar(i(516778)),l=o.__importDefault(i(12713)),c=o.__importDefault(i(369347)),d=i(460515),u=o.__importDefault(i(132680)),h=o.__importStar(i(44717)),p=o.__importDefault(i(601976)),g=i(815146),C=o.__importStar(i(85385)),m=o.__importStar(i(147286)),S=o.__importStar(i(704704)),_=o.__importDefault(i(363091)),f=o.__importDefault(i(117475)),y=i(16549),T=o.__importDefault(i(601274)),b=o.__importDefault(i(685734)),v=o.__importDefault(i(958868)),I=o.__importDefault(i(150343)),w="FixedPositionItem";class P extends v.default{constructor(){super(...arguments),this._bottomOffset=0,this._renderItem=e=>{const t=e.id;if(e.item){const i=e.item,o=this.state.enableRefreshedPalette?this._getContext().themeColors.surfaceInteractive:y.Color.blue,n=i.eventType===d.ParticipantEventType.Join?o:y.Color.blackOverlay70;return(0,a.jsx)(l.default,{mri:i.mri,isLeaveEvent:i.eventType===d.ParticipantEventType.Leave||i.eventType===d.ParticipantEventType.Unavailable,isRaiseHandEvent:i.eventType===d.ParticipantEventType.HandRaised,useLightText:!0,displayString:this._getParticipantItemDisplayString(i),backgroundColor:n,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets},t)}if(e.text)return(0,a.jsx)(l.default,{mri:e.text.mri,displayString:e.text.text,backgroundColor:y.Color.blackOverlay70,useLightText:!0,isTextEvent:!0,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets},t)},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){const i=I.default.getS4LUiFeatures().enableRefreshedPalette,o={horizontalSafeAreaInsets:f.default.horizontalInsets(),audienceBotMris:c.default.InCallBotMriUtils.getCallAudienceBotMriFilter(),gridViewBotMris:c.default.InCallBotMriUtils.getCallGridViewBotMriFilter(),enableRefreshedPalette:i};return t&&(this._eventCount=0,this._layoutController=new D,o.itemRenderInfos=[],this._layoutController.setCallbacks((e=>this._onRemoveItem(e)))),o}textEvent(e,t){this.setState(this._onTextEvent(e,t))}participantEvent(e,t){const i=h.sanitizeMri(e,h.Namespaces.SkypeId),o={mri:i,userName:p.default.getDisplayName(i)||S.getString("Notifications.UnknownUserShort"),eventType:t,gender:b.default.getFullUserProfileByMri(i).gender,isCurrentUser:_.default.isMyMri(i)};this.setState(this._onParticipantEvent(o))}participantActionEvent(e,t,i){const o=h.sanitizeMri(e,h.Namespaces.SkypeId),a=this._getUserNameForEvent(o),n=h.sanitizeMri(t,h.Namespaces.SkypeId),s={mri:o,userName:a,actionMri:n,actionUserName:p.default.getDisplayName(n)||S.getString("Notifications.UnknownUserShort"),eventType:i};this.setState(this._onParticipantEvent(s))}participantsRingingEvent(e){const t={displayString:u.default.getRingingItemDisplayString(e),mri:e[0],participantCount:e.length};this.setState(this._onParticipantsRingingEvent(t))}clearEvents(){this._layoutController.clearEvents()}_onRemoveItem(e){this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),e===w?this.setState({fixedPositionItem:void 0}):this.setState(this._removeStreamItemsAndReturnNewState(e,this.state)))}_onParticipantEvent(e){const t=s.clone(this.state.itemRenderInfos),i="participant_"+this._eventCount++;let o=this._bottomOffset;return e.eventType===d.ParticipantEventType.Unavailable&&(o=48),t.push({id:i,item:e,layoutController:this._layoutController.controllerForKey(i,!0,o)}),{itemRenderInfos:t}}_onParticipantsRingingEvent(e){const t=w,i=this._layoutController.getFixedPositionItemController(!0),o={id:t,ringingItem:e,layoutController:i};if(!this.state.fixedPositionItem&&e.participantCount>0)this._bottomOffset=48,null==i||i.setDismissTimerTimeout(3e4);else{if(0===e.participantCount)return null==i||i.dismissItem(!0),this._bottomOffset=0,this.state;null==i||i.restartDismissTimer()}return{fixedPositionItem:o}}_onTextEvent(e,t){const i=s.clone(this.state.itemRenderInfos),o="text_"+this._eventCount++;return i.push({id:o,text:{mri:t,text:e},layoutController:this._layoutController.controllerForKey(o,!0)}),{itemRenderInfos:i}}_removeStreamItemsAndReturnNewState(e,t){const i=s.clone(t.itemRenderInfos);return{itemRenderInfos:s.filter(i,(t=>t.id!==e))}}_getParticipantItemDisplayString(e){const{eventType:t,userName:i,actionUserName:o,gender:a,isCurrentUser:n}=e;let r;switch(t){case d.ParticipantEventType.Join:r=S.getString("ReactionsStream.ParticipantJoined",{participant:i});break;case d.ParticipantEventType.Leave:r=S.getString("ReactionsStream.ParticipantLeft",{participant:i});break;case d.ParticipantEventType.Muted:r=S.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:i,person:o||""});break;case d.ParticipantEventType.HandRaised:r=n?S.getString("ReactionsStream.RaiseHandEventForCurrentUser"):S.getString("ReactionsStream.RaiseHandEvent",{gender:m.getLocalizeParamForGender(a),initiator:i||""});break;case d.ParticipantEventType.KickedOut:r=S.getString("CallPanel.RemoveFromCallPersonalize",{initiator:i,person:o||""});break;case d.ParticipantEventType.BotUnavailable:r=s.includes(this.state.audienceBotMris,e.mri)?S.getString("ReactionsStream.TogetherModeUnavailable"):s.includes(this.state.gridViewBotMris,e.mri)?S.getString("ReactionsStream.LargeGridUnavailable"):S.getString("ReactionsStream.ParticipantUnavailable",{participant:i});break;case d.ParticipantEventType.TogetherModeBackgroundChangeFailed:r=S.getString("ReactionsStream.TogetherModeBackgroundChangeFailed");break;case d.ParticipantEventType.TogetherModeDesiredBackgroundAlreadySet:r=S.getString("ReactionsStream.TogetherModeDesiredBackgroundAlreadySet");break;case d.ParticipantEventType.TogetherModeBackgroundChanged:r=S.getString("ReactionsStream.TogetherModeBackgroundChanged",{participant:i});break;case d.ParticipantEventType.Unavailable:default:r=S.getString("ReactionsStream.ParticipantUnavailable",{participant:i})}return r}_renderFixedPositionItem(){if(!this.state.fixedPositionItem)return;const e=this.state.enableRefreshedPalette?this._getContext().themeColors.surfaceInteractive:y.Color.blue,t=this.state.fixedPositionItem,i=t.id;return t.ringingItem?(0,a.jsx)(l.default,{mri:t.ringingItem.mri,isLeaveEvent:!1,useLightText:!0,displayString:t.ringingItem.displayString,backgroundColor:e,layoutController:t.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets},i):void 0}_getUserNameForEvent(e){const t=h.sanitizeMri(e,h.Namespaces.SkypeId);return p.default.getDisplayName(t)||S.getString("Notifications.UnknownUserShort")}render(){const e=s.map(this.state.itemRenderInfos,this._renderItem),t=this._renderFixedPositionItem();return(0,a.jsxs)(r.View,{style:this.props.style,onLayout:this._onLayoutChange,ignorePointerEvents:!0,children:[e,t]})}}t.default=P;class M{constructor(e,t,i,o=0){this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._dismissTimerTimeout=5e3,this._currentHeight=0,this._currentBottomOffset=0,this._currentOpacity=0,this._animatedOpacityValue=new r.Animated.Value(this._currentOpacity),this._animatedVerticalValue=new r.Animated.Value(this._currentBottomOffset),this._animatedStyle=r.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,bottom:this._animatedVerticalValue}),C.log(g.LogTraceArea.CallingUI,`EventItemLayoutController constructor ${n.pii.Omit(e)}`),this._id=e,this._onIntrinsicHeightChange=t,this._onRemoveItem=i,this._currentBottomOffset=o}getStyles(){return[this._animatedStyle]}setIntrinsicHeight(e){Math.abs(e-this._currentHeight)>1&&(this._currentHeight=e,this._onIntrinsicHeightChange(this._id,e,!this._hasBeenPresented))}presentItemIfNeeded(e=!1){return!this._hasBeenPresented&&(C.log(g.LogTraceArea.CallingUI,`EventItemLayoutController presentItemIfNeeded ${n.pii.Omit(this._id)}`),this._hasBeenPresented=!0,this._animatedVerticalValue.setValue(-1.2*this._currentHeight),this._updateAnimatedPosition(this._currentBottomOffset,this._currentOpacityValue(),e,!0,450,(()=>this._startDismissTimer())),!0)}setDismissTimerTimeout(e){this._dismissTimerTimeout=e}restartDismissTimer(){this._startDismissTimer()}dismissItem(e=!1){return!this._hasBeenDismissed&&(C.log(g.LogTraceArea.CallingUI,`EventItemLayoutController dismissItem ${n.pii.Omit(this._id)}`),this._clearDismissTimer(),this._updateAnimatedPosition(this._currentBottomOffset+40,0,e,!1,750,(()=>{this._onRemoveItem&&this._onRemoveItem(this._id)})),this._hasBeenDismissed=!0,!0)}addtoBottomOffset(e,t=!1){this._updateAnimatedPosition(this._currentBottomOffset+e,this._currentOpacityValue(),t)}_clearDismissTimer(){this._dismissTimer&&(T.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(){this._clearDismissTimer(),this._dismissTimer=T.default.setTimeout((()=>this.dismissItem(!0)),this._dismissTimerTimeout)}_currentOpacityValue(){return this._hasBeenPresented&&!this._hasBeenDismissed?1:0}_updateAnimatedPosition(e,t=1,i=!1,o=!1,a=300,n,s){if(!this._hasBeenDismissed){if(this._animation&&(this._animation.stop(),this._animation=void 0),i){const i=s||[];0!==t&&i.push(r.Animated.timing(this._animatedVerticalValue,{toValue:e,duration:a,easing:o?r.Animated.Easing.CubicBezier(.87,-.41,.19,1.44):r.Animated.Easing.InOut()})),i.push(r.Animated.timing(this._animatedOpacityValue,{toValue:t,duration:a,easing:r.Animated.Easing.InOut()})),this._animation=r.Animated.parallel(i),this._animation.start((e=>{n&&n()}))}else this._animatedVerticalValue.setValue(e),this._animatedOpacityValue.setValue(t),n&&n();this._currentOpacity=t,this._currentBottomOffset=e}}}class D{constructor(){this._controllers={},this._orderedKeys=[],this._onIntrinsicHeightChange=(e,t,i)=>{let o=s.indexOf(this._orderedKeys,e);if(i)if(e===w){const e=this.getFixedPositionItemController(!1);null==e||e.presentItemIfNeeded()}else{const e=this.controllerForKey(this._orderedKeys[o],!1);e&&e.presentItemIfNeeded(!0)}for(o-=1;o>=0;o--){const e=this.controllerForKey(this._orderedKeys[o],!1);e&&e.addtoBottomOffset(t,!0)}}}updateViewDimensions(e){}setCallbacks(e){this._onRemoveItem=e}clearEvents(){s.each(this._controllers,(e=>e.dismissItem()))}controllerForKey(e,t,i=0){let o=this._controllers[e];return!o&&t&&(o=new M(e,this._onIntrinsicHeightChange,this._onRemoveItem,i),this._controllers[e]=o,this._orderedKeys.push(e)),o}getFixedPositionItemController(e){return!this._fixedPositionItemController&&e&&(this._fixedPositionItemController=new M(w,this._onIntrinsicHeightChange,this._onRemoveItem,0)),this._fixedPositionItemController}removeControllerForKey(e){e===w?delete this._fixedPositionItemController:(delete this._controllers[e],this._orderedKeys=s.without(this._orderedKeys,e))}}},835697:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=i(26703),l=o.__importDefault(i(827361)),c=o.__importDefault(i(601274)),d=(0,r.lazyProperties)({backFlippedHorizontal:()=>n.Styles.createViewStyle({transform:[{rotateY:"180deg"}]}),backFlippedVertical:()=>n.Styles.createViewStyle({transform:[{rotateX:"180deg"}]})});class u extends s.ComponentBase{constructor(){super(...arguments),this._rotationYValue=new n.Animated.Value(0),this._rotationYStyle=n.Styles.createAnimatedViewStyle({transform:[{rotateY:this._rotationYValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._rotationXValue=new n.Animated.Value(0),this._rotationXStyle=n.Styles.createAnimatedViewStyle({transform:[{rotateX:this._rotationXValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onToggle=()=>{this._flipAnimation(!this.state.isFlipped)}}_buildState(e,t){const i={};return t&&(i.isFlipped=!1),i}componentDidMount(){super.componentDidMount(),this.props.autoflipTimeout&&c.default.setTimeout((()=>{this.isComponentMounted()&&this._onToggle()}),this.props.autoflipTimeout)}_flipAnimation(e){const t=this.props.duration||1e3;this.props.flipHorizontal?n.Animated.timing(this._rotationYValue,{toValue:e?180:0,duration:t,easing:n.Animated.Easing.InOutBack()}).start():n.Animated.timing(this._rotationXValue,{toValue:e?180:0,duration:t,easing:n.Animated.Easing.InOutBack()}).start(),c.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({isFlipped:e})}),t/2)}render(){const e=this.props.children;let t;t=this.state.isFlipped?(0,a.jsx)(h,{isBack:!0,flipHorizontal:this.props.flipHorizontal,children:e[1]},"back"):(0,a.jsx)(h,{flipHorizontal:this.props.flipHorizontal,children:e[0]},"front");const i=[l.default.flexOne,this.props.flipHorizontal?this._rotationYStyle:this._rotationXStyle];return(0,a.jsx)(n.View,{style:this.props.style,children:(0,a.jsx)(n.Animated.View,{style:i,children:t})})}}t.default=u;class h extends s.ComponentBase{render(){const e=[l.default.flexOne];return this.props.isBack&&e.push(this.props.flipHorizontal?d.backFlippedHorizontal:d.backFlippedVertical),(0,a.jsx)(n.View,{style:e,children:this.props.children})}}},426180:(e,t,i)=>{const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(148540),l=o.__importDefault(i(22436)),c=o.__importDefault(i(369347)),d=i(152803),u=o.__importDefault(i(99741)),h=o.__importDefault(i(638260)),p=i(460515),g=o.__importDefault(i(132680)),C=o.__importDefault(i(167492)),m=o.__importDefault(i(958868)),S=i(815146),_=o.__importDefault(i(970035)),f=o.__importStar(i(85385)),y=o.__importDefault(i(114818)),T=i(26703),b=o.__importStar(i(704704)),v=o.__importDefault(i(363091)),I=o.__importStar(i(437782)),w=o.__importStar(i(888500)),P=i(16549),M=i(641400),D=o.__importDefault(i(827361)),A=o.__importDefault(i(224286)),k=o.__importDefault(i(760989)),R=100,x=120,L="hangup",B="mute",V="unmute",O=(0,T.lazyProperties)({container:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}),pipContainer:()=>s.Styles.createViewStyle({height:R,width:R,borderRadius:50,backgroundColor:P.Color.black}),gestureView:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:P.Color.transparent}),pip:()=>s.Styles.createViewStyle({position:"absolute",height:R,width:R,overflow:"visible"}),talkingAnimation:()=>s.Styles.createViewStyle({position:"absolute",top:-10,left:-10,width:x,height:x,overflow:"visible"}),muteIconContainer:()=>s.Styles.createViewStyle({position:"absolute",bottom:2,left:0,right:0,height:30,alignItems:"center",justifyContent:"center",backgroundColor:P.Color.transparent})});class E extends m.default{constructor(){super(...arguments),this._currentPoint={x:0,y:0},this._targetPoint={x:0,y:0},this._isDragging=!1,this._animatedTopValue=new s.Animated.Value(this._currentPoint.y),this._animatedLeftValue=new s.Animated.Value(this._currentPoint.x),this._animatedStyle=s.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue}),this._animatedScaleValue=new s.Animated.Value(1),this._animatedScaleStyle=s.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._participantLayoutController={getStyles:()=>[O.pipContainer],getInnerStyles:()=>[D.default.flexOne],getBackgroundColorStyle(){},isHidden:()=>!1},this._onPress=()=>{const e=k.default.newCauseId();f.log(S.LogTraceArea.CallingUI,"FloatingPipView._onPress causeId: "+e),this._updateScale(!1),this.state.callConversationMri&&this.state.callId&&c.default.CallNavigationHelper.rejoinCall(this.state.callConversationMri,this.state.callId,e,S.NavigationCallOrigin.PipView)},this._onLongPress=e=>{this._updateScale(!1,750);const t=this._getActionMenu(),i={anchor:()=>this._floatingPipView,buttons:t.menuItems,destructiveButtonIndex:t.destructiveIndex};w.default.showWithActionMenuConfig({options:i,callback:this._onHandleActionMenuCommand,maintainAnchor:!0,rootViewId:this._getRootViewId(),invokingEvent:e})},this._onPressIn=()=>{this._updateScale(!0)},this._onPan=e=>{const t=!e.isComplete;if(this._isDragging!==t&&this._startOrStopDragging(t),!this._approachValue){const e=this._centerPoint(this._currentPoint);this._startApproach(e,(e=>{const t={x:e.x-50,y:e.y-50};this._positionPip(t),!this._isDragging&&Math.abs(this._targetPoint.x-e.x)<1&&Math.abs(this._targetPoint.y-e.y)<1&&this._stopApproach()}))}if(this._approachValue&&this._isDragging&&(this._targetPoint={x:e.pageX,y:e.pageY},this._approachValue.updateTarget(this._targetPoint)),e.isComplete){let t,i;if(Math.abs(e.velocityY)<.25)Math.abs(e.velocityX)<.25?(t=e.pageX>this.state.viewDimensions.width/2?this.state.viewDimensions.width:0,i=this._currentPoint.y+50):(t=e.velocityX>0?this.state.viewDimensions.width:0,i=this._currentPoint.y+50);else{const o=e.velocityY/e.velocityX;t=e.velocityX>0?this.state.viewDimensions.width:0,i=o*(t-e.pageX)+e.pageY}t=Math.max(Math.min(t,this._maxX()),40),i=Math.max(Math.min(i,this._maxY()),114),this._targetPoint={x:t,y:i},this._approachValue&&this._approachValue.updateTarget(this._targetPoint)}},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};this.setState({viewDimensions:t})},this._onHandleActionMenuCommand=e=>{const t=k.default.newCauseId();if(f.log(S.LogTraceArea.CallingUI,"FloatingPipView._onHandleActionMenuCommand "+e+" causeId: "+t),this.state.callId)switch(e){case L:c.default.CallingStore.endCall(this.state.callId,t);break;case B:h.default.updateCallTelemetry(this.state.callId,t,(e=>e.muteFloatingPipPress())),c.default.CallingStore.mute(this.state.callId,t);break;case V:h.default.updateCallTelemetry(this.state.callId,t,(e=>e.muteFloatingPipPress())),c.default.CallingStore.unmute(this.state.callId,t);case w.SXActionMenuCancel:}},this._layoutController=()=>this._participantLayoutController,this._onFloatingPipRef=e=>{this._floatingPipView=e||void 0},this._onCallingVideoView=(e,t)=>{f.log(S.LogTraceArea.CallingUI,"FloatingPipView._onCallingVideoView causeId"+t),this._callingVideoView!==e&&(this._callingVideoView=e)}}_buildState(e,t){const i={};t&&(i.viewDimensions={width:0,height:0});const o=c.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();if(!o||C.default.isCallVisible(o))return i.showPip=!1,i.callState=r.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0,i.speakerMri=void 0,i;const a=c.default.CallingStore.getCallConversationMri(o);if(c.default.CallingStore.isCallCreator(o)&&a&&1===u.default.getActiveParticipants(o,a).length)i.speakerMri=n.first(v.default.getMyMris());else{const e=c.default.CallingStore.getTopSpeakerMri(o);if(e)i.speakerMri=e;else{const e=c.default.CallingStore.getRemoteCallMemberMris(o);i.speakerMri=this._fallbackSpeakerParticipantKey(o,e)}}if(i.isCallJoinedAsTwincam=c.default.CallingStore.isCallJoinedAsTwincam(o),i.isCallJoinedAsTwincam){const e=C.default.hasCallPreviewViewBeenSeen(o),t=c.default.CallingStore.isProvidingVideo(o);i.showPip=!e,i.callId=o,i.callConversationMri=a,i.callState=c.default.CallingStore.getCallState(o),i.videoAvailable=t,i.screenshareAvailable=!1,i.videoStreaming=t&&!e,i.screenshareStreaming=!1,i.isMuted=g.default.isLocalOrServerMuted(o)}else i.speakerMri?(i.showPip=!0,i.callId=o,i.callConversationMri=a,i.callState=c.default.CallingStore.getCallState(o),i.videoAvailable=c.default.RemoteStreamHelper.isStreamAvailable(o,i.speakerMri,r.StreamType.Video),i.screenshareAvailable=c.default.RemoteStreamHelper.isStreamAvailable(o,i.speakerMri,r.StreamType.ScreenSharing),i.videoStreaming=c.default.RemoteStreamHelper.isStreamRenderingForTarget(o,i.speakerMri,r.StreamType.Video,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.screenshareStreaming=c.default.RemoteStreamHelper.isStreamRenderingForTarget(o,i.speakerMri,r.StreamType.ScreenSharing,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.isMuted=g.default.isLocalOrServerMuted(o)):(i.showPip=!1,i.callState=r.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0);return i}componentDidMount(){super.componentDidMount(),this.state.showPip&&this.state.viewDimensions.width&&this._presentPip();const e=this.state.showPip?"Showing":"Hiding";f.log(S.LogTraceArea.CallingUI,"FloatingPipView.componentDidMount: "+e+" PiP")}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=k.default.newCauseId();if(f.log(S.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate causeId: "+o),this.state.showPip!==t.showPip&&(this.state.showPip&&this._presentPip(),this.state.showPip!==t.showPip)){const e=this.state.showPip?"Showing":"Hiding";f.log(S.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate: "+e+" PiP")}(0,y.default)(this.state.viewDimensions,t.viewDimensions)||(t.viewDimensions.width?this._updatePipPosition():this.state.showPip&&this._presentPip())}requestFocus(){}_presentPip(){f.log(S.LogTraceArea.CallingUI,"FloatingPipView._presentPip");const e={x:this.state.viewDimensions.width,y:84};this._positionPip(e),this._positionPip({x:e.x-90,y:e.y},!0,200)}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._stopApproach(),this._approachValue=new l.default(e,t),this._approachValue.start()}_startOrStopDragging(e){this._isDragging=e,this._updateScale(e)}_updateScale(e,t=250){s.Animated.timing(this._animatedScaleValue,{toValue:e?.9:1,easing:s.Animated.Easing.OutBack(),duration:t}).start()}_fallbackSpeakerParticipantKey(e,t){if(!t||n.isEmpty(t))return;const i=n.find(t,(t=>c.default.RemoteStreamHelper.isStreamAvailable(e,t,r.StreamType.ScreenSharing)));if(i)return i;const o=n.find(t,(t=>c.default.RemoteStreamHelper.isStreamAvailable(e,t,r.StreamType.Video)));return o||t[0]}_updatePipPosition(){if(this._isDragging)return;let e=this._currentPoint.x,t=this._currentPoint.y;e>0&&(e=this._maxX()-50);const i=this._maxY()-50;t>i&&(t=i),this._positionPip({x:e,y:t})}_maxX(){return this.state.viewDimensions.width-50+10}_maxY(){return this.state.viewDimensions.height-50+10}_centerPoint(e){return{x:e.x+50,y:e.y+50}}_positionPip(e,t=!1,i=0){t?s.Animated.parallel([s.Animated.timing(this._animatedTopValue,{toValue:e.y,easing:s.Animated.Easing.Out(),duration:250,delay:i}),s.Animated.timing(this._animatedLeftValue,{toValue:e.x,easing:s.Animated.Easing.Out(),duration:250,delay:i})]).start():(this._animatedTopValue.setValue(e.y),this._animatedLeftValue.setValue(e.x)),this._currentPoint=e}_getActionMenu(){const e=[];return e.push({text:b.getString("FloatingPipView.HangupAction"),command:L}),this.state.isMuted?e.push({text:b.getString("FloatingPipView.UnmuteAction"),command:V}):e.push({text:b.getString("FloatingPipView.MuteAction"),command:B}),{menuItems:e,destructiveIndex:0}}_getRenderInfo(){return{renderKey:this.state.speakerMri||"",mri:this.state.speakerMri||"",isLocal:!1,shouldRenderVideo:this.state.videoAvailable||this.state.screenshareAvailable||this.state.videoStreaming||this.state.screenshareStreaming,renderScreenShare:this.state.screenshareAvailable}}_getLocalRenderInfo(){return{renderKey:p.CallStageElementKeys.localUserKey,mri:v.default.getSkypeMri(),isLocal:!0,shouldRenderVideo:this.state.videoStreaming,renderScreenShare:!1}}render(){if(!this.state.showPip||!this.state.viewDimensions.width)return(0,a.jsx)(s.View,{style:O.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0});f.log(S.LogTraceArea.CallingUI,"FloatingPipView: Showing PiP for call user "+I.mriOrId(this.state.speakerMri)+", videoAvailable "+this.state.videoAvailable+", videoStreaming "+this.state.videoStreaming+", videoDimension "+this.state.viewDimensions.width+" "+this.state.viewDimensions.height+", threadId: "+I.mriOrId(this.state.callConversationMri)+", callId: "+this.state.callId);const e=this.state.isCallJoinedAsTwincam?this._getLocalRenderInfo():this._getRenderInfo(),t=this.state.isMuted?(0,a.jsx)(s.View,{style:O.muteIconContainer,children:(0,a.jsx)(_.default,{icon:M.SkypeIcon.MicrophoneOff,size:M.IconSize.size16,color:P.Color.white})}):void 0;return(0,a.jsx)(s.View,{style:O.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0,children:(0,a.jsxs)(s.Animated.View,{ref:this._onFloatingPipRef,style:[O.pip,this._animatedStyle,this._animatedScaleStyle],ignorePointerEvents:!0,children:[(0,a.jsx)(A.default,{style:O.talkingAnimation,animate:!0,size:x}),this.state.callId&&(0,a.jsx)(d.CallParticipantView,{callId:this.state.callId,renderInfo:e,renderKey:e.renderKey,isCompact:!0,iconOpacity:1,videoBorderRadius:50,suppressTalkingRing:!0,parentViewId:"FloatingPipView",onCallingVideoView:this._onCallingVideoView,layoutController:this._layoutController,iconSize:100}),t,(0,a.jsx)(s.GestureView,{style:O.gestureView,onPan:this.state.showPip?this._onPan:void 0,releaseOnRequest:!1,importantForAccessibility:s.Types.ImportantForAccessibility.No,children:(0,a.jsx)(s.Button,{style:O.gestureView,onPress:this.state.showPip?this._onPress:void 0,onPressIn:this._onPressIn,onLongPress:this._onLongPress,delayLongPress:500,disableTouchOpacityAnimation:!0,accessibilityLabel:b.getString("FloatingPipView.ReturnToCallButtonAccessibilityLabel"),accessibilityTraits:s.Types.AccessibilityTrait.Button})})]})})}}t.Z=E},73785:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(217041),s=o.__importDefault(i(369347)),r=o.__importDefault(i(167492));class l extends n.ComponentBase{_buildState(e,t){if(!t&&this.state.renderPipView)return{};{const e=s.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();return{renderPipView:!!e&&!r.default.isCallVisible(e)}}}render(){if(this.state.renderPipView){const e=i(426180).Z;return(0,a.jsx)(e,{})}return null}}t.default=l},914339:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(854646),r=o.__importDefault(i(762356)),l=o.__importDefault(i(132680)),c=i(154235),d=i(26703),u=o.__importDefault(i(799585)),h=i(16549),p=o.__importDefault(i(827361)),g=o.__importDefault(i(497910)),C=i(403396),m=i(596648).UserIconSize.Size120,S=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),containerAndroid:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"}),innerView:()=>p.default.absoluteFill,backgroundContainerView:()=>n.Styles.createViewStyle({backgroundColor:h.Color.transparent}),icon:()=>n.Styles.createViewStyle({width:m,height:m,overflow:"visible"}),connecting:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,height:m,width:m,borderRadius:m/2,backgroundColor:h.Color.blackOverlay20,overflow:"hidden"})});class _ extends g.default{constructor(){super(...arguments),this._animatedBackgroundOpacityValue=new n.Animated.Value(0),this._animatedBackgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedBackgroundOpacityValue}),this._animatedIconOpacityValue=new n.Animated.Value(0),this._animatedIconScaleValue=new n.Animated.Value(1),this._animatedIconStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedIconOpacityValue,transform:[{scale:this._animatedIconScaleValue}]})}componentDidMount(){super.componentDidMount(),this._updateIconOpacity(),this._updateBackgroundIconOpacity(!1),this._updateIconScale()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.iconOpacity!==e.iconOpacity&&this._updateIconOpacity(this.props.animateChanges),this.props.isConnecting===e.isConnecting&&this.props.backgroundOpacity===e.backgroundOpacity||this._updateBackgroundIconOpacity(l.default.enableLayoutAnimation()),this.props.size!==e.size&&this._updateIconScale(this.props.animateChanges)}_updateIconScale(e=!1){const t=this.props.size/m;e?n.Animated.timing(this._animatedIconScaleValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconScaleValue.setValue(t)}_updateIconOpacity(e=!1){const t=this.props.iconOpacity||0;e?n.Animated.timing(this._animatedIconOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconOpacityValue.setValue(t)}_updateBackgroundIconOpacity(e){let t=this.props.isConnecting||!this.props.backgroundOpacity?0:this.props.backgroundOpacity;this.props.showAudioParticipantBackground&&(t=1),e?n.Animated.timing(this._animatedBackgroundOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedBackgroundOpacityValue.setValue(t)}render(){const e=this.props.isConnecting?(0,a.jsx)(n.View,{style:S.connecting,children:(0,a.jsx)(u.default,{size:c.SXActivityIndicatorSize.Medium,tintColor:h.Color.whiteOverlay80})}):void 0,t=[this.props.style];t.push(S.container);const i=[S.innerView,S.backgroundContainerView];this.props.backgroundColorStyle&&i.push(this.props.backgroundColorStyle),this._animatedBackgroundOpacityStyle&&i.push(this._animatedBackgroundOpacityStyle);const o=this.props.gradientColors?(0,a.jsx)(s.GradientView,{style:S.innerView,direction:s.GradientDirection.BOTTOM,colors:this.props.gradientColors}):void 0,l=this.props.showAudioParticipantBackground?(0,a.jsx)(r.default,{}):void 0,d=this.props.hideIcon?void 0:(0,a.jsx)(n.View,{style:S.icon,children:(0,a.jsxs)(n.Animated.View,{style:[p.default.overflowVisible,this._animatedIconStyle],children:[(0,a.jsx)(C.UserIcon,{userMri:this.props.userMri,size:m,forceMediumAvatarSize:!0,useCircleForAgentMask:!0}),e]})});return(0,a.jsxs)(n.View,{style:t,children:[(0,a.jsxs)(n.Animated.View,{style:i,children:[o,l]}),d]})}}t.default=_},200020:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=i(68210),l=o.__importDefault(i(601976)),c=i(815146),d=o.__importDefault(i(970035)),u=o.__importStar(i(85385)),h=i(26703),p=o.__importStar(i(50350)),g=o.__importStar(i(704704)),C=o.__importDefault(i(740794)),m=i(16549),S=o.__importDefault(i(20758)),_=i(641400),f=o.__importDefault(i(52066)),y=i(262725),T=o.__importDefault(i(497910)),b=o.__importDefault(i(760989)),v=o.__importDefault(i(453761)),I=(0,h.lazyProperties)({contentContainer:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center"}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>n.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>n.Styles.createTextStyle({fontSize:S.default.controlFontSize.caption}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),dismissButtonDesktop:()=>n.Styles.createViewStyle({margin:12}),dismissButtonMobile:()=>n.Styles.createViewStyle({marginTop:0,marginBottom:0}),translationIconDesktop:()=>n.Styles.createViewStyle({marginLeft:10}),linkBlue:()=>n.Styles.createTextStyle({color:m.Color.blue})});class w extends T.default{constructor(){super(...arguments),this._onPressMusicModeNoticeLearnMore=()=>{p.openUrlWithParams({origin:c.BrowserOrigin.CallPanel,url:s.default.getConfigSettingsNoSubscription().musicMode.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onPressTogetherModeNoticeLearnMore=()=>{p.openUrlWithParams({origin:c.BrowserOrigin.CallPanel,url:s.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onPressPstnTranslatorNoticeLearnMore=()=>{p.openUrlWithParams({origin:c.BrowserOrigin.CallPanel,url:s.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.privacyLink,rootViewId:this._getRootViewId()})},this._onPressPstnParticipantRingButton=()=>{if(this.props.callId){const e=b.default.newCauseId();u.log(c.LogTraceArea.CallingUI,`GeneralPurposeInCallBanner._onPressPstnParticipantRingButton callId: ${this.props.callId} causeId: ${e}`),C.default.openCallRoster(this.props.conversationMri,this.props.callId,e,this._getContext())}},this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:l.default.getDisplayName(e.conversationMri)||""}}render(){return(0,a.jsxs)(n.View,{style:[this.props.containerStyle,I.container],children:[(0,a.jsxs)(n.View,{style:I.contentContainer,children:[this._renderTeamsIcon(),this._renderTextContent()]}),this._renderDismissButton()]})}_renderTeamsIcon(){var e,t;const i=this._getIconForType();if(i)return(0,a.jsx)(d.default,{style:this.props.isUsingStackNavigation?void 0:I.translationIconDesktop,icon:i,color:null!==(e=this.props.iconColor)&&void 0!==e?e:m.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:_.IconSize.size16},"teamsIcon")}_getIconForType(){switch(this.props.toastType){case r.ToastType.TogetherModeNotice:return _.SkypeIcon.Audience;case r.ToastType.TeamsInterop:return _.SkypeIcon.MSTeams;case r.ToastType.PstnTranslation:return _.SkypeIcon.Warning;case r.ToastType.PstnParticipantRing:return _.SkypeIcon.ContactGroupCall;case r.ToastType.MusicModeEnabled:return _.SkypeIcon.PersonVoice;case r.ToastType.VideoRestricted:return _.SkypeIcon.VideoOff}}_renderTextContent(){switch(this.props.toastType){case r.ToastType.TogetherModeNotice:return this._renderTogetherModeNoticeTextContent();case r.ToastType.MusicModeEnabled:return this._renderMusicModeNoticeTextContent();case r.ToastType.TeamsInterop:return this._renderTeamsInteropContent();case r.ToastType.PstnTranslation:return this._renderPstnTranslatorContent();case r.ToastType.PstnParticipantRing:return this._renderPstnParticipantRingContent();case r.ToastType.VideoRestricted:return this._renderVideoRestrictedContent()}}_renderVideoRestrictedContent(){return(0,a.jsx)(n.View,{style:I.textContentContainer,children:(0,a.jsx)(y.BodyText,{style:this._getTextStyles(),children:g.getString("VideoDisabledToast.VideoDisabled")})},"textContentContainer")}_renderMusicModeNoticeTextContent(){const e=this._getAudioModeLearnMoreLink();return(0,a.jsx)(n.View,{style:I.textContentContainer,children:(0,a.jsx)(y.BodyText,{style:this._getTextStyles(),children:g.getParts("MusicModeNoticeBanner.MusicModeNoticeInCallBannerText",{learnMoreLink:e})})},"textContentContainer")}_renderPstnTranslatorContent(){return(0,a.jsx)(n.View,{style:I.textContentContainer,children:(0,a.jsxs)(y.BodyText,{style:this._getTextStyles(),children:[g.getString("LanguageAndTranslationSettingsPanel.TranslationBannerText")+" ",(0,a.jsx)(f.default,{url:s.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.privacyLink,onPress:this._onPressPstnTranslatorNoticeLearnMore,blue:!0,children:g.getString("LanguageAndTranslationSettingsPanel.TranslationBannerMorePrivacyInfoText")},"pstnTranslatorNoticeLearnMoreLink ")]})},"textContentContainer")}_renderPstnParticipantRingContent(){if(this.props.callId)return(0,a.jsx)(n.View,{style:I.textContentContainer,children:(0,a.jsxs)(y.BodyText,{style:this._getTextStyles(),children:[g.getString("CallPanel.PstnParticipantRingToastText")+" ",(0,a.jsx)(n.Text,{onPress:this._onPressPstnParticipantRingButton,style:I.linkBlue,children:g.getString("CallPanel.PstnParticipantRingToastButton")},"pstnParticipantsRingLink")]})},"textContentContainer")}_renderTeamsInteropContent(){return(0,a.jsx)(n.View,{style:I.textContentContainer,children:(0,a.jsx)(y.BodyText,{style:this._getTextStyles(),children:g.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})})},"textContentContainer")}_renderTogetherModeNoticeTextContent(){const e=this._getTogetherModeLearnMoreLink();return(0,a.jsx)(n.View,{style:I.textContentContainer,children:(0,a.jsx)(y.BodyText,{style:this._getTextStyles(),children:g.getParts("TogetherModeNoticeBanner.TogetherModeNoticeInCallBannerText",{learnMoreLink:e})})},"textContentContainer")}_getTogetherModeLearnMoreLink(){return(0,a.jsx)(f.default,{url:s.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,onPress:this._onPressTogetherModeNoticeLearnMore,blue:!0,children:g.getString("Global.LearnMore")},"togetherModeNoticeLearnMoreLink ")}_getAudioModeLearnMoreLink(){return(0,a.jsx)(f.default,{url:s.default.getConfigSettingsNoSubscription().musicMode.learnMoreUrl,onPress:this._onPressMusicModeNoticeLearnMore,blue:!0,children:g.getString("Global.LearnMore")},"musicModeNoticeLearnMoreLink ")}_renderDismissButton(){var e,t;return(0,a.jsx)(v.default,{style:this.props.isUsingStackNavigation?I.dismissButtonMobile:I.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:m.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:_.IconSize.size24,icon:_.SkypeIcon.Cancel},"dismissButton")}_getTextStyles(){const e=[this.props.textStyle,I.textContent];return this.props.isUsingStackNavigation&&e.push(I.textContentMobile),e}}t.default=w},119302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HoverPopup=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(859745)),s=o.__importStar(i(516778)),r=o.__importDefault(i(54720)),l=o.__importDefault(i(266311)),c=i(815146),d=o.__importStar(i(85385)),u=i(26703),h=i(16549),p=o.__importDefault(i(497910)),g=o.__importDefault(i(601274)),C=o.__importDefault(i(432548)),m=(0,u.lazyProperties)({transparentWrapper:()=>s.Styles.createViewStyle({padding:65})});class S extends p.default{constructor(){super(...arguments),this._isPopupHovered=!1,this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._onBack=()=>(this._dismissSticky(),!0),this._dismissSticky=()=>{this.props.isSticky&&l.default.dismissPopup(this.props.popupId,this._getRootViewId()),this._onClosed()},this._showPopup=()=>{g.default.setTimeout((()=>{this._allowShowPopup()&&this.isComponentMounted()&&this.showImmediately()}),1e3)},this._renderPopup=(e,t,i,o)=>(0,a.jsx)(C.default,{anchorPosition:e,anchorOffset:t,popupWidth:i,popupHeight:o,fillColor:h.Color.transparent,strokeColor:h.Color.transparent,popupAccessibilityTitle:this.popupDescription(),offset:{x:-5,y:-18},onContentDimensionsChanged:this._reconstructPopup,renderContent:()=>this.renderContent()}),this._reconstructPopup=()=>{this.hideImmediately(),this.showImmediately()},this.showImmediately=()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].showImmediately, executed`),this.setState({shouldShowPopup:!0},(()=>{if(this._animatedPopupRef&&this._animatedPopupRef.fadeIn(),this.props.isSticky){const e={getAnchor:this.props.anchor,renderPopup:this._renderPopup,rootViewId:this._getRootViewId(),positionPriorities:["top"],onDismiss:this._onClosed,dismissIfShown:!0};l.default.showPopup(e,this.props.popupId)}this._onOpened(this._isAnchorLongPressed)}))},this.hideImmediately=()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].hideImmediately, executed`),this.setState({shouldShowPopup:!1}),this.props.isSticky?this._dismissSticky():this._onClosed()},this._hidePopup=e=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, settingTimeout`),g.default.setTimeout((()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, shouldFade: ${e}`),this._allowHidePopup()?e?this._animatedPopupRef&&this._animatedPopupRef.fadeOut((e=>{e.finished&&this.isComponentMounted()&&this.hideImmediately()})):this.isComponentMounted()&&this.hideImmediately():d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, notAllowed`)}),50)},this.onAnchorEnter=()=>{this._isAnchorHovered=!0,this.props.isSticky||this._showPopup()},this.onAnchorLeave=()=>{this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky||this._hidePopup(!0)},this.onAnchorLongPress=()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorLongPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!0,this.props.isSticky?this.showImmediately():this._showPopup()},this.onAnchorPress=()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky?this.hideImmediately():this._hidePopup(!1)},this._defaultAllowShowPopupConditions=()=>(this._isAnchorHovered||this._isAnchorLongPressed)&&!this.state.shouldShowPopup,this._defaultAllowHidePopupConditions=()=>!this._isAnchorHovered&&!this._isAnchorLongPressed&&!this._isPopupHovered&&this.state.shouldShowPopup,this._allowShowPopup=()=>this._defaultAllowShowPopupConditions(),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onOpened=e=>{this.onOpened(e),this.props.onOpened&&this.props.onOpened()},this._onClosed=()=>{this.onClosed(),this.props.onClosed&&this.props.onClosed()},this._onPopupEnter=()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupEnter`),this._isPopupHovered=!0},this._onPopupLeave=()=>{d.log(c.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupLeave`),this._isPopupHovered=!1,this.props.isSticky||this._hidePopup(!0)},this._onAnimatedPopupRef=e=>{this._animatedPopupRef=e||void 0}}_buildState(e,t){const i={};return t&&(i.shouldShowPopup=!1),i}render(){return!this.state.shouldShowPopup||this.props.isSticky?null:(0,a.jsx)(n.View,{ref:this._onAnimatedPopupRef,style:[m.transparentWrapper,this.props.style],opacity:0,onMouseEnter:this._onPopupEnter,onMouseLeave:this._onPopupLeave,children:this.renderContent()})}componentDidMount(){super.componentDidMount(),this.props.isSticky&&(this._getContext().isPresentedInGenericDesktopModal||r.default.subscribe(this._onBack))}componentWillUnmount(){super.componentWillUnmount(),r.default.unsubscribe(this._onBack)}}t.HoverPopup=S},914889:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(344175),l=o.__importStar(i(187140)),c=o.__importDefault(i(150343)),d=o.__importDefault(i(369347)),u=o.__importDefault(i(638260)),h=o.__importStar(i(44717)),p=o.__importDefault(i(958868)),g=o.__importDefault(i(288547)),C=i(815146),m=o.__importDefault(i(524526)),S=o.__importStar(i(85385)),_=o.__importStar(i(94534)),f=i(26703),y=o.__importStar(i(704704)),T=o.__importDefault(i(341994)),b=o.__importDefault(i(252089)),v=o.__importDefault(i(942724)),I=o.__importDefault(i(960282)),w=o.__importDefault(i(421334)),P=o.__importDefault(i(660401)),M=i(154235),D=i(641400),A=o.__importDefault(i(20758)),k=o.__importDefault(i(601274)),R=o.__importDefault(i(760989)),x=o.__importDefault(i(360718)),L=i(548087),B=(0,f.lazyProperties)({translateButtonText:()=>s.Styles.createTextStyle({font:A.default.font.uiDisplayRegular}),translateButton:()=>s.Styles.createViewStyle({minWidth:210}),translBtnContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",marginBottom:30}),containerDesktop:()=>s.Styles.createViewStyle({position:"absolute",flexDirection:"row",alignItems:"center",justifyContent:"space-between",alignSelf:"center"}),containerMobile:()=>s.Styles.createViewStyle({flexDirection:"row",flexWrap:"nowrap",alignItems:"center",justifyContent:"space-between",alignSelf:"center"}),absolute:()=>s.Styles.createViewStyle({position:"absolute"}),actionBtnsContainer:()=>s.Styles.createViewStyle({flexGrow:1,flexShrink:1,borderRadius:16,paddingVertical:5,paddingHorizontal:16,marginHorizontal:12,flexWrap:"nowrap"}),minWidthContainer:()=>s.Styles.createViewStyle({minWidth:440}),langDetected:()=>s.Styles.createTextStyle({fontSize:A.default.fontSize.size14,marginRight:10,flexWrap:"wrap",flexGrow:1,flexShrink:1}),settingsContainer:()=>s.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center"}),pauseContainer:()=>s.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center",marginRight:8}),menuPadding:()=>s.Styles.createViewStyle({paddingLeft:16,paddingRight:16}),anchor:()=>s.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,height:0})});class V extends p.default{constructor(){super(...arguments),this._onMobileAnchorRef=e=>{this._mobileAnchorRef=e||void 0},this._onDesktopAnchorRef=e=>{this._desktopAnchorRef=e||void 0},this._pressPause=e=>{e.stopPropagation();const t=R.default.newCauseId();S.log(C.LogTraceArea.CallingUI,`_togglePstnTranslationPause causeId: ${t}`),this.state.isPaused?d.default.InCallBotService.setPstnTranslationPause(this.props.callId,!1,t):d.default.InCallBotService.setPstnTranslationPause(this.props.callId,!0,t)},this._pressTranslateButton=()=>{const e=R.default.newCauseId();u.default.onStartPstnTranslationClicked(this.props.callId,e),this._canTranslateNow()?this._startTranslateCall(!1):(d.default.InCallBotService.preheatTranslator(this.props.callId,e),this._toggleSettingsMenu())},this._toggleSettingsMenu=()=>{const e=R.default.newCauseId(),t=this._getRootViewId(),i=()=>this._desktopAnchorRef;k.default.clearTimeout(this._hideMenuTimeout);const o={causeId:e,rootViewId:t,callId:this.props.callId,conversationMri:this.state.conversationMri||this.props.conversationMri,anchor:i,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,useLightTheme:this.props.useLightTheme,onClose:()=>{k.default.clearTimeout(this._hideMenuTimeout)},isPstnCall:this.props.isPstnCall,callerContext:()=>this._getContext(),callUIState:this.props.callUIState,menuComponentStyle:B.menuPadding,update:this._updateTranslationSettings.bind(this),useAlertForDesktop:this._useAlertForDesktop.bind(this),changeLanguage:this._actuallyChangeLanguage.bind(this),startTranslation:this._startTranslationAndHideSettings.bind(this),isPstnTranslation:!0,isSkypeTranslation:!1};(0,L.showTranslationMenu)(o)},this._hideTranslationSettingsMenu=()=>{g.default.closeIfNeeded(this._getRootViewId(),R.default.newCauseId())},this._startTranslationAndHideSettings=()=>{this._startTranslateCall(!0)},this._startTranslateCall=e=>{const t=R.default.newCauseId();this._canTranslateNow()?this.state.isTranslating?(S.log(C.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall stopPstnTranslation causeId: ${t}`),d.default.InCallBotService.stopPstnTranslation(this.props.callId,t)):(S.log(C.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall startPstnTranslation causeId: ${t}`),d.default.InCallBotService.startPstnTranslation(this.props.callId,t).then((()=>{e&&(k.default.clearTimeout(this._hideMenuTimeout),this._hideMenuTimeout=k.default.setTimeout((()=>this._hideTranslationSettingsMenu()),this.state.settings.translationSettingsHideTimeout))}))):S.log(C.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall pressed but info missing. causeId: ${t}`)},this._actuallyChangeLanguage=(e,t,i)=>{const o=c.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech;if(n.includes(o,t)){let o={};const a=this.state.conversationMri||this.props.conversationMri;let n;e?(n=m.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(a),m.default.setLocalPstnCallTranlatorBotSpokenLanguageLocale(a,t),o={localLanguageLocale:t}):(n=m.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(a),m.default.setOtherPstnCallTranlatorBotSpokenLanguageLocale(a,t),o={otherLanguageLocale:t});const s=d.default.InCallBotService.getPstnTranslationSessionId(this.props.callId);u.default.onPstnTranslationLanguageChange(this.props.callId,s,e,null!=n?n:"",t,i),this.setState(o,(()=>{this._updateTranslationSettings(i)}))}else S.log(C.LogTraceArea.CallingUI,`_togglePstnTranslationLanguageMenu newLocale ${t} not in supported langs list. causeId: ${i}`);this._toggleSettingsMenu()}}_buildState(e,t){return{settings:c.default.getS4LCMCFeatures().pstnTranslation,conversationMri:d.default.CallingStore.getCallConversationMri(e.callId),isTranslating:d.default.InCallBotService.isPstnTranslationEnabled(e.callId),translationVoice:T.default.getCallTranslatorBotTranslationVoice(),isUsingStackNavigationContext:v.default.isUsingStackNavigationContext(),isMobileScreenReaderEnabled:w.default.isMobileScreenReaderEnabled(),localLanguageLocale:m.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),otherLanguageLocale:m.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),callParticipantCount:d.default.CallingStore.connectedParticipantsCount(e.callId),isCaptioning:d.default.InCallBotService.isCaptioningEnabled(e.callId),isVoiceTranslating:d.default.InCallBotService.isVoiceTranslationEnabled(e.callId),isSkypeTranslating:d.default.InCallBotService.isSkypeTranslationEnabled(e.callId),userPrimaryColor:b.default.getPrimaryColor(),availableWidth:I.default.getWidth(this._getRootViewId()),isPaused:d.default.InCallBotService.isPstnTranslationPaused(e.callId)}}componentDidMount(){if(super.componentDidMount(),!this.state.localLanguageLocale&&this._isEnabled()){const e=m.default.getLocalCallTranslatorBotSpokenLanguageLocale();if(e){const t=R.default.newCauseId();this._actuallyChangeLanguage(!0,e,t)}}}componentWillUnmount(){super.componentWillUnmount(),k.default.clearTimeout(this._hideMenuTimeout)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),x.default.setUpMenu(this._toggleSettingsMenu)}_canTranslateNow(){return this.state.translationVoice&&this.state.localLanguageLocale&&this.state.otherLanguageLocale}_updateTranslationSettings(e){this.state.isTranslating&&!this.state.isPaused?(S.log(C.LogTraceArea.CallingUI,"_updatePstnTranslationSettings requesting update of translation settings"),d.default.InCallBotService.startPstnTranslation(this.props.callId,e)):!this.state.isTranslating&&this._canTranslateNow()&&this._startTranslationAndHideSettings()}_getLanguageNameFromLocale(e){const t=_.getShortLanguageTitle(e);return n.isEmpty(t)?e:t}_isEnabled(){return this.state.settings.enabled&&!this.state.isCaptioning&&!this.state.isVoiceTranslating&&!this.state.isSkypeTranslating&&this.state.conversationMri&&h.isPhoneMri(this.state.conversationMri)&&1===this.state.callParticipantCount}_useAlertForDesktop(){return!0}_getDetectedLangs(e){if(this.state.localLanguageLocale&&this.state.otherLanguageLocale){const t=this._getLanguageNameFromLocale(this.state.localLanguageLocale),i=this._getLanguageNameFromLocale(this.state.otherLanguageLocale),o=y.getParts("CallTranscription.DetectedLanguages",{language1:t,language2:i});return(0,a.jsx)(s.Text,{style:s.Styles.combine(B.langDetected,e.themeStyles.primaryTextColorStyle),children:o})}}render(){var e,t;if(!this._isEnabled())return null;const i=s.Styles.createViewStyle({marginBottom:null!==(e=this.props.marginBottom)&&void 0!==e?e:30},!1),o=s.Styles.createViewStyle({bottom:null!==(t=this.props.marginBottom)&&void 0!==t?t:110},!1),n=s.Styles.createViewStyle({maxWidth:this.state.availableWidth-30},!1),c=this.state.isUsingStackNavigationContext?void 0:(0,a.jsx)(s.View,{style:B.anchor,ref:this._onDesktopAnchorRef}),d=this._getContext();if(this.state.isTranslating){const e=this.state.isPaused?y.getString("LanguageAndTranslationSettingsPanel.TranslationResume"):y.getString("LanguageAndTranslationSettingsPanel.TranslationPause"),t=d.themeStyles.primaryBackgroundColorStyle,u=this.state.availableWidth<=440,h=this.state.isUsingStackNavigationContext||u?[B.containerMobile,B.actionBtnsContainer,i,n,t,this.props.style]:[B.containerDesktop,B.actionBtnsContainer,B.minWidthContainer,o,t,this.props.style];u&&!this.state.isUsingStackNavigationContext&&h.push(B.absolute);const p=d.themeColors.buttonTextColor,g=d.themeColors.buttonBackgroundColor;return(0,a.jsxs)(s.View,{ref:this._onMobileAnchorRef,style:s.Styles.combine(h),onPress:this._toggleSettingsMenu,children:[this._getDetectedLangs(d),(0,a.jsxs)(r.Row,{children:[(0,a.jsx)(l.default,{style:[B.pauseContainer],icon:this.state.isPaused?D.SkypeIcon.PauseGradient:D.SkypeIcon.Pause,iconColor:this.state.isPaused?this.state.userPrimaryColor:p,iconSize:D.IconSize.size20,size:l.ActionButtonSize.Small,backgroundColor:g,title:e,onPress:this._pressPause,accessibilityTraits:s.Types.AccessibilityTrait.Button,accessibilityLabel:e,importantForAccessibility:s.Types.ImportantForAccessibility.Auto}),(0,a.jsx)(l.default,{style:[B.settingsContainer],icon:D.SkypeIcon.Settings,iconColor:p,iconSize:D.IconSize.size20,size:l.ActionButtonSize.Small,backgroundColor:g,title:e,onPress:this._toggleSettingsMenu,accessibilityTraits:s.Types.AccessibilityTrait.Button,accessibilityLabel:y.getString("LanguageAndTranslationSettingsPanel.TranslationSettings"),importantForAccessibility:s.Types.ImportantForAccessibility.Auto})]}),c]})}const u=this.state.isUsingStackNavigationContext?[B.translBtnContainer,i]:[B.containerDesktop,o];this.props.style&&u.push(s.Styles.createViewStyle(this.props.style,!1));const h=y.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall");return(0,a.jsxs)(s.View,{ref:this._onMobileAnchorRef,style:u,children:[(0,a.jsx)(P.default,{hoverText:h,title:h,accessibilityLabel:h,icon:D.SkypeIcon.Translate,iconSize:D.IconSize.size20,iconPositon:M.SXButtonIconPosition.Start,onPress:this._pressTranslateButton,buttonSize:M.SXButtonSize.Medium,style:B.translateButton,textStyleOverride:[B.translateButtonText]},"open-chat-button"),c]})}}t.default=V},551890:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(970035)),r=i(26703),l=o.__importDefault(i(791384)),c=i(16549),d=i(641400),u=i(262725),h=o.__importDefault(i(497910)),p=(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:c.Color.white,minHeight:40,borderRadius:20,marginBottom:20,paddingHorizontal:20,paddingVertical:5,marginTop:-55}),statusText:()=>n.Styles.createTextStyle({color:c.Color.gray300}),statusTextAccessible:()=>n.Styles.createTextStyle({color:c.Color.gray400}),iconPadding:()=>n.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>n.Styles.createViewStyle({paddingLeft:10}),warningAnimatedView:()=>n.Styles.createViewStyle({overflow:"visible",height:0})});class g extends h.default{constructor(){super(...arguments),this._warningViewAnimatedOpacityValue=new n.Animated.Value(1),this._warningViewAnimatedOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._warningViewAnimatedOpacityValue})}componentDidMount(){super.componentDidMount(),l.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.viewInformation.warningText!==this.props.viewInformation.warningText&&l.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}showOrHideWarningView(e,t=!0,i=0){if(this.isComponentMounted()){const o=e?1:0;t?n.Animated.timing(this._warningViewAnimatedOpacityValue,{toValue:o,duration:200,delay:i,easing:n.Animated.Easing.Out()}).start():this._warningViewAnimatedOpacityValue.setValue(o)}}render(){const e=this.props.style?n.Styles.createViewStyle(this.props.style,!1):void 0,t=[p.container];this.props.viewInformation.opacityStyle&&t.push(this.props.viewInformation.opacityStyle);const i=this.props.viewInformation.icon?this._getWarningIcon(this.props.viewInformation.icon):void 0,o=this.props.viewInformation.warningText?this._getWarningText(this.props.viewInformation.warningText):void 0;return(0,a.jsx)(n.Animated.View,{style:[this._warningViewAnimatedOpacityStyle,p.warningAnimatedView,e],blockPointerEvents:!0,ignorePointerEvents:!0,children:(0,a.jsxs)(n.Animated.View,{style:[t,e],children:[i,o]})})}_getWarningText(e){return(0,a.jsx)(u.BodyText,{style:this._useAccessibleTheme()?p.statusTextAccessible:p.statusText,children:e})}_getWarningIcon(e){return(0,a.jsx)(s.default,{icon:e,size:d.IconSize.size15,color:this.props.viewInformation.optionalIconColor||c.Color.gray300,style:this._getContext().isRTL?p.iconPaddingRTL:p.iconPadding})}}t.default=g},918642:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageConversationCommand=t.MergeIncomingCallCommand=t.AcceptIncomingCallCommand=t.RejectIncomingCallCommand=void 0;const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importStar(i(971988)),s=i(815146),r=o.__importStar(i(800662)),l=o.__importStar(i(7040)),c=o.__importStar(i(85385)),d=o.__importDefault(i(863132)),u=o.__importDefault(i(139221)),h=o.__importDefault(i(760989)),p=o.__importDefault(i(638260)),g=i(873324);t.RejectIncomingCallCommand=class{constructor(e,t){this._callId=e,this._setFocusAfterReject=t}execute(){const e=h.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`RejectIncomingCallCommand callId: ${this._callId} causeId: ${e}`),a.default.CallingStore.rejectCall(this._callId,e),p.default.trackUserAction(g.CallUserActionType.RejectCall,this._callId,e,s.NavigationCallOrigin.IncomingRing),this._setFocusAfterReject&&r.setFocus(r.FocusEvent.DeclineCallFromCallBanner)}};t.AcceptIncomingCallCommand=class{constructor(e,t,i){this._callId=e,this._callInfo=t,this._skipNavigation=i,this._executed=!1}execute(e=!1){if(this._executed)return void c.warn(s.LogTraceArea.CallingUI,`Tried to execute AcceptIncomingCallCommand multiple times. withVideo:${e}; callId: ${this._callId}`);this._executed=!0;const t=h.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`AcceptIncomingCallCommand withVideo:${e}; callId: ${this._callId}; causeId: ${t}`);const i=!u.default.isWindows10Plus();p.default.onCalleeAnsweredCall(this._callId,"incomingRingCommands",t),a.default.CallNavigationHelper.answerOrJoinCall({conversationMri:this._callInfo.conversationMri,callId:this._callId,withVideo:e,skipNavigation:this._skipNavigation,knownToBeAnswer:i,origin:s.NavigationCallOrigin.CallControls},t)}canExecuteWithVideo(){return a.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}};t.MergeIncomingCallCommand=class{constructor(e){this._callId=e}execute(){const e=h.default.newCauseId();c.log(s.LogTraceArea.CallingUI,`MergeIncomingCallCommand callId: ${this._callId}; causeId: ${e}`),a.default.CallingStore.mergeCall(this._callId,e)}};t.MessageConversationCommand=class{constructor(e){this._conversationMri=e}execute(e,t){d.default.postMessageFromInput(this._conversationMri,t,l.convertRawTextToInputEntities(e),n.MessageTypes.RichText)}}},305931:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importStar(i(187140)),l=i(26178),c=o.__importStar(i(873324)),d=i(16549),u=o.__importDefault(i(601976)),h=i(67850),p=i(815146),g=i(918642),C=i(182042),m=o.__importDefault(i(97595)),S=i(26703),_=o.__importStar(i(704704)),f=i(641400),y=(i(371221),i(677790),(0,S.lazyProperties)({buttonRow:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonRowReversed:()=>s.Styles.createViewStyle({flexDirection:"row-reverse"}),buttonSpacing:()=>s.Styles.createViewStyle({marginHorizontal:6})})),T={key:"green-gradient",colors:(0,h.getButtonsAgnosticGradientFillColor)(d.AgnosticGradientFillButtonColors.green)},b=_.getString("CallControls.CallButtonDeclineLabel");class v extends C.IncomingRingControlsBase{constructor(e){super(c.CallControlContext.IncomingRingControls,e),this._onAnswerCallKeyboardShortcut=()=>(this._answerCommand.execute(),!0),this._onRejectCallKeyboardShortcut=()=>(this._rejectCommand.execute(),!0),this._onRejectCall=()=>{this._rejectCommand.execute()},this._onAnswerCallWithVideo=()=>{this.props.onPress&&(this.props.onPress(),this.props.fromNotification),this._answerCommand.execute(!0)},this._onAnswerCall=()=>{this.props.onPress&&(this.props.onPress(),this.props.fromNotification),this._answerCommand.execute()},this._onMergeCall=()=>{this.props.onPress&&this.props.onPress();new g.MergeIncomingCallCommand(this.props.callId).execute()}}_buildState(e,t){return this._initializeCommands(e,e.forMobile),{conversationName:u.default.getDisplayName(e.conversationMri)||_.getString("Notifications.UnknownUserShort"),allowVideoButton:this._answerCommand.canExecuteWithVideo()}}componentDidMount(){super.componentDidMount(),this._registerKeyboardHandlers()}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers()}_buttonSize(){return n.isUndefined(this.props.buttonSize)?l.CallButtonSize.Large:this.props.buttonSize}_registerKeyboardHandlers(){m.default.addHandler(p.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),m.default.addHandler(p.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}_unregisterKeyboardHandlers(){m.default.removeHandler(p.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),m.default.removeHandler(p.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}render(){const e=this._buttonSize(),t=this.props.hasSmallerSpacing?l.CallButtonSpacing.Small:l.CallButtonSpacing.Default;let i,o;if(this.props.showMergeButton){const o=this.props.isMergePossible?_.getString("CallControls.CallButtonMergeLabel",{conversationName:this.state.conversationName}):_.getString("CallControls.CallButtonMergeDisabledLabel");i=(0,a.jsx)(l.CallButton,{icon:f.SkypeIcon.CallMerge,isToggledOn:!1,title:o,onPress:this._onMergeCall,isCallMergeButton:!0,size:e,accessibilityLabel:o,spacing:t,isDisabled:!this.props.isMergePossible})}if(this.state.allowVideoButton){const e=_.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationName});o=(0,a.jsx)(r.default,{icon:f.SkypeIcon.Video,title:e,onPress:this._onAnswerCallWithVideo,size:r.ActionButtonSize.Small,accessibilityLabel:e,userColor:T,style:y.buttonSpacing})}const n=_.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationName});return(0,a.jsxs)(s.View,{style:[y.buttonRow,void 0,this.props.style],children:[i,o,(0,a.jsx)(r.default,{ref:this._onAnswerCallButtonRef,icon:f.SkypeIcon.CallStart,title:n,onPress:this._onAnswerCall,size:r.ActionButtonSize.Small,accessibilityLabel:n,userColor:T,style:y.buttonSpacing,autoFocus:!0}),(0,a.jsx)(r.default,{icon:f.SkypeIcon.CallEnd,title:b,onPress:this._onRejectCall,size:r.ActionButtonSize.Small,accessibilityLabel:b,backgroundColor:d.Color.red,style:y.buttonSpacing})]})}}t.default=v},182042:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IncomingRingControlsBase=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(119557)),s=o.__importDefault(i(369347)),r=i(873324),l=i(815146),c=i(918642),d=o.__importStar(i(85385)),u=o.__importDefault(i(497910));class h extends u.default{constructor(e,t){super(t),this._instrumentationContext=e,this._mediaActionEvent=e=>{if(s.default.CallingStore.isCallIncoming(this.props.callId)){d.track(new r.MediaActionEvent(this._instrumentationContext,r.MediaActionEventResult.AnswerCall));const t=s.default.CallingStore.incomingCallHasVideo(this.props.callId);d.log(l.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent answering call (video: ${t}); causeId: ${e}`),t&&this._answerCommand.canExecuteWithVideo()?this._answerCommand.execute(!0):this._answerCommand.execute()}else d.track(new r.MediaActionEvent(this._instrumentationContext,r.MediaActionEventResult.Ignore)),d.log(l.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent no action; causeId: ${e}`)},this._onAnswerCallButtonRef=e=>{this._answerCallButton=e||void 0}}_initializeCommands(e,t){this._forMobile=t,this._rejectCommand=new c.RejectIncomingCallCommand(e.callId,!t),this._answerCommand=new c.AcceptIncomingCallCommand(e.callId,e,t)}componentDidMount(){super.componentDidMount(),this._forMobile&&a.delay((()=>{this.isComponentMounted()&&this._answerCallButton&&this._answerCallButton.requestFocus()}),100),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),n.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=n.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe((()=>{d.track(new r.MaybeEndCallFromAndroidBtScoDisconnectEvent(this._instrumentationContext))})))}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}}t.IncomingRingControlsBase=h},532747:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(132680)),l=i(815146),c=o.__importStar(i(85385)),d=o.__importStar(i(704704)),u=i(262725),h=o.__importDefault(i(760989));class p extends s.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{const t=h.default.newCauseId();c.log(l.LogTraceArea.CallingUI,"StackNavAudioOnlyToast disable audio only clicked. causeId:"+t),r.default.enableIncomingVideo(this.props.callId,t)}}componentDidMount(){super.componentDidMount(),n.Accessibility.announceForAccessibility(d.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement"))}componentWillUnmount(){super.componentWillUnmount(),n.Accessibility.announceForAccessibility(d.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement"))}render(){return(0,a.jsxs)(n.View,{style:this.props.containerStyle,children:[(0,a.jsx)(u.BodyText,{style:this.props.textStyle,numberOfLines:1,children:d.getString("IncomingVideoDisabledToast.BannerTitle")}),(0,a.jsx)(n.Button,{onPress:this._onStopPress,children:(0,a.jsx)(u.BodyText,{style:this.props.linkStyle,children:d.getString("IncomingVideoDisabledToast.ResumeLinkText")})})]})}}t.default=p},661890:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(395527)),l=i(315742),c=o.__importDefault(i(341714)),d=i(26703),u=o.__importDefault(i(211618)),h=i(16549),p=o.__importDefault(i(577267)),g=o.__importDefault(i(90882)),C=(0,d.lazyProperties)({unhandledBubbleContainer:()=>n.Styles.createViewStyle({backgroundColor:h.Color.white,borderRadius:10,paddingVertical:5})});class m extends s.ComponentBase{constructor(){super(...arguments),this._animationConfig={presentOffset:{x:200,y:15},dismissOffset:{x:200,y:15},duration:350,easing:n.Animated.Easing.OutBack()},this.updateAnchorInfo=e=>{const t=e||this.props.getAnchorInfo(this.props.creatorKey);this._popupView&&t&&this._popupView.updatePosition(t)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getAnchorInfo=()=>this.props.getAnchorInfo(this.props.creatorKey),this._getPopUpPositions=e=>[l.PopupAnchorPositon.Bottom],this._getAnimationDirection=e=>e?this.props.alignRight?l.PopupAnchorPositon.Right:l.PopupAnchorPositon.Left:l.PopupAnchorPositon.Bottom,this._renderPopupContent=(e,t,i,o,n)=>{const s=this.props.callParticipantReaction.reaction,l=(0,a.jsx)(g.default,{id:s.cuid,mri:s.creator,content:this.props.callParticipantReaction.content,reaction:this.props.callParticipantReaction.reaction,gradientColors:this.props.callParticipantReaction.gradientColors,textTimeoutMs:r.default.getTextTimeoutBasedOnContent(s.content),hideBackground:!0,hideUserIcon:!n,style:n?C.unhandledBubbleContainer:void 0,onPress:this.props.onReactionTap?this._onPress:void 0},"reaction"+s.cuid);return n?l:(0,a.jsx)(p.default,{anchorPosition:c.default.popupAnchorPositionToString(e),anchorOffset:t,popupWidth:i,popupHeight:o,borderRadius:10,strokeColor:h.Color.white,fillColor:h.Color.white,shadow:"0px 2px 4px rgba(0, 0, 0, 0.25)",skipPopupAutoFocus:!0,children:l})},this._onPress=()=>{this.dismiss(!1),this.props.onReactionTap&&this.props.onReactionTap()}}componentDidMount(){super.componentDidMount(),this.props.callParticipantReaction&&this.updateAnchorInfo(),this._rectChangeSubscriptionToken=this.props.getAnchorRectChanges(this.props.creatorKey,this.updateAnchorInfo)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.callParticipantReaction&&this.updateAnchorInfo()}componentWillUnmount(){super.componentWillUnmount(),this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}dismiss(e=!1){this._popupView&&this._popupView.dismiss(e)}render(){if(!this.props.callParticipantReaction)return null;const e=this.props.callParticipantReaction;return(0,a.jsx)(u.default,{ref:this._onPopupViewRef,animateDismissal:!0,animationConfig:this._animationConfig,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,getAnimationDirection:this._getAnimationDirection,renderPopup:this._renderPopupContent,timeoutMs:5e3,allowTaps:!0,onDismissPopup:()=>{this.props.onRemoveReaction&&this.props.onRemoveReaction(e)}},"reaction"+this.props.callParticipantReaction.reaction.cuid)}}t.default=m},601373:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(174958),s=o.__importStar(i(496486)),r=o.__importStar(i(516778)),l=i(217041),c=o.__importDefault(i(306794)),d=i(460515),u=i(815146),h=o.__importDefault(i(661890)),p=o.__importStar(i(85385)),g=i(26703),C=o.__importDefault(i(924849)),m=o.__importDefault(i(363091)),S=o.__importDefault(i(597285)),_=(0,g.lazyProperties)({container:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"})});class f extends l.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new C.default,this.showMessage=e=>{p.log(u.LogTraceArea.CallReactions,"InlineCallStageReactionsView.showMessage cuid: "+e.reaction.cuid);const t=this.state.callParticipantReactions,i=e.reaction.creator,o=m.default.isMyMri(i)?d.CallStageElementKeys.localUserKey:i;t[o]=e,s.each(s.keys(t),(e=>{if(e!==o){const t=this._mountedRefsMap.ref(e);t&&t.dismiss()}}));const a=this.state.sequence+1;return this.setState({callParticipantReactions:t,sequence:a}),!0},this.dismissReaction=e=>{p.log(u.LogTraceArea.CallReactions,"InlineCallStageReactionsView.dismissReaction, key: "+n.pii.Omit(e));const t=this.state.callParticipantReactions;if(t[e]){delete t[e];const i=this.state.sequence+1;this.setState({callParticipantReactions:t,sequence:i})}},this._onAnimationEnd=e=>{if(this.isComponentMounted()){const t=e.reaction.creator,i=m.default.isMyMri(t)?d.CallStageElementKeys.localUserKey:t,o=e.reaction.cuid,a=this.state.callParticipantReactions;if(a[i]&&a[i].reaction.cuid===o){delete a[i];const e=this.state.sequence+1;this.setState({callParticipantReactions:a,sequence:e})}}},this._getAnchorInfo=e=>this.props.getAnchorInfo(e)||{rect:{x:this.props.alignRight?this.props.parentDimensions.width:0,y:20,height:this.props.topOffsetForUnhandledReactions,width:this.props.topOffsetForUnhandledReactions/2},hidden:!0}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutoff,o=c.default.getLastReaction(e.callId,i),a={lastReactionInfo:o&&S.default.callReactionInfoForReaction(o),reactionsCutoff:i};return t&&(a.callParticipantReactions={},a.sequence=0),a}componentDidMount(){super.componentDidMount();const e=this.props.getCallReactionsDisplayHelper();e.registerUnhandledReactionCallback(this.showMessage),e.registerUnhandledReactionDismissCallback(this.dismissReaction)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const o=t.lastReactionInfo?t.lastReactionInfo.reaction.cuid:void 0,a=this.state.lastReactionInfo?this.state.lastReactionInfo.reaction.cuid:void 0;this.state.lastReactionInfo&&o!==a&&this.props.getCallReactionsDisplayHelper().showReaction(this.state.lastReactionInfo)}componentWillUnmount(){super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionCallback(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionDismissCallback()}updateElementDimensions(e,t){const i=this._mountedRefsMap.ref(e);i&&i.updateAnchorInfo()}_renderReactionsFeed(e,t){return(0,a.jsx)(h.default,{ref:this._mountedRefsMap.onComponentRef(e),creatorKey:e,callParticipantReaction:t,alignRight:this.props.alignRight,onRemoveReaction:this._onAnimationEnd,getAnchorInfo:this._getAnchorInfo,getAnchorRectChanges:this.props.getAnchorInfoChanges,onReactionTap:this.props.onReactionTap},e+"feed")}render(){const e=s.map(this.state.callParticipantReactions,((e,t)=>e?this._renderReactionsFeed(t,e):void 0));return(0,a.jsx)(r.View,{style:[_.container,this.props.style],blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents,children:e})}}t.default=f},740275:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IosRouteControlButton=void 0;const o=i(197582),a=i(785893),n=o.__importDefault(i(119557)),s=o.__importStar(i(516778)),r=o.__importDefault(i(958868)),l=o.__importDefault(i(827361));class c extends r.default{render(){const e=n.default.routePickerView();return(0,a.jsxs)(s.View,{style:this.props.style,children:[this.props.children,(0,a.jsx)(e,{style:l.default.absoluteFill,accessibilityLabel:this.props.accessibilityLabel})]})}}t.IosRouteControlButton=c,t.default=c},405716:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(152803),r=i(460515),l=o.__importDefault(i(958868)),c=i(26703),d=i(16549),u=o.__importDefault(i(827361)),h=i(641400),p=o.__importDefault(i(132680)),g=(0,c.lazyProperties)({newLocalViewContainer:()=>n.Styles.createViewStyle({height:120,width:200,position:"absolute",right:0,top:0,overflow:"visible",shadowOffset:{width:0,height:4},shadowRadius:4,shadowColor:d.Color.blackOverlay70}),localParticipantBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:d.Color.callStageLight}),backgroundStyleLightTheme:()=>n.Styles.createViewStyle({backgroundColor:d.Color.gray50})});class C extends l.default{constructor(){super(...arguments),this._getStylesBasedOnIsLandscape=e=>[u.default.flexOne,g.newLocalViewContainer,this.props.isCompactView?Object.assign({borderRadius:h.IconSize.size8,overflow:"hidden"},p.default.getLocalPreviewMobilesShape(e)):void 0],this._participantLayoutController={getStyles:(e,t,i)=>this._getStylesBasedOnIsLandscape(t),getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?g.backgroundStyleLightTheme:g.localParticipantBackgroundStyle,isHidden:()=>!1},this._layoutController=()=>this._participantLayoutController}render(){return(0,a.jsx)(s.CallParticipantView,{renderKey:r.CallStageElementKeys.localUserKey,parentViewId:"LocalCallParticipantView",getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useDarkBackground:!0,desktopNameTag:!0,showContextMenu:!0,layoutController:this._layoutController,iconSize:64,iconOpacity:1,isGroupCall:!1,useLightTheme:this.props.useLightTheme},r.CallStageElementKeys.localUserKey)}}t.default=C},351695:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(216837)),s=o.__importStar(i(516778)),r=o.__importDefault(i(369347)),l=i(815146),c=o.__importStar(i(85385)),d=o.__importDefault(i(655192)),u=o.__importDefault(i(827361));class h extends s.Component{constructor(){super(...arguments),this._callingVideoView=null,this._rendererPromise=null,this._useNewVideoView=!1,this._onCallingVideoView=e=>{this._callingVideoView=e,this._resetRenderer()}}render(){return this._useNewVideoView&&n.VideoView?(0,a.jsx)(n.VideoView,{ref:this._onCallingVideoView}):n.default&&(0,a.jsx)(n.default,{ref:this._onCallingVideoView,style:u.default.absoluteFill,isLocal:!0,parentView:h.name,nametag:this.props.nametag})}componentWillUnmount(){c.log(l.LogTraceArea.Calling,"LocalVideoPreview: componentWillUnmount"),this._clearRenderer()}componentDidUpdate(e){this.props.device!==e.device&&(c.log(l.LogTraceArea.Calling,"LocalVideoPreview: component change requiring new renderer"),this._resetRenderer())}_clearRenderer(){this._rendererPromise&&(this._rendererPromise.then((e=>e.dispose())),this._rendererPromise=null)}_resetRenderer(){this._clearRenderer(),this._callingVideoView&&(c.log(l.LogTraceArea.Calling,`LocalVideoPreview: create renderer { device: ${this.props.device} }`),this._rendererPromise=r.default.DeviceStore.createPreviewRenderer(this._callingVideoView.getVideoContainer(),this.props.options,this.props.device),this._rendererPromise.fail((e=>{c.warn(l.LogTraceArea.Calling,"LocalVideoPreview: DeviceStore.createPreviewRenderer failed. "+d.default.errorAsString(e))})))}}t.default=h},364038:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MicrophoneActivityIcon=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(667294),r=o.__importStar(i(970035)),l=o.__importDefault(i(670363)),c=i(641400),d=i(97312),u=(0,i(26703).lazyProperties)({microphoneActivityIndicator:()=>n.Styles.createViewStyle({position:"absolute"})}),h=e=>{var{style:t}=e,i=o.__rest(e,["style"]);const h=(0,d.useMicrophoneLevel)(250)/.8,p=(0,s.useRef)(n.Animated.createValue(h)),g=(0,s.useRef)(n.Styles.createAnimatedViewStyle({opacity:p.current}));return(0,s.useEffect)((()=>{const e=l.default.timing(p.current,{toValue:h,duration:250,easing:n.Animated.Easing.Linear(),useNativeDriver:!0});return e.start(),()=>{e.stop()}}),[h]),(0,a.jsx)(r.AnimatedIconView,Object.assign({},i,{style:[...t,u.microphoneActivityIndicator,g.current],icon:c.SkypeIcon.MicrophoneActivity}))};t.MicrophoneActivityIcon=e=>{var{isMuted:t,legacy:i=!1}=e,n=o.__rest(e,["isMuted","legacy"]);return(0,a.jsxs)(s.Fragment,{children:[!t&&(0,a.jsx)(h,Object.assign({},n)),i?(0,r.simpleIcon)(n.icon,n.color,n.size,n.style):(0,a.jsx)(r.default,Object.assign({},n))]})}},842628:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=o.__importStar(i(496486)),r=o.__importDefault(i(119557)),l=o.__importStar(i(516778)),c=i(148540),d=o.__importStar(i(187140)),u=o.__importDefault(i(150343)),h=i(26178),p=i(737298),g=o.__importDefault(i(625209)),C=o.__importDefault(i(369347)),m=i(873324),S=i(460515),_=o.__importDefault(i(132680)),f=i(815146),y=o.__importDefault(i(453761)),T=o.__importStar(i(85385)),b=i(26703),v=o.__importStar(i(704704)),I=(o.__importDefault(i(201721)),o.__importDefault(i(942724))),w=i(276602),P=o.__importDefault(i(421334)),M=i(16549),D=i(641400),A=o.__importDefault(i(497910)),k=o.__importDefault(i(760989)),R=o.__importDefault(i(92179)),x=i(96575),L=i(364038),B=o.__importDefault(i(815299)),V=o.__importDefault(i(638260)),O=(0,b.lazyProperties)({container:()=>l.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between",overflow:"visible",alignItems:"center",flexGrow:1,maxWidth:"100%"}),containerVertical:()=>l.Styles.createViewStyle({flexDirection:"column",justifyContent:"space-between",alignItems:"center",flexGrow:1,maxWidth:80,overflow:"visible",maxHeight:"100%"}),buttonsGap:()=>l.Styles.createViewStyle({marginHorizontal:8}),primaryControlsContainer:()=>l.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),primaryControlsContainerVertical:()=>l.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonControls:()=>l.Styles.createViewStyle({flexDirection:"row",minWidth:44,flexGrow:1,flexShrink:1,width:"50%"}),buttonControlsVertical:()=>l.Styles.createViewStyle({flexDirection:"column",minHeight:44,flexGrow:1,flexShrink:1,height:"50%"}),buttonControlsLeft:()=>l.Styles.createViewStyle({justifyContent:"flex-start",overflow:"visible"}),buttonControlsRight:()=>l.Styles.createViewStyle({justifyContent:"flex-end",overflow:"visible"}),iconControl:()=>l.Styles.createViewStyle({width:44,height:44})});class E extends A.default{constructor(){super(...arguments),this._onCallEndButtonRef=e=>{this._callEndButton=e||void 0,this._callEndButton&&this.isComponentMounted()&&this._maybeFocusCallEndButton()},this._onSnapshotPressed=()=>{this._snapshotCommand.execute(),this.props.onInteracting(!1)},this._onToggleVideoPressed=e=>{const t=k.default.newCauseId();V.default.trackVideoButtonClick(this.props.callId,t),R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessToggleVideoCall,e),this._videoCommand.execute(),this.props.onInteracting(!1),R.default.markActionDoneAndRemoveTracker(t)},this._onEndCallPressed=e=>{const t=k.default.newCauseId();R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessEndCall,e),V.default.trackHangUpButtonClick(this.props.callId,t);const i=k.default.newCauseId();T.log(f.LogTraceArea.CallingUI,"MobileCallControls._onEndCallPressed "+i),this._endCall(!1,i),R.default.markActionDoneAndRemoveTracker(t)},this._onEndCallButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),g.default.showEndCallMenuPopup(this._getRootViewId(),e,this._getAnchorForEndCallMenu,this._selectEndCallMenuItem)},this._onChatPanelButtonPressed=e=>{const t=k.default.newCauseId();R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessChatPanelInCall,e);const i=k.default.newCauseId();T.log(f.LogTraceArea.CallingUI,"MobileCallControls._onChatPanelButtonPressed "+i),this.props.onChatPanelButtonPress(i),this.props.onInteracting(!1),R.default.markActionDoneAndRemoveTracker(t)},this._getAnchorForEndCallMenu=()=>this._callEndButton,this._selectEndCallMenuItem=e=>{g.default.selectEndCallMenuItem(e,this._getRootViewId(),this._endCall)},this._endCall=(e,t)=>{if(T.log(f.LogTraceArea.CallingUI,"MobileCallControls._endCall forEveryone: "+e+" causeId: "+t),e)this._endCallForAllCommand.execute();else{new p.EndCallCommand(this.props.callId,t,this.props.onEndCallFailure).execute()}},this._onToggleMicrophonePressed=e=>{const t=k.default.newCauseId();R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessMuteCall,e),V.default.trackMicButtonClick(this.props.callId,t,this.props.callUIState);new p.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId(),t,t).execute(),this.state.isMuted&&this.props.onLocalUnmute&&this.props.onLocalUnmute(),this.props.onInteracting(!1)},this._mediaActionEvent=e=>{C.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(T.track(new m.MediaActionEvent(m.CallControlContext.MobileCallControls,m.MediaActionEventResult.EndCall)),T.log(f.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent ending call (causeId: "+e+")"),C.default.CallingStore.endCall(this.props.callId,e)):(T.track(new m.MediaActionEvent(m.CallControlContext.MobileCallControls,m.MediaActionEventResult.Ignore)),T.log(f.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent no action (causeId: "+e+")"))},this._renderMicrophoneActivityIcon=e=>(0,a.jsx)(L.MicrophoneActivityIcon,Object.assign({},e,{isMuted:this.state.isMuted,legacy:!0})),this._showOverflowMenu=()=>{T.log(f.LogTraceArea.CallingUI,"MobileCallControls._showOverflowMenu"),this.props.onOverflowPressed((()=>this._overflowButtonRef.current),this.props.isUsingSkypeTheme),this.setState({showRedDot:!1})},this._overflowButtonRef=n.createRef()}_buildState(e,t){this._videoCommand=new p.ToggleVideoCommand(e.callId,e),this._snapshotCommand=new w.MomentCommand(e.callId,e,e.reactionsConversationMri),this._endCallForAllCommand=new p.EndCallForEveryoneCommand(e.callId,e,e.callUIState,e.onEndCallFailure);const i=C.default.CallingStore.isCallConnected(e.callId),o=e.callUIState!==S.CallUIState.None,a=C.default.CallingFeaturesHelper.allowReactionsInCallStageMobile();let n;this._reactionCommand=void 0,a&&(n=_.default.getReactionButtonType(e.conversationMri,e.callId),this._reactionCommand=_.default.getReactionCommand(n,e.callId,e,e.reactionsConversationMri));const s=a&&void 0!==this._reactionCommand&&o,r=!s&&this._snapshotCommand.canExecute()&&o;return{isMuted:_.default.isLocalOrServerMuted(e.callId),isServerMuted:C.default.CallingStore.isServerMuted(e.callId),isVideoActive:C.default.CallingStore.isProvidingVideo(e.callId),isMobileScreenReaderEnabled:P.default.isMobileScreenReaderEnabled(),isVideoButtonEnabled:this._videoCommand.canExecute(),hangupAllEnabled:this._endCallForAllCommand.canExecute(),isSnapshotButtonVisible:r,callState:C.default.CallingStore.getCallState(e.callId),isTablet:!I.default.isUsingStackNavigationContext(),isCallConnected:i,shouldMakeSecondaryActionsAvailable:o,showReactButton:s,reactionButtonType:n,enableMicSoundIndicator:u.default.getS4LCMCFeatures().enableMicSoundIndicator,showRedDot:!1}}componentDidMount(){super.componentDidMount(),this._maybeFocusCallEndButton(100),this._mediaActionEventSub=r.default.mediaActionEvent.subscribe(this._mediaActionEvent),r.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=r.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe((()=>{T.track(new m.MaybeEndCallFromAndroidBtScoDisconnectEvent(m.CallControlContext.MobileCallControls))})))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||_.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&T.log(f.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&T.log(f.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}_maybeFocusCallEndButton(e=0){const t=()=>{this._callEndButton&&this.isComponentMounted()&&this.state.isMobileScreenReaderEnabled&&this._callEndButton.requestFocus()};e?s.delay(t,e):s.defer(t)}_getPrimaryControls(){let e;return this.props.isPSTNCall?e=this._getPSTNDialPadButton():this.props.isEncryptedCall||(e=this._getVideoButton()),(0,a.jsxs)(l.View,{style:this._getPrimaryControlsStyle(),children:[this._getMicButton(),e,this._getHangUpButton()]})}_getHangUpButton(){if(this.props.hideEndCallButton)return null;const e=v.getString("CallControls.CallButtonEndCall");return this.props.enableNewButtons?(0,a.jsx)(d.default,{ref:this._onCallEndButtonRef,icon:D.SkypeIcon.CallEnd,title:e,accessibilityLabel:e,size:d.ActionButtonSize.Medium,backgroundColor:M.Color.red,onPress:this._onEndCallPressed,onLongPress:this.state.hangupAllEnabled?this._onEndCallButtonLongPress:void 0,reverseGradientColor:!0,style:this._getButtonsGapStyle()}):(0,a.jsx)(h.CallButton,{ref:this._onCallEndButtonRef,icon:D.SkypeIcon.CallEnd,title:e,size:h.CallButtonSize.Large,isToggledOn:!1,isCallEndButton:!0,onPress:this._onEndCallPressed,onLongPress:this.state.hangupAllEnabled?this._onEndCallButtonLongPress:void 0,accessibilityLabel:e,backgroundStyle:h.CallButtonBackgroundStyle.Solid})}static _getActionButtonColorConfig(e){if(e)return;return{iconColor:M.Color.gray400Overlay70,backgroundColor:M.Color.gray200}}_getMicButton(){const{enableMicSoundIndicator:e,isMuted:t}=this.state,i=v.getString(t?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute");if(this.props.enableNewButtons){const o=E._getActionButtonColorConfig(!t);return(0,a.jsx)(d.default,{icon:t?D.SkypeIcon.MicrophoneOff:D.SkypeIcon.Microphone,accessibilityLabel:i,title:i,size:d.ActionButtonSize.Medium,backgroundColor:null==o?void 0:o.backgroundColor,iconColor:null==o?void 0:o.iconColor,onPress:this._onToggleMicrophonePressed,renderIcon:e?this._renderMicrophoneActivityIcon:void 0,reverseGradientColor:!0,style:this._getButtonsGapStyle()})}return(0,a.jsx)(h.CallButton,{icon:t?D.SkypeIcon.MicrophoneOff:D.SkypeIcon.Microphone,renderIcon:e?this._renderMicrophoneActivityIcon:void 0,title:i,size:h.CallButtonSize.Large,isToggledOn:!t,onPress:this._onToggleMicrophonePressed,accessibilityLabel:i,backgroundStyle:t?h.CallButtonBackgroundStyle.Solid:h.CallButtonBackgroundStyle.Overlay})}_getVideoButton(){const e=v.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),t=E._getActionButtonColorConfig(this.state.isVideoActive);return this.props.enableNewButtons?(0,a.jsx)(d.default,{icon:this.state.isVideoActive?D.SkypeIcon.Video:D.SkypeIcon.VideoOff,accessibilityLabel:e,title:e,size:d.ActionButtonSize.Medium,backgroundColor:null==t?void 0:t.backgroundColor,iconColor:null==t?void 0:t.iconColor,onPress:this._onToggleVideoPressed,disabled:!this.state.isVideoButtonEnabled,reverseGradientColor:!0,style:this._getButtonsGapStyle()}):(0,a.jsx)(h.CallButton,{icon:this.state.isVideoActive?D.SkypeIcon.Video:D.SkypeIcon.VideoOff,title:e,size:h.CallButtonSize.Large,isDisabled:!this.state.isVideoButtonEnabled,isToggledOn:this.state.isVideoActive,onPress:this._onToggleVideoPressed,accessibilityLabel:e,backgroundStyle:this.state.isVideoActive?h.CallButtonBackgroundStyle.Overlay:h.CallButtonBackgroundStyle.Solid})}_getActionButton(e,t,i,o){return(0,a.jsx)(d.default,{icon:e,title:t,accessibilityLabel:t,ref:o,backgroundColor:M.Color.gray200,iconColor:M.Color.gray400Overlay70,size:d.ActionButtonSize.Medium,onPress:i})}_getPSTNDialPadButton(){const e=v.getString("CallPanel.DialpadTooltipTitle"),t=!(this.state.callState===c.CallState.Connected||this.state.callState===c.CallState.EarlyMedia);return this.props.enableNewButtons?(0,a.jsx)(d.default,{icon:D.SkypeIcon.Dialpad,accessibilityLabel:e,title:e,size:d.ActionButtonSize.Medium,onPress:this.props.onOpenDialpad,reverseGradientColor:!0,style:this._getButtonsGapStyle(),disabled:t}):(0,a.jsx)(h.CallButton,{icon:D.SkypeIcon.Dialpad,size:h.CallButtonSize.Large,isDisabled:!(this.state.callState===c.CallState.Connected||this.state.callState===c.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,title:v.getString("CallPanel.DialpadTooltipTitle"),accessibilityLabel:v.getString("CallPanel.DialpadTooltipTitle"),backgroundStyle:h.CallButtonBackgroundStyle.Overlay})}_getSnapshotButton(){if(!this.state.isSnapshotButtonVisible)return;const e=v.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle");return this.props.enableNewButtons?this._getActionButton(D.SkypeIcon.Snapshot,e,this._onSnapshotPressed):(0,a.jsx)(y.default,{style:O.iconControl,icon:D.SkypeIcon.Snapshot,title:e,size:D.IconSize.size24,onPress:this._onSnapshotPressed,accessibilityLabel:e,color:M.Color.white,hoverColor:M.Color.whiteOverlay20})}_getReactionButton(){if(!this.state.showReactButton||!this._reactionCommand||void 0===this.state.reactionButtonType)return;const e=_.default.getReactionButtonDescriptors(this.state.reactionButtonType,this._reactionCommand);return this.props.enableNewButtons?this._getActionButton(e.icon,e.accessibilityLabel,e.onPress):(0,a.jsx)(y.default,Object.assign({style:O.iconControl,size:D.IconSize.size24,color:M.Color.white,hoverColor:M.Color.whiteOverlay20,disabled:!this.state.isCallConnected},e))}_getChatPanelButton(){if(!this.state.isTablet)return;const e=this.props.isShowingChat?v.getString("CallPanel.CloseConversation"):v.getString("CallPanel.OpenConversation"),t=this.props.isShowingChat?D.SkypeIcon.ChatsInverted:D.SkypeIcon.Message;return this.props.enableNewButtons?this._getActionButton(t,e,this._onChatPanelButtonPressed):(0,a.jsx)(y.default,{style:O.iconControl,icon:t,title:e,accessibilityLabel:e,size:D.IconSize.size24,onPress:this._onChatPanelButtonPressed,color:M.Color.white,hoverColor:M.Color.whiteOverlay20})}_getOverflowButton(){if(this.props.isEncryptedCall||!this.state.shouldMakeSecondaryActionsAvailable)return;const e=v.getString("CallControls.CallButtonOverflowMenu"),t=this.props.enableNewButtons?this._getActionButton(D.SkypeIcon.More,e,this._showOverflowMenu,this._overflowButtonRef):(0,a.jsx)(y.default,{ref:this._overflowButtonRef,icon:D.SkypeIcon.More,title:e,size:D.IconSize.size24,onPress:this._showOverflowMenu,accessibilityLabel:e,color:M.Color.white,hoverColor:M.Color.whiteOverlay20,style:O.iconControl});return(0,a.jsx)(B.default,{showRedDot:this.state.showRedDot,children:t})}_getButtonsGapStyle(){return this.props.showCallControlsVertically?void 0:O.buttonsGap}_getPrimaryControlsStyle(){return this.props.showCallControlsVertically?O.primaryControlsContainerVertical:O.primaryControlsContainer}_getButtonControlsStyle(){return this.props.showCallControlsVertically?O.buttonControlsVertical:O.buttonControls}_getContainerStyle(){return this.props.showCallControlsVertically?[O.containerVertical,this.props.style]:[O.container,this.props.style]}render(){return(0,a.jsxs)(l.View,{style:this._getContainerStyle(),ignorePointerEvents:this.props.ignorePointerEvents,blockPointerEvents:this.props.blockPointerEvents,children:[(0,a.jsxs)(l.View,{style:l.Styles.combine(this._getButtonControlsStyle(),O.buttonControlsLeft),children:[this._getChatPanelButton(),this._getSnapshotButton(),this._getReactionButton()]}),this._getPrimaryControls(),(0,a.jsx)(l.View,{style:l.Styles.combine(this._getButtonControlsStyle(),O.buttonControlsRight),children:this._getOverflowButton()})]})}}t.default=E},459172:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(99741)),l=i(460515),c=o.__importDefault(i(340724)),d=o.__importDefault(i(389659)),u=o.__importDefault(i(601976)),h=i(815146),p=o.__importStar(i(85385)),g=i(26703),C=o.__importStar(i(704704)),m=i(16549),S=i(262725),_=o.__importDefault(i(497910)),f=o.__importDefault(i(601274)),y=o.__importDefault(i(760989)),T=i(641400),b=o.__importDefault(i(142193)),v=o.__importDefault(i(970035)),I=(0,g.lazyProperties)({titleContainer:()=>n.Styles.createViewStyle({flex:-1,paddingTop:6,justifyContent:"center",backgroundColor:m.Color.transparent}),headerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",height:l.CallPanelHeaderHeight.mobile}),headerContainerLeftAligned:()=>n.Styles.createViewStyle({alignItems:"flex-start"}),firstRow:()=>n.Styles.createViewStyle({flexDirection:"row",paddingTop:16,justifyContent:"center",marginBottom:8,alignItems:"center"}),firstRowLeftAligned:()=>n.Styles.createViewStyle({marginBottom:1}),conversationNameText:()=>n.Styles.createTextStyle({color:m.Color.white}),callInfo:()=>n.Styles.createTextStyle({color:m.Color.whiteOverlay70}),recordingIcon:()=>n.Styles.createViewStyle({width:24,height:24,marginRight:8})});class w extends _.default{constructor(){super(...arguments),this._onPress=()=>{if(this.props.onTitlePress){const e=y.default.newCauseId();p.log(h.LogTraceArea.CallingUI,"MobileCallPanelHeaderTitle._onPress, causeId: "+e),this.props.onTitlePress(e,l.CallRosterOrigin.FromGroupTitle)}}}_buildState(e,t){const i=s.default.CallingStore.getConnectedAndNotOnHoldCallId(),o=!!i&&i!==e.callId;return{conversationName:u.default.getDisplayName(e.conversationMri)||C.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?r.default.getActiveParticipants(e.callId,e.conversationMri).length:void 0,totalParticipantCount:e.showParticipantCount?r.default.getRosterForConversation(e.conversationMri).length:void 0,multipleCallWarning:o?C.getString("CallBanner.IncomingCallMultiCallWarning"):void 0}}render(){const e=[I.firstRow],t=[I.headerContainer,I.headerContainerLeftAligned],i=[I.conversationNameText,I.firstRowLeftAligned],o=[I.callInfo],s=[{icon:T.SkypeIcon.CallRecordStroke,color:m.Color.white},{icon:T.SkypeIcon.CallRecordDot,color:m.Color.red}];this.props.isUsingSkypeTheme&&(i.push(n.Styles.createTextStyle({color:this._themeColors.headerTextColor},!1)),o.push(n.Styles.createTextStyle({color:this._themeColors.secondaryTextColor},!1)));const r=(0,a.jsxs)(n.View,{style:e,children:[this.props.isRecording&&!this.props.isRecordingToastVisible&&(0,a.jsx)(b.default,{icons:s,style:I.recordingIcon}),(0,a.jsx)(S.PanelHeader,{landscape:this.props.isLandscape,style:i,numberOfLines:1,children:this.state.conversationName})]});let l,c;this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length&&(l=(0,a.jsx)(S.Caption,{style:o,numberOfLines:1,children:this.props.outgoingRingStatus})),this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(c=C.getString("CallPanel.CallRosterTitleUpper",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const d=(0,a.jsxs)(n.View,{style:{flexDirection:"row"},children:[(0,a.jsx)(P,{callId:this.props.callId,isActive:this.props.isCallActive&&this.props.isSeen,participantCountText:c,textStyle:o}),this.props.isMobileScreenShareActive&&!this.props.isScreenSharingToastVisible&&(0,a.jsx)(v.default,{style:{marginLeft:8},icon:T.SkypeIcon.ScreenShareGradient,size:T.IconSize.size16,color:m.Color.white})]});let u;this.state.multipleCallWarning&&(u=(0,a.jsx)(S.Caption,{style:o,children:this.state.multipleCallWarning}));const h=!!this.props.onTitlePress;return(0,a.jsx)(n.Button,{style:I.titleContainer,onPress:h?this._onPress:void 0,accessibilityTraits:h?n.Types.AccessibilityTrait.Button:n.Types.AccessibilityTrait.Text,disableTouchOpacityAnimation:!h,children:(0,a.jsxs)(n.View,{style:t,children:[r,l,u,d]})})}_subscribeToThemeChanges(){return!1}}t.default=w;class P extends _.default{constructor(){super(...arguments),this._onTimerUpdate=()=>{const e=s.default.OngoingCallService.getCallConnectedTime(this.props.callId),t=e?Date.now()-e:0;this.setState({elapsedTimeMs:t})}}_buildState(e,t){const i={};return t&&(i.elapsedTimeMs=0),i}componentDidMount(){super.componentDidMount(),this.props.isActive&&this._maybeStartTimer()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isActive!==this.props.isActive&&this._maybeStartTimer()}componentWillUnmount(){super.componentWillUnmount(),this._startOrStopCallTimer(!1)}_maybeStartTimer(){this._startOrStopCallTimer(!!this.props.isActive)}_startOrStopCallTimer(e){e?this._timerToken||(this._timerToken=f.default.setInterval(this._onTimerUpdate,1e3),this._onTimerUpdate()):this._timerToken&&(f.default.clearInterval(this._timerToken),this._timerToken=void 0)}render(){let e=null;if(this.props.participantCountText||this.state.elapsedTimeMs>0||this.props.isActive){const t=this.state.elapsedTimeMs||this.props.isActive,i=t?d.default.getElapsedTimeStringFromMs(this.state.elapsedTimeMs):void 0,o=t?d.default.getFormattedDuration(Math.floor(this.state.elapsedTimeMs/1e3),!0):void 0,s=this.props.participantCountText&&i?(0,a.jsx)(n.Text,{children:" | "}):void 0;let r;r=this.props.participantCountText&&o?c.default.combinedAccessibilityLabel(this.props.participantCountText,o):this.props.participantCountText||o,e=(0,a.jsx)(n.View,{accessibilityLabel:r,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:n.Types.AccessibilityTrait.Text,children:(0,a.jsxs)(S.Caption,{style:this.props.textStyle,numberOfLines:1,accessibilityHidden:!0,children:[this.props.participantCountText,s,i]})})}return e}_subscribeToThemeChanges(){return!1}}},878524:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=i(26178),l=o.__importDefault(i(369347)),c=i(873324),d=o.__importStar(i(873324)),u=o.__importStar(i(44717)),h=i(410098),p=o.__importDefault(i(288547)),g=o.__importDefault(i(587853)),C=o.__importDefault(i(601976)),m=i(815146),S=i(182042),_=o.__importStar(i(85385)),f=i(26703),y=o.__importStar(i(704704)),T=i(16549),b=i(641400),v=i(262725),I=o.__importDefault(i(760989)),w=i(206197),P=(0,f.lazyProperties)({containerViewBase:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:T.Color.transparent}),titleStyle:()=>n.Styles.createTextStyle({marginTop:30,marginHorizontal:50,textAlign:"center",color:T.Color.white}),messageStyle:()=>n.Styles.createTextStyle({marginTop:10,marginHorizontal:50,textAlign:"center",color:T.Color.whiteOverlay70}),buttonInfoStyle:()=>n.Styles.createTextStyle({marginTop:10,marginHorizontal:5,textAlign:"center",color:T.Color.whiteOverlay70}),actionPane:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:30,alignItems:"center",alignSelf:"stretch"}),minorButtonsRowOneItem:()=>n.Styles.createViewStyle({marginBottom:30,alignContent:"center",justifyContent:"center"}),minorButtonsRowMultiItem:()=>n.Styles.createViewStyle({marginBottom:30,marginHorizontal:100,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"}),majorButtonsRow:()=>n.Styles.createViewStyle({marginVertical:20,marginHorizontal:60,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"})});class M extends S.IncomingRingControlsBase{constructor(e){super(d.CallControlContext.MobileIncomingRingPanel,e),this._onMessageButtonRef=e=>{this._callMessageButton=e||void 0},this._onRejectCall=()=>{this._rejectCommand.execute(),_.track(new c.MobileCallAnswerEvent(c.MobileCallAnswerActions.Declined,0))},this._onAnswerCallWithVideo=()=>{this._answerCommand.execute(!0),_.track(new c.MobileCallAnswerEvent(c.MobileCallAnswerActions.AnsweredWithVideo,0))},this._onAnswerCall=()=>{this._answerCommand.execute(),_.track(new c.MobileCallAnswerEvent(c.MobileCallAnswerActions.AnsweredWithAudio,0))},this._onMesageBack=()=>{const e=I.default.newCauseId();l.default.OngoingCallService.stopCallSounds(this.props.callId,e);const t={callId:this.props.callId,conversationMri:this.props.conversationMri,onClose:this._closeMessagePrompt},i=(0,a.jsx)(g.default,Object.assign({},t)),o=g.default.getMenuHeight(),n={headerType:h.HeaderType.Slim,hideCloseButton:!0};p.default.showWithContent({menuId:p.default.menuId(),anchor:()=>this._callMessageButton,rootViewId:this._getRootViewId(),menuHeight:o,content:i,onCloseMenu:this._closeMessagePrompt,getTitle:()=>{},headerConfig:n,colorThemeOverride:w.Theme.DelphiDark,backgroundColor:T.Color.black},e)},this._closeMessagePrompt=()=>{const e=I.default.newCauseId();_.log(m.LogTraceArea.CallingUI,"MobileIncomingRingPanel._closeMessagePrompt causeId: "+e),p.default.close(this._getRootViewId(),e)}}_buildState(e,t){this._initializeCommands(e,!0);const i=l.default.CallingStore.getConnectedAndNotOnHoldCallId();return{conversationName:C.default.getDisplayName(e.conversationMri)||y.getString("Notifications.UnknownUserShort"),allowVideoButton:this._answerCommand.canExecuteWithVideo(),withVideo:l.default.CallingStore.incomingCallHasVideo(e.callId),isGroupCall:u.isGroupConversation(e.conversationMri),connectedToAnotherCall:!!i&&i!==e.callId,showMessageButton:s.default.getS4LCMCFeatures().enableDeclineAndMessageOnRingControls&&!l.default.CallingStore.isPSTNCall(e.callId)}}_colorConfig(e){return{iconColor:T.Color.white,backgroundColor:e,selectedIconColor:T.Color.white,selectedBackgroundColor:e}}render(){return(0,a.jsxs)(n.View,{style:[P.containerViewBase,this.props.style],children:[this._renderTitle(),this._renderCallInfo(),(0,a.jsx)(n.View,{style:P.actionPane,children:this._renderCallButtons()})]})}_renderTitle(){const e=this.props.useLightTheme?[P.titleStyle,this._themeStyles.headerTextColorStyle]:[P.titleStyle];return(0,a.jsx)(v.PanelHeader,{style:e,numberOfLines:1,children:this.state.conversationName})}_renderCaption(e,t){return(0,a.jsx)(v.Caption,{style:t,children:e})}_renderCallInfo(){const e=this.props.useLightTheme?[P.messageStyle,this._themeStyles.headerTextColorStyle]:[P.messageStyle];return this._renderCaption(this._getIncomingCallStrings(),e)}_renderCallButtons(){let e;const t=this.props.useLightTheme?[P.buttonInfoStyle,this._themeStyles.headerTextColorStyle]:[P.buttonInfoStyle],i=this.props.useLightTheme?T.Color.gray300Overlay80:T.Color.gray200Overlay20;if(this.state.allowVideoButton){const i=y.getString("MobileIncomingCallPanel.CallButtonVideoLabel",{conversationName:this.state.conversationName});e=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(r.CallButton,{icon:b.SkypeIcon.Video,isToggledOn:!1,title:i,onPress:this._onAnswerCallWithVideo,size:r.CallButtonSize.ExtraLarge,accessibilityLabel:i,colorConfig:this._colorConfig(T.Color.green)}),this._renderCaption(y.getString("MobileIncomingCallPanel.VideoButtonText"),t)]})}const o=y.getString("MobileIncomingCallPanel.CallButtonAudioLabel",{conversationName:this.state.conversationName}),s=y.getString("MobileIncomingCallPanel.CallButtonDeclineLabel"),l=y.getString("MobileIncomingCallPanel.CallButtonMessageBackLabel",{conversationName:this.state.conversationName}),c=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(r.CallButton,{ref:this._onAnswerCallButtonRef,icon:b.SkypeIcon.CallStart,isToggledOn:!1,title:o,onPress:this._onAnswerCall,size:e?r.CallButtonSize.Small:r.CallButtonSize.ExtraLarge,accessibilityLabel:o,colorConfig:this._colorConfig(e?i:T.Color.green),isSquareButton:!!e}),this._renderCaption(y.getString("MobileIncomingCallPanel.AudioButtonText"),t)]}),d=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(r.CallButton,{icon:b.SkypeIcon.CallEnd,isToggledOn:!1,title:s,onPress:this._onRejectCall,isCallEndButton:!0,size:r.CallButtonSize.ExtraLarge,accessibilityLabel:s,colorConfig:this._colorConfig(T.Color.red)}),this._renderCaption(y.getString("MobileIncomingCallPanel.DeclineButtonText"),t)]});let u;if(this.state.showMessageButton&&(u=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(r.CallButton,{ref:this._onMessageButtonRef,icon:b.SkypeIcon.Message,isToggledOn:!1,title:l,onPress:this._onMesageBack,size:r.CallButtonSize.Small,accessibilityLabel:l,colorConfig:this._colorConfig(i),isSquareButton:!0}),this._renderCaption(y.getString("MobileIncomingCallPanel.MessageButtonText"),t)]})),e){const t=u?P.minorButtonsRowMultiItem:P.minorButtonsRowOneItem;return[(0,a.jsxs)(n.View,{style:t,children:[u,c]},"minorRow"),(0,a.jsxs)(n.View,{style:P.majorButtonsRow,children:[d,e]},"majorRow")]}return[(0,a.jsx)(n.View,{style:P.minorButtonsRowOneItem,children:u},"minorRow"),(0,a.jsxs)(n.View,{style:P.majorButtonsRow,children:[d,c]},"majorRow")]}_getIncomingCallStrings(){return this.state.connectedToAnotherCall?y.getString("CallBanner.IncomingCallMergeCallWarning"):this.state.isGroupCall?y.getString("MobileIncomingCallPanel.IncomingCall"):this.state.withVideo?y.getString("MobileIncomingCallPanel.IncomingVideoCall"):y.getString("MobileIncomingCallPanel.IncomingAudioCall")}}t.default=M},882424:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(815146),r=o.__importDefault(i(970035)),l=o.__importStar(i(85385)),c=i(26703),d=o.__importStar(i(704704)),u=i(686196),h=i(16549),p=i(641400),g=i(262725),C=o.__importDefault(i(453761)),m=o.__importDefault(i(497910)),S=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),subcontainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),icon:()=>n.Styles.createViewStyle({marginRight:10})});class _ extends m.default{constructor(){super(...arguments),this._onStopPress=e=>{l.log(s.LogTraceArea.CallingUI,"MobileScreenShareBanner disable screen-share clicked");new u.MobileScreenShareToggleCommand(this.props).execute()}}render(){return(0,a.jsxs)(n.View,{style:S.container,children:[(0,a.jsxs)(n.View,{style:S.subcontainer,children:[(0,a.jsx)(r.default,{style:S.icon,icon:p.SkypeIcon.ScreenShare,size:p.IconSize.size24,color:h.Color.white}),(0,a.jsxs)(n.View,{style:this.props.containerStyle,children:[(0,a.jsx)(g.BodyText,{style:this.props.textStyle,numberOfLines:1,children:d.getString("MobileScreenSharingToast.BannerTitle")}),(0,a.jsx)(n.Button,{onPress:this._onStopPress,children:(0,a.jsx)(g.BodyText,{style:this.props.linkStyle,children:d.getString("MobileScreenSharingToast.StopSharingLinkText")})})]})]}),(0,a.jsx)(C.default,{icon:p.SkypeIcon.ClosePanel,size:p.IconSize.size20,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,title:d.getString("Global.CloseButtonTitle"),onPress:this.props.onHideScreenSharingToast})]})}}t.default=_},219388:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventsLayoutController=t.PhotoEventItemLayoutController=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=i(460515),l=i(815146),c=o.__importStar(i(85385)),d=o.__importDefault(i(393443)),u=o.__importDefault(i(842252)),h=o.__importDefault(i(601274)),p=o.__importDefault(i(760989)),g={width:300,height:300};class C{constructor(e,t,i,o,a,s,r,l,c=10,u=10){if(this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._isPanning=!1,this._viewRect={x:0,y:0,width:0,height:0},this._animatedVerticalValue=new n.Animated.Value(0),this._animatedHorizontalValue=new n.Animated.Value(0),this._animatedHeightValue=new n.Animated.Value(1),this._animatedWidthValue=new n.Animated.Value(1),this._animatedTransfromValueForScale=new n.Animated.Value(0),this._animatedTransformValueForX=new n.Animated.Value(0),this._animatedTransformValueForY=new n.Animated.Value(0),this._incomingPhotoSound=d.default.SkypeShutter,this._id=e,this._parentViewDimensions=t,this._onWillRemoveItem=o,this._onDidRemoveItem=a,this._onPanItem=i,this._isDesktop=s,this._animationDirection=r,this._bottomMargin=c,this._desktopSideMargin=u,l&&l.width&&l.height){let e,t;l.width>l.height?(e=g.width,t=g.width*(l.height/l.width)):(t=260,e=g.height*(l.width/l.height)),e=Math.max(e,260),t=Math.max(t,260),this._containerDimensions={width:e,height:t}}else this._containerDimensions=g;const h=this._animationOffset();this._animatedTransformValue=new n.Animated.Value(h),this._rectStyleForMobile=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue,bottom:this._animatedVerticalValue,height:this._animatedHeightValue,width:this._animatedWidthValue});const p={bottom:this._bottomMargin,height:this._containerDimensions.height,width:this._containerDimensions.width};p.right=this._desktopSideMargin,this._rectStyleForDesktop=n.Styles.createViewStyle(p,!1),this._setPositionStyle(),this._imageStyle=n.Styles.createImageStyle({width:this._containerDimensions.width,height:this._containerDimensions.height},!1)}_setPositionStyle(){switch(this._animationDirection){case r.PhotoAnimationDirection.Zoom:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValueForX},{translateY:this._animatedTransformValueForY},{scale:this._animatedTransfromValueForScale}],opacity:this._animatedTransfromValueForScale});break;case r.PhotoAnimationDirection.Up:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._animatedTransformValue}]});break;default:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValue}]})}}getRectStyles(){return this._isDesktop?this._rectStyleForDesktop:this._rectStyleForMobile}getPositionStyles(){return this._positionStyle}getImageStyle(){return this._imageStyle}presentItemIfReady(e=!0){if(this._hasBeenPresented)return!1;this._hasBeenPresented=!0;const t=p.default.newCauseId();c.log(l.LogTraceArea.GenericUnsafe,"PhotoEventItemLayoutController.presentItemIfReady causeId: "+t),this._incomingPhotoSound.playOnce(t);const i=s.default.getS4LCMCFeaturesNoSubscription().photoEventTimeoutMs;return this._isDesktop?this._updateAnimatedPositionForDesktop(this._itemRect(),0,!0,1,!1,(()=>this._startDismissTimer(i))):this._updateAnimatedPosition(this._itemRect(),0,!1,e,(()=>this._startDismissTimer(i))),!0}_itemRect(){const e=this._containerDimensions;let t,i;return this._isDesktop?(t=this._desktopSideMargin,i=this._bottomMargin):(t=(this._parentViewDimensions.width-e.width)/2,i=(this._parentViewDimensions.height-e.height)/2),Object.assign({x:t,y:i},e)}dismissItem(e=!0){return!this._hasBeenDismissed&&!this._isPanning&&(this._onWillRemoveItem&&this._onWillRemoveItem(this._id),this._clearDismissTimer(),this._isDesktop?this._updateAnimatedPositionForDesktop({x:this._desktopSideMargin-this._desktopSideMargin/2,y:this._bottomMargin-this._bottomMargin/2,width:0,height:0},this._animationOffset(),e,0,e,(()=>{h.default.setTimeout((()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)}),1e3)})):this._updateAnimatedPosition(this._viewRect,this._animationOffset(),!1,e,(()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)})),this._hasBeenDismissed=!0,!0)}onPan(e){if(this._hasBeenDismissed||!this._hasBeenPresented||this._animationDirection===r.PhotoAnimationDirection.Up)return;let t=e.pageX-e.initialPageX;this._animationDirection===r.PhotoAnimationDirection.Left&&t<0?t=-1*Math.sqrt(Math.abs(t)):this._animationDirection===r.PhotoAnimationDirection.Right&&t>0&&(t=Math.sqrt(Math.abs(t))),this._animatedTransformValue.setValue(t),e.isComplete?this._isPanning&&(this._isPanning=!1,this._onPanItem(!1),this.dismissItem()):this._isPanning||(this._isPanning=!0,this._onPanItem(!0))}_animationOffset(){if(!this._parentViewDimensions)return 0;switch(this._animationDirection){case r.PhotoAnimationDirection.Left:return this._parentViewDimensions.width-this._viewRect.x;case r.PhotoAnimationDirection.Right:return-1*(this._parentViewDimensions.width-this._viewRect.x);case r.PhotoAnimationDirection.Up:return this._containerDimensions.height+300;case r.PhotoAnimationDirection.Zoom:return(this._containerDimensions.height+10)/2}return 0}_clearDismissTimer(){this._dismissTimer&&(h.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(e){this._clearDismissTimer(),this._dismissTimer=h.default.setTimeout((()=>this.dismissItem(!0)),e)}updateViewDimensions(e){this._parentViewDimensions=e;const t=this._itemRect();this._animatedVerticalValue.setValue(t.y),this._animatedHorizontalValue.setValue(t.x),this._animatedWidthValue.setValue(t.width),this._animatedHeightValue.setValue(t.height)}_updateAnimatedPositionForDesktop(e,t,i=!0,o,s=!0,r,l){if(this._hasBeenDismissed)return;const c=l||[];i?c.push(u.default.easeOut({value:this._animatedTransfromValueForScale,toValue:o})):this._animatedTransfromValueForScale.setValue(o),s?(c.push(u.default.easeOut({value:this._animatedTransformValueForX,toValue:-1*t})),c.push(u.default.easeOut({value:this._animatedTransformValueForY,toValue:t}))):(this._animatedTransformValueForX.setValue(-1*t),this._animatedTransformValueForY.setValue(t)),a.isEmpty(c)?r&&r():n.Animated.parallel(c).start((e=>{r&&r()})),this._viewRect=e}_updateAnimatedPosition(e,t,i=!0,o=!0,s,r){if(this._hasBeenDismissed)return;const l=r||[];i?(l.push(u.default.easeOut({value:this._animatedVerticalValue,toValue:e.y})),l.push(u.default.easeOut({value:this._animatedHorizontalValue,toValue:e.x})),l.push(u.default.easeOut({value:this._animatedWidthValue,toValue:e.width})),l.push(u.default.easeOut({value:this._animatedHeightValue,toValue:e.height}))):(this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height)),o?l.push(u.default.easeOut({value:this._animatedTransformValue,toValue:t})):this._animatedTransformValue.setValue(t),a.isEmpty(l)?s&&s():n.Animated.parallel(l).start((e=>{s&&s()})),this._viewRect=e}}t.PhotoEventItemLayoutController=C;t.PhotoEventsLayoutController=class{constructor(e,t,i,o){this._controllers={},this._orderedKeys=[],this._isDesktop=e,this._animationDirection=t,this._bottomMargin=i,this._desktopSideMargin=o}updateViewDimensions(e){this._viewDimensions=e,a.each(this._controllers,(t=>t.updateViewDimensions(e)))}setCallbacks(e,t,i){this._onWillRemoveItem=e,this._onDidRemoveItem=t,this._onPanItem=i}clearEvents(e){a.each(this._controllers,((t,i)=>{i!==e&&(this._isDesktop?t.dismissItem(!1):t.dismissItem())}))}dismissItem(e){const t=this.existingControllerForKey(e);t&&t.dismissItem()}presentItemIfReady(e,t=!0){const i=this.existingControllerForKey(e);i&&i.presentItemIfReady(t)}existingControllerForKey(e){return this._intControllerForKey(e,!1)}controllerForKey(e,t,i){return this._intControllerForKey(e,!0,t,i)}_intControllerForKey(e,t,i,o){let a=this._controllers[e];return!a&&t&&(a=new C(e,this._viewDimensions,this._onPanItem,this._onWillRemoveItem,this._onDidRemoveItem,this._isDesktop,i&&!this._isDesktop?r.PhotoAnimationDirection.Up:this._animationDirection,o,this._bottomMargin,this._desktopSideMargin),this._controllers[e]=a,this._orderedKeys.push(e)),a}removeControllerForKey(e){delete this._controllers[e],this._orderedKeys=a.without(this._orderedKeys,e)}}},629897:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(174958),s=o.__importStar(i(496486)),r=o.__importStar(i(516778)),l=i(217041),c=o.__importDefault(i(306794)),d=i(460515),u=o.__importStar(i(463519)),h=i(815146),p=o.__importStar(i(85385)),g=i(26703),C=i(606933),m=o.__importDefault(i(363091)),S=o.__importDefault(i(942724)),_=i(219388),f=o.__importDefault(i(654201)),y=i(16549),T=o.__importDefault(i(601274)),b=o.__importDefault(i(760989)),v=(0,g.lazyProperties)({container:()=>r.Styles.createViewStyle({backgroundColor:y.Color.transparent}),dismissalView:()=>r.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:y.Color.transparent})});class I extends l.ComponentBase{constructor(){super(...arguments),this._backgroundColorValue=new r.Animated.Value(0),this._backgroundColorStyle=r.Styles.createAnimatedViewStyle({backgroundColor:this._backgroundColorValue.interpolate({inputRange:[0,1],outputRange:[y.Color.transparent,y.Color.blackOverlay50]})}),this._isPanning=!1,this._onWillRemoveItem=e=>{this.state.itemRenderInfo.length<=1&&this._toggleBackgroundColor(!1)},this._onDidRemoveItem=e=>{this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),this.setState(this._removeStreamItemsAndReturnNewState(e)))},this._onPanItem=e=>{this._isPanning=e},this._renderItem=e=>{const t=e.id,i=e.item;return(0,a.jsx)(f.default,{eventId:t,mri:i.mri,message:i.message,layoutController:e.layoutController,onPan:this._onPan,onTap:this._onTap,onLoad:this._onItemLoad,onClose:this._onClose},t)},this._onClose=e=>{this._layoutController.dismissItem(e),this.props.onPhotoDismissed&&this.props.onPhotoDismissed()},this._onPan=(e,t)=>{const i=this._layoutController.existingControllerForKey(e);i&&i.onPan(t)},this._onTap=(e,t)=>{const i=b.default.newCauseId(),o=s.findIndex(this.state.itemRenderInfo,(t=>t.id===e)),a=-1!==o?this.state.itemRenderInfo[o].item.message:void 0;p.log(h.LogTraceArea.CallReactions,"PhotoEventStream onTap "+n.pii.Omit(e)+" message: "+(a?a.cuid:"none")+" causeId: "+i),this.props.isDesktop||this._layoutController.clearEvents(),this.props.photoTapDelay?T.default.setTimeout((()=>{this.isComponentMounted()&&this.props.onPhotoTap&&this.props.onPhotoTap(a,t,i)}),this.props.photoTapDelay):this.props.onPhotoTap&&this.props.onPhotoTap(a,t,i),this.props.isDesktop&&T.default.setTimeout((()=>{this._layoutController.clearEvents()}),500),a&&!m.default.isMyMri(a.creator)&&c.default.markOneIncomingPhotoSeen(this.props.callId)},this._onDismissalTap=()=>{this.clearEvents()},this._onItemLoad=e=>{this.isComponentMounted()&&(this.props.isDesktop||this._toggleBackgroundColor(!0),this._layoutController.clearEvents(e),this._layoutController.presentItemIfReady(e))},this._toggleBackgroundColor=(e,t)=>{r.Animated.timing(this._backgroundColorValue,{toValue:e?1:0,duration:200,easing:r.Animated.Easing.InOut()}).start(t)},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){const i={};if(t){this._eventCount=0;const t=e.isDesktop?d.PhotoAnimationDirection.Zoom:S.default.isUsingStackNavigationContext()?d.PhotoAnimationDirection.Right:d.PhotoAnimationDirection.Left;this._layoutController=new _.PhotoEventsLayoutController(!!e.isDesktop,t,e.bottomMargin,e.desktopSideMargin),i.itemRenderInfo=[]}return i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._layoutController.setCallbacks((e=>this._onWillRemoveItem(e)),(e=>this._onDidRemoveItem(e)),(e=>this._onPanItem(e)))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.itemRenderInfo.length&&!t.itemRenderInfo.length&&this._toggleBackgroundColor(!1)}photoEvent(e,t){if(this._isPanning)return;const i=s.clone(this.state.itemRenderInfo),o="photo_"+this._eventCount++,a=m.default.isMyMri(e.creator),n=u.decode(e);let r;if(this.props.sizePhotosToFit){const e=n.getFirstUriObjectChild(C.PictureNode);if(e){const t=e.getOriginalDimensions();t.width&&t.height&&(r=t)}}p.log(h.LogTraceArea.CallReactions,"PhotoEventStream photoEvent  intrinsicSize "+(r?r.width+", "+r.height:"none")+" message: "+e.cuid);const l=this._layoutController.controllerForKey(o,a,r);i.push({id:o,item:{mri:t,message:e},layoutController:l}),this.setState({itemRenderInfo:i})}clearEvents(){this._layoutController.clearEvents()}_removeStreamItemsAndReturnNewState(e){const t=s.clone(this.state.itemRenderInfo);return{itemRenderInfo:s.filter(t,(t=>t.id!==e))}}render(){const e=s.map(this.state.itemRenderInfo,this._renderItem),t=[v.container,this.props.isDesktop?void 0:this._backgroundColorStyle,this.props.style],i=!this.props.isDesktop&&e.length>0?(0,a.jsx)(r.View,{style:v.dismissalView,onPress:this._onDismissalTap}):void 0;return(0,a.jsxs)(r.Animated.View,{style:t,onLayout:this._onLayoutChange,ignorePointerEvents:!0,children:[i,e]})}}t.default=I},654201:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventStreamItem=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importStar(i(463519)),l=o.__importDefault(i(694154)),c=o.__importDefault(i(560099)),d=i(77395),u=o.__importDefault(i(970035)),h=i(26703),p=o.__importStar(i(704704)),g=i(606933),C=o.__importDefault(i(363091)),m=i(16549),S=i(641400),_=o.__importDefault(i(827361)),f=o.__importDefault(i(460403)),y=i(403396),T=i(596648),b=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute"}),innerContainer:()=>n.Styles.createViewStyle({borderRadius:10,backgroundColor:m.Color.white,justifyContent:"center",alignItems:"flex-end",flexDirection:"row"}),imageView:()=>n.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),imageViewNoFooter:()=>n.Styles.createViewStyle({borderRadius:10}),attributionView:()=>n.Styles.createViewStyle({position:"absolute",top:10,left:10}),closeButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,width:50,height:50,alignItems:"center",justifyContent:"center"}),closeButton:()=>n.Styles.createViewStyle({backgroundColor:m.Color.blackOverlay35,width:30,height:30,borderRadius:15,alignItems:"center",justifyContent:"center"})});class v extends s.ComponentBase{constructor(){super(...arguments),this._onPan=e=>{this.props.onPan&&this.props.onPan(this.props.eventId,e)},this._onComponentRef=e=>{this._viewRef=e||void 0},this._onTap=e=>{this.props.onTap&&this.props.onTap(this.props.eventId,this._getRef)},this._getRef=()=>this.isComponentMounted()?this._viewRef:void 0,this._onLoad=e=>{this.props.onLoad&&this.props.onLoad(this.props.eventId)},this._onClose=()=>{this.props.onClose&&this.props.onClose(this.props.eventId)}}_buildState(e,t){let i,o=!1;if(e.message){const t=r.decode(e.message).getFirstUriObjectChild(g.PictureNode);i=t&&t.getDisplayUrlAsThumbnailSanitized(),o=C.default.isMyMri(e.message.creator)}return{thumbnailUrl:i?f.default.getAuthenticatedUrl(i):void 0,postedByCurrentUser:o}}render(){const e=[b.container,_.default.overflowVisible],t=[_.default.absoluteFill,b.innerContainer],i=[this.state.postedByCurrentUser?b.imageViewNoFooter:b.imageView];this.props.layoutController&&(e.push(this.props.layoutController.getRectStyles()),i.push(this.props.layoutController.getImageStyle()),t.push(this.props.layoutController.getPositionStyles()));const o=(0,a.jsx)(c.default,{style:b.attributionView,children:(0,a.jsx)(y.UserIcon,{userMri:this.props.message.creator,size:T.UserIconSize.Size30})},"attribution"),s=this.props.onClose?(0,a.jsx)(d.HoverableButton,{style:b.closeButtonContainer,accessibilityLabel:p.getString("CallPanel.ClosePhoto"),onPress:this._onClose,children:(0,a.jsx)(n.View,{style:b.closeButton,children:(0,a.jsx)(u.default,{icon:S.SkypeIcon.Cancel,size:S.IconSize.size16,color:m.Color.white})})},"closebutton"):void 0,r=[_.default.absoluteFill,_.default.pointerCursor],h=[(0,a.jsx)(n.GestureView,{style:r,onPanHorizontal:this._onPan,onTap:this._onTap,children:(0,a.jsx)(l.default,{origin:"PhotoEvent",containerStyle:_.default.absoluteFill,style:i,source:this.state.thumbnailUrl,resizeMode:"cover",onLoad:this._onLoad})},"imagecontainer"),o,s],g=(0,a.jsx)(n.Animated.View,{style:t,ignorePointerEvents:!0,children:h});return(0,a.jsx)(n.Animated.View,{ref:this._onComponentRef,style:e,ignorePointerEvents:!0,children:g})}}t.PhotoEventStreamItem=v,t.default=v},307293:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalPrivacyToastComponent=t.RemotePrivacyToastComponent=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(843822),r=o.__importDefault(i(369347)),l=o.__importDefault(i(60433)),c=i(460515),d=i(154235),u=o.__importDefault(i(142193)),h=o.__importDefault(i(68210)),p=o.__importDefault(i(601976)),g=i(815146),C=o.__importDefault(i(453761)),m=o.__importStar(i(85385)),S=i(26703),_=o.__importStar(i(704704)),f=i(16549),y=i(641400),T=o.__importDefault(i(52066)),b=i(262725),v=o.__importDefault(i(266872)),I=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center",paddingHorizontal:d.CompositeNotificationToastInfo.horizontal,paddingVertical:10}),leftContentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10}),stopRecordingContentContainer:()=>n.Styles.createViewStyle({paddingHorizontal:5,flexDirection:"row"}),statusContentContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementTextStyle:()=>n.Styles.createTextStyle({flex:1,color:f.Color.white,wordBreak:"break-word",paddingRight:10,textAlign:"right"}),statusTextStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",paddingLeft:10}),linkStyle:()=>n.Styles.createTextStyle({color:f.Color.sxBlue})});class w extends s.RemoteBaseCallRecorderToast{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss(),this._cleanToastMessage(!0)}}_buildState(e,t){const i=h.default.getToast(e.id);if(i&&i.state){const t=i.state,o=r.default.CallingStore.getCallState(t.callId);return{callId:t.callId,callState:o,shouldToastBeRemoved:e.shouldToastBeRemoved(o),initiatorDisplayName:e.initiatorMri?p.default.getMemberShortNameForConversation(t.conversationMri,e.initiatorMri):void 0}}return{}}render(){const e=(0,a.jsx)(u.default,{icons:this.props.icons});let t,i;this.state.initiatorDisplayName?t=_.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotificationTextPath&&(t=_.getString(this.props.initialNotificationTextPath)),t&&(i=(0,a.jsx)(b.BodyText,{style:[I.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1,children:t}));const o=this.props.onDismiss?this._renderCloseButton():void 0;return(0,a.jsx)(n.View,{style:I.container,children:(0,a.jsx)(n.View,{style:I.leftContentContainer,children:(0,a.jsxs)(n.View,{style:I.statusContentContainer,children:[e,i,o]})})})}_cleanToastMessage(e){(this.state.shouldToastBeRemoved||!l.default.isCallStateActive(this.state.callState)||e)&&(m.log(g.LogTraceArea.CallingUI,`[RemotePrivacyToastComponent][_cleanToast] removing toast with toast id: ${this.props.id}}`),h.default.removeToast(this.props.id))}_renderCloseButton(){return(0,a.jsx)(C.default,{icon:y.SkypeIcon.ClosePanel,size:y.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:_.getString("Global.CloseButtonTitle"),onPress:this._onDismiss})}componentDidMount(){super.componentDidMount(),this._cleanToastMessage()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._cleanToastMessage()}componentWillUnmount(){super.componentWillUnmount(),this._cleanToastMessage()}}t.RemotePrivacyToastComponent=w;class P extends s.LocalBaseCallRecorderToast{_buildState(e,t){const i=h.default.getToast(e.id);if(i&&i.state){const o=i.state,a=r.default.CallingStore.getCallState(o.callId);return{callId:o.callId,showPrivacyLink:t||!(!this.state||!this.state.showPrivacyLink),callState:a,shouldToastBeRemoved:e.shouldToastBeRemoved(a),recordingTimestamp:e.getTimestamp(),isAccessibleTheme:v.default.isAccessibleTheme()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.shouldToastBeRemoved&&(m.log(g.LogTraceArea.CallingUI,"LocalPrivacyToastComponent.componentDidUpdate removing toast"),h.default.removeToast(this.props.id,c.ToastActionType.Dismissed,!0))}render(){const e=[{icon:y.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:y.SkypeIcon.CallRecordDot,color:f.Color.red}],t=(0,a.jsx)(n.Button,{onPress:this._onStopPress,accessibilityLabel:_.getString(this.props.stopLinkTextPath),children:(0,a.jsx)(u.default,{icons:e})});let i;this.state.recordingTimestamp&&(i=(0,a.jsx)(b.BodyText,{style:[I.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1,children:this._getElapsedTime()}));const o=(0,a.jsxs)(n.View,{style:I.stopRecordingContentContainer,children:[i,(0,a.jsx)(b.BodyText,{style:I.statusTextStyle,allowFontScaling:!1,children:(0,a.jsx)(T.default,{url:"#",style:this.state.isAccessibleTheme?this._themeStyles.headerTextColorStyle:I.linkStyle,allowFontScaling:!1,onPress:this._onStopPress,children:_.getString(this.props.stopLinkTextPath)})})]});let s;if(this.state.showPrivacyLink){const e=(0,a.jsx)(T.default,{url:"#",style:this.state.isAccessibleTheme?this._themeStyles.headerTextColorStyle:I.linkStyle,allowFontScaling:!1,onPress:this._onMorePrivacyInfoPress,children:_.getString(this.props.morePrivacyInfoLinkTextPath)});s=(0,a.jsxs)(n.View,{style:I.privacyStatementContainer,children:[(0,a.jsx)(b.BodyText,{style:[I.privacyStatementTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1,children:_.getParts(this.props.privacyStatementTextPath,{learnMoreLink:e})}),(0,a.jsx)(C.default,{icon:y.SkypeIcon.ClosePanel,size:y.IconSize.size20,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:_.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress})]})}return(0,a.jsx)(n.View,{style:I.container,children:(0,a.jsx)(n.View,{style:I.leftContentContainer,children:(0,a.jsxs)(n.View,{style:I.statusContentContainer,children:[t,o,s]})})})}}t.LocalPrivacyToastComponent=P},336764:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(827361)),r=o.__importDefault(i(497910));class l extends r.default{constructor(){super(...arguments),this._isBalancePanelCollapsed=!1,this._balancePanelExpandedAnimatedHeight=new n.Animated.Value(0),this._balancePanelExpandedAnimatedStyles=n.Styles.createAnimatedViewStyle({height:this._balancePanelExpandedAnimatedHeight}),this._isBalancePanelCollapsedOnCompletion=!1,this._isCollapsed=()=>this._isBalancePanelCollapsed||this._isBalancePanelCollapsedOnCompletion,this.toggleBalancePanelVisibility=e=>{if(!this.state.balancePanelExpandedHeight||!this._balancePanelExpandedAnimatedHeight)return;if(this._isBalancePanelCollapsed===e)return;if(this.props.onCannotToggle&&this.props.onCannotToggle(e))return;if(this._balancePanelInProgressAnimation){if(this._isBalancePanelCollapsedOnCompletion===e)return;this._balancePanelInProgressAnimation.stop(),this._balancePanelInProgressAnimation=void 0}this._isBalancePanelCollapsedOnCompletion=e;const t=[];e?t.push(n.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:0,duration:10,easing:n.Animated.Easing.Out(),isInteraction:!1})):t.push(n.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:this.state.balancePanelExpandedHeight,duration:10,easing:n.Animated.Easing.In()}));const i=e=>{this._balancePanelInProgressAnimation=void 0,this._isBalancePanelCollapsed=e,this.forceUpdate()};this._balancePanelInProgressAnimation=n.Animated.parallel(t),this._balancePanelInProgressAnimation.start((()=>{i(e)}))},this._onLayout=e=>{this.state.balancePanelExpandedHeight||!this.isComponentMounted()||this.props.isInLandscape||this._isCollapsed()||(this._balancePanelExpandedAnimatedHeight.setValue(e.height),this.setState({balancePanelExpandedHeight:e.height,useAnimatedLayout:!0}))}}_buildState(e,t){return{balancePanelExpandedHeight:t?void 0:this.state.balancePanelExpandedHeight,useAnimatedLayout:!t&&this.state.useAnimatedLayout}}render(){let e;return n.UserInterface.isNavigatingWithKeyboard()&&this._isBalancePanelCollapsed&&(e=s.default.displayNone),!this.props.isInLandscape&&this.state.useAnimatedLayout?(0,a.jsx)(n.View,{style:e,onLayout:this._onLayout,children:(0,a.jsx)(n.Animated.View,{style:this._balancePanelExpandedAnimatedStyles,children:this.props.children})}):(0,a.jsx)(n.View,{style:e,onLayout:this._onLayout,children:this.props.children})}}t.default=l},255556:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(453761)),r=i(26703),l=o.__importStar(i(704704)),c=o.__importDefault(i(960282)),d=i(16549),u=i(641400),h=o.__importDefault(i(827361)),p=o.__importDefault(i(497910)),g=(0,r.lazyProperties)({dialerWrapper:()=>n.Styles.createViewStyle({backgroundColor:d.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),collapsedDialpadButtonContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center"}),dialpadIcon:()=>n.Styles.createButtonStyle({borderRadius:20,flexGrow:1,paddingVertical:15})});class C extends p.default{constructor(){super(...arguments),this._isDialpadCollapsed=!1,this._useAnimatedLayout=!1,this._dialpadExpandedAnimatedHeight=new n.Animated.Value(0),this._dialpadExpandedAnimatedStyles=n.Styles.createAnimatedViewStyle({height:this._dialpadExpandedAnimatedHeight}),this._dialpadCollapsedAnimatedHeight=new n.Animated.Value(0),this._dialpadCollapsedAnimatedStyles=n.Styles.createAnimatedViewStyle({height:this._dialpadCollapsedAnimatedHeight}),this._isDialpadCollapsedOnCompletion=!1,this.toggleDialpadToCollapsedState=e=>{this._isDialpadCollapsed!==e&&this._dialpadAnimation(e)},this.isCollapsed=()=>this._isDialpadCollapsed||this._isDialpadCollapsedOnCompletion,this._dialpadAnimation=e=>{if(!this.state.dialpadExpandedHeight||!this._useAnimatedLayout)return;if(this._dialpadInProgressAnimation){if(this._isDialpadCollapsedOnCompletion===e)return;this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0}this._isDialpadCollapsedOnCompletion=e,this.props.onToggleStart&&this.props.onToggleStart(e);const t=[];e?(t.push(n.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:0,duration:210,easing:n.Animated.Easing.Out()})),t.push(n.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:54,duration:30,easing:n.Animated.Easing.In()}))):(t.push(n.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:0,duration:30,easing:n.Animated.Easing.Out()})),t.push(n.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:this.state.dialpadExpandedHeight,duration:210,easing:n.Animated.Easing.In()})));const i=e=>{this._dialpadInProgressAnimation=void 0,this.isComponentMounted()&&(this._isDialpadCollapsed=e,this.props.onToggleCompletion&&this.props.onToggleCompletion(e),this.forceUpdate())};this._dialpadInProgressAnimation=n.Animated.sequence(t),this._dialpadInProgressAnimation.start((()=>{i(e)}))},this._onPanVertical=e=>{this.props.isInLandscape||e.isComplete&&Math.abs(e.velocityY)>.2&&(e.velocityY<0?this.toggleDialpadToCollapsedState(!1):this.toggleDialpadToCollapsedState(!0))},this._onPressDialpadViewCollapsed=e=>{e&&(e.stopPropagation(),e.preventDefault()),this.toggleDialpadToCollapsedState(!1)},this._onLayout=e=>{!this.isComponentMounted()||this.props.isInLandscape||this.isCollapsed()||this._useAnimatedLayout||(this._useAnimatedLayout=!0,this.setState({dialpadExpandedHeight:e.height}),this.props.onHeightsChanged&&this.props.onHeightsChanged(e.height,54))},this._renderDialpadViewCollapsed=()=>{const e=[g.dialerWrapper];this._useDarkTheme()||e.push(this._themeStyles.searchBoxColorStyle);const t=this._isDialpadCollapsed||!1,i=l.getString("PeopleList.PstnDialpadLabel");return(0,a.jsx)(n.Animated.View,{style:[this._dialpadCollapsedAnimatedStyles,e],children:(0,a.jsx)(n.View,{style:g.collapsedDialpadButtonContainer,importantForAccessibility:t?n.Types.ImportantForAccessibility.No:n.Types.ImportantForAccessibility.NoHideDescendants,children:(0,a.jsx)(s.default,{icon:u.SkypeIcon.Dialpad,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,size:u.IconSize.size24,style:g.dialpadIcon,onPress:this._onPressDialpadViewCollapsed,tabIndex:t?void 0:-1,title:i,accessibilityLabel:i})})})}}_buildState(e,t){const i=this._getRootViewId();return{dialpadExpandedHeight:t?void 0:this.state.dialpadExpandedHeight,viewWidth:c.default.getWidth(i),viewHeight:c.default.getHeight(i)}}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),t.dialpadExpandedHeight&&this.state.dialpadExpandedHeight!==t.dialpadExpandedHeight?this._dialpadExpandedAnimatedHeight.setValue(t.dialpadExpandedHeight):this.props.isInLandscape||e.isInLandscape||this.state.viewWidth===t.viewWidth&&this.state.viewHeight===t.viewHeight||(this._useAnimatedLayout=!1,this.isCollapsed()&&(this._dialpadInProgressAnimation&&(this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0),this._dialpadCollapsedAnimatedHeight.setValue(0),this._isDialpadCollapsed=!1,this._isDialpadCollapsedOnCompletion=!1))}render(){if(this.props.isInLandscape)return(0,a.jsx)(n.View,{style:h.default.flexOne,children:this.props.children});let e;if(this._useAnimatedLayout){const t=[this._dialpadExpandedAnimatedStyles];n.UserInterface.isNavigatingWithKeyboard()&&this._isDialpadCollapsed&&t.push(h.default.displayNone),e=(0,a.jsxs)(n.View,{onLayout:this._onLayout,children:[(0,a.jsx)(n.Animated.View,{style:t,children:this.props.children}),this._renderDialpadViewCollapsed()]})}else e=(0,a.jsxs)(n.View,{onLayout:this._onLayout,children:[this.props.children,this._renderDialpadViewCollapsed()]});return e}}t.default=C},90765:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(497910));class r extends s.default{constructor(){super(...arguments),this._animatedHeight=new n.Animated.Value(0),this._animatedStyles=n.Styles.createAnimatedViewStyle({height:this._animatedHeight})}toggleToCollapsedState(){this._animatedHeight.setValue(this.state.collapsedHeight)}toggleToExpandedState(){this._animatedHeight.setValue(this.state.expandedHeight)}toggleToHiddenState(){this._animatedHeight.setValue(0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.expandedHeight!==t.expandedHeight&&this._animatedHeight.setValue(t.expandedHeight)}render(){return this.props.isInLandscape?null:(0,a.jsx)(n.Animated.View,{style:this._animatedStyles})}}t.default=r},99377:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(317588)),r=o.__importDefault(i(582176)),l=o.__importStar(i(85385)),c=o.__importDefault(i(114818)),d=i(26703),u=o.__importStar(i(427393)),h=o.__importDefault(i(791384)),p=i(16549),g=o.__importDefault(i(827361)),C=i(262725),m=o.__importDefault(i(497910)),S=(0,d.lazyProperties)({callRateStyle:()=>n.Styles.createTextStyle({paddingHorizontal:20,color:p.Color.white,backgroundColor:p.Color.transparent,marginBottom:10}),image:()=>n.Styles.createViewStyle({height:110,width:158})});class _ extends m.default{_buildState(e,t){const i=r.default.getCallRate(),o=r.default.tasterImageEnabled();return{callRateMessage:i.message,isTasterEligible:i.isTasterEligible,tasterImageEnabled:o}}componentDidMount(){super.componentDidMount(),this.state.isTasterEligible&&this.state.tasterImageEnabled&&l.track(new u.TasterImageShown)}shouldComponentUpdate(e,t){return!(0,c.default)(this.state,t)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isTasterEligible&&t.tasterImageEnabled||!this.state.isTasterEligible||!this.state.tasterImageEnabled||l.track(new u.TasterImageShown),t.callRateMessage!==this.state.callRateMessage&&this.state.callRateMessage&&h.default.shouldAnnounceForAccessibility()&&n.Accessibility.announceForAccessibility(this.state.callRateMessage)}render(){if(void 0===this.state.callRateMessage)return null;const e=[S.callRateStyle];!this._useDarkTheme()&&this._useAccessibleTheme()&&e.push(this._themeStyles.primaryTextColorStyle);const t=(0,a.jsx)(C.Subtitle,{style:e,children:this.state.callRateMessage});return this.state.isTasterEligible&&this.state.tasterImageEnabled?(0,a.jsxs)(n.View,{style:g.default.alignItemsCenter,children:[(0,a.jsx)(n.Image,{source:s.Collection.TASTER_POST_CALL_ILLUSTRATION,style:S.image,resizeMode:"contain"}),t]}):t}}t.default=_},839401:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CountryListItemKey=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(614080),r=o.__importStar(i(516778)),l=i(154235),c=o.__importDefault(i(358878)),d=i(26703),u=o.__importStar(i(704704)),h=o.__importDefault(i(942724)),p=o.__importDefault(i(117475)),g=o.__importDefault(i(791384)),C=i(884853),m=o.__importDefault(i(827361)),S=o.__importDefault(i(497910)),_=o.__importDefault(i(601274)),f=(0,d.lazyProperties)({sectionHeader:()=>r.Styles.createViewStyle({height:40,flexDirection:"row",alignItems:"center",paddingHorizontal:12})}),y="country",T="header";function b(e,t){return e===v.CountryCode?t.country:t.countryCode.toString()}var v;!function(e){e[e.CountryCode=0]="CountryCode",e[e.PhoneCountryCode=1]="PhoneCountryCode"}(v||(t.CountryListItemKey=v={}));class I extends S.default{constructor(){super(...arguments),this._onCountrySelect=e=>{var t;const i=null!==(t=this.props.countryListItemKey)&&void 0!==t?t:v.CountryCode;this.props.onSelect(b(i,e))},this._renderCountryItem=e=>{const t=this.props.recentCountries&&this.props.recentCountries[e.key]||this.props.countries[e.key];return(0,a.jsx)(c.default,{filter:this.state.filter,country:t,rowTitleStyleOverride:this.props.rowTitleStyleOverride,onSelect:this._onCountrySelect,showFlag:this.props.showFlags})},this._renderHeaderItem=e=>(0,a.jsx)(r.View,{style:f.sectionHeader,children:(0,a.jsx)(C.SectionTitle,{title:e.key,titleStyles:m.default.flexOne},e.key)}),this._renderItem=e=>{switch(e.template){case T:return this._renderHeaderItem(e);case y:return this._renderCountryItem(e);default:return[]}},this._filterCountries=e=>{var t;return e&&n.includes(e.countryName.toLowerCase(),null===(t=this.state.filter)||void 0===t?void 0:t.toLowerCase())}}_buildState(e,t){return{isUsingStackNavigationContext:h.default.isUsingStackNavigationContext(),safeAreaPaddingStyle:p.default.horizontalPaddingStyle(l.HorizontalInsetDefault)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.filter&&this.state.filter!==t.filter){this._cancelAnnoncement();const e=u.getString("PSTNCountryList.SearchResult",{count:n.size(this._filteredCountries)});this._announceForAccessibility(e,500)}}render(){const e=[m.default.flexOne];return this.state.safeAreaPaddingStyle&&e.push(this.state.safeAreaPaddingStyle),(0,a.jsx)(r.View,{style:e,children:(0,a.jsx)(s.VirtualListView,{itemList:this._getCountriesListItems(),renderItem:this._renderItem,animateChanges:!1,keyboardShouldPersistTaps:!0,keyboardDismissMode:"on-drag"})})}onFilterChange(e){this.isComponentMounted()&&this.setState({filter:e})}_getListHeader(e){return{key:e,height:40,template:T,isNavigable:!1,accessibilityGroup:s.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:e}}_getCountriesListItems(){this._filteredCountries=this.state.filter?n.filter(this.props.countries,this._filterCountries):n.values(this.props.countries);const e=(this.props.isSortedList?[...this._filteredCountries].sort(((e,t)=>e.countryName.localeCompare(t.countryName))):this._filteredCountries).map((e=>{var t;return((e,t)=>({key:b(t,e),height:60,template:y}))(e,null!==(t=this.props.countryListItemKey)&&void 0!==t?t:v.CountryCode)}));if(this.state.filter||n.isEmpty(this.props.recentCountries)){const t=[];return this.state.isUsingStackNavigationContext||t.push(this._getListHeader(u.getString("PSTNCountryList.Result"))),n.concat(t,e)}const t=Object.values(this.props.recentCountries||[]).filter((e=>!!e)).map((e=>{var t;return((e,t)=>({key:`recent_${b(t,e)}`,height:60,template:y}))(e,null!==(t=this.props.countryListItemKey)&&void 0!==t?t:v.CountryCode)})),i=[this._getListHeader(u.getString("PSTNCountryList.Recent"))],o=[this._getListHeader(u.getString("PSTNCountryList.All"))];return n.concat(i,t,o,e)}_announceForAccessibility(e,t=0){this._announcePromise=_.default.sleep(t).then((()=>g.default.maybeAnnounceForAccessibility(e)))}_cancelAnnoncement(){this._announcePromise&&(this._announcePromise.cancel(),this._announcePromise=void 0)}}t.default=I},358878:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(26703),r=o.__importDefault(i(998929)),l=o.__importDefault(i(252089)),c=o.__importDefault(i(20758)),d=i(262725),u=o.__importDefault(i(497910)),h=i(186907),p=i(308861),g=(0,s.lazyProperties)({countryListItemCode:()=>n.Styles.createTextStyle({flex:0,marginHorizontal:20,textAlign:"right"}),countryListItemName:()=>n.Styles.createTextStyle({flex:1,flexDirection:"row",marginHorizontal:20}),countryFlagItem:()=>n.Styles.createViewStyle({marginLeft:20}),countryListItem:()=>n.Styles.createViewStyle({alignItems:"center",borderBottomWidth:1,flexDirection:"row",height:60,justifyContent:"space-between"})});class C extends u.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onSelect(this.props.country)}}render(){let e;const t=c.default.rowTitleFontStyle(this._currentTheme),i=[t,l.default.getTextColorStyleNoSubscription()],o=[t,this._themeStyles.secondaryTextColorStyle,g.countryListItemCode];if(this.props.filter){const o=this.props.country.countryName.toLowerCase().indexOf(this.props.filter.toLowerCase()),s=this.props.country.countryName.substring(0,o),r=this.props.country.countryName.substring(o,this.props.filter.length+o),l=this.props.country.countryName.substring(s.length+r.length);e=(0,a.jsxs)(n.Text,{style:g.countryListItemName,numberOfLines:1,children:[(0,a.jsx)(n.Text,{style:t,children:s}),(0,a.jsx)(n.Text,{style:i,children:r}),(0,a.jsx)(n.Text,{style:t,children:l})]})}else e=(0,a.jsx)(n.Text,{style:g.countryListItemName,numberOfLines:1,children:(0,a.jsx)(d.RowTitle,{textStyle:this.props.rowTitleStyleOverride,children:this.props.country.countryName})});const s={id:`flag_${this.props.country.country}`,firstFrame:0,frameCount:0};return(0,a.jsxs)(r.default.Button,{style:[g.countryListItem,this._themeStyles.dividerBorderColorStyle],onPress:this._onPress,underlayColor:this._themeColors.rowHighlightColor,accessibilityLabel:`${this.props.country.countryName} +${this.props.country.countryCode}`,accessibilityTraits:n.Types.AccessibilityTrait.Button,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,children:[this.props.showFlag&&(0,a.jsx)(p.StaticEmoticon,{emoticonInfo:s,size:h.EmoticonSize.Medium,style:g.countryFlagItem},s.id),e,(0,a.jsxs)(n.Text,{style:o,children:["+",this.props.country.countryCode]})]})}}t.default=C},477069:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(402536)),l=o.__importDefault(i(582176)),c=o.__importDefault(i(244261)),d=o.__importDefault(i(54945)),u=i(26703),h=o.__importStar(i(704704)),p=o.__importStar(i(629564)),g=(0,u.lazyProperties)({dialpad:()=>s.Styles.createViewStyle({flexGrow:1,flexShrink:0,marginHorizontal:5}),row:()=>s.Styles.createViewStyle({flexDirection:"row",flexGrow:1,flexShrink:0}),rowReverse:()=>s.Styles.createViewStyle({flexDirection:"row-reverse",flexGrow:1,flexShrink:0})}),C={dialpad:(0,u.lazyProperties)({MobileSmall:()=>s.Styles.createViewStyle({marginVertical:5}),MobileMedium:()=>s.Styles.createTextStyle({marginVertical:10}),MobileDefaultLandscape:()=>s.Styles.createTextStyle({marginVertical:10}),MobileDefault:()=>s.Styles.createTextStyle({marginVertical:15}),DesktopDefault:()=>s.Styles.createTextStyle({marginVertical:5})})},m=/[\r\n]+/;class S extends p.ResponsiveComponentBase{constructor(e){super(e),this._focusedButtonIndex=0,this._dialpadButtons=[],this._dialpadButtonRefCallbacks={},this._dialpadButtonPressCallbacks={},this._getLocalizationLetters=e=>{let t;switch(e){default:case"ABC":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_ABC");break;case"DEF":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_DEF");break;case"GHI":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_GHI");break;case"JKL":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_JKL");break;case"MNO":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_MNO");break;case"PQRS":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_PQRS");break;case"TUV":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_TUV");break;case"WXYZ":t=h.getString("PSTNDialerPanel.DialpadLocalizationLetters_WXYZ")}return n.split(t,m)},this._onKeyPress=e=>{let t=-1;if(e.keyCode===d.default.UP?t=0:e.keyCode===d.default.RIGHT?t=1:e.keyCode===d.default.DOWN?t=2:e.keyCode===d.default.LEFT&&(t=3),t>=0){let i=this._buttonsNavigationMap[this._focusedButtonIndex][t],o=this._dialpadButtons[i];for(;o&&o.props.buttonDisabled;)i=this._buttonsNavigationMap[i][t],o=this._dialpadButtons[i];this._focusButton(o),e.preventDefault(),e.stopPropagation()}},this._onKeyLongPress=e=>t=>{this.props.onKeyLongPress&&this.props.onKeyLongPress(e)},this._onButtonFocused=e=>{const t=this._focusedButtonIndex;if(this._focusedButtonIndex=n.findIndex(this._dialpadButtons,(t=>t&&t.props.value===e.props.title))||0,this._focusedButtonIndex!==t){const e=this._dialpadButtons[t];e&&e.resetFocus()}},this._buttons={1:void 0,2:this._getLocalizationLetters("ABC"),3:this._getLocalizationLetters("DEF"),4:this._getLocalizationLetters("GHI"),5:this._getLocalizationLetters("JKL"),6:this._getLocalizationLetters("MNO"),7:this._getLocalizationLetters("PQRS"),8:this._getLocalizationLetters("TUV"),9:this._getLocalizationLetters("WXYZ"),"*":e.isDtmfDialpad?void 0:[","],",":void 0,0:["+"],"#":void 0},this._buttonsNavigationMap={0:[9,1,3,2],1:[10,2,4,0],2:[11,0,5,1],3:[0,4,6,5],4:[1,5,7,3],5:[2,3,8,4],6:[3,7,9,8],7:[4,8,10,6],8:[5,6,11,7],9:[6,10,0,11],10:[7,11,1,9],11:[8,9,2,10]}}_buildState(e,t){const i=super._buildState(e,t);return i.isCollapsed=l.default.isDialpadCollapsed(),i.isDialingExtension=l.default.isDialingExtension(),i.showCommaButton=!l.default.isDialingExtension()&&!e.isDtmfDialpad,i.canDialComma=l.default.canDialComma(),i}componentDidMount(){super.componentDidMount(),r.default.isCallingBundleLoaded()||(this._dialpadButtons.forEach((e=>null==e?void 0:e.toggleDisabledState(!0))),r.default.getCallingBundleStartupable().performAfterInitialized().then((()=>{this._dialpadButtons.forEach((e=>null==e?void 0:e.toggleDisabledState(!1)))})))}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.props.isDtmfDialpad&&t.showCommaButton!==this.state.showCommaButton){let e=this._dialpadButtons[this._focusedButtonIndex];e&&e.props.buttonDisabled&&(e.resetFocus(),e=this._dialpadButtons[0],e&&e.setLastFocused())}}_getRowsCount(){let e=0;return n.each(this._buttons,(t=>{const i=n.size(t);return!(e<i&&(e=i,2===e))})),e+1}focusFirst(){this._focusButton(this._dialpadButtons[0]),s.Accessibility.announceForAccessibility("1")}render(){const e=[g.dialpad,this._chooseResponsiveStyle(C.dialpad)],t=this._getContext().isRTL?g.rowReverse:g.row,i=this._getRowsCount(),o={onButtonFocused:this._onButtonFocused,isInLandscape:this.props.isInLandscape,isDtmfDialpad:this.props.isDtmfDialpad,disableFontScaling:this.props.disableFontScaling};return(0,a.jsxs)(s.View,{style:e,onKeyPress:this._onKeyPress,importantForAccessibility:this.state.isCollapsed?s.Types.ImportantForAccessibility.NoHideDescendants:void 0,children:[(0,a.jsxs)(s.View,{style:t,children:[(0,a.jsx)(c.default,Object.assign({value:"1",rowCount:i,letters:this._buttons[1],ref:this._getDialpadButtonRefCallback(0),onPress:this._getDialpadButtonPressCallback("1")},o)),(0,a.jsx)(c.default,Object.assign({value:"2",rowCount:i,letters:this._buttons[2],ref:this._getDialpadButtonRefCallback(1),onPress:this._getDialpadButtonPressCallback("2")},o)),(0,a.jsx)(c.default,Object.assign({value:"3",rowCount:i,letters:this._buttons[3],ref:this._getDialpadButtonRefCallback(2),onPress:this._getDialpadButtonPressCallback("3")},o))]}),(0,a.jsxs)(s.View,{style:t,children:[(0,a.jsx)(c.default,Object.assign({value:"4",rowCount:i,letters:this._buttons[4],ref:this._getDialpadButtonRefCallback(3),onPress:this._getDialpadButtonPressCallback("4")},o)),(0,a.jsx)(c.default,Object.assign({value:"5",rowCount:i,letters:this._buttons[5],ref:this._getDialpadButtonRefCallback(4),onPress:this._getDialpadButtonPressCallback("5")},o)),(0,a.jsx)(c.default,Object.assign({value:"6",rowCount:i,letters:this._buttons[6],ref:this._getDialpadButtonRefCallback(5),onPress:this._getDialpadButtonPressCallback("6")},o))]}),(0,a.jsxs)(s.View,{style:t,children:[(0,a.jsx)(c.default,Object.assign({value:"7",rowCount:i,letters:this._buttons[7],ref:this._getDialpadButtonRefCallback(6),onPress:this._getDialpadButtonPressCallback("7")},o)),(0,a.jsx)(c.default,Object.assign({value:"8",rowCount:i,letters:this._buttons[8],ref:this._getDialpadButtonRefCallback(7),onPress:this._getDialpadButtonPressCallback("8")},o)),(0,a.jsx)(c.default,Object.assign({value:"9",rowCount:i,letters:this._buttons[9],ref:this._getDialpadButtonRefCallback(8),onPress:this._getDialpadButtonPressCallback("9")},o))]}),(0,a.jsxs)(s.View,{style:t,children:[(0,a.jsx)(c.default,Object.assign({overrideKey:"buttonStarComma",value:this.state.showCommaButton?",":"*",accessibilityLabel:this.state.showCommaButton?h.getString("KeyboardShortcuts.CommaKey"):void 0,rowCount:i,letters:this._buttons[this.state.showCommaButton?",":"*"],longPressValue:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:",",buttonDisabled:!this.props.isDtmfDialpad&&!this.state.canDialComma,ref:this._getDialpadButtonRefCallback(9),onPress:this._getDialpadButtonPressCallback(this.state.showCommaButton?",":"*"),onLongPress:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:this._onKeyLongPress("*")},o)),(0,a.jsx)(c.default,Object.assign({value:"0",rowCount:i,letters:this._buttons[0],longPressValue:"+",ref:this._getDialpadButtonRefCallback(10),onPress:this._getDialpadButtonPressCallback("0"),onLongPress:this._onKeyLongPress("0")},o)),(0,a.jsx)(c.default,Object.assign({value:"#",rowCount:i,letters:this._buttons["#"],buttonDisabled:!this.props.isDtmfDialpad&&!this.state.isDialingExtension,ref:this._getDialpadButtonRefCallback(11),onPress:this._getDialpadButtonPressCallback("#")},o))]})]})}_getDialpadButtonRefCallback(e){return this._dialpadButtonRefCallbacks[e]||(this._dialpadButtonRefCallbacks[e]=t=>{this._dialpadButtons[e]=t||void 0}),this._dialpadButtonRefCallbacks[e]}_getDialpadButtonPressCallback(e){return this._dialpadButtonPressCallbacks[e]||(this._dialpadButtonPressCallbacks[e]=t=>{this.props.onKeyPress&&this.props.onKeyPress(e)}),this._dialpadButtonPressCallbacks[e]}_focusButton(e){e&&e.requestFocus()}}t.default=S},244261:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(537180),r=o.__importDefault(i(369347)),l=i(815146),c=o.__importStar(i(85385)),d=i(26703),u=(o.__importStar(i(704704)),o.__importDefault(i(92179))),h=o.__importDefault(i(879119)),p=o.__importStar(i(629564)),g=i(96575),C=i(16549),m=o.__importDefault(i(20758)),S=i(262725),_=o.__importDefault(i(760989)),f=o.__importDefault(i(582176)),y=i(677982),T=(0,d.lazyProperties)({dialpadButton:()=>n.Styles.createViewStyle({alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46}),dialpadButtonContent:()=>n.Styles.createViewStyle({alignSelf:"center",flexDirection:"column",flexGrow:1,flexShrink:0}),dialpadButtonContentLandscape:()=>n.Styles.createViewStyle({flexDirection:"row",flexGrow:0,width:50,overflow:"visible",flexWrap:"nowrap"}),buttonLettersContainer:()=>n.Styles.createViewStyle({alignSelf:"center",alignItems:"center"}),buttonLettersContainerLandsape:()=>n.Styles.createViewStyle({paddingLeft:7,alignItems:"flex-start"}),dialpadButtonNumber:()=>n.Styles.createTextStyle({font:m.default.font.uiDisplayBold,textAlign:"center"}),dialpadButtonLetters:()=>n.Styles.createTextStyle({lineHeight:16})}),b=(0,d.lazyProperties)({dialpadButtonNumber:()=>n.Styles.createTextStyle({color:C.Color.white,font:m.default.font.uiDisplayBold}),dialpadButtonLetters:()=>n.Styles.createTextStyle({color:C.Color.white})}),v={dialpadButton:(0,d.lazyProperties)({MobileDefaultLandscape:()=>n.Styles.createViewStyle({margin:void 0}),MobileDefault:()=>n.Styles.createViewStyle({margin:5}),DesktopSmall:()=>n.Styles.createTextStyle({margin:void 0}),DesktopDefault:()=>n.Styles.createTextStyle({margin:5})}),dialpadButtonNumber:(0,d.lazyProperties)({MobileSmall:()=>n.Styles.createTextStyle({fontSize:m.default.controlFontSize.h4,lineHeight:30}),MobileMedium:()=>n.Styles.createTextStyle({fontSize:m.default.controlFontSize.dialpadNumber,lineHeight:36}),MobileDefault:()=>n.Styles.createTextStyle({fontSize:m.default.controlFontSize.dialpadNumberLarge,lineHeight:42}),DesktopDefault:()=>n.Styles.createTextStyle({fontSize:m.default.controlFontSize.h4,lineHeight:30})})};class I extends p.ResponsiveComponentBase{constructor(){super(...arguments),this._onPress=e=>{if(this.props.buttonDisabled)return;const t=_.default.newCauseId();u.default.createTrackerAndMarkPressTime(t,g.ScenarioName.ResponsivenessPressDialpadButton,e),c.log(l.LogTraceArea.DialerStore,"DialpadButton._onPress causeId: "+t),this.props.isDtmfDialpad||(h.default.appendCharToPhoneNumberInput(this.props.value),this._playDTMFSound(t)),this.props.onPress(e),u.default.markActionDoneAndRemoveTracker(t),f.default.cleanupPhoneNumberVaild()},this._onLongPress=e=>{if(!this.props.buttonDisabled){if(!this.props.isDtmfDialpad){const e=_.default.newCauseId();c.log(l.LogTraceArea.DialerStore,"DialpadButton._onLongPress causeId: "+e),h.default.appendCharToPhoneNumberInput(this.props.longPressValue||this.props.value),this._playDTMFSound(e)}this.props.onLongPress&&this.props.onLongPress(e)}},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._onFocus=e=>{this.isComponentMounted()&&(this.props.onButtonFocused&&this._buttonRef&&!this.props.buttonDisabled&&this.props.onButtonFocused(this._buttonRef),this.setState({isLastFocusedBtn:!0}))}}_buildState(e,t){const i=super._buildState(e,t);return t&&(i.isLastFocusedBtn="1"===e.value),i.enablePlayingDTMFSoundAfterInteractions=y.AppConfigStore.getS4LCMCFeatures().enablePlayingDTMFSoundAfterInteractions,i}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}resetFocus(){this.setState({isLastFocusedBtn:!1})}setLastFocused(){this.setState({isLastFocusedBtn:!0})}toggleDisabledState(e){this.setState({isDisabled:e})}render(){var e;const t=[T.dialpadButton,this._chooseResponsiveStyle(v.dialpadButton)],i=[T.dialpadButtonContent],o=[T.buttonLettersContainer];this.props.isInLandscape&&(i.push(T.dialpadButtonContentLandscape),o.push(T.buttonLettersContainerLandsape));const s=[n.Types.AccessibilityTrait.Button];let r=this.props.accessibilityLabel||this.props.value;return this.props.buttonDisabled&&s.push(n.Types.AccessibilityTrait.Disabled),(0,a.jsx)(n.Button,{style:t,ref:this._onButtonRef,onPress:this._onPress,onFocus:this._onFocus,title:this.props.value,onLongPress:this._onLongPress,disabled:this.props.buttonDisabled||null!==(e=this.state.isDisabled)&&void 0!==e&&e,accessibilityTraits:s,accessibilityLabel:r,tabIndex:this.state.isLastFocusedBtn?0:-1,children:(0,a.jsxs)(n.View,{style:i,children:[this._getValue(),(0,a.jsx)(n.View,{style:o,children:this._getLetters()},"view_"+this.props.value+"letters")]},"view_"+this.props.value+"button")},this.props.overrideKey||"button"+this.props.value)}_playDTMFSound(e){this.state.enablePlayingDTMFSoundAfterInteractions?s.InteractionManager.runAfterInteractions((()=>{r.default.PstnUtils.playDTMFSound(this.props.value,e)})):r.default.PstnUtils.playDTMFSound(this.props.value,e)}_getValue(){const e=[T.dialpadButtonNumber,this._themeStyles.primaryTextColorStyle,this._chooseResponsiveStyle(v.dialpadButtonNumber)];return this.props.isDtmfDialpad&&e.push(b.dialpadButtonNumber),(0,a.jsx)(n.Text,{style:e,allowFontScaling:!this.props.disableFontScaling,children:this.props.value},"value"+this.props.value)}_getLetters(){const e=[T.dialpadButtonLetters,this._themeStyles.primaryTextColorStyle];this.props.isDtmfDialpad&&e.push(b.dialpadButtonLetters);const t=[];for(let i=0;i<this.props.rowCount-1;i++)this.props.letters&&i in this.props.letters?t.push((0,a.jsx)(S.Caption,{style:e,allowFontScaling:!this.props.disableFontScaling,forceDirection:!0,children:this.props.letters[i]},"letters"+this.props.value+i)):this.props.isInLandscape||t.push((0,a.jsx)(S.Caption,{style:e,allowFontScaling:!this.props.disableFontScaling,children:" "},"letters"+this.props.value+i));return t}}t.default=I},793580:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(537180),r=o.__importDefault(i(265971)),l=o.__importDefault(i(690954)),c=o.__importDefault(i(582176)),d=o.__importDefault(i(457468)),u=i(26703),h=o.__importStar(i(879119)),p=o.__importDefault(i(848329)),g=o.__importDefault(i(497910)),C=i(637224),m=i(16549),S=i(154235),_=o.__importStar(i(704704)),f=(0,u.lazyProperties)({buttonsContainer:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row",justifyContent:"center",marginBottom:15,minHeight:60,overflow:"visible",paddingLeft:5,paddingRight:5}),buttonWrapper:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexBasis:0,flexDirection:"row",justifyContent:"center",minHeight:60}),buttonsContainerNew:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row",justifyContent:"space-around",marginBottom:15,minHeight:40,overflow:"visible",paddingLeft:24,paddingRight:24}),buttonWrapperNew:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexBasis:0,flexDirection:"column",justifyContent:"flex-start",minHeight:40,overflow:"visible",marginBottom:6}),textStyles:()=>n.Styles.createTextStyle({fontSize:10,fontStyle:"normal",fontWeight:S.FontWeight.regular,lineHeight:12,color:m.Color.gray500}),marginRightStyle:()=>n.Styles.createViewStyle({marginRight:7.5}),marginLeftStyle:()=>n.Styles.createViewStyle({marginLeft:7.5})}),y=s.StyleSheet.create({box:{width:"100%"}});class T extends g.default{constructor(){super(...arguments),this._callAllowed=()=>this.state.phoneNumber.callable&&!this.state.disableHighBandwidthOperations}shouldComponentUpdate(e,t){return!0}_buildState(e,t){const i=c.default.getCallRate();return{isCollapsed:c.default.isDialpadCollapsed(),phoneNumber:h.default.getPhoneNumber(h.TriggerKeys.Callable),disableHighBandwidthOperations:d.default.isUsingGogoNetwork(),smsPrice:c.default.getSmsRate(),callRateMessage:i.message,enableSmsNewEntry:c.default.isSmsNewEntryEnabled()}}renderSmsRateSection(){if(!this.state.smsPrice)return null;const{rate:e,currency:t}=this.state.smsPrice;return e&&t?(0,a.jsx)(n.Text,{style:f.textStyles,children:_.getString("PSTNDialerPanel.SmsRateInfo",{price:(0,C.getFormattedRate)(e,t,3)})}):null}renderCallRateSection(){return this.state.callRateMessage?(0,a.jsx)(n.Text,{style:f.textStyles,children:this.state.callRateMessage}):null}renderDialpadControlsWithButtonRedesign(){return(0,a.jsxs)(n.View,{style:f.buttonsContainerNew,importantForAccessibility:this.state.isCollapsed?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No,children:[(0,a.jsxs)(n.View,{style:n.Styles.combine(f.buttonWrapperNew,f.marginRightStyle),children:[(0,a.jsx)(s.View,{style:y.box,children:(0,a.jsx)(p.default,{phoneNumber:this.state.phoneNumber,canSendSms:this.state.phoneNumber.callable})}),this.renderSmsRateSection()]}),(0,a.jsxs)(n.View,{style:n.Styles.combine(f.buttonWrapperNew,f.marginLeftStyle),children:[(0,a.jsx)(s.View,{style:y.box,children:(0,a.jsx)(l.default,{phoneNumber:this.state.phoneNumber,canCall:this._callAllowed(),callId:this.props.callId,conversationMri:this.props.conversationId})}),this.renderCallRateSection()]})]})}render(){return this.state.enableSmsNewEntry?this.renderDialpadControlsWithButtonRedesign():(0,a.jsxs)(n.View,{style:f.buttonsContainer,importantForAccessibility:this.state.isCollapsed?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No,children:[(0,a.jsx)(n.View,{style:f.buttonWrapper,children:(0,a.jsx)(p.default,{phoneNumber:this.state.phoneNumber,canSendSms:this.state.phoneNumber.callable})}),(0,a.jsx)(n.View,{style:f.buttonWrapper,children:(0,a.jsx)(l.default,{phoneNumber:this.state.phoneNumber,canCall:this._callAllowed(),callId:this.props.callId,conversationMri:this.props.conversationId})}),(0,a.jsx)(n.View,{style:f.buttonWrapper,children:(0,a.jsx)(r.default,{})})]})}}t.default=T},265971:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(815146),r=o.__importDefault(i(453761)),l=i(26703),c=o.__importStar(i(704704)),d=o.__importDefault(i(879119)),u=o.__importDefault(i(791384)),h=i(16549),p=o.__importDefault(i(139221)),g=i(641400),C=o.__importDefault(i(497910)),m=o.__importDefault(i(582176)),S=(0,l.lazyProperties)({backspaceButton:()=>n.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class _ extends C.default{constructor(){super(...arguments),this._onBackspace=e=>{const[t,i]=d.default.eraseCharFromPhoneNumberInput();t&&i?u.default.maybeAnnounceForAccessibility(c.getString("PSTNPhoneNumberInput.OnBackspaceAnnouncement",{symbol:t})):u.default.maybeAnnounceForAccessibility(c.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement")),m.default.cleanupPhoneNumberVaild()},this._onLongBackspace=e=>{d.default.cleanupPhoneNumberInput(),u.default.maybeAnnounceForAccessibility(c.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))}}render(){const e=this.props.iconColor||(this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:h.Color.black),t=c.getString("Pstn.RemoveNumberButton"),i=n.Styles.combine(S.backspaceButton,this.props.style);return(0,a.jsx)(r.default,{icon:g.SkypeIcon.Backspace,color:e,hoverColor:e,size:g.IconSize.size24,style:i,onPress:this._onBackspace,onLongPress:this._onLongBackspace,title:t,accessibilityLabel:t,flipIcon:this._getContext().isRTL&&p.default.getPlatformType()!==s.PlatformType.Android})}}t.default=_},690954:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(187140)),r=o.__importDefault(i(369347)),l=o.__importDefault(i(631681)),c=i(315742),d=o.__importDefault(i(615364)),u=o.__importDefault(i(582176)),h=i(815146),p=o.__importStar(i(85385)),g=i(26703),C=o.__importStar(i(704704)),m=o.__importDefault(i(740794)),S=o.__importDefault(i(942724)),_=o.__importDefault(i(879119)),f=i(427393),y=i(16549),T=i(641400),b=o.__importDefault(i(497910)),v=o.__importDefault(i(760989)),I=o.__importDefault(i(660401)),w=i(154235),P=i(647648),M=o.__importDefault(i(872263)),D=o.__importDefault(i(746434)),A=o.__importDefault(i(535174)),k=o.__importDefault(i(285901)),R=(0,g.lazyProperties)({roundButton:()=>n.Styles.createButtonStyle({height:60,overflow:"visible",width:60}),newCallButton:()=>n.Styles.createButtonStyle({height:40,overflow:"visible",marginBottom:6})});class x extends b.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:c.CoachMarkAreaType.Dialer},this._startPstnCall=()=>{const e=v.default.newCauseId(),t=!!this.state.telephonyWarningParams;if(p.log(h.LogTraceArea.CallingUI,`[CallControl][_startPstnCall]: Start PSTN Call Button, willGoToCallerIdWarning ${t} causeId: ${e}`),p.track(new f.DialerPanelComponentClick(f.DialerPanelClickTarget.CallButton,void 0,u.default.isSmsNewEntryEnabled(),t)),this.state.telephonyWarningParams)return M.default.savePhoneNumberInput(this.props.phoneNumber.inputValue),M.default.shouldRestoreState(),void m.default.navigateToTelephonyWarning(this._getRootViewId(),this.state.telephonyWarningParams);if(this.state.showInvalidNoteBeforeStartCall){const t=u.default.isValidNumberForCountry(this.props.phoneNumber.inputValue,this.props.phoneNumber.countryCode);if(u.default.setIsPhoneNumberVaild(t),!t&&u.default.isCallClickCountLessThanOne(this.state.clickCallCount))return;t||u.default.isCallClickCountLessThanOne(this.state.clickCallCount)||p.track(new f.StartPSTNCallWithInvalidNotificationEvent(e))}k.default.startOrAddPstnCall(this.props.phoneNumber.E164,this.props.phoneNumber.emergency,this.props.phoneNumber.countryCode,this.props.phoneNumber.suffix,this.props.callId,this.props.conversationMri,this.props.phoneNumber.extension,e),this._isJoinCallRequest()&&(this.state.isUsingStackNavigationContext?this.props.conversationMri&&this.props.callId&&(p.log(h.LogTraceArea.CallingUI,"CallControl._startPstnCall causeId: "+e),r.default.CallNavigationHelper.rejoinCall(this.props.conversationMri,this.props.callId,e,_.default.getPhoneNumberOrigin()||h.NavigationCallOrigin.PstnDialpad)):m.default.closeGenericDesktopModal(e,this._getRootViewId()))}}_buildState(e,t){const i=u.default.getCallRate(),o=A.default.callerIdWarningForCountry(i),a={isUsingStackNavigationContext:S.default.isUsingStackNavigationContext(),conversationMembersMris:[],tasterCoachmarkEnabled:u.default.tasterCoachmarkEnabled(),tasterGreenCallButtonEnabled:u.default.tasterGreenCallButtonEnabled(),isTasterEligible:u.default.getCallRate().isTasterEligible,enableSmsNewEntry:u.default.isSmsNewEntryEnabled(),showInvalidNoteBeforeStartCall:u.default.isShowInvalidNoteBeforeStartCallEnabled(),telephonyWarningParams:(0,P.generateCallerIdWarningParams)(e.phoneNumber,o),clickCallCount:u.default.getClickCallCount()};if(e.callId&&e.conversationMri){const t=(0,d.default)().getConversation(e.conversationMri);t&&(a.conversationMembersMris=t.getMemberMris())}return a}render(){const e=this.state.isTasterEligible&&this.state.tasterGreenCallButtonEnabled?y.Color.green:void 0;let t=this.state.isTasterEligible&&this.state.tasterCoachmarkEnabled?(0,a.jsx)(l.default.ActionButton,{coachMarkType:c.CoachMarkType.PlaceTasterCall,anchorAccessibilityLabel:C.getString("PSTNDialerPanel.PlaceTasterCallCoachmarkTitle"),positions:[c.PopupAnchorPositon.Top],accessibilityLabel:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),accessibilityTraits:n.Types.AccessibilityTrait.Button,title:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:T.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:R.roundButton,backgroundColor:e}):(0,a.jsx)(s.default,{title:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:T.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:R.roundButton,backgroundColor:e});return this.state.enableSmsNewEntry&&(t=this.state.isTasterEligible&&this.state.tasterCoachmarkEnabled?(0,a.jsx)(l.default.SXButton,{coachMarkType:c.CoachMarkType.PlaceTasterCall,anchorAccessibilityLabel:C.getString("PSTNDialerPanel.PlaceTasterCallCoachmarkTitle"),positions:[c.PopupAnchorPositon.Top],accessibilityLabel:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),accessibilityTraits:n.Types.AccessibilityTrait.Button,title:C.getString("PSTNDialerPanel.CallButtonTitle"),icon:T.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:R.newCallButton,buttonSize:w.SXButtonSize.Medium}):(0,a.jsx)(I.default,{title:C.getString("PSTNDialerPanel.CallButtonTitle"),style:R.newCallButton,icon:T.SkypeIcon.CallStart,disabled:!this.props.canCall,buttonSize:w.SXButtonSize.Medium,onPress:this._startPstnCall,accessibilityLabel:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),accessibilityTraits:n.Types.AccessibilityTrait.Button})),(0,a.jsxs)(a.Fragment,{children:[this.state.telephonyWarningParams?(0,a.jsx)(D.default,Object.assign({},this.state.telephonyWarningParams)):null,(0,a.jsx)(c.CoachMarkContext.Provider,{value:this._coachMarkContext,children:t})]})}_isJoinCallRequest(){return this.props.callId&&this.props.conversationMri}}t.default=x},848329:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(331654)),s=o.__importStar(i(516778)),r=o.__importDefault(i(150343)),l=o.__importStar(i(603094)),c=o.__importDefault(i(304623)),d=o.__importDefault(i(988773)),u=o.__importDefault(i(37679)),h=i(815146),p=o.__importStar(i(85385)),g=i(26703),C=o.__importDefault(i(740794)),m=o.__importDefault(i(879119)),S=i(427393),_=o.__importStar(i(160049)),f=i(641400),y=o.__importDefault(i(497910)),T=o.__importDefault(i(760989)),b=o.__importDefault(i(660401)),v=i(154235),I=o.__importStar(i(704704)),w=o.__importDefault(i(453761)),P=i(16549),M=o.__importDefault(i(139221)),D=o.__importDefault(i(582176)),A=(0,g.lazyProperties)({smsButtonDimensions:()=>s.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46}),smsNewButtonDimensions:()=>s.Styles.createButtonStyle({height:40,overflow:"visible",marginBottom:6})});class k extends y.default{constructor(){super(...arguments),this._onPress=()=>{if(!this.props.canSendSms)return;const e=T.default.newCauseId();p.log(h.LogTraceArea.DialerPanel,"[action]: Send SMS Button, causeId: "+e),this.props.phoneNumber.emergency?this._startEmergencySMS(e):this._startSkypeSMS(e)}}_buildState(e,t){const i=u.default.getCreditEntitlement(),o=u.default.getSubscriptions(),a={searchResult:m.default.getSearchResults().exactMatch,canShowSmsEntryPoint:r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SmsButtonEnabled,supportsEmergencySms:t?void 0:this.state.supportsEmergencySms,sendButtonEnabled:!t&&this.state.sendButtonEnabled,userEntitlementsSummary:l.getEntitlementCombination(i,o),enableSmsNewEntry:D.default.isSmsNewEntryEnabled()};return e.canSendSms?e.phoneNumber.emergency&&!a.supportsEmergencySms?a.sendButtonEnabled=!1:a.sendButtonEnabled=!0:a.sendButtonEnabled=!1,a}render(){if(!this.state.canShowSmsEntryPoint)return null;if(this.state.enableSmsNewEntry)return(0,a.jsx)(b.default,{title:I.getString("PSTNDialerPanel.SmsButtonTitle"),buttonSize:v.SXButtonSize.Medium,icon:f.SkypeIcon.MobileSmsNew,disabled:!this.state.sendButtonEnabled,style:A.smsNewButtonDimensions,onPress:this._onPress});const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:P.Color.black;return(0,a.jsx)(w.default,{icon:f.SkypeIcon.MobileSmsNew,title:I.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),disabled:!this.state.sendButtonEnabled,color:e,hoverColor:e,size:f.IconSize.size24,style:A.smsButtonDimensions,onPress:this._onPress,flipIcon:this._getContext().isRTL&&M.default.getPlatformType()!==h.PlatformType.Android})}componentDidMount(){super.componentDidMount(),void 0===this.state.supportsEmergencySms&&n.default.supportsNativeEmergencyCalling().catch((()=>!1)).then((e=>{this.isComponentMounted()&&this.setState({supportsEmergencySms:e})}))}_startEmergencySMS(e){p.log(h.LogTraceArea.DialerPanel,"SMSControl._startEmergencySMS, causeId: "+e);const t=this.props.phoneNumber.suffix;t?(p.log(h.LogTraceArea.GenericUnsafe,"Placing emergency SMS to "+d.default.maskPhoneNumber(t)+", destination country: "+this.props.phoneNumber.countryCode),n.default.makeNativeEmergencySMS(t).then((e=>{e||p.warn(h.LogTraceArea.GenericUnsafe,"Failed to place emergency SMS")}))):p.warn(h.LogTraceArea.GenericUnsafe,"Refusing to place emergency SMS, reason: no information about phone number suffix")}_startSkypeSMS(e){p.log(h.LogTraceArea.DialerPanel,"SMSControl._startSkypeSMS, causeId: "+e);const t=d.default.getPhoneNumberMri(this.props.phoneNumber);c.default.ensureConversationLoadedOrFaked(t).then((i=>{const o={convId:t,origin:h.NavigationConversationOrigin.SmsControl,isNewConversation:i,causeId:e};_.default.setNextFlowId(_.SmsFlowId.Dialer),p.track(new S.DialerPanelComponentClick(S.DialerPanelClickTarget.SmsButton,this.state.userEntitlementsSummary,D.default.isSmsNewEntryEnabled())),C.default.navigateToConversation(o)}))}}t.default=k},479088:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(266311)),r=o.__importDefault(i(839401)),l=o.__importDefault(i(186325)),c=i(815146),d=o.__importDefault(i(560099)),u=o.__importDefault(i(970035)),h=o.__importStar(i(85385)),p=i(26703),g=o.__importStar(i(704704)),C=o.__importDefault(i(740794)),m=o.__importDefault(i(328416)),S=o.__importDefault(i(879119)),_=i(427393),f=o.__importDefault(i(791384)),y=o.__importDefault(i(602466)),T=i(375258),b=i(16549),v=i(641400),I=o.__importDefault(i(577267)),w=o.__importDefault(i(827361)),P=i(262725),M=o.__importDefault(i(497910)),D=o.__importDefault(i(760989)),A=(0,p.lazyProperties)({headerControlWrap:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center",height:v.IconSize.default}),headerControlText:()=>n.Styles.createTextStyle({flexGrow:0,flexShrink:1,color:b.Color.white,marginRight:5}),dividerContainer:()=>n.Styles.createViewStyle({height:1}),divider:()=>n.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,height:1}),iconStyle:()=>n.Styles.createViewStyle({paddingLeft:3}),countrySelectorPopupContainer:()=>n.Styles.createViewStyle({height:350,width:300}),titleWrapperStyle:()=>n.Styles.createViewStyle({flexGrow:0,flexShrink:1,flexDirection:"row",alignItems:"center"}),filterInputControl:()=>n.Styles.createViewStyle({height:50,paddingTop:10})}),k="countrySelectorPopup";class R extends M.default{constructor(){super(...arguments),this._close=()=>{const e=D.default.newCauseId();h.log(c.LogTraceArea.Navigation,"DialpadHeader._close, causeId: "+e),C.default.goBack(e,this._getContext())},this._goCallSettings=()=>{h.track(new _.DialerPanelComponentClick(_.DialerPanelClickTarget.SettingsButton)),C.default.navigateToCallingSettingsPanel(!1,this._getContext())},this._onCenterControlsRef=e=>{this._centerControls=e||void 0},this._onCountryTitleRef=e=>{this._countryTitleRef=e||void 0},this._onCountryListRef=e=>{this._countryListRef=e||void 0},this._onCountrySelectorPress=e=>{this.props.isUsingStackNavigationContext?C.default.navigateToCountrySelector(this._getRootViewId()):this._openCountrySelectorModal()},this._openCountrySelectorModal=()=>{const e=e=>{const t=this.state.countries[e];S.default.setSelectedCountry(t,!0),s.default.dismissPopup(k,this._getRootViewId())},t={getAnchor:()=>this._countryTitleRef,renderPopup:(t,i,o,s)=>(0,a.jsx)(I.default,{anchorPosition:t,anchorOffset:i,popupWidth:o,popupHeight:s,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,popupAccessibilityTitle:g.getString("PSTNCountryList.CountryList"),children:(0,a.jsxs)(n.View,{style:A.countrySelectorPopupContainer,children:[(0,a.jsx)(n.View,{style:w.default.flexZero,children:(0,a.jsx)(y.default,{style:A.filterInputControl,placeholderText:g.getString("PSTNCountryList.SearchCountryPlaceholder"),onInputTextChange:this._onSearch,showSearchIcon:!0,hideBackground:!0,useBoldFont:!0})}),(0,a.jsx)(n.View,{style:A.dividerContainer,children:(0,a.jsx)(l.default,{style:A.divider})}),(0,a.jsx)(r.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:S.default.getLast5CalledCountriesNoSubscription(),onSelect:e})]})}),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId()};s.default.showPopup(t,k)},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))}}requestFocus(){this._centerControls&&this._centerControls.requestFocus()}render(){return(0,a.jsx)(T.SimplePanelHeader,{useTransparentBackground:!0,hideBottomBorder:!0,leftButton:this._getCloseButton(),rightButtons:this._getCallingSettingseButton(),titleView:this._getHeaderCenterControls(),headerPosition:this.props.isInLandscape?T.HeaderPosition.Start:T.HeaderPosition.Default})}_buildState(e,t){const i={countries:m.default.getCountries(),selectedCountry:S.default.getSelectedCountry()};return t&&(i.selectedCountry&&(i.selectedCountry=m.default.getCountryByCode(i.selectedCountry.country)),this._titleWrapperStyle=[A.titleWrapperStyle,n.Styles.createViewStyle({maxWidth:e.maxWidth},!1)]),i}_getCloseButton(){return{closeButtonType:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?T.CloseButtonType.Close:T.CloseButtonType.Back,title:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?g.getString("Global.CloseButtonTitle"):g.getString("Global.BackButtonTitle"),onPress:this._close,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:b.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:b.Color.whiteOverlay50,accessibilityLabel:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?g.getString("Global.CloseButtonTitle"):g.getString("Global.BackButtonTitle")}}_getCallingSettingseButton(){const e=g.getString("UserSettingsPanel.CallSettingsTitle");return{icon:v.SkypeIcon.Settings,title:e,onPress:this._goCallSettings,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:b.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:b.Color.whiteOverlay50,accessibilityLabel:e}}_getHeaderCenterControls(){let e=g.getString("PSTNCountrySelectorPanel.Title"),t=g.getString("PSTNCountrySelectorPanel.Title");const i=[A.headerControlText];return this.state.selectedCountry&&(e=this.state.selectedCountry.countryName,t=g.getString("PSTNDialerPanel.CountriesAndRegionsAccessibilityLabel",{countryTitle:e})),(this._useDarkTheme()||this._useAccessibleTheme())&&i.push(this._themeStyles.headerTextColorStyle),(0,a.jsx)(n.Button,{ref:this._onCenterControlsRef,style:A.headerControlWrap,onPress:this._onCountrySelectorPress,accessibilityLabel:t,accessibilityTraits:[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.HasPopup],children:(0,a.jsxs)(d.default,{ref:this._onCountryTitleRef,style:this._titleWrapperStyle,children:[(0,a.jsx)(P.PanelHeader,{style:i,numberOfLines:1,children:e}),(0,a.jsx)(u.default,{icon:v.SkypeIcon.DownChevron,size:v.IconSize.size12,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:b.Color.white,style:A.iconStyle})]})})}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),S.default.initializeCountrySelection()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.selectedCountry&&this._announceCountrySelectedForAccessibility(this.state.selectedCountry.countryName)}shouldComponentUpdate(e,t){return!!this.state.selectedCountry!=!!t.selectedCountry||!!this.state.selectedCountry&&!!t.selectedCountry&&this.state.selectedCountry.country!==t.selectedCountry.country||this.props.isInLandscape!==e.isInLandscape}_announceCountrySelectedForAccessibility(e){this._announceForAccessibility(g.getString("PSTNDialerPanel.CountryAnnouncement",{countryTitle:e}))}_announceForAccessibility(e){f.default.maybeAnnounceForAccessibility(e,1e3)}}t.default=R},698591:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(614080),r=o.__importStar(i(516778)),l=i(154235),c=o.__importDefault(i(190799)),d=i(815146),u=o.__importStar(i(85385)),h=i(26703),p=o.__importStar(i(704704)),g=o.__importDefault(i(998929)),C=o.__importStar(i(69848)),m=o.__importStar(i(879119)),S=o.__importStar(i(427393)),_=o.__importDefault(i(960282)),f=i(376229),y=i(16549),T=o.__importDefault(i(20758)),b=i(331079),v=o.__importDefault(i(827361)),I=i(262725),w=o.__importDefault(i(497910)),P=i(403396),M=i(596648),D=i(309515),A=i(306194),k=o.__importDefault(i(150343)),R=(0,h.lazyProperties)({searchResultPanelStyle:()=>r.Styles.createViewStyle({flex:1}),searchResultPanelDarkThemeStyle:()=>r.Styles.createViewStyle({backgroundColor:y.Color.gray400}),itemDivider:()=>r.Styles.createViewStyle({height:1,marginLeft:50,marginRight:10}),itemDividerDarkTheme:()=>r.Styles.createViewStyle({backgroundColor:y.Color.dialPadHoverDark}),itemDividerLightTheme:()=>r.Styles.createViewStyle({backgroundColor:y.Color.whiteOverlay20}),itemDividerSmallScreen:()=>r.Styles.createViewStyle({marginRight:16}),singleItemDivider:()=>r.Styles.createViewStyle({height:1,marginLeft:10,marginRight:10}),transparentBg:()=>r.Styles.createViewStyle({backgroundColor:y.Color.transparent}),textOnGradient:()=>r.Styles.createTextStyle({color:y.Color.white}),rowHighlightDarkStyle:()=>r.Styles.createViewStyle({backgroundColor:y.Color.dialPadHoverDark})});class x extends w.default{constructor(){super(...arguments),this._onScrollFlag=!1,this._renderItem=e=>{const t=(0,a.jsx)(L,{mri:e.profile.userMri,displayName:e.profile.displayName,phoneNumber:this.state.isSingleSelection?void 0:e.phone,itemHeight:e.height,textToHighlight:e.textToHighlight,onResultPress:this._onSearchItemPressed,searchIndex:e.searchIndex},e.key);if(e.isLastItem&&!this.state.isSingleSelection)return t;const i=[R.itemDivider];this._useDarkTheme()?i.push(R.itemDividerDarkTheme):i.push(this._themeStyles.dividerColorStyle),this.state.isMobileScreenSize&&i.push(R.itemDividerSmallScreen);const o=(0,a.jsx)(r.View,{style:i},"itemDivider");if(this.state.isSingleSelection){const e=[R.singleItemDivider];this._useDarkTheme()?e.push(R.itemDividerDarkTheme):e.push(R.itemDividerLightTheme);return[(0,a.jsx)(r.View,{style:e},"itemDivider"),t]}return[t,o]},this._onSearchItemPressed=(e,t)=>{u.log(d.LogTraceArea.DialerPanel,"[action]: Contact Selection"),u.track(new S.ContactSelected(m.default.getPhoneNumber(m.TriggerKeys.InputValue).E164.length)),m.default.selectSearchResultItem(t),this.props.onItemPressed&&this.props.onItemPressed()},this._onScroll=()=>{this.props.onScroll&&this._onScrollFlag?(this.props.onScroll(),this._onScrollFlag=!1):this._onScrollFlag=!0}}_buildState(e,t){const i=m.default.getSearchResults(),o=f.SearchItemHeights.baseListItemHeight+Math.round(f.SearchItemHeights.scaledListItemHeight*Math.min(_.default.getContentSizeMultiplier(),l.MaxContentSizeMultiplier)),a=this._getRootViewId(),s={isMobileScreenSize:_.default.isMobileScreenSize(a),searchQuery:i.query,sessionId:i.sessionId,profiles:[],isSingleSelection:!!i.selectedResult};return i.results.length>0&&!i.selectedResult&&(n.each(i.results,((e,t)=>{s.profiles.push({profile:e.contact,phone:e.phone.number,textToHighlight:e.matchedString,template:"profile",height:o,key:"ct_"+e.contact.uniqueId+t,searchIndex:t,isLastItem:!1})})),s.profiles[s.profiles.length-1].isLastItem=!0),s}render(){const e=[R.searchResultPanelStyle];return this.state.isSingleSelection||0===this.state.profiles.length?e.push(R.transparentBg):this._useDarkTheme()?e.push(R.searchResultPanelDarkThemeStyle):e.push(this._themeStyles.primaryBackgroundColorStyle),(0,a.jsx)(r.View,{style:e,importantForAccessibility:this._accessibilityForSearchResultsView(),children:(0,a.jsx)(s.VirtualListView,{itemList:this.state.profiles,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,horizontalPadding:this.props.safeAreaHorizontalInsets,hoveredItemStyle:this.state.isSingleSelection?void 0:this._themeStyles.rowHoverViewStyle,onScroll:this._onScroll,accessibilityLabel:p.getString("PSTNDialerPanel.FastContactsSearchList")})})}componentDidMount(){super.componentDidMount(),m.default.initializeSearch()}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._onScrollFlag=!1,this.state.profiles.length>0){const e=0===this.state.searchQuery.length;(0,D.searchResultsRendered)(A.ScenarioSearchTypes.FastContacts,this.state.sessionId,e);const t={publicDirectory:!1,message:!1,indexedDb:!1,bots:!1,allPeople:!1,fastContacts:!0,messageInConversation:!1};(0,D.compositeScenarioResultsRendered)(this.state.searchQuery,A.CompositeSearchOrigin.Dialpad,void 0,e,t)}this.props.onRender&&this.props.onRender()}componentWillUnmount(){super.componentWillUnmount(),m.default.destroySearch()}_accessibilityForSearchResultsView(){return 0===this.state.profiles.length?r.Types.ImportantForAccessibility.NoHideDescendants:void 0}}class L extends w.default{constructor(){super(...arguments),this._onHoverOverItemStart=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!0})},this._onHoverOverItemEnd=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!1})},this._onItemPressed=()=>{this.props.phoneNumber&&(this.props.onResultPress(this.props.phoneNumber,this.props.searchIndex),this.isComponentMounted()&&this.setState({isHoveringOverItem:!1}))}}_buildState(e,t){return{enableRefreshedPalette:k.default.getS4LUiFeatures().enableRefreshedPalette}}render(){const e=C.getItemHeightStyle(this.props.itemHeight-1),t=[C.styles.listItem];e&&t.push(e),this.state.isHoveringOverItem&&this.props.phoneNumber&&(this._useDarkTheme()?t.push(R.rowHighlightDarkStyle):t.push(this._themeStyles.rowHighlightViewStyle));const i=[T.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,v.default.flexNegativeOne,this._getOptionalRefreshedPaletteAwareAccessibleStyles()],o=[...i,C.styles.statusTextInnerContainer],n=this.props.displayName,s=this.props.phoneNumber;let l,d;if(s)d=(0,a.jsx)(r.View,{style:C.styles.statusContainer,title:s,children:(0,a.jsx)(c.default,{displayText:s,textToHighlight:this.props.textToHighlight,containerStyles:o,inlineTextStyle:i,highlightType:b.TextToHighlightType.PhoneNumber})});else{d=void 0;let e=R.textOnGradient;!this._useDarkTheme()&&this._useAccessibleTheme()&&(e=this._themeStyles.primaryTextColorStyle),l=e}const u=-1!==n.indexOf(this.props.textToHighlight)?(0,a.jsx)(c.default,{displayText:n,textToHighlight:this.props.textToHighlight,containerStyles:o,inlineTextStyle:[T.default.rowTitleFontStyle(this._currentTheme),l],highlightType:b.TextToHighlightType.DisplayName}):(0,a.jsx)(I.RowTitle,{style:l,numberOfLines:1,children:n});return(0,a.jsxs)(g.default.Button,{style:t,onPress:s?this._onItemPressed:void 0,onHoverStart:s?this._onHoverOverItemStart:void 0,onHoverEnd:s?this._onHoverOverItemEnd:void 0,underlayColor:this._useDarkTheme()?y.Color.dialPadHoverDark:this._themeColors.rowHighlightColor,accessibilityTraits:r.Types.AccessibilityTrait.Button,accessibilityLabel:n+(s?", "+s:""),children:[(0,a.jsx)(P.UserIcon,{size:M.UserIconSize.Size40,userMri:this.props.mri,statusBorderColor:this._themeColors.primaryBackgroundColor},"userIcon"),(0,a.jsxs)(r.View,{style:C.styles.textContainer,children:[u,d]},"text")]})}_getOptionalRefreshedPaletteAwareAccessibleStyles(){if(this.state.enableRefreshedPalette&&this._useAccessibleTheme()&&this.state.isHoveringOverItem)return r.Styles.createTextStyle({color:this._themeColors.textOnColor},!1)}}t.default=x},902571:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberInputBase=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=o.__importDefault(i(354676)),l=o.__importDefault(i(872263)),c=i(815146),d=o.__importDefault(i(453761)),u=o.__importStar(i(85385)),h=i(26703),p=o.__importStar(i(704704)),g=o.__importDefault(i(740794)),C=o.__importDefault(i(808164)),m=o.__importDefault(i(879119)),S=i(879119),_=i(427393),f=o.__importStar(i(629564)),y=o.__importDefault(i(791384)),T=i(16549),b=i(641400),v=o.__importDefault(i(582176));var I;!function(e){e[e.Regular=0]="Regular",e[e.Emergency=1]="Emergency"}(I||(I={}));const w=(0,h.lazyProperties)({contactsIcon:()=>n.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:8,alignSelf:"flex-start",flex:0})});class P extends f.ResponsiveComponentBase{constructor(e){super(e),this._getOptionalContactsIcon=()=>this.state.isContactsIconEnabled?(0,a.jsx)(d.default,{icon:b.SkypeIcon.BookContacts,color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:T.Color.white,hoverColor:this._useAccessibleTheme()?this._themeColors.iconHoverColor:T.Color.whiteOverlay50,size:b.IconSize.size24,style:w.contactsIcon,onPress:this._onContactsButtonClick,title:p.getString("PSTNDialerPanel.ContactsButtonTitle")}):void 0,this._onContactsButtonClick=()=>{u.track(new _.DialerPanelComponentClick(_.DialerPanelClickTarget.ContactsIcon)),g.default.navigateToContactsPanel(void 0,!1,this._getContext())},this._writePrefilledNumberToStore=()=>{var e;const t=this.props.prefilledInput;t&&(null===(e=this.state)||void 0===e?void 0:e.value)!==t&&this._writeToStore(t,c.NavigationCallOrigin.PstnDialpadPrefilled)}}_buildState(e,t){const i=super._buildState(e,t),o=m.default.getPhoneNumber(S.TriggerKeys.Emergency);i.value=m.default.getPhoneNumber(S.TriggerKeys.InputValue).inputValue,i.selectedResult=m.default.getSearchResults().selectedResult,i.phoneNumber=o,i.phoneNumber.emergency?i.mode=I.Emergency:i.mode=I.Regular;const a=s.default.getS4LEntitlementFeatures().SCE;i.isContactsIconEnabled=a.Dialpad.Features.ContactsIconEnabled,i.isRateIntegrationEnabled=a.UserServices.Client.Features.RateIntegrationEnabled,i.accessibilitySummary=m.default.getAccessibilitySummary(),i.callRate=this._getCallRate(o);const n=s.default.getS4LCommerceFeaturesNoSubscription().showInvalidNoteBeforeStartCall;return i.enableShowInvalidNoteBeforeStartCall=n,t&&(i.showInvalidNumberNote=e.openedOnInvalidNumberError),i.showInvalidNoteBeforeStartCall=!t&&n&&!v.default.getIsPhoneNumberVaild(),i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._writePrefilledNumberToStore();const e=l.default.restorePhoneNumberInputIfNeeded();e&&this._writeToStore(e,c.NavigationCallOrigin.PstnDialpadSaveContact),v.default.cleanupPhoneNumberVaild(),v.default.cleanupclickCallCount(),l.default.clearState()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.prefilledInput!==e.prefilledInput&&this._writePrefilledNumberToStore()}_getCallRate(e){if(e.E164&&C.default.isValidNumberString(e.E164))return r.default.getCallRateByPhoneNumber(C.default.stripPlusSign(e.E164))}_isEmergencyMode(){return this.state.mode===I.Emergency}_writeToStore(e,t){m.default.overwritePhoneNumberInput(e,!1,t)}_announceForAccessibility(e,t=void 0){return y.default.maybeAnnounceForAccessibility(e,t)}}t.PhoneNumberInputBase=P},993317:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(537180),l=o.__importDefault(i(150343)),c=i(154235),d=o.__importStar(i(761393)),u=o.__importDefault(i(285901)),h=o.__importDefault(i(988773)),p=i(815146),g=o.__importDefault(i(970035)),C=o.__importDefault(i(457468)),m=o.__importStar(i(85385)),S=i(26703),_=o.__importStar(i(704704)),f=o.__importDefault(i(740794)),y=o.__importDefault(i(942724)),T=i(902571),b=o.__importDefault(i(879119)),v=o.__importStar(i(427393)),I=o.__importDefault(i(791384)),w=o.__importDefault(i(660401)),P=i(16549),M=o.__importDefault(i(20758)),D=i(641400),A=o.__importDefault(i(827361)),k=i(262725),R=o.__importDefault(i(760989)),x=o.__importDefault(i(265971)),L=o.__importDefault(i(582176)),B=i(427393),V=(0,S.lazyProperties)({numberInputContainer:()=>s.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:20,paddingRight:10}),numberInput:()=>s.Styles.createTextStyle({backgroundColor:P.Color.transparent,flex:0,font:M.default.font.uiDisplayBold}),emergencyCallContainerStyle:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emergencyCallContainerStyleLandscape:()=>s.Styles.createViewStyle({flexDirection:"column"}),emergencyCallStyle:()=>s.Styles.createTextStyle({backgroundColor:P.Color.transparent,color:P.Color.white,marginBottom:5,paddingHorizontal:10,flexShrink:1}),emergencyCallLearnMoreStyle:()=>s.Styles.createViewStyle({alignSelf:"flex-start",marginRight:10}),emergencyCallLearnMoreStyleLandscape:()=>s.Styles.createViewStyle({alignSelf:"flex-start",marginLeft:10}),emergencyCallBackground:()=>s.Styles.createViewStyle({backgroundColor:P.Color.red,height:d.DefaultHeight}),errorNotificationFlexStyle:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row",marginLeft:10,marginRight:40}),invalidNumberNotificationStyle:()=>s.Styles.createTextStyle({flex:1,backgroundColor:P.Color.transparent,color:P.Color.white,marginBottom:5,marginLeft:10})}),O={numberInput:(0,S.lazyProperties)({MobileSmall:()=>s.Styles.createTextStyle({fontSize:M.default.controlFontSize.h4}),MobileMedium:()=>s.Styles.createTextStyle({fontSize:M.default.controlFontSize.dialpadNumber}),MobileDefault:()=>s.Styles.createTextStyle({fontSize:M.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>s.Styles.createTextStyle({fontSize:M.default.controlFontSize.h4})})};class E extends T.PhoneNumberInputBase{constructor(){super(...arguments),this._onChangeTextEvent={isLocked:!1,newValue:""},this._onPressPhoneNumberContainer=e=>{this.props.onPress&&this.props.onPress()},this._onSubmit=()=>{if(!this.state.phoneNumber.callable||this.state.disableHighBandwidthOperations)return void m.log(p.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit not callable phone number");const e=R.default.newCauseId();m.log(p.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit, causeId: "+e),u.default.startOrAddPstnCall(this.state.phoneNumber.E164,this.state.phoneNumber.emergency,this.state.phoneNumber.countryCode,this.state.phoneNumber.suffix,this.props.callId,this.props.conversationId),!y.default.isUsingStackNavigationContext()&&this._isJoinCallRequest()&&f.default.closeGenericDesktopModal(e,this._getRootViewId())},this._onPaste=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=n.find(e.clipboardData.items,(e=>"text/plain"===e.type)),i=!!this._textInputRef&&h.default.isCursorPlacedInPrefixArea(this.state.phoneNumber,this._textInputRef.getSelectionRange());t&&(this._onChangeTextEvent.isLocked=!0,t.getAsString((e=>{this._onChangeTextEvent.isLocked=!1;const t=h.default.normalizePhoneNumber(e);if(h.default.isE164Format(t))this._onChangeText(t,p.NavigationCallOrigin.PstnDialpadPasted);else if(i)this._onChangeText(t,p.NavigationCallOrigin.PstnDialpadPasted);else if(!n.isEmpty(this._onChangeTextEvent.newValue)){const e=h.default.normalizePhoneNumber(this._onChangeTextEvent.newValue);this._onChangeText(e,p.NavigationCallOrigin.PstnDialpadPasted)}m.track(new v.PasteNumber)})))},this._renderEmergencyCallElements=()=>{if(!this._isEmergencyMode())return;const e=[],t=[];if(this.state.phoneNumber.forceChangedPrefix){m.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 0"));const i=_.getString("PSTNDialerPanel.EmergencyCallingDefaultCountryAppliedLabel",{number:this.state.phoneNumber.suffix?this.state.phoneNumber.suffix:"",country:this.state.selectedCountry?this.state.selectedCountry.countryName:""});e.push((0,a.jsx)(k.BodyText,{size:k.BodyTextSize.SmallDeprecated,style:V.emergencyCallStyle,children:i},"EmergencyCallingDefaultCountryAppliedLabel")),t.push(i)}if(this.state.phoneNumber.callable){let i;if(m.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 1")),n.includes(this.state.e911EnabledCountries,n.toLower(this.state.phoneNumber.countryCode)))i=_.getString("PSTNDialerPanel.E911CallingLimitedLabel");else{i=_.getString("PSTNDialerPanel.EmergencyCallingLimitedLabel")+" "+_.getString("PstnUtils.EmergencyCallWarning")}e.push((0,a.jsxs)(s.View,{style:this.props.isInLandscape?V.emergencyCallContainerStyleLandscape:V.emergencyCallContainerStyle,children:[(0,a.jsx)(k.Subtitle,{style:V.emergencyCallStyle,children:i},"EmergencyCallingLimitedLabel"),(0,a.jsx)(w.default,{buttonSize:c.SXButtonSize.Small,buttonStyle:c.SXButtonStyle.LightFill,style:this.props.isInLandscape?V.emergencyCallLearnMoreStyleLandscape:V.emergencyCallLearnMoreStyle,title:_.getString("PstnUtils.EmergencyCallingLearnMore"),allowTextWrap:!0,onPress:this._onPressEmergencyCallLearnMoreHandler},"EmergencyCallingLimitedLabelContainer")]},"EmergencyCallingContainer")),t.push(i)}else{m.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 2"));const i=_.getString("PSTNDialerPanel.EmergencyCallingNoCallingLabel"),o=_.getString("PstnUtils.EmergencyCallingNotSupportedRegion");e.push((0,a.jsx)(k.Subtitle,{style:V.emergencyCallStyle,children:i},"EmergencyCallingNoCallingLabel"),(0,a.jsx)(k.Caption,{style:V.emergencyCallStyle,children:o},"EmergencyCallingNotSupportedRegion")),t.push(i),t.push(o)}return t.length>0&&I.default.maybeAnnounceForAccessibility(t.join(" ")),e},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote||!this._isEmergencyMode()&&this.state.showInvalidNoteBeforeStartCall)return(0,a.jsxs)(s.View,{style:V.errorNotificationFlexStyle,children:[(0,a.jsx)(g.default,{icon:D.SkypeIcon.Info,size:D.IconSize.size20,color:P.Color.white},"infoIcon"),(0,a.jsx)(k.BodyText,{size:k.BodyTextSize.BigDeprecated,bold:!0,style:V.invalidNumberNotificationStyle,numberOfLines:2,children:_.getString("PSTNDialerPanel.InvalidNumberError")})]})},this._onPressEmergencyCallLearnMoreHandler=()=>{s.Linking.openUrl(l.default.getConfigSettingsNoSubscription().calling.emergencyCallingLearnMoreLink)},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._handleChangeText=e=>{this._onChangeText(e,p.NavigationCallOrigin.PstnDialpadTyped)},this._onChangeText=(e,t)=>{this._onChangeTextEvent.isLocked?this._onChangeTextEvent.newValue=e:e!==this.state.value&&(e&&!h.default.isValidPhoneNumberInput(e)?this._textInputRef&&this._textInputRef.setValue(this.state.value):b.default.overwritePhoneNumberInput(e,!0,t),this.props.onPress&&this.props.onPress(),L.default.cleanupPhoneNumberVaild())}}_buildState(e,t){const i=super._buildState(e,t);return i.selectedCountry=b.default.getSelectedCountry(),i.disableHighBandwidthOperations=C.default.isUsingGogoNetwork(),i.e911EnabledCountries=l.default.getS4LEntitlementFeatures().SCE.Dialpad.E911.enabledCountries,i.enableSmsNewEntry=L.default.isSmsNewEntryEnabled(),i}_getTextInput(){const e=[V.numberInput,{color:this._themeColors.textOnColor},this._chooseResponsiveStyle(O.numberInput)];let t=P.Color.white;(this._useDarkTheme()||this._useAccessibleTheme())&&(e.push(this._themeStyles.headerTextColorStyle),t=this._themeColors.headerTextColor);let i=(0,a.jsxs)(s.View,{style:A.default.flexOne,onPress:this._onPressPhoneNumberContainer,children:[(0,a.jsx)(s.TextInput,{style:r.StyleSheet.flatten(e),autoFocus:!0,value:this.state.value,placeholder:_.getString("PSTNPhoneNumberInput.NumberPlaceholder"),accessibilityLabel:this._getAccessibilityLabel(),placeholderTextColor:this._useAccessibleTheme()?P.Color.whiteOverlay80:P.Color.whiteOverlay50,onChangeText:this._handleChangeText,ref:this._onTextInputRef,onPaste:this._onPaste,onSubmitEditing:this._onSubmit,clearButtonMode:"never",keyboardType:"none"}),this.state.value&&this.state.enableSmsNewEntry?(0,a.jsx)(x.default,{style:{position:"absolute",right:0,top:-10},iconColor:P.Color.white}):void 0]});return i=(0,a.jsx)("div",{className:(this._useAccessibleTheme()?"":"inputGradient")+" disableAutoFill",style:{WebkitTextFillColor:t},children:i}),i}_isJoinCallRequest(){return this.props.callId&&this.props.conversationId}_isInputFocused(){return this._textInputRef&&this._textInputRef.isFocused()}render(){const e=this._isEmergencyMode()||this.state.showInvalidNumberNote||this.state.showInvalidNoteBeforeStartCall?(0,a.jsxs)(s.View,{children:[this._renderEmergencyCallElements(),this._renderInvalidNotification()]}):void 0;return(0,a.jsxs)(s.View,{style:this._isEmergencyMode()?V.emergencyCallBackground:void 0,children:[(0,a.jsxs)(s.View,{style:V.numberInputContainer,children:[(0,a.jsx)(s.View,{style:A.default.flexOne,children:this._getTextInput()}),this._getOptionalContactsIcon()]}),e]})}componentDidMount(){super.componentDidMount(),this._textInputRef&&this._textInputRef.selectRange(-1,-1)}componentDidUpdate(e,t,i){var o,a,n;if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote&&this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),this.props.navigationSource===p.DialerNavigationSource.EdgeTelLink&&b.default.setPhoneNumberOrigin(p.NavigationCallOrigin.EdgeTelLink),this._isInputFocused()||!this.state.phoneNumber.inputValue)return void(this.state.isRateIntegrationEnabled&&this.state.callRate&&I.default.maybeAnnounceForAccessibility(this.state.callRate));const s=this._getAccessibilityLabel(!0);s&&I.default.maybeAnnounceForAccessibility(s,500),this.state.selectedResult&&!t.selectedResult&&this.requestFocus(),(this.state.showInvalidNumberNote||this.state.showInvalidNoteBeforeStartCall&&!this._isEmergencyMode())&&m.track(new B.RenderInvalidNotificationEvent(null!==(o=this.state.showInvalidNumberNote)&&void 0!==o&&o,null!==(a=this.state.showInvalidNoteBeforeStartCall)&&void 0!==a&&a,null!==(n=this.props.openedOnInvalidNumberError)&&void 0!==n&&n))}requestFocus(){n.defer((()=>{if(this.isComponentMounted()&&this._textInputRef){this._textInputRef.requestFocus();const e=this.state.phoneNumber.inputValue.length;e>0&&this._textInputRef.selectRange(e,e)}}))}_getCallAccessibilityLabel(){return this._isInputFocused()?_.getString("PSTNPhoneNumberInput.AccessibilityLabelEnterToCall"):_.getString("PSTNPhoneNumberInput.AccessibilityLabel")}_getAccessibilityLabel(e=!1){const t=e?[this.state.value]:[];return this.state.showInvalidNumberNote?t.push(_.getString("PSTNDialerPanel.InvalidNumberError")):this.state.phoneNumber.callable&&t.push(this._getCallAccessibilityLabel()),this.state.accessibilitySummary&&(this.state.accessibilitySummary.searchHasResults&&t.push(_.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")),this.state.accessibilitySummary.selectedContactDisplayName&&t.push(_.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})),!h.default.isE164Format(this.state.value)&&this.state.accessibilitySummary.selectedCountryName&&t.push(_.getString("PSTNPhoneNumberInput.AccessibilityLabelDestinationCountry",{country:this.state.accessibilitySummary.selectedCountryName}))),this.state.isRateIntegrationEnabled&&!this._isInputFocused()&&this.state.callRate&&t.push(this.state.callRate),t.length?t.join(", "):void 0}}t.default=E},393083:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(762025),s=o.__importStar(i(516778)),r=i(537180),l=i(815146),c=o.__importDefault(i(970035)),d=o.__importStar(i(85385)),u=i(26703),h=o.__importStar(i(704704)),p=o.__importDefault(i(942724)),g=i(902571),C=o.__importStar(i(427393)),m=i(16549),S=o.__importDefault(i(20758)),_=i(641400),f=o.__importDefault(i(827361)),y=i(262725),T=i(240265),b=o.__importDefault(i(265971)),v=o.__importDefault(i(582176)),I=i(427393),w=(0,u.lazyProperties)({numberInputContainer:()=>s.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:10,paddingRight:0,minHeight:45}),inputWrapper:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row"}),numberInput:()=>s.Styles.createTextStyle({backgroundColor:m.Color.transparent,flex:0,font:S.default.font.uiDisplayBold,paddingRight:10}),contextMenu:()=>s.Styles.createViewStyle({alignSelf:"stretch",flex:1}),errorNotificationFlexStyle:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:40}),invalidNumberNotificationStyle:()=>s.Styles.createTextStyle({flex:1,backgroundColor:m.Color.transparent,color:m.Color.white,textAlignVertical:"top",marginBottom:5,marginLeft:10}),extendedHeight:()=>s.Styles.createTextStyle({minHeight:150})}),P={numberInput:(0,u.lazyProperties)({MobileSmall:()=>s.Styles.createTextStyle({fontSize:S.default.controlFontSize.h4}),MobileMedium:()=>s.Styles.createTextStyle({fontSize:S.default.controlFontSize.dialpadNumber}),MobileDefault:()=>s.Styles.createTextStyle({fontSize:S.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>s.Styles.createTextStyle({fontSize:S.default.controlFontSize.h4})})},M="copy",D="paste";class A extends g.PhoneNumberInputBase{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress&&this.props.onPress()},this._onContextMenuRef=e=>{this._contextMenu=e||void 0},this._showContextMenu=()=>{this._contextMenu&&this._contextMenu.showContextMenu()},this._handleItemSelected=e=>{switch(e){case M:const e=this.state.value;e&&(0,T.writeTextToClipboard)(e);break;case D:d.track(new C.PasteNumber),(0,T.getTextFromClipboard)().then((e=>{this._writeToStore(e,l.NavigationCallOrigin.PstnDialpadPasted)}))}},this._renderInvalidNotification=()=>{var e,t,i;if(this.state.showInvalidNumberNote||this.state.showInvalidNoteBeforeStartCall)return d.track(new I.RenderInvalidNotificationEvent(null!==(e=this.state.showInvalidNumberNote)&&void 0!==e&&e,null!==(t=this.state.showInvalidNoteBeforeStartCall)&&void 0!==t&&t,null!==(i=this.props.openedOnInvalidNumberError)&&void 0!==i&&i)),(0,a.jsxs)(s.View,{style:w.errorNotificationFlexStyle,children:[(0,a.jsx)(c.default,{icon:_.SkypeIcon.Info,color:m.Color.white,size:_.IconSize.size20}),(0,a.jsx)(y.BodyText,{size:y.BodyTextSize.BigDeprecated,bold:!0,style:w.invalidNumberNotificationStyle,children:h.getString("PSTNDialerPanel.InvalidNumberError")})]})}}_buildState(e,t){const i=super._buildState(e,t);return i.isUsingStackNavigationContext=p.default.isUsingStackNavigationContext(),i.enableSmsNewEntry=v.default.isSmsNewEntryEnabled(),i}componentDidUpdate(e,t,i){var o,a,n;if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote)return this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),void(t.showInvalidNumberNote||this._announceForAccessibility(h.getString("PSTNDialerPanel.InvalidNumberError")));this.state.accessibilitySummary&&t.value===this.state.value&&(this.state.accessibilitySummary.searchHasResults?this._announceForAccessibility(h.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")):this.state.accessibilitySummary.selectedContactDisplayName&&this._announceForAccessibility(h.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName}))),(this.state.showInvalidNumberNote||this.state.showInvalidNoteBeforeStartCall)&&d.track(new I.RenderInvalidNotificationEvent(null!==(o=this.state.showInvalidNumberNote)&&void 0!==o&&o,null!==(a=this.state.showInvalidNoteBeforeStartCall)&&void 0!==a&&a,null!==(n=this.props.openedOnInvalidNumberError)&&void 0!==n&&n))}_announceForAccessibility(e){s.Accessibility.announceForAccessibility(e)}_getTextInput(){const e=[w.numberInput,{color:this._themeColors.textOnColor},this._chooseResponsiveStyle(P.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle);const t=this.state.value;return(0,a.jsx)(s.Text,{style:r.StyleSheet.flatten(e),numberOfLines:1,allowFontScaling:!1,ellipsizeMode:"head",children:t||h.getString("PSTNPhoneNumberInput.NumberPlaceholder")})}render(){let e;this.state.isUsingStackNavigationContext&&(e=[w.inputWrapper]);const t=this.state.value.length?h.getString("PSTNPhoneNumberInput.AccessibilityLabelEnteredPhoneNumber",{number:this.state.value}):h.getString("PSTNPhoneNumberInput.AccessibilityLabelNumberPlaceholder");return(0,a.jsxs)(s.View,{style:this.state.showInvalidNumberNote||this.state.showInvalidNoteBeforeStartCall?[w.numberInputContainer,w.extendedHeight]:w.numberInputContainer,children:[(0,a.jsx)(n.ContextMenu,{items:this._getMenuItems(),onItemSelected:this._handleItemSelected,style:w.contextMenu,ref:this._onContextMenuRef,children:(0,a.jsxs)(s.View,{onLongPress:this._showContextMenu,onPress:this._onPress,style:f.default.flexOne,children:[(0,a.jsxs)(s.View,{style:e,accessibilityLabel:t,children:[this._getTextInput(),this.state.value&&this.state.enableSmsNewEntry?(0,a.jsx)(b.default,{style:{position:"absolute",right:0,top:-10},iconColor:m.Color.white}):void 0]}),this._renderInvalidNotification()]})}),this._getOptionalContactsIcon()]})}_getMenuItems(){return[{text:h.getString("Pstn.CopyContextMenu"),command:M},{text:h.getString("Pstn.PasteContextMenu"),command:D}]}}t.default=A},629564:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponsiveComponentBase=void 0;const o=i(197582),a=o.__importDefault(i(960282)),n=o.__importDefault(i(497910));class s extends n.default{constructor(e){super(e),this._mobileSmallBreakpoint=360,this._mobileMediumBreakpoint=400,this._desktopSmallBreakpoint=800,this._desktopSmallHeightBreakpoint=600}_buildState(e,t){const i=this._getRootViewId(),o={};return o.xSize=a.default.getWidth(i),o.ySize=a.default.getHeight(i),o.isMobileScreenSize=a.default.isMobileScreenSize(i),o}_chooseResponsiveStyle(e){const t=this.props.isInLandscape?this.state.ySize:this.state.xSize,i=this.state.ySize,o=(this.props.isInLandscape?e.MobileDefaultLandscape:void 0)||e.MobileDefault;return this.state.isMobileScreenSize?t<=this._mobileSmallBreakpoint?e.MobileSmall||o:t<=this._mobileMediumBreakpoint?e.MobileMedium||o:e.MobileDefault:(t<=this._desktopSmallBreakpoint||i<=this._desktopSmallHeightBreakpoint)&&e.DesktopSmall||e.DesktopDefault}}t.ResponsiveComponentBase=s},644426:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(154235),l=i(215070),c=o.__importDefault(i(555436)),d=o.__importDefault(i(988773)),u=o.__importDefault(i(872263)),h=o.__importDefault(i(186325)),p=(i(815146),o.__importDefault(i(174042))),g=o.__importStar(i(85385)),C=i(26703),m=o.__importStar(i(704704)),S=o.__importDefault(i(740794)),_=i(879119),f=o.__importDefault(i(879119)),y=o.__importStar(i(427393)),T=o.__importDefault(i(960282)),b=i(16549),v=o.__importDefault(i(20758)),I=i(641400),w=i(331079),P=o.__importDefault(i(497910)),M=(0,C.lazyProperties)({buttonContainer:()=>s.Styles.createViewStyle({backgroundColor:b.Color.transparent,marginBottom:12,alignItems:"flex-start"}),buttonStyle:()=>s.Styles.createViewStyle({paddingHorizontal:20,paddingVertical:6}),titleStyle:()=>s.Styles.createTextStyle({paddingLeft:12}),topBorderDividerDarkTheme:()=>s.Styles.createViewStyle({backgroundColor:b.Color.dialPadHoverDark}),topBorderDividerLightTheme:()=>s.Styles.createViewStyle({backgroundColor:b.Color.whiteOverlay20})});class D extends P.default{constructor(){super(...arguments),this._onButtonPress=e=>{if(e.stopPropagation(),this.state.phoneNumber){const e=d.default.getPhoneNumberMri(this.state.phoneNumber);if(c.default.isContact(e))return;u.default.savePhoneNumberInput(this.state.phoneNumber.inputValue),g.track(new y.DialerPanelComponentClick(y.DialerPanelClickTarget.SaveContactButton));const t={number:n.isEmpty(this.state.phoneNumber.E164)?this.state.phoneNumber.suffix:this.state.phoneNumber.E164,type:w.PhoneNumberTypes.Mobile};S.default.navigateToAddPhoneNumberPanel(l.AddPhoneNumberPanelOrigin.DialpadPanel,this._getRootViewId(),void 0,[t],void 0,this._onPhoneNumberSaved,this._onSaveNumberCancelled)}},this._onPhoneNumberSaved=e=>{f.default.preselectSavedContact(e),this.props.onContactSaved&&this.props.onContactSaved(),g.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactSuceeded))},this._onSaveNumberCancelled=()=>{u.default.shouldRestoreState(),g.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactCancelled))}}_buildState(e,t){return{phoneNumber:f.default.getPhoneNumber(_.TriggerKeys.E164),contentSizeMultiplier:T.default.getContentSizeMultiplier()}}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:b.Color.white,t=s.Styles.createTextStyle({color:e},!1),i=[M.titleStyle,v.default.bodyFontStyle(this._currentTheme),t];return!this._useDarkTheme()&&this._useAccessibleTheme()&&i.push(this._themeStyles.primaryTextColorStyle),g.track(new y.SaveContactDialpadFlowStep(y.SaveContactFlowStep.SaveContactButtonShow)),(0,a.jsxs)(s.View,{style:M.buttonContainer,children:[(0,a.jsx)(h.default,{marginLeft:10,marginRight:10,marginBottom:10,style:this._useDarkTheme()?M.topBorderDividerDarkTheme:M.topBorderDividerLightTheme}),(0,a.jsx)(p.default,{size:this._getContentSizeHeight(I.IconSize.size24),color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:b.Color.white,icon:I.SkypeIcon.ContactAdd,title:m.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),accessibilityLabel:m.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),titleStyle:i,useTrailingIcon:!1,onPress:this._onButtonPress,style:M.buttonStyle})]})}_getContentSizeHeight(e){return e*Math.min(this.state.contentSizeMultiplier||1,r.MaxContentSizeMultiplier)}}t.default=D},76962:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(26703),r=(o.__importStar(i(704704)),o.__importDefault(i(879119))),l=(o.__importDefault(i(791384)),i(16549)),c=i(262725),d=o.__importDefault(i(497910)),u=o.__importDefault(i(403396)),h=i(596648),p=(0,s.lazyProperties)({container:()=>n.Styles.createButtonStyle({flex:0,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4}),textContainer:()=>n.Styles.createViewStyle({flex:1,marginHorizontal:10}),textStyle:()=>n.Styles.createTextStyle({backgroundColor:l.Color.transparent,color:l.Color.white})});class g extends d.default{_buildState(e,t){return{selectedResult:r.default.getSearchResults().selectedResult}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}render(){if(!this.state.selectedResult)return null;const e=!this._useDarkTheme()&&this._useAccessibleTheme();return(0,a.jsxs)(n.View,{style:p.container,children:[(0,a.jsx)(u.default,{size:h.UserIconSize.Size40,userMri:this.state.selectedResult.contact.userMri,statusBorderColor:this._themeColors.primaryBackgroundColor},"selectedContactUserIcon"),(0,a.jsx)(n.View,{style:p.textContainer,children:(0,a.jsx)(c.RowTitle,{style:e?this._themeStyles.primaryTextColorStyle:p.textStyle,numberOfLines:1,children:this.state.selectedResult.contact.displayName})})]})}}t.default=g},566034:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(537180),r=i(344175),l=i(854646),c=o.__importDefault(i(150343)),d=o.__importDefault(i(970035)),u=o.__importStar(i(94534)),h=i(26703),p=o.__importStar(i(704704)),g=o.__importDefault(i(363091)),C=i(16549),m=o.__importDefault(i(20758)),S=i(641400),_=o.__importDefault(i(827361)),f=o.__importDefault(i(497910)),y=i(403396),T=i(596648),b=o.__importStar(i(473483)),v=(0,h.lazyProperties)({iconPadding:()=>n.Styles.createViewStyle({paddingRight:10,paddingLeft:10}),selectLang:()=>n.Styles.createTextStyle({paddingTop:0,height:22,lineHeight:20,overflow:"hidden",flexShrink:1}),selectLangMobile:()=>n.Styles.createTextStyle({paddingTop:3,height:22,lineHeight:20,overflow:"hidden",flexShrink:1}),container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),selectLangContainer:()=>n.Styles.createViewStyle({flex:1,flexGrow:1,flexShrink:1,flexDirection:"row",alignItems:"flex-start",alignContent:"flex-start",justifyContent:"flex-start",borderRadius:7}),selectLangContainerWidth:()=>n.Styles.createViewStyle({flexBasis:"35%"}),selectLangContainerPadding3:()=>n.Styles.createViewStyle({padding:3}),selectLangContainerBg:()=>n.Styles.createViewStyle({backgroundColor:C.Color.gray400}),flagContainerMobile:()=>n.Styles.createViewStyle({borderRadius:10,borderWidth:1,width:20,height:20,overflow:"hidden",paddingTop:4,alignItems:"center"}),flagContainerDesktop:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:10,borderWidth:1,width:20,height:20,overflow:"hidden",paddingTop:3,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerBig:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:20,borderWidth:2,width:40,height:40,overflow:"hidden",paddingTop:8,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerBorderGray:()=>n.Styles.createViewStyle({borderColor:C.Color.gray200}),flagContainerBorderBlue:()=>n.Styles.createViewStyle({borderColor:C.Color.blue}),flag:()=>n.Styles.createTextStyle({fontSize:9,fontWeight:"700"}),flagColor:()=>n.Styles.createTextStyle({color:C.Color.white}),flagBig:()=>n.Styles.createTextStyle({color:C.Color.white,fontSize:18,fontWeight:"700"}),leftArrow:()=>n.Styles.createViewStyle({position:"absolute",backgroundColor:C.Color.sxBlue,width:20,height:25,bottom:0,borderBottomRightRadius:25,left:2}),rightArrow:()=>n.Styles.createViewStyle({position:"absolute",width:20,height:25,bottom:0,borderBottomLeftRadius:25,right:2}),leftBubbleMargin:()=>n.Styles.createViewStyle({marginLeft:4}),rightBubbleMargin:()=>n.Styles.createViewStyle({marginRight:4}),languageBubbleRadius:()=>n.Styles.createViewStyle({borderRadius:16})}),I={textTransform:"uppercase"},w={textOverflow:"ellipsis",whiteSpace:"nowrap"},P=T.UserIconSize.Size36;class M extends f.default{constructor(){super(...arguments),this._onLanguageChange=()=>{this.props.onLanguageChange(this.props.isLocalLanguage)},this._onButtonRef=e=>{this.props.onRef&&e&&this.props.onRef(e)}}_buildState(e,t){return{settings:c.default.getS4LCMCFeatures().pstnTranslation}}_getNameFromCode(e){return u.getShortLanguageTitle(e)||e}render(){let e;const t=this._themeStyles.primaryIconColorStyle,i=[v.selectLangContainer],o=[],c=[I];i.push(v.selectLangContainerWidth),o.push(v.flagContainerDesktop),c.push(v.flag),c.push(t),this.props.languageCode?o.push(v.flagContainerBorderBlue):o.push(v.flagContainerBorderGray),o.push(n.Styles.createViewStyle({borderWidth:0,paddingTop:0,paddingLeft:0,paddingRight:0,width:P,height:P+2},!1)),e=this.props.languageCode?this._getNameFromCode(this.props.languageCode):p.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguage");const d=this.props.isLocalLanguage?g.default.getSkypeMri():this.props.conversationId,u=(0,a.jsx)(y.UserIcon,{userMri:d,size:P}),h=(0,a.jsx)(n.Text,{numberOfLines:1,style:[this.props.isUsingStackNavigationContext?v.selectLangMobile:v.selectLang,this._themeStyles.primaryTextColorStyle,m.default.fontStyle.secondaryButton,w],children:e});let C;this.props.languageCode?(C=this.props.isLocalLanguage?p.getString("LanguageAndTranslationSettingsPanel.TranslationSelectedLocalLanguageTitleAccessibility"):p.getString("LanguageAndTranslationSettingsPanel.TranslationSelectedOtherLanguageTitleAccessibility"),C+=": "+this._getNameFromCode(this.props.languageCode)):C=this.props.isLocalLanguage?p.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLocalLanguageTitleAccessibility"):p.getString("LanguageAndTranslationSettingsPanel.TranslationSelectOtherLanguageTitleAccessibility");const S=b.reverseGradientColorsForColorInfo(this._getContext().userColor),f=[_.default.absoluteFill,v.languageBubbleRadius],T=this.props.isLocalLanguage?(0,a.jsx)(l.GradientView,{style:f,colors:S,direction:l.GradientDirection.RIGHT}):null,M=_.default.absoluteFill,D=this.props.isLocalLanguage?(0,a.jsx)(l.GradientView,{style:M,colors:S,direction:l.GradientDirection.RIGHT}):null,A=(0,a.jsx)(s.Pressable,{onPress:this._onLanguageChange,style:_.default.flexOneRN,accessibilityLabel:C,children:(0,a.jsxs)(r.Box,{importantForAccessibility:"no-hide-descendants",accessibilityLabel:C,ref:this._onButtonRef,backgroundColor:this._getContext().themeColors.bubbleColorSelfModernize,borderColor:void 0,borderWidth:0,paddingLeft:"size120",paddingTop:"size80",paddingBottom:"size80",paddingRight:"size120",borderRadius:16,flex:"1",flexDirection:"row",children:[(0,a.jsx)(n.View,{style:[this.props.isLocalLanguage?v.leftArrow:v.rightArrow,{backgroundColor:this._getContext().themeColors.bubbleColorSelfModernize}],children:D}),T,h]})}),k=this.props.isLocalLanguage?[(0,a.jsx)(n.View,{style:n.Styles.combine([o,v.rightBubbleMargin]),children:u}),A]:[A,(0,a.jsx)(n.View,{style:n.Styles.combine([o,v.leftBubbleMargin]),children:u})];return(0,a.jsx)(n.View,{style:i,importantForAccessibility:n.Types.ImportantForAccessibility.Auto,accessibilityTraits:n.Types.AccessibilityTrait.Button,children:k})}}class D extends f.default{constructor(){super(...arguments),this._onButtonRef=e=>{this.props.onRef&&e&&this.props.onRef(e)}}render(){const e=[v.container],t=[v.iconPadding],i=S.IconSize.size24;e.push(_.default.flexOne);const o=this._themeColors.primaryIconColor;return(0,a.jsxs)(n.View,{style:e,children:[(0,a.jsx)(M,{colorThemeOverride:this.props.colorThemeOverride,isUsingStackNavigationContext:this.props.isUsingStackNavigationContext,languageCode:this.props.localLanguageLocale,onLanguageChange:this.props.changeLanguage,isLocalLanguage:!0,onRef:this.props.onRef}),(0,a.jsx)(n.Button,{onPress:this.props.flipLanguages,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:p.getString("LanguageAndTranslationSettingsPanel.TranslationLanguageSwitchTitle"),importantForAccessibility:n.Types.ImportantForAccessibility.Auto,ref:this._onButtonRef,children:(0,a.jsx)(d.default,{icon:S.SkypeIcon.LanguageSwitch,size:i,color:o,style:t})}),(0,a.jsx)(M,{colorThemeOverride:this.props.colorThemeOverride,isUsingStackNavigationContext:this.props.isUsingStackNavigationContext,languageCode:this.props.otherLanguageLocale,onLanguageChange:this.props.changeLanguage,isLocalLanguage:!1,onRef:this.props.onRef,conversationId:this.props.conversationId})]})}}t.default=D},996256:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(54720)),r=o.__importDefault(i(369347)),l=o.__importDefault(i(638260)),c=i(154235),d=o.__importDefault(i(397232)),u=o.__importStar(i(225511)),h=o.__importDefault(i(288547)),p=i(815146),g=o.__importDefault(i(524526)),C=o.__importStar(i(85385)),m=o.__importDefault(i(54945)),S=i(26703),_=o.__importStar(i(704704)),f=o.__importDefault(i(341994)),y=o.__importDefault(i(566034)),T=o.__importDefault(i(702141)),b=(o.__importDefault(i(791384)),i(16549)),v=i(641400),I=o.__importDefault(i(660401)),w=o.__importDefault(i(497910)),P=o.__importDefault(i(712606)),M=o.__importDefault(i(760989)),D=o.__importDefault(i(206315)),A=o.__importDefault(i(150343)),k=o.__importStar(i(94534)),R=o.__importDefault(i(495193)),x=i(619429),L=(0,S.lazyProperties)({langBarContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),langBarContainerPaddingTop:()=>n.Styles.createViewStyle({paddingTop:20}),doneButtonContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),doneButton:()=>n.Styles.createButtonStyle({alignSelf:"center"}),sectionTitleOverride:()=>n.Styles.createTextStyle({fontWeight:"bold",fontSize:14}),blank:()=>n.Styles.createViewStyle({})}),B=50,V={marginTop:0,marginBottom:0};class O extends w.default{constructor(){super(...arguments),this._dividerCount=0,this._buttons=[],this._onKeyUp=e=>(e.keyCode===m.default.ESCAPE&&this._onBack(),!1),this._onBack=()=>{const e=M.default.newCauseId();return C.log(p.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu._onBack Menu close on ESC press, causeId: ${e}`),h.default.close(this._getRootViewId(),e),!0},this._onButtonsRef=e=>{e&&this._buttons.push(e)}}static menuHeight(){let e=0;return e+=150,e+=2*d.default.rowHeight(V),e+=d.default.rowHeight(V),e+=60,e}_buildState(e,t){const i={translatorVoice:f.default.getCallTranslatorBotTranslationVoice(),localLanguageLocale:e.isPstnTranslation?g.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri):g.default.getCallTranslatorSpokenLanguage(e.conversationMri),otherLanguageLocale:e.isPstnTranslation?g.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri):void 0,autoDetectFeatureEnabled:A.default.getS4LCMCFeatures().translationFeatures.automaticLangDetection,autoDetectEnabled:f.default.getCallTranslatorTranslationAutoDetectEnabled(),truVoiceFeatureEnabled:A.default.getS4LCMCFeatures().translationFeatures.truVoice,truVoiceEnabled:f.default.getCallTranslatorTruVoiceEnabled(),truVoiceConsentState:e.callId?R.default.getInCallFeatureState(e.callId):void 0};return e.callId&&(i.isTranslating=e.isPstnTranslation?r.default.InCallBotService.isPstnTranslationEnabled(e.callId):r.default.InCallBotService.isSkypeTranslationEnabled(e.callId)),i}componentDidMount(){super.componentDidMount();const e=r.default.InCallBotService.getPstnTranslationSessionId(this.props.callId);this.props.callId&&l.default.onPstnTranslationSettingsOpened(this.props.callId,e);const t=M.default.newCauseId();C.log(p.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.componentDidMount Menu open causeId: ${t}`),s.default.subscribe(this._onBack),n.Input.keyUpEvent.subscribe(this._onKeyUp)}componentWillUnmount(){super.componentWillUnmount();const e=M.default.newCauseId();C.log(p.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.componentWillUnMount Menu close causeId: ${e}`),s.default.unsubscribe(this._onBack),n.Input.keyUpEvent.unsubscribe(this._onKeyUp)}_translationDisabled(){return this.props.isPstnTranslation&&(!this.state.localLanguageLocale||!this.state.otherLanguageLocale)||this.props.isSkypeTranslation&&!this.state.localLanguageLocale||!this.state.translatorVoice}_getDividerProps(){let e=b.Color.whiteOverlay30;if(this.props.colorThemeOverride){e=D.default.themeColorsForTheme(this.props.colorThemeOverride).secondaryTextColor}return Object.assign(Object.assign({},V),{key:"divider-"+this._dividerCount++,rowHeight:d.default.rowHeight(V),color:e})}_addDivider(e){e.push({props:this._getDividerProps(),builder:d.default.buildRow,nonInteractive:!0})}_addAutoDetectionToggle(e){const t=_.getString("LanguageAndTranslationSettingsPanel.AutoDetectLanguage"),i=t+", "+(this.state.autoDetectEnabled?_.getString("ToggleSwitch.OnText"):_.getString("ToggleSwitch.OffText")),o={key:"autoDetectLanguage",rowType:u.CustomActionMenuRowType.Toggle,isSelected:this.state.autoDetectEnabled,accessibilityLabel:i,titleText:t,onRowPress:this.props.toggleAutoDetect,rowHeight:B,hideBorder:!0,icon:v.SkypeIcon.Wand,toggleOverlayColorAndroid:b.Color.black,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:o,builder:u.default.buildRow})}_addPstnLangChangeRow(e){const t=(0,a.jsx)(n.View,{style:[L.langBarContainer,void 0],children:(0,a.jsx)(y.default,{isPstnTranslation:this.props.isPstnTranslation,isUsingStackNavigationContext:this.props.isUsingStackNavigationContext,isSkypeTranslation:this.props.isSkypeTranslation,localLanguageLocale:this.state.localLanguageLocale,otherLanguageLocale:this.state.otherLanguageLocale,colorThemeOverride:this.props.colorThemeOverride,conversationId:this.props.conversationMri,flipLanguages:this.props.flipLanguages,changeLanguage:this.props.changeLanguage})}),i=_.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle"),o={key:"langswitch",rowType:u.CustomActionMenuRowType.Custom,accessibilityLabel:i,rowHeight:70,hideBorder:!0,customElement:t,hoverStyle:L.blank};e.push({props:o,builder:u.default.buildRow})}_addSkypeLangChangeRow(e){const t=_.getString("LanguageAndTranslationSettingsPanel.SpokenLanguageLabel"),i=this.state.localLanguageLocale?(o=this.state.localLanguageLocale,k.getShortLanguageTitle(o)||o):"";var o;const a=t+", "+i,n={key:"translationlang",rowType:u.CustomActionMenuRowType.Default,accessibilityLabel:a,titleText:t,onRowPress:()=>this.props.changeLanguage(!0),rowHeight:B,hideBorder:!0,icon:v.SkypeIcon.PersonVoice,rightSideText:i,disabled:this.props.isSkypeTranslation&&this.state.autoDetectFeatureEnabled?this.state.autoDetectEnabled:void 0,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:n,builder:u.default.buildRow})}_addVoiceTitle(e){const t=_.getString("LanguageAndTranslationSettingsPanel.TranslationVoiceSelectionTitle"),i={key:"selectVoiceTitle",rowType:u.CustomActionMenuRowType.Default,accessibilityLabel:t,titleText:t,rowHeight:B,hideBorder:!0,hoverStyle:L.blank,containerStyleOverride:L.sectionTitleOverride,autoShortenText:!0,removeTabIndex:!0};e.push({props:i,builder:u.default.buildRow,nonInteractive:!0})}_addTruvoiceToggle(e){const t=A.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName,i=_.getString("LanguageAndTranslationSettingsPanel.TranslationTruVoice",{featureName:t}),o=i+", "+(this.state.truVoiceEnabled?_.getString("ToggleSwitch.OnText"):_.getString("ToggleSwitch.OffText")),a={key:"truVoice",rowType:u.CustomActionMenuRowType.Toggle,isSelected:this.state.truVoiceEnabled,accessibilityLabel:o,titleText:i,onRowPress:this.props.toggleTruVoice,rowHeight:B,hideBorder:!0,icon:v.SkypeIcon.MicrophoneSpark,toggleOverlayColorAndroid:b.Color.black,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:a,builder:u.default.buildRow})}_addVoiceSelector(e){const t=_.getString("LanguageAndTranslationSettingsPanel.TranslationSystemVoiceTitle");let i;i=this.props.isSkypeTranslation&&this.state.truVoiceFeatureEnabled&&this.state.truVoiceEnabled?_.getString("ToggleSwitch.OffText"):this.state.translatorVoice?P.default.getLabelForGender(this.state.translatorVoice):_.getString("LanguageAndTranslationSettingsPanel.TranslationSelectDefaultValue");const o=t+", "+i,a={key:"translationvoice",rowType:u.CustomActionMenuRowType.Default,accessibilityLabel:o,titleText:t,onRowPress:this.props.changeVoice,rowHeight:B,hideBorder:!0,icon:this.props.isSkypeTranslation?v.SkypeIcon.Robot:v.SkypeIcon.PersonVoice,rightSideText:i,disabled:this.props.isSkypeTranslation&&this.state.truVoiceFeatureEnabled?this.state.truVoiceEnabled:void 0,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:a,builder:u.default.buildRow})}_addTranslateToggle(e){const t=_.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall"),i=t+", "+(this.state.isTranslating?_.getString("ToggleSwitch.OnText"):_.getString("ToggleSwitch.OffText")),o={key:"translatecall",rowType:u.CustomActionMenuRowType.Toggle,isSelected:this.state.isTranslating,accessibilityLabel:i,titleText:t,onRowPress:this.props.translateCall,rowHeight:B,hideBorder:!0,icon:v.SkypeIcon.SkypeTranslator,disabled:this._translationDisabled(),toggleOverlayColorAndroid:b.Color.black,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:o,builder:u.default.buildRow})}_addStopTranslationRow(e){const t=_.getString("CallTranscriptionNotifications.StopTranslation"),i=(0,a.jsx)(n.View,{style:L.doneButtonContainer,children:(0,a.jsx)(I.default,{buttonSize:c.SXButtonSize.Small,title:t,onPress:()=>{this.props.translateCall(),this.props.closeMenu()},style:L.doneButton})}),o={key:"done",rowType:u.CustomActionMenuRowType.Custom,accessibilityLabel:t,rowHeight:60,hideBorder:!0,customElement:i,removeTabIndex:!0,hoverStyle:L.blank};e.push({props:o,builder:u.default.buildRow})}_addDoneButtonRow(e){const t=_.getString("Global.DoneButtonTitle"),i=(0,a.jsx)(n.View,{style:L.doneButtonContainer,children:(0,a.jsx)(I.default,{buttonSize:c.SXButtonSize.Small,title:t,onPress:this.props.closeMenu,style:L.doneButton})}),o={key:"done",rowType:u.CustomActionMenuRowType.Custom,accessibilityLabel:t,rowHeight:60,hideBorder:!0,customElement:i,removeTabIndex:!0,hoverStyle:L.blank};e.push({props:o,builder:u.default.buildRow})}_getPstnTranslationMenu(e){this._addPstnLangChangeRow(e),this._addDivider(e),this._addVoiceSelector(e),this._addDivider(e),this._addTranslateToggle(e),this.props.isUsingStackNavigationContext||(this._addDivider(e),this._addDoneButtonRow(e))}_getSkypeTranslationMenu(e){var t,i;this.state.autoDetectFeatureEnabled&&(this._addAutoDetectionToggle(e),this._addDivider(e)),this._addSkypeLangChangeRow(e),this._addDivider(e);const o=(null===(t=this.state.truVoiceConsentState)||void 0===t?void 0:t.state)===x.InCallFeatureState.Enabled||(null===(i=this.state.truVoiceConsentState)||void 0===i?void 0:i.state)===x.InCallFeatureState.EnabledByRemote;(this.state.truVoiceFeatureEnabled||o)&&(this._addVoiceTitle(e),this._addTruvoiceToggle(e),this._addDivider(e)),this._addVoiceSelector(e),this._addDivider(e),this._addStopTranslationRow(e)}render(){const e=[];return this.props.isSkypeTranslation?this._getSkypeTranslationMenu(e):this.props.isPstnTranslation&&this._getPstnTranslationMenu(e),(0,a.jsx)(T.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride,style:this.props.style})}}t.default=O},895597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(331654),s=o.__importStar(i(516778)),r=o.__importStar(i(317588)),l=i(154235),c=i(413686),d=o.__importDefault(i(367911)),u=i(26703),h=o.__importStar(i(704704)),p=o.__importDefault(i(740794)),g=i(697091),C=o.__importDefault(i(399564)),m=(o.__importDefault(i(690051)),o.__importDefault(i(960282))),S=o.__importDefault(i(660401)),_=i(262725),f=o.__importDefault(i(497910)),y=(0,u.lazyProperties)({noCallsItemContainer:()=>s.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),noCallsItemContainerSmallTopMargin:()=>s.Styles.createViewStyle({marginTop:20}),noCallsItemContainerLargeTopMargin:()=>s.Styles.createViewStyle({marginTop:70,marginBottom:10}),noCallsItemInfoText:()=>s.Styles.createTextStyle({textAlign:"center"}),noCallsItemButton:()=>s.Styles.createButtonStyle({flex:1,marginTop:20,minWidth:190,alignSelf:"center"}),noCallsImageV3:()=>s.Styles.createImageStyle({width:130,height:130,alignSelf:"center"})});class T extends f.default{constructor(){super(...arguments),this._syncLocalAddressStore=()=>{this.state.hideSyncAddressBookCta||p.default.navigateToSyncAddressBook({origin:c.DialogNavOrigin.NoCallsItem,hideSkipButton:!0},void 0,this._getRootViewId())}}static getDefaultHeight(){return 157}_buildState(e,t){const i=this._getRootViewId(),o={hideSyncAddressBookCta:!0,isLandscape:m.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape&&!this._getContext().isPresentedInDesktopSubview,isSmallDevice:m.default.isSmallDevice(i)};return t&&(o.hideSyncAddressBookCta||C.default.track(new g.DisplayedEmptyStateCta(g.EmptyStateOrigin.NoCalls))),o}render(){let e,t;const i=[y.noCallsItemContainer];return this.state.hideSyncAddressBookCta||(e=(0,a.jsx)(S.default,{style:y.noCallsItemButton,buttonSize:l.SXButtonSize.Medium,onPress:this._syncLocalAddressStore,title:h.getString("NoCallsItem.ConnectButton")})),this.state.isLandscape||(t=(0,a.jsx)(s.Image,{style:y.noCallsImageV3,resizeMode:"contain",source:r.Collection.ONBOARDING_CALLS_EMPTYSTATE_NOCALLS_V3})),(0,a.jsxs)(s.View,{style:i,children:[t,(0,a.jsx)(d.default,{headerText:this.props.title}),(0,a.jsx)(_.BodyText,{style:y.noCallsItemInfoText,textThemeColor:_.TextThemeColor.Secondary,children:this.props.infoLabel}),e]})}}t.default=T},515888:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importDefault(i(815063)),r=i(331654),l=o.__importStar(i(516778)),c=o.__importDefault(i(974634)),d=i(537180),u=o.__importDefault(i(150343)),h=o.__importDefault(i(452045)),p=o.__importDefault(i(45810)),g=o.__importDefault(i(808467)),C=o.__importDefault(i(369347)),m=o.__importDefault(i(60433)),S=i(619429),_=o.__importDefault(i(549173)),f=o.__importStar(i(44717)),y=o.__importDefault(i(98794)),T=o.__importDefault(i(721657)),b=o.__importDefault(i(340724)),v=o.__importDefault(i(633958)),I=i(154235),w=o.__importDefault(i(555436)),P=o.__importDefault(i(615364)),M=o.__importDefault(i(984339)),D=o.__importDefault(i(417411)),A=o.__importDefault(i(739651)),k=i(815146),R=i(406719),x=o.__importDefault(i(453761)),L=o.__importDefault(i(457468)),B=o.__importStar(i(85385)),V=i(26703),O=o.__importDefault(i(432091)),E=o.__importStar(i(963369)),N=o.__importStar(i(704704)),F=o.__importDefault(i(201721)),U=o.__importDefault(i(740794)),H=o.__importDefault(i(942724)),j=o.__importStar(i(511592)),z=o.__importDefault(i(895597)),G=o.__importDefault(i(690051)),W=i(351979),K=o.__importDefault(i(459778)),$=i(773151),q=o.__importDefault(i(960282)),Q=o.__importStar(i(437782)),X=o.__importDefault(i(117475)),Z=o.__importDefault(i(421334)),J=i(376229),Y=i(286517),ee=i(240804),te=o.__importDefault(i(657764)),ie=o.__importDefault(i(268558)),oe=o.__importDefault(i(81122)),ae=o.__importDefault(i(817672)),ne=i(375258),se=o.__importDefault(i(504025)),re=o.__importDefault(i(350648)),le=i(928722),ce=o.__importDefault(i(660401)),de=i(641400),ue=o.__importDefault(i(827361)),he=o.__importDefault(i(685734)),pe=o.__importDefault(i(760989)),ge=o.__importDefault(i(139825)),Ce=i(844086),me=i(927164),Se=o.__importDefault(i(463171)),_e=i(503308),fe=(i(385855),[W.QuickCallPanelFilter.All,W.QuickCallPanelFilter.Skype,W.QuickCallPanelFilter.Phone]),ye=(0,V.lazyProperties)({mainContainer:()=>l.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>l.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch"}),innerHeaderContainer:()=>l.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),searchInputContainer:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),noCallsContainer:()=>l.Styles.createViewStyle({flex:1,paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20}),searchBoxContainerCompositeNav:()=>l.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:J.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1}),searchHeaderWrapper:()=>l.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),searchAccessoryButton:()=>l.Styles.createViewStyle({marginRight:5}),dialpadBarAccessibilityOffset:()=>l.Styles.createViewStyle({marginBottom:65})}),Te={flexGrow:1,flexShrink:0},be={zeroInput:[{groupType:k.SearchResultsListGroup.PstnDialpad},{groupType:k.SearchResultsListGroup.UpcomingCalls},{groupType:k.SearchResultsListGroup.RecentCalls},{groupType:k.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputWithDialpadAccessory:[{groupType:k.SearchResultsListGroup.UpcomingCalls},{groupType:k.SearchResultsListGroup.RecentCalls},{groupType:k.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputSearchOnly:[{groupType:k.SearchResultsListGroup.RecentCalls},{groupType:k.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputOneOnOneCall:[{groupType:k.SearchResultsListGroup.RecentCalls},{groupType:k.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputAddToOneOnOneCall:[{groupType:k.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputGroupCall:[{groupType:k.SearchResultsListGroup.GroupMember},{groupType:k.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputCallsOnly:[{groupType:k.SearchResultsListGroup.RecentCallsExtended}],shortQuery:[{groupType:k.SearchResultsListGroup.AllPeople},{groupType:k.SearchResultsListGroup.GroupChats}],longQuery:[{groupType:k.SearchResultsListGroup.AllPeople,isCollapsible:!0},{groupType:k.SearchResultsListGroup.GroupChats,isCollapsible:!0},{groupType:k.SearchResultsListGroup.PublicDirectory,isCollapsible:!0}]},ve="quickCallHeader",Ie="selectedProfilesList",we="quickCallSearchResultList",Pe="compositeNavsearchResultsListWrapper";class Me extends g.default{constructor(e){super(e),this._onKeyDownEvent=new c.default,this._searchActive=!1,this._shadowVisible=!1,this._headerExpanded=!0,this._selectedProfiles=[],this._headerAnimatedTopValue=new l.Animated.Value(0),this._headerAnimatedTopStyle=l.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]}),this._resetTransitionTransformValue=new l.Animated.Value(0),this._resetTransitionOpacityValue=new l.Animated.Value(1),this._resetTransitionStyle=l.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._shadowOpacityValue=new l.Animated.Value(0),this._shadowOpacityStyle=l.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._showSearchWhenEmptyState=!1,this._onResultsCountChange=e=>{0===n.trim(this.state.rawSearchQuery).length&&Se.default.setCallsEmpty(e)},this._renderAddContacts=()=>(0,a.jsx)(l.View,{style:ye.noCallsContainer,children:(0,a.jsx)(z.default,{infoLabel:N.getString("QuickCallPanel.NoCallsDescriptionDesktop"),title:N.getString("QuickCallPanel.NoCallsTitleDesktop")})},"noCallsItem"),this._renderDialpadButtonMobile=()=>(0,a.jsx)(x.default,{size:de.IconSize.size24,onPress:this._onPressDialer,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:de.SkypeIcon.Dialpad,title:N.getString("PeopleList.PstnDialpadLabel")}),this._handleMenuCommand=e=>{if(!this.isComponentMounted())return;const t=Me._filterForCommand(e);n.isUndefined(t)||(F.default.setUserPreferencesLocal({quickCallFilter:t}),this.setState({filter:t}))},this._handleSearchButtonClick=()=>{const e=pe.default.newCauseId();B.log(k.LogTraceArea.QuickCallPanel,"_handleSearchButtonClick causeId: "+e),B.track(new _e.PressAction(_e.PressScenario.SearchNavigation,k.SearchPanelInitiator.QuickCallPanel)),U.default.navigateToSearchFromPanel(e,this._getContext(),this._isPresentedInTabletLeftNav(),k.SearchPanelInitiator.QuickCallPanel)},this._addSelectedUsersToCall=()=>{const e=pe.default.newCauseId();B.log(k.LogTraceArea.QuickCallPanel,"_addSelectedUsersToCall causeId: "+e),this.state.selectedMris&&this._addUsersToCall(this.state.selectedMris.map((e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e})),e)},this._handleSearchResultsListAddUserToCall=(e,t)=>{const i=pe.default.newCauseId();B.log(k.LogTraceArea.QuickCallPanel,"_handleAddUserToCall causeId: "+i),this._containerRef&&this._containerRef.requestFocus?this._searchResultsListActionHelper(t,e,i):B.error(k.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper anchor is not focusable:  has container ref: "+!!this._containerRef+", causeId: "+i)},this._handleSearchResultsListItemClick=(e,t,i)=>{const o=pe.default.newCauseId();if(B.log(k.LogTraceArea.QuickCallPanel,"_handleListItemClick causeId: "+o),i===k.SearchResultsListGroup.PstnDialpad)this._onPressDialer();else{const i=()=>e.isComponentMounted()?e:void 0;this._searchResultsListActionHelper(i,t,o)}},this._onPressDialer=()=>{const e=pe.default.newCauseId();B.log(k.LogTraceArea.QuickCallPanel,"_onToggleDialpad, causeId: "+e),this._onInputTextChange("");let t=k.DialerNavigationSource.QuickCallPanel;this.props.callId?t=this.props.newGroup?k.DialerNavigationSource.QuickCallPanelAddToCall:k.DialerNavigationSource.QuickCallPanelNewCall:this.state.isInGroupCallMode&&(t=this.props.newGroup?k.DialerNavigationSource.QuickCallPanelNewCall:k.DialerNavigationSource.QuickCallPanelAddToCall),U.default.navigateToPSTNDialerWithParams({callId:this.props.callId,conversationId:this.props.conversationId,causeId:e,navigationSource:t},this._getRootViewId())},this._removeProfileFromSelection=e=>{if(this.isComponentMounted()){const t=e.getMri(),i=t?this._removeEntryFromMriToPhoneMap(t):void 0,o=n.compact(n.without(this.state.selectedMris,i||t));this.setState({selectedMris:o}),this._searchResultsList?this._searchResultsList.focusFirst():this._groupCallModeHeaderButtonRef&&this._groupCallModeHeaderButtonRef.requestFocus()}},this._onSimplePanelHeaderRef=e=>{this._headerRef=e||void 0},this._onSearchResultsListRef=e=>{this._searchResultsList=e||void 0},this._onContainerRef=e=>{this._containerRef=e||void 0},this._onGroupCallModeHeaderButtonRef=e=>{this._groupCallModeHeaderButtonRef=e||void 0},this._onGroupCallBackHeaderButtonRef=e=>{this._groupCallBackHeaderButtonRef=e||void 0},this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e?this.setState({isSearchActive:e}):this.setState({isSearchActive:e,rawSearchQuery:""})},this._onPressClose=()=>{const e=pe.default.newCauseId();B.log(k.LogTraceArea.QuickCallPanel,"_onPressClose causeId: "+e),this.setState({rawSearchQuery:""}),this._goBack(e)},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onContentWrapperRef=e=>{this._wrappedTransitionView=e||void 0},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._updateScrollYValue=e=>{!this.state.enableCollapsibleHeaderSearch||this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()||this.setState({vlvScrollY:e})},this._onScroll=(e,t)=>{var i,o;if(this._updateScrollYValue(e),null===(o=(i=this.props).onScroll)||void 0===o||o.call(i,e,t),this._shouldCollapseHeader()){let i=this._headerExpanded;if(e<T.default.collapsableHeight(this._getRootViewId()))i=!0;else{i=i&&t-e>0}this._expandOrCollapseHeader(i,!0)}},this._onExperimentalNavScroll=(e,t)=>{var i,o;this._updateScrollYValue(e),null===(o=(i=this.props).onScroll)||void 0===o||o.call(i,e,t);const a=e>0;this._shadowVisible!==a&&(l.Animated.timing(this._shadowOpacityValue,{toValue:a?.5:0,duration:100,easing:l.Animated.Easing.Out()}).start(),this._shadowVisible=a)},this._onExperimentalCallButtonPress=e=>{{const t=pe.default.newCauseId();B.log(k.LogTraceArea.QuickCallPanel,"_handleGroupCallButtonClick_Floating_CTA_desktop causeId: "+t),this._enterGroupCallMode(e)}},this._enterGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!0})},this._leaveGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!1,selectedMris:[]})},this._startGroupCall=()=>{const e=pe.default.newCauseId();if(B.log(k.LogTraceArea.QuickCallPanel,"_startGroupCall causeId: "+e),this.state.selectedMris&&1===this.state.selectedMris.length){const t=()=>this._groupCallModeHeaderButtonRef;this._startCallToMri(this.state.selectedMris[0],t,e,k.NavigationCallOrigin.QuickCallPanelNewCall)}else this.setState({isNewGroupCallStarting:!0}),this.state.selectedMris?C.default.CallNavigationHelper.startNewGroupCallAndConversation(this.state.selectedMris,!1,e,void 0,k.NavigationCallOrigin.StartNewGroupCallAndConv).always((()=>{this.isComponentMounted()&&this.setState({isNewGroupCallStarting:!1})})):B.error(k.LogTraceArea.QuickCallPanel,"_startGroupCall with no mris causeId: "+e)},this._onInputTextChange=e=>{this.isComponentMounted()&&this.setState({rawSearchQuery:e})},this._goBack=e=>(B.log(k.LogTraceArea.QuickCallPanel,"QuickCallPanel._goBack, causeId: "+e),this._isPresentedInTabletLeftNav()?(U.default.closeCallSearchPanel(e,this._getContext()),!0):super._goBack(e)),e.searchOnly&&(this._transitionSubscriptionToken=j.default.transitionInfoEvent().subscribe((e=>{if(e.inProgress&&this.isComponentMounted())if(j.default.isHubSearchTransition()){if(e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===j.RouteType.Search?e.toRoute.index:e.fromRoute.index;n.isUndefined(t)?this._clearAnimatedValues():this._setAnimatedValues(e.progress,t)}}else this._clearAnimatedValues()}))),this._showSearchWhenEmptyState=e.navSource===k.QuickCallSource.RewardsUpsell}_buildState(e,t){let i=W.QuickCallPanelFilter.All;e.useExperimentalDesktopUtilityBar&&(i=F.default.getUserPreferencesLocal().quickCallFilter||W.QuickCallPanelFilter.All);const{enableCollapsibleHeaderSearch:o}=u.default.getS4LUiFeatures(),a={filter:i,enableCollapsibleHeaderSearch:o};t&&(a.vlvScrollY=0,a.isSearchActive=!1,a.isInGroupCallMode=!1,a.isNewGroupCallStarting=!1,a.selectedMris=[],a.mriToPhoneMriMap=new Map,a.rawSearchQuery="",this._searchController=new te.default,e.newGroup&&(a.isInGroupCallMode=!0),a.isMobile=s.default.isMobile(),this._headerAnimatedHeightValue=new l.Animated.Value(T.default.expandedHeight(this._getRootViewId())),this._headerAnimatedHeightStyle=l.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}));const c=this._getContext(),d=this._getRootViewId(),h=H.default.isUsingStackNavigationContext(),p=!e.hideHeader&&(!c.isPresentedInDesktopSubview||this._isPresentedInTabletLeftNav());a.isSmallDevice=q.default.isSmallDevice(d),a.statusBarPadding=p?X.default.statusBarPadding():0,a.isPortrait=q.default.getDeviceOrientation(d)===r.DeviceOrientation.Portrait,a.isSyncAddressBookEnabled=G.default.getSyncAddressBookPrivacySetting(),a.hasCallsAndContacts=(0,P.default)().hasJoinedConversationsWithCall()||w.default.getFilteredSortedAllPeopleProfiles("",{excludeBots:!0,excludeShortCircuitMatches:!a.isSyncAddressBookEnabled,excludeUnauthorized:!a.isSyncAddressBookEnabled,excludeBlocked:!0}).length>0,a.shouldUseIOSSearchStyles=T.default.shouldUseIOSSearchStyles(),a.useMobileOrTabletUI=h||!!this._isPresentedInTabletLeftNav(),a.disableHighBandwidthOperations=L.default.isUsingGogoNetwork();const g=e.callId,S=e.conversationId;if(g&&S){a.activeCallMemberMris=n.map(n.filter(C.default.CallingStore.getRemoteCallMembers(g),(e=>!!e&&(m.default.isParticipantConnected(e)||m.default.isParticipantStateRinging(e.state)))),(e=>C.default.CallingStore.getRemoteCallMemberMri(g,e)));const e=(0,P.default)().getConversation(S);e&&(a.conversationMemberMris=e.getMemberMris())}return a.isMobileScreenReaderEnabled=Z.default.isMobileScreenReaderEnabled(),a.rowSize=this._isPresentedInDesktopLeftNav()?K.default.nonRecentRowSizeAndChanges():void 0,a.emptyStateModernizedEmoticon=u.default.getS4LMessagingFeatures().emoticonForEmptyCallsTab,a.shouldShowEmptyStateIllustrationScreen=Se.default.getCallsEmpty()&&!e.hideIllustration&&!this._showSearchWhenEmptyState&&e.navSource!==k.QuickCallSource.FreeCallUpsell,a}scrollToTop(){this._searchResultsList&&this._searchResultsList.scrollToTop()}componentDidMount(){super.componentDidMount(),this._showOrHideHeader(this.state,!this._searchActive,!1),this._onScroll(0,0),se.default.showPromptIfNeeded(this.props.conversationId||I.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),this._transitionSubscriptionToken&&(this._transitionSubscriptionToken.unsubscribe(),this._transitionSubscriptionToken=void 0),this._searchController&&this._searchController.destroy(),this._onScroll(0,0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const o=e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e};this._selectedProfiles=n.map(t.selectedMris,(e=>he.default.getDisplayableUserByMri(o(e)))),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait&&this.state.selectedMris===t.selectedMris||this._showOrHideHeader(t,!this._searchActive,!1)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isInGroupCallMode!==t.isInGroupCallMode&&(this._headerRef&&this._headerRef.requestFocus(),this._groupCallBackHeaderButtonRef&&this.state.isInGroupCallMode&&this._groupCallBackHeaderButtonRef.requestFocus())}render(){const e=this._shouldCollapseHeader(),t=n.trim(this.state.rawSearchQuery),i=0===t.length;let o;o=i?this.state.filter===W.QuickCallPanelFilter.Phone||this.state.filter===W.QuickCallPanelFilter.Skype?be.zeroInputCallsOnly:e?be.zeroInputSearchOnly:this.state.isInGroupCallMode?this.props.conversationId&&f.isGroupConversation(this.props.conversationId)?[{groupType:k.SearchResultsListGroup.ShareGroup},...be.zeroInputGroupCall]:this.props.callId?be.zeroInputAddToOneOnOneCall:be.zeroInputOneOnOneCall:be.zeroInputWithDialpadAccessory:t.length<u.default.getConfigSettingsNoSubscription().search.longQueryCharCount?be.shortQuery:be.longQuery,(this.state.isInGroupCallMode||this.props.callId)&&(o=o.filter((e=>e.groupType!==k.SearchResultsListGroup.GroupChats))),this.props.navSource===k.QuickCallSource.FreeCallUpsell&&(o=[{groupType:k.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}]);const s=this._shouldShowDialPadBar(o),r=this.props.useExperimentalDesktopUtilityBar?this._renderUtilityBar():void 0,c=r?this._renderShadow():void 0,h=this.state.shouldShowEmptyStateIllustrationScreen?this._renderEmptyState():void 0,p=[ye.mainContainer,this._getBackgroundColorStyle()],g=[];if((!this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())&&this.props.hideHeader){const e=N.getString(this.state.isMobile?"SearchInputControl.PlaceHolderTextShort":"SearchInputControl.PlaceHolderTextPeopleGroupsMessages");g.push((0,a.jsx)(me.CollapsibleHeaderSearch,{onPress:this._handleSearchButtonClick,placeholder:e,value:this.state.vlvScrollY,valueFrom:0,valueTo:50},"search"))}if(this.state.hasCallsAndContacts||this.state.isSyncAddressBookEnabled||this._showSearchWhenEmptyState){this.state.isInGroupCallMode&&!n.isEmpty(this._selectedProfiles)&&g.push((0,a.jsx)(ie.default,{selectedProfiles:this._selectedProfiles,onProfileRemoved:this._removeProfileFromSelection},Ie));const t=this.props.callId||this.state.isInGroupCallMode?ee.FilterType.GroupCallCapable:ee.FilterType.CallCapable;let r=0;e&&(r=T.default.collapsableHeight(this._getRootViewId()));const u=0;r=this.props.topInset||u;const p=!this.state.isInGroupCallMode&&(!this.props.callId&&i),C=Math.max(this.props.bottomPadding||0,s&&!this.state.isMobileScreenReaderEnabled?65:0),m=e||this.props.onScroll?this._onScroll:c?this._onExperimentalNavScroll:this._updateScrollYValue,S=this._getContext().isPresentedInGenericDesktopModal?k.SearchResultsListOrigin.QuickCallPanelModal:k.SearchResultsListOrigin.QuickCallPanel,_=(0,a.jsx)(Y.SearchResultsList,{rawSearchQuery:this.state.rawSearchQuery,origin:S,ref:this._onSearchResultsListRef,userMrisToExclude:this.state.activeCallMemberMris,searchResultGroups:o,searchController:this._searchController,isSearchActive:this.state.isSearchActive,hasCallIcons:p,hasAddToCallIcon:!!this.props.callId&&!this.props.newGroup,filterPeopleType:t,arePeopleSelectableForInvite:this.state.isInGroupCallMode,maxNumberOfSuggestedContacts:20,onListItemClick:this._handleSearchResultsListItemClick,onAddUserToCall:this.props.callId?this._handleSearchResultsListAddUserToCall:void 0,selectedMris:this.state.isInGroupCallMode?this.state.selectedMris:void 0,showInviteButton:!1,showButtonsOnHover:this.props.useExperimentalDesktopUtilityBar,disableItemOnLongPress:!0,excludeGroups:this.state.isInGroupCallMode,excludeEncrypted:this.state.isInGroupCallMode,onlyPstn:this.state.filter===W.QuickCallPanelFilter.Phone,excludePstn:this.state.filter===W.QuickCallPanelFilter.Skype,keyDownEvent:this._onKeyDownEvent,topInset:r,bottomPadding:C,onScroll:m,onResultsCountChange:this._onResultsCountChange,accessibilityLabel:N.getString("QuickCallPanel.CallsList"),suppressPseudoFocus:!0,conversationId:this.props.conversationId,hideEmptyState:this.props.newGroup,hideIllustration:this.props.hideIllustration,rowSize:this.state.rowSize,excludeRecentCallFromSuggestedList:!0,isMobileTab:!!this.props.isMobileTab,emptyStateDisplayed:this.state.shouldShowEmptyStateIllustrationScreen,peopleType:this.props.navSource===k.QuickCallSource.FreeCallUpsell?ee.PeopleType.AllWithPhoneNumbers:void 0},we);this.state.useMobileOrTabletUI?h?g.push((0,a.jsxs)(d.ScrollView,{contentContainerStyle:Te,children:[_,h]},"scrollViewForOptionalEmptyStateScreen")):g.push(_):g.push((0,a.jsxs)(l.View,{style:ue.default.flexOne,children:[h?(0,a.jsxs)(d.ScrollView,{contentContainerStyle:Te,children:[_,h]}):_,c]},Pe))}else h?g.push((0,a.jsx)(d.ScrollView,{style:{marginTop:(this.state.useMobileOrTabletUI,0)},contentContainerStyle:Te,children:h},"scrollViewForOptionalEmptyStateScreen")):g.push(this._renderAddContacts());const C=[ue.default.flexOne];let m;this.state.useMobileOrTabletUI?(this.props.searchOnly&&C.push(l.Styles.createViewStyle({marginTop:T.default.collapsedHeight(this._getRootViewId())+this.state.statusBarPadding},!1)),s&&this.state.isMobileScreenReaderEnabled&&C.push(ye.dialpadBarAccessibilityOffset),m=(0,a.jsx)(l.View,{style:C,children:g},"content")):m=g;const S=e?this._renderSearchHeader():this._renderHeaderContainer(),_=s?(0,a.jsx)(A.default,{location:R.ExperimentLocation.CallsPanel,onPress:this._onPressDialer,onCallButtonPress:this._onExperimentalCallButtonPress},"DialpadBarExperiment"):void 0,y=this._getFooterButton(),b=this.state.shouldShowEmptyStateIllustrationScreen?[r,m]:[S,r,m,_];let I=(0,a.jsxs)(l.View,{ref:this._onContainerRef,style:p,children:[e?n.reverse(b):b,this._renderEntitlementsBanner(),y?this._getPanelFooter(y):void 0]});return this.props.searchOnly&&(I=(0,a.jsx)(ge.default,{ref:this._onContentWrapperRef,style:ye.mainContainer,children:I})),(0,a.jsx)(v.default,{goBack:this._goBack,children:(0,a.jsx)(Ce.KeyboardAvoidingView,{children:I})})}_getPanelFooter(e){return(0,a.jsx)(l.View,{style:this._getBackgroundColorStyle(),children:(0,a.jsx)(ae.default,{button:e})})}_getBackgroundColorStyle(){return l.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1)}_renderShadow(){return(0,a.jsx)(D.default,{opacityStyle:this._shadowOpacityStyle})}_renderUtilityBar(){const e=Me._menuItemTitle(this.state.filter),t=b.default.combinedAccessibilityLabel(N.getString("QuickCallPanel.ViewByMenu"),e);return(0,a.jsx)(oe.default,{getMenuSections:this._getMenuSections(),currentMenuText:e,accessibilityText:t,onHandleMenuCommand:this._handleMenuCommand,newActionPickerContext:this.props.newActionPickerContext},"utilitybar")}_renderEmptyState(){return(0,a.jsx)(h.default,{emoticon:this.state.emptyStateModernizedEmoticon,topSlot:(0,a.jsx)(p.default,{headerText:N.getString("QuickCallPanel.NoCallsTitleModernized"),bodyText:N.getString("QuickCallPanel.NoCallsInfoModernized"),useThemeHeaderColor:!0})},"noCallsItem")}_renderSearchHeader(){if(this.state.useMobileOrTabletUI)return(0,a.jsx)(l.View,{style:ye.searchHeaderWrapper,ignorePointerEvents:!0,children:(0,a.jsx)(y.default,{ref:this._onSearchHeaderRef,initialValue:1,autoFocus:!0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,cancelSearch:this._onPressClose})},ve)}_renderHeaderContainer(){if(this.props.hideHeader)return;let e;if(this.state.useMobileOrTabletUI){let t;(this.state.hasCallsAndContacts||this._showSearchWhenEmptyState)&&(t=(0,a.jsx)(l.View,{style:ye.searchInputContainer,children:(0,a.jsx)(y.default,{initialValue:1,showButtonWhenInactive:!0,placeholderText:this.state.isMobile?N.getString("SearchInputControl.PlaceHolderTextShort"):N.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?N.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,actionButton:this.state.isInGroupCallMode?this._groupCallModeHeaderButton():void 0,buttonAccessoryView:this._renderDialpadButtonMobile(),hideButtonAccessoryViewBorder:!0})}));const i=this._getHeaderText(this.state),o=i?void 0:(0,a.jsx)(l.View,{style:ue.default.flexOne});e=(0,a.jsx)(l.Animated.View,{style:[ye.headerContainer,this._headerAnimatedHeightStyle],children:(0,a.jsxs)(l.Animated.View,{style:s.default.isMobile()?void 0:this._headerAnimatedTopStyle,children:[(0,a.jsx)(ne.SimplePanelHeader,{ref:this._onSimplePanelHeaderRef,panelName:i,leftButton:this._getHeaderCloseButton(),titleView:o,hideBottomBorder:!0,delayHeaderFocus:!1,shouldAnnouncePanelNameOnMount:!!this.props.callId&&!1}),t]})},ve)}else{let t;if(this.state.hasCallsAndContacts||this._showSearchWhenEmptyState){const e=(0,a.jsx)(ce.default,{style:ye.searchAccessoryButton,buttonStyle:I.SXButtonStyle.LightFill,buttonSize:I.SXButtonSize.Small,title:N.getString("QuickCallPanel.DialpadButtonLabel"),allowTextWrap:!1,icon:de.SkypeIcon.Dialpad,showShadow:!0,onPress:this._onPressDialer});t=(0,a.jsx)(l.View,{style:ye.searchInputContainer,children:(0,a.jsx)(M.default,{placeholderText:N.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),accessoryView:e,showButtonWhenInactive:!0,autoFocus:!l.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?N.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,onKeyDown:this._onSearchInputKeyDown})})}e=(0,a.jsxs)(l.View,{style:ye.headerContainer,children:[this._renderCompositeNavHeader(),(0,a.jsx)(l.View,{style:[ye.innerHeaderContainer,this._themeStyles.searchBoxColorStyle],children:t})]},ve)}return e}_renderEntitlementsBanner(){if(this._isPresentedInDesktopLeftNav())return(0,a.jsx)(re.default,{location:R.ExperimentLocation.CallsPanelBanner,useCompactLayout:this.state.rowSize===$.RowSize.ExtraCompact,onClose:()=>{this._searchResultsList&&this._searchResultsList.focusFirst()}})}_renderCompositeNavHeader(){return(0,a.jsx)(ne.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderCloseButton(),hideBottomBorder:!0,delayHeaderFocus:!1})}_getMenuSections(){return[{key:"calls",menuItems:n.map(fe,(e=>({text:Me._menuItemTitle(e),command:Me._menuItemCommand(e),selected:e===this.state.filter,isCheckbox:!0})))}]}_getHeaderCloseButton(){return this.state.isInGroupCallMode&&!this.props.newGroup?{text:N.getString("Global.CancelLabel"),onPress:this._leaveGroupCallMode,title:N.getString("Global.CancelLabel"),closeButtonType:ne.CloseButtonType.Back}:{title:this.props.callId||!this.state.useMobileOrTabletUI&&!this.props.isAloneInNavStack?N.getString("Global.BackButtonTitle"):N.getString("QuickCallPanel.CloseButtonAccessibilityLabel"),onPress:this._onPressClose,setButtonRef:this._onGroupCallBackHeaderButtonRef,closeButtonType:(this.state.useMobileOrTabletUI||this.props.isAloneInNavStack)&&this.props.navigationDirection!==le.StackNavigationDirection.Push?ne.CloseButtonType.Close:ne.CloseButtonType.Back}}_groupCallModeHeaderButton(){const e=!this.state.selectedMris||0===this.state.selectedMris.length;return{text:this.props.callId?N.getString("QuickCallPanel.AddToCallText"):N.getString("QuickCallPanel.StartCallText"),onPress:this.props.callId?this._addSelectedUsersToCall:this._startGroupCall,disabled:e,showActivityIndicator:this.state.isNewGroupCallStarting,setButtonRef:this._onGroupCallModeHeaderButtonRef}}_getFooterButton(){if(this.state.isInGroupCallMode)return this._groupCallModeHeaderButton()}_getHeaderText(e){let t=N.getString("QuickCallPanel.PanelHeaderDefault");return this.props.callId?t=N.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderAddToCall":"QuickCallPanel.PanelHeaderNewCall"):e.isInGroupCallMode&&(t=N.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderNewCall":"QuickCallPanel.SelectParticipantsHeader")),t}_addUsersToCall(e,t){if(B.log(k.LogTraceArea.QuickCallPanel,"_addUsersToCall causeId: "+t),!this.props.callId)return;C.default.CallParticipantUtils.addUsersToCallOrRing(e,this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||k.NavigationAddToCallOrigin.Unknown);const i=N.getString("QuickCallPanel.AddToCallAnnouncement",{count:e.length});l.Accessibility.announceForAccessibility(i),this.state.useMobileOrTabletUI?this._onPressClose():this._goBack(t)}_searchResultsListActionHelper(e,t,i){if(this.state.isInGroupCallMode){if(!u.default.getS4LCMCFeatures().enableUIToSelectSkypeOrPSTNContactToAddToGroupCall)return void this._addOrRemoveUserSelection(t,i);const o=e=>{this._addOrRemoveUserSelection(e,i)},a=(e,t)=>{this.state.mriToPhoneMriMap.set(t,e),o(t)},s=he.default.getDisplayableUserByMri(t),r=f.isPhoneMri(t)?[]:E.mergeMriProfileAndExtraPhones(t,void 0,s?s.phoneNumbers:void 0),l=n.includes(this.state.selectedMris,t);return void(n.isEmpty(r)||l?(l&&this._removeEntryFromMriToPhoneMap(t),this._addOrRemoveUserSelection(t,i)):_.default.showForSkypeMri(e,this._getRootViewId(),t,void 0,!0,k.ContactInviteOrigin.Unknown,k.NavigationCallOrigin.Unknown,o,a,void 0,r))}if(this.props.callId)return void this._addUserToExistingCall(t,i);if(!t)return void B.error(k.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper with unactionable listItemMri: "+Q.mriOrId(t)+", causeId: "+i);if(!f.isMri(t)&&E.isLocalAddressBookContact(t))return void this._handleAddressBookContactClick(e,t);const o=()=>{U.default.navigateToConversation({convId:t,causeId:i,origin:k.NavigationConversationOrigin.Search})};n.trim(this.state.rawSearchQuery).length||this._isPresentedInDesktopLeftNav()&&t?o():this._startCallToMri(t,e,i,k.NavigationCallOrigin.CallsTabQuickCallPanel)}_startCallToMri(e,t,i,o){if(B.log(k.LogTraceArea.QuickCallPanel,"_startCallToMri causeId: "+i),this.props.callId)return void B.log(k.LogTraceArea.QuickCallPanel,"_startCallToMri, callId must not be defined, causeId: "+i);if(!e||!f.isMri(e)||!C.default.CallNavigationHelper.isOutgoingCallingAllowed(e))return void B.log(k.LogTraceArea.QuickCallPanel,"_startCallToMri, calling not allowed, causeId: "+i);const a=O.default.getContactByCorrespondingMri(e);_.default.startCallOrMaybePrompt(t,this._getRootViewId(),{skypeMri:e,phones:a?a.phones:void 0,inviteOrigin:k.ContactInviteOrigin.CallPanelSearch,callOrigin:o,userIntent:S.StartCallOrMaybePromptUserIntent.Generic},i)}_handleAddressBookContactClick(e,t){const i=O.default.getContactById(t);i&&i.phones&&_.default.showForAddressContact(e,this._getRootViewId(),i.getDisplayName(),k.ContactInviteOrigin.CallPanelSearch,k.NavigationCallOrigin.QuickCallPanelCall,i.phones,i.emails)}_addUserToExistingCall(e,t){if(B.log(k.LogTraceArea.QuickCallPanel,"_addUserToExistingCall causeId: "+t),!this.props.callId)return;if(!this.state.conversationMemberMris||0===this.state.conversationMemberMris.length)return;const i=f.sanitizeMri(e,f.Namespaces.SkypeId);C.default.CallParticipantUtils.addUsersToCallOrRing([i],this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||k.NavigationAddToCallOrigin.Unknown),this._onPressClose()}_removeEntryFromMriToPhoneMap(e){const t=f.isPhoneMri(e)?he.default.getConversationOwnerNoSubscription(e):e;return t&&this.state.mriToPhoneMriMap.delete(t),t}_addOrRemoveUserSelection(e,t){B.log(k.LogTraceArea.QuickCallPanel,"_addOrRemoveUserSelection causeId: "+t);const i=n.without(this.state.selectedMris,e);i.length===(this.state.selectedMris?this.state.selectedMris.length:0)&&i.push(e),this.setState({selectedMris:i})}_shouldCollapseHeader(){return this.state.useMobileOrTabletUI&&this.props.searchOnly}_expandOrCollapseHeader(e,t=!0){this._headerExpanded!==e&&(this._searchHeader&&this._searchHeader.setExpandedValue(e?1:0,t),this._headerExpanded=e)}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const o=this._getRootViewId(),a=this._headerHeight(e),n=t?0:-1*a,s=t?a+T.default.collapsableHeight(o):T.default.expandedHeight(o)+e.statusBarPadding;i?l.Animated.parallel([l.Animated.timing(this._headerAnimatedTopValue,{toValue:n,duration:200,easing:l.Animated.Easing.Out()}),l.Animated.timing(this._headerAnimatedHeightValue,{toValue:s,duration:200,easing:l.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(n),this._headerAnimatedHeightValue.setValue(s))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?ne.HeaderHeightSmall:ne.HeaderHeight:e.isSmallDevice?ne.HeaderHeightLandscapeSmall:ne.HeaderHeightLandscape)+e.statusBarPadding}_setAnimatedValues(e,t){if(this._wrappedTransitionView){const i=l.Styles.createAnimatedViewStyle({transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[90,0,0]})}]});this._wrappedTransitionView.setAnimatedStyle(i)}}_clearAnimatedValues(){this._wrappedTransitionView&&this._wrappedTransitionView.setAnimatedStyle(this._resetTransitionStyle)}_shouldShowDialPadBar(e){return n.some(e,(e=>e.groupType===k.SearchResultsListGroup.PstnDialpad))&&!this._isPresentedInDesktopLeftNav()&&!0}_isUsedDuringCall(){return!!this.props.callId}static _menuItemTitle(e){switch(e){case W.QuickCallPanelFilter.All:return N.getString("QuickCallPanel.AllFilter");case W.QuickCallPanelFilter.Skype:return N.getString("QuickCallPanel.SkypeFilter");case W.QuickCallPanelFilter.Phone:return N.getString("QuickCallPanel.PhoneFilter")}return""}static _menuItemCommand(e){switch(e){case W.QuickCallPanelFilter.All:return W.QuickCallPanelMenuItemCommand.all;case W.QuickCallPanelFilter.Skype:return W.QuickCallPanelMenuItemCommand.skype;case W.QuickCallPanelFilter.Phone:return W.QuickCallPanelMenuItemCommand.phone}return""}static _filterForCommand(e){switch(e){case W.QuickCallPanelMenuItemCommand.all:return W.QuickCallPanelFilter.All;case W.QuickCallPanelMenuItemCommand.skype:return W.QuickCallPanelFilter.Skype;case W.QuickCallPanelMenuItemCommand.phone:return W.QuickCallPanelFilter.Phone}}}t.default=Me},634859:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RaiseHandImageType=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importStar(i(317588)),l=i(26703);var c;!function(e){e[e.MediumSizeCenterAligned=0]="MediumSizeCenterAligned",e[e.SmallSizeTopLeftAligned=1]="SmallSizeTopLeftAligned"}(c||(t.RaiseHandImageType=c={}));const d=(0,l.lazyProperties)({raiseHandIcon20:()=>n.Styles.createImageStyle({height:20,width:20,position:"absolute",top:2,left:0}),raiseHandIcon32:()=>n.Styles.createImageStyle({height:30,width:32,alignSelf:"center",marginBottom:8})});class u extends s.ComponentBase{render(){const e=this._getStyle(),t=this._getSource();return(0,a.jsx)(n.Image,{style:e,resizeMode:"contain",source:t})}_getStyle(){switch(this.props.type){case c.MediumSizeCenterAligned:return d.raiseHandIcon32;case c.SmallSizeTopLeftAligned:return d.raiseHandIcon20}}_getSource(){switch(this.props.type){case c.MediumSizeCenterAligned:return r.Collection.RAISE_HAND_MEDIUM;case c.SmallSizeTopLeftAligned:return r.Collection.RAISE_HAND_SMALL}}}t.default=u},663627:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(217041),l=o.__importDefault(i(150343)),c=o.__importDefault(i(369347)),d=o.__importDefault(i(60433)),u=o.__importDefault(i(306794)),h=i(460515),p=o.__importStar(i(132680)),g=o.__importStar(i(44717)),C=o.__importDefault(i(601976)),m=i(815146),S=o.__importDefault(i(945302)),_=o.__importDefault(i(524526)),f=o.__importStar(i(85385)),y=i(26703),T=o.__importDefault(i(363091)),b=o.__importDefault(i(629897)),v=o.__importDefault(i(597285)),I=o.__importStar(i(437782)),w=i(331079),P=o.__importDefault(i(827361)),M=o.__importDefault(i(601274)),D=(0,y.lazyProperties)({container:()=>s.Styles.createViewStyle({flex:1,overflow:"visible"}),fullScreenView:()=>P.default.absoluteFill,eventsContainer:()=>s.Styles.createViewStyle({paddingBottom:20,overflow:"visible"}),mobileEventsContainerWithCallControls:()=>s.Styles.createViewStyle({paddingBottom:75}),streamContainer:()=>s.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"})});class A extends r.ComponentBase{constructor(){super(...arguments),this._subscriptions=[],this._onSelectSceneResponseFailedEvent=e=>{if(this._eventStream){const t=this._getAudienceBotMri(this.props.callId);n.isUndefined(t)||this._eventStream.participantEvent(t,e)}},this._onSceneChangedEvent=(e,t)=>{this._eventStream&&this._eventStream.participantEvent(t,h.ParticipantEventType.TogetherModeBackgroundChanged)},this._onEventStreamRef=e=>{this._eventStream=e||void 0},this._onPhotoEventStreamRef=e=>{this._photoEventStream=e||void 0}}_buildState(e,t){t&&(this._subscriptions.push(c.default.AudienceBotService.selectSceneResponseFailedEvent(e.callId).subscribe(this._onSelectSceneResponseFailedEvent)),this._subscriptions.push(c.default.AudienceBotService.sceneChangedEvent(e.callId).subscribe(this._onSceneChangedEvent)));const{enableNotifyUsersMuteKick:i}=l.default.getS4LCMCFeatures(),o=[],a=[],s=_.default.getNonVisibleInCallBotMris(),r=_.default.getNonInteractiveInCallBotMris(),d=[];n.each(c.default.CallingStore.getRemoteCallMembers(e.callId),(t=>{const i=c.default.CallingStore.getRemoteCallMemberMri(e.callId,t);p.default.shouldRenderConnectedParticipantInEventStream(t,i,r)?o.push(i):p.default.shouldRenderRingingParticipantInEventStream(t,i,s)&&a.push(i)})),c.default.CallingStore.getParticipantsWithRaisedHands(e.callId).map((e=>{const t=n.concat(o,[T.default.getSkypeMri()]);n.find(t,(t=>t===e.id))&&d.push(e.id)}));const h=u.default.hasPostedReactions(e.callId);let g;if(!t&&this._reactionsInteropMessageAllowed()&&h&&!this.state.hasPostedReactions){const t=c.default.CallingStore.getRemoteMembersNotSupportingCallingReactions(e.callId);t&&(g=p.default.getFeatureUnsupportedParticipantsInfo(e.callId,t,e.conversationMri))}const C=t?Date.now():this.state.callEntryTime,m=n.last(u.default.getPictureReactions(e.callId,C)),S=this._photoInfoForMessage(m,e.conversationMri),f=u.default.getEventsReaction(e.callId,C),y={callParticipantMris:o,ringingParticipantMris:a,reactionsMessageInfo:g,hasPostedReactions:h,lastPhotoInfo:S,eventReactions:f,enableNotifyUsersMuteKick:i,handRaisedMris:d};return t&&(y.suppressParticipantEvents=!0,y.callEntryTime=C),y}componentWillUnmount(){super.componentWillUnmount(),this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[]}_getAudienceBotMri(e){const t=_.default.getCallAudienceBotMri(),i=_.default.getCallAudienceBotMriFilter();return c.default.InCallBotService.findActualBotMri(e,t,i)}_reactionsInteropMessageAllowed(){return g.isThread(this.props.conversationMri)||g.isSkypeIdMri(this.props.conversationMri)}_photoInfoForMessage(e,t){return e?{message:e,user:C.default.getMemberShortNameForConversation(t,e.creator)}:void 0}_identifyParticipantChange(e,t){if(this.state.suppressParticipantEvents||g.isOneOnOneConversation(this.props.conversationMri))return;const i=n.difference(e,t),o=n.difference(t,e);o.length&&this._onJoin(o),i.length&&this._onLeave(i)}_identifyParticipantRaiseHandChange(e,t){const i=n.difference(t,e);i.length&&this._onRaised(i)}_identifyParticipantRingingChange(e,t){if(this.state.suppressParticipantEvents)return;const i=n.difference(e,t);(n.difference(t,e).length||i.length)&&this._onParticipantsRinging(t),i.length&&this._onStopRinging(i)}_onJoin(e){n.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,h.ParticipantEventType.Join)}))}_onRaised(e){n.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,h.ParticipantEventType.HandRaised)}))}_onLeave(e){n.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,h.ParticipantEventType.Leave)}))}_onMuted(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,h.ParticipantEventType.Muted)}_onKickedOut(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,h.ParticipantEventType.KickedOut)}_onStopRinging(e){n.each(e,((t,i)=>{if(this._eventStream){const i=c.default.CallingStore.findRemoteCallMember(this.props.callId,t);d.default.isParticipantConnected(i)||d.default.isParticipantInCanStreamMediaState(i)||this._eventStream.participantEvent(t,this._getStopRingingEventType(e))}}))}_getStopRingingEventType(e){return e.length&&n.intersection(c.default.InCallBotMriUtils.getCallFullscreenBotMris(),e).length?h.ParticipantEventType.BotUnavailable:h.ParticipantEventType.Unavailable}_onParticipantsRinging(e){this._eventStream&&this._eventStream.participantsRingingEvent(e)}componentDidMount(){super.componentDidMount(),g.isOneOnOneConversation(this.props.conversationMri)?M.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})}),3e3):M.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})}),1e4)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._identifyParticipantRingingChange(t.ringingParticipantMris,this.state.ringingParticipantMris),this._identifyParticipantChange(t.callParticipantMris,this.state.callParticipantMris),this._identifyParticipantRaiseHandChange(t.handRaisedMris,this.state.handRaisedMris),this.state.reactionsMessageInfo&&!t.reactionsMessageInfo){const e=this.state.reactionsMessageInfo.count;if(0===e)return;f.log(m.LogTraceArea.CallReactions,"ReactionsPanel.componentDidUpdate: reactionsMessageInfo,  count: "+e+" firstUser: "+(I.mriOrId(this.state.reactionsMessageInfo.firstUser)||"none")+" secondUser: "+(I.mriOrId(this.state.reactionsMessageInfo.secondUser)||"none"));const t=p.default.getFeatureUnsupportedMessage(this.state.reactionsMessageInfo,p.UnsupportedFeature.CallReactions);t&&this._eventStream&&this._eventStream.textEvent(t)}if(this._photoEventStream&&this.state.lastPhotoInfo){this.state.lastPhotoInfo.message.cuid!==(t.lastPhotoInfo?t.lastPhotoInfo.message.cuid:void 0)&&this._photoEventStream.photoEvent(this.state.lastPhotoInfo.message,this.state.lastPhotoInfo.message.creator)}if(this.state.enableNotifyUsersMuteKick&&this.state.eventReactions){const e=n.last(this.state.eventReactions),i=n.last(t.eventReactions);(e?e.cuid:void 0)!==(i?i.cuid:void 0)&&this.state.eventReactions.forEach((e=>{const t=v.default.parseCallEventReaction(e);t&&(t.eventType===w.ReactionsTextType.CallEventMuted?this._onMuted(t):t.eventType===w.ReactionsTextType.CallEventKickedOut&&this._onKickedOut(t))}))}}render(){const e=[D.fullScreenView,D.eventsContainer,this.props.bottomStyle];return this.props.areMobileCallControlsVisible&&e.push(D.mobileEventsContainerWithCallControls),this.props.style&&e.push(this.props.style),(0,a.jsxs)(s.View,{style:D.container,ignorePointerEvents:!0,children:[(0,a.jsx)(s.Animated.View,{style:e,ignorePointerEvents:!0,blockPointerEvents:!0,children:(0,a.jsx)(S.default,{style:D.streamContainer,ref:this._onEventStreamRef})}),(0,a.jsx)(b.default,{style:D.fullScreenView,ref:this._onPhotoEventStreamRef,isDesktop:this.props.isDesktop,bottomMargin:this.props.desktopBottomMargin,desktopSideMargin:this.props.desktopSideMargin,sizePhotosToFit:this.props.sizePhotosToFit,photoTapDelay:this.props.photoTapDelay,onPhotoTap:this.props.onPhotoTap,onPhotoDismissed:this.props.onPhotoDismissed,reactionsConversationMri:this.props.reactionsConversationMri,callId:this.props.callId})]})}}t.default=A},293556:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BeingRecordedNotifyView=void 0;const o=i(197582),a=i(785893),n=i(537180),s=o.__importStar(i(704704)),r=i(272792),l=i(827856),c=i(601910),d={display:"initial"};t.BeingRecordedNotifyView=({elapsedTime:e,initiatorDisplayName:t})=>{const{textStyle:i}=(0,r.useTextStyles)(),o=(0,a.jsx)(n.Text,{style:i,allowFontScaling:!1,children:`${(0,l.getRecordingTimeStampString)(e)} ${s.getParts("CallRecorderToast.StartedRecordingNotification1st",{initiator:t})}`}),u=(0,a.jsx)(n.Text,{style:i,allowFontScaling:!1,children:s.getParts("CallRecorderToast.StartedRecordingNotification2nd",{learnMoreLink:(0,a.jsx)(c.BannerViewButton,{buttonStyles:d,buttonBackgroundStyles:{paddingLeft:0,paddingRight:0,borderRadius:0},title:s.getString("CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText"),onPress:l.onClickMorePrivacyLink})})});return(0,a.jsxs)(n.View,{children:[o,u]})}},535388:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BeingRecordedView=void 0;const o=i(197582),a=i(785893),n=i(537180),s=o.__importStar(i(704704)),r=i(272792),l=i(827856);t.BeingRecordedView=({elapsedTime:e,initiatorDisplayName:t})=>{const{textStyle:i}=(0,r.useTextStyles)();return(0,a.jsx)(n.Text,{style:i,allowFontScaling:!1,children:`${(0,l.getRecordingTimeStampString)(e)} ${s.getParts("CallRecorderToast.StartRecordingInformation",{initiator:t})}`})}},286687:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InRecordingView=void 0;const o=i(197582),a=i(785893),n=i(537180),s=o.__importStar(i(704704)),r=i(272792),l=i(601910),c=i(827856),d=n.StyleSheet.create({textContainer:{flexDirection:"row"}});t.InRecordingView=({elapsedTime:e,onStopRecording:t})=>{const{textStyle:i}=(0,r.useTextStyles)(),o=(0,a.jsx)(n.Text,{style:i,allowFontScaling:!1,children:(0,c.getRecordingTimeStampString)(e)});return(0,a.jsxs)(n.View,{style:d.textContainer,children:[o,(0,a.jsx)(l.BannerViewButton,{buttonBackgroundStyles:{paddingLeft:5,paddingRight:5,borderRadius:0},onPress:t,title:s.getString("CallRecorderToast.StopRecordingLinkText")})]})}},287289:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PrepareRecordingView=void 0;const o=i(197582),a=i(785893),n=i(537180),s=o.__importStar(i(704704)),r=i(272792);t.PrepareRecordingView=()=>{const{textStyle:e}=(0,r.useTextStyles)();return(0,a.jsx)(n.Text,{style:e,children:s.getString("CallRecorderToast.StartingRecordingText")})}},827856:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRecordingTimeStampString=t.onClickMorePrivacyLink=void 0;const o=i(197582),a=o.__importStar(i(516778)),n=o.__importDefault(i(150343)),s=o.__importDefault(i(389659));t.onClickMorePrivacyLink=()=>a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies);t.getRecordingTimeStampString=e=>s.default.getElapsedTimeStringFromMs(e)},260718:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(667294),s=i(287289),r=i(691723),l=i(764611),c=i(286687),d=i(293556),u=i(535388),h=i(526849),p=o.__importDefault(i(369347)),g=o.__importDefault(i(601976)),C=o.__importDefault(i(760989)),m=o.__importDefault(i(601274)),S=o.__importDefault(i(389659)),_=o.__importStar(i(840709)),f=i(641400),y=o.__importDefault(i(132680));t.default=(0,h.WithResub)((({callId:e,initiatorDisplayName:t,initiatorMri:i,isLocalInitiator:o,isRecording:h,isTriggeredFromHeader:p,onStopRecording:g,recordingStartTime:C,shouldShowNewRecordingStatusView:T})=>{const[b,v]=(0,n.useState)(Date.now()),[I,w]=(0,n.useState)(void 0),P=(0,n.useCallback)(((e,t)=>{let i=0;if(t){i=e-S.default.getUnixMillisecondsTimestamp(t),i<0&&(i=0)}return i}),[]);(0,n.useEffect)((()=>{if(h){const e=m.default.setInterval((()=>{v(Date.now())}),1e3);w(e)}y.default.announceScreenRecordingState(h)}),[h]),(0,n.useEffect)((()=>{h||(I&&m.default.clearInterval(I),w(void 0),_.default.setCallRecordingViewShowStatus(_.RecordingViewShowStatus.TriggeredByDefault,e))}),[e,h,I]);if(!(T&&h))return null;let M=(0,a.jsx)(s.PrepareRecordingView,{});return i&&(M=o?p?(0,a.jsx)(c.InRecordingView,{elapsedTime:P(b,C),onStopRecording:g}):(0,a.jsx)(r.StartRecordingView,{elapsedTime:P(b,C),onStopRecording:g}):p?(0,a.jsx)(u.BeingRecordedView,{elapsedTime:P(b,C),initiatorDisplayName:t}):(0,a.jsx)(d.BeingRecordedNotifyView,{elapsedTime:P(b,C),initiatorDisplayName:t})),(0,a.jsx)(l.PopupBanner,{onDismissPopup:()=>{_.default.setCallRecordingViewShowStatus(_.RecordingViewShowStatus.Dismissed,e)},icon:f.SkypeIcon.CallRecord,children:M})}),(e=>{const{callId:t,conversationMri:i}=e,o=p.default.CallingStore.getCallRecordingInitiator(t),a=p.default.InCallBotUtils.isCallRecordingInitiator(o),n=o?g.default.getMemberShortNameForConversation(i,o):void 0,s=p.default.CallingStore.getCallRecordingTimestamp(t),r=p.default.CallingStore.isRecording(t),l=_.default.getCallRecordingViewShowStatus(t),c=l===_.RecordingViewShowStatus.TriggeredFromHeader,d=l!==_.RecordingViewShowStatus.Dismissed;return Object.assign(Object.assign({},e),{initiatorDisplayName:n,initiatorMri:o,isLocalInitiator:a,isRecording:r,isTriggeredFromHeader:c,onStopRecording:()=>{const e=C.default.newCauseId();p.default.InCallBotService.stopRecording(t,e)},recordingStartTime:s,shouldShowNewRecordingStatusView:d})}))},691723:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartRecordingView=void 0;const o=i(197582),a=i(785893),n=i(537180),s=o.__importStar(i(704704)),r=i(272792),l=i(601910),c=i(827856),d=n.StyleSheet.create({buttonGroup:{flexDirection:"row",flexWrap:"wrap"}});t.StartRecordingView=({elapsedTime:e,onStopRecording:t})=>{const{textStyle:i}=(0,r.useTextStyles)();return(0,a.jsxs)(n.View,{children:[(0,a.jsx)(n.Text,{style:i,allowFontScaling:!1,numberOfLines:2,children:`${(0,c.getRecordingTimeStampString)(e)} ${s.getParts("CallRecorderToast.PrivacyStatementText",{learnMoreLink:""})}`}),(0,a.jsxs)(n.View,{style:d.buttonGroup,children:[(0,a.jsx)(l.BannerViewButton,{buttonBackgroundStyles:r.buttonBackgroundStyles,onPress:t,title:s.getString("CallRecorderToast.StopRecordingLinkText")}),(0,a.jsx)(l.BannerViewButton,{buttonBackgroundStyles:r.buttonBackgroundStyles,onPress:c.onClickMorePrivacyLink,title:s.getString("CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText")})]})]})}},85754:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentRinglessCallInterstitial=function(e,t){f.log(S.LogTraceArea.CallingUI,"RinglessCallInterstitial maybePresentRinglessCallInterstitial, causeId: "+e.causeId);const i=(0,a.jsx)(B,{dialogId:x,conversationMri:e.conversationMri,withVideo:e.withVideo,origin:e.origin,isLargeGroup:e.isLargeGroup,causeId:e.causeId});p.default.showModal(i,x,t)};const o=i(197582),a=i(785893),n=i(331654),s=o.__importStar(i(516778)),r=o.__importStar(i(317588)),l=o.__importDefault(i(808467)),c=o.__importDefault(i(369347)),d=o.__importStar(i(873324)),u=o.__importDefault(i(638260)),h=o.__importDefault(i(340724)),p=o.__importDefault(i(266311)),g=i(154235),C=o.__importStar(i(761393)),m=o.__importStar(i(170881)),S=i(815146),_=o.__importDefault(i(453761)),f=o.__importStar(i(85385)),y=i(26703),T=o.__importStar(i(704704)),b=o.__importDefault(i(960282)),v=o.__importDefault(i(117475)),I=o.__importDefault(i(377556)),w=o.__importDefault(i(525864)),P=o.__importDefault(i(660401)),M=i(16549),D=i(641400),A=o.__importStar(i(179582)),k=i(262725),R=o.__importStar(i(128249)),x="RinglessCallInterstitial",L=(0,y.lazyProperties)({dialog:()=>s.Styles.createViewStyle({flex:1,justifyContent:"center"}),dialogHeaderContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"space-between"}),closeButton:()=>s.Styles.createViewStyle({paddingLeft:15,paddingRight:15}),footer:()=>s.Styles.createViewStyle({height:60,alignSelf:"center"}),footerLandscape:()=>s.Styles.createViewStyle({height:50,alignSelf:"center"}),footerButton:()=>s.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",alignItems:"center",marginTop:10}),interstitialImage:()=>s.Styles.createImageStyle({height:120,width:360,alignSelf:"center",marginTop:5}),message:()=>s.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:10,marginHorizontal:30,backgroundColor:M.Color.transparent})});class B extends l.default{constructor(){super(...arguments),this._closeButtonPressed=()=>{f.log(S.LogTraceArea.CallNavigation,"RinglessCallInterstitial._closeButtonPressed causeId: "+this.props.causeId),u.default.trackRinglessCallInterstitial(d.RinglessCallInterstitialActions.Cancel,this.props.isLargeGroup),p.default.dismissModal(this.props.dialogId,this._getRootViewId())},this._onButtonPressed=()=>{f.log(S.LogTraceArea.CallNavigation,"RinglessCallInterstitial._onButtonPressed causeId: "+this.props.causeId),u.default.trackRinglessCallInterstitial(d.RinglessCallInterstitialActions.ContinueWithCall,this.props.isLargeGroup),c.default.CallNavigationHelper.startCall({conversationMri:this.props.conversationMri,withVideo:this.props.withVideo,origin:this.props.origin},this.props.causeId)}}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:!this._getContext().isPresentedInDesktopSubview&&b.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape,isMobileScreenSize:b.default.isMobileScreenSize(i),statusBarHeight:v.default.leavePaddingForStatusBar()?v.default.statusBarHeight():0}}componentDidMount(){super.componentDidMount(),m.dismissAll()}componentWillUnmount(){super.componentWillUnmount(),f.log(S.LogTraceArea.CallingUI,"RinglessCallInterstitial componentWillUnmount")}render(){const e=this._renderCloseButton(),t=this._renderActionButton(),i=this.state.isMobileScreenSize?{maxWidth:void 0,maxHeight:void 0}:{maxWidth:C.CompactWidth,maxHeight:462},o=this._renderImage(),n=this._getTitleText(),r=this._getContentText(),l=h.default.combinedAccessibilityLabel(n,r);return(0,a.jsxs)(w.default,Object.assign({dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0},i,{maxWidth:this.state.isMobileScreenSize?void 0:C.DefaultWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:l,children:[(0,a.jsx)(R.default,{statusBarKey:"RinglessCall",barStyle:R.BarStyle.LIGHT_CONTENT,animated:!0}),(0,a.jsxs)(s.View,{style:L.dialog,children:[e,o,(0,a.jsx)(k.PanelHeader,{style:L.message,children:n}),(0,a.jsx)(k.BodyText,{style:L.message,children:r}),t]})]}))}_getHeaderTopMargin(){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderCloseButton(){const e=[L.dialogHeaderContainer],t=this._getHeaderTopMargin();return t&&e.push(I.default.marginTopStyle(t)),(0,a.jsx)(s.View,{style:e,children:(0,a.jsx)(_.default,{style:L.closeButton,icon:A.closeIcon(),size:D.IconSize.size24,title:T.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor})})}_renderActionButton(){return(0,a.jsx)(s.View,{style:this.state.isLandscape?L.footerLandscape:L.footer,children:(0,a.jsx)(P.default,{buttonSize:g.SXButtonSize.Medium,buttonStyle:g.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:M.AgnosticGradientFillButtonColors.blue,style:L.footerButton,allowTextWrap:!0,title:T.getString("CallPanel.GroupCallRingLessContinueToCallButtonTitle"),onPress:this._onButtonPressed,autoFocus:!1})})}_renderImage(){const e=this.props.isLargeGroup?r.Collection.RINGLESS_CALL_LARGE_GROUP:r.Collection.RINGLESS_CALL_SMALL_GROUP;return(0,a.jsx)(s.Image,{source:e,style:L.interstitialImage})}_getTitleText(){return this.props.isLargeGroup?T.getString("CallPanel.GroupCallRinglessLargeGroup"):T.getString("CallPanel.GroupCallRinglessSmallGroup")}_getHeaderText(e){return this._getTitleText()}_getContentText(){return this.props.isLargeGroup?T.getString("CallPanel.GroupCallRinglessLargeGroupExplanation"):T.getString("CallPanel.GroupCallRinglessSmallGroupExplanation")}}t.default=B},401845:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(20758)),l=i(16549),c=i(26703),d=o.__importStar(i(704704)),u=(0,c.lazyProperties)({controlItem:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:l.Color.black,marginBottom:7}),controlItemText:()=>n.Styles.createTextStyle({textAlign:"center",color:l.Color.white}),controlItemTextActive:()=>n.Styles.createTextStyle({fontSize:r.default.controlFontSize.screenShareZoomControlActiveItem}),controlItemTextNonActive:()=>n.Styles.createTextStyle({fontSize:r.default.controlFontSize.screenShareZoomControlNonActiveItem})});class h extends s.ComponentBase{constructor(){super(...arguments),this._onReactionButtonRef=e=>{this._reactionButton=e||void 0}}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}render(){const e=[u.controlItem,...this.props.styles],t=[u.controlItemText,this.props.isActive?u.controlItemTextActive:u.controlItemTextNonActive];return(0,a.jsx)(n.Button,{style:e,onPress:this.props.onClick,ref:this._onReactionButtonRef,accessibilityLabel:d.getString("CallControls.ScreenShareZoomControlsZoomButtonAnnouncement",{zoomLevel:this.props.zoomLevelText}),children:(0,a.jsx)(n.Text,{style:t,children:this.props.textToShow})})}}t.default=h},18983:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=i(26703),l=i(16549),c=i(789352),d=o.__importDefault(i(401845)),u=o.__importDefault(i(631681)),h=i(315742),p=o.__importStar(i(704704)),g=o.__importDefault(i(453761)),C=i(641400),m=o.__importDefault(i(924849)),S=i(815146),_=o.__importDefault(i(139221)),f="item_",y=(0,r.lazyProperties)({controlsContainer:()=>n.Styles.createViewStyle({width:36,minHeight:36,borderRadius:18,borderWidth:2,position:"absolute",bottom:15,right:15,alignItems:"center",justifyContent:"center",borderColor:l.Color.black,backgroundColor:l.Color.white}),controlsContainerOpened:()=>n.Styles.createViewStyle({paddingTop:3}),controlsMenuWrapper:()=>n.Styles.createViewStyle({alignItems:"center",height:30,overflow:"hidden"}),controlsMenuInnerWrapper:()=>n.Styles.createViewStyle({alignItems:"center"}),controlsClosedButtonWrapper:()=>n.Styles.createViewStyle({width:30,height:30,position:"absolute",backgroundColor:l.Color.white}),controlsClosedButton:()=>n.Styles.createViewStyle({width:30,height:30,alignItems:"center",justifyContent:"center"}),controlsClosedButtonText:()=>n.Styles.createTextStyle({fontSize:15}),closeControlsIcon:()=>n.Styles.createViewStyle({width:22,height:22,borderRadius:11,backgroundColor:l.Color.black,marginBottom:3}),activeItem:()=>n.Styles.createViewStyle({width:c.zoomDrawerValues.activeItemSize,height:c.zoomDrawerValues.activeItemSize,borderRadius:14}),notActiveItem:()=>n.Styles.createViewStyle({width:c.zoomDrawerValues.nonActiveItemSize,height:c.zoomDrawerValues.nonActiveItemSize,borderRadius:11}),lastItemMargin:()=>n.Styles.createViewStyle({marginBottom:c.zoomDrawerValues.lastItemMargin})});class T extends s.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new m.default,this._animatedHeightValue=new n.Animated.Value(c.zoomDrawerValues.minHeight),this._animatedOpacityValue=new n.Animated.Value(c.zoomDrawerValues.minOpacity),this._animatedContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onMenuCloseButtonRef=e=>{this._menuClosedButtonRef=e||void 0},this._handleOpenMenu=()=>{this.setState({shouldDrawerBeOpened:!0,isDrawerOpened:!0,menuOpenedWithKeyboard:this.props.isNavigatingWithKeyboard})},this._handleCloseMenu=()=>{this.setState({shouldDrawerBeOpened:!1,menuOpenedWithKeyboard:!1})}}_buildState(e,t){const i={};return t&&(i.shouldDrawerBeOpened=!1,i.isDrawerOpened=!1,i.menuOpenedWithKeyboard=!1),i}componentWillUnmount(){super.componentWillUnmount(),this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.shouldDrawerBeOpened!==t.shouldDrawerBeOpened&&this._positionControlsDrawer(),this.state.isDrawerOpened!==t.isDrawerOpened){const e=this.state.isDrawerOpened?this._mountedRefsMap.ref(f+0):this._menuClosedButtonRef;e&&e.requestFocus()}}render(){const{isDrawerOpened:e,menuOpenedWithKeyboard:t}=this.state,{currentZoomLevel:i,isNavigatingWithKeyboard:o}=this.props,s=c.zoomUiSizesText.length-1,r=[y.controlsMenuWrapper,this._animatedContainerStyle],l=[y.controlsMenuInnerWrapper,this._animatedInnerContainerStyle],d=_.default.getPlatformType()===S.PlatformType.OSX?p.getString("CallControls.ScreenShareZoomCoachMarkMacLabel"):p.getString("CallControls.ScreenShareZoomCoachMarkDefaultLabel");return(0,a.jsx)(u.default.View,{coachMarkType:h.CoachMarkType.ScreenShareZoomControl,anchorAccessibilityLabel:d,positions:[h.PopupAnchorPositon.Left,h.PopupAnchorPositon.Bottom],onMouseEnter:this._handleOpenMenu,onMouseLeave:this._handleCloseMenu,widthOverride:c.zoomDrawerValues.coachMarkWidth,style:[y.controlsContainer,e?y.controlsContainerOpened:void 0],children:e?(0,a.jsx)(n.Animated.View,{style:r,children:(0,a.jsxs)(n.Animated.View,{style:l,children:[this._renderZoomLevelButtons(s,i),t&&this._renderDrawerCloseButton()]})}):(0,a.jsx)(n.Animated.View,{style:y.controlsClosedButtonWrapper,children:(0,a.jsx)(n.Button,{accessibilityLabel:p.getString("CallControls.ScreenShareZoomControlsOpenButtonAnnouncement"),ref:this._onMenuCloseButtonRef,onPress:o?this._handleOpenMenu:void 0,style:y.controlsClosedButton,children:(0,a.jsx)(n.Text,{style:y.controlsClosedButtonText,children:c.zoomUiSizesText[s-i]+"x"})})})})}_renderDrawerCloseButton(){return(0,a.jsx)(g.default,{icon:C.SkypeIcon.DownChevron,size:C.IconSize.size16,color:l.Color.white,accessibilityLabel:p.getString("CallControls.ScreenShareZoomControlsCloseButtonAnnouncement"),style:y.closeControlsIcon,onPress:this._handleCloseMenu})}_renderZoomLevelButtons(e,t){return c.zoomUiSizesText.map(((i,o)=>{const n=e-o,s=o===e,r=!this.state.menuOpenedWithKeyboard&&s,l=n===t,c=[l?y.activeItem:y.notActiveItem,r?y.lastItemMargin:void 0];return(0,a.jsx)(d.default,{zoomLevelText:i,textToShow:s?i+"x":i,ref:this._mountedRefsMap.onComponentRef(f+o),styles:c,isActive:l,onClick:()=>this._setZoomLevel(n)},i)}))}_positionControlsDrawer(){const{shouldDrawerBeOpened:e}=this.state,t=e?this._getDrawerHeight(this.state.menuOpenedWithKeyboard):c.zoomDrawerValues.minHeight,i=e?c.zoomDrawerValues.maxOpacity:c.zoomDrawerValues.minOpacity;if(!this._animatedHeightValue||!this._animatedOpacityValue)return;const o=n.Animated.timing(this._animatedHeightValue,{toValue:t,easing:n.Animated.Easing.Linear(),duration:e?c.zoomDrawerValues.openDuration:c.zoomDrawerValues.closeDuration}),a=n.Animated.timing(this._animatedOpacityValue,{toValue:i,easing:n.Animated.Easing.Linear(),duration:e?c.zoomDrawerValues.openDuration:c.zoomDrawerValues.closeDuration});let s,r;e?(s=o,r=a):(s=a,r=o),this._drawerAnimation=s,this._drawerAnimation.start((()=>{this._drawerAnimation=r,this._drawerAnimation.start((()=>{this._onPositionDrawerAnimationCompleted()}))}))}_onPositionDrawerAnimationCompleted(){const{shouldDrawerBeOpened:e}=this.state;e||this.setState({isDrawerOpened:!1})}_getDrawerHeight(e){const t=c.zoomUiSizesText.length+(e?1:0);return(c.zoomDrawerValues.nonActiveItemSize+c.zoomDrawerValues.itemMargin)*(t-1)+(c.zoomDrawerValues.activeItemSize+c.zoomDrawerValues.lastItemMargin)}_setZoomLevel(e){this.props.currentZoomLevel!==e&&this.props.setZoomLevel(e)}}t.default=T},662046:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(148540),l=o.__importDefault(i(395298)),c=o.__importDefault(i(369347)),d=i(843890),u=i(154235),h=o.__importDefault(i(186325)),p=i(815146),g=o.__importDefault(i(453761)),C=o.__importStar(i(85385)),m=o.__importDefault(i(612285)),S=o.__importDefault(i(97595)),_=i(26703),f=o.__importStar(i(704704)),y=o.__importDefault(i(960282)),T=o.__importDefault(i(427845)),b=i(424220),v=o.__importDefault(i(273186)),I=i(79681),w=o.__importDefault(i(525864)),P=o.__importDefault(i(660401)),M=i(16549),D=o.__importDefault(i(20758)),A=i(641400),k=o.__importStar(i(179582)),R=i(331079),x=o.__importDefault(i(827361)),L=i(262725),B=o.__importDefault(i(497910)),V=o.__importDefault(i(601274)),O=M.Color.gray400,E=(0,_.lazyProperties)({panel:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:O}),modalContainerForAll:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",padding:20}),sourcesLists:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row",marginHorizontal:40,justifyContent:"flex-start",alignSelf:"center"}),screensSourcesList:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",flexWrap:"wrap"}),windowsSourcesList:()=>s.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center"}),title:()=>s.Styles.createViewStyle({marginBottom:30}),titleText:()=>s.Styles.createTextStyle({color:M.Color.white,fontSize:D.default.controlFontSize.cardTitle}),divider:()=>s.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),sourceListScreen:()=>s.Styles.createViewStyle({justifyContent:"flex-start"}),sourceListWindow:()=>s.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"flex-start"}),buttons:()=>s.Styles.createViewStyle({flexDirection:"row"}),button:()=>s.Styles.createViewStyle({marginHorizontal:10,marginTop:15,width:180}),modalAudioLabelContainer:()=>s.Styles.createViewStyle({paddingHorizontal:4,flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"stretch",marginTop:15}),includeAudioLabel:()=>s.Styles.createTextStyle({color:M.Color.white}),audioMargin:()=>s.Styles.createViewStyle({marginRight:10}),sectionHeader:()=>s.Styles.createTextStyle({color:M.Color.white,marginLeft:5,marginBottom:10}),closeButton:()=>s.Styles.createViewStyle({alignSelf:"flex-start",justifyContent:"center",height:50,paddingLeft:15,paddingRight:15})});class N extends B.default{constructor(){super(...arguments),this._onAudioToggleChange=(e,t)=>{e.stopPropagation(),C.log(p.LogTraceArea.CallingUI,"ScreenSharingPanel._onAudioToggleChange"),this.setState({includeAudio:t},(()=>{V.default.setTimeout((()=>{this.isComponentMounted()&&this._audioToggleRef&&this._audioToggleRef.focusToggle()}),100)}))},this._onEscape=()=>(C.log(p.LogTraceArea.CallingUI,"ScreenSharingPanel._onEscape"),this._onClose(b.ScreenSharingPanelCancelOrigin.Esc),!0),this._onAudioToggleRef=e=>{this._audioToggleRef=e||void 0},this._onClose=e=>{var t;this.props.onClose&&(C.track(new b.ScreenSharingPanelCancelEvent(e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onClose())},this._onSourceSelected=(e,t)=>{C.log(p.LogTraceArea.CallingUI,"ScreenSharingPanel: _onSourceSelected "+r.SharingSourceType[this.state.selectedSourcesType]),t&&this.state.isNavigatingWithKeyboard?this._shareScreen(b.ScreenSharingStartOrigin.EnterWithKeyboardNavigation):this.setState({selectedSource:e})},this._shareScreen=e=>{var t;this.state.selectedSource&&(C.track(new b.ScreenSharingPanelStartedSharingEvent(this.state.selectedSource.getType(),e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onSelectSource(this.state.selectedSource,this.state.includeAudio,this.state.selectedSource.getType()))}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());const i=d.CallingCapabilities.applicationSharingSupported(),o=y.default.getWidth(this._rootViewId),a=T.default.responsiveWidthForSize(o),s=c.default.DeviceStore.getAvailableScreens(),l=i?c.default.DeviceStore.getAvailableWindows():void 0;let u,h;t?(u=e.currentScreenSharingSource||n.first(s),h=e.currentScreenSharingSourceType||r.SharingSourceType.Monitor,c.default.DeviceStore.fetchAvailableWindows()):(u=this.state.selectedSource,h=this.state.selectedSourcesType),C.log(p.LogTraceArea.CallingUI,`created new state screensSourcesList ${s.length} windowSharingEnabled ${i}`),l&&C.log(p.LogTraceArea.CallingUI,`windowsSourcesList ${l.length}`);const g=!this._useDarkTheme(),S=this._useAccessibleTheme(),_=g||S;return{includeAudio:t?!!e.initialShareSounds:this.state.includeAudio,screensSourcesList:s,windowsSourcesList:l||[],hasWindowsSection:!!(null==l?void 0:l.length),appWidth:o,selectedSourcesType:h,selectedSource:u,screenSize:a,isNavigatingWithKeyboard:m.default.isNavigatingWithKeyboard(),useHighContrastTheme:S,useDefaultTheme:_}}componentDidMount(){super.componentDidMount(),S.default.addEscapeHandler(this._onEscape),this._windowsInterval=V.default.setInterval((()=>c.default.DeviceStore.fetchAvailableWindows()),1e3)}componentWillUnmount(){super.componentWillUnmount(),S.default.removeEscapeHandler(this._onEscape),V.default.clearInterval(this._windowsInterval),c.default.DeviceStore.clearAvailableWindows()}render(){const e=v.default.getWindowSourceItemDimensions(),t=this.state.appWidth<=650?e.width:this.state.screenSize<=R.ResponsiveWidth.Tiny?2*e.width:void 0,i=[E.windowsSourcesList,s.Styles.createViewStyle({maxWidth:t},!1)],o=[E.sectionHeader];this.state.useDefaultTheme&&o.push(this._themeStyles.primaryTextColorStyle);const n=this.state.hasWindowsSection&&[(0,a.jsx)(h.default,{style:E.divider,color:this.state.useDefaultTheme?this._themeColors.dividerColor:M.Color.gray200Overlay20,marginRight:25,marginLeft:18},"divider"),(0,a.jsxs)(s.View,{style:i,children:[(0,a.jsx)(L.RowTitle,{style:o,children:f.getString("ScreenSharingModal.WindowsSection")}),(0,a.jsx)(I.ScreenSharingSourceList,{style:E.sourceListWindow,sourcesList:this.state.windowsSourcesList,itemWidth:e.width,itemHeight:e.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:f.getString("ScreenSharingModal.WindowsSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme})]},"windowsList")],r=[E.titleText];this.state.useDefaultTheme&&r.push(this._themeStyles.primaryTextColorStyle);const l=v.default.getScreenSourceItemDimensions(this.state.screenSize,!this.state.hasWindowsSection,this.state.screensSourcesList.length),c=[E.screensSourcesList,s.Styles.createViewStyle({minWidth:l.width},!1)],u=d.CallingCapabilities.screenSharingWithSoundSupported(),p=(0,a.jsxs)(s.View,{style:E.modalContainerForAll,children:[(0,a.jsx)(s.View,{style:E.title,children:(0,a.jsx)(L.RowTitle,{style:r,children:f.getString("ScreenSharingModal.Title")})}),(0,a.jsxs)(s.View,{style:E.sourcesLists,children:[(0,a.jsxs)(s.View,{style:c,children:[(0,a.jsx)(L.RowTitle,{style:o,children:f.getString("ScreenSharingModal.ScreensSection")}),(0,a.jsx)(I.ScreenSharingSourceList,{style:this.state.hasWindowsSection?E.sourceListScreen:E.sourceListWindow,sourcesList:this.state.screensSourcesList,itemWidth:l.width,itemHeight:l.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:f.getString("ScreenSharingModal.ScreensSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme})]}),n]}),d.CallingCapabilities.screenSharingWithSoundSupported()&&this._getAudioToggle(),(0,a.jsxs)(s.View,{style:this.state.screenSize>R.ResponsiveWidth.MinDesktop?E.buttons:void 0,children:[this._getCancelButton(),this._getStartSharingButton()]})]}),g=[E.panel];return this.state.useDefaultTheme&&g.push(this._themeStyles.primaryBackgroundColorStyle),(0,a.jsx)(w.default,{dialogId:"screenShare",onClickOutside:()=>this._onClose(b.ScreenSharingPanelCancelOrigin.ClickOutside),maxWidth:v.default.getModalWidth(this.state.screenSize,this.state.screensSourcesList.length,this.state.windowsSourcesList.length),maxHeight:v.default.getModalHeigh(this.state.screensSourcesList.length,this.state.windowsSourcesList.length,u),fullScreen:this.state.screenSize<=R.ResponsiveWidth.Tiny,useFullSizeContainer:!0,children:(0,a.jsxs)(s.View,{style:g,children:[this.state.screenSize<=R.ResponsiveWidth.Tiny&&this._getBackButton(),p]})})}_getBackButton(){return(0,a.jsx)(g.default,{style:E.closeButton,icon:k.closeIcon(),size:A.IconSize.size24,title:f.getString("Global.CloseButtonTitle"),onPress:()=>this._onClose(b.ScreenSharingPanelCancelOrigin.BackButton),color:M.Color.white,hoverColor:M.Color.whiteOverlay70})}_getAudioToggle(){const e=(0,a.jsx)(l.default,{ref:this._onAudioToggleRef,isOn:this.state.includeAudio,accessibilityLabel:f.getString("ScreenSharingModal.IncludeAudioToggleAccessibilityLabel"),onChange:this._onAudioToggleChange,style:x.default.alignItemsCenter}),t=[E.includeAudioLabel];this.state.useDefaultTheme&&t.push(this._themeStyles.primaryTextColorStyle);const i=(0,a.jsx)(s.View,{style:E.audioMargin,children:(0,a.jsx)(L.RowTitle,{style:t,children:f.getString("ScreenSharingModal.IncludeAudioText")})});return(0,a.jsxs)(s.View,{style:E.modalAudioLabelContainer,children:[i,e]})}_getCancelButton(){const e=this.state.useHighContrastTheme?u.SXButtonStyle.ThemeStroke:u.SXButtonStyle.ColorStroke;return(0,a.jsx)(P.default,{title:f.getString("ScreenSharingModal.Cancel"),style:E.button,buttonStyle:e,buttonSize:u.SXButtonSize.Medium,onPress:()=>this._onClose(b.ScreenSharingPanelCancelOrigin.CancelButton)})}_getStartSharingButton(){return(0,a.jsx)(P.default,{title:this._getScreenShareButtonText(),style:E.button,buttonSize:u.SXButtonSize.Medium,onPress:()=>this._shareScreen(b.ScreenSharingStartOrigin.StartButton),disabled:!this.state.selectedSource})}_getScreenShareButtonText(){return this.props.isScreenSharingActive?this.state.selectedSourcesType&&this.state.selectedSourcesType===r.SharingSourceType.Window?f.getString("ScreenSharingModal.SwitchWindow"):f.getString("ScreenSharingModal.SwitchScreen"):this.state.hasWindowsSection?f.getString("ScreenSharingModal.ShareScreenOrWindow"):this.state.includeAudio?f.getString("ScreenSharingModal.ShareScreenAndSounds"):f.getString("ScreenSharingModal.ShareScreen")}}t.default=N},958315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(148540),r=i(873324),l=i(815146),c=o.__importDefault(i(970035)),d=o.__importStar(i(85385)),u=i(26703),h=o.__importStar(i(704704)),p=o.__importDefault(i(252089)),g=o.__importStar(i(437782)),C=i(273186),m=o.__importDefault(i(655192)),S=i(16549),_=i(641400),f=i(262725),y=o.__importDefault(i(497910)),T=(0,u.lazyProperties)({image:()=>n.Styles.createViewStyle({borderColor:S.Color.transparent,backgroundColor:S.Color.gray400}),missingPreviewView:()=>n.Styles.createViewStyle({borderColor:S.Color.transparent,backgroundColor:S.Color.gray400,flexDirection:"column",alignContent:"center",alignItems:"center",justifyContent:"space-around"}),missingPreviewText:()=>n.Styles.createTextStyle({color:S.Color.white}),imageSelectedBorder:()=>n.Styles.createImageStyle({borderColor:S.Color.blue}),imageHoverBorder:()=>n.Styles.createImageStyle({borderColor:S.Color.gray200Overlay20}),imageSelectedBackground:()=>n.Styles.createViewStyle({backgroundColor:S.Color.blue}),imageHoverBackground:()=>n.Styles.createViewStyle({backgroundColor:S.Color.gray200Overlay60}),centerContent:()=>n.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4}),sourceItem:()=>n.Styles.createViewStyle({justifyContent:"center",marginTop:4}),sourceDescription:()=>n.Styles.createTextStyle({textAlign:"center",color:S.Color.white,marginTop:8}),appDescription:()=>n.Styles.createTextStyle({textAlign:"left"}),textLine:()=>n.Styles.createViewStyle({marginLeft:5})});class b extends y.default{constructor(){super(...arguments),this._failedCode="Failed",this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._toggleSelection=()=>{d.log(l.LogTraceArea.CallingUI,"ScreenSharingSourceItem: _toggleSelection Source Selected "+g.dev_unknownOmit(this.props.sourceDetails.getDescription())),this.props.onSourceSelected(this.props.sourceDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{selectedColor:p.default.getPrimaryColor()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}componentDidMount(){super.componentDidMount(),this._setPreviewUrl(this.props.width,this.props.height)}render(){let e;const t=this.props.sourceDetails.getDescription(),i=n.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1);let o;if(this.props.isSelected){const e=n.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);o=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(o=T.imageHoverBorder);const s=[T.image,i,o],r=[T.missingPreviewView,i,o],l=this._getPlaceholderSize();if(this.state.previewUrl)if(this.state.previewUrl===this._failedCode){const t=h.getString("ScreenSharingModal.PreviewUnavailable");e=(0,a.jsxs)(n.View,{style:[r],children:[(0,a.jsx)(c.default,{icon:_.SkypeIcon.MissingPreview,color:S.Color.white,size:l}),(0,a.jsx)(f.BodyText,{style:T.missingPreviewText,children:t})]})}else e=(0,a.jsx)(n.Image,{style:s,source:this.state.previewUrl,resizeMode:"stretch"});const d=[n.Styles.createViewStyle({width:this.props.width},!1)];d.push(T.appDescription,T.textLine),this.props.useDefaultTheme&&(this.props.isSelected?d.push(this._themeStyles.primaryBackgroundColorTextStyle):d.push(this._themeStyles.secondaryTextColorStyle));const u=n.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1);let p;if(this.props.isSelected){const e=n.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);p=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(p=T.imageHoverBackground);return(0,a.jsx)(n.GestureView,{onDoubleTap:this.props.onDoubleTap,children:(0,a.jsx)(n.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,children:(0,a.jsx)(n.Button,{ref:this._onContainerRef,style:[T.sourceItem,u],onPress:this._toggleSelection,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex,children:(0,a.jsxs)(n.View,{style:[T.centerContent,p],children:[e,(0,a.jsx)(f.Caption,{style:[T.sourceDescription,d],numberOfLines:1,children:t})]})})})})}_getPlaceholderSize(){return this.props.height<=C.SharingSourceSize.Small.width?_.IconSize.size48:this.props.height<=C.SharingSourceSize.Medium.width?_.IconSize.size100:_.IconSize.size128}_setPreviewUrl(e,t){this.props.sourceDetails.getPreviewAsync(e,t).then((e=>{this._checkIfUnmountedReportLateApi("get source preview")||e&&this._createCanvasAndSetpreviewUrl(e)})).catch((e=>{this.setState({previewUrl:this._failedCode});const t=m.default.errorAsString(e);d.error(l.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrl "+t),d.track(new r.ScreenShareSourceGetPreviewFailure(t,s.SharingSourceType[this.props.sourceDetails.getType()],String(this.props.currentlyShared)))})),this.props.sourceDetails.getType()!==s.SharingSourceType.Monitor&&this._setPreviewUrlToIcon(e,t)}_setPreviewUrlToIcon(e,t){this.props.sourceDetails.getIcon(50,50).then((i=>{this._checkIfUnmountedReportLateApi("getIcon")||this.state.previewUrl||this._createCanvasForIconAndSetpreviewUrl(i,e,t)})).catch((e=>{const t=m.default.errorAsString(e);d.error(l.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrlToIcon "+t),d.track(new r.ScreenShareSourceGetIconFailure(t,String(this.props.currentlyShared)))}))}_checkIfUnmountedReportLateApi(e){return!this.isComponentMounted()&&(d.log(l.LogTraceArea.GenericUnsafe,"ScreenSharingSource: "+e+" returned after component was unmounted: "+g.dev_unknownOmit(this.props.sourceDetails.getDescription())),!0)}_createCanvasForIconAndSetpreviewUrl(e,t,i){const o=document.createElement("canvas");o.width=t,o.height=i,o.style.width=t+"px",o.style.height=i+"px";const a=o.getContext("2d");a&&(a.fillStyle=S.Color.black,a.fillRect(0,0,t,i),a.putImageData(e,t/2-25,i/2-25)),this.setState({previewUrl:o.toDataURL()})}_createCanvasAndSetpreviewUrl(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,t.style.width=e.width+"px",t.style.height=e.height+"px",i&&i.putImageData(e,0,0),this.setState({previewUrl:t.toDataURL()})}}t.default=b},79681:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingSourceList=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(217041),l=i(148540),c=o.__importDefault(i(340724)),d=o.__importDefault(i(54945)),u=i(26703),h=o.__importStar(i(704704)),p=o.__importDefault(i(924849)),g=i(424220),C=o.__importDefault(i(958315)),m=(0,u.lazyProperties)({scrollView:()=>s.Styles.createScrollViewStyle({marginRight:-30,flex:1})}),S="source";class _ extends r.ComponentBase{constructor(){super(...arguments),this._mountedSourceRefsMap=new p.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==d.default.UP&&e.keyCode!==d.default.LEFT||(t-=1),e.keyCode!==d.default.DOWN&&e.keyCode!==d.default.RIGHT||(t+=1),t<0||t>=this.props.sourcesList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return(0,a.jsx)(s.ScrollView,{style:m.scrollView,onKeyPress:this._onKeyPress,children:(0,a.jsx)(s.View,{style:this.props.style,children:this._getAvailableSharingSources()})})}_focusItem(e=0){if(e<0||e>=this.props.sourcesList.length)return;const t=this._mountedSourceRefsMap.ref(S+e);null==t||t.requestFocus()}_getAvailableSharingSources(){return n.map(this.props.sourcesList,((e,t)=>{const i=!!this.props.selectedSource&&e.getId()===this.props.selectedSource.getId(),o=!!this.props.currentScreenSharingSource&&e.getId()===this.props.currentScreenSharingSource.getId(),n=e.getId(),s=e.getDescription(),r=e.getType()===l.SharingSourceType.Monitor?"ScreenSharingModal.DesktopAccessibilityLabel":"ScreenSharingModal.WindowAccessibilityLabel";let d=h.getString(r,{description:s,currentItemIndex:t+1,numberOfItems:this.props.sourcesList.length});return i&&(d=c.default.combinedAccessibilityLabel(d,h.getString("Global.SelectedAccessibilityLabel"))||""),(0,a.jsx)(C.default,{ref:this._mountedSourceRefsMap.onComponentRef(S+t),tabIndex:this.state.focusedIndex===t?0:-1,sourceDetails:e,onSourceSelected:this.props.onSourceSelected,isSelected:i,screenIndex:t,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,currentlyShared:o,onDoubleTap:()=>this.props.shareScreen(g.ScreenSharingStartOrigin.DoubleClickSource),accessibilityLabel:d,useHighContrastTheme:this.props.useHighContrastTheme,useDefaultTheme:this.props.useDefaultTheme},n)}))}}t.ScreenSharingSourceList=_},305561:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(854646),r=o.__importStar(i(516778)),l=o.__importDefault(i(369347)),c=i(26703),d=o.__importStar(i(704704)),u=o.__importDefault(i(252089)),h=i(16549),p=o.__importDefault(i(497910)),g=o.__importDefault(i(601274)),C=(0,c.lazyProperties)({progressContainer:()=>r.Styles.createViewStyle({height:20,flexDirection:"row",overflow:"hidden",marginBottom:10,alignSelf:"center",justifyContent:"center"}),progressDotContainer:()=>r.Styles.createViewStyle({width:21,height:20,overflow:"hidden",backgroundColor:h.Color.transparent}),progressDot:()=>r.Styles.createViewStyle({width:40,height:40,borderRadius:20,borderWidth:14,borderStyle:"solid",backgroundColor:h.Color.transparent,marginTop:-10,marginLeft:-10})});class m extends p.default{_buildState(e,t){return t?{level:0}:{}}componentDidMount(){super.componentDidMount(),this._timer=g.default.setInterval((()=>{l.default.DeviceStore.getMicrophoneVolumeLevel().then((e=>{this.isComponentMounted()&&this.setState({level:e||0})}))}),200)}componentWillUnmount(){super.componentWillUnmount(),this._timer&&(g.default.clearInterval(this._timer),this._timer=void 0)}render(){const e=this.props.steps||19,t=[C.progressDot];t.push(r.Styles.createViewStyle({borderColor:this.props.backgroundColor||this._themeColors.primaryBackgroundColor},!1));const i=n.range(e).map((i=>{const o=[t];return i*(1/e)>=this.state.level&&o.push(this._themeStyles.secondaryBackgroundColorStyle),(0,a.jsx)(r.View,{style:C.progressDotContainer,children:(0,a.jsx)(r.View,{style:o})},i.toString())}));return(0,a.jsx)(r.View,{accessibilityLabel:d.getString("AudioVideoSettings.MicrophoneLevelMeter"),accessibilityTraits:r.Types.AccessibilityTrait.Image,ariaRoleDescription:"",children:(0,a.jsx)(s.GradientView,{style:[C.progressContainer,this.props.style],colors:u.default.getGradientColorsNoSubscription(),direction:s.GradientDirection.LEFT,children:i})})}}t.default=m},463264:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importStar(i(704704)),s=o.__importDefault(i(761158));class r extends s.default{_getVolume(){return a.default.DeviceStore.getMicrophoneVolume()}_setVolume(e){a.default.DeviceStore.setMicrophoneVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonMicrophoneVolumeLabel")}}t.default=r},30460:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importDefault(i(150343)),s=o.__importStar(i(704704)),r=o.__importDefault(i(761158));class l extends r.default{componentDidMount(){super.componentDidMount(),n.default.getS4LCMCFeaturesNoSubscription().enableUsingSystemSpeakerVolume&&a.default.DeviceStore.getSpeakerVolumeAsync(!0).then((e=>{this.setState({initialValue:e})}))}_getVolume(){return a.default.DeviceStore.getSpeakerVolume()}_setVolume(e){a.default.DeviceStore.setSpeakerVolume(100*e)}_getAccessibilityLabel(){return s.getString("CallControls.CallButtonSpeakerVolumeLabel")}}t.default=l},761158:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importDefault(i(369347)),r=o.__importStar(i(704704)),l=(o.__importDefault(i(791384)),o.__importDefault(i(290589))),c=o.__importDefault(i(497910));class d extends c.default{constructor(){super(...arguments),this._onVolumeChange=e=>{if(!this.isComponentMounted())return;const t=n.round(10*e,1);this.setState({accessibilityVolume:t}),this.props.onAdjustVolume&&this.props.onAdjustVolume(),this._setVolume(e)},this._onSelectedDeviceChanged=()=>{this.setState({initialValue:this._getVolume()})}}componentDidMount(){super.componentDidMount(),s.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._onSelectedDeviceChanged)}componentWillUnmount(){super.componentWillUnmount(),s.default.DeviceStore.selectedDevicesChangedEvent().unsubscribe(this._onSelectedDeviceChanged),s.default.DeviceStore.saveSettings()}_getAccessibilityVolumeAnnouncement(e){return r.getString("AudioVideoSettings.SpeakerVolumeSliderAnnouncement",{volume:e})}_buildState(e,t){return{initialValue:t?this._getVolume():-1,accessibilityVolume:n.round(this._getVolume()/10,1)}}render(){return(0,a.jsx)(l.default,{style:this.props.style,value:-1!==this.state.initialValue?this.state.initialValue/100:void 0,trackHeight:this.props.trackHeight||10,handleSize:this.props.handleSize||26,onProgressChange:this._onVolumeChange,accessibilityLabel:this._getAccessibilityLabel(),colorThemeOverride:this.props.colorThemeOverride,dragStep:.02,ariaValueNow:this.state.accessibilityVolume})}}t.default=d},872799:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(736667)),l=i(815146),c=o.__importDefault(i(207864)),d=o.__importDefault(i(453761)),u=i(26703),h=o.__importStar(i(704704)),p=o.__importDefault(i(670363)),g=o.__importDefault(i(377556)),C=i(16549),m=o.__importDefault(i(139221)),S=i(641400),_=(0,u.lazyProperties)({container:()=>s.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:70,overflow:"visible"}),innerContainer:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:C.Color.blackOverlay20}),innerContainerRTL:()=>s.Styles.createViewStyle({flexDirection:"row-reverse"}),closeIcon:()=>s.Styles.createViewStyle({width:S.IconSize.default,height:S.IconSize.default,alignItems:"center",justifyContent:"center"})});class f extends r.default{constructor(){super(...arguments),this._enableHaptics=m.default.getPlatformType()===l.PlatformType.iOS,this._animatedStylesInitialized=!1}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isOpen!==t.isOpen&&this._positionDrawer(!0,this.state)}openDrawer(){super.openDrawer(),this._enableHaptics&&c.default.prepareFeedback()}closeDrawer(){const e=super.closeDrawer();return this._enableHaptics&&c.default.unprepareFeedback(),e}_onHandleReactionPressed(){super._onHandleReactionPressed(),this._enableHaptics&&c.default.triggerFeedback()}_positionDrawer(e,t){if(this._onPositionDrawer(e,t),!this._animatedStylesInitialized)return void this._maybeInitAnimatedStyles(t);const i=this._animatedValues(t);this._animatedTransformValue&&this._animatedOpacityValue&&(e?(this._drawerAnimation=s.Animated.parallel([p.default.timing(this._animatedTransformValue,{toValue:i.top,easing:s.Animated.Easing.Out(),duration:150,useNativeDriver:!0}),p.default.timing(this._animatedOpacityValue,{toValue:i.opacity,easing:s.Animated.Easing.Out(),duration:150,useNativeDriver:!0})]),this._drawerAnimation.start((e=>{this._onPositionDrawerAnimationCompleted()}))):(this._animatedTransformValue.setValue(i.top),this._animatedOpacityValue.setValue(i.opacity)))}_renderReactionViews(e){const t=(0,a.jsx)(d.default,{style:_.closeIcon,size:S.IconSize.size24,icon:S.SkypeIcon.Cancel,color:C.Color.white,hoverColor:C.Color.white,title:h.getString("ReactionsStream.ReactionBarCloseDrawerTitle"),onPress:this._onToggleOpen},"close");return n.compact([...e,t])}_maybeInitAnimatedStyles(e){if(!this._animatedStylesInitialized){const t=this._animatedValues(e);this._animatedTransformValue=new s.Animated.Value(t.top),this._animatedOpacityValue=new s.Animated.Value(t.opacity),this._animatedStyle=s.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,transform:[{translateY:this._animatedTransformValue}]}),this._animatedStylesInitialized=!0}}_animatedValues(e){return{top:e.isOpen?0:this._drawerSize(),opacity:e.isOpen?1:0}}_drawerSize(){return 70+this.props.bottomSafeAreaInset}render(){const e=[_.container];this._animatedStyle&&e.push(this._animatedStyle);const t=[_.innerContainer];return g.default.hasHorizontalSafeAreas(this.props.horizontalInsets)&&t.push(g.default.horizontalPaddingStyle(this.props.horizontalInsets)),this._isRTL&&t.push(_.innerContainerRTL),this.props.bottomSafeAreaInset&&(e.push(g.default.heightStyle(this._drawerSize())),t.push(g.default.paddingBottomStyle(this.props.bottomSafeAreaInset))),(0,a.jsx)(s.Animated.View,{style:e,children:(0,a.jsx)(s.View,{style:t,children:this._renderContent()})})}}t.default=f},848829:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(484591)),s=i(520539);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){return s.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,textStyle:s.CommonToastStyles.titleStyle,linkStyle:s.CommonToastStyles.linkStyle})}}t.default=r},112184:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavCallMediaCapturerToast=t.RemoteStackNavCallMediaCapturerToast=void 0;const o=i(197582),a=i(785893),n=i(217041),s=o.__importDefault(i(912201)),r=i(202389),l=i(16549),c=i(641400);class d extends n.ComponentBase{render(){const e=[{icon:c.SkypeIcon.CallRemoteNdiRecord,color:l.Color.white}];return(0,a.jsx)(r.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.props.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",icons:e,style:this.props.style})}}t.RemoteStackNavCallMediaCapturerToast=d;class u extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>{},this._onStopPress=()=>{s.default.setNdiEnabled(!1)}}render(){return(0,a.jsx)(r.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this._onStopPress,getTimestamp:this._getTimestamp,privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel",style:this.props.style})}}t.LocalStackNavCallMediaCapturerToast=u},391083:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(217041),s=o.__importDefault(i(369347)),r=i(202389),l=i(16549),c=i(641400);class d extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>s.default.CallingStore.getCallRecordingTimestamp(this.props.callId)}_buildState(e,t){const i=s.default.CallingStore.getCallRecordingInitiator(e.callId);return{initiatorMri:i,isLocalInitiator:s.default.InCallBotUtils.isCallRecordingInitiator(i)}}render(){if(this.state.initiatorMri&&this.state.isLocalInitiator)return(0,a.jsx)(r.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this.props.onPress,getTimestamp:this._getTimestamp,privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable",style:this.props.style,onHideRecordingToast:this.props.onHideRecordingToast});const e=[{icon:c.SkypeIcon.CallRecordStroke,color:l.Color.white},{icon:c.SkypeIcon.CallRecordDot,color:l.Color.red}];return(0,a.jsx)(r.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.state.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotficationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",icons:e,style:this.props.style,onHideRecordingToast:this.props.onHideRecordingToast})}}t.default=d},792163:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(206197),s=o.__importDefault(i(697088)),r=i(520539);class l extends r.StackNavHeightBasedToast{_getContainerStyle(){return r.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(s.default,{closeToast:this.props.closeToast,colorThemeOverride:n.Theme.ColorfulDark})}}t.default=l},174401:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(200020)),s=i(520539);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){return s.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{toastType:this.props.type,textStyle:s.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast,callId:this.props.callId,isUsingStackNavigation:!0})}}t.default=r},520539:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackNavHeightBasedToast=t.CommonToastStyles=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=i(26703),l=i(16549),c=o.__importDefault(i(20758)),d=(0,r.lazyProperties)({hidden:()=>n.Styles.createViewStyle({opacity:0})});t.CommonToastStyles=(0,r.lazyProperties)({titleStyle:()=>n.Styles.createTextStyle({color:l.Color.white,font:c.default.font.uiDisplayBold,fontSize:c.default.controlFontSize.subtitle}),linkStyle:()=>n.Styles.createTextStyle({color:l.Color.sxBlue,font:c.default.font.uiDisplayBold,fontSize:c.default.controlFontSize.smallButton}),container:()=>n.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:l.Color.gray400Overlay70})});class u extends s.ComponentBase{constructor(){super(...arguments),this.onLayout=e=>{const t=this.props.topInset,i=e.height-(t||0);i!==this.state.desiredHeight&&this.setState({desiredHeight:i,initialLayoutComplete:!0})}}_buildState(e,t){const i={};return t&&(i.initialLayoutComplete=!1,i.desiredHeight=0),i}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}componentWillUnmount(){super.componentWillUnmount(),this.props.onDesiredHeightChanged(0)}render(){const e=[this._getContainerStyle()];return this.props.topInset&&e.push(n.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.props.style&&e.push(this.props.style),this.state.initialLayoutComplete||e.push(d.hidden),(0,a.jsx)(n.View,{style:e,onLayout:this.onLayout,children:this._renderContent()})}}t.StackNavHeightBasedToast=u},638438:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(532747)),s=i(520539);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){return s.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{callId:this.props.callId,textStyle:s.CommonToastStyles.titleStyle,linkStyle:s.CommonToastStyles.linkStyle})}}t.default=r},874599:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(882424)),s=i(520539);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){return s.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,isEncryptedCall:this.props.isEncryptedCall,isPSTNCall:this.props.isPSTNCall,textStyle:s.CommonToastStyles.titleStyle,linkStyle:s.CommonToastStyles.linkStyle,onHideScreenSharingToast:this.props.onHideScreenSharingToast})}}t.default=r},202389:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavPrivacyToast=t.RemoteStackNavPrivacyToast=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(843822),r=o.__importDefault(i(142193)),l=o.__importDefault(i(601976)),c=o.__importDefault(i(453761)),d=i(26703),u=o.__importStar(i(704704)),h=o.__importDefault(i(117475)),p=i(16549),g=i(641400),C=i(262725),m=o.__importDefault(i(340724)),S=(o.__importDefault(i(827361)),o.__importDefault(i(95114))),_=i(483753),f=o.__importDefault(i(150343)),y=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:p.Color.gray400Overlay70,justifyContent:"space-between"}),contentContainer:()=>n.Styles.createViewStyle({flex:1,marginLeft:10,paddingTop:4}),hiddenContainer:()=>n.Styles.createViewStyle({opacity:0}),titleContainer:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,justifyContent:"space-between"}),titleSubcontainer:()=>n.Styles.createViewStyle({flexDirection:"row"}),privacyStatementContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:5}),privacyStatementTextContainer:()=>n.Styles.createViewStyle({flex:1,marginRight:5}),statusTextStyle:()=>n.Styles.createTextStyle({flex:1,paddingHorizontal:10})});class T extends s.RemoteBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){const i=h.default.horizontalPaddingStyle(),o={initiatorDisplayName:e.initiatorMri?l.default.getMemberShortNameForConversation(e.conversationMri,e.initiatorMri):void 0,horizontalPaddingStyle:i};return t&&(o.initialLayoutComplete=!1,o.desiredHeight=0),o}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}componentWillUnmount(){super.componentWillUnmount(),this.props.onDesiredHeightChanged(0)}render(){const e=[y.container];this.state.horizontalPaddingStyle&&e.push(this.state.horizontalPaddingStyle),this.props.topInset&&e.push(n.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.props.style&&e.push(this.props.style),this.state.initialLayoutComplete||e.push(y.hiddenContainer);const t=(0,a.jsx)(r.default,{icons:this.props.icons});let i;const o=[y.titleContainer,n.Styles.createViewStyle({maxWidth:this.props.viewWidth-55},!1)];let s;if(this.state.initiatorDisplayName?s=u.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotficationTextPath&&(s=u.getString(this.props.initialNotficationTextPath)),s){const e=n.Styles.createTextStyle({color:this._themeColors.textLightFixed},!1);i=(0,a.jsx)(n.View,{style:o,children:(0,a.jsx)(C.Subtitle,{style:e,children:s})})}return(0,a.jsxs)(n.View,{style:e,onLayout:this._onLayout,children:[(0,a.jsxs)(n.View,{style:y.titleSubcontainer,children:[t,(0,a.jsx)(n.View,{style:y.contentContainer,children:i})]}),(0,a.jsx)(c.default,{icon:g.SkypeIcon.ClosePanel,size:g.IconSize.size20,color:this._themeColors.textLightFixed,hoverColor:this._themeColors.textLightFixed,title:u.getString("Global.CloseButtonTitle"),onPress:this.props.onHideRecordingToast})]})}}t.RemoteStackNavPrivacyToast=T;class b extends s.LocalBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){const i=h.default.horizontalPaddingStyle(),o=f.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies,a={horizontalPaddingStyle:i,recordingTimestamp:e.getTimestamp(),privacyLinkUrl:o};return t&&(a.showPrivacyLink=!0,a.initialLayoutComplete=!1,a.desiredHeight=0),a}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}componentWillUnmount(){super.componentWillUnmount(),this.props.onDesiredHeightChanged(0)}render(){const e=n.Styles.createTextStyle({color:this._themeColors.textLightFixed},!1),t=n.Styles.createTextStyle({color:this._themeColors.textAccentFixed},!1),i=[{icon:g.SkypeIcon.CallRecordStroke,color:p.Color.white},{icon:g.SkypeIcon.CallRecordDot,color:p.Color.red}],o=[y.container];this.state.horizontalPaddingStyle&&o.push(this.state.horizontalPaddingStyle),this.props.topInset&&o.push(n.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.props.style&&o.push(this.props.style),this.state.initialLayoutComplete||o.push(y.hiddenContainer);const s=(0,a.jsx)(n.View,{onPress:this._onStopPress,children:(0,a.jsx)(r.default,{icons:i})}),l=(0,a.jsxs)(n.View,{style:y.titleContainer,children:[(0,a.jsxs)(n.View,{style:y.titleSubcontainer,children:[(0,a.jsx)(C.Subtitle,{style:e,children:this._getElapsedTime()}),(0,a.jsx)(n.Button,{onPress:this._onStopPress,children:(0,a.jsx)(C.Subtitle,{style:[y.statusTextStyle,t],children:u.getString(this.props.stopLinkTextPath)})})]}),(0,a.jsx)(c.default,{icon:g.SkypeIcon.ClosePanel,size:g.IconSize.size20,color:this._themeColors.textLightFixed,hoverColor:this._themeColors.textLightFixed,title:u.getString("Global.CloseButtonTitle"),onPress:this.props.onHideRecordingToast})]});let d;if(this.state.showPrivacyLink){const t=[y.privacyStatementTextContainer,n.Styles.createViewStyle({maxWidth:this.props.viewWidth-80},!1)],i=u.getString(this.props.morePrivacyInfoLinkTextPath),o=u.getParts(this.props.privacyStatementTextPath,{learnMoreLink:this._getPrivacyLink(i)}),s=m.default.linkAccessibilityInfo(u.getString(this.props.privacyStatementTextPath,{learnMoreLink:i}));d=(0,a.jsx)(n.View,{style:y.privacyStatementContainer,children:(0,a.jsx)(n.View,{style:t,accessibilityLabel:s.label,accessibilityTraits:s.traits,importantForAccessibility:void 0,onPress:this._onMorePrivacyInfoPress,children:(0,a.jsx)(C.Caption,{style:[S.default.subtitleMediumSemiLarge,e],children:o})})})}return(0,a.jsxs)(n.View,{style:o,onLayout:this._onLayout,children:[s,(0,a.jsxs)(n.View,{style:y.contentContainer,children:[l,d]})]})}_getPrivacyLink(e){return(0,a.jsx)(_.AccessibleLink,{url:this.state.privacyLinkUrl,textElement:C.Caption,hasFixedColors:!0,children:e},"recordingPrivacyNote")}}t.LocalStackNavPrivacyToast=b},293356:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(970035)),r=i(26703),l=o.__importStar(i(704704)),c=i(520539),d=i(16549),u=i(641400),h=i(262725),p=(0,r.lazyProperties)({containerstyle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),titleStyle:()=>n.Styles.createTextStyle({paddingLeft:7})});class g extends c.StackNavHeightBasedToast{_getContainerStyle(){return c.CommonToastStyles.container}_renderContent(){return(0,a.jsxs)(n.View,{style:p.containerstyle,children:[(0,a.jsx)(s.default,{icon:u.SkypeIcon.MicrophoneOff,size:u.IconSize.size14,color:d.Color.white}),(0,a.jsx)(h.BodyText,{style:[c.CommonToastStyles.titleStyle,p.titleStyle],numberOfLines:1,children:l.getString("CallPanel.MicrophoneServerMuted")})]})}}t.default=g},876974:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(520539),s=o.__importDefault(i(102333));class r extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(s.default,{textStyle:n.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast})}}t.default=r},949633:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(520539),s=o.__importDefault(i(157786));class r extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(s.default,{callId:this.props.callId,textStyle:n.CommonToastStyles.titleStyle,linkStyle:n.CommonToastStyles.linkStyle,conversationMri:this.props.conversationMri})}}t.default=r},432548:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(958868)),l=o.__importDefault(i(577267));class c extends r.default{constructor(){super(...arguments),this._checkIfContentDimensionsChanged=()=>{if(n.isUndefined(this._popupRef))return;const e=this._popupRef.getBoundingClientRect();n.isUndefined(this.state.prevContentRect)||Math.round(this.state.prevContentRect.width)===Math.round(e.width)&&Math.round(this.state.prevContentRect.height)===Math.round(e.height)||this.props.onContentDimensionsChanged&&this.props.onContentDimensionsChanged(),this.setState({prevContentRect:e})},this._onPopupRef=e=>{this._popupRef=e||void 0}}_buildState(e,t){const i={};return t&&(i.prevContentRect=void 0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._checkIfContentDimensionsChanged()}render(){return(0,a.jsx)("div",{ref:this._onPopupRef,children:(0,a.jsx)(l.default,{anchorPosition:this.props.anchorPosition,anchorOffset:this.props.anchorOffset,popupWidth:this.props.popupWidth,popupHeight:this.props.popupHeight,fillColor:this.props.fillColor,strokeColor:this.props.strokeColor,popupAccessibilityTitle:this.props.popupAccessibilityTitle,offset:this.props.offset,children:(0,a.jsx)(s.View,{style:this.props.style,children:this.props.renderContent()})})})}}t.default=c},586337:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsList=void 0;const o=i(197582),a=i(785893),n=i(667294),s=i(217041),r=i(614080),l=i(701025),c=i(392529),d=i(597667),u=i(640147),h=i(736267),p=i(154235),g=o.__importDefault(i(960282)),C=o.__importStar(i(27800)),m=i(589640),S=(0,n.forwardRef)((({listItems:e,origin:t,searchResultsGroupsHelpers:i,emptyStateDisplayed:o,onScroll:s},d)=>{const{rootViewId:p}=(0,h.useCommonContext)(),g=(0,n.useCallback)((e=>(0,u.callsListItemHandler)(e,i,t,p)),[t,p,i]);return(0,a.jsx)(l.SafeAreaView,{style:c.styles.callsListSafeArea,edges:["left","right"],pointerEvents:"box-none",children:(0,a.jsx)(r.VirtualListView,{ref:d,itemList:e,renderItem:g,onScroll:s,animateChanges:!1,keyboardDismissMode:"on-drag",style:o?m.styles.panelWrapperStyle:void 0,skipRenderIfItemUnchanged:!0,keyboardShouldPersistTaps:!0,restoreFocusAfterUpdate:!0})})}));class _ extends s.ComponentBase{constructor(){super(...arguments),this._searchResultsGroupsHelpers={},this._onVLVRef=e=>{this._vlvRef=e||void 0}}_buildState(e,t){const i={contentSizeMultiplier:Math.min(g.default.getContentSizeMultiplier(),p.MaxContentSizeMultiplier),trimmedNormalizedQuery:""};return i.listItems=t?[]:this._generateListOfCallItems(),this._updateSearchControllerSearchConfig(e),this._updateSearchConfigs(i),i}componentDidMount(){super.componentDidMount(),this._updateListOfCalls()}componentDidUpdate(e,t,i){var o;if(super.componentDidUpdate(e,t,i),this.props.onResultsCountChange&&this.state.listItems.length!==t.listItems.length){const e=this.props.topInset?1:0,t=(null===(o=this.props.headers)||void 0===o?void 0:o.length)||0,i=this.state.listItems.length-(e+t);this.props.onResultsCountChange(i)}}scrollToTop(){var e,t;null===(t=null===(e=this._vlvRef)||void 0===e?void 0:e.scrollToTop)||void 0===t||t.call(e,!0)}_updateSearchControllerSearchConfig(e){(0,d.updateSearchControllersConfig)(e.searchController,e.searchResultGroups,e.excludePstn,e.onlyPstn)}_updateSearchConfigs(e){const t=Object.assign(Object.assign({},this.state),e);this.props.searchResultGroups.forEach((e=>{let i=this._searchResultsGroupsHelpers[e.groupType];i||(i=C.createHelper(e.groupType,this.props.origin),this._searchResultsGroupsHelpers[e.groupType]=i),i.updateSearchConfig(e,this.props,t)}))}_generateListOfCallItems(){return(0,d.handleSearchResultGroup)(this._searchResultsGroupsHelpers,this.props.searchResultGroups,this.state,this.props)}_updateListOfCalls(){const e=this._generateListOfCallItems();this.setState({listItems:e})}render(){return(0,a.jsx)(S,Object.assign({ref:this._onVLVRef,listItems:this.state.listItems,onScroll:this.props.onScroll,searchResultsGroupsHelpers:this._searchResultsGroupsHelpers},this.props))}}t.CallsList=_},471016:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsListEmptyState=function({headers:e,topInset:t,emptyStateEmoticon:i,emptyStateHeader:c}){return(0,o.jsxs)(a.Box,{flex:1,paddingTop:t,children:[(0,o.jsx)(n.SafeAreaView,{style:s.styles.callsListEmptyStateSafeArea,edges:["left","right"],pointerEvents:"box-none",children:null==e?void 0:e.map((e=>(0,o.jsx)(l.CallsListHeader,{template:e.template},e.template)))}),(0,o.jsx)(a.Box,{flexGrow:0,flexShrink:1,children:(0,o.jsx)(r.IllustrationScreen,{emoticon:i,topSlot:c},"noCallsItem")})]})};const o=i(785893),a=i(344175),n=i(701025),s=i(392529),r=i(571059),l=i(449294)},449294:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsListHeader=function({template:e}){if(e.indexOf(n.CallsListHeader.CallButtonSection)>-1)return(0,a.jsx)(r.CallsButtonsSection,{});if(e.indexOf(n.CallsListHeader.PhoneCommerceSection)>-1)return(0,a.jsx)(l.default,{});if(e.indexOf(n.CallsListHeader.IsMinor)>-1)return(0,a.jsx)(s.MinorProtectionBanner,{});return(0,a.jsx)(a.Fragment,{})};const o=i(197582),a=i(785893),n=i(619905),s=i(298174),r=i(307800),l=o.__importDefault(i(188972))},517842:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsListSection=void 0;const o=i(197582),a=i(785893),n=i(667294),s=i(344175),r=i(392529),l=i(586337),c=i(471016),d=i(815146),u=o.__importDefault(i(657764)),h=i(249549),p=o.__importDefault(i(760989)),g=i(82485),C=o.__importDefault(i(549173)),m=i(619429),S=i(154235),_=i(287153);t.CallsListSection=(0,n.forwardRef)((({showEmptyIllustration:e,emptyStateEmoticon:t,emptyStateHeader:i,categoryFilter:o,searchGroups:f,topInset:y,headers:T,handleResultsCountChange:b,onScroll:v},I)=>{const w=(0,n.useMemo)((()=>new u.default),[]),P=(0,n.useCallback)(((e,t)=>function(e,t,i){const o=p.default.newCauseId();g.Instrumentation.log(d.LogTraceArea.QuickCallPanel,`[CallsListSection][handleCallListItemClick][${o}]list item was clicked`),g.Instrumentation.track(new _.CallTabsListTelemetry(e,h.ButtonEvents.Press));const a=e===h.Tab.Calls?d.NavigationCallOrigin.CallsTab:d.NavigationCallOrigin.PhoneTab;C.default.startCallOrMaybePrompt((()=>t),S.MainRootViewId,{skypeMri:i,inviteOrigin:d.ContactInviteOrigin.CallPanelSearch,userIntent:m.StartCallOrMaybePromptUserIntent.Generic,callOrigin:a},o)}(o,e,t)),[o]),M=o===h.Tab.Calls,D=o===h.Tab.Phone,A=e&&!!t,k=D?d.SearchResultsListOrigin.PhoneTabPanel:d.SearchResultsListOrigin.CallsTabPanel;return(0,a.jsxs)(s.Column,{style:r.styles.flexOne,children:[!A&&(0,a.jsx)(s.Box,{style:A?r.styles.callsListContainerEmptyState:r.styles.callsListContainerNonEmptyState,flexBasis:y?`${y}`:"auto",children:(0,a.jsx)(l.CallsList,{ref:I,searchResultGroups:f,searchController:w,origin:k,onScroll:v,excludePstn:M,onlyPstn:D,onListItemClick:P,onResultsCountChange:b,emptyStateDisplayed:A,topInset:y,headers:T,hasCallIcons:!0,hideEmptyState:!0})}),A&&(0,a.jsx)(c.CallsListEmptyState,{headers:T,topInset:y,emptyStateEmoticon:t,emptyStateHeader:i})]})})),t.default=t.CallsListSection},71142:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsListTopSpacer=function(){return(0,o.jsx)(a.View,{},n.CallsListTemplate.TopSpacer)};const o=i(785893),a=i(537180),n=i(619905)},597667:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getResultListMode=t.SEARCH_GROUPS=void 0,t.handleSearchResultGroup=function(e,t,i,o){var n;const l=[];o.topInset&&l.push({key:a.CallsListTemplate.TopSpacer,template:a.CallsListTemplate.TopSpacer,height:o.topInset,isNavigable:!1});null===(n=o.headers)||void 0===n||n.forEach((e=>{l.push({key:a.CallsListTemplate.Header+e.template,template:a.CallsListTemplate.Header+e.template,height:e.height,isNavigable:!0,measureHeight:!0})}));let c="";return t.forEach(((t,a)=>{const n=e[t.groupType].getItems(i,o,a,!0);c+=`${s.SearchResultsListGroup[t.groupType]} with result count - ${n.length}, `,n.forEach((e=>{l.push(Object.assign(Object.assign({},e),{rawSearchQuery:"",onListItemClick:o.onListItemClick}))}))})),r.log(s.LogTraceArea.Search,`group types processed - ${c}`,c),l},t.updateSearchControllersConfig=function(e,t,i,o){e.updateConfig({onlyPstn:o,excludePstn:i,rawQuery:"",trimmedNormalizedQuery:"",showOnlyBots:!1,onlyGroupCapable:!1,onlyCallCapable:!1},t.map((e=>e.groupType)))};const o=i(197582),a=i(619905),n=i(249549),s=i(815146),r=o.__importStar(i(85385));t.SEARCH_GROUPS={zeroInputSearchSkypeCalls:[{groupType:s.SearchResultsListGroup.RecentCalls},{groupType:s.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:s.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputSearchPhoneCalls:[{groupType:s.SearchResultsListGroup.RecentCalls},{groupType:s.SearchResultsListGroup.AllPeopleWithPhoneNumbers}]};t.getResultListMode=e=>e===n.Tab.Calls?t.SEARCH_GROUPS.zeroInputSearchSkypeCalls:t.SEARCH_GROUPS.zeroInputSearchPhoneCalls},640147:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.callsListItemHandler=function(e,t,i,r){if(e.template.indexOf(a.CallsListTemplate.Header)>-1)return(0,o.jsx)(n.CallsListHeader,{template:e.template});if(e.template.indexOf(a.CallsListTemplate.TopSpacer)>-1)return(0,o.jsx)(s.CallsListTopSpacer,{});if(void 0===e.groupType)return(0,o.jsx)(o.Fragment,{});const l=t[e.groupType];if(!l)return(0,o.jsx)(o.Fragment,{});const c=l.renderItem({key:"result",item:e,origin:i,rootViewId:r},!1);if(!c)return(0,o.jsx)(o.Fragment,{});return c};const o=i(785893),a=i(619905),n=i(449294),s=i(71142)},959835:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsList=t.CallsListSection=void 0;var o=i(517842);Object.defineProperty(t,"CallsListSection",{enumerable:!0,get:function(){return o.CallsListSection}});var a=i(586337);Object.defineProperty(t,"CallsList",{enumerable:!0,get:function(){return a.CallsList}})},392529:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;const o=i(537180);t.styles=o.StyleSheet.create({flexOne:{flex:1},callsListSafeArea:{flex:1},callsListEmptyStateSafeArea:{zIndex:2},callsListContainerNonEmptyState:{flexGrow:1},callsListContainerEmptyState:{flexGrow:0}})},619905:(e,t)=>{var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.CallsListHeader=t.CallsListTemplate=void 0,function(e){e.Header="CallsListHeader",e.TopSpacer="CallsListTopSpacer"}(i||(t.CallsListTemplate=i={})),function(e){e.CallButtonSection="CallButtonSection",e.PhoneCommerceSection="PhoneCommerceSection",e.IsMinor="IsMinor"}(o||(t.CallsListHeader=o={}))},188972:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CREDIT_COMPONENT_AVG_HEIGHT=t.MINOR_COMPONENT_MAX_HEIGHT=void 0;const o=i(197582),a=i(785893),n=i(344175),s=i(537180),r=i(177727),l=o.__importDefault(i(808509)),c=o.__importStar(i(704704)),d=i(641400),u=i(154235),h=i(16549),p=i(736267),g=o.__importDefault(i(740794)),C=i(526849),m=o.__importDefault(i(150343)),S=o.__importStar(i(85385)),_=i(287153),f=i(249549),y=i(175338),T=i(739901),b=o.__importDefault(i(37679)),v=i(106774),I=i(815146),w=i(414838);t.MINOR_COMPONENT_MAX_HEIGHT=175,t.CREDIT_COMPONENT_AVG_HEIGHT=275,t.default=(0,C.WithResub)((function({ecs:e,pathsRequiringHeaders:t,stratusHost:i,userHasEntitlements:o}){const C=(0,p.useCommonContext)();return(0,a.jsxs)(n.Column,{style:r.styles.buttonSectionContainer,children:[(0,a.jsx)(v.CreditBarSection,{}),(0,a.jsxs)(s.ScrollView,{horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:r.styles.phoneHorizontalScrollViewContentContainer,children:[(0,a.jsx)(l.default,{title:c.getString("CallTab.InternationalCall"),subtitle:c.getString("CallTab.InternationalCallSubtitle"),icon:d.SkypeIcon.Globe,buttonStyle:u.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:h.AgnosticGradientFillButtonColors.darkPurple,onPress:()=>{S.track(new _.CallTabsButtonsTelemetry(f.Tab.Phone,f.Buttons.SkypeToPhone,f.ButtonEvents.Press,o)),g.default.navigateToBalanceStatePanel(I.BalancePanelSource.PhoneTabButtonSectionSkypeToPhone,C.rootViewId)}},"phoneTabSkypeToPhone"),(0,a.jsx)(l.default,{title:c.getString("CallTab.SkypeCredit"),subtitle:c.getString("CreditExpiration.CallButtonLabel"),icon:d.SkypeIcon.Money,buttonStyle:u.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:h.AgnosticGradientFillButtonColors.mediumBlue,onPress:()=>{S.track(new _.CallTabsButtonsTelemetry(f.Tab.Phone,f.Buttons.SkypeCredit,f.ButtonEvents.Press,o)),g.default.navigateToBalanceStatePanel(I.BalancePanelSource.PhoneTabButtonSectionSkypeCredit,C.rootViewId)}},"phoneTabSkypeCredit"),(0,a.jsx)(l.default,{title:c.getString("CallTab.SkypeNumberPretitle"),subtitle:c.getString("CallTab.SkypeNumberSubtitle"),icon:d.SkypeIcon.Call,buttonStyle:u.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:h.AgnosticGradientFillButtonColors.darkGreen,onPress:()=>{S.track(new _.CallTabsButtonsTelemetry(f.Tab.Phone,f.Buttons.SkypeNumber,f.ButtonEvents.Press,o)),S.track(new w.PaymentStep(I.PaymentFlowStep.ShowPanel,{location:T.Location[T.Location.PhoneTab],target:"SkypeNumberNativePurchaseFlow"})),(0,y.runSkypeNumberPurchaseFlow)({location:T.Location.PhoneTab,rootViewId:C.rootViewId,ecs:e,pathsRequiringHeaders:t,stratusHost:i,context:C})}},"phoneTabSkypeNumber")]})]})}),(e=>{const t=m.default.getS4LCommerceFeatures(),{newBuyCreditExperience:i,skypeNumber:o,webConfig:a}=t,{enableNewCallsCreditOffers:n}=m.default.getS4LMessagingFeatures();return Object.assign(Object.assign({},e),{clientCurrencyFormatting:i.useClientFormattingForCurrencies,ecs:o,pathsRequiringHeaders:a.pathsRequiringHeaders,stratusHost:m.default.getConfigSettings().secureStratus.host,enableNewCallsCreditOffers:n,userHasEntitlements:b.default.userHasActiveEntitlements()})}))},808509:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(331654),r=o.__importDefault(i(660401)),l=o.__importDefault(i(827361)),c=o.__importDefault(i(20758)),d=i(154235),u=i(26703),h=o.__importDefault(i(960282)),p=o.__importDefault(i(958868)),g=i(330380),C=(0,u.lazyProperties)({button:()=>n.Styles.createButtonStyle({flexGrow:1,flexShrink:1,flexBasis:0,borderRadius:8}),buttonLandscape:()=>n.Styles.createButtonStyle({maxWidth:200}),buttonText:()=>n.Styles.createTextStyle({font:c.default.font.uiDisplayBold,fontSize:14,lineHeight:18,fontWeight:d.FontWeight.bold}),textLeft:()=>n.Styles.createTextStyle({textAlign:"left"}),textRight:()=>n.Styles.createTextStyle({textAlign:"right"}),innerContainer:()=>n.Styles.createViewStyle({flex:1,minWidth:160,minHeight:90,borderRadius:8,paddingHorizontal:16,paddingBottom:16,justifyContent:"flex-end",alignItems:"flex-start"}),innerContainerLandscape:()=>n.Styles.createViewStyle({flex:1,width:200,minHeight:90,borderRadius:8,paddingHorizontal:16,paddingBottom:10,justifyContent:"flex-end",alignItems:"stretch"})});function m({pretitle:e,title:t,subtitle:i,icon:o,buttonStyle:s,agnosticGradientColor:c,onPress:d,isLandscape:u,colorInfoOverride:h}){const p=(0,g.useLocalization)(),m=n.Styles.combine([u?C.innerContainerLandscape:C.innerContainer]),S=p.isRTL?C.textRight:C.textLeft;return(0,a.jsx)(r.default,{onPress:d,pretitle:e,title:t,subtitle:i,backgroundIcon:o,textStyleOverride:[C.buttonText,S],style:n.Styles.combine([C.button,l.default.shadowLightStyle,u?C.buttonLandscape:void 0]),buttonStyle:s,agnosticGradientColor:c,colorInfoOverride:h,innerContainerStyle:m,maxTitleWidth:u?200:160,allowTextWrap:!0,backgroundStyle:{height:void 0,paddingLeft:void 0,paddingRight:void 0}})}class S extends p.default{_buildState(){const e=this._getRootViewId();return{isLandscape:h.default.getDeviceOrientation(e)===s.DeviceOrientation.Landscape}}render(){return(0,a.jsx)(m,{pretitle:this.props.pretitle,title:this.props.title,subtitle:this.props.subtitle,icon:this.props.icon,buttonStyle:this.props.buttonStyle,agnosticGradientColor:this.props.agnosticGradientColor,onPress:this.props.onPress,colorInfoOverride:this.props.colorInfoOverride,isLandscape:this.state.isLandscape})}}t.default=S},229821:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(667294),r=i(537180),l=i(344175),c=i(854646),d=i(167606),u=o.__importDefault(i(453761)),h=i(641400),p=i(206315),g=o.__importDefault(i(970035)),C=i(526849),m=o.__importDefault(i(37679)),S=o.__importStar(i(603094)),_=o.__importDefault(i(20758)),f=o.__importStar(i(704704)),y=o.__importDefault(i(740794)),T=i(736267),b=i(841343),v=o.__importDefault(i(760989)),I=i(82485),w=i(287153),P=i(249549),M=i(815146);t.default=(0,C.WithResub)(n.memo((({creditEntitlement:e,subscriptions:t})=>{const i=(0,T.useCommonContext)(),{gradients:o,mode:n,themeColors:C}=(0,p.useSkypeTheme)(),m=(0,l.useSUIThemeStyles)((e=>({innerContainer:{backgroundColor:e.colors.surfacePrimary,borderRadius:10,margin:2},gradient:{borderRadius:12,flexGrow:1,flexShrink:1},container:{paddingHorizontal:20},creditIcon:{color:e.colors.iconPrimary,alignSelf:"center",marginRight:5},iconButtonStyle:{height:20},balanceText:{fontSize:_.default.fontSize.size14,lineHeight:20,color:e.colors.textPrimary}})),[]),D=e&&S.getFormattedBalance(e)||"0",A=t.length>0,k=(0,s.useCallback)((()=>{const o=v.default.newCauseId();I.Instrumentation.log(d.LogTraceArea.Navigation,`CreditBarSection.navigateToBalanceStatePanel, causeId: ${o}`);const a=S.hasActiveSubscriptions(t)||S.hasUsableCredit(e);I.Instrumentation.track(new w.CallTabsButtonsTelemetry(P.Tab.Phone,P.Buttons.CreditBar,P.ButtonEvents.Press,a)),y.default.navigateToBalanceStatePanel(M.BalancePanelSource.PhoneTabCreditBar,i.rootViewId,void 0,void 0,o)}),[i.rootViewId,t,e]),R=n.isAccessible?[C.strokeHighContrast,C.strokeHighContrast]:o.secondary;return(0,a.jsx)(l.Row,{marginY:"size120",marginX:"size120",children:(0,a.jsx)(c.GradientView,{direction:c.GradientDirection.TOP_LEFT,colors:R,style:m.gradient,children:(0,a.jsxs)(l.Box,{style:m.innerContainer,paddingY:"size120",paddingX:"size120",children:[(0,a.jsxs)(l.Row,{alignContent:"center",justifyContent:"space-between",children:[(0,a.jsx)(l.Column,{width:"80%",children:(0,a.jsxs)(l.Row,{alignItems:"center",alignContent:"center",flexGrow:1,children:[(0,a.jsx)(g.default,{icon:h.SkypeIcon.Money,size:h.IconSize.size14,color:m.creditIcon.color,style:m.creditIcon}),(0,a.jsx)(r.Text,{style:m.balanceText,children:f.getString("QuickCallPanel.CreditBarBallance",{amount:D})})]})}),(0,a.jsx)(l.Column,{children:(0,a.jsx)(u.default,{icon:h.SkypeIcon.MoreVertical,size:h.IconSize.size16,color:C.iconPrimary,onPress:k,style:m.iconButtonStyle})})]}),A&&(0,a.jsx)(b.SubscriptionsList,{subscriptions:t})]})})})})),(()=>({creditEntitlement:m.default.getCreditEntitlement(),subscriptions:m.default.getSubscriptions()})))},466075:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionItem=void 0;const o=i(197582),a=i(785893),n=i(667294),s=i(344175),r=i(537180),l=o.__importStar(i(704704)),c=i(613155),d=o.__importDefault(i(20758)),u=i(568394),h=i(483753),p=i(825419);t.SubscriptionItem=({subscription:e,onPress:t})=>{const i=(0,s.useSUIThemeStyles)((e=>({text:{fontSize:d.default.fontSize.size12,lineHeight:16,color:e.colors.textPrimary},upgrade:{fontSize:d.default.fontSize.size12,lineHeight:16,marginLeft:4}})),[]),o=(0,u.getSubscriptionCountryName)(e),g=(0,n.useCallback)((()=>{null==t||t(e)}),[t,e]),C=!e.isUnlimited&&(e.availableMinutes||0)<5;return(0,a.jsx)(s.Column,{marginBottom:"size120",children:(0,a.jsxs)(r.Pressable,{onPress:g,children:[(0,a.jsxs)(s.Row,{justifyContent:"space-between",children:[(0,a.jsx)(p.Caption,{style:i.text,children:o}),(0,a.jsxs)(s.Row,{children:[void 0!==e.availableMinutes&&void 0!==e.totalMinutes&&!e.isUnlimited&&(0,a.jsx)(p.Caption,{style:i.text,children:l.getString("QuickCallPanel.CreditBarNumberOfMinutes",{current:e.availableMinutes,total:e.totalMinutes})}),e.isUnlimited&&(0,a.jsx)(p.Caption,{style:i.text,children:l.getString("QuickCallPanel.CreditBarUnlimited")}),C&&(0,a.jsx)(h.Link,{url:"",style:i.upgrade,onPress:g,children:l.getString("QuickCallPanel.CreditBarUpgrade")})]})]}),(0,a.jsx)(s.Row,{marginTop:1,children:(0,a.jsx)(c.ProgressBar,{value:e.isUnlimited?1:e.availableMinutes||0,totalValue:e.isUnlimited?1:e.totalMinutes||0})})]})})}},841343:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionsList=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(667294),r=i(344175),l=o.__importStar(i(704704)),c=i(466075),d=o.__importDefault(i(20758)),u=i(736267),h=i(326707),p=i(825419),g=i(526849),C=o.__importDefault(i(602149)),m=o.__importDefault(i(150343));t.SubscriptionsList=(0,g.WithResub)(n.memo((({subscriptions:e,displayLimit:t=2,shouldUseGPlayBilling:i,callingSubscriptionFeatures:o,commerceConfig:n})=>{const g=(0,u.useCommonContext)(),[C,m]=(0,s.useReducer)((e=>!e),!1),S=(0,r.useSUIThemeStyles)((e=>({text:{fontSize:d.default.fontSize.size12,lineHeight:16,color:e.colors.textSecondary}})),[]),_=(0,s.useCallback)((e=>{(0,h.handleSubscriptionDetailPress)(e,g.rootViewId,i,n,o)}),[g.rootViewId,n,o,i]),f=C?l.getString("QuickCallPanel.CreditBarShowLess"):l.getString("QuickCallPanel.CreditBarShowMore");return(0,a.jsxs)(r.Column,{paddingTop:"size120",children:[e.map(((e,i)=>!C&&i>=t?null:(0,a.jsx)(c.SubscriptionItem,{subscription:e,onPress:_},`${e.id}-${i}`))),e.length>t&&(0,a.jsx)(p.BodyText,{style:S.text,onPress:m,children:f})]})})),(e=>({subscriptions:e.subscriptions,displayLimit:e.displayLimit,shouldUseGPlayBilling:C.default.shouldUseGooglePlayBillingForSubscriptions(),commerceConfig:m.default.getS4LCommerceFeatures(),callingSubscriptionFeatures:m.default.getS4LEntitlementFeatures().SCE.CallingSubscriptions.Features})))},568394:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSubscriptionCountryName=function(e){var t;let i=a.default.subscriptionHasLocalizedName(e)&&(null===(t=e.data)||void 0===t?void 0:t.nameFormatted)||n.getString("Entitlements.DefaultSubscriptionName");const o=i.split(" ");o.length>3&&(i=`${o.slice(0,3).join(" ")}...`);return i};const o=i(197582),a=o.__importDefault(i(37679)),n=o.__importStar(i(704704))},106774:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreditBarSection=void 0;const o=i(197582).__importDefault(i(229821));t.CreditBarSection=o.default},326707:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleSubscriptionDetailPress=function(e,t,i,o,d){n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,`credit bar handleSubscriptionDetailPress subscription id ${e.id}`),n.Instrumentation.track(new r.SubscriptionDetailsLinkClick(e.id));const u=o.nativeProducts.manageSubscription,h=u.apple.subscriptionPlanRegExp,p=u.gPlay.subscriptionPlanRegExp,g=u.apple.enabled,C=u.gPlay.enabled;g||n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,"iOS manageable subscriptions disabled.");C||n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,"GPlay manageable subscriptions disabled.");const m=!!function(e,t){let i;try{i=new RegExp(e)}catch(e){const t=l.default.asString(e);return n.Instrumentation.error(s.LogTraceArea.SubscriptionDataSection,t),void n.Instrumentation.track(new r.EntitlementIntegrationError("ios_plan_regexp",t))}const o=t&&t.plan;if(!o){const e=`No plan information: ${l.default.asString(t)}`;return n.Instrumentation.error(s.LogTraceArea.SubscriptionDataSection,e),void n.Instrumentation.track(new r.EntitlementIntegrationError("plan_missing",e))}return i.test(o)}(h,e.attributes),S=!!function(e,t){let i;try{i=new RegExp(e)}catch(e){const t=l.default.asString(e);return n.Instrumentation.error(s.LogTraceArea.SubscriptionDataSection,t),void n.Instrumentation.track(new r.EntitlementIntegrationError("gplay_plan_regexp",t))}const o=t&&t.plan;if(!o){const e=`No plan information: ${l.default.asString(t)}`;return n.Instrumentation.error(s.LogTraceArea.SubscriptionDataSection,e),void n.Instrumentation.track(new r.EntitlementIntegrationError("plan_missing",e))}return i.test(o)}(p,e.attributes),_=d.ManageSubscriptionsUXImprovements||function(e,t){let i=!1;if(t){if(e){const e=c.default.getPlatformType();i=[s.PlatformType.iOS,s.PlatformType.OSX].includes(e)}else i=!1;n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,`Result: ${i}`)}return i}(g,m)||function(e,t){let i=!1;t&&(i=e,n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,`Result: ${i}`));return i}(C,S)||function(e,t){n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,`Check is manageable subscription: ${l.default.asString(t)}`);const i=!e;return n.Instrumentation.log(s.LogTraceArea.SubscriptionDataSection,`Result: ${i}`),i}(i,e.attributes);a.default.showDialog({isManageAble:_,commerceConfig:o,appleInAppSubscription:m,gplayInAppSubscription:S,subscription:e},t)};const o=i(197582),a=o.__importDefault(i(384808)),n=i(82485),s=i(815146),r=o.__importStar(i(287687)),l=o.__importDefault(i(655192)),c=o.__importDefault(i(139221))},642542:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MinorProtectionBanner=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(667294),r=i(344175),l=o.__importStar(i(704704)),c=i(825419),d=o.__importDefault(i(20758)),u=i(154235),h=i(526849),p=o.__importDefault(i(150343)),g=i(287687),C=o.__importStar(i(50350)),m=i(736267),S=i(82485),_=i(815146),f=i(483753),y=(0,h.WithResub)(n.memo((({giveLinkUrl:e,learnMoreUrl:t})=>{const i=(0,m.useCommonContext)(),o=(0,r.useSUIThemeStyles)((e=>({container:{backgroundColor:e.colors.surfaceSecondary,borderRadius:12,borderWidth:1,borderColor:e.colors.strokeHighContrast},text:{textAlign:"center",fontSize:d.default.fontSize.size12,lineHeight:16,marginBottom:4,paddingHorizontal:12},link:{fontSize:d.default.fontSize.size12,letterSpacing:-.24,marginVertical:4,textAlign:"center",fontWeight:u.FontWeight.semiBold}})),[]),n=(0,s.useCallback)(((e,t)=>{S.Instrumentation.track(new g.AADCPanelLoaded(g.AADCExperienceLoaded.BalancePanelScreenLoaded,e)),C.openUrl(_.BrowserOrigin.SubscriptionDataSection,t,i.rootViewId)}),[i.rootViewId]);return(0,a.jsxs)(r.Box,{style:o.container,margin:"size200",paddingX:"size80",paddingY:"size160",alignItems:"center",children:[(0,a.jsx)(c.BodyText,{style:o.text,children:l.getString("BalanceStatePanel.AgeAppropriateInfo")}),e&&(0,a.jsx)(f.Link,{url:e,style:o.link,onPress:()=>n(g.AADCLInfoLinksClickTarget.GiftSkypeCreditFAQLinkClicked,e),children:l.getString("QuickCallPanel.MinorProtectionBannerGift")}),t&&(0,a.jsx)(f.Link,{url:t,style:o.link,onPress:()=>n(g.AADCLInfoLinksClickTarget.AADCLearnMoreLinkClicked,t),children:l.getString("QuickCallPanel.MinorProtectionBannerSettings")})]})})),(()=>({learnMoreUrl:p.default.getConfigSettingsNoSubscription().skypeGoLinks.aadcLearnMoreLink,giveLinkUrl:p.default.getConfigSettingsNoSubscription().skypeGoLinks.giftSkypeCreditLink})));t.MinorProtectionBanner=y},18858:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneTabPanel=void 0;const o=i(197582),a=i(785893),n=i(667294),s=i(188972),r=i(959835),l=i(619905),c=o.__importDefault(i(246038)),d=i(597667),u=o.__importDefault(i(463171)),h=i(815146),p=i(249549),g=i(526849),C=o.__importDefault(i(247286)),m=i(385855),S=(0,n.forwardRef)((({isChildOrMinor:e,emptyStateEmoticon:t},i)=>{const[o,g]=(0,n.useState)(!1),[C]=(0,n.useState)((0,d.getResultListMode)(p.Tab.Phone)),[S,_]=(0,n.useState)(0),f=(0,n.useCallback)((e=>{_(e)}),[]),y=(0,n.useMemo)((()=>[{template:e?l.CallsListHeader.IsMinor:l.CallsListHeader.PhoneCommerceSection,height:e?s.MINOR_COMPONENT_MAX_HEIGHT:s.CREDIT_COMPONENT_AVG_HEIGHT}]),[e]),T=(0,n.useCallback)((e=>{g(0===e),u.default.setPhoneCallsEmpty(e)}),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.default,{scrollTop:S,searchOrigin:h.SearchPanelInitiator.PhoneTabPanel}),(0,a.jsx)(r.CallsListSection,{ref:i,categoryFilter:p.Tab.Phone,searchGroups:C,showEmptyIllustration:o,emptyStateEmoticon:t,handleResultsCountChange:T,onScroll:f,headers:y,topInset:m.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT})]})})),_=(0,g.WithResub)((0,n.memo)(S),(e=>Object.assign(Object.assign({},e),{isChildOrMinor:C.default.isChildOrMinor()})));t.PhoneTabPanel=_},298174:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MinorProtectionBanner=t.PhoneButtonsSection=t.PhoneTabPanel=void 0;const o=i(197582);var a=i(18858);Object.defineProperty(t,"PhoneTabPanel",{enumerable:!0,get:function(){return a.PhoneTabPanel}});var n=i(188972);Object.defineProperty(t,"PhoneButtonsSection",{enumerable:!0,get:function(){return o.__importDefault(n).default}});var s=i(642542);Object.defineProperty(t,"MinorProtectionBanner",{enumerable:!0,get:function(){return s.MinorProtectionBanner}})},177727:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;const o=i(537180);t.styles=o.StyleSheet.create({buttonSectionContainer:{paddingBottom:20},phoneHorizontalScrollViewContentContainer:{flexGrow:1,justifyContent:"flex-start",alignItems:"stretch",minWidth:"100%",gap:8,paddingHorizontal:12}})},246038:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({scrollTop:e,searchOrigin:t}){const i=(0,n.useCallback)((()=>{const e=c.default.newCauseId();u.log(d.LogTraceArea.CallsTabPanel,`[SearchSection][onSearchButtonClick][${e}]`),u.track(new h.CallTabsSearchTelemetry(t)),u.track(new p.PressAction(p.PressScenario.SearchNavigation,t)),l.default.navigateToSearch({searchOrigin:t},e)}),[t]);return(0,a.jsx)(r.CollapsibleHeaderSearch,{value:e,valueFrom:0,valueTo:g,placeholder:s.getString("SearchInputControl.PlaceHolderTextShort"),onPress:i})};const o=i(197582),a=i(785893),n=i(667294),s=o.__importStar(i(704704)),r=i(927164),l=o.__importDefault(i(740794)),c=o.__importDefault(i(760989)),d=i(815146),u=o.__importStar(i(85385)),h=i(287153),p=i(503308),g=50},37357:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CALLS_BUTTONS_COMPONENT_HEIGHT=void 0;const o=i(197582),a=i(785893),n=i(344175),s=i(667294),r=i(667294),l=o.__importStar(i(704704)),c=o.__importDefault(i(537882)),d=i(641400),u=i(154235),h=o.__importStar(i(85385)),p=i(815146),g=o.__importDefault(i(740794)),C=o.__importDefault(i(760989)),m=o.__importDefault(i(92179)),S=o.__importDefault(i(375809)),_=i(96575),f=i(736267),y=i(206315),T=o.__importDefault(i(827361)),b=i(287153),v=i(249549),I=i(503308),w=i(966666);t.CALLS_BUTTONS_COMPONENT_HEIGHT=125;const P=e=>{e.stopPropagation();const t=C.default.newCauseId();h.log(p.LogTraceArea.CallsTabPanel,`[ButtonsSection][onMeetNowPress][${t}]`),h.track(new b.CallTabsButtonsTelemetry(v.Tab.Calls,v.Buttons.MeetNow,v.ButtonEvents.Press));const i=C.default.newCauseId();m.default.createOneShotTrackerAndMarkPressTime(i,_.ScenarioName.ResponsivenessMeetNow,e),h.track(new I.PressAction(I.PressScenario.MeetNow,w.MeetNowOrigin.CallsTabMobile)),S.default.navigateToCreateOrJoinFlyout()};t.default=(0,s.memo)((()=>{const e=(0,f.useCommonContext)(),{themeColors:{iconOnColor:i,iconPrimary:o,textOnColor:s,textPrimary:m,surfaceAltFill:S,dividerPrimary:_},gradients:{secondary:I},mode:{isAccessible:w}}=(0,y.useSkypeTheme)(),M=(0,r.useCallback)((t=>{t.stopPropagation();const i=C.default.newCauseId();h.log(p.LogTraceArea.CallsTabPanel,`[ButtonsSection][onAudioCallPress][${i}]`),h.track(new b.CallTabsButtonsTelemetry(v.Tab.Calls,v.Buttons.AudioCall,v.ButtonEvents.Press)),g.default.navigateToQuickCallPanelWithParams({causeId:i,newGroup:!0},e.rootViewId)}),[e.rootViewId]);return(0,a.jsxs)(n.Row,{height:t.CALLS_BUTTONS_COMPONENT_HEIGHT,paddingX:"size120",paddingY:"size200",children:[(0,a.jsx)(c.default,{title:l.getString("CallTab.StartACallButton"),icon:d.SkypeIcon.VideoFilled,iconColor:i,buttonStyle:u.SXButtonStyle.GradientFill,buttonConfig:{textColor:s},onPress:M,style:T.default.shadowLightStyle}),(0,a.jsx)(c.default,{title:l.getString("CallTab.CreateACallButton"),accessoryView:I&&2===I.length?(0,d.getIcon)(d.SkypeIcon.Link,d.IconSize.size24,o,{gradientcolor1:I[0],gradientcolor2:I[1]}):void 0,buttonStyle:u.SXButtonStyle.ThemeFill,buttonConfig:{backgroundColor:S,textColor:m,borderColor:w?_:void 0},onPress:P,style:T.default.shadowLightStyle})]})}))},537882:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(331654),r=o.__importDefault(i(660401)),l=o.__importDefault(i(20758)),c=i(26703),d=i(154235),u=o.__importDefault(i(960282)),h=o.__importDefault(i(958868)),p=(0,c.lazyProperties)({button:()=>n.Styles.createButtonStyle({flexGrow:1,flexShrink:1,flexBasis:0,marginHorizontal:4,borderRadius:8}),buttonText:()=>n.Styles.createTextStyle({font:l.default.font.uiDisplayRegular,fontSize:13,lineHeight:18}),innerContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",flex:1,borderRadius:8,minHeight:90}),innerContainerLandscape:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",flex:1,borderRadius:8,minHeight:90})});function g({title:e,accessoryView:t,icon:i,iconColor:o,buttonStyle:s,buttonConfig:l,onPress:c,style:u,isLandscape:h}){return(0,a.jsx)(r.default,{textStyleOverride:[p.buttonText],style:n.Styles.combine([p.button,u]),buttonStyle:s,onPress:c,title:e,accessoryView:t,icon:i,iconColor:o,iconPositon:h?d.SXButtonIconPosition.Start:d.SXButtonIconPosition.Top,buttonConfig:l,innerContainerStyle:h?p.innerContainerLandscape:p.innerContainer,backgroundStyle:{height:void 0}})}class C extends h.default{_buildState(){const e=this._getRootViewId();return{isLandscape:u.default.getDeviceOrientation(e)===s.DeviceOrientation.Landscape}}render(){return(0,a.jsx)(g,Object.assign({},this.state,this.props))}}t.default=C},621777:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsTabPanel=t.CallsTabPanelInternal=void 0;const o=i(197582),a=i(785893),n=i(667294),s=i(959835),r=i(619905),l=i(597667),c=o.__importDefault(i(246038)),d=o.__importDefault(i(463171)),u=i(815146),h=i(249549),p=i(526849),g=i(385855),C=i(704704),m=i(571059),S=i(375369),_=i(37357);t.CallsTabPanelInternal=(0,n.forwardRef)((({emptyStateEmoticon:e},t)=>{const[i,o]=(0,n.useState)(!1),[p]=(0,n.useState)((0,l.getResultListMode)(h.Tab.Calls)),[f,y]=(0,n.useState)(0),T=(0,n.useCallback)((e=>{y(e),(0,S.getHubTabScrollStore)("calls").setValue(e)}),[]),b=[{template:r.CallsListHeader.CallButtonSection,height:_.CALLS_BUTTONS_COMPONENT_HEIGHT}],v=(0,n.useCallback)((e=>{o(0===e),d.default.setPhoneCallsEmpty(e)}),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(c.default,{scrollTop:f,searchOrigin:u.SearchPanelInitiator.CallsTabPanel}),(0,a.jsx)(s.CallsListSection,{ref:t,categoryFilter:h.Tab.Calls,searchGroups:p,showEmptyIllustration:i,emptyStateEmoticon:e,emptyStateHeader:(0,a.jsx)(m.IllustrationScreenHeader,{headerText:(0,C.getString)("QuickCallPanel.NoCallsTitleModernized"),bodyText:(0,C.getString)("QuickCallPanel.NoCallsInfoModernized"),useThemeHeaderColor:!0}),handleResultsCountChange:v,onScroll:T,headers:b,topInset:g.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT})]})})),t.CallsTabPanel=(0,p.WithResub)((0,n.memo)(t.CallsTabPanelInternal),(e=>Object.assign({},e)))},307800:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsButtonsSection=t.CallsTabPanel=void 0;const o=i(197582);var a=i(621777);Object.defineProperty(t,"CallsTabPanel",{enumerable:!0,get:function(){return a.CallsTabPanel}});var n=i(37357);Object.defineProperty(t,"CallsButtonsSection",{enumerable:!0,get:function(){return o.__importDefault(n).default}})},224286:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=i(16549),l=200;class c extends s.ComponentBase{constructor(e){super(e),this._loopDuration=3e3,this._backgroundRing1ScaleAnimatedValue=new n.Animated.Value(1),this._backgroundRing1ScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing1ScaleAnimatedValue}]}),this._backgroundRing2ScaleAnimatedValue=new n.Animated.Value(1),this._backgroundRing2ScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing2ScaleAnimatedValue}]}),this._backgroundRing3ScaleAnimatedValue=new n.Animated.Value(1),this._backgroundRing3ScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing3ScaleAnimatedValue}]})}_startAnimation(){this._animation=n.Animated.parallel([n.Animated.sequence([n.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{delay:.3*this._loopDuration,toValue:1.9,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1}),n.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.5,0,1,1),duration:.2*this._loopDuration,isInteraction:!1})]),n.Animated.sequence([n.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:2.1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.66*this._loopDuration,isInteraction:!1}),n.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.7,0,1,1),duration:.33*this._loopDuration,isInteraction:!1})]),n.Animated.sequence([n.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:2.3,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.75*this._loopDuration,isInteraction:!1}),n.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.9,0,1,1),duration:.25*this._loopDuration,isInteraction:!1})])]),this._animation.start((()=>{this.isComponentMounted()&&this.props.animate&&this._startAnimation()}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!e.animate&&this.props.animate&&this._startAnimation()}componentDidMount(){super.componentDidMount(),this.props.animate&&this._startAnimation()}_containerStyle(){const e=this.props.size||l;return n.Styles.createViewStyle({overflow:"visible",width:e,height:e,alignItems:"center",justifyContent:"center"},!1)}_backgroundRing1Style(){const e=this.props.size||l;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:r.Color.gray300,opacity:.35},!1)}_backgroundRing2Style(){const e=this.props.size||l;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:r.Color.gray300,opacity:.15},!1)}_backgroundRing3Style(){const e=this.props.size||l;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:r.Color.gray300,opacity:.15},!1)}_backgroundRing0Style(){const e=this.props.size||l;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:r.Color.gray300,opacity:.07,transform:[{scale:2.3}]},!1)}render(){return(0,a.jsx)(n.View,{style:this.props.style,blockPointerEvents:!0,children:(0,a.jsxs)(n.View,{style:this._containerStyle(),children:[(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing0Style()]}),(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing1Style(),this._backgroundRing1ScaleAnimatedStyle]}),(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing2Style(),this._backgroundRing2ScaleAnimatedStyle]}),(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing3Style(),this._backgroundRing3ScaleAnimatedStyle]})]})})}}t.default=c},102333:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(601976)),l=o.__importDefault(i(970035)),c=i(26703),d=o.__importStar(i(704704)),u=i(16549),h=o.__importDefault(i(20758)),p=i(641400),g=i(262725),C=(0,c.lazyProperties)({contentContainer:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>n.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>n.Styles.createTextStyle({fontSize:h.default.controlFontSize.caption}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>n.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>n.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>n.Styles.createViewStyle({marginLeft:15})});class m extends s.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:r.default.getDisplayName(e.conversationMri)||""}}render(){return(0,a.jsxs)(n.View,{style:[this.props.containerStyle,C.container],children:[(0,a.jsxs)(n.View,{style:C.contentContainer,children:[this._renderTeamsIcon(),this._renderTextContent()]}),this._renderDismissButton()]})}_renderTeamsIcon(){return(0,a.jsx)(l.default,{style:C.translationIconDesktop,icon:p.SkypeIcon.MSTeams,color:u.Color.white,size:p.IconSize.size24},"teamsIcon")}_renderTextContent(){return(0,a.jsx)(n.View,{style:C.textContentContainer,children:(0,a.jsx)(g.BodyText,{style:this._getTextStyles(),children:d.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})})},"textContentContainer")}_renderDismissButton(){return(0,a.jsx)(l.default,{style:C.dismissButtonDesktop,color:u.Color.white,onPress:this._onDismiss,size:p.IconSize.size24,icon:p.SkypeIcon.Cancel},"dismissButton")}_getTextStyles(){return[this.props.textStyle,C.textContent]}}t.default=m},90882:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(854646),s=o.__importStar(i(516778)),r=i(217041),l=i(843890),c=o.__importStar(i(44717)),d=i(815146),u=o.__importStar(i(85385)),h=i(26703),p=o.__importDefault(i(341126)),g=o.__importDefault(i(363091)),C=i(16549),m=o.__importDefault(i(827361)),S=o.__importDefault(i(601274)),_=i(403396),f=i(596648),y=10,T=(0,h.lazyProperties)({bubbleContainer:()=>s.Styles.createViewStyle({flex:-1,flexDirection:"row"}),simpleBubbleContainer:()=>s.Styles.createViewStyle({maxWidth:260}),bubble:()=>s.Styles.createViewStyle({flex:-1,alignSelf:"flex-start",backgroundColor:C.Color.gray400,borderTopRightRadius:y,borderBottomLeftRadius:y,borderBottomRightRadius:y,padding:15,marginBottom:4,marginHorizontal:20}),bubbleSelf:()=>s.Styles.createViewStyle({flex:-1,alignSelf:"flex-end",backgroundColor:C.Color.gray50,borderTopLeftRadius:y,borderTopRightRadius:y,borderBottomLeftRadius:y,padding:15,marginBottom:4,marginHorizontal:20}),simpleBubble:()=>s.Styles.createViewStyle({flex:-1,padding:8}),bubbleGradient:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,borderTopRightRadius:y,borderBottomLeftRadius:y,borderBottomRightRadius:y}),bubbleText:()=>s.Styles.createTextStyle({color:C.Color.white,backgroundColor:C.Color.transparent}),bubbleTextSelf:()=>s.Styles.createTextStyle({color:C.Color.gray400,backgroundColor:C.Color.transparent}),userIcon:()=>s.Styles.createViewStyle({marginLeft:5})});class b extends r.ComponentBase{componentDidMount(){super.componentDidMount(),u.log(d.LogTraceArea.CallReactions,"TextReactionView.componentDidMount cuid: "+this.props.id),this._reactionOnScreenTimer=S.default.setTimeout((()=>{this._reactionOnScreenTimer=void 0,this.isComponentMounted()&&this.props.onAnimationEnd&&this.props.onAnimationEnd(this.props.id,this.props.mri)}),this.props.textTimeoutMs||3e3)}componentWillUnmount(){super.componentWillUnmount(),u.log(d.LogTraceArea.CallReactions,"TextReactionView.componentWillUnmount cuid: "+this.props.id),this._reactionOnScreenTimer&&(S.default.clearTimeout(this._reactionOnScreenTimer),this._reactionOnScreenTimer=void 0)}render(){const e=g.default.isMyMri(this.props.mri),t=c.isAgent(this.props.mri),i=e||this.props.hideBackground?void 0:(0,a.jsx)(n.GradientView,{style:T.bubbleGradient,colors:this.props.gradientColors,direction:n.GradientDirection.RIGHT}),o=e||this.props.hideUserIcon?void 0:(0,a.jsx)(_.UserIcon,{style:T.userIcon,size:f.UserIconSize.Size30,userMri:this.props.mri}),r=this.props.hideBackground?T.simpleBubble:e?T.bubbleSelf:T.bubble,d=e||this.props.hideBackground?T.bubbleTextSelf:T.bubbleText;let u;if(this.props.reaction){const e={renderMedia:!1,allowLargeEmoticons:!0,textOverrideStyle:d,allowTextFallbackEmoticons:!0,numberOfLines:this.props.hideBackground&&!t&&l.UICapabilities.textNumberOfLinesSupported()?10:void 0};u=(0,a.jsx)(p.default,{message:this.props.reaction,options:e})}else this.props.content&&(u=(0,a.jsx)(s.Text,{style:d,children:this.props.content}));const h=[];return this.props.hideBackground&&h.push(T.simpleBubbleContainer),this.props.onPress&&h.push(m.default.pointerCursor),this.props.style&&h.push(this.props.style),(0,a.jsx)(s.View,{style:h,onPress:this.props.onPress,activeOpacity:.8,children:(0,a.jsxs)(s.View,{style:T.bubbleContainer,children:[o,(0,a.jsxs)(s.View,{style:r,children:[i,u]})]})})}}t.default=b},6609:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(132680),r=i(77395),l=i(970035),c=i(26703),d=o.__importStar(i(704704)),u=i(276602),h=o.__importDefault(i(20758)),p=i(641400),g=i(262725),C=o.__importDefault(i(497910)),m=o.__importDefault(i(989819)),S=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16}),labelStyle:()=>n.Styles.createTextStyle({textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,fontSize:h.default.fontSize.size13Deprecated,font:h.default.font.uiDisplayRegular}),iconStyle:()=>n.Styles.createViewStyle({overflow:"visible"}),iconCompactStyle:()=>n.Styles.createViewStyle({paddingHorizontal:8})});class _ extends C.default{constructor(){super(...arguments),this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()}}_buildState(e,t){return t&&(this._changeTogetherModeBackgroundCommand=new u.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri)),{canChangeTogetherModeBackground:this._changeTogetherModeBackgroundCommand.canExecute(),compactView:s.CallUIUtils.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}render(){if(!this.state.canChangeTogetherModeBackground)return null;const e=d.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t=[S.iconStyle,this.state.compactView?S.iconCompactStyle:void 0],i={style:S.container,title:e,accessibilityLabel:e,onPress:this._onTogetherModeBackgroundChangeButtonPress};let o;return this.state.compactView||(o=(0,a.jsx)(g.BodyText,{style:[S.labelStyle,{color:this.props.labelColor}],children:e})),(0,a.jsxs)(r.HoverableButton,Object.assign({},i,{children:[(0,a.jsx)(l.IconView,{icon:m.default.getBackgroundChangeButtonIcon(),size:p.IconSize.size16,color:this.props.labelColor,style:t}),o]}))}}t.default=_},681976:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(815146),r=o.__importDefault(i(970035)),l=o.__importStar(i(85385)),c=i(26703),d=o.__importDefault(i(252089)),u=o.__importStar(i(437782)),h=i(16549),p=o.__importDefault(i(20758)),g=i(641400),C=i(262725),m=o.__importDefault(i(497910)),S=(0,c.lazyProperties)({image:()=>n.Styles.createViewStyle({borderColor:h.Color.transparent,backgroundColor:h.Color.gray400}),imageHoverBorder:()=>n.Styles.createImageStyle({borderColor:h.Color.gray200Overlay20}),imageHoverBackground:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray200Overlay60}),centerContent:()=>n.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4,position:"relative"}),maxAudienceIconAndValue:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",position:"absolute",top:13,right:13,backgroundColor:"#2B2C33D8",paddingHorizontal:2}),maxAudienceIcon:()=>n.Styles.createViewStyle({marginBottom:2,marginRight:4}),maxAudienceText:()=>n.Styles.createTextStyle({color:h.Color.white}),backgroundItem:()=>n.Styles.createViewStyle({justifyContent:"center",marginTop:4}),backgroundName:()=>n.Styles.createTextStyle({textAlign:"left",color:h.Color.white,marginTop:8}),textLine:()=>n.Styles.createViewStyle({marginLeft:5}),selectedTextStyleDark:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray400}),selectedTextStyleWhite:()=>n.Styles.createViewStyle({backgroundColor:h.Color.white})});class _ extends m.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._onPress=()=>{l.log(s.LogTraceArea.CallingUI,"TogetherModeBackgroundItem: _onPress Background Selected "+u.dev_unknownOmit(this.props.backgroundDetails.untranslatedName)),this.props.onSelected(this.props.backgroundDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{isHoveringOn:!1,selectedColor:d.default.getPrimaryColor(),primaryBackgroundColorStyle:d.default.getPrimaryBackgroundColorStyle()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}render(){const e=this.props.backgroundDetails.label,t=n.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1),i=[S.image,t,this._getExtraBorderStyle()],o=(0,a.jsx)(C.Caption,{style:[S.backgroundName,this._getCaptionStyles()],numberOfLines:1,children:e}),s=n.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1),l=(0,a.jsxs)(n.View,{style:S.maxAudienceIconAndValue,children:[(0,a.jsx)(r.default,{style:S.maxAudienceIcon,size:g.IconSize.size14,color:h.Color.white,icon:g.SkypeIcon.ContactGroup}),(0,a.jsx)(n.Text,{style:[S.maxAudienceText,p.default.fontStyle.tertiaryButton],children:this.props.backgroundDetails.maxAudience})]});return(0,a.jsx)(n.GestureView,{onDoubleTap:this.props.onDoubleTap,children:(0,a.jsx)(n.View,{onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,children:(0,a.jsx)(n.Button,{ref:this._onContainerRef,style:[S.backgroundItem,s],onPress:this._onPress,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex,children:(0,a.jsxs)(n.View,{style:[S.centerContent,this._getExtraBackgroundStyle()],children:[(0,a.jsx)(n.Image,{style:i,source:this.props.backgroundDetails.url,resizeMode:"stretch"}),l,o]})})})})}_getCaptionStyles(){const e=[n.Styles.createViewStyle({width:this.props.width},!1),S.textLine];return this.props.isSelected?e.push(this.props.highContrastTheme?this._themeStyles.primaryBackgroundColorTextStyle:this.state.primaryBackgroundColorStyle):this.props.defaultTheme&&e.push(this._themeStyles.primaryTextColorStyle),e}_getExtraBackgroundStyle(){if(this.props.isSelected){const e=n.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return S.imageHoverBackground}_getExtraBorderStyle(){if(this.props.isSelected){const e=n.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return S.imageHoverBorder}}t.default=_},471856:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(217041),l=o.__importDefault(i(340724)),c=o.__importDefault(i(54945)),d=i(26703),u=o.__importStar(i(704704)),h=o.__importDefault(i(924849)),p=o.__importDefault(i(681976)),g=(0,d.lazyProperties)({scrollView:()=>s.Styles.createScrollViewStyle({flex:1})}),C="source";class m extends r.ComponentBase{constructor(){super(...arguments),this._mountedItemRefsMap=new h.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==c.default.UP&&e.keyCode!==c.default.LEFT||(t-=1),e.keyCode!==c.default.DOWN&&e.keyCode!==c.default.RIGHT||(t+=1),t<0||t>=this.props.backgroundsList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return(0,a.jsx)(s.ScrollView,{style:g.scrollView,onKeyPress:this._onKeyPress,showsVerticalScrollIndicator:!1,children:(0,a.jsx)(s.View,{style:this.props.style,children:this._getAvailableBackgrounds()})})}_focusItem(e=0){if(e<0||e>=this.props.backgroundsList.length)return;const t=this._mountedItemRefsMap.ref(C+e);null==t||t.requestFocus()}_getAvailableBackgrounds(){return n.map(this.props.backgroundsList,((e,t)=>{const i=!!this.props.selectedBackground&&e.sceneId===this.props.selectedBackground.sceneId,o=e.sceneId,n=e.label;let s=u.getString("TogetherModeModal.BackgroundAccessibilityLabel",{name:n,currentItemIndex:t+1,numberOfItems:this.props.backgroundsList.length});return i&&(s=l.default.combinedAccessibilityLabel(s,u.getString("Global.SelectedAccessibilityLabel"))||""),(0,a.jsx)(p.default,{ref:this._mountedItemRefsMap.onComponentRef(C+t),tabIndex:this.state.focusedIndex===t?0:-1,backgroundDetails:e,onSelected:this.props.onItemSelected,isSelected:i,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,onDoubleTap:this.props.onItemDoubleTap,accessibilityLabel:s,highContrastTheme:this.props.highContrastTheme,stackNavigation:this.props.stackNavigation,defaultTheme:this.props.defaultTheme},o)}))}}t.default=m},37115:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return null}},717583:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TouchBar=void 0;const o=i(197582);var a=i(37115);Object.defineProperty(t,"TouchBar",{enumerable:!0,get:function(){return o.__importDefault(a).default}})},970029:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(150343)),r=o.__importDefault(i(369347)),l=i(619429),c=i(154235),d=o.__importDefault(i(615364)),u=o.__importDefault(i(601976)),h=i(815146),p=o.__importDefault(i(453761)),g=i(970035),C=o.__importDefault(i(524526)),m=o.__importStar(i(85385)),S=i(26703),_=o.__importStar(i(704704)),f=o.__importDefault(i(341994)),y=o.__importDefault(i(740794)),T=o.__importDefault(i(942724)),b=o.__importDefault(i(960282)),v=o.__importStar(i(437782)),I=o.__importDefault(i(660401)),w=i(16549),P=i(641400),M=o.__importDefault(i(52066)),D=o.__importDefault(i(827361)),A=i(262725),k=o.__importDefault(i(497910)),R=o.__importDefault(i(558870)),x=o.__importDefault(i(760989)),L=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",borderTopWidth:1,borderStyle:"solid",backgroundColor:w.Color.whiteOverlay20,justifyContent:"flex-start",alignItems:"center"}),textContent:()=>n.Styles.createTextStyle({flexShrink:1,paddingLeft:10,paddingRight:45,marginVertical:8}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",alignItems:"center"}),textContentContainerMobile:()=>n.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"}),textContentContainerDeprecateDesktop:()=>n.Styles.createTextStyle({flexWrap:"nowrap"}),textContentDeprecationDesktop:()=>n.Styles.createTextStyle({flexShrink:1,flex:1}),textStyleMobile:()=>n.Styles.createTextStyle({fontSize:12}),buttonsContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:8,alignSelf:"center"}),buttonsContainerMobile:()=>n.Styles.createViewStyle({alignSelf:"flex-start"}),iconStyle:()=>n.Styles.createViewStyle({marginVertical:10,marginLeft:20}),closeIconStyle:()=>n.Styles.createViewStyle({marginVertical:10,marginRight:20}),actionButton:()=>n.Styles.createViewStyle({marginHorizontal:10})});class B extends k.default{constructor(){super(...arguments),this._onAcceptRequestPress=()=>{R.default.acceptTranslation(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeclineRequestPress=()=>{R.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeprecationAcceptPress=()=>{const e=x.default.newCauseId(),t=this.state.remoteUser.getMri();t?(R.default.requestTranslation(t,this.state.spokenLanguageLocale),y.default.navigateToConversation({convId:t,causeId:e,origin:h.NavigationConversationOrigin.EngagementNotice})):m.log(h.LogTraceArea.Calling,"TranslationConversationBanner._onDeprecationAcceptPress conversationId: "+v.mriOrId(this.props.conversationId)+" causeId: "+e)},this._onLearnMoreLinkPress=e=>{n.Linking.openUrl(s.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)},this._onDismiss=e=>{e.stopPropagation(),this.state.translationState===l.TranslationState.Pending?R.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale):this.state.translationState!==l.TranslationState.Requested&&this.state.translationState!==l.TranslationState.Enabled||f.default.setConversationTranslationBannerDismissState(this.props.conversationId,!0)},this._onSpokenLanguageLinkPress=e=>{e.preventDefault(),r.default.CallNavigationHelper.navigateToTranslationSettingsPanel(!1,this._getRootViewId())}}_buildState(e,t){const i=(0,d.default)().getConversation(e.conversationId),o=s.default.getS4LCMCFeatures().translatorAgentId;let a=e.conversationId;return i&&e.isDeprecated&&o&&(a=i.getMemberMrisWithoutMe().filter((e=>e!==o))[0]||a),{isDismissed:f.default.getConversationTranslationBannerDismissState(e.conversationId),isUsingStackNavigationContext:T.default.isUsingStackNavigationContextNoSubscription(),translationState:C.default.getConversationTranslationState(e.conversationId)||l.TranslationState.Disabled,spokenLanguageLocale:C.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isDeviceLanguageSupported:C.default.isDeviceLanguageSupportedForTranslation(),remoteUser:u.default.getDisplayableProfile(a),isSmallScreen:b.default.isWidthSmallerThanThreshold(1024,this._getRootViewId())}}render(){if(this.state.isDismissed||this.state.translationState===l.TranslationState.Disabled&&!this.props.isDeprecated)return null;if(this.state.isDeviceLanguageSupported&&this.state.translationState===l.TranslationState.Enabled)return null;const e=(0,a.jsx)(p.default,{style:L.closeIconStyle,hoverColor:this._getIconColor(),color:this._getIconColor(),onPress:this._onDismiss,title:_.getString("Global.CloseButtonTitle"),size:P.IconSize.size24,icon:P.SkypeIcon.Cancel});return(0,a.jsxs)(n.View,{style:this._getContainerStyles(),children:[this._renderTranslationIcon(),(0,a.jsxs)(n.View,{style:this._getTextContentContainerStyle(),children:[(0,a.jsx)(A.BodyText,{style:this._getTextStyles(),children:this._getText()}),this._renderOptionalActionButtons()]}),e]})}_renderOptionalActionButtons(){const{translationState:e,remoteUser:t}=this.state;return e===l.TranslationState.Pending?(0,a.jsxs)(n.View,{style:this._getButtonContainerStyle(),children:[(0,a.jsx)(I.default,{style:L.actionButton,buttonSize:c.SXButtonSize.Small,title:_.getString("TranslationBanner.AcceptButtonTitle"),onPress:this._onAcceptRequestPress}),(0,a.jsx)(I.default,{style:L.actionButton,buttonSize:c.SXButtonSize.Small,buttonStyle:c.SXButtonStyle.LightFill,title:_.getString("TranslationBanner.DeclineButtonTitle"),onPress:this._onDeclineRequestPress})]}):this.props.isDeprecated?(0,a.jsx)(n.View,{style:this._getButtonContainerStyle(),children:(0,a.jsx)(I.default,{style:L.actionButton,buttonSize:c.SXButtonSize.Small,title:_.getString("TranslationBanner.TryNewTranslationsButtonV2",{userName:t.getShortName()}),onPress:this._onDeprecationAcceptPress})}):void 0}_getButtonContainerStyle(){return[L.buttonsContainer,void 0,this.props.isDeprecated?D.default.flexZero:void 0]}_getTextContentContainerStyle(){return[L.textContentContainer,void 0,this._isDeprecatedOnWideScreen()?L.textContentContainerDeprecateDesktop:void 0]}_getContainerStyles(){const e=[L.container,this._themeStyles.headerShadowBorderColorStyle];return this._useAccessibleTheme()&&e.push(this._themeStyles.primaryBackgroundColorStyle),e}_renderTranslationIcon(){return(0,a.jsx)(g.IconView,{style:L.iconStyle,icon:P.SkypeIcon.SkypeTranslator,color:this._themeColors.primaryIconColor,size:P.IconSize.size24})}_getIconColor(){return this._themeColors.primaryTextColor}_getText(){return this.state.translationState===l.TranslationState.Requested?_.getString("TranslationBanner.RequestSentText",{userName:this.props.conversationName}):this.state.translationState===l.TranslationState.Pending?_.getParts("TranslationBanner.RequestReceivedTextv2",{userName:this.props.conversationName,learnMoreLink:this._getLearnMoreLink()}):this.props.isDeprecated?_.getParts("TranslationBanner.OldBotDeprecationTextV2",{date:this.props.translatorBotDeprecationDate||""}):this.state.isDeviceLanguageSupported||this.state.translationState!==l.TranslationState.Enabled?void 0:_.getParts("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedExplanation",{spokenLanguageLink:this._getLanguageSettingsLink()})}_getLearnMoreLink(){return(0,a.jsx)(M.default,{url:"#",blue:!0,onPress:this._onLearnMoreLinkPress,children:_.getString("UserSettingsPanel.TranslationCELAStatementLearnMore")},"keyLearnMore")}_getTextStyles(){return[L.textContent,this._themeStyles.primaryTextColorStyle,void 0,this._isDeprecatedOnWideScreen()?L.textContentDeprecationDesktop:void 0]}_isDeprecatedOnWideScreen(){return!!this.props.isDeprecated&&!this.state.isSmallScreen}_getLanguageSettingsLink(){return(0,a.jsx)(M.default,{url:"#",blue:!0,onPress:this._onSpokenLanguageLinkPress,children:_.getString("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedSelectLinkText")},"keySpokenLanguage")}}t.default=B},157786:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=o.__importDefault(i(150343)),l=o.__importDefault(i(970035)),c=i(26703),d=o.__importStar(i(704704)),u=o.__importDefault(i(341994)),h=i(16549),p=o.__importDefault(i(20758)),g=i(641400),C=o.__importDefault(i(52066)),m=i(262725),S=(0,c.lazyProperties)({contentContainer:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>n.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>n.Styles.createTextStyle({fontSize:p.default.controlFontSize.caption}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>n.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>n.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>n.Styles.createViewStyle({marginLeft:15})});class _ extends s.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss(),u.default.setInCallTranslationBannerDismissState(this.props.conversationMri,!0)},this._onLearnMoreLinkPress=e=>{n.Linking.openUrl(r.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)}}render(){return(0,a.jsxs)(n.View,{style:[this.props.containerStyle,S.container],children:[(0,a.jsxs)(n.View,{style:S.contentContainer,children:[this._renderTranslationIcon(),this._renderTextContent()]}),this._renderDismissButton()]})}_renderTranslationIcon(){var e,t;return(0,a.jsx)(l.default,{style:S.translationIconDesktop,icon:g.SkypeIcon.SkypeTranslator,color:null!==(e=this.props.iconColor)&&void 0!==e?e:h.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:g.IconSize.size16},"translationIcon")}_renderTextContent(){const e=d.getParts("TranslationBanner.TranslatedConversationInCallText",{learnMore:this._getLearnMoreLink()});return(0,a.jsx)(n.View,{style:S.textContentContainer,children:(0,a.jsx)(m.BodyText,{style:this._getTextStyles(),children:e})},"textContentContainer")}_renderDismissButton(){var e,t;return(0,a.jsx)(l.default,{style:S.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:h.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:g.IconSize.size24,icon:g.SkypeIcon.Cancel},"dismissButton")}_getLearnMoreLink(){return(0,a.jsx)(C.default,{style:this.props.linkStyle,url:"#",blue:!0,onPress:this._onLearnMoreLinkPress,children:d.getString("TranslationBanner.TranslatedConversationInCallLearnMoreLink")},"learnMoreLink")}_getTextStyles(){return[this.props.textStyle,S.textContent]}}t.default=_},144708:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(369347)),s=o.__importDefault(i(497910)),r=o.__importDefault(i(266311)),l=o.__importStar(i(704704)),c=i(641400),d=i(460515),u=o.__importDefault(i(26178)),h=o.__importDefault(i(867480)),p=o.__importDefault(i(150343)),g=i(97570),C="ShareQRPopup";class m extends s.default{constructor(){super(...arguments),this._onShareQRButtonPress=e=>{(0,g.trackTwincamShareIntent)(this.props.callId,"call_controls");const{twinCamDisableSyncMessageOnQRCodeClicked:t}=p.default.getS4LCMCFeaturesNoSubscription();t||n.default.CallPostMessageService.postTwincamSyncMessage(this.props.conversationMri),r.default.showPopup({getAnchor:this._getShareQRButtonRef,rootViewId:this._getRootViewId(),renderPopup:this._renderShareTwincamQRContent,preventDismissOnPress:!1,positionPriorities:["top","right"]},C)},this._renderShareTwincamQRContent=()=>{const{callId:e,conversationMri:t}=this.props;return(0,a.jsx)(h.default,{callId:e,conversationMri:t,leftOffset:this.props.isShowingRecents?100:0,onStopTwincamPressed:this.props.onStopTwincamPressed,isPopup:!0,isTwincamConnected:this.props.isTwincamConnected})},this._setShareQRButtonRef=e=>{this._shareTwincamQRButtonRef=e},this._getShareQRButtonRef=()=>this._shareTwincamQRButtonRef}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isTwincamConnected!==this.props.isTwincamConnected&&r.default.dismissPopup(C,this._getRootViewId())}render(){const{colorConfig:e,caption:t,callButtonSize:i,isDisabled:o,title:n,showToolTip:s,toolTipConfig:r,isTwincamConnected:h}=this.props,p=c.SkypeIcon.TwincamMidOffGradient;return h&&e&&(e.hoverIcon=void 0),(0,a.jsx)(u.default,{icon:h?p:c.SkypeIcon.TwincamMid,accessibilityLabel:l.getString("CallControlsOverFlowMenu.Twincam"),size:i,colorConfig:e,isDisabled:o,onPress:this._onShareQRButtonPress,caption:t,ref:this._setShareQRButtonRef,isToggledOn:h,title:n,showToolTip:s,toolTipConfig:r},d.CallControlsKeys.Twincam)}}t.default=m},867480:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(999591)),s=o.__importStar(i(817673)),r=o.__importStar(i(516778)),l=i(167606),c=o.__importDefault(i(620529)),d=o.__importStar(i(317588)),u=o.__importDefault(i(369347)),h=i(44557),p=o.__importDefault(i(660401)),g=i(262725),C=o.__importDefault(i(827361)),m=o.__importDefault(i(497910)),S=o.__importDefault(i(150343)),_=o.__importStar(i(704704)),f=i(154235),y=i(16549),T=i(26703),b=i(641400),v=i(970035),I=i(206197),w=i(483753),P=o.__importDefault(i(363091)),M=o.__importDefault(i(799585)),D=i(154235),A=i(766698),k=o.__importStar(i(85385)),R=(0,T.lazyProperties)({twincam:()=>r.Styles.createViewStyle({flexDirection:"column",alignItems:"center",flex:1,padding:20}),header:()=>r.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:y.Color.darkThemeBackground}),twincamViewContent:()=>r.Styles.createViewStyle({flexDirection:"column",alignItems:"center",flex:1}),twincamOffPopup:()=>r.Styles.createViewStyle({flexDirection:"row",borderRadius:8,shadowColor:y.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10,width:400,minHeight:583,marginBottom:20,backgroundColor:y.Color.darkThemeBackground}),twincamOnPopup:()=>r.Styles.createViewStyle({borderRadius:8,shadowColor:y.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10,width:320,marginBottom:20,backgroundColor:y.Color.darkThemeBackground}),darkAccessibleTwincamBorder:()=>r.Styles.createViewStyle({borderWidth:1,borderColor:y.Color.white}),twincamText:()=>r.Styles.createTextStyle({color:y.Color.white,textAlign:"center",fontSize:h.MeetNowFontSize.lobbySubtitleMedium}),twincamHeaderText:()=>r.Styles.createTextStyle({color:y.Color.white}),twincamTextPadding:()=>r.Styles.createTextStyle({color:y.Color.white,textAlign:"center",marginBottom:20,fontSize:h.MeetNowFontSize.lobbySubtitleSmall}),twincamTitle:()=>r.Styles.createTextStyle({color:y.Color.white,marginBottom:20,textAlign:"center",fontSize:h.MeetNowFontSize.lobbyTitle}),twincamCode:()=>r.Styles.createTextStyle({color:y.Color.white,marginBottom:20,textAlign:"center",fontSize:h.MeetNowFontSize.lobbySubtitleMedium}),qrBgPortrait:()=>r.Styles.createViewStyle({width:208,height:208,padding:10,borderRadius:10,backgroundColor:y.Color.white,marginBottom:20,marginTop:20,alignItems:"center"}),titleTwincamArea:()=>r.Styles.createViewStyle({marginBottom:10,marginTop:5,flexDirection:"row"}),titleTwincamText:()=>r.Styles.createTextStyle({color:y.Color.white,fontSize:h.MeetNowFontSize.lobbySubtitleSmall,textAlign:"center",marginLeft:10,paddingBottom:5}),learnMoreLink:()=>r.Styles.createTextStyle({textDecorationLine:"underline"})});class x extends m.default{constructor(){super(...arguments),this._pendingSetState={setState:null}}_cancelPendingSetState(){return this._pendingSetState.setState=null,this._pendingSetState={setState:this.setState.bind(this)},this._pendingSetState}_buildState(e,t){const{twinCamInsiderTextEnabled:i,twinCamRetailStepsTextEnabled:o,twinCamSendInitiatorId:a}=S.default.getS4LCMCFeatures(),r=this._cancelPendingSetState();let c=t?null:this.state.joinLink;const d={twincam:!0,threadId:e.conversationMri,callId:e.callId};a&&(d.twincamUser=P.default.getSkypeId());const h=u.default.CallingStore.getCall(e.callId);return h?h.getJoinBlob().then((e=>{var t;d.j=function(e){const t=n.deflateRaw(e);return(0,A.Uint8ArrayToBase64String)(t)}(e);const i=function(e){const t=s.stringify(e);return"skype:?call&"+t}(d);null===(t=r.setState)||void 0===t||t.call(r,{joinLink:i})})):(k.warn(l.LogTraceArea.CallingUI,`[TwincamShareView][_buildState] Failed to get call ${e.callId}, cannot generate join link`),c=null),{joinLink:c,useInsiderText:i&&!o,useRetailTextWithSteps:o}}componentWillUnmount(){super.componentWillUnmount(),this._cancelPendingSetState()}_getLearnMoreLink(){return(0,a.jsx)(w.Link,{url:S.default.getConfigSettingsNoSubscription().twinCam.learnMoreUrl,style:R.learnMoreLink,children:_.getString("CallControlsOverFlowMenu.TwincamHowToConnect")},"keyLearnMore")}_getFirstStepText(){return this.state.useInsiderText?_.getString("CallControlsOverFlowMenu.TwincamInstructionInsidersFirst"):this.state.useRetailTextWithSteps?_.getString("CallControlsOverFlowMenu.TwincamInstructionRetailFirst"):null}_getSecondStepText(){return this.state.useInsiderText||this.state.useRetailTextWithSteps?_.getString("CallControlsOverFlowMenu.TwincamInstructionSecond"):null}_renderStep(e,t){return e?(0,a.jsx)(g.BodyText,{style:[R.titleTwincamText,t],children:e}):null}_getIconColor(){return this._useDarkTheme()?y.Color.white:y.Color.black}render(){const e=this._useDarkTheme(),t=this._useAccessibleTheme(),i=e||t?h.MeetNowStyle.getStyle(t,e):h.MeetNowStyle.getThemeStyle(I.Theme.Delphi),o=this.props.isTwincamConnected?R.twincamOnPopup:R.twincamOffPopup,n=[R.twincam,this.props.leftOffset?r.Styles.createViewStyle({left:this.props.leftOffset},!1):void 0,this.props.isPopup?o:void 0,e?void 0:i.background],s={backgroundColor:this._themeColors.primaryBackgroundColor,textColor:this._themeColors.primaryTextColor},l=e?void 0:r.Styles.createTextStyle({color:s.textColor},!0);t&&e&&n.push(R.darkAccessibleTwincamBorder);const u=d.Collection.SKYPE_LOGO,m=this.props.isTwincamConnected?(0,a.jsx)(g.BodyText,{style:[R.twincamCode,l],children:_.getString("CallControlsOverFlowMenu.TwincamConnected")}):(0,a.jsxs)(r.View,{style:R.twincamViewContent,children:[(0,a.jsx)(r.View,{style:R.titleTwincamArea,children:(0,a.jsx)(v.IconView,{size:32,color:this._getIconColor(),icon:b.SkypeIcon.TwincamMid},"iconTwincam")}),(0,a.jsx)(g.Subtitle,{style:[R.twincamTitle,l],children:_.getString("CallControlsOverFlowMenu.AddTwincamVideo")}),(0,a.jsx)(g.BodyText,{style:[R.titleTwincamText,l],children:_.getString("CallControlsOverFlowMenu.TwincamInstructionTitle")}),this._renderStep(this._getFirstStepText(),l),this._renderStep(this._getSecondStepText(),l),(0,a.jsx)(r.View,{style:R.qrBgPortrait,children:this.state.joinLink?(0,a.jsx)(c.default,{message:this.state.joinLink,correctionLevel:"Q",style:C.default.flexOne,color:y.Color.black,backgroundColor:y.Color.white,iconSrc:u,iconHeight:50,iconWidth:50,iconExcavate:!0,size:188}):(0,a.jsx)(M.default,{style:C.default.flexOne,size:D.SXActivityIndicatorSize.Large,tintColor:y.Color.blue})}),(0,a.jsx)(g.BodyText,{style:[R.twincamTextPadding,l],children:_.getString("CallControlsOverFlowMenu.TwincamPrivacyNote")}),(0,a.jsx)(g.BodyText,{style:[R.twincamTextPadding,l],children:this._getLearnMoreLink()})]});return(0,a.jsxs)(r.View,{style:n,tabIndex:-1,accessibilityLabel:_.getString("MeetNowCallControls.Twincam"),children:[m,this.props.isTwincamConnected&&(0,a.jsx)(p.default,{buttonStyle:f.SXButtonStyle.DarkFill,buttonSize:f.SXButtonSize.Medium,title:_.getString("CallControlsOverFlowMenu.StopTwincam"),allowTextWrap:!0,onPress:this.props.onStopTwincamPressed})]})}}t.default=x},123719:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.show=function(e,t,i,o){x.log(M.LogTraceArea.UnansweredCall,"show causeId: "+o);const n=(0,a.jsx)(ce,{modalId:t,callId:e.originalCallId,conversationMri:e.originalConversationMri,unansweredCallOutput:e});return F.registerModalDialogDismissalException(t),_.default.showModal(n,t,i),e=>le(e,i.rootViewId,o)},t.dismiss=le;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(331654),r=o.__importStar(i(516778)),l=o.__importStar(i(623627)),c=o.__importDefault(i(659938)),d=o.__importDefault(i(150343)),u=o.__importDefault(i(54720)),h=o.__importDefault(i(192478)),p=o.__importDefault(i(702814)),g=o.__importDefault(i(369347)),C=i(619429),m=i(843890),S=o.__importStar(i(44717)),_=o.__importDefault(i(266311)),f=i(154235),y=o.__importDefault(i(555436)),T=o.__importDefault(i(615364)),b=o.__importDefault(i(288547)),v=o.__importStar(i(761393)),I=o.__importStar(i(170881)),w=o.__importDefault(i(601976)),P=o.__importDefault(i(37679)),M=i(815146),D=o.__importStar(i(800662)),A=i(77395),k=o.__importDefault(i(970035)),R=o.__importStar(i(626065)),x=o.__importStar(i(85385)),L=o.__importDefault(i(97595)),B=i(26703),V=o.__importDefault(i(432091)),O=o.__importStar(i(963369)),E=o.__importStar(i(704704)),N=o.__importDefault(i(731036)),F=o.__importStar(i(353831)),U=o.__importDefault(i(942724)),H=o.__importDefault(i(246230)),j=o.__importDefault(i(692012)),z=o.__importDefault(i(863132)),G=o.__importDefault(i(84830)),W=o.__importDefault(i(960282)),K=o.__importStar(i(437782)),$=i(96575),q=o.__importDefault(i(525864)),Q=i(375258),X=o.__importDefault(i(660401)),Z=i(16549),J=i(641400),Y=i(331079),ee=o.__importDefault(i(827361)),te=i(262725),ie=o.__importDefault(i(761896)),oe=i(247896),ae=o.__importDefault(i(685734)),ne=o.__importDefault(i(760989)),se=i(844086),re=(0,B.lazyProperties)({dialog:()=>r.Styles.createViewStyle({flex:1,alignItems:"stretch",justifyContent:"center"}),innerContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",padding:20}),title:()=>r.Styles.createTextStyle({marginTop:25,marginBottom:20,textAlign:"center",backgroundColor:Z.Color.transparent}),sectionTitle:()=>r.Styles.createViewStyle({flex:1,alignItems:"stretch",alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),sectionTitleText:()=>r.Styles.createTextStyle({paddingHorizontal:10}),message:()=>r.Styles.createTextStyle({marginTop:10,marginBottom:20,textAlign:"center",backgroundColor:Z.Color.transparent}),centeredText:()=>r.Styles.createTextStyle({textAlign:"center",backgroundColor:Z.Color.transparent}),permissionsText:()=>r.Styles.createTextStyle({paddingBottom:20}),permissions:()=>r.Styles.createViewStyle({alignSelf:"stretch"}),primaryButton:()=>r.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"}),messageComposerContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",marginTop:20,marginHorizontal:20}),actionContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",marginBottom:20}),feedbackButton:()=>r.Styles.createButtonStyle({marginTop:20})});function le(e,t,i){x.log(M.LogTraceArea.UnansweredCall,"dismiss causeId: "+i),F.unregisterModalDialogDismissalException(e),_.default.dismissModal(e,t)}class ce extends h.default{constructor(){super(...arguments),this._renderAction=(e,t)=>{switch(e.action){case C.UnansweredCallAction.SendMessage:if(S.isPhoneMri(this.props.conversationMri)||this.state.oneToOneConversationUnaccepted)return;const i=e.message&&0===t?(0,a.jsx)(te.BodyText,{bold:!0,style:re.centeredText,children:e.message}):void 0;return(0,a.jsxs)(r.View,{style:re.actionContainer,children:[i,this._renderMessageComposer(e.prepopulatedMessage)]},"composer"+t);case C.UnansweredCallAction.PromptForPermission:let o;this.props.unansweredCallOutput.reason===C.UnansweredCallReason.MicAndCamPermissionDenied?o=H.default.getDeniedPrompt(Y.PermissionType.MicrophoneAndCamera):this.props.unansweredCallOutput.reason===C.UnansweredCallReason.CameraPermissionDenied?o=H.default.getDeniedPrompt(Y.PermissionType.Camera):this.props.unansweredCallOutput.reason===C.UnansweredCallReason.MicrophonePermissionDenied?o=H.default.getDeniedPrompt(Y.PermissionType.Microphone):this.props.unansweredCallOutput.reason===C.UnansweredCallReason.ReadPhoneStatePermissionDenied&&(o=H.default.getDeniedPrompt(Y.PermissionType.ReadPhoneState));const n=o?(0,a.jsx)(te.BodyText,{bold:!0,style:[re.centeredText,re.permissionsText],children:o}):void 0,s=m.UICapabilities.systemSettingsDeepLinkSupported()?(0,a.jsx)(X.default,{style:re.primaryButton,buttonStyle:f.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:Z.AgnosticGradientFillButtonColors.blue,onPress:this._onPermissionSettingsPress,title:E.getString("UnansweredCallActions.Settings")}):void 0;return(0,a.jsxs)(r.View,{style:re.permissions,children:[n,s]},"permissions"+t);case C.UnansweredCallAction.SendFeedback:return(0,a.jsx)(A.HoverableButton,{onPress:this._onSendFeedbackPress,style:re.feedbackButton,children:(0,a.jsx)(te.BodyText,{bold:!0,style:re.centeredText,textThemeColor:te.TextThemeColor.Secondary,children:e.message},"sendfeedbacktext"+t)},"sendfeedbackbutton"+t);case C.UnansweredCallAction.CallPSTN:return this._renderCallButtons();case C.UnansweredCallAction.ShowRegulatoryInfoIndia||C.UnansweredCallAction.ShowRegulatoryInfoNetherlands:return this._renderRegulatoryInfoButton(e.action)}},this._onTitleOrMessageRef=e=>{this._titleOrMessageRef=e||void 0},this._onPermissionSettingsPress=()=>{r.Linking.openUrl("app-settings:")},this._onCallButtonPressed=e=>{const t=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCallButtonPressed mri: "+K.mriOrId(e)+" causeId: "+t),ie.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,C.UnansweredCallAction.CallPSTN,t),this._closeDialog(this._getRootViewId(),t),x.track(new oe.UnansweredCallCTA("cta_clicked")),g.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:!1,origin:M.NavigationCallOrigin.UnansweredCallPanel},t)},this._onMessageSent=e=>{const t=ne.default.newCauseId();return x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onMessageSent causeId: "+t),z.default.postMessageFromInput(this.props.conversationMri,M.PostSource.UnansweredCallPanel,e,void 0,{name:$.ScenarioName.SendTextMessage}),ie.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,C.UnansweredCallAction.SendMessage,t),this._closeDialog(this._getRootViewId(),t),!0},this._onSendFeedbackPress=e=>{const t=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onSendFeedbackPress causeId: "+t),e.stopPropagation(),G.default.reportProblem(!0,this._getRootViewId()),ie.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,C.UnansweredCallAction.SendFeedback,t),this._closeDialog(this._getRootViewId(),t)},this._onClickOutside=()=>{const e=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onClickOutside causeId: "+e),this._reportCancel(e)},this._onCancelPress=()=>{const e=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCancelPress causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)},this._onBack=()=>{const e=ne.default.newCauseId();return x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onBack causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),x.log(M.LogTraceArea.HardwareBackButton,"goBack: true componentId: UnansweredCallPanel"),!0},this._onEscape=()=>{const e=ne.default.newCauseId();return x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onEscape causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),!0},this._onAppStateChange=e=>{if(e===r.Types.AppActivationState.Background){const e=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onAppStateChange causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)}},this._closeDialog=(e,t)=>{x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._closeDialog causeId: "+t),le(this.props.modalId,e,t)},this._onPhoneActionsMenuClose=e=>{x.log(M.LogTraceArea.UnansweredCall,"_onPhoneActionsMenuClose causeId: "+e),b.default.close(this._getRootViewId(),e)},this._onTrySkypeToPhoneButtonRef=e=>{this._trySkypeToPhoneButtonRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),o=S.isOneOnOneConversation(e.conversationMri);let a;if(o){const t=(0,T.default)().getConversation(e.conversationMri);t?a=t.getOtherPartyMri():S.isSkypeIdMri(e.conversationMri)&&(a=e.conversationMri)}return{isLandscape:W.default.getDeviceOrientation(i)===s.DeviceOrientation.Landscape,isMobileScreenSize:W.default.isMobileScreenSize(i),title:e.unansweredCallOutput.title,oneToOneConversationUnaccepted:o&&!y.default.isConversationAccepted(e.conversationMri),displayName:w.default.getShortDisplayName(e.conversationMri)||E.getString("UnansweredCallTitle.UnknownCallee"),fullName:w.default.getDisplayName(e.conversationMri)||E.getString("UnansweredCallTitle.UnknownCallee"),isOneOnOne:o,localAddressBookContact:V.default.getContactByCorrespondingMri(e.conversationMri),userPhones:a?ae.default.getFullUserProfileByMri(a).phones:[],callActionUcuxEnabled:d.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.NewUcuxCallActionEnabled,hasEntitlements:P.default.userHasActiveEntitlements()}}componentDidMount(){super.componentDidMount();const e=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"componentDidMount causeId: "+e),this._titleOrMessageRef&&this._titleOrMessageRef.requestFocus(),I.dismissAll(),u.default.subscribe(this._onBack),L.default.addEscapeHandler(this._onEscape),this._activationSubToken=c.default.subscribeForChanges("UnansweredCallPanel",this._onAppStateChange)}componentWillUnmount(){super.componentWillUnmount();const e=ne.default.newCauseId();x.log(M.LogTraceArea.UnansweredCall,"componentWillUnmount causeId: "+e),u.default.unsubscribe(this._onBack),L.default.removeEscapeHandler(this._onEscape),this._reportCancel(e),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),D.setFocusWithDelay(D.FocusEvent.CloseUnansweredCallPanel,500)}render(){return(0,a.jsx)(q.default,{dialogId:this.props.modalId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:v.CompactWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:this.state.title||this.props.unansweredCallOutput.optionalSecondaryMessage||"",onClickOutside:this._onClickOutside,children:(0,a.jsx)(se.KeyboardAvoidingView,{children:this._content()})})}_renderMessageComposer(e){let t=[];return e&&(t=t.concat(new R.UnhandledEntity(e))),(0,a.jsx)(r.View,{style:[re.messageComposerContainer],children:(0,a.jsx)(N.default,{conversationId:this.props.conversationMri,otherPartyMri:void 0,hideMediaBar:!0,disableCopyPasteMedia:!0,hideEmoticonKeyboardIcon:!0,hideMediaPickerIcon:!0,hideStickerPickerIcon:!0,hideLocationPickerIcon:!0,hideContactPickerIcon:!0,hideOverflowMenu:!0,hideSmsIcon:!0,hideAudioMessage:!0,shouldAutoFocus:!!e,showSendControlWhenEmpty:!0,initialInputEntities:t,onMessageSent:this._onMessageSent})},"composer")}_renderRegulatoryInfoButton(e){let t="",i="";const o=d.default.getConfigSettingsNoSubscription().pstn;if(e===C.UnansweredCallAction.ShowRegulatoryInfoIndia?(t=o.indiaRegulatoryFaq,i=E.getString("PstnUtils.BlockedRegulatoryIndiaButton")):e===C.UnansweredCallAction.ShowRegulatoryInfoNetherlands&&(t=o.netherlandsRegulatoryFaq,i=E.getString("PstnUtils.BlockedRegulatoryNetherlandsButton")),!n.isEmpty(t)&&!n.isEmpty(i))return(0,a.jsx)(r.View,{style:re.actionContainer,children:(0,a.jsx)(X.default,{title:i,onPress:()=>{r.Linking.openUrl(t)},buttonSize:f.SXButtonSize.Medium,autoFocus:!0})},"regulatoryButton");x.warn(M.LogTraceArea.UnansweredCall,`Missing button properties for UnansweredCallAction: ${C.UnansweredCallAction[e]}; url = "${t}", buttonTitle = "${i}"`)}_renderCallButtons(){const e=O.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones);let t,i;if(e&&0!==e.length)return 1===e.length?(t=(0,a.jsx)(r.View,{style:re.sectionTitle,children:(0,a.jsx)(te.Subtitle,{style:[re.sectionTitleText,this._themeStyles.primaryTextColorStyle],children:E.getString("UnansweredCallActions.TrySkypeToPhoneButton")})}),i=this._renderCallButton(e[0].number)):i=this._renderTrySkypeToPhoneButton(e),x.track(new oe.UnansweredCallCTA("cta_shown")),(0,a.jsxs)(r.View,{style:re.actionContainer,children:[t,(0,a.jsx)(r.View,{style:re.messageComposerContainer,children:i})]},"placecall")}_renderCallButton(e){const t=S.sanitizeMri(e,S.Namespaces.PSTN),i=`${E.getString("UnansweredCallActions.CallName",{name:this.state.displayName})} ${e} `;return(0,a.jsx)(p.default,{isUsingStackNav:U.default.isUsingStackNavigationContextNoSubscription(),icon:J.SkypeIcon.SkypeOut,accessibilityLabel:i,phoneNumber:e,onPress:()=>this._onCallButtonPressed(t)},"callingbutton_"+e)}_renderTrySkypeToPhoneButton(e){return(0,a.jsx)(p.default,{ref:this._onTrySkypeToPhoneButtonRef,isUsingStackNav:U.default.isUsingStackNavigationContextNoSubscription(),icon:J.SkypeIcon.SkypeOut,phoneNumber:E.getString("UnansweredCallActions.TrySkypeToPhoneButton"),accessibilityLabel:E.getString("UnansweredCallActions.TrySkypeToPhoneButton"),onPress:()=>this._showPhoneActionsMenu(e)},"trySkypeToPhoneButton")}_headerCloseButton(){return{closeButtonType:Q.CloseButtonType.Close,title:E.getString("Global.CloseButtonTitle"),onPress:this._onCancelPress,color:this._themeColors.primaryIconColor}}_content(){const e=this.state.isMobileScreenSize&&this.state.isLandscape,t=(0,a.jsx)(Q.SimplePanelHeader,{leftButton:this._headerCloseButton(),hideBottomBorder:!0,floating:!0,useTransparentBackground:!0}),i=this.state.title?(0,a.jsx)(te.PanelHeader,{ref:this._onTitleOrMessageRef,landscape:e,style:re.title,children:this.state.title},"title"):void 0,o=this.props.unansweredCallOutput.optionalSecondaryMessage?(0,a.jsx)(te.PanelHeader,{ref:i?void 0:this._onTitleOrMessageRef,landscape:e,style:re.message,children:this.props.unansweredCallOutput.optionalSecondaryMessage},"message"):void 0;let s,c;if(n.some(this.props.unansweredCallOutput.actions,(e=>e.action===C.UnansweredCallAction.CallPSTN))){const e=O.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones),t=!S.isPhoneMri(this.props.conversationMri)&&!this.state.oneToOneConversationUnaccepted&&this.state.isOneOnOne&&e.length>0&&this.state.hasEntitlements;t&&x.track(new oe.UnansweredCallCTA("cta_eligible"));const i=t&&this.state.callActionUcuxEnabled?n.filter(this.props.unansweredCallOutput.actions,(e=>e.action===C.UnansweredCallAction.CallPSTN)):n.filter(this.props.unansweredCallOutput.actions,(e=>e.action===C.UnansweredCallAction.SendMessage));s=n.map(i,this._renderAction)}else s=n.map(this.props.unansweredCallOutput.actions,this._renderAction);if(this.props.unansweredCallOutput.visualInfo)switch(this.props.unansweredCallOutput.visualInfo.type){case C.UnansweredCallVisualInfoType.Emoticon:c=(0,a.jsx)(l.AnimatedEmoticon,{size:l.Size.ExtraLarge,emoticonName:this.props.unansweredCallOutput.visualInfo.name,standaloneAnimation:!0});break;case C.UnansweredCallVisualInfoType.Icon:c=(0,a.jsx)(k.default,{icon:this.props.unansweredCallOutput.visualInfo.name,size:J.IconSize.size80,color:Z.Color.gray300})}return(0,a.jsxs)(r.View,{style:ee.default.flexOne,children:[(0,a.jsxs)(r.View,{style:re.innerContainer,children:[c,i,o,s]},"innercontainer"),t]})}_reportCancel(e){x.log(M.LogTraceArea.UnansweredCall,"UnansweredCallPanel._reportCancel causeId: "+e),ie.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,C.UnansweredCallAction.None,e)}_showPhoneActionsMenu(e){const t=n.map(e,(e=>{const t=S.sanitizeMri(e.number,S.Namespaces.PSTN);return{props:{key:"pstnButton"+e.number+e.type,phone:e,keepSpaceForSubtitle:!0,onPress:()=>this._onCallButtonPressed(t)},builder:j.default.buildRow}}));b.default.showWithBuilders({builders:t,anchor:()=>this._trySkypeToPhoneButtonRef,getTitle:()=>this.state.fullName,onCloseMenu:this._onPhoneActionsMenuClose,rootViewId:this._getRootViewId()})}}t.default=ce},215687:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importDefault(i(369347)),r=o.__importStar(i(873324)),l=o.__importDefault(i(638260)),c=o.__importDefault(i(378473)),d=i(154235),u=i(119302),h=o.__importDefault(i(453761)),p=i(26703),g=o.__importStar(i(704704)),C=o.__importDefault(i(660401)),m=i(16549),S=i(641400),_=i(262725),f=o.__importDefault(i(760989)),y=(0,p.lazyProperties)({popupContainer:()=>n.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,backgroundColor:m.Color.darkThemeBackgroundOverlay85}),popupContainerLightTheme:()=>n.Styles.createViewStyle({backgroundColor:m.Color.whiteOverlay90}),popupContainerBackground:()=>n.Styles.createViewStyle({backgroundColor:m.Color.darkThemeBackground}),popupTitleRow:()=>n.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"}),backgroundReplacementContainer:()=>n.Styles.createViewStyle({marginBottom:15})});class T extends u.HoverPopup{constructor(){super(...arguments),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions()&&!this.state.isAwaitingConfirmation&&!this.state.shouldShowCloseButton,this._onClosePressed=()=>{this.state.shouldShowCloseButton&&this.setState({shouldShowCloseButton:!1},(()=>{this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._isPopupHovered=!1,this._hidePopup(!1)}))},this._onCameraSelected=(e,t)=>{const i=f.default.newCauseId();e&&(s.default.CallControlsStore.setIsAwaitingCameraConfirmation(!0),l.default.updateCallVideoSettingsPopupEvent((e=>{e.markDidChangeCameraDevice()})),s.default.DeviceStore.preselectDevices({camera:t},i))},this._onToggleBlur=e=>{l.default.updateCallVideoSettingsPopupEvent((t=>{e?t.toggleBlurOn():t.toggleBlurOff()}))},this._onBackgroundChangePress=e=>{this.props.onChangeBackgroundPress&&this.props.onChangeBackgroundPress()}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingConfirmation:s.default.CallControlsStore.isAwaitingCameraConfirmation(),enableBackgroundReplacement:s.default.DeviceStore.isBackgroundReplacementEnabled()})}componentWillUnmount(){super.componentWillUnmount(),this.state.isAwaitingConfirmation&&s.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),this.onClosed()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isAwaitingConfirmation&&!this.state.isAwaitingConfirmation&&this._hidePopup(!0)}renderContent(){const e={backgroundColor:m.Color.blue,textColor:m.Color.white},t=this.state.enableBackgroundReplacement&&(0,a.jsx)(n.View,{style:y.backgroundReplacementContainer,children:(0,a.jsx)(C.default,{buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.Custom,title:g.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),onPress:this._onBackgroundChangePress,buttonConfig:e,autoFocus:!1})}),i=this.state.shouldShowCloseButton?(0,a.jsx)(h.default,{icon:S.SkypeIcon.ClosePanel,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.primaryIconColor,size:S.IconSize.size20,onPress:this._onClosePressed,title:g.getString("AudioVideoSettings.VideoSettingsClose")}):void 0;return(0,a.jsxs)(n.View,{style:[y.popupContainer,this.props.useLightTheme?y.popupContainerLightTheme:void 0,this.props.isOutgoingVideoDisabled?y.popupContainerBackground:void 0],children:[(0,a.jsxs)(n.View,{style:y.popupTitleRow,children:[(0,a.jsx)(_.Subtitle,{children:g.getString("CallControlsOverFlowMenu.AdjustVideoSettings")}),i]}),(0,a.jsx)(c.default,{colorThemeOverride:this._currentTheme,hideVideoLabel:!0,labelMaxWidth:166,onCameraSelected:this._onCameraSelected,onToggleBlur:this._onToggleBlur,forceVideoOnClose:!0,forceUpdateDefaultDevice:!1,skipVideoOnClose:this.state.isAwaitingConfirmation,overrideVideoPreviewDimensions:{width:270,height:150},isVideoDisabledDuringScreenSharing:this.props.isVideoDisabledDuringScreenSharing,showNewBackgroundReplacementUI:!1,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled}),t]})}popupDescription(){return"VideoSettings"}onOpened(e){l.default.setCallVideoSettingsPopupEvent(new r.CallVideoSettingsPopup(this.props.callId,e)),s.default.CallControlsStore.setSettingsPopupVisibility(!0),this.state.shouldShowCloseButton||this.props.isVideoButtonEnabled||this.setState({shouldShowCloseButton:!0})}onClosed(){s.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=T},815299:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,a.jsxs)(n.View,{style:r.wrapper,children:[e.children,e.showRedDot?(0,a.jsx)(n.View,{style:r.redDot}):void 0]})};const o=i(197582),a=i(785893),n=(o.__importStar(i(667294)),i(537180)),s=i(16549),r=n.StyleSheet.create({wrapper:{position:"relative"},redDot:{width:10,height:10,borderRadius:5,backgroundColor:s.Color.red,position:"absolute",right:"-7%",top:"25%",marginTop:-5,marginRight:5}})},762356:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(667294)),r=o.__importDefault(i(480986)),l=i(26703),c=o.__importDefault(i(827361)),d=i(206315),u=(0,l.lazyProperties)({opacityLight:()=>n.Styles.createImageStyle({opacity:.3}),opacityDark:()=>n.Styles.createImageStyle({opacity:.5})});t.default=()=>{const[e,t]=s.useState(),{mode:{isDark:i}}=(0,d.useSkypeTheme)();if(s.useEffect((()=>{const e=r.default.getAvailableBackgroundUri();return e&&t(e),()=>{e&&r.default.setBackgroundAvailable(e)}}),[]),!e)return null;const o=i?u.opacityDark:u.opacityLight;return(0,a.jsx)(n.Image,{style:n.Styles.combine(c.default.absoluteFill,o),resizeMode:"cover",source:e})}},443789:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FullScreenTooltip=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(667294),r=i(315742),l=o.__importStar(i(704704)),c=i(736267),d=o.__importDefault(i(296374)),u=o.__importDefault(i(201721)),h=i(26703),p=o.__importDefault(i(20758)),g=o.__importDefault(i(543915)),C=o.__importDefault(i(369347)),m=i(526849),S=(0,h.lazyProperties)({titleTextStyle:()=>n.Styles.createTextInputStyle({marginTop:8,fontFamily:p.default.fontFamily.uidDisplayBold,fontWeight:"normal",fontSize:p.default.fontSize.size14}),descriptionStyle:()=>n.Styles.createTextInputStyle({width:200}),gotItBarStyle:()=>n.Styles.createViewStyle({paddingHorizontal:10,paddingVertical:8,height:void 0})});t.FullScreenTooltip=(0,m.WithResub)((e=>{const{anchor:t,hasIncomingScreensharing:i,tooltipShowTimes:o}=e,[n,h]=(0,s.useState)(0),[p,C]=(0,s.useState)(!1),[m,_]=(0,s.useState)(!1),f=(0,c.useCommonContext)(),y=l.getString("CallPanel.FullScreenTooltipTitle"),T=(0,s.useMemo)((()=>({getElement:t,positions:[r.PopupAnchorPositon.Bottom,r.PopupAnchorPositon.Left],title:y,description:l.getString("CallPanel.FullScreenTooltipText"),anchorAccessibilityLabel:y,instanceId:"viewButton",rootViewId:f.rootViewId,showGotItButton:!0,durationMs:5e3})),[t,f.rootViewId,y]),b=(0,s.useCallback)((()=>{C(!1),_(!0),u.default.increaseFullScreenToolTipShowTime()}),[]);(0,s.useEffect)((()=>{g.default.measureLayoutRelativeToWindow(t).then((e=>{h(e.y)}))}),[t]);const v=i&&o<2;return(0,s.useEffect)((()=>{i||_(!1)}),[i]),(0,s.useEffect)((()=>{v&&!m&&C(!0)}),[m,v]),p?(0,a.jsx)(d.default,{toolTipInfo:T,onDismiss:b,textMarginHorizontal:16,textMarginVertical:8,titleTextStyle:S.titleTextStyle,descriptionStyle:S.descriptionStyle,gotItBarStyle:S.gotItBarStyle,onPressClose:b,containerOffsetY:n}):(0,a.jsx)(a.Fragment,{})}),(e=>{const{callId:t}=e,i=C.default.CallScreenShareStore.hasIncomingScreensharing(t),o=u.default.getFullScreenToolTipShowTime();return Object.assign(Object.assign({},e),{hasIncomingScreensharing:i,tooltipShowTimes:o})}))},992435:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(331654)),l=o.__importDefault(i(150343)),c=o.__importDefault(i(947878)),d=o.__importDefault(i(132680)),u=o.__importDefault(i(288547)),h=o.__importDefault(i(583604)),p=i(26703),g=o.__importStar(i(704704)),C=i(16549),m=o.__importDefault(i(20758)),S=i(641400),_=i(206197),f=o.__importDefault(i(760989)),y=o.__importDefault(i(497910)),T=i(77395),b=i(262725),v=o.__importDefault(i(970035)),I=C.Color.gray400,w=(0,p.lazyProperties)({innerContainer:()=>s.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0}),label:()=>s.Styles.createTextStyle({backgroundColor:C.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,color:C.Color.white,fontSize:m.default.fontSize.size13Deprecated,font:m.default.font.uiDisplayRegular}),labelLightTheme:()=>s.Styles.createTextStyle({color:I}),iconStyle:()=>s.Styles.createViewStyle({overflow:"visible"}),chevronIcon:()=>s.Styles.createViewStyle({marginLeft:5}),redDot:()=>s.Styles.createViewStyle({width:8,height:8,borderRadius:4,backgroundColor:C.Color.red,position:"absolute",left:10,top:8})});class P extends y.default{constructor(){super(...arguments),this._handleOnPress=e=>{this.state.isMenuShown&&u.default.close(this._getRootViewId(),f.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOption?r.default.isFullScreenMode(this._getRootViewId()).then((e=>{this._showMenu(e)})):this._showMenu(!1)},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();u.default.showWithContent({menuId:u.default.menuId(),anchor:t,rootViewId:i,menuHeight:h.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(h.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOption,isInFullscreenMode:e,availableItems:this.state.availableMenuItems,itemColor:this.props.useLightTheme?I:void 0,dividerColor:this.props.useLightTheme?this._themeColors.dividerColor:void 0}),getTitle:()=>{},onCloseMenu:e=>u.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:this.props.useLightTheme?_.Theme.Colorful:_.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:302,borderRadius:8,backgroundColor:this.props.useLightTheme?this._themeColors.primaryBackgroundColor:"#292828"},f.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=l.default.getS4LCMCFeatures().enableFullScreenOnWeb,o=d.default.getAvailableMenuItemsV2(e.callId,i,e.useMobileCallControls,e.conversationMri);return{isMenuShown:this.state&&this.state.isMenuShown,stageMode:c.default.getStageMode(e.callId),showFullScreenOption:i,menuContainsNewItem:n.some(o,(e=>e.isNew)),availableMenuItems:o}}render(){const e=[w.label,this.props.useLightTheme?w.labelLightTheme:void 0],t=(0,a.jsx)(b.BodyText,{style:e,children:g.getString("CallPanel.CallHeaderViewLabel")}),i=this.props.useLightTheme?I:C.Color.white,o=(0,a.jsx)(v.default,{icon:S.SkypeIcon.GridView,size:S.IconSize.size16,color:i,style:w.iconStyle}),n=[w.innerContainer,s.Styles.createViewStyle({backgroundColor:C.Color.transparent,height:this.props.height},!1)],r=this._intLabel(),l={style:n,title:this._intLabel(),accessibilityLabel:r,onPress:this._handleOnPress};return(0,a.jsxs)(T.HoverableButton,Object.assign({},l,{ref:this._onButtonRef,children:[o,t,this.state.menuContainsNewItem?(0,a.jsx)(s.View,{style:w.redDot}):void 0]}))}_intLabel(){return g.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=P},583604:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(331654)),s=i(167606),r=o.__importDefault(i(150343)),l=i(737298),c=o.__importDefault(i(369347)),d=o.__importDefault(i(947878)),u=o.__importStar(i(873324)),h=o.__importDefault(i(638260)),p=i(460515),g=o.__importDefault(i(132680)),C=o.__importStar(i(44717)),m=o.__importDefault(i(513983)),S=o.__importDefault(i(288547)),_=o.__importStar(i(85385)),f=o.__importDefault(i(573280)),y=o.__importStar(i(704704)),T=i(641400),b=o.__importDefault(i(760989)),v={[p.StageMode.Speaker]:u.CallViewMenuActions.SwitchToSpeaker,[p.StageMode.Presentation]:u.CallViewMenuActions.SwitchToPresentation,[p.StageMode.FocusedScreenShare]:u.CallViewMenuActions.SwitchToContent,[p.StageMode.Grid]:u.CallViewMenuActions.SwitchToModernGrid,[p.StageMode.TogetherMode]:u.CallViewMenuActions.SwitchToTogetherMode,[p.StageMode.LargeGrid]:u.CallViewMenuActions.SwitchToLargeGallery},I={[p.CallPanelHeaderLayout.Window]:"CallPanel.CallHeaderLayoutWindowLabel",[p.CallPanelHeaderLayout.Float]:"CallPanel.CallHeaderLayoutFloatLabel"},w={[p.CallPanelHeaderLayout.Window]:u.CallViewMenuActions.SwitchToWindow,[p.CallPanelHeaderLayout.Float]:u.CallViewMenuActions.SwitchToFloat};class P extends m.default{static getLayoutPickerHeight(e){const t=p.DesktopLayoutPickerItemHeight;return a.sum(a.map(e,(e=>e.type===p.LayoutPickerMenuItemType.Divider?11:t)))}_buildState(e,t){const i={isPSTNCall:c.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:C.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId},o=d.default.getStageMode(e.callId);this._changeCallLayoutCommand=new l.ChangeCallLayoutCommand(i,!!e.isIncomingOrOutGoingRing,o);const a=r.default.getS4LCMCFeatures();return{activeStageMode:o,activeHeaderMode:d.default.getCallHeaderLayoutMode(e.callId),tmNumberOfParticipants:a.callAudienceBotConfig.minParticipantsOnCall,lgNumberOfParticipants:a.callGridViewBotConfig.minParticipantsOnCall,activeOnlyVideoOnTheStage:d.default.getOnlyVideoOnTheStage(e.callId),isSelfInTheGrid:d.default.getSelfInTheGrid(e.callId),isTrayHidden:d.default.isTopTrayHidden(e.callId)}}_buildRows(e,t){return e.availableItems.map(((t,i)=>{const o={type:t.type,callId:e.callId,useMobileControls:e.useMobileControls,itemColor:e.itemColor,dividerColor:e.dividerColor};switch(t.type){case p.LayoutPickerMenuItemType.Divider:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{isDivider:!0,key:"divider"+i}));case p.LayoutPickerMenuItemType.StageModeSpeaker:case p.LayoutPickerMenuItemType.StageModeFocusedScreenShare:case p.LayoutPickerMenuItemType.StageModeGrid:case p.LayoutPickerMenuItemType.StageModeManual:case p.LayoutPickerMenuItemType.StageModePresentation:case p.LayoutPickerMenuItemType.StageModeTogetherMode:case p.LayoutPickerMenuItemType.StageModeLargeGrid:const a=g.default.layoutPickerMenuItemTypeToStageMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{icon:g.default.getIconForStageMode(a),title:g.default.getStageModeItemTitle(a),isSelected:a===g.default.displayedStageMode(this.state.activeStageMode),onRowPress:()=>this._onStageRowPress(a),changeLayoutCommand:this._changeCallLayoutCommand,tooltip:this._getTooltipForLgOrTm(a),key:p.StageMode[a]}));case p.LayoutPickerMenuItemType.OnlyVideoOnTheStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{icon:T.SkypeIcon.Video,title:y.getString("CallPanel.HideAudioFromTheStage"),onRowPress:()=>this._onOnlyVideoOnTheStageRowPress(),isSelected:this.state.activeOnlyVideoOnTheStage,key:"onlyVideoOnTheStage",isNew:t.isNew}));case p.LayoutPickerMenuItemType.Fullscreen:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{icon:this._getFullscreenModeIcon(!!e.isInFullscreenMode),title:this._getFullscreenModeItemTitle(!!e.isInFullscreenMode),onRowPress:()=>this._onFullScreenRowPress(!e.isInFullscreenMode),key:"fullscreen"}));case p.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:case p.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:case p.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:case p.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:const n=g.default.layoutPickerMenuItemTypeToHeaderMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{title:this._getHeaderModeItemTitle(n),isSelected:n===this.state.activeHeaderMode,onRowPress:()=>this._onHeaderRowPress(n),key:p.CallPanelHeaderLayout[n]}));case p.LayoutPickerMenuItemType.SelfInTheGridToggle:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{icon:T.SkypeIcon.Contact,title:y.getString("CallPanel.ShowMyselfInTheGrid"),isSelected:this.state.isSelfInTheGrid,onRowPress:()=>this._onSelfInTheGridToggled(),key:"selfInGrid",isNew:t.isNew}));case p.LayoutPickerMenuItemType.HidePeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{icon:T.SkypeIcon.TopPanelCollapse,title:y.getString("CallPanel.HidePeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"hideTray"}));case p.LayoutPickerMenuItemType.ShowPeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},o),{icon:T.SkypeIcon.TopPanelExpand,title:y.getString("CallPanel.ShowPeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"showTray"}))}}))}_buildSimpleRowBuilder(e){return{props:e,builder:f.default.buildRow}}_onStageRowPress(e){this._changeCallLayoutCommand.execute(e),S.default.close(this.props.rootViewId,b.default.newCauseId()),h.default.trackCallViewMenuActions(v[e])}_onHeaderRowPress(e){d.default.setCallHeaderLayoutMode(this.props.callId,e),S.default.close(this.props.rootViewId,b.default.newCauseId()),h.default.trackCallViewMenuActions(w[e])}_onOnlyVideoOnTheStageRowPress(){const e=!this.state.activeOnlyVideoOnTheStage;d.default.setOnlyVideoOnTheStage(this.props.callId,e),this._forgetManuallySetStageRibbonParticipantPlacements(),S.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?u.CallViewMenuActions.ActivateOnlyVideoOnTheStage:u.CallViewMenuActions.DeactivateOnlyVideoOnTheStage;h.default.trackCallViewMenuActions(t)}_forgetManuallySetStageRibbonParticipantPlacements(){this.state.activeStageMode===p.StageMode.Manual&&this._changeCallLayoutCommand.execute(p.StageMode.Grid),c.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,void 0)}_onSelfInTheGridToggled(){const e=!this.state.isSelfInTheGrid;d.default.setSelfInTheGrid(e,this.props.callId),S.default.close(this.props.rootViewId,b.default.newCauseId());const t=e?u.CallViewMenuActions.ActivateSelfInTheGrid:u.CallViewMenuActions.DeactivateSelfInTheGrid;h.default.trackCallViewMenuActions(t)}_onTopTrayCollapseExpandPress(){const e=!this.state.isTrayHidden;d.default.setHideTopTray(e,this.props.callId),S.default.close(this.props.rootViewId,b.default.newCauseId()),_.track(new u.ToggleCallTray(this.props.callId,e))}_onFullScreenRowPress(e){S.default.close(this.props.rootViewId,b.default.newCauseId()),e?n.default.tryEnterFullScreenMode(this.props.rootViewId).then((e=>{e?(_.track(new u.RibbonSettingsMenuActionEvent(u.RibbonSettingsMenuActions.EnterFullScreen)),h.default.trackCallViewMenuActions(u.CallViewMenuActions.EnterFullScreen)):_.log(s.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")})):n.default.exitFullScreenMode(this.props.rootViewId).then((()=>{_.track(new u.RibbonSettingsMenuActionEvent(u.RibbonSettingsMenuActions.ExitFullScreen))})).catch((e=>{_.log(s.LogTraceArea.CallingUI,"Failed to exit full screen mode:")}))}_getTooltipForLgOrTm(e){if(e===p.StageMode.TogetherMode||e===p.StageMode.LargeGrid)return y.getString("CallPanel.StageModeRequiresMoreParticipantsTooltip",{count:p.StageMode.TogetherMode?this.state.tmNumberOfParticipants:this.state.lgNumberOfParticipants})}_getHeaderModeItemTitle(e){const t=I[e];return t?y.getString(t):(_.error(s.LogTraceArea.CallingUI,"No title found for header mode: "+p.CallPanelHeaderLayout[e]),"")}_getFullscreenModeItemTitle(e){return e?y.getString("CallPanel.ExitFullScreen"):y.getString("CallPanel.EnterFullScreen")}_getFullscreenModeIcon(e){return e?T.SkypeIcon.FitToWindow:T.SkypeIcon.ViewSwitcher}}t.default=P},573280:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(460515),l=o.__importDefault(i(225511)),c=i(26703),d=i(16549),u=o.__importDefault(i(20758)),h=i(641400),p=o.__importDefault(i(497910)),g=o.__importDefault(i(947878)),C=o.__importDefault(i(132680)),m=o.__importDefault(i(369347)),S=o.__importDefault(i(854929)),_=o.__importDefault(i(916256)),f=(0,c.lazyProperties)({dividerDesktop:()=>s.Styles.createViewStyle({height:2,marginTop:4,marginBottom:4,backgroundColor:"#11100F"}),dividerMobile:()=>s.Styles.createViewStyle({borderBottomWidth:1,height:1,borderColor:d.Color.whiteOverlay70}),rowMobile:()=>s.Styles.createViewStyle({marginHorizontal:16}),hoverStyle:()=>s.Styles.createViewStyle({backgroundColor:d.Color.gray200Overlay20})}),y=d.Color.white;class T extends p.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{disabled:this._isDisabled(e),isSelected:this._isSelected(e)}}_isDisabled(e){let t=!1;const i=C.default.layoutPickerMenuItemTypeToStageMode(e.type);if(e.changeLayoutCommand&&!n.isUndefined(i)&&(t=!e.changeLayoutCommand.canExecuteForStageMode(i)),e.type===r.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=g.default.getOnlyVideoOnTheStage(e.callId)&&!m.default.CallingStore.isProvidingVideo(e.callId),o=S.default.hasPinnedParticipants(e.callId);(i||o)&&(t=!0)}return e.type===r.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&S.default.getPinnedParticipants(e.callId)&&(t=!0),e.type!==r.LayoutPickerMenuItemType.HidePeopleAtTop||_.default.trayHasParticipants(e.callId)||(t=!0),t}_isSelected(e){let t=e.isSelected;if(e.type===r.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=g.default.getOnlyVideoOnTheStage(e.callId)&&!m.default.CallingStore.isProvidingVideo(e.callId),o=S.default.hasPinnedParticipants(e.callId);(i||o)&&(t=!1)}return e.type===r.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&S.default.hasPinnedParticipants(e.callId)&&(t=!1),!!t}render(){if(this.props.isDivider)return this._renderDivider();const e=this.props.itemColor?this.props.itemColor:y,t={onRef:this._onContainerRef,icon:this.props.icon,accessibilityLabel:this.props.title||"",titleText:this.props.title,onRowPress:this.props.onRowPress,colorThemeOverride:this.props.colorThemeOverride,rowHeight:this._getRowHeight(),titleTextColor:e,accessoryIcon:this.state.isSelected?h.SkypeIcon.Ok:void 0,titleStyle:u.default.fontStyle.bodySmallDeprecated,iconSize:h.IconSize.size16,accessoryIconSize:h.IconSize.size16,iconColor:e,accessoryIconColor:e,hideBorder:!this.props.showBorder,disabled:this.state.disabled,borderColor:d.Color.gray50Overlay50,tooltip:this.state.disabled?this.props.tooltip:void 0,containerStyleOverride:this.props.useMobileControls?f.rowMobile:void 0,hoverStyle:f.hoverStyle,isNew:this.props.isNew};return l.default.buildRow(t)}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}_getRowHeight(){return this.props.useMobileControls?r.MobileLayoutPickerItemHeight:r.DesktopLayoutPickerItemHeight}_renderDivider(){const e=this.props.useMobileControls?f.dividerMobile:f.dividerDesktop;return(0,a.jsx)(s.View,{style:[e,this.props.dividerColor&&{backgroundColor:this.props.dividerColor}],importantForAccessibility:s.Types.ImportantForAccessibility.No})}}T.buildRow=e=>(0,a.jsx)(T,Object.assign({},e)),t.default=T},757293:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewCallReactionsView=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(167606),r=o.__importDefault(i(497910)),l=o.__importDefault(i(601373)),c=i(460515),d=i(26703),u=o.__importDefault(i(827361)),h=o.__importDefault(i(760989)),p=o.__importStar(i(85385)),g=o.__importDefault(i(543915)),C=o.__importDefault(i(363091)),m=(0,d.lazyProperties)({reactionsView:()=>u.default.absoluteFill});class S extends r.default{constructor(){super(...arguments),this._stageReactionsAnimatedOpacityValue=new n.Animated.Value(1),this._stageReactionsAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._getAnchorInfoChanges=(e,t)=>{},this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=h.default.newCauseId();p.log(s.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._getAnchorInfo=e=>{const t=C.default.isMyMri(e)?c.CallStageElementKeys.localUserKey:e;let i;return g.default.measureLayoutRelativeToAncestor((()=>this.props.getChildRef(t)),this.props.getParentRef).then((e=>{i={rect:e,hidden:!1}})),i}}render(){return this.props.disableReactions?null:(0,a.jsx)(n.Animated.View,{style:[m.reactionsView,this._stageReactionsAnimatedStyle],ignorePointerEvents:!0,children:(0,a.jsx)(l.default,{reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,ignorePointerEvents:!0,parentDimensions:this.props.parentDimensions,topOffsetForUnhandledReactions:0,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed})},c.CallStageElementKeys.callTextReactionViewKey)}}t.NewCallReactionsView=S},712416:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrayOverflowButton=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(167606),r=o.__importDefault(i(497910)),l=i(16549),c=i(26703),d=o.__importDefault(i(20758)),u=i(77395),h=i(262725),p=i(460515),g=o.__importDefault(i(760989)),C=o.__importStar(i(85385)),m=p.BigTrayCallParticipantAvatarSize,S=(0,c.lazyProperties)({overflowButtonContainer:()=>n.Styles.createViewStyle({backgroundColor:l.Color.transparent,width:p.BigTrayOverflowButtonSize,flexShrink:0,flexGrow:0,alignContent:"center",justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),overflowButton:()=>n.Styles.createButtonStyle({width:m,height:m,borderRadius:m/2,backgroundColor:l.Color.gray200Overlay60,alignContent:"center",justifyContent:"center"}),overflowButtonLightTheme:()=>n.Styles.createButtonStyle({backgroundColor:l.Color.gray100}),overflowButtonLabel:()=>n.Styles.createTextStyle({color:l.Color.whiteOverlay80,backgroundColor:l.Color.transparent,textAlign:"center",textAlignVertical:"center",paddingBottom:1,fontSize:d.default.fontSize.size18}),overflowButtonLabelLightTheme:()=>n.Styles.createTextStyle({color:l.Color.gray400})});class _ extends r.default{constructor(){super(...arguments),this._onPress=()=>{const e=g.default.newCauseId();C.log(s.LogTraceArea.CallingUI,"OverflowButton._onPress "+e),this.props.onOverflowButtonPress(e,p.CallRosterOrigin.TrayOverflowButton,!1)}}render(){if(!this.props.hiddenParticipantsNumber)return null;const{buttonSizeMultiplier:e=1}=this.props,t=[S.overflowButtonContainer],i=[S.overflowButton],o=[S.overflowButtonLabel];if(1!==e){const a=n.Styles.createViewStyle({width:p.BigTrayOverflowButtonSize*e},!1),s=n.Styles.createButtonStyle({width:m*e,height:m*e,borderRadius:m},!1),r=n.Styles.createTextStyle({fontSize:e<1?d.default.fontSize.size16:d.default.fontSize.size18},!1);t.push(a),i.push(s),o.push(r)}return this.props.showTrayVertically&&t.push(n.Styles.createViewStyle({height:p.BigTrayOverflowButtonSize*e},!1)),this.props.useLightTheme&&(i.push(S.overflowButtonLightTheme),o.push(S.overflowButtonLabelLightTheme)),(0,a.jsx)(n.View,{style:t,children:(0,a.jsx)(u.HoverableButton,{style:i,onPress:this._onPress,children:(0,a.jsx)(h.BodyText,{style:o,children:`+${this.props.hiddenParticipantsNumber}`})})})}}t.TrayOverflowButton=_},145149:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrayOverflowButtonV2=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(344175),r=i(537180),l=i(167606),c=i(460515),d=i(154235),u=o.__importStar(i(85385)),h=i(26703),p=o.__importDefault(i(660401)),g=o.__importDefault(i(760989)),C=i(206315),m=(0,h.lazyProperties)({button:()=>n.Styles.createViewStyle({opacity:.6})}),S=r.StyleSheet.create({container:{alignItems:"center",justifyContent:"center",padding:8}});t.TrayOverflowButtonV2=e=>{const{mode:{isAccessible:t}}=(0,C.useSkypeTheme)();if(!e.hiddenParticipantsNumber)return null;return(0,a.jsx)(s.Box,{style:S.container,children:(0,a.jsx)(p.default,{style:t?void 0:m.button,title:`+${e.hiddenParticipantsNumber}`,onPress:()=>{const t=g.default.newCauseId();u.log(l.LogTraceArea.CallingUI,`TrayOverflowButtonV2._onPress ${t}`),e.onOverflowButtonPress(t,c.CallRosterOrigin.TrayOverflowButton,!1)},buttonSize:d.SXButtonSize.Small,buttonStyle:d.SXButtonStyle.ThemeFill})})}},791884:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(217041),s=o.__importDefault(i(150343)),r=o.__importDefault(i(457468));class l extends n.ComponentBase{_buildState(e,t){const i=s.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.DarkerDialerBarEnabled;return{onPress:e.onPress,enableDarkerColors:i,disableHighBandwidthOperations:r.default.isUsingGogoNetwork()}}render(){const e=this.props.layoutComponent;return(0,a.jsx)(e,{experimentSettings:this.props.experimentSettings,onPress:this.state.onPress,onCallButtonPress:this.props.onCallButtonPress,enableDarkerColors:this.state.enableDarkerColors,disabled:this.state.disableHighBandwidthOperations})}}t.default=l},739651:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(791884)),s=i(291524),r=o.__importDefault(i(993370));class l extends s.LayoutExperiment{constructor(e){super(e,"DialpadBar")}_getOptionFromConf(){return"revert"}render(){const e=this._getLayoutToDisplay();if(e)return(0,a.jsx)(n.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return(0,a.jsx)(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return r.default}}t.default=l},993370:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=(i(331654),i(854646)),r=o.__importDefault(i(970035)),l=o.__importDefault(i(831890)),c=i(26703),d=o.__importStar(i(704704)),u=o.__importDefault(i(252089)),h=o.__importDefault(i(960282)),p=o.__importDefault(i(322094)),g=i(16549),C=i(641400),m=(o.__importDefault(i(48076)),i(262725)),S=o.__importDefault(i(497910)),_=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,paddingVertical:12,justifyContent:"center",bottom:0}),buttonContainer:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexGrow:0,flexDirection:"row",height:50,borderRadius:28}),actionButtonStyle:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row",borderRadius:20,paddingHorizontal:20}),buttonText:()=>n.Styles.createTextStyle({color:g.Color.white,flex:0,maxWidth:180}),addToCallMargins:()=>n.Styles.createViewStyle({marginLeft:6,marginRight:3}),dialpadMargin:()=>n.Styles.createViewStyle({marginRight:6}),dialpadMarginMulti:()=>n.Styles.createViewStyle({marginLeft:3})});class f extends S.default{constructor(){super(...arguments),this._callButtonLabelName="QuickCallPanel.SkypeCallLabel",this._onPress=()=>{this.props.onPress&&this.props.experimentSettings&&(l.default.registerDialerButtonClickAction(this.props.experimentSettings),this.props.onPress())},this._onCallButtonPress=e=>{this.props.onCallButtonPress&&this.props.experimentSettings&&(l.default.registerCallButtonClickAction(this.props.experimentSettings),this.props.onCallButtonPress(e))},this._onLayout=e=>{this.isComponentMounted()&&this._useLayoutWidth()&&this.setState({width:e.width})}}_buildState(e,t){const i=this._getRootViewId();return{orientation:h.default.getDeviceOrientation(i),useIOSLandscapeStyles:!1,width:this._useLayoutWidth()?void 0:this._getContext().isPresentedInDesktopLeftNav?p.default.getWidth():h.default.getWidth(i),gradientColors:u.default.getGradientColors(),primaryColor:u.default.getPrimaryColor()}}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&l.default.registerOpenAction(this.props.experimentSettings)}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:this.state.primaryColor,t=n.Styles.createViewStyle({borderColor:e,borderWidth:2,backgroundColor:this._themeColors.primaryBackgroundColor},!1),i=n.Styles.createTextStyle({color:e},!1);let o,l;const c=this._isPresentedInDesktopLeftNav()?1:2;if(this.state.width){const e=this.state.width-(this.state.useIOSLandscapeStyles?60:0);o=n.Styles.createViewStyle({position:"absolute",width:this.state.width,paddingHorizontal:this.state.useIOSLandscapeStyles?20:void 0},!1),l=n.Styles.createViewStyle({width:.9*e/c},!1)}const u=this._isPresentedInDesktopLeftNav()?void 0:(0,a.jsx)(n.View,{style:[_.buttonContainer,t,l,_.addToCallMargins],children:(0,a.jsxs)(n.Button,{style:[_.actionButtonStyle,l],onPress:this._onCallButtonPress,accessibilityLabel:d.getString("QuickCallPanel.PanelHeaderNewCall"),disabled:this.props.disabled,children:[(0,a.jsx)(r.default,{icon:C.SkypeIcon.CallAdd,color:e,size:C.IconSize.size24}),(0,a.jsx)(m.BodyText,{bold:!0,style:[_.buttonText,i],allowFontScaling:!1,children:d.getString(this._callButtonLabelName)})]})},"AddCallButton"),h=this._useAccessibleTheme()?n.Styles.createTextStyle({color:this._themeColors.primaryBackgroundColor},!1):void 0,p=(0,a.jsxs)(n.Button,{style:[_.actionButtonStyle,l],onPress:this._onPress,accessibilityLabel:d.getString("QuickCallPanel.DialpadButtonAccessibilityLabel"),disabled:this.props.disabled,children:[(0,a.jsx)(r.default,{icon:C.SkypeIcon.Dialpad,color:this._themeColors.primaryBackgroundColor,size:C.IconSize.size24}),(0,a.jsx)(m.BodyText,{bold:!0,style:[_.buttonText,h],allowFontScaling:!1,children:d.getString("QuickCallPanel.DialpadButtonLabelShort")})]},"DialpadButton"),g=[_.dialpadMargin,c>1?_.dialpadMarginMulti:void 0];let S;if(this._useAccessibleTheme()){const e=[_.buttonContainer,l,g,n.Styles.createViewStyle({backgroundColor:this._themeColors.primaryIconColor},!1)];S=(0,a.jsx)(n.View,{style:e,children:p},"Container_View")}else S=(0,a.jsx)(s.GradientView,{style:[_.buttonContainer,l,g],colors:this.state.gradientColors,direction:s.GradientDirection.BOTTOM_RIGHT,children:p},"Gradient_View");return(0,a.jsxs)(n.View,{style:[_.container,o],onLayout:this._useLayoutWidth()?this._onLayout:void 0,children:[u,S]})}_useLayoutWidth(){return!0}}t.default=f},291524:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutExperiment=t.ExperimentOption=void 0;const o=i(217041);var a;!function(e){e[e.Default=0]="Default",e[e.NewCta=1]="NewCta"}(a||(t.ExperimentOption=a={}));const n={default:a.Default,newCta:a.NewCta};class s extends o.ComponentBase{constructor(e,t){super(e),this._settings={name:t,location:e.location}}shouldComponentUpdate(e,t){return this.state.optionToPresent!==t.optionToPresent}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._setSettingsLayoutOption(t.optionToPresent)}_buildState(e,t){const i={optionToPresent:this._getOptionFromConf()};return t&&this._setSettingsLayoutOption(i.optionToPresent),i}_getOptionToDisplay(){const e=this.state.optionToPresent;return n[e]?n[e]:a.Default}_getExperimentSettings(){return this._settings}_setSettingsLayoutOption(e){this._settings.layoutOption=e}}t.LayoutExperiment=s},202533:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(854646),r=o.__importDefault(i(150343)),l=i(154235),c=o.__importDefault(i(142193)),d=o.__importDefault(i(186325)),u=i(815146),h=i(406719),p=o.__importDefault(i(453761)),g=o.__importDefault(i(831890)),C=i(26703),m=o.__importStar(i(704704)),S=o.__importDefault(i(201721)),_=o.__importDefault(i(740794)),f=o.__importDefault(i(450312)),y=i(928722),T=o.__importDefault(i(660401)),b=i(16549),v=o.__importDefault(i(139221)),I=i(641400),w=i(262725),P=o.__importDefault(i(497910));var M,D;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(M||(M={})),function(e){e[e.SkypeToPhone=0]="SkypeToPhone",e[e.Credit=1]="Credit",e[e.Subscription=2]="Subscription"}(D||(D={}));const A=(0,C.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:0,minHeight:60,paddingTop:11,paddingLeft:8,paddingRight:8,paddingBottom:3,flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between"}),buttonContainer:()=>n.Styles.createViewStyle({flex:0,alignSelf:"flex-start",paddingTop:21,paddingLeft:7}),buttonContainerBroad:()=>n.Styles.createViewStyle({flex:0,alignSelf:"flex-end",paddingTop:5}),bannerContainer:()=>n.Styles.createViewStyle({alignItems:"stretch",justifyContent:"space-between",backgroundColor:b.Color.transparent}),closeIconContainer:()=>n.Styles.createViewStyle({position:"absolute",top:8,right:8,padding:4}),textContainer:()=>n.Styles.createViewStyle({flex:1,paddingLeft:7,paddingRight:8,justifyContent:"space-between",alignItems:"flex-start"}),bodyStyle:()=>n.Styles.createTextStyle({flex:1,lineHeight:18,fontSize:13}),caption:()=>n.Styles.createTextStyle({flex:1,lineHeight:16,fontSize:12})}),k={skypeToPhone:{icon:[{icon:I.SkypeIcon.GlobeCredit,color:b.Color.orangeLight},{icon:I.SkypeIcon.CreditGlobe,color:b.Color.blueDark}],buttonType:M.GetCredit,labelType:D.SkypeToPhone},credit:{icon:[{icon:I.SkypeIcon.GlobeCredit,color:b.Color.orangeLight},{icon:I.SkypeIcon.CreditGlobe,color:b.Color.blueDark}],buttonType:M.GetCredit,labelType:D.Credit},subscription:{icon:[{icon:I.SkypeIcon.Globe,color:b.Color.blue}],buttonType:M.GetSubscription,labelType:D.Subscription},freeTrial:{icon:[{icon:I.SkypeIcon.GlobeCredit,color:b.Color.orangeLight},{icon:I.SkypeIcon.CreditGlobe,color:b.Color.blueDark}],buttonType:M.GetFreeTrial,labelType:D.SkypeToPhone}};class R extends P.default{constructor(){super(...arguments),this._appVersion=v.default.getAppVersion(),this._telemetrySent=!1,this._renderActionButton=(e,t)=>t?this._renderButton(M.GetFreeTrial):"credit_only"===e?this._renderButton(M.GetSubscription):this._renderButton(M.GetCredit),this._renderButton=e=>{let t,i,o="";const n={buttonStyle:l.SXButtonStyle.Custom},r={textColor:b.Color.white};switch(e){case M.GetFreeTrial:t=b.AgnosticGradientFillButtonColors.green,o=m.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case M.GetCredit:o=m.getString("SkypeToPhonePanel.GetCreditButton"),i=this._useAccessibleTheme()?void 0:{key:"primary",colors:this._getContext().gradients.primary};break;case M.GetSubscription:t=b.AgnosticGradientFillButtonColors.blue,o=m.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();r.backgroundColor=e?b.Color.white:b.Color.black,r.textColor=e?b.Color.black:b.Color.white}else n.buttonStyle=l.SXButtonStyle.AgnosticGradientFill,n.agnosticGradientColor=t,n.gradientDirection=s.GradientDirection.BOTTOM_RIGHT;let c=A.buttonContainer;return o.length>16&&!this.state.isCompactView&&(c=A.buttonContainerBroad),{button:(0,a.jsx)(T.default,Object.assign({style:c,backgroundStyle:R._backgroundStyle,title:o,onPress:this._onProceedButtonPress,buttonSize:l.SXButtonSize.Small,buttonConfig:r},n,{colorInfoOverride:i}),"banner_content_button"),titleLength:o.length}},this._onProceedButtonPress=e=>{e.stopPropagation();let t=u.BalancePanelSource.SkypeToPhoneBanner;if(this.props.experimentSettings){g.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable);t={[h.ExperimentLocation.CallsPanel]:u.BalancePanelSource.CallsPanel,[h.ExperimentLocation.CallsPanelBanner]:u.BalancePanelSource.CallsPanelBanner,[h.ExperimentLocation.CallsPanelTop]:u.BalancePanelSource.CallsPanelTop,[h.ExperimentLocation.DialerPanel]:u.BalancePanelSource.DialerPanel}[this.props.experimentSettings.location]}_.default.navigateToBalanceStatePanel(t,this._getRootViewId(),void 0,"credit_only"===this.props.userEntitlementsSummary?u.BalanceStatePanelSection.Subscriptions:void 0)},this._getBannerTheme=(e,t)=>t?k.freeTrial:"credit_only"===e?k.subscription:"none"===e?k.skypeToPhone:k.credit,this._onPressClose=()=>{this.props.experimentSettings&&g.default.registerCloseButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),S.default.setUserPreferencesLocal({entitlementsBannerOptions:{visible:!1,closedForClientVersion:this._appVersion}}),this.props.onClose()}}_buildState(e,t){const i=S.default.getUserPreferencesLocal().entitlementsBannerOptions,o=i&&(i.visible||i.closedForClientVersion!==this._appVersion),a=r.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.BannerEnabled,n=r.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.ForceShowBanner;return{isEntitlementsBannerVisible:o&&(a||n)||"both"!==e.userEntitlementsSummary&&n,isCompactView:f.default.isSplitNavStackCollapsed(y.StackNavigatorId.DesktopContent)}}_sendTelemetry(){this.props.experimentSettings&&this.state.isEntitlementsBannerVisible&&!this._telemetrySent&&(g.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),this._telemetrySent=!0)}componentDidMount(){super.componentDidMount(),this._sendTelemetry()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._sendTelemetry()}render(){if(!this.state.isEntitlementsBannerVisible)return null;const e=this._getBannerTheme(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable);let t,i=m.getString("SkypeToPhonePanel.CallPhonesSendSMS");switch(e.labelType){case D.Subscription:i=m.getString("SkypeToPhonePanel.SaveMoreText"),t=m.getString("SkypeToPhonePanel.Subscriptions");break;case D.Credit:t=m.getString("ProfileCard.SkypeCreditsLabel");break;case D.SkypeToPhone:t=m.getString("Entitlements.SkypeToPhoneTitle")}const o=(0,a.jsx)(c.default,{iconSize:I.IconSize.size58,icons:e.icon}),s=this._renderActionButton(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),r=this.state.isCompactView||s.titleLength<17?[(0,a.jsxs)(n.View,{style:A.textContainer,children:[(0,a.jsx)(w.Caption,{style:A.caption,children:t}),(0,a.jsx)(w.BodyText,{style:A.bodyStyle,size:this.props.useCompactLayout?w.BodyTextSize.SmallDeprecated:void 0,children:i})]},"text_section"),s.button]:(0,a.jsxs)(n.View,{style:A.textContainer,children:[(0,a.jsx)(w.Caption,{style:A.caption,children:t}),(0,a.jsx)(w.BodyText,{style:A.bodyStyle,children:i}),s.button]}),l=(0,a.jsx)(p.default,{style:A.closeIconContainer,size:I.IconSize.size12,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,onPress:this._onPressClose,icon:I.SkypeIcon.ClosePanel,title:m.getString("Global.CloseButtonTitle")}),u=n.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1);return(0,a.jsxs)(n.View,{style:A.bannerContainer,children:[(0,a.jsx)(d.default,{}),(0,a.jsxs)(n.View,{style:[A.container,u],children:[o,r]}),l]})}}t.LayoutOptionDefault=R,R._backgroundStyle={paddingLeft:12,paddingRight:12,borderRadius:20},t.default=R},90713:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(217041),r=o.__importStar(i(603094)),l=o.__importDefault(i(37679)),c=(o.__importDefault(i(149138)),o.__importDefault(i(994160))),d=o.__importDefault(i(602149));class u extends s.ComponentBase{_buildState(e,t){const i=l.default.getSubscriptions(),o=l.default.getCreditEntitlement(),a=c.default.getLoadedPersonalizedRecommendations();return{userEntitlementsSummary:r.getEntitlementCombination(o,i),isFreeTrialAvailable:a&&n.some(a.callingOffers,(e=>e.isFreeTrial)),shouldUseGPlayBilling:d.default.shouldUseGooglePlayBillingForCredit()||d.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?d.default.requestUpdate():c.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return(0,a.jsx)(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,isFreeTrialAvailable:this.state.isFreeTrialAvailable,useCompactLayout:this.props.useCompactLayout,onClose:this.props.onClose})}}t.default=u},350648:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(150343)),s=o.__importStar(i(291524)),r=o.__importDefault(i(202533)),l=o.__importDefault(i(90713));class c extends s.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneBanner")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneBanner}render(){return(0,a.jsx)(l.default,Object.assign({layoutComponent:r.default,experimentSettings:this._getExperimentSettings()},this.props))}}t.default=c},395781:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(317588)),r=i(154235),l=o.__importDefault(i(453761)),c=o.__importDefault(i(831890)),d=i(26703),u=o.__importStar(i(704704)),h=i(998929),p=o.__importDefault(i(740794)),g=o.__importDefault(i(660401)),C=i(16549),m=i(641400),S=o.__importStar(i(179582)),_=o.__importDefault(i(827361)),f=i(262725),y=o.__importDefault(i(497910)),T=o.__importDefault(i(150343)),b=i(815146),v=s.Collection.SKYPE_TO_PHONE_SMALL,I=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4,marginTop:5}),iconContainer:()=>n.Styles.createViewStyle({width:40,height:40,marginRight:10,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),iconStyle:()=>n.Styles.createImageStyle({width:40,height:40,justifyContent:"center",overflow:"visible"}),labelsContainer:()=>n.Styles.createViewStyle({flex:1,paddingLeft:5}),topTextLine:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),bottomTextLine:()=>n.Styles.createViewStyle({marginTop:2}),rightLabelText:()=>n.Styles.createTextStyle({textAlignVertical:"center",height:20}),rightPartView:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:6,overflow:"visible"}),forwardButton:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),itemDivider:()=>n.Styles.createViewStyle({height:1,marginHorizontal:10,marginTop:5}),itemDividerMiddle:()=>n.Styles.createViewStyle({height:1,marginLeft:65,marginTop:0}),itemDividerDarkeTheme:()=>n.Styles.createViewStyle({backgroundColor:C.Color.gray400})});class w extends y.default{constructor(){super(...arguments),this._onProceedButtonPress=e=>{e.stopPropagation(),this.props.experimentSettings&&c.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),p.default.navigateToBalanceStatePanel(b.BalancePanelSource.DialerPanel,this._getRootViewId())},this._renderImage=(e,t)=>{const i=[I.iconStyle];return t&&i.push(t),(0,a.jsx)(n.Image,{style:i,source:e})},this._renderOptionalSpacer=(e,t)=>{},this._renderTopText=e=>(0,a.jsx)(n.View,{style:I.topTextLine,children:(0,a.jsx)(f.RowTitle,{style:_.default.flexOne,numberOfLines:2,children:e})})}_buildState(){return{enableRefreshedPalette:T.default.getS4LUiFeatures().enableRefreshedPalette}}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&c.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable)}render(){const e=[I.itemDivider];this._useDarkTheme()?e.push(I.itemDividerDarkeTheme):e.push(this._themeStyles.dividerColorStyle);const t=u.getString("Entitlements.SkypeToPhoneTitle");let i,o,s=t;if(this.props.hasCallingEntitlements){const e=u.getString("Entitlements.SubscriptionsSmallCaps",{count:this.props.subscriptionsCount});s+=", "+e,this.props.formattedBalance&&(s+=", "+this.props.formattedBalance),i=(0,a.jsx)(f.BodyText,{style:I.bottomTextLine,numberOfLines:1,textThemeColor:f.TextThemeColor.Secondary,children:e}),o=[(0,a.jsx)(f.RowTitle,{style:[this._themeStyles.secondaryTextColorStyle,I.rightLabelText,_.default.pointerCursor],numberOfLines:1,children:this.props.formattedBalance},"creditEntitlementValueText"),(0,a.jsx)(l.default,{size:m.IconSize.size20,color:this._themeColors.disclosureArrowColor,hoverColor:this._themeColors.iconHoverColor,icon:S.navForwardIcon(),style:I.forwardButton,title:u.getString("Global.ForwardButton"),accessibilityLabel:u.getString("Global.ForwardButton")},"creditEntitlementForwardButton")]}else{const e=u.getString("Entitlements.AddFundsLabel");s+=", "+e;const t={backgroundColor:this._themeColors.buttonBackgroundColor,textColor:this._themeColors.primaryIconColor};o=(0,a.jsx)(n.View,{blockPointerEvents:!0,children:(0,a.jsx)(g.default,{title:e,buttonStyle:r.SXButtonStyle.Custom,buttonSize:r.SXButtonSize.Small,buttonConfig:t,allowTextWrap:!0})})}return(0,a.jsxs)(n.View,{children:[this._renderOptionalSpacer("skypeToPhoneSpacer",[e,I.itemDividerMiddle]),(0,a.jsxs)(h.MaybeListItem.Button,{style:[I.container,_.default.pointerCursor],accessibilityLabel:s,onPress:this._onProceedButtonPress,children:[(0,a.jsx)(n.View,{style:I.iconContainer,children:this._renderImage(v,void 0)}),(0,a.jsxs)(n.View,{style:[I.labelsContainer,_.default.pointerCursor],children:[this._renderTopText(t),i]}),(0,a.jsx)(n.View,{style:I.rightPartView,children:o})]}),(0,a.jsx)(n.View,{style:e})]})}}t.LayoutOptionDefault=w,t.default=w},763912:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionNewCta=t.ActionButtonType=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(854646),l=i(154235),c=o.__importDefault(i(395781)),d=i(26703),u=o.__importStar(i(704704)),h=i(998929),p=o.__importDefault(i(660401)),g=i(16549),C=o.__importDefault(i(827361)),m=i(262725),S=i(641400),_=o.__importDefault(i(142193)),f=o.__importDefault(i(20758)),y=o.__importStar(i(322094));o.__importDefault(i(48076));var T;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(T||(t.ActionButtonType=T={}));const b=S.IconSize.size58,v=S.IconSize.size40,I=(0,d.lazyProperties)({componentContainer:()=>s.Styles.createViewStyle({paddingHorizontal:16,paddingVertical:6}),listItemContainer:()=>s.Styles.createViewStyle({flexDirection:"row"}),buttonContainer:()=>s.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",paddingLeft:4,overflow:"visible"}),buttonContainerWide:()=>s.Styles.createViewStyle({maxWidth:200}),buttonContainerSmall:()=>s.Styles.createViewStyle({paddingLeft:5}),iconContainer:()=>s.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"visible"}),centerTextContainer:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"space-around",paddingVertical:3,paddingRight:4,paddingLeft:16,flexGrow:1}),entitlementsContainer:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",paddingTop:1}),regularTextStyles:()=>s.Styles.createTextStyle({font:f.default.font.uiDisplayRegular}),buttonTextStyle:()=>s.Styles.createTextStyle({textAlign:"center"}),bannerTextStyle:()=>s.Styles.createTextStyle({fontSize:13,lineHeight:18}),topTextStyle:()=>s.Styles.createTextStyle({fontSize:12,lineHeight:16})});class w extends c.default{constructor(){super(...arguments),this._renderTopText=e=>(0,a.jsx)(m.Caption,{numberOfLines:1,style:I.regularTextStyles,children:e}),this._getButtonContainerResponsiveMaxWidth=()=>{let e;if(this.props.isLandscape)e=95;else{const t=y.default.getWidthNoSubscription(y.SideBar.Left);e=Math.ceil((t-32-b)/2)}return s.Styles.createViewStyle({maxWidth:e},!1)}}render(){const e=[I.iconContainer],t=[I.buttonContainer],i=[I.centerTextContainer];this.props.isSmallDevice&&!this.props.isLandscape&&t.push(I.buttonContainerSmall),t.push(this._getButtonContainerResponsiveMaxWidth());const o=u.getString("Entitlements.SkypeToPhoneTitle"),r=this._renderTopText(o),l=this._renderCenterText(),c=this._renderActionButton(),d=[o,l.accessibilityLabel,c.accessibilityLabel],p=n.join(d,", "),m=[{icon:S.SkypeIcon.GlobeCredit,color:g.Color.orangeLight},{icon:S.SkypeIcon.CreditGlobe,color:g.Color.blueDark}],f=this.props.isLandscape?v:b;return(0,a.jsx)(s.View,{style:I.componentContainer,children:(0,a.jsxs)(h.MaybeListItem.Button,{style:[I.listItemContainer,C.default.pointerCursor],accessibilityLabel:p,onPress:this._onProceedButtonPress,accessibilityTraits:s.Types.AccessibilityTrait.Button,children:[(0,a.jsx)(s.View,{style:e,children:(0,a.jsx)(_.default,{iconSize:f,icons:m})}),(0,a.jsxs)(s.View,{style:i,children:[r,l.element]}),(0,a.jsx)(s.View,{style:t,children:c.element})]})})}_renderCenterText(){if(this.props.isFreeTrialAvailable||"none"===this.props.userEntitlementsSummary){const e=u.getString("SkypeToPhonePanel.CallPhoneNumbers");return{element:(0,a.jsx)(s.View,{style:I.entitlementsContainer,children:(0,a.jsx)(m.Caption,{numberOfLines:void 0,selected:!0,style:[I.regularTextStyles,I.bannerTextStyle],children:e})}),accessibilityLabel:e}}{const e=this._renderCallingEntitlement(),t=this._renderSubscriptions(),i=n.compact([e?e.accessibilityLabel:void 0,t.accessibilityLabel]),o=n.join(i,", ");return{element:(0,a.jsxs)(s.View,{style:I.entitlementsContainer,children:[e?e.element:void 0,t.element]}),accessibilityLabel:o}}}_renderActionButton(){return this.props.isFreeTrialAvailable?this._renderButton(T.GetFreeTrial):"credit_only"===this.props.userEntitlementsSummary?this._renderButton(T.GetSubscription):this._renderButton(T.GetCredit)}_renderButton(e){let t,i,o="";const n={buttonStyle:l.SXButtonStyle.Custom},c={textColor:g.Color.white};switch(e){case T.GetFreeTrial:t=g.AgnosticGradientFillButtonColors.green,o=u.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case T.GetCredit:o=u.getString("SkypeToPhonePanel.GetCreditButton"),i=this._useAccessibleTheme()?void 0:{key:"primary",colors:this._getContext().gradients.primary};break;case T.GetSubscription:t=g.AgnosticGradientFillButtonColors.blue,o=u.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();c.backgroundColor=e?g.Color.white:g.Color.black,c.textColor=e?g.Color.black:g.Color.white}else n.buttonStyle=l.SXButtonStyle.AgnosticGradientFill,n.agnosticGradientColor=t,n.gradientDirection=r.GradientDirection.BOTTOM_RIGHT;e!==T.GetFreeTrial&&this.state.enableRefreshedPalette&&(n.buttonStyle=l.SXButtonStyle.GradientFill);return{element:(0,a.jsx)(s.View,{blockPointerEvents:!0,children:(0,a.jsx)(p.default,Object.assign({title:o,backgroundStyle:w._buttonBackgroundStyles,buttonSize:l.SXButtonSize.Small,buttonConfig:c,allowTextWrap:!0,textStyleOverride:[I.regularTextStyles,I.buttonTextStyle,I.bannerTextStyle]},n,{colorInfoOverride:i}))}),accessibilityLabel:o}}_renderSubscriptions(){let e;e=this.props.subscriptionMinutes&&1===this.props.subscriptionsCount?-1===this.props.subscriptionMinutes?u.getString("SkypeToPhonePanel.SubscriptionUnlimited"):u.getString("SkypeToPhonePanel.SubscriptionMinutesLeft",{count:this.props.subscriptionMinutes||""}):u.getString("SkypeToPhonePanel.SubscriptionsCount",{count:this.props.subscriptionsCount});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}_renderCallingEntitlement(){if(this.props.formattedBalance){const e=u.getString("SkypeToPhonePanel.Credit",{amount:this.props.formattedBalance||""});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}}_renderSmallBodyText(e){return(0,a.jsx)(m.BodyText,{numberOfLines:1,bold:!0,size:l.BodyTextSize.SmallDeprecated,children:e})}}t.LayoutOptionNewCta=w,w._buttonBackgroundStyles={borderRadius:32,paddingLeft:12,paddingRight:12,paddingTop:7,paddingBottom:7},t.default=w},406844:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(331654),r=i(217041),l=o.__importDefault(i(150343)),c=o.__importStar(i(603094)),d=i(154235),u=o.__importDefault(i(37679)),h=(o.__importDefault(i(149138)),o.__importDefault(i(994160))),p=o.__importDefault(i(960282)),g=o.__importDefault(i(602149));class C extends r.ComponentBase{_buildState(e,t){const i=u.default.getSubscriptions(),o=u.default.getCreditEntitlement(),a=h.default.getLoadedPersonalizedRecommendations();return{canRenderEntitlements:l.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.UIEnabled,userFormattedBalance:c.getFormattedBalance(o),userSubscriptionsCount:i?n.size(i):0,hasActiveCreditEntitlements:c.hasUsableCredit(o),hasCallingEntitlements:u.default.userHasSubscriptions(),userEntitlementsSummary:c.getEntitlementCombination(o,i),subscriptionMinutes:1===n.size(i)?i[0].isUnlimited?-1:i[0].availableMinutes:void 0,isFreeTrialAvailable:a&&n.some(a.callingOffers,(e=>e.isFreeTrial)),isSmallDevice:p.default.isSmallDevice(d.MainRootViewId),isLandscape:void 0!==e.isLandscape?e.isLandscape:p.default.getDeviceOrientation(d.MainRootViewId)===s.DeviceOrientation.Landscape,shouldUseGPlayBilling:g.default.shouldUseGooglePlayBillingForCredit()||g.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?g.default.requestUpdate():h.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return(0,a.jsx)(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,formattedBalance:this.state.userFormattedBalance,subscriptionsCount:this.state.userSubscriptionsCount,hasActiveCreditEntitlements:this.state.hasActiveCreditEntitlements,hasCallingEntitlements:this.state.hasCallingEntitlements,subscriptionMinutes:this.state.subscriptionMinutes,isFreeTrialAvailable:this.state.isFreeTrialAvailable,isSmallDevice:this.state.isSmallDevice,isLandscape:this.state.isLandscape})}}t.default=C},535927:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(150343)),s=o.__importStar(i(291524)),r=o.__importDefault(i(395781)),l=o.__importDefault(i(763912)),c=o.__importDefault(i(406844));class d extends s.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneCard")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneCard}render(){const e=this._getLayoutToDisplay();if(e)return(0,a.jsx)(c.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return(0,a.jsx)(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return this._getOptionToDisplay()===s.ExperimentOption.NewCta?l.default:r.default}}t.default=d},390212:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMemberHelper=void 0;const o=i(197582),a=i(667294),n=i(785893),s=o.__importStar(i(496486)),r=i(815146),l=o.__importStar(i(704704)),c=o.__importDefault(i(811795)),d=o.__importDefault(i(923728)),u=i(96249),h=i(331079),p="groupMemberHeader",g="groupMemberFooter",C="groupMember_";class m extends u.SearchSectionHelper{constructor(e=r.SearchResultsListGroup.GroupMember){super(),this._keys={footer:g,header:p},this._groupType=e}static _getKey(e){return C+e}static _getMri(e){return e}buildConfig(e,t,i){return{inactiveCallMemberMris:t.searchController.getGroupMemberResults(t.conversationId),searchQuery:i.trimmedNormalizedQuery,limit:3}}getItems(e,t,i,o,a){const n=r.SearchResultsListGroup.GroupMember,s={itemTemplate:"groupMember",header:l.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})},c=u.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:n,sourceList:this._searchConfig.inactiveCallMemberMris,keys:this._keys,renderConfig:s,getKey:m._getKey,getMri:m._getMri,limit:3,onFooterPress:a}),d=c.defaultList||[];return e.isShowingMore[this._groupType]&&d.push(...c.listWithRestOfItems),c.footerItem&&d.push(c.footerItem),c.defaultList}renderItem(e){return e.item.key===p?u.SearchSectionHelper.renderHeader(l.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})):e.item.key===g?this._renderFooterItem(e.item):e.item.key.substring(0,12)===C?this._renderSearchResultItem(e):void 0}_renderFooterItem(e){return(0,n.jsx)(d.default,{shouldShowAllResults:e.isShowingMore,groupType:this._groupType,onShowMorePress:e.onPress})}_renderSearchResultItem(e){const t=e.item.key.substring(12),i=u.SearchSectionHelper.getSearchBaseItemProps(e,t),o={textToHighlight:this._searchConfig.searchQuery,highlightType:h.TextToHighlightType.DisplayName};return(0,a.createElement)(c.default,Object.assign({},i,{key:"groupMemberItem",mri:t,textToHighlightInfo:o,showLastCallInfo:!1,groupType:r.SearchResultsListGroup.GroupMember,onItemPress:e.item.onListItemClick||s.noop}))}}t.GroupMemberHelper=m},447606:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.startPhoneNumberVerificationFromManageSearchPanel=function(e,t){a.track(new s.PnvUIStartFromManageSearchPanel),r(e,t)},t.startPhoneNumberVerification=r;const o=i(197582),a=o.__importStar(i(85385)),n=o.__importDefault(i(938730)),s=i(217437);function r(e,t){n.default.displayMsaPhoneAccrualDialog(e,t)}},902186:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PstnDialpadHelper=t.PstnDialpadItem=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(217041),r=i(815146),l=i(406719),c=o.__importDefault(i(457468)),d=i(26703),u=i(96249),h=o.__importDefault(i(535927)),p="dialpad",g="dialpadSpacer",C=(0,d.lazyProperties)({spacer:()=>n.Styles.createViewStyle({height:10})});class m extends s.ComponentBase{_buildState(e,t){return{disableHighBandwidthOperations:c.default.isUsingGogoNetwork()}}requestFocus(){}render(){return(0,a.jsx)(h.default,{location:l.ExperimentLocation.CallsPanel})}}t.PstnDialpadItem=m;class S extends u.SearchSectionHelper{constructor(){super()}buildConfig(e,t,i){}getItems(e,t,i,o){const a=[];return a.push({key:p,height:56,measureHeight:!0,template:"dialpad",isLastItem:!0,groupType:r.SearchResultsListGroup.PstnDialpad,onListItemClick:t.onListItemClick,isHoverable:!1}),a}renderItem(e){return e.item.key===p?this._renderDialpadItem(e):e.item.key===g?this._renderSpacer():void 0}_renderSpacer(){return(0,a.jsx)(n.View,{style:C.spacer},g)}_renderDialpadItem(e){return(0,a.jsx)(m,Object.assign({},e))}}t.PstnDialpadHelper=S},537705:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecentCallsHelper=void 0;const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importStar(i(44717)),l=i(815146),c=i(26703),d=o.__importStar(i(704704)),u=o.__importDefault(i(895597)),h=o.__importStar(i(398797)),p=o.__importDefault(i(184457)),g=o.__importDefault(i(811795)),C=i(96249),m=i(331079),S=o.__importDefault(i(685734)),_="recentCallsHeader",f="recentCall_",y="noCallsItemKey",T=(0,c.lazyProperties)({noCallsContainer:()=>s.Styles.createViewStyle({paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20})}),b={header:_};class v extends C.SearchSectionHelper{static _getKey(e){return f+e}static _getMri(e){return e}constructor(e){super(),this._useExtendedCallCount=e}buildConfig(e,t,i){return{localPhoneContacts:h.mapLocalContactsByMri(t.searchController.getAddressBookResults()),recentCallsConversationIds:t.searchController.getRecentCallsResults(),combinedContactsConversationIds:t.searchController.getCombinedContactsResults().reduce(((e,t)=>{var i;const o=null===(i=t.skypeContact)||void 0===i?void 0:i.getMri();return o&&e.push(o),e}),[]),isSyncAddressBookEnabled:i.isSyncAddressBookEnabled,limit:this._useExtendedCallCount?50:20,searchQuery:i.trimmedNormalizedQuery,upcomingCallsCount:p.default.ScheduledCallsStore.getUpcomingScheduledCalls().length}}getItems(e,t){const i=this._useExtendedCallCount?l.SearchResultsListGroup.RecentCallsExtended:l.SearchResultsListGroup.RecentCalls;if(0===this._searchConfig.recentCallsConversationIds.length&&0===this._searchConfig.combinedContactsConversationIds.length&&0===this._searchConfig.upcomingCallsCount&&!t.hideEmptyState&&0===Object.keys(this._searchConfig.localPhoneContacts).length)return[{index:0,isLastItem:!0,key:y,height:u.default.getDefaultHeight(),measureHeight:!0,template:"noCalls",groupType:i}];const o={itemTemplate:"call",header:d.getString("QuickCallPanel.RecentCallsSectionHeader"),hideHeader:this._useExtendedCallCount};return C.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:i,sourceList:this._searchConfig.recentCallsConversationIds.slice(0,this._searchConfig.limit),keys:b,renderConfig:o,getKey:v._getKey,getMri:v._getMri}).defaultList}renderItem(e){return e.item.key===_?C.SearchSectionHelper.renderHeader(d.getString("QuickCallPanel.RecentCallsSectionHeader")):e.item.key.substring(0,11)===f?this._renderSearchResultItem(e):e.item.key===y?this._renderNoCallsItem():void 0}_getNoCallsTitle(){return d.getString("RecentCallsHelper.NoRecentCallsTitleDesktop")}_renderNoCallsItem(){let e;return e=d.getString("RecentCallsHelper.NoRecentCallsDescriptionDesktop"),(0,a.jsx)(s.View,{style:T.noCallsContainer,children:(0,a.jsx)(u.default,{infoLabel:e,title:this._getNoCallsTitle()})},"noCallsItem")}_renderSearchResultItem(e){const t=e.item.key.substring(11),i=C.SearchSectionHelper.getSearchBaseItemProps(e,t),o={key:"recentCallItem",mri:S.default.getConversationOwner(t),origin:e.origin,pstnMri:r.isPhoneMri(t)?t:void 0,showLastCallInfo:!0,onItemPress:e.item.onListItemClick||n.noop};if(r.isPhoneMri(t)){const e=this._searchConfig.localPhoneContacts[t];e&&(o.addressBookContactOverride=e,o.isAddressBookContact=!0)}const s={textToHighlight:this._searchConfig.searchQuery,highlightType:m.TextToHighlightType.DisplayName};return(0,a.jsx)(g.default,Object.assign({},i,o,{textToHighlightInfo:s,groupType:this._useExtendedCallCount?l.SearchResultsListGroup.RecentCallsExtended:l.SearchResultsListGroup.RecentCalls}))}}t.RecentCallsHelper=v},398797:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapLocalContactsByMri=function(e){const t={},i=a.compact(a.map(e,(e=>e.addressBookContact)));return a.each(i,(e=>{e&&a.each(e.phones,(i=>{if(s.default.isValidNumberString(i.number)){const o=n.getMriFromPhoneNumber(i);t[o]=e}}))})),t};const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(44717)),s=o.__importDefault(i(808164))},548087:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showTranslationMenu=function e(t){u.log(d.LogTraceArea.CallingUI,`showTranslationMenu causeId: ${t.causeId}`);const i=()=>{var e;u.log(d.LogTraceArea.CallingUI,"onCloseMenu using X in header. causeId: "+t.causeId),null===(e=t.onClose)||void 0===e||e.call(t),r.default.close(t.rootViewId,t.causeId)},o=()=>{const e=m.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`showTranslationMenu causeId: ${e}`);const i=s.getString("LanguageAndTranslationSettingsPanel.TranslationSystemVoiceTitle"),o=[{command:S.Gender.female,text:s.getString("LanguageAndTranslationSettingsPanel.TranslatedVoiceOptionFemale")},{command:S.Gender.male,text:s.getString("LanguageAndTranslationSettingsPanel.TranslatedVoiceOptionMale")}],a=t.rootViewId,n={anchor:()=>{},buttons:o,title:i};_.default.showWithActionMenuConfig({options:n,callback:t=>I(t,e),onCancel:()=>w(),maintainAnchor:!1,rootViewId:a,useAlertForMobile:!0,useAlertForDesktop:t.useAlertForDesktop(),invokingEvent:void 0,allowScrolling:t.useAlertForDesktop()})},I=(e,i)=>{var o;e!==S.Gender.female&&e!==S.Gender.male?u.log(d.LogTraceArea.CallingUI,`showTranslationMenu newVoice ${e} not in supported voices list. causeId: ${i}`):(f.default.setCallTranslatorBotTranslationVoice(e),null===(o=t.update)||void 0===o||o.call(t,i)),w()},w=()=>{t.useAlertForDesktop()&&e(t)},P=e=>{const t=T.getShortLanguageTitle(e);return t&&""!==t?t:e},M=e=>{const i=m.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`_togglePstnTranslationLanguageMenu causeId: ${i}`);let o=s.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLocalLanguageTitle");e||(o=s.getString("LanguageAndTranslationSettingsPanel.TranslationSelectOtherLanguageTitle"));const a=y.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech,n=s.getLanguageFromLocale(),r=[...a].sort(((e,t)=>{const i=P(e),o=P(t);return i.localeCompare(o,n)})).map((e=>({text:P(e),command:e}))),l=t.rootViewId,c={anchor:()=>{},buttons:r,title:o};_.default.showWithActionMenuConfig({options:c,callback:o=>t.changeLanguage(e,o,i),onCancel:()=>w(),maintainAnchor:!1,rootViewId:l,useAlertForMobile:!0,useAlertForDesktop:t.useAlertForDesktop(),invokingEvent:void 0,allowScrolling:t.useAlertForDesktop()})},D=e=>{v.default.navigateToSpokenLanguagePicker(!1,t.rootViewId,e,t.conversationMri,t.changeLanguage)},A=n.throttle((()=>{const e=f.default.getCallTranslatorTruVoiceEnabled();b.default.InCallBotService.enableTruVoice(t.callId,!e)}),y.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceButtonThrottleTimeoutMs),k=n.throttle((()=>{const e=f.default.getCallTranslatorTranslationAutoDetectEnabled();b.default.InCallBotService.enableAutoDetect(t.callId,!e)}),y.default.getS4LCMCFeaturesNoSubscription().translationFeatures.autoDetectButtonThrottleTimeoutMs),R={callId:t.callId,conversationMri:t.conversationMri,isPSTNCall:t.isPstnCall,isEncryptedCall:!1,callerContext:t.callerContext,callUIState:t.callUIState},x=t.useLightTheme?g.Theme.Delphi:g.Theme.DelphiDark,L=(0,a.jsx)(c.default,Object.assign({isPstnTranslation:t.isPstnTranslation,isSkypeTranslation:t.isSkypeTranslation,colorThemeOverride:x,isUsingStackNavigationContext:t.isUsingStackNavigationContext,translateCall:t.startTranslation,changeVoice:()=>{const e=m.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`_togglePstnTranslationChangeVoice causeId: ${e}`),o()},changeLanguage:e=>{const t=m.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.Button Change my language pressed causeId: ${t}`),y.default.getS4LCMCFeaturesNoSubscription().enableNewLanguageSelectors?D(e):M(e)},flipLanguages:()=>{var e;const i=m.default.newCauseId();u.log(d.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.Button Flip languages pressed causeId: ${i}`),C.default.switchPstnCallTranlatorBotSpokenLanguageLocales(t.conversationMri),null===(e=t.update)||void 0===e||e.call(t,i)},closeMenu:i,toggleAutoDetect:k,toggleTruVoice:A,style:t.menuComponentStyle},R)),B=()=>s.getString("LanguageAndTranslationSettingsPanel.CallTranslationSettingsTitle"),V=c.default.menuHeight();r.default.showWithContent({menuId:r.default.menuId(),anchor:t.anchor,rootViewId:t.rootViewId,menuHeight:V,menuWidth:450,content:L,useBlurredBackground:!1,colorThemeOverride:x,borderRadius:8,headerConfig:t.isUsingStackNavigationContext?{headerType:h.HeaderType.Slim}:{headerType:h.HeaderType.Default,rightButton:{icon:p.SkypeIcon.Cancel,onPress:e=>{i()}}},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,useDesktopPopup:!t.isUsingStackNavigationContext&&!t.isMobileScreenReaderEnabled,getTitle:B,onCloseMenu:e=>{u.log(d.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),r.default.close(t.rootViewId,e)}},t.causeId),l.dismissAll()};const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(704704)),r=o.__importDefault(i(288547)),l=o.__importStar(i(170881)),c=o.__importDefault(i(996256)),d=i(815146),u=o.__importStar(i(85385)),h=i(410098),p=i(641400),g=i(206197),C=o.__importDefault(i(524526)),m=o.__importDefault(i(760989)),S=i(477195),_=o.__importDefault(i(888500)),f=o.__importDefault(i(341994)),y=o.__importDefault(i(150343)),T=o.__importStar(i(94534)),b=o.__importDefault(i(369347)),v=o.__importDefault(i(740794))},625209:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(873324)),n=o.__importDefault(i(859545)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importStar(i(704704)),c=o.__importDefault(i(888500)),d=o.__importDefault(i(760989)),u="LeaveCall",h="EndCallForEveryOne";class p{static selectEndCallMenuItem(e,t,i){const o=d.default.newCauseId();switch(r.log(s.LogTraceArea.CallingUI,"CallControlsEndCallContextMenu.selectEndCallMenuItem causeId: "+o),c.default.dismiss(p._endCallMenuId,t),e){case h:i(!0,o),r.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallForEveryone));break;case u:i(!1,o),r.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.LeaveCall))}}static _getEndCallMenuConfig(e){return{anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}}}p._endCallMenuId=c.default.menuId(),p.showEndCallMenuPopup=(e,t,i,o)=>{const n=p._getEndCallMenuConfig(i);c.default.showWithOptions({id:p._endCallMenuId,config:n,getMenuItems:p._getEndCallMenuItems,handleMenuCommand:o,rootViewId:e,invokingEvent:t})&&r.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallPopupShown))},p._getEndCallMenuItems=()=>{const e=[];return e.push({text:l.getString("CallControls.LeaveCall"),command:u}),n.default.call().canEndCallForAll&&e.push({text:l.getString("CallControls.HangupAllMessageDesktop"),command:h}),e},t.default=p},830745:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(369347)),s=o.__importStar(i(873324)),r=o.__importDefault(i(638260)),l=i(460515),c=o.__importDefault(i(132680)),d=i(154235),u=i(815146),h=o.__importStar(i(85385)),p=o.__importStar(i(704704)),g=o.__importDefault(i(740794)),C=i(812822),m=i(231817),S=i(602370),_=o.__importDefault(i(888500)),f=o.__importDefault(i(760989)),y=i(721748),T=(o.__importDefault(i(150343)),"TurnOffVideo"),b="Mute",v="Unmute",I="BlurBackground",w="UnblurBackground",P="CropVideo",M="FullVideo",D="BackgroundEffectsSettings",A="LowerHand",k="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callLocalVideoContextMenuOptions=e,this._getActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallLocalVideoMenuItems=()=>{const e=[],t=this._getCameraMenuItems(),i=this._getOtherMenuItems();return t.length&&e.push({key:"cameraSwitching",menuItems:t}),e.push({key:"otherSettings",menuItems:i}),e},this._getCameraMenuItems=()=>{const e=[],t=n.default.DeviceStore.getCameras(),i=this._getSelectedCameraId();return t.forEach((t=>{e.push({text:t.label,command:t.id,selected:this._localVideoOn&&t.id===i,selectableType:d.SXMenuItemSelectableType.Checkbox})})),e.push({text:p.getString("CallControls.CallButtonTurnOffVideoLabel"),command:T,selected:!this._localVideoOn,selectableType:d.SXMenuItemSelectableType.Checkbox}),e},this._getOtherMenuItems=()=>{const e=[],t=c.default.isLocalOrServerMuted(this._callLocalVideoContextMenuOptions.callId);if(this._localVideoOn&&n.default.DeviceStore.isBackgroundBlurCapable()&&!n.default.DeviceStore.isBackgroundReplacementEnabled()){const t=n.default.DeviceStore.isBackgroundBlurred();e.push({text:t?p.getString("CallControls.CallMenuUnBlurBackground"):p.getString("CallControls.CallMenuBlurBackground"),command:t?w:I})}return this._localVideoOn&&n.default.DeviceStore.isBackgroundReplacementEnabled()&&e.push({text:p.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings"),command:D}),e.push({text:t?p.getString("CallControls.CallMenuUnmuteMicrophone"):p.getString("CallControls.CallMenuMuteMicrophone"),command:t?v:b}),this._callLocalVideoContextMenuOptions.showLowerHand&&e.push({text:p.getString("CallControls.LowerHand"),command:A}),this._callLocalVideoContextMenuOptions.showCropUncropMenuOption&&!a.isUndefined(this._callLocalVideoContextMenuOptions.sizeToFit)&&(this._callLocalVideoContextMenuOptions.sizeToFit?e.push({text:p.getString("CallControls.ShowCroppedVideo"),command:P}):e.push({text:p.getString("CallControls.ShowFullVideo"),command:M})),this._callLocalVideoContextMenuOptions.showPinOption&&this._callLocalVideoContextMenuOptions.isGroupCall&&e.push({text:p.getString("CallControls.PinParticipant"),command:k}),this._callLocalVideoContextMenuOptions.showUnpinOption&&this._callLocalVideoContextMenuOptions.isGroupCall&&e.push({text:p.getString("CallControls.UnpinParticipant"),command:R}),e},this._selectMenuItem=(e,t,i)=>{var o;const d=f.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"CallLocalVideoContextMenu._selectMenuItem"+e+" causeId: "+d);const p=n.default.DeviceStore.getCameras();switch(a.each(p,(t=>{var i;if(t.id!==e);else if(t.id!==this._getSelectedCameraId()&&(n.default.DeviceStore.choosePreferredDevices({camera:e},d),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.SwitchCamera,this._callLocalVideoContextMenuOptions.callId))),!this._localVideoOn){const{callId:e}=this._callLocalVideoContextMenuOptions;null===(i=n.default.CallingStore.getLocalVideoState(e))||void 0===i||i.setLocalVideoEnabled(!0),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.TurnOnVideo,e))}})),e){case T:if(this._localVideoOn){const{callId:e}=this._callLocalVideoContextMenuOptions;null===(o=n.default.CallingStore.getLocalVideoState(e))||void 0===o||o.setLocalVideoEnabled(!1),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.TurnOffVideo,this._callLocalVideoContextMenuOptions.callId))}break;case b:n.default.CallingStore.mute(this._callLocalVideoContextMenuOptions.callId,d),c.default.announceMicrophoneState(!0),r.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,d,(e=>e.muteLocalVideoContextMenuPress())),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.Mute,this._callLocalVideoContextMenuOptions.callId));break;case v:n.default.CallingStore.unmute(this._callLocalVideoContextMenuOptions.callId,d),c.default.announceMicrophoneState(!1),r.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,d,(e=>e.muteLocalVideoContextMenuPress())),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.Unmute,this._callLocalVideoContextMenuOptions.callId));break;case I:n.default.DeviceStore.setBackgroundEffectType(u.BackgroundEffect.Blur),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.BackgroundBlur,this._callLocalVideoContextMenuOptions.callId));break;case w:n.default.DeviceStore.setBackgroundEffectType(u.BackgroundEffect.Off),h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.BackgroundUnBlur,this._callLocalVideoContextMenuOptions.callId));break;case P:i&&i(!1);break;case M:i&&i(!0);break;case D:this._showAVSettings(t);break;case A:new m.LowerHandCommand(this._callLocalVideoContextMenuOptions.callId,S.LowerHandOrigin.OverflowMenu).execute();break;case k:case R:new y.PinUnpinCommand(l.CallStageElementKeys.localUserKey,this._callLocalVideoContextMenuOptions.callId).execute()}},this._showCallLocalVideoMenuPopup=(e,t,i,o)=>{const a=this._getActionsMenuConfig(i);_.default.showGroupWithOptions({id:this._callLocalVideoMenuId,config:a,getMenuGroups:this._getCallLocalVideoMenuItems,handleMenuCommand:o,rootViewId:e,invokingEvent:t})&&h.track(new s.LocalVideoActionsEvent(s.LocalVideoActions.PopupShown,this._callLocalVideoContextMenuOptions.callId))},this._getSelectedCameraId=()=>{const e=n.default.DeviceStore.getCurrentDevices();return null==e?void 0:e.camera},this._showAVSettings=e=>{const t=f.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"CallLocalVideContextMenu._showAVSettings causeId: "+t),g.default.navigateToDesktopSettingsGroup(C.SettingsGroup.AudioVideoSettings,e,t)},this._callLocalVideoMenuId=_.default.menuId(),this._localVideoOn=n.default.CallingStore.isProvidingVideo(this._callLocalVideoContextMenuOptions.callId)}showContextMenu(e,t,i,o){!!this._callLocalVideoContextMenuOptions.conversationMri&&n.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:n.default.CallingStore.isPSTNCall(this._callLocalVideoContextMenuOptions.callId),isEncryptedCall:n.default.CallingStore.isEncryptedCall(this._callLocalVideoContextMenuOptions.callId),conversationMri:this._callLocalVideoContextMenuOptions.conversationMri,callId:this._callLocalVideoContextMenuOptions.callId})?this._showCallLocalVideoMenuPopup(e,t,i,(t=>this._selectMenuItem(t,e,o))):h.log(u.LogTraceArea.CallingUI,"CallLocalVideoContextMenu allowOutboundVideo is false")}_getAndroidCameraItems(e,t){const i=[];let o=0,a=0;return e.forEach((e=>{let n=e.label;-1!==n.indexOf(l.AndroidFrontCameraPattern)?(o++,n=1===o?p.getString("CallControls.FrontCameraLabel"):p.getString("CallControls.FrontCameraLabelWithIndex",{index:o})):-1!==n.indexOf(l.AndroidBackCameraPattern)&&(a++,n=1===a?p.getString("CallControls.BackCameraLabel"):p.getString("CallControls.BackCameraLabelWithIndex",{index:a})),i.push({text:n,command:e.id,selected:this._localVideoOn&&e.id===t,selectableType:d.SXMenuItemSelectableType.Checkbox})})),i}}},549173:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(397691)),n=o.__importDefault(i(402536)),s=o.__importDefault(i(369347)),r=o.__importDefault(i(441428)),l=o.__importDefault(i(963721)),c=o.__importStar(i(704704)),d=o.__importStar(i(888500));t.default=new class{showForSkypeMri(e,t,i,o,a,n,s,r,c,d,u,h,p){l.default.showForSkypeMri(e,t,i,o,a,n,s,r,c,d,u,h,p)}showForPhoneNumber(e,t,i,o,a){l.default.showForPhoneNumber(e,t,i,o,a)}showForAddressContact(e,t,i,o,a,n,s,r,c,d){l.default.showForAddressContact(e,t,i,o,a,n,s,r,c,d)}startCallOrMaybePrompt(e,t,i,o,u,h){const p=(e,t)=>s.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:t,origin:i.callOrigin,openInMainWindow:u,view:h},o),g=i=>{const o=[{text:c.getString("CallOrInviteMenu.UnencryptedCallAlertYes"),command:""}],n={anchor:e,buttons:o,positionPriorities:["bottom"],title:i?c.getString("CallOrInviteMenu.UnencryptedVideoCallAlertTitle"):c.getString("CallOrInviteMenu.UnencryptedAudioCallAlertTitle"),message:i?c.getString("CallOrInviteMenu.UnencryptedVideoCallAlertBody"):c.getString("CallOrInviteMenu.UnencryptedAudioCallAlertBody"),cancelButtonTitle:c.getString("CallOrInviteMenu.UnencryptedCallAlertNo"),cancelButtonPosition:d.CancelButtonPosition.End,destructiveButtonIndex:0},s=a.Defer();return d.default.showWithActionMenuConfig({options:n,callback:e=>{e!==d.SXActionMenuCancel?s.resolve(void 0):s.reject()},rootViewId:t,useAlertForDesktop:!0,useAlertForMobile:!1,invokingEvent:void 0}),s.promise()},C=(e,t,a)=>s.default.CallNavigationHelper.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin,openInMainWindow:u,view:h},o),m=(e,t,a)=>s.default.CallPreviewUtils.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin},o),S=(o,a,n,s,r,c,d,u)=>{l.default.showForSkypeMri(e,t,o,a,n,i.inviteOrigin,i.callOrigin,s,r,c,d,u,i.popupTitleOverride)},_=(o,a,n)=>{l.default.showForAddressContact(e,t,o,i.inviteOrigin,i.callOrigin,a,n,!1)};return n.default.loadCallingBundle().then((()=>r.default.startCallOrMaybePromptHelper(i,p,C,m,S,_,g,o)))}}},139466:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importDefault(i(150343)),n=i(737298),s=o.__importStar(i(483255)),r=o.__importDefault(i(99741)),l=o.__importStar(i(873324)),c=o.__importDefault(i(132680)),d=i(154235),u=i(815146),h=o.__importStar(i(85385)),p=o.__importStar(i(704704)),g=o.__importDefault(i(740794)),C=i(276602),m=i(231817),S=i(602370),_=o.__importDefault(i(888500)),f=o.__importDefault(i(760989)),y=i(721748),T="RemoveFromCall",b="Mute",v="CropVideo",I="FullVideo",w="SendMessage",P="ViewProfile",M="MuteEveryone",D="LowerHand",A="ChangeTogetherModeBackground",k="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callParticipantContextMenuOptions=e,this._selectUserNameChevronMenuItem=(e,t,i)=>{this._selectCanvasAndRibbonActionsMenuItem(e,t,i)},this._getCanvasAndRibbonActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallParticipantMenuItems=()=>{const e=[];return this._callParticipantContextMenuOptions.showMute&&e.push({text:p.getString("CallControls.CallButtonMute"),command:b,disabled:!this._callParticipantContextMenuOptions.isMuteOptionDisabled}),this._callParticipantContextMenuOptions.showRemoveCall&&e.push({text:p.getString("CallControls.RemoveFromCall"),command:T}),this._callParticipantContextMenuOptions.showCropVideoOption?e.push({text:p.getString("CallControls.ShowCroppedVideo"),command:v}):this._callParticipantContextMenuOptions.showFullVideoOption&&e.push({text:p.getString("CallControls.ShowFullVideo"),command:I}),this._callParticipantContextMenuOptions.showLowerHandOption&&a.default.getS4LCMCFeatures().enableCallLowerHandByOthers&&c.default.canHandBeLoweredForParticipant(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri)&&e.push({text:p.getString("CallControls.LowerHand"),command:D}),this._callParticipantContextMenuOptions.showChangeTogetherModeBackgroundOption&&e.push({text:p.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),command:A}),this._callParticipantContextMenuOptions.showPinOption&&e.push({text:p.getString("CallControls.PinParticipant"),command:k}),this._callParticipantContextMenuOptions.showUnpinOption&&e.push({text:p.getString("CallControls.UnpinParticipant"),command:R}),e},this._getMenuItemsRelatedToOutsideTheCall=()=>{const e=[];return this._callParticipantContextMenuOptions.showSendMessageMenuOption&&e.push({text:p.getString("CallControls.SendMessageFromParticipantMenuAccessibilityLabel"),command:w}),this._callParticipantContextMenuOptions.showViewProfile&&e.push({text:p.getString("GroupProfilePanel.ViewInfo"),command:P}),e},this._getMenuItemsRelatedToModeratedChat=()=>{const e=[];return this._callParticipantContextMenuOptions.showMuteEveryone&&e.push({text:p.getString("CallControls.CallButtonMuteEveryone"),command:M}),e},this._getCanvasAndRibbonActionsMenuItems=()=>{const e=[],t=this._getCallParticipantMenuItems(),i=this._getMenuItemsRelatedToOutsideTheCall(),o=this._getMenuItemsRelatedToModeratedChat();return t.length>0&&e.push({key:"menuItemsCallParticipant",menuItems:t,title:void 0}),i.length>0&&e.push({key:"menuItemsRelatedToOutsideTheCall",menuItems:i}),o.length>0&&e.push({key:"menuItemsRelatedToModeratedChat",menuItems:o}),e},this._selectCanvasAndRibbonActionsMenuItem=(e,t,i)=>{const o=f.default.newCauseId();switch(h.log(u.LogTraceArea.CallingUI,"CallParticipantActionsContextMenu._selectCanvasAndRibbonActionsMenuItem causeId: "+o),e){case P:g.default.showDetailsPanelWithParams({mri:this._callParticipantContextMenuOptions.userMri,rootViewId:d.MainRootViewId,causeId:o}),h.track(new l.CanvasAndRibbonActionsEvent(l.CanvasAndRibbonActions.ViewProfile,this._callParticipantContextMenuOptions.callId));break;case T:r.default.handleRemoteHangup(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,o),h.track(new l.CanvasAndRibbonActionsEvent(l.CanvasAndRibbonActions.RemoveFromCall,this._callParticipantContextMenuOptions.callId));break;case b:r.default.handleRemoteMute(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,o),h.track(new l.CanvasAndRibbonActionsEvent(l.CanvasAndRibbonActions.Mute,this._callParticipantContextMenuOptions.callId));break;case M:new n.MuteEveryoneCommand(this._callParticipantContextMenuOptions.callId).execute(),h.track(new l.CallMuteEveryoneEvent(l.MuteEveryoneOrigin.OverflowMenu));break;case v:if(i){new s.default(i).execute()}break;case I:if(i){new s.FullVideoCommand(i).execute()}break;case w:(new s.SendMessageCommand).execute(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId);break;case D:new m.LowerHandParticipantCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri,S.LowerHandOrigin.OverflowMenu,this._callParticipantContextMenuOptions.isLocal,this._callParticipantContextMenuOptions.displayName).execute();break;case A:new C.ChangeTogetherModeBackgroundCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.conversationMri).execute();break;case k:case R:new y.PinUnpinCommand(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId).execute()}},this._showCanvasAndRibbonActionsMenuPopup=(e,t,i,o,a,n)=>{const s=this._getCanvasAndRibbonActionsMenuConfig(i);_.default.showGroupWithOptions({id:this._canvasAndRibbonActionsMenuId,config:s,getMenuGroups:this._getCanvasAndRibbonActionsMenuItems,handleMenuCommand:o,onDismiss:n,maintainTitleForMobile:!0,cancelButtonTitleIOS:p.getString("Global.CancelLabel"),rootViewId:e,invokingEvent:t})&&(a&&a(),h.track(new l.CanvasAndRibbonActionsEvent(l.CanvasAndRibbonActions.PopupShown,this._callParticipantContextMenuOptions.callId)))},this._canvasAndRibbonActionsMenuId=_.default.menuId()}showContextMenu(e,t,i,o,a,n){this._showCanvasAndRibbonActionsMenuPopup(e,t,i,(e=>this._selectUserNameChevronMenuItem(e,a,n)),o,a)}}},907880:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(815063),s=o.__importDefault(i(97572)),r=i(737298),l=o.__importDefault(i(830745)),c=o.__importDefault(i(139466)),d=i(460515),u=o.__importStar(i(44717)),h=o.__importDefault(i(615364)),p=o.__importDefault(i(19831)),g=o.__importDefault(i(186477)),C=i(675862),m=o.__importDefault(i(132680));t.default=new class{getCallLocalVideoContextMenuOptions(e,t,i,o,n,s,r=!1,l=!1){return{callId:e,conversationMri:t,isGroupCall:!!t&&u.isGroupConversation(t),sizeToFit:!a.isUndefined(n)&&n,isCompact:!!i,isInTray:!!l,isRenderingVideo:o,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showLowerHand:s,showPinOption:m.default.shouldShowCallParticipantPinOption(d.CallStageElementKeys.localUserKey,e),showUnpinOption:m.default.shouldShowCallParticipantUnpinOption(d.CallStageElementKeys.localUserKey,e)}}getShowCropUncropMenuOption(e,t,i,o=!1){let a=!0;return(n.BrowserEnvironment.isEngineEdgeHTML()||e||!t||i||o)&&(a=!1),a}getMenuOptionEnabled(e){let t=!1,i=!1,o=!1,n=!1,l=!1,c=!1,d=!1;const p=new r.MuteEveryoneCommand(e.callId).canExecute(),g=(0,h.default)().getConversation(e.conversationMri),m=e.isGroupCall&&!e.isCropVideoEnabledOnGroupCall||!e.isGroupCall&&!e.isCropVideoEnabledOn1On1Call;if(t=this.getShowCropUncropMenuOption(m,e.isRenderingVideo,e.isCompact,e.isInTray),!e.isLocal&&e.isGroupCall){o=!0,i=!0;const{showChangeTogetherModeBackgroundOption:a}=e;a?(i=!1,o=!1,t=!1):(0,C.isRegularMemberInModeratedGroup)(g)&&(i=!1,o=!1)}return!e.showSendMessageMenuOption||e.isLocal||!e.isGroupCall||s.default.isMriBlocked(e.userMri)||u.isGuestUserMri(e.userMri)||(l=!0),i&&e.isLocalMuteSupported&&e.isServerMutedSupported&&!e.isMuted&&(n=!0),t&&!a.isUndefined(e.sizeToFit)&&(e.sizeToFit?c=!0:d=!0),{isMuteOptionDisabled:n,showMute:i,showMuteEveryone:p,showRemoveCall:o,showCropUncropMenuOption:t,showSendMessageMenuOption:l,showCropVideoOption:c,showFullVideoOption:d}}showParticipantActionsContextMenuOnPosition(e,t,i,o,n,s){g.default.setAnchorPosition(e),a.defer((()=>{const a=p.default.getMenuTargetCallback(t),r=this.getMenuOptionEnabled(i);i.isMuteOptionDisabled=r.isMuteOptionDisabled,i.showMute=r.showMute,i.showMuteEveryone=r.showMuteEveryone,i.showRemoveCall=r.showRemoveCall,i.showCropUncropMenuOption=r.showCropUncropMenuOption,i.showSendMessageMenuOption=r.showSendMessageMenuOption,i.showCropVideoOption=r.showCropVideoOption,i.showFullVideoOption=r.showFullVideoOption;new c.default(i).showContextMenu(t,{pageX:e.x,pageY:e.y},a,o,n,i.showCropUncropMenuOption?s:void 0)}))}showParticipantActionsContextMenu(e,t,i,o,n,s){e.stopPropagation(),e.preventDefault();const r=a.pick(e,"pageX","pageY");this.showParticipantActionsContextMenuOnPosition({x:r.pageX||0,y:r.pageY||0},t,i,o,n,s)}showLocalVideoActionsContextMenuOnPosition(e,t,i,o){g.default.setAnchorPosition(e),a.defer((()=>{const a=p.default.getMenuTargetCallback(t),n=new l.default(i),s=i.isGroupCall&&!i.isCropVideoEnabledOnGroupCall||!i.isGroupCall&&!i.isCropVideoEnabledOn1On1Call;i.showCropUncropMenuOption=this.getShowCropUncropMenuOption(s,i.isRenderingVideo,i.isCompact,i.isInTray),n.showContextMenu(t,{pageX:e.x,pageY:e.y},a,i.showCropUncropMenuOption?o:void 0)}))}showLocalVideoActionsContextMenu(e,t,i,o){e.stopPropagation(),e.preventDefault();const n=a.pick(e,"pageX","pageY");this.showLocalVideoActionsContextMenuOnPosition({x:n.pageX||0,y:n.pageY||0},t,i,o)}}},483255:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SendMessageCommand=t.FullVideoCommand=void 0;const o=i(197582),a=o.__importStar(i(873324)),n=o.__importDefault(i(304623)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importDefault(i(740794)),c=o.__importStar(i(437782)),d=o.__importDefault(i(760989));t.default=class{constructor(e){this._onToggleCropVideo=e}execute(){r.log(s.LogTraceArea.Calling,"CropVideoCommand.execute."),this._onToggleCropVideo(!1)}};t.FullVideoCommand=class{constructor(e){this._onToggleCropVideo=e}execute(){r.log(s.LogTraceArea.Calling,"FullVideoCommand.execute."),this._onToggleCropVideo(!0)}};t.SendMessageCommand=class{execute(e,t=""){n.default.ensureConversationLoadedOrFaked(e).then((i=>{const o=d.default.newCauseId();r.log(s.LogTraceArea.Calling,"SendMessageCommand.execute, causeId: "+o+" user mri:"+c.mriOrId(e)),l.default.navigateToConversation({convId:e,origin:s.NavigationConversationOrigin.CallParticipantActionMenu,isNewConversation:i,causeId:o}),r.track(new a.CanvasAndRibbonActionsEvent(a.CanvasAndRibbonActions.SendMessage,t))}))}}},780676:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubtitleMaxWidthV3=t.SubtitleMaxWidthV2=t.SubtitleMaxWidth=void 0;const o=i(197582).__importDefault(i(760989)),a={desktop:{portrait:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!1,fixedSize:300,sizeRatio:0}}},mobile:{portrait:{preview:{isHorizontal:!0,sizeRatio:.65},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.8},interactive:{isHorizontal:!1,sizeRatio:.5}}}};t.SubtitleMaxWidth=500,t.SubtitleMaxWidthV2=600,t.SubtitleMaxWidthV3=1e3;class n{static getTranscriptionLayout(e,t,i){const o=t?a.mobile:a.desktop,n=i?o.landscape:o.portrait;return e?n.interactive:n.preview}static getTranscriptionLayoutRects(e,t){const i=t.fixedSize?n.shrinkRectByAmount(e,t.fixedSize,t.isHorizontal):n.shrinkRectByRatio(e,t.sizeRatio,t.isHorizontal);let o=i.remainderRect;if(t.paddingSize){const e=n.shrinkRectByAmount(o,t.paddingSize,!t.isHorizontal).shrinkedRect;o={x:t.isHorizontal?e.x+t.paddingSize:e.x,y:t.isHorizontal?e.y:e.y+t.paddingSize,width:e.width,height:e.height}}return{stage:i.shrinkedRect,subtitles:o,isHorizontal:t.isHorizontal}}static shrinkRectByRatio(e,t,i){t=o.default.clampValue(t,0,1);const a=Math.floor((i?e.height:e.width)*t);return n.shrinkRectByAmount(e,a,i)}static shrinkRectByAmount(e,t,i){t=o.default.clampValue(t,0,i?e.height:e.width);const a=i?{x:e.x,y:e.y,width:e.width,height:e.height-t}:{x:e.x,y:e.y,width:e.width-t,height:e.height};return{shrinkedRect:a,remainderRect:i?{x:e.x,y:a.y+a.height,width:e.width,height:e.height-a.height}:{x:a.x+a.width,y:e.y,width:e.width-a.width,height:e.height}}}}t.default=n},273186:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.SharingSourceSize=void 0;const o=i(331079);class a{}t.SharingSourceSize=a,a.XLarge={width:960,height:576},a.Large={width:480,height:288},a.Medium={width:240,height:144},a.Small={width:160,height:90},a.XSmall={width:80,height:45};const n=a.Small.width;var s;!function(e){e[e.FourWindowsColumns=490+3*n]="FourWindowsColumns",e[e.ThreeWindowsColumns=490+2*n]="ThreeWindowsColumns",e[e.TwoWindowsColumns=490+n]="TwoWindowsColumns",e[e.OneWindowsColumn=490]="OneWindowsColumn",e[e.NoWindowsColumn=600]="NoWindowsColumn"}(s||(t.ModalWidth=s={}));var r;!function(e){e[e.ThreeScreens=650]="ThreeScreens",e[e.ThreeScreensAndToggle=720]="ThreeScreensAndToggle",e[e.TwoScreens=515]="TwoScreens",e[e.TwoScreensAndToggle=585]="TwoScreensAndToggle",e[e.OneScreen=380]="OneScreen",e[e.OneScreenAndToggle=450]="OneScreenAndToggle",e[e.NoWindowsOneScreens=640]="NoWindowsOneScreens",e[e.NoWindowsTwoScreens=500]="NoWindowsTwoScreens",e[e.NoWindowsMoreThanTwoScreens=685]="NoWindowsMoreThanTwoScreens"}(r||(t.ModalHeight=r={}));t.default=class{static getSourceItemDimensions(e,t,i){let o=!1;t&&e<t&&i>1&&(o=!0);const n=e/i;return n>1e3&&!o?a.XLarge:n>200?a.Large:n>90?a.Medium:a.Small}static getWindowSourceItemDimensions(){return a.Small}static getScreenSourceItemDimensions(e,t,i){return t?1===i&&e!==o.ResponsiveWidth.MinDesktop?a.Large:a.Medium:e!==o.ResponsiveWidth.MinDesktop||t?a.Small:a.XSmall}static getModalWidth(e,t,i){if(0===i)return s.NoWindowsColumn;let a,n;switch(e){case o.ResponsiveWidth.Large:a=4;break;case o.ResponsiveWidth.Medium:a=3;break;case o.ResponsiveWidth.Small:default:a=2}n=2!==t||3!==i&&4!==i?i>9?4:i>6?3:i>3?2:1:2;switch(Math.min(a,n)){case 1:default:return s.OneWindowsColumn;case 2:return s.TwoWindowsColumns;case 3:return s.ThreeWindowsColumns;case 4:return s.FourWindowsColumns}}static getModalHeigh(e,t,i){if(0===t)return 1===e?r.NoWindowsOneScreens:2===e?r.NoWindowsTwoScreens:r.NoWindowsMoreThanTwoScreens;let o;switch(o=e>=3?3:2===e?t>4?3:e:t>=3?3:t,o){case 1:return i?r.OneScreenAndToggle:r.OneScreen;case 2:return i?r.TwoScreensAndToggle:r.TwoScreens;default:return i?r.ThreeScreensAndToggle:r.ThreeScreens}}}},807833:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.BackgroundSize=void 0;class i{}t.BackgroundSize=i,i.XLarge={width:960,height:576},i.Large={width:288,height:173},i.Medium={width:240,height:144},i.Small={width:160,height:90},i.XSmall={width:80,height:45};const o=i.Small.width;var a;!function(e){e[e.FourColumns=380+3*o]="FourColumns",e[e.ThreeColumns=380+2*o]="ThreeColumns",e[e.TwoColumns=380+o]="TwoColumns",e[e.OneColumn=380]="OneColumn"}(a||(t.ModalWidth=a={}));var n;!function(e){e[e.ThreeRows=650]="ThreeRows",e[e.TwoRows=515]="TwoRows",e[e.OneRow=380]="OneRow"}(n||(t.ModalHeight=n={}));t.default=class{static getBackgroundItemDimensions(e,t,o){return o&&e&&t?i.Medium:e&&t?i.Large:i.Medium}static getModalWidth(e,t){return a.TwoColumns}static getModalHeight(e){return n.ThreeRows}}},771895:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InCallFeatureStoppedState=t.InCallFeatureStoppedByRemoteUserState=t.InCallFeatureEnabledByRemoteState=t.InCallFeatureEnabledState=t.RemoteConsentRejectedByRemoteUserState=t.RemoteConsentCancelledByLocalUserState=t.RemoteConsentRequestedByLocalUserState=t.SelfConsentFromRemoteUserRejectedByLocalUserState=t.SelfConsentRequestedByRemoteUserState=t.SelfConsentRejectedState=t.SelfConsentRequestedState=t.InCallFeatureRemoteFailedState=t.InCallFeatureFailedState=t.InCallFeatureNotSupportedState=t.InCallFeatureDisabledState=t.FeatureConsentFlowState=void 0;const o=i(197582).__importStar(i(85385)),a=i(619429),n=i(815146);class s{constructor(e,t){this.getState=()=>({state:this.getFeatureState(),requestedBy:this._requestedBy}),this.onEnter=()=>{this._logMessage(`Switching to ${a.InCallFeatureState[this.getFeatureState()]}`)},this._callId=e,this._requestedBy=t}_logInvalidTransition(e){this._logMessage(`Transition ${a.InCallFeatureTransitionAction[e.action]}\n            from ${a.InCallFeatureState[this.getState().state]} state not supported`)}_logMessage(e){o.log(n.LogTraceArea.InCallBotService,`[InCallFeature] ${e}`)}}t.FeatureConsentFlowState=s;class r extends s{constructor(e,t,i,o,n){super(o,n),this.getFeatureState=()=>a.InCallFeatureState.Disabled,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.Start:case a.InCallFeatureTransitionAction.RequestConsent:return this._hasConsent()?new f(this._callId,e.requestedBy):new p(this._hasConsent,this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.Start:return this._isFeatureSupportedFn()?this._hasConsent()?this._hasRemoteConsentFn()?new _(this._callId):new C(this._callId):new u(this._hasConsent,this._hasRemoteConsentFn,this._callId):new l(this._callId);case a.InCallFeatureTransitionAction.Fail:return new c(this._callId);case a.InCallFeatureTransitionAction.Stop:return new r(this._hasConsent,this._hasRemoteConsentFn,this._isFeatureSupportedFn,this._callId);default:return this._logInvalidTransition(e),this}},this._hasConsent=e,this._hasRemoteConsentFn=t,this._isFeatureSupportedFn=i}}t.InCallFeatureDisabledState=r;class l extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.NotSupported,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>this,this.handleLocalUserAction=e=>this}}t.InCallFeatureNotSupportedState=l;class c extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.Failed,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.Fail,this.handleRemoteUserAction=e=>this,this.handleLocalUserAction=e=>this}}t.InCallFeatureFailedState=c;class d extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.RemoteFailed,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.Fail,this.handleRemoteUserAction=e=>this,this.handleLocalUserAction=e=>this}}t.InCallFeatureRemoteFailedState=d;class u extends s{constructor(e,t,i){super(i),this.getFeatureState=()=>a.InCallFeatureState.SelfConsentRequested,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new S(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Stop:return new y(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Fail:return new d(this._callId);case a.InCallFeatureTransitionAction.RequestConsent:case a.InCallFeatureTransitionAction.Start:return new p(this._hasConsent,this._callId,e.requestedBy);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new h(this._callId);case a.InCallFeatureTransitionAction.RequestConsent:return new C(this._callId);case a.InCallFeatureTransitionAction.Stop:return new T(this._callId);case a.InCallFeatureTransitionAction.Start:return this._hasConsent()?this._hasRemoteConsentFn()?new _(this._callId):new C(this._callId):(this._logInvalidTransition(e),this);case a.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}},this._hasConsent=e,this._hasRemoteConsentFn=t}}t.SelfConsentRequestedState=u;class h extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.SelfConsentRejected,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.SelfConsentRejectedState=h;class p extends s{constructor(e,t,i){super(t,i),this.getFeatureState=()=>a.InCallFeatureState.ConsentRequestedByRemote,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new S(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Stop:return new y(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.Start:case a.InCallFeatureTransitionAction.RequestConsent:return this._hasConsent()?new _(this._callId):(this._logInvalidTransition(e),this);case a.InCallFeatureTransitionAction.RejectConsent:return new g(this._callId);case a.InCallFeatureTransitionAction.Stop:return new T(this._callId);case a.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}},this._hasConsent=e}}t.SelfConsentRequestedByRemoteUserState=p;class g extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.SelfConsentRejected,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.RejectConsent,this.handleRemoteUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.SelfConsentFromRemoteUserRejectedByLocalUserState=g;class C extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.RemoteConsentRequested,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.RequestConsent,this.handleRemoteUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.Start:case a.InCallFeatureTransitionAction.RequestConsent:return new _(this._callId);case a.InCallFeatureTransitionAction.RejectConsent:return new S(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Stop:return new y(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.Stop:return new m(this._callId);case a.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}}}}t.RemoteConsentRequestedByLocalUserState=C;class m extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.RemoteConsentCancelled,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.Stop,this.handleRemoteUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.RemoteConsentCancelledByLocalUserState=m;class S extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>a.InCallFeatureState.RemoteConsentRejected,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.RemoteConsentRejectedByRemoteUserState=S;class _ extends s{constructor(e){super(e),this.getFeatureState=()=>a.InCallFeatureState.Enabled,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.Start,this.handleRemoteUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new S(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Stop:return new y(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new g(this._callId);case a.InCallFeatureTransitionAction.Stop:return new T(this._callId);case a.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}}}}t.InCallFeatureEnabledState=_;class f extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>a.InCallFeatureState.EnabledByRemote,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new S(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Stop:return new y(this._callId,e.requestedBy);case a.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case a.InCallFeatureTransitionAction.RejectConsent:return new g(this._callId);case a.InCallFeatureTransitionAction.Stop:return new T(this._callId);case a.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}}}}t.InCallFeatureEnabledByRemoteState=f;class y extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>a.InCallFeatureState.StoppedByRemote,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.InCallFeatureStoppedByRemoteUserState=y;class T extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>a.InCallFeatureState.Stopped,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>a.InCallFeatureTransitionAction.Stop,this.handleRemoteUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===a.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.InCallFeatureStoppedState=T},873324:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallAddPhotosEvent=t.CallAddPhotosEntryPoint=t.CallActivitiesEntryPoint=t.AnswerCallStep=t.AnswerCallNotificationLocation=t.CalleeStopRingingReason=t.AnswerCallEndReason=t.IncomingCallStep=t.IncomingCallEndReason=t.CallRosterSession=t.ToggleCallTray=t.UnpinCallParticipant=t.PinCallParticipant=t.Zoom=t.CallVideoSettingsPopup=t.CallAudioSettingsPopup=t.CallCrashEvent=t.CallReconnectSinceStartedEvent=t.UnansweredCallActionEvent=t.RinglessCallInterstitialEvent=t.RinglessCallInterstitialActions=t.ScreenSharingStoppedEvent=t.RingTheGroupEvent=t.CallPreviewEvent=t.CallPreviewActions=t.CQF=t.WarmCalNotificationDisposition=t.CallIntention=t.CallEntryPoint=t.CallActionCalleeUserPresence=t.CallActionCallKitSuccess=t.CallActionCallKitError=t.CallManagerError=t.CallActionError=t.InCallActivity=t.InCallUFD=t.OverflowMenuOpenedEvent=t.InCallReaction=t.CallActionInviteFreeDecline=t.CallActionEnterFromCallCard=t.CallActionTokenRequested=t.CallActionTokenState=t.CallActionStopRinging=t.CallActionStartRinging=t.IncomingCallNotificationFailure=t.CallInitFailure=t.CallActionPushNotification=t.StopRingReason=t.CallActionBase=t.Call=void 0,t.MobileCallAnswerActions=t.TogetherModePanelActionEvent=t.TogetherModePanelActionOrigin=t.CallStageLayoutChangeEvent=t.CallViewMenuActionEvent=t.SpeakerViewEvent=t.SystemHotKeyCallEvent=t.SystemHotKeyCallAction=t.AudioOutputRouteChangedEvent=t.CallMergeEvent=t.ScreenShareSourceGetIconFailure=t.ScreenShareSourceGetPreviewFailure=t.IncomingVideoNotification=t.IncomingVideoNotificationAction=t.CallbackReminderTappedEvent=t.CallbackReminderTappedAction=t.BingBackgroundsDownloadApiEvent=t.BackgroundEffectsBingInfoClickEvent=t.BackgroundEffectEvent=t.BackgroundBlurEvent=t.BackgroundEffectsSettingsEvent=t.LocalVideoActionsEvent=t.CallViewMenuActions=t.LocalVideoActions=t.CallPstnTranslationSettingsOpened=t.CallPstnTranslationLanguageChangeEvent=t.CallCaptioningEvent=t.EndCallPopupMenuActionsEvent=t.EndCallPopupActions=t.RibbonSettingsMenuActionEvent=t.RibbonSettingsMenuActions=t.CanvasAndRibbonActionsEvent=t.CanvasAndRibbonActions=t.AddBotToCallSucceededEvent=t.AddBotToCallFailedEvent=t.AddBotToCallEvent=t.CallTranslatorDebugEvent=t.CallTranslatorDebugEventType=t.CallRecorderBotDebugEvent=t.CallRecorderBotDebugEventType=t.CallMuteEveryoneEvent=t.MuteEveryoneOrigin=t.CallAddToCallEvent=t.NdiBroadcastEvent=t.CallRecordingEvent=t.CallDataChannelEvent=t.CallDataChannelEventType=t.CallFullScreenBotError=t.CallFullScreenBotEvent=t.CallAddPhotosWithFabEvent=void 0,t.OutgoingCallNavigationFinishedEvent=t.CallManagerRequestCompleteEvent=t.CallUserActionEvent=t.CallUserActionType=t.CallSlimCoreError=t.CallSlimCoreErrorType=t.LiveStateDetectionTimeoutEvent=t.IncomingCallScreenDisplayedEvent=t.CallParticipantRendererIsRenderingEvent=t.CallConnectedOnAnswerEvent=t.AnswerOrJoinCallEvent=t.InformedCallKitEvent=t.TouchBarButtonClickEvent=t.CancelPreheatedCallNotJoinedEvent=t.FullChatUXTelemetryEvent=t.FullChatUXNavigation=t.MaybeEndCallFromAndroidBtScoDisconnectEvent=t.MediaActionEvent=t.MediaActionEventResult=t.CallControlContext=t.MobileCallAnswerEvent=void 0;const o=i(197582),a=o.__importStar(i(636076)),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=i(148540),l=i(619429),c=i(460515),d=i(44717),u=o.__importStar(i(44717)),h=i(815146),p=o.__importDefault(i(139221)),g=i(240297),C=i(425495),m=o.__importStar(i(340482)),S=i(789352),_=i(843890),f=o.__importDefault(i(601274)),y=i(938827),T=o.__importDefault(i(760989));class b extends g.TelemetryEventBase{constructor(e,t,i,o,a){super(),this._callId=e,this._conversationId=t,this._participantId=i,this._nodeId=o,this._origin=a,this._textReactionCount=0,this._emoticonReactionCount=0,this._animationReactionCount=0,this._photoReactionCount=0,this._mediaPickerPhotoReactionCount=0,this._navigateToMediaStageCount=0,this._sideNavigateInCallCount=0,this._backgroundAppInCallCount=0,this._toggleCameraCount=0,this._localMuteCount=0,this._localUnmuteCount=0,this._muteMicButtonPressCount=0,this._muteKeyboardShortcutPressCount=0,this._muteCommandServiceInvokeCount=0,this._muteCallMonitorPressCount=0,this._muteFloatingPipPressCount=0,this._muteCallRosterPressCount=0,this._muteSystemHotKeyPressCount=0,this._muteLocalVideoContextMenuPressCount=0,this._resizedOwnPreviewCount=0,this._movedOwnPreviewCount=0,this._dockedOwnPreviewCount=0,this._reactionThreadCreationDelay=0,this._photoSnapshotCount=0,this._photoSnapshotAudioCount=0,this._photoSnapshotVideoCount=0,this._photoSnapshotScreenShareCount=0,this._callDurationSeconds=0,this._incomingVideoUserNotificationCount=0,this._didEnterMinWidth=!1,this._callConnectionDurationMilliseconds=0,this._localVideoCallMonitorPressCount=0,this._callMonitorShowCount=0,this._callMonitorCloseCount=0,this._didEndCallFromCallMonitor=!1}getAttributes(){const e=n.assign(super.getAttributes(),this._getOwnAttributes()),t=m.getTrackableConversationId(this._conversationId);return t&&(e.ConversationId=t),e}getEventPriority(){return a.AWTEventPriority.High}_getOwnAttributes(){return{CallId:this._callId||"",ParticipantId:this._participantId||"",NodeId:this._nodeId||"",DidUserReact:this._textReactionCount>0||this._emoticonReactionCount>0||this._photoReactionCount>0||this._mediaPickerPhotoReactionCount>0||this._photoSnapshotCount>0||this._animationReactionCount>0,ReactionCount:this._textReactionCount+this._emoticonReactionCount+this._photoReactionCount+this._mediaPickerPhotoReactionCount+this._photoSnapshotCount+this._animationReactionCount,TextReactionCount:this._textReactionCount,EmoticonReactionCount:this._emoticonReactionCount,PhotoReactionCount:this._photoReactionCount,AnimationReactionCount:this._animationReactionCount,MediaPickerPhotoReactionCount:this._mediaPickerPhotoReactionCount,DidUserNavigateToMediaStage:this._navigateToMediaStageCount>0,NavigateToMediaStageCount:this._navigateToMediaStageCount,DidUserSideNavigateInCall:this._sideNavigateInCallCount>0,SideNavigateInCallCount:this._sideNavigateInCallCount,DidUserBackgroundAppInCall:this._backgroundAppInCallCount>0,BackgroundAppInCallCount:this._backgroundAppInCallCount,DidUserToggleCamera:this._toggleCameraCount>0,ToggleCameraCount:this._toggleCameraCount,LocalMuteCount:this._localMuteCount,LocalUnmuteCount:this._localUnmuteCount,MuteMicButtonPressCount:this._muteMicButtonPressCount,MuteKeyboardShortcutPressCount:this._muteKeyboardShortcutPressCount,MuteCommandServiceInvokeCount:this._muteCommandServiceInvokeCount,MuteCallMonitorPressCount:this._muteCallMonitorPressCount,MuteFloatingPipPressCount:this._muteFloatingPipPressCount,MuteCallRosterPressCount:this._muteCallRosterPressCount,MuteSystemHotKeyPressCount:this._muteSystemHotKeyPressCount,MuteLocalVideoContextMenuPressCount:this._muteLocalVideoContextMenuPressCount,ResizedOwnPreviewCount:this._resizedOwnPreviewCount,MovedOwnPreviewCount:this._movedOwnPreviewCount,DockedOwnPreviewCount:this._dockedOwnPreviewCount,ReactionThreadCreationDelay:this._reactionThreadCreationDelay,Origin:h.NavigationCallOrigin[this._origin],CallConversationMriNamespace:this._callConversationMriNamespace?d.Namespaces[this._callConversationMriNamespace]:"",PhotoSnapshotCount:this._photoSnapshotCount,DidUserPostPhotoSnapshot:this._photoSnapshotCount>0,PhotoSnapshotAudioCount:this._photoSnapshotAudioCount,PhotoSnapshotVideoCount:this._photoSnapshotVideoCount,PhotoSnapshotScreenShareCount:this._photoSnapshotScreenShareCount,CallDurationSeconds:this._callDurationSeconds,CallConnectionDurationMilliseconds:this._callConnectionDurationMilliseconds,UserToggledIncomingVideoViaNotificationCount:this._incomingVideoUserNotificationCount,DidEnterMinWidth:this._didEnterMinWidth,LocalVideoCallMonitorPressCount:this._localVideoCallMonitorPressCount,CallMonitorShowCount:this._callMonitorShowCount,CallMonitorCloseCount:this._callMonitorCloseCount,DidEndCallFromCallMonitor:this._didEndCallFromCallMonitor}}postAnimationReaction(){this._animationReactionCount++}postTextReaction(){this._textReactionCount++}postEmoticonReaction(){this._emoticonReactionCount++}postPhotoReaction(){this._photoReactionCount++}postMediaPickerPhotoReaction(){this._mediaPickerPhotoReactionCount++}navigateToMediaStage(){this._navigateToMediaStageCount++}sideNavigateInCall(){this._sideNavigateInCallCount++}backgroundAppInCall(){this._backgroundAppInCallCount++}toggleCamera(){this._toggleCameraCount++}localMute(){this._localMuteCount++}localUnmute(){this._localUnmuteCount++}micButtonPress(){this._muteMicButtonPressCount++}muteKeyboardShortcutPress(){this._muteKeyboardShortcutPressCount++}muteCommandServiceInvoke(){this._muteCommandServiceInvokeCount++}muteCallMonitorPress(){this._muteCallMonitorPressCount++}muteFloatingPipPress(){this._muteFloatingPipPressCount++}muteCallRosterPress(){this._muteCallRosterPressCount++}muteSystemHotKeyPress(){this._muteSystemHotKeyPressCount++}muteLocalVideoContextMenuPress(){this._muteLocalVideoContextMenuPressCount++}resizeOwnPreview(){this._resizedOwnPreviewCount++}moveOwnPreview(){this._movedOwnPreviewCount++}dockOwnPreview(){this._dockedOwnPreviewCount++}setReactionThreadCreationDelay(e){this._reactionThreadCreationDelay=e}updateParticipantId(e){this._participantId=e}setCallConversationMriNamespace(e){this._callConversationMriNamespace=e}postPhotoSnapshot(){this._photoSnapshotCount++}setPhotoSnapshotMakeup(e,t,i){this._photoSnapshotAudioCount=e,this._photoSnapshotVideoCount=t,this._photoSnapshotScreenShareCount=i}setCallDurationSeconds(e){this._callDurationSeconds=e}setCallConnectionDurationMilliseconds(e){this._callConnectionDurationMilliseconds=e}incomingVideoNotificationHit(){this._incomingVideoUserNotificationCount++}setEnterMinWidth(){this._didEnterMinWidth=!0}localVideoCallMonitorPress(){this._localVideoCallMonitorPressCount++}showCallMonitor(){this._callMonitorShowCount++}setEndCallFromCallMonitor(){this._didEndCallFromCallMonitor=!0}closeCallMonitor(){this._callMonitorCloseCount++}}t.Call=class extends b{constructor(e){super(e.callId,e.conversationId,e.participantId,e.nodeId,e.origin),this._params=e,this._startVideoCount=0,this._stopVideoCount=0,this._startScreenSharingCount=0,this._stopScreenSharingCount=0,this._cancelSreenSharingCount=0,this._startActivityCount=0,this._stopActivityCount=0,this._startSoundSharingCount=0,this._screenSharingDroppedCount=0,this._screenSharingStolenCount=0,this._switchScreenWhileSharingCount=0,this._orientationLandscapeCount=0,this._orientationPortraitCount=0,this._isConversationAccepted=!1,this._isConversationAutoAccepted=!1,this._isEscalatedToGroup=!1,this._escalationUserCount=0,this._addUsersToGroupCount=0,this._ringUsersToCallCount=0,this._autoAnsweredWithAudio=!1,this._autoAnsweredWithVideo=!1,this._wasOffline=!1,this._wasSuspended=!1,this._didShowReconnectUI=!1,this._callReconnectStart=0,this._callReconnectEnd=0,this._callReconnectDuration=0,this._callDurationAfterReconnect=0,this._callDroppedDuringReconnect=!1,this._didShowPoorConnectionUI=!1,this._connectionType=r.ConnectionType.AllSupported,this._mccCode="",this._mncCode="",this._startRecordingCount=0,this._stopRecordingCount=0,this._startNdiCount=0,this._stopNdiCount=0,this._showBlockedVideoBannerCount=0,this._navBarOpenedCount=0,this._navBarClosedCount=0,this._isPSTNCall=!1,this._maxConnectedParticipants=0,this._groupMemberCount=0,this._soloModeDurationSeconds=0,this._isGoLive=!1,this._chatOpenedCount=0,this._galleryOpenedCount=0,this._manualDismissedUFDCount=0,this._autoDismisssedUFDCount=0,this._actionedUFDCount=0,this._totalUFDCount=0,this._totalSuccessfulToggleVideoPress=0,this._totalIgornedToggleVideoPress=0,this._callRosterOpenedCount=0,this._callRosterClosedCount=0,this._callRosterGetAllParticipantsFailedCount=0,this._audioOnlyStartedCount=0,this._audioOnlyStoppedCount=0,this._audioOnlySuggestedCount=0,this._enabledIncomingVideoCount=0,this._disabledIncomingVideoCount=0,this._startCaptioningCount=0,this._startPstnTranslationAttemptCount=0,this._startSkypeTranslationAttemptCount=0,this._stopSkypeTranslationAttemptCount=0,this._skypeTranslationStartedCount=0,this._skypeTranslationStoppedCount=0,this._stopCaptioningCount=0,this._startCustomVoiceCount=0,this._stopCustomVoiceCount=0,this._startTranslationAutoDetectCount=0,this._stopTranslationAutoDetectCount=0,this._failedCaptioningConfigCount=0,this._receiverSetupCount=0,this._displayScreenSharingDialogCount=0,this._didUserDisplayScreenSharingDialog=!1,this._didReceiveCaptions=!1,this._didRenderRemoteVideo=!1,this._captionsPositionModeChanged=0,this._firstCaptionReceivedLengthSeconds=0,this._startingCaptionsMessageClickedCount=0,this._audioSystemResetCount=0,this._wholeScreenSharedCount=0,this._appWindowSharedCount=0,this._startBackgroundBlurCount=0,this._stopBackgroundBlurCount=0,this._durationWithBackgroundBlurRatio=0,this._startSpeakerViewCount=0,this._stopSpeakerViewCount=0,this._durationInSpeakerViewRatio=0,this._callMergeRequested=0,this._callMergeSucceed=0,this._zoomedInCount=0,this._zoomedInDuration=0,this._zoomedOutCount=0,this._zoomDragUsed=!1,this._zoomUIControlsUsedCount=0,this._zoomScrollWheelUsedCount=0,this._zoomKeyboardUsedCount=0,this._zoomTrackPadUsedCount=0,this._accessedDialpadCount=0,this._displayedDtmfWarningCount=0,this._screenShareControlReceivedControlRequestCount=0,this._screenShareControlReceivedControlRequestCanceledCount=0,this._screenShareControlSentControlRequestCount=0,this._screenShareControlRequestAcceptedCount=0,this._screenShareControlRequestDeniedCount=0,this._screenShareControlGrantedCount=0,this._screenShareControlSharerTerminatedControlCount=0,this._screenShareControlViewerTerminatedControlCount=0,this._pinToolbar=0,this._unpinToolbar=0,this._couldGiveControl=!1,this._callManagerUsed=!1,this._startBackgroundEffectCount={[h.BackgroundEffect.Blur]:0,[h.BackgroundEffect.BackgroundImage]:0},this._stopBackgroundEffectCount={[h.BackgroundEffect.Blur]:0,[h.BackgroundEffect.BackgroundImage]:0},this._durationWithBackgroundEffectRatio={[h.BackgroundEffect.Blur]:0,[h.BackgroundEffect.BackgroundImage]:0},this._bingBackgroundEffectCaptionClickCount=0,this._startTogetherMode=!1,this._ableToStartTogetherMode=!1,this._startLargeGridMode=!1,this._ableToStartLargeGridMode=!1,this._togetherModeSceneChangeRequestCount=0,this._noiseSuppressionMode=r.NoiseSuppressionMode.Auto,this._voiceIsolationToggleCount=0,this._musicModeEnabled=!1,this._noiseSuppressionAvailable=!1,this._badQualityCounts=new Map,this._hadNativeIncomingCallNotificationsEnabled=!1,this._totalCallingStoreUpdateTime=0,this._numberOfCallingStoreUpdates=0,this._isTwincam=!1,this._twincamShareIntentCount=0,this._didRenderTwincamEndpoint=!1,this._callNetworkErrorReason=r.TerminatedReason.Undefined,this._failedToggleMicCount=0,this._toggleMicBestDuration=0,this._toggleMicMedianDuration=0,this._toggleMicWorstDuration=0,this._failedToggleVideoCount=0,this._failedHangUpCount=0,this._dataChannelReactionsSupport=!1,this._dataChannelCaptionsSupport=!1,this._dataChannelOnlyReactionsSupport=!1,this._dataChannelOnlyCaptionsSupport=!1,this._musicDetectedWithHighNSMode=!1,this._noiseSuppressionMode=e.noiseSuppressionMode,this._noiseSuppressionAvailable=e.isNoiseSuppressionAvailable}getEventName(){return"calling_call"}getAttributes(){const e=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({CallingStack:_.CallingCapabilities.isPluginlessCallingStack()?"pluginless":"slimcore",IsGroupCall:this._params.isGroupCall,IsCallCreator:this._params.isCallCreator,DidUserStartVideo:this._startVideoCount>0,StartVideoCount:this._startVideoCount,DidUserStopVideo:this._stopVideoCount>0,StopVideoCount:this._stopVideoCount,StartScreenSharingCount:this._startScreenSharingCount,SwitchScreenWhileSharingCount:this._switchScreenWhileSharingCount,StopScreenSharingCount:this._stopScreenSharingCount,StartSoundSharingCount:this._startSoundSharingCount,CancelScreenSharingCount:this._cancelSreenSharingCount,ScreenSharingDroppedCount:this._screenSharingDroppedCount,ScreenSharingStolenCount:this._screenSharingStolenCount,DidUserStartScreenSharing:this._startScreenSharingCount>0,DidUserSwitchScreenWhileSharing:this._switchScreenWhileSharingCount>0,DidUserStopScreenSharing:this._stopScreenSharingCount>0,DidUserChangeOrientation:this._orientationLandscapeCount>0||this._orientationPortraitCount>0,OrientationLandscapeCount:this._orientationPortraitCount,OrientationPortraitCount:this._orientationPortraitCount,IsConversationAccepted:this._isConversationAccepted,IsConversationAutoAccepted:this._isConversationAutoAccepted,IsEscalatedToGroup:this._isEscalatedToGroup,EscalationUserCount:this._escalationUserCount,AddUsersToGroupCount:this._addUsersToGroupCount,RingUsersToCallCount:this._ringUsersToCallCount,CallWasAutoAnsweredWithAudio:this._autoAnsweredWithAudio,CallWasAutoAnsweredWithVideo:this._autoAnsweredWithVideo,WasOffline:this._wasOffline,WasSuspended:this._wasSuspended,DidShowReconnectUI:this._didShowReconnectUI,CallReconnectDuration:this._callReconnectDuration,CallDurationAfterReconnect:this._callDurationAfterReconnect,CallDroppedDuringReconnect:this._callDroppedDuringReconnect,DidShowPoorConnectionUI:this._didShowPoorConnectionUI,StartActivityCount:this._startActivityCount,StopActivityCount:this._stopActivityCount,NetworkMCCCode:this._mccCode,NetworkMNCCode:this._mncCode,ConnectionType:this._connectionType,StartRecordingCount:this._startRecordingCount,StopRecordingCount:this._stopRecordingCount,StartNdiCount:this._startNdiCount,StopNdiCount:this._stopNdiCount,ShowBlockedVideoBannerCount:this._showBlockedVideoBannerCount,NavigationBarDesktopOpenedCount:this._navBarOpenedCount,NavigationBarDesktopClosedCount:this._navBarClosedCount,IsPSTNCall:this._isPSTNCall,IsGoLive:this._isGoLive,IsMeetNow:this._params.isLegacyMeetNow,MaxConnectedParticipants:this._maxConnectedParticipants||0,GroupMemberCount:this._groupMemberCount||0,SoloModeDurationSeconds:this._soloModeDurationSeconds,ChatOpenedCount:this._chatOpenedCount,GalleryOpenedCount:this._galleryOpenedCount,ActionedUFDCount:this._actionedUFDCount,ManualDismissedUFDCount:this._manualDismissedUFDCount,AutoDismissedUFDCount:this._autoDismisssedUFDCount,TotalUFDCount:this._totalUFDCount,ToggleVideoSuccessfulCount:this._totalSuccessfulToggleVideoPress,ToggleVideoIgnoredCount:this._totalIgornedToggleVideoPress,CallRosterOpenedCount:this._callRosterOpenedCount,CallRosterClosedCount:this._callRosterClosedCount,CallRosterGetAllParticipantsFailedCount:this._callRosterGetAllParticipantsFailedCount,StartAudioOnlyCount:this._audioOnlyStartedCount,StopAudioOnlyCount:this._audioOnlyStoppedCount,AudioOnlyModeSuggestedCount:this._audioOnlySuggestedCount,DisabledIncomingVideoCount:this._disabledIncomingVideoCount,EnabledIncomingVideoCount:this._enabledIncomingVideoCount,StartCaptioningCount:this._startCaptioningCount,StopCaptioningCount:this._stopCaptioningCount,StartPstnTranslationAttemptCount:this._startPstnTranslationAttemptCount,StartSkypeTranslationAttemptCount:this._startSkypeTranslationAttemptCount,StopSkypeTranslationAttemptCount:this._stopSkypeTranslationAttemptCount,SkypeTranslationStartedCount:this._skypeTranslationStartedCount,SkypeTranslationStoppedCount:this._skypeTranslationStoppedCount,TranslationConsentChangeDate:this._translationConsentDate||"",TranslationTruvoiceConsentChangeDate:this._translationTruvoiceConsentDate||"",StartTruvoiceCount:this._startCustomVoiceCount,StopTruvoiceCount:this._stopCustomVoiceCount,StartTranslationAutoDetectCount:this._startTranslationAutoDetectCount,StopTranslationAutoDetectCount:this._stopTranslationAutoDetectCount,DidReceiveCaptions:this._didReceiveCaptions,DidRenderRemoteVideo:this._didRenderRemoteVideo,FirstCaptionReceivedLengthSeconds:this._firstCaptionReceivedLengthSeconds,CaptionsPositionModeChangeCount:this._captionsPositionModeChanged,LastCaptionsPositionMode:this._lastCaptionsPositionMode||"",CaptionsStartingMessageClickedCount:this._startingCaptionsMessageClickedCount,FailedCaptioningConfigCount:this._failedCaptioningConfigCount,ReceiverSetupCount:this._receiverSetupCount,DisplayScreenSharingDialogCount:this._displayScreenSharingDialogCount,DidUserDisplayScreenSharingDialog:this._didUserDisplayScreenSharingDialog,IsScheduledCallActive:this._params.isScheduledCallActive,IsPreheated:this._params.isPreheated,IsEchoCall:this._params.isEchoCall,AudioSystemReset:this._audioSystemResetCount,"WholeScreenSharedCount ":this._wholeScreenSharedCount,AppWindowSharedCount:this._appWindowSharedCount,StartBackgroundBlurCount:this._startBackgroundBlurCount,StopBackgroundBlurCount:this._stopBackgroundBlurCount,DurationWithBackgroundBlurRatio:this._durationWithBackgroundBlurRatio,StartSpeakerViewCount:this._startSpeakerViewCount,StopSpeakerViewCount:this._stopSpeakerViewCount,DurationInSpeakerViewRatio:this._durationInSpeakerViewRatio,CallMergeRequested:this._callMergeRequested,CallMergeSucceed:this._callMergeSucceed,ZoomedInCount:this._zoomedInCount,ZoomedInDuration:this._zoomedInDuration,ZoomedOutCount:this._zoomedOutCount,ZoomDragUsed:this._zoomDragUsed,ZoomUIControlsUsedCount:this._zoomUIControlsUsedCount,ZoomScrollWheelUsedCount:this._zoomScrollWheelUsedCount,ZoomKeyboardUsedCount:this._zoomKeyboardUsedCount,ZoomTrackPadUsedCount:this._zoomTrackPadUsedCount,AccessedDialpadCount:this._accessedDialpadCount,DisplayedDtmfWarningCount:this._displayedDtmfWarningCount,ScreenShareControlReceivedControlRequestCount:this._screenShareControlReceivedControlRequestCount,ScreenShareControlReceivedControlRequestCanceledCount:this._screenShareControlReceivedControlRequestCanceledCount,ScreenShareControlSentControlRequestCount:this._screenShareControlSentControlRequestCount,ScreenShareControlRequestAcceptedCount:this._screenShareControlRequestAcceptedCount,ScreenShareControlRequestDeniedCount:this._screenShareControlRequestDeniedCount,ScreenShareControlGrantedCount:this._screenShareControlGrantedCount,ScreenShareControlSharerTerminatedControlCount:this._screenShareControlSharerTerminatedControlCount,ScreenShareControlViewerTerminatedControlCount:this._screenShareControlViewerTerminatedControlCount,IsTranslatedCall:this._params.isTranslatedCall,IsFirstCall:this._params.isFirstCall,CallManagerUsed:this._callManagerUsed,IsIgnoringBatteryOptimizations:n.isUndefined(this._isIgnoringBatteryOptimizations)?"":this._isIgnoringBatteryOptimizations,StartBackgroundEffectBlurCount:this._startBackgroundEffectCount[h.BackgroundEffect.Blur],StopBackgroundEffectBlurCount:this._stopBackgroundEffectCount[h.BackgroundEffect.Blur],DurationWithBackgroundEffectBlurRatio:this._durationWithBackgroundEffectRatio[h.BackgroundEffect.Blur],StartBackgroundEffectImageCount:this._startBackgroundEffectCount[h.BackgroundEffect.BackgroundImage],StopBackgroundEffectImageCount:this._stopBackgroundEffectCount[h.BackgroundEffect.BackgroundImage],DurationWithBackgroundEffectImageRatio:this._durationWithBackgroundEffectRatio[h.BackgroundEffect.BackgroundImage],BingBackgroundEffectCaptionClickCount:this._bingBackgroundEffectCaptionClickCount,PinToolbar:this._pinToolbar,UnpinToolbar:this._unpinToolbar,CouldGiveControl:this._couldGiveControl,NoiseSuppressionMode:this._noiseSuppressionMode,VoiceIsolationToggleCount:this._voiceIsolationToggleCount,MusicModeEnabled:this._musicModeEnabled,HadBadQuality:!!this._badQualityCounts.size,IsModerated:this._params.isModerated,HadNativeIncomingCallNotificationsEnabled:this._hadNativeIncomingCallNotificationsEnabled,AverageCallingStoreUpdateTime:this._getAverageCallingStoreUpdateTime(),IsTwinCam:this._isTwincam,TwinCamShareIntentCount:this._twincamShareIntentCount,DidRenderTwinCamEndpoint:this._didRenderTwincamEndpoint,CallNetworkErrorReason:this._callNetworkErrorReason},this._getBadQualityAttributes()),this._getDeviceCountsAttributes()),this._getPermissionAttributes()),this._getFullScreenBotAttributes()),{FailedToggleMicCount:this._failedToggleMicCount,ToggleMicBestDuration:this._toggleMicBestDuration,ToggleMicMedianDuration:this._toggleMicMedianDuration,ToggleMicWorstDuration:this._toggleMicWorstDuration,FailedToggleVideoCount:this._failedToggleVideoCount,ToggleVideoBestDuration:this._toggleVideoBestDuration||0,ToggleVideoMedianDuration:this._toggleVideoMedianDuration||0,ToggleVideoWorstDuration:this._toggleVideoWorstDuration||0,FailedHangUpCount:this._failedHangUpCount,HangUpDuration:this._hangUpDuration||0,NoiseSuppressionAvailable:this._noiseSuppressionAvailable,DataChannelReactionsSupport:this._dataChannelReactionsSupport,DataChannelOnlyReactionsSupport:this._dataChannelOnlyReactionsSupport,DataChannelCaptionsSupport:this._dataChannelCaptionsSupport,DataChannelOnlyCaptionsSupport:this._dataChannelOnlyCaptionsSupport,DataChannelReactionsAllMessageCount:this._dataChannelReactionsAllMessageCount||0,DataChannelReactionsMessageCount:this._dataChannelReactionsMessageCount||0,DataChannelReactionsMessageDeliveryDeltaAverage:this._dataChannelReactionsMessageDeliveryDeltaAverage||0,DataChannelCaptionsAllMessageCount:this._dataChannelCaptionsAllMessageCount||0,DataChannelCaptionsMessageCount:this._dataChannelCaptionsMessageCount||0,DataChannelCaptionsMessageDeliveryDeltaAverage:this._dataChannelCaptionsMessageDeliveryDeltaAverage||0,MusicDetectedWithHighNSMode:this._musicDetectedWithHighNSMode});n.isUndefined(this._params.timeBeforeFirstCallInSec)||(e.TimeBeforeFirstCallInSec=this._params.timeBeforeFirstCallInSec),n.isUndefined(this._params.source)||(e.Source=this._params.source);const t=m.getTrackableConversationId(this._params.conversationId);return t&&(e.ConversationId=t),n.assign(super.getAttributes(),e)}_getAverageCallingStoreUpdateTime(){return this._numberOfCallingStoreUpdates&&this._totalCallingStoreUpdateTime?Math.round(this._totalCallingStoreUpdateTime/this._numberOfCallingStoreUpdates):0}_getDeviceCountsAttributes(){return void 0!==this._micCount&&void 0!==this._speakerCount&&void 0!==this._cameraCount?{MicCount:this._micCount,SpeakerCount:this._speakerCount,CameraCount:this._cameraCount,isDefaultMic:this._isDefaultMic,isDefaultSpeaker:this._isDefaultSpeaker}:{}}_getPermissionAttributes(){return void 0!==this._micPermission&&this._cameraPermission,{}}_getFullScreenBotAttributes(){return{WasLargeGridBotOnCall:this._startLargeGridMode,WasAbleToStartLargeGridBot:this._ableToStartLargeGridMode,WasTogetherModeBotOnCall:this._startTogetherMode,WasAbleToStartTogetherModeBot:this._ableToStartTogetherMode,TogetherModeSceneChangeRequestCount:this._togetherModeSceneChangeRequestCount}}_getBadQualityAttributes(){const e={};return this._badQualityCounts.forEach(((t,i)=>e[r.QualityEventType[i]]=t)),e}screenShareControlReceivedControlRequest(){this._screenShareControlReceivedControlRequestCount++}screenShareControlReceivedControlRequestCanceled(){this._screenShareControlReceivedControlRequestCanceledCount++}screenShareControlSentControlRequest(){this._screenShareControlSentControlRequestCount++}screenShareControlRequestAccepted(){this._screenShareControlRequestAcceptedCount++}screenShareControlRequestDenied(){this._screenShareControlRequestDeniedCount++}screenShareControlGranted(){this._screenShareControlGrantedCount++}screenShareControlSharerTerminatedControl(){this._screenShareControlSharerTerminatedControlCount++}screenShareControlViewerTerminatedControl(){this._screenShareControlViewerTerminatedControlCount++}pinToolbar(){this._pinToolbar++}unPinToolbar(){this._unpinToolbar++}setGiveControlAsPossible(){this._couldGiveControl=!0}setIsCallCreator(e){this._params.isCallCreator=e}startVideo(){this._startVideoCount++}stopVideo(){this._stopVideoCount++}startScreenSharing(){this._startScreenSharingCount++}switchScreenWhileSharing(){this._switchScreenWhileSharingCount++}stopScreenSharing(){this._stopScreenSharingCount++}cancelScreenSharing(){this._cancelSreenSharingCount++}startSoundSharing(){this._startSoundSharingCount++}screenSharingDropped(){this._screenSharingDroppedCount++}screenSharingStolen(){this._screenSharingStolenCount++}orientationChanged(e){e?this._orientationLandscapeCount++:this._orientationPortraitCount++}isConversationAccepted(e){this._isConversationAccepted=e}isConversationAutoAccepted(e){this._isConversationAutoAccepted=e}isEscalatedToGroup(e){this._isEscalatedToGroup=e}escalationUserCount(e){this._escalationUserCount=e}addUserToGroup(){this._addUsersToGroupCount+=1}addUsersToGroup(e){this._addUsersToGroupCount+=e}ringUserToCall(){this._ringUsersToCallCount+=1}ringUsersToCall(e){this._ringUsersToCallCount+=e}callAutoAnswered(e){e?this._autoAnsweredWithVideo=!0:this._autoAnsweredWithAudio=!0}setWasSuspended(){this._wasSuspended=!0}setWasOffline(){this._wasOffline=!0}setCallReconnectStart(){this._didShowReconnectUI=!0,this._callReconnectStart=Date.now(),this._callReconnectEnd=0,this._callReconnectDuration=0}setCallReconnectEnd(){this._callReconnectStart&&(this._callReconnectEnd=Date.now(),this._callReconnectDuration=this._callReconnectEnd-this._callReconnectStart)}setCallReconnectTelemetry(){this._didShowReconnectUI&&(this._callReconnectEnd?this._callDurationAfterReconnect=Date.now()-this._callReconnectEnd:this._callDroppedDuringReconnect=!0)}showedPoorConnectionUI(){this._didShowPoorConnectionUI=!0}startActivityCount(){this._startActivityCount++}stopActivityCount(){this._stopActivityCount++}callConnectionType(e){this._connectionType=n.isUndefined(e)?r.ConnectionType.AllSupported:e}setMccMncCode(e,t){this._mccCode=e||"",this._mncCode=t||""}startRecordingCount(){this._startRecordingCount++}stopRecordingCount(){this._stopRecordingCount++}startNdiCount(){this._startNdiCount++}stopNdiCount(){this._stopNdiCount++}blockedVideoBannerShown(){this._showBlockedVideoBannerCount++}audioSystemResetCount(){this._audioSystemResetCount++}toggleVideoPressSuccessful(){this._totalSuccessfulToggleVideoPress++}toggleVideoPressIgored(){this._totalIgornedToggleVideoPress++}callRosterOpenedCount(){this._callRosterOpenedCount++}callRosterClosedCount(){this._callRosterClosedCount++}callRosterGetAllParticipantsFailedCount(){this._callRosterGetAllParticipantsFailedCount++}startAudioOnly(){this._audioOnlyStartedCount++}stopAudioOnly(){this._audioOnlyStoppedCount++}suggestAudioOnly(){this._audioOnlySuggestedCount++}enableIncomingVideoCount(){this._enabledIncomingVideoCount++}disableIncomingVideoCount(){this._disabledIncomingVideoCount++}displayScreenSharingDialogCount(){this._displayScreenSharingDialogCount++}didUserDisplayScreenSharingDialog(){this._didUserDisplayScreenSharingDialog=!0}wholeScreenSharedCount(){this._wholeScreenSharedCount++}appWindowSharedCount(){this._appWindowSharedCount++}ufdDisplayed(e){switch(e){case c.ToastActionType.Actioned:this._actionedUFDCount++;break;case c.ToastActionType.AutoDismissed:this._autoDismisssedUFDCount++;break;case c.ToastActionType.ManualDismissed:this._manualDismissedUFDCount++}this._totalUFDCount++}navBarOpened(){this._navBarOpenedCount++}navBarClosed(){this._navBarClosedCount++}setIsPSTNCall(e){this._isPSTNCall=e}setGroupMemberCount(e){this._groupMemberCount=e}setMaxConnectedParticipants(e){e>this._maxConnectedParticipants&&(this._maxConnectedParticipants=e)}setDurationInSoloMode(e){0===this._soloModeDurationSeconds&&(this._soloModeDurationSeconds=e)}setIsGoLive(e){this._isGoLive=e}chatOpened(){this._chatOpenedCount++}galleryOpened(){this._galleryOpenedCount++}startCaptioningCount(){this._startCaptioningCount++}stopCaptioningCount(){this._stopCaptioningCount++}startPstnTranslationClickedCount(){this._params.isTranslatedCall=!0,this._startPstnTranslationAttemptCount++}startSkypeTranslationClickedCount(){this._params.isTranslatedCall=!0,this._startSkypeTranslationAttemptCount++}stopSkypeTranslationClickedCount(){this._params.isTranslatedCall=!0,this._stopSkypeTranslationAttemptCount++}translationConsentChangeDate(e){this._translationConsentDate=e}translationTruvoiceConsentChangeDate(e){this._translationTruvoiceConsentDate=e}skypeTranslationStartedCount(){this._skypeTranslationStartedCount++}skypeTranslationStoppedCount(){this._skypeTranslationStoppedCount++}startCustomVoiceCount(){this._startCustomVoiceCount++}stopCustomVoiceCount(){this._stopCustomVoiceCount++}startTranslationAutoDetectCount(){this._startTranslationAutoDetectCount++}stopTranslationAutoDetectCount(){this._stopTranslationAutoDetectCount++}failedCaptioningConfigCount(){this._failedCaptioningConfigCount++}didReceiveCaptions(){this._didReceiveCaptions=!0}didRenderRemoteVideo(){this._didRenderRemoteVideo=!0}setInitialCaptionPositionMode(e){this._lastCaptionsPositionMode=e}didChangeCaptionsPositionMode(e){this._captionsPositionModeChanged++,this._lastCaptionsPositionMode=e}setFirstCaptionReceivedLengthSeconds(e){this._firstCaptionReceivedLengthSeconds=e/1e3}didClickCaptionsStartingMessage(){this._startingCaptionsMessageClickedCount++}receiverSetupCount(){this._receiverSetupCount++}startBackgroundBlur(){this._startBackgroundBlurCount++}stopBackgroundBlur(){this._stopBackgroundBlurCount++}setBackgroundBlurDurationRatio(e){this._durationWithBackgroundBlurRatio=e}startBackgroundEffect(e){const t=e===h.BackgroundEffect.Blur?h.BackgroundEffect.Blur:h.BackgroundEffect.BackgroundImage;this._startBackgroundEffectCount[t]=this._startBackgroundEffectCount[t]+1}stopBackgroundEffect(e){const t=e===h.BackgroundEffect.Blur?h.BackgroundEffect.Blur:h.BackgroundEffect.BackgroundImage;this._stopBackgroundEffectCount[t]=this._stopBackgroundEffectCount[t]+1}setBackgroundEffectDurationRatio(e,t){const i=t===h.BackgroundEffect.Blur?h.BackgroundEffect.Blur:h.BackgroundEffect.BackgroundImage;this._durationWithBackgroundEffectRatio[i]=e}bingBackgroundEffectCaptionClick(){this._bingBackgroundEffectCaptionClickCount++}startSpeakerView(){this._startSpeakerViewCount++}stopSpeakerView(){this._stopSpeakerViewCount++}setSpeakerViewDurationRatio(e){this._durationInSpeakerViewRatio=e}callMergeRequested(){this._callMergeRequested++}callMergeSucceed(){this._callMergeSucceed++}zoomedIn(){this._zoomedInCount++}zoomedOut(e,t){t||this._zoomedOutCount++,e&&(this._zoomedInDuration+=e)}zoomDragUsed(){this._zoomDragUsed=!0}callManagerUsed(){this._callManagerUsed=!0}setIsIgnoringBatteryOptimizations(e){this._isIgnoringBatteryOptimizations=e}zoomChangeType(e){switch(e){case S.ScreenShareZoomType.ScrollWheel:return void this._zoomScrollWheelUsedCount++;case S.ScreenShareZoomType.UIControls:return void this._zoomUIControlsUsedCount++;case S.ScreenShareZoomType.Keyboard:return void this._zoomKeyboardUsedCount++;case S.ScreenShareZoomType.TrackPad:this._zoomTrackPadUsedCount++}}accessedDialpad(){this._accessedDialpadCount++}displayedDtmfWarning(){this._displayedDtmfWarningCount++}setBadQuality(e){this._badQualityCounts.set(e,(this._badQualityCounts.get(e)||0)+1)}setCameraCount(e){this._cameraCount=e}setMicCount(e){this._micCount=e}setSpeakerCount(e){this._speakerCount=e}setIsDefaultMic(e){this._isDefaultMic=e}setIsDefaultSpeaker(e){this._isDefaultSpeaker=e}setCameraPermission(e){this._cameraPermission=e}setMicPermission(e){this._micPermission=e}startTogetherMode(){this._startTogetherMode=!0}startLargeGrid(){this._startLargeGridMode=!0}ableToStartTogetherMode(){this._ableToStartTogetherMode=!0}ableToStartLargeGrid(){this._ableToStartLargeGridMode=!0}setNoiseSuppressionMode(e){this._noiseSuppressionMode=e}voiceIsolationTogglePress(){this._voiceIsolationToggleCount++}musicModeEnabled(e){this._musicModeEnabled=e}togetherModeSceneChangeRequestCount(){this._togetherModeSceneChangeRequestCount++}setHadNativeIncomingCallNotificationsEnabled(e){this._hadNativeIncomingCallNotificationsEnabled=e}addCallingStoreUpdatePerformance(e){this._numberOfCallingStoreUpdates++,this._totalCallingStoreUpdateTime+=e}setIsTwincam(){this._isTwincam=!0}incrementTwincamShareIntentCount(){this._twincamShareIntentCount++}setDidRenderTwincamEndpoint(){this._didRenderTwincamEndpoint=!0}setCallNetworkErrorReason(e){this._callNetworkErrorReason=e}failedToggleMic(){this._failedToggleMicCount++}failedToggleVideo(){this._failedToggleVideoCount++}setButtonToggleBestDuration(e,t){e?this._toggleVideoBestDuration=t:this._toggleMicBestDuration=t}setButtonToggleMedianDuration(e,t){e?this._toggleVideoMedianDuration=t:this._toggleMicMedianDuration=t}setButtonToggleWorstDuration(e,t){e?this._toggleVideoWorstDuration=t:this._toggleMicWorstDuration=t}failedHangUp(){this._failedHangUpCount++}setHangUpDuration(e){this._hangUpDuration=e}setDataChannelReactionsSupport(e,t,i,o){this._dataChannelReactionsSupport=e,this._dataChannelCaptionsSupport=t,this._dataChannelOnlyReactionsSupport=i,this._dataChannelOnlyCaptionsSupport=o}setDataChannelReactionsMessageSuccessRate(e,t,i){this._dataChannelReactionsAllMessageCount=t,this._dataChannelReactionsMessageCount=e,this._dataChannelReactionsMessageDeliveryDeltaAverage=i}setDataChannelCaptionsMessageSuccessRate(e,t,i){this._dataChannelCaptionsAllMessageCount=t,this._dataChannelCaptionsMessageCount=e,this._dataChannelCaptionsMessageDeliveryDeltaAverage=i}setMusicDetectedWithHighNSMode(e){this._musicDetectedWithHighNSMode=e}};class v extends g.TelemetryEventBase{constructor(){super()}getEventName(){return"calling_action"}getAttributes(){return n.assign(super.getAttributes(),{Action:this.getActionName()})}}var I,w,P,M,D,A,k,R,x,L,B,V,O,E,N,F,U,H,j,z,G,W,K,$,q,Q,X,Z,J,Y,ee;t.CallActionBase=v,function(e){e.CallDeniedOrEnded="CallDeniedOrEnded"}(I||(t.StopRingReason=I={}));t.CallActionPushNotification=class extends v{constructor(e,t,i,o){super(),this._info=e,this._nodeId=t,this._registrationId=i,this._causeId=o}getActionName(){return"PushNotification"}getAttributes(){const e={EventType:this._info.eventType,CallId:this._info.callId,RegistrationId:this._registrationId||"",NodeId:this._nodeId||"",IsStarted:this._info.isStarted,Source:this._info.source,TimeWaitingToProcess:Math.max(0,this._info.pushProcessedTime-this._info.pushReceivedTime),HasRegistered:this._info.hasRegistered,ActivationState:s.Types.AppActivationState[s.App.getActivationState()],StopRingReason:this._info.stopRingReason?I[this._info.stopRingReason]:"",IsDuplicate:Boolean(this._info.isDuplicate),CauseId:this._causeId};return this._info.participantId&&(e.ParticipantId=this._info.participantId),n.assign(super.getAttributes(),e)}};t.CallInitFailure=class extends v{constructor(e,t){super(),this._causeId=e,this._origin=t}getActionName(){return"CallInitFailure"}getAttributes(){const e={CauseId:this._causeId,CallInitOrigin:h.NavigationCallOrigin[this._origin]};return Object.assign(super.getAttributes(),e)}};t.IncomingCallNotificationFailure=class extends v{constructor(e,t,i,o,a=""){super(),this._callId=e,this._eventType=t,this._causeId=i,this._reason=o,this._details=a}getActionName(){return"IncomingCallNotificationFailure"}getAttributes(){const e={CallId:this._callId,EventType:this._eventType,CauseId:this._causeId,Reason:D[this._reason],Details:this._details};return n.assign(super.getAttributes(),e)}};t.CallActionStartRinging=class extends v{constructor(e,t){super(),this._callId=e,this._origin=t}getActionName(){return"StartRinging"}getAttributes(){const e={CallId:this._callId,Origin:x[this._origin]};return n.assign(super.getAttributes(),e)}};t.CallActionStopRinging=class extends v{constructor(e,t,i=0,o=""){super(),this._callId=e,this._reason=t,this._ringingDuration=i,this._details=o}getActionName(){return"StopRinging"}getAttributes(){const e={CallId:this._callId,Reason:R[this._reason],RingingDuration:this._ringingDuration,Details:this._details};return n.assign(super.getAttributes(),e)}},function(e){e[e.None=0]="None",e[e.Stale=1]="Stale",e[e.UpToDate=2]="UpToDate"}(w||(t.CallActionTokenState=w={}));t.CallActionTokenRequested=class extends v{constructor(e,t,i,o,a){super(),this._nodeId=e,this._upToDateToken=t,this._hasConnectedToCall=i,this._hasOutgoingCall=o,this._hasIncomingCall=a}getActionName(){return"TokenRequested"}getAttributes(){return n.assign(super.getAttributes(),{NodeId:this._nodeId,TokenState:w[this._upToDateToken],HasConnectedCall:this._hasConnectedToCall,HasOutgoingCall:this._hasOutgoingCall,HasIncomingCall:this._hasIncomingCall})}};t.CallActionEnterFromCallCard=class extends v{getActionName(){return"EnterFromCallCard"}};t.CallActionInviteFreeDecline=class extends v{constructor(e){super(),this._callId=e}getActionName(){return"InviteFreeDecline"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId})}};t.InCallReaction=class extends v{constructor(e,t,i,o,a){super(),this._reactionKey=e,this._reactionType=t,this._isTonedReaction=i,this._isCustomReaction=o,this._isAnimatedReaction=a}getActionName(){return"InCallReaction"}getAttributes(){return n.assign(super.getAttributes(),{ReactionKey:this._reactionKey,ReactionType:this._reactionType,IsTonedReaction:this._isTonedReaction,IsCustomReaction:this._isCustomReaction,IsAnimatedReaction:this._isAnimatedReaction})}};t.OverflowMenuOpenedEvent=class extends v{constructor(e,t,i){super(),this._totalUserActionsCount=e,this._firstUserAction=t,this._secondUserAction=i}getActionName(){return"OverflowMenuOpened"}getAttributes(){return n.assign(super.getAttributes(),{TotalUserActionsCount:this._totalUserActionsCount,FirstUserAction:this._firstUserAction,SecondUserAction:this._secondUserAction})}};t.InCallUFD=class extends v{constructor(e,t,i){super(),this._callId=e,this._type=t,this._actionType=i}getActionName(){return"InCallUFD"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,UFDType:c.DeviceStatusToastType[this._type],UFDActionType:c.ToastActionType[this._actionType]})}};t.InCallActivity=class extends v{constructor(e,t){super(),this._callId=e,this._correlationId=t}getActionName(){return"InCallActivity"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,CorrelationId:this._correlationId})}};t.CallActionError=class extends v{constructor(e,t,i,o){super(),this._error=e,this._nodeId=t,this._registrationId=i,this._pstnCampaign=o}getActionName(){return"Error"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._error.callId,NodeId:this._nodeId||"",RegistrationId:this._registrationId||"",CallAction:this._error.action,ErrorMessage:this._error.message,CallValidationFailureReason:this._error.validationReason?l.CallValidationFailureReason[this._error.validationReason]:"",CallTerminatedReason:this._error.terminatedReason,CallTerminatedReasonLabel:r.TerminatedReason[this._error.terminatedReason],CallFailureType:this._error.failureType,CallFailureTypeLabel:r.FailureType[this._error.failureType],IsUsedForPSTNCampaign:n.includes(this._pstnCampaign,this._error.terminatedReason),CauseId:this._error.causeId||""})}};t.CallManagerError=class extends v{constructor(e){super(),this._methodName=e}getActionName(){return"CallManagerError"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{MethodName:this._methodName})}};t.CallActionCallKitError=class extends v{constructor(e,t,i,o,a,n){super(),this._operation=e,this._errorDomain=t,this._errorCode=i,this._callId=o,this._nodeId=a,this._terminal=n}getActionName(){return"CallKitError"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId||"",NodeId:this._nodeId||"",Operation:this._operation||"",ErrorDomain:this._errorDomain,ErrorCode:this._errorCode,Terminal:this._terminal})}};t.CallActionCallKitSuccess=class extends v{constructor(e,t,i){super(),this._operation=e,this._result=t,this._attemptNumber=i}getActionName(){return"CallKitSuccess"}getAttributes(){return n.assign(super.getAttributes(),{Operation:this._operation,Result:this._result,AttemptNumber:this._attemptNumber})}};t.CallActionCalleeUserPresence=class extends v{constructor(e,t){super(),this._callId=e,this._userPresence=t}getActionName(){return"CallActionCalleeUserPresence"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,UserStatus:this._userPresence.status||"",Availabililty:this._userPresence.availability||"",LastSeenAtUtc:this._userPresence.lastSeenAtUtc||""})}};class te extends C.PriorityTelemetryEventBase{constructor(e,t,i,o,a,n,s,r=!1,l=""){super(),this._callId=e,this._origin=t,this._conversationId=i,this._isGroupCall=o,this._isVideoCall=a,this._isPstnCall=n,this._isIncomingCall=s,this._isRejoin=r,this._causeId=l}getEventName(){return"calling_call_entry_point"}getAttributes(){const e=super.getAttributes();e.CallId=this._callId,e.Origin=h.NavigationCallOrigin[this._origin],e.IsRejoiningCall=this._isRejoin,e.IsGroupCall=this._isGroupCall,e.IsVideoCall=this._isVideoCall,e.IsPstnCall=this._isPstnCall,e.IsIncomingCall=this._isIncomingCall,e.CauseId=this._causeId;const t=m.getTrackableConversationId(this._conversationId);return t&&(e.ConversationId=t),e}}t.CallEntryPoint=te;class ie extends g.TelemetryEventBase{constructor(e,t,i,o,a,n,s){super(),this._origin=e,this._conversationId=t,this._isGroupCall=i,this._isVideoCall=o,this._isPstnCall=a,this._clientCountry=n,this._causeId=s}getEventName(){return"calling_call_intention"}getAttributes(){const e=super.getAttributes();e.CallIntentionOrigin=h.NavigationCallOrigin[this._origin],e.IsGroupCall=this._isGroupCall,e.IsVideoCall=this._isVideoCall,e.IsPstnCall=this._isPstnCall,e.ClientCountry=this._clientCountry,e.CauseId=this._causeId;const t=m.getTrackableConversationId(this._conversationId);return t&&(e.ConversationId=t),e}}t.CallIntention=ie;class oe extends g.TelemetryEventBase{constructor(e,t){super(),this._date=e,this._dispostion=t}getEventName(){return"calling_warm_call_notification"}getAttributes(){return n.assign(super.getAttributes(),{Date:this._date,Disposition:this._dispostion})}}t.WarmCalNotificationDisposition=oe;class ae extends g.TelemetryEventBase{constructor(e,t,i,o,a,n,s,r,l,c,d,u,h){super(),this._callId=e,this._endpointId=t,this._nodeId=i,this._participantId=o,this._score=a,this._problemTokens=n,this._questionaryId=s,this._trackingReason=r,this._cdrId=l,this._maxConnectedParticipants=c,this._isGroupCall=d,this._isVideoCall=u,this._isPstnCall=h}getEventName(){return"mdsc_call_quality_feedback"}getAriaTenantTokenOverride(){return p.default.getAriaCQFTenantToken()}getAttributes(){const e=super.getAttributes();return e.uiVersion=p.default.getUIVersion(),e.call_id=this._callId,e.participant_id=this._participantId,e.IsGroupCall=this._isGroupCall,e.IsVideoCall=this._isVideoCall,e.IsPstnCall=this._isPstnCall,this._nodeId&&(e.nodeId=this._nodeId),this._endpointId&&(e.endpoint_id=this._endpointId),this._score&&(e.call_mos_score=this._score-1),this._problemTokens&&(e.call_mos_score_problem_tokens=this._problemTokens),this._cdrId&&(e.call_mos_score_cdr_id=this._cdrId),e.call_mos_score_questionary_id=this._questionaryId,e.call_mos_score_tracking_reason=this._trackingReason,e.call_max_connected_participants=this._maxConnectedParticipants,e}}t.CQF=ae,function(e){e[e.Cancel=0]="Cancel",e[e.JoinWithVideo=1]="JoinWithVideo",e[e.JoinWithoutVideo=2]="JoinWithoutVideo"}(P||(t.CallPreviewActions=P={}));t.CallPreviewEvent=class extends v{constructor(e,t=!1,i=!1,o=!1,a){super(),this._callPreviewActions=e,this._isCameraChanged=t,this._isMicrophoneMuted=i,this._isBlurred=o,this._callId=a}getActionName(){return"CallPreview"}getAttributes(){return n.assign(super.getAttributes(),{CallPreviewActions:P[this._callPreviewActions],IsCameraChanged:this._isCameraChanged,IsMicrophoneMuted:this._isMicrophoneMuted,IsBlurred:this._isBlurred,CallId:this._callId})}};t.RingTheGroupEvent=class extends v{constructor(e){super(),this._callId=e}getActionName(){return"RingTheGroup"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId})}};t.ScreenSharingStoppedEvent=class extends v{constructor(e,t){super(),this._callId=e,this._origin=t}getActionName(){return"ScreenSharingStopped"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,Origin:this._origin})}},function(e){e[e.Cancel=0]="Cancel",e[e.ContinueWithCall=1]="ContinueWithCall"}(M||(t.RinglessCallInterstitialActions=M={}));t.RinglessCallInterstitialEvent=class extends v{constructor(e,t=!1){super(),this._ringlessCallInterstitialActions=e,this._isLargeGroup=t}getActionName(){return"RinglessCallInterstitial"}getAttributes(){return n.assign(super.getAttributes(),{RinglessCallInterstitialActions:M[this._ringlessCallInterstitialActions],IsLargeGroup:this._isLargeGroup})}};t.UnansweredCallActionEvent=class extends v{constructor(e,t,i,o,a,n){super(),this._callId=e,this._nodeId=t,this._terminatedReason=i,this._failureType=o,this._ucuxReason=a,this._ucuxAction=n}getActionName(){return"UnansweredCallActionEvent"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId||"",NodeId:this._nodeId||"",CallingTerminatedReason:this._terminatedReason,CallingFailureType:this._failureType,UcuxReason:l.UnansweredCallReason[this._ucuxReason],UcuxAction:l.UnansweredCallAction[this._ucuxAction]})}};t.CallReconnectSinceStartedEvent=class extends v{constructor(e,t,i){super(),this._callId=e,this._causeId=t,this._timeDurationInSeconds=i}getActionName(){return"CallReconnectSinceStarted"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId||"",CauseId:this._causeId||"",TimeDuration:this._timeDurationInSeconds})}};t.CallCrashEvent=class extends v{constructor(e,t,i,o,a){super(),this._callId=e,this._state=t,this._nodeId=i,this._participantId=o,this._endpointId=a}getActionName(){return"CallCrash"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,CallState:this._state,NodeId:this._nodeId||"",ParticipantId:this._participantId||"",EndpointId:this._endpointId||""})}};t.CallAudioSettingsPopup=class extends v{constructor(e,t){super(),this._callId=e,this._isTouch=t,this._didChangeMicDevice=!1,this._didChangeSpeakerDevice=!1,this._didAdjustSpeakerVolume=!1,this._didAdjustMicVolume=!1,this._didChangeMusicMode=!1,this._didChangeAECMode=!1}getActionName(){return"CallAudioSettingsPopup"}markDidChangeMicDevice(){this._didChangeMicDevice=!0}markDidChangeSpeakerDevice(){this._didChangeSpeakerDevice=!0}markDidAdjustSpeakerVolume(){this._didAdjustSpeakerVolume=!0}markDidAdjustMicVolume(){this._didAdjustMicVolume=!0}markDidChangeMusicMode(){this._didChangeMusicMode=!0}markDidChangeAECMode(){this._didChangeAECMode=!0}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,IsTouch:this._isTouch,DidChangeMicDevice:this._didChangeMicDevice,DidChangeSpeakerDevice:this._didChangeSpeakerDevice,DidAdjustSpeakerVolume:this._didAdjustSpeakerVolume,DidAdjustMicVolume:this._didAdjustMicVolume,DidChangeMusicMode:this._didChangeMusicMode,DidChangeAECMode:this._didChangeAECMode})}};t.CallVideoSettingsPopup=class extends v{constructor(e,t){super(),this._callId=e,this._isTouch=t,this._didChangeCameraDevice=!1,this._toggleBlurOnCount=0,this._toggleBlurOffCount=0}getActionName(){return"CallVideoSettingsPopup"}markDidChangeCameraDevice(){this._didChangeCameraDevice=!0}toggleBlurOn(){this._toggleBlurOnCount++}toggleBlurOff(){this._toggleBlurOffCount++}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,IsTouch:this._isTouch,DidChangeCameraDevice:this._didChangeCameraDevice,ToggleBlurOnCount:this._toggleBlurOnCount,ToggleBlurOffCount:this._toggleBlurOffCount})}};t.Zoom=class extends v{constructor(){super()}getActionName(){return"Zoomed"}getAttributes(){return n.assign(super.getAttributes(),{})}};t.PinCallParticipant=class extends v{constructor(e){super(),this._callId=e}getActionName(){return"PinCallParticipant"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId})}};t.UnpinCallParticipant=class extends v{constructor(e){super(),this._callId=e}getActionName(){return"UnpinCallParticipant"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId})}};t.ToggleCallTray=class extends v{constructor(e,t){super(),this._callId=e,this._wasHidden=t}getActionName(){return"ToggleCallTray"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,WasHidden:this._wasHidden})}};t.CallRosterSession=class extends v{constructor(e,t,i){super(),this._callId=e,this._callRosterOrigin=t,this._isOriginWithHandRaised=i,this._callRosterRemovedUserCount=0,this._callRosterMutedUserCount=0,this._callRosterRangUserCount=0,this._callRosterAddToCallCount=0,this._callRosterJoinLinkCount=0,this._callRosterRingTheGroupCount=0,this._isCanceled=!1}setIsCanceled(e){this._isCanceled=e}getActionName(){return"InCallRosterSession"}callRosterRemovedUser(){this._callRosterRemovedUserCount++}callRosterMutedUser(){this._callRosterMutedUserCount++}callRosterRangUser(){this._callRosterRangUserCount++}callRosterAddToCall(){this._callRosterAddToCallCount++}callRosterJoinLink(){this._callRosterJoinLinkCount++}callRosterRingTheGroup(){this._callRosterRingTheGroupCount++}getAttributes(){return n.assign(super.getAttributes(),{Action:this.getActionName(),CallId:this._callId,Origin:c.CallRosterOrigin[this._callRosterOrigin],IsOriginWithHandRaised:this._isOriginWithHandRaised,IsCanceled:this._isCanceled,CallRosterAddToCallCount:this._callRosterAddToCallCount,CallRosterJoinLinkCount:this._callRosterJoinLinkCount,CallRosterMutedUserCount:this._callRosterMutedUserCount,CallRosterRangUserCount:this._callRosterRangUserCount,CallRosterRemovedUserCount:this._callRosterRemovedUserCount,CallRosterRingTheGroupCount:this._callRosterRingTheGroupCount})}},function(e){e[e.FailedToParsePayload=0]="FailedToParsePayload",e[e.AcknowledgeFailed=1]="AcknowledgeFailed",e[e.CallerNotAllowed=2]="CallerNotAllowed",e[e.InvalidNotification=3]="InvalidNotification",e[e.WrongRecipient=4]="WrongRecipient",e[e.HandshakeNotCompleted=5]="HandshakeNotCompleted",e[e.DecryptionFailed=6]="DecryptionFailed",e[e.GoGoNetwork=7]="GoGoNetwork",e[e.CallerNotContact=8]="CallerNotContact",e[e.RedundantNotification=9]="RedundantNotification",e[e.LackedLocalPermission=10]="LackedLocalPermission",e[e.OutgoingCallActive=11]="OutgoingCallActive",e[e.StartRingingFailed=12]="StartRingingFailed",e[e.UnexpectedSource=13]="UnexpectedSource",e[e.CallDisabled=14]="CallDisabled",e[e.DesktopCallNotificationNotShown=15]="DesktopCallNotificationNotShown",e[e.CallManagerError=16]="CallManagerError",e[e.ProcessNotificationFailed=17]="ProcessNotificationFailed"}(D||(t.IncomingCallEndReason=D={})),function(e){e[e.NotificationReceived=0]="NotificationReceived",e[e.WaitingForCallingStartup=1]="WaitingForCallingStartup",e[e.BeginAcknowledge=2]="BeginAcknowledge",e[e.CompleteAcknowledge=3]="CompleteAcknowledge"}(A||(t.IncomingCallStep=A={})),function(e){e[e.RejectedByCallee=0]="RejectedByCallee",e[e.NotifyingCalleeFailed=1]="NotifyingCalleeFailed",e[e.AnsweringCallFailed=2]="AnsweringCallFailed",e[e.StopRingerNotificationReceived=3]="StopRingerNotificationReceived",e[e.Error=4]="Error",e[e.DNDEnabled=5]="DNDEnabled"}(k||(t.AnswerCallEndReason=k={})),function(e){e[e.CalleeRejected=0]="CalleeRejected",e[e.CalleeAnsweredWithAudio=1]="CalleeAnsweredWithAudio",e[e.CalleeAnsweredWithVideo=2]="CalleeAnsweredWithVideo",e[e.DisconnectedCallStateReceived=3]="DisconnectedCallStateReceived",e[e.StopRingerNotificationReceived=4]="StopRingerNotificationReceived"}(R||(t.CalleeStopRingingReason=R={})),function(e){e[e.InAppBanner=0]="InAppBanner",e[e.InAppFullScreen=1]="InAppFullScreen",e[e.OSNotification=2]="OSNotification",e[e.DesktopCallNotification=3]="DesktopCallNotification",e[e.CallInteractionManager=4]="CallInteractionManager"}(x||(t.AnswerCallNotificationLocation=x={})),function(e){e[e.NotifyingCallee=0]="NotifyingCallee",e[e.CalleeAnsweredWithAudio=1]="CalleeAnsweredWithAudio",e[e.CalleeAnsweredWithVideo=2]="CalleeAnsweredWithVideo",e[e.CalleeRejected=3]="CalleeRejected"}(L||(t.AnswerCallStep=L={})),function(e){e[e.Unknown=0]="Unknown",e[e.Gallery=1]="Gallery",e[e.MessageStream=2]="MessageStream",e[e.SharedPhoto=3]="SharedPhoto",e[e.OverflowMenu=4]="OverflowMenu"}(B||(t.CallActivitiesEntryPoint=B={})),function(e){e[e.ChatOverflow=0]="ChatOverflow",e[e.MessageComposer=1]="MessageComposer",e[e.OverflowMenu=2]="OverflowMenu",e[e.Stage=3]="Stage",e[e.CallGalleryEmptyView=4]="CallGalleryEmptyView"}(V||(t.CallAddPhotosEntryPoint=V={}));class ne extends v{constructor(e,t,i){super(),this._callId=e,this._isGroupCall=t,this._origin=i}setPhotosSent(e){this._photosSent=e}setFromMediaPicker(e){this._fromMediaPicker=e}setMediaPickerPhotosSelected(e){this._mediaPickerPhotosSelected=e}setPhotoTaken(e){this._wasPhotoTaken=e}setNumberOfPhotos(e){this._photosCount=e}getActionName(){return"CallAddPhotosBaseEvent"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,IsGroupCall:this._isGroupCall,PhotosSent:!!this._photosSent,FromMediaPicker:!!this._fromMediaPicker,MediaPickerPhotosSelected:!!this._mediaPickerPhotosSelected,WasPhotoTaken:!!this._wasPhotoTaken,PhotosCount:this._photosCount||0,Origin:V[this._origin]})}}t.CallAddPhotosEvent=class extends ne{getActionName(){return"CallAddPhotosEvent"}};t.CallAddPhotosWithFabEvent=class extends ne{getActionName(){return"CallAddPhotosWithFabEvent"}};t.CallFullScreenBotEvent=class extends v{constructor(e,t){super(),this._callId=e,this._botType=t,this._enableVideo=!1,this._botOnCallUselessLengthSeconds=0,this._botOnCallUselessTime=0}getActionName(){return`Call${this._botType}Event`}setBotOnCallLengthSeconds(e){this._botOnCallLengthSeconds=e}addBotOnCallUselessLengthSeconds(e){this._botOnCallUselessLengthSeconds+=e}getBotOnCallUselessTime(){return this._botOnCallUselessTime}setBotOnCallUselessTime(e){this._botOnCallUselessTime=e}setEnableVideo(){this._enableVideo=!0}setMaxConnectedParticipants(e){(!this._maxConnectedParticipants||e>this._maxConnectedParticipants)&&(this._maxConnectedParticipants=e)}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,DidEnableVideo:this._enableVideo,BotOnCallSeconds:this._botOnCallLengthSeconds||0,BotOnCallUselessSeconds:this._botOnCallUselessLengthSeconds,MaxConnectedParticipants:this._maxConnectedParticipants||0})}};t.CallFullScreenBotError=class extends v{constructor(e,t,i){super(),this._errorCode=e,this._callId=t,this._botType=i}getActionName(){return"CallFullScreenBotError"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId||"",ErrorCode:this._errorCode,BotType:this._botType})}},function(e){e[e.RegisterDataChannelFailed=0]="RegisterDataChannelFailed",e[e.RegisterDataChannelSucceeded=1]="RegisterDataChannelSucceeded",e[e.AudienceBotResponse=2]="AudienceBotResponse",e[e.AudienceBotChangeSceneEvent=3]="AudienceBotChangeSceneEvent",e[e.BingBackgroundsInfoSendFailed=4]="BingBackgroundsInfoSendFailed",e[e.CaptionsBotResponse=5]="CaptionsBotResponse",e[e.ReactionsBotResponse=6]="ReactionsBotResponse",e[e.ReactionInfoSendFailed=7]="ReactionInfoSendFailed",e[e.ReactionReceiveBlankData=8]="ReactionReceiveBlankData",e[e.ReactionReceiveUnparsableData=9]="ReactionReceiveUnparsableData",e[e.ReactionReceiveData=10]="ReactionReceiveData",e[e.ReactionError=11]="ReactionError"}(O||(t.CallDataChannelEventType=O={}));t.CallDataChannelEvent=class extends v{constructor(e,t,i,o,a,n,s,r){super(),this._type=e,this._value=t,this._errorCode=i,this._errorSubCode=o,this._errorText=a,this._retryAttempt=n,this._dataChannelId=s,this._callId=r}getActionName(){return"CallDataChannelEvent"}getAttributes(){var e,t,i,o,a,s,r;const l={CallDataChannelEventType:O[this._type],HandledValue:null!==(e=this._value)&&void 0!==e?e:"",ErrorCode:null!==(t=this._errorCode)&&void 0!==t?t:0,ErrorSubCode:null!==(i=this._errorSubCode)&&void 0!==i?i:0,ErrorText:null!==(o=this._errorText)&&void 0!==o?o:"",RetryAttempt:null!==(a=this._retryAttempt)&&void 0!==a?a:0,DataChannelId:null!==(s=this._dataChannelId)&&void 0!==s?s:0,CallId:null!==(r=this._callId)&&void 0!==r?r:""};return n.assign(super.getAttributes(),l)}};t.CallRecordingEvent=class extends v{constructor(e){super(),this._callId=e,this._screenShare=!1,this._enableVideo=!1}getActionName(){return"CallRecordingEvent"}recordingLengthSeconds(e){this._recordingLengthSeconds=e}setScreenShare(){this._screenShare=!0}setEnableVideo(){this._enableVideo=!0}setMaxConnectedParticipants(e){(!this._maxConnectedParticipants||e>this._maxConnectedParticipants)&&(this._maxConnectedParticipants=e)}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,RecordingLengthSeconds:this._recordingLengthSeconds||0,DidScreenShare:this._screenShare,DidEnableVideo:this._enableVideo,MaxConnectedParticipants:this._maxConnectedParticipants||0})}};t.NdiBroadcastEvent=class extends v{constructor(e,t){super(),this._callId=e,this._maxConnectedParticipantsCount=t,this._wasVideoEverEnabled=!1}getActionName(){return"NdiBroadcastEvent"}setBroadcastingLengthSeconds(e){this._broadcastingDurationSeconds=e}setWatermarkLocation(e){this._watermarkLocation=e}observeVideoEnabled(){this._wasVideoEverEnabled=!0}setMaxConnectedParticipants(e){e>this._maxConnectedParticipantsCount&&(this._maxConnectedParticipantsCount=e)}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,WasVideoEverEnabled:this._wasVideoEverEnabled,BroadcastingDurationSeconds:this._broadcastingDurationSeconds||0,MaxConnectedParticipantsCount:this._maxConnectedParticipantsCount||0,LastWatermarkLocation:this._watermarkLocation||""})}};t.CallAddToCallEvent=class extends v{constructor(e,t,i,o,a){super(),this._callId=e,this._isGroupCall=t,this._hasCoachmark=i,this._isPSTN=o,this._origin=a}getActionName(){return"AddToCallEvent"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,IsGroupCall:this._isGroupCall,HasCoachmark:this._hasCoachmark,IsPSTN:this._isPSTN,Origin:this._origin})}},function(e){e[e.ContextMenu=0]="ContextMenu",e[e.OverflowMenu=1]="OverflowMenu"}(E||(t.MuteEveryoneOrigin=E={}));t.CallMuteEveryoneEvent=class extends v{constructor(e){super(),this._origin=e}getActionName(){return"MuteEveryone"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{Origin:this._origin})}},function(e){e[e.InitiatorMetadataUnavailable=0]="InitiatorMetadataUnavailable",e[e.InvalidToken=1]="InvalidToken"}(N||(t.CallRecorderBotDebugEventType=N={}));t.CallRecorderBotDebugEvent=class extends v{constructor(e,t){super(),this._type=e,this._properties=t}getActionName(){return"CallRecorderBotDebugEvent"}getAttributes(){const e={CallRecorderBotDebugEventType:N[this._type]};return n.assign(e,this._properties),n.assign(super.getAttributes(),e)}},function(e){e[e.SetConfigFailed=0]="SetConfigFailed",e[e.SetConfigSucceeded=1]="SetConfigSucceeded"}(F||(t.CallTranslatorDebugEventType=F={}));t.CallTranslatorDebugEvent=class extends v{constructor(e,t,i){super(),this._type=e,this._errorCode=t,this._errorMessage=i}getActionName(){return"CallTranslatorDebug"}getAttributes(){var e,t;const i={CallTranslatorDebugEventType:F[this._type],ErrorCode:null!==(e=this._errorCode)&&void 0!==e?e:"",ErrorMessage:null!==(t=this._errorMessage)&&void 0!==t?t:""};return n.assign(super.getAttributes(),i)}};class se extends v{constructor(e,t){super(),this._callId=e,this._botType=t}getAttributes(){const e={BotType:this._botType,CallId:this._callId};return n.assign(super.getAttributes(),e)}}t.AddBotToCallEvent=class extends se{getActionName(){return"AddBotToCallInitiated"}};t.AddBotToCallFailedEvent=class extends se{constructor(e,t,i,o){super(e,t),this._addBotDurationInMs=i,this._errorCode=o}getActionName(){return"AddBotToCallFailed"}getAttributes(){const e={AddBotDurationInMs:this._addBotDurationInMs,ErrorCode:this._errorCode};return n.assign(super.getAttributes(),e)}};t.AddBotToCallSucceededEvent=class extends se{constructor(e,t,i){super(e,t),this._addBotDurationInMs=i}getActionName(){return"AddBotToCallSucceeded"}getAttributes(){const e={AddBotDurationInMs:this._addBotDurationInMs};return n.assign(super.getAttributes(),e)}},function(e){e[e.PopupShown=0]="PopupShown",e[e.Mute=1]="Mute",e[e.RemoveFromCall=2]="RemoveFromCall",e[e.CropVideo=3]="CropVideo",e[e.FullVideo=4]="FullVideo",e[e.SendMessage=5]="SendMessage",e[e.OpenChat=6]="OpenChat",e[e.ViewProfile=7]="ViewProfile"}(U||(t.CanvasAndRibbonActions=U={}));t.CanvasAndRibbonActionsEvent=class extends v{constructor(e,t){super(),this._action=e,this._callId=t}getActionName(){return"CanvasAndRibbonActionsEvent"}getAttributes(){var e;return n.assign(super.getAttributes(),{UserAction:U[this._action],CallId:null!==(e=this._callId)&&void 0!==e?e:""})}},function(e){e[e.EnterFullScreen=0]="EnterFullScreen",e[e.ExitFullScreen=1]="ExitFullScreen"}(H||(t.RibbonSettingsMenuActions=H={}));t.RibbonSettingsMenuActionEvent=class extends v{constructor(e){super(),this._action=e}getActionName(){return"RibbonSettingsMenuEvent"}getAttributes(){return n.assign(super.getAttributes(),{UserAction:H[this._action]})}},function(e){e[e.EndCallPopupShown=0]="EndCallPopupShown",e[e.EndCallForEveryone=1]="EndCallForEveryone",e[e.LeaveCall=2]="LeaveCall"}(j||(t.EndCallPopupActions=j={}));t.EndCallPopupMenuActionsEvent=class extends v{constructor(e){super(),this._action=e}getActionName(){return"EndCallPopupMenuEvent"}getAttributes(){return n.assign(super.getAttributes(),{UserAction:j[this._action]})}};t.CallCaptioningEvent=class extends v{constructor(e,t,i,o,a,n){super(),this._callId=e,this._captioningSessionId=t,this._spokenLanguage=i,this._subtitleLanguage=o,this._otherSpokenLanguage=a,this._isAutoJoin=n,this._subtitleHistoryViewCount=0,this._tokenRefreshCount=0,this._captionsPositionModeChangesCount=0,this._startMessageClickedCount=0}getActionName(){return"CallCaptioningEvent"}setCaptioningLengthSeconds(e){this._captioningLengthSeconds=e}setFirstCaptionReceivedLengthSeconds(e){this._firstCaptionReceivedLengthSeconds=e}setMaxSenderCount(e){(!this._maxSenderCount||e>this._maxSenderCount)&&(this._maxSenderCount=e)}openSubtitleHistoryView(){this._subtitleHistoryViewCount++}setPositionMode(e){this._captionsPositionModeChangesCount++,this._lastCaptionsPositionMode=e}startMessageClicked(){this._startMessageClickedCount++}tokenRefresh(){this._tokenRefreshCount++}getAttributes(){var e,t,i;return n.assign(super.getAttributes(),{CallId:this._callId,CaptioningSessionId:this._captioningSessionId,CaptioningLengthSeconds:this._captioningLengthSeconds||0,FistCaptionReceivedLengthSeconds:this._firstCaptionReceivedLengthSeconds||0,MaxSenderCount:this._maxSenderCount||0,SpokenLanguage:null!==(e=this._spokenLanguage)&&void 0!==e?e:"",SubtitleLanguage:null!==(t=this._subtitleLanguage)&&void 0!==t?t:"",OtherSpokenLanguage:null!==(i=this._otherSpokenLanguage)&&void 0!==i?i:"",IsSubtitleLanguageDifferentFromSpokenLanguage:this._spokenLanguage!==this._subtitleLanguage,SubtitleHistoryViewCount:this._subtitleHistoryViewCount,TokenRefreshCount:this._tokenRefreshCount,IsAutoJoin:this._isAutoJoin,CaptionsPositionModeChangedCount:this._captionsPositionModeChangesCount,LastCaptionsPositionMode:this._lastCaptionsPositionMode||"",StartMessageClickedCount:this._startMessageClickedCount})}};t.CallPstnTranslationLanguageChangeEvent=class extends v{constructor(e,t,i,o,a){super(),this._callId=e,this._captioningSessionId=t,this._prevLanguage=i,this._language=o,this._isLocal=a}getActionName(){return"CallPstnTranslationLanguageChangeEvent"}getAttributes(){var e;return n.assign(super.getAttributes(),{CallId:this._callId,CaptioningSessionId:this._captioningSessionId,PrevLanguage:null!==(e=this._prevLanguage)&&void 0!==e?e:"",Language:this._language,IsLocal:this._isLocal})}};t.CallPstnTranslationSettingsOpened=class extends v{constructor(e,t){super(),this._callId=e,this._captioningSessionId=t}getActionName(){return"CallPstnTranslationSettingOpenedEvent"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,CaptioningSessionId:this._captioningSessionId})}},function(e){e[e.PopupShown=0]="PopupShown",e[e.SwitchCamera=1]="SwitchCamera",e[e.TurnOnVideo=2]="TurnOnVideo",e[e.TurnOffVideo=3]="TurnOffVideo",e[e.Mute=4]="Mute",e[e.Unmute=5]="Unmute",e[e.BackgroundBlur=6]="BackgroundBlur",e[e.BackgroundUnBlur=7]="BackgroundUnBlur"}(z||(t.LocalVideoActions=z={})),function(e){e[e.SwitchToSpeaker=0]="SwitchToSpeaker",e[e.SwitchToContent=1]="SwitchToContent",e[e.SwitchToPresentation=2]="SwitchToPresentation",e[e.SwitchToFloat=3]="SwitchToFloat",e[e.SwitchToWindow=4]="SwitchToWindow",e[e.EnterFullScreen=5]="EnterFullScreen",e[e.SwitchToModernGrid=6]="SwitchToModernGrid",e[e.SwitchToTogetherMode=7]="SwitchToTogetherMode",e[e.SwitchToLargeGallery=8]="SwitchToLargeGallery",e[e.ActivateOnlyVideoOnTheStage=9]="ActivateOnlyVideoOnTheStage",e[e.DeactivateOnlyVideoOnTheStage=10]="DeactivateOnlyVideoOnTheStage",e[e.ActivateSelfInTheGrid=11]="ActivateSelfInTheGrid",e[e.DeactivateSelfInTheGrid=12]="DeactivateSelfInTheGrid"}(G||(t.CallViewMenuActions=G={}));t.LocalVideoActionsEvent=class extends v{constructor(e,t){super(),this._action=e,this._callId=t}getActionName(){return"LocalVideoActionsEvent"}getAttributes(){var e;return n.assign(super.getAttributes(),{UserAction:z[this._action],CallId:null!==(e=this._callId)&&void 0!==e?e:""})}};class re extends g.TelemetryEventBase{constructor(e,t,i,o,a){super(),this._hasActiveCall=e,this._predefinedImage=t,this._effectType=i,this._predefinedImageName=o,this._category=a}getEventName(){return"calling_background_effects_settings"}getAttributes(){const e=super.getAttributes();return e.EffectType=this._effectType,e.HasActiveCall=!!this._hasActiveCall,this._effectType===h.BackgroundEffect.BackgroundImage&&(e.IsPredefinedImage=this._predefinedImage),this._predefinedImageName&&(e.PredefinedImageName=this._predefinedImageName),this._category&&(e.Category=this._category),n.assign(super.getAttributes(),e)}}t.BackgroundEffectsSettingsEvent=re;t.BackgroundBlurEvent=class extends v{constructor(e,t){super(),this._callId=e,this._durationSecond=t}getActionName(){return"BackgroundBlurEvent"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,BlurSessionDuration:this._durationSecond})}};t.BackgroundEffectEvent=class extends v{constructor(e,t,i){super(),this._callId=e,this._durationSecond=t,this._type=i}getActionName(){return"BackgroundEffectEvent"}getAttributes(){const e=this._type===h.BackgroundEffect.Blur?"BlurSessionDuration":"BackgroundImageSessionDuration";return n.assign(super.getAttributes(),{CallId:this._callId,[e]:this._durationSecond})}};class le extends g.TelemetryEventBase{constructor(e,t,i,o,a){super(),this._callId=e,this._isoDate=t,this._bingEffectUser=i,this._market=o,this._isCollapsed=a}getEventName(){return"calling_background_effects_bing_click"}getAttributes(){var e,t;const i=super.getAttributes();return i.CallId=null!==(e=this._callId)&&void 0!==e?e:"",i.ImgDate=this._isoDate,i.Market=null!==(t=this._market)&&void 0!==t?t:"",i.IsCollapsed=this._isCollapsed,n.assign(super.getAttributes(),i)}getPiiAttributes(){var e;const t=super.getPiiAttributes();return t.BingEffectUser={value:null!==(e=this._bingEffectUser)&&void 0!==e?e:"",piiKind:a.AWTPiiKind.Identity},n.assign(super.getPiiAttributes(),t)}}t.BackgroundEffectsBingInfoClickEvent=le;class ce extends g.TelemetryEventBase{constructor(e,t,i,o,a){super(),this._market=e,this._attempt=t,this._code=i,this._imageCount=o,this._error=a}getEventName(){return"calling_bing_background_download_api"}getAttributes(){var e,t;const i=super.getAttributes();return i.Market=this._market,i.Attempt=this._attempt,i.ResultCode=null!==(e=this._code)&&void 0!==e?e:0,i.ImageCount=null!==(t=this._imageCount)&&void 0!==t?t:0,i.Error=this._error||"",n.assign(super.getAttributes(),i)}}t.BingBackgroundsDownloadApiEvent=ce,function(e){e[e.None=0]="None",e[e.Navigate=1]="Navigate",e[e.Call=2]="Call"}(W||(t.CallbackReminderTappedAction=W={}));class de extends g.TelemetryEventBase{constructor(e,t,i){super(),this._result=e,this._missedCallTime=t,this._notificationShownTime=i}getEventName(){return"CallbackReminderTapped"}getAttributes(){const e=Date.now();return n.assign(super.getAttributes(),{CallbackReminderTappedAction:W[this._result],TimeSinceMissedCallMinutes:(e-this._missedCallTime)/6e4,TimeSinceReminderMinutes:(e-this._notificationShownTime)/6e4})}}t.CallbackReminderTappedEvent=de,function(e){e[e.Displayed=0]="Displayed",e[e.Pressed=1]="Pressed"}(K||(t.IncomingVideoNotificationAction=K={}));class ue extends g.TelemetryEventBase{constructor(e,t,i){super(),this._origin=e,this._callId=t,this._action=i}getEventName(){return"calling_incoming_video_notification"}getAttributes(){return n.assign(super.getAttributes(),{Origin:this._origin,CallId:this._callId,Action:K[this._action]})}}t.IncomingVideoNotification=ue;t.ScreenShareSourceGetPreviewFailure=class extends v{constructor(e,t,i){super(),this._error=e,this._sourceType=t,this._currentlyShared=i}getActionName(){return"GetPreview"}getEventName(){return"GetPreviewFailed"}getAttributes(){return n.assign(super.getAttributes(),{Error:this._error,SourceType:this._sourceType,CurrentlyShared:this._currentlyShared})}};t.ScreenShareSourceGetIconFailure=class extends v{constructor(e,t){super(),this._error=e,this._currentlyShared=t}getActionName(){return"GetIcon"}getEventName(){return"GetIconFailed"}getAttributes(){return n.assign(super.getAttributes(),{Error:this._error,CurrentlyShared:this._currentlyShared})}};t.CallMergeEvent=class extends v{constructor(e,t,i){super(),this._activeCallId=e,this._incomingCallId=t,this._succeed=i}getActionName(){return"CallMergeEvent"}getAttributes(){return n.assign(super.getAttributes(),{ActiveCallId:this._activeCallId,IncomingCallId:this._incomingCallId,Succeed:this._succeed})}};class he extends g.TelemetryEventBase{constructor(e,t,i){super(),this._startingRoute=e,this._endingRoute=t,this._changed=i}getEventName(){return"AudioOutputDeviceSwitcher"}getAttributes(){return n.assign(super.getAttributes(),{DidChangeOutputDevice:this._changed,StartingOutputDevice:this._startingRoute,EndingOutputDevice:this._endingRoute})}}t.AudioOutputRouteChangedEvent=he,function(e){e[e.Accept=0]="Accept",e[e.Reject=1]="Reject",e[e.Mute=2]="Mute"}($||(t.SystemHotKeyCallAction=$={}));t.SystemHotKeyCallEvent=class extends v{constructor(e){super(),this._systemHotKeyCallAction=e}getActionName(){return"SystemHotKeyCall"}getAttributes(){return n.assign(super.getAttributes(),{SystemHotKeyCallAction:$[this._systemHotKeyCallAction]})}};t.SpeakerViewEvent=class extends v{constructor(e,t){super(),this._callId=e,this._durationSecond=t}getActionName(){return"SpeakerView"}getAttributes(){return n.assign(super.getAttributes(),{CallId:this._callId,SpeakerViewSessionDuration:this._durationSecond})}};t.CallViewMenuActionEvent=class extends v{constructor(e){super(),this._userAction=e}getActionName(){return"CallViewMenuAction"}getAttributes(){return n.assign(super.getAttributes(),{UserAction:G[this._userAction]})}};t.CallStageLayoutChangeEvent=class extends v{constructor(e,t,i,o,a,n){super(),this._fromStageMode=e,this._toStageMode=t,this._fromOnlyVideoOnTheStage=i,this._toOnlyVideoOnTheStage=o,this._isNewCallScreenActive=a,this._isAutomatic=n}getActionName(){return"CallStageLayoutChange"}getAttributes(){return n.assign(super.getAttributes(),{FromStageMode:c.StageMode[this._fromStageMode],ToStageMode:c.StageMode[this._toStageMode],FromOnlyVideoOnTheStage:this._fromOnlyVideoOnTheStage,ToOnlyVideoOnTheStage:this._toOnlyVideoOnTheStage,IsNewCallScreenActive:this._isNewCallScreenActive,IsAutomatic:this._isAutomatic})}},function(e){e[e.Apply=0]="Apply",e[e.Cancel=1]="Cancel"}(q||(t.TogetherModePanelActionOrigin=q={}));t.TogetherModePanelActionEvent=class extends v{constructor(e,t){super(),this._origin=e,this._isChangingBackground=t}getActionName(){return"TogetherModePanelAction"}getAttributes(){const e=super.getAttributes();return e.IsChangingBackground=this._isChangingBackground,e.Origin=this._origin,e}},function(e){e[e.AnsweredWithAudio=0]="AnsweredWithAudio",e[e.AnsweredWithVideo=1]="AnsweredWithVideo",e[e.Declined=2]="Declined",e[e.DeclinedWithMessage=3]="DeclinedWithMessage"}(Q||(t.MobileCallAnswerActions=Q={}));t.MobileCallAnswerEvent=class extends v{constructor(e,t){super(),this._userAction=e,this._messageIndex=t}getActionName(){return"MobileCallAnswerEvent"}getAttributes(){return n.assign(super.getAttributes(),{UserAction:Q[this._userAction],MessageSent:this._messageIndex})}},function(e){e.MobileIncomingRingPanel="MobileIncomingRingPanel",e.IncomingRingControls="IncomingRingControls",e.DesktopCallControls="DesktopCallControls",e.OngoingCallService="OngoingCallService",e.MobileCallControls="MobileCallControls"}(X||(t.CallControlContext=X={})),function(e){e.Ignore="Ignore",e.AnswerCall="AnswerCall",e.EndCall="EndCall"}(Z||(t.MediaActionEventResult=Z={}));t.MediaActionEvent=class extends v{constructor(e,t){super(),this._context=e,this._result=t}getActionName(){return"MediaAction"}getAttributes(){return n.assign(super.getAttributes(),{Context:this._context,Result:this._result})}};t.MaybeEndCallFromAndroidBtScoDisconnectEvent=class extends v{constructor(e){super(),this._context=e}getActionName(){return"MaybeEndCallFromAndroidBtScoDisconnect"}getAttributes(){return n.assign(super.getAttributes(),{Context:this._context})}},function(e){e[e.Enter=0]="Enter",e[e.Leave=1]="Leave"}(J||(t.FullChatUXNavigation=J={}));t.FullChatUXTelemetryEvent=class extends v{constructor(e,t,i){super(),this._navigation=e,this._conversationId=t,this._callId=i}getActionName(){return"FullChatUX"}getNavigationName(){return J[this._navigation]}getAttributes(){const e=super.getAttributes();return e.Navigation=this.getNavigationName(),e.IsGroupConversation=u.isGroupConversation(this._conversationId),e.CallId=this._callId,e}};t.CancelPreheatedCallNotJoinedEvent=class extends v{constructor(e,t){super(),this._callId=e,this._terminatedReason=t}getActionName(){return"CancelPreheatedCallNotJoined"}getAttributes(){const e=super.getAttributes();return e.CallId=this._callId,e.TerminatedReason=r.TerminatedReason[this._terminatedReason],e}};t.TouchBarButtonClickEvent=class extends v{constructor(e,t){super(),this._callId=e,this._command=t}getActionName(){return"TouchBarButtonClick"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,Command:this._command})}};t.InformedCallKitEvent=class extends v{constructor(e,t,i,o){super(),this._callId=e,this._causeId=t,this._action=i,this._ongoingCallCount=o}getActionName(){return"InformedCallKit"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,CauseId:this._causeId,CallAction:this._action,OngoingCallCount:this._ongoingCallCount})}};t.AnswerOrJoinCallEvent=class extends v{constructor(e,t,i){super(),this._callId=e,this._causeId=t,this._origin=i}getActionName(){return"AnswerOrJoinCall"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,CauseId:this._causeId,Origin:h.NavigationCallOrigin[this._origin]})}};class pe extends v{constructor(e,t){super(),this._completionHandler=t,this._timerId=0,this._timerId=f.default.setTimeout((()=>this._completionHandler(this)),e)}clearTimer(){f.default.clearTimeout(this._timerId)}}t.CallConnectedOnAnswerEvent=class extends pe{constructor(e,t,i,o){super(10*y.SECOND,i),this._callId=e,this._origin=t,this._causeId=o,this._createdTs=Date.now()}getActionName(){return"CallConnectedOnAnswer"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,Origin:this._origin,ConnectedIn:this._getElapsed(),IsTimedOut:this._isTimedOut(),CauseId:this._causeId})}markConnectedState(){this.clearTimer(),this._callConnectedTs=Date.now(),this._completionHandler(this)}_getElapsed(){return(this._callConnectedTs||Date.now())-this._createdTs}_isTimedOut(){return void 0===this._callConnectedTs}};t.CallParticipantRendererIsRenderingEvent=class extends pe{constructor(e,t,i,o){super(10*y.SECOND,o),this._callId=e,this._participantId=t,this._origin=i,this._createdTs=Date.now()}getActionName(){return"CallParticipantRendererIsRendering"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,ParticipantId:this._participantId,Origin:this._origin,RenderingEstablishmentTime:this._getElapsed(),IsTimedOut:this._isTimedOut()})}markIsRenderingState(){this.clearTimer(),this._isRenderingTs=Date.now(),this._completionHandler(this)}_getElapsed(){return(this._isRenderingTs||Date.now())-this._createdTs}_isTimedOut(){return void 0===this._isRenderingTs}};t.IncomingCallScreenDisplayedEvent=class extends pe{constructor(e,t,i){super(30*y.SECOND,i),this._callId=e,this._intentCreatedTs=t}getActionName(){return"IncomingCallScreenDisplayed"}getAttributes(){var e;return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,Duration:(null!==(e=this._incomingCallScreenDisplayedTs)&&void 0!==e?e:Date.now())-this._intentCreatedTs,IsTimedOut:void 0===this._incomingCallScreenDisplayedTs})}markIncomingCallScreenDisplayed(){this.clearTimer(),this._incomingCallScreenDisplayedTs=Date.now(),this._completionHandler(this)}_isTimedOut(){return void 0===this._incomingCallScreenDisplayedTs}};t.LiveStateDetectionTimeoutEvent=class extends v{constructor(e,t){super(),this._callId=e,this._otherActiveCallId=t}getActionName(){return"LiveStateDetectionTimeout"}getAttributes(){var e;return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,OtherActiveCallId:null!==(e=this._otherActiveCallId)&&void 0!==e?e:""})}},function(e){e[e.InvalidCallStatusTransition=0]="InvalidCallStatusTransition"}(Y||(t.CallSlimCoreErrorType=Y={}));t.CallSlimCoreError=class extends v{constructor(e,t,i,o,a=r.CallState.None,n=r.CallState.None){super(),this._callId=e,this._callSlimCoreErrorType=t,this._causeId=i,this._terminatedReason=o,this._currentState=a,this._newState=n}getActionName(){return"CallSlimCoreError"}getAttributes(){var e;return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,SlimCoreErrorType:this._callSlimCoreErrorType,TerminatedReason:null!==(e=this._terminatedReason)&&void 0!==e?e:"",CauseId:this._causeId,CurrentState:this._currentState,NewState:this._newState})}},function(e){e[e.EndCall=0]="EndCall",e[e.RejectCall=1]="RejectCall",e[e.HoldCall=2]="HoldCall",e[e.ResumeCall=3]="ResumeCall"}(ee||(t.CallUserActionType=ee={}));t.CallUserActionEvent=class extends v{constructor(e,t,i,o){super(),this._action=e,this._callId=t,this._causeId=i,this._origin=o}getActionName(){return"CallUserAction"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,CauseId:this._causeId,Origin:h.NavigationCallOrigin[this._origin],UserAction:ee[this._action]})}};t.CallManagerRequestCompleteEvent=class extends v{constructor(e,t){super(),this._methodName=e,this._duration=t}getActionName(){return"CallManagerRequestComplete"}shouldSend(){const e=g.SampledEvents[this.getEventName()+"_"+this.getActionName()];return"number"==typeof e?T.default.sampleForPercentage(e):super.shouldSend()}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{MethodName:this._methodName,Duration:this._duration})}};t.OutgoingCallNavigationFinishedEvent=class extends pe{constructor(e,t,i){super(10*y.SECOND,i),this._callId=e,this._intentCreatedTs=t}getActionName(){return"OutgoingCallNavigationFinishedDurationMs"}getAttributes(){var e;return Object.assign(Object.assign({},super.getAttributes()),{CallId:this._callId,Duration:(null!==(e=this._outgoingCallNavigationFinishedTs)&&void 0!==e?e:Date.now())-this._intentCreatedTs,IsTimedOut:void 0===this._outgoingCallNavigationFinishedTs})}markOutgoingCallNavigationFinished(){this.clearTimer(),this._outgoingCallNavigationFinishedTs=Date.now(),this._completionHandler(this)}_isTimedOut(){return void 0===this._outgoingCallNavigationFinishedTs}}},657784:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallCardType=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(44717)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importStar(i(437782));t.CallCardType={Started:"started",Ended:"ended",Missed:"missed",Cast:"cast"};t.default=class{static getCallUsersMaxDuration(e,t=0){if(!e.length)return t;const i=a.map(e,(e=>e.duration));return a.max(i)||t}static getMri(e){let t=e.identity;if(t||(e.nameChild&&(t=e.nameChild.getRawText()),t&&t.length))return t}static getCallCardUsers(e){const t=[];return a.each(e,(e=>{const i=this.getMri(e);if(!i)return void r.log(s.LogTraceArea.CallCard,"getCallCardUsers() -  no user in partnode.");const o=n.isMri(i)?n.asMri(i):n.isSkypeId(i)?n.sanitizeMri(i,n.Namespaces.SkypeId):void 0;if(o){if(!n.isAgent(o)){let i;if(e.durationChild&&a.isFunction(e.durationChild.getRawText)){const t=parseInt(e.durationChild.getRawText(),10);a.isFinite(t)&&t>=0?i=t:r.warn(s.LogTraceArea.CallCard,"Invalid Call Card user duration from service")}t.push({mri:o,duration:i,isParticipant:!!i})}}else r.log(s.LogTraceArea.CallCard,"getCallCardUsers() - part node user not valid. value:"+l.mriOrId(i))})),t}}},413591:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.participantSupportsServerMute=function(e){return function(e,t){if(!n.default.isParticipantConnected(e))return!1;if(!e)return!1;if(!e.endpoints)return!1;return h(e.endpoints.endpointDetails,t)}(e,(e=>"enabled"===e.serverMuteUnmute))},t.getLocalUserSupportsServerMuteUnmute=function(e){return h(e,(e=>"enabled"===e.serverMuteUnmute))},t.participantSupportsCallingReactions=function(e){return d(e,(e=>!!e.reactionsEnabled))},t.participantSupportsCallRecording=function(e){return d(e,(e=>!!e.supportsCallRecording))},t.participantSupportsInCallTranslation=function(e){return d(e,(e=>!!e.inCallTranslationSupported))},t.participantHasInCallTranslationConsent=function(e){return d(e,(e=>!!e.hasInCallTranslationConsent))},t.participantSupportsTruVoiceTranslation=function(e){return d(e,(e=>!!e.inTruVoiceTranslationSupported))},t.participantHasTruVoiceTranslationConsent=function(e){return d(e,(e=>!!e.hasTruVoiceTranslationConsent))},t.participantSupportsDataChannelReactions=function(e){return d(e,(e=>!!e.dataChannelReactionsSupported))},t.participantSupportsCallMediaCaptureNotifications=function(e){return d(e,(e=>!!e.supportsNotifyCallMediaCaptured))},t.participantHasEndpointMetadata=function(e){return c(e,(e=>!0))},t.participantIsCapturingCallMedia=function(e){return d(e,(e=>!!e.isCallMediaCaptured))},t.participantNotIsVideoCapable=function(e){return d(e,(e=>!a.isUndefined(e.isVideoCapable)&&!e.isVideoCapable))},t.initiatorUserMri=function(e){return u(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.initiatorUserId));return t?t.endpointMetadata.initiatorUserId:void 0}))},t.participantIsAlexa=function(e){return!!u(e,(e=>a.some(e,(e=>{if(!e)return!1;const t=s.SkypeVersionParser.parse(e.clientVersion);return!!t&&r.default.isAlexaPlatformId(t.platformId)}))))},t.recordingTimestamp=function(e){return u(e,(e=>{const t=e.find((e=>!!e.endpointMetadata&&!!e.endpointMetadata.timestamp));return t?t.endpointMetadata.processingModes.recording.timestamp:void 0}))},t.serviceUri=function(e,t,i){const o=l(e,t,i);return o?o.uri:void 0},t.stateVersion=function(e,t,i){const o=l(e,t,i);return o?o.stateVersion:void 0},t.serviceAudienceBotUri=function(e){return u(e,(e=>{var t,i;const o=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri));return o?null===(i=null===(t=o.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0}))},t.serviceGridViewBotUri=function(e){return u(e,(e=>{var t,i;const o=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri));return o?null===(i=null===(t=o.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0}))},t.callTranslatorBotSpokenLanguageLocale=function(e){return u(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.callTranslatorBotSpokenLanguageLocale));return t?t.endpointMetadata.callTranslatorBotSpokenLanguageLocale:void 0}))},t.callTranslatorBotAutoDetectLanguages=function(e){return u(e,(e=>{const t=e.find((e=>{var t;return Boolean(null===(t=null==e?void 0:e.endpointMetadata)||void 0===t?void 0:t.callTranslatorAutoDetectLangs)}));return null==t?void 0:t.endpointMetadata.callTranslatorAutoDetectLangs}))};const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(60433)),s=i(720756),r=o.__importDefault(i(139221));function l(e,t,i){return u(e,(e=>{const o=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.services));if(o){const e=o.endpointMetadata.services;return a.find(e,(e=>e.id===t&&e.version===i))}}))}function c(e,t){return!!e&&(!!e.endpoints&&a.some(e.endpoints.endpointDetails,(e=>!!e.endpointMetadata&&t(e.endpointMetadata))))}function d(e,t){return!!n.default.isParticipantConnected(e)&&c(e,t)}function u(e,t){if(e&&e.endpoints&&n.default.isParticipantConnected(e))return t(e.endpoints.endpointDetails)}function h(e,t){return!!e&&a.some(e,(e=>!!e.capabilities&&t(e.capabilities)))}},788286:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerDisplayUtils=t.CallMarkerType=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(657784)),s=i(189963),r=o.__importStar(i(44717)),l=o.__importDefault(i(389659)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importStar(i(704704)),h=i(641400),p=o.__importDefault(i(760989));var g;!function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended",e[e.Missed=2]="Missed",e[e.NoAnswer=3]="NoAnswer",e[e.Declined=4]="Declined",e[e.Failed=5]="Failed"}(g||(t.CallMarkerType=g={}));t.default=class{static calculateCallMarkerInfo(e,t){let i=this._extractCallCardInfoFromPartListNode(e);return t&&e.type!==n.CallCardType.Started&&(i=this._mergeCallLogsIntoCallMarkerInfo(t,i)),i}static calculateCallMarkerInfoFromPath(e,t,i,o,a){const n={callId:t,conversationId:i,type:o,duration:a};return this._mergeCallLogsIntoCallMarkerInfo(e,n)}static _mergeCallLogsIntoCallMarkerInfo(e,t){let i=t.type,o=t.duration;if(e)if(e.callState===s.CallState.Failed)i=g.Failed;else if(e.callState===s.CallState.Missed&&e.callDirection===s.CallDirection.Incoming)i=g.Missed;else if(e.callState===s.CallState.Missed&&e.callDirection===s.CallDirection.Outgoing)i=g.NoAnswer;else if(e.callState===s.CallState.Declined)i=g.Declined;else if(e.callState===s.CallState.Accepted&&e.callDirection===s.CallDirection.Outgoing&&e.forwardingInfo&&e.forwardingInfo.acceptedBy&&e.forwardingInfo.acceptedBy.type===s.ParticipantType.Voicemail)i=g.NoAnswer;else if(e.callState===s.CallState.Accepted&&e.callDirection===s.CallDirection.Outgoing&&e.callType===s.CallType.MultiParty&&1===a.size(e.participants))i=g.NoAnswer;else if(e.callState===s.CallState.Accepted&&(i=g.Ended,e.connectTime&&e.endTime)){const t=new Date(e.connectTime).getTime(),i=new Date(e.endTime).getTime();t&&i&&i>t&&(o=a.floor((i-t)/1e3))}return Object.assign(Object.assign({},t),{type:i,duration:o})}static _extractCallCardInfoFromPartListNode(e){const t=!!e.conversationId&&r.isThread(e.conversationId),i=!!e.conversationId&&r.isPhoneMri(e.conversationId),o=!!e.conversationId&&r.isGroupConversation(e.conversationId),s=n.default.getCallCardUsers(e.children),l=a.filter(s,(e=>e.isParticipant));let u,h=g.Ended;const p=a.size(e.children),C=a.size(s),m=a.size(l);p!==C&&d.warn(c.LogTraceArea.CallCard,`renderPartListNodeParts() user mismatch. tree: ${p} card: ${C} participants: ${m}type: ${h} thread: ${t} PSTN: ${i}`);const S=m>1;return e.type===n.CallCardType.Started?h=g.Started:o&&!S||!o&&e.type===n.CallCardType.Missed?h=g.Missed:(u=n.default.getCallUsersMaxDuration(s),h=g.Ended),{callId:e.callId,conversationId:e.conversationId,type:h,duration:u}}};t.CallMarkerDisplayUtils=class{static getText(e,t){switch(e){case g.Started:return u.getString("CallCard.CallStartedStatusMessage");case g.Missed:return u.getString("CallCard.CallMissedStatusMessage");case g.Ended:if(t){const e=l.default.getFormattedDuration(t,!1);return u.getString("CallCard.CallEndedStatusWithDurationMessage",{duration:e})}return u.getString("CallCard.CallEndedStatusMessage");case g.Declined:return u.getString("CallCard.CallDeclinedStatusMessage");case g.NoAnswer:return u.getString("CallCard.CallNoAnswerStatusMessage");case g.Failed:return u.getString("CallCard.CallFailedStatusMessage");default:return p.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForEncryptedThread(e,t){switch(e){case g.Started:return u.getString("CallCard.EncryptedCallStartedStatusMessage");case g.Missed:return u.getString("CallCard.EncryptedCallMissedStatusMessage");case g.Ended:if(t){const e=l.default.getFormattedDuration(t,!1);return u.getString("CallCard.EncryptedCallEndedStatusWithDurationMessage",{duration:e})}return u.getString("CallCard.EncryptedCallEndedStatusMessage");case g.Declined:return u.getString("CallCard.EncryptedCallDeclinedStatusMessage");case g.NoAnswer:return u.getString("CallCard.EncryptedCallNoAnswerStatusMessage");case g.Failed:return u.getString("CallCard.EncryptedCallFailedStatusMessage");default:return p.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getIcon(e){switch(e){case g.Started:return h.SkypeIcon.CallStart;case g.Missed:case g.NoAnswer:case g.Declined:case g.Failed:return h.SkypeIcon.CallMissed;case g.Ended:return h.SkypeIcon.CallEnd;default:return p.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForAccessibilityLabel(e){switch(e){case g.Started:return u.getString("AccessibilityLabel.Call");case g.Missed:return u.getString("AccessibilityLabel.CallMissed");case g.Ended:return u.getString("AccessibilityLabel.Call");case g.Declined:return u.getString("AccessibilityLabel.CallDeclined");case g.NoAnswer:return u.getString("AccessibilityLabel.CallNoAnswer");case g.Failed:return u.getString("AccessibilityLabel.CallFailed");default:return p.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}}},609913:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(167606),s=o.__importStar(i(971988)),r=i(82485);t.default=class{static updateCallEventMessages(e){const t=a.compact(e),i=a.clone(t);let o,l,c,d,u=0;return a.each(t,((e,t)=>{s.isEventCallStartedMessageType(e)?l===e.skypeguid?(r.Instrumentation.warn(n.LogTraceArea.MessageStream,"duplicated call started message found, will skip the later one"),i[t]=void 0):(l=e.skypeguid,o=e,u=t,c=void 0):s.isEventCallEndedMessageType(e)?o&&o.skypeguid===e.skypeguid&&(c?i[t]=e.applyPropertyLie("messagesSentDuringCall",!0):i[u]=void 0):s.isEventCallMissedMessageType(e)?d===e.skypeguid?(r.Instrumentation.warn(n.LogTraceArea.MessageStream,"duplicated call missed message found, will skip the later one"),i[t]=void 0):d=e.skypeguid:e.isShownInStream()&&(c=e)})),a.compact(i)}}},760053:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.XorShift=t.ProblemTokens=t.ProblemSectionType=void 0,t.shouldTriggerForCall=function(e,t,i){if(e.durationSeconds<t.MinCallDurationSecs)return d.log(c.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" duration too short ("+e.durationSeconds+" < "+t.MinCallDurationSecs+"). Returning false."),s.Resolved(!1);if(e.forwardingDestinationType&&"voicemail"===e.forwardingDestinationType)return d.log(c.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" went to voicemail. Returning false."),s.Resolved(!1);let o;if(i){const t=r.isGroupConversation(e.conversationMri)?n.EcsCallType.CallTypeGroup:r.isPhoneMri(e.conversationMri)?n.EcsCallType.CallTypePstn:n.EcsCallType.CallTypeS2s;o=s.fromThenable(a.default.shouldTriggerCQF(u.default.getSkypeId(),e.callId,t)).catch((()=>(d.log(c.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" calling stack didn't provide a value. Assuming false."),!1)))}else o=s.Resolved(!1);return o.then((i=>{if(i)return!0;const o=r.isGroupConversation(e.conversationMri)?t.GroupCall_Percent:r.isPhoneMri(e.conversationMri)?t.PSTN_Percent:t.S2S_Percent;return m(e.callId)%100>=o?(d.log(c.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" not within "+o+"%. Returning false."),!1):(d.log(c.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" within "+o+"%. Returning true."),!0)}))},t.tokensString=function(e){if(0===e.length)return;return"checks="+e.join("%20")},t.shuffleArray=C,t.CQFHash=m,t.problemSections=function(e,t){const i=[{type:h.Audio,title:"AudioProblems",problems:f(e,S,p.AudioTokenOther)}];t&&(i.push({type:h.Video,title:"VideoProblems",problems:f(e,_,p.VideoTokenOther)}),C(i,e));return i};const o=i(197582),a=o.__importDefault(i(264596)),n=i(148540),s=o.__importStar(i(397691)),r=o.__importStar(i(44717)),l=o.__importStar(i(766698)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importDefault(i(363091));var h,p;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(h||(t.ProblemSectionType=h={})),function(e){e[e.AudioTokenNoSoundLocal=101]="AudioTokenNoSoundLocal",e[e.AudioTokenNoSoundRemote=102]="AudioTokenNoSoundRemote",e[e.AudioTokenEcho=103]="AudioTokenEcho",e[e.AudioTokenNoise=104]="AudioTokenNoise",e[e.AudioTokenLowSound=105]="AudioTokenLowSound",e[e.AudioTokenDropped=106]="AudioTokenDropped",e[e.AudioTokenDistorted=107]="AudioTokenDistorted",e[e.AudioTokenInterrupted=108]="AudioTokenInterrupted",e[e.AudioTokenOther=109]="AudioTokenOther",e[e.AudioTokenPSTNDialpad=301]="AudioTokenPSTNDialpad",e[e.VideoTokenNoVideoLocal=201]="VideoTokenNoVideoLocal",e[e.VideoTokenNoVideoRemote=202]="VideoTokenNoVideoRemote",e[e.VideoTokenLowQuality=203]="VideoTokenLowQuality",e[e.VideoTokenFreezing=204]="VideoTokenFreezing",e[e.VideoTokenStoppedUnexpectedly=205]="VideoTokenStoppedUnexpectedly",e[e.VideoTokenOtherSideTooDark=206]="VideoTokenOtherSideTooDark",e[e.VideoTokenNoAudioSync=207]="VideoTokenNoAudioSync",e[e.VideoTokenOther=208]="VideoTokenOther"}(p||(t.ProblemTokens=p={}));class g{constructor(e){const t=m(e);this._w=t,this._x=t/2>>>0,this._y=t/3>>>0,this._z=t/4>>>0}getNext(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y,this._y=this._z,this._z=this._w,this._w=(this._w^this._w>>>19^e^e>>>8)>>>0,this._w}}function C(e,t){const i=new g(t);for(let t=e.length-1;t>=1;t--){const o=i.getNext()%(t+1),a=e[t];e[t]=e[o],e[o]=a}}function m(e){const t=l.computeSHA256(e);return(t[0]<<24|t[1]<<16|t[2]<<8|t[3]<<0)>>>0}t.XorShift=g;const S=[p.AudioTokenNoSoundLocal,p.AudioTokenNoSoundRemote,p.AudioTokenEcho,p.AudioTokenNoise,p.AudioTokenLowSound,p.AudioTokenDropped,p.AudioTokenDistorted,p.AudioTokenInterrupted],_=[p.VideoTokenNoVideoLocal,p.VideoTokenNoVideoRemote,p.VideoTokenLowQuality,p.VideoTokenFreezing,p.VideoTokenStoppedUnexpectedly,p.VideoTokenOtherSideTooDark,p.VideoTokenNoAudioSync];function f(e,t,i){const o=t.slice(0);return C(o,e),o}},395527:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(460515),n=i(815146),s=o.__importStar(i(85385)),r=o.__importDefault(i(597285)),l=o.__importStar(i(437782)),c=o.__importDefault(i(791384));t.default=class{constructor(){this._participantReactionCallbacks={}}registerUnhandledReactionCallback(e){this._unhandledReactionCallback=e}unregisterUnhandledReactionCallback(){this._unhandledReactionCallback=void 0}registerUnhandledReactionDismissCallback(e){this._dismissUnhandledReactionCallback=e}unregisterUnhandledReactionDismissCallback(){this._dismissUnhandledReactionCallback=void 0}registerParticipantReactionCallback(e,t){s.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.registerParticipantReactionCallback key: "+l.mriOrId(e)),this._participantReactionCallbacks[e]=t}unregisterParticipantReactionCallback(e){s.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.unregisterParticipantReactionCallback key: "+l.mriOrId(e)),delete this._participantReactionCallbacks[e]}dismissReaction(e){s.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.dismissReaction key: "+l.mriOrId(e)),this._dismissUnhandledReactionCallback&&this._dismissUnhandledReactionCallback(e)}showReaction(e){c.default.shouldAnnounceForAccessibility()&&r.default.announceReaction(e.reaction);const t=e.isLocal?a.CallStageElementKeys.localUserKey:e.reaction.creator,i=e.isLocal?a.CallStageElementKeys.localUserKey:l.mriOrId(e.reaction.creator);s.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.showReaction cuid: "+e.reaction.cuid+" key: "+i+" has callback "+!!this._participantReactionCallbacks[t]),this._participantReactionCallbacks[t]&&this._participantReactionCallbacks[t](e)||this._unhandledReactionCallback&&this._unhandledReactionCallback(e)}static getTextTimeoutBasedOnContent(e){return e.length<=40?3e3:e.length<=100?4500:6e3}}},191867:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(971988));o.__importStar(i(44717));t.default=new class{getReactionsThreadPostParams(e){return{[a.MessageProperties.CastParentThreadId]:e}}}},60433:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionTokenDisposable=t.SubscriptionDisposable=void 0;const o=i(197582),a=i(174958),n=o.__importStar(i(496486)),s=o.__importStar(i(999591)),r=i(148540),l=o.__importDefault(i(974634)),c=o.__importStar(i(397691)),d=o.__importStar(i(619429)),u=o.__importStar(i(44717)),h=o.__importStar(i(766698)),p=i(815146),g=o.__importStar(i(85385)),C=o.__importDefault(i(808164)),m=i(527703),S=o.__importStar(i(437782)),_=o.__importDefault(i(655192)),f=i(843890);t.SubscriptionDisposable=class{constructor(e,t){this._token=e,this._unsubscribe=t}dispose(){if(this._token){const e=this._token;this._token=void 0,this._unsubscribe(e)}}};t.SubscriptionTokenDisposable=class{constructor(e){this._token=e}dispose(){this._token&&(this._token.unsubscribe(),this._token=void 0)}};const y=[r.CallState.LocalHold,r.CallState.RemoteHold],T=[...y,r.CallState.Connected],b=[...T,r.CallState.Connecting,r.CallState.Notified,r.CallState.EarlyMedia];class v{constructor(){this.onCallingError=new l.default,this._callBlacklist=[]}activeCallStates(){return b}connectedCallStates(){return T}onHoldCallStates(){return y}isCallStateActive(e){return n.includes(this.activeCallStates(),e)}isCallStateConnected(e){return n.includes(this.connectedCallStates(),e)}isCallStateOnHold(e){return n.includes(this.onHoldCallStates(),e)}isParticipantConnected(e){return!!e&&this.isParticipantStateConnected(e.state)}isParticipantInCanStreamMediaState(e){return(null==e?void 0:e.state)===r.ParticipantState.EarlyMedia}isParticipantStateConnected(e){return e===r.ParticipantState.Connected||e===r.ParticipantState.OnHold}isParticipantRinging(e,t=!0){return e&&this.isParticipantStateRinging(e.state,t)}isParticipantStateRinging(e,t=!0){return t&&e===r.ParticipantState.Connecting||e===r.ParticipantState.Ringing}isParticipantOnHold(e){return e&&e.state===r.ParticipantState.OnHold}isParticipantTalking(e){return e&&e.voiceLevel>0}isParticipantMuted(e){return e&&e.isServerMuted}isPstnNetherlandsReason(e){return!!e&&480===e.callControllerCode&&213432===e.callControllerSubCode}participantMris(e){const t=u.asMri(e.id);return{default:(e.acceptedBy&&e.acceptedBy!==e.id?v._normalizeForwardedEndpoint(u.asMri(e.acceptedBy)):void 0)||t,original:t}}static _normalizeForwardedEndpoint(e){if(!u.isPhoneMri(e))return e;const t=u.splitMri(e),i=C.default.getNormalizedPhoneNumber(t.id);return i?u.sanitizeMri(i,t.namespace):e}conversationLiveStateFromCastNotification(e){if(!e)return void g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: undefined");const t=this._uncompressPayload(e),i=t&&n.attempt((()=>atob(t)));if(!i||n.isError(i))return void g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: "+_.default.errorAsString(i),a.pii.Omit(e||""));const o=_.default.parseJsonErrorToUndefined(i);if(o&&!n.isError(o))return o.groupCallInitiator&&(o.groupCallInitiator=u.sanitizeMri(o.groupCallInitiator,u.Namespaces.SkypeId)),o;g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing rawData: "+_.default.errorAsString(o),a.pii.Omit(i||""))}blacklistCallId(e,t){n.includes(this._callBlacklist,e)||(g.log(p.LogTraceArea.Calling,"Blacklisting callId: "+e+" causeId: "+t),this._callBlacklist.push(e))}isLiveStateValid(e){return!this.invalidLiveStateError(e)}invalidLiveStateError(e){return e?"Active"!==e.status?("InActive"===e.status&&g.warn(p.LogTraceArea.Calling,"Got non-null inactive live state "+a.pii.Omit(JSON.stringify(e))),"Status of call is "+e.status):e.expiration?1e3*e.expiration<Date.now()?"Expired with Active status":e.conversationId&&e.conversationUrl?n.includes(this._callBlacklist,e.conversationId)?"Call ID has been blacklisted":u.isMri(e.conversationUrl)&&u.isEncryptedThread(e.conversationUrl)?"Call is encrypted":void 0:"Missing call ID or conversation URL":"Missing expiration":"No live state found"}isLiveStateForGoLive(e){return!!e&&"cast"===e.conversationType}isLiveStateValidAndForGoLive(e){return!!this.isLiveStateValid(e)&&this.isLiveStateForGoLive(e)}incomingCallNotificationForFlamingo(e){let t,i;if(e.content){const o=_.default.parseJsonErrorToUndefined(e.content);o&&(o.cp&&(t=this._uncompressPayload(o.cp)),i=o.callId)}const o=u.getParsedConversationId(e),a=parseInt(e.eventId,10);return{evt:a,gp:t,gpc:e.content,nsp:void 0,displayName:void 0,callId:e.skypeguid||i,conversationMri:v._maybeSanitizeMri(e.conversationId||e.imdisplayname||o,a),callerMri:v._maybeSanitizeMri(e.imdisplayname,a),participantId:e.skypeguid,videoCall:"true"===e.isVideoCall,encryptedKey:void 0,recipientId:void 0}}incomingCallNotificationForPnh(e,t){let i;return t.servicePayload&&t.servicePayload.cp&&(i=this._uncompressPayload(t.servicePayload.cp)),{evt:e,gp:i,gpc:JSON.stringify(t.servicePayload),nsp:void 0,displayName:t.displayName,callId:t.callId,conversationMri:v._maybeConvertToEncryptedThread(v._maybeSanitizeMri(t.convoId,e),e),callerMri:v._maybeSanitizeMri(t.callerId,e),participantId:t.participantId,videoCall:"true"===t.videoCall,encryptedKey:t.encryptedKey,recipientId:v._maybeSanitizeRecipientId(t.recipientId)}}incomingGoLivelNotificationForPnh(e,t){const i=this.conversationLiveStateFromCastNotification(t.castContext);if(i)return{evt:e,callId:t.callId,callerMri:v._maybeSanitizeMri(i.groupCallInitiator,e),conversationMri:v._maybeSanitizeMri(t.threadId,e),recipientId:v._maybeSanitizeRecipientId(t.recipientId),conversationLiveState:i,participantId:void 0};g.warn(p.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(t)))}stopGoLiveNotificationForPnh(e,t){return{evt:e,callId:t.callId,conversationMri:v._maybeSanitizeMri(t.threadId,e),recipientId:v._maybeSanitizeRecipientId(t.recipientId),participantId:void 0}}incomingGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt,i=this.conversationLiveStateFromCastNotification(e.body.castContext);if(i)return{evt:t,callId:e.body.callId,callerMri:v._maybeSanitizeMri(i.groupCallInitiator,t),conversationMri:v._maybeSanitizeMri(e.body.threadId,t),recipientId:v._maybeSanitizeRecipientId(e.body.recipientId),conversationLiveState:i,participantId:void 0};g.warn(p.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(e.body)))}stopGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,callId:e.body.callId,conversationMri:v._maybeSanitizeMri(e.body.threadId,t),recipientId:v._maybeSanitizeRecipientId(e.body.recipientId),participantId:void 0}}_uncompressPayload(e){const t=h.base64StringToUint8Array(e);if(!t)return void g.warn(p.LogTraceArea.Calling,"_uncompressPayload: Couldn't un-base64 call data");const i=s.inflate(t);return h.Uint8ArrayToBase64String(i)}stopCallNotificationForPnh(e,t){return{evt:e,reason:t.reason,callId:t.callId,conversationMri:v._maybeSanitizeMri(t.conversationId,e),callerMri:v._maybeSanitizeMri(t.callerMri,e),participantId:t.participantId,recipientId:v._maybeSanitizeRecipientId(t.recipientId)}}stopCallNotificationForPermission(e){return{evt:e.evt,callId:e.callId,participantId:e.participantId,conversationMri:e.conversationMri,callerMri:e.callerMri,reason:"RejectedDueToNoMicPermission",recipientId:e.recipientId}}incomingCallNotificationForTrouter(e){let t;t=e.body.servicePayload&&e.body.servicePayload.cp?this._uncompressPayload(e.body.servicePayload.cp):e.body.gp;const i=e.eventId||e.body.evt;return{evt:i,gp:t,gpc:e.body.servicePayload?JSON.stringify(e.body.servicePayload):void 0,nsp:void 0,displayName:e.body.displayName,callId:e.body.callId,conversationMri:v._maybeConvertToEncryptedThread(v._maybeSanitizeMri(e.body.convoId||e.body.conversationId,i),i),callerMri:v._maybeSanitizeMri(e.body.callerId||e.body.callerMri,i),participantId:e.body.participantId,videoCall:"boolean"==typeof e.body.videoCall?e.body.videoCall:"true"===e.body.videoCall,encryptedKey:e.body.encryptedKey,recipientId:v._maybeSanitizeRecipientId(e.body.recipientId)}}stopCallNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,reason:e.body.reason,callId:e.body.callId,conversationMri:v._maybeSanitizeMri(e.body.convoId||e.body.conversationId,t),callerMri:v._maybeSanitizeMri(e.body.callerId||e.body.callerMri,t),participantId:e.body.participantId,recipientId:v._maybeSanitizeRecipientId(e.body.recipientId)}}incomingCallNotificationForP2PPnh(e){const t=e.eventType;return{evt:t,displayName:e.displayName,callId:e.callId,conversationMri:v._maybeSanitizeMri(e.convoId,t),callerMri:v._maybeSanitizeMri(e.callerId,t),participantId:e.participantId,videoCall:"true"===e.videoCall,recipientId:v._maybeSanitizeRecipientId(e.recipientId)}}static _maybeSanitizeMri(e,t){const i=v._getCallerNamespaceForCallEvent(e,t);return e?u.sanitizeMri(e,i):void 0}static _maybeConvertToEncryptedThread(e,t){return t===m.PNHEvents.IncomingNGCEncryptedCall&&e&&!u.isEncryptedThread(e)?u.buildOneOnOneEncryptedThreadId(e):e}static _maybeSanitizeRecipientId(e){return e?u.sanitizeMri(e,u.Namespaces.SkypeId):void 0}buildNGCCallPayload(e,t,i,o,s,r){var l,c,d;const u=e.gp;if(!u)return void g.error(p.LogTraceArea.Calling,`buildNGCCallPayload: Error when decoding gp payload: undefined causeId: ${r}`);const h=n.attempt((()=>atob(u)));if(!h||n.isError(h))return void g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when decoding gp payload: "+_.default.errorAsString(h)+" causeId: "+r+" "+a.pii.Omit(u));const C=_.default.parseJsonErrorable(h);if(C&&!n.isError(C)){if(C.callNotification)return{conversationId:e.conversationMri||(null===(l=C.groupChat)||void 0===l?void 0:l.threadId)||C.callNotification.from.id,messageId:null===(c=C.groupChat)||void 0===c?void 0:c.messageId,callerId:e.callerMri||C.callNotification.from.id,convoCallId:e.callId||C.debugContent.callId,isMultiParty:Boolean(null===(d=C.conversationInvitation)||void 0===d?void 0:d.isMultiParty),fromMixer:C.callNotification.fromMixer,ngcCall:!0,body:{evt:e.evt,nsp:e.nsp||"",gp:f.CallingCapabilities.isPluginlessCallingStack()?e.gp||"":e.gpc||e.gp||""},videoCall:e.videoCall,launchTime:i,pushReceivedTime:o.pushReceivedTime,registrationId:s||"",callKey:t,participantId:e.participantId,connectionType:o.connectionType};g.log(p.LogTraceArea.Calling,`Unable to create incoming NGC payload ${r}`)}else g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when parsing gp payload: "+_.default.errorAsString(C)+" causeId: "+r+" "+a.pii.Omit(h))}static _getCallerNamespaceForCallEvent(e,t){if(e&&u.isMri(e))return u.getMriNamespace(e);switch(t){case m.PNHEvents.IncomingNGCCall:case m.PNHEvents.IncomingP2PCall:case m.PNHEvents.IncomingNGCGroupCall:case m.PNHEvents.IncomingNGCEncryptedCall:return u.Namespaces.SkypeId;case m.PNHEvents.IncomingNGCPSTNCall:return u.Namespaces.PSTN;case m.PNHEvents.IncomingS4BCall:return u.Namespaces.S4B_Bridge;case m.PNHEvents.IncomingNGCStopRinger:return C.default.isPossiblyPhoneNumber(e)?u.Namespaces.PSTN:u.Namespaces.SkypeId;default:return u.Namespaces.SkypeId}}getMediaPeerTypeForIncomingCall(e){switch(e){case m.PNHEvents.IncomingS4BCall:case m.PNHEvents.IncomingNGCCall:case m.PNHEvents.IncomingNGCEncryptedCall:return r.MediaPeerType.ConsumerTwoParty;case m.PNHEvents.IncomingNGCGroupCall:return r.MediaPeerType.ConsumerPstn;case m.PNHEvents.IncomingNGCPSTNCall:default:return r.MediaPeerType.ConsumerMultiParty}}isValidCallingMri(e){if(!e)return!1;if(!u.isMri(e))return!1;switch(u.getMriNamespace(e)){case u.Namespaces.S4B_Bridge:case u.Namespaces.PSTN:case u.Namespaces.SkypeId:case u.Namespaces.Thread:case u.Namespaces.Bot:return!0;default:return!1}}extractMriFromKey(e,t=!1){if(u.isMri(e))return t?S.mriOrId(e):e;const i=["ss_","video_","icon_"];for(let o=0;o<i.length;++o)if(n.startsWith(e,i[o])){const a=e.substring(i[o].length);if(u.isMri(a))return t?`${i[o]}${S.mriOrId(a)}`:a}return t?a.pii.Omit(e):e}sanitizeCallStartOptions(e){return n.mapValues(n.clone(e),((e,t)=>"callKey"===t||"encryptedKey"===t?e?"yes":"no":"label"===t?a.pii.Omit(e):e))}validateIncomingCallNotificationBody(e){return!!e.conversationMri&&(u.isEncryptedThread(e.conversationMri)?!!e.encryptedKey:!e.encryptedKey)}validateOutgoingCall(e,t){return!u.isEncryptedThread(e)||!t.withVideo&&!!t.ringOthers}validateOutgoingCallParticipants(e,t){return!e.ringOthers||t.length>0}generateCallingError(e,t,i,o,a,n,s){const r=new d.CallingError(e,t,i,o,a,n,s);return g.warn(p.LogTraceArea.Calling,`[CallingUtils] generateCallingError for callId: ${e}, action: ${t}, message: ${i} terminatedReason: ${o}, failureType: ${a} validationReason: ${n}`+(s?`, causeId: ${s}`:"")),this.onCallingError.fire(r),c.Rejected(r)}maybeCallingErrorAsString(e){const t=e.action,i=e.terminatedReason,o=e.failureType,a=e.validationReason?d.CallValidationFailureReason[e.validationReason]:void 0,n=e.message;if(!(t||i||o||a))return{message:_.default.errorAsString(e),isCallingError:!1};return{message:"callId: "+e.callId+"action: "+t+" terminatedReason: "+i+" failureType: "+o+" validationFailureReason: "+a+" message: "+n,isCallingError:!0}}validateParametersPromise(e,t,i,o,a){return this.validateParameters(e,t,o,a)?c.Resolved():this.generateCallingError(e,i,"Parameter validation failed for "+t+" ("+i+")",r.TerminatedReason.BadRequest,r.FailureType.CallSetupFailed,d.CallValidationFailureReason.InvalidParameters,o)}validateParameters(e,t,i,o){let a=!0;return n.each(o,(o=>{const n=n=>{const s="Failed to validate parameter "+S.mriOrId(o.param)+" in method ["+t+"] callId: "+e+" causeId: "+i+(n?", error "+_.default.errorAsString(n):"");g.error(p.LogTraceArea.Calling,s),a=!1};try{o.check()||n()}catch(e){n(e)}})),a}isEventTypeTriggeringMuteAction(e){return n.includes([d.CallDeviceQualityEventType.DeviceEcho,d.CallDeviceQualityEventType.DeviceMultipleEndpoints,d.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected],e)}}t.default=new v},888870:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialerSearchUtils=void 0;const o=i(197582).__importStar(i(496486));t.DialerSearchUtils=class{static sortByDisplayName(e){return o.sortBy(o.values(e),(e=>e.contact.displayName))}static getSearchCriteria(e,t=!1){return 0!==e.inputValue.indexOf("+")&&t||o.isEmpty(e.E164)?e.inputValue:e.E164}}},510130:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importDefault(i(119557)),n=i(460515),s=o.__importStar(i(704704)),r=i(641400);t.default=class{static getViewInformationForAudioRouting(e){let t;switch(e){case a.default.AudioOutputEarpiece:t=s.getString("CallPanel.EarpieceWarning");break;case a.default.AudioOutputSpeaker:t=s.getString("CallPanel.SpeakerWarning");break;case a.default.AudioOutputBluetooth:t=s.getString("CallPanel.BluetoothWarning");break;case a.default.AudioOutputWiredHeadset:t=s.getString("CallPanel.HeadsetWarning");break;default:return}return{warningText:t,warningViewType:n.InCallWarningViewType.Audio}}static getViewInformationForAudioMuted(e,t){if((e||t)&&(e||t)){let i,o;return t&&e?(i=void 0,o=s.getString("CallPanel.SpeakerAndMicrophoneMuted")):t?(i=r.SkypeIcon.VolumeOff,o=s.getString("CallPanel.SpeakerMuted")):e&&(i=r.SkypeIcon.MicrophoneOff,o=s.getString("CallPanel.MicrophoneMuted")),o?{warningText:o,icon:i,warningViewType:n.InCallWarningViewType.Audio}:void 0}}static getViewInformationForVoicemail(){return{warningText:s.getString("CallPanel.RecordingVoicemail"),warningViewType:n.InCallWarningViewType.Voicemail}}static getViewInformationForForwarding(){return{warningText:s.getString("CallPanel.CallForwarding"),warningViewType:n.InCallWarningViewType.Forwarding}}}},831890:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582).__importStar(i(85385)),a=i(247896);t.default=class{static registerOpenAction(e,t,i){o.track(new a.ExperimentOpenAction(e,t,i))}static registerDialerButtonClickAction(e,t,i){o.track(new a.ExperimentButtonClickAction(a.NavigateToDestination.DialerPanel,e,t,i))}static registerBalanceStateButtonClickAction(e,t,i){o.track(new a.ExperimentButtonClickAction(a.NavigateToDestination.BalanceStatePanel,e,t,i))}static registerCallButtonClickAction(e,t){o.track(new a.ExperimentButtonClickAction(a.NavigateToDestination.GroupCall,e,t))}static registerCloseButtonClickAction(e,t,i){o.track(new a.ExperimentBannerCloseAction(e,t,i))}}},808164:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberFormat=void 0;const o=i(197582),a=i(174958),n=i(93791),s=o.__importStar(i(496486)),r=i(815146),l=o.__importStar(i(85385)),c=o.__importStar(i(704704)),d=o.__importDefault(i(655192)),u=o.__importDefault(i(139221)),h=i(331079),p=o.__importDefault(i(760989)),g=/[^0-9\.\+]+/g,C=/(,+(.*))/;let m;var S;!function(e){e[e.E164=1]="E164",e[e.INTERNATIONAL=2]="INTERNATIONAL",e[e.NATIONAL=3]="NATIONAL",e[e.RFC3966=4]="RFC3966"}(S||(t.PhoneNumberFormat=S={}));class _{static isPossibleNumber(e,t){return _._getInstance().isPossibleNumberString(e,t||u.default.getCountryCode())}static getRegionCodeForNumber(e){try{return e?_._getInstance().getRegionCodeForNumber(e):void 0}catch(t){return void l.error(r.LogTraceArea.Phone,"PhoneUtils.getRegionCodeForNumber: Failed to get region code for number "+a.pii.Omit(e?e.getRawInput():"")+" - "+d.default.errorAsString(t))}}static getCountryCodeForRegion(e){return _._getInstance().getCountryCodeForRegion(e)}static isValidNumberString(e){return _.isValidNumber(_.parse(e))}static isValidNumber(e){return!!e&&_._getInstance().isValidNumber(e)}static parseAndFormat(e,t,i){const o=_.parse(e,i);if(o&&_._getInstance().isValidNumber(o))return _.format(o,t)}static parse(e,t){try{return _._getInstance().parse(e,t)}catch(e){return}}static parseAndKeepRawInput(e,t){try{return _._getInstance().parseAndKeepRawInput(e,t)}catch(t){return void l.error(r.LogTraceArea.Phone,"PhoneUtils.parseAndKeepRawInput: Failed to parse phone number "+a.pii.Omit(e)+" - "+d.default.errorAsString(t))}}static format(e,t){return t?_._getInstance().format(e,_._getGoogleFormat(t)):_._getInstance().format(e)}static formatNumberWithType(e){const t=_.getStringForPhoneType(e.type);let i=e.number;try{const t=_._getInstance().parse(e.number);i=_._getInstance().format(t,n.PhoneNumberFormat.INTERNATIONAL)}catch(e){}return c.getString("PhoneUtils.PhoneFormat",{type:t,number:i})}static getMatchedPhoneNumber(e,t){if(e&&0!==e.length)return s.find(e,(e=>e.number.indexOf(t)>-1))}static getStringForPhoneType(e){switch(e){case h.PhoneNumberTypes.Home:return c.getString("PhoneUtils.PhoneHome");case h.PhoneNumberTypes.Mobile:return c.getString("PhoneUtils.PhoneMobile");case h.PhoneNumberTypes.Office:return c.getString("PhoneUtils.PhoneOffice");case h.PhoneNumberTypes.Other:return c.getString("PhoneUtils.PhoneOther");default:return p.default.switchStatementExhaustiveChecking(e)}}static convertLabelToPhoneType(e){if(!e)return h.PhoneNumberTypes.Other;switch(e.toLowerCase()){case"mobile":return h.PhoneNumberTypes.Mobile;case"office":return h.PhoneNumberTypes.Office;case"home":return h.PhoneNumberTypes.Home;default:return h.PhoneNumberTypes.Other}}static getNormalizedPhoneNumber(e,t=!0){let i=e.trim();if(t&&(i=_.convertPhoneLetters(i),i=i.replace(g,""),0===i.length))return"";let o=u.default.getCountryCode();if(!o){const e=c.getLocale().split("-");e instanceof Array&&e.length>1&&(o=e[1])}i=_.convert00ToPlus(i);let a=_.parse(i,o);return a&&_.isValidNumber(a)?_.format(a,S.E164):a&&s.startsWith(i,"+")?i:s.startsWith(i,"+")?void 0:(a=_.parse("+"+i),a&&_.isValidNumber(a)?_.format(a,S.E164):i)}static normalizePartialNumberWithCountryCode(e){let t=e.replace(g,"");if(0===t.length)return"";const i=u.default.getCountryCode();if(t=_.convert00ToPlus(t),!s.startsWith(t,"+")&&i)try{const e=_._getInstance().getCountryCodeForRegion(i);return _.compilePhoneNumber(t,e)}catch(e){return l.warn(r.LogTraceArea.Phone,"PhoneUtils: Unable to get country code for countryCode: ",a.pii.Omit(i)),t}return t}static convert00ToPlus(e){return s.startsWith(e,"00")?"+"+e.substring(2):e}static compilePhoneNumber(e,t){return"+"+t+e}static stripSpecialChars(e){return e.replace(g,"")}static stripPossibleExtension(e){return e.replace(C,"")}static getPossibleExtension(e,t){const i=e.match(C),o=t?1:2;return i&&i[o]?i[o]:void 0}static isPossiblyPhoneNumber(e){return!!e&&(e.startsWith("+")&&(e=e.slice(1)),!isNaN(parseInt(e,10)))}static stripPlusSign(e){return e&&e.length>0&&"+"===e[0]?e.substring(1):e}static _getInstance(){return m||(m=n.PhoneNumberUtil.getInstance()),m}static _getGoogleFormat(e){switch(e){case S.E164:return n.PhoneNumberFormat.E164;case S.INTERNATIONAL:return n.PhoneNumberFormat.INTERNATIONAL;case S.NATIONAL:return n.PhoneNumberFormat.NATIONAL;case S.RFC3966:return n.PhoneNumberFormat.RFC3966}}static convertPhoneLetters(e){e=e.toLowerCase();let t="";const i=s.startsWith(e,"+");return s.each(e.split(""),(e=>{switch(e){case"0":t+="0";break;case"1":t+="1";break;case"2":case"a":case"b":case"c":t+="2";break;case"3":case"d":case"e":case"f":t+="3";break;case"4":case"g":case"h":case"i":t+="4";break;case"5":case"j":case"k":case"l":t+="5";break;case"6":case"m":case"n":case"o":t+="6";break;case"7":case"p":case"q":case"r":case"s":t+="7";break;case"8":case"t":case"u":case"v":t+="8";break;case"9":case"w":case"x":case"y":case"z":t+="9"}})),i&&(t="+"+t),t}static getPhoneNumberDetails(e){const t={isValidNumber:!1,possibleCountry:""};if(e){const i=_.parseAndKeepRawInput(e);t.possibleCountry=_.getRegionCodeForNumber(i),t.isValidNumber=_.isValidNumber(i)}return t}}t.default=_},73711:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(397691)),s=o.__importStar(i(760053)),r=i(815146),l=o.__importStar(i(85385));t.default=new class{shouldPresentScheduleNextCallPanel(e,t,i,o,n){if(!a.isEmpty(t))return l.log(r.LogTraceArea.ScheduleCall,"shouldPresentScheduleNextCallPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1;const s=e.durationSeconds>n.scheduleNextCallDurationSeconds,c=o>=n.scheduleNextCallFrequency,d=i<n.maxScheduleNextCallDisplays;return!!(s&&c&&d&&e.isCallCreator)}shouldPresentCallQualityFeedbackPanel(e,t,i,o,c){return a.isEmpty(t)?o?(l.log(r.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing because of forceCQF"),n.Resolved(!0)):s.shouldTriggerForCall(e.callInfo,i,c).then((t=>(t&&l.log(r.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing for "+e.callInfo.callId+" because of ECS"),t))):(l.log(r.LogTraceArea.CallQualityFeedback,"shouldPresentCallQualityFeedbackPanel: skipping for "+e.callInfo.callId+" because other calls are active "+JSON.stringify(t)),n.Resolved(!1))}shouldPresentPermissionPanel(e,t){return!!a.isEmpty(t)||(l.log(r.LogTraceArea.CallMonitor,"shouldPresentPermissionPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1)}shouldPresentCallerIdPanel(e){return a.isEmpty(e)}}},597285:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(516778)),s=o.__importStar(i(317588)),r=o.__importDefault(i(150343)),l=i(460515),c=o.__importStar(i(591312)),d=o.__importStar(i(971988)),u=o.__importDefault(i(734468)),h=o.__importStar(i(463519)),p=o.__importDefault(i(601976)),g=o.__importDefault(i(794229)),C=i(815146),m=o.__importStar(i(85385)),S=o.__importStar(i(704704)),_=o.__importDefault(i(252089)),f=o.__importDefault(i(363091)),y=o.__importDefault(i(655192)),T=o.__importDefault(i(759664)),b=i(331079),v=["cid","sender","receivers","message"];class I{static imageForSticker(e){switch(e.toLowerCase()){case"sticker1":return s.Collection.CAPTURE_STICKER1;case"sticker8":return s.Collection.CAPTURE_STICKER8;case"sticker17":return s.Collection.CAPTURE_STICKER17;case"sticker20":return s.Collection.CAPTURE_STICKER20;case"sticker22":return s.Collection.CAPTURE_STICKER22;case"sticker29":return s.Collection.CAPTURE_STICKER29;case"sticker31":return s.Collection.CAPTURE_STICKER31;case"sticker32":return s.Collection.CAPTURE_STICKER32;default:return s.Collection.CAPTURE_STICKER33}}static stickerKeyForText(e){switch(e){case"omg":return"STICKER31";case"snap":return"STICKER33";case"awesome":return"STICKER8";case"BRB":return"STICKER1";case"hello":return"STICKER29";case"oops":return"STICKER22";case"yes":return"STICKER17";case"ouch":return"STICKER20";case"wow":return"STICKER32"}}static textForImageSticker(e){switch(e){case"STICKER31":return"omg";case"STICKER33":return"snap";case"STICKER8":return"awesome";case"STICKER1":return"BRB";case"STICKER29":return"hello";case"STICKER22":return"oops";case"STICKER17":return"yes";case"STICKER20":return"ouch";case"STICKER32":return"wow"}}static localizedAccessibilityTextForImageSticker(e){switch(e){case"STICKER31":return S.getString("Sticker.OMGAccessibilityLabel");case"STICKER33":return S.getString("Sticker.SnapAccessibilityLabel");case"STICKER8":return S.getString("Sticker.AwesomeAccessibilityLabel");case"STICKER1":return S.getString("Sticker.BRBAccessibilityLabel");case"STICKER29":return S.getString("Sticker.HelloAccessibilityLabel");case"STICKER22":return S.getString("Sticker.OopsAccessibilityLabel");case"STICKER17":return S.getString("Sticker.YesAccessibilityLabel");case"STICKER20":return S.getString("Sticker.OuchAccessibilityLabel");case"STICKER32":return S.getString("Sticker.WowAccessibilityLabel")}}static messageToReactionsEmoticonLocalizedAccesssibilityString(e){const t=e.getEmoticonCallReactionKey();return t?this.localizedAccessibilityTextForEmoticon(t):void 0}static localizedAccessibilityTextForEmoticon(e){const t=g.default.getEmoticonByNameNoSubscription(e);return(null==t?void 0:t.description)||e}static isAnimationReaction(e){return"cake"===e}static isSuperAnimationReaction(e){return a.includes(r.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsKeys,e)}static superAnimationReactionsNumber(e){let t=0;return a.each(e,(e=>{this.isSuperAnimationReaction(e)&&t++})),t}static isTranscriptionReaction(e){const t=y.default.parseJsonErrorToUndefined(e.content);return t&&a.every(v,(e=>e in t))}static isCallEventReaction(e){const t=h.decode(e),i=a.last(t.children);if(!i.getInternalType)return!1;const o=i.getInternalType()&&i.getInternalType()||b.ReactionsTextType.Default;return!!i.getUserMri()&&a.includes([b.ReactionsTextType.CallEventMuted,b.ReactionsTextType.CallEventKickedOut,b.ReactionsTextType.CallEventTransfer,b.ReactionsTextType.CallEventKickedOutOwn],o)}static animationInfoForKey(e,t){switch(e){case"beer":return T.default.BEER;case"cake":return t?T.default.CELEBRATION_ICBC:T.default.CELEBRATION_ICBC_PORTRAIT;case"clap":return T.default.CLAP;case"dropthemic":return T.default.DROPTHEMIC;case"facepalm":return T.default.FACEPALM;case"fire":return T.default.FIRE;case"heart":return T.default.HEART;case"highfive":return T.default.HIGHFIVE;case"laugh":return T.default.LAUGH;case"mistletoe":return T.default.MISTLETOE;case"penguin":return T.default.PENGUIN;case"rudolfsurprise":return T.default.RUDOLFSURPRISE;case"sad":return T.default.SAD;case"sarcastic":return T.default.SARCASTIC;case"snowflake":return T.default.SNOWFLAKE;case"surprised":return T.default.SURPRISED;case"xmascwl":return T.default.XMASCWL;case"xmasyes":return T.default.XMASYES;case"yes":return T.default.YES}}static announceReaction(e){const t=p.default.getDisplayableProfile(e.creator);let i,o,s=!0;if(e.isEmoticonCallReaction())i=I.messageToReactionsEmoticonLocalizedAccesssibilityString(e);else{const t=h.decode(e),n=a.last(t.children),r=a.first(t.children);if(o=n.getStyle?n.getStyle():void 0,o===b.ReactionsTextStyle.Sticker){if(r.getRawText?r.getRawText():void 0){const e=I.stickerKeyForText(r.getRawText());i=e&&I.localizedAccessibilityTextForImageSticker(e)}}else{if(r.children.length){const e=a.first(r.children);e.getRawText&&(i=e.getRawText())}else r.getRawText&&(i=r.getRawText());s=!1}}if(i){if(s){let e;e=o===b.ReactionsTextStyle.Snapshot?i:S.getString("AccessibilityLabel.Reactions1User",{firstUser:t.getShortName(),reactionName:i}),n.Accessibility.announceForAccessibility(e)}}else m.warn(C.LogTraceArea.CallReactions,"ReactionsEmojiStream._updateReactionsAndReturnState Unsupported reaction emoticon/sticker or empty text")}static callReactionInfoForReaction(e){const t=h.decode(e),i=a.last(t.children),o=d.getMessageTypeGroup(e),n=i.getStyle&&i.getStyle()||b.ReactionsTextStyle.Default;let s;if(!e.isEmoticonCallReaction()&&o===d.MessageTypeGroups.Text){const i=a.first(t.children);let o;if(o=c.renderText(t,{skipAuthor:!0}),i.children.length){const e=a.first(i.children);e.getRawText&&(o=e.getRawText())}else i.getRawText&&(o=i.getRawText());if(n===b.ReactionsTextStyle.Sticker&&o){const e=I.stickerKeyForText(o);e&&(s=I.imageForSticker(e))}else if(n===b.ReactionsTextStyle.Snapshot){const t=p.default.getDisplayableProfile(e.creator);s=S.getString("CallPanel.SnapshotNotification",{name:t.getShortName()})}else s=o}const r=f.default.isMyMri(e.creator);return{reaction:e,reactionsTextStyle:n,gradientColors:r?_.default.getGradientColors():u.default.getGradientColors(e.creator),isLocal:r,content:s}}static parseCallEventReaction(e){const t=h.decode(e),i=a.last(t.children);if((i.getStyle&&i.getStyle()||b.ReactionsTextStyle.Default)===b.ReactionsTextStyle.CallEvent){const t=i.getInternalType()&&i.getInternalType()||b.ReactionsTextType.Default,o=i.getUserMri();if(o)return{mri:e.creator,actionMri:o,eventType:t}}}}I.reactionItems=[{key:"heart",type:l.ReactionsItemType.Emoticon},{key:"STICKER32",type:l.ReactionsItemType.Sticker},{key:"cwl",type:l.ReactionsItemType.Emoticon},{key:"STICKER8",type:l.ReactionsItemType.Sticker},{key:"sad",type:l.ReactionsItemType.Emoticon}],t.default=I},494190:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(815146),n=i(477195),s=o.__importDefault(i(139221)),r=i(331079),l=i(136464),c={enableAndroidNativeIncomingCallNotifications:!1,enableAndroidNativeIncomingGroupCallNotifications:!1,enableElectronIntegratedCalling:!1,enableStreamVideo:!1,enableAdaptiveCameraContentScale:!1,resumableUploads:{enabled:!0,types:["Video","VideoMessage"]},mobilePreviewPercentage:.2,enableMissedCallbackReminderAppActive:!1,enableIncomingVideoNotification:!1,enableNewIncomingVideoSound:!1,enableTestCalls:!1,maximumGroupSizeRing:25,maximumGroupSizeGoLive:250,maximumGroupSizeRinglessCall:50,maxRecordingMs:18e4,videoWidth:640,videoHeight:360,videoBitrate:1300,enableMsnpFlamingoMessages:!0,translatorAgentId:"28:0d5d6cff-595d-49d7-9cf8-973173f5233b",videoProfile:1,enableVideoBFrame:!1,videoReEncodeKeyFrameSec:1,optimizeVideoForNetwork:!1,captureStopDelayMs:1e4,cameraVersion:1,enableSimpleTextReactions:!1,enableHDVideo:!1,androidCallMonitorConfig:{permissionPromptMaxDisplayCount:3,permissionPromptResetIntervalSeconds:2419200},enableBatteryOptimizationNotification:!1,enableBatteryOptimizationNotificationV2:!0,enableBufferSharing:!1,callRecorderBotMri:"28:0ad9717e-76fd-4658-a764-beaf21698977",callRecorderBotMriFilter:["28:0ad9717e-76fd-4658-a764-beaf21698977","28:56fc6434-1e40-4e9e-ace2-373ce28cfba4"],callRecorderRetentionDurationDays:30,callReactionsBarButtonConfig:{mobile:[["Moments"],["Reactions"]],tablet:[["Chat","Moments"],["Gallery","Reactions"]]},enablePhotoSharingCoachMark:!1,enableCallTechnicalInformation:!1,callReactionButtonKey:"heart",callCelebrationConfig:{callCelebrateButtonKey:"cake"},callAnimatedReactionsConfig:{callAnimatedReactionsKeys:["beer","clap","dropthemic","facepalm","fire","heart","highfive","laugh","mistletoe","penguin","rudolfsurprise","sad","sarcastic","snowflake","surprised","xmascwl","xmasyes","yes","cake"],callAnimatedReactionsTimeoutsinMs:{beer:3e3,cake:3750,clap:2e3,default:3e3,fire:3600,heart:2e3,laugh:2e3,penguin:6300,rudolfsurprise:3e3,sad:2e3,sarcastic:2e3,snowflake:5e3,surprised:2e3,yes:2e3}},enableGifCaptureLoadingIndicator:!1,allowIncomingCallsWithExpiredToken:!1,enableAddToCallRibbonCoachMark:!1,enableNDISetting:s.default.isElectronOsx()||s.default.isElectronWindows(),learnMoreNDILink:"https://www.newtek.com/blog/tips/using-ndi-in-skype/",broadcastTermsOfServiceUrl:"https://www.skype.com/{lang}/legal/broadcast/",enableMessageTranslation:!1,enableOneMessageTranslationDiscardUnwanted:!1,translatorBotDeprecationDate:"31/12/2019",enableTranslatorBotDeprecation:!1,messageTranslatorEndpointUrl:"https://translatorv2.skype.com/api/v1/text.translation",callCaptionsEnableTranslatedVoiceOption:!1,isCallCaptionsCleanupEnabled:!1,callCaptionsCleanupBatchSize:1e3,callCaptionsCleanupValidDate:"",callCaptionsClearTimeout:7e3,callCaptionsMaxHistory:100,callCaptionsEnableSubtitleLanguageOption:!1,isInterimCaptionConcatenated:!1,isInterimCaptionHighlightEnabled:!1,callCaptionsStartImmediateTrigger:!1,callCaptionsMerge:!0,callCaptionsHideSpokenLangInSettings:!0,callCaptionsPositionModeDefault:n.CaptionsPositionMode.float,callCaptionsSettingsShowHistory:!1,callCaptionsSendToInteropHook:!1,callCaptionsScrolling:{allowStopScrolling:!0,allowScrollingAnimation:!1,stopScrollingThreshold:50,scrollingCallbackDebounce:100,jumpToAndButtonDisplayDelay:300},callCaptionsFloatPanel:{enabled:!0,desktopSizePercentage:.3,mobileSizePercentage:.35,letterSpacingWindows:0,limit:10,timeout:7e3},callCaptionsBottomPanel:{enabled:!0,desktopSizePercentage:.2,mobileSizePercentage:.4,captionsWidthDesktopPercentage:.9,limit:20,timeout:0},callCaptionsLeftPanel:{enabled:!0,desktopSizePercentage:.25,captionsWidthDesktopPercentage:.95,limit:50,timeout:0},callTranslatorBotConfig:{enabledTranslatorOneOnOneCall:!1,enabledTranslatorOneOnOnePstnCall:!1,enabledTranslatorGroupCall:!1,hideInRoster:!0,botMri:"28:5dad43e6-3db1-435f-b8ee-7b0a759c658f",botMriFilter:["28:9f6cbb6e-083f-4b96-bcfa-802488dcf40e","28:d96d5a9f-c9ae-41af-9187-e213d456041f","28:29a41b3a-90e7-4d23-9d24-afe4dee2e4e7","28:52b0c63e-a675-4e38-b8fb-b373d96ec315","28:f15ea256-e453-4b87-810e-6fabc0a6fdb3","28:f4c739a9-9d32-45a9-bb93-bfb955b30270","28:5dad43e6-3db1-435f-b8ee-7b0a759c658f"],service:{id:"skype.tx",version:1},languageSupport:{speech:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"],tts:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"]},translatorBotClientTimeoutMs:5e3},pstnTranslation:{enabled:!1,showToast:!0,privacyLink:"https://go.skype.com/privacy",useAlertDialogOnDesktop:!1,translationSettingsHideTimeout:5e3,captionsLimit:50,captionsTimeout:0},skypeTranslation:{enabled:!1,privacyLink:"https://go.skype.com/privacy",variantB:!1},translationFeatures:{showInSettings:!0,enableConsentListener:!0,consentButtonsSameColor:!1,truVoice:!1,automaticLangDetection:!1,automaticLangDetectionNumberOfResults:4,toastTimeout:8e3,truVoiceName:"Truvoice",autoDetectButtonThrottleTimeoutMs:1e3,truVoiceButtonThrottleTimeoutMs:1e3},translationDefaultVoice:n.Gender.female,isStartCaptionsInfoPanelEnabled:!1,stopTranslationOnCallHold:!1,callControlTimeoutMs:7e3,callControlShortTimeoutMs:5e3,isInCallFeatureConsentEnabled:!0,inCallFeatureConsentRosterDelayMs:500,syncAdapterMode:"on",photoEventTimeoutMs:5e3,callAudienceBotConfig:{enabledOneOnOneCall:!1,enabledGroupCall:!1,enabledBackgroundSelection:!1,botMri:"28:9cd07db6-fab5-438c-8e34-44117fac7650",botMriFilter:["28:4969df63-cfcb-45e3-b06e-1f2b54d8b9bb","28:9cd07db6-fab5-438c-8e34-44117fac7650","28:3d59cb08-f597-4e49-9add-a05f9735152b"],backgrounds:[],minParticipantsOnCall:2,maxNumberOfAttemptsForDataChannelHandler:4,retryDelayMsForDataChannelHandler:500},callGridViewBotConfig:{enabled:!1,botMri:"28:ab5d1521-415b-4380-82e4-af803fb8bf2d",botMriFilter:["28:9dc84a1d-cd1f-4e39-83b4-365e9482e2ad","28:8cf0f6d9-65dc-464b-a2cb-8f66a9767358","28:ab5d1521-415b-4380-82e4-af803fb8bf2d"],minParticipantsOnCall:2},enableUFDForDeviceHasEcho:!1,enableAttachVideoWithId:!1,enableJoinerCallPreview:!1,enableRinglessCall:!1,enableRinglessCallForSmallGroups:!1,enableEndGoLiveForLastParticipant:!1,enableBlockPSTNUserInContactInviteHeader:!1,enablnewPSTNLandingScreenWhileSearch:!1,enableTapToMoveCallParticipant:!1,enableSlimcorelogging:!1,retryPolicy:{maxPostElapsedTime:3e5,maxTransferTime:{postingService_getStatusServerTranscoding:6e4,postingService_postChatMessage:r.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:r.NumberShim.MAX_SAFE_INTEGER},maxRetriesDefault:5,maxRetries:{postingService_urlPreviewFetching:3,postingService_updateChatMessageProperties:3,postingService_getStatusServerTranscoding:1e3,postingService_postChatMessage:r.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:r.NumberShim.MAX_SAFE_INTEGER},constantPollTime:{postingService_getStatusServerTranscoding:500},countLocalNetworkFailures:!0},optimalVideoCountInitialThrottleSeconds:0,enablePreRS5HIDSupported:!0,enableAccessibleRecordButton:!1,disableCopyingOriginalVideoToCache:!1,videoReencodeConfig:{profile:2,highQualitySource:!1,outputWidth:1280,outputHeight:720,videoBitrate:2e6,audioBitrate:96e3,minSizeDecreaseRatio:.2},picturePrefetch:{status:l.PrefetchMode.On,maxTimeIntervalPriorToStartupSec:86400,maxQueuedEntriesCount:20},picturePrefetchCacheExpiryTimeSec:259200,videoPrefetchCacheExpiryTimeSec:259200,enableLibraryVideoMarkup:!1,maxVideoDurationOnMobileMin:1,fileRetentionDurationDays:30,scheduleNextCallDurationSeconds:300,scheduleNextCallFrequency:20,scheduledCallNotSupportedFallbackUrl:"https://www.skype.com/get-skype",scheduledCallSearchBatchSize:100,enableScheduledCallAddToCalendar:!1,enableScheduledCallsSystemMessages:!1,scheduledCallInviteSendTimeout:3e3,maxScheduleNextCallDisplays:5,enableMeetNowEmoticonPicker:!1,enableMeetNowStickersOnSafari:!1,meetNowTitleSuggestionList:{enableSuggestionList:!1,isFlatList:!0},removeThreadIdFromUrlHistory:!1,waitJoinKnowledgeTimeoutMs:15e3,enablePreHeatCall:!1,enableObservingCall:!1,enableContentPanelHeaderButtonsSubscribeToCallOnMount:!0,enableFullScreenOnWeb:!1,enableDoubleTapToFullScreen:!1,serverMessagesAfterThreadCreationTimeWindow:3e3,earpieceHiddenForVideoCalls:!1,enableMobileScreenSharing:!1,enableCameraPortraitLock:!1,enableMobileSubtitlesRightPanel:!1,enableScreenSharingToolbar:!1,enableDeclineAndMessageOnRingControls:!1,enableBlurBackgroundForAllCalls:!1,footprintServiceIntervalInMinutes:0,footprintServiceConfigUrls:[],enableScreenSharingControl:!1,enableEndCallWhenSystemSleeps:!1,useConverstionSyncForJoinCall:!1,officeLensMinIosVersion:"12.2.0",enableShouldShowCQFDelegation:!1,enableScreenRecordingPermission:!1,enableCallIntegration:!1,enableBackgroundReplacement:!1,enableBackgroundBlurOnWeb:!1,enableBackgroundBlurOnIOS:!1,enableBackgroundBlurOnAndroid:!1,backgroundEffects:[],bingBackgrounds:{enableImageDownload:!1,host:"https://www.bing.com",path:"/hp/api/v1/imagegallery?format=json&setmkt=[LOCALE]&today=1",syncIntervalMs:216e5,maxImageDownloadRetries:10,pickImageBasedOnUserIdHash:!1,showInSettings:!1,showInCallHeader:!1,showInCallFooter:!1,iconCountInHeader:1,captionAlwaysCollapsed:!0,useBingLogoInsteadOfSearchIcon:!1,showBackgroundCaptions:!0,tryOpenInAppBrowser:!0,sendBackgroundInfoUpdates:!0,throttleIntervalMs:500,clickLinkPartnerCode:"SBIOTD"},backgroundCategories:a.BackgroundCategories,enableBackgroundEffectsCategories:!1,numberOfVisibleLastUsedEffects:4,backgroundEffectsUri:"https://secure.skypeassets.com/content/dam/scom/",backgroundEffectsDefaultFolder:"skypebackgroundimage/",enableVideoBackgroundEffects:!1,hideSnapshotButton:!1,keepScreenShareWhenDisableVideo:!1,modernCallStage:{enabled:!1,maxStageElements:4,animationDuration:250,keepStreamAlive:!1,enableVideoPrioritization:!1,minVideoSize:{width:360,height:270},mobileMinVideoSize:{width:180,height:135},autoLetterBoxThresholdRatio:.3},enableNotifyUsersMuteKick:!1,enablePerfomanceTelemetry:!1,perfomanceTelemetryTimeoutInterval:5e3,enableAllCallButtonsVisible:!1,enableNewBackgroundEffectsLayout:!1,maxNumberOfVideosInUI:12,enableDialpadOnPSTNSubtitlesCalls:!1,disableVideosInRibbon:!1,enableCallPreviewPermissionOnLoad:!1,enableDeviceNumberTelemetry:!1,enableMsixPermissionTelemetry:!1,enableUFDQualityTelemetry:!1,enableShareInviteMessageVariant:!1,enablePresentationMode:!1,enableParticipantsButtonInCallControls:!1,enableParticipantsButtonPstnMobile:!1,enableAudioParticipantsOnTheStage:!1,enableAudioParticipantsOnTheStageByDefault:!1,enableAudioParticipantsOnTheStageAsNew:!1,enableTransparentVideoStream:!1,enableAudioParticipantsBackground:!1,enableAudioParticipantsBackgroundInTray:!1,audioParticipantsBackgroundFileNames:[],enableReactionsInCallStageMobile:!1,enableOutgoingVideoFirefox:!1,enableIncomingVideoFirefox:!1,enableScreenSharingFirefox:!1,cameraHelp:{showCameraIssuesText:!1,cameraIssuesLink:"https://go.skype.com/call.quality.guide"},enableUIToSelectSkypeOrPSTNContactToAddToGroupCall:!1,meetNowRequestsConfig:{retryCount:3,timeoutInMs:15e3},electronNavigationDebounce:1e3,enableSpeechConsentFlow:!1,speechConsentFlowConfig:{callsBetweenConsentSuggestion:5,maxSuggestionsShownCount:3},enableNoiseSuppression:!1,enableNewLayoutPicker:!1,enableLockMeeting:!1,enableAudienceDataChannel:!1,enableAsyncMedia:!1,PSTNCampaignTerminatedReasons:[],customCallReactions:{enabled:!1,maxNumberOfCustomReactions:6,defaultPack:["yes","cwl","surprised","clap","cry"],useNewAddEmojiIcon:!1},enableNewCustomCallReactions:!1,dataChannelReactions:{enableDataChannel:!1,sendReactions:!1,useSpecificRecipientList:!1,doNotSendReactionsViaChat:!1,doNotSendCaptionsViaChat:!1,enableCaptions:!1,throttleIntervalMs:500,retryDataChannelSendOnError:!0,retryDataChannelMaxNumber:3,retryDataChannelDelayMs:2e3,logReactionsCounts:!1,logCaptionsCounts:!1},enableDataChannelForPstn:!1,enableCallHandoff:!1,enableCallLowerHandByOthers:!1,enableMultipleStreamSupport:!1,autoLetterBoxThresholdRatioForNewStage:.5,enableAutoLetterBoxOnMobile:!1,autoLetterBoxThresholdRatioOnMobile:.5,callingStoreThrottleMs:void 0,callingStoreTriggerAggregation:0,enableEcoMode:!1,enableCallParticipantsPinning:!1,twinCamEnabled:!1,twinCamEnabledForOneOnOne:!1,twinCamInsiderTextEnabled:!0,twinCamRetailStepsTextEnabled:!0,twinCamSendInitiatorId:!0,twinCamEnabledForSingleParticipant:!0,twinCamDisableSyncMessageAfterCallFinished:!0,twinCamDisableSyncMessageOnQRCodeClicked:!0,enableTopTrayHiding:!1,enableScreenShareZoom:!1,enablePictureInPictureCallMonitor:!1,enablePerfResponsivenessTracking:!1,responsivenessTrackingTimeout:6e4,responsivenessScenarioSampling:{},enableNSModeSwitching:!1,audioConfig:{enableSpatialAudio:!1,enableNSCompatibilityCheck:!1,defaultMusicMode:!1,defaultAECMode:!0},enableMicSoundIndicator:!1,showSimpleReconnectingLostMessage:!0,enableNewLanguageSelectors:!1,enableNewCallPanel:{enableVisitor:!1,enablePortraitFlex:!1,enableLandscapeFlex:!1,enableExperimentalHeader:!1,enableExperimentalCallControls:!1,enableAnimationV2:!1},clientCountry:"other",enableIOSNativeCallsAddInfo:!1,disableUpdateEndpointMetadataOnESCConfigChange:!1,disableCallEndSoundPlayingWhenMultipleCalls:!1,enableRemovedSlimcoreStreamObjectsHandling:!0,enableIOSValidateCallStatus:!1,enableIOSNativeIncomingCallNotifications:!1,enableBackgroundTask:!1,enableShowParticipantNamesOnMobiles:!1,enableFriendlyCameraLabelsOnAndroid:!1,temporarilyInactivateCallControlsAfterCallEnd:{enabled:!1,timeout:2e3},enableGroupCallReRinging:!1,enableCallKitAcceptAction:!1,disableOptimisticRing:!1,enableStartFromCallPreviewScreenWhenPreviousCallEnded:!1,disableCallPreviewJoinCallCheck:!1,enableRemoveDefaultDeviceFromAudioSettings:!1,enableForceStopLoadingTwinCam:!1,disableIOSRejectCallWhenHasOutgoingCall:!1,enableEndCallsWhenLeavingGroup:!1,enableVideoStreamForSingleParticipant:!1,enableIgnoringRecordingStopBeforeStart:!1,enableIOSVideoCleanUpWhenUninitialize:!1,enableCleanupWhenAssumedStartCallFailed:!1,enableRejectIncomingCallWhenLackOfMicPermission:!1,enableIOSNativeIncomingCallUpdateDisplayName:!1,enableJoinExistingInsteadOfStartingNewCall:!1,enableIOSCallMonitor:!1,disableIOSRemoveExistingCallWhenAddingCallInfo:!1,resumeListenToCameraSwapEventAfterResumeCall:!1,enableForcePiiOmitOnErrorMessage:!1,enableUpdatingParticipantStatusInCallRoster:!1,enableDefaultHighNSMode:!1,enableVoiceIsolationToggle:!1,enableRedesignedDeviceQualityBanners:!1,enableForceGlobalVoiceIsolationSetting:!1,enableMobileUpdateSlimcoreDisplayName:!1,enableUnmountVideoViewInBackground:!1,enableTimeoutForWaitingForCallInStates:!1,timeoutForWaitingForCallInStates:5e3,disableChainedPromiseSlimcoreRNLocalStillCapture:!1,enableUnmuteBtSco:!1,enableUsingSystemSpeakerVolume:!1,enableBorderlineSystemSpeakerVolume:!1,enableShowingResumeCallInConversationListItem:!1,pnhRequestRetryCount:0,enablePlayingDTMFSoundAfterInteractions:!1,commonCallManagerCallKitTimeoutMS:3e4,enableIOSFirstResolveWhenRequestStartCall:!1,enableUnregisteringTrouterListenersWhenReloading:!0,enableCallRegistry:!1,disableTransferIfCurrentInMeeting:!1};t.default=c},166745:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AsyncEvent=t.StagingList=void 0;t.StagingList=class{constructor(){this._list=[],this._committed=null}commit(){return this._committed||(this._committed=this._list.slice())}add(e){this._committed=null,this._list.push(e)}remove(e){const t=this._list.lastIndexOf(e);t>=0&&(this._committed=null,this._list.splice(t,1))}};t.AsyncEvent=class{constructor(e,...t){this._listeners=e,this._triggers=new WeakMap,this._callback=e=>e(...t)}trigger(){const e=this._listeners.commit();let t=this._triggers.get(e);t||(t=function(e,...t){let i=!1;return function(){i||(i=!0,queueMicrotask((()=>{i=!1,e(...t)})))}}((e=>{e.forEach(this._callback)}),e),this._triggers.set(e,t)),t()}}},88766:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.callRegistry=t.CallRetainer=t.CallEntry=void 0,t.createCallStateListener=function(e,t,i){const o=new WeakMap;return function(a){const n=e(a),s=o.get(a);void 0!==s&&t(n,s)||(o.set(a,n),i(a,s))}};const o=i(167606),a=i(82485),n=i(166745);var s,r=o.LogTraceArea.Calling;class l{constructor(e){this.callId=e,this._retainers=new Set,this._changeEvent=new n.AsyncEvent(d.call.listeners,this),this.tag=`[CallEntry:${++l._id}:${this.callId}]`}retain(e){this._retainers.add(e),a.Instrumentation.log(r,this.tag,"Retain",`{ retainer: ${e}, updated set: [${Array.from(this._retainers)}] }`)}release(e){const t=this._retainers.delete(e);a.Instrumentation.log(r,this.tag,"Release"+(t?"":" (not retained)"),`{ retainer: ${e}, updated set: [${Array.from(this._retainers)}] }`),t&&this.checkState()}getConversationMri(){return this._conversationMri}setConversationMri(e){this._conversationMri!==e&&(this._conversationMri=e,this._changeEvent.trigger())}getJoinContext(){return this._joinContext}setJoinContext(e){this._joinContext!==e&&(this._joinContext=e,this._changeEvent.trigger(),this.checkState())}isDisposable(){return 0===this._retainers.size}checkState(){this.isDisposable()&&function(e){const t=c.indexOf(e);t>=0&&(a.Instrumentation.log(r,e.tag,"Unregister"),c.splice(t,1))}(this)}}t.CallEntry=l,l._id=0,function(e){e.GoLive="GO_LIVE",e.LiveStatePrefix="LIVE_STATE@"}(s||(t.CallRetainer=s={}));const c=[];const d={call:{listeners:new n.StagingList,addListener(e){this.listeners.add(e);const t=c.slice();queueMicrotask((()=>{for(const i of t)e(i)}))},removeListener(e){this.listeners.remove(e)}}};t.callRegistry={getAllCalls:function(){return c.slice()},getCall:function(e){const t=c.find((t=>t.callId===e));if(t)return t;const i=new l(e);return a.Instrumentation.log(r,i.tag,"Register"),c.push(i),queueMicrotask((()=>i.checkState())),i},addListener:function(e,t){d[e].addListener(t)},removeListener:function(e,t){d[e].removeListener(t)}},t.default=t.callRegistry},480986:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(397691)),n=o.__importDefault(i(150343)),s=o.__importStar(i(85385)),r=i(815146),l=o.__importStar(i(446574));t.default=new class{constructor(){this._audioBackgroundsEnabled=!1,this._audioBackgrounds=[],this._storeBackgroundsUri=()=>{const{enableAudioParticipantsBackground:e,audioParticipantsBackgroundFileNames:t,backgroundEffectsUri:i,backgroundEffectsDefaultFolder:o}=n.default.getS4LCMCFeaturesNoSubscription();this._audioBackgroundsEnabled!==e&&(this._audioBackgroundsEnabled=e,s.log(r.LogTraceArea.CallingUI,`[AudioParticipantBackgroundHelper][_storeBackgroundsUri] Audio participant backgrounds enabled=${this._audioBackgroundsEnabled}`),this._audioBackgrounds=e?t.map((e=>({uri:i+o+e,available:!0}))):[])},l.RegisterStartupable(this,"AudioParticipantBackgroundHelper")}startup(){return this._storeBackgroundsUri(),this._appConfigSubscriptionToken=n.default.subscribe((()=>{this._storeBackgroundsUri()})),a.Resolved()}getAvailableBackgroundUri(){if(0===this._audioBackgrounds.length)return void s.log(r.LogTraceArea.CallingUI,"[AudioParticipantBackgroundHelper][getAvailableBackgroundUri] There are no backgrounds to select from.");this._audioBackgrounds.some((e=>e.available))||this._audioBackgrounds.forEach((e=>e.available=!0));const e=this._audioBackgrounds.find((e=>e.available));return e?(s.log(r.LogTraceArea.CallingUI,"[AudioParticipantBackgroundHelper][getAvailableBackgroundUri] Available background found."),e.available=!1,e.uri):void 0}setBackgroundAvailable(e){const t=this._audioBackgrounds.find((t=>t.uri===e));t&&(t.available=!0)}test_reset(){this._audioBackgroundsEnabled=!1,this._audioBackgrounds=[],this._appConfigSubscriptionToken&&(n.default.unsubscribe(this._appConfigSubscriptionToken),this._appConfigSubscriptionToken=void 0)}}},636428:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importDefault(i(331654)),n=o.__importDefault(i(150343)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importStar(i(446574)),c=o.__importDefault(i(655192));class d{constructor(){l.RegisterStartupable(this,"BatteryOptimizationNotificationHelper")}startup(){return n.default.getS4LCMCFeaturesNoSubscription().enableBatteryOptimizationNotification&&(r.log(s.LogTraceArea.Calling,"Battery optimization notification enabled"),d._showBatteryOptimizationNotification()),Promise.resolve()}static _showBatteryOptimizationNotification(){a.default.showBatteryOptimizationNotification().then((e=>{r.log(s.LogTraceArea.Calling,`Battery optimization notification displayed: ${e}`)}),(e=>{r.warn(s.LogTraceArea.Calling,"Battery optimization notification displaying failed: "+c.default.errorAsString(e))}))}}t.default=new d},153223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCallConnectionTypeAndUpdateTelemetry=function(e,t,i){return C(t,i).then((t=>(m(e,t,i),t)))},t.getCallConnectionType=C,t.updateTelemetry=m;const o=i(197582),a=i(148540),n=o.__importDefault(i(638260)),s=o.__importStar(i(44717)),r=o.__importDefault(i(555436)),l=o.__importDefault(i(615364)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importDefault(i(201721)),h=o.__importDefault(i(778362)),p=o.__importStar(i(437782)),g=o.__importStar(i(446574));function C(e,t){return d.log(c.LogTraceArea.Calling,"getCallConnectionType conversationMri: "+p.mriOrId(e)+" causeId: "+t),g.EnsureStarted([u.default,h.default]).then((()=>{if(u.default.getUserPreferencesLocalNoSubscription().forceRelay)return d.log(c.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to force causeId: "+t),a.ConnectionType.NoDirectConnection;const i=h.default.getCallConnectionType();return i===a.ConnectionType.NoDirectConnection?(d.log(c.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to NetworkOperatorStore causeId: "+t),i):e&&(s.isOneToOneThread(e)||s.isSkypeIdMri(e))?(0,l.default)().getConversationPotentiallyBeforeStartupAsync(e).then((e=>r.default.isConversationObjectAccepted(e)?a.ConnectionType.AllSupported:(d.log(c.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to ContactsStore.isIncomingContactInvitePending causeId: "+t),a.ConnectionType.NoDirectConnection))):a.ConnectionType.AllSupported}))}function m(e,t,i){n.default.updateCallTelemetry(e,i,(e=>{e.setMccMncCode(h.default.getMccCode(),h.default.getMncCode()),e.callConnectionType(t)}))}},181896:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postCallEventNotification=function(e,t,i,o,u,h){if(!o)return;let p="";const g=n.default.getDisplayableProfile(a.default.getSkypeMri()),C=n.default.getDisplayableProfile(t);switch(e){case l.ReactionsTextType.CallEventMuted:p=s.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case l.ReactionsTextType.CallEventKickedOut:p=s.getString("CallPanel.RemoveFromCallPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case l.ReactionsTextType.CallEventTransfer:case l.ReactionsTextType.CallEventKickedOutOwn:p=s.getString("CallControls.RemovedFromCallByTransfer")}const m={reactionInfo:{type:c.ReactionsItemType.CallEvent,key:p,internalType:e,userMri:t},causeId:h,timestamp:Date.now(),postSource:r.PostSource.CallMoments,callId:i,conversationMri:o,reactionsConversationMri:u,logTraceArea:r.LogTraceArea.CallingUI};d.CallReactionPostingHelpers.postReaction(m)};const o=i(197582),a=o.__importDefault(i(363091)),n=o.__importDefault(i(601976)),s=o.__importStar(i(704704)),r=i(815146),l=i(331079),c=i(460515),d=i(513800)},721748:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PinUnpinCommand=void 0;const o=i(197582),a=o.__importStar(i(85385)),n=o.__importDefault(i(150343)),s=o.__importDefault(i(854929)),r=o.__importStar(i(873324));t.PinUnpinCommand=class{constructor(e,t){this._key=e,this._callId=t}canExecute(){return n.default.getS4LCMCFeatures().enableCallParticipantsPinning}execute(){const e=s.default.isParticipantPinned(this._key,this._callId);e?s.default.unpinParticipant(this._key,this._callId):s.default.pinParticipant(this._key,this._callId);const t=e?new r.UnpinCallParticipant(this._callId):new r.PinCallParticipant(this._callId);a.track(t)}}},455275:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compileCallRateLabel=function(e){let t;switch(e.callFundedBy){case s.CallRateFundingSource.Credit:l.default.setFreeCall(!1),e.price&&e.currency&&(t=a.default.getS4LCommerceFeaturesNoSubscription().smsNewEntry.enableOnDialpad?r.getString("PSTNDialerPanel.CallRateInfo",{price:n.getFormattedRate(e.price,e.currency,3)}):r.getString("CallOptionsMenu.CallFundedBy_Credit",{price:n.getFormattedRate(e.price,e.currency,3)}));break;case s.CallRateFundingSource.CallingPlan:t=r.getString("CallOptionsMenu.CallFundedBy_CallingPlan");break;case s.CallRateFundingSource.FreeCall:l.default.setFreeCall(!0),t=r.getString("CallOptionsMenu.CallFundedBy_FreeCall");break;case s.CallRateFundingSource.TasterCall:l.default.setFreeCall(!0),t=r.getString("CallOptionsMenu.CallFundedBy_TasterCall",{numberOfMinutes:a.default.getS4LEntitlementFeatures().SCE.CallRates.TasterCallMaxDurationMinutes});break;case s.CallRateFundingSource.NoFunding:t=r.getString("CallOptionsMenu.CallFundedBy_NoFunding")}return t};const o=i(197582),a=o.__importDefault(i(150343)),n=o.__importStar(i(637224)),s=i(783193),r=o.__importStar(i(704704)),l=o.__importDefault(i(582176))},513800:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionPostingHelpers=void 0;const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importDefault(i(306794)),s=o.__importDefault(i(191867)),r=o.__importDefault(i(638260)),l=i(460515),c=o.__importStar(i(459287)),d=o.__importStar(i(626065)),u=o.__importStar(i(85385)),h=o.__importDefault(i(863132)),p=o.__importDefault(i(597285)),g=o.__importStar(i(437782)),C=i(331079),m=o.__importStar(i(535775)),S=o.__importDefault(i(150343)),_=o.__importDefault(i(615364)),f=o.__importDefault(i(363091));t.CallReactionPostingHelpers=class{static shouldSendReactionViaDataChannel(){const e=S.default.getS4LCMCFeaturesNoSubscription();return e.dataChannelReactions.enableDataChannel&&e.dataChannelReactions.sendReactions}static shouldSendReactionViaChatService(){const e=S.default.getS4LCMCFeaturesNoSubscription();return!(e.dataChannelReactions.enableDataChannel&&e.dataChannelReactions.sendReactions&&e.dataChannelReactions.doNotSendReactionsViaChat)}static sendReactionViaChatService(e){this.shouldSendReactionViaChatService()&&h.default.postMessage(e)}static sendReactionViaDataChannel(e,t,i,o){if(this.shouldSendReactionViaDataChannel()){const n=(0,_.default)().getConversation(t),s=Math.max(Date.now(),n?n.getTimestamp()+1:0),r={content:e.messageForPosting.content,userId:f.default.getSkypeMri(),conversationId:t,callId:i,createdTime:s,clientmessageid:e.messageForPosting.clientmessageid,messagetype:e.messageForPosting.messagetype,contenttype:e.messageForPosting.contenttype};a.default.ReactionsDataChannelService.sendReactionInfo(i,o,r)}}static postReaction(e){e.reactionInfo.type===l.ReactionsItemType.Sticker?this._postStickerText(e):e.reactionInfo.type===l.ReactionsItemType.Emoticon?this._postEmoticon(e):e.reactionInfo.type===l.ReactionsItemType.Snapshot?this._postSnapshot(e):e.reactionInfo.type===l.ReactionsItemType.Animation?this._postAnimation(e):e.reactionInfo.type===l.ReactionsItemType.CallEvent&&this._postCallEvent(e)}static _postAnimation(e){const t=e.reactionInfo.key;this._postHelper(e,"animation",(()=>{const i=[new d.UnhandledEntity(t)];e.callId&&(i.push(new d.CallReactionMetadataEntity(e.callId,C.ReactionsTextStyle.Animation)),r.default.updateCallTelemetry(e.callId,e.causeId,(e=>e.postAnimationReaction())),r.default.trackInCallReaction(t,"animation",!1,!1,!0));const o=c.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,s.default.getReactionsThreadPostParams(e.conversationMri));this.sendReactionViaDataChannel(o,e.conversationMri,e.callId,e.causeId),this.sendReactionViaChatService(o),r.default.trackInCallActivity(e.callId,e.reactionsConversationMri,o.messageForPosting.clientmessageid)}))}static _postEmoticon(e){this._postHelper(e,"emoticon",(()=>a.default.CallPostMessageService.postEmoticonReactionString(e.reactionInfo.key,e.conversationMri,e.reactionsConversationMri,e.callId,e.causeId)))}static _postStickerText(e){const t=p.default.textForImageSticker(e.reactionInfo.key);t&&t.length&&this._postHelper(e,"sticker",(()=>{const i=[new d.UnhandledEntity(t)];e.callId&&(i.push(new d.CallReactionMetadataEntity(e.callId,C.ReactionsTextStyle.Sticker)),r.default.updateCallTelemetry(e.callId,e.causeId,(e=>e.postTextReaction())),r.default.trackInCallReaction(t,"sticker",!1,!1,!1));const o=c.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,s.default.getReactionsThreadPostParams(e.conversationMri));this.sendReactionViaDataChannel(o,e.conversationMri,e.callId,e.causeId),this.sendReactionViaChatService(o),r.default.trackInCallActivity(e.callId,e.reactionsConversationMri,o.messageForPosting.clientmessageid)}))}static _postSnapshot(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new d.UnhandledEntity(t)];e.callId&&i.push(new d.CallReactionMetadataEntity(e.callId,C.ReactionsTextStyle.Snapshot));const o=c.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,s.default.getReactionsThreadPostParams(e.conversationMri));this.sendReactionViaDataChannel(o,e.conversationMri,e.callId,e.causeId),this.sendReactionViaChatService(o)}static _postCallEvent(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new d.UnhandledEntity(t)];e.callId&&i.push(new d.CallReactionMetadataEntity(e.callId,C.ReactionsTextStyle.CallEvent,e.reactionInfo.internalType,e.reactionInfo.userMri));const o=c.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,s.default.getReactionsThreadPostParams(e.conversationMri));this.sendReactionViaDataChannel(o,e.conversationMri,e.callId,e.causeId),this.sendReactionViaChatService(o)}static _postHelper(e,t,i){let o;u.log(e.logTraceArea,"_postHelper, type: "+t+" reactionsConversationId: "+g.mriOrId(e.reactionsConversationMri)+" callId: "+e.callId+" causeId: "+e.causeId),e.timestamp&&(o=new m.default(m.ScenarioName.RenderLocalCallReaction),o.start(void 0,e.timestamp),o.markStepCompleted("onReactionPressed"),n.default.setReactionPressedScenario(o)),n.default.setHasPostedReactions(e.callId,!0),i(),o&&o.markStepCompleted("posted")}}},99741:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(148540),s=o.__importDefault(i(150343)),r=o.__importStar(i(181896)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(60433)),d=o.__importDefault(i(638260)),u=o.__importDefault(i(132680)),h=o.__importStar(i(44717)),p=o.__importDefault(i(615364)),g=i(815146),C=o.__importStar(i(85385)),m=o.__importStar(i(704704)),S=o.__importDefault(i(363091)),_=o.__importDefault(i(321630)),f=o.__importStar(i(437782)),y=i(641400),T=i(331079),b=o.__importDefault(i(19973));class v{static getRosterForConversation(e,t=!0){const i=(0,p.default)().getConversation(e);if(!i)return C.warn(g.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+f.mriOrId(e)),[];const o=_.default.getSortedPeopleListInConversation(i,t);return o&&0===o.length&&C.warn(g.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: returns empty list conversationId="+f.mriOrId(e)),o}static getActiveParticipants(e,t){const i=v.getRosterForConversation(t),o=S.default.getSkypeMri();return a.filter(i,(t=>{if(t===o)return!0;{const i=l.default.CallingStore.findRemoteCallMember(e,t);return c.default.isParticipantConnected(i)}}))}static getInactiveGroupMembersFromRoster(e,t){return a.difference(e,t)}static getInactiveGroupMembers(e,t){return this.getInactiveGroupMembersFromRoster(v.getRosterForConversation(t,!1),l.default.CallingStore.getRemoteCallMemberMris(e))}static getConversationName(e){const t=(0,p.default)().getConversation(e);return t?t.topicName():(C.log(g.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+f.mriOrId(e)),"")}static getParticipantRenderInfoConfig(e,t,i,o){const a=o?o.state:void 0,s=c.default.isParticipantConnected(o),r=o&&o.voiceLevel>0,d=a===n.ParticipantState.Ringing||a===n.ParticipantState.Connecting,u=!!o&&o.isServerMuted;return{key:e,participantState:a,isActive:s,isTalking:r,isRinging:d,isServerMuted:u,isServerMutedSupported:!!o&&l.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(t,o),isLocalMuted:u,isLocalMuteSupported:i}}static getRenderInfoForParticipant(e,t){const i=e.key,o=e.participantState,a=e.isActive,n=e.isTalking,s=e.isRinging,r=e.isServerMuted,l=e.isServerMutedSupported,c=e.isLocalMuted,d=e.isLocalMuteSupported;return t&&e.participantState===t.participantState&&n===t.isTalking&&s===t.isRinging&&r===t.isServerMuted&&l===t.isServerMutedSupported&&d===t.isLocalMuteSupported&&c===t.isLocalMuted?t:{key:i,participantState:o,isActive:a,isTalking:n,isRinging:s,isServerMuted:r,isServerMutedSupported:l,isLocalMuted:c,isLocalMuteSupported:d}}static getRenderInfoForCurrentParticipant(e,t,i){const o=u.default.isLocalOrServerMuted(t);return{key:e,participantState:n.ParticipantState.Connected,isActive:!0,isTalking:!1,isRinging:!1,isLocal:!0,isLocalMuteSupported:i,isServerMuted:o,isServerMutedSupported:!0,isLocalMuted:o}}static getAllMembersWithActiveAndInactiveParticipants(e,t,i){const o={},n=[],s=[],r=S.default.getSkypeMri(),c=v.getRosterForConversation(e),d=l.default.CallingStore.getLocalMuteSupported(t),u=v.getRenderInfoForCurrentParticipant(r,t,d);c&&0===c.length&&C.warn(g.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: allMembers is empty list conversationId="+f.mriOrId(e));const h=a.map(l.default.CallingStore.getParticipantsWithRaisedHands(t),(e=>e.id)),p=a.uniq(a.concat(h,c)),m=a.includes(h,r);return a.each(p,(e=>{if(e!==r){const a=l.default.CallingStore.findRemoteCallMember(t,e),r=v.getParticipantRenderInfoConfig(e,t,u.isLocalMuteSupported,a),c=v.getRenderInfoForParticipant(r,i[e]);a&&c.isActive?n.push(c):s.push(c),o[e]=c}else e===r&&m&&(n.push(u),o[r]=u)})),u&&!m&&(n.push(u),o[r]=u),n&&0===n.length&&C.warn(g.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: activeParticipants is empty list conversationId="+f.mriOrId(e)),{activeParticipants:n,inactiveParticipants:s,allMembers:c,allParticipants:o}}static getIconTitleForMuteOrUnMute(e,t,i,o,a){let n,s,r=!1;return t&&i?(n=y.SkypeIcon.MicrophoneOff,s=m.getString("CallControls.CallButtonUnmuteLabel")):t&&!i?(n=y.SkypeIcon.Microphone,s=m.getString("CallControls.CallButtonMute")):e&&o?o&&a?(n=y.SkypeIcon.MicrophoneOff,s=m.getString("CallPanel.MicrophoneUnMuteNotAllowed"),r=!0):(n=y.SkypeIcon.Microphone,s=m.getString("CallControls.CallButtonMute")):(n=y.SkypeIcon.Microphone,s=m.getString("CallPanel.MicrophoneMuteNotSupported"),r=!0),{icon:n,title:s,disableIcon:r}}}v.handleLocalMuteOrUnmute=(e,t)=>(d.default.updateCallTelemetry(e,t,(e=>e.muteCallRosterPress())),u.default.isLocalOrServerMuted(e)?(l.default.CallingStore.unmute(e,t),!1):(l.default.CallingStore.mute(e,t),b.default.updateCallRosterTelemetry(e,t,(e=>e.callRosterMutedUser())),!0)),v.handleRemoteMute=(e,t,i)=>{const o=l.default.CallingStore.findRemoteCallMember(t,e),a=h.getReactionsThreadMriForCallId(t),c=l.default.CallingStore.getCallConversationMri(t);o?(l.default.CallingStore.muteParticipants(t,n.MuteScope.Specified,[o],i).then((()=>{s.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&r.postCallEventNotification(T.ReactionsTextType.CallEventMuted,e,t,c,a,i)})),b.default.updateCallRosterTelemetry(t,i,(e=>e.callRosterMutedUser()))):C.error(g.LogTraceArea.CallingUI,`[CallRosterUtils] _handleRemoteMute\n                                                          participantToMute is null or empty, causeId: ${i}`)},v.handleRemoteHangup=(e,t,i)=>{const o=h.getReactionsThreadMriForCallId(t),a=l.default.CallingStore.getCallConversationMri(t);s.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&r.postCallEventNotification(T.ReactionsTextType.CallEventKickedOut,e,t,a,o,i),l.default.CallingStore.removeParticipant(t,e,i)},t.default=v},53179:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(55644)),n=o.__importDefault(i(400059)),s=i(148540),r=o.__importStar(i(397691)),l=o.__importDefault(i(369347)),c=i(513800),d=o.__importDefault(i(947878)),u=o.__importDefault(i(638260)),h=i(460515),p=i(132680),g=o.__importStar(i(198649)),C=i(473483),m=i(154235),S=o.__importDefault(i(601976)),_=i(815146),f=o.__importStar(i(252665)),y=o.__importStar(i(85385)),T=o.__importStar(i(704704)),b=o.__importDefault(i(503411)),v=o.__importDefault(i(363091)),I=o.__importDefault(i(863132)),w=o.__importStar(i(437782)),P=o.__importDefault(i(655192)),M=i(331079),D=o.__importDefault(i(460403)),A=o.__importDefault(i(685734));var k,R,x;!function(e){e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large"}(k||(k={})),function(e){e[e.Landscape=1]="Landscape",e[e.Portrait=2]="Portrait"}(R||(R={})),function(e){e[e.Row=1]="Row",e[e.Column=2]="Column"}(x||(x={}));class L{constructor(e,t){this.causeId=e,this.mri=t}}class B extends L{constructor(e,t,i){super(e,t),this._size=i}captureFrame(e){return a.default.createImageContext(this._size.width,this._size.height).then((e=>{const t=S.default.getDisplayableProfile(this.mri),i=(0,C.gradientColorsForColors)(t.getColor().colors);let o=t.getAvatarUrl(M.AvatarSize.Large);o&&(o=D.default.getAuthenticatedUrl(o));const n={x:this._size.width/2,y:0},s={x:this._size.width/2,y:this._size.height},l={origin:{x:0,y:0},size:this._size},c=200;a.default.drawLinearGradient(e,n,i[0],s,i[1],l);const d=r.Defer();if(o)return a.default.createImageContextWithURL(o).then((o=>{if(a.default.isContextValid(o)){const t=a.default.getSize(o),i=t.width<=t.height?t.width:t.height,n=z((t.width-i)/2,(t.height-i)/2,i,i),s=z((this._size.width-c)/2,(this._size.height-c)/2,c,c),r=a.default.createPath(a.GCPathTypes.Arc);r?(r.appencArcToPath({x:this._size.width/2,y:this._size.height/2},100,0,2*Math.PI),a.default.clipPath(e,r)):y.error(_.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createPath return undefined"),a.default.drawGraphicsContext(e,o,n,s)}else{const o=t.getInitials();this.renderAvatarInitialsLook(e,o,i,c)}a.default.createImageData(e,0,0,this._size.width,this._size.height).then((t=>{t?d.resolve(t):(y.error(_.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),d.resolve(void 0)),a.default.destroyContext(e),a.default.isContextValid(o)&&a.default.destroyContext(o)}))})).catch((()=>(y.error(_.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContextWithURL return null"),r.Resolved(void 0)))),d.promise();{const o=t.getInitials();this.renderAvatarInitialsLook(e,o,i,c),a.default.createImageData(e,0,0,this._size.width,this._size.height).then((t=>{t?d.resolve(t):(y.error(_.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),d.resolve(void 0)),a.default.destroyContext(e)}))}return d.promise()})).catch((()=>(y.error(_.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContext return null"),r.Resolved(void 0))))}renderAvatarInitialsLook(e,t,i,o){const n=g.colorStringToBodyMovinRgbArray(i[0]);a.default.setFillColor(e,255,255,255,1),a.default.fillArc(e,{x:this._size.width/2,y:this._size.height/2},o/2,0,2*Math.PI),a.default.setStrokeColor(e,Math.ceil(255*n[0]),Math.ceil(255*n[1]),Math.ceil(255*n[2]),1),a.default.setLineWidth(e,2),a.default.strokeArc(e,{x:this._size.width/2,y:this._size.height/2},o/2+1,0,2*Math.PI),a.default.setTextAlignment(e,a.HorizontalTextAlignment.Center,a.VerticalTextAlignment.Center),a.default.setFont(e,"sans-serif",o/4,!0),a.default.setFillColor(e,Math.ceil(255*n[0]),Math.ceil(255*n[1]),Math.ceil(255*n[2]),1),a.default.fillText(e,t,this._size.width/2,this._size.height/2)}}class V extends L{constructor(e,t,i){super(e,t),this._renderer=i}captureFrame(e){return r.fromThenable(this._renderer.captureFrame(e))}}class O{constructor(){this._offset={x:0,y:0},this._size={width:0,height:0},this._sizeScale=1}setSize(e){this._size=e}getSize(){return this._size}setOffset(e){this._offset=e}getOffset(){return this._offset}setSizeScale(e){this._sizeScale=e}concatSizeScale(e){this.setSizeScale(this.getSizeScale()*e)}getSizeScale(){return this._sizeScale}getRenderRectangle(){return z(this._offset.x*this._sizeScale,this._offset.y*this._sizeScale,this._size.width*this._sizeScale,this._size.height*this._sizeScale)}}class E extends O{static layoutDefinition(e,t,i,o,a){return y.log(_.LogTraceArea.CallingUI,"CallSnapshots.layoutDefinition (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+o.length+" )"),t.layout===x.Column?new N(e,t,i,o,a):new F(e,t,i,o,a)}static chooseRenderBox(e,t,i,o){y.log(_.LogTraceArea.CallingUI,"CallSnapshots.chooseRenderBox (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+o.length+" )");const a=t.orientation===R.Landscape?i:o;switch(t.sizeClass){case k.Large:return a.splice(a.length-1,1)[0];case k.Medium:return a.splice(Math.floor(a.length/2),1)[0];case k.Small:return a.splice(0,1)[0]}}constructor(e,t,i,o,a){super(),this._boxes=[],this.constructLayout(e,t,i,o,a)}constructLayout(e,t,i,o,a){if(t.definitions)for(const n of t.definitions)this._boxes.push(E.layoutDefinition(e,n,i,o,a));else if(t.elements)for(const a of t.elements)this._boxes.push(E.chooseRenderBox(e,a,i,o))}boxes(){return this._boxes}render(e){a.default.saveContext(e),a.default.setTranslate(e,this.getOffset().x,this.getOffset().y);for(const t of this._boxes)t.render(e);a.default.restoreContext(e)}setSizeScale(e){for(const t of this._boxes)t.concatSizeScale(e);this.doLayout()}doLayout(){for(const e of this._boxes)e.doLayout()}}class N extends E{doLayout(){super.doLayout();let e=0,t=-1;for(const i of this.boxes())i.getRenderRectangle().size.width>e&&(e=i.getRenderRectangle().size.width),(-1===t||i.getRenderRectangle().size.width<t)&&(t=i.getRenderRectangle().size.width);const i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(const e of this.boxes()){const t=i/e.getRenderRectangle().size.width;e.concatSizeScale(t)}let o=0;for(const e of this.boxes())e.setOffset({x:0,y:o}),o+=e.getRenderRectangle().size.height;this.setSize({width:i,height:o})}}class F extends E{doLayout(){super.doLayout();let e=0,t=-1;for(const i of this.boxes())i.getRenderRectangle().size.height>e&&(e=i.getRenderRectangle().size.height),(-1===t||i.getRenderRectangle().size.height<t)&&(t=i.getRenderRectangle().size.height);const i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(const e of this.boxes()){const t=i/e.getRenderRectangle().size.height;e.concatSizeScale(t)}let o=0;for(const e of this.boxes())e.setOffset({x:o,y:0}),o+=e.getRenderRectangle().size.width;this.setSize({width:o,height:i})}}class U extends O{constructor(e){super(),this._videoFrame=e,this._renderRect=this._computeRenderRect(),this.setSize({width:this._renderRect.size.width,height:this._renderRect.size.height})}isLandscape(){return this._videoFrame.getSize().width>=this._videoFrame.getSize().height}_computeRenderRect(){const e={origin:{x:0,y:0},size:{width:0,height:0}},t=this._videoFrame.getSize();if(this.isLandscape()){const i=4,o=3;e.size.width=t.width,e.size.height=o/i*e.size.width,e.size.height>t.height&&(e.size.height=t.height,e.size.width=i/o*e.size.height)}else{const i=3,o=4;e.size.height=t.height,e.size.width=i/o*e.size.height,e.size.width>t.width&&(e.size.width=t.width,e.size.height=o/i*e.size.width)}return e.origin.x=(t.width-e.size.width)/2,e.origin.y=(t.height-e.size.height)/2,e}renderRect(){return this._renderRect}doLayout(){}render(e){a.default.drawImage(e,this._videoFrame,this._renderRect.origin.x,this._renderRect.origin.y,this._renderRect.size.width,this._renderRect.size.height,this.getOffset().x,this.getOffset().y,this._renderRect.size.width*this.getSizeScale(),this._renderRect.size.height*this.getSizeScale())}}class H extends U{_computeRenderRect(){const e=this._videoFrame.getSize();return{origin:{x:0,y:0},size:{width:e.width,height:e.height}}}}class j{static takeSnapshot(e,t,i,o,a,n){y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot causeId: "+e+" callId: "+t);const c=d.default.getStageMode(t),h=[],g=[];let C,m=0;let S=!1;const f=l.default.CallingStore.isConnectedAudienceBotInCall(t),T=l.default.CallingStore.isConnectedGridViewBotInCall(t),b=f&&p.CallUIUtils.isTogetherMode(c),I=T&&p.CallUIUtils.isLargeGrid(c);if(I){const i=l.default.CallingStore.getConnectedGridViewBotMriInCall(t);i&&(j.addVideoParticipantForMri(t,i,g,e),S=!0)}else if(b){const i=l.default.CallingStore.getConnectedAudienceBotMriInCall(t);i&&(j.addVideoParticipantForMri(t,i,g,e),S=!0)}else{for(C=0;C<a.length&&!S;C++){const i=l.default.CallingStore.getBestStreamForMri(t,a[C],s.StreamType.ScreenSharing);if(i){m++;const o=l.default.CallingStore.getRemoteStreamRenderer(t,a[C],i);if(void 0!==o){const t=new V(e,a[C],o);g.push(t),S=!0}}else y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote stream causeId: "+e+" callId: "+t+" mri: "+w.mriOrId(a[C]))}if(!S)for(C=0;C<a.length;C++){const i=l.default.CallingStore.getStreamsForMri(t,a[C],s.StreamType.Video),o={width:600,height:450};if(i)i.forEach((i=>{const n=l.default.CallingStore.getRemoteStreamRenderer(t,a[C],i);if(n){const t=new V(e,a[C],n);g.push(t)}else{const t=new B(e,a[C],o);h.push(t)}}));else{y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote video streamNaN causeId: "+e+" callId: "+t+" mri: "+w.mriOrId(a[C]));const i=new B(e,a[C],o);h.push(i)}}this.addLocalUserTwincamStreams(e,t,g)}y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot participation -  causeId: "+e+" callId: "+t+" total audio only "+h.length+" total video "+(g.length-m)+" total screen sharing "+m),u.default.updateCallTelemetry(t,e,(e=>e.setPhotoSnapshotMakeup(h.length,g.length-m,m))),j.postNotification(e,t,i,o),y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot rendering participants -  causeId: "+e);const M=[];this.getLocalRenderer(t).then((i=>{if(!S&&!I&&!b)if(i&&i.captureFrame)try{M.push(r.fromThenable(i.captureFrame(this.sCaptureTimeoutMS)))}catch(t){y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot localRenderer.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}else y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot no local renderer frame capture -  causeId: "+e);for(C=0;C<g.length&&M.length<j.sMaxParticipants;C++){const t=g[C];try{M.push(t.captureFrame(this.sCaptureTimeoutMS))}catch(t){y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot aParticipant.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}}r.all(M.map((e=>e.catch((e=>e))))).then((i=>{var o;const a=[];for(const t of i)(null===(o=null==t?void 0:t.getSize)||void 0===o?void 0:o.call(t))?a.push(t):t?y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t):y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot null return rendering a frame -  causeId: "+e);if(a.length>0)this.renderAndPost(e,t,n,a,S);else{const i=[],o={width:600,height:450},a=new B(e,v.default.getSkypeMri(),o);i.push(a.captureFrame(this.sCaptureTimeoutMS));for(const e of h)i.length<j.sMaxParticipants&&i.push(e.captureFrame(this.sCaptureTimeoutMS));r.all(i.map((e=>e.catch((e=>e))))).then((i=>{const o=[];for(const t of i)t?o.push(t):o.length<j.sMaxParticipants&&y.log(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t);o.length>0&&this.renderAndPost(e,t,n,o,S)}))}}))}))}static addLocalUserTwincamStreams(e,t,i){l.default.CallingStore.getCallMediaStreamsOnOtherEndpoints(t).forEach((o=>{const a=v.default.getSkypeMri(),n=l.default.CallingStore.getRemoteStreamRenderer(t,a,o);if(n){const t=new V(e,a,n);i.push(t)}}))}static addVideoParticipantForMri(e,t,i,o){const a=l.default.CallingStore.getBestStreamForMri(e,t,s.StreamType.Video);if(a){const n=l.default.CallingStore.getRemoteStreamRenderer(e,t,a);if(n){const e=new V(o,t,n);i.push(e)}else y.error(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode renderer is "+n)}else y.error(_.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode stream is "+a)}static renderAndPost(e,t,i,o,a){const n=[],s=[];let r;for(r=0;r<o.length;r++){const i=o[r];if(i){const e=i.getSize();if(!e||e.width<=0||e.height<=0)return void y.error(_.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frameSize is illegel"+e);y.log(_.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frame: #"+r+" width: "+e.width+"height: "+e.height),e.width>=e.height?s.push(a?new H(i):new U(i)):n.push(a?new H(i):new U(i))}else y.log(_.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost missing frame @ #"+r+" -  causeId: "+e+" callId: "+t)}const l=this.layoutComposition(e,s.length,n.length,0,0);l&&this.processMoment(e,t,i,l,s,n)}static postNotification(e,t,i,o){const a=A.default.getFullUserProfileByMri(v.default.getSkypeMri()),n={reactionInfo:{type:h.ReactionsItemType.Snapshot,key:T.getString("CallPanel.SnapshotNotification",{name:a.getDisplayName()})},causeId:e,postSource:_.PostSource.SnapshotNotification,callId:t,conversationMri:i,reactionsConversationMri:o,logTraceArea:_.LogTraceArea.CallingUI};c.CallReactionPostingHelpers.postReaction(n)}static processMoment(e,t,i,o,s,r){y.log(_.LogTraceArea.CallingUI,"CallSnapshots.processMoment (causeId:"+e+" ; landscape count:"+s.length+" ; portrait count: "+r.length+" )"),s=s.sort(((e,t)=>e.getSize().width>t.getSize().width?1:e.getSize().width<t.getSize().width?-1:0)),r=r.sort(((e,t)=>e.getSize().height>t.getSize().height?1:e.getSize().height<t.getSize().height?-1:0));const l=E.layoutDefinition(e,o,s,r,{origin:{x:0,y:0},size:{width:0,height:0}});if(l.doLayout(),l.getRenderRectangle().size.width>this.sMaxDim){const e=this.sMaxDim/l.getRenderRectangle().size.width;l.concatSizeScale(e)}if(l.getRenderRectangle().size.height>this.sMaxDim){const e=this.sMaxDim/l.getRenderRectangle().size.height;l.concatSizeScale(e)}let c=!1;a.default.createImageContext(l.getSize().width,l.getSize().height).then((e=>{l.render(e),n.default.drawLogo(e,l.getSize().height,l.getSize().width).then((()=>{a.default.createFileData(e,this.getSnapshotFileName()+".jpeg",(e=>{e?I.default.postUploadAndShowFeedbackToast(i,e,_.PostSource.CallMoments,!1,t):(c=!0,y.error(_.LogTraceArea.CallingUI,"CallSnapshots.processMoment Graphics.createFileData return null data"))})),a.default.destroyContext(e)}))})).catch((t=>{c=!0,y.error(_.LogTraceArea.CallingUI,"CallSnapshots.processMoment failed to create context with error"+P.default.errorAsString(t)+" ( causeId:"+e+" )")})).finally((()=>{c&&b.default.scheduleTextMessage(T.getString("CallPanel.SnapshotFailureMiniToast"),void 0,m.MainRootViewId)}))}static getSnapshotFileName(){const e=new Date(Date.now()),t="Skype-"+f.getISO8601Date(e)+"-"+f.getISO8601Time(e);return t===this.lastSnapshotFileName?(this.lastSnapshotFileName=t,t+"-"+ ++this.counterForSnapshotIn1S):(this.counterForSnapshotIn1S=0,this.lastSnapshotFileName=t,t)}static getLocalRenderer(e){return l.default.CallControlsStore.isProvidingVideo(e)?r.Resolved(l.default.CallingStore.getVideoPreviewRenderer(e)):r.Resolved(void 0)}static layoutComposition(e,t,i,o,a){return y.log(_.LogTraceArea.CallingUI,"CallSnapshots.layoutComposition (causeId:"+e+" ; landscape:"+t+" ; portraitCount: "+i+")"),1===t&&0===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Large}]}:2===t&&0===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Large},{position:2,orientation:R.Landscape,sizeClass:k.Large}]}:3===t&&0===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Large},{position:1,orientation:R.Landscape,sizeClass:k.Large},{position:2,orientation:R.Landscape,sizeClass:k.Large}]}:0===t&&1===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Large}]}:0===t&&2===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]}:0===t&&3===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium},{position:2,orientation:R.Portrait,sizeClass:k.Medium}]}:1===t&&1===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Large},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]}:2===t&&1===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,definitions:[{landscape:2,portrait:0,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Small},{position:1,orientation:R.Landscape,sizeClass:k.Small}]},{landscape:0,portrait:1,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium}]}]}:3===t&&1===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,definitions:[{landscape:1,portrait:1,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Large},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]},{landscape:2,portrait:0,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]}]}:2===t&&3===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:1,portrait:2,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Small},{position:2,orientation:R.Portrait,sizeClass:k.Small}]},{landscape:1,portrait:1,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Large},{position:1,orientation:R.Portrait,sizeClass:k.Small}]}]}:3===t&&2===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,definitions:[{landscape:0,portrait:2,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]},{landscape:3,portrait:0,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Medium},{position:2,orientation:R.Landscape,sizeClass:k.Medium}]}]}:1===t&&2===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:0,portrait:2,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Small},{position:1,orientation:R.Portrait,sizeClass:k.Small}]},{landscape:1,portrait:0,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium}]}]}:2===t&&2===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,definitions:[{landscape:1,portrait:1,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Small},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]},{landscape:1,portrait:1,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Small}]}]}:1===t&&3===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:1,portrait:1,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Small},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]},{landscape:0,portrait:2,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]}]}:0===t&&4===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:0,portrait:2,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]},{landscape:0,portrait:2,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]}]}:4===t&&0===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:2,portrait:0,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]},{landscape:2,portrait:0,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]}]}:4===t&&1===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,definitions:[{landscape:1,portrait:1,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Large},{position:1,orientation:R.Landscape,sizeClass:k.Medium}]},{landscape:3,portrait:0,layout:x.Column,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Medium},{position:2,orientation:R.Landscape,sizeClass:k.Medium}]}]}:1===t&&4===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:0,portrait:3,layout:x.Row,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Medium},{position:2,orientation:R.Portrait,sizeClass:k.Medium}]},{landscape:1,portrait:1,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Large},{position:1,orientation:R.Portrait,sizeClass:k.Medium}]}]}:0===t&&5===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Row,definitions:[{landscape:0,portrait:3,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Small},{position:1,orientation:R.Portrait,sizeClass:k.Small},{position:2,orientation:R.Portrait,sizeClass:k.Small}]},{landscape:0,portrait:2,layout:x.Column,elements:[{position:0,orientation:R.Portrait,sizeClass:k.Medium},{position:1,orientation:R.Portrait,sizeClass:k.Small}]}]}:5===t&&0===i&&0===o&&0===a?{landscape:t,portrait:i,layout:x.Column,definitions:[{landscape:3,portrait:0,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Small},{position:1,orientation:R.Landscape,sizeClass:k.Small},{position:2,orientation:R.Landscape,sizeClass:k.Small}]},{landscape:2,portrait:0,layout:x.Row,elements:[{position:0,orientation:R.Landscape,sizeClass:k.Medium},{position:1,orientation:R.Landscape,sizeClass:k.Small}]}]}:void y.log(_.LogTraceArea.CallingUI,"CallStageView.layoutComposition: Failed to provide layout for "+t+", "+i)}}function z(e,t,i,o){return{origin:{x:Math.ceil(e),y:Math.ceil(t)},size:{width:Math.ceil(i),height:Math.ceil(o)}}}j.sMaxDim=1920,j.sCaptureTimeoutMS=7500,j.sMaxParticipants=5,j.lastSnapshotFileName="",j.counterForSnapshotIn1S=0,t.default=j},638260:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RedundantStartCallError=t.CallTriggeredBy=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(224807),s=o.__importStar(i(516778)),r=i(148540),l=o.__importStar(i(397691)),c=o.__importDefault(i(55331)),d=o.__importDefault(i(150343)),u=o.__importStar(i(17421)),h=o.__importDefault(i(60433)),p=o.__importStar(i(873324)),g=i(460515),C=o.__importStar(i(964647)),m=o.__importStar(i(44717)),S=i(434343),_=o.__importDefault(i(515858)),f=o.__importDefault(i(455907)),y=i(815146),T=i(477195),b=o.__importStar(i(85385)),v=o.__importDefault(i(652032)),I=o.__importDefault(i(363091)),w=o.__importDefault(i(912201)),P=i(735711),M=i(527703),D=o.__importDefault(i(565060)),A=i(96575),k=o.__importDefault(i(994962)),R=o.__importDefault(i(506082)),x=o.__importDefault(i(902530)),L=o.__importStar(i(446574)),B=o.__importDefault(i(664821)),V=o.__importDefault(i(655192)),O=o.__importDefault(i(535775)),E=o.__importDefault(i(19973)),N=o.__importDefault(i(760989)),F=i(947786),U=o.__importDefault(i(601274)),H=o.__importStar(i(437782)),j=o.__importDefault(i(615364));var z;!function(e){e.None="None",e.ScheduleACall="ScheduleACall"}(z||(t.CallTriggeredBy=z={})),t.RedundantStartCallError="Outgoing call already being processed for this conversation";const G=5*F.SECOND;class W{constructor(){this._callTelemetryEvents={},this._callPerformanceTelemetryEvents={},this._callPerformanceTelemetryTokens={},this._incomingCallScenarios={},this._answerCallScenarioIds={},this._answerCallScenarios={},this._callIntents={},this._startRingingEvents={},this._stopRingingEvents={},this._notificationFailureEvents={},this._callConnectedOnAnswerEvents={},this._callParticipantRendererIsRenderingEvents={},this._timeToDisplayIncomingCallScreenEvents={},this._callAddPhotoTelemetryEvents={},this._callRecordingEvents={},this._callCaptioningEvents={},this._ndiEvents={},this._callTogetherModeEvents={},this._callLargeGridEvents={},this._micButtonClickEvents={},this._micToggleDurations=new Map,this._videoButtonClickEvents={},this._videoToggleDurations=new Map,this._hangUpButtonClickEvents={},this._outgoingCallNavigationFinishedEvents={},this._onCallingError=e=>{e.causeId&&this._callIntents[e.causeId]&&e.message===t.RedundantStartCallError&&delete this._callIntents[e.causeId];const i=d.default.getS4LCMCFeaturesNoSubscription().PSTNCampaignTerminatedReasons;this._waitForIds().then((()=>b.track(new p.CallActionError(e,x.default.CallingNodeId.get(),x.default.EdfRegistrationId.get(),i))))},this.updateCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent?e(this._callAudioSettingsPopupEvent):b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] updateCallAudioSettingsPopupEvent - attempted to update the AudioSettings popup but no popup event has been set")},this.updateCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent?e(this._callVideoSettingsPopupEvent):b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] updateCallVideoSettingsPopupEvent, attempted to update the VideoSettings popup but no popup event has been set")},this.setCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent||(this._callAudioSettingsPopupEvent=e)},this.setCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent||(this._callVideoSettingsPopupEvent=e)},this._updatePerformanceEvent=e=>{var t,i,o,a;const n=u.default.getPerformanceMetrics(),s=this._callPerformanceTelemetryEvents[e];s&&n&&(n.systemUsageInfo&&s.setMainUsage(n.systemUsageInfo),s.setGPUUsage(null===(t=n.gpu)||void 0===t?void 0:t.wss,null===(i=n.gpu)||void 0===i?void 0:i.cpu),s.setRendererUsage(null===(o=n.renderer)||void 0===o?void 0:o.wss,null===(a=n.renderer)||void 0===a?void 0:a.cpu))},this._sendCallAVSettingsPopupEvents=()=>{this._callAudioSettingsPopupEvent&&(b.track(this._callAudioSettingsPopupEvent),this._callAudioSettingsPopupEvent=void 0),this._callVideoSettingsPopupEvent&&(b.track(this._callVideoSettingsPopupEvent),this._callVideoSettingsPopupEvent=void 0)},this.onCallManagerError=e=>{this._waitForIds().then((()=>{b.track(new p.CallActionCallKitError(e.operation,e.domain,e.code,e.callId,x.default.CallingNodeId.get(),!!e.terminal))}))},this.onCallManagerSuccess=e=>{b.track(new p.CallActionCallKitSuccess(e.operation,e.result,e.attemptNumber))},h.default.onCallingError.subscribe(this._onCallingError)}_waitForIds(){return l.all([x.default.CallingNodeId.waitUntilSet(),x.default.EdfRegistrationId.waitUntilSet()]).then(a.noop)}onCallCreated(e){if(!this._callTelemetryEvents[e.callId]){if(b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] Starting to track Call event for callId: "+e.callId+" causeId: "+e.causeId),this._callIntents[e.causeId]&&delete this._callIntents[e.causeId],this._callTelemetryEvents[e.callId]=new p.Call({callId:e.callId,conversationId:e.conversationId,participantId:e.participantId,isCallCreator:e.isCallCreator,origin:e.origin,isScheduledCallActive:e.isScheduledCallActive,source:e.source,isLegacyMeetNow:e.isLegacyMeetNow,isEchoCall:e.isEchoCall,isTranslatedCall:e.isTranslatedCall,nodeId:x.default.CallingNodeId.get(),isGroupCall:e.isGroupConversation,isFirstCall:e.isFirstCall,timeBeforeFirstCallInSec:e.timeBeforeFirstCallInSec,isPreheated:e.isPreheated,noiseSuppressionMode:e.noiseSuppressionMode,isModerated:e.isModerated,isNoiseSuppressionAvailable:e.isNoiseSuppressionAvailable}),d.default.getS4LCMCFeatures().enablePerfomanceTelemetry){const t=u.default.getPerformanceMetrics();t&&t.systemUsageInfo&&u.default.isTracking()&&(this._callPerformanceTelemetryEvents[e.callId]=new P.CallPerformanceEvent(e.callId,t.systemUsageInfo.cpuSpeed,t.systemUsageInfo.cpuModel,t.systemUsageInfo.cores),this._callPerformanceTelemetryTokens[e.callId]=u.OnMetricsUpdated.subscribe((()=>this._updatePerformanceEvent(e.callId))),u.default.startTrackingPerformance())}b.track(new p.CallEntryPoint(e.callId,e.origin,e.conversationId,e.isGroupConversation,e.isVideoCall,e.isPstnCall,e.isIncomingCall,!1,e.causeId))}}onCallDisposed(e,t,i){var o;if(E.default.getActiveSession()&&(b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] onCallDisposed, causeId: ${i}`),E.default.completeSession(),this.updateCallTelemetry(e.callId,i,(e=>e.callRosterClosedCount()))),e.failureType!==r.FailureType.CallSetupFailed&&e.durationSeconds>0?(this._maybeCompleteCallRecordingEvent(e.callId,i),this._maybeCompleteCallCaptioningEvent(e.callId,i),this._maybeCompleteNdiEvent(e.callId),this.onStopTogetherMode(e.callId,i),this.onStopGridView(e.callId,i),this.updateCallTelemetry(e.callId,i,(o=>{b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onCallDisposed, sending Call event for callId: "+e.callId+" causeId: "+i),o.isConversationAccepted(t),o.setIsCallCreator(e.isCallCreator),o.setCallConversationMriNamespace(m.getMriNamespace(e.conversationMri)),o.setCallDurationSeconds(e.durationSeconds),o.setIsPSTNCall(!!e.isPSTNCall),o.setCallReconnectTelemetry(),o.setHadNativeIncomingCallNotificationsEnabled(d.default.isNativeIncomingCallNotificationsEnabled()),this._trackMicAndVideoToggleDurations(o,e.callId);const a=this._micButtonClickEvents[e.callId];a&&(a.forEach((()=>o.failedToggleMic())),delete this._micButtonClickEvents[e.callId]),this._hangUpButtonClickEvents[e.callId]&&(o.failedHangUp(),delete this._hangUpButtonClickEvents[e.callId]),this._videoButtonClickEvents[e.callId]&&(o.failedToggleVideo(),delete this._videoButtonClickEvents[e.callId]),b.track(o)})),_.default.trackMeetNowCallIfValid(e.conversationMri),f.default.trackMeetNowCallIfValid(e.conversationMri)):(_.default.finishScenario(),f.default.finishScenario()),d.default.getS4LCMCFeatures().enablePerfomanceTelemetry&&this._callPerformanceTelemetryTokens[e.callId]){null===(o=this._callPerformanceTelemetryTokens[e.callId])||void 0===o||o.unsubscribe();const t=this._callPerformanceTelemetryEvents[e.callId];t&&b.track(t),this._callPerformanceTelemetryTokens[e.callId]=void 0,this._callPerformanceTelemetryEvents[e.callId]=void 0}this._sendCallAVSettingsPopupEvents(),delete this._notificationFailureEvents[e.callId],delete this._startRingingEvents[e.callId],delete this._stopRingingEvents[e.callId],delete this._callTelemetryEvents[e.callId]}updateCallTelemetry(e,t,i){const o=this._callTelemetryEvents[e];o?i(o):b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper]","updateCallTelemetry","Attempted to access telemetry event for callId:",e,"causeId:",t)}maybeSendInviteFreeDeclinedEvent(e,t,i,o){m.isSkypeIdMri(t)&&!i&&b.track(new p.CallActionInviteFreeDecline(e))}trackInCallReaction(e,t,i,o,a){b.track(new p.InCallReaction(e,t,i,o,a))}trackInCallUFD(e,t,i){b.track(new p.InCallUFD(e,t,i))}trackOverflowMenuActions(e){const t=a.size(e),i=e[0]||"None",o=e[1]||"None";b.track(new p.OverflowMenuOpenedEvent(t,i,o))}trackInCallActivity(e,t,i){const o=C.getCorrelationIdFromMessageParts(I.default.getSkypeMri(),t,i);b.track(new p.InCallActivity(e,o))}trackCallViewMenuActions(e){b.track(new p.CallViewMenuActionEvent(e))}trackCallPreview(e,t,i,o,a){b.track(new p.CallPreviewEvent(e,t,i,o,a))}trackRingTheGroup(e){b.track(new p.RingTheGroupEvent(e))}trackRinglessCallInterstitial(e,t){b.track(new p.RinglessCallInterstitialEvent(e,t))}trackCalleePresence(e,t,i){a.each(t,(t=>i(t).then((t=>b.track(new p.CallActionCalleeUserPresence(e,t))))))}trackCallIntention(e,t,i,o){b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackCallIntention causeId: ${o}.`);const a=m.isGroupConversation(t),n=m.isPhoneMri(t),s=d.default.getS4LCMCFeaturesNoSubscription().clientCountry;b.track(new p.CallIntention(e,t,a,i,n,s,o)),this._maybeTrackCallInitFailure(o,e)}trackMicButtonClick(e,t,i=g.CallUIState.Default){if(i!==g.CallUIState.Default)return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][trackMicButtonClick] Not tracking Mic button click as call is not connected. callId=${e}, causeId=${t}`);b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][trackMicButtonClick] callId=${e}, causeId=${t}`),this.updateCallTelemetry(e,t,(e=>e.micButtonPress()));const o={causeId:t,time:Date.now()},a=this._micButtonClickEvents[e];a?a.push(o):this._micButtonClickEvents[e]=[o]}trackMicStateChange(e,t){const i=this._micButtonClickEvents[e],o=null==i?void 0:i.findIndex((e=>e.causeId===t));if(i&&void 0!==o&&o>=0){const n=i[o],s=Date.now()-n.time;var a=this._micToggleDurations.get(e);a?a.push(s):a=[s],this._micToggleDurations.set(e,a),i.splice(o,1),b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][trackMicStateChange] callId=${e}, causeId=${t}, time=${s} ms`)}else b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][trackMicStateChange] Not tracking Mic state change as related click event not found. callId=${e}, causeId=${t}`)}trackStartRinging(e,t){if(this._startRingingEvents[e])return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackStartRinging - duplicate event for callId ${e} skipped.`);const i=new p.CallActionStartRinging(e,t);this._startRingingEvents[e]={startRingingTime:Date.now(),startRingingEvent:i},b.track(i)}trackStopRinging(e,t,i){if(this._stopRingingEvents[e])return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackStopRinging - duplicate event for callId ${e} skipped.`);const o=this._startRingingEvents[e];if(!o)return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackStopRinging - related startRinging event for callId ${e} not found.`,`reason: ${p.CalleeStopRingingReason[t]}`,i?`(${i})`:"");const a=Date.now()-o.startRingingTime,n=new p.CallActionStopRinging(e,t,a,i);b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackStopRinging callId: ${e} ringingDuration: ${a}ms`,`reason: ${p.CalleeStopRingingReason[t]}`,i?`(${i})`:""),this._stopRingingEvents[e]=n,b.track(n)}trackIncomingCallNotificationFailure(e,t,i,o,a){if(this._notificationFailureEvents[e])return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackIncomingCallNotificationFailure - duplicate event for callId ${e} skipped.`);const n=new p.IncomingCallNotificationFailure(e,t,i,o,a);this._notificationFailureEvents[e]=n,b.track(n)}trackReconnectCallSinceCallStarted(e,t,i){const o=Date.now(),a=i?Math.floor((o-(null==i?void 0:i.getTime()))/1e3):0;a>0&&b.track(new p.CallReconnectSinceStartedEvent(e,t,a))}trackAudioOutputRouteChange(e,t){const i=e!==t;b.track(new p.AudioOutputRouteChangedEvent(e,t,i))}trackSystemHotKey(e){b.track(new p.SystemHotKeyCallEvent(e))}onIncomingCallNotification(e,t){const i=N.default.newGuid();return this._waitForIds().then((()=>{if(e.eventType!==M.PNHEvents.IncomingNGCStopRinger)this._sendCallNotificationEvent(e,t),e.isDuplicate||e.eventType===M.PNHEvents.IncomingP2PCall||e.eventType===M.PNHEvents.IncomingGoLiveStart||this._beginTrackingIncomingCall(i,e,t);else{}})),i}onStopCallNotification(e,t){this._waitForIds().then((()=>this._sendCallNotificationEvent(e,t)))}trackIncomingVideoNotification(e,t,i){const o=e?p.IncomingVideoNotificationAction.Pressed:p.IncomingVideoNotificationAction.Displayed,s=a.isUndefined(i)?n.IncomingVideoNotificationOrigin[n.IncomingVideoNotificationOrigin.NotSpecified]:n.IncomingVideoNotificationOrigin[i];b.track(new p.IncomingVideoNotification(s,t,o))}trackTouchBarButtonClick(e,t){b.track(new p.TouchBarButtonClickEvent(e,t))}trackSlimCoreInvalidCallStatusTransitionCallError(e,t,i,o,a){b.track(new p.CallSlimCoreError(e,p.CallSlimCoreErrorType.InvalidCallStatusTransition,t,i,o,a))}_sendCallNotificationEvent(e,t){b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] Sending call notification telemetry for callId: "+e.callId+" source: "+e.source+" causeId: "+t),l.all([this._waitForIds(),L.EnsureStarted(D.default)]).then((()=>{const i=W._hydrateInfo(e);b.track(new p.CallActionPushNotification(i,x.default.CallingNodeId.get(),x.default.EdfRegistrationId.get(),t))}))}static _hydrateInfo(e){return Object.assign(Object.assign({},e),{hasRegistered:D.default.hasRegisteredWithService(),isStarted:R.default.isUIDisplayed()})}_beginTrackingIncomingCall(e,t,i){l.all([this._waitForIds(),L.EnsureStarted(D.default)]).then((()=>{const o=W._hydrateInfo(t),a={ActivationState:s.Types.AppActivationState[s.App.getActivationState()],EventType:o.eventType,HasRegistered:o.hasRegistered,IsStarted:o.isStarted,Source:o.source,TimeWaitingToProcess:Math.max(0,o.pushProcessedTime-o.pushReceivedTime)};let n=this._incomingCallScenarios[e];if(!n){b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper]_beginTrackingIncomingCall, Starting incoming call scenario telemetry for scenarioId: "+e+" source: "+o.source+" causeId: "+i);const t={CallId:o.callId,NodeId:x.default.CallingNodeId.get()||"",RegistrationId:x.default.EdfRegistrationId.get()||""};o.participantId&&(t.ParticipantId=o.participantId),n=new O.default(A.ScenarioName.IncomingCall,e,t),this._incomingCallScenarios[e]=n;let s=o.pushReceivedTime||o.pushProcessedTime;if(s<=0){const e="[CallTelemetryHelper] Received invalid incoming call scenario start time";b.error(y.LogTraceArea.Calling,e),s=Date.now()}n.start(a,s)}this.markIncomingCallStep(e,p.IncomingCallStep.NotificationReceived,i,a,o.pushProcessedTime-o.pushReceivedTime)}))}markIncomingCallStep(e,t,i,o,a){this._waitForIds().then((()=>{var n;this._incomingCallScenarios[e]&&(b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] markIncomingCallStep, marking incoming call scenario step for scenarioId: "+e+" step: "+p.IncomingCallStep[t]+" causeId: "+i),null===(n=this._incomingCallScenarios[e])||void 0===n||n.markStepCompleted(p.IncomingCallStep[t],o,a))}))}endTrackingIncomingCall(e,t,i){this._waitForIds().then((()=>{if(!this._incomingCallScenarios[e])return void b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingIncomingCall, unable to end tracking unknown incoming call: "+e+" causeId: "+t);const o=this._incomingCallScenarios[e];b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingIncomingCall, completing incoming call scenario telemetry for scenarioId: "+e+" reason: "+(i?p.IncomingCallEndReason[i.reason]:"success")+" causeId: "+t),i?null==o||o.fail(p.IncomingCallEndReason[i.reason],i.details):null==o||o.finish(),delete this._incomingCallScenarios[e]}))}checkCrashedCalls(){L.EnsureStarted(v.default).then((()=>{const e=v.default.getData(S.InternalKeys.ActiveCalls);e&&e.length&&(b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] checkCrashedCalls, reporting crashed calls: ${JSON.stringify(e)}`),this.updateActiveCalls(void 0),x.default.CallingNodeId.waitUntilSet().then((()=>{a.each(e,(e=>{b.track(new p.CallCrashEvent(e.callId,e.state,x.default.CallingNodeId.get(),e.participantId,e.endpointId))}))})))}))}updateActiveCalls(e){v.default.putData(S.InternalKeys.ActiveCalls,e)}_getCallAddPhotosEvent(e){return e?this._callAddPhotoTelemetryEvents[e]:void 0}initCallAddPhotosEvent(e,t,i,o=!1){if(this._getCallAddPhotosEvent(e))return;const a=m.isGroupConversation(t);this._callAddPhotoTelemetryEvents[e]=o?new p.CallAddPhotosWithFabEvent(e,a,i):new p.CallAddPhotosEvent(e,a,i)}markPhotosSentCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i?(i.setPhotosSent(t),i.setNumberOfPhotos(1)):b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] markPhotosSentCallAddPhotosEvent, no callAddPhotos Event")}markPhotosSelectedCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setMediaPickerPhotosSelected(t)}markFromMediaPickerAndNumberOfPhotosCallAddPhotosEvent(e,t,i){const o=this._getCallAddPhotosEvent(e);o&&(o.setPhotosSent(!0),o.setFromMediaPicker(t),o.setNumberOfPhotos(i))}markPhotoTakenCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setPhotoTaken(t)}completeCallAddPhotosEvent(e){const t=this._getCallAddPhotosEvent(e);t&&(b.track(t),delete this._callAddPhotoTelemetryEvents[e])}onStartRecording(e,t){this._callRecordingEvents[e]?b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartRecording, recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startRecordingCount()})),b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartRecording, callId: "+e+" causeId: "+t),this._callRecordingEvents[e]={recordingStartTime:Date.now(),callRecordingEvent:new p.CallRecordingEvent(e)})}onStopRecording(e,t){this._maybeCompleteCallRecordingEvent(e,t),this.updateCallTelemetry(e,t,(e=>{e.stopRecordingCount()}))}onStartPstnTranslationClicked(e,t){this.updateCallTelemetry(e,t,(e=>{e.startPstnTranslationClickedCount()}))}onStartCaptions(e,t,i,o,a,n,s,r){this._callCaptioningEvents[e]?b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartCaptions, captioning event already exists for callId: "+e+" causeId: "+r):(this.updateCallTelemetry(e,r,(e=>{e.startCaptioningCount(),s&&e.setInitialCaptionPositionMode(s)})),b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartCaptions, callId: "+e+" causeId: "+r),this._callCaptioningEvents[e]={captioningStartTime:Date.now(),callCaptioningEvent:new p.CallCaptioningEvent(e,t,i,o,a,n)})}onStopCaptions(e,t){this._maybeCompleteCallCaptioningEvent(e,t),this.updateCallTelemetry(e,t,(e=>{e.stopCaptioningCount()}))}onStartCustomVoice(e,t,i,o){this.updateCallTelemetry(e,o,(e=>{e.startCustomVoiceCount(),e.translationConsentChangeDate(t),e.translationTruvoiceConsentChangeDate(i)}))}onStopCustomVoice(e,t){this.updateCallTelemetry(e,t,(e=>{e.stopCustomVoiceCount()}))}onStartTranslationAutoDetect(e,t){this.updateCallTelemetry(e,t,(e=>{e.startTranslationAutoDetectCount()}))}onStopTranslationAutoDetect(e,t){this.updateCallTelemetry(e,t,(e=>{e.stopTranslationAutoDetectCount()}))}onStartSkypeTranslation(e,t){this.updateCallTelemetry(e,t,(e=>{e.startSkypeTranslationClickedCount()}))}onStopSkypeTranslation(e,t){this.updateCallTelemetry(e,t,(e=>{e.stopSkypeTranslationClickedCount()}))}onSkypeTranslationStarted(e,t,i,o){this.updateCallTelemetry(e,o,(e=>{e.skypeTranslationStartedCount(),e.translationConsentChangeDate(t),e.translationTruvoiceConsentChangeDate(i)}))}onSkypeTranslationStopped(e,t){this.updateCallTelemetry(e,t,(e=>{e.skypeTranslationStoppedCount()}))}onRecieveCaptions(e,t){this.updateCallTelemetry(e,t,(e=>{e.didReceiveCaptions()}));const i=this._callCaptioningEvents[e];if(i&&!i.firstCaptionReceivedTime){const o=i.captioningStartTime,a=Date.now()-o;i.firstCaptionReceivedTime=a,this.updateCallTelemetry(e,t,(e=>{e.setFirstCaptionReceivedLengthSeconds(a)}))}}onCaptionPositionModeChanged(e,t,i){var o,a;this.updateCallTelemetry(e,i,(e=>{e.didChangeCaptionsPositionMode(t)})),null===(a=null===(o=this._callCaptioningEvents[e])||void 0===o?void 0:o.callCaptioningEvent)||void 0===a||a.setPositionMode(t)}onCaptionsStartingMessageClick(e,t){var i,o;this.updateCallTelemetry(e,t,(e=>{e.didClickCaptionsStartingMessage()})),null===(o=null===(i=this._callCaptioningEvents[e])||void 0===i?void 0:i.callCaptioningEvent)||void 0===o||o.startMessageClicked()}onFailedCaptionsConfig(e,t){this.updateCallTelemetry(e,t,(e=>{e.failedCaptioningConfigCount()}))}onPstnTranslationLanguageChange(e,t,i,o,a,n){const s=new p.CallPstnTranslationLanguageChangeEvent(e,null!=t?t:"",o,a,i);b.track(s)}onPstnTranslationSettingsOpened(e,t){const i=new p.CallPstnTranslationSettingsOpened(e,null!=t?t:"");b.track(i)}onSetReceiverSetup(e,t){this.updateCallTelemetry(e,t,(e=>{e.receiverSetupCount()}))}onStartTogetherMode(e,t){this._callTogetherModeEvents[e]?b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartTogetherMode recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startTogetherMode()})),b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartTogetherMode callId: "+e+" causeId: "+t),this._callTogetherModeEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new p.CallFullScreenBotEvent(e,T.BotType[T.BotType.Audience])})}onStopTogetherMode(e,t){const i=this._callTogetherModeEvents[e];if(!i)return;b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStopTogetherMode, callId: "+e+" causeId: "+t);const o=i.callFullScreenBotEvent;if(!o)return;o.setBotOnCallLengthSeconds((Date.now()-i.botAddedStartTime)/1e3);const a=o.getBotOnCallUselessTime();0!==a&&o.addBotOnCallUselessLengthSeconds((Date.now()-a)/1e3),b.track(i.callFullScreenBotEvent),delete this._callTogetherModeEvents[e]}onTogetherModeFailed(e,t,i){b.track(new p.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,T.BotType[T.BotType.Audience]))}onGridViewFailed(e,t,i){this._waitForIds().then((()=>{b.track(new p.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,T.BotType[T.BotType.GridView]))}))}onStartGridView(e,t){this._callLargeGridEvents[e]?b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartGridView, large grid event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startLargeGrid()})),b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartGridView, callId: "+e+" causeId: "+t),this._callLargeGridEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new p.CallFullScreenBotEvent(e,T.BotType[T.BotType.GridView])})}onStopGridView(e,t){const i=this._callLargeGridEvents[e];if(!i)return;b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStopGridView, callId: "+e+" causeId: "+t);const o=i.callFullScreenBotEvent;o.setBotOnCallLengthSeconds((Date.now()-i.botAddedStartTime)/1e3);const a=o.getBotOnCallUselessTime();0!==a&&o.addBotOnCallUselessLengthSeconds((Date.now()-a)/1e3),b.track(i.callFullScreenBotEvent),delete this._callLargeGridEvents[e]}onAddingBotToCall(e,t){b.track(new p.AddBotToCallEvent(e,T.BotType[t]))}onBotAddedToCall(e,t,i){b.track(new p.AddBotToCallSucceededEvent(e,T.BotType[t],i))}onBotFailed(e,t,i,o){b.track(new p.AddBotToCallFailedEvent(e,T.BotType[t],i,a.isNumber(o)?o:0))}_maybeCompleteCallRecordingEvent(e,t){const i=this._callRecordingEvents[e];if(!i)return;b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] _maybeCompleteCallRecordingEvent, callId: "+e+" causeId: "+t);i.callRecordingEvent.recordingLengthSeconds((Date.now()-i.recordingStartTime)/1e3),b.track(i.callRecordingEvent),delete this._callRecordingEvents[e]}_maybeCompleteCallCaptioningEvent(e,t){const i=this._callCaptioningEvents[e];if(!i)return;b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] _maybeCompleteCallCaptioningEvent, callId: "+e+" causeId: "+t);const o=i.callCaptioningEvent;o.setCaptioningLengthSeconds((Date.now()-i.captioningStartTime)/1e3);const a=i.firstCaptionReceivedTime;a&&o.setFirstCaptionReceivedLengthSeconds(a/1e3),b.track(i.callCaptioningEvent),delete this._callCaptioningEvents[e]}screenShareControlReceivedControlRequest(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlReceivedControlRequest()))}togetherModeSceneChangeRequestCount(e,t){this.updateCallTelemetry(e,t,(e=>e.togetherModeSceneChangeRequestCount()))}screenShareControlReceivedControlRequestCanceled(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlReceivedControlRequestCanceled()))}screenShareControlSentControlRequest(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlSentControlRequest()))}screenShareControlRequestAccepted(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlRequestAccepted()))}screenShareControlRequestDenied(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlRequestDenied()))}screenShareControlGranted(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlGranted()))}screenShareControlSharerTerminatedControl(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlSharerTerminatedControl()))}screenShareControlViewerTerminatedControl(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlViewerTerminatedControl()))}onStopScreenSharing(e,t){b.track(new p.ScreenSharingStoppedEvent(e,t))}pinToolbar(e,t){this.updateCallTelemetry(e,t,(e=>e.pinToolbar()))}unPinToolbar(e,t){this.updateCallTelemetry(e,t,(e=>e.unPinToolbar()))}setGiveControlAsPossible(e,t){this.updateCallTelemetry(e,t,(e=>e.setGiveControlAsPossible()))}onStartNdi(e,t){this._ndiEvents[e]?b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartNdi, ndi event already exists for callId: "+e):(this.updateCallTelemetry(e,"ndi-started",(e=>{e.startNdiCount()})),b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] onStartNdi, callId: "+e),this._ndiEvents[e]={broadcastingStartTime:Date.now(),broadcastingEvent:new p.NdiBroadcastEvent(e,t)})}onStopNdi(e){this._maybeCompleteNdiEvent(e),this.updateCallTelemetry(e,"ndi-stopped",(e=>{e.stopNdiCount()}))}onBlockedVideoBannerShown(e){this.updateCallTelemetry(e,"BlockedVideoBannerShown",(e=>{e.blockedVideoBannerShown()}))}onZoomIn(e){this.updateCallTelemetry(e,"ZoomedInCount",(e=>{e.zoomedIn()}))}onZoomOut(e,t,i){this.updateCallTelemetry(e,"ZoomedOutCount",(e=>{e.zoomedOut(t,i)}))}onZoomDragUsed(e){this.updateCallTelemetry(e,"ZoomDragUsed",(e=>{e.zoomDragUsed()}))}onZoomChangeType(e,t){this.updateCallTelemetry(e,"ZoomChangeType",(e=>{e.zoomChangeType(t)}))}onAudioSystemReset(e,t){this.updateCallTelemetry(e,t,(e=>{e.audioSystemResetCount()}))}onCallManagerUsed(e,t){this.updateCallTelemetry(e,t,(e=>{e.callManagerUsed()}))}setIsIgnoringBatteryOptimizations(e,t,i){this.updateCallTelemetry(e,t,(e=>{e.setIsIgnoringBatteryOptimizations(i)}))}_maybeCompleteNdiEvent(e){if(!this._ndiEvents[e])return;b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] _maybeCompleteNdiEvent, callId: "+e);const t=this._ndiEvents[e];if(!t)return;const i=t.broadcastingEvent;i.setBroadcastingLengthSeconds((Date.now()-t.broadcastingStartTime)/1e3),i.setWatermarkLocation(w.default.getWatermarkLocation()),b.track(i),delete this._ndiEvents[e]}updateNdiTelemetry(e,t){const i=this._ndiEvents[e];i&&t(i.broadcastingEvent)}updateCallRecordingTelemetry(e,t,i){const o=this._callRecordingEvents[e];o&&i(o.callRecordingEvent)}updateCallCaptioningTelemetry(e,t,i){const o=this._callCaptioningEvents[e];o&&i(o.callCaptioningEvent)}updateCallTogetherModeTelemetry(e,t){const i=this._callTogetherModeEvents[e];i&&t(i.callFullScreenBotEvent)}updateCallGridViewTelemetry(e,t){const i=this._callLargeGridEvents[e];i&&t(i.callFullScreenBotEvent)}updateTogetherModeAvailability(e,t){this.updateCallTelemetry(e,t,(e=>{e.ableToStartTogetherMode()}))}updateLargeGridAvailability(e,t){this.updateCallTelemetry(e,t,(e=>{e.ableToStartLargeGrid()}))}addCallingStoreUpdatePerformance(e,t,i){this.updateCallTelemetry(e,t,(e=>{e.addCallingStoreUpdatePerformance(i)}))}onCallNetworkErrorReason(e,t){this.updateCallTelemetry(e,"CallNetworkErrorReason",(e=>{e.setCallNetworkErrorReason(t)}))}rejoinCallTelemetry(e,t,i,o){b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] rejoinCallTelemetry callId: "+e+" causeId: "+t);const a=m.isGroupConversation(o),n=m.isPhoneMri(o);b.track(new p.CallEntryPoint(e,i,o,a,!1,n,!0,!0,t))}beginTrackingAnswerCall(e,t,i){return this._waitForIds().then((()=>{let o=this._answerCallScenarioIds[e];if(!o){o=N.default.newGuid(),b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] beginTrackingAnswerCall, starting answer call scenario telemetry for scenarioId: "+o+" causeId: "+i);const a={CallId:e,NodeId:x.default.CallingNodeId.get()||"",RegistrationId:x.default.EdfRegistrationId.get()||""};if(t){a.IsGroupCall=!m.isOneOnOneConversation(t);let e=z.None;const i=k.default.getScheduledCallByConversationId(t);i&&k.default.isScheduledCallNow(i.id)&&(e=z.ScheduleACall),a.TriggeredBy=e}const n=new O.default(A.ScenarioName.AnswerCall,o,a);this._answerCallScenarios[o]=n,this._answerCallScenarioIds[e]=o,n.setDuplicateStepMarkingEnabled(!0),n.start()}return o}))}markAnswerCallStep(e,t,i,o,a,n){this._waitForIds().then((()=>l.Resolved(this._answerCallScenarioIds[e]))).then((n=>n||(t===p.AnswerCallStep.NotifyingCallee?(B.default.notifyingCallee(a),this.beginTrackingAnswerCall(e,i,o)):l.Rejected("markAnswerCallStep, unable to mark step for unknown answer call: "+e+" causeId: "+o)))).then((e=>{var i;b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] markAnswerCallStep, marking answer call scenario step for scenarioId: "+e+" step: "+p.AnswerCallStep[t]+" causeId: "+o),null===(i=this._answerCallScenarios[e])||void 0===i||i.markStepCompleted(p.AnswerCallStep[t],a,n)})).catch((e=>b.warn(y.LogTraceArea.Calling,`[CallTelemetryHelper] markAnswerCallStep catch: ${V.default.errorAsString(e,!0)}`)))}endTrackingAnswerCall(e,t,i){this._waitForIds().then((()=>{const o=this._answerCallScenarioIds[e];if(!o)return void b.warn(y.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingAnswerCall, unable to end tracking unknown answer call: "+o+" causeId: "+t);const a=this._answerCallScenarios[o];b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingAnswerCall, completing answer call scenario telemetry for scenarioId: "+o+" reason: "+(i?p.AnswerCallEndReason[i.reason]:"success")+" causeId: "+t),i?null==a||a.fail(p.AnswerCallEndReason[i.reason],i.details):null==a||a.finish(),delete this._answerCallScenarios[o],delete this._answerCallScenarioIds[e]}))}onCalleeAnsweredCall(e,t,i){this._callConnectedOnAnswerEvents[e]||(this._callConnectedOnAnswerEvents[e]=new p.CallConnectedOnAnswerEvent(e,t,(t=>{b.track(t),delete this._callConnectedOnAnswerEvents[e]}),i))}onCallStateConnected(e){const t=this._callConnectedOnAnswerEvents[e];t&&t.markConnectedState()}trackAnswerOrJoinCall(e,t,i){b.track(new p.AnswerOrJoinCallEvent(e,i,t))}trackVideoButtonClick(e,t){this._videoButtonClickEvents[e]&&(this.updateCallTelemetry(e,t,(e=>e.failedToggleVideo())),delete this._videoButtonClickEvents[e]),this._videoButtonClickEvents[e]=Date.now()}trackVideoStateChange(e,t){const i=this._videoButtonClickEvents[e];if(!i)return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackVideoStateChange - related videoButtonClick event for callId ${e} not found.`);const o=Date.now()-i;var a=this._videoToggleDurations.get(e);a?a.push(o):a=[o],this._videoToggleDurations.set(e,a),delete this._videoButtonClickEvents[e]}trackHangUpButtonClick(e,t){this._hangUpButtonClickEvents[e]&&(this.updateCallTelemetry(e,t,(e=>e.failedHangUp())),delete this._hangUpButtonClickEvents[e]),this._hangUpButtonClickEvents[e]=Date.now(),this.trackUserAction(p.CallUserActionType.EndCall,e,t,y.NavigationCallOrigin.CallControls)}trackHangUpStateChange(e,t){const i=this._hangUpButtonClickEvents[e];if(!i)return void b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper] trackHangUpButtonClick - related hangUpButtonClick event for callId ${e} not found.`);const o=Date.now()-i;this.updateCallTelemetry(e,t,(e=>e.setHangUpDuration(o))),delete this._hangUpButtonClickEvents[e]}trackUserAction(e,t,i,o){b.track(new p.CallUserActionEvent(e,t,i,o))}onReceivedNativeNotificationForIncomingRing(e,t){this._timeToDisplayIncomingCallScreenEvents[e]||(this._timeToDisplayIncomingCallScreenEvents[e]=new p.IncomingCallScreenDisplayedEvent(e,t,(t=>{delete this._timeToDisplayIncomingCallScreenEvents[e],b.track(t)})))}onCallPanelRendered(e){const t=this._timeToDisplayIncomingCallScreenEvents[e];t&&t.markIncomingCallScreenDisplayed()}onGoLiveStart(e,t){if(!e||!t)return;let i,o;b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][onGoLiveStart] callId=${e}, conversation=${H.mriOrId(t)}`);const a=(0,j.default)(),n=()=>{void 0!==o&&(a.unsubscribe(o),o=void 0)},s=c.default.setTimeout((()=>{b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][onGoLiveStart] LiveState detection timeout, callId=${e} otherActiveCallId=${i}`),b.track(new p.LiveStateDetectionTimeoutEvent(e,i)),n()}),10*F.SECOND);o=a.subscribe((()=>{var o,r;const l=null===(r=null===(o=a.getConversation(t))||void 0===o?void 0:o.validLiveState())||void 0===r?void 0:r.conversationId;l===e?(b.log(y.LogTraceArea.Calling,`[CallTelemetryHelper][onGoLiveStart] LiveState detected, callId=${e}`),c.default.clearTimeout(s),n()):void 0!==l&&(i=l)}))}_maybeTrackCallInitFailure(e,t){this._callIntents[e]=t,U.default.setTimeout((()=>{this._callIntents[e]&&(b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper] Call is not initialized within 5 seconds after clicking Start call.",`CauseId: ${e}`),b.track(new p.CallInitFailure(e,t)),delete this._callIntents[e])}),G)}_trackMicAndVideoToggleDurations(e,t){this._trackButtonToggleDurations(e,!1,this._micToggleDurations.get(t)),this._micToggleDurations.delete(t),this._trackButtonToggleDurations(e,!0,this._videoToggleDurations.get(t)),this._videoToggleDurations.delete(t)}_trackButtonToggleDurations(e,t,i){const o=null==i?void 0:i.sort((function(e,t){return e-t}));if(o&&o.length>0){const i=o[0];e.setButtonToggleBestDuration(t,i);const a=o[Math.floor(o.length/2)];e.setButtonToggleMedianDuration(t,a);const n=o[o.length-1];e.setButtonToggleWorstDuration(t,n)}}test_getAnswerCallScenarios(){return this._answerCallScenarios}test_resetAnswerCallScenarios(){this._answerCallScenarios={},this._answerCallScenarioIds={}}trackCallParticipantRendererIsRendering(e){const t=this._callParticipantRendererIsRenderingEvents[e];t&&(b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper]","[trackParticipantRendererIsRendering]",t.toString()),b.track(t),delete this._callParticipantRendererIsRenderingEvents[e])}static _generateCallParticipantKey(e,t,i){return e+t+i}onCallParticipantRendererCreated(e,t,i,o){const a=W._generateCallParticipantKey(e,t,i);this._callParticipantRendererIsRenderingEvents[a]?b.log(y.LogTraceArea.Calling,"[CallTelemetryHelper]","[onCallParticipantRendererCreated]",`telemetry event already created for callId: ${e} and participantMri: ${H.mriOrId(i)},`,`other parameters isRendering: ${o} origin ${t}`):this._callParticipantRendererIsRenderingEvents[a]=new p.CallParticipantRendererIsRenderingEvent(e,H.mriOrId(i),t,(()=>{this.trackCallParticipantRendererIsRendering(a)}))}onCallParticipantRendererIsRendering(e,t,i){const o=W._generateCallParticipantKey(e,t,i),a=this._callParticipantRendererIsRenderingEvents[o];a&&a.markIsRenderingState()}trackOutgoingCallNavigationStarted(e){this._outgoingCallNavigationFinishedEvents[e]=new p.OutgoingCallNavigationFinishedEvent(e,Date.now(),(t=>{b.track(t),delete this._outgoingCallNavigationFinishedEvents[e]}))}onOutgoingCallNavigationFinished(e){const t=this._outgoingCallNavigationFinishedEvents[e];t&&t.markOutgoingCallNavigationFinished()}}t.default=new W},572095:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isValidTranscriptionMessage=function(e,t){const i=n.default.CallingStore.currentCallId(e),o=n.default.CallingStore.getParticipantId(i);if(!o)return!1;const c=r.default.parseJsonErrorToUndefined(t.content);if(!c||!c.sender||!c.receivers||0===c.receivers.length||!c.message&&!c.translation)return s.warn(l.LogTraceArea.CallReactions,"[isValidTranscriptionMessage] Invalid transcription payload: "+a.pii.Omit(t.content)),!1;if(!c.receivers.includes(o))return s.warn(l.LogTraceArea.CallReactions,`[isValidTranscriptionMessage] Participant ${o} not part of recipients [${c.receivers.join(",")}]`),!1;return!0};const o=i(197582),a=i(174958),n=o.__importDefault(i(369347)),s=o.__importStar(i(85385)),r=o.__importDefault(i(655192)),l=i(815146)},939304:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeAll=function(e){a.default.removeAllFromCategory(e,a.ToastCategory.Captions)},t.removeId=S,t.addStartMessage=function(e,t){return f(a.ToastType.CaptionsStart,{callId:e,text:t})},t.addErrorMessage=function(e){const t=a.ToastType.CaptionsError;return c.track(new d.CaptionsNotificationDisplayedEvent(e,t.toString(),void 0)),f(t,{callId:e,text:s.getString("CallTranscriptionNotifications.Error"),icon:n.SkypeIcon.CallWarning,iconColorOverride:l.Color.red,dismissable:!0})},t.addSameLanguageMessage=function(e,t,i=!1){const o=a.ToastType.CaptionsLanguageChange;if(P(o,e,void 0,void 0))return;const n=i?"CallTranscriptionNotifications.SameLanguageB":"CallTranscriptionNotifications.SameLanguageA";return c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),i)),f(o,{callId:e,text:s.getString(n),dismissable:!0,buttons:[{label:s.getString(i?"CallTranscriptionNotifications.Keep":"CallTranscriptionNotifications.StopTranslation"),action:v(e,o,i,d.NotificationActionButtonType.Primary,null==t?void 0:t[0])},{label:s.getString(i?"CallTranscriptionNotifications.Dismiss":"CallTranscriptionNotifications.Keep"),action:v(e,o,i,d.NotificationActionButtonType.Secondary,null==t?void 0:t[1])}]})},t.removeLanguageChangeDetectedMessage=T,t.addLanguageChangeDetectedMessage=function(e,t,i,o,n=!1){const l=a.ToastType.CaptionsParticipantLanguageChange;b(e,t);const u=i.split("-")[0],h=r.getLanguageOnlyTitle(u);if(P(l,e,t,u))return;T(e,t);const p=I(e,t),g=n?s.getString("CallTranscriptionNotifications.LanguageChangeDetectedB",{language:h,name:p}):s.getString("CallTranscriptionNotifications.LanguageChangeDetectedA",{language:h,name:p}),C={callId:e,participantId:t,text:g,dismissable:!0,buttons:[(null==o?void 0:o[0])?{label:s.getString(n?"CallTranscriptionNotifications.Revert":"CallTranscriptionNotifications.Change",{language:h}),action:v(e,l,n,d.NotificationActionButtonType.Primary,null==o?void 0:o[0])}:void 0]},S=_(l,t);return S?(a.default.updateToast(S.id,C)&&m.default.maybeAnnounceForAccessibility(C.text),S.id):(c.track(new d.CaptionsNotificationDisplayedEvent(e,l.toString(),n)),f(l,C))},t.removeUnableDetectLanguageMessage=b,t.addUnableDetectLanguageMessage=function(e,t,i,o){const n=a.ToastType.CaptionsLanguageDetectionError;if(P(n,e,t,void 0))return;T(e,t);const r=I(e,t),l=o?s.getString("CallTranscriptionNotifications.UnableDetectLanguageTextB",{name:r}):s.getString("CallTranscriptionNotifications.UnableDetectLanguageTextA",{name:r}),u=_(n,t);return u?u.id:(c.track(new d.CaptionsNotificationDisplayedEvent(e,n.toString(),o)),f(n,{callId:e,participantId:t,text:l,dismissable:!0,buttons:[{label:s.getString(o?"CallTranscriptionNotifications.Keep":"CallTranscriptionNotifications.SetUp"),action:v(e,n,o,d.NotificationActionButtonType.Primary,null==i?void 0:i[0])},{label:s.getString(o?"CallTranscriptionNotifications.SetUp":"CallTranscriptionNotifications.StopTranslation"),action:v(e,n,o,d.NotificationActionButtonType.Secondary,null==i?void 0:i[1])}]}))},t.addTranslationConsentMessage=function(e,t){const i=a.ToastType.CaptionsTranslationConsent,o=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),y(i,{callId:e,icon:n.SkypeIcon.Translate,title:s.getString("CallTranscriptionNotifications.TranslationConsentTitle"),text:s.getString("CallTranscriptionNotifications.TranslationConsentText"),subtitle:s.getString("CallTranscriptionNotifications.TranslationConsentSubtitle"),subtext:[s.getString("CallTranscriptionNotifications.TranslationConsentSubtext1"),s.getString("CallTranscriptionNotifications.TranslationConsentSubtext2",{featureName:o}),s.getString("CallTranscriptionNotifications.TranslationConsentSubtext3")],link:{text:s.getString("CallTranscriptionNotifications.TranslationConsentLearnMore"),url:C.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:s.getString("CallTranscriptionNotifications.TranslationConsentSendRequest"),action:v(e,i,void 0,d.NotificationActionButtonType.Primary,t[0])},{label:s.getString("CallTranscriptionNotifications.TranslationConsentMaybeLater"),action:v(e,i,void 0,d.NotificationActionButtonType.Secondary,t[1])}]})},t.addTranslationConsentSentMessage=function(e,t){const i=a.ToastType.CaptionsTranslationRequestSent;return c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),f(i,{callId:e,text:s.getString("CallTranscriptionNotifications.TranslationConsentSentText"),dismissable:!0,buttons:[{label:s.getString("CallTranscriptionNotifications.TranslationConsentSentGotIt"),action:v(e,i,void 0,d.NotificationActionButtonType.Primary,t[0])},{label:s.getString("CallTranscriptionNotifications.TranslationConsentSentCancel"),action:v(e,i,void 0,d.NotificationActionButtonType.Secondary,t[1])}]})},t.addTranslationConsentQuestionMessage=function(e,t,i){const o=a.ToastType.CaptionsTranslationConsentRequest,r=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const l=s.getString("CallTranscriptionNotifications.TranslationConsentQuestionTitle",{name:null!=t?t:s.getString("CallTranscriptionNotifications.OtherUser")});return y(o,{callId:e,icon:n.SkypeIcon.Translate,title:l,text:s.getString("CallTranscriptionNotifications.TranslationConsentText"),subtitle:s.getString("CallTranscriptionNotifications.TranslationConsentSubtitle"),subtext:[s.getString("CallTranscriptionNotifications.TranslationConsentSubtext1"),s.getString("CallTranscriptionNotifications.TranslationConsentSubtext2",{featureName:r}),s.getString("CallTranscriptionNotifications.TranslationConsentSubtext3")],link:{text:s.getString("CallTranscriptionNotifications.TranslationConsentLearnMore"),url:C.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:s.getString("CallTranscriptionNotifications.TranslationConsentQuestionTranslate"),action:v(e,o,void 0,d.NotificationActionButtonType.Primary,i[0])},{label:s.getString("CallTranscriptionNotifications.TranslationConsentQuestionNoTranks"),action:v(e,o,void 0,d.NotificationActionButtonType.Secondary,i[1])}]})},t.addTranslationRejectedMessage=function(e,t){const i=a.ToastType.CaptionsTranslationRejected;c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const o=f(i,{callId:e,text:s.getString("CallTranscriptionNotifications.TranslationRejectedText"),dismissable:!0});o&&t&&g.default.setTimeout((()=>{a.default.removeToast(o)}),t);return o},t.addTranslationCancelledMessage=function(e,t){const i=a.ToastType.CaptionsTranslationCancelled;c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const o=f(i,{callId:e,text:s.getString("CallTranscriptionNotifications.TranslationCancelledText"),dismissable:!0});o&&t&&g.default.setTimeout((()=>{a.default.removeToast(o)}),t);return o},t.addTranslationStoppedMessage=function(e,t,i){const o=a.ToastType.CaptionsTranslationStopped;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const n=t?s.getString("CallTranscriptionNotifications.TranslationStoppedTextName",{name:t}):s.getString("CallTranscriptionNotifications.TranslationStoppedText"),r=f(o,{callId:e,text:n,dismissable:!0});r&&i&&g.default.setTimeout((()=>{a.default.removeToast(r)}),i);return r},t.addTranslationNotSuppportedMessage=function(e,t,i){const o=a.ToastType.CaptionsTranslationNotSupported;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const n=s.getString("CallTranscriptionNotifications.TranslationNotSuppportedText"),r=f(o,{callId:e,text:n,dismissable:!0,buttons:[{label:s.getString("CallTranscriptionNotifications.TranslationNotSuppportedGotIt"),action:v(e,o,void 0,d.NotificationActionButtonType.Primary,t[0])}]});r&&i&&g.default.setTimeout((()=>{a.default.removeToast(r)}),i);return r},t.addTranslationEnabledMessage=function(e,t,i){const o=a.ToastType.CaptionsTranslationEnabled;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const n=t?s.getString("CallTranscriptionNotifications.TranslationEnabledTextName",{name:t}):s.getString("CallTranscriptionNotifications.TranslationEnabledText"),r=f(o,{callId:e,text:n,dismissable:!0});r&&i&&g.default.setTimeout((()=>{a.default.removeToast(r)}),i);return r},t.addTruVoiceAvailableMessage=function(e,t,i){const o=a.ToastType.CaptionsTruVoiceEnable,n=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const r=f(o,{callId:e,text:s.getString("CallTranscriptionNotifications.TruVoiceConsentText",{featureName:n}),dismissable:!0,buttons:[{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentLearnMore"),action:v(e,o,void 0,d.NotificationActionButtonType.Primary,t[0])},{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentMaybeLater"),action:v(e,o,void 0,d.NotificationActionButtonType.Secondary,t[1])}]});r&&i&&g.default.setTimeout((()=>{a.default.removeToast(r)}),i);return r},t.addTruVoiceConsentMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceConsent,o=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),y(i,{callId:e,icon:n.SkypeIcon.MicrophoneSpark,title:s.getString("CallTranscriptionNotifications.TruVoiceConsentTitle",{featureName:o}),text:s.getString("CallTranscriptionNotifications.TruVoiceConsentText",{featureName:o}),subtitle:s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtitle"),subtext:[s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext1",{featureName:o}),s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext2",{featureName:o}),s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext3",{featureName:o})],link:{text:s.getString("CallTranscriptionNotifications.TruVoiceConsentLearnMore"),url:C.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentSendRequest"),action:v(e,i,void 0,d.NotificationActionButtonType.Primary,t[0])},{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentMaybeLater"),action:v(e,i,void 0,d.NotificationActionButtonType.Secondary,t[1])}]})},t.addTruVoiceConsentSentMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceRequestSent,o=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),f(i,{callId:e,text:s.getString("CallTranscriptionNotifications.TruVoiceConsentSentText",{featureName:o}),dismissable:!0,buttons:[{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentSentGotIt"),action:v(e,i,void 0,d.NotificationActionButtonType.Primary,t[0])},{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentSentCancel"),action:v(e,i,void 0,d.NotificationActionButtonType.Secondary,t[0])}]})},t.addTruVoiceConsentQuestionMessage=function(e,t,i){const o=a.ToastType.CaptionsTruVoiceConsentRequest,r=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0)),y(o,{callId:e,icon:n.SkypeIcon.MicrophoneSpark,title:s.getString("CallTranscriptionNotifications.TruVoiceConsentQuestionTitle",{name:null!=t?t:s.getString("CallTranscriptionNotifications.OtherUser"),featureName:r}),text:s.getString("CallTranscriptionNotifications.TruVoiceConsentText",{featureName:r}),subtitle:s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtitle"),subtext:[s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext1",{featureName:r}),s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext2",{featureName:r}),s.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext3",{featureName:r})],link:{text:s.getString("CallTranscriptionNotifications.TruVoiceConsentLearnMore"),url:C.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentQuestionActivate",{featureName:r}),action:v(e,o,void 0,d.NotificationActionButtonType.Primary,i[0])},{label:s.getString("CallTranscriptionNotifications.TruVoiceConsentQuestionNoThanks"),action:v(e,o,void 0,d.NotificationActionButtonType.Secondary,i[1])}]})},t.addTruVoiceRejectedMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceRejected,o=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const n=f(i,{callId:e,text:s.getString("CallTranscriptionNotifications.TruVoiceRejectedText",{featureName:o}),dismissable:!0});n&&t&&g.default.setTimeout((()=>{a.default.removeToast(n)}),t);return n},t.addTruVoiceCancelledMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceCancelled,o=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;c.track(new d.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const n=f(i,{callId:e,text:s.getString("CallTranscriptionNotifications.TruVoiceCancelledText",{featureName:o}),dismissable:!0});n&&t&&g.default.setTimeout((()=>{a.default.removeToast(n)}),t);return n},t.addTruVoiceStoppedMessage=function(e,t,i){const o=a.ToastType.CaptionsTruVoiceStopped,n=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const r=t?s.getString("CallTranscriptionNotifications.TruVoiceStoppedTextName",{name:t,featureName:n}):s.getString("CallTranscriptionNotifications.TruVoiceStoppedText",{featureName:n}),l=f(o,{callId:e,text:r,dismissable:!0});l&&i&&g.default.setTimeout((()=>{a.default.removeToast(l)}),i);return l},t.addTruVoiceEnabledMessage=function(e,t,i){const o=a.ToastType.CaptionsTruVoiceEnabled,n=C.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;c.track(new d.CaptionsNotificationDisplayedEvent(e,o.toString(),void 0));const r=t?s.getString("CallTranscriptionNotifications.TruVoiceEnabledTextName",{name:t,featureName:n}):s.getString("CallTranscriptionNotifications.TruVoiceEnabledText",{featureName:n}),l=f(o,{callId:e,text:r,dismissable:!0});l&&i&&g.default.setTimeout((()=>{a.default.removeToast(l)}),i);return l};const o=i(197582),a=o.__importStar(i(68210)),n=i(641400),s=o.__importStar(i(704704)),r=o.__importStar(i(94534)),l=i(16549),c=o.__importStar(i(85385)),d=i(95480),u=o.__importDefault(i(363091)),h=o.__importDefault(i(601976)),p=o.__importDefault(i(369347)),g=o.__importDefault(i(601274)),C=o.__importDefault(i(150343)),m=o.__importDefault(i(791384));function S(e){a.default.removeToast(e)}function _(e,t){const i=a.default.getToastsOfType(e).filter((e=>e.state.participantId===t)),o=i.pop();return i.forEach((e=>S(e.id))),o}function f(e,t){var i;const o=null===(i=a.default.toastForCallId(e,t,a.ToastCategory.Captions))||void 0===i?void 0:i.id,n=a.default.addCaptionsGenericToast(e,t);return o!==n&&void 0!==n&&m.default.maybeAnnounceForAccessibility(t.text),n}function y(e,t){var i;const o=null===(i=a.default.toastForCallId(e,t,a.ToastCategory.Captions))||void 0===i?void 0:i.id,n=a.default.addCaptionsGeneriConsentToast(e,t);return o!==n&&void 0!==n&&m.default.maybeAnnounceForAccessibility(t.title),n}function T(e,t){const i=a.ToastType.CaptionsParticipantLanguageChange;a.default.getToastsOfType(i).filter((e=>e.state.participantId===t)).forEach((e=>S(e.id)))}function b(e,t){const i=a.ToastType.CaptionsLanguageDetectionError;a.default.getToastsOfType(i).filter((e=>e.state.participantId===t)).forEach((e=>S(e.id)))}const v=(e,t,i,o,a)=>n=>{c.track(new d.CaptionsNotificationClickedEvent(e,t.toString(),i,o)),a()},I=(e,t)=>{let i;return p.default.CallingStore.connectedParticipants(e).forEach((e=>{var o,a;null===(a=null===(o=e.endpoints)||void 0===o?void 0:o.endpointDetails)||void 0===a||a.forEach((o=>{o.participantId===t&&(i=e.id)}))})),i?u.default.isMyMri(i)?s.getString("DisplayInfoStore.ListMyName"):h.default.getShortDisplayName(i)||t:t},w={},P=(e,t,i,o)=>{const n=`${a.ToastType[e]}-${t}-${i}-${o}`;return!!w[n]||(w[n]=(new Date).valueOf(),g.default.setTimeout((()=>{delete w[n]}),2e4),!1)}},252443:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.giveTranslationConsent=function(){a.default.setCallTranslatorTranslationConsent(!0),a.default.setCallTranslatorTranslationConsentChangeDate(Date.now())},t.resetTranslationConsent=function(){a.default.setCallTranslatorTranslationConsent(!1),a.default.setCallTranslatorTranslationConsentChangeDate(Date.now()),a.default.setCallTranslatorTranslationAutoDetectOffered(!1)},t.giveTruVoiceConsent=function(){a.default.setCallTranslatorTruVoiceConsent(!0),a.default.setCallTranslatorTruVoiceConsentChangeDate(Date.now())},t.resetTruVoiceConsent=function(){a.default.setCallTranslatorTruVoiceConsent(!1),a.default.setCallTranslatorTruVoiceConsentChangeDate(Date.now()),a.default.setCallTranslatorTruVoiceOffered(!1)},t.translationAutoDetectEnable=r,t.translationAutoDetectDisable=function(e){const t=n.default.newCauseId();a.default.setCallTranslatorTranslationAutoDetectEnabled(!1),s.default.onStopTranslationAutoDetect(e,t)},t.translationAutoDetectEnableOnFirstConsent=function(e){a.default.getCallTranslatorTranslationAutoDetectOffered()||(r(e),a.default.setCallTranslatorTranslationAutoDetectOffered(!0))},t.truVoiceEnable=function(e){if(a.default.setCallTranslatorTruVoiceEnabled(!0),e){const t=n.default.newCauseId(),i=a.default.getCallTranslatorTranslationConsentChangeDate(),o=a.default.getCallTranslatorTruVoiceConsentChangeDate();s.default.onStartCustomVoice(e,i,o,t)}},t.truVoiceDisable=function(e){if(a.default.setCallTranslatorTruVoiceEnabled(!1),e){const t=n.default.newCauseId();s.default.onStopCustomVoice(e,t)}};const o=i(197582),a=o.__importDefault(i(341994)),n=o.__importDefault(i(760989)),s=o.__importDefault(i(638260));function r(e){const t=n.default.newCauseId();a.default.setCallTranslatorTranslationAutoDetectEnabled(!0),s.default.onStartTranslationAutoDetect(e,t)}},132680:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallUIUtils=t.LocalPreviewLongerSideSize=t.ReactionButtonType=t.UnsupportedFeature=t.ServerMutedToastTimeout=t.DummyVideoSize=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(516778)),s=i(148540),r=o.__importDefault(i(150343)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(60433)),d=i(619429),u=i(460515),h=o.__importDefault(i(473304)),p=o.__importDefault(i(615364)),g=o.__importDefault(i(363394)),C=o.__importDefault(i(601976)),m=i(815146),S=o.__importDefault(i(524526)),_=o.__importStar(i(85385)),f=o.__importStar(i(704704)),y=i(44557),T=i(675862),b=o.__importDefault(i(363091)),v=o.__importDefault(i(942724)),I=o.__importDefault(i(450312)),w=i(276602),P=i(231817),M=i(602370),D=o.__importDefault(i(597285)),A=o.__importDefault(i(960282)),k=o.__importDefault(i(791384)),R=i(686196),x=o.__importStar(i(322094)),L=i(16549),B=i(641400),V=o.__importDefault(i(48076)),O=o.__importDefault(i(989819)),E=o.__importDefault(i(201721)),N=o.__importStar(i(44717)),F=o.__importDefault(i(947878)),U=o.__importDefault(i(854929)),H=o.__importDefault(i(916256)),j=o.__importDefault(i(638260)),z=o.__importDefault(i(760989)),G=o.__importDefault(i(491196));t.DummyVideoSize={height:0,width:0};const W=1e4;var K,$;t.ServerMutedToastTimeout=5e3,function(e){e[e.CallReactions=0]="CallReactions"}(K||(t.UnsupportedFeature=K={})),function(e){e[e.Celebration=0]="Celebration",e[e.Heart=1]="Heart"}($||(t.ReactionButtonType=$={}));const q={[u.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[u.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[u.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[u.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[u.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[u.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGalleryViewLabel"},Q={[u.StageMode.Speaker]:B.SkypeIcon.StartIncomingVideo,[u.StageMode.Grid]:B.SkypeIcon.GridView,[u.StageMode.FocusedScreenShare]:B.SkypeIcon.ContentView,[u.StageMode.Presentation]:B.SkypeIcon.Presenter,[u.StageMode.LargeGrid]:B.SkypeIcon.GalleryLarge,[u.StageMode.TogetherMode]:B.SkypeIcon.Audience,[u.StageMode.Manual]:B.SkypeIcon.GridView};function X(e,t){var i,o;const a=null===(i=t.endpoints)||void 0===i?void 0:i.endpointDetails;if(a)for(const t of a)if((null===(o=t.endpointMetadata)||void 0===o?void 0:o.isTwinCam)&&t.endpointId===e)return!0;return!1}t.LocalPreviewLongerSideSize=176;class Z{static _filterPerEndpointDuplicitStreams(e){const t=new Map;for(const i of e)if(i.isAvailable){const e=t.get(i.endpointId);(!e||i.rank>e.rank)&&t.set(i.endpointId,i)}return Array.from(t.values())}static elementInfoForParticipantOrScreenshare(e,t,i,o,a,n){const h=o.state,p=this.isFullScreenBot(t)?[d.VideoOverrideReason.FullScreenBot]:void 0,g=n?s.StreamType.ScreenSharing:s.StreamType.Video,C=this._isStreamAvailable(t,g,i,void 0,p),S=this._streamDimensions(t,g,i),f=!!n&&C;let y=!1;if(f){const e=l.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(i);if(e){const t=e.viewerInControl();t&&b.default.isMyMri(t.mri)&&(y=!0)}else _.warn(m.LogTraceArea.CallingUI,"Screen sharing control store is undefined")}const T=c.default.isParticipantRinging(o),v=a&&c.default.isParticipantOnHold(o),I=c.default.isParticipantMuted(o),w=!!n,P=l.default.CallingStore.getRaisedHandRankForMri(i,t),M=c.default.isParticipantTalking(o),D=t===l.default.CallScreenShareStore.getPresenter(i)&&!n,A=l.default.CallingStore.isHandRaisedForMri(t,i),k=this.isTogetherModeBot(t),R=this.isLargeGridBot(t),x=o.state;function L(e){return Boolean(e.endpointId&&X(e.endpointId,o))}const B=this._filterPerEndpointDuplicitStreams(o.streams[g]).sort(((e,t)=>t.rank-e.rank)),V=B.find((e=>!L(e))),O=B.find((e=>L(e)));B.length=0,V&&B.push(V),O&&B.push(O),r.default.getS4LCMCFeatures().enableMultipleStreamSupport||(B.length=1);let E=0;const N=B.map((e=>{const o=this._isStreamAvailable(t,g,i,e,p,e.endpointId),a=this._streamDimensions(t,g,i,e.endpointId);return o&&E++,{endpointId:e.endpointId,isTwincamEndpoint:e===O,isStreamAvailable:o,videoDimensions:a}}));let F=u.CallParticipantStreamsStatus.None;return 0!==E&&(F=E>1?u.CallParticipantStreamsStatus.Multiple:u.CallParticipantStreamsStatus.Single),{key:e,mri:t,participantState:h,isStreamAvailable:C,videoDimensions:S,isScreensharing:f,isScreenshareControlling:y,isRinging:T,isOnHold:v,isServerMuted:I,renderScreenShare:w,connectionSortKey:T?1:0,raisedHandRank:P,isTalking:M,isHandRaised:A,isPresenter:D,state:x,streamsStatus:F,streams:N,isLargeGridBot:R,isTogetherModeBot:k}}static getLocalMediaStreams(e,t){const i=b.default.getSkypeMri(),o=l.default.CallingStore.getCall(e),a=null==o?void 0:o.participantId,n=l.default.CallingStore.getLocalVideoStreamSize(e),s=[{isStreamAvailable:!!o&&o.isVideoOn,videoDimensions:n,endpointId:u.CallStageElementKeys.localUserKey}],r=l.default.CallingStore.getCallMediaStreams(e);return r&&r[t]&&r[t].filter((e=>e.participantId!==a)).map((a=>{const{endpointId:n}=a,r=this._isStreamAvailable(i,t,e,a),l=this._streamDimensions(i,t,e,n);s.push({endpointId:n,isTwincamEndpoint:Boolean(n&&o&&X(n,o)),isStreamAvailable:r,videoDimensions:l})})),s}static isLargeGridBot(e){const t=S.default.getCallGridViewBotMriFilter();return a.includes(t,e)}static isTogetherModeBot(e){const t=S.default.getCallAudienceBotMriFilter();return a.includes(t,e)}static isFullScreenBot(e){return this.isTogetherModeBot(e)||this.isLargeGridBot(e)}static isLocalOrServerMuted(e){return l.default.CallingFeaturesHelper.isLocalOrServerMuted(e)}static shouldRenderConnectedParticipantInEventStream(e,t,i){return c.default.isParticipantConnected(e)&&!a.includes(i,t)}static shouldRenderRingingParticipantInEventStream(e,t,i){return c.default.isParticipantRinging(e)&&!a.includes(i,t)}static stageLayoutRect(e,t){const i=e.height*((null==t?void 0:t.height)||1),o=e.width*((null==t?void 0:t.width)||1);return Z.translateRect({x:0,y:0,height:i,width:o},e.width)}static translateRect(e,t){if(!e)return;return{x:t-e.x-e.width,y:e.y,width:e.width,height:e.height}}static getOrderedByVideoPresenceParticipants(e,t){const i=l.default.CallParticipantStore.getParticipantRenderInfosForCall(t),o=a.compact(a.map(e,(e=>i.get(e)))).sort(((e,t)=>this._compareRenderInfoBasedOnVideo(e,t)));return a.map(o,(e=>e.renderKey))}static getOrderedDisplayedTrayParticipants(e,t,i,o=1,n=!1,s=!1,r=!1){const c=l.default.CallParticipantStore.getParticipantRenderInfosForCall(i),d=a.compact(a.map(e,(e=>c.get(e)))),u=r?U.default.getPinnedParticipants(i):void 0,h=d.sort(((e,t)=>this._compareTrayRenderInfo(e,t,s,u))),p=this._getNumberOfShownParticipants(t,h,o,n,s),g=a.take(h,p),C=a.takeRight(h,h.length-p);return this._showHiddenTalkingParticipant(g,C,s),a.map(g,(e=>e.renderKey))}static _showHiddenTalkingParticipant(e,t,i=!1){var o,n;const s=a.find(t,(e=>0===e.activeSpeakerRank)),r=e.length-1,l=null===(o=e[r])||void 0===o?void 0:o.isLocal,c=i&&(null===(n=e[r])||void 0===n?void 0:n.isPresenter);!s||l||c||a.fill(e,s,r)}static _compareTrayRenderInfo(e,t,i,o){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);if(i&&e.isPresenter!==t.isPresenter)return this._compareBoolean(!!t.isPresenter,!!e.isPresenter);if(o){const i=a.includes(o,e.renderKey),n=a.includes(o,t.renderKey);if(i!==n)return this._compareBoolean(n,i)}const n=e.shouldRenderVideo,s=t.shouldRenderVideo;if(n!==s)return this._compareBoolean(s,n);const r=0===e.activeSpeakerRank,l=0===t.activeSpeakerRank;if(r!==l)return this._compareBoolean(l,r);if(!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank){const i=a.isUndefined(e.raisedHandRank)?Number.MAX_VALUE:e.raisedHandRank,o=a.isUndefined(t.raisedHandRank)?Number.MAX_VALUE:t.raisedHandRank;return this._compareValue(i,o)}return e.activeSpeakerRank!==t.activeSpeakerRank?this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1):0}static _compareRenderInfoBasedOnVideo(e,t){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);const i=e.shouldRenderVideo,o=t.shouldRenderVideo;if(i!==o)return this._compareBoolean(o,i);if(r.default.getS4LCMCFeaturesNoSubscription().enableMultipleStreamSupport){const i=!!e.streams&&a.filter(e.streams,(e=>e.isStreamAvailable)).length>1,o=!!t.streams&&a.filter(t.streams,(e=>e.isStreamAvailable)).length>1;if(i&&!o)return-1;if(!i&&o)return 1}return 0}static _getNumberOfShownParticipants(e,t,i=1,o=!1,n=!1){let s=t.length;if(a.sumBy(t,(e=>this._getParticipantSize(e,i,o)))>e){let r=e-u.BigTrayOverflowButtonSize*i;a.each(t,((e,a)=>{const l=this._getParticipantSize(e,i,o);return r>l?(r-=l,!0):(s=0===a&&(null==t?void 0:t.length)>0?1:n&&1===a&&(null==t?void 0:t.length)>1?2:a,!1)}))}return s}static _getParticipantSize(e,t=1,i=!1){return e?!e.shouldRenderVideo||i?u.BigTrayCallParticipantMainAxisSize.audio*t:u.BigTrayCallParticipantMainAxisSize.video*t:0}static getErrorToastType(e){switch(e){case d.CallDeviceQualityEventType.AudioStoppedWorking:return u.DeviceStatusToastType.AudioStoppedWorking;case d.CallDeviceQualityEventType.MicrophoneStoppedWorking:return u.DeviceStatusToastType.MicrophoneStoppedWorking;case d.CallDeviceQualityEventType.SpeakerStoppedWorking:return u.DeviceStatusToastType.SpeakerStoppedWorking;case d.CallDeviceQualityEventType.AudioDeviceBusy:return u.DeviceStatusToastType.AudioDeviceBusy;case d.CallDeviceQualityEventType.VideoStoppedWorking:return u.DeviceStatusToastType.VideoStoppedWorking;case d.CallDeviceQualityEventType.VideoTimedOut:return u.DeviceStatusToastType.VideoTimedOut;case d.CallDeviceQualityEventType.VideoCameraBusy:return u.DeviceStatusToastType.VideoSystemBusy;case d.CallDeviceQualityEventType.VideoSystemOutOfMemory:return u.DeviceStatusToastType.VideoSystemOutOfMemory;case d.CallDeviceQualityEventType.DeviceCausingEcho:return u.DeviceStatusToastType.DeviceCausingEcho;case d.CallDeviceQualityEventType.MicrophoneNotMuteButSilent:return u.DeviceStatusToastType.MicrophoneNotMuteButSilent;case d.CallDeviceQualityEventType.DeviceRenderGlitches:return u.DeviceStatusToastType.DeviceRenderGlitches;case d.CallDeviceQualityEventType.DeviceLowSNR:return u.DeviceStatusToastType.DeviceLowSNR;case d.CallDeviceQualityEventType.DeviceClipping:return u.DeviceStatusToastType.DeviceClipping;case d.CallDeviceQualityEventType.DeviceEcho:return u.DeviceStatusToastType.DeviceEcho;case d.CallDeviceQualityEventType.DeviceMultipleEndpoints:return u.DeviceStatusToastType.DeviceMultipleEndpoints;case d.CallDeviceQualityEventType.DeviceRenderZeroVolume:return u.DeviceStatusToastType.DeviceRenderZeroVolume;case d.CallDeviceQualityEventType.CpuInsufficient:return u.DeviceStatusToastType.CpuInsufficient;case d.CallDeviceQualityEventType.ZeroCaptureDevicesEnumerated:return u.DeviceStatusToastType.ZeroCaptureDevicesEnumerated;case d.CallDeviceQualityEventType.ZeroRenderDevicesEnumerated:return u.DeviceStatusToastType.ZeroRenderDevicesEnumerated;case d.CallDeviceQualityEventType.VideoCaptureDeviceFreeze:return u.DeviceStatusToastType.VideoCaptureDeviceFreeze;case d.CallDeviceQualityEventType.AudioCapturePermissionDenied:return u.DeviceStatusToastType.AudioCapturePermissionDenied;case d.CallDeviceQualityEventType.VideoCapturePermissionDenied:return u.DeviceStatusToastType.VideoCapturePermissionDenied;case d.CallDeviceQualityEventType.VideoCaptureFreezeRecovered:return u.DeviceStatusToastType.VideoCaptureFreezeRecovered;case d.CallDeviceQualityEventType.DeviceRenderHowling:return u.DeviceStatusToastType.DeviceRenderHowling;case d.CallDeviceQualityEventType.PresentationAudioLoopbackDeviceState:return u.DeviceStatusToastType.PresentationAudioLoopbackDeviceState;case d.CallDeviceQualityEventType.RemoteNetworkConnectivityIssue:return u.DeviceStatusToastType.RemoteNetworkConnectivityIssue;case d.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected:return u.DeviceStatusToastType.AudioCaptureUltrasoundDetected;case d.CallDeviceQualityEventType.MusicModeNotAvailable:return u.DeviceStatusToastType.MusicModeNotAvailable;case d.CallDeviceQualityEventType.CameraLighting:return u.DeviceStatusToastType.CameraLighting;case d.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithHighNS:return u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS;case d.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithLowNS:return u.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS;case d.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithHighNSNotAvailable:return u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNSNotAvailable;default:return}}static getDeviceStatusBannerButtons(e,t){switch(e){case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:return this._getMusicDetectedBannerButtons(e,t);default:return[]}}static _getMusicDetectedBannerButtons(e,t){const i=[],o=(0,G.default)();return r.default.getS4LCMCFeaturesNoSubscription().enableVoiceIsolationToggle?i.push(this._getDisableVoiceIsolationButton(e,t,o)):i.push(this._getEnableMusicModeButton(e,t,o)),i}static _getDisableVoiceIsolationButton(e,t,i){return{labelKey:"CallPanel.DisableVoiceIsolationLabel",callback:()=>{i.removeDeviceQualityBannerType(t,e,u.ToastActionType.Actioned),this.toggleVoiceIsolation(!1,r.default.getS4LCMCFeaturesNoSubscription().enableForceGlobalVoiceIsolationSetting,t)}}}static _getEnableMusicModeButton(e,t,i){return{labelKey:"NotificationsPrompt.ButtonLabel",callback:()=>{i.removeDeviceQualityBannerType(t,e,u.ToastActionType.Actioned),this.toggleVoiceIsolation(!1,r.default.getS4LCMCFeaturesNoSubscription().enableForceGlobalVoiceIsolationSetting,t)}}}static toggleVoiceIsolation(e,t,i,o=z.default.newCauseId()){e?this._enableVoiceIsolation(t,i,o):this._disableVoiceIsolation(t,i,o)}static _enableVoiceIsolation(e,t,i=z.default.newCauseId()){const{enableDefaultHighNSMode:o,audioConfig:{defaultAECMode:a}}=r.default.getS4LCMCFeaturesNoSubscription(),n=s.NoiseSuppressionMode.Auto,c=o?s.NoiseSuppressionMode.High:n;t&&!e?l.default.CallingStore.applyMusicModeForCallIfAvailable(t,false,a,i).then((()=>{l.default.CallingStore.setNoiseSuppressionForCall(t,c)})):l.default.CallingStore.applyMusicModeIfAvailable(false,a,i).then((()=>{l.default.DeviceStore.setNoiseSuppressionMode(n),l.default.CallingStore.setNoiseSuppressionMode(c)}))}static _disableVoiceIsolation(e,t,i=z.default.newCauseId()){const{audioConfig:{defaultAECMode:o}}=r.default.getS4LCMCFeaturesNoSubscription(),a=s.NoiseSuppressionMode.Off;t&&!e?l.default.CallingStore.setNoiseSuppressionForCall(t,a).then((()=>{l.default.CallingStore.applyMusicModeForCallIfAvailable(t,true,o,i)})):(l.default.DeviceStore.setNoiseSuppressionMode(a),l.default.CallingStore.setNoiseSuppressionMode(a).then((()=>{l.default.CallingStore.applyMusicModeIfAvailable(true,o,i)})))}static getToastInformation(e,i,o,a){let n,s,l=!1,c=B.SkypeIcon.Warning;switch(e){case u.DeviceStatusToastType.AudioStoppedWorking:n="CallPanel.AudioDeviceFailed",l=!0;break;case u.DeviceStatusToastType.MicrophoneStoppedWorking:n="CallPanel.MicrophoneFailed",l=!0;break;case u.DeviceStatusToastType.SpeakerStoppedWorking:n="CallPanel.SpeakerFailed",l=!0;break;case u.DeviceStatusToastType.AudioDeviceBusy:n="CallPanel.AudioDeviceBusy",l=!0;break;case u.DeviceStatusToastType.MicrophoneDisconnected:n="CallPanel.NoMicrophone";break;case u.DeviceStatusToastType.SpeakerDisconnected:n="CallPanel.NoSpeaker";break;case u.DeviceStatusToastType.SoundSharingStopped:n="CallPanel.SoundSharingStopped";break;case u.DeviceStatusToastType.VideoStoppedWorking:case u.DeviceStatusToastType.VideoTimedOut:n="CallPanel.CameraFailed",l=!0;break;case u.DeviceStatusToastType.VideoSystemBusy:n="CallPanel.CameraBusy",l=!0;break;case u.DeviceStatusToastType.VideoSystemOutOfMemory:n="CallPanel.CameraStoppedWorkingOutOfMemory";break;case u.DeviceStatusToastType.CameraChanged:n="CallPanel.CameraChanged",l=!0,s=W;break;case u.DeviceStatusToastType.MicrophoneChanged:n="CallPanel.MicrophoneChanged",l=!0,s=W;break;case u.DeviceStatusToastType.SpeakerChanged:n="CallPanel.SpeakerChanged",l=!0,s=W;break;case u.DeviceStatusToastType.CompositeAudioAvailable:o?(n="CallPanel.NewAudio",s=W):(n="CallPanel.CompositeAudioChanged",l=!0,s=W);break;case u.DeviceStatusToastType.DeviceCausingEcho:n="CallPanel.DeviceCausingEcho",s=W;break;case u.DeviceStatusToastType.MicrophoneNotMuteButSilent:n="CallPanel.MicrophoneNotMuteButSilent",l=!0,s=W;break;case u.DeviceStatusToastType.MicrophoneServerMuted:n="CallPanel.MicrophoneServerMuted",s=t.ServerMutedToastTimeout,c=B.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing:n="CallPanel.OutgoingVideoDisabledScreenSharing";break;case u.DeviceStatusToastType.DeviceRenderGlitches:n="CallPanel.DeviceRenderGlitches",l=!0;break;case u.DeviceStatusToastType.DeviceLowSNR:n="CallPanel.DeviceLowSNR";break;case u.DeviceStatusToastType.DeviceClipping:n="CallPanel.DeviceClipping";break;case u.DeviceStatusToastType.DeviceEcho:n="CallPanel.DeviceEcho",c=B.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.DeviceMultipleEndpoints:n="CallPanel.DeviceMultipleEndpoints",c=B.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.DeviceRenderZeroVolume:n="CallPanel.DeviceRenderZeroVolume";break;case u.DeviceStatusToastType.CpuInsufficient:n="CallPanel.CpuInsufficient";break;case u.DeviceStatusToastType.ZeroCaptureDevicesEnumerated:n="CallPanel.ZeroCaptureDevicesEnumerated";break;case u.DeviceStatusToastType.ZeroRenderDevicesEnumerated:n="CallPanel.ZeroRenderDevicesEnumerated";break;case u.DeviceStatusToastType.VideoCaptureDeviceFreeze:n="CallPanel.VideoCaptureDeviceFreeze",l=!0,s=W;break;case u.DeviceStatusToastType.AudioCapturePermissionDenied:n="CallPanel.AudioCapturePermissionDenied",l=!0;break;case u.DeviceStatusToastType.VideoCapturePermissionDenied:n="CallPanel.VideoCapturePermissionDenied",l=!0;break;case u.DeviceStatusToastType.VideoCaptureFreezeRecovered:n="CallPanel.VideoCaptureFreezeRecovered",l=!0,s=W;break;case u.DeviceStatusToastType.DeviceRenderHowling:n="CallPanel.DeviceRenderHowling",l=!0;break;case u.DeviceStatusToastType.PresentationAudioLoopbackDeviceState:n="CallPanel.PresentationAudioLoopbackDeviceState";break;case u.DeviceStatusToastType.RemoteNetworkConnectivityIssue:n="CallPanel.RemoteNetworkConnectivityIssue";break;case u.DeviceStatusToastType.AudioCaptureUltrasoundDetected:n="CallPanel.AudioCaptureUltrasoundDetected",c=B.SkypeIcon.MicrophoneOff;break;case u.DeviceStatusToastType.MusicModeNotAvailable:n="CallPanel.MusicModeNotAvailable";break;case u.DeviceStatusToastType.CameraLighting:n="CallPanel.CameraLighting";break;case u.DeviceStatusToastType.VideoEffectsQualityChange:n="CallPanel.OnVideoEffectsQuality";break;case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:n=r.default.getS4LCMCFeaturesNoSubscription().enableVoiceIsolationToggle?"CallPanel.MusicDetectedWithHighNSV2":"CallPanel.MusicDetectedWithHighNS",c=B.SkypeIcon.SoundWave;break;case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNSNotAvailable:l=!0,n="CallPanel.MusicDetectedWithHighNSNotAvailable",c=B.SkypeIcon.SoundWave;break;case u.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:n=r.default.getS4LCMCFeaturesNoSubscription().enableVoiceIsolationToggle?"CallPanel.MusicDetectedWithHighNSV2":"CallPanel.MusicDetectedWithLowNS",c=B.SkypeIcon.SoundWave;break;case u.DeviceStatusToastType.None:default:return void _.warn(m.LogTraceArea.CallingUI,"Showing toast without specified error type this shouldnt happen")}return{notificationText:f.getString(n,i),showAvSettingsLink:l,timeout:s,icon:c,buttons:o,action:a}}static enableLayoutAnimation(){return!1}static disableCaptureAndChanges(e){return l.default.CallingStore.isProvidingVideo(e)}static _compareValue(e,t){return e===t?0:e>t?1:-1}static _compareBoolean(e,t){return e===t?0:e?1:-1}static isLeftPanelOpen(){return!v.default.isUsingStackNavigationContext()&&I.default.isLeftPanelShowing()}static isGalleryPanelOpen(){return!v.default.isUsingStackNavigationContext()&&I.default.isGalleryShowing()}static isSubtitlesPanelOpen(){return!v.default.isUsingStackNavigationContext()&&I.default.isSubtitlesShowing()}static isRightPanelOpen(){return!v.default.isUsingStackNavigationContext()&&I.default.isRightSideBarShowing()}static getCallCanvasWidth(e){let t=A.default.getWidth(e);return t-=this.isLeftPanelOpen()?x.default.getWidthNoSubscription(x.SideBar.Left):0,t-=this.isRightPanelOpen()?x.default.getWidthNoSubscription(x.SideBar.Right,!1):0,t}static getControlsType(e){const t=this.getCallCanvasWidth(e);let i;return i=Z.isMobileUI()?u.CallControlsType.Mobile:t<=this._getWidthBreakpoint(u.CallControlsType.DesktopMinSmallest)?u.CallControlsType.DesktopMinSmallest:t<=this._getWidthBreakpoint(u.CallControlsType.DesktopMedium)?u.CallControlsType.DesktopMedium:t<=this._getWidthBreakpoint(u.CallControlsType.DesktopMinStageTwo)?u.CallControlsType.DesktopMinStageTwo:t<=this._getWidthBreakpoint(u.CallControlsType.DesktopMin)?u.CallControlsType.DesktopMin:u.CallControlsType.Default,i}static isMobileUI(){return v.default.isUsingStackNavigationContext()}static _getWidthBreakpoint(e){switch(e){case u.CallControlsType.DesktopMin:return u.DesktopMinNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMedium:return u.DesktopMediumtNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinStageTwo:return u.DesktopMinStageTwoNewCallControlsWidthBreakpoint;case u.CallControlsType.DesktopMinSmallest:return u.DesktopMinSmallestNewCallControlsWidthBreakpoint}return-1}static isMinDesktop(e){return e===u.CallControlsType.DesktopMinSmallest||e===u.CallControlsType.DesktopMinStageTwo||e===u.CallControlsType.DesktopMin}static isDesktopMinCallPanelHeader(e){return!v.default.isUsingStackNavigationContext()&&!V.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallPanelHeaderWidthBreakpoint}static isDesktopMinCallPanelHeaderV2(e){return!v.default.isUsingStackNavigationContext()&&!V.default.isTablet()&&this.getCallCanvasWidth(e)<=u.DesktopMinCallPanelHeaderV2WidthBreakpoint}static overflowMenuRowButtonsDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t=[],i=new w.NativeMobileInvitePeopleCommand(e.conversationMri,y.MeetNowOrigin.CallPanel,e.callId);if(i.canExecute()){const o=f.getString("JoinLinkCard.InvitePopupAccessibilityTitle"),a={key:u.CallControlsOverflowItem.AddPeople,icon:{icon:B.SkypeIcon.ShareiOS,color:e.iconColor},title:o,accessibilityLabel:o,onPress:()=>i.execute()};t.push(a)}return t}static isDeepNoiseSuppressionAvailable(){return r.default.getS4LCMCFeaturesNoSubscription().enableNoiseSuppression&&l.default.DeviceStore.isDeepNoiseSuppressionSupported()}static overflowMenuListDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(Z.isDeepNoiseSuppressionAvailable()){const o=new w.ToggleNoiseSuppressionCommand(e.callId,t,e.noiseSuppressionMode);if(o.canExecute()){const t=[{label:f.getString("AudioVideoSettings.NoiseSuppressionOff"),value:s.NoiseSuppressionMode[s.NoiseSuppressionMode.Off]},{label:f.getString("AudioVideoSettings.NoiseSuppressionAuto"),value:s.NoiseSuppressionMode[s.NoiseSuppressionMode.Auto]},{label:f.getString("AudioVideoSettings.NoiseSuppressionLow"),value:s.NoiseSuppressionMode[s.NoiseSuppressionMode.Low]},{label:f.getString("AudioVideoSettings.NoiseSuppressionHigh"),value:s.NoiseSuppressionMode[s.NoiseSuppressionMode.High]}],a=t.find((t=>t.value===s.NoiseSuppressionMode[e.noiseSuppressionMode])),n=a?a.label:"",r=f.getString("AudioVideoSettings.NoiseSuppressionControlAccessibilityLabel",{selectedItem:n}),l={key:u.CallControlsOverflowItem.NoiseSuppression,icon:{icon:B.SkypeIcon.SoundWave,color:e.iconColor},title:f.getString("AudioVideoSettings.NoiseSuppressionControlLabel"),accessibilityLabel:r,onItemSelected:e=>o.execute(e),menuItems:t,listLabel:n};i.push(l)}}return i}static overflowMenuToggleDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(e.isBackroundBlurEnabled){const t=new w.BackgroundBlurCommand(e.callId,e.isVideoActive,e.isBackroundBlurEnabled,e.isBackgroundBlurSelected),o={key:u.CallControlsOverflowItem.BackgroundBlur,icon:{icon:B.SkypeIcon.BackgroundReplacement,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),onPress:()=>t.execute(),selected:e.isBackgroundBlurSelected,disabled:!t.canExecute(),isNew:e.isBackgroundBlurNewItem};i.push(o)}const o=new w.ToggleIncomingVideoCommand(e.callId,t,e.isAudioOnlyEnabled,e.isIncomingVideoDisabled);if(o.canExecute()){const t=!e.isIncomingVideoDisabled&&!e.isAudioOnlyEnabled,a=f.getString(t?"CallControlsOverFlowMenu.StopIncomingVideo":"CallControlsOverFlowMenu.StartIncomingVideo"),n={key:u.CallControlsOverflowItem.IncomingVideo,icon:{icon:B.SkypeIcon.Video,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.StartIncomingVideo"),accessibilityLabel:a,onPress:()=>o.execute(),selected:t};i.push(n)}return i}static overflowMenuButtonDescriptors(e,t){if(!e.callId||e.isEncryptedCall)return[];_.log(m.LogTraceArea.CallingUI,`[CallUIUtils][overflowMenuButtonDescriptors] CallUIState: ${e.callUIState}`);const i=[],o=Z.isMobileUI()&&r.default.getS4LCMCFeaturesNoSubscription().enableNewCallPanel.enableExperimentalHeader;if(o){const t={key:u.CallControlsOverflowItem.Chat,icon:{icon:B.SkypeIcon.Message,color:e.iconColor},title:f.getString("MeetNow.OpenChat"),accessibilityLabel:f.getString("MeetNow.OpenChat"),onPress:e.onChatButtonPress};i.push(t)}const a=new w.ToggleHoldCallCommand(e,void 0,e.iconColor);if(a.canExecute()){const e=a.getButtonDescriptor();e&&i.push(e)}const n=new w.TwincamCommand(e.callId,e);if(n.canExecute()){const t=l.default.CallingStore.hasConnectedTwincam(e.callId),o={key:u.CallControlsOverflowItem.Twincam,icon:{icon:B.SkypeIcon.TwincamMid,color:e.iconColor},title:t?f.getString("CallControlsOverFlowMenu.StopTwincam"):f.getString("CallControlsOverFlowMenu.Twincam"),accessibilityLabel:t?f.getString("CallControlsOverFlowMenu.StopTwincam"):f.getString("CallControlsOverFlowMenu.Twincam"),onPress:()=>n.execute(t)};i.push(o)}const s=new w.ShowBingBackgroundsCommand(e.callId,e.callerContext);if(s.canExecute()){const t={key:u.CallControlsOverflowItem.BingBackgrounds,icon:{icon:B.SkypeIcon.Bing,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.BingBackgrounds"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.BingBackgrounds"),onPress:()=>s.execute()};i.push(t)}const c=new w.AddToCallCommand(e.callId,e,e.conversationMri,e.callerContext,m.NavigationAddToCallOrigin.OverflowMenu);if(c.canExecute()){const t={key:u.CallControlsOverflowItem.AddPeople,icon:{icon:B.SkypeIcon.ContactAdd,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.AddPeopleToCall"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.AddPeopleToCall"),onPress:()=>c.execute()};i.push(t)}const d=new w.ParticipantsCommand(e.callId,e.conversationMri,e.callerContext);if(d.canExecute()){const t={key:u.CallControlsOverflowItem.Participants,icon:{icon:B.SkypeIcon.ContactGroupTwoPersonas,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.Participants"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.Participants"),onPress:()=>d.execute()};i.push(t)}const h=new w.ToggleRecordCommand(e.callId,e,e.isRecording);if(h.canExecute()&&e.callUIState===u.CallUIState.Default){const t=f.getString(e.isRecording?"CallControlsOverFlowMenu.StopRecording":"CallControlsOverFlowMenu.StartRecording"),o={key:u.CallControlsOverflowItem.CallRecording,icon:e.isRecording?[{icon:B.SkypeIcon.CallRecordStroke,color:e.iconColor},{icon:B.SkypeIcon.CallRecordDot,color:L.Color.red}]:{icon:B.SkypeIcon.CallRecord,color:e.iconColor},title:t,accessibilityLabel:t,onPress:()=>h.execute()};i.push(o)}if(!l.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()){const t=this.getReactionButtonType(e.conversationMri,e.callId),o=this.getReactionCommand(t,e.callId,e,e.reactionsConversationMri);if(o){const a=Z.getReactionButtonDescriptors(t,o),n=Object.assign(Object.assign({},a),{icon:{icon:a.icon,color:e.iconColor}});i.push(n)}}const p=new w.MomentCommand(e.callId,e,e.reactionsConversationMri);if(p.canExecute()&&e.callUIState===u.CallUIState.Default){const t={icon:B.SkypeIcon.Snapshot,color:e.iconColor},o=f.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),a={key:u.CallControlsOverflowItem.Moments,icon:t,title:o,accessibilityLabel:o,onPress:()=>p.execute()};i.push(a)}const g=new R.MobileScreenShareToggleCommand(e);if(g.canExecute()){const t=e.isScreenShareActive?{icon:B.SkypeIcon.ScreenShareOff,color:e.iconColor}:{icon:B.SkypeIcon.ScreenShare,color:e.iconColor},o=f.getString(e.isScreenShareActive?"CallControlsOverFlowMenu.StopShareScreen":"CallControlsOverFlowMenu.ShareScreen"),a={key:u.CallControlsOverflowItem.MobileScreenSharing,icon:t,title:o,accessibilityLabel:o,onPress:()=>g.execute()};i.push(a)}const C=new P.RaiseHandCommand(e.callId,e);if(C.canExecute()){const t={icon:B.SkypeIcon.RaiseHand,color:e.iconColor},o=f.getString("CallControls.RaiseHand"),a=f.getString("CallControls.RaiseHandLabel"),n={key:u.CallControlsOverflowItem.RaiseHands,icon:t,title:o,accessibilityLabel:a,onPress:()=>C.execute()};i.push(n)}const S=new P.LowerHandCommand(e.callId,M.LowerHandOrigin.CallControls);if(S.canExecute()){const t={icon:B.SkypeIcon.LowerHand,color:e.iconColor},o=f.getString("CallControls.LowerHand"),a=f.getString("CallControls.LowerHandLabel"),n={key:u.CallControlsOverflowItem.LowerHands,icon:t,title:o,accessibilityLabel:a,onPress:()=>S.execute()};i.push(n)}const y=new w.ToggleCallStatsCommand(e.callId,t);if(y.canExecute()){const t={key:u.CallControlsOverflowItem.CallStats,icon:{icon:B.SkypeIcon.Info,color:e.iconColor},title:f.getString("CallPanel.CallStats"),doesNotInfluenceMenuLayout:!0,onPress:()=>y.execute()};i.push(t)}const T=new w.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri);if(T.canExecute()){const t=f.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),o={key:u.CallControlsOverflowItem.ChangeTogetherModeBackground,icon:{icon:O.default.getBackgroundChangeButtonIcon(),color:e.iconColor},title:t,doesNotInfluenceMenuLayout:!0,onPress:()=>T.execute()};i.push(o)}const b=new w.ToggleCaptionsCommand(e.callId,e,e.isTranslating);if(b.canExecute()&&e.callUIState===u.CallUIState.Default){const t=f.getString("CallControlsOverFlowMenu.LiveCaptionsStart"),o=B.SkypeIcon.ClosedCaption,a=t,n={key:u.CallControlsOverflowItem.CallTranslator,icon:{icon:o,color:e.iconColor},title:a,accessibilityLabel:t,onPress:()=>b.execute(),selected:e.isTranslating};i.push(n)}const v=new w.ToggleSkypeTranslateCommand(e.callId,e,e.isSkypeTranslating);if(v.canExecute()&&e.callUIState===u.CallUIState.Default){const t=f.getString((e.isSkypeTranslating,"CallControlsOverFlowMenu.Translate")),o=B.SkypeIcon.Translate,a=t,n={key:u.CallControlsOverflowItem.CallSkypeTranslation,icon:{icon:o,color:e.iconColor},title:a,accessibilityLabel:t,onPress:()=>v.execute(),selected:e.isSkypeTranslating};i.push(n)}const I=new w.SwitchCameraCommand(e.callId,e.isVideoActive);if(I.canExecute()){const t={key:u.CallControlsOverflowItem.SwitchCamera,icon:{icon:B.SkypeIcon.SwitchCamera,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.SwitchCamera"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.SwitchCamera"),onPress:()=>I.execute()};i.push(t)}if(o&&e.callUIState===u.CallUIState.Default){const t={key:u.CallControlsOverflowItem.ChangeView,icon:{icon:B.SkypeIcon.GridView,color:e.iconColor},title:f.getString("CallControlsOverFlowMenu.ChangeViewMode"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.ChangeViewMode"),onPress:e.onChangeViewButtonPress};i.push(t)}return i}static getFeatureUnsupportedParticipantsInfo(e,t,i){return a.isEmpty(t)?void 0:{count:t.length,firstUser:C.default.getMemberShortNameForConversation(i,l.default.CallingStore.getRemoteCallMemberMri(e,t[0])),secondUser:t.length>1?C.default.getMemberShortNameForConversation(i,l.default.CallingStore.getRemoteCallMemberMri(e,t[1])):void 0}}static getFeatureUnsupportedMessage(e,t){const i=e.count;let o;if(e.firstUser&&(e.firstUser||e.secondUser))switch(i){case 1:o=this._getOneCountFeatureUnsupportedMessage(e.firstUser,t);break;case 2:o=this._getTwoCountFeatureUnsupportedMessage(e,t);break;default:o=this._getMoreCountFeatureUnsupportedMessage(e,t)}else o=this._getDefaultFeatureUnsupportedMessage(t);return o||_.error(m.LogTraceArea.CallingUI,"CallUIUtils.getFeatureUnsupportedMessage Missing localized unsupported message"),o}static announceCameraDirectionState(e){if(!k.default.shouldAnnounceForAccessibility())return;let t;e===s.CameraPosition.Front?t=f.getString("CallControls.CameraFrontAnnouncement"):e===s.CameraPosition.Back&&(t=f.getString("CallControls.CameraBackAnnouncement")),t&&n.Accessibility.announceForAccessibility(t)}static getAccessibilityLabelForStageMode(e){switch(e){case u.StageMode.Grid:case u.StageMode.Manual:return f.getString("CallControls.StageModeGridAnnouncement");case u.StageMode.FocusedScreenShare:return f.getString("CallControls.StageModeFocusedScreenShareAnnouncement");case u.StageMode.Presentation:return f.getString("CallPanel.CallHeaderPresentationViewLabel");case u.StageMode.Speaker:return f.getString("CallControls.StageModeFocusAnnouncement");default:return}}static announceStageMode(e){if(!k.default.shouldAnnounceForAccessibility())return;const t=this.getAccessibilityLabelForStageMode(e);t&&n.Accessibility.announceForAccessibility(t)}static announceMicrophoneState(e,t=!1){if(!k.default.shouldAnnounceForAccessibility())return;const i=this.getAccessibilityLabelForMicrophoneMute(e,t);i&&n.Accessibility.announceForAccessibility(i)}static getAccessibilityLabelForMicrophoneMute(e,t=!1){let i;return t&&e?i=f.getString("CallControls.MicrophoneServerMutedAccessibilityLabel"):t||e?!t&&e&&(i=f.getString("CallControls.MicrophoneMutedAccessibilityLabel")):i=f.getString("CallControls.MicrophoneUnmutedAccessibilityLabel"),i}static announceVideoState(e){k.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallPreview.ToggleVideoOnLabel")):n.Accessibility.announceForAccessibility(f.getString("CallPreview.ToggleVideoOffLabel")))}static announceHoldState(e){k.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.HoldCallAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ResumeCallAnnouncement")))}static announceScreenShareState(e){k.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ScreenShareStartAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.ScreenShareEndAnnouncement")))}static announceScreenRecordingState(e){k.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel")):n.Accessibility.announceForAccessibility(f.getString("CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable")))}static announceSubtitleState(e,t){k.default.shouldAnnounceForAccessibility()&&(t?e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleStartStateAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleStopStateAnnouncement")):e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleBeginStartAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.SubtitleBeginStopAnnouncement")))}static _announceIncomingVideoAllowanceState(e){k.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement")):n.Accessibility.announceForAccessibility(f.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement")))}static enableIncomingVideo(e,t){const i=l.default.CallingStore.getVideoOverrides(e);(null==i?void 0:i.clearRemoteStreamOverride(d.VideoOverrideReason.IncomingVideoDisabled))&&(j.default.updateCallTelemetry(e,t,(e=>e.enableIncomingVideoCount())),Z._announceIncomingVideoAllowanceState(!0))}static disableIncomingVideo(e,t){const i=l.default.CallingStore.getVideoOverrides(e);(null==i?void 0:i.setRemoteStreamOverride(d.VideoOverrideReason.IncomingVideoDisabled))&&(i.clearRemoteStreamOverride(d.VideoOverrideReason.AudioOnlyMode),j.default.updateCallTelemetry(e,t,(e=>e.disableIncomingVideoCount())),Z._announceIncomingVideoAllowanceState(!1))}static isIncomingVideoDisabled(e){if(l.default.CallingFeaturesHelper.isIncomingVideoDisabled())return!0;const t=l.default.CallingStore.getVideoOverrides(e);return Boolean(null==t?void 0:t.hasSpecificRemoteStreamOverride(d.VideoOverrideReason.IncomingVideoDisabled))}static getRingingItemDisplayString(e){let t="";if(e.length&&a.intersection(S.default.getCallFullscreenBotMris(),e).length){if(a.intersection(S.default.getCallAudienceBotMriFilter(),e).length)return f.getString("ReactionsStream.CallingTogetherMode");if(a.intersection(S.default.getCallGridViewBotMriFilter(),e).length)return f.getString("ReactionsStream.CallingLargeGridMode")}e.length&&(t=C.default.getDisplayName(e[0])||f.getString("Notifications.UnknownUserShort"));let i="";e.length>1&&(i=C.default.getDisplayName(e[1])||f.getString("Notifications.UnknownUserShort"));let o="";return 1===e.length?o=f.getString("ReactionsStream.CallingParticipant",{participant:t}):2===e.length?o=f.getString("ReactionsStream.CallingTwoParticipants",{firstParticipant:t,secondParticipant:i}):e.length>2&&(o=f.getString("ReactionsStream.CallingMultipleParticipants",{participant:t,count:e.length-1})),o}static getShareScreenIcon(e){return e?B.SkypeIcon.ScreenShareOff:B.SkypeIcon.ScreenShare}static getSizesForStageElements(e,t,i,o,a,n){const s=i.width*i.height,r=o&&!n||!o&&n;let l;l=r?i.width*(i.height+t-s):i.height*(i.width+t-s);const c=t-l;let d,u;if(o?(u=1/(0===l?t/i.height:i.width),d=1/a.height):(u=1/a.width,d=1/(0===l?t/i.width:i.height)),1===t)return[{width:u,height:d},...e];if(0===l){return new Array(t).fill({width:u,height:d}).concat(e)}for(let t=0;t<l;t++)e.unshift({width:u,height:d});if(c>=1){const t=Z._getNewVirtualStageSize(l,i,r);return Z.getSizesForStageElements(e,c,t,n?!o:o,a,!1)}return e}static _getNewVirtualStageSize(e,t,i){const o=i?t.width:t.height,a=(i?t.height:t.width)-Math.ceil(e/o);return{width:i?o:a,height:i?a:o}}static getStageVideoCount(e,t,i,o){const a=Math.ceil(Math.sqrt(e)),n=Math.min(i,t,a),s=Math.ceil(e/n),r=Math.max(n,s),l=Math.min(n,s);return{width:o?r:l,height:o?l:r}}static isInGridStageMode(e){return e===u.StageMode.Grid||e===u.StageMode.Manual}static isInIncomingScreenshareMode(e){return e===u.StageMode.Presentation||e===u.StageMode.FocusedScreenShare}static getScreensharingMode(){return l.default.CallingFeaturesHelper.isPresentationModeEnabled()?u.StageMode.Presentation:u.StageMode.FocusedScreenShare}static getAvailableHeaderModes(e,t){return e?[]:t?[u.CallPanelHeaderLayout.Window,u.CallPanelHeaderLayout.Float]:[]}static isTogetherMode(e){return e===u.StageMode.TogetherMode}static isLargeGrid(e){return e===u.StageMode.LargeGrid}static _getDefaultFeatureUnsupportedMessage(e){let t;if(e===K.CallReactions)t="CallPanel.ReactionsShortMessageDefault";return t?f.getString(t):void 0}static _getOneCountFeatureUnsupportedMessage(e,t){let i;if(t===K.CallReactions)i="CallPanel.ReactionsShortMessage1User";return i?f.getString(i,{firstUser:e}):void 0}static _getTwoCountFeatureUnsupportedMessage(e,t){let i;if(t===K.CallReactions)i="CallPanel.ReactionsShortMessage2Users";return i?f.getString(i,{firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _getMoreCountFeatureUnsupportedMessage(e,t){let i;if(t===K.CallReactions)i="CallPanel.ReactionsShortMessageMoreUsers";return i?f.getString(i,{count:e.count-2,firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _isStreamAvailable(e,t,i,o,a,n){if(!e)return!1;const s=!(!o||!l.default.RemoteStreamHelper.validateStream(i,e,o,a))?o:l.default.RemoteStreamHelper.getAvailableStream(i,e,t,n,a);return!!s&&s.isAvailable}static _streamDimensions(e,i,o,a){return e&&l.default.RemoteStreamHelper.getStreamSize(o,e,i,a)||t.DummyVideoSize}static getReactionItems(e){const t=Z.getEmoticonReactionKey(e),i=(0,g.default)().getCustomReactions(),o=a.uniq([t,...i].reverse());return a.map(o,(e=>({key:e,type:D.default.isAnimationReaction(e)?u.ReactionsItemType.Animation:u.ReactionsItemType.Emoticon})))}static getEmoticonReactionKey(e){const t=r.default.getS4LCMCFeatures();if(e)return t.callCelebrationConfig.callCelebrateButtonKey;const i=(0,g.default)();if(i.hasBeenCustomized()){const e=i.getCurrentReactions();return 0===e.length?i.getCustomReactions()[0]:e[0]}return t.callReactionButtonKey}static canHandBeLoweredForParticipant(e,t){const i=l.default.CallingStore.getCallConversationMri(e),o=i&&(0,p.default)().getConversation(i);return l.default.CallingStore.isHandRaisedForMri(t,e)&&(!(0,T.isModerated)(o)||(0,T.isCurrentUserAdminInModeratedGroup)(o)||b.default.isMyMri(t))}static announceLoweredHandState(e,t){if(!k.default.shouldAnnounceForAccessibility())return;let i;e?i=f.getString("CallPanel.HandLowered"):t&&(i=f.getString("CallPanel.HandLoweredOther",{displayName:t})),i&&n.Accessibility.announceForAccessibility(i)}static getReactionButtonType(e,t){let i=$.Heart;return h.default.getCelebrationData(e,t)&&(i=$.Celebration),i}static getReactionCommand(e,t,i,o){let a;switch(e){case $.Celebration:a=new w.SendReactionCommand(u.ReactionsItemType.Animation,"cake",t,i,o);break;case $.Heart:a=new w.SendReactionCommand(u.ReactionsItemType.Emoticon,"heart",t,i,o)}if(a.canExecute())return a}static getReactionButtonDescriptors(e,t){let i;switch(e){case $.Celebration:i={key:u.CallControlsOverflowItem.CelebrationAnimation,icon:B.SkypeIcon.Birthday,title:f.getString("CallControlsOverFlowMenu.CelebrateBirthday"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.CelebrateBirthday"),onPress:()=>t.execute()};break;case $.Heart:i={key:u.CallControlsOverflowItem.HeartReaction,icon:B.SkypeIcon.HeartOutline,title:f.getString("CallControlsOverFlowMenu.ReactWithHeart"),accessibilityLabel:f.getString("CallControlsOverFlowMenu.ReactWithHeart"),onPress:()=>t.execute()}}return i}static getStageModeItemTitle(e){const t=q[this.displayedStageMode(e)];return t?f.getString(t):(_.error(m.LogTraceArea.CallingUI,"No title found for stage mode: "+u.StageMode[e]),"")}static getIconForStageMode(e){const t=Q[this.displayedStageMode(e)];return t||_.error(m.LogTraceArea.CallingUI,"No icon found for stage mode: "+u.StageMode[e]),t}static displayedStageMode(e){return e===u.StageMode.Manual?u.StageMode.Grid:e}static getAvailableMenuItems(e,t,i,o){const a=F.default.getAvailableStageModes(e).reduce(((e,t,o)=>(i&&0!==o&&e.push({type:u.LayoutPickerMenuItemType.Divider}),e.push({type:Z._stageModeToLayoutPickerMenuItemType(t)}),e)),[]),n=r.default.getS4LCMCFeatures(),s=N.isOneOnOneConversation(o);n.enableAudioParticipantsOnTheStage&&!s&&(a.push({type:u.LayoutPickerMenuItemType.Divider}),a.push({type:u.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(n),markAsSeen:this._markOnlyVideoOnTheStageAsSeen}));const l=F.default.getStageMode(e);this.isInGridStageMode(l)&&i&&(a.push({type:u.LayoutPickerMenuItemType.Divider}),a.push({type:u.LayoutPickerMenuItemType.SelfInTheGridToggle})),t&&(a.push({type:u.LayoutPickerMenuItemType.Divider}),a.push({type:u.LayoutPickerMenuItemType.Fullscreen}));const c=Z.getAvailableHeaderModes(i,s);return c.length&&a.push({type:u.LayoutPickerMenuItemType.Divider}),c.forEach((e=>{a.push({type:Z._headerModeToLayoutPickerMenuItemType(e)})})),a}static getAvailableMenuItemsV2(e,t,i,o){const a=F.default.getAvailableStageModesV2(e).reduce(((e,t,o)=>(i&&0!==o&&e.push({type:u.LayoutPickerMenuItemType.Divider}),e.push({type:Z._stageModeToLayoutPickerMenuItemType(t)}),e)),[]),n=r.default.getS4LCMCFeatures(),s=N.isOneOnOneConversation(o),l=F.default.getStageMode(e),c=!s&&this.isInGridStageMode(l),d=this.isInGridStageMode(l),h=n.enableTopTrayHiding;if((c||d||h)&&a.push({type:u.LayoutPickerMenuItemType.Divider}),c&&a.push({type:u.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(n),markAsSeen:this._markOnlyVideoOnTheStageAsSeen}),d&&a.push({type:u.LayoutPickerMenuItemType.SelfInTheGridToggle}),h){const t=F.default.isTopTrayHidden(e)?u.LayoutPickerMenuItemType.ShowPeopleAtTop:u.LayoutPickerMenuItemType.HidePeopleAtTop;a.push({type:t})}return t&&(a.push({type:u.LayoutPickerMenuItemType.Divider}),a.push({type:u.LayoutPickerMenuItemType.Fullscreen})),a}static _isOnlyVideoOnTheStageNew(e){return e.enableAudioParticipantsOnTheStageAsNew&&!!E.default.getUserPreferencesLocal().showOnlyVideoOnTheStageAsNew}static _stageModeToLayoutPickerMenuItemType(e){switch(e){case u.StageMode.Speaker:return u.LayoutPickerMenuItemType.StageModeSpeaker;case u.StageMode.FocusedScreenShare:return u.LayoutPickerMenuItemType.StageModeFocusedScreenShare;case u.StageMode.Grid:return u.LayoutPickerMenuItemType.StageModeGrid;case u.StageMode.Manual:return u.LayoutPickerMenuItemType.StageModeManual;case u.StageMode.Presentation:return u.LayoutPickerMenuItemType.StageModePresentation;case u.StageMode.TogetherMode:return u.LayoutPickerMenuItemType.StageModeTogetherMode;case u.StageMode.LargeGrid:return u.LayoutPickerMenuItemType.StageModeLargeGrid}}static layoutPickerMenuItemTypeToStageMode(e){switch(e){case u.LayoutPickerMenuItemType.StageModeSpeaker:return u.StageMode.Speaker;case u.LayoutPickerMenuItemType.StageModeFocusedScreenShare:return u.StageMode.FocusedScreenShare;case u.LayoutPickerMenuItemType.StageModeGrid:return u.StageMode.Grid;case u.LayoutPickerMenuItemType.StageModeManual:return u.StageMode.Manual;case u.LayoutPickerMenuItemType.StageModePresentation:return u.StageMode.Presentation;case u.LayoutPickerMenuItemType.StageModeTogetherMode:return u.StageMode.TogetherMode;case u.LayoutPickerMenuItemType.StageModeLargeGrid:return u.StageMode.LargeGrid;default:return}}static _headerModeToLayoutPickerMenuItemType(e){switch(e){case u.CallPanelHeaderLayout.Mobile:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile;case u.CallPanelHeaderLayout.Float:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat;case u.CallPanelHeaderLayout.Window:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow;case u.CallPanelHeaderLayout.None:return u.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone}}static layoutPickerMenuItemTypeToHeaderMode(e){switch(e){case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:return u.CallPanelHeaderLayout.Mobile;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:return u.CallPanelHeaderLayout.Float;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:return u.CallPanelHeaderLayout.Window;case u.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:return u.CallPanelHeaderLayout.None;default:return}}static shouldShowCallParticipantPinOption(e,t){var i;return r.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&this.isInGridStageMode(F.default.getStageMode(t))&&!this.isCallParticipantPinned(e,t)&&H.default.getStageCapacity(t)>((null===(i=U.default.getPinnedParticipants(t))||void 0===i?void 0:i.length)||0)}static shouldShowCallParticipantUnpinOption(e,t){return r.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&this.isCallParticipantPinned(e,t)}static isCallParticipantPinned(e,t){return!!e&&U.default.isParticipantPinned(e,t)}static isPortraitVideo(e){return e&&e.height>e.width}static getUserOptionsAccessibilityLabel(e,t,i){if(!e)return;let o;return o=t?f.getString("CallPanel.DisplayNameWithMicrophoneMuted",{displayName:e}):f.getString("SkypeUserListItem.DisplayNameLabel",{displayName:e}),i&&(o=f.getString("CallPanel.DisplayNameWithHandRaised",{prefix:o})),o}static _getRoundedValueByRatio(e,t,i){const o=t&&t.height&&t.width?t.width/t.height:2/3;return Math.round(i?e/o:e*o)}static getLocalPreviewMobilesShape(e){return e&&e.height&&e.width&&e.width>=e.height?{height:Z._getRoundedValueByRatio(t.LocalPreviewLongerSideSize,e,!0),width:t.LocalPreviewLongerSideSize}:{height:t.LocalPreviewLongerSideSize,width:Z._getRoundedValueByRatio(t.LocalPreviewLongerSideSize,e)}}}t.CallUIUtils=Z,Z._markOnlyVideoOnTheStageAsSeen=()=>{E.default.setUserPreferencesLocal({showOnlyVideoOnTheStageAsNew:!1})},t.default=Z},441428:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartCallOptionAction=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(148540),s=o.__importStar(i(397691)),r=i(619429),l=o.__importDefault(i(369347)),c=o.__importDefault(i(60433)),d=i(619429),u=i(843890),h=o.__importStar(i(44717)),p=o.__importDefault(i(615364)),g=o.__importStar(i(60771)),C=i(815146),m=o.__importStar(i(85385)),S=o.__importDefault(i(432091)),_=o.__importStar(i(963369)),f=o.__importStar(i(437782)),y=o.__importDefault(i(685734)),T=o.__importDefault(i(150343));var b;!function(e){e[e.call=0]="call",e[e.promptForAddresses=1]="promptForAddresses",e[e.promptForSkypeMri=2]="promptForSkypeMri",e[e.failed=3]="failed"}(b||(t.StartCallOptionAction=b={}));const v=new class{startCallOrMaybePromptHelper(e,t,i,o,l,p,T,v){if(!this._releaseAssert(!!e.skypeMri||!a.isEmpty(e.phones),"CallOptionsHelper.startCallOrMaybePromptHelper","Must pass skypeMri or phones"))return c.default.generateCallingError("",r.CallAction.Start,"Must pass skypeMri or phones",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,d.CallValidationFailureReason.InvalidParameters,v),s.Resolved();if(!this._releaseAssert(!e.skypeMri||c.default.isValidCallingMri(e.skypeMri),"CallOptionsHelper.startCallOrMaybePromptHelper","If skypeMri is passed, it must be valid for calling"))return c.default.generateCallingError("",r.CallAction.Start,"If skypeMri is passed, it must be valid for calling",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,d.CallValidationFailureReason.InvalidParameters,v),s.Resolved();const I=(t,a,n)=>{if(!t)return;const s=this._activeCallIdForMri(t,n);return s?(m.log(C.LogTraceArea.CallNavigation,"[CallingOptionsHelper] Start processing active call",`{ callId: ${s}, showCallPreview: ${e.showCallPreview} }`,`causeId: ${n}`),e.showCallPreview?o(t,s,a):i(t,s,a)):void 0},w=(i,o)=>{I(i,o,v)||(e.initiatingConversation&&h.isEncryptedThread(e.initiatingConversation)&&!h.isEncryptedThread(i)?T(o).then((()=>t(i,o))):t(i,o)),M()},P=e=>w(e,!1),M=()=>{e.onCallStartedAnsweredOrJoined&&e.onCallStartedAnsweredOrJoined()},D=e=>{w(e,!1)};if(I(e.skypeMri,e.userIntent===d.StartCallOrMaybePromptUserIntent.Video,v))return M(),s.Resolved();const A=[!e.skypeMri||h.isThread(e.skypeMri)?s.Resolved(void 0):y.default.getFullUserProfileByMriAsync(e.skypeMri),u.CallingCapabilities.encryptedCallingSupported()&&e.skypeMri&&h.isSkypeIdMri(e.skypeMri)?g.getEstablishedEncryptedThreadId(e.skypeMri):s.Resolved(void 0)];return s.all(A).then((([t,i])=>{var o;let a=_.mergeMriProfileAndExtraPhones(e.skypeMri,void 0,t?t.phones:e.phones);const n=e.skypeMri?S.default.getContactByCorrespondingMri(e.skypeMri):void 0;a=n?_.mergeMriProfileAndExtraPhones(void 0,a,n.phones):a;const s=this._callingOptionsHelper(e.skypeMri,a,e.userIntent,i);switch(m.log(C.LogTraceArea.Calling,"[CallOptionsHelper] startCallOrMaybePromptHelper: "+f.mriOrId(e.skypeMri)+", allPhones: "+a+", userIntent: "+d.StartCallOrMaybePromptUserIntent[e.userIntent]+", result: "+b[s.action]),s.action){case b.failed:m.error(C.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper failed. skypeMri: "+f.mriOrId(e.skypeMri)+", allPhones: "+a+", userIntent: "+e.userIntent);break;case b.call:if(!s.callMri){m.error(C.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper returned call action with no mri.");break}w(s.callMri,!!s.withVideo);break;case b.promptForSkypeMri:if(!e.skypeMri){m.error(C.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper promptForSkypeMri called with no mri.");break}l(h.isPhoneMri(e.skypeMri)?void 0:e.skypeMri,i,!!s.suppressPromptVideoOption,w,P,D,a,e.showSmsOption);break;case b.promptForAddresses:const n=e.skypeMri?h.getPhoneNumberFromMri(e.skypeMri):void 0,r=n?S.default.getContactByPhoneNumber(n):void 0,c=r?r.getDisplayName():t?t.getDisplayName():"",d=null===(o=null==t?void 0:t.emails)||void 0===o?void 0:o.map((e=>e.address));p(c,a,d)}}))}test_callingOptionsHelper(e,t){return this._callingOptionsHelper(e.skypeMri,e.phones,e.userIntent,t)}_callingOptionsHelper(e,t,i,o){const n=a.isEmpty(t)?0:t.length;return!e||h.isPhoneMri(e)?n&&i!==d.StartCallOrMaybePromptUserIntent.Video?i===d.StartCallOrMaybePromptUserIntent.Generic?{action:b.promptForAddresses}:1===n?{action:b.call,withVideo:!1,callMri:h.sanitizeMri(t[0].number,h.Namespaces.PSTN)}:{action:e?b.promptForSkypeMri:b.promptForAddresses}:{action:b.failed}:h.isThread(e)?n?{action:b.failed}:i===d.StartCallOrMaybePromptUserIntent.Generic?{action:b.promptForSkypeMri}:{action:b.call,withVideo:i===d.StartCallOrMaybePromptUserIntent.Video,callMri:e}:h.isUserMri(e)?i===d.StartCallOrMaybePromptUserIntent.Generic?{action:b.promptForSkypeMri}:i===d.StartCallOrMaybePromptUserIntent.Video?{action:b.call,withVideo:!0,callMri:e}:0!==n||o?{action:b.promptForSkypeMri,suppressPromptVideoOption:!0}:{action:b.call,withVideo:!1,callMri:e}:{action:b.failed}}_releaseAssert(e,t,i){return!!e||(m.error(C.LogTraceArea.Calling,f.dev_unknownOmit(t)+": "+f.dev_unknownOmit(i)),!1)}_activeCallIdForMri(e,t){if(!e)return;if(h.isThread(e)){if(T.default.getS4LCMCFeaturesNoSubscription().enableCallRegistry){const t=l.default.ActiveCallUIHelper.getActiveCallLiveState(e);return null==t?void 0:t.conversationId}{const i=(0,p.default)().getConversation(e);if(!i){const i="CallOptionsHelper._activeCallIdForMri: Didn't find conversation";return m.warn(C.LogTraceArea.Calling,i+" "+f.mriOrId(e)+" causeId: "+t),void c.default.generateCallingError("",r.CallAction.AnswerOrJoin,i,n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,d.CallValidationFailureReason.ConversationNotFound,t)}const o=i.validLiveState();return o&&o.conversationId}}const i=l.default.CallingStore.getCallIdsForConversationMri(e);return a.head(i)}};t.default=v},741020:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopSecondaryCallControlsManager=t.OverflowMenuCommands=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(460515),s=o.__importDefault(i(114818)),r=o.__importDefault(i(760989));var l,c;!function(e){e.OnAddToCall="OnAddToCall",e.OnShowParticipants="OnShowParticipants",e.OnShowAVSettings="OnShowAVSettings",e.OnShowAudioSettings="OnShowAudioSettings",e.ShareScreen="ShareScreen",e.ShareScreenAndSounds="ShareScreenAndSounds",e.ConfirmStopSharing="ConfirmStopSharing",e.StopSharing="StopSharing",e.SwitchScreen="SwitchScreen",e.ScreenShareControl="ScreenShareControl",e.StopScreenShareControl="StopScreenShareControl",e.HoldCall="HoldCall",e.ResumeCall="ResumeCall",e.StartRecording="StartRecording",e.StopRecording="StopRecording",e.StartCaptions="StartCaptions",e.StopCaptions="StopCaptions",e.LiveCaptions="LiveCaptions",e.SkypeTranslate="SkypeTranslate",e.StopSkypeTranslate="StopSkypeTranslate",e.Snap="Snapshot",e.React="React",e.CustomReact="CustomReact",e.EnableIncomingVideo="EnableIncomingVideo",e.DisableIncomingVideo="DisableIncomingVideo",e.Blur="BlurBackground",e.Unblur="UnblurBackground",e.CallStats="CallStats",e.BackgroundEffectsSettings="BackgroundEffectsSettings",e.MuteEveryone="MuteEveryone",e.RaiseHand="RaiseHand",e.LowerHand="LowerHand",e.ChangeTogetherModeBackground="ChangeTogetherModeBackground",e.BingBackgrounds="BingBackgrounds",e.Invite="Invite",e.Twincam="Twincam",e.StopTwincam="StopTwincam"}(l||(t.OverflowMenuCommands=l={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(c||(c={}));t.DesktopSecondaryCallControlsManager=class{configure(e){(0,s.default)(e,this._input)||(this._input=e,this._computeControlPlacement())}_computeControlPlacement(){if(this._input.controlsType===n.CallControlsType.DesktopMinSmallest){this._leftControls=[this._input.leftControlForDesktopMinSmallest];const e=a.flatMap(this._input.idealLeftControls,(e=>this._callControlKeyToOverflowMenuCommands(e.type))),t=a.flatMap(this._input.idealRightControls,(e=>this._callControlKeyToOverflowMenuCommands(e.type)));this._overflowControls=e.concat(t).concat(this._input.idealOverflowControls);const i=this._callControlKeyToOverflowMenuCommands(this._input.leftControlForDesktopMinSmallest);return 1===i.length&&(this._overflowControls=a.filter(this._overflowControls,(e=>e!==i[0]))),void(this._rightControls=this._overflowControls.length>0?[n.CallControlsKeys.Overflow]:[])}const e=this._getCapacity(this._input.controlsType,c.Left),t=this._getCapacity(this._input.controlsType,c.Right),i=this._restrictControls(this._input.idealLeftControls,e),o=this._restrictControls(this._input.idealRightControls,t);this._leftControls=a.map(i.controlsToKeep,(e=>e.type)),this._rightControls=a.map(o.controlsToKeep,(e=>e.type));const s=a.map(i.controlsForOverflow,(e=>e.type)),r=a.map(o.controlsForOverflow,(e=>e.type));var l=a.flatMap(s,(e=>this._callControlKeyToOverflowMenuCommands(e))),d=a.flatMap(r,(e=>this._callControlKeyToOverflowMenuCommands(e)));l=a.filter(l,(e=>-1===this._input.idealOverflowControls.indexOf(e))),d=a.filter(d,(e=>-1===this._input.idealOverflowControls.indexOf(e))),this._overflowControls=l.concat(d).concat(this._input.idealOverflowControls)}getLeftControls(){return this._leftControls}getRightControls(){return this._rightControls}getOverflowControls(){return this._overflowControls}_restrictControls(e,t){for(var i=a.map(e,(e=>({control:e,delete:!1}))),o=e.length;o>t;){const e=a.filter(i,(e=>!e.delete)),n=a.max(a.map(e,(e=>e.control.priority)));for(let e=0;e<i.length&&!(o<=t);e++)i[e].delete||i[e].control.priority!==n||(i[e].delete=!0,--o)}const n=a.filter(i,(e=>!e.delete)),s=a.filter(i,(e=>e.delete));return{controlsToKeep:a.map(n,(e=>e.control)),controlsForOverflow:a.map(s,(e=>e.control))}}_callControlKeyToOverflowMenuCommands(e){switch(e){case n.CallControlsKeys.Participants:return this._input.isOneOnOneCall?[l.OnAddToCall]:[l.OnShowParticipants];case n.CallControlsKeys.ScreenShare:const t=[this._input.isScreenShareActive?l.StopSharing:l.ShareScreen];return this._input.isScreenShareActive&&(this._input.numberAvailableScreens>1||this._input.windowSharingEnabled)&&t.push(l.SwitchScreen),t;case n.CallControlsKeys.ScreenShareControl:return this._input.canRequestScreenShareControl?[l.ScreenShareControl]:[l.StopScreenShareControl];case n.CallControlsKeys.RaiseHand:return[l.RaiseHand];case n.CallControlsKeys.LowerHand:return[l.LowerHand];case n.CallControlsKeys.ChangeScene:return[l.ChangeTogetherModeBackground];case n.CallControlsKeys.Record:if(this._input.allowRecording){if(!this._input.isRecording&&this._input.connectedAndNotOnHoldCallId===this._input.callId)return[l.StartRecording];if(this._input.isCallRecordingInitiator)return[l.StopRecording]}return[];case n.CallControlsKeys.ReactionsDrawer:return[l.React];case n.CallControlsKeys.ReactionsPopover:return[l.CustomReact];case n.CallControlsKeys.Moments:return[l.Snap];case n.CallControlsKeys.ShareLink:return[l.Invite];case n.CallControlsKeys.Twincam:return[l.Twincam];case n.CallControlsKeys.StopTwincam:return[l.StopTwincam];case n.CallControlsKeys.LiveCaptions:return this._input.allowLiveCaptions&&this._input.connectedAndNotOnHoldCallId===this._input.callId?[l.LiveCaptions]:[];case n.CallControlsKeys.SkypeTranslate:return this._input.allowSkypeTranslate&&this._input.connectedAndNotOnHoldCallId===this._input.callId?this._input.isSkypeTranslating?[l.StopSkypeTranslate]:[l.SkypeTranslate]:[];case n.CallControlsKeys.Mic:case n.CallControlsKeys.MicQuickSettings:case n.CallControlsKeys.Video:case n.CallControlsKeys.VideoQuickSettings:case n.CallControlsKeys.Dialpad:case n.CallControlsKeys.EndCall:case n.CallControlsKeys.Overflow:case n.CallControlsKeys.Chat:return[];default:return r.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getCapacity(e,t){switch(e){case n.CallControlsType.Mobile:return Number.MAX_SAFE_INTEGER;case n.CallControlsType.Default:return 5;case n.CallControlsType.DesktopMin:return t===c.Right?5:4;case n.CallControlsType.DesktopMinStageTwo:return t===c.Right?5:3;case n.CallControlsType.DesktopMedium:return 2;case n.CallControlsType.DesktopMinSmallest:return 1;default:return r.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsType element")}}}},285901:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importStar(i(44717)),s=o.__importDefault(i(615364)),r=o.__importDefault(i(988773)),l=o.__importDefault(i(421852)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importDefault(i(879119)),h=o.__importStar(i(427393)),p=o.__importDefault(i(760989));t.default=class{static startOrAddPstnCall(e,t,i,o,l,g,C,m){const S=u.default.getPhoneNumberOrigin()||c.NavigationCallOrigin.PstnDialpad;if(d.track(new h.StartCall(c.NavigationCallOrigin[S])),i&&r.default.setDefaultPstnDestinationCountryCode(i),m=null!=m?m:p.default.newCauseId(),t)this._startEmergencyPstnCall(e,m,i,o);else{let t;if(e&&(t=n.sanitizeMri(e,n.Namespaces.PSTN)),t)if(l&&g){const e=(0,s.default)().getConversation(g);let i=[];e&&(i=e.getMemberMris()),a.default.CallParticipantUtils.addUsersToCallOrRing([t],l,g,i,c.NavigationAddToCallOrigin.Unknown)}else C&&a.default.PstnUtils.setCallDTMF(t,C),a.default.CallNavigationHelper.startCall({conversationMri:t,withVideo:!1,origin:u.default.getPhoneNumberOrigin()||c.NavigationCallOrigin.PstnDialpad},m),u.default.resetPhoneNumberOrigin()}}static _startEmergencyPstnCall(e,t,i,o){i?o?(d.track(new h.EmergencyCall),d.log(c.LogTraceArea.GenericUnsafe,"Placing emergency call to "+r.default.maskPhoneNumber(e)+", destination country: "+i),l.default.getEmergencyContentForNumberNoSubscription(o)&&d.track(new h.E911EmergencyContentEvent),a.default.CallNavigationHelper.startEmergencyCall(o,i,t).catch((e=>{d.warn(c.LogTraceArea.GenericUnsafe,"Failed to place emergency call, reason: "+JSON.stringify(e)),d.track(new h.EmergencyCallFailed)}))):d.warn(c.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number suffix"):d.warn(c.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number country")}}},988773:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(174958),n=o.__importStar(i(496486)),s=o.__importDefault(i(150343)),r=o.__importStar(i(44717)),l=i(815146),c=o.__importStar(i(85385)),d=o.__importDefault(i(201721)),u=o.__importDefault(i(341994)),h=o.__importDefault(i(328416)),p=o.__importStar(i(427393)),g=o.__importDefault(i(655192)),C={a:2,b:2,c:2,d:3,e:3,f:3,g:4,h:4,i:4,j:5,k:5,l:5,m:6,n:6,o:6,p:7,q:7,r:7,s:7,t:8,u:8,v:8,w:9,x:9,y:9,z:9,å:2,ä:2,á:2,ā:2,č:2,é:3,ē:3,í:4,ī:4,ģ:4,ķ:5,ļ:5,ö:6,ó:6,õ:6,ø:6,ņ:6,š:7,ü:8,ú:8,ū:8,ž:9,а:2,б:2,в:2,г:2,д:3,е:3,ж:3,з:3,и:4,й:4,к:4,л:4,м:5,н:5,о:5,п:5,р:6,с:6,т:6,у:6,ф:7,х:7,ц:7,ч:7,ш:8,щ:8,ъ:8,ы:8,ь:9,э:9,ю:9,я:9};t.default=class{static isEmergencyNumber(e){const t=s.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedNumbers;return!!e.suffix&&n.includes(t,e.suffix)}static getEmergencyCallingCountrySubstitute(e){const t=this.getDefaultEmergencyCallingCountry();if(t&&e!==t&&this.allowedEmergencyCallingDestinationCountry(t))return h.default.getCountryByCode(t)}static isCallableNumber(e){return e.emergency?this.allowedEmergencyCallingDestinationCountry(n.toLower(e.countryCode)):!!e.prefix&&!!e.suffix&&e.suffix.length>1}static isValidPhoneNumberInput(e){return!!e&&/^\+?[\d\s]*(,[\d\s\*\#,]*$|$)/.test(e)}static getDefaultEmergencyCallingCountry(){return u.default.getEmergencyCallDefaultCountry()}static allowedEmergencyCallingDestinationCountry(e){return n.includes(s.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedCountries,e)}static normalizePhoneNumber(e){if(!e)return"";let t,i=0;const o=s.default.getS4LEntitlementFeatures().SCE.Dialpad.NumberInput.decodeHtmlMaxIterations;try{do{t=e,e=decodeURIComponent(e),i++}while(t!==e&&i<o)}catch(t){c.error(l.LogTraceArea.DialerPanel,"[DialerPhoneNumberUtils] Failed to decode input number: "+a.pii.Omit(e))}let n=e.replace(/[^\d\+\*\#,]/g,"");return n.lastIndexOf("+")===n.length-1?"+":(n=n.replace(/(?!^)\+/g,""),n=n.replace(/^00/,"+"),"00"===n?"+":n)}static filterPhoneNumberChar(e,t){return t&&/[\d\+\*\#,]/.test(t)&&this.isValidPhoneNumberInput(e+t)?t:""}static getCountryDestinationPrefixIndex(e){const t={};let i=-1,o=0;return n.each(e,((e,a)=>{t[e.countryCode]||(t[e.countryCode]=[],++o),t[e.countryCode].push(a),i<e.countryCode&&(i=e.countryCode)})),{index:t,indexSize:o,maxLength:i>=0?i.toString().length:0}}static getFormattedPhoneNumber(e,t){if(!t)return e;const i=t.length+1;return e.length===i?e:e.substring(0,i)+" "+e.substring(i)}static isE164Format(e){return 0===e.indexOf("+")}static getE164FormattedPhoneNumber(e,t){return e?"+"+e+(t||""):""}static getPhoneNumberSuffix(e,t){return t?this.isE164Format(e)?e.slice(t.length+1):e:n.trimStart(e,"+")}static getPhoneNumberPrefixCountry(e,t){if(!e)return;const i=t.index[n.parseInt(e)];if(!i||0===i.length)return;if(1===i.length)return h.default.getCountryByCode(i[0]);const o=s.default.getS4LEntitlementFeatures().SCE.Dialpad.CountryCodeToCountryDefault[e];return o?h.default.getCountryByCode(o.toLowerCase()):h.default.getCountryByCode(i[0])}static getPhoneNumberPrefix(e,t){if(e.length<2||0!==e.indexOf("+"))return;if(!t)return;const i=t.maxLength+1;for(let o=2;o<=i;++o){const i=n.toInteger(e.substring(1,o));if(t.index[i])return i.toString();if(n.includes(s.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.TestPrefixes,i))return i.toString();if(n.includes(s.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.NonGeographicPrefixes,i))return i.toString()}}static getDefaultPstnDestinationCountry(){const e=this._getStoredDefaultPstnDestinationCountryCode()||this._getGeoIpCountryCode();if(e)return h.default.getCountryByCode(e)}static setDefaultPstnDestinationCountryCode(e){const t=this._getStoredDefaultPstnDestinationCountryCode();if(t!==e){const i=this._getGeoIpCountryCode();void 0===t&&e!==i&&c.track(new p.DefaultCountryStored(i,e)),d.default.setUserPreferencesLocal({defaultPstnDestinationCountryCode:e})}}static _getStoredDefaultPstnDestinationCountryCode(){return d.default.getUserPreferencesLocal().defaultPstnDestinationCountryCode}static _getGeoIpCountryCode(){var e;return(null===(e=s.default.getHeaders().CountryCode)||void 0===e?void 0:e.toLowerCase())||""}static getPhoneNumberMri(e){return r.sanitizeMri(e.E164,r.Namespaces.PSTN)}static phoneNumberToString(e){return"PhoneNumber(input: "+this.maskPhoneNumber(e.inputValue)+", E164: "+this.maskPhoneNumber(e.E164)+", prefix: "+e.prefix+", suffix: "+this.maskPhoneNumber(e.suffix)+", country: "+e.countryCode+", callable: "+e.callable+", emergency: "+e.emergency+", searchable: "+e.searchable+", fcp: "+e.forceChangedPrefix+")"}static maskPhoneNumber(e){return e?a.pii.Omit(e):""}static containsNonGeographicOrTestPrefixes(e){const t=s.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling;if(t){const i=t.NonGeographicPrefixes?t.NonGeographicPrefixes:[],o=t.TestPrefixes?t.TestPrefixes:[],a=i.concat(o);return n.some(a,(t=>0===e.indexOf("+"+t)))}return!1}static isCursorPlacedInPrefixArea(e,t){if(!this._isSingleCursorPlaced(t))return!1;const i=e.inputValue.length-(e.suffix?e.suffix.length:0);return t.start<i}static mapKeypadLettersToNumbers(e){const t=[];let i;e=g.default.deburrLowerCase(e);for(const o of e)i=C[o],i||0===i?t.push(i):t.push(o);return t.join("")}static _isSingleCursorPlaced(e){return e.start===e.end}}},236530:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDialPadKeyCode=function(e,t){if(t)return e===o.default.THREE||e===o.default.EIGHT;return h(e)||p(e)||e===l||e===c||e===d||e===o.default.COMMA},t.isNumberKeyCode=h,t.isNumpadNumberKeyCode=p,t.getStringFromKeyCode=function(e,t){t?e===o.default.THREE?e=d:e===o.default.EIGHT&&(e=l):p(e)?e-=a:e===c?e=l:e===o.default.COMMA&&(e=u);return String.fromCharCode(e)};const o=i(197582).__importDefault(i(54945)),a=48,n=57,s=96,r=105,l=42,c=106,d=35,u=44;function h(e){return a<=e&&e<=n}function p(e){return s<=e&&e<=r}},524526:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(174958),s=o.__importDefault(i(150343)),r=i(619429),l=o.__importDefault(i(615364)),c=i(815146),d=i(477195),u=o.__importStar(i(85385)),h=o.__importStar(i(704704)),p=o.__importDefault(i(201721)),g=o.__importDefault(i(341994)),C=o.__importStar(i(437782)),m=o.__importStar(i(94534));t.default=new class{getCallRecorderBotMri(){return p.default.getUserPreferencesLocal().callRecorderBotMriOverride||s.default.getS4LCMCFeatures().callRecorderBotMri}getCallRecorderBotMriFilter(){const e=p.default.getUserPreferencesLocal().callRecorderBotMriOverride,t=s.default.getS4LCMCFeatures().callRecorderBotMriFilter;return e?[e,...t]:t}setCallRecorderBotOverride(e){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.setCallRecorderBotOverride mri: "+C.mriOrId(e)),p.default.setUserPreferencesLocal({callRecorderBotMriOverride:e})}clearCallRecorderBotOverride(){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.clearCallRecorderBotOverride"),p.default.setUserPreferencesLocal({callRecorderBotMriOverride:void 0})}getCallTranslatorBotMri(){return p.default.getUserPreferencesLocal().callTranslatorBotMriOverride||s.default.getS4LCMCFeatures().callTranslatorBotConfig.botMri}getCallTranslatorBotMriFilter(){const e=p.default.getUserPreferencesLocal().callTranslatorBotMriOverride,t=s.default.getS4LCMCFeatures().callTranslatorBotConfig.botMriFilter;return e?[e,...t]:t}setCallTranslatorBotOverride(e){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotOverride mri: "+C.mriOrId(e)),p.default.setUserPreferencesLocal({callTranslatorBotMriOverride:e})}clearCallTranslatorBotOverride(){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.clearCallTranslatorBotOverride"),p.default.setUserPreferencesLocal({callTranslatorBotMriOverride:void 0})}setCallTranslatorBotHideInRosterOverride(e){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotHideInRosterOverride hide: "+e),p.default.setUserPreferencesLocal({callTranslatorBotHideInRosterOverride:e})}getLocalCallTranslatorBotSpokenLanguageLocale(e=void 0){const t=this.getCallTranslatorSpokenLanguage(e);if(t&&!a.isEmpty(t))return t;const i=g.default.getCallTranslatorBotSubtitleLanguageLocale();return i&&!a.isEmpty(i)?i:h.getLocale()}getLocalPstnCallTranlatorBotSpokenLanguageLocale(e){if(e){const t=g.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(t&&t[e]&&t[e].local)return t[e].local}const t=g.default.getCallTranslatorBotSubtitleLanguageLocale();return t&&!a.isEmpty(t)?t:h.getLocale()}setLocalPstnCallTranlatorBotSpokenLanguageLocale(e,t){let i=g.default.getCallPstnTranslatorBotSpokenLanguageLocales();i||(i={}),i[e]||(i[e]={}),i[e].local=t,g.default.setCallPstnTranslatorBotSpokenLanguageLocales(i)}getOtherPstnCallTranlatorBotSpokenLanguageLocale(e){if(e){const t=g.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(t&&t[e]&&t[e].other)return t[e].other}}setOtherPstnCallTranlatorBotSpokenLanguageLocale(e,t){let i=g.default.getCallPstnTranslatorBotSpokenLanguageLocales();i||(i={}),i[e]||(i[e]={}),i[e].other=t,g.default.setCallPstnTranslatorBotSpokenLanguageLocales(i)}switchPstnCallTranlatorBotSpokenLanguageLocales(e){const t=g.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(!t||!t[e])return;const i=t[e].local,o=t[e].other;t[e].local=o,t[e].other=i,g.default.setCallPstnTranslatorBotSpokenLanguageLocales(t)}getAllowedCallTranslatorCaptionsPositionMode(e,t=!1,i=!1){if(t||i)return d.CaptionsPositionMode.float;if(e&&this._isCaptionsPositionModeEnabled(e))return e;const o=s.default.getS4LCMCFeaturesNoSubscription().callCaptionsPositionModeDefault;return this._isCaptionsPositionModeEnabled(o)?o:d.CaptionsPositionMode.float}_isCaptionsPositionModeEnabled(e){const t=s.default.getS4LCMCFeaturesNoSubscription();switch(e){case d.CaptionsPositionMode.bottom:return t.callCaptionsBottomPanel.enabled;case d.CaptionsPositionMode.left:return t.callCaptionsLeftPanel.enabled;case d.CaptionsPositionMode.float:return t.callCaptionsFloatPanel.enabled;default:return!1}}getCallTranslatorSpokenLanguage(e){if(e){const t=g.default.getCallTranslatorSpokenLanguage();if(t&&t[e])return t[e]}const t=g.default.getCallTranslatorBotSubtitleLanguageLocale();return t&&!a.isEmpty(t)?t:h.getLocale()}setCallTranslatorSpokenLanguage(e,t){u.log(c.LogTraceArea.Calling,`Setting call captions spoken language to ${t} for conversation ${n.pii.Mri(e)}`);const i=g.default.getCallTranslatorSpokenLanguage()||{};i[e]=t,g.default.setCallTranslatorSpokenLanguage(i)}getLocalCallTranslatorBotSubtitleLanguageLocale(e=void 0){const t=this.getCallTranslatorSpokenLanguage(e);if(t&&!a.isEmpty(t))return t;const i=g.default.getCallTranslatorBotSubtitleLanguageLocale();return i&&!a.isEmpty(i)?i:h.getLocale()}isDeviceLanguageSupportedForTranslation(){const e=s.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech,t=this.getLocalCallTranslatorBotSpokenLanguageLocale();return e.includes(m.getLocaleStandardized(t))}isLanguageSupportedForTranslation(e){return s.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech.includes(m.getLocaleStandardized(e))}isConversationTranslated(e){const t=(0,l.default)().getConversation(e);return t?this.isDeviceLanguageSupportedForTranslation()&&t.getTranslationState()===r.TranslationState.Enabled:(u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation"),!1)}getConversationTranslationState(e){const t=(0,l.default)().getConversation(e);if(t)return t.getTranslationState();u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation")}getCallAudienceBotMri(){return p.default.getUserPreferencesLocal().callAudienceBotMriOverride||s.default.getS4LCMCFeatures().callAudienceBotConfig.botMri}getCallAudienceBotMriFilter(){const e=p.default.getUserPreferencesLocal().callAudienceBotMriOverride,t=s.default.getS4LCMCFeatures().callAudienceBotConfig.botMriFilter;return e?[e,...t]:t}getBotType(e){return a.includes(this.getCallAudienceBotMriFilter(),e)?d.BotType.Audience:a.includes(this.getCallGridViewBotMriFilter(),e)?d.BotType.GridView:a.includes(this.getCallRecorderBotMriFilter(),e)?d.BotType.Recorder:a.includes(this.getCallTranslatorBotMriFilter(),e)?d.BotType.Translator:void 0}setCallAudienceBotOverride(e){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.setCallAudienceBotOverride mri: "+C.mriOrId(e)),p.default.setUserPreferencesLocal({callAudienceBotMriOverride:e})}clearCallAudienceBotOverride(){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.clearCallAudienceBotOverride"),p.default.setUserPreferencesLocal({callAudienceBotMriOverride:void 0})}getCallGridViewBotMri(){return p.default.getUserPreferencesLocal().callGridViewBotMriOverride||s.default.getS4LCMCFeatures().callGridViewBotConfig.botMri}getCallGridViewBotMriFilter(){const e=p.default.getUserPreferencesLocal().callGridViewBotMriOverride,t=s.default.getS4LCMCFeatures().callGridViewBotConfig.botMriFilter;return e?[e,...t]:t}setCallGridViewBotOverride(e){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.setCallGridViewBotOverride mri: "+C.mriOrId(e)),p.default.setUserPreferencesLocal({callGridViewBotMriOverride:e})}clearCallGridViewBotOverride(){u.log(c.LogTraceArea.Calling,"InCallBotMriUtils.clearCallGridViewBotOverride"),p.default.setUserPreferencesLocal({callGridViewBotMriOverride:void 0})}getCallFullscreenBotMris(){return[...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getMultiParticipantInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getNonVisibleInCallBotMris(){const e=s.default.getS4LCMCFeatures().callTranslatorBotConfig.hideInRoster,t=p.default.getUserPreferencesLocal().callTranslatorBotHideInRosterOverride,i=this.getCallRecorderBotMriFilter();return!t&&e?[...i,...this.getCallTranslatorBotMriFilter()]:i}getNonInteractiveInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}}},276602:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchCameraCommand=t.TwincamCommand=t.ToggleHoldCallCommand=t.ToggleCallStatsCommand=t.ShowBingBackgroundsCommand=t.InvitePeopleCommand=t.NativeMobileInvitePeopleCommand=t.ToggleSkypeTranslateCommand=t.ToggleCaptionsCommand=t.ToggleNoiseSuppressionCommand=t.ToggleIncomingVideoCommand=t.BackgroundBlurCommand=t.ToggleRecordCommand=t.ChangeTogetherModeBackgroundCommand=t.ToggleAudienceModeCommand=t.MomentCommand=t.SendReactionCommand=t.ParticipantsCommand=t.AddToCallCommand=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(148540),s=i(279211),r=o.__importDefault(i(363091)),l=o.__importDefault(i(150343)),c=i(962234),d=o.__importDefault(i(369347)),u=o.__importStar(i(44717)),h=i(513800),p=o.__importStar(i(181896)),g=o.__importDefault(i(53179)),C=o.__importDefault(i(947878)),m=o.__importDefault(i(638260)),S=i(460515),_=o.__importDefault(i(132680)),f=i(843890),y=o.__importDefault(i(541367)),T=o.__importDefault(i(615364)),b=i(815146),v=o.__importDefault(i(524526)),I=o.__importStar(i(85385)),w=o.__importStar(i(704704)),P=o.__importDefault(i(466321)),M=i(675862),D=o.__importDefault(i(740794)),A=o.__importDefault(i(421334)),k=o.__importDefault(i(791384)),R=i(967338),x=o.__importDefault(i(393443)),L=i(331079),B=o.__importDefault(i(19973)),V=o.__importDefault(i(989819)),O=o.__importDefault(i(760989)),E=i(627924),N=o.__importDefault(i(601976)),F=i(16549),U=i(641400),H=i(873324);t.AddToCallCommand=class{constructor(e,t,i,o,a){this._callId=e,this._info=t,this._conversationMri=i,this._context=o,this._origin=a}canExecute(){return d.default.CallingFeaturesHelper.allowAddToCall(this._info)}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"AddToCallCommand.execute callId: ${this._callId} causeId: ${causeId}"),I.log(b.LogTraceArea.CallingUI,"AddToCallCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),s.PushNotifications.onCallScreenClose(),D.default.openAddToCall(this._conversationMri,this._callId,this._origin,this._context(),e),B.default.updateCallRosterTelemetry(this._callId,e,(e=>e.callRosterAddToCall()))}};t.ParticipantsCommand=class{constructor(e,t,i){this._callId=e,this._conversationMri=t,this._context=i}canExecute(){const e=l.default.getS4LCMCFeaturesNoSubscription().enableParticipantsButtonPstnMobile,t=!d.default.CallingStore.isOneOnOneCall(this._callId),i=(0,T.default)().getConversation(this._conversationMri),o=!(!(null==i?void 0:i.isGroupConversation())||!i.getThreadMembers().find((e=>u.isPhoneMri(e.id))));return e&&t&&o}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,`ParticipantsCommand.execute callId: ${this._callId} causeId: ${e}`),I.log(b.LogTraceArea.CallingUI,`ParticipantsCommand.onNavigateAwayFrom Call onCallScreenClose, callId: ${this._callId} causeId: ${e}`),s.PushNotifications.onCallScreenClose(),D.default.openCallRoster(this._conversationMri,this._callId,e,this._context())}};t.SendReactionCommand=class{constructor(e,t,i,o,a){this._reactionType=e,this._reactionKey=t,this._callId=i,this._info=o,this._reactionsConversationMri=a}canExecute(){return d.default.CallingFeaturesHelper.allowReactions(this._info)}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"SendReactionCommand.execute callId: ${this._callId} causeId: ${causeId}");const t={reactionInfo:{type:this._reactionType,key:this._reactionKey},causeId:e,timestamp:Date.now(),postSource:b.PostSource.CallReactionPressed,callId:this._callId,conversationMri:this._info.conversationMri,reactionsConversationMri:this._reactionsConversationMri,logTraceArea:b.LogTraceArea.CallReactionsDrawer};h.CallReactionPostingHelpers.postReaction(t)}};t.MomentCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._reactionsConversationMri=i}canExecute(){return d.default.CallingFeaturesHelper.allowSnapshots(this._info)&&f.CallingCapabilities.callSnapshotSupported()}execute(){const e=O.default.newCauseId(),t=x.default.SkypeCameraCapture;I.log(b.LogTraceArea.CallingUI,"MomentCommand.execute callId: ${this._callId} causeId: ${causeId}");const i=[this._info.conversationMri],o=this._info.conversationMri,a=this._reactionsConversationMri,n=d.default.CallingStore.getRankedSpeakerMris(this._callId);t.playOnce(e),g.default.takeSnapshot(e,this._callId,o,a,n,i),k.default.maybeAnnounceForAccessibility(w.getString("CallPanel.SnapshotPosted")),m.default.updateCallTelemetry(this._callId,e,(e=>e.postPhotoSnapshot()))}};t.ToggleAudienceModeCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isAudienceMode=i}canExecute(){return d.default.CallingFeaturesHelper.allowCallAudienceBot(this._info)}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"AudienceCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isAudienceMode?d.default.InCallBotService.stopAudienceMode(this._callId,e):d.default.InCallBotService.startAudienceMode(this._callId,e)}};class j{constructor(e,t){this._callId=e,this._conversationMri=t}canExecute(){return j.canExecute(this._callId,this._conversationMri)}static canExecute(e,t){if(a.isUndefined(e)||a.isUndefined(t))return!1;const i=C.default.getStageMode(e)===S.StageMode.TogetherMode,{enabledBackgroundSelection:o}=l.default.getS4LCMCFeatures().callAudienceBotConfig,n=d.default.CallingStore.isConnectedAudienceBotInCall(e),s=!a.isEmpty(V.default.getTogetherModeBackgrounds()),r=j._isAllowedToChangeBackgroundIfInModeratedGroup(t);if(i&&o&&n&&r){if(s)return!0;{const e="ChangeTogetherModeBackgroundCommand.canExecute no TogetherMode backgrounds to choose from";return I.warn(b.LogTraceArea.CallingUI,e),!1}}return!1}static _isAllowedToChangeBackgroundIfInModeratedGroup(e){const t=e&&(0,T.default)().getConversation(e);return!(0,M.isModerated)(t)||(0,M.isCurrentUserAdminInModeratedGroup)(t)}execute(){const e=O.default.newCauseId();m.default.togetherModeSceneChangeRequestCount(this._callId,e);const t={conversationMri:this._conversationMri,onChangeBackground:t=>{d.default.AudienceBotService.selectAudienceScene(this._callId,e,t.sceneId)},onStartTogetherMode:a.noop,onClose:a.noop,isAudienceBotInCall:!0,selectedBackground:undefined};D.default.navigateToTogetherModePanel(t,V.default.getPanelId())}}t.ChangeTogetherModeBackgroundCommand=j;t.ToggleRecordCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isRecording=i}canExecute(){const e=d.default.CallingStore.getCallRecordingInitiator(this._callId);return d.default.CallingFeaturesHelper.allowRecording(this._info)&&d.default.InCallBotUtils.showCallRecorderControls(e)}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"RecordCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isRecording?d.default.InCallBotService.stopRecording(this._callId,e):d.default.InCallBotService.startRecording(this._callId,e)}};t.BackgroundBlurCommand=class{constructor(e,t,i,o){this._callId=e,this._isVideoActive=t,this._isBackgroundBlurEnabled=i,this._isBackgroundBlurSelected=o}canExecute(){return this._isBackgroundBlurEnabled&&this._isVideoActive}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,`BackgroundBlurCommand.execute callId: ${this._callId} causeId: ${e}`),this._isVideoActive&&(this._isBackgroundBlurSelected=!this._isBackgroundBlurSelected,d.default.DeviceStore.setBackgroundEffectType(this._isBackgroundBlurSelected?b.BackgroundEffect.Blur:b.BackgroundEffect.Off))}};t.ToggleIncomingVideoCommand=class{constructor(e,t,i,o){this._callId=e,this._info=t,this._audioOnlyEnabled=i,this._isIncomingVideoDisabled=o}canExecute(){return d.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"IncomingVideoCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._audioOnlyEnabled?d.default.CallingStore.stopAudioOnly(this._callId,e):this._isIncomingVideoDisabled?_.default.enableIncomingVideo(this._callId,e):_.default.disableIncomingVideo(this._callId,e)}};t.ToggleNoiseSuppressionCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._noiseSuppressionMode=i}canExecute(){return d.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(e){const t=O.default.newCauseId(),i=d.default.DeviceStore.getNoiseSuppressionMode();let o;switch(I.log(b.LogTraceArea.CallingUI,`NoiseSuppressionCommand.execute callId: ${this._callId}\n                                                       item: ${e} mode: ${this._noiseSuppressionMode} causeId: ${t}`),e){case n.NoiseSuppressionMode.Auto:o=n.NoiseSuppressionMode.Auto;break;case n.NoiseSuppressionMode.Off:o=n.NoiseSuppressionMode.Off;break;case n.NoiseSuppressionMode.Low:o=n.NoiseSuppressionMode.Low;break;case n.NoiseSuppressionMode.High:o=n.NoiseSuppressionMode.High;break;default:return}this._noiseSuppressionMode=o,d.default.DeviceStore.setNoiseSuppressionMode(this._noiseSuppressionMode);let a=o;a===n.NoiseSuppressionMode.Auto&&l.default.getS4LCMCFeatures().enableDefaultHighNSMode&&(I.log(b.LogTraceArea.CallingUI,"[OverflowMenuCommands][ToggleNoiseSuppressionCommand] change Auto to High"),a=n.NoiseSuppressionMode.High),d.default.CallingStore.setNoiseSuppressionMode(a),I.track(new R.NoiseSuppressionSettingsEvent(!0,i,o,c.MicrophoneSettingsOrigin.InCallPopup))}};t.ToggleCaptionsCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isTranslating=i}canExecute(){const e=v.default.isConversationTranslated(this._info.conversationMri),t=d.default.InCallBotService.isPstnTranslationEnabled(this._info.callId),i=d.default.InCallBotService.isSkypeTranslationEnabled(this._info.callId),o=d.default.CallingFeaturesHelper.allowCaptioning(this._info);return I.log(b.LogTraceArea.CallingUI,`[ToggleCaptionsCommand] [canExecute] allowCaptioning: ${o}, isConversationTranslated: ${e}, isPstnTranslationEnabled: ${t}, isSkypeTranslationEnabled: ${i}`),o&&!e&&!t&&!i}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"CaptionsCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isTranslating?d.default.InCallBotService.stopTranslator(this._callId,e):d.default.InCallBotService.startTranslator(this._callId,e)}};t.ToggleSkypeTranslateCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isTranslating=i}canExecute(){const e=d.default.InCallBotService.isCaptioningEnabled(this._info.callId),t=v.default.isConversationTranslated(this._info.conversationMri),i=d.default.InCallBotService.isPstnTranslationEnabled(this._info.callId);return d.default.CallingFeaturesHelper.allowSkypeTranslation(this._info)&&!t&&!i&&!e}execute(){const e=O.default.newCauseId();I.log(b.LogTraceArea.CallingUI,"TranslatorCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isTranslating?d.default.InCallBotService.stopSkypeTranslationConsent(this._callId,e):d.default.InCallBotService.startSkypeTranslationConsent(this._callId,e)}};t.NativeMobileInvitePeopleCommand=class{constructor(e,t,i){this._conversationId=e,this._origin=t,this._callId=i}canExecute(){const e=(0,T.default)().getConversation(this._conversationId);return!(!(null==e?void 0:e.isGroupConversation())||!(null==e?void 0:e.isJoinEnabled()))&&(this._joinLink=y.default.getLink(this._conversationId),!!this._joinLink)}execute(){this._joinLink&&P.default.showMobile({threadId:this._conversationId,joinLink:this._joinLink,callId:this._callId,meetNowParameters:{origin:this._origin}})}};t.InvitePeopleCommand=class{constructor(e,t){this._conversationId=e,this._rootViewId=t}canExecute(){var e;const t=(0,T.default)().getConversation(this._conversationId);return null!==(e=null==t?void 0:t.isGroupConversation())&&void 0!==e&&e}execute(){const e=N.default.getDisplayName(this._conversationId);D.default.navigateToGroupShare(this._conversationId,e,E.InviteLinkOrigin.QuickCallPanel,this._rootViewId)}};t.ShowBingBackgroundsCommand=class{constructor(e,t){this._callId=e,this._context=t}canExecute(){const e=d.default.CallingFeaturesHelper.bingBackgroundsEnabled(),t=d.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(this._callId);return e&&t>0}execute(){I.log(b.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.execute callId: ${this._callId}"),I.log(b.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),s.PushNotifications.onCallScreenClose(),D.default.openBingBackgroundsOverview(this._callId,this._context())}};t.ToggleCallStatsCommand=class{constructor(e,t,i){this._callId=e,this._context=t,this._modal=i}canExecute(){return l.default.getS4LCMCFeatures().enableCallTechnicalInformation&&!A.default.isMobileScreenReaderEnabled()&&f.CallingCapabilities.callTechnicalInformationSupported()}execute(){D.default.navigateToCallingDebugPanel(this._callId,this._context,this._modal)}};t.ToggleHoldCallCommand=class{constructor(e,t,i=F.Color.white){this._callInfo=e,this._causeId=null!=t?t:O.default.newCauseId(),this._iconColor=i,this._allowHoldCall=d.default.CallingFeaturesHelper.allowHoldCall(e),this._isCallOnHoldResumeable=void 0!==e.callId&&d.default.CallingStore.isCallOnHoldResumeable(e.callId)}canExecute(){return void 0!==this._callInfo.callId&&(this._allowHoldCall||this._isCallOnHoldResumeable)}execute(){var e;const t=d.default.ActiveCallUIHelper.connectedToActiveCall(this._callInfo.conversationMri),i=d.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();I.log(b.LogTraceArea.Calling,`ToggleHoldCommand.execute ${t?"HOLD":"RESUME"} causeId: ${this._causeId}`),t?(d.default.CallingStore.hold(this._callInfo.callId,this._causeId),m.default.trackUserAction(H.CallUserActionType.HoldCall,this._callInfo.callId,this._causeId,b.NavigationCallOrigin.CallControls)):(i&&i!==this._callInfo.callId?d.default.CallingStore.hold(i,this._causeId).then(this._unhold):this._unhold(),m.default.trackUserAction(H.CallUserActionType.ResumeCall,null!==(e=this._callInfo.callId)&&void 0!==e?e:"",this._causeId,b.NavigationCallOrigin.CallControls))}getButtonDescriptor(){return this._allowHoldCall?{key:S.CallControlsOverflowItem.ToggleHoldCall,icon:{icon:U.SkypeIcon.Pause,color:this._iconColor},title:w.getString("CallControlsOverFlowMenu.HoldCall"),accessibilityLabel:w.getString("CallControlsOverFlowMenu.HoldCall"),onPress:()=>this.execute()}:this._isCallOnHoldResumeable?{key:S.CallControlsOverflowItem.ToggleHoldCall,icon:{icon:U.SkypeIcon.Play,color:this._iconColor},title:w.getString("CallControlsOverFlowMenu.ResumeCall"),accessibilityLabel:w.getString("CallControlsOverFlowMenu.ResumeCall"),onPress:()=>this.execute()}:void 0}_unhold(){this._callInfo.callId&&d.default.CallingStore.unhold(this._callInfo.callId,this._causeId)}};t.TwincamCommand=class{constructor(e,t){this._callId=e,this._info=t,this._onStopTwincamButtonPress=()=>{const e=O.default.newCauseId();if(I.log(b.LogTraceArea.Calling,"_onStopTwincamButtonPress: causeId: "+e),l.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick){const t=u.getReactionsThreadMriForCallId(this._callId),i=r.default.getSkypeMri();p.postCallEventNotification(L.ReactionsTextType.CallEventKickedOutOwn,i,this._callId,this._info.conversationMri,t,e)}d.default.CallingStore.removeOtherEndpoints(this._callId,e)}}canExecute(){return!a.isUndefined(this._callId)&&!a.isUndefined(this._info.conversationMri)&&d.default.CallingFeaturesHelper.allowTwincam(this._info)}execute(e){if(e)this._onStopTwincamButtonPress();else{const{twinCamDisableSyncMessageOnQRCodeClicked:e}=l.default.getS4LCMCFeaturesNoSubscription();e||d.default.CallPostMessageService.postTwincamSyncMessage(this._info.conversationMri);const t={callId:this._callId,conversationMri:this._info.conversationMri,onStopTwincamPressed:this._onStopTwincamButtonPress,isTwincamConnected:d.default.CallingStore.hasConnectedTwincam(this._callId)};D.default.navigateToTwincamPanel(t)}}};t.SwitchCameraCommand=class{constructor(e,t){this._callId=e,this._isVideoActive=t}canExecute(){return _.default.isMobileUI()&&l.default.getS4LCMCFeaturesNoSubscription().enableNewCallPanel.enableExperimentalHeader&&this._isVideoActive}execute(){const e=O.default.newCauseId(),t=d.default.DeviceStore.getCameras(),i=d.default.DeviceStore.getSelectedCamera(),o=i&&i.position,a=i&&i.id,n=t.find((e=>e.id!==a&&e.position!==o)),s=null==n?void 0:n.id,r=null==n?void 0:n.position;s&&r?(d.default.DeviceStore.choosePreferredDevices({camera:s},e),I.log(b.LogTraceArea.CallingUI,"[SwitchCameraCommand]",`_updateVideoSource ${a} position ${o} -> ${s} position ${r}`,`causeId: ${e}`),m.default.updateCallTelemetry(this._callId,e,(e=>e.toggleCamera()))):I.warn(b.LogTraceArea.CallingUI,"[SwitchCameraCommand] No camera found to switch to.")}}},231817:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LowerHandParticipantCommand=t.LowerHandCommand=t.RaiseHandCommand=void 0;const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importDefault(i(132680)),s=o.__importStar(i(85385)),r=i(602370),l=o.__importDefault(i(760989));t.RaiseHandCommand=class{constructor(e,t){this._callId=e,this._info=t}isFeatureEnabled(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)}canExecute(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)&&!a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){return s.track(new r.RaiseHandTelemetryEvent(this._callId,r.RaiseHandAction.RaiseHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1)),a.default.CallingStore.raiseHand(this._callId,l.default.newCauseId())}};t.LowerHandCommand=class{constructor(e,t){this._callId=e,this._lowerHandOrigin=t}canExecute(){return a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){return s.track(new r.RaiseHandTelemetryEvent(this._callId,r.RaiseHandAction.LowerMyHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(!0),a.default.CallingStore.lowerHandForCurrentUserMri(this._callId,l.default.newCauseId())}};t.LowerHandParticipantCommand=class{constructor(e,t,i,o,a){this._callId=e,this._mri=t,this._lowerHandOrigin=i,this._isLocal=o,this._displayName=a}isHandRaised(){return a.default.CallingStore.isHandRaisedForMri(this._mri,this._callId)}canExecute(){return n.default.canHandBeLoweredForParticipant(this._callId,this._mri)}execute(){a.default.CallingStore.lowerHandForMri(this._mri,this._callId,l.default.newCauseId()),s.track(new r.RaiseHandTelemetryEvent(this._callId,r.RaiseHandAction.LowerOthersHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(this._isLocal,this._displayName)}}},223815:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocallyStartedRinglessCallType=void 0;const o=i(197582),a=o.__importDefault(i(150343)),n=o.__importDefault(i(369347)),s=o.__importDefault(i(99741)),r=o.__importStar(i(44717)),l=o.__importDefault(i(615364)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importDefault(i(341994)),h=o.__importDefault(i(740794)),p=o.__importDefault(i(760989));var g;!function(e){e[e.OnePerson=0]="OnePerson",e[e.SmallGroup=1]="SmallGroup",e[e.LargeGroup=2]="LargeGroup",e[e.GoLive=3]="GoLive",e[e.None=4]="None"}(g||(t.LocallyStartedRinglessCallType=g={}));class C{static getRinglessCallType(e,t){const i=C.getMemberCount(e);return t&&!this.isLocallyStartedRinglessCall(e,t)?g.None:1===i?g.OnePerson:i<=a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCallForSmallGroups?g.SmallGroup:i>a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCall?g.LargeGroup:g.GoLive}static getMemberCount(e){const t=(0,l.default)().getConversation(e);return t?Math.max(t.getMemberCount(),0):0}static isLocallyStartedRinglessCall(e,t){return n.default.CallingStore.hasStartedCallLocallyGoLive(t)}static handleRingTheGroup(e,t){const i=s.default.getInactiveGroupMembers(t,e);n.default.CallParticipantUtils.addUsersToCallOrRing(i,t,e,i,c.NavigationAddToCallOrigin.GoLiveInformationView);const o=p.default.newCauseId();d.log(c.LogTraceArea.CallingUI,`[GoLiveInformationPanel] _handleRingAll, causeId: ${o}`)}static isRingTheGroupOptionAvailable(e,t){return!(!C.isLocallyStartedRinglessCall(e,t)||n.default.CallingStore.hasRingingParticipants(t,!0)||this.getRinglessCallType(e)!==g.SmallGroup)}static isPotentialRinglessCall(e,t){if(!r.isGroupConversation(e))return!1;switch(C.getRinglessCallType(e)){case g.SmallGroup:return t;case g.LargeGroup:return!0;default:return!1}}static isInterstitialShown(e){const t=C.getMemberCount(e);if(1!==t)return t>a.default.getS4LCMCFeatures().maximumGroupSizeRing?u.default.getInterstitialForLargeGroupRinglessCallsShown():u.default.getInterstitialForSmallGroupRinglessCallsShown()}static shouldShowInterstitial(e,t){return!C.isInterstitialShown(e)&&C.isPotentialRinglessCall(e,t)}static maybeShowRinglessCallInterstitial(e,t,i,o){if(C.isInterstitialShown(e)||!C.isPotentialRinglessCall(e,t))return;d.log(c.LogTraceArea.CallingUI,"RinglessCallUtils show Ringlesscall interstitial");const a=C.getRinglessCallType(e)===g.LargeGroup;h.default.navigateToRinglessCallInterstitial({conversationMri:e,origin:i,withVideo:t,isLargeGroup:a,causeId:o}),a?u.default.setInterstitialForLargeGroupRinglessCallsShown(!0):u.default.setInterstitialForSmallGroupRinglessCallsShown(!0)}}t.default=C},686196:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileScreenShareToggleCommand=void 0;const o=i(197582),a=(o.__importDefault(i(807592)),o.__importDefault(i(369347))),n=o.__importDefault(i(638260)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importStar(i(704704)),c=o.__importDefault(i(791384)),d=o.__importDefault(i(760989));t.MobileScreenShareToggleCommand=class{constructor(e){this._callInfo=e}canExecute(){const e=a.default.DeviceStore.getAvailableScreens();return e&&e.length>0&&a.default.CallingFeaturesHelper.allowMobileScreenSharing(this._callInfo)}execute(){const e=this._callInfo.callId;if(!e)return;const t=d.default.newCauseId(),i=a.default.CallingStore.isScreenSharing(e);if(r.log(s.LogTraceArea.CallingUI,`ScreenShareToggleCommand isScreenShareActive:${i}; callId: ${e}; causeId: ${t}`),i)a.default.CallingStore.stopScreenSharing(e,t),n.default.updateCallTelemetry(e,t,(e=>e.stopScreenSharing())),c.default.maybeAnnounceForAccessibility(l.getString("AccessibilityLabel.ScreenShareStopped"));else{const i=a.default.DeviceStore.getAvailableScreens();if(i&&i.length>0){(()=>{a.default.CallingStore.startScreenSharing(e,t,i[0],!1),n.default.updateCallTelemetry(e,t,(e=>e.startScreenSharing())),c.default.maybeAnnounceForAccessibility(l.getString("AccessibilityLabel.ScreenShareStarted"))})()}else r.error(s.LogTraceArea.CallingUI,"No screens are available for sharing")}}}},618702:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LgTmModeElementsManager=t.PresentationModeElementsManager=t.SpeakerModeElementsManager=t.GridModeElementsManager=t.FullScreenBotType=t.StageModeElementsManager=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(167606),s=o.__importDefault(i(363091)),r=o.__importStar(i(85385)),l=o.__importDefault(i(760989)),c=i(460515),d=o.__importDefault(i(524526)),u=i(619429),h=o.__importDefault(i(369347)),p=i(132680),g=o.__importDefault(i(854929)),C=o.__importDefault(i(150343));class m{constructor(e,t,i,o){this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=o,this._filterOutNonDisplayableParticipants=e=>!0}onInit(e){return r.log(n.LogTraceArea.CallingUI,"StageModeElementsManager: initializing participants"),this.updateParticipants(e)}updateParticipants(e){const t=a.filter(e,this._filterOutNonDisplayableParticipants),i=p.CallUIUtils.getOrderedByVideoPresenceParticipants(a.compact(t),this._callId);if(C.default.getS4LCMCFeatures().modernCallStage.enableVideoPrioritization){const e=l.default.newCauseId();this._updateVideoPriorityOrder(i,e)}const o=this._getStageParticipants(i),n=a.without(i,...o),s=this._getTrayParticipants(i,o);return{stageParticipants:o,trayParticipants:s,trayRemainder:n.length-s.length}}setTrayParameters(e,t,i=1,o=!1){return this._trayMainAxisSize=e,this._trayItemSizeMultiplier=i,this._trayItemsCompact=o,this.updateParticipants(t)}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[s.default.getSkypeMri(),...e];h.default.CallingStore.setRemoteVideoPriorityOrder(this._callId,a.without(i,c.CallStageElementKeys.localUserKey),t)}_getTrayParticipants(e,t,i=!1,o=!1){const n=a.without(e,...t);return p.CallUIUtils.getOrderedDisplayedTrayParticipants(n,this._trayMainAxisSize,this._callId,this._trayItemSizeMultiplier,this._trayItemsCompact,i,o)}}var S;t.StageModeElementsManager=m,function(e){e[e.LargeGrid=0]="LargeGrid",e[e.TogetherMode=1]="TogetherMode"}(S||(t.FullScreenBotType=S={}));t.GridModeElementsManager=class extends m{constructor(e,t,i,o,n,s,r){super(e,t,i,o),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=o,this._stageCapacity=n,this._onlyVideoOnStage=s,this._showSelfInTheGrid=r,this._filterOutNonDisplayableParticipants=e=>!a.includes(d.default.getNonInteractiveInCallBotMris(),e)}updateStageCapacity(e,t){return r.log(n.LogTraceArea.CallingUI,"GridModeElementsManager.updateStageCapacity to "+t),this._stageCapacity=t,this.updateParticipants(e)}_getStageParticipants(e){if(C.default.getS4LCMCFeatures().enableCallParticipantsPinning&&g.default.hasPinnedParticipants(this._callId))return this._getParticipantsForPinningMode(e);let t=e;this._showSelfInTheGrid||(t=a.without(e,c.CallStageElementKeys.localUserKey));let i=t;return this._onlyVideoOnStage&&(i=a.filter(e,(e=>{const t=h.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId);return!!(null==t?void 0:t.shouldRenderVideo)}))),a.take(i,this._stageCapacity)}_getParticipantsForPinningMode(e){const t=a.intersection(e,g.default.getPinnedParticipants(this._callId));return a.take(t,this._stageCapacity)}_getTrayParticipants(e,t){const i=a.without(e,...t);return h.default.CallingStore.isOneOnOneCall(this._callId)&&a.remove(i,(e=>e===c.CallStageElementKeys.localUserKey)),p.CallUIUtils.getOrderedDisplayedTrayParticipants(i,this._trayMainAxisSize,this._callId,this._trayItemSizeMultiplier,this._trayItemsCompact)}};t.SpeakerModeElementsManager=class extends m{constructor(e,t,i,o){super(e,t,i,o),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=o,this._filterOutNonDisplayableParticipants=e=>!a.includes(d.default.getNonInteractiveInCallBotMris(),e)&&!a.startsWith(e,u.ScreenSharingPrefix)}_getStageParticipants(e){const t=a.minBy(e,(e=>{var t;return null===(t=h.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId))||void 0===t?void 0:t.activeSpeakerRank}));return t?[t]:[]}};t.PresentationModeElementsManager=class extends m{constructor(e,t,i,o){super(e,t,i,o),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=o,this._filterOutNonDisplayableParticipants=e=>!a.includes(d.default.getNonInteractiveInCallBotMris(),e)}_getStageParticipants(e){const t=e.find((e=>a.startsWith(e,u.ScreenSharingPrefix))),i=[];return t&&i.push(t),i}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[...this._getStageParticipants(e),...e];super._updateVideoPriorityOrder(a.uniq(i),t)}_getTrayParticipants(e,t){return super._getTrayParticipants(e,t,!0,!0)}};t.LgTmModeElementsManager=class extends m{constructor(e,t,i,o,n){super(e,t,i,o),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=o,this._botType=n,this._filterOutNonDisplayableParticipants=e=>{const t=this._getBotMrisToFilterOut();return!a.includes(d.default.getNonVisibleInCallBotMris(),e)&&!a.includes(t,e)&&!a.startsWith(e,u.ScreenSharingPrefix)}}_getStageParticipants(e){const t=this._getBotMris(),i=e.find((e=>a.includes(t,e))),o=[];return i&&o.push(i),o}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[...this._getStageParticipants(e),...e];super._updateVideoPriorityOrder(a.uniq(i),t)}_getBotMris(){switch(this._botType){case S.LargeGrid:return d.default.getCallGridViewBotMriFilter();case S.TogetherMode:return d.default.getCallAudienceBotMriFilter()}}_getBotMrisToFilterOut(){switch(this._botType){case S.LargeGrid:return d.default.getCallAudienceBotMriFilter();case S.TogetherMode:return d.default.getCallGridViewBotMriFilter()}}}},989819:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(150343)),s=o.__importStar(i(704704)),r=i(641400),l=new Set(["Auditorium","AuditoriumDark","AuditoriumGold","Amphitheater","DiningRoom","ConferenceRoom","CoffeeShop","BigConferenceRoom","AbstractDark","Halo","Underwater","Classroom","Minecraft","HolidaySnow","HolidayCave","Restaurant","WinterLodge","KitchenDining","WarmSantorini","Dinner","Celebration","Outdoors","Crowd","TropicalSunset","PowerTogether","Airplane","Birthday"]);class c{static getTogetherModeBackgrounds(){const{backgrounds:e}=n.default.getS4LCMCFeatures().callAudienceBotConfig;return a.map(e,(e=>{const t=this._getTranslatedLabel(e);return{sceneId:e.sceneId,untranslatedName:e.name,label:t,url:e.thumbSrc,maxAudience:e.maxAudience}}))}static getTogetherModeBackgroundName(e){var t;return null===(t=c.getTogetherModeBackgrounds().find((t=>t.sceneId===e)))||void 0===t?void 0:t.untranslatedName}static getPanelId(){return"_togetherModeModalId"}static getBackgroundChangeButtonIcon(){return r.SkypeIcon.Picture}static _getTranslatedLabel(e){const t=e.humanFriendlyId;if(!l.has(t))return e.name;const i=`TogetherModeBackgroundNames.${t}`;return s.getString(i)}}t.default=c},558870:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(619429),n=o.__importDefault(i(404547)),s=i(823684),r=o.__importDefault(i(615364)),l=o.__importStar(i(459287)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importDefault(i(341994)),h=o.__importDefault(i(863132)),p=o.__importStar(i(437782)),g=o.__importDefault(i(655192));t.default=new class{_getTranslationToLocale(e){const t=(0,r.default)().getConversation(e);return t?t.getMessageTranslationLocale():void 0}disableTranslation(e,t){this._changeTranslationState(e,a.TranslationState.Disabled,a.TranslationState.Disabled,t),u.default.deleteTranslationBannerDismissStates(e),d.track(new s.ConversationTranslationAction(e,c.TranslationAction.Disabled,t,this._getTranslationToLocale(e)))}cancelTranslationRequest(e,t){this._changeTranslationState(e,a.TranslationState.Disabled,a.TranslationState.Cancelled,t),u.default.deleteTranslationBannerDismissStates(e),d.track(new s.ConversationTranslationAction(e,c.TranslationAction.Cancelled,t,this._getTranslationToLocale(e)))}declineTranslationRequest(e,t){this._changeTranslationState(e,a.TranslationState.Disabled,a.TranslationState.Declined,t),u.default.deleteTranslationBannerDismissStates(e),d.track(new s.ConversationTranslationAction(e,c.TranslationAction.Declined,t,this._getTranslationToLocale(e)))}requestTranslation(e,t){this._changeTranslationState(e,a.TranslationState.Requested,a.TranslationState.Pending,t),u.default.setInCallTranslationBannerDismissState(e,!1),u.default.setConversationTranslationBannerDismissState(e,!1),d.track(new s.ConversationTranslationAction(e,c.TranslationAction.Requested,t,this._getTranslationToLocale(e)))}acceptTranslation(e,t){this._changeTranslationState(e,a.TranslationState.Enabled,a.TranslationState.Enabled,t),d.track(new s.ConversationTranslationAction(e,c.TranslationAction.Accepted,t,this._getTranslationToLocale(e)))}_changeTranslationState(e,t,i,o){d.log(c.LogTraceArea.Calling,"TranslationHelper._changeTranslationState conversationId: "+p.mriOrId(e)+" localTranslationState "+a.TranslationState[t]+" remoteTranslationState "+a.TranslationState[i]);const s=l.createTranslationSettingsMessage(e,c.PostSource.MessagePanel,o,i,!1);s?n.default.setTranslationState(e,t).then((()=>h.default.postMessage(s))).catch((e=>{d.error(c.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed: "+g.default.errorAsString(e))})):d.error(c.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed to create translation settings message")}}},97570:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trackTwincamShareIntent=function(e,t){a.Instrumentation.track(new n.TwincamShareIntent(e,t)),o.default.updateCallTelemetry(e,t,(e=>e.incrementTwincamShareIntentCount()))};const o=i(197582).__importDefault(i(638260)),a=i(82485),n=i(418926)},761896:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(380157),n=i(148540),s=o.__importDefault(i(150343)),r=o.__importDefault(i(902530)),l=o.__importDefault(i(601976)),c=o.__importDefault(i(251733)),d=o.__importStar(i(85385)),u=o.__importStar(i(704704)),h=i(815146),p=i(641400),g=i(331079),C=o.__importDefault(i(247286)),m=o.__importStar(i(44717)),S=o.__importDefault(i(597285)),_=o.__importDefault(i(60433)),f=o.__importDefault(i(363091)),y=o.__importStar(i(873324)),T=i(619429),b=o.__importDefault(i(638260));class v{constructor(){this._endedCalls={},this._unknownReasonTimestamps=[]}test_reset(){this._endedCalls={},this._unknownReasonTimestamps=[]}reportUnansweredCallActionTaken(e,t,i,o){const a=this._endedCalls[e];a?(d.log(h.LogTraceArea.UnansweredCall,"Reporting UCUX action callId: "+a.callId+" reason: "+T.UnansweredCallReason[t]+" action: "+T.UnansweredCallAction[i]+" causeId: "+a.causeId),delete this._endedCalls[e],d.track(new y.UnansweredCallActionEvent(e,r.default.CallingNodeId.get(),a.terminatedReason,a.failureType,t,i))):d.warn(h.LogTraceArea.UnansweredCall,"Attempted to report result of UCUX for unknown callId: "+e+" causeId: "+o)}unansweredCallOptionsParticipant(e,t){const i=this._reasonForAddParticipantFailedInfo(e);if(i!==T.UnansweredCallReason.None)return{reason:i,actions:v._actionsForUnansweredCall(i,e.conversationMri,!1),title:u.getString("PstnUtils.UnableToAddParticipant"),optionalSecondaryMessage:v._titleForUnansweredCall(i,e.participantInfo.mri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:v._visualInfoForUnasnweredCall(i)};d.log(h.LogTraceArea.UnansweredCall,"Skipping UCUX in participant flow - callId: "+e.callId+" ParticipantStateReason: "+n.ParticipantStateReason[e.participantInfo.reason]+" causeId: "+t)}unansweredCallOptions(e,t){if(e.terminatedReason!==n.TerminatedReason.NoPermission){const i=t.lastEventReaction?S.default.parseCallEventReaction(t.lastEventReaction):void 0,o=(null==i?void 0:i.mri)===f.default.getSkypeMri()&&(null==i?void 0:i.eventType)===g.ReactionsTextType.CallEventKickedOutOwn;if((e.terminatedReason!==n.TerminatedReason.Kicked||o)&&!e.isCallCreator&&(e.terminatedReason!==n.TerminatedReason.CallSetupError||t.hasMicrophones))return void d.log(h.LogTraceArea.UnansweredCall,"Skipping UCUX - user is not call creator and TerminatedReason is NOT Kicked callId: "+e.callId+" causeId: "+e.causeId);if(t.isPreheatedAndNotJoined)return void d.log(h.LogTraceArea.UnansweredCall,"Skipping UCUX - was preheating callId: "+e.callId+" causeId: "+e.causeId)}const i=this._reasonForCallEndedInfo(e,t);if(i!==T.UnansweredCallReason.None)return d.log(h.LogTraceArea.UnansweredCall,"Computed UCUX result callId: "+e.callId+" reason: "+T.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:v._actionsForUnansweredCall(i,e.conversationMri,this._showSendFeedbackOption()),title:v._titleForUnansweredCall(i,e.conversationMri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:v._visualInfoForUnasnweredCall(i),optionalSecondaryMessage:v._secondaryMessageForUnansweredCall(i,t)};d.log(h.LogTraceArea.UnansweredCall,"Skipping UCUX - success callId: "+e.callId+" causeId: "+e.causeId)}kickCallOptions(e,t){const i=T.UnansweredCallReason.Kicked;return d.log(h.LogTraceArea.UnansweredCall,"Computed kick UCUX result callId: "+e.callId+" reason: "+T.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:[{action:T.UnansweredCallAction.None}],title:v._titleForUnansweredCall(i,e.conversationMri,t),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:v._visualInfoForUnasnweredCall(i,t)}}_resetUnknownReasonCounter(){this._unknownReasonTimestamps=[]}_incrementUnknownReasonCounter(e){this._unknownReasonTimestamps.push(e)}_showSendFeedbackOption(){const e=this._unknownReasonTimestamps.length;if(C.default.isChild()||e<3)return!1;const t=this._unknownReasonTimestamps.slice(e-3,e);return(t[2]-t[0])/1e3<=300}_reasonForAddParticipantFailedInfo(e){let t=T.UnansweredCallReason.None;switch(e.participantInfo.reason){case n.ParticipantStateReason.PstnSkypeoutAccountBlocked:t=T.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.ParticipantStateReason.PstnCouldNotConnectToSkypeProxy:t=T.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.ParticipantStateReason.PstnBlockedByUs:t=T.UnansweredCallReason.PstnBlockedByUs;break;case n.ParticipantStateReason.PstnNumberForbidden:t=T.UnansweredCallReason.PstnNumberForbidden;break;case n.ParticipantStateReason.PstnCallTerminated:t=T.UnansweredCallReason.PstnCallTerminated;break;case n.ParticipantStateReason.PstnNumberUnavailable:t=T.UnansweredCallReason.PstnNumberUnavailable;break;case n.ParticipantStateReason.Declined:case n.ParticipantStateReason.Busy:t=T.UnansweredCallReason.DeclineParticipant;break;case n.ParticipantStateReason.PstnInsufficientFunds:case n.ParticipantStateReason.PstnNoSubscriptionCover:case n.ParticipantStateReason.PstnCreditExpired:case n.ParticipantStateReason.PstnCreditExpiredButEnough:t=T.UnansweredCallReason.InsufficientFunds;break;case n.ParticipantStateReason.PstnBlockedRegulatoryIndia:t=T.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.ParticipantStateReason.PstnInvalidNumber:t=T.UnansweredCallReason.InvalidNumber}return _.default.isPstnNetherlandsReason(e.participantInfo.callEndDiagnosticsInfo)&&(t=T.UnansweredCallReason.BlockedRegulatoryNetherlands),t}_reasonForCallEndedInfo(e,t){const i=e.failureType===n.FailureType.CallSetupFailed||0===e.durationSeconds&&e.failureType!==n.FailureType.CallDropped,o=(Date.now()-t.callCreationTime)/1e3;let s=T.UnansweredCallReason.Unknown;switch(e.terminatedReason){case n.TerminatedReason.Success:s=m.isThread(e.conversationMri)&&0===t.maxConnectedParticipants?T.UnansweredCallReason.NoAnswer:T.UnansweredCallReason.None;break;case n.TerminatedReason.Cancelled:s=o>15?T.UnansweredCallReason.NoAnswer:T.UnansweredCallReason.None;break;case n.TerminatedReason.NoNgcEndpoint:case n.TerminatedReason.NoSignalingFromPeer:case n.TerminatedReason.TemporarilyUnavailable:s=T.UnansweredCallReason.Unreachable;break;case n.TerminatedReason.NetworkError:case n.TerminatedReason.MediaDroppedError:case n.TerminatedReason.LocalHttpStackError:case n.TerminatedReason.NetworkRequestTimeoutError:case n.TerminatedReason.CannotConnectToNetworkError:case n.TerminatedReason.MediaRelayWhiteListingIssue:i?(b.default.onCallNetworkErrorReason(e.callId,e.terminatedReason),s=T.UnansweredCallReason.LocalNetworkError):s=T.UnansweredCallReason.None;break;case n.TerminatedReason.CallSetupError:t.hasMicrophones||(s=T.UnansweredCallReason.NoMicrophoneDetected);break;case n.TerminatedReason.PstnSkypeoutAccountBlocked:s=T.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.TerminatedReason.PstnCouldNotConnectToSkypeProxy:s=T.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.TerminatedReason.PstnBlockedByUs:s=T.UnansweredCallReason.PstnBlockedByUs;break;case n.TerminatedReason.PstnNumberForbidden:s=T.UnansweredCallReason.PstnNumberForbidden;break;case n.TerminatedReason.PstnCallTerminated:s=T.UnansweredCallReason.PstnCallTerminated;break;case n.TerminatedReason.PstnNumberUnavailable:s=T.UnansweredCallReason.PstnNumberUnavailable;break;case n.TerminatedReason.NoPermission:const r=c.default.permissionStatus(g.PermissionType.Microphone)===a.PermissionStatus.Granted,l=c.default.permissionStatus(g.PermissionType.Camera)===a.PermissionStatus.Granted,u=c.default.permissionStatus(g.PermissionType.ReadPhoneState)===a.PermissionStatus.Granted;if(!e.withVideo||r||l)if(r)if(l)if(u){const e="TerminatedReason.NoPermission, yet cannot identify what permissions are lacking";d.error(h.LogTraceArea.UnansweredCall,e)}else s=T.UnansweredCallReason.ReadPhoneStatePermissionDenied;else{const e="Never show 'CameraPermissionDenied' if 'withVideo' is false";d.error(h.LogTraceArea.UnansweredCall,e),s=T.UnansweredCallReason.CameraPermissionDenied}else s=T.UnansweredCallReason.MicrophonePermissionDenied;else s=T.UnansweredCallReason.MicAndCamPermissionDenied;break;case n.TerminatedReason.Missed:s=T.UnansweredCallReason.NoAnswer;break;case n.TerminatedReason.Declined:case n.TerminatedReason.Busy:s=T.UnansweredCallReason.Decline;break;case n.TerminatedReason.PstnInvalidNumber:s=T.UnansweredCallReason.InvalidNumber;break;case n.TerminatedReason.PstnEmergencyCallDenied:s=T.UnansweredCallReason.EmergencyCallDenied;break;case n.TerminatedReason.Kicked:s=T.UnansweredCallReason.Kicked;break;case n.TerminatedReason.PstnInsufficientFunds:case n.TerminatedReason.PstnNoSubscriptionCover:case n.TerminatedReason.PstnCreditExpired:case n.TerminatedReason.PstnCreditExpiredButEnough:s=T.UnansweredCallReason.InsufficientFunds;break;case n.TerminatedReason.PstnBlockedRegulatoryIndia:s=T.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.TerminatedReason.Undefined:s=T.UnansweredCallReason.None}return i||(s=T.UnansweredCallReason.None),s===T.UnansweredCallReason.Unknown?this._incrementUnknownReasonCounter(t.callCreationTime):this._resetUnknownReasonCounter(),s}static _secondaryMessageForUnansweredCall(e,t){if(e===T.UnansweredCallReason.NoMicrophoneDetected)return u.getString("UnansweredCallTitle.NoMicDetectedMessage")}static _titleForUnansweredCall(e,t,i){const o=l.default.getShortDisplayName(t)||u.getString("UnansweredCallTitle.UnknownCallee");switch(e){case T.UnansweredCallReason.NoAnswer:case T.UnansweredCallReason.Decline:return m.isGroupConversation(t)?u.getString("UnansweredCallTitle.NoAnswerGroup"):u.getString("UnansweredCallTitle.Decline",{name:o});case T.UnansweredCallReason.DeclineParticipant:return u.getString("UnansweredCallTitle.Decline",{name:o});case T.UnansweredCallReason.Unreachable:return u.getString("UnansweredCallTitle.Unreachable",{name:o});case T.UnansweredCallReason.LocalNetworkError:return u.getString("UnansweredCallTitle.NetworkError");case T.UnansweredCallReason.MicrophonePermissionDenied:return u.getString("UnansweredCallTitle.NoMicrophonePermission");case T.UnansweredCallReason.CameraPermissionDenied:return u.getString("UnansweredCallTitle.NoCameraPermission");case T.UnansweredCallReason.MicAndCamPermissionDenied:return u.getString("UnansweredCallTitle.NoMicAndCamPermission");case T.UnansweredCallReason.Kicked:{const e=this._getKickedPrimaryMessage(i);return e||u.getString("CallControls.RemovedFromCallMessage")}case T.UnansweredCallReason.NoMicrophoneDetected:return u.getString("UnansweredCallTitle.NoMicDetected");case T.UnansweredCallReason.EmergencyCallDenied:return u.getString("PstnUtils.EmergencyCallDenied");case T.UnansweredCallReason.BlockedRegulatoryIndia:return u.getString("PstnUtils.BlockedRegulatoryIndia");case T.UnansweredCallReason.BlockedRegulatoryNetherlands:return u.getString("PstnUtils.BlockedRegulatoryNetherlands");case T.UnansweredCallReason.PstnBlockedByUs:return u.getString("PstnUtils.BlockedByUs");case T.UnansweredCallReason.PstnSkypeoutAccountBlocked:return u.getString("PstnUtils.SkypeoutAccountBlocked");case T.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:return u.getString("PstnUtils.CouldNotConnectToSkypeProxy");case T.UnansweredCallReason.PstnNumberForbidden:return u.getString("PstnUtils.NumberForbidden");case T.UnansweredCallReason.PstnCallTerminated:return u.getString("PstnUtils.CallTerminated");case T.UnansweredCallReason.PstnNumberUnavailable:return u.getString("PstnUtils.NumberUnavailable");case T.UnansweredCallReason.InvalidNumber:return u.getString("PstnUtils.InvalidNumber");case T.UnansweredCallReason.Unknown:return u.getString("UnansweredCallTitle.OtherError");case T.UnansweredCallReason.TransferedToTwinCam:return u.getString("CallControls.RemovedFromCallByTransfer");case T.UnansweredCallReason.ReadPhoneStatePermissionDenied:return u.getString("UnansweredCallTitle.NoReadPhoneStatePermission")}return u.getString("UnansweredCallTitle.OtherError")}static _actionsForUnansweredCall(e,t,i){switch(e){case T.UnansweredCallReason.NoAnswer:case T.UnansweredCallReason.Unreachable:return[{action:T.UnansweredCallAction.SendMessage,prepopulatedMessage:v._chatMessagesForReason(e,t)},{action:T.UnansweredCallAction.CallPSTN}];case T.UnansweredCallReason.Decline:return[{action:T.UnansweredCallAction.SendMessage,prepopulatedMessage:v._chatMessagesForReason(e,t)}];case T.UnansweredCallReason.LocalNetworkError:return[{action:T.UnansweredCallAction.SendMessage}];case T.UnansweredCallReason.Kicked:return[{action:T.UnansweredCallAction.None}];case T.UnansweredCallReason.Unknown:const o=[{action:T.UnansweredCallAction.SendMessage,message:""}];return i?o.concat({action:T.UnansweredCallAction.SendFeedback,message:u.getString("FeedbackMechanism.FeedbackDialogTitle")}):o;case T.UnansweredCallReason.MicrophonePermissionDenied:case T.UnansweredCallReason.CameraPermissionDenied:case T.UnansweredCallReason.MicAndCamPermissionDenied:case T.UnansweredCallReason.ReadPhoneStatePermissionDenied:return[{action:T.UnansweredCallAction.PromptForPermission}];case T.UnansweredCallReason.BlockedRegulatoryIndia:return[{action:T.UnansweredCallAction.ShowRegulatoryInfoIndia}];case T.UnansweredCallReason.BlockedRegulatoryNetherlands:return[{action:T.UnansweredCallAction.ShowRegulatoryInfoNetherlands}]}return[]}static _chatMessagesForReason(e,t){if(!m.isThread(t))switch(e){case T.UnansweredCallReason.NoAnswer:case T.UnansweredCallReason.Decline:return u.getString("UnansweredCallChatMessages.CallMeBack")}}static _visualInfoForUnasnweredCall(e,t){switch(e){case T.UnansweredCallReason.Decline:case T.UnansweredCallReason.NoAnswer:case T.UnansweredCallReason.Unreachable:return{type:T.UnansweredCallVisualInfoType.Emoticon,name:"call"};case T.UnansweredCallReason.Kicked:case T.UnansweredCallReason.Unknown:if(t){const e=S.default.parseCallEventReaction(t);if(e&&e.eventType===g.ReactionsTextType.CallEventTransfer)return{type:T.UnansweredCallVisualInfoType.Emoticon,name:"yes"}}return{type:T.UnansweredCallVisualInfoType.Emoticon,name:"cry"};case T.UnansweredCallReason.NoMicrophoneDetected:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.MicrophoneOff};case T.UnansweredCallReason.LocalNetworkError:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.CallQualityIndicator};case T.UnansweredCallReason.MicAndCamPermissionDenied:case T.UnansweredCallReason.MicrophonePermissionDenied:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.MicrophoneOff};case T.UnansweredCallReason.CameraPermissionDenied:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.VideoOff};case T.UnansweredCallReason.EmergencyCallDenied:case T.UnansweredCallReason.BlockedRegulatoryIndia:case T.UnansweredCallReason.BlockedRegulatoryNetherlands:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.CallBlockedFilled};case T.UnansweredCallReason.PstnBlockedByUs:case T.UnansweredCallReason.PstnCallTerminated:case T.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:case T.UnansweredCallReason.PstnNumberForbidden:case T.UnansweredCallReason.PstnNumberUnavailable:case T.UnansweredCallReason.PstnSkypeoutAccountBlocked:case T.UnansweredCallReason.InvalidNumber:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.CallErrorFilled};case T.UnansweredCallReason.ReadPhoneStatePermissionDenied:return{type:T.UnansweredCallVisualInfoType.Icon,name:p.SkypeIcon.CallBlockedFilled};case T.UnansweredCallReason.None:return}}static _getKickedPrimaryMessage(e){if(!s.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick)return;if(!e||!S.default.isCallEventReaction(e))return;const t=S.default.parseCallEventReaction(e);if(!t)return;const i=v._getUserName(t.mri);return t.eventType===g.ReactionsTextType.CallEventTransfer?u.getString("CallControls.RemovedFromCallByTransfer"):u.getString("CallControls.RemovedFromCallMessageWithName",{name:i})}static _getUserName(e){const t=m.sanitizeMri(e,m.Namespaces.SkypeId);return l.default.getDisplayName(t)||u.getString("Notifications.UnknownUserShort")}}const I=new v;t.default=I},794637:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.countInactivePstnParticipantInThread=function(e,t){return t.filter((t=>o.isPhoneMri(t.id)&&!e.includes(t.id))).length};const o=i(197582).__importStar(i(44717))},97312:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useMicrophoneLevel=void 0;const o=i(197582),a=i(667294),n=o.__importDefault(i(601274)),s=o.__importDefault(i(369347));t.useMicrophoneLevel=e=>{const[t,i]=(0,a.useState)(0);return(0,a.useEffect)((()=>{const t=n.default.setInterval((()=>{s.default.DeviceStore.getMicrophoneVolumeLevel().then((e=>{i(null!=e?e:0)}))}),e);return()=>{n.default.clearInterval(t)}}),[e]),t}},839647:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(397691)),s=o.__importDefault(i(150343)),r=o.__importStar(i(971988)),l=i(44717),c=o.__importStar(i(434343)),d=i(815146),u=i(120695),h=o.__importStar(i(71380)),p=o.__importStar(i(85385)),g=o.__importStar(i(446574)),C=o.__importDefault(i(655192)),m=i(123117),S="CallCaptionsCleanupStarted",_="CallCaptionsCleanupFailure";t.default=new class{constructor(){this._isCleanupInProgress=!1,this._doCallCaptionsCleanup=()=>(h.default.queueIdleTask("Scheduling call captions cleanup",h.TaskTypeFlags.CpuIntensive|h.TaskTypeFlags.UsesNetworking,(()=>{try{return s.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsCleanupEnabled?c.default.getLastCallCaptionsCleanupTimestamp().then(this._isCallCaptionsCleanupRequired).then(this._cleanupCallCaptions).catch((e=>{p.track(new u.FundamentalsDebugEvent(_,"FailureInPromise")),this._logError("Call captions cleanup failed. Error: "+C.default.errorAsString(e))})):(this._logInfo("Call captions cleanup disabled."),n.Resolved())}catch(e){return p.track(new u.FundamentalsDebugEvent(_,"FailureInWrapperCatch")),this._logError("Call captions cleanup failed. Error: "+C.default.errorAsString(e)),n.Rejected()}})),n.Resolved()),this._isCallCaptionsCleanupRequired=e=>{if(this._isCleanupInProgress)return!1;if(!e)return p.track(new u.FundamentalsDebugEvent(S,"FirstRun")),this._logInfo("Call captions cleanup not yet done."),!0;return!!(e<this._parseCleanupValidTimestamp())&&(p.track(new u.FundamentalsDebugEvent(S,"Expired")),this._logInfo("Call captions cleanup expired. Need for another cleanup."),!0)},this._parseCleanupValidTimestamp=()=>{const e=s.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupValidDate,t=Date.parse(e);return isNaN(t)?0:t},this._cleanupCallCaptions=e=>e?(this._isCleanupInProgress=!0,n.all([this._setCaptionsCleanupStartTimestamp(),this._processCaptionsCleanup(),this._processConversationCleanup()]).then(this._completeCleanup)):(this._logInfo("Call captions - cleanup valid. No need for another cleanup."),n.Resolved()),this._setCaptionsCleanupStartTimestamp=()=>c.default.internal_getInternalData(c.InternalKeys.CallCaptionsCleanupStartTimestamp).then((e=>e?n.Resolved():c.default.internal_putInternalData(c.InternalKeys.CallCaptionsCleanupStartTimestamp,Date.now()))).catch((e=>{this._logError(`Call captions - Set startTimestamp failed. Error: ${C.default.errorAsString(e)}`)})),this._processCaptionsCleanup=()=>{const e=n.Defer(),t=s.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanMessageCaptionsAsync(e,0,t),e.promise()},this._cleanMessageCaptionsAsync=(e,t,i)=>{h.default.queueIdleTask("Clean Messages startIndex: "+t,h.TaskTypeFlags.CpuIntensive|h.TaskTypeFlags.UsesNetworking,(()=>{m.MessagesRepository.getAllMessages(i,t).then((o=>{if(0===o.length)return this._logInfo("Call captions - cleanup finished"),void e.resolve();const n=this._filterCallCaptionMessageType(o);if(a.isEmpty(n)){const o=t+i;this._logInfo(`Call captions - 0 to delete. Moving offset to ${o}`),this._cleanMessageCaptionsAsync(e,o,i)}else this._removeCaptions(n).then((()=>{let o=t+(i-n.length);o<0&&(o=0),this._logInfo(`Call captions - ${n.length} deleted. Moving offset to ${o}`),this._cleanMessageCaptionsAsync(e,o,i)}))}))}))},this._processConversationCleanup=()=>{const e=n.Defer(),t=s.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanConversationsAsync(e,0,t),e.promise()},this._cleanConversationsAsync=(e,t,i)=>{c.default.getAllConversationMetas(i,t).then((o=>{if(0===o.length)return this._logInfo("Conversations - lastMessage captions cleanup finished."),void e.resolve();h.default.queueIdleTask("Clean conversation last message startIndex: "+t,h.TaskTypeFlags.CpuIntensive|h.TaskTypeFlags.UsesNetworking,(()=>{const n=this._filterCallCaptionConversationType(o);a.isEmpty(n)?this._cleanConversationNext(e,t,i,0):this._cleanConversationsLastMessage(n).then((()=>{this._cleanConversationNext(e,t,i,n.length)}))}))}))},this._filterCallCaptionMessageType=e=>{const t=a.filter(e,(e=>r.isCaptionMessageType(e.messagetype)));return this._logInfo("Call captions - filtering captions message type. Found "+t.length+" captions."),t},this._filterCallCaptionConversationType=e=>{const t=a.filter(e,(e=>(0,l.isReactionsThread)(e.conv.id)&&!!e.conv.lastMessage&&r.isCaptionMessageType(e.conv.lastMessage.messagetype)));return this._logInfo(`Conversations - filtering caption conversation type. Found ${t.length} captions conversations.`),t},this._removeCaptions=e=>m.MessagesRepository.removeMessages(e).then((()=>{this._logInfo("Call captions - remove batch finished.")})).catch((e=>(this._logError(`Call captions - remove batch failed. Error: ${C.default.errorAsString(e)}`),n.Rejected(e)))),this._cleanConversationsLastMessage=e=>(e=a.map(e,(e=>e.updateConversation(e.conv.dropLastMessage()))),c.default.putConversationMetas(e).then((()=>{this._logInfo("Conversations - update batch finished.")}),(e=>(this._logError(`Conversations - update batch failed. Error: ${C.default.errorAsString(e)}`),n.Rejected(e))))),this._completeCleanup=()=>c.default.internal_getInternalData(c.InternalKeys.CallCaptionsCleanupStartTimestamp).then((e=>{if(e){const t=Date.now()-e;p.track(new u.FundamentalsDebugEvent("CallCaptionsCleanupTime",t.toString())),this._logInfo(`Captions and conversations cleanup execution time: ${t}ms.`)}})).then((()=>c.default.internal_deleteInternalData(c.InternalKeys.CallCaptionsCleanupStartTimestamp))).then((()=>c.default.internal_putInternalData(c.InternalKeys.CallCaptionsCleanupEndTimestamp,Date.now()))).then((()=>{this._isCleanupInProgress=!1,this._logInfo("Captions and conversations cleanup finished.")}),(e=>(this._logError(`Captions and conversations cleanup failed. Error: ${C.default.errorAsString(e)}`),n.Rejected(e)))),this._logInfo=e=>{p.log(d.LogTraceArea.GenericUnsafe,`[CaptionsCleanup] ${e}`)},this._logError=e=>{p.error(d.LogTraceArea.GenericUnsafe,`[CaptionsCleanup] ${e}`)},this.test_doCallCaptionsCleanup=()=>this._doCallCaptionsCleanup(),g.RegisterStartupable(this,"CallCaptionsCleanupService")}startup(){return s.default.subscribe(this._doCallCaptionsCleanup),this._doCallCaptionsCleanup(),Promise.resolve()}_cleanConversationNext(e,t,i,o){const a=t+i;this._logInfo(`Conversations - ${o} updated. Moving offset to ${a}`),this._cleanConversationsAsync(e,a,i)}}},803306:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(314210)),s=o.__importStar(i(397691)),r=o.__importDefault(i(150343)),l=o.__importDefault(i(369347)),c=o.__importStar(i(44717)),d=i(154235),u=o.__importDefault(i(988773)),h=i(815146),p=o.__importStar(i(85385)),g=o.__importDefault(i(510335)),C=o.__importDefault(i(740794)),m=o.__importDefault(i(808164)),S=o.__importStar(i(879119)),_=o.__importStar(i(446574)),f=o.__importDefault(i(655192)),y=o.__importDefault(i(760989)),T="tel:";t.default=new class{constructor(){this._processIntentEvent=e=>{const t=y.default.newCauseId();p.log(h.LogTraceArea.DialerPanel,`CallIntentService._processIntentEvent eventType=${e.type} causeId: ${t}`),e.number&&a.startsWith(e.number,T)&&(e.number=e.number.replace(T,""));const i=e.number&&f.default.safeDecodeURIComponent(e.number),o=m.default.isPossiblyPhoneNumber(i)?e.number:void 0;if(e.type===n.IntentEventType.contactMessage&&e.skypeId){const i=c.sanitizeMri(e.skypeId,c.Namespaces.SkypeId);C.default.navigateToConversation({convId:i,causeId:t,origin:h.NavigationConversationOrigin.NativeContactIntent})}else if(e.type!==n.IntentEventType.contactAudio&&e.type!==n.IntentEventType.contactVideo||!e.skypeId)if(e.type===n.IntentEventType.contactPhone&&i&&o&&(u.default.isE164Format(i)||r.default.getS4LCommerceFeatures().callIntent.allowNonE164NumberCalls)){S.default.initializeCountrySelection(),S.default.overwritePhoneNumberInput(o,!1);const e=S.default.getPhoneNumber(S.TriggerKeys.E164),i=c.sanitizeMri(e.E164,c.Namespaces.PSTN);l.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:!1,origin:h.NavigationCallOrigin.NativeContactIntent},t)}else C.default.navigateToPSTNDialerWithParams({causeId:t,navigationSource:h.DialerNavigationSource.CallIntent,prefilledNumber:o},d.MainRootViewId);else{const i=c.sanitizeMri(e.skypeId,c.Namespaces.SkypeId);l.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:"contactVideo"===e.type,origin:h.NavigationCallOrigin.NativeContactIntent},t)}},_.RegisterStartupable(this,"CallIntentService"),g.default.registerForLogout(this,"CallIntentService")}startup(){return n.default.setListener(this._processIntentEvent),Promise.resolve()}test_processIntentEvent(e){this._processIntentEvent(e)}logout(e,t,i){return n.default.removeListener(),s.Resolved()}}},330381:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(619429),n=o.__importDefault(i(658804)),s=o.__importDefault(i(495193)),r=o.__importStar(i(939304)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(760989)),d=o.__importStar(i(85385)),u=i(815146),h=o.__importDefault(i(150343)),p=o.__importStar(i(252443));t.default=new class{constructor(){this._translationStateUpdated=e=>{const t=c.default.newCauseId(),i=h.default.getS4LCMCFeaturesNoSubscription().translationFeatures.toastTimeout,o=n.default.getInCallFeatureState(e);switch(null==o?void 0:o.state){case a.InCallFeatureState.Disabled:case a.InCallFeatureState.SelfConsentRejected:l.default.InCallBotService.isSkypeTranslationEnabled(e)&&l.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.Failed:case a.InCallFeatureState.RemoteFailed:r.removeAll(),r.addErrorMessage(e),l.default.InCallBotService.isSkypeTranslationEnabled(e)&&l.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.SelfConsentRequested:r.removeAll(),r.addTranslationConsentMessage(e,[()=>{n.default.requestProvideConsent(e)},()=>{n.default.requestRejectConsent(e),p.translationAutoDetectDisable(e)}]);break;case a.InCallFeatureState.RemoteConsentRequested:r.removeAll(),r.addTranslationConsentSentMessage(e,[()=>{},()=>{n.default.requestStopFeature(e)}]);break;case a.InCallFeatureState.RemoteConsentCancelled:r.removeAll(),r.addTranslationCancelledMessage(e,i),l.default.InCallBotService.isSkypeTranslationEnabled(e)&&l.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.ConsentRequestedByRemote:r.removeAll(),r.addTranslationConsentQuestionMessage(e,o.requestedBy,[()=>{n.default.requestProvideConsent(e)},()=>{n.default.requestRejectConsent(e)}]);break;case a.InCallFeatureState.RemoteConsentRejected:r.removeAll(),r.addTranslationRejectedMessage(e,i),l.default.InCallBotService.isSkypeTranslationEnabled(e)&&l.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.StoppedByRemote:r.removeAll(),l.default.InCallBotService.isSkypeTranslationEnabled(e)?l.default.InCallBotService.stopSkypeTranslation(e,t).always((()=>{r.addTranslationStoppedMessage(e,o.requestedBy,i)})):r.addTranslationStoppedMessage(e,o.requestedBy,i);break;case a.InCallFeatureState.Stopped:r.removeAll(),l.default.InCallBotService.isSkypeTranslationEnabled(e)&&l.default.InCallBotService.stopSkypeTranslation(e,t).then((()=>{r.addTranslationStoppedMessage(e,void 0,i)})).catch((e=>{d.error(u.LogTraceArea.InCallBotService,"Translator stop failed with: "+JSON.stringify(e))}));break;case a.InCallFeatureState.NotSupported:r.removeAll(),r.addTranslationNotSuppportedMessage(e,[()=>{}],i);break;case a.InCallFeatureState.Enabled:p.translationAutoDetectEnableOnFirstConsent(e),l.default.InCallBotService.isSkypeTranslationEnabled(e)||l.default.InCallBotService.startSkypeTranslation(e,t).then((()=>{r.addTranslationEnabledMessage(e,void 0,i)}));break;case a.InCallFeatureState.EnabledByRemote:p.translationAutoDetectEnableOnFirstConsent(e),l.default.InCallBotService.isSkypeTranslationEnabled(e)||l.default.InCallBotService.startSkypeTranslation(e,t).then((()=>{r.addTranslationEnabledMessage(e,o.requestedBy,i)}))}},this._truVoiceStateUpdated=e=>{const t=c.default.newCauseId(),i=h.default.getS4LCMCFeaturesNoSubscription().translationFeatures.toastTimeout,o=s.default.getInCallFeatureState(e);switch(null==o?void 0:o.state){case a.InCallFeatureState.SelfConsentRequested:r.removeAll(),r.addTruVoiceConsentMessage(e,[()=>{s.default.requestProvideConsent(e)},()=>{s.default.requestRejectConsent(e),p.truVoiceDisable(e)}]);break;case a.InCallFeatureState.RemoteConsentRequested:r.removeAll(),r.addTruVoiceConsentSentMessage(e,[()=>{},()=>{s.default.requestStopFeature(e),p.truVoiceDisable(e)}]);break;case a.InCallFeatureState.RemoteConsentCancelled:r.removeAll(),r.addTruVoiceCancelledMessage(e,i);break;case a.InCallFeatureState.ConsentRequestedByRemote:r.removeAll(),r.addTruVoiceConsentQuestionMessage(e,o.requestedBy,[()=>{s.default.requestProvideConsent(e)},()=>{s.default.requestRejectConsent(e)}]);break;case a.InCallFeatureState.RemoteConsentRejected:p.truVoiceDisable(e),r.removeAll(),r.addTruVoiceRejectedMessage(e,i);break;case a.InCallFeatureState.StoppedByRemote:p.truVoiceDisable(e),l.default.InCallBotService.refreshConfig(e,t),r.removeAll(),r.addTruVoiceStoppedMessage(e,o.requestedBy,i);break;case a.InCallFeatureState.Stopped:p.truVoiceDisable(e),l.default.InCallBotService.refreshConfig(e,t),r.removeAll(),r.addTruVoiceStoppedMessage(e,void 0,i);break;case a.InCallFeatureState.NotSupported:break;case a.InCallFeatureState.Enabled:p.truVoiceEnable(e),l.default.InCallBotService.refreshConfig(e,t),r.removeAll(),r.addTruVoiceEnabledMessage(e,void 0,i);break;case a.InCallFeatureState.EnabledByRemote:p.truVoiceEnable(e),l.default.InCallBotService.refreshConfig(e,t),r.removeAll(),r.addTruVoiceEnabledMessage(e,o.requestedBy,i)}}}start(e){h.default.getS4LCMCFeaturesNoSubscription().translationFeatures.enableConsentListener&&(n.default.startTracking(e),s.default.startTracking(e),this._translationStateSub=n.default.stateUpdatedEvent().subscribe(this._translationStateUpdated),this._truVoiceStateSub=s.default.stateUpdatedEvent().subscribe(this._truVoiceStateUpdated))}stop(e){h.default.getS4LCMCFeaturesNoSubscription().translationFeatures.enableConsentListener&&(n.default.stopTracking(e),s.default.stopTracking(e),this._translationStateSub&&this._translationStateSub.unsubscribe(),this._truVoiceStateSub&&this._truVoiceStateSub.unsubscribe())}}},360718:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(148540),n=o.__importDefault(i(369347)),s=o.__importStar(i(939304)),r=o.__importDefault(i(524526)),l=o.__importStar(i(85385)),c=i(815146),d=o.__importDefault(i(760989)),u=o.__importStar(i(44717)),h=o.__importDefault(i(341994)),p=o.__importDefault(i(150343)),g=o.__importStar(i(252443)),C=o.__importStar(i(94534));t.default=new class{constructor(){this._participantUpdateSubscription={},this._participantLanguage={},this._lastSeen={},this._stop=(e,t)=>n.default.InCallBotService.stopSkypeTranslationConsent(e,t),this._pause=(e,t,i)=>n.default.InCallBotService.setSkypeTranslationPause(e,t,i),this._isPaused=e=>n.default.InCallBotService.isSkypeTranslationPaused(e),this._getVariant=()=>p.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.variantB,this._participantChanged=(e,t)=>{t.state===a.ParticipantState.Connected&&r.default.getCallTranslatorBotMriFilter().includes(t.id)&&t.endpoints&&t.endpoints.endpointDetails.map((t=>{var i;const o=null===(i=t.endpointMetadata)||void 0===i?void 0:i.detectedSpokenLanguage;if(o){if(o.timestamp<=this._lastSeen[e])return;this._lastSeen[e]=o.timestamp;const t=o.participantId;if(!this._acceptedParticipant(e,t))return;if(o.isFailure)l.log(c.LogTraceArea.InCallBotService,`[LID] FAILED to detect language for ${o.participantId}, Previous language: ${o.language}, Timestamp: ${o.timestamp}`),this._unableDetectLanguage(e,t);else{l.log(c.LogTraceArea.InCallBotService,`[LID] Language detected for ${o.participantId}, Previous language: ${o.previousLanguage}, New language: ${o.language}, Confidence: ${o.confidence}, Timestamp: ${o.timestamp}`);const i=this._getCurrentLanguage(e,t);if(this._languageDetectionSuccess(i,o)){const a=o.language.toLowerCase();this._languageDetected(e,t,i,a)}}}}))}}start(e){p.default.getS4LCMCFeaturesNoSubscription().translationFeatures.automaticLangDetection&&(s.removeAll(e),this._participantLanguage[e]={},this._participantUpdateSubscription[e]=n.default.CallingStore.participantUpdatedEvent().subscribe(this._participantChanged),this._lastSeen[e]=0)}stop(e){p.default.getS4LCMCFeaturesNoSubscription().translationFeatures.automaticLangDetection&&(this._participantUpdateSubscription[e]&&(this._participantUpdateSubscription[e].unsubscribe(),delete this._participantUpdateSubscription[e]),s.removeAll(e),delete this._participantLanguage[e],delete this._lastSeen[e])}setUpMenu(e){this._setUpMenu=e}_languageDetectionSuccess(e,t){const i=C.getLocaleStandardized(t.language.toLowerCase());return!!r.default.isLanguageSupportedForTranslation(i)&&(void 0===e||e!==i&&("high"===t.confidence.toLowerCase()||parseFloat(t.confidence)>.5))}_isAllSameLangs(e){const t=n.default.CallingStore.getCallConversationMri(e);if(this._isPstn(e)){const e=r.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(t),i=r.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(t);return l.log(c.LogTraceArea.InCallBotService,`_isAllSameLangs, pstn mode, comparing langs local: ${e} and remote: ${i}`),(null==e?void 0:e.toLowerCase())===(null==i?void 0:i.toLowerCase())}const i=r.default.getCallTranslatorSpokenLanguage(t),o=C.getLanguageFromLocale(i),a=n.default.InCallBotService.getTranslatorBotSenders(e).map((e=>e.locale));return l.log(c.LogTraceArea.InCallBotService,`_isAllSameLangs, skype mode, comparing langs local: ${i} and remotes: ${a.join(",")}`),a.every((e=>C.getLanguageFromLocale(e).toLowerCase()===o.toLowerCase()))}_unableDetectLanguage(e,t){const i=this._getVariant(),o=d.default.newCauseId();if(i){const i=d.default.newCauseId();this._pause(e,!0,i),s.addUnableDetectLanguageMessage(e,t,[()=>{this._pause(e,!1,i)},()=>{var t;g.translationAutoDetectDisable(e),null===(t=this._setUpMenu)||void 0===t||t.call(this)}],!0)}else s.addUnableDetectLanguageMessage(e,t,[()=>{var t;g.translationAutoDetectDisable(e),null===(t=this._setUpMenu)||void 0===t||t.call(this)},()=>{this._stop(e,o)}],!1)}_languageDetected(e,t,i,o){const a=this._getVariant(),n=d.default.newCauseId();if(a){const a=o;this._changeLanguageForParticipant(e,t,a),this._isPaused(e)&&this._pause(e,!1,n),s.addLanguageChangeDetectedMessage(e,t,o,[i?()=>{const o=i;this._changeLanguageForParticipant(e,t,o)}:void 0],!0),this._isAllSameLangs(e)&&this._sameLanguage(e)}else s.addLanguageChangeDetectedMessage(e,t,o,[()=>{const i=o;this._changeLanguageForParticipant(e,t,i),this._isPaused(e)&&this._pause(e,!1,n),this._isAllSameLangs(e)&&this._sameLanguage(e)}],!1)}_sameLanguage(e){const t=this._getVariant(),i=d.default.newCauseId();t?s.addSameLanguageMessage(e,[()=>{this._pause(e,!1,i)},()=>{}],!0):s.addSameLanguageMessage(e,[()=>{this._stop(e,i)},()=>{}],!1)}_acceptedParticipant(e,t){const i=this._isPstn(e),o=n.default.CallingStore.getParticipantId(e);return!!(t===o&&!i||t===o&&i||t!==o&&i)}_isPstn(e){const t=n.default.CallingStore.getCallConversationMri(e);return t&&u.isPhoneMri(t)&&n.default.InCallBotService.isPstnTranslationEnabled(e)}_getCurrentLanguage(e,t){const i=n.default.CallingStore.getCallConversationMri(e),o=this._isPstn(e),a=n.default.CallingStore.getParticipantId(e);return t===a&&i&&!o?r.default.getCallTranslatorSpokenLanguage(i):t===a&&i&&o?r.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(i):t!==a&&i&&o?r.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(i):void 0}_changeLanguageForParticipant(e,t,i){const o=n.default.CallingStore.getCallConversationMri(e),a=this._isPstn(e),s=n.default.CallingStore.getParticipantId(e);t===s&&h.default.setCallTranslatorBotSubtitleLanguageLocale(i),t===s&&o&&!a?r.default.setCallTranslatorSpokenLanguage(o,i):t===s&&o&&a?r.default.setLocalPstnCallTranlatorBotSpokenLanguageLocale(o,i):t!==s&&o&&a&&r.default.setOtherPstnCallTranlatorBotSpokenLanguageLocale(o,i)}}},988576:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(516778)),s=o.__importStar(i(397691)),r=o.__importDefault(i(659938)),l=o.__importDefault(i(150343)),c=i(768741),d=o.__importDefault(i(473304)),u=o.__importStar(i(44717)),h=i(434343),p=o.__importDefault(i(615364)),g=o.__importDefault(i(389659)),C=i(22478),m=i(815146),S=i(815146),_=o.__importDefault(i(637961)),f=o.__importStar(i(235256)),y=o.__importStar(i(85385)),T=o.__importDefault(i(652032)),b=o.__importDefault(i(114818)),v=o.__importDefault(i(341994)),I=o.__importDefault(i(363091)),w=o.__importDefault(i(25999)),P=o.__importDefault(i(657764)),M=o.__importStar(i(446574)),D=o.__importDefault(i(655192)),A=o.__importDefault(i(685734)),k=o.__importDefault(i(760989));t.default=new class{constructor(){this._cachedUserProfilesDict={},this._didShowNotification=!1,this._didIdentifyDifferentTopContacts=!1,this._topContactsWithBirthday=[],this._activationStateChangedSubscribeCallback=()=>{const e=n.App.getActivationState()===n.Types.AppActivationState.Active;this._isAppActive!==e&&(y.log(m.LogTraceArea.Engagement,"Active state changed to "+n.Types.AppActivationState[n.App.getActivationState()]),this._isAppActive=e,this._appConfigStoreSubscribeCallback())},this._appConfigStoreSubscribeCallback=()=>{this._initServiceConfig(),this._isFeatureEnabled?this._usersStoreSubscriptionToken||(this._usersStoreSubscriptionToken=A.default.subscribe((e=>{this._tryCreateBirthdayNotification(e)})),y.log(m.LogTraceArea.Engagement,"Subscribed to UsersStore, _usersStoreSubscriptionToken: "+(this._usersStoreSubscriptionToken?"1":"0"))):(y.log(m.LogTraceArea.Engagement,"CelebrationNotificationService disabled. Disabling subscriptions"),this._usersStoreSubscriptionToken&&(A.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0))},this._tryCreateBirthdayNotification=e=>{if(!this._isFeatureEnabled)return y.log(m.LogTraceArea.Engagement,"Birthday notification feature is not enabled. Skipping scheduling"),s.Resolved();if(this._didShowNotification)return y.log(m.LogTraceArea.Engagement,"Birthday notification already created. Skipping scheduling"),s.Resolved();let t;const i=this._getAllContactsMrisEnabled?this.getAllContacts():this.getFavoriteAndSuggestedContacts();return t=e?a.intersection(e,a.keys(this._cachedUserProfilesDict)):i.favoriteContactsMris.concat(i.nonFavoriteSuggestedContactsMris),this.fetchUserProfiles(t).then((()=>{const e=this.getTopContactMrisWithBirthdaysToday(i);if(a.isUndefined(this._topContactsWithBirthday)||this._topContactsWithBirthday.length<=0)return y.log(m.LogTraceArea.Engagement,"Identified contacts with birthday during first run. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e);const t=e[0],o=this._topContactsWithBirthday[0];return t&&t!==o?(y.log(m.LogTraceArea.Engagement,"Identified new contacts with birthday. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e)):s.Resolved()}))},M.RegisterStartupable(this,"CelebrationNotificationService",[p.default,f.default,T.default,v.default,A.default,w.default])}startup(){return this._initAppStateConfig(),this._appStateSubscription=r.default.subscribeForChanges("CelebrationNotificationService",this._activationStateChangedSubscribeCallback),this._appConfigStoreSubscription=l.default.subscribe(this._appConfigStoreSubscribeCallback),this._appConfigStoreSubscribeCallback(),f.default.setRefreshOptions("CelebrationNotification",{interval:this._refreshTime,taskTypeFlags:f.TaskTypeFlags.UsesNetworking,callback:()=>this._tryCreateBirthdayNotification()}),this._isFeatureEnabled&&_.default.queueIdleTask("CelebrationNotificationService",f.TaskTypeFlags.CpuIntensive,this._tryCreateBirthdayNotification),Promise.resolve()}logout(e,t,i){return y.log(m.LogTraceArea.Engagement,"Logout action triggered for CelebrationNotificationService"),this._usersStoreSubscriptionToken&&(A.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._didShowNotification=!1,this._topContactsWithBirthday=[],a.each(this._cachedUserProfilesDict,((e,t)=>{e&&delete this._cachedUserProfilesDict[t]})),y.log(m.LogTraceArea.Engagement,"Cleared local cache of user profiles in CelebrationNotificationService"),s.Resolved()}_initAppStateConfig(){this._isAppActive=n.App.getActivationState()===n.Types.AppActivationState.Active}_initServiceConfig(){const e=l.default.getEngagementFeatures().engagementCelebrationNotificationSetting,t=l.default.getSkypeEngagementFeatures().birthdayContent;y.log(m.LogTraceArea.Engagement,"initServiceConfig callback executed, given featureSettings: "+JSON.stringify(e)+"given birthdayContent: "+JSON.stringify(t)),this._campaignId=t.campaignId,this._variantId=t.variantId,this._isFeatureEnabled=e.enabled,this._refreshTime=e.refreshTime,this._celebrationNotificationsTopContactCutOff=e.celebrationNotificationsTopContactCutOff,this._isThrottlingOnRoamingSettingsEnabled=e.isThrottlingOnRoamingSettingsEnabled,this._isThrottlingOnLocalSettingsEnabled=e.isThrottlingOnLocalSettingsEnabled,this._isContactCutOffEnabled=e.isContactCutOffEnabled,this._getAllContactsMrisEnabled=e.getAllContactsMrisEnabled,this._isDiscardingOnAppActiveEnabled=e.isDiscardingOnAppActiveEnabled}_doesMriHaveBirthdayToday(e){const t=this._cachedUserProfilesDict[e];return t&&d.default.isTodayBirthdayForParticipantProfile(t)}_getSearchStore(){if(!this._searchStore){this._searchStore=new P.default;const e={rawQuery:"",trimmedNormalizedQuery:"",userMriToExclude:[I.default.getSkypeMri()],excludeBots:!0,onlyGroupCapable:!1,onlyCallCapable:!0,includeBlocked:!1,excludeNonManuallyAdded:!0};this._searchStore.updateConfig(e,[S.SearchResultsListGroup.FavoriteContacts,S.SearchResultsListGroup.SuggestedFrequentConversations,S.SearchResultsListGroup.AddressBook])}return this._searchStore}getAllContacts(){if(y.log(m.LogTraceArea.Engagement,"Will try to fetch all contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return y.log(m.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getCombinedContactsWithoutAddressBookAndShortCircuit(),(t=>{if(!t.skypeContact)return!1;const i=t.skypeContact.getMri();return!!i&&(this._isContactCutOffEnabled&&u.isOneOnOneConversation(i)?(e--,e>=0):u.isOneOnOneConversation(i))})),i=a.map(t,(e=>{if(e.skypeContact)return e.skypeContact.getMri()}));return this._isContactCutOffEnabled&&0===e&&(y.log(m.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of contact MRIs"),y.track(new c.CelebrationNotificationTelemetryEvent({action:c.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId}))),{favoriteContactsMris:i,nonFavoriteSuggestedContactsMris:[]}}getFavoriteAndSuggestedContacts(){if(y.log(m.LogTraceArea.Engagement,"Will try to fetch favorite and suggested contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return y.log(m.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of favorite and nonFavorite contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getFavoriteContactsResults(),(t=>this._isContactCutOffEnabled&&u.isOneOnOneConversation(t)?(e--,e>=0):u.isOneOnOneConversation(t)));if(this._isContactCutOffEnabled&&0===e)return y.log(m.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of nonFavorite contact MRIs"),y.track(new c.CelebrationNotificationTelemetryEvent({action:c.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:[]};let i=[];return i=a.filter(this._searchStore.getSuggestedContactsAndConversationsResults(S.SearchResultsListGroup.SuggestedFrequentConversations),(e=>u.isOneOnOneConversation(e))),i=a.difference(i,t),i=i.splice(e-1,i.length-e),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:i}}fetchUserProfiles(e){return y.log(m.LogTraceArea.Engagement,"Starting to fetch user profiles for specified MRIs"),A.default.getFullUserProfileByMrisAsync(e).then((e=>{a.each(e,(e=>{this._cachedUserProfilesDict[e.mri]&&delete this._cachedUserProfilesDict[e.mri],this._cachedUserProfilesDict[e.mri]=e})),y.log(m.LogTraceArea.Engagement,"Finished fetching user profiles for specified MRIs")}))}getTopContactMrisWithBirthdaysToday(e){const t=e.favoriteContactsMris,i=e.nonFavoriteSuggestedContactsMris;let o=a.filter(t,(e=>this._doesMriHaveBirthdayToday(e)));const n=a.filter(i,(e=>this._doesMriHaveBirthdayToday(e)));return o.sort(((e,t)=>this._compareTwoContacts(e,t))),n.sort(((e,t)=>this._compareTwoContacts(e,t))),o=o.concat(n),o}maybeCreateBirthdayLocalEngagementNotification(e){const t=this._getCelebrationNotificationLastShownTime(this._isThrottlingOnLocalSettingsEnabled,this._isThrottlingOnRoamingSettingsEnabled);return this._didIdentifyDifferentTopContacts=!1,this._didShowNotification=!this._wasTimeBeforeToday(t),this._didShowNotification?(y.log(m.LogTraceArea.Engagement,"Birthday notification already created since: "+t+". Skipping scheduling"),y.track(new c.CelebrationNotificationTelemetryEvent({action:c.CelebrationNotificationTelemetryEventAction.NotificationAlreadyShown,numberOfTopContacts:e.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),s.Resolved()):(this._didIdentifyDifferentTopContacts=!(0,b.default)(this._topContactsWithBirthday,e),this._topContactsWithBirthday=e,y.log(m.LogTraceArea.Engagement,"Birthday notification will now be created"),this._createLocalBirthdayEngagementNotificationWithTopContacts(this._topContactsWithBirthday).always((e=>e?(this._didShowNotification=!0,y.log(m.LogTraceArea.Engagement,"Birthday notification created successfully"),this._setCelebrationNotificationLastShownTime(Date.now())):(y.log(m.LogTraceArea.Engagement,"Birthday notification not created"),s.Resolved()))))}_createLocalBirthdayEngagementNotificationWithTopContacts(e){if(0===e.length)return y.log(m.LogTraceArea.Notifications,"Ignoring celebration notification because topContacts list is empty."),s.Resolved(!1);const t=e[0],i=A.default.getFullUserProfileByMri(t).getSkypeId();if(!this._cachedUserProfilesDict[t])return y.log(m.LogTraceArea.Notifications,"Ignoring celebration notification because of incomplete user profile."),y.track(new c.CelebrationNotificationTelemetryEvent({action:c.CelebrationNotificationTelemetryEventAction.SelectedTopContactUserProfileIncomplete,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),s.Resolved(!1);if(this._isDiscardingOnAppActiveEnabled&&!this._isAppActive)return y.log(m.LogTraceArea.Notifications,"Ignoring celebration notification because app is not active."),s.Resolved(!1);const o={content:{skypeId:i}};return w.default.openCampaign(this._campaignId,this._variantId,C.EngagementType.PopCard,k.default.newGuid(),o).then((()=>(y.log(m.LogTraceArea.Notifications,"Created celebration popcard notification with campaignId : "+this._campaignId,"variantId : "+this._variantId),y.track(new c.CelebrationNotificationTelemetryEvent({action:c.CelebrationNotificationTelemetryEventAction.Created,notificationType:c.CelebrationNotificationType.EngagementPopCard,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardCampaignId:this._campaignId,cardGuid:this._variantId,celebratedUserSkypeId:i})),!0))).fail((e=>(y.log(m.LogTraceArea.Notifications,"Failed to fetch campaign using PullCampaignContentService campaignId : "+this._campaignId+"variantId : "+this._variantId+" error: "+D.default.errorAsString(e)),y.track(new c.CelebrationNotificationTelemetryEvent({action:c.CelebrationNotificationTelemetryEventAction.PullCampaignContentServiceFailed,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),!1)))}_getRecentConversationsInvolvingUser(e){return a.filter((0,p.default)().getDisplayableRecentConversationsSortedAll(),(t=>a.some(t.getMemberMris(),(t=>!I.default.isMyMri(e)&&t===e))))}_compareTwoContacts(e,t){const i=this._getRecentConversationsInvolvingUser(e),o=this._getRecentConversationsInvolvingUser(t),a=i.length-o.length;let n=0;return i.length>0&&o.length>0&&(n=i[0].getTimestamp()-o[0].getTimestamp()),0===a?n:a}_wasTimeBeforeToday(e){const t=new Date(e),i=new Date;return i.setHours(0,0,0,0),t.getTime()<i.getTime()}_getCelebrationNotificationLastShownTime(e,t){const i=e&&T.default.getData(h.InternalKeys.CelebrationNotificationLastShownTime)||0,o=t&&v.default.getCelebrationNotificationLastShownTime()||0;return Math.max(i,o)}_setCelebrationNotificationLastShownTime(e){T.default.putData(h.InternalKeys.CelebrationNotificationLastShownTime,e),v.default.setCelebrationNotificationLastShownTime(e)}test_startup(){this._appConfigStoreSubscribeCallback()}test_reset(){this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._usersStoreSubscriptionToken&&(A.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._appConfigStoreSubscription&&(l.default.unsubscribe(this._appConfigStoreSubscription),this._appConfigStoreSubscription=void 0),a.each(this._cachedUserProfilesDict,((e,t)=>{e&&delete this._cachedUserProfilesDict[t]})),this._didShowNotification=!1;const e=g.default.add(Date.now(),0,-1);this._setCelebrationNotificationLastShownTime(e)}setFavoriteAndSuggestedContactsList(e){a.each(e,(e=>{this._cachedUserProfilesDict[e.mri]=e}))}setTopContactsList(e){this._topContactsWithBirthday=e}}},872263:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i{static savePhoneNumberInput(e){this.phoneNumberInput=e}static clearState(){this.phoneNumberInput=void 0,this.restoreStateRequired=!1}static restorePhoneNumberInputIfNeeded(){return this.restoreStateRequired?this.phoneNumberInput:void 0}static shouldRestoreState(){this.restoreStateRequired=!0}}i.phoneNumberInput=void 0,i.restoreStateRequired=!1,t.default=i},926876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.E911Service=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(397691)),s=o.__importDefault(i(25309)),r=i(766698),l=o.__importStar(i(85385)),c=i(815146),d=i(427393),u=o.__importDefault(i(655192));class h{getBase64EncodedLocation(e,t,i){return l.log(c.LogTraceArea.Phone,"E911Service: Fetching location from Bing Maps API."),s.default.getInstance().getLocationByPoint(e,t,i).then((i=>{var o;const s=null===(o=i.resourceSets[0])||void 0===o?void 0:o.resources[0];if(a.isUndefined(s))return n.Rejected();l.track(new d.E911BingMapsEvent(String(i.statusCode))),l.log(c.LogTraceArea.Phone,"E911Service: Location is fetched from Bing Maps API. Formatting location to PIDF-LO.");const u=this._formatLocation(e,t,s);return l.log(c.LogTraceArea.Phone,"E911Service: Location is formatted to PIDF-LO. Encoding location to Base64."),(0,r.btoaUtf8)(u)})).catch((e=>{const t=String(a.get(e,"statusCode"))||"NO_STATUS_CODE",i=String(a.get(e,"statusDescription"))||"NO_STATUS_DESCRIPTION";return l.track(new d.E911BingMapsEvent(t)),l.warn(c.LogTraceArea.Phone,"E911Service: Failed to fetch location from Bing Maps API: "+t+" - "+i),n.Rejected()}))}_formatLocation(e,t,i){return`<?xml version="1.0" encoding="utf-8"?>\n            <presence xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:ietf:params:xml:ns:pidf">\n                <tuple id="tuple0">\n                    <status>\n                        <geopriv xmlns="urn:ietf:params:xml:ns:pidf:geopriv10">\n                            <location-info>\n                                <Point srsName="urn:ogc:def:crs:EPSG::4326" xmlns="http://www.opengis.net/gml">\n                                    <pos>${e} ${t}</pos>\n                                </Point>\n                                <civicAddress xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr">\n                                    ${`<country>${u.default.toUpper(a.escape(i.address.countryRegionIso2))}</country>\n                <A1>${a.escape(i.address.adminDistrict)}</A1>\n                <A2>${a.escape(i.address.adminDistrict2)}</A2>\n                <A3>${a.escape(i.address.locality)}</A3>\n                <RD>${a.escape(i.address.addressLine)}</RD>\n                <LMK>${a.escape(i.address.landmark)}</LMK>\n                <PC>${a.escape(i.address.postalCode)}</PC>`}\n                                </civicAddress>\n                            </location-info>\n                            <usage-rules>\n                                <retransmission-allowed xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:basicPolicy">true</retransmission-allowed>\n                            </usage-rules>\n                            <method>Derived</method>\n                        </geopriv>\n                    </status>\n                </tuple>\n            </presence>`}}t.E911Service=h,t.default=new h},565060:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(174958),n=o.__importStar(i(496486)),s=o.__importDefault(i(638884)),r=i(279211),l=i(662783),c=o.__importDefault(i(974634)),d=o.__importStar(i(397691)),u=i(673620),h=o.__importDefault(i(150343)),p=i(434343),g=(o.__importStar(i(766698)),i(815146)),C=o.__importStar(i(85385)),m=o.__importDefault(i(652032)),S=o.__importDefault(i(114818)),_=o.__importStar(i(704704)),f=o.__importDefault(i(510335)),y=o.__importStar(i(754801)),T=o.__importDefault(i(599571)),b=o.__importDefault(i(902530)),v=o.__importStar(i(446574)),I=o.__importDefault(i(655192)),w=o.__importDefault(i(139221)),P=o.__importDefault(i(601274)),M=o.__importStar(i(517518)),D=o.__importDefault(i(800449)),A=i(843890),k=o.__importDefault(i(760989)),R=i(6123);t.default=new class{constructor(){this.pushTransportPathChanged=new c.default,this._exponentialTime=new l.ExponentialTime(1e3,3e5),this._checkStateRunning=!1,this._checkStateQueued=!1,this._subscriptions=[],this._clearedPushVoipRegistrations=!1,this._clearedPushAlertRegistrations=!1,this._handleRegistrationTokenReceived=e=>o.__awaiter(this,void 0,void 0,(function*(){const t=new y.GotToken;if(C.log(g.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let i;i=e,t.registrationAction=yield this._setPushTransportPath(i)}else C.warn(g.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token");C.track(t)})),this._handleRegistrationAlertTokenReceived=e=>o.__awaiter(this,void 0,void 0,(function*(){const t=new y.GotToken;if(C.log(g.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let i;i=e,t.registrationAction=yield this._setPushTransportAlertPath(i)}else C.warn(g.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token");C.track(t)})),this._gaveUpOnFetchingRegistrationTokenEvent=()=>{C.track(new y.GaveUpOnFetchingToken)},this._nonFatalErrorFetchingRegistrationTokenEvent=e=>{C.track(new y.NonFatalErrorFetchingToken(e.errorCode,e.errorMessage,e.networkConnectivityLevel))},this._handleRegistrationInvalidated=()=>{C.warn(g.LogTraceArea.RegistrarService,"OS Push Notification token has been invalidated")},this._updateTrouter=(e,t)=>this._trouterUrl===e&&this._trouterTTL===t?Promise.resolve():(this._setTrouterEndpoint(e,t),this._checkState().then(u.noop)),this._checkState=()=>o.__awaiter(this,void 0,void 0,(function*(){if(this._checkStateRunning)return this._checkStateQueued=!0,"no_action";for(;;){this._checkStateRunning=!0;const e=yield this._checkStateInner();if(this._checkStateRunning=!1,!this._checkStateQueued)return e;this._checkStateQueued=!1}})),v.RegisterStartupable(this,"RegistrarService",[m.default,b.default,M.default,D.default]),f.default.registerForLogout(this,"RegistrarService")}startup(){const e=m.default.getData(p.InternalKeys.EdfRegistrationInfo);e&&(this._setRegistrationId(e.registrationId,!!e.registrationIdGenerated),this._lastPostedTime=e.lastPostedTime,this._lastPostedPayload=e.lastPostedPayload,C.log(g.LogTraceArea.RegistrarService,"Loaded registrationId: "+this._registrationId+" lastPostedTime: "+this._lastPostedTime),h.default.getS4LFeatures().pushConfig.refreshOnLaunch&&(C.log(g.LogTraceArea.RegistrarService,"Clearing lastPostedPayload - will re-register"),this._lastPostedPayload=void 0));const t=s.default.useNativeRegistrationId();if(t||this._registrationId)!t||this._registrationId&&!this._registrationIdGenerated||b.default.InternalCallingRegistrationId.waitUntilSet().then((()=>this._setAndPersistRegistrationId(b.default.InternalCallingRegistrationId.get(),!1)));else{const e=k.default.newGuid();C.log(g.LogTraceArea.RegistrarService,"Generated new arbitrary registrationId: "+e),this._setAndPersistRegistrationId(e,!0)}this._subscriptions.push(r.PushNotifications.registrationTokenReceivedEvent.subscribe(this._handleRegistrationTokenReceived)),this._subscriptions.push(r.PushNotifications.registrationAlertTokenReceivedEvent.subscribe(this._handleRegistrationAlertTokenReceived)),this._subscriptions.push(r.PushNotifications.gaveUpOnFetchingRegistrationTokenEvent.subscribe(this._gaveUpOnFetchingRegistrationTokenEvent)),this._subscriptions.push(r.PushNotifications.nonFatalErrorFetchingRegistrationTokenEvent.subscribe(this._nonFatalErrorFetchingRegistrationTokenEvent)),this._subscriptions.push(r.PushNotifications.registrationTokenInvalidatedEvent.subscribe(this._handleRegistrationInvalidated));const i=r.PushNotifications.getRegistrationToken();i&&this._handleRegistrationTokenReceived(i);const o=r.PushNotifications.getAlertRegistrationToken();return o&&this._handleRegistrationAlertTokenReceived(o),this._tokenStoreSubscription=M.default.subscribe(this._checkState,M.TriggerKeys.SkypeTokenKey),this._subscriptions.push(D.default.trouterChanged.subscribe(this._updateTrouter)),this._setTrouterEndpoint(D.default.getUrl(),D.default.getTTL()),this._appConfigStoreSubscription=h.default.subscribe(this._checkState),this._checkState().then(u.noop)}logout(e,t,i){this._unsubscribe();const o=i?d.Resolved():m.default.putData(p.InternalKeys.EdfRegistrationInfo,void 0),a=this._deleteRegistration(),n=b.default.deleteIds({edfRegistrationId:!0},!i);return d.all([o,n]).always((()=>d.raceTimer(a,500))).then(u.noop)}test_reset(){return this._pushTransportPath=void 0,this._pushTransportAlertPath=void 0,this._trouterUrl=void 0,this._trouterTTL=void 0,this._registrationId=void 0,this._registrationIdGenerated=void 0,this._lastPostedTime=void 0,this._lastPostedPayload=void 0,this._dontPostUntilAfter=void 0,this._registrationInFlight=void 0,this._postingPayload=void 0,this._clearedPushVoipRegistrations=!1,this._clearedPushAlertRegistrations=!1,this._unsubscribe(),d.all([b.default.deleteIds({edfRegistrationId:!0}),m.default.putData(p.InternalKeys.EdfRegistrationInfo,void 0)]).then(u.noop)}_unsubscribe(){const e=this._subscriptions;if(this._subscriptions=[],n.each(e,(e=>e.unsubscribe())),this._tokenStoreSubscription){const e=this._tokenStoreSubscription;this._tokenStoreSubscription=void 0,M.default.unsubscribe(e)}if(this._appConfigStoreSubscription){const e=this._appConfigStoreSubscription;this._appConfigStoreSubscription=void 0,h.default.unsubscribe(e)}}_setPushTransportPath(e){return this._pushTransportPath===e?Promise.resolve("no_action"):(this._pushTransportPath=e,this.pushTransportPathChanged.fire(),this._checkState())}_setPushTransportAlertPath(e){return this._pushTransportAlertPath===e?Promise.resolve("no_action"):(this._pushTransportAlertPath=e,this._checkState())}getPushTransportPath(){return this._pushTransportPath}test_updateTrouter(e,t){return this._updateTrouter(e,t)}_setTrouterEndpoint(e,t){this._trouterUrl=e,this._trouterTTL=t}hasRegisteredWithService(){return!!this._lastPostedPayload}debug_getLastPayload(){return this._lastPostedPayload}debug_enumerateRegistrations(){return T.default.enumerateRegistrations().then((e=>e.bindings))}_deleteRegistration(){return this._registrationId?T.default.deleteRegistration(this._registrationId):d.Resolved()}_checkStateInner(){return o.__awaiter(this,void 0,void 0,(function*(){if(!M.default.hasUsableSkypeToken())return C.log(g.LogTraceArea.RegistrarService,"Skipping PNH registration request: No usable SkypeToken"),"no_usable_skype_token";if(!this._registrationId)return C.log(g.LogTraceArea.RegistrarService,"Skipping PNH registration request: No registrationId"),"no_registration_id";if(!this._trouterUrl&&!this._pushTransportPath)return C.log(g.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid transport"),"no_valid_transport";if(!this._trouterUrl&&!this._pushTransportAlertPath&&A.UICapabilities.alertNotificationEnabled())return C.log(g.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid alert transport path"),"no_valid_alert_transport";const e=Date.now();if(this._dontPostUntilAfter&&e<this._dontPostUntilAfter)return this._retryTimer&&P.default.clearExpiration(this._retryTimer),this._retryTimer=P.default.setExpiration(this._checkState,this._dontPostUntilAfter),C.log(g.LogTraceArea.RegistrarService,"Skipping PNH registration request: Cannot post until "+this._dontPostUntilAfter),"registration_blocked_until_timestamp";const t=yield this._buildRegistrationPayload();if(!this._lastPostedTime||!(0,S.default)(this._lastPostedPayload,t)||e>this._lastPostedTime+1e3*h.default.getS4LFeatures().pushConfig.refreshIntervalSeconds||e>this._lastPostedTime+this._calcLowestTTLForPayload(this._lastPostedPayload)/2){if(this._registrationInFlight){if((0,S.default)(t,this._postingPayload))return C.log(g.LogTraceArea.RegistrarService,"Skipping PNH registration request: Already posting"),"registration_already_in_progress";const e=this._registrationInFlight;this._registrationInFlight=void 0,e.cancel()}return this._registrationInFlight=this._clearPushRegistrations().finally((()=>this._createPushRegistration(t))),"registration_started"}{const e=this._registrationCompleteDeferred;return e&&(C.log(g.LogTraceArea.RegistrarService,"PNH Registration Completed..."),e.resolve(void 0),this._registrationCompleteDeferred=void 0),"no_action"}}))}_createPushRegistration(e){return this._logPnhRegistrationAttempt(e),this._postingPayload=e,T.default.postRegistration(this._postingPayload).finally((()=>{this._registrationInFlight=void 0,this._postingPayload=void 0})).then((t=>{this._dontPostUntilAfter=void 0,this._exponentialTime.reset(),C.log(g.LogTraceArea.RegistrarService,"PNH Registration Completed!"),this._lastPostedTime=Date.now(),this._lastPostedPayload=e,this._saveInfoToDb(),this._storeRegistrationTime(t)}),(e=>{C.warn(g.LogTraceArea.RegistrarService,"PNH Registration errored: "+I.default.errorAsString(e)),this._dontPostUntilAfter=Date.now()+this._exponentialTime.getTimeAndCalculateNext()})).finally((()=>{this._checkState()}))}_logPnhRegistrationAttempt(e){C.log(g.LogTraceArea.RegistrarService,"Sending PNH registration request:\nClient Description: "+a.pii.Omit(JSON.stringify(e.clientDescription))+", NodeId: "+e.nodeId+", Registration Id: "+e.registrationId+", Transports: "+n.map(e.transports,((e,t)=>{let i="";return"\n"+t+" registered for:"+n.map(e,(e=>(i=i||e.path,", Context: "+e.context+", TTL: "+e.ttl+", CreationTime: "+e.creationTime)))+", with Path: "+C.piiTrustMeThisIsSafe(i)})))}_clearPushRegistrations(){if(!h.default.getS4LMessagingFeaturesNoSubscription().clearPushRegistrations)return d.Resolved();const e=Date.now()/1e3+1e5,t=s.default.getApplicationId(),i=[];return this._pushTransportPath&&!this._clearedPushVoipRegistrations&&i.push(T.default.patchRegistrations(this._pushTransportPath,e,t).then((()=>{C.log(g.LogTraceArea.RegistrarService,"Cleared VoIP push registrations"),this._clearedPushVoipRegistrations=!0}),(e=>{C.log(g.LogTraceArea.RegistrarService,"Failed to clear VoIP push registrations with error: "+I.default.errorAsString(e))}))),A.UICapabilities.alertNotificationEnabled()&&this._pushTransportAlertPath&&!this._clearedPushAlertRegistrations&&i.push(T.default.patchRegistrations(this._pushTransportAlertPath,e,t).then((()=>{C.log(g.LogTraceArea.RegistrarService,"Cleared alert push registrations"),this._clearedPushAlertRegistrations=!0}),(e=>{C.log(g.LogTraceArea.RegistrarService,"Failed to clear alert push registrations with error: "+I.default.errorAsString(e))}))),C.log(g.LogTraceArea.RegistrarService,"Number of push registration paths to be cleared: "+i.length),d.all(i)}_calcLowestTTLForPayload(e){let t;return n.each(e.transports,(e=>{n.each(e,(e=>{(!t||e.ttl<t)&&(t=e.ttl)}))})),t}_saveInfoToDb(){const e={registrationId:this._registrationId,registrationIdGenerated:this._registrationIdGenerated,lastPostedTime:this._lastPostedTime,lastPostedPayload:this._lastPostedPayload};return m.default.putData(p.InternalKeys.EdfRegistrationInfo,e)}_setAndPersistRegistrationId(e,t){this._setRegistrationId(e,t),this._saveInfoToDb().then((()=>{this._checkState()}))}getRegistrationId(){return this._registrationId}_setRegistrationId(e,t){this._registrationId=e,this._registrationIdGenerated=t,this._registrationId&&b.default.setEdfRegistrationId(this._registrationId)}_buildRegistrationPayload(){return o.__awaiter(this,void 0,void 0,(function*(){const{pnh:e,pnhEncryption:t}=h.default.getConfigSettingsNoSubscription(),i=n.merge({},this._pushTransportPath?s.default.getTransports(h.default.getS4LFeatures().pushConfig.ttlSeconds,this._pushTransportPath,this._pushTransportAlertPath,A.UICapabilities.alertNotificationEnabled(),e):{},this._getTrouterTransport()),o={registrationId:this._registrationId,nodeId:"",clientDescription:{appId:s.default.getApplicationId(),platform:s.default.getPlatformName(),languageId:_.getLocale(),templateKey:s.default.getTemplateKey(A.UICapabilities.alertNotificationEnabled(),e),platformUIVersion:w.default.getClientVersionAndPlatform()+"/",notificationFilteringService:s.default.getNotificationFilteringService()},transports:i};return t.enabled&&Object.assign(o.clientDescription,yield(0,R.getPnhEncryptionService)().createRegistrationPayload()),o}))}_storeRegistrationTime(e){const{pnhEncryption:t}=h.default.getConfigSettingsNoSubscription();t.enabled&&(0,R.getPnhEncryptionService)().storeRegistrationTime(e)}_getTrouterTransport(){return this._trouterUrl?{TROUTER:[{context:"",creationTime:"",path:this._trouterUrl,ttl:this._trouterTTL}]}:{}}getTrouterUrl(){return this._trouterUrl}}},656945:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(942111),n=o.__importStar(i(496486)),s=o.__importStar(i(167606)),r=o.__importStar(i(397691)),l=o.__importDefault(i(150343)),c=i(85385),d=o.__importDefault(i(163374)),u=o.__importDefault(i(902530)),h=o.__importDefault(i(139221)),p=o.__importDefault(i(517518)),g=i(705341),C=o.__importStar(i(549781)),m=o.__importDefault(i(424646)),S=i(41623);class _ extends g.TrouterBase{constructor(){super(),this._stateChangeCallbacks=[],this._trouter=(0,a.createTrouterService)(new m.default("tstrouter"));const e=l.default.getTrouterJScriptClientConfig();this._config={version:h.default.getUIVersion(),sessionIdProvider:()=>h.default.getDeviceId(),registrationIdProvider:()=>u.default.EdfRegistrationId.get(),tokenProvider:()=>p.default.performWhenValidSkypeTokenArrives().then((()=>p.default.getRawSkypeToken())).toEs6Promise(),urlProvider:()=>l.default.getTrouterJScriptClientConfig().TrouterConnectionUrl,telemetry:{sender:{logEvent(e){(0,c.track)(new S.TrouterEvent(e))}},settings:{enabled:e.TelemetryEnabled,logHealthCheckError:e.ClientTelemetryEventEnabled.logHealthCheckError,trouter_js_client_connected:e.ClientTelemetryEventEnabled.trouter_js_client_connected,trouter_js_client_disconnected:e.ClientTelemetryEventEnabled.trouter_js_client_disconnected,trouter_js_client_error:e.ClientTelemetryEventEnabled.trouter_js_client_error,trouter_js_client_progress:e.ClientTelemetryEventEnabled.trouter_js_client_progress,trouter_js_client_response:e.ClientTelemetryEventEnabled.trouter_js_client_response,numberOfStepsToMaintain:e.ClientTelemetryEventEnabled.numberOfStepsToMaintain,sendProgressTimeoutSecs:e.ClientTelemetryEventEnabled.sendProgressTimeoutSecs}},connectivityChanged:d.default.connectivityChangedEvent}}start(){s.log(s.LogTraceArea.Trouter,"start"),this._trouter.addCallback(((e,t)=>{this._url=t?t.url:void 0,this._ttl=t?t.getRemainingTtlInSec():void 0,s.log(s.LogTraceArea.Trouter,"Received state change event url: "+this._url+" state: "+a.TrouterState[e]+" ttl: "+this._ttl),n.each(this._stateChangeCallbacks,(e=>e(this.isConnected())))})),this._connectivityToken=this._config.connectivityChanged.subscribe((e=>{s.log(s.LogTraceArea.Trouter,"Received connectivity change: "+e),e&&this._trouter.checkConnection()})),this._trouter.start(this._createTrouterServiceConfig())}stop(){if(s.log(s.LogTraceArea.Trouter,"stop"),this._trouter.stop(),this._connectivityToken){const e=this._connectivityToken;this._connectivityToken=void 0,e.unsubscribe()}}isEnabled(){return!0}setEcsConfig(e){return r.fromThenable(this._trouter.setEcsConfig(e))}getInternal(){return this._trouter}registerMessageHandler(e){this._trouter.registerListener({onTrouterConnected:(e,t)=>{},onTrouterRequest:(t,i)=>{this._handleTrouterRequest(e,t,i,g.IncomingUedMessagingEventId)},onTrouterMessageLoss:e=>(s.log(s.LogTraceArea.Trouter,`onTrouterMessageLoss ${e}`),!!e.includes(g.TrouterMessaging.tag)&&(this.onMessagingMessageLoss.fire(),!0))},g.TrouterMessaging.path),this._trouter.registerListener({onTrouterConnected:(e,t)=>{},onTrouterRequest:(t,i)=>{this._handleTrouterRequest(e,t,i,g.IncomingUpsPresenceEventId)}},g.TrouterUps.path),this._trouter.registerMessageHandler({handleMessage:t=>{if(!t||!t.body)return void s.warn(s.LogTraceArea.Trouter,"Ignoring empty message");const i=t.headers,o=i?i[g.CVHeaderName]:void 0,a=i?i[g.TrouterRequestHeaderName]:void 0,n=t.body.data||t.body,r={eventId:t.eventId?t.eventId:t.body?t.body.evt||t.body.eventId||n.eventType||(n.presence?g.IncomingUpsPresenceEventId:void 0):void 0,body:n,cv:o,messageStoreUsed:C.parseMessageStoreFlagValue(a)};return e.canHandleMessage(r)?(e.handleMessage(r),{isHandled:!0,resultCode:200}):void 0}})}clearMessageHandlers(){this._trouter.clearMessageHandlers()}url(){return this._url}ttl(){return this._ttl}isConnected(){var e;return(null===(e=this._trouter)||void 0===e?void 0:e.state())===a.TrouterState.Connected}onConnectedChanged(e){this._stateChangeCallbacks.push(e),e(this.isConnected())}setUserActivityState(e,t,i){if(this._trouter){const o=t?a.UserActivityState.Active:a.UserActivityState.Inactive;s.log(s.LogTraceArea.Trouter,`setUserActivityState to ${o} on endpoint ${e}`),this._trouter.setUserActivityState(o,i)}}_createTrouterServiceConfig(){return{trouterSettings:this._createTrouterSettings(),skypeTokenProvider:this._config.tokenProvider,telemetryConfig:this._createTrouterTelemetryConfig()}}_createTrouterSettings(){return{trouterServiceUrl:this._config.urlProvider(),version:this._config.version,productName:"Skype4Life",sessionId:this._config.sessionIdProvider(),registrationId:this._config.registrationIdProvider(),environment:"prod",incallModeTimeoutMs:0}}_createTrouterTelemetryConfig(){return{eventLogger:this._config.telemetry.sender,settings:this._config.telemetry.settings}}_handleTrouterRequest(e,t,i,o){s.log(s.LogTraceArea.Trouter,`Incoming request ${t.path}: ${JSON.stringify(t.headers)}`);const a=t.headers,n={eventId:o,body:t.body,cv:a[g.CVHeaderName],messageStoreUsed:C.parseMessageStoreFlagValue(a[g.TrouterRequestHeaderName])};e.handleMessage(n),i.status=200,i.send()}}t.default=_},549781:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parseMessageStoreFlagValue=function(e){if(a.isUndefined(e))return;const t=n.default.parseJsonErrorable(e);if(a.isError(t))return void r.error(s.LogTraceArea.Trouter,"Failed to parse TrouterRequestHeader.");return t.mstore};const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(655192)),s=i(815146),r=o.__importStar(i(85385))},705341:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterBase=t.UserActivityStateInactive=t.UserActivityStateActive=t.TrouterUps=t.TrouterMessaging=t.TrouterAppName=t.IncomingUedMessagingEventId=t.IncomingUpsPresenceEventId=t.TrouterRequestHeaderName=t.CVHeaderName=void 0;const o=i(197582).__importDefault(i(974634));t.CVHeaderName="MS-CV",t.TrouterRequestHeaderName="trouter-request",t.IncomingUpsPresenceEventId=1200,t.IncomingUedMessagingEventId=299,t.TrouterAppName="Skype4Life-App",t.TrouterMessaging={path:"/messaging",tag:"messaging"},t.TrouterUps={path:"/ups",tag:""},t.UserActivityStateActive=1,t.UserActivityStateInactive=2;t.TrouterBase=class{constructor(){this.onMessagingMessageLoss=new o.default}}},424646:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(167606));class s{constructor(e){this._getPrefix=a.isFunction(e)?e:()=>e}createChild(e){const t=a.isFunction(e)?e:()=>e;return new s((()=>this._getPrefix()+"/"+t()))}log(...e){this._apply((e=>n.log(n.LogTraceArea.Trouter,e)),e)}debug(...e){this._apply((e=>n.debug((()=>e))),e)}info(...e){this._apply((e=>n.log(n.LogTraceArea.Trouter,e)),e)}warn(...e){this._apply((e=>n.warn(n.LogTraceArea.Trouter,e)),e)}error(...e){this._apply((e=>n.error(n.LogTraceArea.Trouter,e)),e)}_apply(e,t=[]){this._addPrefix(t);const i=t.map((e=>a.isObject(e)?JSON.stringify(e):e)).join(", ");e.call(n,i)}_addPrefix(e){if(e&&e[0]){const t=this._getPrefix()+" "+e[0];e[0]=t}}}t.default=s},748996:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=(i(174958),o.__importStar(i(397691))),s=o.__importDefault(i(150343)),r=o.__importDefault(i(369347)),l=o.__importDefault(i(60433)),c=o.__importDefault(i(404547)),d=o.__importDefault(i(555436)),u=o.__importDefault(i(919682)),h=i(815146),p=o.__importStar(i(85385)),g=o.__importDefault(i(510335)),C=o.__importDefault(i(960218)),m=i(527703),S=o.__importDefault(i(769956)),_=o.__importStar(i(446574)),f=o.__importDefault(i(269296)),y=o.__importDefault(i(685734)),T=i(512050);t.default=new class{constructor(){this._subscriptions=[],_.RegisterStartupable(this,"TrouterNotificationsService",[C.default]),g.default.registerForLogout(this,"TrouterNotificationsService")}startup(){return this._subscriptions.push(C.default.event_trouterNotificationQueueChanged.subscribe((()=>{this._drainTrouterQueue()}))),this._drainTrouterQueue(),Promise.resolve()}_drainTrouterQueue(){a.each(C.default.fetchAndDrainTrouterNotificationQueue(),(e=>{this._handleTrouterMessage(e.notification,e.causeId)}))}logout(e,t,i){const o=this._subscriptions;return this._subscriptions=[],a.each(o,(e=>e.unsubscribe())),n.Resolved()}_handleTrouterMessage(e,t){const i=Number(e.eventId);p.log(h.LogTraceArea.Trouter,"_handleTrouterMessage (Evt: "+i+", causeId: "+t+"), MS-CV: "+e.cv+")"),r.default.CallNotificationHelpers.maybeDisposePendingWarmCallForNotification(i);const o=Date.now();if(i===m.PNHEvents.IncomingNGCCall||i===m.PNHEvents.IncomingNGCGroupCall||i===m.PNHEvents.IncomingNGCPSTNCall||i===m.PNHEvents.IncomingS4BCall||i===m.PNHEvents.IncomingNGCEncryptedCall)r.default.CallNotificationHelpers.processIncomingCallNotification(i,"trouter",l.default.incomingCallNotificationForTrouter(e),o,o,t);else if(i===m.PNHEvents.IncomingGoLiveStart)r.default.CallNotificationHelpers.processIncomingGoLiveNotification(i,"trouter",l.default.incomingGoLiveNotificationForTrouter(e),o,o,t);else if(i===m.PNHEvents.IncomingGoLiveStop)r.default.CallNotificationHelpers.processGoLiveStopNotification(i,"trouter",l.default.stopGoLiveNotificationForTrouter(e),o,o,t);else if(i===m.PNHEvents.IncomingNGCStopRinger)r.default.CallNotificationHelpers.processStopCallNotification("trouter",l.default.stopCallNotificationForTrouter(e),o,o,t);else if(i===m.PNHEvents.IncomingWarmCall)r.default.CallNotificationHelpers.processWarmCallNotification(!1,e.body,t);else if(i===m.PNHEvents.IncomingP2PCall)r.default.CallNotificationHelpers.processP2PCallNotification(i,"trouter",e.body,o,o,t);else if(i===m.PNHEvents.IncomingContactListChange)d.default.processContactListChangeNotification();else if(i===m.PNHEvents.IncomingContactRequest||i===m.PNHEvents.IncomingContactAccept||i===m.PNHEvents.IncomingContactInviteListChange)d.default.processContactInviteNotification();else if(i===m.PNHEvents.IncomingProfileChange)y.default.fetchUserPotentiallyBeforeStartup();else if(i===m.PNHEvents.IncomingAvatarChange)y.default.fetchUserAvatarUrlPotentiallyBeforeStartup();else if(i===m.PNHEvents.SceUserServicesChange)u.default.processSceUserServicesChangeNotification(e.body.data||e.body);else if(i===m.PNHEvents.IncomingTPUMConciergeMessage){const i=e.body;f.default.processTPUMNotification(i,t)}else if(i===m.PNHEvents.IncomingUpsPresence)S.default.handleTrouterEvent(e.body);else if(i===m.PNHEvents.Ued||i===m.PNHEvents.UedP2PFromV2){const t=s.default.getS4LMessagingFeaturesNoSubscription().ued,i=t&&t.enabled&&t.consumeEvents;p.log(h.LogTraceArea.Trouter,"Incoming UED event, MS-CV: "+e.cv+", processing enabled:"+i),i&&c.default.handleTrouterEvent(e.body,e.cv,e.messageStoreUsed)}else{if(i!==m.PNHEvents.ContentChannelSync&&i!==m.PNHEvents.ContentChannelNotification)return p.warn(h.LogTraceArea.Trouter,"_handleTrouterMessage: Failed to handle event type: "+i+" causeId: "+t+", MS-CV: "+e.cv),!1;(0,T.handleChannelsTrouterMessage)(i,e)}return!0}}},800449:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(331654)),s=o.__importStar(i(516778)),r=o.__importDefault(i(974634)),l=o.__importStar(i(397691)),c=o.__importDefault(i(150343)),d=i(815146),u=o.__importStar(i(85385)),h=i(527703),p=o.__importStar(i(446574)),g=o.__importDefault(i(655192)),C=o.__importDefault(i(517518)),m=o.__importDefault(i(656945)),S=o.__importStar(i(442699)),_=o.__importDefault(i(902530)),f=i(715405),y=o.__importStar(i(440760)),T=o.__importDefault(i(601274)),b=o.__importDefault(i(163374)),v=i(621991),I=3e4;t.default=new class{constructor(){this.messageReceived=new r.default,this.trouterChanged=new r.default,this.messageLost=new r.default,this._started=!1,this._activityLevelIsBackground=!1,this._onReloadCallback=e=>(u.log(d.LogTraceArea.Trouter,"LifecycleService.ON_RELOAD causeId: "+e),this.logout(e,!1,!1),l.Resolved()),this._setTimeoutToReportIfTrouterIsDisconnectedTooLong=()=>{const{enableDisconnectedTrouterReporting:e}=c.default.getS4LMessagingFeatures();e&&(this._trouterDisconnectedTimeout&&(T.default.clearTimeout(this._trouterDisconnectedTimeout),this._trouterDisconnectedTimeout=null),this._trouterDisconnectedTimeout=T.default.setTimeout((()=>{if(!this._trouter.isConnected()){if(!b.default.isNetworkingAvailableNoSubscription())return void u.warn(d.LogTraceArea.Trouter,"Trouter disconnected more than 30000 milliseconds due to internet connectivity issue");u.error(d.LogTraceArea.Trouter,"Trouter disconnected more than 30000 milliseconds even though the internet is available"),u.track(new v.TrouterDisconnectedTooLong(I))}}),I))},p.RegisterStartupable(this,"TrouterService",[C.default,_.default])}startup(){return y.default.addObserver(y.LifecycleEventType.ON_RELOAD,this._onReloadCallback),this._trouter=new m.default,this._configStoreSubscriptionToken=c.default.subscribe((()=>this._onConfigChanged())),this._trouter.registerMessageHandler({handleMessage:e=>this.messageReceived.fire(e),canHandleMessage:e=>!a.isNaN(e.eventId)&&e.eventId!==h.PNHEvents.IncomingUnknown&&a.some(a.values(h.PNHEvents),(t=>a.toNumber(t)===e.eventId))}),this._trouter.onConnectedChanged((e=>{if(u.log(d.LogTraceArea.Trouter,"onConnectedChanged "+e),e){if(this._waitingForTrouterConnected){const e=this._waitingForTrouterConnected;this._waitingForTrouterConnected=void 0,e.resolve(void 0)}this._trouterDisconnectedTimeout&&(T.default.clearTimeout(this._trouterDisconnectedTimeout),this._trouterDisconnectedTimeout=null)}else this._setTimeoutToReportIfTrouterIsDisconnectedTooLong();u.track(new S.DevDebug("UED-Trouter-Event",JSON.stringify({event:"onStateChange",isConnected:e,url:this._trouter.url()}))),this.trouterChanged.fire(this._trouter.url(),this._trouter.ttl())})),this._trouter.onMessagingMessageLoss.subscribe((()=>{u.track(new S.DevDebug("UED-Trouter-Event",JSON.stringify({event:"onMessageLoss",url:this._trouter.url()}))),this.messageLost.fire()})),this._trouter.start(),this._started=!0,this._setTimeoutToReportIfTrouterIsDisconnectedTooLong(),this._connectivityChangeListener=s.Network.connectivityChangedEvent.subscribe((e=>{e&&this._setTimeoutToReportIfTrouterIsDisconnectedTooLong()})),l.Resolved()}logout(e,t,i){var o;this._trouter.clearMessageHandlers(),this._trouter.stop(),c.default.unsubscribe(this._configStoreSubscriptionToken),y.default.removeObserver(y.LifecycleEventType.ON_RELOAD,this._onReloadCallback),this.setActivityLevel(!0),this._started=!1,this._trouterDisconnectedTimeout&&(T.default.clearTimeout(this._trouterDisconnectedTimeout),this._trouterDisconnectedTimeout=null),null===(o=this._connectivityChangeListener)||void 0===o||o.unsubscribe()}getTrouter(){return this._trouter}isEnabled(){return this._trouter.isEnabled()}isConnected(){return this._trouter.isConnected()}setUserActivityState(e,t){try{const i=(0,f.generateCorrelationVector)();return u.log(d.LogTraceArea.Trouter,`setUserActivityState: ${t}, cv: ${i}, endpointId: ${e}`),this._trouter.setUserActivityState(e,t,i),l.Resolved()}catch(e){return u.log(d.LogTraceArea.Trouter,`setUserActivityState failed with error: ${g.default.errorAsString(e)}`),l.Rejected("setUserActivityState failed "+g.default.errorAsString(e))}}setActivityLevel(e){this._started?e!==this._activityLevelIsBackground&&(u.log(d.LogTraceArea.Trouter,"Setting activity level to "+(e?"background":"foreground")),this._activityLevelIsBackground=e,this._activityLevelIsBackground?n.default.disableWifiLock().catch((e=>{u.warn(d.LogTraceArea.Trouter,"disableWifiLock failed: "+g.default.errorAsString(e))})):n.default.enableWifiLock().catch((e=>{u.warn(d.LogTraceArea.Trouter,"enableWifiLock failed: "+g.default.errorAsString(e))}))):u.log(d.LogTraceArea.Trouter,"Ignoring setActivityLevel call - not started")}getUrl(){return this._trouter.url()}getTTL(){return this._trouter.ttl()}performWhenTrouterIsConnected(){return this._trouter.isConnected()?l.Resolved():(this._waitingForTrouterConnected||(this._waitingForTrouterConnected=l.Defer()),this._waitingForTrouterConnected.promise())}_onConfigChanged(){const e=c.default.getCachedEcsConfig();return e?this._trouter.setEcsConfig(e.config):(u.log(d.LogTraceArea.Trouter,"No cached ECS settings available"),l.Resolved())}}},785526:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createCallJoinContext=function(e,t){return o.__awaiter(this,void 0,void 0,(function*(){{const i=yield function(e){return(0,n.default)().getConversationPotentiallyBeforeStartupAsync(e).then((e=>e||a.Rejected(new Error("getConversationPotentiallyBeforeStartupAsync returned undefined"))))}(t).toEs6Promise(),o=i.getConversationProperty(s.ConversationProps.LiveState);if("string"!=typeof o)throw new Error("Failed to get conversation live state");const l=r.default.parseJsonErrorToUndefined(o);if(void 0===(null==l?void 0:l.conversationUrl))throw new Error("Failed to get conversation URL for call join context");return{conversationId:e,conversationUrl:l.conversationUrl}}}))};const o=i(197582),a=o.__importStar(i(397691)),n=o.__importDefault(i(615364)),s=o.__importStar(i(44717)),r=o.__importDefault(i(655192))},218905:(e,t,i)=>{var o;Object.defineProperty(t,"__esModule",{value:!0}),t.EmailABCHEntry=t.PhoneABCHEntry=t.ABCHEntry=t.VerificationState=void 0;const a=i(197582),n=i(174958),s=a.__importStar(i(496486)),r=i(217041),l=a.__importStar(i(397691)),c=a.__importStar(i(932382)),d=a.__importDefault(i(956324)),u=a.__importStar(i(815146)),h=a.__importStar(i(85385)),p=a.__importDefault(i(201721)),g=a.__importStar(i(3025)),C=a.__importDefault(i(655192)),m=a.__importDefault(i(760989)),S=a.__importStar(i(808164)),_=a.__importStar(i(446574));var f;!function(e){e[e.ProfileChanged=0]="ProfileChanged"}(f||(f={}));var y;!function(e){e[e.Unverified=0]="Unverified",e[e.VerificationPending=1]="VerificationPending",e[e.Verified=2]="Verified"}(y||(t.VerificationState=y={}));class T{constructor(e){switch(this.Searchable=e.Searchable,this.Source=e.Source,e.State){case c.VerificationStrings.Verified:this.VerifiedState=y.Verified;break;case c.VerificationStrings.VerificationPending:this.VerifiedState=y.VerificationPending;break;case c.VerificationStrings.Unverified:default:this.VerifiedState=y.Unverified}}}t.ABCHEntry=T;class b extends T{constructor(e){super(e),this.Phone=d.default.getPhonePartsFromViewValue(e)}}t.PhoneABCHEntry=b;class v extends T{constructor(e){super(e),this.EmailAddress=e.Name}}t.EmailABCHEntry=v;let I=o=class extends r.StoreBase{constructor(){super(),this._shortCircuitEntries={},_.RegisterStartupable(this,"ABCHStore",[p.default])}startup(){return this._initialize(),Promise.resolve()}getEntries(){return this._profile||this._initialize(),s.cloneDeep(this._shortCircuitEntries)}getProfile(e=!1){return!this._profile||e?this._initialize():l.Resolved(this._profile)}hidePhoneNumberInSearch(e){const t={Name:e.Number,Country:o.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!1},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Hide phone number in search "+n.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then((e=>this._parseProfile(e)))}showPhoneNumberInSearch(e,t){const i={Name:e.Number,Country:o.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0},a="Msa"===t;a&&(i.Label=c.Phone_Other_Label);const s=a?{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[i]}]}:{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Show phone number in search "+n.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}deletePhoneNumber(e){const t={Name:e.Number,Country:o.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Label:c.Phone_Other_Label},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Delete:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Delete phone number "+n.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then((e=>this._parseProfile(e)))}verifyPhoneNumber(e,t){const i={Token:t,Name:e.Number,Country:o.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode)},a={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Verify phone number "+n.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(a).then((e=>this._parseProfile(e)))}provisionExistingPhoneNumber(e,t,i){const a={Name:e.Number,Country:o.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[a]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision exisiting phone number "+n.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}provisionNewPhoneNumber(e,t,i){const a={Name:e.Number,Country:o.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i,Label:c.Phone_Other_Label},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[a]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision new phone number "+n.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}getUnverifiedPhoneNumberFromProfile(e){let t="";return s.eachRight(this._shortCircuitEntries,((i,o)=>!(i instanceof b&&i.VerifiedState!==y.Verified&&i.Source===e)||(t=i.Phone.Number,!1))),t}updateEntrySearchability(e,t){this._shortCircuitEntries[e]&&(this._shortCircuitEntries[e].Searchable=t,this.trigger())}registerMsaVerifiedEmailWithShortCircuit(){return this.getProfile(!0).then((e=>{let t,i;return s.each(e.Views,(e=>{s.each(e.Attributes,(e=>{e.Name===c.AttributeNames.PersonalContactProfileEmails&&s.each(e.Value,(e=>{"Msa"===e.Source&&e.State===c.VerificationStrings.Verified&&!e.Searchable&&e.Name&&(t=e.Name,i=e.Label)}))}))})),!(!t||!i)&&c.default.registerEmailWithShortCircuit(t,i).then((()=>!0))}))}_initialize(){return this._initializationPromise||(this._initializationPromise=c.default.getMyProfile().then((e=>(h.log(u.LogTraceArea.ABCHStore,`Profile successfully loaded. Views length: ${e.Views.length}`),this.trigger(f.ProfileChanged),this._parseProfile(e)))).catch((e=>{var t;return h.track(new g.MyProfileFetch({isSuccess:!1,isV2:!0,isMigrationSuggested:!1,isMigratedToV2:!1,errorStatusCode:null!==(t=null==e?void 0:e.statusCode)&&void 0!==t?t:void 0,origin:u.MyProfileFetchOrigin.ABCHStore})),l.Rejected(e)})),h.log(u.LogTraceArea.ABCHStore,"Profile loading started.")),this._initializationPromise.finally((()=>{this._initializationPromise=void 0}))}getParsedProfile(){var e;const t={phoneNumbersAndParts:[],emails:[]};if(!this._profile)return this._initialize(),t;const i=s.flatten(s.map(null===(e=this._profile)||void 0===e?void 0:e.Views,"Attributes")),o=s.filter(i,(e=>s.includes([c.AttributeNames.PersonalContactProfilePhones,c.AttributeNames.PersonalContactProfileEmails],e.Name)));return s.each(o,(e=>{s.each(e.Value,(i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones&&0===t.phoneNumbersAndParts.length){const e=d.default.getPhonePartsFromViewValue(i);t.phoneNumbersAndParts.push({phoneNumber:d.default.getPhoneKey(e.Number,e.CountryIsoCode,e.CountryCallingCode,!0),phoneParts:e,source:i.Source})}else e.Name===c.AttributeNames.PersonalContactProfileEmails&&0===t.emails.length&&t.emails.push(i.Name)}))})),t}_parseProfile(e){this._profile=e,this._shortCircuitEntries={};let t=!1;s.each(e.Views,(e=>{s.each(e.Attributes,(e=>{s.each(e.Value,(i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones){const e=d.default.calculatePhoneKeyFromViewValue(i);this._shortCircuitEntries[e]=new b(i)}else if(e.Name===c.AttributeNames.PersonalContactProfileEmails){const e=this._calculateEmailKeyFromViewValue(i);this._shortCircuitEntries[e]=new v(i),i.State===c.VerificationStrings.Verified&&(t=!0)}}))}))}));const i=s.map(this._shortCircuitEntries,((e,t)=>`${this._getEntryName(e)}:${n.pii.Omit(t)}`)).join("\n");return h.log(u.LogTraceArea.ABCHStore,"Updated profile info:\n"+i),p.default.setUserPreferencesLocal({hasVerifiedEmail:t}),this.trigger(),e}_getEntryName(e){return e instanceof b?"Phone":e instanceof v?"Email":m.default.switchStatementExhaustiveChecking(e)}hasMSAPhoneNumber(e){return Object.values(e).some((e=>e instanceof b&&"Msa"===e.Source))}getMSAPhoneNumber(e){let t;const i=Object.values(e).filter((e=>e instanceof b&&"Msa"===e.Source));if(i.length>0){const e=i[0].Phone,o=S.default.parse(e.Number,e.CountryCallingCode);t=o?S.default.format(o,S.PhoneNumberFormat.NATIONAL):e.Number}return t}static getCountryForVerification(e,t){return C.default.toUpper(e)+"-"+t}_calculateEmailKeyFromViewValue(e){return e.Name.trim().toLowerCase()}test_reset_store(){this._profile=void 0,this._initializationPromise=void 0}};a.__decorate([r.autoSubscribe],I.prototype,"getEntries",null),a.__decorate([r.autoSubscribe],I.prototype,"getProfile",null),a.__decorate([(0,r.autoSubscribeWithKey)(f.ProfileChanged)],I.prototype,"getParsedProfile",null),I=o=a.__decorate([r.AutoSubscribeStore],I),t.default=new I},290598:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(217041),n=i(815146),s=o.__importStar(i(85385));var r;!function(e){e[e.CallStatsVisibilty=0]="CallStatsVisibilty",e[e.OverflowMenuVisibility=1]="OverflowMenuVisibility"}(r||(r={}));let l=class extends a.StoreBase{constructor(){super(...arguments),this._isVisible=!1,this._overflowMenuVisible=!1}areCallControlsVisible(){return this._isVisible}setCallControlsVisible(e,t){s.log(n.LogTraceArea.CallingUI,"CallControlsVisibilityStore.setCallControlsVisible.visible: "+(e?"true":"false")+" causeId: "+t);this.areCallControlsVisible()!==e&&this._triggerUpdates(e)}_triggerUpdates(e){this._isVisible=e,this.trigger()}isOverflowMenuVisible(){return this._overflowMenuVisible}setOverflowMenuVisiblity(e,t){e!==this._overflowMenuVisible&&(s.log(n.LogTraceArea.CallingUI,`CallControlsVisibilityStore.setOverflowMenuVisibility moving  ${this._overflowMenuVisible}->${e} causeId: ${t}`),this._overflowMenuVisible=e,this.trigger(r.OverflowMenuVisibility))}resetAllVisibility(e){s.log(n.LogTraceArea.CallingUI,`CallControlsVisibilityStore.resetAllVisibility causeId: ${e}`),this._isVisible=!1,this._overflowMenuVisible=!1}};o.__decorate([a.autoSubscribe],l.prototype,"areCallControlsVisible",null),o.__decorate([(0,a.autoSubscribeWithKey)(r.OverflowMenuVisibility)],l.prototype,"isOverflowMenuVisible",null),l=o.__decorate([a.AutoSubscribeStore],l),t.default=new l},724063:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallDebugMenuItem=t.TriggerKeys=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=o.__importDefault(i(331654)),s=i(167606),r=i(217041),l=i(148540),c=o.__importStar(i(397691)),d=o.__importDefault(i(369347)),u=i(44717),h=o.__importDefault(i(555436)),p=o.__importStar(i(85385)),g=o.__importDefault(i(740794)),C=o.__importDefault(i(655192)),m=o.__importDefault(i(601274)),S=o.__importDefault(i(685734)),_=o.__importDefault(i(760989));var f,y;!function(e){e[e.SelectedTab=0]="SelectedTab",e[e.Participants=1]="Participants",e[e.CallTechnicalInfo=2]="CallTechnicalInfo",e[e.AppMetrics=3]="AppMetrics",e[e.RendererMetrics=4]="RendererMetrics"}(f||(t.TriggerKeys=f={})),function(e){e[e.CallStats=0]="CallStats",e[e.Simulation=1]="Simulation",e[e.Inspect=2]="Inspect"}(y||(t.CallDebugMenuItem=y={}));let T=class extends r.StoreBase{constructor(){super(...arguments),this._selectedItem=y.CallStats,this._refreshIntervalTokens={},this._callTechnicalInfo={},this._callParticipants={},this._rendererStats={},this._showAppMetrics=!1,this._showVideoMetrics=!1,this._handleCallEndedEvent=e=>{const t=_.default.newCauseId();this.dispose(e.callId),this.closeDebugWindow(e.callId,t,void 0)},this._updatePerformanceMetrics=()=>c.all([n.default.getSystemUsage(),n.default.getAppMetrics()]).then((e=>{const[t,i]=e;this._metrics={systemUsageInfo:t,gpu:i?i.find((e=>"GPU"===e.type)):void 0,renderer:i?i.find((e=>"Tab"===e.type)):void 0},this.trigger(f.AppMetrics)})),this._updateCallTechnicalInfo=e=>d.default.CallingStore.getTechnicalInformation(e).then((t=>{const i=C.default.parseJsonErrorToUndefined(t);this._callTechnicalInfo[e]||(this._callTechnicalInfo[e]=void 0),this._callTechnicalInfo[e]=i,this.trigger((0,r.formCompoundKey)(e,f.CallTechnicalInfo))}))}init(e){d.default.CallingStore.callEndedEvent().subscribe(this._handleCallEndedEvent),this.startTrackCallTechnicalInfo(e)}getParticipants(e){return this._callParticipants[e]?this._callParticipants[e]:[]}addParticipant(e){this._callParticipants[e]||(this._callParticipants[e]=[]);const t=this._generateParticipant(e);t&&(this._callParticipants[e].push(t),this.trigger(f.Participants))}resetParticipants(e){delete this._callParticipants[e],this.trigger(f.Participants)}removeParticipants(e){this._callParticipants[e]&&(this._callParticipants[e].pop(),this.trigger(f.Participants))}addGroupParticipants(e){for(let t=0;t<12;t++)this.addParticipant(e);this.trigger(f.Participants)}isFakeCallParticipant(e,t){return!!this._callParticipants[e]&&void 0!==a.find(this._callParticipants[e],(e=>e.mri===t))}closeDebugWindow(e,t,i,o=!0){g.default.closeCallDebugPanel(t,i,o)}openNativeWindow(e,t,i,o){g.default.closeCallDebugPanel(o,i,!t),g.default.navigateToCallingDebugPanel(e,i,t),this.trigger()}getCallTechnicalInfo(e){return this._callTechnicalInfo[e]}getAppMetrics(){return this._metrics}getSelectedTab(){return this._selectedItem}showAppMetrics(){return this._showAppMetrics}showVideoMetrics(){return this._showVideoMetrics}setShowAppMetrics(e){this._showAppMetrics=e,e?this._refreshAppMetricsIntervalTokens||(this._refreshAppMetricsIntervalTokens=m.default.setInterval(this._updatePerformanceMetrics,1e4),this._updatePerformanceMetrics()):this._refreshAppMetricsIntervalTokens&&(m.default.clearInterval(this._refreshAppMetricsIntervalTokens),this._refreshAppMetricsIntervalTokens=void 0,this._metrics=void 0),this.trigger(f.AppMetrics)}setShowVideoMetrics(e){this._showVideoMetrics=e,this.trigger()}getRendererMetrics(e,t){if(this._rendererStats[e]&&this._rendererStats[e][t])return this._rendererStats[e][t]}fetchRendererStats(e,t,i){if(!e)return;const o=d.default.RemoteStreamHelper.getRemoteStreamRenderer(e,t,i);null==o||o.getStats().then((i=>{var a,n;this._rendererStats[e]||(this._rendererStats[e]={}),this._rendererStats[e][t]={framesDropped:i.framesDropped,framesTotal:i.framesTotal,frameType:l.FrameType[null==o?void 0:o.frameType],rendererType:l.RendererType[null==o?void 0:o.rendererType],streamSize:`${null===(a=null==o?void 0:o.streamSize)||void 0===a?void 0:a.width}:${null===(n=null==o?void 0:o.streamSize)||void 0===n?void 0:n.height}`},this.trigger((0,r.formCompoundKey)(e,f.RendererMetrics))}),(e=>{p.error(s.LogTraceArea.CallDebug,`Failed to get renderer stats: ${e}`)}))}setSelectedTab(e){this._selectedItem=e,this.trigger(f.SelectedTab)}startTrackCallTechnicalInfo(e){this._refreshIntervalTokens[e]||(this._refreshIntervalTokens[e]=m.default.setInterval((()=>this._updateCallTechnicalInfo(e)),1e4),this._updateCallTechnicalInfo(e))}getCallDebugMemberMri(e,t){return a.find(this._callParticipants[e],(e=>e.id===t.id)).mri}dispose(e){const t=this._refreshIntervalTokens[e];t&&m.default.clearInterval(t),this._selectedItem=y.CallStats,this._refreshIntervalTokens[e]=void 0,this._callTechnicalInfo[e]=void 0}test_reset(){a.map(this._refreshIntervalTokens,(e=>{e&&m.default.clearInterval(e)})),this._refreshIntervalTokens={},this._callParticipants={},this._selectedItem=y.CallStats,this._callTechnicalInfo={}}_generateParticipant(e){const t=h.default.dangerousGetContactMriListMutable();if(0===t.length)return;const i=a.random(0,t.length);let o;do{o=t[a.random(0,t.length)]}while(!(0,u.isMri)(o));try{const t=S.default.getDisplayableUserByMri(o),a=new b(_.default.newGuid(),t?t.getMri():"8:myfakeuserdebug"+_.default.newCauseId(),t?t.getDisplayName():`MyFakeUser${i}`,l.ParticipantState.Connected);return a.streams={[l.StreamType.Video]:[new v(i,e,!0,!0,1,l.StreamType.Video)]},a}catch(e){return void p.log(s.LogTraceArea.CallDebug,"User doesn't exists")}}};o.__decorate([(0,r.autoSubscribeWithKey)(f.Participants)],T.prototype,"getParticipants",null),o.__decorate([(0,r.autoSubscribeWithKey)(f.CallTechnicalInfo),o.__param(0,r.key)],T.prototype,"getCallTechnicalInfo",null),o.__decorate([(0,r.autoSubscribeWithKey)(f.AppMetrics)],T.prototype,"getAppMetrics",null),o.__decorate([(0,r.autoSubscribeWithKey)(f.SelectedTab)],T.prototype,"getSelectedTab",null),o.__decorate([r.autoSubscribe],T.prototype,"showAppMetrics",null),o.__decorate([r.autoSubscribe],T.prototype,"showVideoMetrics",null),o.__decorate([(0,r.autoSubscribeWithKey)(f.RendererMetrics),o.__param(0,r.key)],T.prototype,"getRendererMetrics",null),o.__decorate([r.autoSubscribe],T.prototype,"getCallDebugMemberMri",null),T=o.__decorate([r.AutoSubscribeStore],T);class b{constructor(e,t,i,o){this.id=e,this.mri=t,this.displayName=i,this.state=o}getSourceIdForMediaType(e){return 42}getDiagnosticData(){return"MockedParticipant"}dispose(){}changed(e){return{dispose:e=>{}}}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}}class v{constructor(e,t,i,o,a,n){this.mediaSourceId=0,this.id=e,this.callId=t,this.isAvailable=i,this.isStreaming=o,this.rank=a,this.type=n}changed(e){return{dispose:e=>{}}}dispose(e){}getDiagnosticData(){return""}getStats(){assert.fail("not implemented")}isActive(){return!0}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}start(e,t){return new Promise(((e,t)=>{const i=d.default.CallingStore.getVideoPreviewRenderer(this.callId);i?e(i):t("No renderer")}))}stop(){return new Promise(((e,t)=>{e()}))}}t.default=new T},7371:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(174958),n=o.__importStar(i(496486)),s=i(217041),r=i(815146),l=o.__importStar(i(85385)),c=o.__importDefault(i(114818));var d;!function(e){e[e.DropTarget=0]="DropTarget",e[e.Drag=1]="Drag",e[e.Hover=2]="Hover"}(d||(d={}));let u=class extends s.StoreBase{getCurrentDraggingParticipantKey(){return this._currentConfig?this._currentConfig.key:void 0}getCurrentDraggingParticipantConfig(){return this._currentConfig}getCurrentHoveringParticipantConfig(){return this._hoveringConfig}dangerouslyGetCurrentDraggingParticipantConfig(){return this._currentConfig}setDraggingParticipantConfig(e){if((0,c.default)(this._currentConfig,e))return;const t=this._currentConfig;this._currentConfig=e;const i=[],o=t?t.key:null;if(!this._currentConfig||o!==this._currentConfig.key){const e=this._currentConfig?this._currentConfig.key:"none";l.log(r.LogTraceArea.CallingUI,"CallDraggingParticipantStore.setDraggingParticipantConfig change: key: "+a.pii.Omit(e)),i.push(d.Drag)}e&&this._hoveringConfig&&(this._hoveringConfig=void 0,i.push(d.Hover)),i.push(d.DropTarget),this.trigger(i)}clearHoveringParticipantConfig(e){!this._hoveringConfig||e&&this._hoveringConfig.source!==e||(this._hoveringConfig=void 0,n.defer((()=>{this.trigger(d.Hover)})))}setHoveringParticipantConfig(e){(0,c.default)(this._hoveringConfig,e)||(this._hoveringConfig=e,this.trigger(d.Hover))}};o.__decorate([(0,s.autoSubscribeWithKey)(d.Drag)],u.prototype,"getCurrentDraggingParticipantKey",null),o.__decorate([(0,s.autoSubscribeWithKey)(d.DropTarget)],u.prototype,"getCurrentDraggingParticipantConfig",null),o.__decorate([(0,s.autoSubscribeWithKey)(d.Hover)],u.prototype,"getCurrentHoveringParticipantConfig",null),u=o.__decorate([s.AutoSubscribeStore],u);const h=new u;t.default=h},379363:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallEndedTrackingStore=void 0,t.default=function(){return h||(h=new p)};const o=i(197582),a=i(217041),n=i(167606),s=o.__importDefault(i(55331)),r=o.__importDefault(i(369347)),l=i(677982),c=i(82485),d=o.__importStar(i(437782)),u=o.__importDefault(i(760989));let h,p=class extends a.StoreBase{constructor(){super(),this._storeEnabled=!1,this._timeout=0,this._conversationsWithRecentCallEnded={},this._handleCallEndedEventSubscription=(e,t)=>{this._storeEnabled=e,this._timeout=t,this._storeEnabled?this._subscribeToCallEndedEvent():this._cleanSubscriptionToCallEndedEvent()},this._subscribeToCallEndedEvent=()=>{c.Instrumentation.log(n.LogTraceArea.CallingUI,"[CallEndedTrackingStore][_subscribeToCallEndedEvent] Subscribing to callEndedEvent"),this._callEndedSubscriptionToken=r.default.CallingStore.callEndedEvent().subscribe(this._onCallEnded)},this._cleanSubscriptionToCallEndedEvent=()=>{this._callEndedSubscriptionToken&&(c.Instrumentation.log(n.LogTraceArea.CallingUI,"[CallEndedTrackingStore][_cleanSubscriptionToCallEndedEvent] Cleaning subscription to callEndedEvent"),this._callEndedSubscriptionToken.unsubscribe(),this._callEndedSubscriptionToken=void 0)},this._onCallEnded=e=>{const t=u.default.newCauseId(),i=e.conversationMri,o=this._conversationsWithRecentCallEnded[i];o&&(c.Instrumentation.log(n.LogTraceArea.CallingUI,`[CallEndedTrackingStore][_onCallEnded][${t}] Clean previous call ended timer in a conversation`,`conversationId: ${d.mriOrId(i)}`),s.default.clearTimeout(o),delete this._conversationsWithRecentCallEnded[i]),c.Instrumentation.log(n.LogTraceArea.CallingUI,`[CallEndedTrackingStore][_onCallEnded][${t}] Start tracking call ended in a conversation`,`conversationId: ${d.mriOrId(i)}`),this._conversationsWithRecentCallEnded[i]=s.default.setTimeout((()=>{this._stopTrackingEndedCall(i,t)}),this._timeout),this.trigger(i)},this._subscribeToCallEndedEvents()}shouldInactivateControlsAfterEndedCall(e){return!!this._storeEnabled&&void 0!==this._conversationsWithRecentCallEnded[e]}_subscribeToCallEndedEvents(){const{enabled:e,timeout:t}=l.AppConfigStore.getS4LCMCFeaturesNoSubscription().temporarilyInactivateCallControlsAfterCallEnd;this._handleCallEndedEventSubscription(e,t),l.AppConfigStore.subscribe((()=>{const{enabled:e,timeout:t}=l.AppConfigStore.getS4LCMCFeaturesNoSubscription().temporarilyInactivateCallControlsAfterCallEnd;this._storeEnabled!==e&&this._handleCallEndedEventSubscription(e,t)}))}_stopTrackingEndedCall(e,t){this._conversationsWithRecentCallEnded[e]&&(c.Instrumentation.log(n.LogTraceArea.CallingUI,`[CallEndedTrackingStore][_stopTrackingEndedCall][${t}] Stop tracking call ended in a conversation`,`conversationId: ${d.mriOrId(e)}`),delete this._conversationsWithRecentCallEnded[e],this.trigger(e))}};t.CallEndedTrackingStore=p,o.__decorate([a.autoSubscribe,o.__param(0,a.key)],p.prototype,"shouldInactivateControlsAfterEndedCall",null),o.__decorate([a.disableWarnings],p.prototype,"_subscribeToCallEndedEvents",null),t.CallEndedTrackingStore=p=o.__decorate([a.AutoSubscribeStore],p)},851692:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_CallLogStore=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importDefault(i(304623)),r=o.__importDefault(i(434343)),l=i(815146),c=o.__importStar(i(85385));let d=class extends n.StoreBase{constructor(){super(),this._requestThrottle=a.throttle(this._requestCallLogsThrottled,250),this._throttledIds={},this._dbLookups={},this._cache={},this._incomingCallLogsProcessedCallback=e=>{a.each(e,(e=>{const t=this._isTrackingKey(e.callId);t&&this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore received new calllog: ${e.callId} tracking: ${t}`)}))},s.default.callLogsReceived.subscribe(this._incomingCallLogsProcessedCallback)}getCallLog(e){return this._cache[e]}_startedTrackingKey(e){this._dbLookups[e]||(this._throttledIds[e]=e,this._requestThrottle())}_stoppedTrackingKey(e){delete this._throttledIds[e],delete this._cache[e]}_requestCallLogsThrottled(){if(a.isEmpty(this._throttledIds))return;const e=a.values(this._throttledIds);this._throttledIds={},c.log(l.LogTraceArea.Calling,`CallLogStore processing throttle for ${e}`);const t=r.default.getCallLogs(e).finally((()=>{a.each(e,(e=>delete this._dbLookups[e]))})).then((e=>{a.each(e,(e=>{e&&this._isTrackingKey(e.callId)&&(this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore adding calllog from store: ${e.callId}`))}))})).fail((t=>{c.warn(l.LogTraceArea.Calling,`CallLogStore failed getting calllogs from store: ${e}`)}));a.each(e,(e=>{this._dbLookups[e]=t}))}_addToCache(e){const t=this._cache[e.callId];t&&t.messageCuid&&e.messageCuid&&!(e.messageCuid>t.messageCuid)||(this._cache[e.callId]=e,this.trigger(e.callId))}test_setCache(e){this._cache=e}};t.Test_CallLogStore=d,o.__decorate([n.autoSubscribe,o.__param(0,n.key)],d.prototype,"getCallLog",null),o.__decorate([n.disableWarnings],d.prototype,"_startedTrackingKey",null),o.__decorate([n.disableWarnings],d.prototype,"_stoppedTrackingKey",null),t.Test_CallLogStore=d=o.__decorate([n.AutoSubscribeStore],d),t.default=new d},758117:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallNetworkConnectionStore=void 0,t.default=function(){return d||(d=new u)};const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importDefault(i(369347)),r=o.__importStar(i(619429)),l=i(815146),c=o.__importStar(i(85385));let d,u=class extends n.StoreBase{constructor(){super(),this._networkSubscription=void 0,this._calls=[],this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={},this._startWatchingForNetworkConnectionChanges=e=>{a.includes(this._calls,e.callId)||this._calls.push(e.callId),this._networkSubscription||(this._networkSubscription=s.default.CallingStore.networkConnectionEvent().subscribe(this._callNetworkStateUpdated))},this._stopWatchingForNetworkConnectionChanges=e=>{delete this._receiveQuality[e.callId],delete this._reconnection[e.callId],delete this._receiveCatastrophic[e.callId],a.pull(this._calls,e.callId),a.isEmpty(this._calls)&&(this._networkSubscription&&(this._networkSubscription.unsubscribe(),this._networkSubscription=void 0),this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={})},this._callNetworkStateUpdated=e=>{const t=e.callId;a.includes(this._calls,t)&&(e.eventType===r.CallNetworkQualityEventType.NetworkReconnection?this._reconnection[t]=e.networkState:e.eventType===r.CallNetworkQualityEventType.NetworkReceiveQuality?this._receiveQuality[t]=e.networkState:e.eventType!==r.CallNetworkQualityEventType.NetworkReceiveCatastrophic&&e.eventType!==r.CallNetworkQualityEventType.NetworkSendCatastrophic||(this._receiveCatastrophic[t]=e.networkState),this.trigger(t))},this._listenStartAndStopCallEvents()}getCallReconnectionState(e){if(e in this._reconnection)return this._reconnection[e]}isCallQualityPoor(e){if(this.isCallCatastrophic(e))return!0;const t=this._getCallReceivedQualityState(e);return c.log(l.LogTraceArea.Calling,`isCallQualityPoor: connectionState=${t}`),t===r.NetworkConnectionState.LostConnection}isCallCatastrophic(e){const t=this._getCallReceiveCatastrophic(e);return c.log(l.LogTraceArea.Calling,`isCallCatastrophic: connectionState=${t}`),t===r.NetworkConnectionState.Connecting||t===r.NetworkConnectionState.LostConnection}_getCallReceivedQualityState(e){if(e in this._receiveQuality)return this._receiveQuality[e]}_getCallReceiveCatastrophic(e){if(e in this._receiveCatastrophic)return this._receiveCatastrophic[e]}test_listenStartAndStopCallEvents(){this._listenStartAndStopCallEvents()}_listenStartAndStopCallEvents(){s.default.CallingStore.callCreatedEvent().subscribe(this._startWatchingForNetworkConnectionChanges),s.default.CallingStore.callEndedEvent().subscribe(this._stopWatchingForNetworkConnectionChanges)}};t.CallNetworkConnectionStore=u,o.__decorate([n.autoSubscribe,o.__param(0,n.key)],u.prototype,"getCallReconnectionState",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],u.prototype,"isCallQualityPoor",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],u.prototype,"isCallCatastrophic",null),o.__decorate([n.disableWarnings],u.prototype,"_listenStartAndStopCallEvents",null),t.CallNetworkConnectionStore=u=o.__decorate([n.AutoSubscribeStore],u)},854929:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=i(167606),r=o.__importStar(i(85385)),l=o.__importStar(i(437782));let c=class extends n.StoreBase{constructor(){super(...arguments),this._pinnedParticipants={}}pinParticipant(e,t){r.log(s.LogTraceArea.CallingUI,"Pinning participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]||(this._pinnedParticipants[t]=[]),this._pinnedParticipants[t].push(e),this.trigger(t)}unpinParticipant(e,t){r.log(s.LogTraceArea.CallingUI,"Trying to unpin participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]&&(a.pull(this._pinnedParticipants[t],e),this.trigger(t))}cleanupPinnedParticipants(e){r.log(s.LogTraceArea.CallingUI,"Cleaning up the call participants for a call "+e),delete this._pinnedParticipants[e],this.trigger(e)}getPinnedParticipants(e){return this._pinnedParticipants[e]}isParticipantPinned(e,t){return a.includes(this._pinnedParticipants[t],e)}hasPinnedParticipants(e){return!a.isEmpty(this._pinnedParticipants[e])}};o.__decorate([n.autoSubscribe,o.__param(0,n.key)],c.prototype,"getPinnedParticipants",null),o.__decorate([n.autoSubscribe,o.__param(1,n.key)],c.prototype,"isParticipantPinned",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],c.prototype,"hasPinnedParticipants",null),c=o.__decorate([n.AutoSubscribeStore],c),t.default=new c},354676:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importStar(i(455275)),r=o.__importStar(i(44717)),l=i(783193),c=o.__importDefault(i(919682)),d=o.__importDefault(i(808164)),u=o.__importDefault(i(127336));let h=class extends n.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._phoneNumberSkypeCallRates={},this._lookups={},this._getPhoneNumberFromPhoneMri=e=>{const t=r.getPhoneNumberFromMri(e);return t?d.default.stripPlusSign(t):e},this._getPhoneNumberRates=e=>this._phoneNumberRates[e]&&this._phoneNumberRates[e][e]?this._phoneNumberRates[e][e]:void 0,this._getCallRateFundingSourceForPhoneNumber=e=>this._phoneNumberSkypeCallRates[e]&&this._phoneNumberSkypeCallRates[e][e]?this._phoneNumberSkypeCallRates[e][e].callFundedBy:void 0,this._getCallRateDestinationCountry=e=>this._phoneNumberSkypeCallRates[e]&&this._phoneNumberSkypeCallRates[e][e]?this._phoneNumberSkypeCallRates[e][e].destinationCountry:void 0}_startedTrackingKey(e){const t=r.isMri(e)?this._getPhoneNumberFromPhoneMri(e):e;this._lookups[t]||(this._lookups[t]=c.default.getRates([t]).finally((()=>{delete this._lookups[t]})).then((i=>{const o={};a.transform(i,((e,t)=>{const i=s.compileCallRateLabel(t);i&&(e[t.pstnNumber]=i)}),o),this._phoneNumberRates[t]=o,this._phoneNumberSkypeCallRates[t]=i,this.trigger(e)})))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e],delete this._phoneNumberSkypeCallRates[e]}getCallRateByPhoneNumber(e){return this._getPhoneNumberRates(e)}getCallRateByMri(e){const t=this._getPhoneNumberFromPhoneMri(e);return this._getPhoneNumberRates(t)}isPhoneNumberEligibleForTaster(e){const t=this._getCallRateFundingSourceForPhoneNumber(e);return!!t&&t===l.CallRateFundingSource.TasterCall}getCallRateDestinationCountry(e){return this._getCallRateDestinationCountry(e)}isPhoneMriTollFree(e){const t=this._getPhoneNumberFromPhoneMri(e),i=this._getCallRateFundingSourceForPhoneNumber(t);return!!i&&i===l.CallRateFundingSource.FreeCall}getDestinationCallCountry(e){var t;if(!e)return;const i=this.getCallRateDestinationCountry(d.default.stripPlusSign(e)),o=u.default.getSmsRateByPhoneNumber(e);return(null===(t=null==o?void 0:o.fullRateInfo)||void 0===t?void 0:t.destinationCountry)||i}};o.__decorate([n.disableWarnings],h.prototype,"_startedTrackingKey",null),o.__decorate([n.disableWarnings],h.prototype,"_stoppedTrackingKey",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],h.prototype,"getCallRateByPhoneNumber",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],h.prototype,"getCallRateByMri",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],h.prototype,"isPhoneNumberEligibleForTaster",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],h.prototype,"getCallRateDestinationCountry",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],h.prototype,"isPhoneMriTollFree",null),o.__decorate([n.autoSubscribe],h.prototype,"getDestinationCallCountry",null),h=o.__decorate([n.AutoSubscribeStore],h),t.default=new h},306794:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=t.ReactionSentOver=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importStar(i(397691)),r=o.__importDefault(i(304623)),l=o.__importStar(i(971988)),c=i(815146),d=o.__importStar(i(85385)),u=o.__importDefault(i(363091)),h=o.__importDefault(i(597285)),p=o.__importStar(i(437782)),g=o.__importDefault(i(997226)),C=o.__importStar(i(446574)),m=o.__importDefault(i(150343)),S=o.__importDefault(i(369347)),_=o.__importStar(i(413591)),f=o.__importDefault(i(638260)),y=o.__importDefault(i(760989)),T=o.__importStar(i(44717)),b=i(123117),v=i(572095);var I,w;!function(e){e.ChatService="chats",e.DataChannel="dataChannel"}(I||(t.ReactionSentOver=I={})),function(e){e[e.EventReactions=0]="EventReactions"}(w||(t.TriggerKeys=w={}));let P=class extends n.StoreBase{constructor(){super(),this._reactionGroups={},this._outerToInnerThreadMap={},this._isAnimationPlaying=!1,this._dataChannelSupportEnabledForCall={},C.RegisterStartupable(this,"CallReactionsStore",[r.default])}startup(){return s.Resolved()}dispose(){this._messagesUpdatedSubscriptionToken&&(this._messagesUpdatedSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken=void 0),this._reactionsSubscriptionToken&&(this._reactionsSubscriptionToken.unsubscribe(),this._reactionsSubscriptionToken=void 0)}_startedTrackingKey(e){this.startTracking(e)}_stoppedTrackingKey(e){this.stopTracking(e)}startTracking(e){const t=T.getReactionsThreadMriForCallId(e),i=S.default.CallingStore.currentCallId(e);d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [startTracking] reactionsConversationMri: ${p.mriOrId(t)}, callId: ${e}, baseCallId: ${i}`),this._reactionGroups[i]||(this._reactionGroups[i]=this._newCallReactionsGroup()),m.default.getS4LCMCFeaturesNoSubscription().dataChannelReactions.enableDataChannel&&(this._logDataChannelReactionsSupport(i),this._dataChannelSupportEnabledForCall[i]=!0),this._reactionsSubscriptionToken||(this._reactionsSubscriptionToken=S.default.ReactionsDataChannelService.reactionReceivedEvent().subscribe((e=>{var t;const i=S.default.CallingStore.currentCallId(e.callId);if(!this._dataChannelSupportEnabledForCall[i])return;const o=null!==(t=S.default.CallingStore.getCallConversationMri(i))&&void 0!==t?t:e.conversationId,a=S.default.CallingStore.getCallIdsForConversationMri(o);e.conversationId=o;const n=!!i&&!!this._reactionGroups[i];if(d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [startTracking] datachannel message received. willProcess=${n}, callId=${e.callId}, convCallId=${i}, conversation=${p.mriOrId(o)}, cuid=${e.clientmessageid}, messagetype=${e.messagetype}, reactionGroupExists=${!!this._reactionGroups[i]}`),n){const t=Object.assign(Object.assign({},e),{composetime:new Date(e.createdTime).toISOString()}),o=g.default.fromFirstLie(t,e.conversationId,e.userId,e.createdTime,!1,!0);this._putReactions(i,[o],I.DataChannel)&&this.trigger(a)}}))),this._messagesUpdatedSubscriptionToken||(b.MessagesRepository.getMessagesInConversation(t).then((e=>{const i=S.default.CallingStore.getCallIdsForConversationMri(t),o=(null==i?void 0:i.length)?S.default.CallingStore.currentCallId(i[0]):void 0;e.length&&o&&this._reactionGroups[o]&&this._putReactions(o,e,I.ChatService)&&this.trigger(i)})),this._messagesUpdatedSubscriptionToken=r.default.messagesProcessed.subscribe((e=>{const t=a.filter(e,(e=>{const t=e.conversationId,i=this._getOuterThreadMri(t);if(!i)return d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [startTracking] chat service message received. unable to find outer conversation reactionConversation=${p.mriOrId(e.conversationId)}, cuid=${e.cuid}, messagetype=${e.messagetype}`),!1;const o=S.default.CallingStore.getCallIdsForConversationMri(i),a=(null==o?void 0:o.length)?S.default.CallingStore.currentCallId(o[0]):void 0;if(!e.isCallReaction()&&a&&this._reactionGroups[a]&&this._reactionGroups[a].chatIsOpen)return d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [startTracking] chat service message from outer thread received. ignoring because chat is open. reactionConversation=${p.mriOrId(e.conversationId)}, cuid=${e.cuid}, messagetype=${e.messagetype}`),!1;const n=!!a&&!!this._reactionGroups[a];return d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [startTracking] chat service message received. willProcess=${n}, reactionConversation=${p.mriOrId(e.conversationId)}, callId=${a}, cuid=${e.cuid}, messagetype=${e.messagetype}`),n})),i=a.groupBy(t,(e=>e.conversationId));a.each(i,((e,t)=>{const i=this._getOuterThreadMri(t),o=this._isOuterThreadMri(t);if(i){const t=S.default.CallingStore.getCallIdsForConversationMri(i),a=(null==t?void 0:t.length)?S.default.CallingStore.currentCallId(t[0]):void 0;a&&this._putReactions(a,e,I.ChatService,o)&&this.trigger(t)}}))})))}stopTracking(e){const t=S.default.CallingStore.currentCallId(e);d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [stopTracking] callId: ${e}, baseCallId: ${t}`),this._logReactionsDeliverySuccessRate(t,!0),this._logCaptionsDeliverySuccessRate(t,!0),this._dataChannelSupportEnabledForCall[t]&&delete this._dataChannelSupportEnabledForCall[t]}assignOuterThread(e,t){d.log(c.LogTraceArea.CallReactions,"[CallReactionsStore] [assignOuterThread] outerThreadMri: "+p.mriOrId(t)+" innerThreadMri: "+p.mriOrId(e)),Object.entries(this._outerToInnerThreadMap).forEach((([t,i])=>{i.includes(e)&&i.splice(i.indexOf(e),1)})),this._outerToInnerThreadMap[t]||(this._outerToInnerThreadMap[t]=[]),a.includes(this._outerToInnerThreadMap[t],e)||this._outerToInnerThreadMap[t].push(e)}clearOuterThreadAssignment(e,t){d.log(c.LogTraceArea.CallReactions,"[CallReactionsStore] [clearOuterThreadAssignment] outerThreadMri: "+p.mriOrId(t)+" innerThreadMri: "+p.mriOrId(e)),this._clearOuterThreadAssignment(e,t)}setChatIsOpen(e,t){const i=S.default.CallingStore.currentCallId(e),o=this._reactionGroups[i];o&&(o.chatIsOpen=t)}setReactionPressedScenario(e){this._reactionPressedScenario=e}maybeGetAndClearReactionPressedScenario(){const e=this._reactionPressedScenario;return this._reactionPressedScenario=void 0,e}setHasPostedReactions(e,t){const i=S.default.CallingStore.currentCallId(e),o=this._reactionGroups[i];o&&o.hasPostedReactions!==t&&(o.hasPostedReactions=t,t&&this.trigger(e))}getUnseenIncomingTextCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];return i?i.unseenIncomingTextCount:0}resetUnSeenIncomingTextCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];i&&(i.unseenIncomingTextCount=0),this.trigger(e)}getUnseenIncomingPhotoCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];return i?i.unseenIncomingPhotoCount:0}resetUnSeenIncomingPhotoCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];i&&(i.unseenIncomingPhotoCount=0),this.trigger(e)}markOneIncomingPhotoSeen(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];i&&i.unseenIncomingPhotoCount>0&&i.unseenIncomingPhotoCount--,this.trigger(e)}getUnseenIncomingTranscriptionCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];return i?i.unseenIncomingTranscriptionCount:0}resetUnseenIncomingTranscriptionCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];i&&(i.unseenIncomingTranscriptionCount=0),this.trigger(e)}getUnseenIncomingEventsCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];return i?i.unseenIncomingEventsCount:0}resetUnseenIncomingEventsCount(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];i&&(i.unseenIncomingEventsCount=0),this.trigger(e)}hasPostedReactions(e){const t=S.default.CallingStore.currentCallId(e),i=this._reactionGroups[t];return!!i&&i.hasPostedReactions}getReactions(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);return o&&o.allReactions.length?a.filter(o.allReactions,((e,i)=>e.createdTime>t&&!e.isEmoticonCallReaction())):[]}getTextReactions(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);return o&&o.textReactions.length?t>0?a.filter(o.textReactions,((e,i)=>e.createdTime>t)):o.textReactions:[]}getLastReaction(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);if(!o||!o.textReactions.length)return;const n=a.last(o.textReactions);return n&&n.createdTime>t?n:void 0}getPictureReactions(e,t=0,i=!1){const o=S.default.CallingStore.currentCallId(e),n=this._reactionsInfoForCallId(o);return n&&n.photoReactions.length?t>0||i?a.filter(n.photoReactions,((e,o)=>!(e.createdTime<=t)&&(!i||e.isCallReaction()))):n.photoReactions:[]}getLastTranscriptionReaction(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);if(!o||!o.transcriptionReactions.length)return;const n=a.last(o.transcriptionReactions);return n&&n.createdTime>t?n:void 0}getLastTranscriptionReactions(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);if(!o||!o.transcriptionReactions.length)return[];return a.filter(o.transcriptionReactions,(e=>e.createdTime>t))}getEventsReaction(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);return o&&o.eventReactions.length?t>0?a.filter(o.eventReactions,((e,i)=>e.createdTime>t)):o.eventReactions:[]}getLastEventReaction(e,t=0){const i=S.default.CallingStore.currentCallId(e),o=this._reactionsInfoForCallId(i);if(!o||!o.eventReactions.length)return;const n=a.last(o.eventReactions);return n&&n.createdTime>t?n:void 0}_clearOuterThreadAssignment(e,t){if(this._outerToInnerThreadMap[t]){const i=this._outerToInnerThreadMap[t];a.remove(i,(t=>t===e)),a.isEmpty(i)&&delete this._outerToInnerThreadMap[t]}}_getOuterThreadMri(e){for(const t in this._outerToInnerThreadMap)if(Object.hasOwnProperty.call(this._outerToInnerThreadMap,t)){if(e===t)return t;if(a.includes(this._outerToInnerThreadMap[t],e))return t}}_isOuterThreadMri(e){for(const t in this._outerToInnerThreadMap)if(Object.hasOwnProperty.call(this._outerToInnerThreadMap,t)&&e===t)return!0;return!1}_putReactions(e,t,i,o=!1){const n=this._reactionGroups[e];if(!n)return!1;let s=!1;return a.each(t,(t=>{if(!(l.isCaptionMessageType(t.messagetype)&&!(0,v.isValidTranscriptionMessage)(e,t))){if(o||this._countDelivery(e,t,i),t.isDeletedMessage())n.callReactionsInfo.allReactions=a.filter(n.callReactionsInfo.allReactions,(e=>e.cuid!==t.cuid)),n.callReactionsInfo.photoReactions=a.filter(n.callReactionsInfo.photoReactions,(e=>e.cuid!==t.cuid)),n.callReactionsInfo.textReactions=a.filter(n.callReactionsInfo.textReactions,(e=>e.cuid!==t.cuid)),n.callReactionsInfo.transcriptionReactions=a.filter(n.callReactionsInfo.transcriptionReactions,(e=>e.cuid!==t.cuid)),n.callReactionsInfo.eventReactions=a.filter(n.callReactionsInfo.eventReactions,(e=>e.cuid!==t.cuid));else{if(this._maybeUpdateReactionMessage(t,e))return;if(l.getMessageTypeGroup(t)===l.MessageTypeGroups.Picture)n.callReactionsInfo.photoReactions.push(t),u.default.isMyMri(t.creator)||n.unseenIncomingPhotoCount++;else{if(l.getMessageTypeGroup(t)!==l.MessageTypeGroups.Text)return;l.isCaptionMessageType(t.messagetype)?(n.callReactionsInfo.transcriptionReactions.push(t),n.unseenIncomingTranscriptionCount++):h.default.isCallEventReaction(t)?(n.callReactionsInfo.eventReactions.push(t),n.unseenIncomingEventsCount++):(n.callReactionsInfo.textReactions.push(t),t.isEmoticonCallReaction()||n.unseenIncomingTextCount++)}n.callReactionsInfo.allReactions.push(t)}s=!0}})),d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [_putReactions] triggering=${s}, callId: ${e}, unseenIncomingPhotoCount: ${n.unseenIncomingPhotoCount} unseenIncomingTextCount: ${n.unseenIncomingTextCount}`),s}setAnimationIsPlaying(e){this._isAnimationPlaying=e}isAnimationPlaying(){return this._isAnimationPlaying}_maybeUpdateReactionMessage(e,t){const i=this._reactionsInfoForCallId(t);return!!i&&(!!this._replaceReactionMessage(e,i.allReactions)&&(l.getMessageTypeGroup(e)===l.MessageTypeGroups.Picture?this._replaceReactionMessage(e,i.photoReactions):l.getMessageTypeGroup(e)===l.MessageTypeGroups.Text&&(l.isCaptionMessageType(e.messagetype)?this._replaceReactionMessage(e,i.transcriptionReactions):h.default.isCallEventReaction(e)?this._replaceReactionMessage(e,i.eventReactions):this._replaceReactionMessage(e,i.textReactions)),!0))}_replaceReactionMessage(e,t){const i=a.findIndex(t,(t=>t.cuid===e.cuid));return i>=0&&(t.splice(i,1,e),!0)}_countDelivery(e,t,i){const o=S.default.CallingStore.findRemoteCallMemberNoSubscription(e,t.creator),a=_.participantSupportsDataChannelReactions(o),n=m.default.getS4LCMCFeaturesNoSubscription().dataChannelReactions,s=u.default.isMyMri(t.creator),r=n.enableDataChannel,h=(a||s)&&!l.isCaptionMessageType(t.messagetype),g=!!l.isCaptionMessageType(t.messagetype)&&n.enableCaptions,C=!t.isDeletedMessage()&&(l.getMessageTypeGroup(t)===l.MessageTypeGroups.Picture||l.getMessageTypeGroup(t)===l.MessageTypeGroups.Text);if(r&&(h||g)&&t.isCallReaction()&&C){const r=this._reactionGroups[e];if(g){if(r.receivedCaptionsOverCounter[t.cuid]?r.receivedCaptionsOverCounter[t.cuid][i]||(r.receivedCaptionsOverCounter[t.cuid][i]=Date.now()):r.receivedCaptionsOverCounter[t.cuid]={[i]:Date.now()},this._logCaptionsDeliverySuccessRate(e),n.logCaptionsCounts){const a=(null==o?void 0:o.id)?p.mriOrId(null==o?void 0:o.id):"unknown";d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [_countDelivery] Caption message, callId: ${e}, type: ${t.messagetype}, isMe: ${s}, sentOver: ${i}, CUID: ${t.cuid}, creator: ${p.mriOrId(t.creator)}), participant: ${a}, createdTime: ${t.createdTime}}`)}}else r.receivedReactionsOverCounter[t.cuid]?r.receivedReactionsOverCounter[t.cuid][i]||(r.receivedReactionsOverCounter[t.cuid][i]=Date.now()):r.receivedReactionsOverCounter[t.cuid]={[i]:Date.now()},this._logReactionsDeliverySuccessRate(e),n.logReactionsCounts&&d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [_countDelivery] Reaction message, callId: ${e}, type: ${t.messagetype}, isMe: ${s}, sentOver: ${i}, CUID: ${t.cuid}, creator: ${p.mriOrId(t.creator)}), participant: ${null==o?void 0:o.id}, senderSupportsDataChannel: ${a}, createdTime: ${t.createdTime}}`)}}_logReactionsDeliverySuccessRate(e,t=!1){const i=this._reactionGroups[e].receivedReactionsOverCounter;let o=0,a=0,n=0;const s=[];Object.entries(i).forEach((([e,t])=>{o++,i[e][I.DataChannel]&&a++,i[e][I.ChatService]&&n++,i[e][I.DataChannel]&&i[e][I.ChatService]&&s.push(i[e][I.DataChannel]-i[e][I.ChatService])}));const r=y.default.newCauseId(),l=s.length>0?s.reduce(((e,t)=>e+t),0)/s.length:0;if(f.default.updateCallTelemetry(e,r,(e=>e.setDataChannelReactionsMessageSuccessRate(a,o,l))),m.default.getS4LCMCFeaturesNoSubscription().dataChannelReactions.logReactionsCounts&&t){const t=o===a?"NO":"MISMATCH";d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [_logReactionsDeliverySuccessRate] callId: ${e}, mismatch: ${t}, total: ${o}, dataChannelDeliveredCount: ${a} chatServiceDeliveredCount: ${n}`)}}_logCaptionsDeliverySuccessRate(e,t=!1){const i=this._reactionGroups[e].receivedCaptionsOverCounter;let o=0,a=0,n=0;const s=[];Object.entries(i).forEach((([e,t])=>{o++,i[e][I.DataChannel]&&a++,i[e][I.ChatService]&&n++,i[e][I.DataChannel]&&i[e][I.ChatService]&&s.push(i[e][I.DataChannel]-i[e][I.ChatService])}));const r=s.length>0?s.reduce(((e,t)=>e+t),0)/s.length:0,l=y.default.newCauseId();if(f.default.updateCallTelemetry(e,l,(e=>e.setDataChannelCaptionsMessageSuccessRate(a,o,r))),m.default.getS4LCMCFeaturesNoSubscription().dataChannelReactions.logCaptionsCounts&&t){const t=o===a?"NO":"MISMATCH";d.log(c.LogTraceArea.CallReactions,`[CallReactionsStore] [_logCaptionsDeliverySuccessRate] callId: ${e}, mismatch: ${t}, total: ${o}, dataChannelDeliveredCount: ${a} chatServiceDeliveredCount: ${n}`)}}_logDataChannelReactionsSupport(e){const t=y.default.newCauseId(),i=m.default.getS4LCMCFeaturesNoSubscription().dataChannelReactions;f.default.updateCallTelemetry(e,t,(e=>e.setDataChannelReactionsSupport(!0,i.enableCaptions,i.doNotSendReactionsViaChat,i.doNotSendCaptionsViaChat)))}_newCallReactionsGroup(){return{callReactionsInfo:{allReactions:[],photoReactions:[],textReactions:[],transcriptionReactions:[],eventReactions:[]},unseenIncomingPhotoCount:0,unseenIncomingTextCount:0,unseenIncomingTranscriptionCount:0,unseenIncomingEventsCount:0,hasPostedReactions:!1,chatIsOpen:!1,receivedReactionsOverCounter:{},receivedCaptionsOverCounter:{}}}_reactionsInfoForCallId(e){const t=this._reactionGroups[e];if(t&&t.callReactionsInfo)return t.callReactionsInfo}test_putReactions(e,t,i,o=!1){return this._putReactions(e,t,i,o)}test_reset(){this._reactionGroups={},this._outerToInnerThreadMap={}}};o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getUnseenIncomingTextCount",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getUnseenIncomingPhotoCount",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getUnseenIncomingTranscriptionCount",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getUnseenIncomingEventsCount",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"hasPostedReactions",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getReactions",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getTextReactions",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getLastReaction",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getPictureReactions",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getLastTranscriptionReaction",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getLastTranscriptionReactions",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getEventsReaction",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],P.prototype,"getLastEventReaction",null),o.__decorate([n.autoSubscribe],P.prototype,"isAnimationPlaying",null),P=o.__decorate([n.AutoSubscribeStore],P),t.default=new P},840709:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecordingViewShowStatus=void 0;const o=i(197582),a=i(217041);var n,s;!function(e){e[e.RecordingView=0]="RecordingView"}(n||(n={})),function(e){e[e.Dismissed=0]="Dismissed",e[e.TriggeredByDefault=1]="TriggeredByDefault",e[e.TriggeredFromHeader=2]="TriggeredFromHeader"}(s||(t.RecordingViewShowStatus=s={}));let r=class extends a.StoreBase{constructor(){super(...arguments),this._callRecordingViewShowStatus={viewStatus:s.TriggeredByDefault,callId:""}}getCallRecordingViewShowStatus(e){return this._callRecordingViewShowStatus.callId===e?this._callRecordingViewShowStatus.viewStatus:s.TriggeredByDefault}setCallRecordingViewShowStatus(e,t){this._callRecordingViewShowStatus={viewStatus:e,callId:t},this.trigger(n.RecordingView)}};o.__decorate([(0,a.autoSubscribeWithKey)(n.RecordingView)],r.prototype,"getCallRecordingViewShowStatus",null),r=o.__decorate([a.AutoSubscribeStore],r),t.default=new r},916256:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallScreenElementsStore=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(148540),s=i(174958),r=i(217041),l=o.__importDefault(i(150343)),c=o.__importStar(i(85385)),d=o.__importDefault(i(369347)),u=o.__importDefault(i(947878)),h=i(460515),p=i(815146),g=o.__importDefault(i(114818)),C=i(618702),m=o.__importStar(i(619429)),S=o.__importDefault(i(760989)),_=o.__importDefault(i(854929));let f=class extends r.StoreBase{constructor(){super(...arguments),this._statePerCallId=new Map}_startedTrackingKey(e){c.log(p.LogTraceArea.CallingUI,`CallScreenElementsStore._startedTrackingKey: callId ${e}`);const t={remoteCallElements:new Map,stageElements:[],trayElements:[],stageCapacity:Number.MAX_VALUE,trayMainAxisSize:Number.MAX_VALUE,trayRemainder:0,trayItemSizeMultiplier:1,trayItemsCompact:!1,layoutStoreSubscription:u.default.subscribe((()=>this._onLayoutStoreUpdate(e)),e),callParticipantsStoreSubscription:d.default.CallParticipantStore.subscribe((()=>this._onParticipantsChanged(e)),e),callPinningStoreSubscription:_.default.subscribe((()=>this._onParticipantsChanged(e)),e)};this._statePerCallId.set(e,t),this._onLayoutStoreUpdate(e),this._onParticipantsChanged(e)}_stoppedTrackingKey(e){const t=S.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore cleaning up subscriptions for call "+e+" causeId: "+t),this._cleanupFullscreenBotStreamOverrides(e,t);const i=this._getCallScreenElementsStateFor(e);i&&(u.default.unsubscribe(i.layoutStoreSubscription),d.default.CallParticipantStore.unsubscribe(i.callParticipantsStoreSubscription),_.default.unsubscribe(i.callPinningStoreSubscription),this._statePerCallId.delete(e))}_getCallScreenElementsStateFor(e){return this._statePerCallId.get(e)}_onLayoutStoreUpdate(e){var t;const i=u.default.getStageMode(e),o=S.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore._onLayoutStoreUpdate: callId "+e+" stageMode: "+h.StageMode[i]+" causeId: "+o),this._cleanupFullscreenBotStreamOverrides(e,o);const a=this._getCallScreenElementsStateFor(e);a&&(a.manager=this._getStageModeManager(e,i,o),this._updateScreenElements(e,null===(t=a.manager)||void 0===t?void 0:t.onInit(this._getCallParticipantsMris(e)),o))}_cleanupFullscreenBotStreamOverrides(e,t){var i;null===(i=d.default.CallingStore.getVideoOverrides(e))||void 0===i||i.clearRemoteStreamOverride(m.VideoOverrideReason.FullScreenBot)}_registerFullscreenBotStreamOverrides(e,t){var i;null===(i=d.default.CallingStore.getVideoOverrides(e))||void 0===i||i.setRemoteStreamOverride(m.VideoOverrideReason.FullScreenBot)}_updateScreenElements(e,t,i){t&&(this._setStageParticipants(e,t.stageParticipants),this._setTrayParticipants(e,t.trayParticipants),this._setTrayRemainder(e,t.trayRemainder||0))}_getStageModeManager(e,t,i){const o=this._getCallScreenElementsStateFor(e);if(o)switch(t){case h.StageMode.Grid:case h.StageMode.Manual:return new C.GridModeElementsManager(e,o.trayMainAxisSize,o.trayItemSizeMultiplier,o.trayItemsCompact,o.stageCapacity,u.default.getOnlyVideoOnTheStage(e),u.default.getSelfInTheGrid(e));case h.StageMode.Speaker:return new C.SpeakerModeElementsManager(e,o.trayMainAxisSize,o.trayItemSizeMultiplier,o.trayItemsCompact);case h.StageMode.Presentation:case h.StageMode.FocusedScreenShare:return new C.PresentationModeElementsManager(e,o.trayMainAxisSize,o.trayItemSizeMultiplier,o.trayItemsCompact);case h.StageMode.LargeGrid:return this._registerFullscreenBotStreamOverrides(e,i),new C.LgTmModeElementsManager(e,o.trayMainAxisSize,o.trayItemSizeMultiplier,o.trayItemsCompact,C.FullScreenBotType.LargeGrid);case h.StageMode.TogetherMode:return this._registerFullscreenBotStreamOverrides(e,i),new C.LgTmModeElementsManager(e,o.trayMainAxisSize,o.trayItemSizeMultiplier,o.trayItemsCompact,C.FullScreenBotType.TogetherMode)}else c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._getStageModeManager call id '${e}' is undefined`)}_onParticipantsChanged(e){var t;const i=S.default.newCauseId(),o=this._getCallScreenElementsStateFor(e);if(!o)return void c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._onParticipantsChanged call id '${e}' is undefined`);const s=[...this._getRemoteCallElements(e).keys()],r=d.default.CallParticipantStore.getParticipantRenderInfosForCall(e),l=[];r.forEach((e=>{o.remoteCallElements.set(e.renderKey,{mri:e.mri,renderKey:e.renderKey,participantState:e.state||n.ParticipantState.None,isScreenShare:e.isScreenSharing}),l.push(e.renderKey)}));const u=a.difference(s,l);a.each(u,(e=>{o.remoteCallElements.delete(e)})),this._updateScreenElements(e,null===(t=o.manager)||void 0===t?void 0:t.updateParticipants(this._getCallParticipantsMris(e)),i)}_setStageParticipants(e,t){const i=this._getCallScreenElementsStateFor(e);i?(0,g.default)(i.stageElements,t)||(c.log(p.LogTraceArea.CallingUI,"Stage participants for callId "+e+" updated. New stage elements: "+s.pii.Omit(t.toString())),i.stageElements=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setStageParticipants call id '${e}' is undefined`)}_setTrayParticipants(e,t){const i=this._getCallScreenElementsStateFor(e);i?a.xor(i.trayElements,t).length&&(c.log(p.LogTraceArea.CallingUI,"Tray participants for callId "+e+" updated. New tray elements: "+s.pii.Omit(t.toString())),i.trayElements=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setTrayParticipants call id '${e}' is undefined`)}_getCallParticipantsMris(e){const t=this._getCallScreenElementsStateFor(e);return t?l.default.getS4LCMCFeatures().enableMultipleStreamSupport?a.uniq(Array.from(t.remoteCallElements.values()).map((e=>e.renderKey||e.mri))):Array.from(t.remoteCallElements.keys()):(c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._getCallParticipantsMris call id '${e}' is undefined`),[])}_setTrayRemainder(e,t){const i=this._getCallScreenElementsStateFor(e);i?i.trayRemainder!==t&&(i.trayRemainder=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setTrayRemainder call id '${e}' is undefined`)}_getRemoteCallElements(e){var t,i;return a.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.remoteCallElements)&&void 0!==i?i:new Map)}getStageElements(e){var t,i;return a.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.stageElements)&&void 0!==i?i:[])}getTrayElements(e){var t,i;return a.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayElements)&&void 0!==i?i:[])}getTrayRemainder(e){var t,i;return null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayRemainder)&&void 0!==i?i:0}trayHasParticipants(e){var t,i,o;return(null!==(o=null===(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayElements)||void 0===i?void 0:i.length)&&void 0!==o?o:0)>0}setStageCapacity(e,t){const i=this._getCallScreenElementsStateFor(e);if(!i)return void c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore.setStageCapacity call id '${e}' is undefined`);const{manager:o}=i;if(o&&o instanceof C.GridModeElementsManager&&i.stageCapacity!==t){i.stageCapacity=t;const a=this._getCallParticipantsMris(e),n=S.default.newCauseId();this._updateScreenElements(e,o.updateStageCapacity(a,i.stageCapacity),n),this.trigger(e)}}getStageCapacity(e){var t,i;return null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.stageCapacity)&&void 0!==i?i:0}setTrayParameters(e,t,i=1,o=!1){var a;const n=this._getCallScreenElementsStateFor(e);if(n){if(n.trayMainAxisSize!==t&&0!==t){n.trayMainAxisSize=t,n.trayItemSizeMultiplier=i,n.trayItemsCompact=o;const s=this._getCallParticipantsMris(e),r=S.default.newCauseId();this._updateScreenElements(e,null===(a=n.manager)||void 0===a?void 0:a.setTrayParameters(t,s,i,o),r)}}else c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore.setTrayParameters call id '${e}' is undefined`)}getRemoteCallElements(e,t=!1){return t&&this._onParticipantsChanged(e),this._getRemoteCallElements(e)}};t.CallScreenElementsStore=f,o.__decorate([r.disableWarnings],f.prototype,"_startedTrackingKey",null),o.__decorate([r.disableWarnings],f.prototype,"_stoppedTrackingKey",null),o.__decorate([r.autoSubscribe,o.__param(0,r.key)],f.prototype,"getStageElements",null),o.__decorate([r.autoSubscribe,o.__param(0,r.key)],f.prototype,"getTrayElements",null),o.__decorate([r.autoSubscribe,o.__param(0,r.key)],f.prototype,"getTrayRemainder",null),o.__decorate([r.autoSubscribe,o.__param(0,r.key)],f.prototype,"trayHasParticipants",null),o.__decorate([r.autoSubscribe,o.__param(0,r.key)],f.prototype,"getStageCapacity",null),o.__decorate([o.__param(0,r.key)],f.prototype,"getRemoteCallElements",null),t.CallScreenElementsStore=f=o.__decorate([r.AutoSubscribeStore],f),t.default=new f},947878:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importDefault(i(150343)),r=o.__importDefault(i(369347)),l=i(873324),c=i(460515),d=o.__importDefault(i(132680)),u=i(815146),h=o.__importStar(i(85385)),p=o.__importDefault(i(942724)),g=o.__importStar(i(446574)),C=o.__importDefault(i(760989)),m=c.StageMode.Grid;let S=class extends n.StoreBase{constructor(){super(),this._stageLayoutMode={},this._fallbackStageLayoutMode={},this._callHeaderLayoutMode={},this._fallbackCallHeaderLayoutMode={},this._onlyVideoOnTheStage={},this._selfInTheGrid={},this._hideTopTray={},this._hasStartedHideControlsTimer={},this._callScreenshareStoreSubscriptions={},this._callCallingStoreSubscriptions={},this._wasFullScreenBotAutoTriggered={},g.RegisterStartupable(this,"CallStageLayoutStore")}startup(){return Promise.resolve()}onStartTrackingCall(e,t,i){this._setDefaultHeaderLayoutMode(e,t),this._setDefaultSelfInTheGrid(t,e),this.setStageMode(e,m,i,!0),this._subscribeToScreenshareStore(e),this._subscribeForFullScreenBots(e,t)}onStopTrackingCall(e){this._cleanUpStageLayoutSettings(e),this._unsubscribeFromScreenshareStore(e),this._unsubscribeForFullScreenBots(e)}_subscribeForFullScreenBots(e,t){this._callCallingStoreSubscriptions[e]||(this._callCallingStoreSubscriptions[e]=r.default.CallingStore.subscribe((()=>this._onCallingStoreChanged(e,t)),e))}_unsubscribeForFullScreenBots(e){this._callCallingStoreSubscriptions[e]&&(r.default.CallingStore.unsubscribe(this._callCallingStoreSubscriptions[e]),delete this._callCallingStoreSubscriptions[e],delete this._wasFullScreenBotAutoTriggered[e])}_onCallingStoreChanged(e,t){const i=C.default.newCauseId();if(r.default.CallingStore.isConnectedAudienceBotInCall(e)&&!this._wasFullScreenBotAutoTriggered[e]){h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._onCallingStoreChanged with audience bot,\n                causeId: ${i}`),this._wasFullScreenBotAutoTriggered[e]=!0;const t=c.StageMode.TogetherMode;this._setFallbackStageMode(e,i,t),r.default.CallScreenShareStore.hasIncomingScreensharing(e)||(this._setStageMode(e,t,i,!0),this._setFallbackHeaderLayoutMode(e,i),this._setCallHeaderLayoutMode(e,c.CallPanelHeaderLayout.Window,i))}else if(!r.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(e)&&this._wasFullScreenBotAutoTriggered[e]){h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._onCallingStoreChanged audience bot disconnected,\n                causeId: ${i}`),this._wasFullScreenBotAutoTriggered[e]=!1;const o=this._getStageMode(e);d.default.isTogetherMode(o)?(this._setDefaultHeaderLayoutMode(e,t),this.setStageMode(e,m,i,!0)):d.default.isInIncomingScreenshareMode(o)&&this._setFallbackStageMode(e,i,m)}}_subscribeToScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]||(this._callScreenshareStoreSubscriptions[e]=r.default.CallScreenShareStore.subscribe((()=>this._onScreensharingChanged(e)),e))}_unsubscribeFromScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]&&(r.default.CallScreenShareStore.unsubscribe(this._callScreenshareStoreSubscriptions[e]),delete this._callScreenshareStoreSubscriptions[e])}_onScreensharingChanged(e){const t=C.default.newCauseId();h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._onScreensharingChanged, causeId: ${t}`),r.default.CallScreenShareStore.hasIncomingScreensharing(e)?this._applyScreensharingSettings(e,t):this._applyFallbackSettings(e,t)}_applyScreensharingSettings(e,t){this._setFallbackStageMode(e,t);const i=d.default.getScreensharingMode();this._setStageMode(e,i,t,!0),this._setFallbackHeaderLayoutMode(e,t),this._setCallHeaderLayoutMode(e,c.CallPanelHeaderLayout.Window,t)}_applyFallbackSettings(e,t){d.default.isInIncomingScreenshareMode(this._getStageMode(e))&&this._resetStageModeToFallback(e,t),this._resetHeaderModeToFallback(e)}getStageMode(e){return this._getStageMode(e)}_getStageMode(e){return a.isUndefined(this._stageLayoutMode[e])?m:this._stageLayoutMode[e]}setStageMode(e,t,i,o){this._setStageMode(e,t,i,o),a.isUndefined(this._fallbackStageLayoutMode[e])||delete this._fallbackStageLayoutMode[e]}getAvailableStageModes(e){const t=s.default.getS4LCMCFeatures(),i=[c.StageMode.Grid],o=r.default.CallingStore.isOneOnOneCall(e);r.default.CallScreenShareStore.hasIncomingScreensharing(e)?i.push(d.default.getScreensharingMode()):o||i.push(c.StageMode.Speaker);const a=r.default.CallingStore.isPSTNCall(e),n=r.default.CallingStore.isEncryptedCall(e);if(a||n)return i;return(o?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(c.StageMode.TogetherMode),!o&&t.callGridViewBotConfig.enabled&&i.push(c.StageMode.LargeGrid),i}getAvailableStageModesV2(e){const t=s.default.getS4LCMCFeatures(),i=[],o=r.default.CallingStore.isOneOnOneCall(e);o||i.push(c.StageMode.Speaker),r.default.CallScreenShareStore.hasIncomingScreensharing(e)&&i.push(d.default.getScreensharingMode()),i.push(c.StageMode.Grid);const a=r.default.CallingStore.isPSTNCall(e),n=r.default.CallingStore.isEncryptedCall(e);if(a||n)return i;!o&&t.callGridViewBotConfig.enabled&&i.push(c.StageMode.LargeGrid);return(o?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(c.StageMode.TogetherMode),i}_setStageMode(e,t,i,o){const a=this._stageLayoutMode[e];if(a!==t){this._stageLayoutMode[e]=t,h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._setStageMode: call stage mode\n                changed from ${c.StageMode[a]} to ${c.StageMode[t]}, causeId: ${i}`);const n=this._getOnlyVideoOnTheStage(e);h.track(new l.CallStageLayoutChangeEvent(a,t,n,n,!0,!!o)),this.trigger(e)}}_cleanUpStageLayoutSettings(e){delete this._stageLayoutMode[e],delete this._fallbackStageLayoutMode[e],delete this._callHeaderLayoutMode[e],delete this._fallbackCallHeaderLayoutMode[e],delete this._onlyVideoOnTheStage[e],delete this._selfInTheGrid[e],delete this._hideTopTray[e],delete this._hasStartedHideControlsTimer[e]}_setFallbackStageMode(e,t,i){const o=a.isUndefined(i)?this._stageLayoutMode[e]:i;this._fallbackStageLayoutMode[e]===o||d.default.isInIncomingScreenshareMode(o)||(this._fallbackStageLayoutMode[e]=o,h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackStageMode: fallback call stage mode\n                set to ${c.StageMode[o]}, causeId: ${t}`))}_resetStageModeToFallback(e,t){const i=this._fallbackStageLayoutMode[e];a.isUndefined(i)?(h.log(u.LogTraceArea.Calling,"CallStageLayoutStore.resetStageModeToFallback: No fallback mode found for call id "+e+" causeId: "+t),this.setStageMode(e,m,t,!0)):(h.log(u.LogTraceArea.Calling,`CallStageLayoutStore.resetStageModeToFallback: set stage mode\n                to ${c.StageMode[i]} , causeId ${t}`),this.setStageMode(e,i,void 0,!0),delete this._fallbackStageLayoutMode[e])}getCallHeaderLayoutMode(e){return a.isUndefined(this._callHeaderLayoutMode[e])?this._getDefaultHeaderLayout(!0):this._callHeaderLayoutMode[e]}setCallHeaderLayoutMode(e,t,i){a.isUndefined(this._fallbackCallHeaderLayoutMode[e])||delete this._fallbackCallHeaderLayoutMode[e],this._setCallHeaderLayoutMode(e,t,i)}_setDefaultHeaderLayoutMode(e,t){this._setCallHeaderLayoutMode(e,this._getDefaultHeaderLayout(t))}_setCallHeaderLayoutMode(e,t,i){const o=this._callHeaderLayoutMode[e];o!==t&&(this._callHeaderLayoutMode[e]=t,h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._setCallHeaderLayoutMode: header layout mode\n                changed from ${c.CallPanelHeaderLayout[o]} to ${c.CallPanelHeaderLayout[t]},\n                causeId: ${i}`),this.trigger(e))}_setFallbackHeaderLayoutMode(e,t){const i=this._callHeaderLayoutMode[e];this._fallbackCallHeaderLayoutMode[e]!==i&&(this._fallbackCallHeaderLayoutMode[e]=i,h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackHeaderLayoutMode: fallback call header mode\n                set to ${c.CallPanelHeaderLayout[i]}, causeId: ${t}`))}_resetHeaderModeToFallback(e){const t=this._fallbackCallHeaderLayoutMode[e];a.isUndefined(t)?h.log(u.LogTraceArea.Calling,"No header fallback mode found for call id "+e):(h.log(u.LogTraceArea.Calling,`CallStageLayoutStore._resetHeaderModeToFallback: set header mode\n                to ${c.CallPanelHeaderLayout[t]}`),this.setCallHeaderLayoutMode(e,t),delete this._fallbackCallHeaderLayoutMode[e])}_getDefaultHeaderLayout(e){return p.default.isUsingStackNavigationContext()?c.CallPanelHeaderLayout.Mobile:e?c.CallPanelHeaderLayout.Window:c.CallPanelHeaderLayout.Float}getOnlyVideoOnTheStage(e){return this._getOnlyVideoOnTheStage(e)}_getOnlyVideoOnTheStage(e){return a.isUndefined(this._onlyVideoOnTheStage[e])?this._getDefaultOnlyVideoOnTheStage():this._onlyVideoOnTheStage[e]}_getDefaultOnlyVideoOnTheStage(){return!1}setOnlyVideoOnTheStage(e,t,i){const o=this._onlyVideoOnTheStage[e];if(o!==t){this._onlyVideoOnTheStage[e]=t,h.log(u.LogTraceArea.Calling,`CallStageLayoutStore.setOnlyVideoOnTheStage: onlyVideoOnTheStage changed from ${o} to ${t}, causeId: ${i}`);const a=this._getStageMode(e);h.track(new l.CallStageLayoutChangeEvent(a,a,o,t,!0,!1)),this.trigger(e)}}getSelfInTheGrid(e){return this._getSelfInTheGrid(e)}_getSelfInTheGrid(e){return!!a.isUndefined(this._selfInTheGrid[e])||this._selfInTheGrid[e]}_setDefaultSelfInTheGrid(e,t){this.setSelfInTheGrid(e,t)}setSelfInTheGrid(e,t){h.log(u.LogTraceArea.CallingUI,"Set local view on the stage to "+e),this._getSelfInTheGrid(t)!==e&&(this._selfInTheGrid[t]=e,this.trigger(t))}isTopTrayHidden(e){return!!this._hideTopTray[e]}setHideTopTray(e,t){this._hideTopTray[t]!==e&&(this._hideTopTray[t]=e,this.trigger(t))}hasStartedHideControlsTimer(e){return!!this._hasStartedHideControlsTimer[e]}setHasStartedHideControlsTimer(e,t){this._hasStartedHideControlsTimer[t]!==e&&(this._hasStartedHideControlsTimer[t]=e,this.trigger(t))}};o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"getStageMode",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"getAvailableStageModes",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"getAvailableStageModesV2",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"getCallHeaderLayoutMode",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"getOnlyVideoOnTheStage",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"getSelfInTheGrid",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"isTopTrayHidden",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],S.prototype,"hasStartedHideControlsTimer",null),S=o.__decorate([n.AutoSubscribeStore],S),t.default=new S},368427:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(174958),n=o.__importStar(i(496486)),s=i(217041),r=o.__importDefault(i(150343)),l=o.__importDefault(i(369347)),c=o.__importDefault(i(306794)),d=i(815146),u=o.__importStar(i(85385)),h=o.__importDefault(i(114818)),p=o.__importDefault(i(363091)),g=o.__importDefault(i(655192)),C=i(572095),m=o.__importDefault(i(601976));let S=class extends s.StoreBase{constructor(){super(...arguments),this._transcriptionInfo={},this._reactionsStoreSubscription={}}_stoppedTrackingKey(e){const t=this._reactionsStoreSubscription[e];t&&(c.default.unsubscribe(t),delete this._reactionsStoreSubscription[e])}_getTranscriptions(e,t){const i=l.default.CallingStore.currentCallId(e);if(!this._transcriptionInfo[i])return[];let o=this._transcriptionInfo[i].transcriptions;if(n.isEmpty(o))return[];if(t){const e=this._transcriptionInfo[i].consumptionHorizon;o=e?n.filter(o,(t=>t.message.createdTime>=e)):n.clone(o),o.splice(0,Math.max(o.length-t,0))}else o=n.clone(o);return o}getTranscriptions(e,t){const i=l.default.CallingStore.currentCallId(e);return this._getTranscriptions(i,t)}getTranscriptionsMerged(e,t){var i,o,a;const s=l.default.CallingStore.currentCallId(e),r=this._getTranscriptions(s,t),c=[];let d;for(const e of r){if(d===e.senderMri){const t=n.last(c);null===(i=null==t?void 0:t.messages)||void 0===i||i.push(e.message),null===(o=null==t?void 0:t.payloads)||void 0===o||o.push(e.payload),null===(a=null==t?void 0:t.sentences)||void 0===a||a.push(e.sentence)}else{const t=n.cloneDeep(e);t.messages=[t.message],t.payloads=[t.payload],t.sentences=[t.sentence],c.push(t)}d=e.senderMri}return c}transcriptionCount(e){const t=l.default.CallingStore.currentCallId(e);return this._transcriptionInfo[t]?this._transcriptionInfo[t].transcriptions.length:0}resetUnseenTranscriptionCount(e){const t=l.default.CallingStore.currentCallId(e);c.default.resetUnseenIncomingTranscriptionCount(t)}assignCallId(e,t){this._initStorage(t),this._reactionsStoreSubscription[t]||(this._reactionsStoreSubscription[t]=c.default.subscribe((()=>this._processReactionsStoreUpdate(t)),t))}clearCallIdAssignment(e){this._deleteStorage(e)}setConsumptionHorizon(e,t){const i=l.default.CallingStore.currentCallId(e);this._transcriptionInfo[i]&&this._transcriptionInfo[i].consumptionHorizon!==t&&(this._transcriptionInfo[i].consumptionHorizon=t,this.trigger([i,e]))}clearConsumptionHorizon(e){this.setConsumptionHorizon(e,0)}_processReactionsStoreUpdate(e){const t=l.default.CallingStore.currentCallId(e);if(!this._transcriptionInfo[t])return;const i=l.default.CallingStore.getParticipantId(t);if(!i)return;if(l.default.CallingStore.isCallOnHold(t))return void u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Call is on hold, ignoring incoming subtitles");const o=c.default.getLastTranscriptionReactions(t,this._transcriptionInfo[t].lastItemTime);n.isEmpty(o)?u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: no transcription reactions"):(n.each(o,(e=>{this._processTranscription(e,t,i),e.createdTime>this._transcriptionInfo[t].lastItemTime&&(this._transcriptionInfo[t].lastItemTime=e.createdTime)})),this.trigger([t,e]))}_processTranscription(e,t,i){var o;if(!(0,C.isValidTranscriptionMessage)(t,e))return void u.warn(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Invalid transcription payload: "+a.pii.Omit(e.content));const s=l.default.CallingStore.currentCallId(t),c=g.default.parseJsonErrorToUndefined(e.content);if(!c)return void u.warn(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Invalid transcription payload: "+a.pii.Omit(e.content));const S=this._transcriptionInfo[s].transcriptions,_=n.findIndex(S,(e=>e.payload.cid===c.cid));let f=c.message||c.translation||"";if(_>=0){if((0,h.default)(S[_].payload,c))return;if(S[_].payload.isFinal&&!c.isFinal)return;!c.isFinal&&S[_].sentence&&(f=S[_].sentence+" "+f)}const y={message:e,payload:c,sentence:f,senderMri:this._getSenderMri(s,c.sender)};if(r.default.getS4LCMCFeaturesNoSubscription().callCaptionsSendToInteropHook&&globalThis.interopHooks){const t=p.default.getSkypeMri()===y.senderMri,i=y.senderMri,a=i&&m.default.getDisplayName(i);null===(o=globalThis.interopHooks)||void 0===o||o.onCaption({callId:s,createdTime:e.createdTime,cid:c.cid,isFinal:c.isFinal,isLocal:t,sender:c.sender,caption:c.message,senderMri:i,displayName:a})}if(-1===_){const e=Math.max(50,r.default.getS4LCMCFeaturesNoSubscription().callCaptionsMaxHistory),t=S.length-e+1;t>0&&S.splice(0,t),S.push(y)}else S[_]=y}_getSenderMri(e,t){const i=l.default.CallingStore.currentCallId(e);if(!this._transcriptionInfo[i])return;const o=l.default.CallingStore.getParticipantId(i);if(!o)return;if(t===o)return p.default.getSkypeMri();const a=l.default.CallingStore.findRemoteCallMemberByEndpointParticipantId(i,t);return a?a.id:void 0}_initStorage(e){this._transcriptionInfo[e]||(this._transcriptionInfo[e]={transcriptions:[],lastItemTime:0,consumptionHorizon:0})}_deleteStorage(e){const t=l.default.CallingStore.currentCallId(e);this._transcriptionInfo[t]&&delete this._transcriptionInfo[t]}};o.__decorate([s.disableWarnings],S.prototype,"_stoppedTrackingKey",null),o.__decorate([o.__param(0,s.key)],S.prototype,"_getTranscriptions",null),o.__decorate([s.autoSubscribe,o.__param(0,s.key)],S.prototype,"getTranscriptions",null),o.__decorate([s.autoSubscribe,o.__param(0,s.key)],S.prototype,"getTranscriptionsMerged",null),o.__decorate([s.autoSubscribe,o.__param(0,s.key)],S.prototype,"transcriptionCount",null),S=o.__decorate([s.AutoSubscribeStore],S),t.default=new S},167492:(e,t,i)=>{var o;Object.defineProperty(t,"__esModule",{value:!0});const a=i(197582),n=a.__importStar(i(496486)),s=i(217041),r=i(815146),l=a.__importStar(i(85385));var c;!function(e){e[e.CallVisible=0]="CallVisible"}(c||(c={}));let d=o=class extends s.StoreBase{constructor(){super(...arguments),this._visibleCalls={},this._hasVisibleCall=!1,this._callPreviewViews={}}isCallVisible(e){return!!this._visibleCalls[e]}hasVisibleCall(){return this._hasVisibleCall}hasCallPreviewViewBeenSeen(e){return!!this._callPreviewViews[e]}setCallPreviewViewSeen(e){this._callPreviewViews[e]=!0,this.trigger(e)}setCallPreviewViewNotSeen(e){this._callPreviewViews[e]=!1,this.trigger(e)}setCallViewVisible(e,t,i){if(l.log(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" visible: "+(t?"true":"false")+" causeId: "+i),!e)return;const a=!n.isEmpty(this._visibleCalls);if(t){const t=n.find(this._visibleCalls,(t=>t.callId===e));n.isUndefined(t)?this._visibleCalls[e]=o._visibleCall(e):t.refCounter++}else void 0!==this._visibleCalls[e]?(this._visibleCalls[e].refCounter--,this._visibleCalls[e].refCounter<=0&&delete this._visibleCalls[e]):l.warn(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" trying to set visiblity false at a already invisible call");this._triggerUpdates(e,a)}_triggerUpdates(e,t=!0){this.trigger(e);const i=!n.isEmpty(this._visibleCalls);t!==i&&(this._hasVisibleCall=i,this.trigger(c.CallVisible))}static _visibleCall(e){return{callId:e,refCounter:1}}};a.__decorate([s.autoSubscribe,a.__param(0,s.key)],d.prototype,"isCallVisible",null),a.__decorate([(0,s.autoSubscribeWithKey)(c.CallVisible)],d.prototype,"hasVisibleCall",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],d.prototype,"hasCallPreviewViewBeenSeen",null),d=o=a.__decorate([s.AutoSubscribeStore],d),t.default=new d},921428:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallingSettingsStore=t.CallingSettingsFeature=void 0;const o=i(197582),a=i(217041),n=o.__importDefault(i(150343)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importDefault(i(357377)),c=o.__importDefault(i(655192));t.CallingSettingsFeature=class{};let d=class extends a.StoreBase{fetch(e=!1){if(this._callingSettings=n.default.getS4LCommerceFeatures().callingSettingsPanel,e)return;const t=this.callForwardingFeature();t&&t.clientEnabled&&this._fetchCallForwarding()}callForwardingFeature(){if(!this._callingSettings)return;const e=this._callingSettings.callForwarding;return{clientEnabled:e.enabled,link:e.link,goTarget:e.goTarget,useExternalWebBrowser:e.useExternalWebBrowser,fetched:void 0!==this._callForwardingEnabled,active:this._callForwardingEnabled}}_fetchCallForwarding(){l.default.getIsCallForwardingEnabledOption().then((e=>this._setCallForwardingEnabled(e))).catch((e=>{r.warn(s.LogTraceArea.Calling,"CallingSettingsStore: "+c.default.errorAsString(e)),this._setCallForwardingEnabled(void 0)}))}_setCallForwardingEnabled(e){this._callForwardingEnabled!==e&&(this._callForwardingEnabled=e,this.trigger())}};t.CallingSettingsStore=d,o.__decorate([a.autoSubscribe],d.prototype,"callForwardingFeature",null),t.CallingSettingsStore=d=o.__decorate([a.AutoSubscribeStore],d),t.default=new d},473304:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CelebrationType=void 0;const o=i(197582),a=o.__importDefault(i(369347)),n=o.__importDefault(i(601976)),s=i(815146),r=o.__importStar(i(85385)),l=o.__importDefault(i(114818)),c=o.__importStar(i(704704)),d=o.__importDefault(i(363091)),u=o.__importDefault(i(685734)),h=i(217041);var p;!function(e){e[e.Birthday=0]="Birthday",e[e.SpecialDay=1]="SpecialDay"}(p||(t.CelebrationType=p={}));let g=class extends h.StoreBase{constructor(){super(...arguments),this._celebrationConversations={}}_startedTrackingKey(e){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[e]||(this._celebrationConversations[e]=this._newCelebrationConversation()),this._celebrationConversations[e].callIdToken||(r.log(s.LogTraceArea.Calling,"CelebrationStore subscribing to CallingStore for callId : "+e),this._celebrationConversations[e].callIdToken=a.default.CallingStore.subscribe((()=>{this._celebrationConversations[e]?(0,l.default)(this._celebrationConversations[e].participantMris,a.default.CallingStore.getRemoteCallMemberMris(e))||(r.log(s.LogTraceArea.Calling,"CelebrationStore triggering for callId : "+e),this._celebrationConversations[e].participantMris=a.default.CallingStore.getRemoteCallMemberMris(e),this.trigger()):r.warn(s.LogTraceArea.Calling,"No celebration conversation for callId : "+e)}),e))}_stoppedTrackingKey(e){const t=this._celebrationConversations[e];t&&t.callIdToken&&(r.log(s.LogTraceArea.Calling,"CelebrationStore unsubscribing from CallingStore for callId : "+e),a.default.CallingStore.unsubscribe(t.callIdToken),delete this._celebrationConversations[e])}_getCelebrateButtonText(e){const t=e.length;switch(t){case 0:return c.getString("ReactionsStream.CelebrateButtonGenericTitle");case 1:return c.getString("ReactionsStream.CelebrateButtonTitle1User",{firstUser:e[0]});case 2:return c.getString("ReactionsStream.CelebrateButtonTitle2Users",{firstUser:e[0],secondUser:e[1]});default:return c.getString("ReactionsStream.CelebrateButtonTitleMoreUsers",{firstUser:e[0],secondUser:e[1],count:t-2})}}_newCelebrationConversation(){return{callIdToken:void 0,participantMris:[]}}getCelebrationData(e,t){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[t]||(this._celebrationConversations[t]=this._newCelebrationConversation());const i=this._celebrationConversations[t];if(i){(0,l.default)(i.participantMris,a.default.CallingStore.getRemoteCallMemberMris(t))||(i.participantMris=a.default.CallingStore.getRemoteCallMemberMris(t),this.trigger());const o=i.participantMris.filter((e=>this.isTodayBirthdayForParticipant(e,!1))),s=p.Birthday,r=o.map((t=>{const i=n.default.getMemberShortNameForConversation(e,t);return i||""}));if(o.length>0){return{recipientMris:o,recipientFirstNames:r,celebrationType:s,celebrationText:this._getCelebrateButtonText(r)}}}}isTodayBirthdayForParticipant(e,t){if(d.default.isMyMri(e)&&!t)return!1;const i=u.default.getFullUserProfileByMri(e).birthday;if(i){const e=new Date;e.setHours(0,0,0,0);const t=i.split("-");return e.getDate()===Number(t[2])&&e.getMonth()+1===Number(t[1])}return!1}isTodayBirthdayForParticipantProfile(e){const t=e.birthday;if(t){const e=new Date;e.setHours(0,0,0,0);const i=t.split("-");return e.getDate()===Number(i[2])&&e.getMonth()+1===Number(i[1])}return!1}};o.__decorate([h.disableWarnings],g.prototype,"_startedTrackingKey",null),o.__decorate([h.disableWarnings],g.prototype,"_stoppedTrackingKey",null),o.__decorate([h.autoSubscribe,o.__param(1,h.key)],g.prototype,"getCelebrationData",null),g=o.__decorate([h.AutoSubscribeStore],g),t.default=new g},604266:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importStar(i(397691)),r=i(284841),l=o.__importDefault(i(434343)),c=o.__importDefault(i(555436));let d=class extends n.StoreBase{constructor(){super(...arguments),this._dbLookups={},this._usersByPhoneNumber={},this._usersByPhoneNumberPromise={}}_startedTrackingKey(e){this._dbLookups[e]||(this._dbLookups[e]=l.default.getUserProfilesByPhoneNumber(e).finally((()=>{delete this._dbLookups[e]})).then((t=>{this._isTrackingKey(e)&&(this._usersByPhoneNumber[e]=t,this.trigger(e))})))}_stoppedTrackingKey(e){const t=this._dbLookups[e];t&&(delete this._dbLookups[e],t.cancel()),delete this._usersByPhoneNumber[e]}getSortedUsersByPhoneNumber(e){return this._sortFoundUsers(this._usersByPhoneNumber[e])}getSortedUsersByPhoneNumberAsync(e){return this._usersByPhoneNumber[e]?s.Resolved(this._usersByPhoneNumber[e]):(this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=l.default.getUserProfilesByPhoneNumber(e).finally((()=>{delete this._usersByPhoneNumberPromise[e]})).then((e=>this._sortFoundUsers(e)))),this._usersByPhoneNumberPromise[e])}getUserByPhoneNumberExactMatch(e){return this._getFirstUserMriByExactPhone(this.getSortedUsersByPhoneNumber(e),e)}getUserByPhoneNumberExactMatchAsync(e){return this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=this.getSortedUsersByPhoneNumberAsync(e)),this._usersByPhoneNumberPromise[e].then((t=>this._getFirstUserMriByExactPhone(t,e)))}_getFirstUserMriByExactPhone(e,t){return a.find(e,(e=>!!e.phones&&!!a.find(e.phones,(e=>e.number===t))))}_sortFoundUsers(e){const t=c.default.dangerousGetContactMriListMutable();return(0,r.chain)(e,(0,r.filter)((e=>e.getMri()&&a.includes(t,e.getMri()))),(0,r.sortBy)((e=>e.getDisplayName().toLowerCase())))}test_reset(){this._dbLookups={},this._usersByPhoneNumberPromise={},this._usersByPhoneNumber={}}};o.__decorate([n.disableWarnings],d.prototype,"_startedTrackingKey",null),o.__decorate([n.disableWarnings],d.prototype,"_stoppedTrackingKey",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],d.prototype,"getSortedUsersByPhoneNumber",null),o.__decorate([n.autoSubscribe,o.__param(0,n.key)],d.prototype,"getUserByPhoneNumberExactMatch",null),d=o.__decorate([n.AutoSubscribeStore],d);const u=new d;t.default=u},491196:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceQualityBannersStore=void 0,t.default=function(){return C||(C=new m)};const o=i(197582),a=i(217041),n=o.__importDefault(i(369347)),s=o.__importStar(i(619429)),r=i(815146),l=o.__importStar(i(85385)),c=i(677982),d=o.__importDefault(i(132680)),u=i(460515),h=o.__importDefault(i(60433)),p=o.__importDefault(i(638260)),g=o.__importDefault(i(760989));let C,m=class extends a.StoreBase{constructor(){super(),this._storeEnabled=!1,this._calls=[],this._deviceQualityBanners={},this._manuallyDismissedBanners={},this._handleSubscriptions=e=>{this._storeEnabled=e,this._storeEnabled?this._listenStartAndStopCallEvents():this._cleanAllSubscriptions()},this._startWatchingDeviceQualityEvents=e=>{l.log(r.LogTraceArea.CallingUI,`[DeviceQualityBannersStore][_startWatchingDeviceQualityEvents] callId: ${e}`),this._calls.includes(e)||this._calls.push(e),this._qualityEventsSubscription||(this._qualityEventsSubscription=n.default.CallingStore.callDeviceQualityEvent().subscribe(this._onDeviceQualityEvent))},this._stopWatchingDeviceQualityEvents=e=>{l.log(r.LogTraceArea.CallingUI,`[DeviceQualityBannersStore][_stopWatchingDeviceQualityEvents] callId: ${e}`),delete this._deviceQualityBanners[e],this._calls=this._calls.filter((t=>t.indexOf(e)<0)),0===this._calls.length&&(this._cleanQualityEventsSubscription(),this._deviceQualityBanners={},this._manuallyDismissedBanners={})},this._onDeviceQualityEvent=e=>{l.log(r.LogTraceArea.CallingUI,`[DeviceQualityBannersStore][_onDeviceQualityEvent] callId: ${e.callId}`,`eventType: ${s.CallDeviceQualityEventType[e.eventType]}`,`state: ${s.CallDeviceState[e.deviceState]} causeId: ${e.causeId}`);const t=e.callId;if(this._calls.includes(t)){if(e.eventType===s.CallDeviceQualityEventType.AudioDeviceMuted&&e.deviceState===s.CallDeviceState.NotWorking)return;const i=d.default.getErrorToastType(e.eventType);i&&(e.deviceState===s.CallDeviceState.NotWorking?this._addDeviceQualityBanner(t,i):e.deviceState===s.CallDeviceState.Working&&(h.default.isEventTypeTriggeringMuteAction(e.eventType)||this._removeDeviceQualityBanner(t,i,u.ToastActionType.AutoDismissed)))}},this._subscribeToCallsAndEvents()}_subscribeToCallsAndEvents(){const{enableRedesignedDeviceQualityBanners:e}=c.AppConfigStore.getS4LCMCFeaturesNoSubscription();this._handleSubscriptions(e),c.AppConfigStore.subscribe((()=>{const{enableRedesignedDeviceQualityBanners:e}=c.AppConfigStore.getS4LCMCFeaturesNoSubscription();this._storeEnabled!==e&&this._handleSubscriptions(e)}))}_listenStartAndStopCallEvents(){l.log(r.LogTraceArea.CallingUI,"[DeviceQualityBannersStore][_listenStartAndStopCallEvents]"),this._callCreatedSubscription=n.default.CallingStore.callCreatedEvent().subscribe((e=>this._startWatchingDeviceQualityEvents(e.callId))),this._callEndedSubscription=n.default.CallingStore.callEndedEvent().subscribe((e=>this._stopWatchingDeviceQualityEvents(e.callId))),n.default.CallingStore.getCallIds().forEach((e=>{this._startWatchingDeviceQualityEvents(e)}))}_cleanAllSubscriptions(){var e,t;l.log(r.LogTraceArea.CallingUI,"[DeviceQualityBannersStore][_cleanAllSubscriptions]"),null===(e=this._callCreatedSubscription)||void 0===e||e.unsubscribe(),null===(t=this._callEndedSubscription)||void 0===t||t.unsubscribe(),this._callCreatedSubscription=void 0,this._callEndedSubscription=void 0,this._cleanQualityEventsSubscription(),this._calls=[],this._deviceQualityBanners={},this._manuallyDismissedBanners={}}_cleanQualityEventsSubscription(){var e;null===(e=this._qualityEventsSubscription)||void 0===e||e.unsubscribe(),this._qualityEventsSubscription=void 0}_addDeviceQualityBanner(e,t){this._manuallyDismissedBanners[e]&&this._manuallyDismissedBanners[e].includes(t)?l.log(r.LogTraceArea.CallingUI,"[DeviceQualityBannersStore][_addDeviceQualityBanner] Banner not tracked as it was dismissed by user previously.",`callId: ${e}, type: ${u.DeviceStatusToastType[t]}`):(l.log(r.LogTraceArea.CallingUI,`[DeviceQualityBannersStore][_addDeviceQualityBanner] callId: ${e} type: ${u.DeviceStatusToastType[t]}`),this._deviceQualityBanners[e]?this._deviceQualityBanners[e].includes(t)||(this._deviceQualityBanners[e].push(t),this.trigger(e)):(this._deviceQualityBanners[e]=[t],this.trigger(e)))}_removeDeviceQualityBanner(e,t,i=u.ToastActionType.Dismissed,o=g.default.newCauseId()){this._deviceQualityBanners[e]&&this._deviceQualityBanners[e].includes(t)&&(l.log(r.LogTraceArea.CallingUI,"[DeviceQualityBannersStore][_removeDeviceQualityBanner]",`callId: ${e} type: ${u.DeviceStatusToastType[t]} action: ${u.ToastActionType[i]} causeId: ${o}`),this._removeBannerFromList(e,t),this._updateManuallyDismissedBanners(e,t,i),this._sendTelemetry(e,t,i,o),this.trigger(e))}_removeBannerFromList(e,t){this._deviceQualityBanners[e]=this._deviceQualityBanners[e].filter((e=>e!==t))}_updateManuallyDismissedBanners(e,t,i){i!==u.ToastActionType.ManualDismissed&&i!==u.ToastActionType.Actioned||(this._manuallyDismissedBanners[e]?this._manuallyDismissedBanners[e].push(t):this._manuallyDismissedBanners[e]=[t])}_sendTelemetry(e,t,i,o){p.default.trackInCallUFD(e,t,i),p.default.updateCallTelemetry(e,o,(e=>e.ufdDisplayed(i)))}getDeviceQualityBannerTypes(e){return this._deviceQualityBanners[e]?[...this._deviceQualityBanners[e]]:[]}removeDeviceQualityBannerType(e,t,i,o){this._removeDeviceQualityBanner(e,t,i,o)}test_reset(){this._cleanAllSubscriptions()}};t.DeviceQualityBannersStore=m,o.__decorate([a.disableWarnings],m.prototype,"_subscribeToCallsAndEvents",null),o.__decorate([a.autoSubscribe,o.__param(0,a.key)],m.prototype,"getDeviceQualityBannerTypes",null),o.__decorate([o.__param(0,a.key)],m.prototype,"removeDeviceQualityBannerType",null),t.DeviceQualityBannersStore=m=o.__decorate([a.AutoSubscribeStore],m)},582176:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialerUXStore=t.TriggerKeys=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importDefault(i(150343)),r=o.__importStar(i(535174)),l=o.__importDefault(i(354676)),c=i(154235),d=o.__importDefault(i(808164)),u=o.__importStar(i(879119)),h=o.__importStar(i(960282)),p=o.__importStar(i(446574)),g=o.__importDefault(i(127336));var C;!function(e){e[e.CallerIdCTA=0]="CallerIdCTA",e[e.CallRate=1]="CallRate",e[e.DialpadCollapse=2]="DialpadCollapse",e[e.SaveContact=3]="SaveContact",e[e.TasterPromotion=4]="TasterPromotion",e[e.DialingExtension=5]="DialingExtension",e[e.CanDialComma=6]="CanDialComma",e[e.SmsRate=7]="SmsRate",e[e.SmsNewEntry=8]="SmsNewEntry",e[e.FreeCall=9]="FreeCall",e[e.ShowInvalidNoteBeforeStartCall=10]="ShowInvalidNoteBeforeStartCall"}(C||(t.TriggerKeys=C={}));let m=class extends n.StoreBase{constructor(){super(),this._isDialpadCollapsed=!1,this._shouldShowCallerIdCTA=!1,this._isCallerIdCTACollapsedInPortrait=!1,this._isCallerIdCTACollapsedInLandscape=!1,this._callRatesSubscriptions={},this._smsRatesSubscriptions={},this._callRates={},this._smsRates={},this._rateIntegrationEnabled=!1,this._saveContactEnabled=!1,this._saveContactVisible=!1,this._tasterPromotionEnabled=!1,this._isRoomForTasterImage=!1,this._canDialComma=!1,this._isDialingExtension=!1,this._enableSmsNewEntry=!1,this._isFreeCall=!1,this._showInvalidNoteBeforeStartCall=!1,this._isPhoneNumberVaild=!0,this._clickCallCount=0,this._updateAppConfigFields=()=>{const e=s.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.RateIntegrationEnabled;this._rateIntegrationEnabled!==e&&(this._rateIntegrationEnabled=e,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility());const t=s.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SaveContactEnabled;this._saveContactEnabled!==t&&(this._saveContactEnabled=t,this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility());const i=s.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.TasterPromotionEnabled;this._tasterPromotionEnabled!==i&&(this._tasterPromotionEnabled=i,this.trigger(C.TasterPromotion));const o=s.default.getS4LCommerceFeatures().smsNewEntry.enableOnDialpad;this._enableSmsNewEntry!==o&&(this._enableSmsNewEntry=o,this.trigger(C.SmsNewEntry));const a=s.default.getS4LCommerceFeatures().showInvalidNoteBeforeStartCall;this._showInvalidNoteBeforeStartCall!==a&&(this._showInvalidNoteBeforeStartCall=a,this.trigger(C.ShowInvalidNoteBeforeStartCall))},this._shouldShowCallerIdCTAUpdate=()=>{const e=r.default.shouldShowDialpadCTA();this._shouldShowCallerIdCTA!==e&&(this._shouldShowCallerIdCTA=e,this.trigger(C.CallerIdCTA))},this._searchResultsUpdate=()=>{this._contactSearchResults=u.default.getSearchResults(),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberUpdate=()=>{this._phoneNumber=u.default.getPhoneNumber(u.TriggerKeys.E164),this.trigger(C.CallRate),this.trigger(C.SmsRate),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberInputUpdate=()=>{this._phoneNumber=u.default.getPhoneNumber(u.TriggerKeys.InputValue),this._updateIsDialingExtension(),this._updateCanDialComma()},this._screenSizeUpdate=()=>{const e=h.default.isMobileScreenSize(c.MainRootViewId)&&!h.default.isHeightSmallerThanThreshold(710,c.MainRootViewId);this._isRoomForTasterImage!==e&&(this._isRoomForTasterImage=e,this.trigger(C.TasterPromotion))},this._updateSaveContactVisibility=()=>{const e=this._saveContactEnabled&&this._phoneNumber&&this._phoneNumber.callable&&!this._phoneNumber.emergency&&!this._phoneNumber.extension&&(!this._contactSearchResults||!this._contactSearchResults.selectedResult&&!this._contactSearchResults.exactMatch)&&!(this._callRates[this._phoneNumber.E164]&&this._callRates[this._phoneNumber.E164].isTasterEligible);this._saveContactVisible!==e&&(this._saveContactVisible=!!e,this.trigger(C.SaveContact))},this._updateCallerIdCTAVisibility=()=>{let e=!1,t=!1;this._phoneNumber&&this._callRates[this._phoneNumber.E164]&&(e=!0),this._contactSearchResults&&(this._contactSearchResults.results.length>0||this._contactSearchResults.selectedResult)&&(e=!0),this.isDialpadCollapsed()&&(e=!0),this._saveContactVisible&&(e=!0),this._phoneNumber&&this._phoneNumber.emergency&&(e=!0,t=!0),this._isCallerIdCTACollapsedInPortrait===e&&this._isCallerIdCTACollapsedInLandscape===t||(this._isCallerIdCTACollapsedInPortrait=e,this._isCallerIdCTACollapsedInLandscape=t,this.trigger(C.CallerIdCTA))},this._updateCanDialComma=()=>{const e=!!this._phoneNumber&&this._phoneNumber.callable;this._canDialComma!==e&&(this._canDialComma=e,this.trigger(C.CanDialComma))},this._updateIsDialingExtension=()=>{const e=!!this._phoneNumber&&!!this._phoneNumber.extension;this._isDialingExtension!==e&&(this._isDialingExtension=e,this.trigger(C.DialingExtension))},this.isValidNumberForCountry=(e,t)=>{try{return!a.isEmpty(e)&&d.default.isPossibleNumber(e,t)&&d.default.isValidNumber(d.default.parse(e,t))}catch(e){return!1}},p.RegisterStartupable(this,"DialerUXStore")}startup(){return s.default.subscribe(this._updateAppConfigFields),this._updateAppConfigFields(),u.default.subscribe(this._searchResultsUpdate,u.TriggerKeys.SearchResults),this._searchResultsUpdate(),u.default.subscribe(this._phoneNumberUpdate,u.TriggerKeys.E164),this._phoneNumberUpdate(),u.default.subscribe(this._phoneNumberInputUpdate,u.TriggerKeys.InputValue),this._phoneNumberInputUpdate(),h.default.subscribe(this._screenSizeUpdate,h.TriggerKeys.ResponsiveWidth),h.default.subscribe(this._screenSizeUpdate,h.TriggerKeys.Height),this._screenSizeUpdate(),Promise.resolve()}resetDialerPanelState(){this.toggleDialpadCollapse(!1)}toggleDialpadCollapse(e){this._isDialpadCollapsed=e,this._updateCallerIdCTAVisibility(),this.trigger(C.DialpadCollapse)}getIsPhoneNumberVaild(){return this._isPhoneNumberVaild}getClickCallCount(){return this._clickCallCount}setIsPhoneNumberVaild(e){this._isPhoneNumberVaild=e,e?this._clickCallCount=0:this._clickCallCount++,this.trigger(C.ShowInvalidNoteBeforeStartCall)}cleanupPhoneNumberVaild(){this.isShowInvalidNoteBeforeStartCallEnabled()&&(this._isPhoneNumberVaild=!0,this.trigger(C.ShowInvalidNoteBeforeStartCall))}cleanupclickCallCount(){this.isShowInvalidNoteBeforeStartCallEnabled()&&(this._clickCallCount=0)}isShowInvalidNoteBeforeStartCallEnabled(){return this._showInvalidNoteBeforeStartCall}isCallClickCountLessThanOne(e){return e<1}isSmsNewEntryEnabled(){return this._enableSmsNewEntry}isFreeCall(){return this._isFreeCall}isDialpadCollapsed(){return this._isDialpadCollapsed}getCallRate(){if(!this._phoneNumber||!this._isValidPhoneNumber(this._phoneNumber.E164)||!this._rateIntegrationEnabled)return{};const e=this._phoneNumber.E164,t=d.default.stripPlusSign(e);return void 0===this._callRatesSubscriptions[e]&&(this._callRatesSubscriptions[e]=l.default.subscribe((()=>this._callRateUpdate(e)),t),this._callRates[e]={destinationCountry:l.default.getCallRateDestinationCountry(t),message:l.default.getCallRateByPhoneNumber(t),isTasterEligible:l.default.isPhoneNumberEligibleForTaster(t),phoneNumber:t}),this._callRates[e]}getSmsRate(){var e;if(!this._phoneNumber||!this._isValidPhoneNumber(this._phoneNumber.E164)||!this._rateIntegrationEnabled)return{};const t=this._phoneNumber.E164,i=d.default.stripPlusSign(t);return void 0===this._smsRatesSubscriptions[t]&&(this._smsRatesSubscriptions[t]=g.default.subscribe((()=>this._smsRateUpdate(t)),i),this._smsRates[t]=null!==(e=g.default.getSmsRateByPhoneNumber(i))&&void 0!==e?e:{}),this._smsRates[t]}isSaveContactVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&this._saveContactVisible}isCallerIdCTAVisibleInPortrait(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInPortrait}isCallerIdCTAVisibleInLandscape(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInLandscape}shouldShowRateAboveSelectedContact(){return!(this.tasterImageEnabled()&&this.getCallRate().isTasterEligible)}tasterImageEnabled(){return this._tasterPromotionEnabled&&this._isRoomForTasterImage}tasterCoachmarkEnabled(){return this._tasterPromotionEnabled&&!this._isRoomForTasterImage}tasterGreenCallButtonEnabled(){return this._tasterPromotionEnabled}isDialingExtension(){return this._isDialingExtension}canDialComma(){return this._canDialComma}setFreeCall(e){this._isFreeCall=e,this.trigger(C.FreeCall)}_isCallerIdCTAVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&(void 0===this._callerIdPromptStoreSubscription&&(this._callerIdPromptStoreSubscription=r.default.subscribe(this._shouldShowCallerIdCTAUpdate,r.TriggerKeys.DialpadCTA),this._shouldShowCallerIdCTA=r.default.shouldShowDialpadCTA()),this._shouldShowCallerIdCTA)}_isInvalidNumberNotificationVisible(e,t){return!!(e&&t&&this._phoneNumber&&this._phoneNumber.E164===t)}_isValidPhoneNumber(e){try{return!a.isEmpty(e)&&d.default.isValidNumberString(e)}catch(e){return!1}}_callRateUpdate(e){const t=d.default.stripPlusSign(e),i={message:l.default.getCallRateByPhoneNumber(t),isTasterEligible:l.default.isPhoneNumberEligibleForTaster(d.default.stripPlusSign(t))};this._callRates[e].message===i.message&&this._callRates[e].isTasterEligible===i.isTasterEligible||(this._callRates[e]=i,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility()),l.default.unsubscribe(this._callRatesSubscriptions[e]),delete this._callRatesSubscriptions[e]}_smsRateUpdate(e){const t=d.default.stripPlusSign(e),i=g.default.getSmsRateByPhoneNumberSafely(t);!i||this._smsRates[e].currency===i.currency&&this._smsRates[e].rate===i.rate||(this._smsRates[e]=i,this.trigger(C.SmsRate),this._updateCallerIdCTAVisibility()),g.default.unsubscribe(this._smsRatesSubscriptions[e])}};t.DialerUXStore=m,o.__decorate([(0,n.autoSubscribeWithKey)(C.ShowInvalidNoteBeforeStartCall)],m.prototype,"getIsPhoneNumberVaild",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.ShowInvalidNoteBeforeStartCall)],m.prototype,"getClickCallCount",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.ShowInvalidNoteBeforeStartCall)],m.prototype,"isShowInvalidNoteBeforeStartCallEnabled",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.SmsNewEntry)],m.prototype,"isSmsNewEntryEnabled",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.FreeCall)],m.prototype,"isFreeCall",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.DialpadCollapse)],m.prototype,"isDialpadCollapsed",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.CallRate)],m.prototype,"getCallRate",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.SmsRate)],m.prototype,"getSmsRate",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.SaveContact)],m.prototype,"isSaveContactVisible",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.CallerIdCTA)],m.prototype,"isCallerIdCTAVisibleInPortrait",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.CallerIdCTA)],m.prototype,"isCallerIdCTAVisibleInLandscape",null),o.__decorate([(0,n.autoSubscribeWithKey)([C.CallRate,C.TasterPromotion])],m.prototype,"shouldShowRateAboveSelectedContact",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.TasterPromotion)],m.prototype,"tasterImageEnabled",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.TasterPromotion)],m.prototype,"tasterCoachmarkEnabled",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.TasterPromotion)],m.prototype,"tasterGreenCallButtonEnabled",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.DialingExtension)],m.prototype,"isDialingExtension",null),o.__decorate([(0,n.autoSubscribeWithKey)(C.CanDialComma)],m.prototype,"canDialComma",null),t.DialerUXStore=m=o.__decorate([n.AutoSubscribeStore],m),t.default=new m},421852:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.E911Store=void 0;const o=i(197582),a=o.__importDefault(i(264596)),n=o.__importDefault(i(331654)),s=i(380157),r=o.__importStar(i(496486)),l=i(217041),c=o.__importDefault(i(150343)),d=o.__importDefault(i(926876)),u=i(815146),h=o.__importStar(i(85385)),p=o.__importDefault(i(114818)),g=o.__importDefault(i(265609)),C=o.__importDefault(i(201721)),m=o.__importDefault(i(251733)),S=o.__importDefault(i(341994)),_=i(427393),f=o.__importStar(i(446574)),y=(o.__importDefault(i(139221)),i(331079));let T=class extends l.StoreBase{constructor(){super(),this.requiresSystemPermission=!1,this._supportsNativeEmergencyCalling=!1,f.RegisterStartupable(this,"E911Store",[m.default,S.default,C.default,g.default])}startup(){return n.default.supportsNativeEmergencyCalling().catch((()=>!1)).then((e=>{var t;if(this._supportsNativeEmergencyCalling=e,h.log(u.LogTraceArea.Phone,"E911Store: Native emergency calling capability checked, supports="+e),!e){let e,i=this._isLocationEnabled();if(c.default.subscribe((()=>{this.trigger();const e=this._isLocationEnabled();i!==e&&(i=e,e||this.resetLocation())})),this.requiresSystemPermission){let e=m.default.permissionStatus(y.PermissionType.Location)===s.PermissionStatus.Granted;r.isUndefined(C.default.isE911LocationConsentGranted())||C.default.setE911LocationConsentGranted(e),m.default.subscribe((()=>{if(!r.isUndefined(C.default.isE911LocationConsentGranted())){const t=m.default.permissionStatus(y.PermissionType.Location)===s.PermissionStatus.Granted;e!==t&&(C.default.setE911LocationConsentGranted(t),e=t,t||this.resetLocation())}}),y.PermissionType.Location)}else{let e=!!C.default.isE911LocationConsentGranted();C.default.subscribe((()=>{const t=!!C.default.isE911LocationConsentGranted();e!==t&&(e=t,t||this.resetLocation())}))}null===(t=a.default.getStack())||void 0===t||t.on("e911InfoChanged",(t=>{if((0,p.default)(e,t)){e=t;const i=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;this._canShareLocation()&&i.locationUpdateEventEnabled&&this.updateLocation(u.LocationUpdateReason.E911NetworkChange)}})),this._canShareLocation()&&this.updateLocationWithPermission(u.LocationUpdateReason.E911Startup)}})).toEs6Promise()}isEnabled(){return this._isEnabled()}_isEnabled(){if(this._supportsNativeEmergencyCalling)return!1;const e=c.default.getHeaders().CountryCode;if(!e)return!1;const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;return r.includes(t.enabledCountries,r.toLower(e))}isLocationEnabled(){return this._isLocationEnabled()}_isLocationEnabled(){const e=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;return this._isEnabled()&&e.locationEnabled}_canShareLocation(){return this._isLocationEnabled()&&!!C.default.isE911LocationConsentGranted()}shouldRequestAcknowledgementNoSubscription(){return!!this._isEnabled()&&(!S.default.isE911Acknowledged()||this._isLocationEnabled()&&r.isUndefined(C.default.isE911LocationConsentGranted()))}getEmergencyContentForNumberNoSubscription(e){const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;if(!r.includes(t.locationNumbers,e))return;if(!this._canShareLocation()||r.isUndefined(this._location))return;const i={pidf:this._location};return JSON.stringify(i)}requestLocationPermission(){return g.default.getLocationPermission(!0,y.PermissionType.Location)}updateLocation(e){if(!r.isUndefined(this._locationUpdatePromise))return h.log(u.LogTraceArea.Phone,"E911Store: Already updating location. Exit now."),this._locationUpdatePromise;h.log(u.LogTraceArea.Phone,"E911Store: Updating location. Reason: "+e);const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911.locationUpdateThrottlingMs,i=this._locationUpdateTimestamp?Date.now()-this._locationUpdateTimestamp:void 0;if(!r.isUndefined(this._location)&&!r.isUndefined(i)&&i<t)return h.log(u.LogTraceArea.Phone,"E911Store: Location has been updated recently. Exit now."),Promise.resolve(this._location);h.log(u.LogTraceArea.Phone,"E911Store: Resolving geo coordinates.");const o=g.default.updateLocation(e,!0).then((e=>{const t=null==e?void 0:e.coords;return r.isUndefined(t)?Promise.reject():(h.log(u.LogTraceArea.Phone,"E911Store: Geo coordinates resolved. Fetching location."),d.default.getBase64EncodedLocation(t.latitude,t.longitude,this._getCountryLocale()).toEs6Promise().then((e=>(this._location=e,this._locationUpdateTimestamp=Date.now(),h.track(new _.E911LocationUpdateEvent),h.log(u.LogTraceArea.Phone,"E911Store: Location is updated."),e))))})).catch((()=>(h.warn(u.LogTraceArea.Phone,"E911Store: Failed to update location: Couldn't resolve geo coordinates."),Promise.reject())));return this._locationUpdatePromise=o,o.finally((()=>{this._locationUpdatePromise=void 0})),o}updateLocationWithPermission(e){return this.requestLocationPermission().then((()=>this.updateLocation(e)))}resetLocation(){h.log(u.LogTraceArea.Phone,"E911Store: Resetting location."),this._location=void 0,this._locationUpdateTimestamp=void 0}_getCountryLocale(){const e=c.default.getHeaders().CountryCode;return r.toLower(e),"en-US"}};t.E911Store=T,o.__decorate([l.autoSubscribe],T.prototype,"isEnabled",null),o.__decorate([l.autoSubscribe],T.prototype,"isLocationEnabled",null),t.E911Store=T=o.__decorate([l.AutoSubscribeStore],T),t.default=new T},929154:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InCallFeatureConsentStore=void 0;const o=i(197582),a=i(217041),n=i(148540),s=i(496486),r=o.__importDefault(i(974634)),l=o.__importDefault(i(150343)),c=o.__importDefault(i(369347)),d=o.__importDefault(i(60433)),u=i(619429),h=o.__importStar(i(85385)),p=i(815146),g=o.__importDefault(i(601976)),C=o.__importDefault(i(524526));class m extends a.StoreBase{constructor(){super(...arguments),this._participantUpdateSubscription={},this._inCallFeatureStateMachine={},this._participantInCallFeatureRequest={},this._stateUpdatedEvent=new r.default,this.requestStartFeature=e=>{this._isFeatureConsentEnabled()&&this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Start})},this.requestStopFeature=e=>{this._isFeatureConsentEnabled()&&this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Stop})},this.requestProvideConsent=e=>{this._isFeatureConsentEnabled()&&(this._setLocalConsent(!0),this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Start}))},this.requestRemoteConsent=e=>{this._isFeatureConsentEnabled()&&(this._setLocalConsent(!0),this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.RequestConsent}))},this.requestRejectConsent=e=>{this._isFeatureConsentEnabled()&&(this._setLocalConsent(!1),this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.RejectConsent}))},this.requestFeatureFailure=e=>{this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Fail})},this._maybeGoToNextStateFromLocalUserAction=(e,t)=>{var i;this._maybeResetToInitialState(e);const o=null===(i=this._inCallFeatureStateMachine[e])||void 0===i?void 0:i.handleLocalUserAction(t);this._maybeTriggerNextState(e,o)},this._maybeGoToNextStateFromRemoteUserAction=(e,t)=>{var i;this._maybeResetToInitialState(e);var o=null===(i=this._inCallFeatureStateMachine[e])||void 0===i?void 0:i.handleRemoteUserAction(t);this._maybeTriggerNextState(e,o)},this._maybeTriggerNextState=(e,t)=>{t&&this._inCallFeatureStateMachine[e]!==t&&(t.onEnter(),this._inCallFeatureStateMachine[e]=t,t.shouldPublishToRoster()&&void 0!==t.getTransitionAction()&&this._updateRosterState(e,t),this._stateUpdatedEvent.fire(e),this.trigger(e))},this._maybeResetToInitialState=e=>{var t;(null===(t=this._inCallFeatureStateMachine[e])||void 0===t?void 0:t.isFinal())&&this._resetToInitialState(e)},this._clearState=e=>{this._inCallFeatureStateMachine[e]&&delete this._inCallFeatureStateMachine[e],this._participantInCallFeatureRequest[e]&&delete this._participantInCallFeatureRequest[e]},this._getRosterUpdateDelay=()=>l.default.getS4LCMCFeaturesNoSubscription().inCallFeatureConsentRosterDelayMs,this._processTransitionRequestUpdate=(e,t,i)=>{var o,a;const n=null===(a=null===(o=this._participantInCallFeatureRequest[e])||void 0===o?void 0:o[t])||void 0===a?void 0:a.action,s=i.action;this._logMessage(`Update from ROSTER: ${n?u.InCallFeatureTransitionAction[n]:"undefined"}->${u.InCallFeatureTransitionAction[s]}`),this._recordParticipantInCallTransitionRequest(e,t,i),this._maybeGoToNextStateFromRemoteUserAction(e,i)},this._participantChanged=(e,t)=>{t.state===n.ParticipantState.Connected&&!c.default.CallingStore.isCallOnHold(e)&&t.endpoints&&this._notSelfUpdate(e,t.id)&&t.endpoints.endpointDetails.forEach((i=>{const o=this._getInCallFeatureTransitionRequestFromRoster(e,i.endpointMetadata);o&&(this._isParticipantInCallFeatureStateUpdate(e,t.id,o)?(o.requestedBy=g.default.getShortDisplayName(t.id)||t.displayName,this._processTransitionRequestUpdate(e,t.id,o)):this._logMessage("Transition request not updated"))}))},this._notSelfUpdate=(e,t)=>c.default.CallingStore.getParticipantId(e)!==t,this._recordParticipantInCallTransitionRequest=(e,t,i)=>{this._participantInCallFeatureRequest[e]||(this._participantInCallFeatureRequest[e]={}),this._participantInCallFeatureRequest[e][t]=i},this._participantInCallFeatureStateExists=(e,t)=>{var i;return!!(null===(i=this._participantInCallFeatureRequest[e])||void 0===i?void 0:i[t])},this._isParticipantInCallFeatureStateUpdate=(e,t,i)=>{var o,a,n;if(!this._participantInCallFeatureStateExists(e,t))return this._logMessage("Participant state does not exist -> process update"),!0;const s=null===(o=this._participantInCallFeatureRequest[e])||void 0===o?void 0:o[t],r=null!==(a=i.requestVersion)&&void 0!==a?a:0,l=null!==(n=s.requestVersion)&&void 0!==n?n:0;return s&&r>l?(this._logMessage(`${this._getInCallFeatureName()} state update to ${u.InCallFeatureState[i.action]} as new state version is greater (${i.requestVersion} > ${s.requestVersion})`),!0):(this._logMessage(`Not processing ${u.InCallFeatureState[i.action]} transition as new state version is lower (${i.requestVersion} <= ${s.requestVersion})`),!1)},this._getConnectedParticipants=e=>{const t=C.default.getNonInteractiveInCallBotMris();return c.default.CallingStore.getRemoteCallMembers(e).filter((i=>{if(!d.default.isParticipantConnected(i))return!1;const o=c.default.CallingStore.getRemoteCallMemberMri(e,i);return!(!i.endpoints||t.includes(o))}))},this._logMessage=e=>{h.log(p.LogTraceArea.InCallBotService,`${this._getInCallFeatureName()} ${e}`)},this._isFeatureConsentEnabled=()=>l.default.getS4LCMCFeaturesNoSubscription().isInCallFeatureConsentEnabled}startTracking(e){this._isFeatureConsentEnabled()&&(this._resetToInitialState(e),this._participantUpdateSubscription[e]=c.default.CallingStore.participantUpdatedEvent().subscribe(this._participantChanged))}stopTracking(e){this._isFeatureConsentEnabled()&&(this._participantUpdateSubscription[e]&&(this._participantUpdateSubscription[e].unsubscribe(),delete this._participantUpdateSubscription[e]),this._clearState(e))}stateUpdatedEvent(){return this._stateUpdatedEvent}getInCallFeatureState(e){var t;if(!this._isFeatureConsentEnabled())return;const i=null===(t=this._inCallFeatureStateMachine[e])||void 0===t?void 0:t.getState();return i?(0,s.clone)(i):void 0}}t.InCallFeatureConsentStore=m,o.__decorate([a.autoSubscribe,o.__param(0,a.key)],m.prototype,"getInCallFeatureState",null)},658804:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(217041),n=i(496486),s=o.__importDefault(i(369347)),r=i(929154),l=i(771895),c=o.__importDefault(i(341994));function d(e,t){s.default.CallingStore.setInCallTranslationState(e,t)}let u=class extends r.InCallFeatureConsentStore{constructor(){super(...arguments),this._setLocalConsent=e=>{s.default.CallingStore.setHasInCallTranslationConsent(e)},this._getLocalConsent=()=>c.default.getCallTranslatorTranslationConsent(),this._isInCallFeatureSupported=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,n.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberSupportsInCallTranslation(e,i.id)||(t=!1)})):t=!1,t},this._didOtherUsersProvideConsent=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,n.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberHasInCallTranslationConsent(e,i.id)||(t=!1)})):t=!1,t},this._updateRosterState=(e,t)=>{(0,n.delay)(d,this._getRosterUpdateDelay(),e,t.getTransitionAction())},this._getInCallFeatureTransitionRequestFromRoster=(e,t)=>{var i;return null===(i=null==t?void 0:t.inCallTranslationState)||void 0===i?void 0:i[e]},this._resetToInitialState=e=>{this._inCallFeatureStateMachine[e]=new l.InCallFeatureDisabledState((()=>this._getLocalConsent()),(()=>this._didOtherUsersProvideConsent(e)),(()=>this._isInCallFeatureSupported(e)),e)},this._getInCallFeatureName=()=>"[InCallTranslation]"}};u=o.__decorate([a.AutoSubscribeStore],u),t.default=new u},912201:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TestableNdiConfigStore=void 0;const o=i(197582),a=i(167606),n=i(217041),s=i(434343),r=o.__importStar(i(85385)),l=o.__importDefault(i(652032)),c=o.__importDefault(i(655192)),d=o.__importDefault(i(760989));let u=class extends n.StoreBase{constructor(){super(),this._ndiConfig={isNdiEnabled:!1,watermarkLocation:"1,0"}}initialize(){const e=d.default.newCauseId(),t=l.default.getDataExclusive(s.InternalKeys.NdiConfig);if(r.log(a.LogTraceArea.Ndi,`NdiConfigStore.initialize. causeId: ${e}`),t){let e=!1;this._ndiConfig.isNdiEnabled===t.isNdiEnabled&&this._ndiConfig.watermarkLocation===t.watermarkLocation||(e=!0),this._ndiConfig.isNdiEnabled=t.isNdiEnabled,this._ndiConfig.watermarkLocation=t.watermarkLocation,e&&this.trigger()}r.log(a.LogTraceArea.Ndi,`Initial ndi config is ${JSON.stringify(this._ndiConfig)}`)}isNdiEnabled(){return this._ndiConfig.isNdiEnabled}setNdiEnabled(e){const t=d.default.newCauseId();this._ndiConfig.isNdiEnabled!==e?(r.log(a.LogTraceArea.Ndi,`updating isNdiEnabled to ${e}. causeId: ${t}`),this._ndiConfig.isNdiEnabled=e,this.trigger(),this._writeToUserConfig(t)):r.log(a.LogTraceArea.Ndi,`setNdiEnabled called with value same as current (${e}). causeId: ${t}`)}getWatermarkLocation(){return this._ndiConfig.watermarkLocation}setWatermarkLocation(e){const t=d.default.newCauseId();this._ndiConfig.watermarkLocation!==e?(r.log(a.LogTraceArea.Ndi,`updating watermarkLocation to ${e} causeId: ${t}`),this._ndiConfig.watermarkLocation=e,this.trigger(),this._writeToUserConfig(t)):r.log(a.LogTraceArea.Ndi,`setWatermarkLocation called with value same as current (${e}). causeId: ${t}`)}_writeToUserConfig(e){r.log(a.LogTraceArea.Ndi,`Writing ${JSON.stringify(this._ndiConfig)} to internalDataStore. causeId: ${e}`),l.default.putData(s.InternalKeys.NdiConfig,this._ndiConfig,e).catch((t=>r.warn(a.LogTraceArea.Ndi,`putData Failed. causeId: ${e} error: ${c.default.errorAsString(t)}`))).finally((()=>{r.log(a.LogTraceArea.Ndi,`Done writing. causeId: ${e}`)}))}};t.TestableNdiConfigStore=u,o.__decorate([n.autoSubscribe],u.prototype,"isNdiEnabled",null),o.__decorate([n.autoSubscribe],u.prototype,"getWatermarkLocation",null),t.TestableNdiConfigStore=u=o.__decorate([n.AutoSubscribeStore],u),t.default=new u},879119:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const o=i(197582),a=o.__importStar(i(496486)),n=i(217041),s=o.__importDefault(i(150343)),r=i(284841),l=o.__importStar(i(44717)),c=o.__importDefault(i(604266)),d=o.__importDefault(i(615364)),u=o.__importDefault(i(988773)),h=i(888870),p=i(815146),g=o.__importStar(i(85385)),C=o.__importDefault(i(432091)),m=o.__importDefault(i(328416)),S=o.__importDefault(i(808164)),_=i(427393),f=o.__importDefault(i(601274)),y=o.__importDefault(i(685734)),T=i(309515),b=i(306194);var v;!function(e){e[e.InputValue=0]="InputValue",e[e.Emergency=1]="Emergency",e[e.E164=2]="E164",e[e.SelectedCountry=3]="SelectedCountry",e[e.Prefix=4]="Prefix",e[e.Callable=5]="Callable",e[e.SearchResults=6]="SearchResults"}(v||(t.TriggerKeys=v={}));let I=class extends n.StoreBase{constructor(){super(...arguments),this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},this._searchResults={results:[],query:"",sessionId:""},this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCacheLoading=!1,this._lastCalledCountryCodes={},this._phoneNumberPrefixIndex={index:{},indexSize:0,maxLength:0}}getPhoneNumber(e){return this._phoneNumber}getSearchResults(){return this._searchResults}getSelectedCountry(){return this._selectedCountry}getDefaultCountry(){return this._defaultCountry}getAccessibilitySummary(){return{searchHasResults:!!this._searchResults.results.length&&!this._searchResults.selectedResult,selectedContactDisplayName:this._searchResults.selectedResult?this._searchResults.selectedResult.contact.displayName:void 0,selectedCountryName:this._selectedCountry?this._selectedCountry.countryName:void 0}}getLast5CalledCountriesNoSubscription(){return this._lastCalledCountryCodes}setSelectedCountry(e,t=!1){if(g.log(p.LogTraceArea.DialerStore,"setSelectedCountry("+JSON.stringify(e)+", "+t+")"),g.log(p.LogTraceArea.DialerStore,"selectedCountry state changed, from ["+JSON.stringify(this._selectedCountry)+"] to ["+JSON.stringify(e)+"]"),this._selectedCountry=e,this._setDefaultCountry(this._selectedCountry),t){let e="";this._selectedCountry&&(this._phoneNumber.suffix&&this._phoneNumber.E164?(g.log(p.LogTraceArea.DialerStore,"Preserving number input"),this._phoneNumber.suffix===this._phoneNumber.inputValue?(this._phoneNumber.prefix=a.toString(this._selectedCountry.countryCode),e=this._phoneNumber.suffix,this._recalculatePhoneNumberCountry(),this._recalculatePhoneNumberE164Format()):e=S.default.compilePhoneNumber(this._phoneNumber.suffix,this._selectedCountry.countryCode)):e="+"+this._selectedCountry.countryCode),this.overwritePhoneNumberInput(e,!!e)}this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),this.trigger(v.SelectedCountry)}_preselectCountry(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;if(!this._selectedCountry){const t=u.default.getDefaultPstnDestinationCountry();g.log(p.LogTraceArea.DialerStore,"_preselectCountry() Stored PSTN default country: "+JSON.stringify(t)),t&&this.setSelectedCountry(t,!e.T9SearchEnabled)}!e.T9SearchEnabled||this._searchResults&&this._searchResults.preselected||this.cleanupPhoneNumberInput()}cleanupPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"cleanupPhoneNumberInput("+e+")"),this._setInputValue("",e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}eraseCharFromPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"eraseCharFromPhoneNumberInput("+e+")");const t=this._phoneNumber.inputValue.slice(-1),i=this._phoneNumber.inputValue.slice(0,-1);return this._setInputValue(i,e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),[t,i]}appendCharToPhoneNumberInput(e,t=!0){g.log(p.LogTraceArea.DialerStore,"appendCharToPhoneNumberInput(*, "+t+")"),e=u.default.filterPhoneNumberChar(this._phoneNumber.inputValue,e),this._setInputValue(this._phoneNumber.inputValue?this._phoneNumber.inputValue+e:e,t),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}overwritePhoneNumberInput(e,t=!0,i=p.NavigationCallOrigin.PstnDialpadTyped){g.log(p.LogTraceArea.DialerStore,"overwritePhoneNumberInput(*, "+t+")"),this._setInputValue(e,t),this.setPhoneNumberOrigin(i)}selectSearchResultItem(e){const t=this._searchResults.results[e];this.overwritePhoneNumberInput(t.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSearchResult),this._resetSearchResults(),this._searchResults.results=[t],this._searchResults.exactMatch=t,this._searchResults.selectedResult=t,this.trigger(v.SearchResults)}initializeSearch(){this._searchInitialized||this._searchCacheLoading||(this._searchCacheLoading=!0,this._searchCachePromise=c.default.getSortedUsersByPhoneNumberAsync("+").then((e=>{this._searchCache=[],a.each(e,(e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:e.getMri()},a.each(e.phones,((t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})}))})),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache),g.log(p.LogTraceArea.DialerStore,"Contact search: [init], Contacts cache: ["+a.size(this._searchContacts)+"], Search cache: ["+a.size(this._searchCache)+"]"),this._localAddressBookSubToken||(this._localAddressBookSubToken=C.default.subscribe((()=>this._updateSearchCache()))),this._updateSearchCache(),this._searchInitialized=!0})).finally((()=>{this._searchCachePromise=void 0,this._searchCacheLoading=!1})))}_updateSearchCache(){const e=C.default.getFilteredSortedAddressBookContacts("",!0,!1);a.each(e,(e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:""},a.remove(this._searchCache,(t=>t.contact.uniqueId===this._searchContacts[e.getUniqueId()].uniqueId)),a.each(e.phones,((t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})}))})),g.log(p.LogTraceArea.DialerStore,"Contact search: [update], AB contacts: ["+e.length+"] Contacts cache: ["+a.size(this._searchContacts)+"], Search cache: ["+a.size(this._searchCache)+"]"),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache)}_scheduleSearch(e){if(this._cancelOngoingSearch(),!this._phoneNumber.searchable)return;this.initializeSearch();const t=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;this._phoneNumberHandlingPromise=f.default.sleep(t.ExecutionDelay).then((()=>{this._resetSearchResults();const i={resultsName:[],resultsNumber:[]};a.isEmpty(this._searchResults.query)||(a.each(this._searchCache,(e=>{if(t.T9SearchEnabled){let t=e.phone.number.indexOf(this._searchResults.query);t>=0?(e.matchedString=this._searchResults.query,i.resultsNumber.push(e)):(t=e.t9SearchHash.indexOf(this._searchResults.query),t>=0&&(e.matchedString=e.contact.displayName.substring(t,this._searchResults.query.length+t),i.resultsName.push(e)))}else a.startsWith(e.phone.number,this._searchResults.query)&&(e.matchedString=this._searchResults.query,i.resultsNumber.push(e));e.phone.number===this._searchResults.query&&(this._searchResults.exactMatch=e)})),this._searchResults.results=i.resultsName.concat(i.resultsNumber),this._searchResults.sessionId=e,(0,T.searchResultsReceived)(b.ScenarioSearchTypes.FastContacts,e,this._isZeroTermSearch()))})).always((()=>{g.log(p.LogTraceArea.DialerStore,"Contact search: [results], Partial match: ["+this._searchResults.results.length+"] Exact match: ["+!!this._searchResults.exactMatch+"]"),this._phoneNumberHandlingPromise=void 0,this.trigger(v.SearchResults)}))}_isZeroTermSearch(){return 0===this._phoneNumber.inputValue.length}_cancelOngoingSearch(){if(this._phoneNumberHandlingPromise){const e=this._phoneNumberHandlingPromise;this._phoneNumberHandlingPromise=void 0,e.cancel()}}_resetSearchResults(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch.T9SearchEnabled;this._searchResults.query=h.DialerSearchUtils.getSearchCriteria(this._phoneNumber,e),this._searchResults.results=[],this._searchResults.exactMatch=void 0,this._searchResults.selectedResult=void 0,this._searchResults.preselected=void 0}destroySearch(){if(this._cancelOngoingSearch(),this._searchInitialized&&(this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCachePromise)){const e=this._searchCachePromise;this._searchCacheLoading=!1,this._searchCachePromise=void 0,e.cancel()}this._localAddressBookSubToken&&(C.default.unsubscribe(this._localAddressBookSubToken),this._localAddressBookSubToken=void 0),this._resetSearchResults(),this.trigger(v.SearchResults),g.log(p.LogTraceArea.DialerStore,"Contact search: [destroy]")}initializeCountrySelection(){g.log(p.LogTraceArea.DialerStore,"CountrySelection: [init]");const e=a.sortBy(a.filter((0,d.default)().getAllConversationsInMemory(),(e=>e.isCurrentUserMember()&&!!e.lastCallTime&&l.isPhoneMri(e.id))),(e=>-1*(e.lastCallTime||0))),t=(0,r.chain)(e,(0,r.map)((e=>this._getRegionCodeForConversation(e))),(0,r.uniq)(),(0,r.compact)());this._lastCalledCountryCodes=(0,r.chain)(t,(0,r.take)(5),(0,r.map)((e=>["recent_"+e,m.default.getCountryByCode(e)])),(0,r.fromPairs)()),this._preselectCountry()}destroyCountrySelection(){this._lastCalledCountryCodes={},this._selectedCountry=void 0,this._defaultCountry=void 0,g.log(p.LogTraceArea.DialerStore,"CountrySelection: [destroy]")}resetPhoneNumber(){this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},g.log(p.LogTraceArea.DialerStore,"PhoneNumber: [destroy]")}_setInputValue(e,t=!0){const i=a.uniqueId("Query");if((0,T.willSearch)(b.ScenarioSearchTypes.FastContacts,i),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [before] "+u.default.phoneNumberToString(this._phoneNumber)),this._phoneNumber.searchable=t,this._phoneNumber.inputValue===e)return;let o=this._processPhoneNumber(e);0!==o.length&&(o=a.uniq(o.concat(this._identifyEmergencyNumber())),this._identifyCallableNumber()&&o.push(v.Callable),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): TriggerEvents",o),this.trigger(o),(0,T.searchCallSent)(b.ScenarioSearchTypes.FastContacts,i,this._isZeroTermSearch()),this._scheduleSearch(i),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [after] "+u.default.phoneNumberToString(this._phoneNumber)))}_processPhoneNumber(e){const t=[];e=u.default.normalizePhoneNumber(e);const i=S.default.stripPossibleExtension(e);return this._recalculatePhoneNumberPrefix(i)&&(t.push(v.Prefix),this._recalculatePhoneNumberCountry()),this._phoneNumber.suffix=u.default.getPhoneNumberSuffix(i,this._phoneNumber.prefix),this._phoneNumber.extension=S.default.getPossibleExtension(e,!0),u.default.isE164Format(i)&&(e=u.default.getFormattedPhoneNumber(e,this._phoneNumber.prefix)),this._phoneNumber.inputValue!==e&&(this._phoneNumber.inputValue=e,t.unshift(v.InputValue),this._recalculatePhoneNumberE164Format()&&t.push(v.E164)),t}_identifyEmergencyNumber(){let e=[],t=!1;if(u.default.isEmergencyNumber(this._phoneNumber)){t=!0;const i=u.default.getEmergencyCallingCountrySubstitute(this._phoneNumber.countryCode);if(i&&!u.default.isE164Format(this._phoneNumber.inputValue)){const t=u.default.getE164FormattedPhoneNumber(a.toString(i.countryCode),this._phoneNumber.suffix);e=this._processPhoneNumber(t),this._phoneNumber.forceChangedPrefix=!0}else this._phoneNumber.forceChangedPrefix=!1}return this._phoneNumber.emergency!==t&&(this._phoneNumber.emergency=t,e.push(v.Emergency),t&&g.track(new _.EmergencyNumber)),e}_identifyCallableNumber(){const e=u.default.isCallableNumber(this._phoneNumber);return this._phoneNumber.callable!==e&&(this._phoneNumber.callable=e,!0)}_recalculatePhoneNumberPrefix(e){if(this._phoneNumber.prefix&&1===e.indexOf(this._phoneNumber.prefix))return!1;let t;if(0!==e.indexOf("+")&&e.length>0){const e=this._selectedCountry||this._defaultCountry;e&&(t=a.toString(e.countryCode))}else t=u.default.getPhoneNumberPrefix(e,this._getPhoneNumberPrefixIndex());return this._phoneNumber.prefix!==t&&(this._phoneNumber.prefix=t,!0)}_recalculatePhoneNumberCountry(){const e=u.default.getPhoneNumberPrefixCountry(this._phoneNumber.prefix,this._getPhoneNumberPrefixIndex());e?this._phoneNumber.countryCode!==e.country&&(this._phoneNumber.countryCode=e.country,this._selectedCountry&&a.toString(this._selectedCountry.countryCode)===this._phoneNumber.prefix||this.setSelectedCountry(e)):this._selectedCountry&&(this._phoneNumber.countryCode=void 0,this.setSelectedCountry(void 0))}_recalculatePhoneNumberE164Format(){const e=u.default.getE164FormattedPhoneNumber(this._phoneNumber.prefix,this._phoneNumber.suffix);return this._phoneNumber.E164!==e&&(this._phoneNumber.E164=e,!0)}_setDefaultCountry(e){!e||this._defaultCountry&&this._defaultCountry.country===e.country||(void 0!==this._defaultCountry&&u.default.setDefaultPstnDestinationCountryCode(e.country),g.log(p.LogTraceArea.DialerStore,"Default country state changed, from ["+JSON.stringify(this._defaultCountry)+"] to ["+JSON.stringify(e)+"]"),this._defaultCountry=e)}_getRegionCodeForConversation(e){const t=l.stripMriNamespace(e.id);if(u.default.containsNonGeographicOrTestPrefixes(t))return;const i=S.default.parseAndKeepRawInput(t),o=S.default.getRegionCodeForNumber(i);return o?o.toLowerCase():void 0}_getPhoneNumberPrefixIndex(){return this._phoneNumberPrefixIndex.indexSize<=0&&(this._phoneNumberPrefixIndex=u.default.getCountryDestinationPrefixIndex(m.default.getCountries()),g.log(p.LogTraceArea.DialerStore,"PhoneNumberPrefixIndex init, indexSize:",this._phoneNumberPrefixIndex.indexSize)),this._phoneNumberPrefixIndex}setPhoneNumberOrigin(e){this._phoneNumberOrigin=e}resetPhoneNumberOrigin(){this._phoneNumberOrigin=void 0}getPhoneNumberOrigin(){return this._phoneNumberOrigin}preselectSavedContact(e){const t=y.default.getFullUserProfileByMriNoSubscription(e);if(t&&t.phones){this._resetSearchResults(),this._searchInitialized=!1;const e={contact:{displayName:t.getDisplayName(),uniqueId:t.getUniqueId(),userMri:t.getMri()},phone:t.phones[0]};this.overwritePhoneNumberInput(e.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSaveContact),this._searchResults.results=[e],this._searchResults.exactMatch=e,this._searchResults.selectedResult=e,this._searchResults.preselected=!0,this.trigger(v.SearchResults)}}};o.__decorate([n.autoSubscribe,o.__param(0,n.key)],I.prototype,"getPhoneNumber",null),o.__decorate([(0,n.autoSubscribeWithKey)(v.SearchResults)],I.prototype,"getSearchResults",null),o.__decorate([(0,n.autoSubscribeWithKey)(v.SelectedCountry)],I.prototype,"getSelectedCountry",null),o.__decorate([(0,n.autoSubscribeWithKey)(v.SelectedCountry)],I.prototype,"getDefaultCountry",null),o.__decorate([(0,n.autoSubscribeWithKey)([v.SelectedCountry,v.SearchResults])],I.prototype,"getAccessibilitySummary",null),I=o.__decorate([n.AutoSubscribeStore],I),t.default=new I},328416:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=o.__importStar(i(516778)),s=i(217041),r=o.__importStar(i(397691)),l=i(284841),c=i(434343),d=o.__importStar(i(235256)),u=o.__importDefault(i(652032)),h=o.__importStar(i(678032)),p=o.__importStar(i(704704)),g=o.__importDefault(i(201721)),C=o.__importDefault(i(419864)),m=o.__importStar(i(446574)),S=o.__importDefault(i(655192)),_=o.__importDefault(i(815899));let f=class extends s.StoreBase{constructor(){super(),this._handleMemoryWarningEvent=()=>{this._countries={}},this._updateData=(e,t)=>{this._countries=(0,l.chain)(e,(0,l.uniqBy)((e=>e.MSShort)),(0,l.map)((e=>{const t=Number(e.TAPICode);if(!isNaN(t))return{country:a.toLower(e.MSShort),countryName:e.CountryRegionName,countryCode:t}})),(0,l.compact)(),(0,l.keyBy)((e=>e.country)));const i={countries:this._countries,language:t};u.default.putData(c.InternalKeys.PhoneCountryCache,i),this._locale=t,this.trigger()},p.localeChangedEvent.subscribe((e=>{m.HasStarted(this)&&e!==this._locale&&this._requestCountryConfig(e)})),m.RegisterStartupable(this,"PhoneCountryStore",[d.default,u.default,g.default])}startup(){return this._countries={},this._locale=p.getLocale(),n.App.memoryWarningEvent.subscribe(this._handleMemoryWarningEvent),d.default.setRefreshOptions(c.InternalKeys.PhoneCountryCache,{interval:6048e5,taskTypeFlags:d.TaskTypeFlags.UsesNetworking,callback:()=>this._requestCountryConfig(p.getLocale())}),r.Resolved()}getCountries(){return this._getCountries()}getCountriesFromBackupNoSubscription(e=!0){return(0,l.chain)(_.default,(0,l.uniqBy)((e=>e.MSShort)),(0,l.map)((e=>{const t=Number(e.TAPICode);if(!isNaN(t))return{country:a.toLower(e.MSShort),countryName:e.CountryRegionName,countryCode:t}})),(0,l.compact)(),(0,l.keyBy)((t=>e?t.countryCode:t.country)))}getCountryByCode(e){return this._getCountries()[e]}getCountryByCodeNoSubscription(e){return this._getCountries()[e]}getCountriesByCode(e){const t=[];return e.forEach((e=>{const i=this.getCountryByCodeNoSubscription(e.toLowerCase());i&&t.push(i)})),t}_getCountries(){if(a.isEmpty(this._countries)){const e=u.default.getData(c.InternalKeys.PhoneCountryCache);this._countries=e&&e.countries||{},a.isEmpty(this._countries)?(this._loadDataFromBackupFile(),m.EnsureStarted(this).then((()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)}))):e&&e.language!==p.getLocale()&&m.EnsureStarted(this).then((()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)}))}return this._countries}_requestCountryConfig(e,t=!0){return C.default.getConfig(e).then((t=>this._updateData(t,e))).catch((i=>{if(404===i.statusCode&&t){const t=this._getFallbackLocale(e);if(t!==e)return void this._requestCountryConfig(t,!1)}a.isEmpty(this._countries)&&this._loadDataFromBackupFile()}))}_loadDataFromBackupFile(){this._updateData(_.default,"en-US")}_getFallbackLocale(e){const t=e&&e.split("-")[0],i=h.getDefaultLocale(t);return`${t}-${S.default.toUpper(i)}`}};o.__decorate([s.autoSubscribe],f.prototype,"getCountries",null),o.__decorate([s.autoSubscribe,o.__param(0,s.key)],f.prototype,"getCountryByCode",null),o.__decorate([o.__param(0,s.key)],f.prototype,"getCountryByCodeNoSubscription",null),f=o.__decorate([s.AutoSubscribeStore],f),t.default=new f},102771:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(217041),n=o.__importStar(i(397691)),s=o.__importStar(i(44717)),r=o.__importDefault(i(604266));let l=class extends a.StoreBase{constructor(){super(...arguments),this._phoneNumberUserMri={}}_startedTrackingKey(e){const t=r.default.getUserByPhoneNumberExactMatch(e);this._phoneNumberUserMri[e]=t?t.getMri():void 0,this._updateUserMriByPhoneNumber(e)}getConversationMri(e){return this._phoneNumberUserMri[e]}getConversationMriAsync(e){const t=s.getPhoneNumberFromMri(e);return t?this._updateUserMriByPhoneNumber(t).then((()=>this._phoneNumberUserMri[t]||e)):n.Resolved(e)}_updateUserMriByPhoneNumber(e){return r.default.getUserByPhoneNumberExactMatchAsync(e).then((t=>{this._phoneNumberUserMri[e]=t?t.getMri():void 0,this.trigger(e)}))}};o.__decorate([a.disableWarnings],l.prototype,"_startedTrackingKey",null),o.__decorate([a.autoSubscribe,o.__param(0,a.key)],l.prototype,"getConversationMri",null),l=o.__decorate([a.AutoSubscribeStore],l),t.default=new l},495193:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(217041),n=i(496486),s=o.__importDefault(i(369347)),r=i(929154),l=i(771895),c=o.__importDefault(i(341994));function d(e,t){s.default.CallingStore.setTruVoiceTranslationState(e,t)}let u=class extends r.InCallFeatureConsentStore{constructor(){super(...arguments),this._setLocalConsent=e=>{s.default.CallingStore.setHasTruVoiceTranslationConsent(e)},this._getLocalConsent=()=>c.default.getCallTranslatorTruVoiceConsent(),this._isInCallFeatureSupported=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,n.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberSupportsTruVoiceTranslation(e,i.id)||(t=!1)})):t=!1,t},this._didOtherUsersProvideConsent=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,n.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberHasTruVoiceTranslationConsent(e,i.id)||(t=!1)})):t=!1,t},this._updateRosterState=(e,t)=>{(0,n.delay)(d,this._getRosterUpdateDelay(),e,t.getTransitionAction())},this._getInCallFeatureTransitionRequestFromRoster=(e,t)=>{var i;return null===(i=null==t?void 0:t.truVoiceTranslationState)||void 0===i?void 0:i[e]},this._resetToInitialState=e=>{this._inCallFeatureStateMachine[e]=new l.InCallFeatureDisabledState((()=>this._getLocalConsent()),(()=>this._didOtherUsersProvideConsent(e)),(()=>this._isInCallFeatureSupported(e)),e)},this._getInCallFeatureName=()=>"[TruVoiceTranslation]"}};u=o.__decorate([a.AutoSubscribeStore],u),t.default=new u},190099:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalVideoState=void 0;const o=i(197582),a=i(217041),n=i(815146),s=o.__importStar(i(85385)),r=o.__importDefault(i(655192));let l=class extends a.StoreBase{constructor(e){super(),this._call=e,this._enabled=!1,this._overrides=[],this._updateVideoPromise=Promise.resolve(!1),this._updateVideo=e=>{const t=this._isLocalVideoActivated();return t===e?e:t?this._call.startVideo().then((()=>!0),(t=>(s.error(n.LogTraceArea.Calling,`Failed to start local video. ${r.default.errorAsString(t,!0)}`),e))):this._call.stopVideo().then((()=>!1),(t=>(s.error(n.LogTraceArea.Calling,`Failed to stop local video. ${r.default.errorAsString(t,!0)}`),e)))}}setLocalVideoEnabled(e){this._enabled!==e&&(this._enabled=e,this._trigger())}isLocalVideoEnabled(){return this._enabled}setLocalVideoOverride(e){this._overrides.includes(e)||(this._overrides.push(e),this._trigger())}clearLocalVideoOverride(e){const t=this._overrides.indexOf(e);t>=0&&(this._overrides.splice(t,1),this._trigger())}_isLocalVideoActivated(){return this._enabled&&0===this._overrides.length}isLocalVideoActivated(){return this._isLocalVideoActivated()}_trigger(){this._updateVideoPromise=this._updateVideoPromise.then(this._updateVideo),this.trigger()}};t.LocalVideoState=l,o.__decorate([a.autoSubscribe],l.prototype,"isLocalVideoActivated",null),t.LocalVideoState=l=o.__decorate([a.AutoSubscribeStore],l)},608287:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteStreamStarter=void 0;const o=i(197582),a=i(815146),n=o.__importStar(i(85385));class s{constructor(e){this._singleRendererPerStream=e,this._startedStreams=new Map,this._maximumVideoCount=0,this._pendingAcquires=[]}setMaximumVideoCount(e){this._maximumVideoCount=e,this._processAcquires()}_releaseSlot(e){let t=this._startedStreams.get(e);t&&(--t,n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] release slot { stream: ${e.id}, remainingAcquires: ${t} }`),t?this._startedStreams.set(e,t):(this._startedStreams.delete(e),this._processAcquires()))}_acquireSlot(e,t){const i=new Promise(((i,o)=>{this._pendingAcquires.push({stream:e,resolve:i,reject:o,startId:t})})),o=this._pendingAcquires[this._pendingAcquires.length-1];return this._processAcquires(),Object.assign(i,{cancel:()=>{const e=this._pendingAcquires.indexOf(o);e>=0&&(this._pendingAcquires.splice(e,1),o.reject())}})}_processAcquires(){for(let e=0;e<this._pendingAcquires.length;){const{stream:t,resolve:i,startId:o}=this._pendingAcquires[e];!(!this._maximumVideoCount||this._startedStreams.size<this._maximumVideoCount||this._startedStreams.has(t))||this._singleRendererPerStream&&this._startedStreams.has(t)?++e:(this._pendingAcquires.splice(e,1),this._startedStreams.set(t,(this._startedStreams.get(t)||0)+1),n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] slot acquired { stream: ${t.id}, startId: ${o} }`),i())}}startStream(e,t,i,o){const r=s._nextStartId++;n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] acquire slot { startId: ${r}, stream: ${t.id}, participant: ${t.participantId}, endpoint: ${t.endpointId} }`),e("Acquiring video slot...");const l=this._acquireSlot(t,r),c=l.then((()=>{n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] start stream { startId: ${r} }`),e("Starting stream...");const s=t.start(i,o);return s.catch((e=>{n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] start stream failed { startId: ${r}, reason: ${e} }`),this._releaseSlot(t)})),s.then((e=>{n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] start stream succeeded { startId: ${r} }`);const i=this,{dispose:o}=e;return e.dispose=function(){this.dispose=o,o.apply(this,arguments),i._releaseSlot(t)},e}))}));return Object.assign(c,{cancel:()=>l.cancel()})}}t.RemoteStreamStarter=s,s._nextStartId=0},514131:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoOverrides=void 0;const o=i(197582),a=i(217041);let n=class extends a.StoreBase{constructor(){super(...arguments),this._remoteStreamOverrides=[]}setRemoteStreamOverride(e){return!this._remoteStreamOverrides.includes(e)&&(this._remoteStreamOverrides.push(e),this.trigger(e),!0)}clearRemoteStreamOverride(e){const t=this._remoteStreamOverrides.indexOf(e);return!(t<0)&&(this._remoteStreamOverrides.splice(t,1),this.trigger(e),!0)}hasAnyRemoteStreamOverride(e=[]){return this._remoteStreamOverrides.some((t=>!e.includes(t)))}hasSpecificRemoteStreamOverride(e){return this._remoteStreamOverrides.includes(e)}};t.VideoOverrides=n,o.__decorate([a.autoSubscribe],n.prototype,"hasAnyRemoteStreamOverride",null),o.__decorate([a.autoSubscribe,o.__param(0,a.key)],n.prototype,"hasSpecificRemoteStreamOverride",null),t.VideoOverrides=n=o.__decorate([a.AutoSubscribeStore],n)},962234:(e,t)=>{var i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.MicrophoneSettingsOrigin=t.SettingsMode=void 0,function(e){e[e.All=0]="All",e[e.Audio=1]="Audio",e[e.Video=2]="Video"}(i||(t.SettingsMode=i={})),function(e){e[e.AVSettings=0]="AVSettings",e[e.InCallPopup=1]="InCallPopup"}(o||(t.MicrophoneSettingsOrigin=o={}))},189963:(e,t)=>{var i,o,a,n,s,r;Object.defineProperty(t,"__esModule",{value:!0}),t.TransferStatus=t.CallDirection=t.CallType=t.CallState=t.CallSessionType=t.ParticipantType=void 0,function(e){e.Default="default",e.Voicemail="voicemail"}(i||(t.ParticipantType=i={})),function(e){e.Default="default",e.ScreenSharing="screenSharing"}(o||(t.CallSessionType=o={})),function(e){e.Failed="failed",e.Missed="missed",e.Accepted="accepted",e.Declined="declined",e.AcceptedElsewhere="acceptedElsewhere"}(a||(t.CallState=a={})),function(e){e.TwoParty="twoParty",e.MultiParty="multiParty"}(n||(t.CallType=n={})),function(e){e.Incoming="incoming",e.Outgoing="outgoing"}(s||(t.CallDirection=s={})),function(e){e.Transferred="transferred",e.TransferAccepted="transferAccepted",e.TransferFailed="transferFailed",e.TransferSucceeded="transferSucceeded"}(r||(t.TransferStatus=r={}))},619429:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingPrefix=t.EcoMode=t.SlimcoreSetupKeys=t.KeyDistributionUrlType=t.UdpTransportUrlType=t.ConversationServiceUrlType=t.InCallFeatureTransitionAction=t.InCallFeatureState=t.TranslationState=t.StartCallOrMaybePromptUserIntent=t.UnansweredCallVisualInfoType=t.UnansweredCallVisualInfo=t.UnansweredCallAction=t.UnansweredCallReason=t.CallingError=t.CallValidationFailureReason=t.CallAction=t.LocalCallActions=t.VideoOverrideReason=t.CallDeviceQualityEventType=t.CallDeviceState=t.CallNetworkQualityEventType=t.NetworkConnectionState=void 0,t.redactedAnswerOrJoinOptions=function(e){return(0,o.mapProperties)(e,((e,t)=>"callJoinContext"===e?w(t):t))},t.redactedLiveState=w;const o=i(156532);var a,n,s,r,l,c,d,u,h,p,g,C,m,S,_,f,y,T,b,v;!function(e){e[e.Unknown=0]="Unknown",e[e.LostConnection=1]="LostConnection",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected"}(a||(t.NetworkConnectionState=a={})),function(e){e[e.Unknown=0]="Unknown",e[e.NetworkReconnection=1]="NetworkReconnection",e[e.NetworkReceiveQuality=2]="NetworkReceiveQuality",e[e.NetworkReceiveCatastrophic=3]="NetworkReceiveCatastrophic",e[e.NetworkSendCatastrophic=4]="NetworkSendCatastrophic"}(n||(t.CallNetworkQualityEventType=n={})),function(e){e[e.Working=0]="Working",e[e.NotWorking=1]="NotWorking"}(s||(t.CallDeviceState=s={})),function(e){e[e.None=0]="None",e[e.AudioStoppedWorking=1]="AudioStoppedWorking",e[e.AudioDeviceBusy=2]="AudioDeviceBusy",e[e.AudioDeviceMuted=3]="AudioDeviceMuted",e[e.MicrophoneStoppedWorking=4]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=5]="SpeakerStoppedWorking",e[e.VideoStoppedWorking=6]="VideoStoppedWorking",e[e.VideoTimedOut=7]="VideoTimedOut",e[e.VideoCameraBusy=8]="VideoCameraBusy",e[e.VideoSystemOutOfMemory=9]="VideoSystemOutOfMemory",e[e.DeviceCausingEcho=10]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=11]="MicrophoneNotMuteButSilent",e[e.DeviceRenderGlitches=12]="DeviceRenderGlitches",e[e.DeviceLowSNR=13]="DeviceLowSNR",e[e.DeviceClipping=14]="DeviceClipping",e[e.DeviceEcho=15]="DeviceEcho",e[e.DeviceMultipleEndpoints=16]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=17]="DeviceRenderZeroVolume",e[e.CpuInsufficient=18]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=19]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=20]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=21]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=22]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=23]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=24]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=25]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=26]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=27]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=28]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=29]="MusicModeNotAvailable",e[e.CameraLighting=30]="CameraLighting",e[e.AudioCaptureMusicDetectedWithHighNS=31]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithHighNSNotAvailable=32]="AudioCaptureMusicDetectedWithHighNSNotAvailable",e[e.AudioCaptureMusicDetectedWithLowNS=33]="AudioCaptureMusicDetectedWithLowNS",e[e.MusicModeSupported=34]="MusicModeSupported"}(r||(t.CallDeviceQualityEventType=r={})),function(e){e[e.Logout=0]="Logout",e[e.InBackground=1]="InBackground",e[e.AudioOnlyMode=2]="AudioOnlyMode",e[e.IncomingVideoDisabled=3]="IncomingVideoDisabled",e[e.FullScreenBot=4]="FullScreenBot"}(l||(t.VideoOverrideReason=l={})),function(e){e[e.None=0]="None",e[e.Initialized=1]="Initialized",e[e.StartedWithRing=2]="StartedWithRing",e[e.StartedGoLive=4]="StartedGoLive",e[e.Joined=8]="Joined",e[e.Answered=16]="Answered",e[e.Rejected=32]="Rejected",e[e.Ended=64]="Ended"}(c||(t.LocalCallActions=c={})),function(e){e.Initialize="initialize",e.Start="start",e.Join="join",e.Answer="answer",e.AnswerOrJoin="answerOrJoin",e.Merge="merge",e.Reject="reject",e.End="end"}(d||(t.CallAction=d={})),function(e){e[e.None=0]="None",e[e.InvalidLiveState=1]="InvalidLiveState",e[e.InvalidParameters=2]="InvalidParameters",e[e.PlatformNotSupported=3]="PlatformNotSupported",e[e.CalleeIsBlocked=4]="CalleeIsBlocked",e[e.CallingNotAllowed=5]="CallingNotAllowed",e[e.CallNotFound=6]="CallNotFound",e[e.ConversationNotFound=7]="ConversationNotFound",e[e.NoCameraPermission=8]="NoCameraPermission",e[e.NoMicPermission=9]="NoMicPermission",e[e.NoMicDetected=10]="NoMicDetected",e[e.OtherCallsOngoing=11]="OtherCallsOngoing",e[e.GogoNetwork=12]="GogoNetwork",e[e.CalleeDoesNotSupportCalling=13]="CalleeDoesNotSupportCalling",e[e.GroupTooLarge=14]="GroupTooLarge",e[e.OnePersonGroup=15]="OnePersonGroup",e[e.E2eeHandshakeIncomplete=16]="E2eeHandshakeIncomplete",e[e.RegularMemberInModeratedGroup=17]="RegularMemberInModeratedGroup",e[e.NoReadPhoneStatePermission=18]="NoReadPhoneStatePermission",e[e.RegisterActiveCallFailure=19]="RegisterActiveCallFailure",e[e.RejectWhenAcceptFailure=20]="RejectWhenAcceptFailure",e[e.AssumedOutGoingCallFailure=21]="AssumedOutGoingCallFailure"}(u||(t.CallValidationFailureReason=u={}));class I extends Error{constructor(e,t,i,o,a,n,s){super(i),this.callId=e,this.action=t,this.message=i,this.terminatedReason=o,this.failureType=a,this.validationReason=n,this.causeId=s}}t.CallingError=I,function(e){e[e.None=0]="None",e[e.PstnNumberUnavailable=1]="PstnNumberUnavailable",e[e.PstnCallTerminated=2]="PstnCallTerminated",e[e.PstnNumberForbidden=3]="PstnNumberForbidden",e[e.PstnBlockedByUs=4]="PstnBlockedByUs",e[e.PstnCouldNotConnectToSkypeProxy=5]="PstnCouldNotConnectToSkypeProxy",e[e.PstnSkypeoutAccountBlocked=6]="PstnSkypeoutAccountBlocked",e[e.NoAnswer=7]="NoAnswer",e[e.Decline=8]="Decline",e[e.DeclineParticipant=9]="DeclineParticipant",e[e.Unreachable=10]="Unreachable",e[e.LocalNetworkError=11]="LocalNetworkError",e[e.NoMicrophoneDetected=12]="NoMicrophoneDetected",e[e.MicrophonePermissionDenied=13]="MicrophonePermissionDenied",e[e.CameraPermissionDenied=14]="CameraPermissionDenied",e[e.MicAndCamPermissionDenied=15]="MicAndCamPermissionDenied",e[e.Unknown=16]="Unknown",e[e.InvalidNumber=17]="InvalidNumber",e[e.EmergencyCallDenied=18]="EmergencyCallDenied",e[e.Kicked=19]="Kicked",e[e.InsufficientFunds=20]="InsufficientFunds",e[e.BlockedRegulatoryIndia=21]="BlockedRegulatoryIndia",e[e.BlockedRegulatoryNetherlands=22]="BlockedRegulatoryNetherlands",e[e.TransferedToTwinCam=23]="TransferedToTwinCam",e[e.KickedOwn=24]="KickedOwn",e[e.ReadPhoneStatePermissionDenied=25]="ReadPhoneStatePermissionDenied"}(h||(t.UnansweredCallReason=h={})),function(e){e[e.None=0]="None",e[e.SendMessage=1]="SendMessage",e[e.PromptForPermission=2]="PromptForPermission",e[e.SendFeedback=3]="SendFeedback",e[e.CallPSTN=4]="CallPSTN",e[e.ShowRegulatoryInfoIndia=5]="ShowRegulatoryInfoIndia",e[e.ShowRegulatoryInfoNetherlands=6]="ShowRegulatoryInfoNetherlands"}(p||(t.UnansweredCallAction=p={}));function w(e){return(0,o.mapProperties)(e,(0,o.mapperRedact)(["groupCallInitiator"]))}t.UnansweredCallVisualInfo=class{},function(e){e[e.Emoticon=0]="Emoticon",e[e.Icon=1]="Icon"}(g||(t.UnansweredCallVisualInfoType=g={})),function(e){e[e.Generic=0]="Generic",e[e.Video=1]="Video",e[e.Audio=2]="Audio"}(C||(t.StartCallOrMaybePromptUserIntent=C={})),function(e){e[e.Disabled=0]="Disabled",e[e.Requested=1]="Requested",e[e.Pending=2]="Pending",e[e.Enabled=3]="Enabled",e[e.Cancelled=4]="Cancelled",e[e.Declined=5]="Declined"}(m||(t.TranslationState=m={})),function(e){e[e.NotSupported=0]="NotSupported",e[e.Failed=1]="Failed",e[e.RemoteFailed=2]="RemoteFailed",e[e.SelfConsentRequested=3]="SelfConsentRequested",e[e.SelfConsentRejected=4]="SelfConsentRejected",e[e.RemoteConsentRequested=5]="RemoteConsentRequested",e[e.RemoteConsentRejected=6]="RemoteConsentRejected",e[e.RemoteConsentCancelled=7]="RemoteConsentCancelled",e[e.ConsentRequestedByRemote=8]="ConsentRequestedByRemote",e[e.Enabled=9]="Enabled",e[e.EnabledByRemote=10]="EnabledByRemote",e[e.Disabled=11]="Disabled",e[e.Stopped=12]="Stopped",e[e.StoppedByRemote=13]="StoppedByRemote"}(S||(t.InCallFeatureState=S={})),function(e){e[e.Start=0]="Start",e[e.Stop=1]="Stop",e[e.RequestConsent=2]="RequestConsent",e[e.RejectConsent=3]="RejectConsent",e[e.Fail=4]="Fail"}(_||(t.InCallFeatureTransitionAction=_={})),function(e){e.Prod="https://api.cc.skype.com/conv/",e.Dev="http://api.conv-dev.skype.net/conv/"}(f||(t.ConversationServiceUrlType=f={})),function(e){e.Prod="udp://api.cc.skype.com:3478/",e.Dev="udp://api.conv-dev.skype.net:11000/"}(y||(t.UdpTransportUrlType=y={})),function(e){e.Prod="https://api.cc.skype.com/kd/",e.Dev="http://api.conv-dev.skype.net/kd/"}(T||(t.KeyDistributionUrlType=T={})),function(e){e.UdpEnabled="*Lib/Call/NG/UdpEnabled",e.EnableUdpCanary="*Lib/Call/NG/EnableUdpCanary",e.EnableEncryptedHttp="*Lib/Call/NG/EnableEncryptedHttp",e.EnableEncryptedHttpForBroker="*Lib/Call/NG/EnableEncryptedHttpForBroker",e.ConversationServiceUrl="*Lib/Call/NG/ConversationServiceUrl",e.UdpTransportUrl="*Lib/Call/NG/UdpTransportUrl",e.KeyDistributionUrl="*Lib/Call/NG/KeyDistributionUrl",e.EnableEcoMode="*Lib/Call/EnableEcoMode",e.EnableDnsCache="*Lib/Call/NG/EnableDnsCache",e.TestContextKey="*Lib/Call/TestContextId",e.ECSClientType="*Lib/ECS/ClientType",e.AutoJoinOnConflict="*Lib/Call/NG/AutoJoinOnConflict",e.AdditionalVideoLinesForGroupCalls="*Lib/Call/NG/AdditionalVideoLinesForGroupCalls",e.MaxNrOfVideosVisibleInUI="*Lib/Call/MaxNrOfVideosVisibleInUI",e.EndpointMetadataSetupKey="*Lib/Call/EndpointMetadata",e.LogLevelKey="*Lib/LogLevel",e.AufLogLevelKey="*Lib/AufObjectLogLevel",e.LogRotationSizeKey="*Lib/Logging/Rotation/RotateSize",e.LogRetentionTimeKey="*Lib/Logging/Rotation/RetentionTime",e.LogULMaxSizeKey="*Lib/RootTools/Logging/Appender/MaxSize",e.LogULMaxFilesKey="*Lib/RootTools/Logging/Appender/MaxRotations",e.DeleteOldLogsKey="*Lib/Logging/Rotation/DeleteOldLogs",e.MediaStackLogEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.PreserveFirstLogKey="*Lib/Logging/Rotation/PreserveFirstLog",e.EdfRegistrationKey="*Lib/Call/NG/ForceEDFRegistration",e.RenewSkypeTokenKey="*Lib/Auth/EnableRenewSkypeToken",e.UiLanguageKey="*Lib/Call/NG/LanguageId",e.EmergencyCallingCountryKey="Lib/Call/EmergencyCountry",e.MediaLibraryLogFileEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.AsyncMediaInitKey="*Lib/AsyncMediaInit"}(b||(t.SlimcoreSetupKeys=b={})),function(e){e[e.Off=0]="Off",e[e.MobileNetwork=1]="MobileNetwork",e[e.AllNetworks=2]="AllNetworks"}(v||(t.EcoMode=v={})),t.ScreenSharingPrefix="ss_"},249549:(e,t)=>{var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonEvents=t.Buttons=t.Tab=void 0,function(e){e[e.Calls=0]="Calls",e[e.Phone=1]="Phone"}(i||(t.Tab=i={})),function(e){e[e.SkypeCredit=0]="SkypeCredit",e[e.SkypeToPhone=1]="SkypeToPhone",e[e.SkypeNumber=2]="SkypeNumber",e[e.CreditBar=3]="CreditBar",e[e.MeetNow=4]="MeetNow",e[e.AudioCall=5]="AudioCall"}(o||(t.Buttons=o={})),function(e){e[e.Press=0]="Press"}(a||(t.ButtonEvents=a={}))},460515:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioNotificationOffset=t.MobileLayoutPickerItemHeight=t.DesktopLayoutPickerItemHeight=t.BigTrayCallParticipantAvatarSize=t.BigTrayOverflowButtonSize=t.BigTrayCallParticipantMainAxisSize=t.CallPanelHeaderHeight=t.LocalParticipantViewPosition=t.DesktopMinCallPanelHeaderV2WidthBreakpoint=t.DesktopMinCallRibbonWidthBreakpoint=t.DesktopMinCallPanelHeaderWidthBreakpoint=t.DesktopMinSmallestNewCallControlsWidthBreakpoint=t.DesktopMediumtNewCallControlsWidthBreakpoint=t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=t.DesktopMinNewCallControlsWidthBreakpoint=t.ParticipantEventType=t.CallControlsType=t.ReactionsItemType=t.PhotoAnimationDirection=t.ToastActionType=t.CallRosterOrigin=t.LayoutPickerMenuItemType=t.StageMode=t.DeviceStatusToastType=t.CallControlsKeys=t.InCallWarningViewType=t.CallParticipantStreamsStatus=t.ActiveCallStatus=t.VideoStatus=t.CallPanelHeaderLayout=t.LayoutInfoVideoType=t.AndroidBackCameraPattern=t.AndroidFrontCameraPattern=t.MobileTopTraySizeMultiplier=t.MobileNewHeaderHeight=t.DesktopTopTrayHeight=t.DesktopNewHeaderHeight=t.DesktopCallControlsHeight=t.CallStageViewMode=t.CallControlsOverflowItem=t.CallStageConfig=t.CallButtonSizes=t.RibbonSizes=t.CallAccessoryType=t.CallAccessoryPosition=t.HoveringParticipantSource=t.CallStageElementKeys=t.CallingViewUIPostion=t.CallingViewCornerPostion=t.CallUIState=void 0,t.CallTranscriptionLeftViewMinWidth=t.CallTranscriptionBottomViewMinHeight=void 0;const o=i(641400);var a,n,s,r,l,c,d,u,h,p,g,C,m,S,_,f,y,T,b,v,I,w,P,M,D;!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.IncomingRing=2]="IncomingRing",e[e.OutgoingRing=3]="OutgoingRing",e[e.Disconnected=4]="Disconnected",e[e.Voicemail=5]="Voicemail",e[e.GoLiveSinglePlayer=6]="GoLiveSinglePlayer"}(a||(t.CallUIState=a={})),function(e){e[e.NotAtCorner=0]="NotAtCorner",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.BottomLeft=3]="BottomLeft",e[e.BottomRight=4]="BottomRight"}(n||(t.CallingViewCornerPostion=n={})),function(e){e[e.Stage=0]="Stage",e[e.Ribbon=1]="Ribbon",e[e.FloatingOnTop=2]="FloatingOnTop",e[e.RibbonWidowsMode=3]="RibbonWidowsMode"}(s||(t.CallingViewUIPostion=s={})),t.CallStageElementKeys={remainderViewKey:"ringingview",callstageViewKey:"callview",screenShareViewKey:"screenshareview",callTextReactionViewKey:"calltextreactionview",ribbonModeViewKey:"ribbonmode",localUserKey:"local",addToCallViewKey:"addtocall",bingBackgrounds:"bingBackgrounds"},function(e){e[e.Participant=1]="Participant",e[e.Nametag=2]="Nametag"}(r||(t.HoveringParticipantSource=r={})),function(e){e[e.Center=1]="Center",e[e.TopLeft=2]="TopLeft",e[e.TopRight=3]="TopRight",e[e.BottomLeft=4]="BottomLeft",e[e.BottomRight=5]="BottomRight",e[e.BottomLeftSmallPadding=6]="BottomLeftSmallPadding",e[e.BottomRightSmallPadding=7]="BottomRightSmallPadding"}(l||(t.CallAccessoryPosition=l={})),function(e){e[e.Mute=1]="Mute",e[e.OnHold=2]="OnHold",e[e.Screensharing=3]="Screensharing"}(c||(t.CallAccessoryType=c={})),t.RibbonSizes={ribbonItemSizeSmall:60,ribbonItemSizeLarge:100,defaultRibbonItemTopMargin:16,ribbonItemModernStageTopMargin:10,ribbonItemInnerMargin:16,ribbonItemMargin:16,ribbonItemRectBorderRadius:10,ribbonDropTargetSmallHeight:80,ribbonDropTargetLargeHeight:132,ribbonModeElementSize:40},t.CallButtonSizes={callbuttonExtraLargeSize:64,callbuttonLargeSize:52,callbuttonSmallSize:o.IconSize.size40,callbuttonExtraSmallSize:o.IconSize.size32,callbuttonSmallestSize:o.IconSize.size24},t.CallStageConfig={animationDuration:250,maxStageElements:4},function(e){e[e.Reactions=1]="Reactions",e[e.Chat=2]="Chat",e[e.AddPeople=3]="AddPeople",e[e.Gallery=4]="Gallery",e[e.Moments=5]="Moments",e[e.CallRecording=6]="CallRecording",e[e.CallTranslator=7]="CallTranslator",e[e.CallSkypeTranslation=8]="CallSkypeTranslation",e[e.IncomingVideo=9]="IncomingVideo",e[e.AudienceChangeBackground=10]="AudienceChangeBackground",e[e.HeartReaction=11]="HeartReaction",e[e.CelebrationAnimation=12]="CelebrationAnimation",e[e.ThumbsUpReaction=13]="ThumbsUpReaction",e[e.MobileScreenSharing=14]="MobileScreenSharing",e[e.CallStats=15]="CallStats",e[e.BackgroundBlur=16]="BackgroundBlur",e[e.RaiseHands=17]="RaiseHands",e[e.LowerHands=18]="LowerHands",e[e.ChangeTogetherModeBackground=19]="ChangeTogetherModeBackground",e[e.BingBackgrounds=20]="BingBackgrounds",e[e.NoiseSuppression=21]="NoiseSuppression",e[e.Twincam=22]="Twincam",e[e.ToggleHoldCall=23]="ToggleHoldCall",e[e.Participants=24]="Participants",e[e.SwitchCamera=25]="SwitchCamera",e[e.ChangeView=26]="ChangeView"}(d||(t.CallControlsOverflowItem=d={})),function(e){e[e.None=0]="None",e[e.StageAndRibbon=1]="StageAndRibbon",e[e.RibbonOnly=2]="RibbonOnly",e[e.StageOnly=3]="StageOnly"}(u||(t.CallStageViewMode=u={})),t.DesktopCallControlsHeight=70,t.DesktopNewHeaderHeight=40,t.DesktopTopTrayHeight=128,t.MobileNewHeaderHeight=0,t.MobileTopTraySizeMultiplier=.5,t.AndroidFrontCameraPattern="/FRONT/",t.AndroidBackCameraPattern="/BACK/",function(e){e[e.None=1]="None",e[e.Portrait=2]="Portrait",e[e.Landscape=3]="Landscape"}(h||(t.LayoutInfoVideoType=h={})),function(e){e[e.Mobile=0]="Mobile",e[e.Float=1]="Float",e[e.Window=2]="Window",e[e.None=3]="None"}(p||(t.CallPanelHeaderLayout=p={})),function(e){e[e.None=0]="None",e[e.Available=1]="Available",e[e.Streaming=2]="Streaming"}(g||(t.VideoStatus=g={})),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.OnHold=2]="OnHold"}(C||(t.ActiveCallStatus=C={})),function(e){e[e.None=0]="None",e[e.Single=1]="Single",e[e.Multiple=2]="Multiple"}(m||(t.CallParticipantStreamsStatus=m={})),function(e){e[e.Audio=0]="Audio",e[e.Network=1]="Network",e[e.Voicemail=2]="Voicemail",e[e.Forwarding=3]="Forwarding"}(S||(t.InCallWarningViewType=S={})),function(e){e.Mic="mic",e.MicQuickSettings="micQuickSettings",e.Video="video",e.VideoQuickSettings="videoQuickSettings",e.Dialpad="dialpad",e.Participants="participants",e.ScreenShare="screenShare",e.ScreenShareControl="screenShareControl",e.EndCall="endCall",e.RaiseHand="raiseHand",e.LowerHand="lowerHand",e.ShareLink="shareLink",e.ChangeScene="changeScene",e.Record="recordCall",e.ReactionsDrawer="reactionspicker",e.ReactionsPopover="reactionspopover",e.Overflow="overflow",e.Moments="moments",e.Chat="chat",e.Twincam="twincam",e.StopTwincam="StopTwincam",e.LiveCaptions="LiveCaptions",e.SkypeTranslate="SkypeTranslate"}(_||(t.CallControlsKeys=_={})),function(e){e[e.None=0]="None",e[e.SpeakerDisconnected=1]="SpeakerDisconnected",e[e.MicrophoneDisconnected=2]="MicrophoneDisconnected",e[e.CompositeAudioAvailable=3]="CompositeAudioAvailable",e[e.AudioStoppedWorking=4]="AudioStoppedWorking",e[e.MicrophoneStoppedWorking=5]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=6]="SpeakerStoppedWorking",e[e.AudioDeviceBusy=7]="AudioDeviceBusy",e[e.SoundSharingStopped=8]="SoundSharingStopped",e[e.VideoStoppedWorking=9]="VideoStoppedWorking",e[e.VideoTimedOut=10]="VideoTimedOut",e[e.VideoSystemOutOfMemory=11]="VideoSystemOutOfMemory",e[e.VideoSystemBusy=12]="VideoSystemBusy",e[e.SpeakerChanged=13]="SpeakerChanged",e[e.MicrophoneChanged=14]="MicrophoneChanged",e[e.CameraChanged=15]="CameraChanged",e[e.DeviceCausingEcho=16]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=17]="MicrophoneNotMuteButSilent",e[e.MicrophoneServerMuted=18]="MicrophoneServerMuted",e[e.OutgoingVideoDisabledDuringScreenSharing=19]="OutgoingVideoDisabledDuringScreenSharing",e[e.DeviceRenderGlitches=20]="DeviceRenderGlitches",e[e.DeviceLowSNR=21]="DeviceLowSNR",e[e.DeviceClipping=22]="DeviceClipping",e[e.DeviceEcho=23]="DeviceEcho",e[e.DeviceMultipleEndpoints=24]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=25]="DeviceRenderZeroVolume",e[e.CpuInsufficient=26]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=27]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=28]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=29]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=30]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=31]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=32]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=33]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=34]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=35]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=36]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=37]="MusicModeNotAvailable",e[e.CameraLighting=38]="CameraLighting",e[e.VideoEffectsQualityChange=39]="VideoEffectsQualityChange",e[e.AudioCaptureMusicDetectedWithHighNS=40]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithHighNSNotAvailable=41]="AudioCaptureMusicDetectedWithHighNSNotAvailable",e[e.AudioCaptureMusicDetectedWithLowNS=42]="AudioCaptureMusicDetectedWithLowNS"}(f||(t.DeviceStatusToastType=f={})),function(e){e[e.Speaker=0]="Speaker",e[e.FocusedScreenShare=1]="FocusedScreenShare",e[e.Grid=2]="Grid",e[e.Manual=3]="Manual",e[e.Presentation=4]="Presentation",e[e.TogetherMode=5]="TogetherMode",e[e.LargeGrid=6]="LargeGrid"}(y||(t.StageMode=y={})),function(e){e[e.Divider=0]="Divider",e[e.StageModeSpeaker=1]="StageModeSpeaker",e[e.StageModeFocusedScreenShare=2]="StageModeFocusedScreenShare",e[e.StageModeGrid=3]="StageModeGrid",e[e.StageModeManual=4]="StageModeManual",e[e.StageModePresentation=5]="StageModePresentation",e[e.StageModeTogetherMode=6]="StageModeTogetherMode",e[e.StageModeLargeGrid=7]="StageModeLargeGrid",e[e.OnlyVideoOnTheStage=8]="OnlyVideoOnTheStage",e[e.Fullscreen=9]="Fullscreen",e[e.CallPanelHeaderLayoutMobile=10]="CallPanelHeaderLayoutMobile",e[e.CallPanelHeaderLayoutFloat=11]="CallPanelHeaderLayoutFloat",e[e.CallPanelHeaderLayoutWindow=12]="CallPanelHeaderLayoutWindow",e[e.CallPanelHeaderLayoutNone=13]="CallPanelHeaderLayoutNone",e[e.SelfInTheGridToggle=14]="SelfInTheGridToggle",e[e.HidePeopleAtTop=15]="HidePeopleAtTop",e[e.ShowPeopleAtTop=16]="ShowPeopleAtTop"}(T||(t.LayoutPickerMenuItemType=T={})),function(e){e[e.FromGroupTitle=0]="FromGroupTitle",e[e.FromManageGroupButton=1]="FromManageGroupButton",e[e.FromParticipantCount=2]="FromParticipantCount",e[e.FromConversationIcon=3]="FromConversationIcon",e[e.GoLiveInformationView=4]="GoLiveInformationView",e[e.CallControls=5]="CallControls",e[e.OverflowMenu=6]="OverflowMenu",e[e.TrayOverflowButton=7]="TrayOverflowButton"}(b||(t.CallRosterOrigin=b={})),function(e){e[e.Actioned=0]="Actioned",e[e.ManualDismissed=1]="ManualDismissed",e[e.AutoDismissed=2]="AutoDismissed",e[e.Dismissed=3]="Dismissed"}(v||(t.ToastActionType=v={})),function(e){e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=3]="Up",e[e.Zoom=4]="Zoom"}(I||(t.PhotoAnimationDirection=I={})),function(e){e[e.Sticker=0]="Sticker",e[e.Emoticon=1]="Emoticon",e[e.Snapshot=2]="Snapshot",e[e.Animation=3]="Animation",e[e.CallEvent=4]="CallEvent"}(w||(t.ReactionsItemType=w={})),function(e){e[e.Default=0]="Default",e[e.Mobile=1]="Mobile",e[e.DesktopMin=2]="DesktopMin",e[e.DesktopMinStageTwo=3]="DesktopMinStageTwo",e[e.DesktopMedium=4]="DesktopMedium",e[e.DesktopMinSmallest=5]="DesktopMinSmallest"}(P||(t.CallControlsType=P={})),function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Unavailable=2]="Unavailable",e[e.BotUnavailable=3]="BotUnavailable",e[e.Muted=4]="Muted",e[e.KickedOut=5]="KickedOut",e[e.HandRaised=6]="HandRaised",e[e.TogetherModeDesiredBackgroundAlreadySet=7]="TogetherModeDesiredBackgroundAlreadySet",e[e.TogetherModeBackgroundChangeFailed=8]="TogetherModeBackgroundChangeFailed",e[e.TogetherModeBackgroundChanged=9]="TogetherModeBackgroundChanged"}(M||(t.ParticipantEventType=M={})),t.DesktopMinNewCallControlsWidthBreakpoint=1200,t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=1050,t.DesktopMediumtNewCallControlsWidthBreakpoint=899,t.DesktopMinSmallestNewCallControlsWidthBreakpoint=749,t.DesktopMinCallPanelHeaderWidthBreakpoint=824,t.DesktopMinCallRibbonWidthBreakpoint=1128,t.DesktopMinCallPanelHeaderV2WidthBreakpoint=700,function(e){e.topLeft="topLeft",e.topRight="topRight",e.bottomLeft="bottomLeft",e.bottomRight="bottomRight"}(D||(t.LocalParticipantViewPosition=D={})),t.CallPanelHeaderHeight={mobile:72,window:80},t.BigTrayCallParticipantMainAxisSize={video:200,audio:120},t.BigTrayOverflowButtonSize=t.BigTrayCallParticipantMainAxisSize.audio,t.BigTrayCallParticipantAvatarSize=64,t.DesktopLayoutPickerItemHeight=37,t.MobileLayoutPickerItemHeight=53,t.AudioNotificationOffset=30,t.CallTranscriptionBottomViewMinHeight=200,t.CallTranscriptionLeftViewMinWidth=260},351979:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallPanelMenuItemCommand=t.QuickCallPanelFilter=void 0,function(e){e[e.All=0]="All",e[e.Skype=1]="Skype",e[e.Phone=2]="Phone"}(i||(t.QuickCallPanelFilter=i={})),t.QuickCallPanelMenuItemCommand={all:"all",skype:"skype",phone:"phone"}},789352:(e,t)=>{var i,o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.zoomDrawerValues=t.zoomUiSizesText=t.ZoomDelayValues=t.ZoomLevelBoundaries=t.ScreenShareZoomType=void 0,function(e){e[e.ScrollWheel=0]="ScrollWheel",e[e.UIControls=1]="UIControls",e[e.Keyboard=2]="Keyboard",e[e.TrackPad=3]="TrackPad"}(i||(t.ScreenShareZoomType=i={})),function(e){e[e.DefaultLevel=0]="DefaultLevel",e[e.MaxLevel=4]="MaxLevel"}(o||(t.ZoomLevelBoundaries=o={})),function(e){e[e.MinDelay=60]="MinDelay",e[e.MaxDelay=120]="MaxDelay",e[e.TrackPadDelay=240]="TrackPadDelay"}(a||(t.ZoomDelayValues=a={})),t.zoomUiSizesText=["3","2.5","2","1.5","1"],t.zoomDrawerValues={minHeight:30,minOpacity:0,maxOpacity:1,openDuration:150,closeDuration:50,activeItemSize:28,nonActiveItemSize:22,itemMargin:7,lastItemMargin:3,coachMarkWidth:400}},400929:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(150343)),l=o.__importDefault(i(196687)),c=i(808467),d=o.__importDefault(i(369347)),u=o.__importDefault(i(638260)),h=o.__importStar(i(873324)),p=o.__importDefault(i(186325)),g=i(815146),C=o.__importDefault(i(970035)),m=i(403396),S=i(596648),_=o.__importStar(i(85385)),f=i(26703),y=o.__importStar(i(50350)),T=o.__importStar(i(704704)),b=o.__importDefault(i(740794)),v=i(812822),I=i(884853),w=i(375258),P=i(641400),M=o.__importDefault(i(827361)),D=i(262725),A=o.__importDefault(i(760989)),k=o.__importStar(i(972830)),R=S.UserIconSize.Size40,x=(0,f.lazyProperties)({container:()=>s.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"}),itemContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",flexDirection:"column",paddingHorizontal:20,marginBottom:10}),itemTextContainer:()=>s.Styles.createTextStyle({fontSize:15,cursor:"pointer"}),itemDivider:()=>s.Styles.createViewStyle({height:1}),sectionTitle:()=>s.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:20}),userContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start",paddingVertical:12}),userIcon:()=>s.Styles.createViewStyle({marginRight:8}),enableFeature:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"flex-start",paddingHorizontal:20}),enableFeatureText:()=>s.Styles.createViewStyle({flexDirection:"row",flexGrow:1,alignItems:"center"}),bingIconLeft:()=>s.Styles.createViewStyle({width:16,height:16,marginRight:10}),copyrightText:()=>s.Styles.createTextStyle({fontSize:12}),settignsPanelWrapper:()=>s.Styles.createViewStyle({paddingHorizontal:20}),settignsPanel:()=>s.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginTop:10,marginBottom:12}),topBgReplaceIcon:()=>s.Styles.createViewStyle({width:24,height:24,marginRight:10}),bgReplaceTextBlock:()=>s.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flexShrink:1}),bgReplaceTitle:()=>s.Styles.createTextStyle({fontSize:13,paddingBottom:5}),bgReplaceText:()=>s.Styles.createTextStyle({fontSize:13}),bgReplaceTexHover:()=>s.Styles.createTextStyle({cursor:"pointer"})});class L extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onSettingsTextMouseOver=()=>{this.setState({settingsTextHover:!0})},this._onSettingsTextMouseLeave=()=>{this.setState({settingsTextHover:!1})},this._onSettingClick=()=>{const e=A.default.newCauseId();this._goBack(e),b.default.navigateToDesktopSettingsGroup(v.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._closeView=()=>{const e=A.default.newCauseId();_.log(g.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster, causeId: ${e}`),this._goBack(e)}}static getHeaderText(){return T.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const i=d.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.route.params.callId);return{captions:i,sortedCaptions:this._sortCaptions(i),isBingPictureOfDayBgSelected:d.default.CallParticipantBackgroundInfoStore.getBingBackgroundEnabled(),isBgReplaceEnabled:d.default.DeviceStore.isBackgroundReplacementEnabled()}}_sortCaptions(e){const t={};for(const i of n.values(e)){if(!(i.isoDate&&i.market&&i.caption&&i.copyright))continue;const e=i.market,o=i.isoDate;t[e]||(t[e]={});const a=i.userId;if(t[e][o])t[e][o].userIds.push(a);else{const n={caption:i.caption,copyright:i.copyright,link:i.link,market:e,isoDate:o,userIds:[a]};t[e][o]=n}}return t}_getHeader(){const e={closeButtonType:w.CloseButtonType.Close,onPress:this._closeView,title:T.getString("Global.CloseButtonTitle")},t=(0,a.jsx)(s.View,{style:M.default.flexOne}),i=T.getString("CallControls.BingBackgrounds");return(0,a.jsx)(s.View,{style:x.headerContainer,children:(0,a.jsx)(w.SimplePanelHeader,{panelName:i,useTransparentBackground:!0,leftButton:e,titleView:t})})}_renderList(){const e=[],{dividerColorStyle:t,secondaryTextColorStyle:i}=k.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{primaryIconColor:o,primaryBackgroundColor:r}=k.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),l=[x.itemDivider,t],c=this.state.settingsTextHover?x.bgReplaceTexHover:void 0;if(this.state.isBgReplaceEnabled&&e.push((0,a.jsxs)(s.View,{style:x.settignsPanelWrapper,children:[(0,a.jsxs)(s.View,{style:x.settignsPanel,children:[(0,a.jsx)(C.default,{color:o,icon:P.SkypeIcon.BackgroundReplacement,size:P.IconSize.size24,style:x.topBgReplaceIcon}),(0,a.jsxs)(s.View,{style:x.bgReplaceTextBlock,onMouseOver:this._onSettingsTextMouseOver,onMouseLeave:this._onSettingsTextMouseLeave,onPress:this._onSettingClick,children:[(0,a.jsx)(D.BodyText,{bold:!0,style:[x.bgReplaceTitle,c],children:T.getString("AudioVideoSettings.BackgroundEffectBingCameraTitle2")}),(0,a.jsx)(D.BodyText,{style:[x.bgReplaceText,i,c],children:T.getString("AudioVideoSettings.BackgroundEffectBingCoachMarkText2")})]})]}),(0,a.jsx)(p.default,{style:l},"itemDivider")]})),e.push((0,a.jsx)(s.View,{style:x.sectionTitle,children:(0,a.jsx)(I.SectionTitle,{title:T.getString("CallPanel.BingBackgroundOverviewTitle"),titleStyles:M.default.flexOne})})),this.state.sortedCaptions)for(const t of n.keys(this.state.sortedCaptions)){const o=this.state.sortedCaptions[t];for(const t of n.keys(o)){const n=o[t],c=[];for(const e of n.userIds){const t=e;c.push((0,a.jsx)(m.UserIcon,{userMri:t,size:R,useCircleForAgentMask:!0,statusBorderColor:r,style:x.userIcon},"userIcon"))}const d=(0,a.jsxs)(s.View,{style:x.itemContainer,children:[(0,a.jsx)(D.BodyText,{bold:!0,style:x.itemTextContainer,onPress:()=>{this._onClick(n)},children:n.caption}),(0,a.jsx)(D.BodyText,{style:[x.copyrightText,i],children:n.copyright}),(0,a.jsx)(s.View,{style:x.userContainer,children:c}),(0,a.jsx)(p.default,{style:l},"itemDivider")]});e.push(d)}}return(0,a.jsx)(s.ScrollView,{children:e},"scrollview")}render(){const{primaryBackgroundColorStyle:e}=k.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,a.jsxs)(s.View,{style:[x.container,e],children:[this._getHeader(),this._renderList()]})}_onClick(e){const{callId:t}=this.props.route.params;if(t){const i=A.default.newCauseId();u.default.updateCallTelemetry(t,i,(e=>e.bingBackgroundEffectCaptionClick())),_.track(new h.BackgroundEffectsBingInfoClickEvent(t,e.isoDate,void 0,e.market,!1))}if(e.link){const t=`${r.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host}${e.link}`,i={browserTitle:T.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!l.default.canNavigateInApp()};y.openUrlWithParams({origin:g.BrowserOrigin.LinkNode,url:t,options:i,rootViewId:this._getRootViewId()})}}_getHeaderText(e){return L.getHeaderText()}}t.default=L},97493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(667294)),s=i(37392);class r extends n.Component{render(){return(0,a.jsx)(s.CallPanel,Object.assign({},this.props))}}t.default=r},287417:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importDefault(i(476114)),s=i(44557);t.default=e=>{const{callId:t,callJoinContext:i,callOrigin:o,conversationMri:r,isTwincam:l,twincamInitUser:c}=e.route.params;return(0,a.jsx)(n.default,{meetNowParameters:{origin:s.MeetNowOrigin.CallPanel,convId:r},callPreviewProps:{callOrigin:o},showTwincam:l,twincamInitUser:c,callId:t,callJoinContext:i})}},562531:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(808467),r=o.__importDefault(i(369347)),l=o.__importDefault(i(46291)),c=o.__importDefault(i(99741)),d=o.__importDefault(i(638260)),u=o.__importStar(i(44717)),h=i(815146),p=o.__importStar(i(85385)),g=i(26703),C=o.__importStar(i(704704)),m=o.__importDefault(i(740794)),S=o.__importStar(i(437782)),_=i(375258),f=i(641400),y=o.__importDefault(i(827361)),T=o.__importDefault(i(19973)),b=o.__importDefault(i(760989)),v=o.__importStar(i(972830)),I=(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"})});class w extends s.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._closeRoster=()=>{const e=b.default.newCauseId();p.log(h.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster, causeId: ${e}`),this._goBack(e),T.default.getActiveSession()&&(T.default.completeSession(),p.log(h.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster Call Roster completeSession, causeId: ${e}`),d.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.callRosterClosedCount())))},this._addParticipantsToCall=()=>{const{callId:e,conversationId:t}=this.props.route.params,i=b.default.newCauseId();p.log(h.LogTraceArea.CallingUI,`[CallRosterView] _addParticipantsToCall, causeId: ${i}`),m.default.openAddToCall(t,e,h.NavigationAddToCallOrigin.RosterView,this._getContext(),i),T.default.updateCallRosterTelemetry(e,i,(e=>e.callRosterAddToCall()))}}static getHeaderText(){return C.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const{callId:i,conversationId:o}=e.route.params,a=c.default.getRosterForConversation(o);if(a&&0===a.length){const e=b.default.newCauseId();p.warn(h.LogTraceArea.CallingUI,"CallRosterView._buildState: allParticipants is empty list conversationId="+S.mriOrId(o)+" causeId="+e),d.default.updateCallTelemetry(i,e,(e=>e.callRosterGetAllParticipantsFailedCount()))}const n=c.default.getActiveParticipants(i,o),s=r.default.CallingStore.isPSTNCall(i),l=u.isEncryptedThread(o);return{allParticipantCount:a.length,activeParticipantCount:n.length,conversationName:c.default.getConversationName(o),allowAddToCall:r.default.CallingFeaturesHelper.allowAddToCall({conversationMri:o,isPSTNCall:s,isEncryptedCall:l,callId:i})}}_getCallRosterHeader(){const e={closeButtonType:_.CloseButtonType.Close,onPress:this._closeRoster,title:C.getString("Global.CloseButtonTitle")},t=this.state.allowAddToCall?{onPress:this._addParticipantsToCall,accessibilityLabel:C.getString("CallPanel.AddToCallTooltipTitle"),icon:f.SkypeIcon.ContactAdd}:void 0,i=(0,a.jsx)(n.View,{style:y.default.flexOne}),o=C.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.allParticipantCount});return(0,a.jsx)(n.View,{style:I.headerContainer,children:(0,a.jsx)(_.SimplePanelHeader,{panelName:o,useTransparentBackground:!0,leftButton:e,rightButtons:t,titleView:i})})}render(){const{primaryBackgroundColorStyle:e}=v.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,a.jsxs)(n.View,{style:[I.container,e],children:[this._getCallRosterHeader(),(0,a.jsx)(l.default,{callId:this.props.route.params.callId,conversationMri:this.props.route.params.conversationId})]})}_getHeaderText(e){return w.getHeaderText()}}t.default=w},44035:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importDefault(i(395298)),l=i(192478),c=o.__importStar(i(724063)),d=i(154235),u=o.__importDefault(i(186325)),h=i(26703),p=i(954225),g=o.__importDefault(i(95114)),C=i(375258),m=o.__importDefault(i(660401)),S=i(16549),_=i(641400),f=o.__importDefault(i(827361)),y=i(262725),T=o.__importDefault(i(760989)),b=(0,h.lazyProperties)({container:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",padding:15,backgroundColor:S.Color.white}),buttonsContainer:()=>s.Styles.createViewStyle({flexDirection:"row",alignContent:"stretch",paddingVertical:5}),headerContainer:()=>s.Styles.createViewStyle({flexDirection:"row",paddingVertical:5,flex:1}),scrollView:()=>s.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch"}),headerStyle:()=>s.Styles.createTextStyle({marginVertical:10}),buttonStyle:()=>s.Styles.createViewStyle({marginVertical:10}),buttonGroupContainer:()=>s.Styles.createViewStyle({flexDirection:"column",paddingVertical:5,flex:1})});class v extends l.BaseNavigationView{constructor(){super(...arguments),this._onAppMetricChange=(e,t)=>{c.default.setShowAppMetrics(t)},this._onVideoMetricChange=(e,t)=>{c.default.setShowVideoMetrics(t)},this._onClose=()=>{const e=T.default.newCauseId();c.default.closeDebugWindow(this.props.route.params.callId,e,this._getContext(),!1)},this._onPopout=()=>{const e=T.default.newCauseId();c.default.openNativeWindow(this.props.route.params.callId,!0,this._getContext(),e)}}_buildState(e,t){return{callTechnicalInfo:c.default.getCallTechnicalInfo(e.route.params.callId),selectedItem:t?c.CallDebugMenuItem.CallStats:c.default.getSelectedTab(),showAppMetrics:c.default.showAppMetrics(),showVideoMetrics:c.default.showVideoMetrics(),appMetrics:c.default.getAppMetrics()}}componentDidMount(){super.componentDidMount(),c.default.init(this.props.route.params.callId)}componentWillUnmount(){super.componentWillUnmount(),c.default.dispose(this.props.route.params.callId)}render(){const{selectedItem:e}=this.state;let t;switch(e){case c.CallDebugMenuItem.Simulation:t=this._renderSimulatePanel();break;case c.CallDebugMenuItem.CallStats:t=this._renderCallStats();break;case c.CallDebugMenuItem.Inspect:t=this._renderInspectContent()}const i={closeButtonType:C.CloseButtonType.Close,onPress:this._onClose,title:"Close"};return(0,a.jsxs)(s.View,{style:b.container,children:[!this.props.route.params.nativeWindow&&(0,a.jsx)(C.SimplePanelHeader,{panelName:"Call debug panel",titleTextStyle:f.default.flexNegativeOne,leftButton:i,rightButtons:undefined,hideBottomBorder:!0,leavePaddingForStatusBar:s.StatusBar.isOverlay()}),(0,a.jsx)(s.View,{style:b.buttonsContainer,children:this._renderMenuItems()}),(0,a.jsx)(u.default,{}),(0,a.jsx)(s.ScrollView,{style:b.scrollView,children:(0,a.jsx)(s.View,{children:t})},"scrollview")]})}_renderMenuItems(){const{selectedItem:e}=this.state;return n.map(c.CallDebugMenuItem,(t=>{const i=c.CallDebugMenuItem[t];return n.isString(i)?(0,a.jsx)(m.default,{buttonSize:d.SXButtonSize.Small,buttonStyle:t===e?void 0:d.SXButtonStyle.ThemeNoBackground,title:c.CallDebugMenuItem[t],onPress:()=>c.default.setSelectedTab(t)},"calldebug"+i):void 0}))}_renderCallStats(){const{callTechnicalInfo:e}=this.state;if(e)return(0,a.jsx)(s.View,{children:n.map(null==e?void 0:e.channels,((e,t)=>(0,a.jsxs)(s.View,{children:[(0,a.jsx)(y.Header,{selectable:!0,style:b.headerStyle,size:5,numberOfLines:1,children:`Channel ${t}`}),n.map(e,((e,t,i)=>{const o="Bandwidth Estimation Algorithm"===t?"Band. est. alg.":t;return(0,a.jsxs)(s.View,{style:f.default.flexOne,children:[this._renderMetricLine(o,e),(0,a.jsx)(u.default,{})]},`callstat-${i}`)}))]})))})}_renderSimulatePanel(){return(0,a.jsxs)(s.View,{children:[(0,a.jsx)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:"Actions"},"actions"),(0,a.jsxs)(s.View,{style:b.buttonGroupContainer,children:[(0,a.jsx)(m.default,{buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ColorStroke,icon:_.SkypeIcon.ContactAdd,title:"Add participant",style:b.buttonStyle,onPress:()=>this._onAddParticipantPress()},"addParticipant"),(0,a.jsx)(m.default,{buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ColorStroke,icon:_.SkypeIcon.SwitchAccount,title:"Remove participant",style:b.buttonStyle,onPress:()=>this._onRemoveParticipantPress()},"removeParticipant"),(0,a.jsx)(m.default,{buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ColorStroke,icon:_.SkypeIcon.ContactGroup,title:"Add 12 participants",style:b.buttonStyle,onPress:()=>this._onGroupParticipantPress()},"addGroupParticipant"),(0,a.jsx)(m.default,{buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ColorStroke,icon:_.SkypeIcon.Reload,title:"Reset",style:b.buttonStyle,onPress:()=>this._resetParticipants()},"resetParticipants")]}),(0,a.jsx)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:"Simulate call states"},"Simulate"),(0,a.jsx)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:"Network states"},"Network")]})}_renderInspectContent(){return(0,a.jsxs)(s.View,{children:[(0,a.jsx)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:"Actions"}),(0,a.jsxs)(s.View,{style:b.buttonGroupContainer,children:[(0,a.jsx)(r.default,{accessibilityLabel:"Show app metrics",style:g.default.controlRowWithDescription,isOn:!!this.state.showAppMetrics,onChange:this._onAppMetricChange,children:(0,a.jsx)(s.View,{style:f.default.flexOne,children:(0,a.jsx)(y.RowTitle,{style:g.default.switchTitleMediumSemiLarge,children:"Show app metrics"})})}),(0,a.jsx)(r.default,{accessibilityLabel:"Show video metrics",style:g.default.controlRowWithDescription,isOn:!!this.state.showVideoMetrics,onChange:this._onVideoMetricChange,children:(0,a.jsx)(s.View,{style:f.default.flexOne,children:(0,a.jsx)(y.RowTitle,{style:g.default.switchTitleMediumSemiLarge,children:"Show video metrics"})})}),this._renderAppMetrics()]})]})}_renderAppMetrics(){var e,t,i,o,n,r,l,c,d,h,p,g,C,m,S,_,T,v,I,w,P,M,D,A,k,R,x,L,B;if(!this.state.showAppMetrics)return;const V=(null===(e=this.state.appMetrics)||void 0===e?void 0:e.gpu)&&(0,a.jsxs)(s.View,{children:[(0,a.jsxs)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:["GPU ",null===(i=null===(t=this.state.appMetrics)||void 0===t?void 0:t.gpu)||void 0===i?void 0:i.pid]}),this._renderMetricLine("CPU",`${null===(n=null===(o=this.state.appMetrics)||void 0===o?void 0:o.gpu)||void 0===n?void 0:n.cpu.toFixed(2)} %`),this._renderMetricLine("Memory",`${((null===(l=null===(r=this.state.appMetrics)||void 0===r?void 0:r.gpu)||void 0===l?void 0:l.wss)/1024).toFixed(2)} Mb`)]}),O=(null===(c=this.state.appMetrics)||void 0===c?void 0:c.renderer)&&(0,a.jsxs)(s.View,{children:[(0,a.jsxs)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:["Renderer ",null===(h=null===(d=this.state.appMetrics)||void 0===d?void 0:d.renderer)||void 0===h?void 0:h.pid]}),this._renderMetricLine("CPU",`${null===(g=null===(p=this.state.appMetrics)||void 0===p?void 0:p.renderer)||void 0===g?void 0:g.cpu.toFixed(2)} %`),this._renderMetricLine("Memory",`${((null===(m=null===(C=this.state.appMetrics)||void 0===C?void 0:C.renderer)||void 0===m?void 0:m.wss)/1024).toFixed(2)} Mb`),(0,a.jsx)(u.default,{})]}),E=(null===(S=this.state.appMetrics)||void 0===S?void 0:S.systemUsageInfo)&&(0,a.jsxs)(s.View,{children:[(0,a.jsx)(y.Header,{style:b.headerStyle,size:5,numberOfLines:1,children:"Main"}),this._renderMetricLine("CPU Model",null===(T=null===(_=this.state.appMetrics)||void 0===_?void 0:_.systemUsageInfo)||void 0===T?void 0:T.cpuModel),this._renderMetricLine("CPU Speed",null===(I=null===(v=this.state.appMetrics)||void 0===v?void 0:v.systemUsageInfo)||void 0===I?void 0:I.cpuSpeed),this._renderMetricLine("CPU Cores",null===(P=null===(w=this.state.appMetrics)||void 0===w?void 0:w.systemUsageInfo)||void 0===P?void 0:P.cores),this._renderMetricLine("Total memory",`${null===(D=null===(M=this.state.appMetrics)||void 0===M?void 0:M.systemUsageInfo)||void 0===D?void 0:D.totalMemory} Mb`),this._renderMetricLine("Free memory",`${null===(k=null===(A=this.state.appMetrics)||void 0===A?void 0:A.systemUsageInfo)||void 0===k?void 0:k.freeMemory} Mb`),this._renderMetricLine("Memory allocated to heap",`${null===(x=null===(R=this.state.appMetrics)||void 0===R?void 0:R.systemUsageInfo)||void 0===x?void 0:x.processMemory} Mb`),this._renderMetricLine("CPU Usage",`${null===(B=null===(L=this.state.appMetrics)||void 0===L?void 0:L.systemUsageInfo)||void 0===B?void 0:B.cpuUsage} %`),(0,a.jsx)(u.default,{})]});return(0,a.jsxs)(s.View,{style:f.default.flexOne,children:[E,O,V]})}_renderMetricLine(e,t){return(0,a.jsxs)(s.View,{style:b.headerContainer,children:[(0,a.jsxs)(y.Caption,{selected:!0,selectable:!0,messageStreamFontSize:p.MessageStreamFontSize.Normal,children:[e,":"," "]}),(0,a.jsx)(y.Caption,{selectable:!0,messageStreamFontSize:p.MessageStreamFontSize.Normal,children:t})]},e)}_onAddParticipantPress(){c.default.addParticipant(this.props.route.params.callId)}_resetParticipants(){c.default.resetParticipants(this.props.route.params.callId)}_onRemoveParticipantPress(){c.default.removeParticipants(this.props.route.params.callId)}_onGroupParticipantPress(){c.default.addGroupParticipants(this.props.route.params.callId)}}t.default=v},711876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=i(192478),s=o.__importDefault(i(78451)),r=o.__importDefault(i(167492)),l=i(815146),c=o.__importStar(i(85385)),d=o.__importDefault(i(117475)),u=o.__importDefault(i(760989));class h extends n.BaseNavigationView{_buildState(e,t){return{topPadding:d.default.statusBarPadding()}}componentDidMount(){super.componentDidMount();const e=u.default.newCauseId();c.log(l.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentDidMount causeId: "+e),r.default.setCallViewVisible(this.props.route.params.callId,!1,e)}componentWillUnmount(){super.componentWillUnmount();const e=u.default.newCauseId();c.log(l.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentWillUnmount causeId: "+e),r.default.setCallViewVisible(this.props.route.params.callId,!0,e)}render(){return(0,a.jsx)(s.default,{callId:this.props.route.params.callId,conversationMri:this.props.route.params.conversationMri,reactionsMri:this.props.route.params.reactionMri,topPadding:this.state.topPadding},"callTranscriptionPanelView")}_componentId(){return"CallTranscriptionStackPanel"}}t.default=h},510248:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=o.__importStar(i(496486)),r=i(331654),l=i(808467),c=o.__importDefault(i(98794)),d=o.__importDefault(i(721657)),u=o.__importDefault(i(839401)),h=o.__importDefault(i(984339)),p=o.__importStar(i(170881)),g=i(815146),C=o.__importStar(i(85385)),m=i(26703),S=o.__importStar(i(704704)),_=o.__importDefault(i(740794)),f=o.__importDefault(i(942724)),y=o.__importDefault(i(328416)),T=o.__importDefault(i(879119)),b=o.__importDefault(i(960282)),v=o.__importDefault(i(117475)),I=i(375258),w=o.__importDefault(i(760989)),P=o.__importStar(i(972830)),M=(o.__importStar(i(128249)),(0,m.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>n.Styles.createViewStyle({alignItems:"stretch",flexDirection:"column"})}));class D extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._searchActive=!1,this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e||this.setState({query:""}),this.setState({isExpanded:e})},this._onPressClose=e=>{this._close()},this._onCountrySelected=e=>{this.props.route.params.onCountrySelected?this.props.route.params.onCountrySelected(e):T.default.setSelectedCountry(this.state.countries[e],!0),this._close()},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))},this._onCountryListRef=e=>{this._countryListRef=e||void 0}}static getHeaderText(){return S.getString("PSTNCountrySelectorPanel.Title")}_buildState(e,t){const i=this._getRootViewId();let o=y.default.getCountries();if(e.route.params.countriesFiltered){o=s.pickBy(o,(function(t,i){return s.includes(e.route.params.countriesFiltered,t.country)}))}const a={countries:o,statusBarPadding:v.default.statusBarPadding(),isPortrait:b.default.getDeviceOrientation(i)===r.DeviceOrientation.Portrait,isUsingStackNavigationContext:f.default.isUsingStackNavigationContext(),isSmallDevice:b.default.isSmallDevice(i),isExpanded:!1};return t&&(a.query="",this._headerAnimatedHeightValue=new n.Animated.Value(d.default.expandedHeight(i)),this._headerAnimatedHeightStyle=n.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}),this._headerAnimatedTopValue=new n.Animated.Value(0),this._headerAnimatedTopStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]})),a}render(){const{primaryBackgroundColorStyle:e}=P.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,a.jsxs)(n.View,{style:[M.panel,e],children:[!1,this._renderHeaderContainer(),(0,a.jsx)(u.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:this.props.route.params.hideRecentCountries?void 0:T.default.getLast5CalledCountriesNoSubscription(),onSelect:this._onCountrySelected})]})}componentDidMount(){super.componentDidMount(),this._showOrHideHeader(this.state,!this._searchActive,!1)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait||this._showOrHideHeader(t,!this._searchActive,!1)}_renderHeaderContainer(){let e;e=this.state.isUsingStackNavigationContext?(0,a.jsx)(c.default,{initialValue:1,showButtonWhenInactive:!0,placeholderText:S.getString("PSTNCountrySelector.SearchPlaceholder"),rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive},"searchInputButton"):(0,a.jsx)(h.default,{placeholderText:S.getString("PSTNCountrySelector.SearchPlaceholder"),activePlaceholderText:S.getString("PSTNCountrySelector.SearchPlaceholder"),showButtonWhenInactive:!0,autoFocus:this.props.route.params.searchAutoFocus,autoFocusWhenActive:!0,rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive},"searchInputButton");const t={closeButtonType:this.props.route.params.isAloneInNavStack||this._getContext().isPresentedByMobileStackNavigator?I.CloseButtonType.Close:I.CloseButtonType.Back,title:S.getString("Global.CloseButtonTitle"),onPress:this._onPressClose},i=(0,a.jsx)(I.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:t,hideBottomBorder:this.state.isUsingStackNavigationContext});let o;return o=this.state.isUsingStackNavigationContext?(0,a.jsx)(n.Animated.View,{style:[M.headerContainer,this._headerAnimatedHeightStyle],children:(0,a.jsxs)(n.Animated.View,{style:this._headerAnimatedTopStyle,children:[i,e]})}):(0,a.jsxs)(n.View,{children:[i,e]}),o}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const o=this._getRootViewId(),a=this._headerHeight(e),s=t?0:-1*a,r=t?a+d.default.collapsableHeight(o):d.default.expandedHeight(o)+e.statusBarPadding;i?n.Animated.parallel([n.Animated.timing(this._headerAnimatedTopValue,{toValue:s,duration:200,easing:n.Animated.Easing.Out()}),n.Animated.timing(this._headerAnimatedHeightValue,{toValue:r,duration:200,easing:n.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(s),this._headerAnimatedHeightValue.setValue(r))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?I.HeaderHeightSmall:I.HeaderHeight:e.isSmallDevice?I.HeaderHeightLandscapeSmall:I.HeaderHeightLandscape)+e.statusBarPadding}_close(){const e=w.default.newCauseId();C.log(g.LogTraceArea.Navigation,"CountrySelector._close,  causeId: "+e),p.dismissAll(),_.default.goBack(e,this._getContext())}_getHeaderText(e){return D.getHeaderText()}}t.default=D},850073:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=(o.__importStar(i(496486)),i(331654),i(854646)),s=o.__importStar(i(516778)),r=o.__importDefault(i(150343)),l=o.__importDefault(i(336764)),c=i(808467),d=o.__importDefault(i(132537)),u=o.__importDefault(i(871297)),h=o.__importDefault(i(535174)),p=o.__importDefault(i(99377)),g=o.__importDefault(i(165108)),C=i(154235),m=o.__importDefault(i(582176)),S=o.__importDefault(i(477069)),_=o.__importDefault(i(255556)),f=o.__importDefault(i(793580)),y=o.__importDefault(i(479088)),T=o.__importStar(i(170881)),b=i(815146),v=i(406719),I=o.__importDefault(i(698591)),w=o.__importStar(i(85385)),P=i(26703),M=o.__importStar(i(704704)),D=o.__importDefault(i(252089)),A=o.__importDefault(i(740794)),k=o.__importDefault(i(942724)),R=o.__importDefault(i(993317)),x=(o.__importDefault(i(393083)),o.__importDefault(i(960282))),L=o.__importDefault(i(117475)),B=o.__importDefault(i(377556)),V=o.__importDefault(i(644426)),O=o.__importDefault(i(791384)),E=o.__importDefault(i(90765)),N=o.__importDefault(i(76962)),F=o.__importDefault(i(504025)),U=o.__importDefault(i(535927)),H=o.__importDefault(i(664821)),j=i(16549),z=o.__importDefault(i(827361)),G=o.__importDefault(i(760989)),W=o.__importStar(i(972830)),K=i(280565),$=o.__importDefault(i(872263)),q=o.__importStar(i(879119)),Q=i(559705),X=(0,P.lazyProperties)({dialerWrapper:()=>s.Styles.createViewStyle({backgroundColor:j.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),regularLightThemeBackground:()=>s.Styles.createViewStyle({backgroundColor:j.Color.transparent,bottom:0,left:0,position:"absolute",right:0,top:0}),accessibleLightThemeBackground:()=>s.Styles.createViewStyle({backgroundColor:j.Color.gray50,bottom:0,left:0,position:"absolute",right:0,top:0}),darkThemeBackground:()=>s.Styles.createViewStyle({backgroundColor:j.Color.gray400,bottom:0,left:0,position:"absolute",right:0,top:0}),firstGroupLandscape:()=>s.Styles.createViewStyle({flex:1,flexBasis:0}),secondGroup:()=>s.Styles.createViewStyle({bottom:0,left:0,position:"absolute",right:0}),secondGroupLandscape:()=>s.Styles.createViewStyle({flex:1,flexBasis:0,borderLeftWidth:1}),groups:()=>s.Styles.createViewStyle({alignSelf:"stretch",flex:1}),groupsLandscape:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row"}),itemDivider:()=>s.Styles.createViewStyle({backgroundColor:j.Color.gray400,height:1})});class Z extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onScrollFastContactsSearch=()=>{const e=this._fastContactsSearch&&this._fastContactsSearch.state.isSingleSelection;!this._dialpadAnimation||this.state.isInLandscape||e||this._dialpadAnimation.toggleDialpadToCollapsedState(!0)},this._onItemPressedFastContactsSearch=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onRenderFastContactsSearch=()=>{const e=this._getSearchResultCount();if(O.default.shouldAnnounceForAccessibility()&&this._lastAnnouncedSearchCount!==e){this._lastAnnouncedSearchCount=e;const t=M.getString("SearchResultsList.SearchResultsAnnouncement",{count:e});s.Accessibility.announceForAccessibility(t)}!this._dialpadAnimation||this.state.isInLandscape||this._dialpadAnimation.isCollapsed()||this._balancePanelAnimation&&this._fastContactsSearch&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._fastContactsSearch.state.isSingleSelection||e>=1)},this._renderDialpadView=()=>{const{colorThemeOverride:e}=this.props.route.params,{primaryBackgroundColorStyle:t,dividerColorStyle:i}=W.themeStyles(this._getContext(),e),o=[X.dialerWrapper];this.state.bottomSafeAreaInset&&o.push(B.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),W.isUsingDarkTheme(this._getContext(),e)||o.push(t);const n=[X.itemDivider];W.isUsingDarkTheme(this._getContext(),e)||n.push(i);const r=this.state.isInLandscape?void 0:(0,a.jsx)(s.View,{style:n});return(0,a.jsxs)(s.View,{style:o,children:[this.state.isInLandscape?void 0:this._renderCallerIdCTA(),r,(0,a.jsx)(l.default,{ref:this._onBalancePanelAnimationRef,isInLandscape:this.state.isInLandscape,onCannotToggle:this._onCannotToggleBalancePanelAnimation,children:(0,a.jsx)(U.default,{isLandscape:this.state.isInLandscape,location:v.ExperimentLocation.DialerPanel})}),(0,a.jsxs)(_.default,{ref:this._onDialpadAnimationRef,isInLandscape:this.state.isInLandscape,onToggleStart:this._onToggleStartDialpadAnimation,onToggleCompletion:this._onToggleCompletionDialpadAnimation,onHeightsChanged:this._onHeightsChangedDialpadAnimation,children:[(0,a.jsx)(S.default,{ref:this._onDialpadRef,isInLandscape:this.state.isInLandscape,isDtmfDialpad:!1,enableExtensionDialing:this.state.extensionDialingEnabled}),(0,a.jsx)(f.default,{callId:this.props.route.params.callId,conversationId:this.props.route.params.conversationId})]})]})},this._onPress=()=>{this._dialpadAnimation&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onContactSaved=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&!this._dialpadAnimation.isCollapsed()&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!1)},this._onCallerIdWarningMount=()=>{var e,t;g.default.registerCallerIdWarningOpen(null===(t=null===(e=this.state.callerIdProblemsWarningCountry)||void 0===e?void 0:e.countryWarning)||void 0===t?void 0:t.country)},this._onCallerIdWarningPress=()=>{var e,t;const i=G.default.newCauseId();w.log(b.LogTraceArea.Navigation,`[DialerPanel][_onCallerIdWarningPress] causeId: ${i}`),g.default.registerCallerIdWarningClick(null===(t=null===(e=this.state.callerIdProblemsWarningCountry)||void 0===e?void 0:e.countryWarning)||void 0===t?void 0:t.country),this._navigateToCallerSettingsPanel(i)},this._onCallerIdDialpadCtaPress=()=>{const e=G.default.newCauseId();w.log(b.LogTraceArea.Navigation,`[DialerPanel][_onCallerIdDialpadCtaPress] causeId: ${e}`),g.default.registerCallerIdDialerCTAClick(),this._navigateToCallerSettingsPanel(e)},this._navigateToCallerSettingsPanel=e=>{w.log(b.LogTraceArea.Navigation,`[DialerPanel][_navigateToCallerSettingsPanel] causeId: ${e}`);const t=q.default.getPhoneNumber(q.TriggerKeys.InputValue).inputValue;$.default.savePhoneNumberInput(t),$.default.shouldRestoreState(),A.default.navigateToCallerIdSettingsPanel(this._getRootViewId(),e)},this._onFastContactsSearchRef=e=>{this._fastContactsSearch=e||void 0},this._onSearchSpacerAnimationRef=e=>{this._searchSpacerAnimation=e||void 0},this._onBalancePanelAnimationRef=e=>{this._balancePanelAnimation=e||void 0},this._onCannotToggleBalancePanelAnimation=e=>!e&&!!this._dialpadAnimation&&this._dialpadAnimation.isCollapsed(),this._onDialpadAnimationRef=e=>{this._dialpadAnimation=e||void 0},this._onDialpadRef=e=>{this._dialpad=e||void 0},this._onDialpadHeaderRef=e=>{this._dialpadHeader=e||void 0},this._onToggleStartDialpadAnimation=e=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToHiddenState(),e&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!0)},this._onToggleCompletionDialpadAnimation=e=>{e?this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToCollapsedState():(this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._getSearchResultCount()>=1),this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToExpandedState(),this._dialpad&&this._dialpad.focusFirst()),m.default.toggleDialpadCollapse(e)},this._onHeightsChangedDialpadAnimation=(e,t)=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.setState({expandedHeight:e,collapsedHeight:t})}}_buildState(e,t){const i=k.default.isUsingStackNavigationContext(),o=this._getRootViewId(),{callId:a,conversationId:n,prefilledNumber:s,reopenOnInvalidNumber:l}=e.route.params,c=m.default.getCallRate(),d=h.default.callerIdWarningForCountry(c),u=void 0!==d,p=x.default.isHeightSmallerThanThreshold(x.default.getWidth(o),o)&&x.default.isHeightSmallerThanThreshold(625,o),g=x.default.isSmallOrTinyScreenSize(o);let S=this._getContext().isPresentedInDesktopSubview?void 0:L.default.horizontalInsets(C.HorizontalInsetDefault);S&&p&&(S={left:S.left,right:0});const _=!u&&m.default.isSaveContactVisible(l,s),f=m.default.isCallerIdCTAVisibleInPortrait(l,s),y=m.default.isCallerIdCTAVisibleInLandscape(l,s),T=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.ExtensionDialingEnabled,b=h.default.shouldShowCallerIdChinaWarning();return{screenWidth:x.default.getWidth(o),isSmallOrTinyScreenSize:g,bottomSafeAreaInset:L.default.bottomSafeAreaInset(C.BottomInsetDefault),isInLandscape:p,safeAreaHorizontalInsets:S,isUsingStackNavigationContext:i,shouldShowSaveContact:_,shouldShowCallerIdCTAPortrait:f,shouldShowCallerIdCTALandscape:y,extensionDialingEnabled:T&&void 0===n&&void 0===a,shouldShowRateAboveSelectedContact:m.default.shouldShowRateAboveSelectedContact(),showChinaCallerIdWarning:b,enableSmsNewEntry:m.default.isSmsNewEntryEnabled(),isFreeCall:m.default.isFreeCall(),showCallerIdProblemsWarning:u,callerIdProblemsWarningCountry:d}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),T.dismissAll()}componentDidMount(){super.componentDidMount(),H.default.dialpadRendered(),h.default.notifyDialpadCTAShown(),F.default.showPromptIfNeeded(this.props.route.params.conversationId||C.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),m.default.resetDialerPanelState()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.showChinaCallerIdWarning&&$.default.clearState()}render(){if(this.state.showChinaCallerIdWarning)return(0,a.jsx)(K.CallerIdChinaWarning,{});const{colorThemeOverride:e,isAloneInNavStack:t}=this.props.route.params,{primaryBackgroundColorStyle:i,searchBoxColorStyle:o,dividerBorderColorStyle:r}=W.themeStyles(this._getContext(),e),l=[X.dialerWrapper,i];let c;if(W.isUsingDarkTheme(this._getContext(),e))l.push(o),c=(0,a.jsx)(s.View,{style:X.darkThemeBackground});else if(W.isUsingAccessibleTheme(this._getContext(),e)){const e=s.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1);c=(0,a.jsx)(s.View,{style:[X.accessibleLightThemeBackground,e]})}else c=(0,a.jsx)(n.GradientView,{style:X.regularLightThemeBackground,colors:D.default.getGradientColorsNoSubscription(),direction:n.GradientDirection.BOTTOM_RIGHT});return(0,a.jsxs)(s.View,{style:this.state.isInLandscape?X.groupsLandscape:X.groups,children:[(0,a.jsxs)(s.View,{style:this.state.isInLandscape?X.firstGroupLandscape:z.default.flexOne,children:[c,(0,a.jsx)(y.default,{ref:this._onDialpadHeaderRef,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isAloneInNavStack:t,isInLandscape:this.state.isInLandscape,maxWidth:this.state.screenWidth?this.state.screenWidth-100:0}),this._renderPhoneNumberInput(),this.state.shouldShowRateAboveSelectedContact?this._renderCallRates():this._renderSelectedContact(),this._renderSaveContact(),this.state.shouldShowRateAboveSelectedContact?this._renderSelectedContact():this._renderCallRates(),this._renderFastContactsSearch(),this._renderSearchSpacerAnimation(),this._renderCallerIdWarnings(),this.state.isInLandscape?this._renderCallerIdCTA():void 0]}),(0,a.jsx)(s.View,{style:this.state.isInLandscape?[X.secondGroupLandscape,r]:X.secondGroup,children:(0,a.jsx)(s.View,{style:l,children:this._renderDialpadView()})})]})}_renderCallRates(){if(this.state.enableSmsNewEntry&&!this.state.isFreeCall)return null;return(0,a.jsx)(p.default,{},"callRates")}_renderSelectedContact(){return(0,a.jsx)(N.default,{},"selectedContact")}_renderSaveContact(){if(!this.state.shouldShowSaveContact)return;return(0,a.jsx)(V.default,{onContactSaved:this._onContactSaved})}_renderPhoneNumberInput(){const{callId:e,conversationId:t,prefilledNumber:i,reopenOnInvalidNumber:o,navigationSource:n}=this.props.route.params;return(0,a.jsx)(R.default,{onPress:this._onPress,callId:e,conversationId:t,isInLandscape:this.state.isInLandscape,prefilledInput:i,openedOnInvalidNumberError:o,navigationSource:n})}_renderCallerIdCTA(){if(!(!this.state.isInLandscape&&!this.state.shouldShowCallerIdCTAPortrait||this.state.isInLandscape&&!this.state.shouldShowCallerIdCTALandscape||this.state.showCallerIdProblemsWarning))return(0,a.jsx)(d.default,{onMount:g.default.registerCallerIdDialerCTAOpen,onPress:this._onCallerIdDialpadCtaPress,isSmallScreen:this.state.isSmallOrTinyScreenSize})}_renderSearchSpacerAnimation(){if(!this.state.showCallerIdProblemsWarning||!this.state.callerIdProblemsWarningCountry)return(0,a.jsx)(E.default,{ref:this._onSearchSpacerAnimationRef,isInLandscape:this.state.isInLandscape})}_renderFastContactsSearch(){if(!this.state.showCallerIdProblemsWarning||!this.state.callerIdProblemsWarningCountry)return(0,a.jsx)(I.default,{ref:this._onFastContactsSearchRef,isInLandscape:this.state.isInLandscape,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onScroll:this._onScrollFastContactsSearch,onItemPressed:this._onItemPressedFastContactsSearch,onRender:this._onRenderFastContactsSearch})}_renderCallerIdWarnings(){if(!this.state.showCallerIdProblemsWarning||!this.state.callerIdProblemsWarningCountry)return;const e=M.getString("SkypeNumberPanel.SkypeNumberWarningUpdateCallerIdWarning"),t=this._getCallerIdWarningInformationalText();return(0,a.jsx)(u.default,{onMount:this._onCallerIdWarningMount,message:t,callToAction:e,onPress:this._onCallerIdWarningPress,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets})}_getCallerIdWarningInformationalText(){const{callerIdProblemsWarningCountry:e}=this.state;return(null==e?void 0:e.warningType)===Q.CallerIdWarningType.CountryWarning&&(null==e?void 0:e.countryWarning)?M.getString("SkypeNumberPanel.SkypeNumberWarningUpdateCallerIdTitleWarning",{country:e.countryWarning.countryName}):(null==e?void 0:e.warningType)===Q.CallerIdWarningType.PrefixWarning?M.getString("SkypeNumberPanel.PrefixCallerIdWarning"):""}_safeAreaMarginStyle(){if(this.state.safeAreaHorizontalInsets&&B.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets))return B.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets)}_getSearchResultCount(){return this._fastContactsSearch?this._fastContactsSearch.state.profiles.length:0}_getHeaderText(e){return Z.getHeaderText()}static getHeaderText(){return M.getString("PSTNDialerPanel.PSTNDialerPanelAccessibilityTitle")}}t.default=Z},731411:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=o.__importStar(i(516778)),r=o.__importStar(i(317588)),l=o.__importDefault(i(395298)),c=o.__importDefault(i(206483)),d=o.__importDefault(i(150343)),u=i(808467),h=i(154235),p=o.__importDefault(i(421852)),g=i(815146),C=o.__importDefault(i(970035)),m=o.__importStar(i(85385)),S=i(26703),_=o.__importStar(i(704704)),f=o.__importDefault(i(201721)),y=o.__importDefault(i(341994)),T=o.__importDefault(i(740794)),b=o.__importDefault(i(942724)),v=i(427393),I=o.__importDefault(i(117475)),w=o.__importDefault(i(691414)),P=i(375258),M=o.__importDefault(i(660401)),D=i(16549),A=o.__importDefault(i(20758)),k=i(641400),R=o.__importDefault(i(52066)),x=o.__importDefault(i(827361)),L=i(262725),B=o.__importStar(i(972830)),V=o.__importDefault(i(760989)),O=(0,S.lazyProperties)({panel:()=>s.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),innerContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",marginTop:16,marginHorizontal:20,overflow:"visible",flexGrow:1}),titlePadding:()=>s.Styles.createTextStyle({paddingTop:4,paddingBottom:16}),textPadding:()=>s.Styles.createTextStyle({paddingBottom:16}),toggle:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:16,paddingTop:4}),toggleText:()=>s.Styles.createTextStyle({flex:1,marginRight:20}),actionButton:()=>s.Styles.createViewStyle({flex:1,alignSelf:"center",marginVertical:16,minWidth:160}),bullet:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row",marginBottom:12}),bulletText:()=>s.Styles.createTextStyle({font:A.default.font.uiDisplaySemibold}),bulletIcon:()=>s.Styles.createViewStyle({marginTop:-2,marginHorizontal:16}),locationImage:()=>s.Styles.createImageStyle({alignSelf:"center"}),locationImageSmall:()=>s.Styles.createImageStyle({marginVertical:20,width:110,height:125}),locationImageLarge:()=>s.Styles.createImageStyle({marginVertical:30,width:145,height:165})});class E extends u.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._close=()=>{const e=V.default.newCauseId();m.log(g.LogTraceArea.Navigation,"E911AcknowledgementPanel._close, causeId: "+e),T.default.goBack(e,this._getContext())},this._onLeftButtonPress=()=>{if(this.state.isAcknowledged)f.default.setE911LocationConsentGranted(this.state.isLocationConsentToggleOn),this.state.isLocationConsentToggleOn&&p.default.updateLocationWithPermission(g.LocationUpdateReason.E911ConsentUpdate),this._close();else if(this.props.route.params.isAloneInNavStack||this.state.isUsingStackNavigationContext){const e=_.getString("E911AcknowledgementPanel.AcknowledgeDismissTitle"),t=_.getString("E911AcknowledgementPanel.AcknowledgeDismissMessage"),i=[{text:_.getString("E911AcknowledgementPanel.AcknowledgeDismissLabel"),onPress:this._close,isSubmit:!0},{text:_.getString("Global.CancelLabel"),isCancel:!0}];c.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}else this._close()},this._onScrollToBottomViewRef=e=>{this._scrollToBottomViewRef=e||void 0},this._onScrollToBottom=()=>{this.state.isAcknowledged||this.state.isAcknowledgementReviewed||(m.log(g.LogTraceArea.Phone,"E911AcknowledgementPanel: Acknowledgement reviewed."),this.setState({isAcknowledgementReviewed:!0}))},this._onLocationFAQLinkPress=e=>{e.stopPropagation(),e.preventDefault();const t=d.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;s.Linking.openUrl(t.locationFAQLink)},this._onLocationConsentToggleChange=(e,t)=>{this.setState({isLocationConsentToggleOn:t})},this._onActionButtonPress=()=>{var e;this.state.isAcknowledged?p.default.requiresSystemPermission?p.default.requestLocationPermission().then((()=>this._onLocationConsent(!0))).catch((()=>this._onLocationConsent(!1))):this._onLocationConsent(this.state.isLocationConsentToggleOn):this.state.isUsingStackNavigationContext||this.state.isAcknowledgementReviewed?(y.default.setE911Acknowledged(!0),m.track(new v.E911AcknowledgementEvent),this.state.shouldRequestLocationConsent||this.props.route.params.onComplete()):null===(e=this._scrollToBottomViewRef)||void 0===e||e.scrollToBottom()},this._onLocationConsent=e=>{f.default.setE911LocationConsentGranted(e),m.track(new v.E911LocationConsentEvent(e)),e&&(p.default.requiresSystemPermission?p.default.updateLocation(g.LocationUpdateReason.E911ConsentUpdate):p.default.updateLocationWithPermission(g.LocationUpdateReason.E911ConsentUpdate)),this.props.route.params.onComplete()}}static getHeaderText(){return _.getString("E911AcknowledgementPanel.PanelHeader")}_getHeaderText(e){return E.getHeaderText()}_buildState(e,t){const i={isAcknowledged:y.default.isE911Acknowledged(),shouldRequestLocationConsent:!e.route.params.shouldSkipLocationConsent&&p.default.isLocationEnabled()&&n.isUndefined(f.default.isE911LocationConsentGranted()),isUsingStackNavigationContext:b.default.isUsingStackNavigationContext(),safeAreaHorizontalPaddingStyle:this._getContext().isPresentedInDesktopSubview?void 0:I.default.horizontalPaddingStyle(h.HorizontalInsetZero)};return t&&(i.isAcknowledgementReviewed=!1,i.isLocationConsentToggleOn=!1),i}render(){const e={closeButtonType:this.props.route.params.isAloneInNavStack||this.state.isUsingStackNavigationContext?P.CloseButtonType.Close:P.CloseButtonType.Back,onPress:this._onLeftButtonPress},{primaryBackgroundColorStyle:t}=B.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),i=(0,a.jsx)(P.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:e}),o=this.state.isUsingStackNavigationContext?this._getStackNavigationContent():this._getContent();return(0,a.jsxs)(s.View,{style:[O.panel,t],children:[i,o]})}_getContent(){return(0,a.jsxs)(s.View,{style:x.default.flexOne,children:[(0,a.jsx)(w.default,{style:x.default.flexOne,ref:this._onScrollToBottomViewRef,onScrollToBottom:this._onScrollToBottom,children:(0,a.jsxs)(s.View,{style:this._getInnerContainerStyles(),children:[this._getAcknowledgementSection(),this._getLocationConsentSection()]})}),(0,a.jsx)(s.View,{children:this._getActionButton()})]})}_getStackNavigationContent(){return(0,a.jsx)(s.ScrollView,{style:x.default.flexOne,children:(0,a.jsxs)(s.View,{style:this._getInnerContainerStyles(),children:[this._getAcknowledgementSection(),this._getLocationConsentSection(),this._getActionButton()]})})}_getInnerContainerStyles(){const e=[O.innerContainer];return this.state.safeAreaHorizontalPaddingStyle&&e.push(this.state.safeAreaHorizontalPaddingStyle),e}_getAcknowledgementSection(){if(!this.state.isAcknowledged||!this.state.shouldRequestLocationConsent)return(0,a.jsxs)(s.View,{children:[(0,a.jsx)(L.BodyText,{style:O.titlePadding,bold:!0,children:_.getString("E911AcknowledgementPanel.DisclosureTitle")}),(0,a.jsx)(L.BodyText,{style:O.textPadding,children:_.getString("E911AcknowledgementPanel.DisclosureText1")}),(0,a.jsx)(L.BodyText,{style:O.textPadding,children:_.getString("E911AcknowledgementPanel.DisclosureText2")}),(0,a.jsx)(L.BodyText,{style:O.titlePadding,bold:!0,children:_.getString("E911AcknowledgementPanel.LimitationTitle")}),(0,a.jsx)(L.BodyText,{children:_.getString("E911AcknowledgementPanel.LimitationText")})]})}_getLocationConsentSection(){if(this.state.isAcknowledged&&this.state.shouldRequestLocationConsent)return(0,a.jsxs)(s.View,{children:[this._getLocationConsentText(),this._getLocationImage(),this._getLocationConsentBullets(),this._getLocationConsentToggle()]})}_getLocationConsentText(){const e=p.default.requiresSystemPermission?_.getString("E911AcknowledgementPanel.LocationConsentText3"):_.getString("E911AcknowledgementPanel.LocationConsentText1");return(0,a.jsx)(L.BodyText,{children:e})}_getLocationImage(){const e=[O.locationImage];return p.default.requiresSystemPermission?e.push(O.locationImageLarge):e.push(O.locationImageSmall),(0,a.jsx)(s.Image,{source:r.Collection.LOCATION_SHARE,style:e,resizeMode:"contain"})}_getLocationConsentBullets(){const e=_.getString("E911AcknowledgementPanel.LocationConsentText2"),t=(0,a.jsx)(s.Text,{children:e}),i=p.default.requiresSystemPermission?_.getString("E911AcknowledgementPanel.LocationConsentText5"):_.getString("E911AcknowledgementPanel.LocationConsentText4"),o=(0,a.jsx)(R.default,{url:"#",style:O.bulletText,linkTextStyle:h.LinkTextStyle.BodyText,blue:!0,onPress:this._onLocationFAQLinkPress,children:_.getString("Global.LearnMore")}),n=(0,a.jsxs)(s.Text,{children:[i," ",o]});return[this._getBullet(k.SkypeIcon.GPS,t,"bullet1"),this._getBullet(k.SkypeIcon.LiveLocation,n,"bullet2")]}_getBullet(e,t,i){const o=[x.default.flexOne,O.bulletText],{primaryTextColor:n}=B.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),r=B.isUsingAccessibleTheme(this._getContext(),this.props.route.params.colorThemeOverride)?n:B.isUsingDarkTheme(this._getContext(),this.props.route.params.colorThemeOverride)?D.Color.gray300:D.Color.gray500;return(0,a.jsxs)(s.View,{style:O.bullet,children:[(0,a.jsx)(C.default,{icon:e,size:k.IconSize.size24,color:r,style:O.bulletIcon}),(0,a.jsx)(L.BodyText,{style:o,children:t})]},i)}_getLocationConsentToggle(){if(p.default.requiresSystemPermission)return;const e=_.getString("E911AcknowledgementPanel.LocationConsentToggleLabel");return(0,a.jsx)(l.default,{style:O.toggle,isOn:this.state.isLocationConsentToggleOn,accessibilityLabel:e,onChange:this._onLocationConsentToggleChange,children:(0,a.jsx)(L.BodyText,{style:O.toggleText,bold:!0,children:e})})}_getActionButton(){const e=this._getActionButtonTitle();return(0,a.jsx)(s.View,{style:O.actionButton,children:(0,a.jsx)(M.default,{buttonSize:h.SXButtonSize.Medium,title:e,allowTextWrap:!0,onPress:this._onActionButtonPress})})}_getActionButtonTitle(){return this.state.isAcknowledged&&this.state.shouldRequestLocationConsent?_.getString("E911AcknowledgementPanel.ContinueLabel"):this.state.isUsingStackNavigationContext||this.state.isAcknowledgementReviewed?_.getString("E911AcknowledgementPanel.AcknowledgeLabel"):_.getString("Global.MoreButtonTitle")}}t.default=E},84040:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallNavigation=void 0;const o=i(197582),a=i(785893),n=o.__importDefault(i(515888));t.QuickCallNavigation=e=>{const{conversationId:t,callId:i,newGroup:o,searchOnly:s}=e.route.params;return(0,a.jsx)(n.default,{conversationId:t,callId:i,newGroup:o,searchOnly:s,hideIllustration:!0})},t.default=t.QuickCallNavigation},385676:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(496486)),s=i(331654),r=o.__importStar(i(516778)),l=o.__importDefault(i(206483)),c=i(192478),d=i(873324),u=o.__importDefault(i(266311)),h=i(154235),p=i(815146),g=o.__importDefault(i(970035)),C=o.__importStar(i(85385)),m=o.__importDefault(i(612285)),S=o.__importDefault(i(97595)),_=i(26703),f=o.__importStar(i(704704)),y=o.__importDefault(i(942724)),T=o.__importDefault(i(960282)),b=o.__importDefault(i(427845)),v=o.__importDefault(i(117475)),I=o.__importDefault(i(377556)),w=o.__importDefault(i(525864)),P=i(375258),M=o.__importDefault(i(655192)),D=o.__importDefault(i(660401)),A=i(16549),k=i(641400),R=o.__importDefault(i(48076)),x=o.__importStar(i(972830)),L=o.__importDefault(i(471856)),B=o.__importDefault(i(989819)),V=o.__importDefault(i(807833)),O=o.__importDefault(i(760989)),E=A.Color.gray400,N=(0,_.lazyProperties)({panel:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:E}),modalContainerForAll:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",paddingTop:0,paddingLeft:20,paddingRight:20,paddingBottom:20}),backgroundsList:()=>r.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"center"}),backgroundsListParent:()=>r.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center",alignSelf:"center"}),header:()=>r.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:E}),titleText:()=>r.Styles.createTextStyle({color:A.Color.white}),noteText:()=>r.Styles.createTextStyle({paddingLeft:8,color:A.Color.white}),noteTextRtl:()=>r.Styles.createTextStyle({paddingRight:8,color:A.Color.white}),divider:()=>r.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),button:()=>r.Styles.createViewStyle({width:180,marginTop:5}),buttonStacked:()=>r.Styles.createViewStyle({marginTop:5}),closeButton:()=>r.Styles.createViewStyle({height:50,paddingLeft:15,paddingRight:15}),infoAndButton:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",marginHorizontal:10,marginTop:10}),infoAndButtonStacked:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginHorizontal:10,marginTop:10}),infoIconAndText:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginTop:5})});class F extends c.BaseNavigationView{constructor(){super(...arguments),this._onEscape=()=>(C.log(p.LogTraceArea.CallingUI,"TogetherModePanel._onEscape"),this._onClose(),!0),this._onClose=()=>{if(this._dismissPanel(),this.props.route.params.onClose){const e=this.props.route.params.isAudienceBotInCall;C.track(new d.TogetherModePanelActionEvent(d.TogetherModePanelActionOrigin.Cancel,e)),this.props.route.params.onClose()}},this._onBackgroundItemDoubleTap=()=>{this._applyTogetherMode()},this._onBackgroundSelected=(e,t)=>{C.log(p.LogTraceArea.CallingUI,"TogetherModePanel: _onBackgroundSelected "+M.default.asString(e.untranslatedName)),t&&this.state.isNavigatingWithKeyboard?this._requestToApplyTogetherMode():this.setState({selectedBackground:e})},this._requestToApplyTogetherMode=()=>{this.state.stackNavigation?this._showApplyConfirmationDialog():this._applyTogetherMode()}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());const i=T.default.getWidth(this._rootViewId),o=b.default.responsiveWidthForSize(i),a=B.default.getTogetherModeBackgrounds(),s=n.first(a),r=t?e.route.params.selectedBackground||s:this.state.selectedBackground;C.log(p.LogTraceArea.CallingUI,`created new state backgroundsList ${a.length}`);const l=x.isUsingAccessibleTheme(this._getContext()),c=!x.isUsingDarkTheme(this._getContext()),d=y.default.isUsingStackNavigationContext(),u=c||l||d;return{backgroundsList:a,hasBackgroundsSection:a.length>0,appWidth:i,selectedBackground:r,screenSize:o,isNavigatingWithKeyboard:m.default.isNavigatingWithKeyboard(),highContrastTheme:l,stackNavigation:d,defaultTheme:u,deviceOrientation:T.default.getDeviceOrientation(this._rootViewId),safeAreaHorizontalInsets:v.default.horizontalInsets(),isTablet:R.default.isTablet()}}componentDidMount(){super.componentDidMount(),S.default.addEscapeHandler(this._onEscape)}componentWillUnmount(){super.componentWillUnmount(),S.default.removeEscapeHandler(this._onEscape)}render(){const e=this.state.deviceOrientation===s.DeviceOrientation.Portrait,t=V.default.getBackgroundItemDimensions(this.state.stackNavigation,e,this.state.isTablet),i=this.state.stackNavigation,o=V.default.getModalWidth(this.state.screenSize,this.state.backgroundsList.length),n=V.default.getModalHeight(this.state.backgroundsList.length),l=i?void 0:o,c=[N.backgroundsList,r.Styles.createViewStyle({maxWidth:l},!1)],d=(0,a.jsx)(L.default,{style:c,backgroundsList:this.state.backgroundsList,itemWidth:t.width,itemHeight:t.height,selectedBackground:this.state.selectedBackground,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,onItemDoubleTap:this._onBackgroundItemDoubleTap,onItemSelected:this._onBackgroundSelected,accessibilityLabel:f.getString("TogetherModeModal.Title"),highContrastTheme:this.state.highContrastTheme,stackNavigation:this.state.stackNavigation,defaultTheme:this.state.defaultTheme}),u=[N.modalContainerForAll];if(!!this.state.safeAreaHorizontalInsets&&I.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)){const e=I.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets);u.push(e)}const h=(0,a.jsxs)(r.View,{style:u,children:[(0,a.jsx)(r.View,{style:N.backgroundsListParent,children:d}),this._getInfoIconAndButton()]}),p=[N.panel],{primaryBackgroundColorStyle:g,primaryTextColorStyle:C}=this._getContext().themeStyles;this.state.defaultTheme&&p.push(g);const m=[N.header];this.state.defaultTheme&&m.push(g);const S=this.state.defaultTheme?C:N.titleText;return(0,a.jsx)(w.default,{dialogId:"togetherMode",onClickOutside:this._onClose,maxWidth:o,maxHeight:n,fullScreen:i,useFullSizeContainer:!0,children:(0,a.jsxs)(r.View,{style:p,children:[(0,a.jsx)(P.SimplePanelHeader,{panelName:this._getTitleText(),leftButton:this._getCancelButton(),style:m,titleTextStyle:S,hideBottomBorder:!this.state.stackNavigation,useCenteredControls:!0}),h]})})}_getCancelButton(){const{headerIconColor:e,iconHoverColor:t}=this._getContext().themeColors,i=this.state.defaultTheme?e:A.Color.white,o=this.state.defaultTheme?t:A.Color.gray100;return{closeButtonType:P.CloseButtonType.Close,title:f.getString("Global.CloseButtonTitle"),onPress:this._onClose,color:i,hoverColor:o}}_getApplyButton(){return(0,a.jsx)(D.default,{title:this._getApplyButtonText(),style:this.state.stackNavigation?N.buttonStacked:N.button,buttonSize:h.SXButtonSize.Medium,onPress:this._requestToApplyTogetherMode,disabled:!this.state.selectedBackground})}_getInfoIconAndButton(){const e=this.state.stackNavigation?N.infoAndButtonStacked:N.infoAndButton,{primaryTextColorStyle:t}=this._getContext().themeStyles,{headerIconColor:i}=this._getContext().themeColors,o=[this._getContext().isRTL?N.noteTextRtl:N.noteText];this.state.defaultTheme&&o.push(t);const n=this.state.defaultTheme?i:A.Color.white,s=this.state.stackNavigation?void 0:(0,a.jsxs)(r.View,{style:N.infoIconAndText,children:[(0,a.jsx)(g.default,{size:k.IconSize.size16,icon:k.SkypeIcon.Info,color:n}),(0,a.jsx)(r.Text,{style:o,children:f.getString("TogetherModeModal.AppliesToAllParticipantsNote")})]});return(0,a.jsxs)(r.View,{style:e,children:[s,this._getApplyButton()]})}_getTitleText(){const e=this.state.deviceOrientation===s.DeviceOrientation.Portrait;return this.state.stackNavigation&&!this.state.isTablet&&e?f.getString("TogetherModeModal.TitleCompact"):f.getString("TogetherModeModal.Title")}_getApplyButtonText(){const e=this.state.deviceOrientation===s.DeviceOrientation.Portrait,t=this.state.stackNavigation&&!this.state.isTablet&&e;return this.props.route.params.isAudienceBotInCall||t?f.getString("TogetherModeModal.Apply"):f.getString("TogetherModeModal.ApplyAndEnable")}_showApplyConfirmationDialog(){const e=f.getString("TogetherModeModal.ConfirmTitle"),t=f.getString("TogetherModeModal.AppliesToAllParticipantsNote"),i=[{text:f.getString("Global.CancelLabel"),isCancel:!0,onPress:()=>{}},{text:f.getString("Global.ConfirmLabel"),isSubmit:!0,style:"destructive",onPress:()=>{this._applyTogetherMode()}}];l.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}_dismissPanel(){if(this.state.stackNavigation){const e=O.default.newCauseId();this._goBack(e)}else u.default.dismissModal(B.default.getPanelId(),this._rootViewId)}_applyTogetherMode(){const e=this.props.route.params.isAudienceBotInCall,t=this.state.selectedBackground;n.isUndefined(t)?e?C.warn(p.LogTraceArea.CallingUI,"Attempting to change Together Mode background to undefined."):C.warn(p.LogTraceArea.CallingUI,"Attempting to start Together Mode without specifying a background."):(C.track(new d.TogetherModePanelActionEvent(d.TogetherModePanelActionOrigin.Apply,e)),this._dismissPanel(),e?this.props.route.params.onChangeBackground(t):this.props.route.params.onStartTogetherMode(t))}}t.default=F},330076:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(785893),n=o.__importStar(i(516778)),s=i(808467),r=i(375258),l=o.__importDefault(i(827361)),c=o.__importStar(i(704704)),d=i(26703),u=o.__importDefault(i(867480)),h=o.__importStar(i(972830)),p=(0,d.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"})});class g extends s.BaseNavigationViewPresentedInModal{static getHeaderText(){return c.getString("MeetNowCallControls.Twincam")}_getHeaderText(e){return g.getHeaderText()}render(){const{callId:e,conversationMri:t,isAloneInNavStack:i,onStopTwincamPressed:o,isTwincamConnected:s,colorThemeOverride:d}=this.props.route.params,{primaryBackgroundColorStyle:g}=h.themeStyles(this._getContext(),d);return(0,a.jsxs)(n.View,{style:[p.panel,g],children:[(0,a.jsx)(r.SimplePanelHeader,{panelName:c.getString("MeetNowCallControls.Twincam"),leftButton:{closeButtonType:i?r.CloseButtonType.Close:r.CloseButtonType.Back}}),(0,a.jsx)(n.ScrollView,{style:l.default.flexOne,children:(0,a.jsx)(u.default,{callId:e,conversationMri:t,leftOffset:0,onStopTwincamPressed:o,isTwincamConnected:s})})]})}}t.default=g},158418:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwincamPanel=t.TogetherModePanel=t.QuickCallNavigation=t.CallTranscriptionStackPanel=t.CallStatsView=t.CallRosterPanel=t.CallPreviewStackNavigation=t.CallPanel=t.BingBackgroundsPanelView=t.E911AcknowledgementPanel=t.DialerPanel=t.CountrySelector=void 0;const o=i(197582);var a=i(510248);Object.defineProperty(t,"CountrySelector",{enumerable:!0,get:function(){return o.__importDefault(a).default}});var n=i(850073);Object.defineProperty(t,"DialerPanel",{enumerable:!0,get:function(){return o.__importDefault(n).default}});var s=i(731411);Object.defineProperty(t,"E911AcknowledgementPanel",{enumerable:!0,get:function(){return o.__importDefault(s).default}});var r=i(400929);Object.defineProperty(t,"BingBackgroundsPanelView",{enumerable:!0,get:function(){return o.__importDefault(r).default}});var l=i(97493);Object.defineProperty(t,"CallPanel",{enumerable:!0,get:function(){return o.__importDefault(l).default}});var c=i(287417);Object.defineProperty(t,"CallPreviewStackNavigation",{enumerable:!0,get:function(){return o.__importDefault(c).default}});var d=i(562531);Object.defineProperty(t,"CallRosterPanel",{enumerable:!0,get:function(){return o.__importDefault(d).default}});var u=i(44035);Object.defineProperty(t,"CallStatsView",{enumerable:!0,get:function(){return o.__importDefault(u).default}});var h=i(711876);Object.defineProperty(t,"CallTranscriptionStackPanel",{enumerable:!0,get:function(){return o.__importDefault(h).default}});var p=i(84040);Object.defineProperty(t,"QuickCallNavigation",{enumerable:!0,get:function(){return o.__importDefault(p).default}});var g=i(385676);Object.defineProperty(t,"TogetherModePanel",{enumerable:!0,get:function(){return o.__importDefault(g).default}});var C=i(330076);Object.defineProperty(t,"TwincamPanel",{enumerable:!0,get:function(){return o.__importDefault(C).default}})},716129:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=o.__importStar(i(496486)),n=i(385400),s=o.__importStar(i(287687)),r=i(815146),l=o.__importStar(i(85385)),c=o.__importDefault(i(363091)),d=o.__importDefault(i(139221));class u extends n.BaseEntitlementsClient{getRates(e){const t=Date.now(),i=c.default.getSkypeId(),o="users/"+encodeURIComponent(i)+"/call-rates?Platform="+d.default.getSkypePlatformId()+a.map(e,((e,t)=>"&callNumbers["+t+"]="+encodeURIComponent(e))).join("");l.log(r.LogTraceArea.EntitlementsClient,"Performing call to ConsumerEntitlement: GET Call Rates");return this._performRequest(o,{acceptType:"application/json; ver=1.0"}).then((e=>{const i=a.keyBy(e.body,(e=>e.pstnNumber));return l.track(new s.RatesFetching(Date.now()-t)),i}))}}t.default=new u},419864:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(662783),n=o.__importDefault(i(150343)),s=o.__importStar(i(704704));class r extends a.GenericRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().pstn.host),this._ratesEndpoint=n.default.getConfigSettingsNoSubscription().pstn.ratesEndpoint}getConfig(e){const t=(e||s.getLocale()).toLowerCase()+".json";return this.performApiGet(this._ratesEndpoint+t)}}t.default=new r},599571:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const o=i(197582),a=i(662783),n=o.__importStar(i(397691)),s=o.__importDefault(i(150343)),r=i(815146),l=o.__importStar(i(85385)),c=i(96575),d=o.__importDefault(i(902530)),u=i(654519),h=o.__importDefault(i(535775)),p=o.__importDefault(i(517518)),g=o.__importDefault(i(114818));class C extends u.SkypeRestClient{constructor(){super(s.default.getConfigSettingsNoSubscription().registrar.host),this._customErrorHandler=(e,t)=>!(0,g.default)(this._postingPayload,e.getOptions().sendData)||400===t.statusCode&&t.body&&40018===t.body.code?(l.log(r.LogTraceArea.RegistrarService,"Outdated request, ignoring retry"),a.ErrorHandlingType.DoNotRetry):(401===t.statusCode&&t.body&&40102===t.body.code&&(l.log(r.LogTraceArea.RegistrarService,"RegistrarClient got 401 w/error code 40102 from request -- nuking skypetoken"),p.default.skypeTokenInvalid(e.getRequestHeaders()["X-Skypetoken"])),a.ErrorHandlingType.RetryCountedWithBackoff),this._postingPayload=void 0,this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.retries=s.default.getS4LCMCFeaturesNoSubscription().pnhRequestRetryCount}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=p.default.getRawSkypeToken(),t}enumerateRegistrations(){return this.performApiGet(s.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl)}patchRegistrations(e,t,i){return this.performApiPatch(s.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl,JSON.stringify({path:e,timestamp:t,appId:i}),{contentType:"application/x-skype-remove-invalid-apns-binding+json"})}_getPostRegistrationUrl(){return s.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl+""}postRegistration(e){return d.default.CallingNodeId.waitUntilSet().then((()=>{const t=new h.default(c.ScenarioName.PNH_Post,void 0,{NodeId:d.default.CallingNodeId.get()||""});return t.start(),this._postingPayload=e,this.performApiPostDetailed(this._getPostRegistrationUrl(),e).then((e=>(t.finish(),e.headers.date)),(e=>(t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""}),n.Rejected(e.body))))}))}deleteRegistration(e){return d.default.CallingNodeId.waitUntilSet().then((()=>{const t=new h.default(c.ScenarioName.PNH_Delete,void 0,{NodeId:d.default.CallingNodeId.get()||""});t.start();const i=s.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl+"/"+e;return this.performApiDelete(i).then((()=>t.finish()),(e=>(t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""}),n.Rejected(e.body))))}))}}t.default=new C}}]);