"use strict";(self.webpackChunkskype4life=self.webpackChunkskype4life||[]).push([[523],{645815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(667294)),a=i.__importDefault(s(574489)),l=s(26703),d=i.__importDefault(s(942724)),c=s(641400),u=i.__importDefault(s(48076)),h=i.__importDefault(s(497910)),p=i.__importDefault(s(3352)),g=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({right:5,bottom:10}),containerDesktop:()=>n.Styles.createViewStyle({bottom:0,right:13,width:c.IconSize.default,height:c.IconSize.default,alignItems:"center"})});class m extends h.default{constructor(){super(...arguments),this._buttonRef=r.createRef()}_buildState(e){const t=e.conversationId?a.default.getMessageCountsForConversation(e.conversationId):void 0;return{unreadCount:null==t?void 0:t.unreadCount,unreadCountOverflowed:null==t?void 0:t.unreadCountOverflowed,useColorBadge:!!(null==t?void 0:t.highPriorityUnreadCount),useDesktopStyles:!d.default.isUsingStackNavigationContext()&&!u.default.isTabletUI()}}render(){const e=[g.container];return this.props.horizontalPadding&&this.props.horizontalPadding.right&&e.push(n.Styles.createViewStyle({right:this.props.horizontalPadding.right+5},!1)),this.state.useDesktopStyles&&e.push(g.containerDesktop),(0,o.jsx)(p.default,{ref:this._buttonRef,style:e,onPressCallback:this.props.onPressCallback,optionalNumber:this.state.unreadCount,optionalNumberOverflowed:this.state.unreadCountOverflowed,useColorBadge:this.state.useColorBadge})}setVisible(e){var t,s;null===(s=null===(t=this._buttonRef)||void 0===t?void 0:t.current)||void 0===s||s.setVisible(e)}}t.default=m},545912:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(667294),n=s(785893),r=i.__importStar(s(496486)),a=i.__importStar(s(516778)),l=s(154235),d=i.__importDefault(s(109367)),c=i.__importStar(s(379878)),u=s(815146),h=i.__importStar(s(85385)),p=s(26703),g=i.__importStar(s(704704)),m=i.__importStar(s(954225)),S=i.__importDefault(s(942724)),_=i.__importDefault(s(791384)),f=i.__importDefault(s(655192)),y=i.__importDefault(s(660401)),v=s(16549),C=i.__importDefault(s(139221)),T=s(262725),M=i.__importDefault(s(497910)),b=(i.__importDefault(s(601274)),i.__importDefault(s(685734)));var I;!function(e){e[e.None=0]="None",e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary"}(I||(I={}));const w=(0,p.lazyProperties)({container:()=>a.Styles.createViewStyle({maxWidth:m.maxStreamContentWidth,alignItems:"center",justifyContent:"center",marginHorizontal:10,flex:1,marginVertical:10,minHeight:100}),containerComposite:()=>a.Styles.createViewStyle({marginLeft:50,marginRight:50}),button:()=>a.Styles.createButtonStyle({marginTop:10}),secondaryButton:()=>a.Styles.createButtonStyle({marginRight:10}),text:()=>a.Styles.createTextStyle({marginHorizontal:60,textAlign:"center"}),buddyName:()=>a.Styles.createTextStyle({fontWeight:"bold"}),row:()=>a.Styles.createViewStyle({flexDirection:"row"})}),P={dark:{backgroundColor:v.Color.gray400,textColor:v.Color.white,borderColor:v.Color.white},light:{backgroundColor:v.Color.white,textColor:v.Color.gray400,borderColor:v.Color.gray400}};class k extends M.default{constructor(){super(...arguments),this._renderers={},this._failureRenderers={},this._renderConversationEnded=()=>[this._renderTextLine("E2eeHandshakeControl.PrivateConversationEndedTitle",!0),this._renderTextLine("E2eeHandshakeControl.PrivateConversationEndedCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",ref:this._onInitialButtonRef,onPress:this._invite,title:g.getString("E2eeHandshakeControl.SendNewInviteButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))],this._renderExpiredState=()=>[this._renderTextLine("E2eeHandshakeControl.InvitationExpiredTitle",!0),this._renderTextLine("E2eeHandshakeControl.InvitationExpiredCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",ref:this._onInitialButtonRef,onPress:this._invite,title:g.getString("E2eeHandshakeControl.SendNewInviteButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))],this._renderSwitch=()=>[this._renderTextLine("E2eeHandshakeControl.SwitchDeviceTitle",!0),this._renderTextLine("E2eeHandshakeControl.SwitchDeviceCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"inviteButton",onPress:this._sendInviteFromSwitch,ref:this._onInitialButtonRef,title:g.getString("E2eeHandshakeControl.SwitchDeviceButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))],this._renderAcceptInvite=()=>[this._renderTextLine("E2eeHandshakeControl.IncomingInvitationTitle",!0),this._renderTextLine("E2eeHandshakeControl.IncomingInvitationCaption",!1),(0,n.jsxs)(a.View,{style:w.row,children:[(0,o.createElement)(y.default,Object.assign({},this._getSecondaryButtonConfig(),{key:"rejectButton",ref:this._onInitialButtonRef,onPress:this._declineInvitation,title:g.getString("E2eeHandshakeControl.DeclineButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Secondary})),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"acceptButton",onPress:this._acceptInvite,title:g.getString("E2eeHandshakeControl.IncomingInvitationButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))]},"acceptButtonsRow")],this._renderConfirmAcceptance=()=>[this._renderTextLine("E2eeHandshakeControl.GotAcceptTitle",!0),this._renderTextLine("E2eeHandshakeControl.GotAcceptCaption",!1),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"confirmButton",ref:this._onInitialButtonRef,onPress:this._confirm,title:g.getString("E2eeHandshakeControl.ConfirmButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))],this._renderAcceptSwitch=()=>[this._renderTextLine("E2eeHandshakeControl.OtherPartySwitchedTitle",!0),this._renderTextLine("E2eeHandshakeControl.OtherPartySwitchedCaption",!1),(0,n.jsxs)(a.View,{style:w.row,children:[(0,o.createElement)(y.default,Object.assign({},this._getSecondaryButtonConfig(),{key:"rejectButton",ref:this._onInitialButtonRef,onPress:this._declineSwitch,title:g.getString("E2eeHandshakeControl.DeclineButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Secondary})),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"acceptButton",onPress:this._acceptSwitch,title:g.getString("E2eeHandshakeControl.IncomingInvitationButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))]},"acceptButtonsRow")],this._renderInviteSent=()=>{const e="E2eeHandshakeControl.OutgoingInvitationTitle",t="E2eeHandshakeControl.OutgoingInvitationCaption";if(C.default.isElectronOsx()){const s=r.join([g.getString(e),r.join(g.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderRejectAcceptance=()=>{const e="E2eeHandshakeControl.SentAcceptTitle",t="E2eeHandshakeControl.SentAcceptCaption";if(C.default.isElectronOsx()){const s=r.join([g.getString(e),r.join(g.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderDeviceSwitched=()=>{const e="E2eeHandshakeControl.DeviceSwitchedTitle",t="E2eeHandshakeControl.DeviceSwitchedCaption";if(C.default.isElectronOsx()){const s=r.join([g.getString(e),r.join(g.getParts(t,{buddy:this.state.buddyName}),"")],".");return[this._renderFocusableTextLine(e,!0,!1,e,s),this._renderTextLine(t,!1)]}return[this._renderTextLine(e,!0,!1),this._renderTextLine(t,!1)]},this._renderBuddyName=()=>(0,n.jsx)(a.Text,{style:w.buddyName,children:this.state.buddyName},"buddyName"),this._renderOutgoingInvitationFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.OutgoingInvitationFailedTitle",this._invite),this._renderSwitchDeviceFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchDeviceFailedTitle",this._sendInviteFromSwitch),this._renderAcceptanceFailed=()=>this.state.lastFailingAction===I.Primary?this._renderStateWithTryAgainButton("E2eeHandshakeControl.AcceptanceFailedTitle",this._acceptInvite):this._renderStateWithTryAgainButton("E2eeHandshakeControl.InviteDeclinationFailedTitle",this._declineInvitation),this._renderConfirmationFailed=()=>this._renderStateWithTryAgainButton("E2eeHandshakeControl.ConfirmationFailedTitle",this._confirm),this._renderSwitchAcceptanceFailed=()=>this.state.lastFailingAction===I.Primary?this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchAcceptanceFailedTitle",this._acceptSwitch):this._renderStateWithTryAgainButton("E2eeHandshakeControl.SwitchDeclinationFailedTitle",this._declineSwitch),this._onInitialButtonRef=e=>{this._initialComponent=e||void 0},this._onInitialTitleRef=e=>{this._initialComponent=e||void 0},this._onInitialFocusedTitleRef=e=>{this._initialComponent=e||void 0},this._invite=()=>{const e=this._isExpired()?u.E2EEInviteOrigin.InvitationExpire:u.E2EEInviteOrigin.ConversationEnd;this._sendInvite(e,"invite")},this._sendInviteFromSwitch=()=>{this._sendInvite(u.E2EEInviteOrigin.DeviceSwitch,"switch")},this._acceptInvite=()=>{this._performAction(d.default.sendAccept(this.props.conversationId,u.E2EEAcceptOrigin.Invitation),"acceptInvite")},this._acceptSwitch=()=>{this._performAction(d.default.sendAccept(this.props.conversationId,u.E2EEAcceptOrigin.DeviceSwitch),"acceptSwitch")},this._confirm=()=>{this._performAction(d.default.sendConfirm(this.props.conversationId),"confirm")},this._declineInvitation=()=>{this._performAction(d.default.sendReject(this.props.conversationId,u.E2EERejectionReason.InvitationDeclining),"declineInvitation",I.Secondary)},this._declineSwitch=()=>{this._performAction(d.default.sendReject(this.props.conversationId,u.E2EERejectionReason.DeviceSwitchDeclining),"declineSwitch",I.Secondary)}}_buildState(e,t){const s=this.props,i=b.default.getFullUserProfileByMri(c.default.getBuddyAddress(e.e2eeHandshake).mri),o={isUsingStackNavigationContext:S.default.isUsingStackNavigationContext(),buddyName:i.firstName||i.getDisplayName()};return t?(this._renderers[c.SecureHandshakeState.None]=this._renderConversationEnded,this._renderers[c.SecureHandshakeState.OtherEndpointInUse]=this._renderSwitch,this._renderers[c.SecureHandshakeState.SentInvite]=this._renderInviteSent,this._renderers[c.SecureHandshakeState.GotInvite]=this._renderAcceptInvite,this._renderers[c.SecureHandshakeState.SentAccept]=this._renderRejectAcceptance,this._renderers[c.SecureHandshakeState.GotAccept]=this._renderConfirmAcceptance,this._renderers[c.SecureHandshakeState.SentSwitch]=this._renderDeviceSwitched,this._renderers[c.SecureHandshakeState.GotSwitch]=this._renderAcceptSwitch,this._failureRenderers[c.SecureHandshakeState.None]=this._renderOutgoingInvitationFailed,this._failureRenderers[c.SecureHandshakeState.OtherEndpointInUse]=this._renderSwitchDeviceFailed,this._failureRenderers[c.SecureHandshakeState.GotInvite]=this._renderAcceptanceFailed,this._failureRenderers[c.SecureHandshakeState.GotAccept]=this._renderConfirmationFailed,this._failureRenderers[c.SecureHandshakeState.GotSwitch]=this._renderSwitchAcceptanceFailed,o.lastFailingAction=I.None,o.busyButton=I.None):s.e2eeHandshakeState!==e.e2eeHandshakeState&&(o.lastFailingAction=I.None,o.busyButton=I.None),o}componentDidMount(){super.componentDidMount();(()=>{this.isComponentMounted()&&this._initialComponent&&this._initialComponent.requestFocus()})()}render(){const e=[w.container];let t;return t=this._isExpired()?this.state.lastFailingAction===I.None?this._renderExpiredState:this._renderOutgoingInvitationFailed:this.state.lastFailingAction===I.None?this._renderers[this.props.e2eeHandshakeState]:this._failureRenderers[this.props.e2eeHandshakeState],this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||e.push(w.containerComposite),(0,n.jsx)(a.View,{style:e,children:t()},"E2eeHandshakeControl")}_isExpired(){return this.props.e2eeHandshakeState!==c.SecureHandshakeState.None&&this.props.e2eeHandshakeState!==c.SecureHandshakeState.OtherEndpointInUse&&this.props.e2eeHandshakeState!==c.SecureHandshakeState.Completed&&Date.now()>Date.parse(this.props.e2eeHandshake.ValidTill)+6e4}_renderTextLine(e,t,s=!1){const i=t?T.RowTitle:T.Caption;return(0,n.jsx)(i,{ref:s?this._onInitialTitleRef:void 0,style:w.text,textThemeColor:T.TextThemeColor.Primary,children:g.getParts(e,{buddy:this._renderBuddyName()})},e)}_renderFocusableTextLine(e,t,s,i,o){return(0,n.jsx)(a.View,{ref:this._onInitialFocusedTitleRef,tabIndex:0,importantForAccessibility:a.Types.ImportantForAccessibility.Auto,accessibilityLabel:o||g.getString(i),children:this._renderTextLine(e,t,s)},"focused_"+e)}_renderStateWithTryAgainButton(e,t){return[this._renderTextLine(e,!0),(0,o.createElement)(y.default,Object.assign({},this._getPrimaryButtonConfig(),{key:"tryAgainButton",ref:this._onInitialButtonRef,onPress:t,title:g.getString("E2eeHandshakeControl.TryAgainButton"),buttonSize:l.SXButtonSize.Medium,showActivityIndicator:this.state.busyButton===I.Primary}))]}_getPrimaryButtonConfig(){return{buttonStyle:this._useDarkTheme()?l.SXButtonStyle.LightFill:l.SXButtonStyle.DarkFill,style:w.button}}_getSecondaryButtonConfig(){return{buttonStyle:l.SXButtonStyle.Custom,buttonConfig:this._useDarkTheme()?P.dark:P.light,style:[w.button,w.secondaryButton]}}_sendInvite(e,t){const s=c.default.getBuddyAddress(this.props.e2eeHandshake).mri;_.default.maybeAnnounceForAccessibility(g.getString("ContentToDisplayTransformerBase.E2eeInvitationSent",{BParty:this.state.buddyName})),this._performAction(d.default.sendInvite(s,e),t)}_performAction(e,t,s=I.Primary){this.setState({busyButton:s});let i=this.state.lastFailingAction;e.catch((e=>{h.warn(u.LogTraceArea.E2EEncryption,'Failed to perform "'+t+'". Error: '+f.default.errorAsString(e)),i=s})).finally((()=>{this.isComponentMounted()&&this.setState({busyButton:I.None,lastFailingAction:i})}))}}t.default=k},119607:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(44717)),a=s(154235),l=i.__importDefault(s(260928)),d=s(815146),c=s(653305),u=i.__importStar(s(85385)),h=i.__importStar(s(704704)),p=i.__importDefault(s(998929)),g=i.__importStar(s(172792)),m=s(954225),S=s(113002),_=s(240804),f=i.__importDefault(s(660401)),y=i.__importDefault(s(497910));class v extends y.default{constructor(){super(...arguments),this._onPress=()=>{u.track(new c.InviteMorePeopleButtonClickedEvent(this.props.origin));new l.default({convId:r.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:d.NavigationConversationOrigin.InviteMorePeopleAfterJoinButton,peopleType:_.PeopleType.AllExcludingBots,filterPeopleType:_.FilterType.GroupCapable,wizardSteps:[S.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}render(){let e=a.SXButtonSize.Medium;this.props.messageStreamFontSize!==m.MessageStreamFontSize.Normal&&(g.isFontLarge(this.props.messageStreamFontSize)?e=a.SXButtonSize.Large:g.isFontSmall(this.props.messageStreamFontSize)&&(e=a.SXButtonSize.Small));const t=(0,o.jsx)(f.default,{buttonSize:e,title:h.getString("MessageStream.InviteMorePeople"),onPress:void 0,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:-1,style:this.props.style});return(0,o.jsx)(p.default.View,{onPress:this._onPress,keepOriginalProps:!0,accessibilityLabel:h.getString("MessageStream.InviteMorePeople"),accessibilityTraits:n.Types.AccessibilityTrait.Button,children:t})}}t.default=v},3352:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(309520)),a=i.__importDefault(s(453761)),l=s(26703),d=i.__importStar(s(704704)),c=i.__importDefault(s(252089)),u=s(641400),h=i.__importDefault(s(497910)),p=(0,l.lazyProperties)({button:()=>n.Styles.createViewStyle({width:u.IconSize.size40,height:u.IconSize.size40,borderWidth:1,borderRadius:u.IconSize.size30,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible"}),hovered:()=>n.Styles.createViewStyle({opacity:1}),container:()=>n.Styles.createViewStyle({position:"absolute",width:u.IconSize.default,height:u.IconSize.default,overflow:"visible"}),badgeStyle:()=>n.Styles.createViewStyle({flex:0,position:"absolute",top:-6,bottom:-6,overflow:"visible",alignItems:"center",alignSelf:"flex-start"})});class g extends h.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onPressCallback(this.props.optionalNumber||0)}}_buildState(e,t){return{visible:!t&&this.state.visible,gradientColors:c.default.getSubtleGradientColors()}}render(){if(!this.state.visible)return null;let e,t="0";if(this.props.optionalNumber&&this.props.optionalNumber>0){t=this.props.optionalNumber.toString(),this.props.optionalNumberOverflowed&&(t=d.getString("Global.CountOverflow",{count:t}));const s=!this._useAccessibleTheme()&&this.props.useColorBadge?this.state.gradientColors:void 0;e=(0,o.jsx)(r.default,{count:t,rawCount:this.props.optionalNumber,badgeSize:r.BadgeSize.Desktop,style:p.badgeStyle,gradientColors:s,fixedSize:!0})}const s=n.Styles.createViewStyle({borderColor:this._themeColors.pillBorderColor},!1),i=[p.button,this._themeStyles.buttonBackgroundColorStyle,s],l=(0,o.jsx)(a.default,{style:i,hoverStyle:p.hovered,size:u.IconSize.size20,onPress:this._onPress,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.headerIconColor,icon:u.SkypeIcon.DownChevron,title:d.getString("MessageStream.JumpToLast",{count:t})}),c=[p.container,this.props.style];return(0,o.jsxs)(n.View,{style:c,children:[l,e]})}setVisible(e){this.isComponentMounted()&&this.state.visible!==e&&this.setState({visible:e})}}t.default=g},602160:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=i.__importDefault(s(56729)),l=s(206467),d=i.__importDefault(s(117475)),c=i.__importDefault(s(43823));t.default=(0,r.memo)((({isBottomSheetOpen:e,onBottomSheetClose:t,message:s,origin:i,menuItems:u,onItemSelected:h,commands:p,onMoreButtonPressed:g})=>{const m=p.includes(l.CommandTypes.AddReaction),S=(0,r.useRef)(null),_=(0,r.useRef)(null),f=(0,r.useMemo)((()=>["50%","100%"]),[]),[y,v]=(0,r.useState)(f);(0,r.useEffect)((()=>{var t,s;e?null===(t=S.current)||void 0===t||t.present():null===(s=S.current)||void 0===s||s.dismiss()}),[e]);const C=(0,r.useCallback)((()=>{t()}),[t]);return(0,o.jsx)(n.BottomSheet,{ref:S,snapPoints:y,enableContentPanningGesture:!1,children:(0,o.jsx)(n.BottomSheetScrollView,{children:(0,o.jsxs)(n.Box,{paddingX:"size80",onLayout:e=>{var t,s;const i=null===(s=null===(t=e.nativeEvent)||void 0===t?void 0:t.layout)||void 0===s?void 0:s.height;i&&"number"==typeof i&&i>0&&i!==_.current&&(_.current=i,v([e.nativeEvent.layout.height+24+d.default.bottomSafeAreaInsetNoSubscription()]))},children:[m?(0,o.jsx)(a.default,{message:s,onMoreButtonPressed:g,onReactionPressed:C}):null,(0,o.jsx)(c.default,{menuItems:u,origin:i,onItemSelected:h})]})})})}))},128224:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItem=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(614080),l=i.__importDefault(s(150343)),d=i.__importStar(s(971988)),c=i.__importStar(s(44717)),u=i.__importStar(s(185013)),h=i.__importDefault(s(615364)),p=i.__importDefault(s(999261)),g=i.__importStar(s(463519)),m=i.__importStar(s(598040)),S=i.__importDefault(s(682432)),_=i.__importDefault(s(531904)),f=i.__importDefault(s(341994)),y=i.__importDefault(s(363091)),v=i.__importStar(s(453353)),C=i.__importDefault(s(960282)),T=i.__importDefault(s(421334)),M=s(683930),b=i.__importDefault(s(497910)),I=i.__importDefault(s(266872)),w=i.__importDefault(s(601274)),P=s(151619),k=i.__importDefault(s(760989)),A=i.__importStar(s(85385)),x=s(815146),D=i.__importDefault(s(288547)),R=i.__importDefault(s(759278)),L=i.__importStar(s(704704)),B=i.__importDefault(s(524526)),F=i.__importStar(s(94534)),N=i.__importDefault(s(888500)),E=s(384229),O=i.__importDefault(s(942724)),U=s(744324),V=s(142833),H=i.__importStar(s(964647)),j=s(676908);class z extends b.default{constructor(){super(...arguments),this._onToggleTranslation=()=>{this.setState((e=>({showTranslatedMessage:!e.showTranslatedMessage})))},this._onToggleTranslateOne=()=>{if(this.state.showTranslatedMessage)S.default.setHidden(this.props.message.conversationId,this.props.message.cuid,!0),A.track(new U.ShowOriginalMessage(V.TranslateOneMessageToggleOrigin.ContextMenu,H.getCorrelationIdForMessage(this.props.message)));else{const e=!S.default.hasTranslatedMessage(this.props.message.conversationId,this.props.message.cuid);e&&_.default.requestTranslation(this.props.message.conversationId,this.props.message.cuid,this.props.message),S.default.setHidden(this.props.message.conversationId,this.props.message.cuid,!1),A.track(new U.TranslateOneMessage(V.TranslateOneMessageToggleOrigin.ContextMenu,H.getCorrelationIdForMessage(this.props.message),e))}},this._onShowOriginalMessage=()=>{S.default.setHidden(this.props.message.conversationId,this.props.message.cuid,!0);const e=k.default.newCauseId(),t=this._getRootViewId();D.default.close(t,e),A.track(new U.ShowOriginalMessage(V.TranslateOneMessageToggleOrigin.MessageMenu,H.getCorrelationIdForMessage(this.props.message)))},this._onChangeTranslateLanguage=()=>{const e=k.default.newCauseId(),t=this._getRootViewId(),s=l.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech,i={anchor:()=>{},buttons:(0,E.getMenuButtons)([...s]),title:L.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle")};N.default.showWithActionMenuConfig({options:i,callback:s=>{f.default.setCallTranslatorBotSubtitleLanguageLocale(s),_.default.requestTranslation(this.props.message.conversationId,this.props.message.cuid,this.props.message),A.track(new U.ChangeLanguageAndTranslateOneMessage(V.TranslateOneMessageToggleOrigin.MessageMenu,H.getCorrelationIdForMessage(this.props.message),s)),D.default.close(t,e)},maintainAnchor:!1,rootViewId:t,useAlertForMobile:!0,useAlertForDesktop:(0,E.useAlertForDesktop)(),invokingEvent:void 0,allowScrolling:(0,E.useAlertForDesktop)()})},this._onToggleTranslateOptions=(e,t,s)=>{const i=k.default.newCauseId(),n=this._getRootViewId();A.log(x.LogTraceArea.MessageContent,`onToggleTranslateOptions causeId: ${i}`),A.track(new U.OpenTranslateMenu(V.TranslateOneMessageToggleOrigin.MessageMenu,H.getCorrelationIdForMessage(this.props.message)));const r=B.default.getLocalCallTranslatorBotSubtitleLanguageLocale(),a=r?F.getShortLanguageTitle(r):void 0,l=t?F.getLanguageOnlyTitle(t):void 0,d={langString:(s?F.getLanguageOnlyTitle(s):void 0)||a,sourceLangString:l,onShowOriginalMessage:this._onShowOriginalMessage,onChangeLang:this._onChangeTranslateLanguage},c=(0,o.jsx)(R.default,Object.assign({},d)),u=R.default.getMenuHeight();D.default.showWithContent({menuId:D.default.menuId(),anchor:()=>e,rootViewId:n,menuHeight:u,content:c,onCloseMenu:()=>D.default.close(n,i),getTitle:()=>this.state.isUsingStackNavigationContext?L.getString("Translator.TranslationOptions"):void 0,hideSubtitleDivider:!1},i)},this._onStreamItemViewRef=e=>this._streamItemViewRef=e||void 0}_buildState(e,t){const{sendingLieMaxDuration:s,enableParsingHtmlMessages:i,enableNoNetworkInfoOnSendingMessage:o,enableReportMessage:n,enableMessageSendSuccessProcessing:r}=l.default.getS4LMessagingFeatures(),a=this.props;let M;(t||a.message!==e.message||this.state.parseHtmlMessages!==i)&&(this._decodedNode=g.decode(e.message),this._decodedNode=(0,P.transformUnicodeEmojis)(this._decodedNode));const b=e.message.isBookmark();if(b){const t=d.getBookmarkMetadata(e.message.properties);t&&(M=t.bookmarkSourceCreatorId)}const k=b&&M?y.default.isMyMri(M):!e.message.isEphemeral()&&y.default.isMyMri(e.message.creator),A=T.default.isMobileScreenReaderEnabled(),x=(0,h.default)().getConversation(e.message.conversationId),D=!!x&&x.isModerated()&&x.isAdmin(y.default.getSkypeMri()),R=this._getRootViewId(),L=S.default.hasTranslatedMessage(e.message.conversationId,e.message.cuid),{enableConversationSearchInMobile:B}=l.default.getS4LMessagingFeaturesNoSubscription(),F={skypeMessage:e.message,decodedNode:this._decodedNode,isReadOnly:e.isReadOnly,hasUnderlay:!1,containerMaxDimensions:e.containerInitialDimensions,layoutWidth:C.default.getWidth(R),isConversationAccepted:e.isConversationAccepted,isConversationBlocked:u.isConversationBlocked(e.message.conversationId),isConversationWithBot:c.isAgent(e.message.conversationId),isConversationTranslated:!!e.isTranslatedConversation,postedByBot:c.isAgent(e.message.creator),postedByCurrentUser:k,isCurrentUserActive:p.default.isCurrentUserActive(),renderOrigin:e.renderOrigin,messageFirstInGroup:e.isFirstInGroup,messageLastInGroup:e.isLastInGroup,isLastMessage:e.isLastMessage,isLastPhotoByCurrentUser:e.isLastPhotoByCurrentUser,disableReactions:e.disableReactions,disableForward:e.disableForward,disableMarkUnread:e.disableMarkUnread,isReportEnabled:n&&!e.disableReportMessage,isSelectMultipleMessagesEnabled:!e.disableSelectMultipleMessages,screenReaderEnabled:A,isModerator:D,isDisplayUrlPreviewsEnabled:f.default.getDisplayUrlPreviews(),themeStyles:this._themeStyles,themeColors:this._themeColors,colorTheme:this._currentTheme,flipBubbleColors:I.default.flipBubbleColors(),hasTranslation:L,enableConversationSearchInMobile:B,isNewsBot:!!e.isNewsBot},N=m.getMessageRenderingOptions(F);let E,U;if(e.searchStore){const t=e.searchStore.getSearchQuery();t&&(U=t.messageId,E=t.query)}const V={renderingOptions:N,isMobileScreenReaderEnabled:A,postedByCurrentUser:k,rawSearchQuery:E,enableNoNetworkInfoOnSendingMessage:o,isSelectedMessage:U===e.message.cuid,hasTranslation:!!F.hasTranslation,showTranslatedMessage:e.isTranslatedConversation?!y.default.isMyMri(e.message.creator):!S.default.hasHiddenTranslation(e.message.conversationId,e.message.cuid),hasConnectivity:v.default.getConnectionStatus()!==v.ConnectionStatus.DisconnectedNoNetworkingReported,parseHtmlMessages:i,isUsingStackNavigationContext:O.default.isUsingStackNavigationContext(),enableMessageSendSuccessProcessing:r},H=N.messageViewRenderingOptions,z=e.message.isEditLie(),W=H.sendingStatus===j.MessageRenderSendingStatus.Sending;if(t||z){if(V.focusMessageViewForMobileScreenReader=!1,!V.enableMessageSendSuccessProcessing){V.sendingLieTimerIsRunning=!1;const t=z?s:s-(Date.now()-e.message.createdTime);e.canPretendBeingSent&&W&&t>0&&(V.sendingLieTimerIsRunning=!0,this._sendingLieTimer=w.default.setTimeout((()=>{this._sendingLieTimer=void 0,this.isComponentMounted()&&this.setState({sendingLieTimerIsRunning:!1})}),t))}}else V.enableMessageSendSuccessProcessing||W||!this._sendingLieTimer||(w.default.clearTimeout(this._sendingLieTimer),this._sendingLieTimer=void 0,V.sendingLieTimerIsRunning=!1);if(l.default.getS4LCMCFeatures().enableMessageTranslation&&V.hasTranslation&&d.hasQuote(e.message.content)){g.decode(e.message).getQuoteNodes().forEach((t=>{t&&t.cuid&&!S.default.hasTranslatedMessage(e.message.conversationId,t.cuid)&&_.default.maybeRequestTranslation(e.message.conversationId,t.cuid,void 0,t.children)}))}return V}componentDidMount(){super.componentDidMount(),this.props.onMountItem&&this.props.onMountItem(this,this.props.focusStreamItemForMobileScreenReader)}componentWillUnmount(){super.componentWillUnmount(),this._sendingLieTimer&&(w.default.clearTimeout(this._sendingLieTimer),this._sendingLieTimer=void 0)}focusItemForScreenReader(){this.isComponentMounted()&&this.setState({focusMessageViewForMobileScreenReader:!0})}render(){let e=this.state.renderingOptions.messageViewRenderingOptions;this.state.enableMessageSendSuccessProcessing||e.sendingStatus===j.MessageRenderSendingStatus.Sending&&(!this.state.hasConnectivity&&this.state.enableNoNetworkInfoOnSendingMessage?e=n.assign({},e,{sendingStatus:j.MessageRenderSendingStatus.NoNetwork}):this.state.sendingLieTimerIsRunning&&(e=n.assign({},e,{sendingStatus:j.MessageRenderSendingStatus.None})));let t=null;if(this.state.renderingOptions.renderOnlyUrlPreview||(t=(0,o.jsx)(a.Types.VirtualListCellContext.Consumer,{children:t=>(0,o.jsx)(M.StreamItemView,{ref:this._onStreamItemViewRef,message:this.props.message,rawSearchQuery:this.state.rawSearchQuery,isSelectedMessage:this.state.isSelectedMessage,decodedNode:this._decodedNode,postedByCurrentUser:this.state.postedByCurrentUser,renderOrigin:this.props.renderOrigin,ignoreProcessing:!1,screenReaderEnabled:this.state.isMobileScreenReaderEnabled,viewRenderingOptions:e,messageActions:this.state.renderingOptions.messageActions,suggestedTextHighlights:this.state.suggestedTextHighlights,onQuote:this.props.onQuote,onEdit:this.props.onEdit,onItemPress:this.props.onItemPress,onLayout:this.props.onLayout,onMarkAsUnread:this.props.onMarkAsUnread,onDisableScroll:this.props.onDisableScroll,onMountContent:this.props.onMountContent,onCopyContextMenu:this.props.onCopyContextMenu,onQuoteSelectionContextMenu:this.props.onQuoteSelectionContextMenu,onRevealInConvPress:this.props.onRevealInConvPress,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,shouldScreenReaderFocusItem:this.state.focusMessageViewForMobileScreenReader,messageStreamFontSize:this.props.messageStreamFontSize,linkedMessages:this.props.linkedMessages,hasTranslation:this.state.hasTranslation,conversationTranslated:this.props.isTranslatedConversation,onToggleTranslation:this._onToggleTranslation,onToggleTranslateOne:this._onToggleTranslateOne,onToggleTranslateOptions:this._onToggleTranslateOptions,showTranslatedMessage:this.state.showTranslatedMessage,searchStore:this.props.searchStore,onListItemDetails:t.onListItemDetails,hint:this.props.hint,isNewsBot:this.props.isNewsBot},"message-view"+this.props.message.cuid)})),!n.isEmpty(this.state.renderingOptions.urlPreviewRenderInformation)){const e=n.map(this.state.renderingOptions.urlPreviewRenderInformation,((e,t)=>{const s=e.urlPreviewData.url+t;return(0,o.jsx)(a.Types.VirtualListCellContext.Consumer,{children:t=>(0,o.jsx)(M.StreamItemView,{urlPreviewId:s,message:this.props.message,rawSearchQuery:this.state.rawSearchQuery,isSelectedMessage:this.state.isSelectedMessage,decodedNode:this._decodedNode,postedByCurrentUser:this.state.postedByCurrentUser,renderOrigin:this.props.renderOrigin,ignoreProcessing:!0,urlPreviewOnly:this.state.renderingOptions.renderOnlyUrlPreview,urlPreviewData:e.urlPreviewData,viewRenderingOptions:e.viewRenderOptions,messageActions:e.urlPreviewActions,suggestedTextHighlights:this.state.suggestedTextHighlights,screenReaderEnabled:this.state.isMobileScreenReaderEnabled,onQuote:this.props.onQuote,onEdit:this.props.onEdit,onItemPress:this.props.onItemPress,onLayout:this.props.onLayout,onMarkAsUnread:this.props.onMarkAsUnread,onDisableScroll:this.props.onDisableScroll,onMountContent:this.props.onMountContent,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,messageStreamFontSize:this.props.messageStreamFontSize,searchStore:this.props.searchStore,onListItemDetails:t.onListItemDetails},s)},"context-"+s)}));t=(0,o.jsxs)(r.View,{children:[t,e]})}return t}copySelection(e){if(this._streamItemViewRef)return this._streamItemViewRef.copySelection(e)}quoteSelection(){if(this._streamItemViewRef)return this._streamItemViewRef.quoteSelection()}}t.StreamItem=z},331235:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemAccessory=t.getAccessoryWidth=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(196687)),d=i.__importStar(s(971988)),c=i.__importStar(s(44717)),u=i.__importDefault(s(543915)),h=i.__importDefault(s(560099)),p=i.__importDefault(s(453761)),g=i.__importDefault(s(970035)),m=s(26703),S=i.__importStar(s(147286)),_=i.__importStar(s(704704)),f=i.__importDefault(s(363091)),y=i.__importDefault(s(740794)),v=i.__importDefault(s(975970)),C=s(206467),T=s(16549),M=s(641400),b=i.__importDefault(s(497910)),I=i.__importDefault(s(685734)),w=i.__importStar(s(548056)),P=s(623627),k=s(683930),A=i.__importDefault(s(827361)),x=i.__importDefault(s(960282)),D=s(676908);t.getAccessoryWidth=e=>e?24:44;const R=e=>e?0:20,L=(0,m.lazyProperties)({statusItemContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"center",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:8}),statusItemContainerSender:()=>r.Styles.createViewStyle({justifyContent:"flex-end"}),outerButtonReceiver:()=>r.Styles.createViewStyle({paddingLeft:8,paddingBottom:4,paddingTop:2}),outerButtonSender:()=>r.Styles.createViewStyle({paddingRight:8}),outerButtonHeightSingle:()=>r.Styles.createViewStyle({height:39}),outerButtonContainer:()=>r.Styles.createViewStyle({alignItems:"flex-end"}),forwardButtonPaddingTopCorrection:()=>r.Styles.createViewStyle({paddingTop:8,marginTop:2}),forwardButtonAlignment:()=>r.Styles.createViewStyle({justifyContent:"flex-start"}),goToOriginalMessageButton:()=>r.Styles.createViewStyle({flexGrow:1,flexDirection:"column",minWidth:48}),goToOriginalMessageIcon:()=>r.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"flex-end",alignSelf:"flex-end"}),flexGrow:()=>r.Styles.createViewStyle({flexGrow:1,alignItems:"stretch"}),accessoryIconsContainer:()=>r.Styles.createViewStyle({flexGrow:1,justifyContent:"space-between",overflow:"visible"}),footerStreamItemAccessory:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",flex:1,overflow:"visible"}),accessoryIcon:()=>r.Styles.createViewStyle({padding:5,flexDirection:"row",alignItems:"center",justifyContent:"center",backgroundColor:T.Color.white,marginTop:6,marginLeft:5,marginBottom:2})});class B extends b.default{constructor(){super(...arguments),this._onForwardKeyPress=e=>u.default.maybeHandleKeyPress(e,this._onForward),this._onForward=()=>{!this.props.disableActions&&this.props.onCommandSelected&&this.props.onCommandSelected(C.CommandTypes[C.CommandTypes.Forward])},this._onNavigateToBookmarkSource=()=>{y.default.navigateToBookmarkSource(this.props.message().properties)}}_buildState(e,t){return{isMinDesktop:x.default.isMinDesktopWidth(this._getRootViewId())&&!e.isUsingStackNavigationContext}}render(){const e=this._getMessageStatusView(),t=this.props.showOuterButtons?this._getOuterButtons(!!e):void 0;if(!e&&n.isUndefined(t))return null;const s=[this.props.isNewsBot&&this.props.accessoryOrigin===k.AccessoryOrigin.StreamItemFooter?L.accessoryIconsContainer:L.outerButtonContainer,this.props.message().isBookmark()?L.flexGrow:void 0];return this.props.paddingStyle&&s.push(this.props.paddingStyle),(0,o.jsxs)(r.Animated.View,{style:[s,this.props.containerAnimationStyle],children:[t,e]},"accessoryContainer")}_getOuterButtons(e){const s=this._themeColors.iconSecondary,i=T.Color.gray500,n=this.props.commands&&this.props.commands.indexOf(C.CommandTypes.AddReaction)>=0,d=f.default.isMyMri(this.props.creator);let c;const u=this.props.isNewsBot&&this.props.accessoryOrigin===k.AccessoryOrigin.StreamItemFooter,h=[L.accessoryIcon,A.default.shadowLightStyle],g=r.Styles.createViewStyle({width:(0,t.getAccessoryWidth)(this.state.isMinDesktop),paddingRight:R(this.state.isMinDesktop)},!1),m=r.Styles.createViewStyle({paddingLeft:R(this.state.isMinDesktop)},!1);if(!this.props.disableActions&&this.props.commands&&this.props.commands.indexOf(C.CommandTypes.Forward)>=0&&l.default.canForwardMessage()){const e=[L.outerButtonReceiver,g,L.outerButtonHeightSingle,L.forwardButtonAlignment,d?L.outerButtonSender:void 0,d?m:void 0];n&&e.push(L.forwardButtonPaddingTopCorrection);const t=(e=>{const{enableForwardItemIconForStreamItems:t}=a.default.getS4LMessagingFeaturesNoSubscription();let s=e?M.SkypeIcon.ShareiOS:M.SkypeIcon.Send;return t&&(s=M.SkypeIcon.ForwardItem),s})(u),l=w.getFrameHeight(P.Size.Small)+10,S=r.Styles.createViewStyle({height:l,borderRadius:l/2},!1);h.push(S),c=(0,o.jsx)(p.default,{color:u?i:s,hoverColor:u?i:s,icon:t,title:_.getString("StreamItem.ActionForward"),onPress:this._onForward,onKeyPress:this._onForwardKeyPress,size:M.IconSize.size20,style:u?void 0:e,flipIcon:this._getContext().isRTL,showHoverEffect:!0},"forward-button")}let S;if(n){const t=[L.outerButtonReceiver,d?L.outerButtonSender:void 0,g,d?m:void 0];c||e||t.push(L.outerButtonHeightSingle),S=(0,o.jsx)(v.default,{message:this.props.message,isMessageKnownByServer:this.props.isMessageKnownByServer,colorOverride:u?i:s,sizeOverride:M.IconSize.size16,style:t,disableAction:this.props.disableActions,anchorOffset:(y=this.state.isMinDesktop,(8-R(y))/2)},"reaction-icon-button")}var y;let b;if(this.props.message().isBookmark()&&(b=(0,o.jsx)(p.default,{color:s,hoverColor:s,icon:M.SkypeIcon.RightChevron,title:_.getString("BookmarksConversation.GoToOriginalMessageButtonTitle"),onPress:this._onNavigateToBookmarkSource,size:M.IconSize.size16,style:L.goToOriginalMessageButton,flipIcon:this._getContext().isRTL,showHoverEffect:!0,iconTextStyle:L.goToOriginalMessageIcon},"chevron-button")),S)return S;if(c||b){const e=u?(0,o.jsx)(r.View,{style:h,children:c}):c,t=u?[L.footerStreamItemAccessory]:[L.flexGrow];return(0,o.jsxs)(r.View,{style:t,children:[S,e,b]})}}_getMessageStatusView(){let e;const s=d.isMessageSms(this.props.messagetype),i=f.default.isMyMri(this.props.creator);if(this.props.showEditIcon||this.props.sendingStatus!==D.MessageRenderSendingStatus.None||s){let n,a;if(this.props.sendingStatus===D.MessageRenderSendingStatus.Failed)a=_.getString("StreamItem.MessageError"),this.props.isConversationAccepted||c.isPhoneMri(this.props.conversationId)||this.props.messagetype!==d.MessageTypes.Media_GenericFile||I.default.getFullUserProfileByMriAsync(this.props.conversationId).then((e=>{if(e){const t=S.getLocalizeParamForGender(e.gender);a=_.getString("StreamItem.FileMessageErrorBeforeFriendshipInvitation",{user:e.getShortName(),gender:t})}})),n=(0,o.jsx)(g.default,{icon:M.SkypeIcon.Error,size:M.IconSize.size16,color:T.Color.pink});else if(this.props.showEditIcon)n=(0,o.jsx)(g.default,{icon:M.SkypeIcon.Topic,size:M.IconSize.size16,color:this._themeColors.iconSecondary}),a=_.getString("StreamItem.MessageEdited");else if(s&&i){let e=M.SkypeIcon.MobileSending,t=_.getString("SMSMessaging.SmsSendingStatus"),s=!1;this.props.smsDeliveryStatus&&(d.isSmsDeliveredSuccessfully(this.props.smsDeliveryStatus)?(e=M.SkypeIcon.MobileOk,t=_.getString("SMSMessaging.SmsOkStatus")):(e=M.SkypeIcon.MobileError,t=_.getString("SMSMessaging.SmsErrorStatus"),s=!0)),n=(0,o.jsx)(g.default,{icon:e,size:M.IconSize.size16,color:s?T.Color.red:this._themeColors.iconSecondary}),a=t}const l=r.Styles.createViewStyle({width:(0,t.getAccessoryWidth)(this.state.isMinDesktop)},!1),u=[L.statusItemContainer,l,i?L.statusItemContainerSender:void 0];e=(0,o.jsx)(h.default,{style:u,title:a,children:n},"statusIcon")}return e}}t.StreamItemAccessory=B},900440:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemCommandManager=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(284841),r=i.__importDefault(s(266311)),a=i.__importStar(s(704704)),l=s(786531),d=i.__importStar(s(355088)),c=s(206467),u=i.__importDefault(s(888500)),h=u.default.menuId();t.StreamItemCommandManager=class{_getAllCommands(e){return o.keyBy(o.compact([d.addReaction(e),d.saveMedia(e),d.saveFileAs(e),d.saveMediaAs(e),d.viewInChat(e),d.editMessage(e),d.quoteMessage(e),d.webSearchInMobile(e),d.quoteSelection(e),d.searchSelection(e),d.removeMessage(e),d.cancelSendMessage(e),d.cancelEditMessage(e),d.cancelFailedSend(e),d.retryFailedSend(e),d.copyLinkMessage(e),d.copyMessage(e),d.copyImage(e),d.copyLocationMessage(e),d.openFileLocation(e),d.openMediaLocation(e),d.markReadToHere(e),d.forwardMessage(e),d.translateMessage(e),d.translateOneMessage(e),d.bookmarkMessage(e),d.reportMessage(e),d.selectMessages(e),d.viewLink(e),d.cancelScheduledCall(e),d.editScheduledCall(e),d.showReportedMessage(e),d.cancelPoll(e),d.debugDumpMessage(e),d.debugDumpMessagePretty(e),d.createImage(e)]),(e=>e.command))}_getSimpleCommands(e){return o.keyBy(o.compact([d.quoteSelection(e),d.searchSelection(e),d.copyMessage(e),d.createImage(e)]),(e=>e.command))}constructor(e){this._onCommandSelected=e}onActionMenuOptionSelected(e,t,s){const i=this._getAllCommands(e)[c.CommandTypes[t]];i&&i.onCommandSelected(s)}showActionMenu(e,t,s,i,r,d,p,g){const m=this._getAllCommands(e),S=(0,n.chain)(d,(0,n.sortBy)(o.identity),(0,n.map)((e=>m[e])),(0,n.filter)((e=>!!e&&(!e.isVisible||!!e.isVisible&&e.isVisible())))),_=(0,n.chain)(S,(0,n.map)((e=>e.command)),(0,n.findLastIndex)((e=>c.CommandTypes.Remove===e||c.CommandTypes.CancelFailedSend===e||c.CommandTypes.CancelSend===e||c.CommandTypes.Report===e||c.CommandTypes.CancelScheduledCall===e||c.CommandTypes.CancelPoll===e))),f=o.map(S,(e=>({text:a.getString(e.localizationKey),command:c.CommandTypes[e.command]})));if(!o.isEmpty(f)){const e={anchor:t,useTheme:!0};u.default.showWithOptions({id:h,config:e,getMenuItems:()=>f,handleMenuCommand:e=>this._onCommandSelected(e,{rootViewId:s},l.MessageActionOrigin.StreamItemActionMenu),menuTitle:r,onDismiss:g,destructiveButtonIndex:_,rootViewId:s,invokingEvent:p})}}getSXMenuItems(e,t,s){const i=s?this._getSimpleCommands(e):this._getAllCommands(e),r=e=>a.getString(e.localizationKey,e.localizationKeyParameters?e.localizationKeyParameters:void 0);return(0,n.chain)(t,(0,n.sortBy)(o.identity),(0,n.map)((e=>i[e])),(0,n.filter)((e=>!!e&&(!e.isVisible||!!e.isVisible&&e.isVisible()))),(0,n.map)((e=>({text:r(e),command:c.CommandTypes[e.command],category:e.category,icon:e.icon,disabled:e.disabled}))))}showSXPopup(e,t,s,i,o,n,r){const a=this.getSXMenuItems(e,t);if(0===a.length||!i())return!1;const d={anchor:i,useTheme:!0,positionPriorities:["bottom","right","left","top"],popupBeakSize:{width:0,height:0}};return u.default.showWithOptions({id:s,config:d,getMenuItems:()=>a,handleMenuCommand:e=>this._onCommandSelected(e,{rootViewId:o},l.MessageActionOrigin.StreamItemPopup),onDismiss:r,rootViewId:o,invokingEvent:n})}dismissSXPopup(e,t){r.default.dismissPopup(e,t)}}},43496:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemContent=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importDefault(s(773671)),a=i.__importStar(s(516778)),l=s(843890),d=i.__importStar(s(368434)),c=s(26703),u=i.__importStar(s(51789)),h=i.__importDefault(s(341126)),p=i.__importStar(s(676908)),g=i.__importDefault(s(58606)),m=i.__importStar(s(172792)),S=s(954225),_=i.__importStar(s(422693)),f=i.__importDefault(s(201721)),y=i.__importDefault(s(960282)),v=s(206467),C=s(16549),T=i.__importDefault(s(20758)),M=s(641400),b=i.__importDefault(s(827361)),I=i.__importDefault(s(497910)),w=s(677982),P=(0,c.lazyProperties)({lightTextStyle:()=>a.Styles.createTextStyle({color:C.Color.white}),atMentionStyle:()=>a.Styles.createTextStyle({font:T.default.font.uiDisplayBold}),quoteSymbolDarkThemeStyle:()=>a.Styles.createTextStyle({color:C.Color.whiteOverlay50}),quoteSeparatorStyle:()=>a.Styles.createViewStyle({borderColor:C.Color.white,borderBottomWidth:1}),quoteAttributeStyle:()=>a.Styles.createTextStyle({fontSize:T.default.controlFontSize.messageStreamQuoteAttributeDesktop}),textStyle:()=>a.Styles.createTextStyle({font:T.default.font.uiDisplayRegular,overflow:"visible"}),textAlignCenter:()=>a.Styles.createTextStyle({textAlign:"center"}),translateLinkStyle:()=>a.Styles.createTextStyle({marginTop:6,opacity:.6})});class k extends I.default{constructor(){super(...arguments),this._onCopy=(e,t,s)=>{g.default.add(this.props.skypeMessage.conversationId,this.props.skypeMessage.mergePartialUpdate({content:s}),t,e)},this._onCopySelectionContainerRef=e=>{this._selectionContainerRef=e||void 0}}_buildState(e,t){const{enableReplyMessageUnifiedUI:s}=w.AppConfigStore.getS4LMessagingFeatures();return{isSmallOrTinyScreenSize:y.default.isSmallOrTinyScreenSize(this._getRootViewId()),enableMultiMessageQuoteOnKeyboard:d.copyAllowed(f.default.getUserPreferencesLocal().pasteAsQuotesEnabled,e.skypeMessage.messagetype),enableReplyMessageUnifiedUI:s}}render(){const{messageTextOverrideColorStyle:e,quoteAttributeOverrideColorStyle:t,quoteColor:s}=this.props.viewRenderingOptions.viewColorProperties,i=n.compact([P.textStyle,e]),d=[P.textStyle,P.quoteAttributeStyle,t,a.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)];let c;const g={size:this.state.enableReplyMessageUnifiedUI?M.IconSize.size20:M.IconSize.size24,color:null!=s?s:this._themeColors.textPrimary},f=[],y=[P.translateLinkStyle,e],{themeColors:I}=this._getContext(),w=[a.Styles.createViewStyle({backgroundColor:I.messageStreamBackgroundColor},!1)];let k;if(this.props.useLightText&&(c=P.quoteSeparatorStyle,g.color=C.Color.whiteOverlay50,i.push(P.lightTextStyle),y.push(P.lightTextStyle)),this.props.viewRenderingOptions.messageContentCentered&&i.push([T.default.fontStyle.caption,P.textAlignCenter,this._themeStyles.secondaryTextColorStyle]),this.props.messageStreamFontSize&&this.props.messageStreamFontSize!==S.MessageStreamFontSize.Normal){const e=T.default.controlFontSize.messageStreamItemDesktop,t=m.getStyle(e,this.props.messageStreamFontSize),s=m.getStyle(T.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.props.messageStreamFontSize);i.push(t),f.push(t),d.push(s),k=m.getSize(e,this.props.messageStreamFontSize)}const A=this.props.viewRenderingOptions.sendingStatus,x={allowLargeEmoticons:!0,emoticonsOnlyEmoticonSize:this.props.emoticonsOnlyEmoticonSize,singleEmoticonSize:this.props.singleEmoticonSize,allowHugeEmoticons:this.props.allowHugeEmoticons,allowTextSelection:!this.props.disableTextSelection,disableActions:this.props.disableActions,isDraggingEnabled:this.props.viewRenderingOptions.isDraggingEnabled,onPressInterceptionCallback:this.props.onSelectMessageCallback,activeOpacityOverride:this.props.activeOpacityOverride,renderOrigin:this.props.renderOrigin,allowTextFallbackEmoticons:!0,hideSendingIndicators:A!==p.MessageRenderSendingStatus.Sending,forceStaticAnimatedEmoticons:!this.props.viewRenderingOptions.shouldAnimateEmoticons,renderLocation:this.props.viewRenderingOptions.showLocationCard,leftPaddingSwiftCarousel:this.props.leftPaddingForUserIcon,supportsCopy:l.UICapabilities.copyTextToClipboardSupported(),messageActions:this.props.messageActions,isRetryCommandSupported:u.isCommandSupported(this.props.messageActions,v.CommandTypes.RetryFailedSend),availableSpace:this.props.availableSpace,constrainedDimensions:this.props.constrainedDimensions,mediaPlaceholderIconColor:this._useDarkTheme()?this._themeColors.secondaryTextColor:this.props.postedByCurrentUser?void 0:this._themeColors.bubbleReactionColorOther,suggestedTextHighlights:this.props.suggestedTextHighlights,fontSize:k,textOverrideStyle:i,atMentionStyle:P.atMentionStyle,atMentionMeOverrideStyle:[P.atMentionStyle,b.default.defaultCursor],quoteAttributeStyle:d,quoteSeparatorStyle:c,quoteSymbolStyle:g,callMarkerStyle:f,translationLinkStyle:y,translationIconStyle:w,urlPreviewThumbnailRadiusStyle:this.props.viewRenderingOptions.urlPreviewThumbnailRadiusStyle,containerRadiusStyle:this.props.viewRenderingOptions.messageContainerRadiusStyle,linkStyle:this._themeStyles.linkTextColorStyle,urlPreviewData:this.props.urlPreviewData,urlPreviewOnly:this.props.urlPreviewOnly,obfuscateUrlPreview:this.props.viewRenderingOptions.obfuscateUrlPreview,overrideLongPressForLinks:this.props.viewRenderingOptions.overrideLongPressForLinks,onMountContent:this.props.onMountContent,onDisableScroll:this.props.onDisableScroll,onPress:this.props.onPress,onLongPressContent:this.props.onLongPressContent,onContextMenu:this.props.onContextMenu,onContentHorizontalScroll:this.props.onContentHorizontalScroll,onThumbnailLoaded:this.props.onThumbnailLoaded,onQuote:this.props.onQuote,onEdit:this.props.onEdit,isMessageInSendingState:_.isMessageInSendingState(this.props.skypeMessage,this.props.renderOrigin),onSelectableText:this.props.onSelectableText,maxContentSizeMultiplier:5,messagePadding:this.props.messagePadding,linkedMessages:this.props.linkedMessages,hasTranslation:this.props.hasTranslation,showTranslatedMessage:this.props.showTranslatedMessage,conversationTranslated:this.props.conversationTranslated,onToggleTranslation:this.props.onToggleTranslation,onToggleTranslateOptions:this.props.onToggleTranslateOptions},D=(0,o.jsx)(h.default,{message:this.props.skypeMessage,rawSearchQuery:this.props.rawSearchQuery,isSelectedMessage:this.props.isSelectedMessage,preDecodedMessage:this.props.decodedNode,options:x,atMentionSymbolStyle:i,disableActions:this.props.disableActions,searchStore:this.props.searchStore});return this.state.enableMultiMessageQuoteOnKeyboard?(0,o.jsx)(r.default,{ref:this._onCopySelectionContainerRef,onCopy:this._onCopy,children:D}):D}copySelection(e){if(this._selectionContainerRef)return this._selectionContainerRef.copySelection(e)}quoteSelection(){if(this._selectionContainerRef)return this._selectionContainerRef.quoteSelection()}}t.StreamItemContent=k},54233:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemFooter=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(217041),a=s(623627),l=s(26703),d=i.__importDefault(s(730529)),c=s(16549),u=i.__importDefault(s(775149)),h=(0,l.lazyProperties)({reactionCountItem:()=>n.Styles.createViewStyle({marginTop:6}),reactionCountItemForOutsideFooter:()=>n.Styles.createViewStyle({borderColor:c.Color.gray100,borderWidth:1,borderStyle:"solid"}),reactionContainer:()=>n.Styles.createViewStyle({marginRight:5,flexDirection:"row",flexWrap:"wrap",alignSelf:"flex-start",overflow:"visible"}),reactionContainerNoMargin:()=>n.Styles.createViewStyle({marginRight:0,flexShrink:1}),reactionContainerOutside:()=>n.Styles.createViewStyle({marginTop:6,marginBottom:10}),streamItemFooter:()=>n.Styles.createViewStyle({overflow:"visible",alignSelf:"flex-start"}),streamItemAccessoryFooter:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",flex:1,overflow:"visible",paddingLeft:5,paddingRight:10})});class p extends r.ComponentBase{render(){const e=[h.reactionContainer,this.props.streamItemAccessory?h.reactionContainerNoMargin:void 0];let t;return this.props.showReactionsOverlay?t=h.reactionCountItem:(t=h.reactionCountItemForOutsideFooter,e.push(h.reactionContainerOutside)),this.props.style&&e.push(this.props.style),this.props.overlayStyle&&void 0===this.props.streamItemAccessory&&e.push(this.props.overlayStyle),(0,o.jsxs)(n.View,{style:this.props.streamItemAccessory?[h.streamItemAccessoryFooter,this.props.overlayStyle]:h.streamItemFooter,children:[(0,o.jsx)(d.default,{style:e,message:this.props.message,reactionSize:a.Size.Small,itemStyle:t,anchorPositionAnywhere:!0,disableAction:this.props.disableAction,suppressSingleCounts:this.props.suppressSingleCounts,showShadows:this.props.showShadows,constrainedWidth:this.props.constrainedWidth}),this.props.streamItemAccessory?this.props.streamItemAccessory:void 0,this.props.hint&&!this.props.streamItemAccessory?(0,o.jsx)(u.default,{icon:this.props.hint.icon,hintMessage:this.props.hint.hintMessage}):void 0]})}}t.StreamItemFooter=p},243864:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemHeader=void 0;const i=s(197582),o=s(785893),n=i.__importDefault(s(815063)),r=i.__importStar(s(516778)),a=i.__importDefault(s(196687)),l=i.__importStar(s(44717)),d=i.__importDefault(s(601976)),c=i.__importDefault(s(190799)),u=i.__importDefault(s(560099)),h=i.__importDefault(s(970035)),p=s(26703),g=i.__importStar(s(704704)),m=i.__importStar(s(172792)),S=s(954225),_=i.__importDefault(s(363091)),f=i.__importStar(s(770644)),y=i.__importDefault(s(655192)),v=s(16549),C=i.__importDefault(s(20758)),T=s(641400),M=i.__importDefault(s(827361)),b=i.__importDefault(s(497910)),I=s(403396),w=s(596648),P=(0,p.lazyProperties)({text:()=>r.Styles.createTextStyle({backgroundColor:v.Color.transparent,flex:1,paddingBottom:2}),textMe:()=>r.Styles.createTextStyle({textAlign:"right",paddingBottom:2}),containerSpacingCarouselMe:()=>r.Styles.createViewStyle({paddingRight:10}),containerBottomPadding:()=>r.Styles.createViewStyle({paddingBottom:2}),userIconContainerSmallDevice:()=>r.Styles.createViewStyle({marginRight:8,overflow:"visible",position:"absolute"}),userIconContainer:()=>r.Styles.createViewStyle({marginRight:10,overflow:"visible",position:"absolute"}),headerContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",overflow:"visible"}),headerContainerMe:()=>r.Styles.createViewStyle({justifyContent:"flex-end"}),headerContainerRevealInConv:()=>r.Styles.createViewStyle({justifyContent:"space-between"}),headerTextContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),marginLeft:()=>r.Styles.createViewStyle({marginLeft:5}),groupIconStyles:()=>r.Styles.createViewStyle({marginLeft:3,alignSelf:"flex-start"}),bookmarkIconStyles:()=>r.Styles.createTextStyle({marginLeft:5,paddingBottom:2}),bookmarkOverrideHeaderStyles:()=>r.Styles.createTextStyle({alignSelf:"flex-start"}),bookmarkHeaderContainerStyles:()=>r.Styles.createTextStyle({flexDirection:"row",flexShrink:1}),revealInConvButton:()=>r.Styles.createTextStyle({color:v.Color.blue,flexDirection:"row",justifyContent:"flex-end"}),iconStyle:()=>r.Styles.createTextStyle({marginRight:3,justifyContent:"center"})});class k extends b.default{constructor(){super(...arguments),this._userIconAnimatedOpacityValue=new r.Animated.Value(1),this._userIconAnimatedOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._userIconAnimatedOpacityValue}),this._handleRevealButtonPress=e=>{var t,s;null===(s=(t=this.props).onRevealInConvPress)||void 0===s||s.call(t,e,this.props.message)}}static getUserIconWidth(e){return e?w.UserIconSize.Size30+8:w.UserIconSize.Size40+10}_buildState(e,t){let s="";e.showSenderName&&(e.postedByCurrentUser?e.postedByCurrentUser&&(s=g.getString("DisplayInfoStore.ListMyName")):s=this._computeRemoteSenderShortName(e.conversationId,e.creatorMri));const i=l.isBookmarkConversation(e.conversationId);let o="";return o=s?g.getString("StreamItem.MessageHeader",{senderName:s,timestamp:e.displayDateTime||""}).trim():e.displayDateTime||"",{headerText:o,displayName:s,userIconSize:w.UserIconSize.Size30,myUserSkypeMri:_.default.getSkypeMri(),isBookmarksThread:i}}_computeRemoteSenderShortName(e,t){return d.default.getMemberShortNameForConversation(e,t)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isContentScrolledOverHeader!==e.isContentScrolledOverHeader&&this._animateUserIcon(this.props.isContentScrolledOverHeader)}render(){const e=[P.headerContainer];!this.props.postedByCurrentUser||this.props.alignLeft||this.state.isBookmarksThread||e.push(P.headerContainerMe),this.props.style&&e.push(this.props.style);const t=void 0!==this.props.onRevealInConvPress,s=this._getUserIconElement(),i=this._getHeaderTextElement(t);if(!s&&!i)return null;const n=i&&this._getOptionalHeaderTextWrapped(i,t),a=(0,o.jsx)(h.default,{icon:T.SkypeIcon.Eye,size:T.IconSize.size12,color:this._themeColors.iconInteractive,style:P.iconStyle}),l=r.Styles.combine(C.default.fontStyle.caption,[P.revealInConvButton,r.Styles.createTextStyle({color:this._themeColors.textInteractive},!1)]),d=t?(0,o.jsxs)(r.Button,{onPress:this._handleRevealButtonPress,style:l,children:[a,(0,o.jsx)(r.Text,{children:g.getString("RevealMedia.GalleryRevealButton")})]}):void 0;return d&&e.push(P.headerContainerRevealInConv),(0,o.jsxs)(r.View,{style:e,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,accessibilityTraits:this.props.accessibilityTraits,accessibilityActions:this.props.accessibilityActions,onAccessibilityAction:this.props.onAccessibilityAction,children:[s,n,d]})}_getOptionalHeaderTextWrapped(e,t){const s=this._getBookmarkIconElement();if(!s)return e;const i=r.Styles.combine(P.headerTextContainer);return(0,o.jsxs)(r.View,{style:i,children:[e,s]})}_getBookmarkIconElement(){if(a.default.canBookmarkMessage()&&this.props.isBookmarkedMessage)return(0,o.jsx)(u.default,{title:g.getString("StreamItem.MessageBookmarked"),children:(0,o.jsx)(h.default,{icon:T.SkypeIcon.Bookmarked,size:T.IconSize.size12,color:this._themeColors.secondaryTextColor,style:P.bookmarkIconStyles})})}_getUserIconElement(){if(this.props.showUserIcon){let e,t;this.props.isSmallDevice?(t=P.userIconContainerSmallDevice,e=w.UserIconSize.Size30):(t=P.userIconContainer,e=w.UserIconSize.Size40),this.setState({userIconSize:e});const s=void 0;return this.props.contentScrollEnabled?(0,o.jsx)(r.Animated.View,{style:[t,this._userIconAnimatedOpacityStyle],importantForAccessibility:s,children:(0,o.jsx)(I.UserIcon,{size:e,userMri:this.props.creatorMri,enableNavigation:!this.props.disableActions&&!this.props.postedByCurrentUser,conversationId:this.props.conversationId,showHoverEffect:!1,hideBlockedOverlay:a.default.allowGroupInteractionBetweenBlockedParticipants(this.state.myUserSkypeMri,this.props.creatorMri),message:this.props.message})}):(0,o.jsx)(I.UserIcon,{size:e,style:t,userMri:this.props.creatorMri,enableNavigation:!this.props.disableActions&&!this.props.postedByCurrentUser,importantForAccessibility:s,conversationId:this.props.conversationId,showHoverEffect:!1,hideBlockedOverlay:a.default.allowGroupInteractionBetweenBlockedParticipants(this.state.myUserSkypeMri,this.props.creatorMri),message:this.props.message})}}_getTextToHighlight(){const e=y.default.deburrLowerCase(this.props.rawSearchQuery||"");return e&&f.nameContainsSearchQuery(this.state.displayName,e)?e:""}_animateUserIcon(e){r.Animated.timing(this._userIconAnimatedOpacityValue,{toValue:e?0:1,easing:e?r.Animated.Easing.Out():r.Animated.Easing.In(),duration:300,isInteraction:!1}).start()}_getHeaderTextElement(e){if(this.state.headerText){const e=[P.text,C.default.fontStyle.caption,r.Styles.createTextStyle({color:this._themeColors.textSecondary},!1)];this.props.showUserIcon&&e.push(r.Styles.createTextStyle({marginLeft:this._getHeaderTextContainerMarginLeft()},!1));const t=this.props.postedByCurrentUser&&!this.props.alignLeft;if(t&&e.push(P.textMe),(this.props.isBookmarkedMessage||this.state.isBookmarksThread)&&e.push(P.bookmarkOverrideHeaderStyles,P.containerBottomPadding),this.props.messageStreamFontSize&&this.props.messageStreamFontSize!==S.MessageStreamFontSize.Normal){const t=m.getStyleFromStyle(e,this.props.messageStreamFontSize);e.push(t)}const s=this._getTextToHighlight();return this._isCarouselOnNative(t)&&e.push(P.containerSpacingCarouselMe),s&&!this.props.isUsingStackNavigationContext?(0,o.jsx)(c.default,{selectable:!(n.default.isMobile()||this.props.disableActions),containerStyles:e,inlineTextStyle:[],displayText:this.state.headerText,textToHighlight:s,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants}):this.state.isBookmarksThread&&this.props.bookmarkSourceConversationName?this._getBookmarkStreamItemHeader():(0,o.jsx)(r.Text,{selectable:!(n.default.isMobile()||this.props.disableActions),ellipsizeMode:"middle",style:e,numberOfLines:1,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants,children:this.state.headerText})}}_getBookmarkStreamItemHeader(){let e;this.props.bookmarkSourceConversationName&&this.props.bookmarkSourceConversationId&&(e=l.isGroupConversation(this.props.bookmarkSourceConversationId)?(0,o.jsx)(h.default,{color:this._themeColors.secondaryTextColor,size:T.IconSize.size14,icon:T.SkypeIcon.ContactGroup,style:P.groupIconStyles}):void 0);const t=[C.default.fontStyle.caption,this._themeStyles.secondaryTextColorStyle],s=(0,o.jsx)(r.Text,{style:[P.marginLeft,M.default.flexOne,t],numberOfLines:1,children:this.props.bookmarkSourceConversationName}),i=[P.bookmarkHeaderContainerStyles,P.containerBottomPadding,r.Styles.createViewStyle({marginLeft:this._getHeaderTextContainerMarginLeft()},!1)];return(0,o.jsxs)(r.View,{style:i,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants,children:[(0,o.jsx)(r.Text,{style:t,children:this.state.displayName+" >"}),e,s,(0,o.jsx)(r.Text,{style:t,children:", "+this.props.displayDateTime})]})}_isCarouselOnNative(e){return!!(e&&this.props.isUsingStackNavigationContext&&this.props.isCarousel)}_getHeaderTextContainerMarginLeft(){return this.state.userIconSize+(this.props.isSmallDevice?8:10)}}t.StreamItemHeader=k},775149:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(26703),a=i.__importDefault(s(275184)),l=(0,r.lazyProperties)({hintContainer:()=>n.Styles.createViewStyle({paddingVertical:6})});t.default=({hintMessage:e,icon:t})=>(0,o.jsx)(n.View,{style:l.hintContainer,children:(0,o.jsx)(a.default,{icon:t,hintMessage:e})})},685794:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemOptionsMenu=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=(i.__importDefault(s(150343)),i.__importDefault(s(543915))),a=i.__importDefault(s(453761)),l=i.__importDefault(s(970035)),d=i.__importDefault(s(612285)),c=s(26703),u=i.__importStar(s(704704)),h=s(954225),p=s(641400),g=i.__importDefault(s(827361)),m=i.__importDefault(s(497910)),S=i.__importDefault(s(601274)),_=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({width:h.streamItemOptionsMenuWidth,paddingRight:22,alignItems:"flex-end",overflow:"visible"}),containerHeight:()=>n.Styles.createViewStyle({height:h.streamItemOptionsMenuHeight}),containerInDesktopSubview:()=>n.Styles.createViewStyle({width:h.streamItemOptionsMenuWidthInDesktopSubview,paddingRight:4}),buttonCentering:()=>n.Styles.createViewStyle({paddingLeft:h.streamItemOptionsMenuWidth}),buttonCenteringInDesktopSubview:()=>n.Styles.createViewStyle({paddingLeft:h.streamItemOptionsMenuWidthInDesktopSubview}),buttonStyle:()=>n.Styles.createButtonStyle({alignSelf:"flex-end",justifyContent:"center",alignItems:"center",width:24,height:24,borderRadius:12}),goToOriginalMessageButton:()=>n.Styles.createViewStyle({flexGrow:1,alignItems:"flex-end",marginTop:h.headerTextHeight}),bookmarkUIoverrides:()=>(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({width:2*h.streamItemOptionsMenuWidth,flexDirection:"row",justifyContent:"space-between",flexGrow:1,flexShrink:0,alignItems:"stretch"}),buttonStyle:()=>n.Styles.createButtonStyle({alignSelf:"flex-start",marginTop:15,marginLeft:5})})});class f extends m.default{constructor(){super(...arguments),this._onMoreButtonRef=e=>{this._moreButton=e||void 0},this._onMouseEnter=e=>{this._isMouseOver=!0,this.state.canShowButton||this._optionsButtonTimer||(this._optionsButtonTimer=S.default.setTimeout((()=>{this._optionsButtonTimer=void 0,this.isComponentMounted()&&this.setState({canShowButton:!0})}),200))},this._onMouseLeave=e=>{this._isMouseOver=!1,this._optionsButtonTimer&&(S.default.clearTimeout(this._optionsButtonTimer),this._optionsButtonTimer=void 0),this.state.canShowButton&&!n.UserInterface.isNavigatingWithKeyboard()&&this.setState({canShowButton:!1})},this._onPopupDismiss=()=>{this.isComponentMounted()&&this.setState({isShowingMenu:!1})},this._onOptionsButtonKeyPress=e=>r.default.maybeHandleKeyPress(e,(()=>{this._onOptionsButtonPress(e)})),this._onOptionsButtonPress=e=>{if(e.stopPropagation(),this.state.isShowingMenu)this.props.onButtonPress(e,!1,(()=>this._moreButton)),this.setState({isShowingMenu:!1});else{const t=!1,s=this.props.onButtonPress(e,!0,(()=>this._moreButton),t?void 0:this._onPopupDismiss);s&&!t&&this.setState({isShowingMenu:s})}}}_buildState(e,t){const s=d.default.isNavigatingWithKeyboard(),i={};return t?(i.canShowButton=s,i.isShowingMenu=!1):this.state&&(!this.state.canShowButton&&s?i.canShowButton=!0:!this.state.canShowButton||s||this._isMouseOver||(i.canShowButton=!1)),i}componentWillUnmount(){super.componentWillUnmount(),this._optionsButtonTimer&&(S.default.clearTimeout(this._optionsButtonTimer),this._optionsButtonTimer=void 0)}render(){const e=[this.props.style];return this.props.onSelect&&e.push(g.default.pointerCursor),this.props.messageContentCentered&&e.push(this._getContext().isPresentedInDesktopSubview?_.buttonCenteringInDesktopSubview:_.buttonCentering),(0,o.jsxs)(n.View,{style:e,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onPress:this.props.onSelect,onLayout:this.props.onLayout,children:[this.props.children,this._renderOptionsButton()]},"options-menu"+this.props.id)}_renderOptionsButton(){let e,t;const s=[_.container,this.props.useBookmarkUI?void 0:_.containerHeight];if(this._getContext().isPresentedInDesktopSubview&&s.push(_.containerInDesktopSubview),this.props.useBookmarkUI&&s.push(_.bookmarkUIoverrides.container),(this.state.isShowingMenu||this.state.canShowButton)&&this.props.renderOptionsButton){const s=[_.buttonStyle];let i=this._themeColors.iconOnAccent;this.props.useBookmarkUI&&s.push(_.bookmarkUIoverrides.buttonStyle),this.state.isShowingMenu?s.push(this._useAccessibleTheme()?this._themeStyles.primaryViewColorStyle:this._themeStyles.buttonBackgroundHoverColorStyle):i=this._themeColors.iconSecondary;const r=u.getString("Global.MoreOptions");e=(0,o.jsx)(n.Button,{ref:this._onMoreButtonRef,style:s,onPress:this._onOptionsButtonPress,onKeyPress:this._onOptionsButtonKeyPress,title:r,accessibilityTraits:[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.HasPopup],children:(0,o.jsx)(l.default,{icon:this.props.useBookmarkUI?p.SkypeIcon.More:p.SkypeIcon.MoreVertical,color:i,size:this.props.useBookmarkUI?p.IconSize.size16:p.IconSize.size12})}),t=this._getOptionalGoToOriginalMessageButton()}return(0,o.jsxs)(n.View,{style:s,children:[e,t]})}_getOptionalGoToOriginalMessageButton(){return this.props.useBookmarkUI?(0,o.jsx)(a.default,{icon:p.SkypeIcon.RightChevron,color:this._themeColors.secondaryTextColor,size:p.IconSize.size16,style:_.goToOriginalMessageButton,hoverColor:this._themeColors.iconHoverColor,onPress:this.props.onSecondaryButtonPress,title:u.getString("BookmarksConversation.GoToOriginalMessageButtonTitle")}):void 0}}t.StreamItemOptionsMenu=f},60599:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importDefault(s(266311)),r=s(16549),a=i.__importDefault(s(577267)),l=i.__importDefault(s(266872));t.default=class{constructor(e,t,s,i){this.dismissPopup=this._createDismissPopup(),this._onClose=this._createOnClose(t),this._anchor=e,this._rootViewId=s,this._rootViewType=i}show(){if(!this._anchor||!this._anchor())return!1;const e=l.default.isDarkThemeNoSubscription()?l.default.themeColorsNoSubscription().dividerColor:r.Color.black,t={getAnchor:()=>this._anchor&&this._anchor(),renderPopup:(t,s,i,n)=>(0,o.jsx)(a.default,{anchorPosition:t,anchorOffset:this._overrideAnchorOffset(s),offset:this._getOffset(),popupWidth:this._getPopupWidth(i),popupHeight:n,strokeColor:e,fillColor:r.Color.black,paddingInPopupCanvas:this._getPaddingInPopupCanvas(),popupAccessibilityTitle:this._getAccessibilityTitle(),borderRadius:10,containerStyle:this._getContainerStyle(),onOrientationChanged:this.dismissPopup,children:this._getPopupContent(t,s,i,n)}),positionPriorities:["top","bottom"],onDismiss:()=>{this._onClose&&this._onClose()},dismissIfShown:!0,rootViewId:this._rootViewId,rootViewType:this._rootViewType,useScopedPopupId:!0};return n.default.showPopup(t,this._getPopupId())}_createOnClose(e){return()=>{e&&e(),this._anchor=void 0,this._onClose=void 0}}_createDismissPopup(){return()=>n.default.dismissPopup(this._getPopupId(),this._rootViewId,!0)}_getOffset(){}_overrideAnchorOffset(e){return e}_getPaddingInPopupCanvas(){}_isCacheable(){return!1}_getContainerStyle(){}_getPopupWidth(e){return e}}},452881:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(859545)),a=i.__importDefault(s(389659)),l=s(26703),d=i.__importStar(s(704704)),c=i.__importDefault(s(998929)),u=i.__importDefault(s(363091)),h=s(16549),p=i.__importDefault(s(20758)),g=i.__importDefault(s(827361)),m=s(262725),S=i.__importDefault(s(497910)),_=i.__importDefault(s(266872)),f=s(403396),y=s(596648),v=(0,l.lazyProperties)({itemContainer:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,backgroundColor:h.Color.transparent,alignItems:"center"}),textContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),mainText:()=>n.Styles.createTextStyle({flex:-1,fontSize:p.default.fontSize.size17,fontFamily:p.default.fontFamily.uidDisplayRegular,color:h.Color.white,paddingLeft:10,paddingRight:10,alignSelf:"center"}),meText:()=>n.Styles.createTextStyle({color:h.Color.gray100,alignSelf:"center",paddingLeft:5}),timeStampStyle:()=>n.Styles.createTextStyle({alignSelf:"flex-end",paddingBottom:1}),accessibleTimeStampColor:()=>n.Styles.createTextStyle({color:h.Color.white})});class C extends S.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onItemPress(this.props.userMri)}}_buildState(e,t){return{isMe:u.default.isMyMri(e.userMri),accessibleTheme:_.default.isAccessibleTheme(),canAccessUserDetails:r.default.navigation().canAccessUserDetails}}render(){const e=[v.itemContainer,this.props.style],t=this.state.canAccessUserDetails&&!this.state.isMe;e.push(t?g.default.pointerCursor:g.default.defaultCursor);let s=this.props.buttonTitle;return this.props.timestamp&&(s+=", "+a.default.getDisplayDateTimeMixedString(this.props.timestamp)),(0,o.jsxs)(c.default.View,{style:e,onPress:t?this._onPress:void 0,accessibilityTraits:t?n.Types.AccessibilityTrait.Button:n.Types.AccessibilityTrait.Summary,importantForAccessibility:t?n.Types.ImportantForAccessibility.Yes:n.Types.ImportantForAccessibility.No,accessibilityLabel:s,activeOpacity:t?.8:void 0,children:[(0,o.jsx)(f.UserIcon,{userMri:this.props.userMri,size:y.UserIconSize.Size32,style:t?g.default.pointerCursor:g.default.defaultCursor}),this._getUserNameElement()]},"item"+this.props.userMri)}_getUserNameElement(){const e=(0,o.jsx)(n.Text,{style:v.mainText,numberOfLines:1,children:this.props.displayName});let t,s;if(this.props.timestamp){const e=[p.default.fontStyle.caption,v.timeStampStyle];this.state.accessibleTheme&&e.push(v.accessibleTimeStampColor),t=(0,o.jsx)(n.Text,{style:e,numberOfLines:1,children:a.default.getDisplayDateTimeMixedString(this.props.timestamp)})}return this.props.showMeLabel&&this.state.isMe&&(s=(0,o.jsx)(m.BodyText,{size:m.BodyTextSize.SmallDeprecated,style:v.meText,numberOfLines:1,children:d.getString("ReactionSummaryListViewItem.MeLabel")})),(0,o.jsxs)(n.View,{style:v.textContainer,children:[e,s,t]})}}t.default=C},81920:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemQuotesGestureWrapper=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(859745)),r=i.__importStar(s(516778)),a=i.__importDefault(s(207864)),l=i.__importDefault(s(453761)),d=s(26703),c=i.__importStar(s(704704)),u=s(641400),h=i.__importDefault(s(497910)),p=(0,d.lazyProperties)({quickQuotesStyleContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",overflow:"visible"}),gestureContainerStyle:()=>r.Styles.createViewStyle({overflow:"visible",flex:1}),quoteMessageIconContainer:()=>r.Styles.createViewStyle({position:"absolute",width:150,flexDirection:"row",alignItems:"center"}),quoteIconPadding:()=>r.Styles.createTextStyle({paddingHorizontal:4})});class g extends h.default{constructor(){super(...arguments),this._quotesButtonOpacityValue=new r.Animated.Value(0),this._quotesButtonOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._quotesButtonOpacityValue}),this._didDisableScrolling=!1,this._hapticFeedbackSent=!1,this._onPanViewQuickQuote=e=>{const t=e.pageX-e.initialPageX,s=Math.abs(t),i=t>=0;if(a.default.prepareFeedback(),!i)return void this._resetMessageContainerPosition();this.state.showQuickQuotesIcon||this.setState({showQuickQuotesIcon:!0}),this._disableScrolling(!0),this.props.onGestureStartStopCallback&&this.props.onGestureStartStopCallback(!0),t>20&&!this.state.showIconText?this.setState({showIconText:!0}):t<20&&this.state.showIconText&&this.setState({showIconText:!1}),this.props.positionToAnimateOnSwipe.setValue(this.props.initialPositionValue+t),s>50?this._quotesButtonOpacityValue.setValue(1):this._quotesButtonOpacityValue.setValue(s/50);const o=s>50;!this._hapticFeedbackSent&&o&&(this._hapticFeedbackSent=!0,a.default.triggerFeedback().then((()=>{a.default.unprepareFeedback()}))),e.isComplete&&(o&&(this.props.onQuotesCommandTrigger(),this._hapticFeedbackSent=!1),this._resetMessageContainerPosition())}}_buildState(e,t){const s={};return t&&(s.showQuickQuotesIcon=!1),s}render(){const e=this.state.showIconText?c.getString("StreamItem.ActionReply"):"",t=this.state.showQuickQuotesIcon?(0,o.jsxs)(r.Animated.View,{style:[p.quoteMessageIconContainer,this._quotesButtonOpacityStyle],children:[(0,o.jsx)(l.default,{icon:u.SkypeIcon.Reply,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,size:u.IconSize.size20,style:p.quoteIconPadding}),(0,o.jsx)(r.Text,{style:[this._themeStyles.secondaryTextColorStyle,p.quoteIconPadding],children:e})]}):void 0;return(0,o.jsxs)(r.View,{style:p.quickQuotesStyleContainer,children:[t,(0,o.jsx)(r.GestureView,{onPanHorizontal:this._onPanViewQuickQuote,panPixelThreshold:20,preferredPan:r.Types.PreferredPanGesture.Horizontal,releaseOnRequest:!1,importantForAccessibility:r.Types.ImportantForAccessibility.No,style:p.gestureContainerStyle,children:this.props.children},"streamViewGesture")]})}_resetMessageContainerPosition(){r.Animated.parallel([r.Animated.timing(this.props.positionToAnimateOnSwipe,{toValue:this.props.initialPositionValue,duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoInOut5,useNativeDriver:!0}),r.Animated.timing(this._quotesButtonOpacityValue,{toValue:0,duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoInOut5,useNativeDriver:!0})]).start((()=>{this._disableScrolling(!1),this.props.onGestureStartStopCallback&&this.props.onGestureStartStopCallback(!1),this.isComponentMounted()&&this.state.showQuickQuotesIcon&&this.setState({showQuickQuotesIcon:!1,showIconText:!1})}))}_disableScrolling(e){this.props.onDisableScroll&&(e?this._didDisableScrolling||(this.props.onDisableScroll(!0),this._didDisableScrolling=!0):this._didDisableScrolling&&(this.props.onDisableScroll(!1),this._didDisableScrolling=!1))}}t.StreamItemQuotesGestureWrapper=g},235020:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemReadReceipts=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(85385)),l=s(26703),d=i.__importStar(s(704704)),c=i.__importStar(s(954225)),u=s(786531),h=i.__importStar(s(353831)),p=s(926187),g=i.__importDefault(s(468492)),m=i.__importDefault(s(20758)),S=s(262725),_=i.__importDefault(s(497910)),f=s(403396),y=s(596648),v=(i.__importDefault(s(421334)),i.__importDefault(s(601976)),i.__importDefault(s(389659)),(0,l.lazyProperties)({container:()=>r.Styles.createButtonStyle({flexDirection:"row",justifyContent:"flex-end",maxWidth:c.maxStreamContentWidth,marginHorizontal:10,alignItems:"center",alignSelf:"flex-end"}),containerComposite:()=>r.Styles.createButtonStyle({marginLeft:50,marginRight:50}),containerCompositeMobile:()=>r.Styles.createButtonStyle({marginRight:16}),avatarStyle:()=>r.Styles.createViewStyle({marginLeft:4}),textView:()=>r.Styles.createTextStyle({marginLeft:4,lineHeight:m.default.controlFontSize.bodyBigDeprecated})})),C={};class T extends _.default{constructor(){super(...arguments),this._onContainerRef=e=>{e&&(this._containerButton=e)},this._getContainerButton=()=>this._containerButton,this._showPopup=()=>{this._readReceiptsPopup||(this._navDismissalRegistrationHandle=h.register({dismiss:this._onClosePopup}),this._readReceiptsPopup=new p.ReadReceiptsPopup(this.props.conversationId,this.props.readReceiptsSum,this._getContainerButton,this._onClosePopup,this._getRootViewId(),this._getRootViewType()),this._readReceiptsPopup.show(),a.track(new u.ReadReceiptsViewed(this.props.readReceiptsHeads.length,this.props.readReceiptsSum.length,this.props.conversationId)))},this._onClosePopup=()=>{this._readReceiptsPopup=void 0,this.isComponentMounted()&&this._containerButton&&this._containerButton.requestFocus&&this._containerButton.requestFocus(),this._navDismissalRegistrationHandle&&(h.unregister(this._navDismissalRegistrationHandle),this._navDismissalRegistrationHandle=void 0)}}_buildState(e,t){const s=this._getRootViewId();return{hideReadReceipts:g.default.isSelectMessagesModeActive(s),readReceiptAccessibilitySummary:undefined}}render(){const e=n.map(n.slice(this.props.readReceiptsHeads,0,3),(e=>(0,o.jsx)(f.UserIcon,{size:y.UserIconSize.Size16,userMri:e.mri,style:v.avatarStyle,showTitleOnHover:!this.state.hideReadReceipts},e.mri)));if(this.props.readReceiptsHeads.length>3){const t=this.state.hideReadReceipts?"":d.getString("StreamItem.ClickToSeeMoreReadReceiptsTitle");e.push((0,o.jsx)(r.View,{title:t,children:(0,o.jsx)(S.Caption,{style:v.textView,children:"+"+(this.props.readReceiptsHeads.length-3)})},"additionalCounter"))}if(!this.state.hideReadReceipts&&this.state.readReceiptAccessibilitySummary){const t=d.getString("StreamItem.ReadBySummaryAccessibilityLabel",{count:this.props.readReceiptsSum.length,summary:this.state.readReceiptAccessibilitySummary});return(0,o.jsx)(r.View,{style:this._getContainerStyles(),ref:this._onContainerRef,accessibilityLabel:t,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityTraits:r.Types.AccessibilityTrait.Summary,children:e})}return(0,o.jsx)(r.Button,Object.assign({},this._getCommonContainerProps(),{children:e}))}componentWillUnmount(){super.componentWillUnmount(),this._readReceiptsPopup&&(this._readReceiptsPopup.dismissPopup(),this._readReceiptsPopup=void 0)}_getCommonContainerProps(){return{style:this._getContainerStyles(),onPress:this._showPopup,ref:this._onContainerRef,accessibilityLabel:d.getString("StreamItem.ReadByMarkerAccessibilityLabel",{count:this.props.readReceiptsSum.length}),importantForAccessibility:this.state.hideReadReceipts?r.Types.ImportantForAccessibility.NoHideDescendants:r.Types.ImportantForAccessibility.Yes,accessibilityTraits:this.state.hideReadReceipts?r.Types.AccessibilityTrait.None:void 0,disableTouchOpacityAnimation:this.state.hideReadReceipts,tabIndex:this.state.hideReadReceipts?-1:void 0,disabledOpacity:0,disabled:this.state.hideReadReceipts}}_getHeightStyle(e){return C[e]||(C[e]=r.Styles.createButtonStyle({height:e},!1)),C[e]}_getContainerStyles(){const e=[v.container,this._getHeightStyle(this.props.availableHeight)];return this._getContext().isPresentedInDesktopSubview?e.push(v.containerCompositeMobile):e.push(v.containerComposite),e}}t.StreamItemReadReceipts=T},966659:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemTailAccessoryWrapper=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(217041),a=i.__importStar(s(971988)),l=s(26703),d=i.__importStar(s(704704)),c=i.__importDefault(s(827361)),u=s(262725),h=s(120880),p=s(677982),g=(0,l.lazyProperties)({accessory:()=>(0,l.lazyProperties)({smsFailedText:()=>n.Styles.createTextStyle({flex:1,textAlign:"right",paddingBottom:4,paddingTop:1})})}),m=new Map([[h.SkypeSmsErrorCategory.InsufficientFunds,"SMSErrorCodeElaboration.InsufficientFund"],[h.SkypeSmsErrorCategory.UserBlocked,"SMSErrorCodeElaboration.UserBlocked"],[h.SkypeSmsErrorCategory.RecipientBlocked,"SMSErrorCodeElaboration.RecipientBlock"],[h.SkypeSmsErrorCategory.NumberDoesNotExist,"SMSErrorCodeElaboration.NumberNotExist"],[h.SkypeSmsErrorCategory.NumberBlocked,"SMSErrorCodeElaboration.NumberBlocked"],[h.SkypeSmsErrorCategory.NumberUnreachable,"SMSErrorCodeElaboration.NumberUnreachable"],[h.SkypeSmsErrorCategory.SmsVelocityReached,"SMSErrorCodeElaboration.SmsVelocityReached"],[h.SkypeSmsErrorCategory.SenderBlockedByRecipient,"SMSErrorCodeElaboration.ServerBlockedByRecipient"]]);class S extends r.ComponentBase{_buildState(e,t){var s;const{errorCategory:i}=null!==(s=e.smsDeliveryStatus)&&void 0!==s?s:{},{enableSMSErrorCodeElaboration:o,smsErrorCode:n}=p.AppConfigStore.getS4LMessagingFeatures();return{smsDeliveryFailedTips:this._getErrorTips(o,i,n)}}_shouldWrapWithSmsFailed(){return!!this.props.smsDeliveryStatus&&!a.isSmsDeliveredSuccessfully(this.props.smsDeliveryStatus)}_getErrorTips(e,t,s){if(!e)return d.getString("SMSMessaging.SmsDeliveryFailed");const i=null!=s?s:t;if(!i)return d.getString("SMSMessaging.SmsDeliveryFailed");const o=m.get(i);return o?d.getString(o):d.getString("SMSMessaging.SmsDeliveryFailed")}_wrapWithSmsFailed(){return(0,o.jsxs)(n.View,{style:c.default.flexOne,children:[this.props.children,(0,o.jsx)(u.Caption,{style:g.accessory.smsFailedText,textThemeColor:u.TextThemeColor.Destructive,children:this.state.smsDeliveryFailedTips})]})}render(){return this._shouldWrapWithSmsFailed()?this._wrapWithSmsFailed():this.props.children?n.Children.only(this.props.children):null}}t.StreamItemTailAccessoryWrapper=S},683930:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StreamItemView=t.shouldShowExternalShareButton=t.AccessoryOrigin=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(331654)),a=i.__importDefault(s(815063)),l=s(537180),d=i.__importStar(s(516778)),c=i.__importStar(s(859745)),u=i.__importDefault(s(19831)),h=i.__importDefault(s(186325)),p=i.__importDefault(s(970035)),g=i.__importDefault(s(11252)),m=i.__importStar(s(888500)),S=i.__importDefault(s(998929)),_=i.__importDefault(s(827361)),f=i.__importDefault(s(497910)),y=(i.__importDefault(s(340724)),i.__importDefault(s(363091))),v=i.__importDefault(s(139221)),C=i.__importDefault(s(663823)),T=s(786531),M=s(73018),b=s(351947),I=i.__importDefault(s(670363)),w=i.__importDefault(s(791384)),P=i.__importDefault(s(150343)),k=i.__importDefault(s(48076)),A=i.__importDefault(s(740794)),x=i.__importDefault(s(201721)),D=i.__importDefault(s(341994)),R=i.__importDefault(s(942724)),L=i.__importDefault(s(450312)),B=i.__importDefault(s(960282)),F=(i.__importDefault(s(421334)),i.__importDefault(s(266872))),N=i.__importDefault(s(389659)),E=i.__importStar(s(85385)),O=i.__importStar(s(704704)),U=i.__importDefault(s(503411)),V=i.__importDefault(s(655192)),H=s(815146),j=s(16549),z=s(641400),W=s(935086),G=s(331079),K=s(536748),q=i.__importStar(s(954225)),Q=i.__importStar(s(69848)),X=i.__importStar(s(669327)),$=i.__importDefault(s(555436)),J=i.__importDefault(s(890908)),Y=i.__importDefault(s(685734)),Z=s(240265),ee=s(26703),te=i.__importDefault(s(601274)),se=i.__importDefault(s(760989)),ie=i.__importDefault(s(114818)),oe=s(83541),ne=s(290545),re=i.__importStar(s(463519)),ae=i.__importStar(s(971988)),le=i.__importStar(s(44717)),de=(i.__importStar(s(51789)),i.__importStar(s(920710))),ce=i.__importDefault(s(446802)),ue=i.__importDefault(s(484700)),he=i.__importDefault(s(794229)),pe=i.__importDefault(s(656681)),ge=i.__importDefault(s(468492)),me=s(954225),Se=s(206467),_e=i.__importStar(s(242561)),fe=s(331235),ye=s(900440),ve=s(43496),Ce=s(54233),Te=s(243864),Me=s(685794),be=s(81920),Ie=s(966659),we=i.__importStar(s(433614)),Pe=i.__importStar(s(676908)),ke=i.__importDefault(s(602160)),Ae=i.__importStar(s(170881)),xe=i.__importDefault(s(138145)),De=s(10966),Re=s(729827),Le=s(493680),Be=i.__importDefault(s(615364)),Fe=i.__importDefault(s(23551)),Ne=i.__importDefault(s(207864)),Ee=s(198649);s(138245);var Oe;!function(e){e[e.StreamItemFooter=1]="StreamItemFooter"}(Oe||(t.AccessoryOrigin=Oe={}));const Ue="stream-item-sx-popup",Ve=Se.CommandTypes.SelectMessages,He=v.default.isRTL()?35:-35,je=z.IconSize.size12,ze=(0,ee.lazyProperties)({innerStreamItemView:()=>(0,ee.lazyProperties)({containerStyle:()=>d.Styles.createViewStyle({flex:-1,alignItems:"stretch"}),containerStyleNews:()=>d.Styles.createViewStyle({flex:1,maxWidth:q.newsChannelMediaCardMaxWidth,alignItems:"stretch"}),desktopContainerStyle:()=>d.Styles.createViewStyle({minHeight:me.streamItemOptionsMenuHeight}),desktopContainerShrinkStyle:()=>d.Styles.createViewStyle({flexGrow:0}),containerSpacing:()=>(0,ee.lazyProperties)({paddingBottomRegular:()=>d.Styles.createViewStyle({paddingBottom:14}),paddingBottomSmall:()=>d.Styles.createViewStyle({paddingBottom:10}),paddingBottomComposite:()=>d.Styles.createViewStyle({paddingBottom:14}),paddingBottomCompositeSmall:()=>d.Styles.createViewStyle({paddingBottom:8}),paddingBottomWithReactions:()=>d.Styles.createViewStyle({paddingBottom:0}),paddingBottomWithReactionsOverlay:()=>d.Styles.createViewStyle({paddingBottom:24})}),footerSpacing:()=>(0,ee.lazyProperties)({paddingLeftRegular:()=>d.Styles.createViewStyle({paddingLeft:14}),paddingLeftSmall:()=>d.Styles.createViewStyle({paddingLeft:10}),paddingLeftComposite:()=>d.Styles.createViewStyle({paddingLeft:15}),noPaddingLeft:()=>d.Styles.createViewStyle({paddingLeft:0}),marginTop:()=>d.Styles.createViewStyle({top:-22,marginBottom:-22,paddingBottom:4}),marginTopRecorderVideos:()=>d.Styles.createViewStyle({top:-3,marginBottom:-3}),paddingBottomWithReactions:()=>d.Styles.createViewStyle({paddingBottom:25})}),messageContentSpacing:()=>(0,ee.lazyProperties)({regular:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:14,paddingRight:14,paddingTop:14})}),compact:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:9,paddingRight:12,paddingTop:8})}),compositeRegular:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:15,paddingRight:15,paddingTop:14})}),compositeCompact:()=>(0,ee.lazyProperties)({WithBubble:()=>d.Styles.createViewStyle({paddingLeft:11,paddingRight:12,paddingTop:9})})})}),streamItemViewWithButtons:()=>(0,ee.lazyProperties)({wrapper:()=>d.Styles.createViewStyle({flex:1,justifyContent:"flex-start",flexDirection:"row"}),wrapperCenter:()=>d.Styles.createViewStyle({justifyContent:"center"}),wrapperMe:()=>d.Styles.createViewStyle({justifyContent:"flex-end"})}),messageContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch"}),messageContainerPadding:()=>d.Styles.createViewStyle({paddingHorizontal:10}),headerLeftPadding:()=>(0,ee.lazyProperties)({smallDevice:()=>d.Styles.createViewStyle({paddingLeft:8}),regularDevice:()=>d.Styles.createViewStyle({paddingLeft:10}),desktop:()=>d.Styles.createViewStyle({paddingLeft:40})}),accessoryTopPadding:()=>d.Styles.createViewStyle({paddingTop:me.headerTextHeight}),accessoryNoPadding:()=>d.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),messageSelection:()=>(0,ee.lazyProperties)({messageSelectionContainer:()=>d.Styles.createViewStyle({flexDirection:"row",alignContent:"center",overflow:"visible"}),messageWithTimeStampContainer:()=>d.Styles.createViewStyle({marginTop:20}),selectionContainerPosition:()=>d.Styles.createViewStyle({position:"absolute",paddingLeft:10,alignSelf:"center"})}),icon:()=>d.Styles.createViewStyle({marginRight:-je-2,paddingLeft:2,alignSelf:"flex-end"}),mobileSideDistance:()=>d.Styles.createViewStyle({paddingRight:16})});let We=800;r.default.getMaxViewSizeForTexture().then((e=>{We=e}),(e=>{E.warn(H.LogTraceArea.StreamItem,"DeviceUtilities getMaxViewSizeForTexture failed: "+V.default.errorAsString(e))}));const Ge={};t.shouldShowExternalShareButton=(e,t,s)=>t&&e===ae.MessageTypeGroups.SwiftCard&&!s||!1;class Ke extends f.default{constructor(){super(...arguments),this._innerMovingContainerXOffsetValue=new d.Animated.Value(0),this._selectContainerOpacityValue=new d.Animated.Value(1),this._selectContainerXOffsetValue=new d.Animated.Value(0),this._selectionContainerXOffsetStyle=d.Styles.createAnimatedViewStyle({transform:[{translateX:this._selectContainerXOffsetValue}]}),this._selectionContainerOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._selectContainerOpacityValue}),this._dimIconsOpacityValue=new d.Animated.Value(1),this._dimIconsOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._dimIconsOpacityValue}),this._itemScaleValue=new d.Animated.Value(1),this._itemBgValue=new d.Animated.Value(0),this._innerStreamItemViewAnimationStyle=d.Styles.createAnimatedViewStyle({transform:[{translateX:this._innerMovingContainerXOffsetValue},{scale:this._itemScaleValue}]}),this._xBase=0,this._onExternalShareMobile=e=>i.__awaiter(this,void 0,void 0,(function*(){const t=H.LogTraceArea.NewsBot,s=ne.ArticleReaderOrigin.NewsBot;if(E.log(t,"External share action"),!e)return;const i=yield Y.default.getFullUserProfileByMriAsync(y.default.getSkypeMri()),o=null==i?void 0:i.getDisplayName(),n=new Promise((e=>{setTimeout((()=>{e(void 0)}),2e3)})),r=J.default.fetchLinkAsPromise(o);Promise.race([r,n]).then((i=>{l.Share.share({message:(0,oe.getExternalShareMessage)(e,o,i),url:e},{dialogTitle:O.getString("Browser.Share")}).then((e=>{e.action===l.Share.sharedAction&&(E.log(t,"External share action was executed"),E.track(new b.TodayShareTelemetry(ne.TodayShareActionTelemetry.SharedExternallyAction,s)))})),E.track(new b.TodayShareTelemetry(ne.TodayShareActionTelemetry.OpenedExternalShare,s))}))})),this._toggleReactionBottomSheet=()=>{this.setState({isBottomSheetOpened:!this.state.isBottomSheetOpened}),this.state.isBottomSheetOpened&&(Ne.default.triggerFeedback(),Ae.dismissAll())},this._openMoreReactionsBottomSheet=()=>{this.setState({isMoreReactionBottomSheetOpened:!0})},this._closeMoreReactionsBottomSheet=()=>{this.setState({isMoreReactionBottomSheetOpened:!1})},this._onExternalShareDesktop=(e,t)=>{const s=H.LogTraceArea.NewsBot;if(E.log(s,"External share action"),!e)return;const i={anchor:()=>t,useTheme:!0,popupDisableContextMenu:!0,positionPriorities:["bottom","top"]},o=[{text:O.getString("Today.CopyLink"),command:"copyLink"}];m.default.showWithOptions({id:m.default.menuId(),config:i,getMenuItems:()=>o,handleMenuCommand:t=>{"copyLink"===t&&((0,Z.writeTextToClipboard)(e),U.default.scheduleTextMessage(O.getString("Today.CopiedToClipboard"),void 0,this._getContext().rootViewId),E.log(s,"External share action was executed"),E.track(new b.TodayShareTelemetry(ne.TodayShareActionTelemetry.SharedExternallyAction,ne.ArticleReaderOrigin.NewsBot)))},rootViewId:this._getContext().rootViewId,destructiveButtonIndex:void 0,invokingEvent:void 0})},this._onExternalShare=(e,t)=>{if(e)return this.state.isUsingStackNavigationContext?this._onExternalShareMobile(e):this._onExternalShareDesktop(e,t)},this._onTap=e=>{const t=new M.ReactionPickerTelemetry(this.props.message,M.ReactionOriginType.DoubleTap),s="yes";if(this._isDoubleTap(e)){this._cancelDoubleTapTimer(),this._lastTapEvent=void 0;const e=this.props.message.getReactions(),i=he.default.getEmoticonTone(s),o=e.some((e=>e.key===de.updateReactionNameWithTone(s,i))),n={message:this.props.message,reactionAction:{reaction:s,reactionTone:i,reactionLevel:0,reactionAdded:!o,isCustomReaction:!1}};de.addRemoveReactionFromMessage(n,t,(e=>{if(D.default.doesMessageHaveHint(this.props.message.cuid)){ue.default.hintShownAndUsed();const e=ce.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,D.default.setMessagesHintData(K.MessageHintsTypes.DoubleTapMessageToLike,e)}this._onAddingReactionDone(e,s,!o)}))}else this._startDoubleTapTimer(e)},this._navigateToBookmarkSource=e=>{e&&e.stopPropagation(),A.default.navigateToBookmarkSource(this.props.message.properties)},this._addOrRemoveMessageCallback=e=>{e&&e.stopPropagation(),this._onSelectMessage()},this._onSelectMessagesStreamItemCommandCallback=e=>{ge.default.activateSelectMessagesMode(this._getRootViewId()),this._onSelectMessage()},this._onSelectMessage=e=>{let t;const s=[];let i;this.props.message.isAlbum()&&(i=se.default.newGuid(),t=pe.default.getAllMediaMessagesForAlbum(this.props.message.getAlbumId()),n.each(t,(e=>{s.push({message:e,node:re.decode(e),actionMenuCommands:this.props.messageActions&&this.props.messageActions.actionMenuCommands,forwardAlbumId:i})})));const o={message:this.props.message,node:this.props.decodedNode,actionMenuCommands:this.props.messageActions&&this.props.messageActions.actionMenuCommands,urlPreviewId:this.props.urlPreviewId,forwardAlbumId:i};e||!this.state.isMessageSelected?(ge.default.addOrUpdateSelectedMessage(o),n.each(s,(e=>ge.default.addOrUpdateSelectedMessage(e)))):(ge.default.removeSelectedMessage(o),n.each(s,(e=>ge.default.removeSelectedMessage(e)))),e||this.setState({isMessageSelected:!this.state.isMessageSelected})},this._onLayout=e=>{if(this.isComponentMounted()){if(void 0!==this.state.availableSpace&&(E.debug((()=>["DIM_CALC - _onLayout: e: ",e," _availableSpace: ",this.state.availableSpace," renderOrigin: "+this.props.renderOrigin])),this.state.availableSpace&&this.state.availableSpace.width&&Math.abs(this.state.availableSpace.width-e.width)>25)){E.debug((()=>["DIM_CALC - _onLayout set state "]));const t=this.props.viewRenderingOptions.showMessageTimestamp||!1,s={width:e.width,height:t?e.height:e.height+20-2};this.props.viewRenderingOptions.calcRenderDim?this.setState({availableSpace:s,dimensions:this.props.viewRenderingOptions.calcRenderDim(s,this.props.renderOrigin)}):this.setState({availableSpace:s})}this.props.onLayout&&this.props.onLayout(e)}},this._onHandleContextMenu=e=>{this.state.showReactionsInBottomSheet?this._toggleReactionBottomSheet():!this.state.isSelectMessagesModeActive&&this._hasActionMenuCommands()&&(m.default._menuTargetComponent=this._menuTargetComponent||this._streamItem||void 0,u.default.showContextMenu(e,this._getRootViewId(),{getMenuItems:this._getMenuItems,onItemSelected:this._onCommandSelectedInContextMenu,onDismiss:this._onContextMenuDismissed},!1))},this._onSelectText=e=>{var t;if(!this.state.enableMiniContextMenu)return;const s=null===(t=this.getSelection())||void 0===t?void 0:t.trim();s&&this._prevString!==s&&(this._prevString=s,!this.state.isSelectMessagesModeActive&&this._hasActionMenuCommands()&&(m.default._menuTargetComponent=this._menuTargetComponent||this._streamItem||void 0,u.default.showContextMenu(e,this._getRootViewId(),{getMenuItems:this._getNewMenuItems,onItemSelected:this._onCommandSelectedInContextMenu,onDismiss:this._onContextMenuDismissed},!0)))},this._handleMoreButtonPressed=()=>{this._toggleReactionBottomSheet(),this.state.enableMoreReactionsMsgMenu?this._openMoreReactionsBottomSheet():(0,De.openCustomReactionPanel)(Re.CustomReactionsType.Message,this._getRootViewId())},this._streamItemViewRef=e=>{this._streamItem=e||void 0},this._menuTargetComponentRef=e=>{this._menuTargetComponent=e||void 0},this._onQuotesCommandTriggerFromSwipe=()=>{this.props.onQuote&&this.props.onQuote([this.props.message],W.QuotesTriggerType.Swipe)},this._onHideStreamAccessories=e=>{this._dimIconsOpacityValue.setValue(e?0:1)},this._getMenuItems=()=>{const e=this._getCommandManagerOptions();return this.props.messageActions?this._commandManager.getSXMenuItems(e,this.props.messageActions.actionMenuCommands):[]},this._getNewMenuItems=()=>{const e=this._getCommandManagerOptions();return this.props.messageActions?this._commandManager.getSXMenuItems(e,this.props.messageActions.actionMenuCommands,!0):[]},this._onAccessibilityAction=e=>{const t=e.nativeEvent;if(t&&!n.isEmpty(t.actionName)){const e=n.filter(this._getMenuItems(),(e=>(0,ie.default)(e.text,t.actionName)));this._commandManager.onActionMenuOptionSelected(this._getCommandManagerOptions(),e[0].command,T.MessageActionOrigin.StreamItemDesktopContextMenu)}},this._onContentContainerRef=e=>{this._contentContainer=e},this._onStreamItemCommandSelected=(e,t,s)=>{this._onCommandSelected(e,s),e!==m.SXActionMenuCancel&&(this._contextMenuItemSelected=!0)},this._onCommandSelectedInStreamItemAccessory=e=>{this._onCommandSelected(e,T.MessageActionOrigin.StreamItemAccesory)},this._onCommandSelectedInContextMenu=e=>{this._onCommandSelected(e,T.MessageActionOrigin.StreamItemDesktopContextMenu),this._contextMenuItemSelected=!0},this._onCommandSelected=(e,t)=>{const s=this._getCommandManagerOptions();this._commandManager.onActionMenuOptionSelected(s,e,t),this.state.showReactionsInBottomSheet&&this.state.isBottomSheetOpened&&this._toggleReactionBottomSheet()},this._onContextMenuDismissed=()=>{this._trackDismissActionMenuTelemetry()},this._onStreamItemContentRef=e=>{this._streamItemContentRef=e||void 0},this._onMountContent=(e,t,s)=>{this.props.onMountContent&&this.props.onMountContent(e,t,s,this.props.message)},this._onLongPress=(e,t)=>{},this._onActionMenuDismissed=()=>{this._focusContentContainer(),this._trackDismissActionMenuTelemetry()},this._focusContentContainer=()=>{this.isComponentMounted()&&this._contentContainer&&this._contentContainer.requestFocus()},this._onPress=e=>{C.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback(e):this.props.onItemPress&&this.props.onItemPress(e,this.props.message)},this._onDesktopOptionsButtonPress=(e,t,s,i)=>{const o=this._getRootViewId();return t&&this._hasActionMenuCommands()?(this._trackSearchSuccessTelemetry(),this._commandManager.showSXPopup(this._getCommandManagerOptions(),this.props.messageActions.actionMenuCommands,Ue,s,o,e,(()=>{i&&i(),this._onContextMenuDismissed()}))):(this._commandManager.dismissSXPopup(Ue,o),!1)},this._onContentHorizontalScroll=e=>{this.isComponentMounted()&&this.setState({isContentScrolled:!!e})},this._getCurrentMessage=()=>this.props.message,this._getReactionMenuAnchor=()=>this._streamItem}_buildState(e,t){const s=P.default.getS4LMessagingFeatures(),i=this._getRootViewId(),o={};t&&(o.disableStylingForTallBubbleAndroid=!1,o.isMoreReactionBottomSheetOpened=!1,o.availableSpace=e.viewRenderingOptions.availableSpace,e.viewRenderingOptions.calcRenderDim&&(o.dimensions=e.viewRenderingOptions.calcRenderDim(o.availableSpace,e.renderOrigin),E.debug((()=>["DIM_CALC - dimensions set from viewRenderingOptions in initial build state"])))),o.useAccessibleTheme=F.default.isAccessibleTheme(),o.isSmallDevice=B.default.isSmallDevice(i)||!!this._getContext().isPresentedInDesktopSubview,o.isMinDesktopWidth=B.default.isMinDesktopWidth(i),o.useCompactLayout=o.isSmallDevice||F.default.isCompactLayout(),o.isUsingStackNavigationContext=R.default.isUsingStackNavigationContext(),o.userIconWidth=Te.StreamItemHeader.getUserIconWidth(o.isSmallDevice),o.isContentScrolled=!1,o.singleEmoticonSize=s.singleEmoticonSize,o.emoticonsOnlyEmoticonSize=s.emoticonsOnlyEmoticonSize,o.allowHugeEmoticons=x.default.getUserPreferencesLocal().allowHugeEmoticons;const n=this._shouldShowSelectionOption(e)&&e.isSelectMessagesModeActive;if(o.isSelectMessagesModeActive=n,o.showReactionsOverlay=e.viewRenderingOptions.showReactionsOnMessage&&e.viewRenderingOptions.overlayReactionsOnMessage,o.showReactionsInBottomSheet=s.enableReactionsInBottomSheet,o.isConversationAccepted=$.default.isConversationAccepted(e.message.conversationId),o.isBookmarkThread=le.isBookmarkConversation(e.message.conversationId),o.doubleTapReactionEnabled=s.enableDoubleTapReaction,o.enableMiniContextMenu=s.enableMiniContextMenu&&D.default.getMiniContextMenuEnabled(),o.enableMessageSendSuccessProcessing=s.enableMessageSendSuccessProcessing,this._commandManager||(this._commandManager=new ye.StreamItemCommandManager(this._onStreamItemCommandSelected)),n||(o.isMessageSelected=!1),o.accessibilityTraits=we.toAccessibilityTraits(e.viewRenderingOptions.accessibilityLabelType),e.viewRenderingOptions.skipAccessibilityLabelForMessageView)o.importantForAccessibility=d.Types.ImportantForAccessibility.No;else{let t=we.toAccessibilityLabel(e.decodedNode,{message:e.message,messageAccessibilityType:e.viewRenderingOptions.accessibilityLabelType,includeReactionInformationInAccessibilityLabel:!0});0,o.accessibilityLabel=t,o.importantForAccessibility=d.Types.ImportantForAccessibility.Yes}o.isTablet=k.default.isTabletNoSubscription(),o.isLandscape=B.default.getDeviceOrientation(i)===r.DeviceOrientation.Landscape,o.responsiveWidth=B.default.getResponsiveWidth(i),o.enableMoreReactionsMsgMenu=s.enableMoreReactionsMsgMenu,o.accessibilityLiveRegion=(0,Le.isMagicBotContainingConversation)((0,Be.default)().getConversation(e.message.conversationId))?d.Types.AccessibilityLiveRegion.Polite:d.Types.AccessibilityLiveRegion.None;const a=e.message.getOriginalClientMessageId();return o.showSpinner=!(!o.enableMessageSendSuccessProcessing||!a)&&Fe.default.shouldShowSpinner(a,e.message.isMessageLie()),o}_getCommandManagerOptions(){const e=L.default.getActiveCallConversationIdNoSubscription(),s=ae.getMessageTypeGroup(this.props.message);return{message:this.props.message,decodedNode:this.props.decodedNode,urlPreviewData:this.props.urlPreviewData,url:this.props.urlPreviewData?this.props.urlPreviewData.url:"",getReactionMenuPopupAnchor:this._getReactionMenuAnchor,onEditCallback:this.props.onEdit,onQuoteCallback:this.props.onQuote,onTranslateCallback:this.props.onToggleTranslation,onTranslateOneCallback:this.props.onToggleTranslateOne,onSelectMessagesCommandCallback:this._onSelectMessagesStreamItemCommandCallback,screenReaderEnabled:this.props.screenReaderEnabled,onMarkAsUnread:this.props.onMarkAsUnread,renderOrigin:this.props.renderOrigin,contextConversationId:e,componentContext:this._getContext(),selectedText:"",showTranslatedMessage:this.props.showTranslatedMessage,hasTranslation:this.props.hasTranslation,isConversationTranslated:this.props.conversationTranslated,onCopy:this.props.onCopyContextMenu,onQuoteSelection:this.props.onQuoteSelectionContextMenu,onExternalShare:(0,t.shouldShowExternalShareButton)(s,this.props.isNewsBot,this.props.viewRenderingOptions.messageContentExpandedToAvailableArea)?this._onExternalShare:void 0}}componentDidMount(){if(super.componentDidMount(),this.state.isSelectMessagesModeActive&&(this._selectContainerXOffsetValue.setValue(He),this._onHideStreamAccessories(!0),!this.state.isMessageSelected)){const e=ge.default.isMessageSelected(this.props.message.cuid);e&&this.setState({isMessageSelected:e})}}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),this.props.shouldScreenReaderFocusItem&&!e.shouldScreenReaderFocusItem&&this._focusContentContainer(),this.state.isMessageSelected&&!(0,ie.default)(e.message.content,this.props.message.content)&&this._onSelectMessage(!0),t.isSelectMessagesModeActive!==this.state.isSelectMessagesModeActive){let e=He;const t=c.Common.Duration.Default;let s=1;this.state.isSelectMessagesModeActive||(e=0,s=0),this.setState({forceSelectCheckboxToBeVisible:!0});const i=[I.default.timing(this._selectContainerXOffsetValue,{toValue:e,duration:t,easing:c.Easing.SkypeExpoOut5,useNativeDriver:!0}),I.default.timing(this._selectContainerOpacityValue,{toValue:s,duration:t,easing:c.Easing.SkypeExpoOut5,useNativeDriver:!0})];d.Animated.parallel(i).start((()=>{!this.state.isSelectMessagesModeActive&&this.isComponentMounted()&&this.setState({forceSelectCheckboxToBeVisible:!1})})),this._onHideStreamAccessories(!!this.state.isSelectMessagesModeActive)}if(e.isSelectMessagesModeActive!==this.props.isSelectMessagesModeActive&&this.props.onListItemDetails){const e={};e.onKeyPress=this.props.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,this.props.onListItemDetails(e)}}render(){const e=this._getMessageContentWithBackground(),t=this._addOuterContentToMessageView(e),s=[ze.messageContainer,this.props.viewRenderingOptions.messageContainerStyle,void 0];this.props.viewRenderingOptions.messageContentExpandedToAvailableArea&&!this.props.isNewsBot||(this.state.isUsingStackNavigationContext||this.props.renderOrigin!==_e.MessageRenderOrigin.ChatCanvas&&this.props.renderOrigin!==_e.MessageRenderOrigin.CallCanvas)&&s.push(ze.messageContainerPadding);const i=this._renderSendingIndicator(),r=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ke.default,{isBottomSheetOpen:this.state.isBottomSheetOpened,onBottomSheetClose:this._toggleReactionBottomSheet,origin:T.MessageActionOrigin.StreamItem,message:this.props.message,onItemSelected:this._onCommandSelected,onMoreButtonPressed:this._handleMoreButtonPressed,menuItems:this._getMenuItems(),commands:this.props.messageActions?this.props.messageActions.outerButtonCommands:[]}),this.state.enableMoreReactionsMsgMenu&&(0,o.jsx)(xe.default,{message:this.props.message,onClose:this._closeMoreReactionsBottomSheet,isOpen:this.state.isMoreReactionBottomSheetOpened})]});let a;const l=this.state.isSelectMessagesModeActive||this.state.forceSelectCheckboxToBeVisible;if(l){const e=this.props.viewRenderingOptions.viewColorProperties.disableGradient?j.Color.gray300:this.props.viewRenderingOptions.viewColorProperties.userPrimaryColor,t=O.getString("MessageStream.SelectionToggleOff"),s=O.getString("MessageStream.SelectionToggleOn"),i=!!this.state.isMessageSelected,n=i?s:t,r=Q.getToggleSwitchItemLabel(n,i),l=[ze.messageSelection.selectionContainerPosition,this._selectionContainerXOffsetStyle,this._selectionContainerOpacityStyle],c=void 0;a=(0,o.jsx)(d.View,{style:[ze.messageSelection.messageSelectionContainer,this.props.viewRenderingOptions.showMessageTimestamp?ze.messageSelection.messageWithTimeStampContainer:void 0],children:(0,o.jsx)(d.Animated.View,{style:l,importantForAccessibility:c,accessibilityTraits:d.Types.AccessibilityTrait.Button,accessibilityLabel:r,children:(0,o.jsx)(g.default,{isOn:i,selectionColor:e,disableSelectionAnimation:!0})})})}const c=this._isDesktopOrDesktopSubView();let u;if(c||this._isPresentedInDesktopSidebar()){const e=!!this.props.messageActions&&!n.isEmpty(this.props.messageActions.actionMenuCommands)&&!this.state.isSelectMessagesModeActive;u=(0,o.jsxs)(Me.StreamItemOptionsMenu,{id:this.props.message.cuid,ref:this._menuTargetComponentRef,style:s,renderOptionsButton:e,onButtonPress:this._onDesktopOptionsButtonPress,messageContentCentered:!!this.props.viewRenderingOptions.messageContentCentered,onSelect:this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,onLayout:this._onLayout,useBookmarkUI:this.props.message.isBookmark(),onSecondaryButtonPress:this.props.message.isBookmark()?this._navigateToBookmarkSource:void 0,children:[t,a,i]})}else{if(this.state.isSelectMessagesModeActive||this.state.forceSelectCheckboxToBeVisible)return s.push(ze.mobileSideDistance),(0,o.jsxs)(S.default.View,{style:s,onLayout:this._onLayout,onPress:l?this._addOrRemoveMessageCallback:void 0,activeOpacity:l?.8:void 0,children:[t,a,i]});{const e=this.state.isSelectMessagesModeActive&&!c?this._getAccessibilityProps():void 0;s.push(ze.mobileSideDistance),u=(0,o.jsxs)(d.View,Object.assign({style:s,onLayout:this._onLayout,onPress:l?this._addOrRemoveMessageCallback:void 0,activeOpacity:l?.8:void 0,ref:this._streamItemViewRef},e,{children:[r,t,a,i]}))}}return this.props.viewRenderingOptions.showDivider&&(u=(0,o.jsxs)(d.View,{children:[u,(0,o.jsx)(h.default,{marginTop:15,marginBottom:5,marginLeft:this._getBookmarkDividerLeftSpacing()})]})),u}copySelection(e){if(this._streamItemContentRef)return this._streamItemContentRef.copySelection(e)}quoteSelection(){if(this._streamItemContentRef)return this._streamItemContentRef.quoteSelection()}getSelection(){var e;return null===(e=window.getSelection())||void 0===e?void 0:e.toString()}_onAddingReactionDone(e,t,s){let i="ReactionsMenu.YouReactedError";i=e?s?"ReactionsMenu.YouReacted":"ReactionsMenu.YouRemovedReaction":s?"ReactionsMenu.YouReactedError":"ReactionsMenu.YouRemovedReactionError",w.default.maybeAnnounceForAccessibility(O.getString(i,{reaction:t}))}_isDoubleTap(e){if(!this._lastTapEvent)return!1;return this._getEventTimestamp(e)-this._getEventTimestamp(this._lastTapEvent)<=200}_startDoubleTapTimer(e){this._lastTapEvent=e,this._doubleTapTimer=te.default.setTimeout((()=>{this.isComponentMounted()&&(this._doubleTapTimer=void 0)}),200)}_cancelDoubleTapTimer(){this._doubleTapTimer&&(te.default.clearTimeout(this._doubleTapTimer),this._doubleTapTimer=void 0)}_getEventTimestamp(e){return e.timeStamp?e.timeStamp.valueOf():0}_getBookmarkDividerLeftSpacing(){return this.state.isUsingStackNavigationContext&&!this.state.isTablet?10:void 0}_renderSendingIndicator(){return(this.state.enableMessageSendSuccessProcessing?this.state.showSpinner:this.props.viewRenderingOptions.sendingStatus===Pe.MessageRenderSendingStatus.Sending||this.props.viewRenderingOptions.sendingStatus===Pe.MessageRenderSendingStatus.NoNetwork)?(0,o.jsx)(p.default,{color:this._getContext().themeColors.textSecondary,size:je,style:ze.icon,icon:z.SkypeIcon.Recent}):null}_isPresentedInDesktopSidebar(){return!(!this._getContext().isPresentedInDesktopLeftNav&&!this._getContext().isPresentedInDesktopRightNav)}_isDesktopOrDesktopSubView(){return this.props.viewRenderingOptions.showDesktopButton&&!this.state.isUsingStackNavigationContext&&!this._getContext().isPresentedInDesktopSubview}_shouldShowSelectionOption(e){return!!e.messageActions&&n.some(e.messageActions.actionMenuCommands,(e=>e===Ve))}_trackDismissActionMenuTelemetry(){if(!this._contextMenuItemSelected){const e=new T.MessageActionTelemetry(this.props.message.conversationId,this.props.message,this.props.message.createdTime,T.MessageActionOrigin.StreamItem,T.MessageActionType.DismissActionMenu);E.track(e)}this._contextMenuItemSelected=!1}_trackSearchSuccessTelemetry(){X.messageActionDone(this.props.message.conversationId)}_getMessageContentWithBackground(){const e=this.props.viewRenderingOptions,t=e.messageContainerRadiusStyle,s=[ze.innerStreamItemView.containerStyle,void 0,this._innerStreamItemViewAnimationStyle];t&&s.push(...t);const i=[],n=this._footerSpacingStyle(),r=[_.default.flexOne],a=this._getContext();let l;if(this._shouldRenderBackground()){const{disableGradient:e,bubbleColor:t}=this.props.viewRenderingOptions.viewColorProperties;let o;if(e){const{surfaceSecondary:e,dividerPrimary:t}=a.themeColors;o=e,a.mode.isAccessible&&s.push(d.Styles.createWebViewStyle({borderWidth:1,borderColor:t},!1)),s.push(d.Styles.createViewStyle({backgroundColor:o},!1))}else o=t,s.push(d.Styles.createViewStyle({backgroundColor:t},!1));if(!a.mode.isAccessible){const e=(0,Ee.lightenColorPercent)(o,-10);l=d.Styles.createAnimatedViewStyle({backgroundColor:this._itemBgValue.interpolate({inputRange:[0,1],outputRange:[o,e]})})}const n=this.props.isNewsBot&&this.props.message.messagetype===ae.MessageTypes.Media_Card;this.state.isUsingStackNavigationContext?this.state.useCompactLayout?(n||i.push(ze.innerStreamItemView.messageContentSpacing.compact.WithBubble),r.push(ze.innerStreamItemView.containerSpacing.paddingBottomSmall)):(n||i.push(ze.innerStreamItemView.messageContentSpacing.regular.WithBubble),r.push(ze.innerStreamItemView.containerSpacing.paddingBottomRegular)):this.state.useCompactLayout?(n||i.push(ze.innerStreamItemView.messageContentSpacing.compositeCompact.WithBubble),r.push(ze.innerStreamItemView.containerSpacing.paddingBottomCompositeSmall)):(n||i.push(ze.innerStreamItemView.messageContentSpacing.compositeRegular.WithBubble),r.push(ze.innerStreamItemView.containerSpacing.paddingBottomComposite)),this.props.message.hasReactions()&&this.props.viewRenderingOptions.showReactionsOnMessage&&(this.state.showReactionsOverlay?r.push(ze.innerStreamItemView.containerSpacing.paddingBottomWithReactionsOverlay):r.push(ze.innerStreamItemView.containerSpacing.paddingBottomWithReactions)),this.props.isNewsBot&&r.push(ze.innerStreamItemView.containerSpacing.paddingBottomWithReactionsOverlay)}e.includeCursor&&r.push(_.default.pointerCursor),e.messageContentSpacingStyle&&i.push(e.messageContentSpacingStyle);const c=this._contextMenuHandler();let u=(0,o.jsx)(d.Animated.View,{style:[s,l],children:(0,o.jsxs)(d.View,{style:r,activeOpacity:e.showTouchFeedbackOnPress?.8:1,importantForAccessibility:d.Types.ImportantForAccessibility.No,onLongPress:this.state.isSelectMessagesModeActive?void 0:c,onPress:this.state.doubleTapReactionEnabled?this._onTap:this._onSelectText,onContextMenu:this.state.isSelectMessagesModeActive?void 0:c,children:[(0,o.jsx)(d.View,{style:i,children:this._getStreamItemContent()}),this.state.showReactionsOverlay||this.props.isNewsBot?void 0:this._getStreamItemFooter(n)]},"bubblecontent")},"contentContainer");return this._isQuickQuoteSupported()&&(u=(0,o.jsx)(be.StreamItemQuotesGestureWrapper,{onDisableScroll:this.props.onDisableScroll,onQuotesCommandTrigger:this._onQuotesCommandTriggerFromSwipe,positionToAnimateOnSwipe:this._innerMovingContainerXOffsetValue,initialPositionValue:this._xBase,onGestureStartStopCallback:this._onHideStreamAccessories,children:u})),u}_footerSpacingStyle(){const e=[];return(this._shouldRenderBackground()||this.state.showReactionsOverlay)&&(this.state.isUsingStackNavigationContext?this.state.useCompactLayout?e.push(ze.innerStreamItemView.footerSpacing.paddingLeftSmall):e.push(ze.innerStreamItemView.footerSpacing.paddingLeftRegular):this.state.useCompactLayout?e.push(ze.innerStreamItemView.footerSpacing.paddingLeftSmall):e.push(ze.innerStreamItemView.footerSpacing.paddingLeftComposite),this.props.isNewsBot&&e.push(ze.innerStreamItemView.footerSpacing.noPaddingLeft)),e}_isQuickQuoteSupported(){return!1}_addOuterContentToMessageView(e){const t=[ze.streamItemViewWithButtons.wrapper],s=this._isQuickQuoteSupported()?_.default.overflowVisible:void 0,i=[s],n=[_.default.noncollapsibleView,this.props.isNewsBot?ze.innerStreamItemView.containerStyleNews:ze.innerStreamItemView.containerStyle,this.props.viewRenderingOptions.outerWrapperOverideStyle,s];let r,a;if((this._isDesktopOrDesktopSubView()||this._isPresentedInDesktopSidebar())&&n.push(ze.innerStreamItemView.desktopContainerStyle),this.props.viewRenderingOptions.showStreamItemAccessory&&!this.props.isNewsBot&&(this.props.postedByCurrentUser&&!this.props.message.isBookmark()?(r=this._getStreamItemAccessory(),t.push(ze.streamItemViewWithButtons.wrapperMe)):a=this._getStreamItemAccessory()),this.props.isNewsBot&&t.push(ze.streamItemViewWithButtons.wrapperCenter),this.props.viewRenderingOptions.messageContentCentered)t.push(ze.streamItemViewWithButtons.wrapperCenter);else if(this.props.viewRenderingOptions.messageContentExpandedToAvailableArea||this.props.isNewsBot)this.props.viewRenderingOptions.messageContentExpandedToAvailableArea&&n.push(_.default.flexOne);else{const e=d.Styles.createViewStyle({marginLeft:this.state.userIconWidth},!1);this.props.viewRenderingOptions.showMessageSenderIcon?i.push(e):this.props.viewRenderingOptions.allowMarginForSenderIcon&&n.push(e)}const l=this._getSpacerStyle();let c;l&&t.push(l),c=this.state.isSelectMessagesModeActive&&!this._isDesktopOrDesktopSubView?{importantForAccessibility:d.Types.ImportantForAccessibility.NoHideDescendants}:this.props.viewRenderingOptions.includeAccessibilityPropertiesOnMessageHeader?void 0:this._getAccessibilityProps(),this.props.postedByCurrentUser&&t.push(this._selectionContainerXOffsetStyle);const u={ref:this._onContentContainerRef,style:n};let h;h=this.props.message.messagetype===ae.MessageTypes.CastRecording?ze.innerStreamItemView.footerSpacing.marginTopRecorderVideos:ze.innerStreamItemView.footerSpacing.marginTop;const p=this.state.showReactionsOverlay||this.props.isNewsBot?this._getStreamItemFooter([...this._footerSpacingStyle()],h):void 0;this.props.message.isBookmark()&&!this.props.isNewsBot&&t.push(ze.innerStreamItemView.desktopContainerShrinkStyle);let g=(0,o.jsxs)(d.Animated.View,{style:t,children:[r,(0,o.jsxs)(S.default.View,Object.assign({},c,u,{children:[this._getStreamItemHeader(),(0,o.jsxs)(d.View,{style:i,accessibilityLiveRegion:this.state.accessibilityLiveRegion,children:[e,p]})]})),a]});return this.props.viewRenderingOptions.smsDeliveryStatus&&(g=(0,o.jsx)(Ie.StreamItemTailAccessoryWrapper,{smsDeliveryStatus:this.props.viewRenderingOptions.smsDeliveryStatus,children:g})),g}_getSpacerWidth(){const e=this.props.viewRenderingOptions;if(e.removeMessageSpacer||e.messageContentCentered)return null;let t=0;return this._isDesktopSize()&&!this.state.isTablet?t=this._getDesktopSpacerWidth(t):this.state.isTablet?t=this._getTabletSpacerWidth():this.state.isUsingStackNavigationContext&&(t=40),this.props.postedByCurrentUser&&(t+=this.state.userIconWidth),(e.showOuterButtons||e.showEditIndicator||e.sendingStatus!==Pe.MessageRenderSendingStatus.None)&&(t-=(0,fe.getAccessoryWidth)(this.state.isMinDesktopWidth&&!this.state.isUsingStackNavigationContext)),this.props.message.isBookmark()&&(t=10),t}_getDesktopSpacerWidth(e){let t=0;return t=this.state.responsiveWidth>=G.ResponsiveWidth.Large?200:this.state.responsiveWidth>G.ResponsiveWidth.Small?120:this.state.responsiveWidth>G.ResponsiveWidth.MinDesktop?80:24,t}_getTabletSpacerWidth(){return this.state.isLandscape&&this.props.renderOrigin!==_e.MessageRenderOrigin.CallCanvas?120:40}_getSpacerStyle(){if(this.props.message.isBookmark())return;const e=this._getSpacerWidth();if(!e)return;const t=(this.props.postedByCurrentUser&&!this.props.message.isBookmark()?"left":"right")+e;return Ge[t]||(Ge[t]=this.props.postedByCurrentUser&&!this.props.message.isBookmark()?d.Styles.createViewStyle({paddingLeft:e},!1):d.Styles.createViewStyle({paddingRight:e},!1)),Ge[t]}_shouldRenderBackground(){return!!this.props.viewRenderingOptions.renderMessageBackground&&!this.state.disableStylingForTallBubbleAndroid}_contextMenuHandler(){return this._onHandleContextMenu}_getStreamItemContent(){const e=this.props.viewRenderingOptions;let t=0;e.messageContentExpandedToAvailableArea&&e.showMessageSenderIcon&&(t=this._isDesktopSize()?40:this.state.isSmallDevice?8:10);const s=!!this.state.disableStylingForTallBubbleAndroid&&this._useDarkTheme();let i=this._getSpacerWidth();return i&&(i+=20),E.debug((()=>["DIM_CALC - StreamItemContent dimensions: ",this.state.dimensions," messagetype: ",this.props.message.messagetype," cuid: ",this.props.message.cuid])),(0,o.jsx)(ve.StreamItemContent,{ref:this._onStreamItemContentRef,skypeMessage:this.props.message,viewRenderingOptions:e,rawSearchQuery:this.props.rawSearchQuery,isSelectedMessage:this.props.isSelectedMessage,decodedNode:this.props.decodedNode,useLightText:s,leftPaddingForUserIcon:this.state.userIconWidth+t,urlPreviewData:this.props.urlPreviewData,urlPreviewOnly:this.props.urlPreviewOnly,postedByCurrentUser:this.props.postedByCurrentUser,messageActions:this.props.messageActions,messagePadding:i||void 0,suggestedTextHighlights:this.props.suggestedTextHighlights,constrainedDimensions:this.state.dimensions,availableSpace:this.state.availableSpace,messageStreamFontSize:this.props.messageStreamFontSize,onContentHorizontalScroll:this._onContentHorizontalScroll,onPress:this._onPress,onLongPressContent:(this.state.isSelectMessagesModeActive,void 0),onContextMenu:this._onHandleContextMenu,onDisableScroll:this.props.onDisableScroll,onMountContent:this._onMountContent,onQuote:this.props.onQuote,onEdit:this.props.onEdit,renderOrigin:this.props.renderOrigin,emoticonsOnlyEmoticonSize:this.state.emoticonsOnlyEmoticonSize,singleEmoticonSize:this.state.singleEmoticonSize,allowHugeEmoticons:this.state.allowHugeEmoticons,disableTextSelection:a.default.isMobile()||this.state.isSelectMessagesModeActive,disableActions:this.state.isSelectMessagesModeActive,onSelectMessageCallback:this.state.isSelectMessagesModeActive?this._addOrRemoveMessageCallback:void 0,activeOpacityOverride:this.state.isSelectMessagesModeActive?.8:void 0,linkedMessages:this.props.linkedMessages,hasTranslation:this.props.hasTranslation,conversationTranslated:this.props.conversationTranslated,onToggleTranslation:this.props.onToggleTranslation,onToggleTranslateOptions:this.props.onToggleTranslateOptions,showTranslatedMessage:this.props.showTranslatedMessage,searchStore:this.props.searchStore},"streamitemcontent")}_cancelAnimations(){this._pendingAnimation&&this._pendingAnimation.stop()}_startAnimation(e){this._cancelAnimations(),this._pendingAnimation=d.Animated.parallel([d.Animated.sequence([d.Animated.timing(this._itemBgValue,{toValue:1,duration:c.Common.Duration.Tiny,useNativeDriver:!0}),d.Animated.timing(this._itemBgValue,{toValue:0,duration:c.Common.Duration.Tiny,useNativeDriver:!0})]),d.Animated.sequence([d.Animated.timing(this._itemScaleValue,{toValue:.95,duration:c.Common.Duration.Tiny,easing:c.Easing.SkypeExpoInOut5,useNativeDriver:!0}),d.Animated.timing(this._itemScaleValue,{toValue:1,duration:c.Common.Duration.Tiny,easing:c.Easing.SkypeExpoInOut5,useNativeDriver:!0})])]),this._pendingAnimation.start((()=>{this._pendingAnimation=void 0,this.isComponentMounted()&&e&&e()}))}_hasActionMenuCommands(){return!!this.props.messageActions&&!n.isEmpty(this.props.messageActions.actionMenuCommands)}_getStreamItemAccessory(e){const t=this.props.viewRenderingOptions,s=[t.showMessageSender||t.showMessageTimestamp&&t.sendingStatus!==Pe.MessageRenderSendingStatus.NoNetwork?ze.accessoryTopPadding:void 0];return this.state.showReactionsOverlay&&this.props.message.hasReactions()&&s.push(ze.innerStreamItemView.footerSpacing.paddingBottomWithReactions),this.props.isNewsBot&&s.push(ze.accessoryNoPadding),(0,o.jsx)(fe.StreamItemAccessory,{paddingStyle:s,message:this._getCurrentMessage,isMessageKnownByServer:this.props.message.isAnyVersionKnownByServer(),messagetype:this.props.message.messagetype,creator:this.props.message.creator,conversationId:this.props.message.conversationId,isConversationAccepted:this.state.isConversationAccepted,showEditIcon:t.showEditIndicator,sendingStatus:t.sendingStatus,smsDeliveryStatus:t.smsDeliveryStatus,showOuterButtons:t.showOuterButtons,commands:this.props.messageActions?this.props.messageActions.outerButtonCommands:[],onCommandSelected:this._onCommandSelectedInStreamItemAccessory,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,containerAnimationStyle:this._dimIconsOpacityStyle,disableActions:this.state.isSelectMessagesModeActive,isNewsBot:this.props.isNewsBot,accessoryOrigin:e||void 0})}_isDesktopSize(){return!this.state.isUsingStackNavigationContext&&!this._getContext().isPresentedInDesktopSubview}_getAccessibilityProps(){let e=this.state.accessibilityLabel,t=this.state.accessibilityTraits,s=d.Types.ImportantForAccessibility.Yes;if(this.state.isSelectMessagesModeActive){const t=!!this.state.isMessageSelected,s=O.getString("MessageStream.SelectionToggleOff"),i=O.getString("MessageStream.SelectionToggleOn"),o=e||(t?i:s);e=Q.getToggleSwitchItemLabel(o,t)}let i;return this.props.hint&&(e=`${e} ${this.props.hint.hintMessage}`),{accessibilityLabel:e,importantForAccessibility:s,accessibilityTraits:t,accessibilityActions:i,onAccessibilityAction:void 0}}_getStreamItemHeader(){const e=this.props.viewRenderingOptions;let t;e.messageContentExpandedToAvailableArea&&!this.props.isNewsBot&&(t=this._isDesktopSize()?ze.headerLeftPadding.desktop:this.state.isSmallDevice?ze.headerLeftPadding.smallDevice:ze.headerLeftPadding.regularDevice);const s=this.state.isSelectMessagesModeActive&&!this._isDesktopOrDesktopSubView()||!e.includeAccessibilityPropertiesOnMessageHeader?void 0:this._getAccessibilityProps();let i;if(this.props.message.isBookmark()){const e=ae.getBookmarkMetadata(this.props.message.properties);e&&(i=e.bookmarkSourceCreatorId)}const n=i||this.props.message.creator;let r,a,l;if(e.showMessageTimestamp&&(r=N.default.getDisplayTimeString(this.props.message.createdTime),this.state.isBookmarkThread)){const e=ae.getBookmarkMetadata(this.props.message.properties);e&&e.bookmarkSourceComposeTime&&(r=N.default.getDisplayDateStringDayMonthYearFormat(e.bookmarkSourceComposeTime)),l=e&&e.bookmarkSourceConversationId,l&&(a=e&&e.bookmarkSourceConversationName)}const d=e.showMessageSenderIcon&&!this.props.isNewsBot,c=e.showMessageSender&&!this.props.isNewsBot;return(0,o.jsx)(Te.StreamItemHeader,Object.assign({},s,{creatorMri:n,style:t,message:this.props.message,messageStreamFontSize:this.props.messageStreamFontSize,conversationId:this.props.message.conversationId,postedByCurrentUser:this.props.postedByCurrentUser,displayDateTime:r,showMessageTimestamp:!!e.showMessageTimestamp,showUserIcon:d,showSenderName:c,onRevealInConvPress:this.props.onRevealInConvPress,alignLeft:e.alignHeaderLeft,isSmallDevice:this.state.isSmallDevice,contentScrollEnabled:!!e.contentScrollEnabled,isContentScrolledOverHeader:!!e.contentScrollEnabled&&this.state.isContentScrolled,userIconBackgroundColor:e.viewColorProperties.userIconBackgroundColor,rawSearchQuery:this.props.rawSearchQuery,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,disableActions:this.state.isSelectMessagesModeActive,isCarousel:e.messageContentExpandedToAvailableArea,isBookmarkedMessage:this.props.message.isBookmarkSourceForCurrentUser(),bookmarkSourceConversationName:a,bookmarkSourceConversationId:l}))}_getStreamItemFooter(e,t){if(this.props.viewRenderingOptions.showReactionsOnMessage||this.props.isNewsBot){E.debug((()=>["DIM_CALC - StreamItemFooter dimensions: ",this.state.dimensions," messagetype: ",this.props.message.messagetype," cuid: ",this.props.message.cuid]));const s=this.props.decodedNode.hasHtmlContent()?void 0:this.state.dimensions&&this.state.dimensions.width;return(0,o.jsx)(Ce.StreamItemFooter,{hint:this.props.hint,style:e,overlayStyle:t,message:n.isEmpty(this.props.message.getReactions())?void 0:this.props.message,showReactionsOverlay:this.state.showReactionsOverlay,constrainedWidth:s,disableAction:this.state.isSelectMessagesModeActive,suppressSingleCounts:!0,showShadows:this.state.showReactionsOverlay,streamItemAccessory:this.props.isNewsBot?this._getStreamItemAccessory(Oe.StreamItemFooter):void 0},"streamitemfooter")}}}t.StreamItemView=Ke},759278:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(513983)),n=i.__importDefault(s(225511)),r=s(641400),a=i.__importStar(s(704704));class l extends o.default{_buildRows(e){return[{props:{key:"translateOriginalMessage",icon:r.SkypeIcon.Translate,onRowPress:e.onShowOriginalMessage,accessibilityLabel:a.getString("Translator.SettingsMessageShowOriginal"),titleText:a.getString("Translator.SettingsMessageShowOriginal"),subtitleText:e.sourceLangString,hideBorder:!1},builder:n.default.buildRow},{props:{key:"translateSettings",icon:r.SkypeIcon.Settings,onRowPress:e.onChangeLang,accessibilityLabel:a.getString("Translator.SettingsShowSettings"),titleText:a.getString("Translator.SettingsShowSettings"),subtitleText:e.langString,hideBorder:!0},builder:n.default.buildRow}]}static getMenuHeight(){return 2*n.default.getMenuItemHeight()}}t.default=l},647780:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(379707),r=i.__importStar(s(331654)),a=s(815063),l=s(167606),d=s(380157),c=s(537180),u=i.__importStar(s(516778)),h=i.__importDefault(s(375308)),p=i.__importDefault(s(207833)),g=s(344175),m=s(197277),S=i.__importDefault(s(369347)),_=i.__importStar(s(709358)),f=i.__importDefault(s(535174)),y=s(742403),v=i.__importDefault(s(679405)),C=(s(187140),i.__importDefault(s(186325))),T=i.__importDefault(s(844445)),M=i.__importDefault(s(660401)),b=s(262725),I=i.__importDefault(s(336009)),w=i.__importStar(s(701034)),P=i.__importDefault(s(827361)),k=i.__importDefault(s(497910)),A=i.__importDefault(s(206483)),x=i.__importDefault(s(331824)),D=i.__importDefault(s(823548)),R=i.__importDefault(s(859545)),L=i.__importDefault(s(363091)),B=i.__importDefault(s(139221)),F=i.__importStar(s(361096)),N=s(134894),E=s(901156),O=s(187086),U=i.__importStar(s(786531)),V=s(786531),H=s(196761),j=i.__importStar(s(352549)),z=i.__importStar(s(206525)),W=i.__importStar(s(340482)),G=s(843890),K=i.__importDefault(s(377556)),q=i.__importDefault(s(20758)),Q=i.__importDefault(s(150343)),X=i.__importDefault(s(48076)),$=i.__importDefault(s(740794)),J=s(536745),Y=i.__importDefault(s(92477)),Z=i.__importStar(s(353021)),ee=i.__importDefault(s(601976)),te=i.__importDefault(s(214295)),se=i.__importDefault(s(341994)),ie=i.__importDefault(s(942724)),oe=i.__importDefault(s(450312)),ne=i.__importDefault(s(327400)),re=i.__importDefault(s(251733)),ae=i.__importDefault(s(163374)),le=i.__importDefault(s(960282)),de=i.__importDefault(s(506082)),ce=i.__importDefault(s(659938)),ue=i.__importStar(s(85385)),he=i.__importStar(s(704704)),pe=i.__importStar(s(437782)),ge=i.__importDefault(s(655192)),me=s(922069),Se=s(154235),_e=s(815146),fe=s(16549),ye=s(641400),ve=s(331079),Ce=s(935086),Te=i.__importDefault(s(179075)),Me=i.__importDefault(s(384669)),be=(i.__importDefault(s(631681)),i.__importDefault(s(247286))),Ie=(s(315742),s(329755)),we=s(169679),Pe=i.__importDefault(s(394503)),ke=s(51160),Ae=i.__importDefault(s(211124)),xe=i.__importStar(s(548056)),De=i.__importDefault(s(519093)),Re=i.__importDefault(s(830320)),Le=i.__importDefault(s(656681)),Be=i.__importDefault(s(627466)),Fe=i.__importDefault(s(353010)),Ne=i.__importDefault(s(982323)),Ee=s(46209),Oe=i.__importStar(s(669327)),Ue=i.__importDefault(s(555436)),Ve=s(269614),He=s(26703),je=i.__importDefault(s(760989)),ze=i.__importStar(s(626065)),We=i.__importStar(s(7040)),Ge=s(848523),Ke=i.__importStar(s(971988)),qe=i.__importStar(s(44717)),Qe=i.__importDefault(s(404547)),Xe=i.__importStar(s(459287)),$e=i.__importDefault(s(119999)),Je=s(500983),Ye=s(379878),Ze=i.__importDefault(s(221837)),et=i.__importDefault(s(863132)),tt=i.__importDefault(s(892034)),st=i.__importDefault(s(615364)),it=i.__importDefault(s(776546)),ot=i.__importDefault(s(732028)),nt=i.__importDefault(s(58606)),rt=i.__importDefault(s(23551)),at=i.__importStar(s(242561)),lt=i.__importStar(s(954225)),dt=i.__importDefault(s(813994)),ct=i.__importDefault(s(916260)),ut=i.__importDefault(s(731036)),ht=s(703689),pt=i.__importDefault(s(545912)),gt=i.__importStar(s(78706)),mt=s(388401),St=10,_t=[],ft=(0,He.lazyProperties)({contentOuterContainer:()=>u.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),messageComposerOuterContainerVertical:()=>u.Styles.createViewStyle({flexDirection:"row",justifyContent:"center"}),messageComposerOuterContainerHorizontal:()=>u.Styles.createViewStyle({flex:-1,flexDirection:"row",justifyContent:"center"}),messageComposerContainerDesktop:()=>u.Styles.createViewStyle({marginTop:8,width:lt.maxStreamContentWidth,alignSelf:"center"}),messageComposerContainerWithSuggestionsDesktop:()=>u.Styles.createViewStyle({marginTop:3}),messageComposerInner:()=>u.Styles.createViewStyle({flex:-1,flexDirection:"row",maxWidth:lt.maxStreamContentWidth,width:lt.maxStreamContentWidth}),messageComposerHorizontalSpacer:()=>u.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"flex-end",alignItems:"center"}),messageComposerHorizontalSpacerDesktop:()=>u.Styles.createViewStyle({height:60}),messageComposerHorizontalSpacerWithSuggestionsDesktop:()=>u.Styles.createViewStyle({height:55}),messageComposerHorizontalTinySpacer:()=>u.Styles.createViewStyle({minWidth:5}),messageComposerHorizontalSmallSpacer:()=>u.Styles.createViewStyle({minWidth:St}),messageComposerHorizontalBigSpacer:()=>u.Styles.createViewStyle({minWidth:80}),defaultRightSpacerStyle:()=>u.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",alignItems:"center",paddingRight:13,minWidth:70}),defaultRightSpacerStyleForComposerWithPopup:()=>u.Styles.createViewStyle({minWidth:St}),toggleLeftPanelButtonContainer:()=>u.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",paddingLeft:15,minWidth:80}),toggleLeftPanelButtonContainerSmallView:()=>u.Styles.createViewStyle({minWidth:60}),messagingUnavailableContainer:()=>u.Styles.createViewStyle({flex:-1,flexDirection:"row",width:lt.maxStreamContentWidth,maxWidth:lt.maxStreamContentWidth,paddingRight:10,height:60,alignItems:"center"}),messagingUnavailablePlaceholder:()=>u.Styles.createTextStyle({flex:-1,paddingHorizontal:16}),dividerShadow:()=>u.Styles.createViewStyle({left:0,right:0,height:1,marginTop:-1}),sidebarButton:()=>u.Styles.createViewStyle({height:ye.IconSize.default,width:ye.IconSize.default}),tabletMessageComposer:()=>u.Styles.createViewStyle({minHeight:x.default.tabBarHeight(Se.TabBarHeight.Tablet),paddingBottom:1,alignItems:"flex-end"}),messageTextCompletion:()=>u.Styles.createViewStyle({marginBottom:-1}),hideComposer:()=>u.Styles.createViewStyle({height:0}),paddingMobileBrowser:()=>u.Styles.createViewStyle({paddingBottom:20}),notificationsButtonWrapper:()=>u.Styles.createViewStyle({alignItems:"center",justifyContent:"center",paddingTop:4,paddingBottom:4,overflow:"hidden"})});class yt extends k.default{constructor(){super(...arguments),this._shouldSendGreetingEvent=!1,this._mountedContentNodes={},this._botMessageTimerLimit=Date.now(),this._shouldFocusMessageComposer=!1,this._scrolledToTheBottom=!0,this._dividerOpacityValue=new u.Animated.Value(0),this._dividerOpacityStyle=u.Styles.createAnimatedViewStyle({opacity:this._dividerOpacityValue}),this._messageComposerOpacityValue=new u.Animated.Value(1),this._messageComposerOpacityStyle=u.Styles.createAnimatedViewStyle({opacity:this._messageComposerOpacityValue}),this._leftMessageStreamSpacerWidth=0,this._rightMessageStreamSpacerWidth=0,this._spacerWidthUpdated=!1,this._trackAddContactOnce=!1,this._trackSendMessageOnce=!1,this._canSendSearchFirstSuccessAction=!1,this._lastDeletedTimestamp=0,this._focusJoinCallButtonOnce=!1,this._showDirectShareConfirmationDialog=e=>{const t=ee.default.getDisplayName(this.props.conversationId)||"",s=he.getString("DirectShare.ConfirmationDialogTitle",{displayName:t}),i=[{text:he.getString("Global.CancelLabel"),isCancel:!0},{text:he.getString("Global.ConfirmLabel"),isSubmit:!0,onPress:()=>$e.default.sendSharedFiles(e,this.props.conversationId)}];A.default.showWithOptions({title:"",dialogAccessibilityTitle:s,message:s,buttons:i,rootViewId:this._getRootViewId()})},this._storeConversationStyles=()=>{it.default.storeSpacerWidths({left:this._leftMessageStreamSpacerWidth,right:this._rightMessageStreamSpacerWidth})},this._onMessageStreamScreenReaderFocusUpdated=e=>{this._shouldFocusMessageComposer=!e&&!u.Modal.isDisplayed()&&!this._focusJoinCallButtonOnce,this._shouldFocusMessageComposer&&!this.state.isAnimationPending&&this._setComposerAccessibilityFocus(),this._focusJoinCallButtonOnce=!1},this._onShowOverflow=(e,t,s)=>{this._shouldFocusMessageComposer=!1,this.props.onShowOverflow&&this.props.onShowOverflow(e,t,s)},this._onConversationsStoreUpdate=()=>{if(this.isComponentMounted()){this._postCallerIdMessage();const e=(0,st.default)().getConversation(this.props.conversationId);this._considerNavigationAfterDeleteConversation(e),this._considerRefreshingContactsStore(e),this._considerInviteMessageCountReached(e)}},this._onSuggestionsToggled=e=>{this.setState({suggestionsShown:e})},this._toggleDesktopFindPanel=()=>{this.props.onToggleFindPanel&&this.props.onToggleFindPanel(this._messageComposer?this._messageComposer.getOverflowConfig():void 0)},this._onComposerContainerRef=e=>{this._composerContainerRef=e||void 0,this._composerContainerRef&&this._composerContainerRef.setFocusLimited(!!this.props.isSelectMessagesModeActive)},this._onMessageComposerRef=e=>{this._messageComposer=e||void 0},this._onTextCompletionRef=e=>{this._textCompletion=e||void 0},this._divider=()=>this.props.showBottomDivider?(0,o.jsx)(u.Animated.View,{style:[ft.dividerShadow,this._themeStyles.headerShadowColorStyle,this._dividerOpacityStyle]}):(0,o.jsx)(C.default,{marginLeft:0,marginRight:0,useLightTheme:!0}),this._onMessageStreamRef=e=>{this._messageStream=e},this._onMessageStreamLayout=e=>{const t=e.height,s=e.width,i=this.state.isBookmark?760:560,o=e.width<i;this.state.contentAreaHeight===t&&this.state.contentAreaWidth===s&&this.state.isRenderedIn4ColumnWidth===o||this.setState({contentAreaHeight:t,contentAreaWidth:s,isRenderedIn4ColumnWidth:o}),Fe.default.isPiPEnabled()&&Pe.default.updateDimensions(e)},this._onInputTextChanged=(e,t)=>{this._textCompletion&&this._textCompletion.setInputText(e,t)},this._onNativeComposerMessageEmptyStateChanged=()=>{this._sendSearchFirstSuccessfulAction()},this._onKeyPress=e=>(this._sendSearchFirstSuccessfulAction(),!!this._textCompletion&&this._textCompletion.handleKeyDown(e)),this._onRecording=()=>{if(this.props.hasConnectedCalls)A.default.showOKAlert(he.getString("MessageStream.AudioMessageNotAllowedTitle"),he.getString("MessageStream.AudioMessageNotAllowedMessage"),this._getRootViewId());else switch(Z.default.getRecordingStateNoSubscription()){case Z.RecordingState.StartingMic:case Z.RecordingState.Recording:A.default.showOKAlert(he.getString("MessageStream.MultipleAudioMessagesNotAllowedTitle"),he.getString("MessageStream.MultipleAudioMessagesNotAllowedMessage"),this._getRootViewId());break;default:this._toggleRecording(!0)}},this._onDoneRecording=()=>{this._toggleRecording(!1)},this._insertSearchResultsToComposer=(e,t,s)=>{this._messageComposer&&this._messageComposer.insertSearchResult(e,t,s)},this._onReplaceText=(e,t,s,i)=>{const o=i instanceof ze.AtMentionEntity;o&&(t+=" "),this._messageComposer&&(this._messageComposer.replaceText(e,t,s,i),o&&u.Accessibility.announceForAccessibility(he.getString("MessageComposer.MentionSuggestionConfirmed",{name:t})))},this._onTextReplacementCandidatesShown=e=>{this._messageComposer&&0===e&&this._messageComposer.abortTextAutoCompletion()},this._onPress=(e,t)=>{e.stopPropagation(),e.preventDefault();const s=je.default.newCauseId();ue.log(_e.LogTraceArea.Navigation,"MessagePanel: onItemPress,  causeId: "+s),this._openGallery(t,s)},this._onInitialRenderComplete=()=>{this._maybeOpenGallery(),this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete()},this._maybeOpenGallery=()=>{if(this._messageStream){const e=this._messageStream.getSkypeMessages(),{focusedMessageCuid:t,scrollToTimestamp:s,conversationId:i}=this.props;let o=e.find((({cuid:e,createdTime:i})=>e===t||i===s));if(!o&&t&&(o=Le.default.getAlbumMessageByConversation(i,t)),o){const e=je.default.newCauseId();ue.log(_e.LogTraceArea.Navigation,"MessagePanel: _maybeOpenGallery, causeId: "+e),this._openGallery(o,e)}}},this._openGallery=(e,t)=>{if(De.default.isMediaItem(e)||e.isAlbum()){this.state.useMobileUI||$.default.closeGalleryPanel(t,this._getContext()),ue.track(new U.MessageContentClicked(e,!1)),z.pictureViewerWillOpen();const s=new j.default(j.ScenarioName.ViewMediaIntent);s.start();let i=e;const o=i.getAlbumId();if(i.isAlbum()){const t=Le.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId());i=t&&t[0]}if(o){const t=Le.default.getSelectedMediaForAlbum(o);if(e.hasBingImageTrackingMetadata()){const s=(0,Ie.decodeAdditionalDataToURL)(t,e.getBingImageTrackingMetadata());s&&(0,we.trackImageOpen)(s)}t&&(i=t,Le.default.removeSelectedMediaForAlbum(o))}i&&Ae.default.showWithMessageConfig({initialMessage:i,animateOpenClose:!0,reverseOrder:!1,rootViewId:this._getRootViewId(),viewMediaIntentScenario:s,getContentNode:e=>this._mountedContentNodes[e],origin:_e.NavigationMediaViewerOrigin.MessageStream}),this._dismissKeyboard()}},this._onMountContent=(e,t,s,i)=>{s?this._mountedContentNodes[i.cuid]={type:e,component:t}:delete this._mountedContentNodes[i.cuid]},this._onKeyboardPaste=e=>{const t=nt.default.get(e.nativeEvent);this._onQuoteMessage(t,Ce.QuotesTriggerType.KeyboardCopyPaste),t.length>0&&ue.track(new U.KeyboardMessagesTelemetry(this.props.conversationId,{messagesCount:t.length,actionType:V.KeyboardActionType.KeyboardPaste}))},this._onQuoteMessage=(e,t)=>{this._sendSearchFirstSuccessfulAction(),this.isComponentMounted()&&(e.forEach((e=>{ue.track(new U.QuotesEventTelemetry(this.props.conversationId,e,e.createdTime,U.MessageActionOrigin.StreamItemActionMenu,U.MessageActionType.Quote,t,e.messagetype))})),this.setState({quotedMessages:e,showTranslatedMessage:e.every((e=>!L.default.isMyMri(e.creator))),editedMessage:void 0,quotesTriggerType:t}))},this._onQuoteSelectionContextMenu=e=>{this._onQuoteMessage(e,Ce.QuotesTriggerType.ActionMenu)},this._onSuggestedCardAction=(e,t)=>{this.isComponentMounted()&&(e.type=at.SwiftMessageTypes.carousel,this.state.suggestedCards&&this.state.suggestedCards===e||this.isComponentMounted()&&this.setState({suggestedCards:e,suggestedAction:t}))},this._onSuggestionClicked=()=>{this._messageComposer&&(u.Accessibility.announceForAccessibility(he.getString("MessageComposer.MessageSentLabel")),this._messageComposer.setTextInputAccessibilityFocus())},this._onScrolledToTheBottom=e=>{this.props.showBottomDivider&&this._scrolledToTheBottom!==e&&(this._scrolledToTheBottom=e,this._showOrHideDivider(this.props,this.state))},this._onScrolledToTheTop=()=>{B.default.getPlatformType()===_e.PlatformType.Android&&this._dismissKeyboard()},this._onClearQuote=(e=!1)=>{const{quotesTriggerType:t}=this.state;e&&this.state.quotedMessages&&void 0!==t&&this.state.quotedMessages.map((e=>ue.track(new U.QuotesEventTelemetry(this.props.conversationId,e,e.createdTime,U.MessageActionOrigin.MessageComposer,U.MessageActionType.ClearQuote,t,W.getMessageTypeName(e))))),this.isComponentMounted()&&this.setState({quotedMessages:void 0})},this._onClearEdit=()=>{this.isComponentMounted()&&this.setState({editedMessage:void 0})},this._onMessageEdit=e=>{this._sendSearchFirstSuccessfulAction(),this.isComponentMounted()&&this.setState({editedMessage:e,quotedMessages:void 0})},this._onEditLastMessage=()=>{let e;if(!qe.isAgent(this.props.conversationId)&&!qe.isS4BBridgeMri(this.props.conversationId)&&!this.state.e2eeHandshake){const t=this._messageStream&&this._messageStream.getSkypeMessages();e=(0,p.default)(t,(e=>L.default.isMyMri(e.creator)&&Ke.getMessageTypeGroup(e)===Ke.MessageTypeGroups.Text))}e&&e.isMessageLie()&&(e=void 0),this.state.editedMessage!==e&&this.isComponentMounted()&&this.setState({editedMessage:e,quotedMessages:void 0})},this._postEphemeralMessage=e=>{this.isComponentMounted()&&this._messageStream&&this._messageStream.feedEphemeralMessage(e)},this._onCardsSent=()=>{this.isComponentMounted()&&this.setState({suggestedCards:void 0})},this._onGreet=()=>{this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(N.GreetActionType.Greet),et.default.postMessageFromInput(this.props.conversationId,_e.PostSource.StartChattingCard,We.convertRawTextToInputEntities("(wave)"),Ke.MessageTypes.RichText,{name:j.ScenarioName.SayHi},void 0,this._getRootViewType()),this._sendAddContactTelemetry(N.AddContactOrigin.ChatWave),this._sendFirstMessageTelemetry()},this._onMessageSent=(e,t)=>{if(this.state.enableOldFriendBack&&Me.default.setShouldShowOldFriendBackQuickReply(this.props.conversationId,!1),this.props.isNewConversation&&qe.isAgent(this.props.conversationId)&&this._botMessageTimerLimit&&Date.now()-this._botMessageTimerLimit<=6e4){const e=Te.default.getAgentDescriptionForMri(this.props.conversationId);this._botMessageTimerLimit=void 0,ue.track(new F.BotMessageInteraction(e.agentId,e.displayName))}if(this._sendFirstMessageTelemetry(),R.default.identity().canUseSlashCommands){const t=this._processSlashCommand(e);if(void 0!==t)return t}if(this.state.sendLegacyInvite&&!this.state.isConversationAccepted&&!this.state.isIncomingContactInvitePending){const t=We.getRawText(e);Ue.default.addContact(this.props.conversationId,N.AddContactOrigin.NewConversation,t)}if(this.state.editedMessage)return this.state.enableMessageSendSuccessProcessing&&this._processMessageSendingInSenderUI(this.state.editedMessage.getOriginalClientMessageId(),!0),et.default.editMessageFromInput(this.state.editedMessage,_e.PostSource.MessagePanel,e),this.isComponentMounted()&&this.setState({editedMessage:void 0}),!0;const s=1===e.length&&e[0]instanceof ze.SmsEntity?Ke.MessageTypes.Sms:Ke.MessageTypes.RichText;this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(N.GreetActionType.Message);const i={name:j.ScenarioName.SendTextMessage,secondaryScenariosToSpawnAtCreation:[{name:j.ScenarioName.SendTextMessageUI},{name:j.ScenarioName.SendTextMessageTimeToAppearInChat,timeout:2500}]},o={messageComposerAction:t,contentType:e.some((e=>e instanceof ze.LinkEntity))?U.MessageComposerSentContentType.Link:(0,O.getTextMessageTypeFromContent)(this._getPlainTextFromInputEntities(e))};let n;const r=e[0];if(r instanceof ze.QuoteEntity){const e=r;e.quotedMessage&&e.quotedMessage.properties&&Ke.isHtmlMessageType(e.quotedMessage.messagetype)&&(n=Ke.getForwardedTeamsProperties(e.quotedMessage.properties))}const a=Xe.createMessageInfo(this.props.conversationId,_e.PostSource.MessagePanel,e,s,n);this.state.enableMessageSendSuccessProcessing&&this._processMessageSendingInSenderUI(a.messageForPosting.clientmessageid),et.default.postMessage(a,void 0,i,this._getRootViewType(),o);const l=(0,st.default)().getConversation(this.props.conversationId);return this._sendAddContactTelemetry(N.AddContactOrigin.NewConversation),this._reportUnacknowledgedMessageReadLie(l,a.messageForPosting),this.props.onMessageSent&&this.props.onMessageSent(),!0},this._reportUnacknowledgedMessageReadLie=(e,t)=>{var s;const i=null===(s=e.memberConsumptionHorizonsSorted)||void 0===s?void 0:s.find((e=>e.id===L.default.getSkypeMri()));if(i&&!this.state.hasReadReceiptsEnabled&&this.state.allowedMessageReadLieMs){new Date(t.composetime).getTime()-i.consumptionHorizonUpdateTime<this.state.allowedMessageReadLieMs&&this._trackMessageReadLieDebounced(t)}},this._trackMessageReadLieDebounced=(0,h.default)((e=>{ue.track(new U.MessageReadLie(e,this.props.conversationId))}),6e4,{leading:!0}),this._setShowDragAndDropOverlayStateFalse=()=>{this.isComponentMounted()&&this.setState({showDragAndDropOverlay:!1})},this._setShowDragAndDropOverlayStateTrue=()=>{this.isComponentMounted()&&this.setState({showDragAndDropOverlay:!0})},this._onContactInviteAccepted=()=>{this.isComponentMounted()&&this.setState({isConversationAccepted:!0,isContactInviteJustAccepted:!0,isIncomingContactInvitePending:!1,isSkypeInviteAccepted:!0}),this.state.isOneOnOneConversation&&(N.ContactsTelemetryHelper.addContactSuccess(this.props.conversationId,N.AddContactOrigin.AcceptButton),Y.default.addAppRatingMetric(1,me.AppRatingMetric.NEW_CONTACT))},this._onJumpToEndPress=()=>{this._setComposerAccessibilityFocus()},this._resetOngoingDownloads=()=>{Re.default.hasDownloadsOnQueue(this.props.conversationId)&&Re.default.cancelDownloadsByTag(this.props.conversationId)},this._getInputEntities=()=>this._messageComposer?this._messageComposer.getInputEntities().toEs6Promise():Promise.resolve([]),this._onDragDropText=e=>{var t;null===(t=this._messageComposer)||void 0===t||t.onDragDropText(e)}}componentDidMount(){super.componentDidMount(),this._appStateSubscription=ce.default.subscribeForChanges("MessagePanel",(e=>{e===u.Types.AppActivationState.Background&&this.state.isRecording&&this._onDoneRecording()})),this._newConversationSetup(this.props,this.state)}_newConversationSetup(e,t){const s=(0,st.default)(),i=s.getConversation(e.conversationId);i&&(this._lastDeletedTimestamp=i.getDeletedTimestamp()),this._storeConversationStyles(),this._showOrHideDivider(e,t),e.isNewConversation&&!t.isIncomingContactInvitePending&&(this._shouldSendGreetingEvent=!0,this._trackSendMessageOnce=!1),this._conversationUpdatedSubscription=s.subscribe(this._onConversationsStoreUpdate,e.conversationId),this._considerInviteMessageCountReached(i),this._composerContainerRef&&!t.useMobileUI&&this._composerContainerRef.setFocusLimited(!!e.isSelectMessagesModeActive);const o=this._showContactInviteHeader(e,t)&&this._showWave(t);ue.log(_e.LogTraceArea.MessageStream,"Show wave:"+o+" isNewContactConversation: "+t.isNewContactConversation+" isContactInviteJustAccepted:"+t.isContactInviteJustAccepted+" e2eeHandshake:"+t.e2eeHandshake+" isAnyMessageInTheStream:"+t.isAnyMessageInTheStream+" isPSTNOrSMSConversation: "+t.isPSTNOrSMSConversation),this._focusJoinCallButtonOnce=!!e.focusJoinCallButton}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._directShareFilesToken&&(this._directShareFilesToken.unsubscribe(),this._directShareFilesToken=void 0),this._oldConversationCleanup(),tt.default.commit(this.props.conversationId),(0,m.getRightPaneStore)().setIsArticleOpenedInApp(this.props.conversationId,!1)}_oldConversationCleanup(){this.props.isNewConversation&&this._shouldSendGreetingEvent&&this._sendGreetingEvent(N.GreetActionType.None),this._conversationUpdatedSubscription&&((0,st.default)().unsubscribe(this._conversationUpdatedSubscription),this._conversationUpdatedSubscription=void 0),Ne.default.deactivatePicker(),this._toggleRecording(!1),this.state.enableAutoDownloadFiles&&this._resetOngoingDownloads()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.conversationId!==this.props.conversationId&&(this.setState({isContactInviteJustAccepted:!1}),(0,m.getRightPaneStore)().setIsArticleOpenedInApp(this.props.conversationId,!1))}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),t.isInCall&&!t.enableAutoDownloadFilesInCall&&this._resetOngoingDownloads(),this.props.enableConversationSwitchWithoutRemount&&this.props.conversationId!==e.conversationId&&(this._oldConversationCleanup(),this._newConversationSetup(e,t))}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),t.isRecording&&!this.state.isRecording&&this._messageComposer&&this._messageComposer.focusSendButton(),t.isAnimationPending&&!this.state.isAnimationPending&&this._shouldFocusMessageComposer&&this._setComposerAccessibilityFocus(),t.e2eeHandshakeState!==this.state.e2eeHandshakeState&&this._showOrHideDivider(this.props,this.state),this._spacerWidthUpdated&&this._storeConversationStyles(),this.props.conversationId!==e.conversationId&&tt.default.commit(e.conversationId),t.isSearchingPes&&!this.state.isSearchingPes&&t.deviceOrientation===r.DeviceOrientation.Portrait&&this.state.deviceOrientation===r.DeviceOrientation.Landscape){const e=je.default.newCauseId();ue.log(_e.LogTraceArea.Navigation,"MessagePanel: componentDidUpdate,  causeId: "+e),t.pesTabType!==xe.TabType.Gif&&$.default.navigateToPesSearch({searchType:t.pesTabType||xe.TabType.Emoticon,conversationId:this.props.conversationId,onMessageSent:this._onMessageSent,clearEditInChatsComposer:this._onClearEdit,causeId:e},this._getContext())}this.props.isSelectMessagesModeActive!==e.isSelectMessagesModeActive&&(this._composerContainerRef&&!this.state.useMobileUI&&this._composerContainerRef.setFocusLimited(!!this.props.isSelectMessagesModeActive),!this.props.isSelectMessagesModeActive&&this._messageComposer&&this._setComposerAccessibilityFocus())}onNavigateAway(){this.blur(),Be.default.stopActivePlayer()}_buildState(e,t){var s,i;const o=(0,st.default)().getConversation(e.conversationId),n=this._getRootViewId(),{enableTodayBotRightPane:a}=Q.default.getS4LUiFeatures(),{enableInviteFree:l,sendLegacyInvite:d,sendLegacyInviteSfB:c,maxContactInviteMessageCount:u,enableGroupInviteFree:h,overrideWithAddressBookName:p}=Q.default.getS4LContactsFeatures(),{readReceiptsAllowedLieTime:g,enableAutoDownloadFiles:m,enableAutoDownloadFilesInCall:S,setOverflowMenuButtonToPlainColor:v,enableHandlingHTMLonPaste:C,audioMessageMaxRecordingTimeMs:T,sendingLieMaxDuration:M,enableMessageSendSuccessProcessing:b}=Q.default.getS4LMessagingFeatures(),{conciergeBotSettings:I}=Q.default.getEngagementFeatures(),{sendCredit:w}=Q.default.getS4LCommerceFeatures(),{enableDesktop:P}=Q.default.getS4LIntegrationsFeatures(),k=!!o&&Ue.default.isConversationAccepted(o.id),A=!!o&&D.default.isSendImCapable(o),x=I.enableVisibility&&qe.isConciergeBotMri(e.conversationId),L=qe.isReadOnlyConversation(e.conversationId)||x,B=X.default.isTabletUI(),F=qe.isPhoneMri(e.conversationId),N=ie.default.isUsingStackNavigationContext();let E=!!o&&void 0!==o.lastMessage;(null==o?void 0:o.isV2OneToOneThread())&&(E=!Ke.isAddMemberMessageType(null!==(i=null===(s=o.lastMessage)||void 0===s?void 0:s.messagetype)&&void 0!==i?i:""));const O=w.enabled&&!!o&&_.isSupportedConversation(o,k),U=!ie.default.isUsingStackNavigationContext()&&oe.default.isCallChatShowing(),V=f.default.messageToShowInChat(e.conversationId),H=Q.default.getEngagementFeatures().oldFriendBack.enable,j=(0,y.isContentChannel)(o),z={isUsingStackNavigationContext:N,readOnlyConversation:L,useTabletUI:B,useMobileUI:N||B,responsiveWidth:le.default.getResponsiveWidth(n),deviceOrientation:le.default.getDeviceOrientation(n),isSendImCapable:A,enableInviteFree:l,sendLegacyInvite:d||c&&qe.isS4BBridgeMri(e.conversationId),isAnyMessageInTheStream:E,showSendCredit:O,showAddinLauncher:A&&!L&&P&&!N&&!qe.isEncryptedThread(e.conversationId)&&!e.selectedNumberForSMS&&!F&&R.default.addins().canUseAddins&&!e.isSelectMessagesModeActive,maximumContactInviteMessageCount:u,isAnimationPending:ne.default.isAnimationPending(),keyboardHeight:te.default.getUpdateInfo().height,isPSTNOrSMSConversation:F,e2eeHandshakeState:o&&o.isEncryptedThread()?ot.default.getHandshakeState(e.conversationId):void 0,e2eeHandshake:o&&o.isEncryptedThread()?o.getEncryptionHandshake():void 0,isBlockedPSTNMri:qe.isBlockedPSTNMri(e.conversationId),isBookmark:qe.isBookmarkConversation(e.conversationId),isSearchingPes:Ne.default.isInlineSearchActive(),pesTabType:Ne.default.getActiveTabType(),hasReadReceiptsEnabled:se.default.getReadReceiptsEnabled(),allowedMessageReadLieMs:1e3*g,enableAutoDownloadFiles:m,enableAutoDownloadFilesInCall:S,isInCall:de.default.isInCall(),setOverflowMenuButtonToPlainColor:v,canUseSlashCommands:R.default.identity().canUseSlashCommands,showCallerIDMessageType:V,enableHandlingHTMLonPaste:C,hideInviteHeader:le.default.getDeviceOrientation(n)===r.DeviceOrientation.Landscape&&X.default.isTablet()&&te.default.isKeyboardSeen(),postSource:U?_e.PostSource.CallStage:_e.PostSource.MessagePanel,isChild:be.default.isChild(),maxRecordingTimeMs:T,isConciergeBot:x,isNewsChannel:j,isNewsBot:(0,y.isTodayBot)(e.conversationId),shouldEnableRightPaneForNewsBot:a,isOneOnOneConversation:null==o?void 0:o.isOneOnOne(),isMuted:null==o?void 0:o.isMuted(),enableOldFriendBack:H,sendingLieMaxDuration:M,enableMessageSendSuccessProcessing:b};t&&(z.contentAreaHeight=0,z.isContactInviteJustAccepted=!1);const W=this.props;if((t||e.conversationId!==W.conversationId||W.scrollToTimestamp!==e.scrollToTimestamp||W.focusedMessageCuid!==e.focusedMessageCuid||W.forceRefreshFocus!==e.forceRefreshFocus)&&(z.isMaximumContactInviteMessageCountReached=!1,z.isRecording=!1,z.isSkypeInviteAccepted=!1,z.showDragAndDropOverlay=!1,t||e.conversationId===W.conversationId||(z.editedMessage=void 0,z.quotedMessages=void 0)),(t||e.conversationId!==W.conversationId||e.isFromSearch!==W.isFromSearch)&&(this._canSendSearchFirstSuccessAction=!!e.isFromSearch),z.isConversationAccepted=!0,o&&(!o.isOneOnOne()&&h||o.isOneOnOne()&&!qe.isAgent(e.conversationId))){z.isConversationAccepted=k,z.isIncomingContactInvitePending=!o.isEncryptedThread()&&(Ue.default.isIncomingContactInvitePending(o.id)||!!e.inviteToken&&(t||!this.state.isSkypeInviteAccepted)&&e.otherPartyMri&&!Ue.default.isContact(e.otherPartyMri)),t||(!this.state.isConversationAccepted&&z.isConversationAccepted&&(z.isContactInviteJustAccepted=!0),z.isConversationAccepted||(z.isContactInviteJustAccepted=!1)),ue.log(_e.LogTraceArea.MessageStream,`Conversation: [id: ${pe.mriOrId(o.id)}, isConversationAccepted: ${z.isConversationAccepted}, isIncomingContactInvitePending: ${z.isIncomingContactInvitePending}, isContactInviteJustAccepted: ${z.isContactInviteJustAccepted}]`);const s=o.isOneOnOne()?o.getOtherPartyMri():void 0;if(p&&s)z.recipientDisplayName=ee.default.getShortDisplayName(s);else{const t=ee.default.getDisplayableProfile(e.conversationId);z.recipientDisplayName=t.getShortName()}z.isConversationAccepted&&(z.isMaximumContactInviteMessageCountReached=!1)}z.hideComposer=(0,Je.shouldHideComposer)(o,e.inviteToken)||this._hasPendingIncomingContactRequest(z)||!!e.isMessageSearchPanelVisible&&(z.useMobileUI||!!z.useTabletUI),o&&z.isOneOnOneConversation&&!o.isEncryptedThread()&&e.otherPartyMri?z.isContact=Ue.default.isManuallyAddedContact(e.otherPartyMri):z.isContact=!1;const G=tt.default.getSavedMessageInput(e.conversationId),K=G?G.messages:null;if(z.pastedTextType=null==G?void 0:G.pastedTextType,K&&K.length>0&&G)switch(G.type){case Ge.SavedMessageType.Edited:z.editedMessage=K[0];break;case Ge.SavedMessageType.Quoted:z.quotedMessages=K}z.e2eeHandshakeState?(t||e.conversationId!==W.conversationId)&&(z.showInviteHeaderForEncryptedThread=!!o&&!o.getThreadProperty(qe.ThreadProps.SecureHandshakeOnceEstablished)):z.showInviteHeaderForEncryptedThread=!1,z.isNewContactConversation=z.isSendImCapable&&!z.isIncomingContactInvitePending&&!z.readOnlyConversation&&!z.isConversationAccepted;const q=z.isConversationAccepted&&!z.e2eeHandshake&&!e.selectedNumberForSMS;return z.showPesCategorySwitcher=z.isSearchingPes?q:q&&X.default.isTablet()&&Ne.default.isPickerActive(),z.initialInputEntities=G?G.inputEntities:_t,z.initialInputEntitiesDataVersion=G?G.inputEntitiesDataVersion:0,z}requestFocus(){this._messageComposer&&this._messageComposer.requestFocus()}blur(){this._messageComposer&&this._messageComposer.blur()}focusTextInputForAccessibility(){this._setComposerAccessibilityFocus()}_dismissKeyboard(){this._messageComposer&&this._messageComposer.blurIfFocused()}_setComposerAccessibilityFocus(){this._messageComposer&&this._messageComposer.setTextInputAccessibilityFocus()}_allowsUpload(){return!this.state.e2eeHandshake&&this.props.allowUploads}render(){return this.state.isBookmark?this._updateBookmarkStreamSpacers():this._updateMessageStreamSpacers(),(0,o.jsxs)(u.View,{style:P.default.flexOne,children:[this._getContactInviteHeader(),this._getMessageStream()]})}_updateMessageStreamSpacers(){this._leftMessageStreamSpacerWidth=0,this._rightMessageStreamSpacerWidth=0,this._spacerWidthUpdated=!1,this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI?this._getContext().isPresentedInDesktopSubview?(this._leftMessageStreamSpacerWidth=5,this._rightMessageStreamSpacerWidth=15,this._spacerWidthUpdated=!0):this.state.useTabletUI&&(this._leftMessageStreamSpacerWidth=St,this._rightMessageStreamSpacerWidth=St,this._spacerWidthUpdated=!0):(this.state.isRenderedIn4ColumnWidth?this._leftMessageStreamSpacerWidth=St:(this._rightMessageStreamSpacerWidth=80-lt.messageStreamOverflowWidth,this._leftMessageStreamSpacerWidth=80-lt.messageStreamOverflowWidth),this._spacerWidthUpdated=!0)}_updateBookmarkStreamSpacers(){{const e=this.state.isRenderedIn4ColumnWidth?30:100;this._leftMessageStreamSpacerWidth=e,this._rightMessageStreamSpacerWidth=e}this._spacerWidthUpdated=!0}_getContactInviteHeader(){if(this.state.hideInviteHeader)return;let e;return this._hasPendingIncomingContactRequest()?this.state.isUsingStackNavigationContext||(e=(0,o.jsx)(ct.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:this.state.isIncomingContactInvitePending,onIncomingContactInviteAccepted:this._onContactInviteAccepted,inviteToken:this.props.inviteToken},this.props.conversationId)):this._showContactInviteHeader(this.props,this.state)&&(e=(0,o.jsx)(ct.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:!1,isContactInviteJustAccepted:this.state.isContactInviteJustAccepted,isEncryptedConversationEstablished:this._isEncryptedConversationEstablished(),isAnyMessageInTheStream:this.state.isAnyMessageInTheStream,showWave:this._showWave(this.state),onGreet:this._onGreet},this.props.conversationId)),e}_getMessageStream(){let e;const t=this._getContext().isPresentedByMobileStackNavigator;e=this.props.hasUnderlay?[P.default.flexOne,P.default.transparentBackground]:[P.default.flexOne,u.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)],this.props.containerStyleOverride&&e.push(this.props.containerStyleOverride);let s=(0,o.jsxs)(u.View,{style:[e,t?ft.paddingMobileBrowser:void 0],children:[this._getNetworkConnectionAlert(),(0,o.jsxs)(u.View,{style:ft.contentOuterContainer,children:[this._getContentArea(),this._getOptionalAutoSuggestionCompletion()]}),this._getMessageComposerArea(),this._getNotificationsButton(),this._getDragAndDropOverlay()]});return G.UICapabilities.dragAndDropSupported()&&this._allowsUpload()&&(s=(0,o.jsx)(T.default,{origin:E.FilePickerOrigin.DragAndDropToMessagePanel,style:e,conversationId:this.props.conversationId,onDragEnter:this._setShowDragAndDropOverlayStateTrue,onDragLeave:this._setShowDragAndDropOverlayStateFalse,onDropCompleted:this._setShowDragAndDropOverlayStateFalse,dropTargetSource:Ee.DropTargetOrigin.MessagePanel,onDragDropText:this._onDragDropText,children:s})),s}_shouldRenderNewsBotRightPane(){return this.state.shouldEnableRightPaneForNewsBot&&this.state.isNewsBot}_getNewsBotContentWithRightPane(e){return(0,o.jsx)(g.Column,{flex:"1",children:(0,o.jsxs)(g.Row,{flex:"1",children:[e,(0,o.jsx)(mt.TodayBotRightPane,{activeConversation:this.props.conversationId})]})})}_getMessageComposerArea(){if(this.state.hideComposer)return;const e=a.BrowserEnvironment.isMobile(),t=[ft.messageComposerOuterContainerHorizontal,u.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)];this.state.useMobileUI&&!e||t.push(ft.messageComposerContainerDesktop);const s=[ft.messageComposerHorizontalSpacer],i=[ft.messageComposerHorizontalSpacer],n=ft.messageComposerHorizontalSpacerDesktop;this.state.useMobileUI||(s.push(n),i.push(n)),!this.state.useMobileUI&&this.state.suggestionsShown&&(t.push(ft.messageComposerContainerWithSuggestionsDesktop),s.push(ft.messageComposerHorizontalSpacerWithSuggestionsDesktop),i.push(ft.messageComposerHorizontalSpacerWithSuggestionsDesktop));const r=this.state.responsiveWidth<=ve.ResponsiveWidth.Tiny,l=this.state.responsiveWidth<=ve.ResponsiveWidth.Small;this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI?this._getContext().isPresentedInDesktopSubview?(s.push(ft.messageComposerHorizontalTinySpacer),i.push(ft.messageComposerHorizontalTinySpacer)):(this.state.useTabletUI||e)&&(s.push(ft.messageComposerHorizontalSmallSpacer),i.push(ft.messageComposerHorizontalSmallSpacer)):(s.push(ft.defaultRightSpacerStyle),s.push(ft.defaultRightSpacerStyleForComposerWithPopup),this.state.isRenderedIn4ColumnWidth?(this.state.showAddinLauncher||s.push(ft.messageComposerHorizontalSmallSpacer),i.push(ft.messageComposerHorizontalSmallSpacer)):(s.push(ft.messageComposerHorizontalBigSpacer),i.push(ft.messageComposerHorizontalBigSpacer))),r||this._getContext().isPresentedInDesktopSubview||this.state.useMobileUI||this.state.isRenderedIn4ColumnWidth||(i.push(ft.toggleLeftPanelButtonContainer),l&&i.push(ft.toggleLeftPanelButtonContainerSmallView));const d=[ft.messageComposerOuterContainerVertical,this.state.useMobileUI?void 0:this._messageComposerOpacityStyle];let c;return this.state.isSearchingPes&&this.state.useMobileUI&&(d.push(ft.hideComposer),c=u.Types.ImportantForAccessibility.NoHideDescendants),(0,o.jsxs)(u.Animated.View,{ref:this._onComposerContainerRef,style:d,limitFocusWithin:u.Types.LimitFocusType.Limited,importantForAccessibility:c,children:[(0,o.jsx)(u.View,{style:i}),(0,o.jsx)(u.View,{style:t,children:this._getMessageComposerInner()}),(0,o.jsx)(u.View,{style:s,children:this._getToggleSideBarButton()})]},"composer")}_getNotificationsButton(){if(!this.state.isNewsChannel&&!this.state.isNewsBot)return;const e=u.Styles.createViewStyle({borderTopWidth:c.StyleSheet.hairlineWidth,borderColor:this._themeColors.dividerPrimary},!1),t=this.state.isMuted?he.getString("ConversationsListItem.UnmuteLabel"):he.getString("ConversationsListItem.MuteLabel"),s=()=>{const e=this.state.isMuted?"":qe.SubscriptionTypes.Muted,t=W.getConversationTypeForTelemetry(this.props.conversationId);Qe.default.setConversationSubscription(this.props.conversationId,e).then((()=>{ue.track(new H.ChatNotificationsToggleSetting(this.state.isMuted,void 0,this.props.conversationId,e,l.NotificationsSource.MessagePanelNotifications,t))}))};return(0,o.jsx)(n.BottomTabBarHeightContext.Consumer,{children:i=>(0,o.jsx)(u.View,{style:[ft.notificationsButtonWrapper,e,u.Styles.createViewStyle({height:i},!1)],children:(0,o.jsx)(M.default,{buttonStyle:Se.SXButtonStyle.Custom,title:t,hoverText:t,accessibilityLabel:t,onPress:s,buttonSize:Se.SXButtonSize.Medium,textStyleOverride:[q.default.fontStyle.semibold15],buttonConfig:{textColor:this._useAccessibleTheme()?this._themeColors.primaryTextColor:this._themeColors.textInteractive,backgroundColor:fe.Color.transparent}},"notifications-button")})})}_getToggleSideBarButton(){}_getMessageComposerInner(){let e;return e=this._shouldShowHandshakeControl(this.state)?this._getE2eeHandshakeControl():this.state.isRecording?this._getAudioComposer():!this.state.isSendImCapable||this.state.readOnlyConversation||this.state.isMaximumContactInviteMessageCountReached||this.state.isBlockedPSTNMri?this._getDisabledComposer():this.state.isBookmark?void 0:this._getMessageComposer(),e}_getDisabledComposer(){if(this.state.isConciergeBot)return;const e=this.state.isMaximumContactInviteMessageCountReached?he.getString("MessageStream.MaximumContactInviteMessagesWarning",{recipientDisplayName:this.state.recipientDisplayName}):he.getString("MessageStream.MessagingUnavailable");return(0,o.jsx)(u.View,{style:ft.messagingUnavailableContainer,children:(0,o.jsx)(b.BodyText,{size:b.BodyTextSize.SmallDeprecated,style:ft.messagingUnavailablePlaceholder,textThemeColor:b.TextThemeColor.Disabled,children:e})})}_getMessageComposer(){const e=[ft.messageComposerInner];this.props.safeAreaHorizontalInsets&&K.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&e.push(K.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets)),this.state.useTabletUI&&e.push(ft.tabletMessageComposer);const t=!!this.state.e2eeHandshake,s=!this._allowsUpload(),i=qe.isMyBotConversation(this.props.conversationId);return(0,o.jsx)(u.View,{style:e,children:(0,o.jsx)(ut.default,{ref:this._onMessageComposerRef,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,disableCopyPasteMedia:s,initialInputEntities:this.state.initialInputEntities,initialInputEntitiesDataVersion:this.state.initialInputEntitiesDataVersion,maxLength:(0,Je.getConversationMaxMessageLength)(this.state.isConversationAccepted),shouldAutoFocus:this.props.shouldAutoFocusInput,preventAccessibilityFocus:this.props.preventAccessibilityFocus||this.props.isSelectMessagesModeActive,availableWidth:this.props.availableWidth,hideMediaBar:this.props.hideMediaBar||this.props.isSelectMessagesModeActive,hideStickerPickerIcon:!this.state.isConversationAccepted||t,hideSendCreditIcon:!this.state.showSendCredit||t,hideFilePicker:!this.state.isConversationAccepted&&!t||t,hideScheduleCallIcon:qe.isAgent(this.props.conversationId)||t,hidePollIcon:t||i,hideMediaPickerIcon:!0,hideLocationPickerIcon:this.state.isChild||t,hideContactPickerIcon:t,hideVideoMessageIcon:this._getContext().isPresentedByMobileStackNavigator,hideAudioMessage:t,headerHeightAndroid:this.props.headerHeightAndroid,quotedMessages:this.state.quotedMessages,quotesTriggerType:this.state.quotesTriggerType,editedMessage:this.state.editedMessage,suggestedCards:this.state.suggestedCards,suggestedAction:this.state.suggestedAction,showTranslatedMessage:this.state.showTranslatedMessage,onClearQuotedMessage:this._onClearQuote,onClearEdit:this._onClearEdit,onMessageSent:this._onMessageSent,onEditLastMessage:this._onEditLastMessage,onInputTextChanged:this._onInputTextChanged,onKeyPress:this._onKeyPress,onRecording:this._onRecording,onLaunchCamera:this.props.onLaunchCamera,onCardsSent:this._onCardsSent,onShowOverflow:this._onShowOverflow,onShowGestureHint:this.props.onShowGestureHint,onHandleOverflow:this.props.onHandleOverflow,onNativeComposerMessageEmptyStateChanged:this._onNativeComposerMessageEmptyStateChanged,onKeyboardPaste:this._onKeyboardPaste,hideContentInMessageComposer:this.props.isSelectMessagesModeActive,inlineSearchModeActive:this.state.isSearchingPes,explicitAccessibilityAnnoucement:!1,preventFocusOnMount:!!this.props.focusedMessageCuid,phoneNumberForSendingSms:this.props.selectedNumberForSMS,isInCall:this.state.isInCall,pastedTextType:this.state.pastedTextType},this.props.conversationId)})}_getAudioComposer(){return(0,o.jsx)(u.View,{style:ft.messageComposerInner,children:(0,o.jsx)(dt.default,{conversationId:this.props.conversationId,onDone:this._onDoneRecording,maxRecordingTimeMs:this.state.maxRecordingTimeMs},this.props.conversationId)})}_getE2eeHandshakeControl(){return(0,o.jsx)(u.View,{style:ft.messageComposerInner,children:(0,o.jsx)(pt.default,{conversationId:this.props.conversationId,e2eeHandshakeState:this.state.e2eeHandshakeState,e2eeHandshake:this.state.e2eeHandshake},this.props.conversationId)})}_getContentArea(){const e={width:this.state.contentAreaWidth,height:this.state.contentAreaHeight};ue.debug((()=>["DIM_CALC - message panel - contentAreaWidth: ",this.state.contentAreaWidth," contentAreaHeight: ",this.state.contentAreaHeight]));const t=this._hasPendingIncomingContactRequest(),s=this._isComposingIndicatorDisabled(),i=this._isEncryptedConversationEstablished(),n=(0,o.jsx)(gt.default,{ref:this._onMessageStreamRef,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,focusedMessageCuid:this.props.focusedMessageCuid,forceRefreshFocus:this.props.forceRefreshFocus,hasUnderlay:!!this.props.hasUnderlay,topInset:this.props.topInset,disableComposingIndicator:s,isConversationAccepted:this.state.isConversationAccepted,isIncomingContactInvitePending:this.state.isIncomingContactInvitePending,isContactInviteJustAccepted:this.state.isContactInviteJustAccepted,recipientDisplayName:this.state.recipientDisplayName,renderOrigin:this.props.renderOrigin,onItemPress:this._onPress,containerInitialDimensions:e,onUserScrolledToTheTop:this._onScrolledToTheTop,onScrolledToTheBottom:this._onScrolledToTheBottom,onGreet:this._onGreet,onQuoteMessage:this._onQuoteMessage,onQuoteSelectionContextMenu:this._onQuoteSelectionContextMenu,onMessageEdit:this._onMessageEdit,onCardSuggestionAction:this._onSuggestedCardAction,onSuggestionClicked:this._onSuggestionClicked,onSuggestionsToggled:this._onSuggestionsToggled,onMountContent:this._onMountContent,onMessageStreamLayout:this._onMessageStreamLayout,onMessageStreamScreenReaderFocusUpdated:this._onMessageStreamScreenReaderFocusUpdated,onMessageSent:this._onMessageSent,onContactInviteAccepted:this._onContactInviteAccepted,onJumpToEndPress:this._onJumpToEndPress,inviteToken:this.props.inviteToken,safeAreaHorizontalInsets:this.props.safeAreaHorizontalInsets,leftSpacerWidth:this._leftMessageStreamSpacerWidth,rightSpacerWidth:this._rightMessageStreamSpacerWidth,onInitialRenderComplete:this._onInitialRenderComplete,isInvisible:this.props.isInvisible,renderDivider:this._shouldRenderDivider()?this._divider:void 0,showInviteHeaderForEncryptedThread:this.state.showInviteHeaderForEncryptedThread,isEncryptedConversationEstablished:i,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,disableSelectMultipleMessages:this._getContext().isPresentedInDesktopSubview,disableReportMessage:this.props.disableReportMessage,disablePlugins:this.props.disablePlugins,hideSuggestions:t,isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isTranslatedConversation:this.props.isTranslatedConversation,searchStore:this.props.searchStore,isRenderedIn4ColumnWidth:this.state.isRenderedIn4ColumnWidth,getInputEntities:this._getInputEntities},this.props.conversationId);return this._shouldRenderNewsBotRightPane()?this._getNewsBotContentWithRightPane(n):n}_isComposingIndicatorDisabled(){return!!this.state.e2eeHandshake&&this.state.e2eeHandshakeState!==Ye.SecureHandshakeState.Completed||this.state.isBookmark}_getOptionalAutoSuggestionCompletion(){if(this.state.isBookmark)return;let e;if(this.state.isSearchingPes&&this.state.useMobileUI)e=(0,o.jsx)(ke.PesInlineSearchContainer,{conversationId:this.props.conversationId,insertSearchResultToComposer:this._insertSearchResultsToComposer,pesTabType:this.state.pesTabType,showPesCategorySwitcher:this.state.showPesCategorySwitcher,showInLandscape:this.state.useTabletUI,containerWidth:this.state.contentAreaWidth});else{const t=this._getAvailableHeight();if(t>0){const s=Math.max((this.state.contentAreaWidth-lt.maxStreamContentWidth)/2,0),i=this.state.canUseSlashCommands&&!this.state.quotedMessages;e=(0,o.jsx)(ht.MessageTextCompletion,{ref:this._onTextCompletionRef,style:this.state.useMobileUI?ft.messageTextCompletion:void 0,conversationId:this.props.conversationId,showSlashCommands:i,onReplaceText:this._onReplaceText,onTextReplacementCandidatesShown:this._onTextReplacementCandidatesShown,maxMenuHeight:t,leftOffset:s})}}return e}_getNetworkConnectionAlert(){let e;return this.state.isUsingStackNavigationContext&&(e=(0,o.jsx)(v.default,{})),e}_getDragAndDropOverlay(){if(this.state.isBookmark)return;let e;return this.state.showDragAndDropOverlay&&this._allowsUpload()&&(e=(0,o.jsx)(I.default,{})),e}_isEncryptedConversationEstablished(){return this.state.e2eeHandshakeState?this.state.e2eeHandshakeState===Ye.SecureHandshakeState.Completed:void 0}_hasPendingIncomingContactRequest(e=this.state){return!!e.isSendImCapable&&!!e.isIncomingContactInvitePending&&!e.readOnlyConversation}_shouldRenderDivider(){return this.state.useMobileUI}_getAvailableHeight(){const e=(0,gt.shouldUseAltMsgView)()?this.state.contentAreaHeight:this.state.contentAreaHeight-this.state.keyboardHeight;return Math.max(0,e)}_considerNavigationAfterDeleteConversation(e){if(e&&this._lastDeletedTimestamp<e.getDeletedTimestamp()){const e=je.default.newCauseId();ue.log(_e.LogTraceArea.Navigation,"MessagePanel._onConversationsStoreUpdate causeId: "+e),$.default.navigateAfterDeleteConversation(this.props.conversationId,e,this._getContext())}}_considerRefreshingContactsStore(e){e&&e.isOneOnOne()&&!qe.isAgent(this.props.conversationId)&&e.getConversationStatus()===_e.ConversationStatus.AcceptPendingSender&&Ue.default.isConversationAccepted(e.id)&&Ue.default.triggerContactsRefresh()}_considerInviteMessageCountReached(e){const t=this.state&&this.state.isConversationAccepted;if(t)return;const s=e&&e.getAcceptPendingMessageCount(),i=void 0!==s&&s>=this.state.maximumContactInviteMessageCount,o=!t&&!qe.isReadOnlyConversation(this.props.conversationId)&&!this.state.isPSTNOrSMSConversation&&i;this.isComponentMounted()&&this.setState({isMaximumContactInviteMessageCountReached:o,isConversationAccepted:t})}_toggleRecording(e){if(e&&!this.state.isRecording){if(this.isComponentMounted()){let e=ve.PermissionPromptOptions.SkipPrePrompt;0,S.default.AugmentedPermissionsPromptHelper.subscribeToAugmentedPermissionEvents(),re.default.requestPermission(ve.PermissionType.Microphone,e).then((e=>{S.default.AugmentedPermissionsPromptHelper.unsubscribeFromAugmentedPermissionEvents(),e===d.PermissionStatus.Granted&&this.setState({isRecording:!0})}))}r.default.blockScreenLock().catch((e=>{ue.warn(_e.LogTraceArea.MessageStream,"blockScreenLock failed: "+ge.default.errorAsString(e))}))}else!e&&this.state.isRecording&&(this.isComponentMounted()&&this.setState({isRecording:!1}),r.default.allowScreenLock().catch((e=>{ue.warn(_e.LogTraceArea.MessageStream,"allowScreenLock failed: "+ge.default.errorAsString(e))})))}_shouldShowHandshakeControl(e){return e.e2eeHandshake&&e.e2eeHandshakeState&&e.e2eeHandshakeState!==Ye.SecureHandshakeState.Completed}_showOrHideDivider(e,t){if(!e.showBottomDivider)return;const s=this._shouldShowHandshakeControl(t)||!this._scrolledToTheBottom;this._dividerOpacityValue.setValue(s?1:0)}_postCallerIdMessage(){if(this.state.showCallerIDMessageType){const e=Xe.createCallerIdMessage(this.props.conversationId,this.state.showCallerIDMessageType);f.default.notifyMessageShown(this.props.conversationId),this._postEphemeralMessage(e),this.isComponentMounted()&&this.setState({showCallerIDMessageType:void 0})}}_processMessageSendingInSenderUI(e,t=!1){if(!e)return;const s=ae.default.isNetworkingAvailableNoSubscription();Ze.default.notifyMessageSubmittedToPostingService(e,this.state.isUsingStackNavigationContext,s),this.state.enableMessageSendSuccessProcessing&&rt.default.signupForSpinner(e,this.state.sendingLieMaxDuration,s,t)}_processSlashCommand(e){const t=w.findSlashCommand(this.props.conversationId,e);switch(t.result){case w.FindResult.InvalidLooksLikeCommand:const s=he.getString("MessageComposer.InvalidSlashCommand"),i=Xe.createMessageInfoFromEscapedText(this.props.conversationId,_e.PostSource.SlashCommand,s);return this._postEphemeralMessage(i),!1;case w.FindResult.FoundCommand:ue.log(_e.LogTraceArea.MessagePanel,`Running slashCommand ${t.command}`);const o=(0,Ve.get)(t,["command","action"]),n=(0,Ve.get)(t,["params"])||"";if(o){const t=o(n,this.props.conversationId,e,this._postEphemeralMessage);switch(t){case J.ActionResult.None:return!0;case J.ActionResult.InvalidParameters:const e=he.getString("MessageComposer.InvalidSlashCommandParameters",{parameters:n}),s=Xe.createMessageInfoFromEscapedText(this.props.conversationId,_e.PostSource.SlashCommand,e);return this._postEphemeralMessage(s),!1;default:je.default.switchStatementExhaustiveChecking(t,"Missing case for SlashCommand.ActionResult")}}return!1;case w.FindResult.None:return;default:je.default.switchStatementExhaustiveChecking(t.result,"Missing case for SlashCommand.FindResult")}}_sendAddContactTelemetry(e){this.state.isContact||qe.isAgent(this.props.conversationId)||!this.state.isOneOnOneConversation||this._trackAddContactOnce||(this._trackAddContactOnce=!0,N.ContactsTelemetryHelper.addContactSuccess(this.props.conversationId,e),Y.default.addAppRatingMetric(1,me.AppRatingMetric.NEW_CONTACT))}_sendFirstMessageTelemetry(){this.props.isFromPeopleRecommendations&&!this._trackSendMessageOnce&&(this._trackSendMessageOnce=!0,Oe.messageSent(this.props.conversationId))}_sendGreetingEvent(e){N.ContactsTelemetryHelper.greetContact(this.props.conversationId,e),this._shouldSendGreetingEvent=!1}_showWave(e){return!(e.isContactInviteJustAccepted||e.e2eeHandshake||e.isAnyMessageInTheStream||e.isPSTNOrSMSConversation)}_showContactInviteHeader(e,t){return!t.isUsingStackNavigationContext&&(t.isNewContactConversation||t.showInviteHeaderForEncryptedThread||t.isContactInviteJustAccepted)&&!qe.isPhoneMri(e.conversationId)}_sendSearchFirstSuccessfulAction(){this.props.isFromSearch&&this._canSendSearchFirstSuccessAction&&(Oe.messageTypingStarted(this.props.conversationId),this._canSendSearchFirstSuccessAction=!1)}_getPlainTextFromInputEntities(e){return e.reduce(((e,t)=>(t instanceof ze.UnhandledEntity&&(e+=t.text()),e)),"")}}t.default=yt},78706:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseAltMsgView=yt;const i=s(197582),o=s(667294),n=s(785893),r=s(496486),a=i.__importDefault(s(114168)),l=i.__importStar(s(516778)),d=i.__importDefault(s(778230)),c=i.__importDefault(s(375308)),u=i.__importDefault(s(207833)),h=i.__importDefault(s(632015)),p=i.__importDefault(s(447974)),g=i.__importDefault(s(354145)),m=s(44557),S=i.__importDefault(s(609913)),_=s(742403),f=i.__importDefault(s(799585)),y=(i.__importDefault(s(827361)),i.__importDefault(s(859545))),v=i.__importDefault(s(363091)),C=i.__importDefault(s(139221)),T=i.__importDefault(s(296114)),M=i.__importDefault(s(140334)),b=s(653305),I=i.__importStar(s(786531)),w=s(786531),P=s(306194),k=s(96575),A=s(309515),x=i.__importDefault(s(150343)),D=s(995276),R=i.__importDefault(s(48076)),L=i.__importStar(s(740794)),B=i.__importDefault(s(664821)),F=i.__importDefault(s(92477)),N=i.__importDefault(s(749315)),E=i.__importDefault(s(850921)),O=i.__importDefault(s(601976)),U=i.__importDefault(s(252089)),V=i.__importDefault(s(201721)),H=i.__importDefault(s(341994)),j=i.__importDefault(s(942724)),z=i.__importDefault(s(163374)),W=i.__importDefault(s(960282)),G=i.__importDefault(s(316026)),K=i.__importDefault(s(218902)),q=i.__importDefault(s(389659)),Q=i.__importStar(s(85385)),X=i.__importStar(s(704704)),$=s(444314),J=i.__importDefault(s(503411)),Y=i.__importDefault(s(92179)),Z=i.__importStar(s(437782)),ee=s(922069),te=s(154235),se=s(815146),ie=i.__importDefault(s(371991)),oe=i.__importDefault(s(384669)),ne=i.__importDefault(s(247286)),re=i.__importDefault(s(656681)),ae=s(403396),le=i.__importDefault(s(999261)),de=i.__importDefault(s(685734)),ce=s(596648),ue=s(284841),he=i.__importStar(s(844104)),pe=i.__importDefault(s(114818)),ge=s(26703),me=i.__importDefault(s(601274)),Se=i.__importDefault(s(760989)),_e=s(536748),fe=i.__importStar(s(964647)),ye=i.__importStar(s(971988)),ve=i.__importStar(s(44717)),Ce=i.__importStar(s(780426)),Te=i.__importDefault(s(404547)),Me=i.__importDefault(s(556587)),be=i.__importStar(s(172134)),Ie=i.__importStar(s(152010)),we=i.__importDefault(s(321783)),Pe=s(675862),ke=s(434364),Ae=i.__importDefault(s(419779)),xe=i.__importDefault(s(484700)),De=i.__importDefault(s(221837)),Re=i.__importDefault(s(863132)),Le=i.__importDefault(s(235972)),Be=i.__importDefault(s(235549)),Fe=i.__importDefault(s(574489)),Ne=i.__importDefault(s(615364)),Ee=i.__importDefault(s(468492)),Oe=i.__importStar(s(242561)),Ue=s(954225),Ve=(s(822871),s(597542)),He=s(285661),je=i.__importDefault(s(406962)),ze=i.__importDefault(s(916260)),We=i.__importDefault(s(144084)),Ge=i.__importDefault(s(260714)),Ke=i.__importDefault(s(439075)),qe=s(770169),Qe=s(748266),Xe=i.__importDefault(s(645815)),$e=i.__importDefault(s(119607)),Je=s(128224),Ye=s(235020),Ze=i.__importDefault(s(852269)),et=i.__importDefault(s(697231)),tt=i.__importDefault(s(257044)),st=i.__importDefault(s(108395)),it=i.__importDefault(s(958868)),ot=3e5,nt=Number.MAX_VALUE;class rt{constructor(e,t,s,i=24){this.key=e,this.readReceiptsHeads=t,this.readReceiptsSum=s,this.height=i,this.focusable=!0}}class at{constructor(e,t,s=36){this.key=e,this.dateOfMarker=t,this.height=s,this.focusable=!1}}class lt{constructor(e,t,s=He.ItemListKey.Composing,i=45){this.composingMris=e,this.conversationId=t,this.key=s,this.height=i,this.focusable=!1}}class dt{constructor(e=He.ItemListKey.UnreadMarker,t=36,s=!1){this.key=e,this.height=t,this.focusItemOnMountOnMobile=s,this.focusable=!0}}class ct{constructor(e=He.ItemListKey.OldFriendBack,t=36,s=!1,i){this.key=e,this.height=t,this.focusItemOnMountOnMobile=s,this.userMri=i,this.focusable=!0}}class ut{constructor(e,t=He.ItemListKey.ReadOnlyChatHeader,s=300){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class ht{constructor(e=He.ItemListKey.ContactInviteHeaderItem,t,s,i,o,n,r){this.key=e,this.height=t,this.showWave=s,this.isContactInviteJustAccepted=i,this.isContactInvitePending=o,this.isEncryptedConversationEstablished=n,this.isAnyMessageInTheStream=r,this.focusable=!0}}class pt{constructor(e,t=He.ItemListKey.InviteMorePeople,s=60){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class gt{constructor(e,t=He.ItemListKey.InviteMorePeople,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class mt{constructor(e,t=He.ItemListKey.InviteMorePeople,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}class St{constructor(e,t=He.ItemListKey.SpeechConsent,s=480){this.conversationId=e,this.key=t,this.height=s,this.focusable=!0}}const _t=(0,ge.lazyProperties)({contentOuterContainer:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch",backgroundColor:"transparent"}),spinnerContainer:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),contactInviteUserIcon:()=>l.Styles.createViewStyle({alignSelf:"center",marginVertical:4}),composingIndicatorContainerMobile:()=>l.Styles.createViewStyle({marginHorizontal:10}),composingIndicatorContainerDesktop:()=>l.Styles.createViewStyle({marginHorizontal:0}),actionsDesktopContainer:()=>l.Styles.createViewStyle({flex:-1,flexDirection:"row",overflow:"visible"}),noMessagesContainer:()=>l.Styles.createViewStyle({position:"absolute",top:0,left:20,right:20,bottom:0,justifyContent:"center"}),contentAreaContainer:()=>l.Styles.createViewStyle({flex:1,height:200}),tabletMargin:()=>l.Styles.createViewStyle({marginHorizontal:20}),groupEngagementButtons:()=>l.Styles.createViewStyle({flex:0,flexDirection:"row",paddingHorizontal:25,alignSelf:"stretch",justifyContent:"center",flexWrap:"wrap",alignItems:"stretch"}),groupEngageButtonStyle:()=>l.Styles.createButtonStyle({marginHorizontal:5,marginVertical:10,minWidth:200}),newConnectionContainer:()=>l.Styles.createViewStyle({flex:1,alignItems:"center",height:32,paddingTop:5})}),ft={};function yt(){return!1}class vt extends it.default{constructor(){super(...arguments),this._lockUpdatesToConsumptionHorizon=!1,this._topPartialViewIndex=-1,this._topWholeViewIndex=-1,this._bottomWholeViewIndex=-1,this._bottomPartialViewIndex=-1,this._lastViewIndex=0,this._lastReceivedMessageTimestamp=0,this._lastSentMessageTimestamp=0,this._lastMessageTimestamp=0,this._lastSentMessageTimestampInitial=0,this._skypeMessages=[],this._unreadMarkerShown=!1,this._unreadMarkerTimestamp=0,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._oldUnreadCount=0,this._isUserPresentInApp=!0,this._isUserScrolling=!1,this._readOnlyConversation=!1,this._oldConsumptionHorizonTimestamp=nt,this._currentConsumptionHorizonTimestamp=nt,this._composingMris=[],this._contentRendered=!1,this._disallowFetchingMoreMessagesFromStore=!1,this._isFocusInsideMessageStreamOnMount=!1,this._isMessageStreamFocusStatusNotified=!1,this._virtualMessageViewRefCount=0,this._openAnimationCompleted=!1,this._readReceiptsKeysCounter=0,this._firstUpdateCompleteForMutliSelect=!1,this._readReceiptsThrottleTimeout=x.default.getS4LMessagingFeaturesNoSubscription().messageReadEventTimeout,this._sendMessageReadEventThrottled=Q.throttleTrack(this._readReceiptsThrottleTimeout),this._statusPillInstance=new K.default,this._shouldFocusLastMessage=!1,this._streamItemRefs={},this._speechConsentSuggestionSeenAt=-1,this._enableConversationSyncLie=!1,this._onMessageStreamStoreTrigger=()=>this.isComponentMounted()&&!this.props.isInvisible?this._updateStreamItemsAndReturnNewState(this.props):{},this._applyModificationsDebounced=(0,c.default)(((e,t,s=this.props,i)=>{this.isComponentMounted()&&!this.props.isInvisible&&(this._checkMessageStreamStoreAndUpdate(s,i?{id:Se.default.newGuid(),messageTimestamp:i}:void 0,"in debounced call of _applyModificationsDebounced"),this._applyModifications(e,t,s,i))}),100),this._equalsItemInfo=(e,t)=>e instanceof _e.MessageViewItemInfo&&t instanceof _e.MessageViewItemInfo?e.key===t.key&&e.skypeMessage===t.skypeMessage:T.default.comparator(e,t),this._onMountItem=(e,t)=>{t&&(this._mountedItemToFocus=e)},this._onVisibleRangeChanged=(e,t,s,i)=>{if(!this.isComponentMounted()||this.props.isInvisible)return;const o=this._dataItemsInfo.getItemList();this._lastViewIndex=o.length-1;const n=this._topWholeViewIndex!==s,a=o[i>=0?i:t];a instanceof _e.MessageViewItemInfo&&this._reportRenderItemQoS(a.skypeMessage,!0),this._topPartialViewIndex=e,this._bottomPartialViewIndex=t,this._bottomWholeViewIndex=i,this._topWholeViewIndex=s,this._checkForConsumptionHorizonChange(),this._checkForReactionConsumptionHorizonChange();const l=this.state.scrollToItemViewIndex;if((this._scrollToMessage||this._scrollToUnreadMarker||this.props.isIncomingContactInvitePending)&&(0,r.isNumber)(l)){l<=t&&l>=e&&(this._scrollToMessage=!1,this._scrollToUnreadMarker=!1)}const d=0===s,c=i===this._lastViewIndex,u=!this._messageStreamStore.isLatestMessageTheEnd()||i<=this._lastViewIndex-5;if(!this._isMessageStreamFocusStatusNotified){let e=!1;this._isFocusInsideMessageStreamOnMount&&(e=!0),this.props.onMessageStreamScreenReaderFocusUpdated&&this.props.onMessageStreamScreenReaderFocusUpdated(e),this._isMessageStreamFocusStatusNotified=!0}(0,r.defer)((()=>{if(this.isComponentMounted()&&!this.props.isInvisible){this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in defer call of _onVisibleRangeChanged");const s=this._convertViewIndexToMessage(this._topPartialViewIndex,!0);this._topVisibleItemInfo!==s&&(this._topVisibleItemInfo=s,this._topVisibleItemInfo&&this._topVisibleItemInfo.skypeMessage&&(this._statusPillInstance.setTopPartiallyVisibleMessage(this._topVisibleItemInfo.skypeMessage),this._statusPillInstance.setUnread(this._unreadMarkerShown&&this._topVisibleItemInfo.metadata.viewIndex>this._unreadMarkerViewIndex)));!d&&!(-1!==e&&e<21)||this._messageStreamStore.isEarliestMessageTheBeginning()||this._messageStreamStore.cannotGetEarlierMessages()||this._disallowFetchingMoreMessagesFromStore?this.props.onUserScrolledToTheTop&&void 0!==this._currentScrollTop&&d&&n&&(this._messageStreamStore.isEarliestMessageTheBeginning()||this._messageStreamStore.cannotGetEarlierMessages())&&this.props.onUserScrolledToTheTop():this._messageStreamStore.fetchEarlierMessages();const i=this._lastViewIndex-21,r=-1!==t&&t>i;let a=u;Q.log(se.LogTraceArea.MessageStream,...this._withContext('Should show "jump to end" button',a)),!c&&!r||this._messageStreamStore.isLatestMessageTheEnd()||this._disallowFetchingMoreMessagesFromStore?c&&this._messageStreamStore.isLatestMessageTheEnd()&&(Q.log(se.LogTraceArea.MessageStream,...this._withContext('Do not show "jump to end" button because we are at the end of the stream')),this._onScrolledToTheBottom(!0),a=!1):this._messageStreamStore.fetchLaterMessages(),!a&&this._shouldFocusLastMessage&&this._listView&&this.state.lastMessage&&(this._listView.focusMessage(this.state.lastMessage.cuid),this._shouldFocusLastMessage=!1),this._jumpToEndButton&&this._jumpToEndButton.setVisible(a),this._maybeTrackMessageSearchPerformance(o)}}))},this._updateConsumptionHorizonToLastVisibleItem=()=>{this._lastVisibleItemForConsumptionHorizon&&(Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("Actually updating consumption horizon to: "+this._lastVisibleItemForConsumptionHorizon.getConsumptionHorizonString())),this._consumptionHorizonUpdateDebounceTimer&&(me.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=void 0),Te.default.setConsumptionHorizonToMessage(this.props.conversationId,this._lastVisibleItemForConsumptionHorizon),this._lastVisibleItemForConsumptionHorizon=void 0)},this._checkForReactionConsumptionHorizonChange=()=>{this._reactionConsumptionHorizonUpdateDebounceTimer&&me.default.clearTimeout(this._reactionConsumptionHorizonUpdateDebounceTimer),this._reactionConsumptionHorizonUpdateDebounceTimer=me.default.setTimeout(this._updateReactionConsumptionHorizon,1500)},this._updateReactionConsumptionHorizon=()=>{let e=0;const t=this._dataItemsInfo.getItemList();for(let s=this._topWholeViewIndex;s<=this._bottomWholeViewIndex;s++){const i=t[s];let o;i instanceof _e.MessageViewItemInfo&&(o=i.skypeMessage),o&&(0,D.isLastMessageUpdateReaction)(o)&&(be.markReactionsAsRead(o),e++)}Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("MessageStream - Updating of reaction consumption horizon for messages in viewport. Updated "+e)),this._reactionConsumptionHorizonUpdateDebounceTimer&&(me.default.clearTimeout(this._reactionConsumptionHorizonUpdateDebounceTimer),this._reactionConsumptionHorizonUpdateDebounceTimer=void 0)},this._onCopyContextMenu=()=>!!this._copyListenerRef&&this._copyListenerRef.triggerCopy(),this._onQuoteSelectionContextMenu=()=>{this.props.onQuoteSelectionContextMenu((0,ue.chain)(Object.values(this._streamItemRefs).map((({ref:e,message:t})=>{const s=e.quoteSelection();return s?t.mergePartialUpdate({content:s}):void 0})),r.flatten,d.default))},this._onCopy=e=>{const t=(0,ue.chain)(Object.values(this._streamItemRefs).map((({ref:t})=>t.copySelection(e))),r.flatten,d.default,r.size);t>0&&(J.default.scheduleTextMessage(X.getString("MessageStream.MessageCopied"),void 0,this._getRootViewId()),Q.track(new I.KeyboardMessagesTelemetry(this.props.conversationId,{messagesCount:t,actionType:w.KeyboardActionType.KeyboardCopy})))},this._onInitialRenderComplete=()=>{var e,t;null===(t=(e=this.props).onInitialRenderComplete)||void 0===t||t.call(e),this._markStreamScenarioStepCompleted(L.StreamNavigationScenarioSteps.InitialRenderComplete,{initial_render_complete_messages:this._skypeMessages.length,initial_render_complete_viewItems:this._dataItemsInfo.getItemList().length}),this.isComponentMounted()&&this.setState({initialRenderCompleted:!0}),this._openAnimationCompleted&&L.default.finishScenario(this.props.conversationId),B.default.messageStreamRendered()},this._openAnimationComplete=()=>{this._openAnimationCompleted=!0,this.state.initialRenderCompleted&&(this._markStreamScenarioStepCompleted(L.StreamNavigationScenarioSteps.WaitingForAnimationEnd),L.default.finishScenario(this.props.conversationId))},this._updateStatusPill=(0,p.default)((()=>{this._statusPill&&this._statusPill.setEnabledForInfo(!0).touch()}),1e3),this._onScroll=(e,t)=>{this._lockUpdatesToConsumptionHorizon=!1,this._onScrollTimer&&(me.default.clearTimeout(this._onScrollTimer),this._onScrollTimer=void 0),this._onScrollTimer=me.default.setTimeout(this._onScrollStoppedDebounced,1500),this._isUserScrolling=!0,this._updateStatusPill();const s=this._bottomWholeViewIndex===this._lastViewIndex&&this._messageStreamStore.isLatestMessageTheEnd();this._onScrolledToTheBottom(s),this._currentScrollTop=e},this._onScrollStoppedDebounced=()=>{this._isUserScrolling=!1,this._onScrollTimer=void 0},this._onOverrideConsumptionHorizon=e=>{this._consumptionHorizonTimestampOverride=e},this._shouldUpdateItem=(e,t)=>e instanceof _e.MessageViewItemInfo&&t instanceof _e.MessageViewItemInfo?e.key!==t.key||e.skypeMessage!==t.skypeMessage||t.metadata.shouldUpdate:!(0,pe.default)(e,t),this._renderItem=(e,t)=>{if(e instanceof ut)return(0,n.jsx)(ae.UserIcon,{style:_t.contactInviteUserIcon,userMri:e.conversationId,size:ce.UserIconSize.Size120,conversationId:this.props.conversationId},e.key);if(e instanceof ht)return(0,n.jsx)(ze.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isIncomingContactInvitePending:this.props.isIncomingContactInvitePending,isContactInviteJustAccepted:this.props.isContactInviteJustAccepted,onIncomingContactInviteAccepted:this.props.onContactInviteAccepted,inviteToken:this.props.inviteToken,isEncryptedConversationEstablished:this.props.isEncryptedConversationEstablished,isAnyMessageInTheStream:e.isAnyMessageInTheStream,showWave:e.showWave,onGreet:this.props.onGreet},e.key);if(e instanceof lt){const t=[];return this.state.isUsingStackNavigationContext?t.push(_t.composingIndicatorContainerMobile):t.push(_t.composingIndicatorContainerDesktop),(0,n.jsx)(l.View,{style:t,children:(0,n.jsx)(st.default,{typingMris:e.composingMris,conversationId:e.conversationId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext})},"-composingIndicator")}if(e instanceof dt){const t=ve.isPhoneMri(this.props.conversationId)?X.getString("MessageStream.UnreadSmsMarkerDivider"):X.getString("MessageStream.UnreadMarkerDivider");return(0,n.jsx)(tt.default,{text:t,dividerTypeIsLastRead:!0,messageStreamFontSize:this.state.messageStreamFontSize,focusStreamItemTextForMobileScreenReader:e.focusItemOnMountOnMobile,onMountItem:this._onMountItem})}if(e instanceof ct){const t=O.default.getShortDisplayName(e.userMri)||"",s=X.getString("MessageStream.OldFriendBackHintDivider",{firstName:t});return(0,n.jsx)(tt.default,{text:s,dividerTypeIsLastRead:!0,messageStreamFontSize:this.state.messageStreamFontSize,focusStreamItemTextForMobileScreenReader:e.focusItemOnMountOnMobile,onMountItem:this._onMountItem})}if(e instanceof at){const t=()=>E.default.getDisplayDateString(e.dateOfMarker);return(0,n.jsx)(tt.default,{textGetter:t,dividerTypeIsLastRead:!1,messageStreamFontSize:this.state.messageStreamFontSize})}if(e instanceof rt)return(0,n.jsx)(Ye.StreamItemReadReceipts,{conversationId:this.props.conversationId,readReceiptsHeads:e.readReceiptsHeads,readReceiptsSum:e.readReceiptsSum,availableHeight:e.height},e.key);if(e instanceof _e.MessageViewItemInfo)return De.default.notifyMessageRendered(e.skypeMessage.getOriginalClientMessageId()),Q.debug((()=>["DIM_CALC - message stream containerInitialDimensions",this.props.containerInitialDimensions])),this._reportRenderItemQoS(e.skypeMessage,!1),(0,o.createElement)(Je.StreamItem,Object.assign({ref:this._onStreamItemRef(e.skypeMessage)},e.metadata.itemRenderInfo,{hint:this._getItemHint(e.skypeMessage.cuid),key:"stream-item-"+e.skypeMessage.cuid,message:e.skypeMessage,renderOrigin:this.props.renderOrigin||Oe.MessageRenderOrigin.ChatCanvas,isConversationAccepted:this.props.isConversationAccepted,isLastMessage:this.state.lastMessage===e.skypeMessage,containerInitialDimensions:this.props.containerInitialDimensions,disableForward:this.props.disableForward,disableSelectMultipleMessages:this.props.disableSelectMultipleMessages,disableReportMessage:this.props.disableReportMessage,disablePlugins:this.props.disablePlugins,onDisableScroll:this._onDisableScroll,onMarkAsUnread:this._onOverrideConsumptionHorizon,onItemPress:this.props.onItemPress,onMountContent:this.props.onMountContent,onMountItem:this._onMountItem,onQuote:this.props.onQuoteMessage,onEdit:this.props.onMessageEdit,onCopyContextMenu:this.state.enableMultiMessageQuoteOnKeyboard?this._onCopyContextMenu:void 0,onQuoteSelectionContextMenu:this.state.enableMultiMessageQuoteOnKeyboard?this._onQuoteSelectionContextMenu:void 0,focusStreamItemForMobileScreenReader:e.shouldItemFocusOnMobile,isSelectMessagesModeActive:this.props.isSelectMessagesModeActive,messageStreamFontSize:this.state.messageStreamFontSize,linkedMessages:this._getLinkedMessages(e.skypeMessage),isTranslatedConversation:this.props.isTranslatedConversation,searchStore:this.props.searchStore,isNewsBot:this.state.isNewsBot}));if(e instanceof pt){const t=(0,n.jsx)($e.default,{conversationId:e.conversationId,style:_t.groupEngageButtonStyle,origin:b.InviteMorePeopleButtonOrigin.MessageStream,messageStreamFontSize:this.state.messageStreamFontSize});return(0,n.jsx)(l.View,{style:_t.groupEngagementButtons,children:t})}return e instanceof gt?(0,n.jsx)(Ze.default,{conversationId:e.conversationId,memberCount:this._conversation.getMemberCount()}):e instanceof mt?(0,n.jsx)(g.default,{threadId:e.conversationId,origin:m.MeetNowOrigin.MessageStream}):e instanceof St?(0,n.jsx)(et.default,{}):void 0},this._onStreamItemRef=e=>t=>{const s=e.cuid;t?this._streamItemRefs[e.cuid]={ref:t,message:e}:delete this._streamItemRefs[s]},this._onCopyListenerRef=e=>this._copyListenerRef=e||void 0,this._getLinkedMessages=e=>e.isAlbum()?re.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId()):[],this._getReadReceiptsSummary=e=>{const t=[];return(0,r.eachRight)(this._readReceiptsMarks,((s,i)=>(t.push(...s.readReceipts),i!==e.toString()))),t},this._onJumpToEndButtonRef=e=>{this._jumpToEndButton=e||void 0},this._onJumpToEndButtonPress=e=>{let t;this._shouldFocusLastMessage=!0,this._messageStreamStore.isLatestMessageTheEnd()?(t=this._lastViewIndex-this._bottomWholeViewIndex,this._scrollToBottom()):(this._scrollToBottomOfRefreshedStream(),Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Refresh store reason: User jumped to end from a position where last messages were not loaded in view"))),this.props.onJumpToEndPress&&this.props.onJumpToEndPress(),Q.track(new I.JumpToEnd(this.props.conversationId,t,e))},this._onDisableScroll=e=>{this.setState({isScrollDisabled:e})},this._statusPillRef=e=>{this._statusPill=e||void 0},this._onListViewRef=e=>{this._listView=e||void 0}}componentDidMount(){super.componentDidMount(),this._postCreatedSubscriptionToken=Re.default.postCreated.subscribe((e=>{this.isComponentMounted()&&this._contentRendered&&!e.editedMessageCuid&&e.conversationIds.includes(this.props.conversationId)&&this._messageStreamStore&&(this._checkMessageStreamStoreAndUpdate(this.props,this.state.scrollRequest,"in async call of PostingService.postCreated"),this._messageStreamStore.isLatestMessageTheEnd()?this._scrollToBottom():this._scrollToBottomOfRefreshedStream())}))}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),e.isSelectMessagesModeActive!==this.props.isSelectMessagesModeActive&&(this._firstUpdateCompleteForMutliSelect=!0,this._viewItemsListDirty=!0,this._regenerateItemListIfDirty(this.props,this.state)),e.isTranslatedConversation!==this.props.isTranslatedConversation&&(this._viewItemsListDirty=!0,this._shouldUpdateForTranslationChange=!0,this._regenerateItemListIfDirty(this.props,this.state)),this._maybeAnimateScrollToPosition(t.scrollRequest,this.state.scrollRequest),t.messageHintsData!==this.state.messageHintsData&&(this._viewItemsListDirty=!0,this._shouldUpdateForHintChange=!0,this._regenerateItemListIfDirty(this.props,this.state)),this.state.messageHintsData&&this._conversation){const t=xe.default.getMessageToShowHint(this._dataItemsInfo,this.state.messageHintsData);t?(this._messageCuidToShowHint=t.skypeMessage.cuid,xe.default.updateHintData(this.props.conversationId,this.state.messageHintsData,t)):e.conversationId!==this.props.conversationId&&(this._messageCuidToShowHint=void 0,this.setState({messageHintsData:xe.default.getNextPriorityHint()}))}this.state.enableConversationLoadingSpinnerTracking&&!t.isInitialMessagesLoaded&&this.state.isInitialMessagesLoaded&&Ae.default.notifyConversationLoadedAndSpinnerDismissed(this.props.conversationId)}componentWillUnmount(){super.componentWillUnmount(),N.default.removeConversation(this.props.conversationId),this._consumptionHorizonUpdateDebounceTimer&&(me.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=void 0),this._lastVisibleItemForConsumptionHorizon&&this._updateConsumptionHorizonToLastVisibleItem(),this._onScrollTimer&&(me.default.clearTimeout(this._onScrollTimer),this._onScrollTimer=void 0),this._postCreatedSubscriptionToken&&this._postCreatedSubscriptionToken.unsubscribe(),this._statusPillInstance&&this._statusPillInstance.destroy(),this._sendMessageReadEventThrottled.flush(),this.state.showSpeechConsentSuggestion&&this.props.renderOrigin!==Oe.MessageRenderOrigin.CallCanvas&&G.default.hideSpeechConsentSuggestion(),this._markInterruptionInQoSTracking(),this.state.enableConversationLoadingSpinnerTracking&&this._markInterruptionInConversationLoadingTracking()}_markInterruptionInQoSTracking(){this._skypeMessages.forEach((e=>{const t=Le.default.getTelemetryScenarioForMessage(e.conversationId,e.cuid);if(!t)return;const s=t.getSecondaryScenario(k.ScenarioName.SendTextMessageUI);!s||s.isResolved()||s.isInterrupted()||(this.state.enableMessageSendSuccessProcessing?De.default.notifyMessageRenderInterrupted(e.getOriginalClientMessageId()):s.markInterrupted(Date.now()-e.createdTime))}))}_markInterruptionInConversationLoadingTracking(){Ae.default.notifyConversationLoadingInterrupted(this.props.conversationId)}_buildState(e,t){var s,i,o,n;const a=x.default.getS4LMessagingFeatures(),{oldFriendBack:l}=x.default.getEngagementFeatures(),d=V.default.getUserPreferencesLocal(),c=this.props;this._conversation=(0,Ne.default)().getConversation(e.conversationId);const u=Fe.default.getMessageCountsForConversation(e.conversationId),h=null===(s=this._conversation)||void 0===s?void 0:s.memberConsumptionHorizonsSorted,p=this._getRootViewId(),g=j.default.isUsingStackNavigationContext(),m=l.enable&&oe.default.shouldShowOldFriendBackQuickReply(e.conversationId);let S={useCompactLayout:W.default.isSmallDevice(p)||!!this._getContext().isPresentedInDesktopSubview,isUsingStackNavigationContext:g,readReceiptsEnabled:a.enableReadReceipts&&!ve.isAgent(e.conversationId)&&H.default.getReadReceiptsEnabled()&&e.isConversationAccepted,memberConsumptionHorizonsSorted:h,isOneOnOne:null===(i=this._conversation)||void 0===i?void 0:i.isOneOnOne(),enableMultiMessageQuoteOnKeyboard:d.pasteAsQuotesEnabled,messageStreamFontSize:V.default.getMessageStreamFontSize(),scrollRequest:e.searchStore?e.searchStore.getTimestamp():void 0,enableNewConversationCreation:a.enableNewConversationCreation,isJoinEnabled:null===(o=this._conversation)||void 0===o?void 0:o.isJoinEnabled(),isRegularMemberInModeratedGroup:this._conversation&&(0,Pe.isRegularMemberInModeratedGroup)(this._conversation),showSpeechConsentSuggestion:G.default.showSpeechConsentSuggestingInConversation(),isClearLeaveV2EnabledAndKeepInRecents:this._conversation&&(0,Ne.default)().isClearApplicableAndKeepInRecents(this._conversation.id),isConvCleared:this._conversation&&this._conversation.isDeleted(),isChild:ne.default.isChild(),messageSearchLimit:a.inConversationMessageSearch.initialPageSize,isNewsBot:(0,_.isTodayBot)(this._conversation.id),isShowOldFriendBackHintDivider:m,enableMessageSendSuccessProcessing:a.enableMessageSendSuccessProcessing,enableConversationLoadingSpinnerTracking:a.enableConversationLoadingSpinnerTracking};t&&(this._messageCuidToShowHint=void 0),t||this.state.messageStreamFontSize===S.messageStreamFontSize||this._virtualMessageViewRefCount++,e.isSelectMessagesModeActive!==c.isSelectMessagesModeActive&&(this._firstUpdateCompleteForMutliSelect=!1),this._isUserPresentInApp=le.default.isCurrentUserActive(),this._oldConsumptionHorizonTimestamp=this._currentConsumptionHorizonTimestamp,this._currentConsumptionHorizonTimestamp=(0,r.isNumber)(u.consumptionHorizonTimestamp)?u.consumptionHorizonTimestamp:nt;const f=!(!ve.isReadOnlyConversation(e.conversationId)&&!(null===(n=this._conversation)||void 0===n?void 0:n.isEncryptedThread()))&&!e.isEncryptedConversationEstablished;f!==this._readOnlyConversation&&(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Conversation readonly state changed - need to regenerate list of items")),this._viewItemsListDirty=!0),this._readOnlyConversation=f;const y=Be.default.getComposingUsers(e.conversationId);(0,pe.default)(y,this._composingMris)||(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Composing MRIs changed - need to regenerate list of items")),this._viewItemsListDirty=!0),this._composingMris=y,this.state&&!(0,pe.default)(h,this.state.memberConsumptionHorizonsSorted)&&(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Member consumption horizons changed - need to regenerate list of items")),this._viewItemsListDirty=!0),t||(0,pe.default)(c.isContactInviteJustAccepted,e.isContactInviteJustAccepted)||(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("isContactInviteJustAccepted changed - need to regenerate list of items")),this._viewItemsListDirty=!0),t||(0,pe.default)(c.isEncryptedConversationEstablished,e.isEncryptedConversationEstablished)||(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("isEncryptedConversationEstablished changed - need to regenerate list of items")),this._viewItemsListDirty=!0),(0,pe.default)(c.isSelectMessagesModeActive,e.isSelectMessagesModeActive)||(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("showCheckboxUiChange - need to regenerate list of items")),this._viewItemsListDirty=!0),t||!this.state||(0,pe.default)(S.showSpeechConsentSuggestion,this.state.showSpeechConsentSuggestion)||(this._viewItemsListDirty=!0),this._messageReadDelay=a.messageReadDelay,Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("UnreadMessageDetails: CurrentConsumptionHorizonTimestamp:"+u.consumptionHorizonTimestamp+" UnreadCount:"+u.unreadCount)),t&&(S.isScrollDisabled=!1);let v=!1;const C=this.state&&void 0!==S.scrollRequest&&!(0,pe.default)(this.state.scrollRequest,S.scrollRequest);let T=!1,M=-1;!t&&C&&void 0!==S.scrollRequest&&(M=this._dataItemsInfo.getItemList().findIndex((e=>e instanceof _e.MessageViewItemInfo&&void 0!==S.scrollRequest&&e.skypeMessage.createdTime===S.scrollRequest.messageTimestamp)),T=M>-1);const b=this.state&&this.state.isClearLeaveV2EnabledAndKeepInRecents&&!this.state.isConvCleared&&S.isConvCleared,I=this._messageStreamStore&&this._messageStreamStore.isDestroyed();return(t||e.conversationId!==c.conversationId||C&&!T||c.focusedMessageCuid!==e.focusedMessageCuid||this.state&&S.readReceiptsEnabled!==this.state.readReceiptsEnabled||b||I)&&(v=!0,Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Refresh store reason:  initialBuild:"+t+" ConversationId differs:"+(e.conversationId!==c.conversationId)+" ScrollToTimestamp differs and target message not loaded:"+C&&!T+" NewTargetMessageIndex:"+M+" FocusMessageId differs:"+(e.focusedMessageCuid!==c.focusedMessageCuid)+" ReadReceipts settings differs:"+(this.state&&S.readReceiptsEnabled!==this.state.readReceiptsEnabled)+" ConversationCleared V2:"+b+" StoreWasDestroyed:"+I))),S=this._refreshConversationProperties(e,S,v,!1,u.unreadCount),!t&&this.state&&S.readReceiptsEnabled!==this.state.readReceiptsEnabled&&(this._lockUpdatesToConsumptionHorizon=!0),t||this._checkForConsumptionHorizonChange(),S.messageHintsData=xe.default.getHint(this._conversation,t),t||(0,pe.default)(S.messageHintsData,this.state.messageHintsData)||(this._viewItemsListDirty=!0),this._enableConversationSyncLie=a.enableConversationSyncLie,S.enableConversationLoadingSpinnerTracking&&t&&!S.isInitialMessagesLoaded&&Ae.default.notifyConversationLoadingStarted(e.conversationId,g,z.default.isNetworkingAvailable()||!1),t&&Y.default.markActionDoneAndRemoveTracker(e.conversationId),S}_refreshConversationProperties(e,t,s,i,o){let n=t||{};const r=o||Fe.default.getMessageCountsForConversation(e.conversationId).unreadCount;if(this._oldUnreadCount!==r&&this._skypeMessages.length>0){if(this._oldUnreadCount>r){const t=new I.MessageReceivedRead(this._skypeMessages[this._skypeMessages.length-1],e.conversationId,this._oldUnreadCount-r);Q.track(t)}this._oldUnreadCount=r}return s?(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Resetting properties for the conversationId:"+Z.mriOrId(e.conversationId))),this._hideUnreadMarker(),r>0&&!i&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp),n.isReactionDetailsOn=!1,this._scrollToMessage=!!n.scrollRequest&&!i,this._scrollToUnreadMarker=r>0&&!this._scrollToMessage&&!!this._currentConsumptionHorizonTimestamp&&!e.isIncomingContactInvitePending&&!i,this._highlightScrollToTarget=this._scrollToMessage,this._topPartialViewIndex=-1,this._bottomWholeViewIndex=-1,this._topWholeViewIndex=-1,this._bottomPartialViewIndex=-1,this._consumptionHorizonTimestampOverride=void 0,this._lockUpdatesToConsumptionHorizon=!1,this._lastReceivedMessageTimestamp=0,this._lastMessageTimestamp=0,this._lastViewIndex=0,this._skypeMessages=[],this._readReceiptsMarks={},this._virtualMessageViewRefCount++,this._contentRendered=!1,this._disallowFetchingMoreMessagesFromStore=!1,this._dataItemsInfo=new M.default,this._updateMessageStreamStore(e,n.scrollRequest&&n.scrollRequest.messageTimestamp,i),t.isUsingStackNavigationContext?L.default.setStackNavigationCompleteCallback(this._openAnimationComplete):this._openAnimationCompleted=!0,this._markStreamScenarioStepCompleted(L.StreamNavigationScenarioSteps.InitialBuild),this._updateStreamItemsAndReturnNewState(e,n)):(this._updateStreamIndexes(n,!0),n=this._regenerateItemListIfDirty(e,n),n)}_updateMessageStreamStore(e,t,s=!1){let i;this._messageStreamStore&&this._removeSubscription(this._messageStreamStoreSubscription),s?i=void 0:this._scrollToMessage?i=t:this._scrollToUnreadMarker&&(i=this._currentConsumptionHorizonTimestamp),this._messageStreamStore=we.default.cachedStoreFor(e.conversationId,i),this._messageStreamStoreSubscription={store:this._messageStreamStore,callbackBuildState:this._onMessageStreamStoreTrigger},this._addSubscription(this._messageStreamStoreSubscription)}_hideUnreadMarker(){this._unreadMarkerShown=!1,this._unreadMarkerTimestamp=-1,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._viewItemsListDirty=!0}_showUnreadMarker(e){this._unreadMarkerShown=!0,this._unreadMarkerTimestamp=e,this._unreadMarkerMessageIndex=-1,this._unreadMarkerViewIndex=-1,this._viewItemsListDirty=!0}_updateStreamIndexes(e,t=!1){if(!(e.isInitialMessagesLoaded||this.state&&this.state.isInitialMessagesLoaded))return;const s=this._lastReceivedMessageTimestamp,i=this._lastMessageTimestamp,o=this._lastSentMessageTimestamp,n=this._skypeMessages.length-1;let a=!1,l=!1;this._lastSentMessageTimestamp=0,(0,r.eachRight)(this._skypeMessages,((e,t)=>(t===n&&(this._lastMessageTimestamp=e.createdTime),v.default.isMyMri(e.creator)||ye.isThreadActivityType(e.messagetype)||l||(this._lastReceivedMessageTimestamp=e.createdTime,l=!0),!v.default.isMyMri(e.creator)||ye.isThreadActivityType(e.messagetype)||a||(this._lastSentMessageTimestamp=e.createdTime,a=!0),!(l&&a))));const d=this._unreadMarkerViewIndex>0&&this._topPartialViewIndex>this._unreadMarkerViewIndex,c=this._unreadMarkerViewIndex>0&&this._bottomPartialViewIndex<this._unreadMarkerViewIndex,u=d||c,h=void 0!==e.isLatestMessageTheEnd?e.isLatestMessageTheEnd:this.state.isLatestMessageTheEnd,p=void 0!==e.isEarliestMessageTheBeginning?e.isEarliestMessageTheBeginning:this.state.isEarliestMessageTheBeginning,g=this._currentConsumptionHorizonTimestamp>=this._lastReceivedMessageTimestamp&&h,m=this._currentConsumptionHorizonTimestamp>=s&&h,S=i>0&&this._lastMessageTimestamp>i&&h,_=s>0&&this._lastReceivedMessageTimestamp>s&&h;0===this._lastSentMessageTimestampInitial&&this._lastSentMessageTimestamp&&h&&(this._lastSentMessageTimestampInitial=this._lastSentMessageTimestamp);const f=0===this._lastViewIndex||this._lastViewIndex===this._bottomPartialViewIndex,y=_&&!f,C=this._oldConsumptionHorizonTimestamp!==nt&&this._currentConsumptionHorizonTimestamp<this._oldConsumptionHorizonTimestamp,T=this._consumptionHorizonTimestampOverride===this._currentConsumptionHorizonTimestamp;if(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("_checkStreamIndexes:isUnreadMarkerOutsideViewport:"+u+";allMessagesRead:"+g+";allOldMessagesRead:"+m+";newMessagesInStream:"+S+";newReceivedMessagesInStream:"+_+";isUserActive:"+this._isUserActive()+";oldLastItemVisible:"+f+";consumptionHorizonMovedBackInTime:"+C+";consumptionHorizonSetManually:"+T)),this._isUserActive()){if(this._unreadMarkerShown){g&&this._hideUnreadMarker();this._unreadMarkerTimestamp>0&&this._lastReceivedMessageTimestamp>0&&this._lastReceivedMessageTimestamp<=this._unreadMarkerTimestamp&&h&&this._hideUnreadMarker();const e=o>0&&this._lastSentMessageTimestamp>this._lastSentMessageTimestampInitial&&this._lastSentMessageTimestamp>o&&this._lastSentMessageTimestamp>this._lastReceivedMessageTimestamp&&h;Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("hideUnreadMarkernewSentMessagesInStream:"+e)),e&&this._hideUnreadMarker(),u&&m&&(y?this._showUnreadMarker(this._currentConsumptionHorizonTimestamp):S&&this._hideUnreadMarker())}else y&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp);(C||T)&&(this._consumptionHorizonTimestampOverride=void 0,this._lockUpdatesToConsumptionHorizon=!0,this._showUnreadMarker(this._currentConsumptionHorizonTimestamp))}else _&&!this._unreadMarkerShown&&this._showUnreadMarker(this._currentConsumptionHorizonTimestamp);let M=!this._unreadMarkerShown,b=!1;this._unreadMarkerMessageIndex=-1,this._currentConsumptionHorizonItemIndex=-1,this._skypeMessages.forEach(((e,t)=>{0===t&&e.createdTime>this._unreadMarkerTimestamp&&!p&&(M=!0),this._unreadMarkerShown&&!M&&e.createdTime>this._unreadMarkerTimestamp&&e.countsForUnreadCounts()&&(this._unreadMarkerMessageIndex=t,this._viewItemsListDirty=!0,M=!0),!b&&e.isAnyVersionKnownByServer()&&(e.createdTime<=this._currentConsumptionHorizonTimestamp?this._currentConsumptionHorizonItemIndex=t:b=!0)})),this._updateReadReceipts(e,t)}_updateReadReceipts(e,t){var s,i,o,n,a;const l=e=>(0,r.flatten)(Object.values(e).map((e=>e.readReceipts.map((e=>e.mri)))));if(!(null!==(s=e.readReceiptsEnabled)&&void 0!==s?s:null===(i=this.state)||void 0===i?void 0:i.readReceiptsEnabled))return;const d=e.isOneOnOne||!!(null===(o=this.state)||void 0===o?void 0:o.isOneOnOne),c=null!==(n=e.memberConsumptionHorizonsSorted)&&void 0!==n?n:(null===(a=this.state)||void 0===a?void 0:a.memberConsumptionHorizonsSorted)||[],u=Ce.computeMarks(this._skypeMessages,c),h=l(this._readReceiptsMarks),p=l(u),g=Object.keys(this._readReceiptsMarks),m=Object.keys(u);if(!(0,pe.default)(g,m)||!(0,pe.default)(h,p)){Object.values(this._readReceiptsMarks).forEach(((e,t)=>{if(u[t]&&!u[t].key)u[t].key=e.key;else{const t=Object.values(u).find((t=>(0,pe.default)(t.readReceipts,e.readReceipts)));t&&(t.key=e.key)}})),Object.values(u).forEach((e=>{e.key||(e.key=He.ItemListKey.ReadReceiptPrefix+this._readReceiptsKeysCounter++)}));const e=m.length&&t&&d?this._skypeMessages[Number(m[0])]:void 0;if(e){const t=new I.MessageRead(e,this.props.conversationId);this._sendMessageReadEventThrottled(t),F.default.addAppRatingMetric(1,ee.AppRatingMetric.MESSAGE_READ)}this._readReceiptsMarks=u,Q.log(se.LogTraceArea.ReadReceipts,"member CH: "+JSON.stringify(Object.values(this._readReceiptsMarks).map((e=>({mris:e.readReceipts.map((e=>Z.mriOrId(e.mri))),key:e.key})))))}}_updateStreamItemsAndReturnNewState(e,t){const s=t||{},i=S.default.updateCallEventMessages(this._messageStreamStore.getMessages()).filter((e=>{if(e.hasAlbumId()){const t=re.default.getNotFailedMediaMessagesForAlbum(e.getAlbumId());return e.isAlbum()?t.length>1:!!e.isSendRejected()||t.length<2}return!0}));if(s.isLatestMessageTheEnd=this._messageStreamStore.isLatestMessageTheEnd(),s.lastMessage=(0,h.default)(i),void 0===this._wasLatestMessageTheEndPreviously&&(this._wasLatestMessageTheEndPreviously=s.isLatestMessageTheEnd),s.isEarliestMessageTheBeginning=this._messageStreamStore.isEarliestMessageTheBeginning(),s.cannotGetEarlierMessages=this._messageStreamStore.cannotGetEarlierMessages(),s.lastMessage&&De.default.notifyMessagePickedFromMessageViewStoreIntoView(s.lastMessage.getOriginalClientMessageId()),this._scrollToUnreadMarker&&!s.isLatestMessageTheEnd){const e=(0,u.default)(i,(e=>e.countsForUnreadCounts())),t=e&&e.createdTime>this._currentConsumptionHorizonTimestamp;t||this._messageStreamStore.fetchLaterMessages(),s.isInitialMessagesLoaded=this._messageStreamStore.isInitialMessagesLoaded()&&t,Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext(`Initial messages loaded with unread marker: ${s.isInitialMessagesLoaded}`))}else s.isInitialMessagesLoaded=this._messageStreamStore.isInitialMessagesLoaded(),Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext(`Initial messages loaded: ${s.isInitialMessagesLoaded}`));return s.isInitialMessagesLoaded&&this._markStreamScenarioStepCompleted(L.StreamNavigationScenarioSteps.InitialMessagesLoaded),this._skypeMessages=i,x.default.getS4LMessagingFeaturesNoSubscription().enableAutoPlayVoiceMessagesInRow&&N.default.addConversation(e.conversationId,this._skypeMessages),Q.log(se.LogTraceArea.MessageStream,...this._withContext("Updated items from the store: "+e.conversationId+", isInitialMessagesLoaded: "+s.isInitialMessagesLoaded+", isLatestMessageTheEnd: "+s.isLatestMessageTheEnd+", skypeMessages.length: "+this._skypeMessages.length)),e.onSkypeMessagesUpdated&&e.onSkypeMessagesUpdated(i),this._viewItemsListDirty=!0,this._updateStreamIndexes(s),this._regenerateItemListIfDirty(e,s)}_isInitialMessagesLoaded(e){var t,s;return null!==(t=e.isInitialMessagesLoaded)&&void 0!==t?t:null===(s=this.state)||void 0===s?void 0:s.isInitialMessagesLoaded}_regenerateItemListIfDirty(e,t){var s,i;if(!this._viewItemsListDirty)return t;const o=this._skypeMessages.length,n=ve.isGroupConversation(e.conversationId),r=[];t.scrollToItemViewIndex=-1;let a=!1,l=!1;this._unreadMarkerViewIndex=-1;const d=this._unreadMarkerShown&&this._unreadMarkerMessageIndex>=0,c=void 0!==t.isLatestMessageTheEnd?t.isLatestMessageTheEnd:!(!this.state||!this.state.isLatestMessageTheEnd),u=void 0!==t.isEarliestMessageTheBeginning?t.isEarliestMessageTheBeginning:this.state&&this.state.isEarliestMessageTheBeginning,h=void 0!==t.cannotGetEarlierMessages?t.cannotGetEarlierMessages:this.state&&this.state.cannotGetEarlierMessages;this._isInitialMessagesLoaded(t)&&(e.isConversationAccepted&&!e.isContactInviteJustAccepted||!this._readOnlyConversation||e.showInviteHeaderForEncryptedThread||r.push(new ut(e.conversationId)));let p=!1,g=!1;const m=this._shouldDisplayContactInviteViewItemInfo(e,t);let S=m?0:-1,_=-1,f=!1;const C=void 0!==t.scrollRequest?t.scrollRequest:this.state&&this.state.scrollRequest;for(let s=0;s<o;s++){const i=this._skypeMessages[s],o=s>0?this._skypeMessages[s-1]:void 0;if(ye.shouldServerMessageBeFilteredOut(i,this._conversation))continue;if(d&&!a&&this._unreadMarkerMessageIndex<=s&&!v.default.isMyMri(i.creator)&&(this._unreadMarkerViewIndex=r.length,this._scrollToUnreadMarker&&t.scrollToItemViewIndex<0&&(Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Scroll to unread indicator:"+s)),t.scrollToItemViewIndex=r.length),r.push(new dt(He.ItemListKey.UnreadMarker,36,g)),a=!0),!ve.isBookmarkConversation(e.conversationId)){if(0===s&&(u||h||l||m)||o&&!q.default.isSameDay(i.createdTime,o.createdTime)){const e=q.default.getMidnight(i.createdTime);r.push(new at(He.ItemListKey.DateMarkerPrefix+e,e))}}n&&Ie.isAddCurrentUserThreadActivity(i)&&(m?S=r.length:(_=r.length,f=!0)),_>=0&&f&&(ye.isThreadActivityType(i.messagetype)?_++:f=!1);const c=C&&i.createdTime===C.messageTimestamp,y=(null==C?void 0:C.cuid)&&i.cuid===C.cuid,T=i.cuid===e.focusedMessageCuid,M=i.isAlbum()&&e.focusedMessageCuid&&re.default.albumContainsMessage(i.getAlbumId(),e.focusedMessageCuid);(this._scrollToMessage&&(c||y||M)||T)&&(C&&i.isAlbum()&&(C.messageTimestamp=i.createdTime),Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Scroll to message index:"+s)),t.scrollToItemViewIndex=r.length,t.shouldFocusScrolledMessageCell=!0,this._isFocusInsideMessageStreamOnMount=!0),r.push(new _e.MessageViewItemInfo(He.ItemListKey.MessagePrefix+i.cuid,i,p));const b=this._readReceiptsMarks[s];b&&r.push(new rt(b.key,b.readReceipts,this._getReadReceiptsSummary(s))),(p||g)&&(p=!1,g=!1,this._isFocusInsideMessageStreamOnMount=!0)}if((null===(s=this.state)||void 0===s?void 0:s.isShowOldFriendBackHintDivider)&&r.push(new ct(He.ItemListKey.OldFriendBack,36,g,e.conversationId)),!l&&S>=0){0!==S||ve.isEncryptedThread(e.conversationId)||(null===(i=this._conversation)||void 0===i?void 0:i.isSkypeSMSConversation())||(S=r.length);const s=!(e.isIncomingContactInvitePending||ve.isEncryptedThread(e.conversationId)||ve.isPhoneMri(e.conversationId)||o);Q.log(se.LogTraceArea.MessageStream,...this._withContext("Show wave:"+s+" isIncomingContactInvitePending:"+e.isIncomingContactInvitePending+" isEncryptedThread:"+ve.isEncryptedThread(e.conversationId)+" isPhoneMri:"+ve.isPhoneMri(e.conversationId)+" skypeMessagesLength: "+o));const n=[new ht(He.ItemListKey.ContactInviteHeaderItem,s?535:325,s,e.isContactInviteJustAccepted,e.isIncomingContactInvitePending,e.isEncryptedConversationEstablished,o>0)];r.splice(S,0,...n),this._scrollToMessage&&(t.scrollToItemViewIndex=S),l=!0}const{isJoinEnabled:T,isRegularMemberInModeratedGroup:M}=this.state||t;T?r.splice(-1===_?0:_,0,new mt(e.conversationId)):_>=0&&y.default.contacts().canInvitePeople&&!M&&((this.state?this.state.enableNewConversationCreation:t.enableNewConversationCreation)?r.splice(_,0,new gt(e.conversationId)):r.splice(_,0,new pt(e.conversationId))),this._shouldShowSpeechConsentItemInfo(this.state,t,r.length)&&r.push(new St(e.conversationId));const b=this._composingMris.filter((e=>!v.default.isMyMri(e)));e.disableComposingIndicator?!e.disableComposingIndicator&&b.length>0&&r.push(new lt(this._composingMris,e.conversationId)):r.push(new lt(b,e.conversationId));const I=this.props;if(this._contentRendered&&(0,pe.default)(I.isSelectMessagesModeActive,e.isSelectMessagesModeActive)?(this._disallowFetchingMoreMessagesFromStore=!0,this._applyModificationsDebounced(r,c,e,C&&C.messageTimestamp)):this._applyModifications(r,c,e,C&&C.messageTimestamp),this._viewItemsListDirty=!1,Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext(" Unread marker:unreadMarkerShown:"+this._unreadMarkerShown+";unreadMarkerTimestamp:"+this._unreadMarkerTimestamp+";unreadMarkerMessageIndex:"+this._unreadMarkerMessageIndex+";unreadMarkerViewIndex:"+this._unreadMarkerViewIndex)),this._scrollToMessage&&t.isInitialMessagesLoaded&&t.scrollToItemViewIndex<0){const t="Unable to find the scroll to message with cuid: "+e.focusedMessageCuid+". ScrollToTimestamp: "+(C&&C.messageTimestamp)+". Please let the dev team know.";Q.warn(se.LogTraceArea.MessageStream,t)}return t}_shouldShowSpeechConsentItemInfo(e,t,s){if(t.isChild)return!1;const i=void 0!==t&&void 0!==t.showSpeechConsentSuggestion?t.showSpeechConsentSuggestion:e.showSpeechConsentSuggestion;return i&&-1===this._speechConsentSuggestionSeenAt&&(this._speechConsentSuggestionSeenAt=s),i||(this._speechConsentSuggestionSeenAt=-1),i&&this._speechConsentSuggestionSeenAt===s}_shouldDisplayContactInviteViewItemInfo(e,t){const s=t.isUsingStackNavigationContext||void 0===t.isUsingStackNavigationContext&&this.state.isUsingStackNavigationContext,i=!this._readOnlyConversation&&(e.isIncomingContactInvitePending||!e.isConversationAccepted);return s&&(i||e.showInviteHeaderForEncryptedThread)||ve.isPhoneMri(this.props.conversationId)}_applyModifications(e,t,s=this.props,i){this._disallowFetchingMoreMessagesFromStore=!1;const o=this._dataItemsInfo.getItemList(),n=he.default.calculateModifications(o,e,!0,!0,this._equalsItemInfo,this._canSubstituteItemsInfo),r=he.default.convertToListModifications(n);s.isSelectMessagesModeActive&&this._updateSelectedMessages(r),this._dataItemsInfo.applyMany(r,(e=>this._regenerateMetadata(e,s,i)),((e,t)=>this._setOptions(e,t))),this._wasLatestMessageTheEndPreviously=t,this._shouldUpdateForTranslationChange=!1,this._shouldUpdateForHintChange=!1}_setOptions(e,t){const s=this._wasLatestMessageTheEndPreviously;e.type===he.ListModificationType.AddItems&&e.insertIndex===t.length&&(e.options={animateFromBottom:s})}_updateSelectedMessages(e){if(e.some((e=>e.type===he.ListModificationType.RemoveItems))){Ee.default.getSelectedMessages().forEach((e=>{!this._skypeMessages.some((t=>t.cuid===e.message.cuid))&&Ee.default.removeSelectedMessage(e)}))}}_regenerateMetadata(e,t,s){let i=0;const o=[];let n;e.forEach(((e,t)=>{e instanceof _e.MessageViewItemInfo&&(e.metadata=Object.assign(e.metadata||{},{streamItemIndex:i++,viewIndex:t}),o.push(e))})),(0,r.eachRight)(o,(e=>{const t=e.skypeMessage;return!(v.default.isMyMri(t.creator)&&!t.isMessageLie()&&ye.getMessageTypeGroup(t)===ye.MessageTypeGroups.Picture)||(n=t.cuid,!1)})),o.forEach(((i,r)=>{const a=r>0?o[r-1]:void 0,l=a?a.skypeMessage:void 0,d=r+1<o.length?o[r+1]:void 0,c=d?d.skypeMessage:void 0,u=i.skypeMessage,h=v.default.isMyMri(u.creator),p=l&&v.default.isMyMri(l.creator);let g=0;const m=r>0&&e[i.metadata.viewIndex-1]instanceof rt;let S=!(!a||m)&&i.metadata.viewIndex-a.metadata.viewIndex>1;const _=ye.isThreadActivityType(u.messagetype);l&&(g=l.createdTime,S=S||_||ye.getMessageTypeGroup(l)===ye.MessageTypeGroups.Calling||l.isEmote());const f=u.createdTime-g>=ot,y=c&&c.createdTime-u.createdTime>=ot,C=!l||S||f||(h?!p:l.creator!==u.creator),T=r===o.length-1||y||!c||c.creator!==u.creator;let M=C&&!h,b=M,I=M||C&&h||C&&T;C&&(_||u.isEmote())&&(M=!1,b=!1,I=!1);const w=this._highlightScrollToTarget&&(s===u.createdTime||t.focusedMessageCuid===u.cuid);w&&(this._highlightScrollToTarget=!1);const P=ye.getMessageTypeGroup(i.skypeMessage)===ye.MessageTypeGroups.Text,k=this.props;let A=!1;if(t.isSelectMessagesModeActive!==k.isSelectMessagesModeActive||this._firstUpdateCompleteForMutliSelect){const e=i.metadata.viewIndex>this._topWholeViewIndex-3&&i.metadata.viewIndex<this._bottomWholeViewIndex+3;A=t.isSelectMessagesModeActive?e||this._firstUpdateCompleteForMutliSelect:!e&&!this._firstUpdateCompleteForMutliSelect}const x={isFirstInGroup:C,isLastInGroup:T,showUserIcon:b,showUserName:M,showTimestamp:I,isHighlighted:w,isReadOnly:this._readOnlyConversation,hasUnderlay:t.hasUnderlay,isLastPhotoByCurrentUser:!!n&&u.cuid===n,canPretendBeingSent:P,showSelectMessageCheckbox:A};i.metadata.shouldUpdate=!(0,pe.default)(x,i.metadata.itemRenderInfo)||this._shouldUpdateForTranslationChange||this._shouldUpdateForHintChange,i.metadata.itemRenderInfo=x}))}_canSubstituteItemsInfo(e,t){return e.key===t.key}_convertViewIndexToMessage(e,t){const s=this._dataItemsInfo.getItemList();if(!(e<0))if(t)for(;e<s.length;){const t=s[e];if(t instanceof _e.MessageViewItemInfo)return t;e++}else for(;e>=0;){const t=s[e];if(t instanceof _e.MessageViewItemInfo)return t;e--}}_maybeTrackMessageSearchPerformance(e){const t=this.state.scrollRequest;if(void 0===t)return;if(e.filter((e=>e instanceof _e.MessageViewItemInfo)).map((e=>e.skypeMessage.createdTime)).includes(t.messageTimestamp)){const e=t.id;if(this.state.lastTrackedScrollRequestId===e)return;this.setState({lastTrackedScrollRequestId:e});const s=!!t.zeroTermSearch;(0,A.searchResultsRendered)(P.ScenarioSearchTypes.MessageInConversation,e,s,this.state.messageSearchLimit);const i={publicDirectory:!1,message:!1,indexedDb:!1,bots:!1,allPeople:!1,fastContacts:!1,messageInConversation:!0};(0,A.compositeScenarioResultsRendered)(e,P.CompositeSearchOrigin.SearchInConversationPanel,void 0,s,i)}}_focusMountedItemOnMobile(){this._mountedItemToFocus?this._mountedItemToFocus.focusItemForScreenReader():Q.warn(se.LogTraceArea.MessageStream,"Focus should be on message stream, but no item mounted")}_checkForConsumptionHorizonChange(){var e;if(Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("MessageStream convId="+Z.mriOrId(this.props.conversationId)+" _checkForConsumptionHorizonChange")),0===this._dataItemsInfo.getItemList().length)return void Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("MessageStream convId="+Z.mriOrId(this.props.conversationId)+" no messages displayed"));if(!this._isUserActive())return void Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("MessageStream convId="+Z.mriOrId(this.props.conversationId)+" user not active"));if(this._lockUpdatesToConsumptionHorizon)return void Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("MessageStream convId="+Z.mriOrId(this.props.conversationId)+" locked updates to CH"));let t;for(let e=this._bottomPartialViewIndex;e>=0;e--){const s=this._convertViewIndexToMessage(e,!1);if(!s)continue;if(t=s.skypeMessage,s.metadata.streamItemIndex<=this._currentConsumptionHorizonItemIndex)break;const i=s.skypeMessage.isAlbumItem()&&1===re.default.getNotFailedMediaMessagesForAlbum(s.skypeMessage.getAlbumId()).length;if(s.skypeMessage.countsForUnreadCounts()||i)break}const s=null===(e=this._conversation)||void 0===e?void 0:e.getConsumptionHorizonTimestamp();t?(Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("lastVisibleItem.createdTime:",t.createdTime,"chTimestamp:",s,"_lastVisibleItemForConsumptionHorizon.createdTime:",this._lastVisibleItemForConsumptionHorizon?this._lastVisibleItemForConsumptionHorizon.createdTime:"_lastVisibleItemForConsumptionHorizon is undefined")),t.createdTime>s&&(!this._lastVisibleItemForConsumptionHorizon||t.createdTime>this._lastVisibleItemForConsumptionHorizon.createdTime)&&(this._lastVisibleItemForConsumptionHorizon=t,Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("MessageStream - scheduling update of consumption horizon to: "+t.getConsumptionHorizonString()+" convId="+Z.mriOrId(this.props.conversationId)+" CHindex="+this._currentConsumptionHorizonItemIndex+" BottomWholeViewIndex="+this._bottomWholeViewIndex+" ConsumptionHorizonTimestamp="+s+" current lastVisibleItem.createdTime="+(this._lastVisibleItemForConsumptionHorizon?this._lastVisibleItemForConsumptionHorizon.createdTime:null)+" new lastVisibleItem.createdTime="+t.createdTime)),this._consumptionHorizonUpdateDebounceTimer&&me.default.clearTimeout(this._consumptionHorizonUpdateDebounceTimer),this._consumptionHorizonUpdateDebounceTimer=me.default.setTimeout(this._updateConsumptionHorizonToLastVisibleItem,this._messageReadDelay))):Q.log(se.LogTraceArea.ConsumptionHorizon,...this._withContext("lastVisibleItem is undefined"))}_renderOldConversationEmptyState(){return(0,n.jsx)(l.View,{style:_t.noMessagesContainer,children:(0,n.jsx)(Ke.default,{conversationId:this.props.conversationId,displayName:this.props.recipientDisplayName,gender:de.default.getFullUserProfileByMriNoSubscription(this.props.conversationId).gender,onGreet:this.props.onGreet,showBorder:!1,alwaysForceEmoticon:!0})})}_renderBookmarkConversationEmptyState(){return(0,n.jsx)(je.default,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext})}_renderMybotConversationEmptyState(){return(0,n.jsx)(We.default,{onInitialRenderComplete:this._onInitialRenderComplete})}_renderMybotFreHeader(){return(0,n.jsx)(Ge.default,{isNoMessage:!this._skypeMessages||0===this._skypeMessages.length})}render(){var e,t,s;let i,o=null,r=null;if(this.state.isInitialMessagesLoaded)if(this._conversation.isBookmarksThread()&&0===this._skypeMessages.length)o=this._renderBookmarkConversationEmptyState();else if(this._conversation.isMyBotThread()&&0===this._skypeMessages.length)o=this._renderMybotConversationEmptyState();else if(this.props.isConversationAccepted&&!this.props.isIncomingContactInvitePending&&!this._readOnlyConversation&&Me.default.haveAllMessagesForConversation(this.props.conversationId)&&0===this._skypeMessages.length)o=ve.isThread(this.props.conversationId)||ve.isConversationWithPhoneNumber(this.props.conversationId)?null:this._renderOldConversationEmptyState();else{if(!this._conversation.isBookmarksThread()){const e=(0,n.jsx)(qe.StatusPillView,{statusPillInstance:this._statusPillInstance,messageStreamStore:this._messageStreamStore,ref:this._statusPillRef,conversationId:this.props.conversationId,messageStreamFontSize:this.state.messageStreamFontSize});r=e,this._enableConversationSyncLie&&(this._statusPillInstance.setMessageStreamStore(this._messageStreamStore),r=(0,n.jsxs)(n.Fragment,{children:[e,(0,n.jsx)(Qe.UpdatePillView,{messageStreamFontSize:this.state.messageStreamFontSize,pillStoreInstace:this._statusPillInstance})]}))}const e=this.state.scrollToItemViewIndex>=0?this.state.scrollToItemViewIndex:void 0;this._contentRendered||this._markStreamScenarioStepCompleted(L.StreamNavigationScenarioSteps.StartVMVRendering,{start_vmv_rendering_viewItems:this._dataItemsInfo.getItemList().length,start_vmv_rendering_messages:this._skypeMessages.length}),this._contentRendered=!0,o=(0,n.jsx)(Ve.VirtualMessageView,{ref:this._onListViewRef,observableList:this._dataItemsInfo,renderItem:this._renderItem,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:Ue.messageStreamMaxContentWidth,onVisibleRangeChanged:this._onVisibleRangeChanged,initialScrollIndex:e,shouldFocusInitialItem:this.state.shouldFocusScrolledMessageCell&&!this.props.isMessageSearchPanelVisible||this._conversation.isBookmarksThread(),isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,allowKeyboardLayoutUpdates:this.props.isMessageSearchPanelVisible,onUserScroll:this._onScroll,onLayout:this.props.onMessageStreamLayout,onInitialRenderComplete:this._onInitialRenderComplete,keyboardShouldPersistTaps:!0,keyboardDismissMode:C.default.getPlatformType()===se.PlatformType.Android?"none":"on-drag",scrollsToTop:!this.state.isReactionDetailsOn,scrollEnabled:!this.state.isScrollDisabled,horizontalPadding:this.props.safeAreaHorizontalInsets,canShowSuggestions:!1,leftSpacerWidth:this.props.leftSpacerWidth,rightSpacerWidth:this.props.rightSpacerWidth,useWideLayout:!this.state.isUsingStackNavigationContext},this._virtualMessageViewRefCount),this.state.enableMultiMessageQuoteOnKeyboard&&(o=(0,n.jsx)(a.default,{ref:this._onCopyListenerRef,handler:this._onCopy,children:o}))}else o=(0,n.jsx)(l.View,{style:_t.spinnerContainer,children:(0,n.jsx)(f.default,{size:te.SXActivityIndicatorSize.Medium,tintColor:U.default.getPrimaryColorNoSubscription(),deferTimeMs:1e3})});const d=!(null===(e=this._conversation)||void 0===e?void 0:e.isSkypeSMSConversation())&&!(null===(t=this._conversation)||void 0===t?void 0:t.isEncryptedThread()),c=!this.props.hideSuggestions&&this.state.isLatestMessageTheEnd&&!!this.state.lastMessage&&d&&!(null===(s=this._conversation)||void 0===s?void 0:s.isBookmarksThread()),u=this.state.isUsingStackNavigationContext&&this.props.isMessageSearchPanelVisible;this.state.initialRenderCompleted&&c&&this.state.lastMessage&&(i=(0,n.jsx)(ie.default,{conversationId:this.props.conversationId,lastMessage:this.state.lastMessage,useCompactLayout:this.state.useCompactLayout,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,onCardSuggestionAction:this.props.onCardSuggestionAction,disableQuickReply:this.props.isSelectMessagesModeActive||u,onSuggestionClicked:this.props.onSuggestionClicked,onToggled:this.props.onSuggestionsToggled,isRenderedIn4ColumnWidth:this.props.isRenderedIn4ColumnWidth,leftSpacerWidth:this.props.leftSpacerWidth,rightSpacerWidth:this.props.rightSpacerWidth,getInputEntities:this.props.getInputEntities,onMessageSent:this.props.onMessageSent},"SwiftQuickReplyListView"),this.state.isUsingStackNavigationContext||(i=(0,n.jsxs)(l.View,{style:_t.actionsDesktopContainer,children:[(0,n.jsx)(l.View,{style:this._getSpacerStyle(this.props.leftSpacerWidth)}),i,(0,n.jsx)(l.View,{style:this._getSpacerStyle(this.props.rightSpacerWidth)})]})));const h=[_t.contentAreaContainer];let p;this.props.isSelectMessagesModeActive||(p=(0,n.jsx)(Xe.default,{ref:this._onJumpToEndButtonRef,onPressCallback:this._onJumpToEndButtonPress,conversationId:this.props.conversationId,horizontalPadding:this.props.safeAreaHorizontalInsets},"jumpToEndButton"),R.default.isIPad()&&h.push(_t.tabletMargin));const g=this.props.renderDivider?this.props.renderDivider():void 0,m=this.props.preventAccessibilityFocus?l.Types.ImportantForAccessibility.NoHideDescendants:void 0,S=(0,ke.shouldShowFreHeader)(this._conversation.isMyBotThread(),$.LocalStorage.getItemSync($.StorageKeys.FreBuildVersion))?this._renderMybotFreHeader():void 0;return(0,n.jsxs)(l.View,{style:_t.contentOuterContainer,importantForAccessibility:m,children:[(0,n.jsxs)(l.View,{style:h,children:[o,r,p,S]}),g,i]})}_getSpacerStyle(e){return ft[e]||(ft[e]=l.Styles.createViewStyle({flex:1,minWidth:e})),ft[e]}_onScrolledToTheBottom(e){this.props.onScrolledToTheBottom&&this.props.onScrolledToTheBottom(e)}_scrollToBottomOfRefreshedStream(){const e=this._refreshConversationProperties(this.props,this.state,!0,!0);this.setState(e)}_reportRenderItemQoS(e,t){const s=Le.default.getTelemetryScenarioForMessage(e.conversationId,e.cuid);if(!s)return;const i=s.getSecondaryScenario(k.ScenarioName.SendTextMessageTimeToAppearInChat);i&&(t?(i.markStepCompleted("AnimationCompleted"),i.finish()):i.isStepMarked("Render")||i.markStepCompleted("Render"));const o=e.isMessageLie();let n=s.getSecondaryScenario(k.ScenarioName.SendTextMessageUI);if(n||(n=s.getSecondaryScenario(k.ScenarioName.SendPictureUI)),!n||n.isResolved()||n.isInvalidated())return;const r="Visible"+(o?"Lie":"Real")+"ItemRender";if(o?n.isStepMarked(r)||n.markStepCompleted(r,void 0,void 0,!0):n.markPerfTargetStepCompleted(r),!o){n.finish();const t=e.getOriginalClientMessageId(),s=n.getTotalDuration();if(void 0!==s&&n.getScenarioName()===k.ScenarioName[k.ScenarioName.SendTextMessageUI]&&!this.state.enableMessageSendSuccessProcessing){const i=n.getIsInitialConnectivityGood()||!1,o=fe.getCorrelationIdFromMessageParts(ve.skypeIdToMri(v.default.getSkypeId()),e.conversationId,t);Q.track(new P.SendTextMessageUI(s,j.default.isUsingStackNavigationContext(),i,n.isInterrupted(),n.getTimePassedTillInterruption(),o,t))}}}_scrollToBottom(){this._listView&&this._listView.scrollToBottom(),this._lockUpdatesToConsumptionHorizon=!1}_markStreamScenarioStepCompleted(e,t){this._getContext().isPresentedInDesktopSubview||L.default.markScenarioStepCompleted(this.props.conversationId,e,t)}getSkypeMessages(){return this._skypeMessages}feedEphemeralMessage(e){this._messageStreamStore&&this._messageStreamStore.feedEphemeralMessage(e)}_checkMessageStreamStoreAndUpdate(e,t,s){this._messageStreamStore&&t&&this._messageStreamStore.isDestroyed()&&(this._updateMessageStreamStore(e,t.messageTimestamp,!1),Q.log(se.LogTraceArea.MessageStreamDebug,...this._withContext("Update MessageStreamStore object reason: "+s)))}_isUserActive(){return this._isUserPresentInApp||this._isUserScrolling}_maybeAnimateScrollToPosition(e,t){if(!(0,pe.default)(e,t)&&void 0!==t&&t.messageTimestamp){const e=this._dataItemsInfo.getItemList().findIndex((e=>e instanceof _e.MessageViewItemInfo&&e.skypeMessage.createdTime===t.messageTimestamp));if(e>-1&&this._listView){const t=this._dataItemsInfo.getItemList()[e].key;this._listView.scrollToPosition(e,t,!0)}}}_getItemHint(e){var t,s;if(e===(null===(t=this.state.messageHintsData)||void 0===t?void 0:t.hintMessageId)&&this._messageCuidToShowHint===(null===(s=this.state.messageHintsData)||void 0===s?void 0:s.hintMessageId))return xe.default.getMessageHintDataToDisplay()}_withContext(...e){return[...e,`Context: ${JSON.stringify({conversationId:Z.mriOrId(this.props.conversationId),messages:this._skypeMessages.length})}`]}}t.default=vt},852269:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(404547)),a=i.__importStar(s(44717)),l=i.__importDefault(s(541367)),d=s(154235),c=i.__importDefault(s(615364)),u=i.__importDefault(s(260928)),h=i.__importDefault(s(187250)),p=i.__importStar(s(170881)),g=i.__importDefault(s(601976)),m=s(815146),S=i.__importDefault(s(970035)),_=i.__importStar(s(85385)),f=s(26703),y=i.__importStar(s(704704)),v=s(954225),C=i.__importDefault(s(363091)),T=i.__importDefault(s(740794)),M=s(113002),b=i.__importDefault(s(960282)),I=s(240804),w=i.__importDefault(s(660401)),P=s(16549),k=s(641400),A=i.__importDefault(s(827361)),x=s(262725),D=i.__importDefault(s(497910)),R=i.__importStar(s(669327)),L=i.__importDefault(s(403396)),B=s(596648),F=i.__importDefault(s(760989)),N=(0,f.lazyProperties)({container:()=>n.Styles.createViewStyle({paddingTop:20,paddingBottom:60}),avatar:()=>n.Styles.createViewStyle({marginBottom:10}),headerStyles:()=>n.Styles.createTextStyle({marginBottom:10}),participantsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",marginBottom:20}),participantsIcon:()=>n.Styles.createViewStyle({marginRight:10}),actionsContainer:()=>n.Styles.createViewStyle({alignItems:"center",borderRadius:8,paddingTop:30,paddingBottom:15,paddingHorizontal:40,marginTop:75}),actionCaption:()=>n.Styles.createTextStyle({color:P.Color.gray400,marginBottom:20}),link:()=>n.Styles.createTextStyle({color:P.Color.blueDark,marginBottom:20}),linkButtonMinWidth:()=>n.Styles.createViewStyle({marginTop:10})});class E extends D.default{constructor(){super(...arguments),this._shareLinkToGroup=()=>{const e=F.default.newCauseId();_.log(m.LogTraceArea.MessageStream,"NewConversationLanding._shareLinkToGroup causeId: "+e),this._hasLink()&&this.state.inviteLink&&this.state.myDisplayName?(h.default.shareToClipboard(this.state.inviteLink),this.setState({isCopied:!0})):_.error(m.LogTraceArea.MessageStream,"NewConversationLanding._shareLinkToGroup inviteLink: "+!!this.state.inviteLink+" myDisplayName: "+!!this.state.myDisplayName)},this._onGroupSettingsPress=()=>{const e=F.default.newCauseId();_.log(m.LogTraceArea.MessageStream,"NewConversationLanding._onGroupSettingsPress causeId: "+e),p.dismissAll(),T.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onSharePress=()=>{const e=F.default.newCauseId();_.log(m.LogTraceArea.MessageStream,"NewConversationLanding._onSharePress causeId: "+e),p.dismissAll(),a.isThread(this.props.conversationId)&&(this.state.isJoinEnabled?this._shareLinkToGroup():(this.setState({isCreatingJoinLink:!0}),r.default.setJoinEnabled(this.props.conversationId,!this.state.isJoinEnabled)))},this._onAddPress=()=>{const e=F.default.newCauseId();_.log(m.LogTraceArea.MessageStream,"NewConversationLanding._onAddPress causeId: "+e),p.dismissAll(),R.contactAdded(this.props.conversationId);new u.default({convId:a.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:m.NavigationConversationOrigin.NewChat,peopleType:I.PeopleType.All,filterPeopleType:I.FilterType.GroupCapable,wizardSteps:[M.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}_buildState(e,t){const s=(0,c.default)().getConversation(e.conversationId),i=C.default.getSkypeMri();return{conversationName:g.default.getDisplayName(e.conversationId),myDisplayName:g.default.getDisplayName(i),isJoinEnabled:s&&s.isJoinEnabled(),inviteLink:s&&l.default.getLink(s.id),isCreatingJoinLink:!t&&this.state.isCreatingJoinLink,isMinWidth:b.default.isMobileScreenSize(this._getRootViewId())}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isCreatingJoinLink&&this._hasLink()&&t.isJoinEnabled!==this.state.isJoinEnabled&&(this._shareLinkToGroup(),this.setState({isCreatingJoinLink:!1}))}render(){const e=this.state.conversationName?(0,o.jsx)(x.Header,{size:d.HeaderSize.h5,style:N.headerStyles,children:this.state.conversationName}):void 0,t=this._useDarkTheme()?n.Styles.createViewStyle({borderColor:P.Color.gray400,borderWidth:1},!1):n.Styles.createViewStyle({backgroundColor:P.Color.gray50Overlay50},!1),s=y.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.props.memberCount}),i=this.state.isCopied?y.getString("InviteShare.ShareCopiedButtonLabel"):y.getString("MessageStream.NewConversationLandingShareGroupLink"),r=n.Styles.createViewStyle({alignSelf:"stretch",flexDirection:this.state.isMinWidth?"column":"row"},!1),a=this._hasLink()?(0,o.jsx)(x.BodyText,{style:[N.link,this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:void 0],selectable:!0,children:this.state.inviteLink}):void 0;return(0,o.jsxs)(n.View,{style:[N.container,A.default.alignItemsCenter],children:[(0,o.jsx)(L.default,{style:N.avatar,size:B.UserIconSize.Size100,userMri:this.props.conversationId}),e,(0,o.jsxs)(n.View,{style:N.participantsContainer,children:[(0,o.jsx)(S.default,{icon:k.SkypeIcon.ContactGroup,size:k.IconSize.size16,color:this._themeColors.primaryTextColor,style:N.participantsIcon}),(0,o.jsx)(x.Caption,{messageStreamFontSize:v.MessageStreamFontSize.Large,children:s})]}),(0,o.jsx)(w.default,{icon:k.SkypeIcon.Topic,iconPositon:d.SXButtonIconPosition.End,buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ThemeNoBackground,title:y.getString("MessageStream.NewConversationLandingGroupSettingsLink"),onPress:this._onGroupSettingsPress}),(0,o.jsxs)(n.View,{style:[N.actionsContainer,t],children:[a,(0,o.jsx)(x.BodyText,{style:N.actionCaption,textThemeColor:d.TextThemeColor.Primary,children:y.getString("MessageStream.NewConversationLandingActionsCaption")}),(0,o.jsxs)(n.View,{style:r,children:[(0,o.jsx)(w.default,{buttonSize:d.SXButtonSize.Medium,title:y.getString("MessageStream.NewConversationLandingAddPeopleButton"),onPress:this._onAddPress}),(0,o.jsx)(w.default,{style:this.state.isMinWidth?N.linkButtonMinWidth:void 0,buttonSize:d.SXButtonSize.Medium,buttonStyle:d.SXButtonStyle.ThemeNoBackground,title:i,onPress:this._onSharePress,disabled:this.state.isCreatingJoinLink})]})]})]})}_hasLink(){return this.state.isJoinEnabled&&this.state.inviteLink}}t.default=E},614905:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(537180),r=s(964414),a=s(641400),l=s(206315),d=i.__importDefault(s(970035)),c=i.__importStar(s(704704)),u=i.__importDefault(s(20758)),h=s(154235),p=()=>{const{themeColors:{iconSecondary:e}}=(0,l.useSkypeTheme)(),{errorStyle:t,errorIconContainer:s,errorTextStyle:i}=(0,r.useSkypeStyles)((({themeColors:{secondaryTextColor:e,surfacePrimary:t}})=>({errorStyle:{color:e,fontSize:u.default.fontSize.size17,lineHeight:22,fontWeight:h.FontWeight.semiBold,padding:15,backgroundColor:t},errorIconContainer:{alignItems:"center",justifyContent:"center",paddingBottom:30},errorTextStyle:{color:e,textAlign:"center"}})),[]);return(0,o.jsxs)(n.View,{style:t,children:[(0,o.jsx)(n.View,{style:s,children:(0,o.jsx)(d.default,{icon:a.SkypeIcon.EmoticonNotPresent,color:e,size:a.IconSize.size60})}),(0,o.jsx)(n.Text,{style:i,children:c.getString("MediaBar.EmoticonPickerErrorText")})]})};p.displayName="ErrorView",t.default=p},644995:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(537180),r=s(964414),a=i.__importDefault(s(799585)),l=s(206315),d=s(154235),c=()=>{const{themeColors:e}=(0,l.useSkypeTheme)(),{containerStyle:t}=(0,r.useSkypeStyles)((({themeColors:{surfacePrimary:e}})=>({containerStyle:{flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"flex-start",backgroundColor:e}})),[]);return(0,o.jsx)(n.View,{style:t,children:(0,o.jsx)(a.default,{size:d.SXActivityIndicatorSize.Medium,tintColor:e.iconSecondary})})};c.displayName="LoadingView",t.default=c},503028:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(537180),r=s(344175),a=s(964414),l=i.__importStar(s(704704)),d=()=>{const{errorContainer:e,errorTextStyle:t}=(0,a.useSkypeStyles)((({themeColors:{textSecondary:e}})=>({errorContainer:{alignSelf:"stretch",alignItems:"center",justifyContent:"center"},errorTextStyle:{color:e,textAlign:"center"}})),[]);return(0,o.jsx)(r.Column,{width:"100%",height:"100%",marginY:"size200",children:(0,o.jsx)(n.View,{style:e,children:(0,o.jsx)(n.Text,{style:t,children:l.getString("PesSearch.EmoticonPickerNoResultsSearchText")})})})};d.displayName="NoSearchResultView",t.default=d},718840:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(537180),n=s(964414),r=({title:e})=>{const{titleStyle:t}=(0,n.useSkypeStyles)((({themeColors:{textPrimary:e}})=>({titleStyle:{color:e,fontSize:17,lineHeight:22,fontWeight:"600",flex:1}})),[]);return(0,i.jsx)(o.Text,{style:t,numberOfLines:1,children:e})};r.displayName="PackHeaderTitle",t.default=r},377737:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(667294)),r=s(537180),a=s(344175),l=s(537180),d=i.__importStar(s(704704)),c=i.__importDefault(s(20758)),u=s(154235),h=s(964414),p=({onPressCustomize:e})=>{const{customButtonStyle:t,customButtonTextStyle:s}=(0,h.useSkypeStyles)((({themeColors:e})=>({customButtonStyle:{padding:0,margin:0,height:18},customButtonTextStyle:{color:e.textOnAccent,fontSize:c.default.fontSize.size14,lineHeight:18,fontWeight:u.FontWeight.regular,textAlign:"right"}})),[]);return(0,o.jsx)(r.Pressable,{onPress:e,children:(0,o.jsx)(a.Box,{style:t,children:(0,o.jsx)(l.Text,{style:s,numberOfLines:1,children:d.getString("DesktopRecentsFilter.Customize")})})})};p.displayName="CustomizeButton",t.default=n.memo(p)},374368:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Emoticon=t.getEmoticonSize=t.EMOTICON_SIZE=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(667294)),r=s(667294),a=s(344175),l=i.__importStar(s(548056)),d=s(82485),c=i.__importStar(s(815146)),u=i.__importStar(s(626065)),h=s(496033),p=s(186907),g=s(737032),m=i.__importDefault(s(543915)),S=i.__importStar(s(147193)),_=s(3216);t.EMOTICON_SIZE=p.EmoticonSize.Large;t.getEmoticonSize=()=>{const e=l.getFrameHeight(t.EMOTICON_SIZE)+0+2*_.PesItemBorder;return{width:e,height:e+16+S.SELECTION_DOT_SIZE+S.SELECTION_DOT_MARGIN}};t.Emoticon=({itemId:e,emoticonsCache:s,customEmoticonsSet:i,onSelected:p,onLongPress:_,didUserSelect:f=!1})=>{const y=s[e]||(0,g.getEmoticonById)(e),v=(0,r.useRef)(void 0),C=n.useCallback((e=>{var t;const s=null===(t=e.shortcuts)||void 0===t?void 0:t[0];if(s){const t=new u.EmoticonEntity(s,e.id,e.tone);p(t,l.mediaTypes.emoticon,e.id)}}),[p]),T=n.useCallback((()=>{m.default.measureLayoutRelativeToWindow((()=>v.current)).then((e=>{null==_||_(y,e,(0,g.existsInCustomSet)(y,i))})).catch((e=>{d.Instrumentation.error(c.LogTraceArea.Pes,`Emoticon measureLayoutRelativeToWindow failed: ${e}`)}))}),[_,y,i]);return y?(0,o.jsxs)(a.Box,{marginY:8,children:[(0,o.jsx)(h.EmoticonItem,{id:y.id,info:y,size:t.EMOTICON_SIZE,margin:0,isSelected:!1,emoticonGroupsEnabled:!1,renderWithToggleIcons:!1,existsInCustomSet:(0,g.existsInCustomSet)(y,i),hideDiverseIndicator:!1,onItemContextMenu:T,onItemLongPress:T,onSelected:C,renderMobileInterface:!0,ref:v}),(0,o.jsx)(S.default,{didUserSelect:f})]}):(d.Instrumentation.warn(c.LogTraceArea.Pes,`Emoticon with id ${e} not found`),null)},t.Emoticon.displayName="Emoticon",t.default=n.memo(t.Emoticon)},502171:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EmoticonPicker=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(667294)),r=s(667294),a=s(344175),l=s(737032),d=s(374368),c=s(82485),u=s(526849),h=i.__importStar(s(815146)),p=i.__importDefault(s(150343)),g=i.__importDefault(s(543915)),m=i.__importDefault(s(614905)),S=i.__importDefault(s(233277)),_=i.__importDefault(s(644995)),f=i.__importStar(s(169909)),y=i.__importDefault(s(87037)),v=i.__importDefault(s(897344)),C=i.__importDefault(s(92462));t.EmoticonPicker=({filter:e,onClose:t,emoticonTabs:s,customEmoticonsSet:i,funReactionsPack:n,onSelected:u,onScroll:p,loadingStatus:S,availableWidth:T,message:M,enableMoreReactionsMenuSelector:b})=>{const I=(0,r.useMemo)((()=>(0,l.getEmoticonItems)(s)),[s]),w=(0,r.useMemo)((()=>T-32),[T]),[P,k]=(0,r.useState)(void 0),A=(0,r.useRef)(null),x=(0,d.getEmoticonSize)(),D=Math.floor(w/(x.width+16)),R=(0,r.useCallback)((e=>{k(void 0),null==p||p(e)}),[p]),L=(0,r.useCallback)(((e,t,s)=>{g.default.measureLayoutRelativeToWindow((()=>A.current||void 0)).then((i=>{const o={x:t.x-i.x+t.width/2,y:t.y-i.y+t.height/3};isNaN(o.x)||isNaN(o.y)?c.Instrumentation.error(h.LogTraceArea.Pes,`EmoticonPicker layoutInfo object is invalid, layoutInfo.x: ${o.x}, layoutInfo.y: ${o.y}}`):k({emoticonInfo:e,layoutInfo:o,isCustomReaction:s})})).catch((e=>{c.Instrumentation.error(h.LogTraceArea.Pes,`EmoticonPicker measureLayoutRelativeToWindow failed: ${e}`)}))}),[]);return(0,o.jsxs)(a.Column,{width:"100%",flex:"1",marginY:"size120",position:"relative",alignItems:"center",justifyContent:"center",overflow:"visible",paddingX:16,ref:A,collapsable:!1,children:[S===f.PesConfigLoadingStatus.Loading&&(0,o.jsx)(_.default,{}),S===f.PesConfigLoadingStatus.Error&&(0,o.jsx)(m.default,{}),S===f.PesConfigLoadingStatus.Completed&&""===e?(0,o.jsx)(C.default,{emoticonsCache:I,onSelected:u,onScroll:R,onItemLongPress:L,numberOfColumns:D,onClose:t,emoticonTabs:s,customEmoticonsSet:i,funReactionsPack:n,enableMoreReactionsMenuSelector:b,message:M}):(0,o.jsx)(y.default,{filter:e,emoticonsCache:I,onSelected:u,onScroll:R,onItemLongPress:L,numberOfColumns:D}),(0,o.jsx)(v.default,{onSelected:u,emoticonMetadata:P})]})},t.EmoticonPicker.displayName="EmoticonPicker";const T=n.memo(t.EmoticonPicker);t.default=(0,u.WithResub)(T,(e=>Object.assign(Object.assign({},e),{loadingStatus:f.default.getLoadingStatus(),customEmoticonsSet:(0,S.default)().getCustomReactions(),emoticonTabs:f.default.getEmoticonTabsArray(),funReactionsPack:p.default.getS4LMessagingFeatures().funReactionsPack,enableMoreReactionsMenuSelector:p.default.getS4LMessagingFeatures().enableMoreReactionsMenuSelector})))},92462:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({emoticonTabs:e,emoticonsCache:t,customEmoticonsSet:s,funReactionsPack:i,message:r,numberOfColumns:I,onClose:w,onItemLongPress:P,onSelected:k,onScroll:A,enableMoreReactionsMenuSelector:x}){const{rootViewId:D}=(0,g.useCommonContext)(),R=_.default.getSkypeMri(),L=null==r?void 0:r.getReactions().reduce(((e,t)=>(t.users.some((e=>e.mri===R))&&e.push(t.key),e)),[]),B=(0,n.useRef)(null),F=(0,n.useRef)(null),N=(0,n.useCallback)((()=>{(0,p.openCustomReactionPanel)(c.CustomReactionsType.Message,D),null==w||w()}),[w,D]),E=(0,n.useMemo)((()=>(0,u.getPackDataFromTabs)(e)),[e]),O=(0,n.useMemo)((()=>{const e=(e,t,s)=>[{id:e,type:v.EmoticonTitle,title:t},...(0,l.chunk)(s,I).map(((t,s)=>({id:`${e}_${s}`,type:v.Emoticons,data:t})))],o=(0,l.flatten)(Object.entries(E).map((([s,i])=>[...e(s,i.title,i.items.filter((e=>t[e])))])));return[...e("customEmoticonsPack","Your reactions",s),...e("funEmoticonsPack","Fun reactions",i),...o]}),[t,s,i,I,E]),U=(0,n.useCallback)((({item:e})=>e.type===v.EmoticonTitle?(0,o.jsxs)(a.Row,{justifyItems:"space-between",alignItems:"center",minHeight:T,children:[(0,o.jsx)(S.default,{title:e.title}),"customEmoticonsPack"===e.id&&(0,o.jsx)(m.default,{onPressCustomize:N})]}):(0,o.jsx)(a.Row,{justifyContent:"flex-start",minHeight:C.height,children:e.data.map((e=>(0,o.jsx)(a.Box,{flex:1/I,children:(0,o.jsx)(h.default,{itemId:e,didUserSelect:null==L?void 0:L.includes(e),onSelected:k,emoticonsCache:t,onLongPress:P})})))})),[N,I,L,k,t,P]),V=(0,n.useCallback)((e=>{var t;const s=O.findIndex((t=>{var s;return t.id===(null===(s=e.packs[0])||void 0===s?void 0:s.id)}));null===(t=B.current)||void 0===t||t.scrollToIndex({index:s,animated:!1})}),[O]),H=(0,n.useCallback)((t=>{var s,i;if(!F.current)return;const o=null!==(i=null===(s=t.viewableItems[1])||void 0===s?void 0:s.index)&&void 0!==i?i:0,n=M(O,o);if(!n)return;const r=Object.values(e).findIndex((e=>e.packs.some((e=>e.id===n.id))));r<0||F.current.onPageSelected({position:r})}),[O,e]),j=(0,n.useCallback)(((e,t)=>{switch(t.type){case v.EmoticonTitle:e.size=T;break;case v.Emoticons:e.size=C.height}}),[]),{mode:z}=(0,f.useSkypeTheme)();return(0,o.jsxs)(a.Column,{width:"100%",height:"100%",children:[x&&(0,o.jsx)(y.default,{ref:F,style:b,tabs:e,onTabSelected:V,transparentTheme:!1,darkTheme:z.isDark,renderMobileInterface:!0,hideSearchDelete:!0}),(0,o.jsx)(d.FlashList,{ref:B,data:O,onScroll:A,onViewableItemsChanged:H,overrideItemLayout:j,getItemType:e=>e.type,estimatedItemSize:(T+C.height)/2,renderItem:U})]})};const i=s(197582),o=s(785893),n=s(667294),r=i.__importStar(s(516778)),a=s(344175),l=s(496486),d=s(569116),c=s(729827),u=s(737032),h=i.__importStar(s(374368)),p=s(10966),g=s(736267),m=i.__importDefault(s(377737)),S=i.__importDefault(s(718840)),_=i.__importDefault(s(363091)),f=s(206315),y=i.__importDefault(s(603812));var v;!function(e){e[e.EmoticonTitle=0]="EmoticonTitle",e[e.Emoticons=1]="Emoticons"}(v||(v={}));const C=(0,h.getEmoticonSize)(),T=30,M=(e,t)=>{for(let s=t;s>=0;s--)if(e[s].type===v.EmoticonTitle)return e[s];return null};const b=r.Styles.createViewStyle({borderTopWidth:0,paddingBottom:12,paddingHorizontal:0})},390276:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(667294)),r=s(667294),a=s(344175),l=i.__importStar(s(704704)),d=s(885838),c=({onSearch:e})=>{const[t,s]=(0,r.useState)(""),i=(0,r.useCallback)((t=>{s(t),e(t)}),[e]),n=(0,r.useCallback)((()=>{s(""),e("")}),[e]),c=l.getString("SearchInputControl.PlaceHolderTextShort");return(0,o.jsx)(a.Box,{height:52,paddingX:"size120",paddingY:"size40",children:(0,o.jsx)(d.SearchInput,{query:t,isClearVisible:t.length>0,onQueryChange:i,onClear:n,onEscape:n,placeholder:c,accessibilityLabel:c,isLoading:!1})})};c.displayName="EmoticonPickerSearch",t.default=n.memo(c)},121770:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSearchResult=function(e,t,s,i){const o=i?r(s):void 0;o&&e.push(o);const l=n.searchInPackTitleAndItemKeyword(e,t).filter((e=>e.packs&&e.packs.length>0)),d=a(l);return(d?[d]:l)||e},t.getGroupedEmoticonTab=r,t.mergePacksInSingleTab=a,t.getRecommendedEmoticonTab=function(e){return{id:"recommended emoticons tab",packs:[{id:"favorites emoticons pack",items:e,title:"Your reactions",customizeButton:!0},{id:"fun emoticons pack",items:e,title:"Fun reactions"}],iconUrlOrAssetID:0,tabType:o.TabType.Emoticon}};const i=s(197582),o=i.__importStar(s(548056)),n=i.__importStar(s(314980));function r(e){if(0!==e.length)return{id:"grouped emoticons tab",packs:[{id:"grouped emoticons pack",items:e,title:""}],iconUrlOrAssetID:0,tabType:o.TabType.Emoticon}}function a(e){let t;if(e.length>0){t=e[0];const s=[];e.forEach((e=>{s.push(...e.packs)}));t=Object.assign(Object.assign({},t),{packs:s})}return t}},737032:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEmoticonById=l,t.getEmoticonItems=function(e){const t={};return e.forEach((e=>{e.packs.forEach((e=>{e.items.forEach((e=>{const s=l(e);s&&!1!==s.visible?t[e]=s:!1===(null==s?void 0:s.visible)&&r.Instrumentation.log(a.LogTraceArea.Pes,`The item ${e} is not visible`)}))}))})),t},t.existsInCustomSet=function(e,t){if(!t||0===t.length)return!1;const s=n.updateReactionNameWithTone(e.id,null==e?void 0:e.tone);return t.includes(s)},t.getPackDataFromTabs=function(e){const t={};return e.forEach((e=>{e.packs.forEach((e=>{t[e.id]=e}))})),t},t.getPacksForPesListView=function(e,t){const s={};return e.forEach((e=>(s[e.id]=e.items.filter((e=>!!t[e])),s))),s};const i=s(197582),o=i.__importDefault(s(794229)),n=i.__importStar(s(920710)),r=s(82485),a=i.__importStar(s(815146));function l(e){const t=n.separateReactionNameAndTone(e),s=o.default.getEmoticonByNameNoSubscription(t.reactionNameWithoutTone);return s&&n.isTonedReaction(e)?Object.assign(Object.assign({},s),{tone:t.reactionTone}):s}},87037:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SearchResults=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(667294)),r=s(667294),a=s(344175),l=s(496486),d=s(569116),c=s(526849),u=i.__importDefault(s(503028)),h=i.__importDefault(s(655192)),p=s(121770),g=i.__importDefault(s(169909)),m=i.__importDefault(s(794229)),S=i.__importStar(s(374368)),_=i.__importDefault(s(644995));t.SearchResults=({filter:e,allEmoticonTabs:t,groupedEmoticons:s,emoticonsCache:i,onSelected:n,onItemLongPress:c,onScroll:g,numberOfColumns:m})=>{const[f,y]=(0,r.useState)([]),[v,C]=(0,r.useState)(!0),T=(0,r.useCallback)((({item:e})=>(0,o.jsx)(a.Row,{justifyContent:"flex-start",children:e.map((e=>(0,o.jsx)(a.Box,{flex:1/m,children:(0,o.jsx)(S.default,{itemId:e,onSelected:n,onLongPress:c,emoticonsCache:i})})))})),[m,n,c,i]);return(0,r.useEffect)((()=>{C(!0),setTimeout((()=>{const o=h.default.deburrLowerCase(e.trim()),[n]=(0,p.getSearchResult)(t,o,s,!0),r=n?Array.from(n.packs.reduce(((e,t)=>(t.items.forEach((t=>{i[t]&&e.add(t)})),e)),new Set)):[];y((0,l.chunk)(r,m)),C(!1)}),1)}),[t,i,e,s,m]),v?(0,o.jsx)(_.default,{}):0===f.length?(0,o.jsx)(u.default,{}):(0,o.jsx)(a.Column,{width:"100%",height:"100%",marginY:"size200",children:(0,o.jsx)(d.FlashList,{data:f,renderItem:T,ListEmptyComponent:(0,o.jsx)(u.default,{}),onScroll:g,keyboardShouldPersistTaps:"handled",estimatedItemSize:(0,S.getEmoticonSize)().height})})},t.SearchResults.displayName="SearchResults",t.default=(0,c.WithResub)(n.memo(t.SearchResults),(e=>Object.assign(Object.assign({},e),{allEmoticonTabs:g.default.getEmoticonTabsArray(),groupedEmoticons:m.default.getGroupedEmoticons()})))},467866:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(496486),r=s(667294),a=s(169012),l=i.__importDefault(s(502171)),d=i.__importDefault(s(390276)),c=({message:e,onClose:t,availableWidth:s,onSelected:i})=>{const[c,u]=(0,r.useState)(""),h=(0,r.useRef)((0,n.debounce)(u,800)),p=(0,r.useCallback)((e=>{h.current.cancel(),h.current=(0,n.debounce)(u,Math.max(800-100*e.length,300)),h.current(e)}),[]),g=(0,r.useCallback)(((s,o,n)=>{null==i||i(s,o,n),e&&(0,a.onClick)(n,e),null==t||t()}),[i,e,t]),m=(0,r.useCallback)((()=>{h.current.cancel(),u(""),null==t||t()}),[t]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(d.default,{onSearch:p}),s>0&&(0,o.jsx)(l.default,{onSelected:g,filter:c,onClose:m,message:e,availableWidth:s})]})};c.displayName="SearchableEmoticonPicker",t.default=(0,r.memo)(c)},897344:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({onSelected:e,emoticonMetadata:t}){const s=(0,n.useRef)(null),[i,g]=(0,n.useState)(1/0),m=(0,n.useCallback)((s=>{var i;s.group&&s.group.length>0?a.default.setLastUsedEmoticonGroupItem(s.group[0],s.id):t&&!t.isCustomReaction&&a.default.setLastUsedTone(s.id,s.tone);const o=null===(i=s.shortcuts)||void 0===i?void 0:i[0];if(o){const t=new l.EmoticonEntity(o,s.id,s.tone),i=h.updateReactionNameWithTone(s.id,s.tone);e(t,d.mediaTypes.emoticon,i)}}),[t,e]);(0,n.useEffect)((()=>{var e,o;if(void 0===t)return void(null===(e=s.current)||void 0===e||e.hide());const n={item:t.emoticonInfo,itemSize:u.EMOTICON_SIZE,onItemSelected:m,x:t.layoutInfo.x,y:t.layoutInfo.y,leftBoundary:0,rightBoundary:i,onItemHover:()=>{},onHide:()=>{},triggeredBy:c.PesPickerTriggeredBy.LongPress};null===(o=s.current)||void 0===o||o.show(n)}),[t,m,i]);const S=(0,n.useCallback)((e=>{var t;g(null===(t=e.nativeEvent)||void 0===t?void 0:t.layout.width)}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.Box,{onLayout:S,position:"absolute",left:0,top:0,right:0,height:0}),(0,o.jsx)(p.PesPickerPopup,{renderMobileInterface:!1,ref:s})]})};const i=s(197582),o=s(785893),n=s(667294),r=s(344175),a=i.__importDefault(s(794229)),l=i.__importStar(s(626065)),d=i.__importStar(s(548056)),c=s(548056),u=s(374368),h=i.__importStar(s(920710)),p=s(211625)},10966:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openCustomReactionPanel=f;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(970035)),a=i.__importStar(s(85385)),l=s(26703),d=i.__importDefault(s(252089)),c=i.__importDefault(s(740794)),u=i.__importStar(s(920710)),h=s(73018),p=s(16549),g=s(641400),m=i.__importDefault(s(497910)),S=(0,l.lazyProperties)({customReactionButton:()=>n.Styles.createViewStyle({padding:5,borderRadius:15})});class _ extends m.default{constructor(){super(...arguments),this._onPress=()=>{var e,t;f(this.props.origin,this._getRootViewId(),this.props.isInNarrowView),null===(t=(e=this.props).optionalReactionBarClose)||void 0===t||t.call(e)}}render(){var e;const t=n.Styles.createButtonStyle({backgroundColor:this._useAccessibleTheme()?p.Color.white:d.default.getPrimaryColorNoSubscription()},!1);return(0,o.jsx)(n.Button,{style:[S.customReactionButton,t,this.props.styles],onPress:this._onPress,title:u.getCustomReactionsStore(this.props.origin).getCustomReactionsModalTitle(),children:(0,o.jsx)(r.default,{size:null!==(e=this.props.iconSize)&&void 0!==e?e:g.IconSize.size20,color:this._useAccessibleTheme()?p.Color.gray300:p.Color.white,icon:g.SkypeIcon.Topic})})}}function f(e,t,s){c.default.navigateToCustomReactionsPanel(e,t);const i=s?h.CustomReactionsManipulationAction.CustomReactionsPanelInNarrowViewOpened:h.CustomReactionsManipulationAction.CustomReactionsPanelOpened;a.track(new h.CustomReactionsManipulationTelemetry(i,{customReactionsType:e}))}t.default=_},76596:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=s(568139),d=s(815146),c=i.__importStar(s(85385)),u=s(26703),h=i.__importStar(s(704704)),p=i.__importStar(s(920710)),g=i.__importDefault(s(960282)),m=i.__importDefault(s(602466)),S=i.__importDefault(s(20758)),_=s(641400),f=s(262725),y=i.__importDefault(s(497910)),v=i.__importDefault(s(266872)),C=i.__importStar(s(972830)),T=s(211625),M=i.__importDefault(s(436245)),b=(0,u.lazyProperties)({customReactionContainer:()=>r.Styles.createViewStyle({flex:1,borderBottomWidth:1}),customReactionsPickerMobile:()=>r.Styles.createViewStyle({paddingTop:4,paddingHorizontal:4,height:212}),customReactionsPickerMobileLandscape:()=>r.Styles.createViewStyle({height:118}),emptyState:()=>(0,u.lazyProperties)({sectionTitleText:()=>r.Styles.createViewStyle({marginTop:0,marginBottom:4,marginRight:4,marginLeft:12,paddingTop:4}),sectionTitleTextDestop:()=>r.Styles.createTextStyle({paddingTop:14,marginLeft:16}),sectionContent:()=>r.Styles.createTextStyle({textAlign:"center",marginTop:50})}),horizontalSpaces:()=>r.Styles.createViewStyle({paddingHorizontal:5}),searchResultTitle:()=>r.Styles.createTextStyle({marginTop:14,marginBottom:4,marginRight:4,marginLeft:16}),pesPickerSearchContainer:()=>r.Styles.createViewStyle({flexShrink:1,height:30,borderRadius:5,margin:10})});class I extends y.default{constructor(){super(...arguments),this._searchData={toggledFromSearchCount:0,searchAttemptsCount:0},this._getPesPickerPopupRef=()=>this._getPesPickerPopup,this._onPesPickerPopupRef=e=>{this._getPesPickerPopup=e||void 0},this._getContainerControlRef=()=>this._getContainerControl,this._onContainerControlRef=e=>{this._getContainerControl=e||void 0},this._onRemoveReaction=(e,t,s)=>{var i;const o=null===(i=e.decode())||void 0===i?void 0:i.encodedAttr(),r=p.updateReactionNameWithTone(s,null==o?void 0:o.tone);this._reactionsStore.removeReactions([r]),c.log(d.LogTraceArea.CustomReactionRemovedFromSet,"Reaction from Custom Reactions set is removed, custom reactions left ",n.size(this.state.selectedReactions))},this._onToggleReaction=(e,t,s)=>{var i;const o=null===(i=e.decode())||void 0===i?void 0:i.encodedAttr(),a=p.updateReactionNameWithTone(s,null==o?void 0:o.tone);this._reactionsStore.isLocalReaction(a)?this._reactionsStore.removeReactions([a]):this._reactionsStore.addReactions([a]),c.log(d.LogTraceArea.CustomReactionsToggleFromModal,"Toggle reactions from Custom Reactions modal, number of currently selected reactions ",n.size(this.state.selectedReactions)),this.state.searchQuery&&this.props.updateTelemetryData({toggledEmoticonCount:++this._searchData.toggledFromSearchCount,searchInitiatedCount:this._searchData.searchAttemptsCount}),this.state.selectedReactions.length>this.state.maxSelectedReactions&&r.Accessibility.announceForAccessibility(h.getString("ReactionsPanel.ExceededCustomReactionsLimit",{name:s}))},this._onSearchQueryChange=e=>{if(!this.isComponentMounted())return;const t=e.trim();t!==this.state.searchQuery&&(this.setState({searchQuery:t}),this.state.searchQuery&&this.props.updateTelemetryData({toggledEmoticonCount:this._searchData.toggledFromSearchCount,searchInitiatedCount:++this._searchData.searchAttemptsCount}))},this._onSearchQueryChangeDebounced=n.debounce(this._onSearchQueryChange,a.default.getS4LSearchFeatures().searchHeaderDebounceWait)}_buildState(e,t){return this._reactionsStore=this._getReactionsStore(e.origin),{selectedReactions:this._reactionsStore.getCurrentReactions(),maxSelectedReactions:this._reactionsStore.getCustomReactionsCount()}}_getReactionsStore(e){return p.getCustomReactionsStore(e)}render(){g.default.getWidthNoSubscription(this._getRootViewId()),g.default.getHeightNoSubscription(this._getRootViewId());let e=[];e=[r.Styles.createViewStyle({height:this._getPickerHeight()})];const t=(0,o.jsx)(m.default,{inputText:this.state.searchQuery,style:[b.pesPickerSearchContainer,this._themeStyles.searchBorderModernizeColorStyle],searchInputControlStyle:b.horizontalSpaces,placeholderText:h.getString("SearchInputControl.PlaceHolderTextShort"),accessibilityLabel:h.getString("SearchInputControl.PlaceHolderTextShort"),clearSearchIconSize:_.IconSize.size14,clearSearchIconColor:this._themeColors.primaryIconColor,inputStyle:[b.horizontalSpaces,S.default.fontStyle.caption],showSearchIcon:!0,hideBackground:!0,doNotAutoFocusOnMount:!0,onInputTextChange:this._onSearchQueryChangeDebounced}),s=(0,o.jsx)(r.View,{style:e,children:this._hasSelectedReactions()?this._renderCustomReactionsPicker():this._renderPlaceholder()}),i=!!this.state.searchQuery&&(0,o.jsx)(r.Text,{style:[S.default.fontStyle.caption,b.searchResultTitle,this._themeStyles.pesPickerCategoryColorStyle],children:h.getString("SearchInputControl.SearchResults")}),n=(0,o.jsx)(M.default,{isCustomReactions:!1,doNotRenderPreview:!0,doNotRenderTabIndicator:!1,parentRef:this._getContainerControlRef,pesPickerPopupRef:this._getPesPickerPopupRef,onPesSelected:this._onToggleReaction,ref:void 0,renderMobileInterface:!1,filter:this.state.searchQuery,searchMode:!!this.state.searchQuery,showingInNarrowView:!0,overrideUseSmallEmoticonSizeMobile:!0,darkTheme:this._isDarkTheme(),renderWithToggleIcons:!0,selectedEmoticons:this.state.selectedReactions,hideDiverseIndicator:!1,hideSearchDelete:!0,initialTabId:this._reactionsStore.getInitialTabId()});return(0,o.jsxs)(r.View,{style:[b.customReactionContainer,this._themeStyles.headerShadowBorderColorStyle],ref:this._onContainerControlRef,children:[t,s,i,n,(0,o.jsx)(T.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1})]})}_getPickerHeight(){let e;return e=this.state.maxSelectedReactions<12?82:this.state.maxSelectedReactions<24?121:168,e}_renderPlaceholder(){const e=[S.default.fontStyle.caption,b.emptyState.sectionTitleText];return e.push(b.emptyState.sectionTitleTextDestop),(0,o.jsxs)(r.View,{children:[(0,o.jsx)(r.Text,{style:e,children:this._getEmptyStateTitle()}),(0,o.jsx)(f.BodyText,{style:b.emptyState.sectionContent,textThemeColor:f.TextThemeColor.Secondary,children:h.getString("ReactionsPanel.NoReactionsSelectedMessage")})]})}_getEmptyStateTitle(){return h.getString("ReactionsPanel.ReactionsSelectedCounter",{count:0,maximum:this.state.maxSelectedReactions})}_renderCustomReactionsPicker(){return(0,o.jsx)(l.CustomReactionsPicker,{isCustomReactions:!0,doNotRenderPreview:!0,doNotRenderTabIndicator:!0,pesPickerPopupRef:this._getPesPickerPopupRef,renderMobileInterface:!1,ref:void 0,onPesSelected:this._onRemoveReaction,searchMode:!1,showingInNarrowView:!0,overrideUseSmallEmoticonSizeMobile:!0,darkTheme:this._isDarkTheme(),renderWithToggleIcons:!0,selectedEmoticons:this.state.selectedReactions,hideDiverseIndicator:!0,autoFocusFirstItem:!0,customReactionOrigin:this.props.origin})}_hasSelectedReactions(){var e;return!!(null===(e=this.state.selectedReactions)||void 0===e?void 0:e.length)}_isDarkTheme(){return C.isDarkTheme(v.default.colorThemeNoSubscription())}}t.default=I},568139:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsPicker=void 0;const i=s(197582),o=i.__importStar(s(704704)),n=i.__importStar(s(548056)),r=i.__importStar(s(920710)),a=s(641400),l=i.__importDefault(s(436245));class d extends l.default{_buildState(e,t){this.selectedReactions=r.getCustomReactionsStore(e.customReactionOrigin).getCurrentReactions(),this.selectedReactionsCount=this.selectedReactions.length,this.maxNumberOfCustomReactions=r.getCustomReactionsStore(e.customReactionOrigin).getCustomReactionsCount();const s=super._buildState(Object.assign({},e),t);return Object.assign({},s)}_getTabs(e,t){return[{id:"customReactions",packs:[{id:"custom",items:this.selectedReactions,title:this._getTitle()}],tabType:0,iconUrlOrAssetID:""}]}_getInitialPagedTabIndex(){return 0}_getTitle(){return o.getString("ReactionsPanel.ReactionsSelectedCounter",{count:this.selectedReactionsCount,maximum:this.maxNumberOfCustomReactions})}_getErrorSymbol(){return a.SkypeIcon.Blank}_supportsRenderTabsWithoutPaging(){return!1}_getPackAccessibilityLabel(e){return o.getString("PesPicker.CustomReactionsPackHeaderAccessibilityLabel",{count:this.selectedReactionsCount,maximum:this.maxNumberOfCustomReactions})}_getNumberOfItemsPerLine(){const e=n.frameHeights.emoticons.Size40+6;return this.state.availableWidth?Math.floor(this.state.availableWidth/e):void 0}}t.CustomReactionsPicker=d},138145:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=i.__importDefault(s(467866)),l=["100%"],d=({message:e,onClose:t,isOpen:s})=>{const[i,d]=(0,r.useState)(0),c=(0,r.useCallback)((e=>{const{width:t}=e.nativeEvent.layout;t!==i&&d(t)}),[i]),u=(0,r.useRef)(null);return(0,r.useEffect)((()=>{var e,t;s?null===(e=u.current)||void 0===e||e.present():null===(t=u.current)||void 0===t||t.dismiss()}),[s]),(0,o.jsx)(n.BottomSheet,{onDismiss:t,ref:u,snapPoints:l,enableContentPanningGesture:!1,children:(0,o.jsx)(n.Box,{width:"100%",height:"100%",onLayout:c,children:(0,o.jsx)(a.default,{onClose:t,message:e,availableWidth:i})})})};d.displayName="MoreReactionsBottomSheet",t.default=(0,r.memo)(d)},723259:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=s(537180),a=s(344175),l=s(641400),d=s(206315),c=i.__importDefault(s(970035)),u=s(82485),h=s(73018);t.default=(0,n.memo)((({onMoreButtonPressed:e,telemetry:t})=>{const s=(0,a.useSUIThemeStyles)((e=>({button:{backgroundColor:e.colors.surfaceSecondary,width:32,height:32,alignItems:"center",justifyContent:"center",borderRadius:16,marginLeft:6}})),[]),i=(0,d.useSkypeTheme)();return(0,o.jsx)(r.Pressable,{style:s.button,onPress:()=>{t.recordUserAction(h.ReactionNavigationAction.MoreReactionButtonPress),u.Instrumentation.track(t),e()},children:(0,o.jsx)(c.default,{color:i.themeColors.textPrimary,size:l.IconSize.size20,icon:l.SkypeIcon.Plus})})}))},634247:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(854646),a=s(667294),l=s(26703),d=s(206315),c=s(938827),u=(0,l.lazyProperties)({gradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:36,bottom:0,width:14,height:48,overflow:"visible"})});t.default=(0,a.memo)((()=>{const{mode:{isDark:e},themeColors:{surfacePrimary:t}}=(0,d.useSkypeTheme)();return(0,o.jsx)(r.GradientView,{style:u.gradient,direction:r.GradientDirection.RIGHT,colors:[e?c.SkypeColor.black0p:c.SkypeColor.white0p,t]})}))},56729:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=s(537180),l=s(526849),d=i.__importStar(s(920710)),c=i.__importStar(s(623627)),u=i.__importDefault(s(363091)),h=i.__importDefault(s(233277)),p=s(510590),g=i.__importDefault(s(794229)),m=i.__importStar(s(704704)),S=i.__importStar(s(85385)),_=s(815146),f=(i.__importDefault(s(207864)),s(73018)),y=i.__importDefault(s(791384)),v=i.__importDefault(s(723259)),C=i.__importDefault(s(147193)),T=i.__importDefault(s(634247)),M=c.Size.Medium,b=a.StyleSheet.create({viewContainer:{alignItems:"center",justifyContent:"center",overflow:"visible"},emoticonContainer:{flex:1,alignItems:"stretch",overflow:"visible"}}),I=e=>{var t;const s=g.default.getEmoticonByNameNoSubscription(e);return null!==(t=null==s?void 0:s.description)&&void 0!==t?t:e};t.default=(0,l.WithResub)((({allUserReactions:e,message:t,myMri:s,openReactionMenuTelemetry:i,onMoreButtonPressed:l,onReactionPressed:u})=>{const g=t.getReactions(),[f,w]=(0,r.useState)(g.filter((e=>e.users.some((e=>e.mri===s)))).reduce(((e,t)=>(e.set(t.key,t),e)),new Map)),P=(0,r.useCallback)(((e,t)=>{const s=I(t);e?(f.delete(t),w(new Map(f)),y.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouRemovedReaction",{reactionName:s}))):y.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouRemovedReactionError",{reactionName:s}))}),[f]),k=(0,r.useCallback)(((e,t)=>{const i=I(t);e?(f.set(t,{key:t,users:[{mri:s,time:Date.now()}]}),w(new Map(f)),y.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouReacted",{reactionName:i}))):y.default.maybeAnnounceForAccessibility(m.getString("ReactionsMenu.YouReactedError",{reactionName:i}))}),[f,s]),A=(0,r.useCallback)(((e,s)=>{S.log(_.LogTraceArea.ReactionsActionSheet,"_onClick - selectedReaction",s);const o=((e,t)=>{const s=d.separateReactionNameAndTone(e);return{message:t,reactionAction:{reaction:s.reactionNameWithoutTone,reactionLevel:40,reactionAdded:!1,isCustomReaction:(0,h.default)().isCustomReaction(e),reactionTone:s.reactionTone}}})(s,t);f.has(s)?d.removeReaction(s,o,i,P):d.addReaction(s,o,i,k),u()}),[t,k,P,u,i,f]),[x,D]=(0,r.useState)(),R=(0,r.useCallback)(((e,t)=>{D(t)}),[]),L=(0,r.useCallback)((e=>{D(void 0)}),[]);return(0,o.jsxs)(n.Row,{width:"full",marginY:10,style:b.viewContainer,children:[(0,o.jsx)(a.ScrollView,{horizontal:!0,showsHorizontalScrollIndicator:!1,children:(0,o.jsx)(n.Row,{style:b.emoticonContainer,children:(e=>e.map((e=>{const t=d.separateReactionNameAndTone(e),s=f.has(e),i=x&&x===e?p.ReactionButtonSelectionState.Selected:p.ReactionButtonSelectionState.NotSelected,n=i===p.ReactionButtonSelectionState.Selected,r=I(t.reactionNameWithoutTone);let l=r;return s&&(l+=", "+m.getString("Global.SelectedAccessibilityLabel")),(0,o.jsxs)(a.View,{children:[(u=e,!!u&&(0,o.jsx)(p.ReactionButton,{title:r,animateEmoticon:n||s,size:c.Size.Large,renderSize:M,reactionName:t.reactionNameWithoutTone,onPress:A,onHoverStart:R,onHoverEnd:L,selectionState:i,accessibilityLabel:l,tone:t.reactionTone})),(0,o.jsx)(C.default,{didUserSelect:s})]},"reactionButton"+r);var u})))(e)})}),(0,o.jsx)(T.default,{}),(0,o.jsx)(v.default,{onMoreButtonPressed:l,telemetry:i})]})}),(e=>{const t=(0,h.default)().getCustomReactions();return Object.assign(Object.assign({},e),{allUserReactions:t,myMri:u.default.getSkypeMri(),openReactionMenuTelemetry:new f.ReactionPickerTelemetry(e.message,f.ReactionOriginType.MessageContextMenu,t.length)})}))},510590:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionButton=t.ReactionButtonSelectionState=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(859745)),r=i.__importStar(s(516778)),a=s(217041),l=s(623627),d=s(26703),c=i.__importStar(s(920710)),u=i.__importDefault(s(827361));var h;!function(e){e[e.NotSelected=0]="NotSelected",e[e.Selected=1]="Selected"}(h||(t.ReactionButtonSelectionState=h={}));const p=(0,d.lazyProperties)({button:()=>r.Styles.createButtonStyle({flex:1,alignSelf:"stretch"}),emoticonStyle:()=>r.Styles.createViewStyle({marginHorizontal:8,marginBottom:2,marginTop:6},!1)});class g extends a.ComponentBase{constructor(){super(...arguments),this._buttonScaleValue=new r.Animated.Value(1),this._buttonScaleAndTranslateStyle=r.Styles.createAnimatedViewStyle({transform:[{scale:this._buttonScaleValue}]}),this._onPress=e=>{e.stopPropagation(),this.props.onPress(e,c.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onLongPress=e=>{e.stopPropagation(),this.props.onLongPress&&this.props.onLongPress(e,c.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onHoverStart=e=>{this.props.onHoverStart&&this.props.onHoverStart(e,c.updateReactionNameWithTone(this.props.reactionName,this.props.tone))},this._onHoverEnd=e=>{this.props.onHoverEnd&&this.props.onHoverEnd(e,c.updateReactionNameWithTone(this.props.reactionName,this.props.tone))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.selectionState!==e.selectionState&&this._startAnimation(this.props.selectionState===h.Selected?1.35:1)}componentWillUnmount(){super.componentWillUnmount(),this._cancelAnimations()}render(){return(0,o.jsx)(r.View,{style:[u.default.overflowVisible,p.emoticonStyle],children:(0,o.jsxs)(r.Animated.View,{style:[u.default.overflowVisible,this._buttonScaleAndTranslateStyle],children:[(0,o.jsx)(l.AnimatedEmoticon,{size:this.props.size,renderSize:this.props.renderSize,innerText:this.props.title,emoticonName:this.props.reactionName,showPlaceHolder:!0,isStatic:!this.props.animateEmoticon,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants,zoomHint:this.state.zoomHint,preventSelectable:!0,tone:this.props.tone}),(0,o.jsx)(r.View,{style:u.default.absoluteFill,children:(0,o.jsx)(r.Button,{style:p.button,title:this.props.title,accessibilityLabel:this.props.accessibilityLabel,accessibilityTraits:this.props.accessibilityTraits,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onPress:this._onPress,onLongPress:this.props.onLongPress?this._onLongPress:void 0,tabIndex:0,disableTouchOpacityAnimation:!0})})]})})}_cancelAnimations(){this._pendingAnimation&&this._pendingAnimation.stop()}_startAnimation(e,t){this._cancelAnimations(),this.setState({zoomHint:e}),this._pendingAnimation=r.Animated.parallel([r.Animated.timing(this._buttonScaleValue,{toValue:e,duration:n.Common.Duration.Short,easing:n.Easing.SkypeExpoInOut5,useNativeDriver:!0})]),this._pendingAnimation.start((()=>{this._pendingAnimation=void 0,this.isComponentMounted()&&t&&t()}))}animatePress(e){const t=()=>{e&&e()};this.isComponentMounted()?this._startAnimation(1.35,(()=>{this.isComponentMounted()?this._startAnimation(1,(()=>{t()})):t()})):t()}}t.ReactionButton=g},602363:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionCountButton=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(623627),a=i.__importStar(s(172134)),l=i.__importDefault(s(543915)),d=i.__importStar(s(433614)),c=i.__importDefault(s(794229)),u=s(815146),h=i.__importDefault(s(446802)),p=i.__importStar(s(85385)),g=s(26703),m=i.__importStar(s(704704)),S=i.__importDefault(s(484700)),_=s(536748),f=i.__importDefault(s(363091)),y=i.__importStar(s(548056)),v=s(590599),C=i.__importStar(s(73018)),T=i.__importStar(s(920710)),M=s(96575),b=s(16549),I=i.__importDefault(s(535775)),w=s(262725),P=i.__importDefault(s(601274)),k=i.__importDefault(s(760989)),A=s(73018),x=i.__importDefault(s(791384)),D=i.__importDefault(s(497910)),R=i.__importDefault(s(612285)),L=i.__importDefault(s(341994)),B=(0,g.lazyProperties)({countContainerView:()=>n.Styles.createButtonStyle({flexDirection:"row",alignItems:"center",justifyContent:"center"}),desktopTransform:()=>n.Styles.createViewStyle({transform:[{rotateZ:"0"}]}),countContainerOuterView:()=>n.Styles.createButtonStyle({backgroundColor:b.Color.white}),countContainer:()=>n.Styles.createButtonStyle({padding:5}),countText:()=>n.Styles.createTextStyle({color:b.Color.gray300,alignSelf:"center",marginLeft:6})});class F extends D.default{constructor(){super(...arguments),this._onLayout=e=>{this._height=e.height},this._onIconButtonRef=e=>{this._iconButton=e||void 0},this._onHoverStart=e=>{if(!this.props.isNewsChannel&&!n.UserInterface.isNavigatingWithKeyboard()){const e=k.default.newCauseId();p.log(u.LogTraceArea.ReactionsCountButton,"_onHoverStart, causeId: "+e),this._popupDismissTimeout&&P.default.clearTimeout(this._popupDismissTimeout),this._hoverTimeout&&P.default.clearTimeout(this._hoverTimeout),this._hoverTimeout=P.default.setTimeout((()=>{this.state.isHovering&&(this._onHandleShowPopup(e),this._hoverTimeout=void 0)}),200)}this.state.isHovering||this.setState({isHovering:!0})},this._onHoverEnd=e=>{this._popupDismissTimeout&&P.default.clearTimeout(this._popupDismissTimeout),this._popupDismissTimeout=P.default.setTimeout((()=>{this.state.isPopupHovered?this._popupDismissTimeout=void 0:this._closePopup()}),150)},this._closePopup=()=>{this._reactionsSummaryPopup&&!this.props.isNewsChannel&&(this._reactionsSummaryPopup.dismissPopup(),this._reactionsSummaryPopup=void 0),this._hoverTimeout&&(P.default.clearTimeout(this._hoverTimeout),this._hoverTimeout=void 0),this.state.isHovering?this.setState({isHovering:!1,isPopupHovered:!1}):this.setState({isPopupHovered:!1})},this._onKeyPress=e=>l.default.maybeHandleKeyPress(e,(()=>{this._onPress(e)})),this._onPress=(e,t=!1)=>{const s=k.default.newCauseId();if(p.log(u.LogTraceArea.ReactionsCountButton,"_onPress, causeId: "+s),this.state.isMyMessage||this.state.isKeyboardNav&&!t)this.state.popupOn||this._onHandleShowPopup(s),this._reactionsSummaryPopup=void 0;else{const e=new A.ReactionPickerTelemetry(this.props.message,A.ReactionOriginType.ReactionsSummary),t={message:this.props.message,reactionAction:{reaction:this.state.reactionNameWithoutTone,reactionTone:this.state.reactionTone,reactionLevel:0,reactionAdded:!this.state.currentUserReacted,isCustomReaction:!1}};T.addRemoveReactionFromMessage(t,e,(e=>{if(L.default.doesMessageHaveHint(this.props.message.cuid)){S.default.hintShownAndUsed();const e=h.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,L.default.setMessagesHintData(_.MessageHintsTypes.TapOnReactionToReactTheSame,e)}this._onAddingReactionDone(e,this.state.reactionEmoticonName,this.state.currentUserReacted)})),this._closePopup()}e.stopPropagation()},this._onPressFromSummaryPopup=e=>{this._onPress(e,!0),this._iconButton&&this._iconButton.requestFocus()},this._onClosePopup=()=>{this.isComponentMounted()&&(this._iconButton&&this._iconButton.requestFocus&&this._iconButton.requestFocus(),this.setState({popupOn:!1}),this.props.onClose&&this.props.onClose())},this._onPopupMouseEnter=()=>{this.setState({isPopupHovered:!0})},this._onPopupMouseLeave=()=>{this._closePopup()}}_buildState(e,t){const s=c.default.getEmoticonByName(e.reaction.key),{reactionTone:i,reactionNameWithoutTone:o}=T.separateReactionNameAndTone(e.reaction.key),n={reactionEmoticonName:s&&s.description||e.reaction.key,isPopupHovered:!1,reactionTone:i,reactionNameWithoutTone:o,currentUserReacted:e.reaction.users.some((e=>f.default.isMyMri(e.mri))),reactionSummaryBorderColor:this._themeColors.surfacePrimaryAccent,isMyMessage:f.default.isMyMri(e.message.creator),isKeyboardNav:R.default.isNavigatingWithKeyboard()};return t&&(n.popupOn=!1,n.isHovering=!1),n.accessibilityLabel=d.getAccessibilityLabelForReaction(e.message.conversationId,e.reaction),n}render(){const e=[B.countContainer,B.countContainerView,B.countContainerOuterView,this.props.style],t=y.getFrameHeight(this.props.reactionSize||r.Size.Small)+10,s=n.Styles.createViewStyle({height:t,borderRadius:t/2},!1);e.push(s);let i,a,l=this.props.isNewsChannel?void 0:m.getString("ReactionsDetailsOverlayPanel.ReactionButtonTitle",{reactionName:this.state.reactionEmoticonName});this.state.isMyMessage||(l=this.state.currentUserReacted?m.getString("ReactionsDetailsOverlayPanel.ReactionSummaryButtonTitleRemove",{reactionName:this.state.reactionEmoticonName}):this.props.isNewsChannel?void 0:m.getString("ReactionsDetailsOverlayPanel.ReactionSummaryButtonTitleAdd",{reactionName:this.state.reactionEmoticonName})),this.props.reaction.users.length>99?i=m.getString("ReactionsDetailsOverlayPanel.ReactionCountOverflow",{countText:99}):(this.props.reaction.users.length>1||!this.props.suppressSingleCounts)&&(i=this.props.reaction.users.length.toString()),i&&(a=(0,o.jsx)(w.Caption,{selected:this.state.currentUserReacted,style:[B.countText,this.props.textStyle],children:i}));let d=B.countContainerView;if(d=[d,B.desktopTransform],i&&this.state.currentUserReacted){const t=n.Styles.createViewStyle({borderColor:this.state.reactionSummaryBorderColor,borderWidth:2},!1);e.push(t)}return!this.state.isHovering||this.state.currentUserReacted||this.state.isMyMessage||e.push(n.Styles.createViewStyle({shadowRadius:1,shadowColor:b.Color.gray500},!1)),(0,o.jsx)(n.Button,{ref:this._onIconButtonRef,style:e,title:l,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,onPress:this._onPress,onKeyPress:this._onKeyPress,onLongPress:this._onHoverStart,activeOpacity:.8,accessibilityLabel:this.state.accessibilityLabel,disabled:this.props.disableAction,disabledOpacity:1,children:(0,o.jsxs)(n.View,{style:d,onLayout:this._onLayout,children:[(0,o.jsx)(r.AnimatedEmoticon,{size:this.props.reactionSize||r.Size.Small,innerText:l,emoticonName:this.state.reactionNameWithoutTone,isStatic:!(this.state.isHovering&&!this.state.popupOn),allowTextFallback:!0,standaloneAnimation:!0,preventSelectable:!0,tone:this.state.reactionTone}),a]})})}_onAddingReactionDone(e,t,s){let i="ReactionsMenu.YouReactedError";i=e?s?"ReactionsMenu.YouReacted":"ReactionsMenu.YouRemovedReaction":s?"ReactionsMenu.YouReactedError":"ReactionsMenu.YouRemovedReactionError",x.default.maybeAnnounceForAccessibility(m.getString(i,{reaction:t}))}_onHandleShowPopup(e){if(p.log(u.LogTraceArea.ReactionsCountButton,"_onHandleShowPopup, causeId: "+e),!this.state.popupOn){this.setState({popupOn:!0});this._showReactionSummaryPopup(e)&&(p.track(new C.ReactionsSummaryClickTelemetry(this.state.reactionEmoticonName,this.props.message,this.props.reaction.users.length)),this._markReactionsRead(this.props.message),this.props.onOpen&&this.props.onOpen())}}_showReactionSummaryPopup(e){p.log(u.LogTraceArea.ReactionsCountButton,"_showReactionSummaryPopup, causeId: "+e);const t=this.state.popupOn?void 0:new I.default(M.ScenarioName.ReactionsSummary);return t&&t.start(),this._reactionsSummaryPopup=new v.ReactionsSummaryPopup(this.props.message.conversationId,t,this.props.reaction,(()=>this._iconButton),this._getRootViewId(),this._getRootViewType(),this._onClosePopup,this._height,this.props.anchorPositionAnywhere,this.state.currentUserReacted,!this.state.isMyMessage,this._onPopupMouseEnter,this._onPopupMouseLeave,this._onPressFromSummaryPopup),this._reactionsSummaryPopup.show()}_markReactionsRead(e){!e.isReactionRead()&&this.state.isMyMessage&&a.markReactionsAsRead(e)}}t.ReactionCountButton=F},730529:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(217041),l=s(26703),d=s(602363),c=i.__importDefault(s(827361)),u=i.__importDefault(s(341994)),h=(0,l.lazyProperties)({listContainer:()=>r.Styles.createViewStyle({flexDirection:"row",marginLeft:-5}),listContainerNoMargin:()=>r.Styles.createViewStyle({marginLeft:0}),countContainerSpacing:()=>r.Styles.createViewStyle({marginLeft:5,marginBottom:2}),reactionContainerSpacing:()=>r.Styles.createViewStyle({marginLeft:5,marginRight:0,marginBottom:2})});class p extends a.ComponentBase{_buildState(e,t){const s={};t&&(s.postedByCurrentUser=!1);const i=this.props;return e.message?!t&&i.message&&e.message.properties===i.message.properties||(s.reactions=e.message.getReactions()):s.reactions=void 0,s}componentDidUpdate(e,t,s){var i;super.componentDidUpdate(e,t,s),t.reactions&&t.reactions.length>0&&!this.state.reactions&&(null===(i=e.message)||void 0===i?void 0:i.cuid)&&u.default.doesMessageHaveHint(e.message.cuid)&&u.default.invalidateHintMessage(e.message.cuid)}render(){if(!this.state.reactions||0===this.state.reactions.length||!this.props.message)return null;const e=[h.listContainer,this.props.style,this.props.isNewsChannel?h.listContainerNoMargin:void 0],t=this.props.message,s=n.map(this.state.reactions,(e=>{const s=[];return this.props.showShadows&&s.push(c.default.shadowLightStyle),this.props.itemStyle&&s.push(this.props.itemStyle),this.props.countItemSpacing?s.push(this.props.countItemSpacing):s.push(this.props.isNewsChannel?h.reactionContainerSpacing:h.countContainerSpacing),(0,o.jsx)(d.ReactionCountButton,{style:s,message:t,reaction:e,reactionSize:this.props.reactionSize,textStyle:this.props.itemTextStyle,onOpen:this.props.onOpen,onClose:this.props.onClose,anchorPositionAnywhere:this.props.anchorPositionAnywhere,disableAction:this.props.disableAction,suppressSingleCounts:this.props.suppressSingleCounts,isNewsChannel:this.props.isNewsChannel},e.key)}));let i;if(n.isNumber(this.props.constrainedWidth)){i=r.Styles.createViewStyle({maxWidth:this.props.constrainedWidth},!1);const t=r.Styles.createViewStyle({minWidth:this.props.constrainedWidth-5,maxWidth:this.props.constrainedWidth-5},!1);e.push(t)}return(0,o.jsx)(r.View,{style:[i,...e],children:s})}}t.default=p},975970:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(631681)),a=i.__importDefault(s(543915)),l=i.__importDefault(s(958868)),d=s(815146),c=i.__importDefault(s(453761)),u=i.__importStar(s(85385)),h=s(26703),p=i.__importStar(s(704704)),g=i.__importDefault(s(453353)),m=i.__importDefault(s(551356)),S=s(158437),_=s(96575),f=i.__importDefault(s(791384)),y=s(16549),v=s(641400),C=i.__importDefault(s(535775)),T=i.__importStar(s(669327)),M=(0,h.lazyProperties)({reactionButton:()=>n.Styles.createViewStyle({paddingVertical:5,paddingHorizontal:5,width:30,alignItems:"center",justifyContent:"flex-start"})});class b extends l.default{constructor(){super(...arguments),this._onIconButtonRef=e=>{this._iconButton=e||void 0},this._onReactKeyPress=e=>a.default.maybeHandleKeyPress(e,(()=>{this._onReactClick(e)})),this._onReactClick=e=>{const t=()=>this._iconButton,s=this.props.message();let i;if(f.default.isMobileScreenReaderEnabled()){const e=new C.default(_.ScenarioName.ShowReactionsMenu);e.start(),u.log(d.LogTraceArea.ReactionIconButton,"_onReactClick - showing accessability menu.");new m.default(s).showReactionActionSheet(t,this._getRootViewId()),i=!0,e.finish()}else{const e=this.state.popupOn?void 0:new C.default(_.ScenarioName.ShowReactionsMenu);e&&e.start(),u.log(d.LogTraceArea.ReactionIconButton,"_onReactClick - showing normal menu.");i=new S.ReactionsMenuPopup(s,e,t,this._getRootViewId(),this._getRootViewType(),this._onClosePopup,this.props.onReactionSelected,this.props.keepOpenAfterReactionSelected,this.props.hideAlternateReactionPacks,this.props.anchorOffset).show()}i&&(this.setState({popupOn:!0}),this.props.onOpen&&this.props.onOpen()),this._trackSearchSuccessTelemetry(),e.stopPropagation()},this._onClosePopup=()=>{u.log(d.LogTraceArea.ReactionIconButton,"_onClosePopup"),this.isComponentMounted()&&(this.setState({popupOn:!1}),this._iconButton&&this._iconButton.requestFocus&&this._iconButton.requestFocus(),this.props.onClose&&this.props.onClose())}}_buildState(e,t){const s={isConnected:g.default.isConnected()};return t&&(s.popupOn=!1),s}render(){const e=this.props.colorOverride||y.Color.gray300,t=this.props.sizeOverride||v.IconSize.size20,s=!this.state.isConnected||!this.props.isMessageKnownByServer;s&&(this.state.isConnected?this.props.isMessageKnownByServer?u.log(d.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to other reasons."):u.log(d.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to version unknown by server."):u.log(d.LogTraceArea.ReactionIconButton,"ReactionButton disabled due to unavailable network."));const i=[M.reactionButton,this.props.style],n={ref:this._onIconButtonRef,style:i,title:p.getString("StreamItem.ReactButtonTitle"),key:"reactionsIcon",onPress:this.props.disableAction?void 0:this._onReactClick,onKeyPress:this.props.disableAction?void 0:this._onReactKeyPress,size:t,color:e,hoverColor:e,icon:this.props.isNewsChannel?v.SkypeIcon.ReactionAdd:v.SkypeIcon.EmoticonStroke,disabled:s,tabIndex:0,showHoverEffect:!0,importantForAccessibility:this.props.importantForAccessibility};return this.props.coachMarkType?(0,o.jsx)(r.default.IconButton,Object.assign({},n,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:p.getString("StreamItem.ReactButtonTitle")})):(0,o.jsx)(c.default,Object.assign({},n))}_trackSearchSuccessTelemetry(){T.messageActionDone(this.props.message().conversationId)}}t.default=b},147193:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SELECTION_DOT_MARGIN=t.SELECTION_DOT_SIZE=void 0;const i=s(785893),o=s(537180),n=s(667294),r=s(964414);t.SELECTION_DOT_SIZE=4,t.SELECTION_DOT_MARGIN=4;t.default=(0,n.memo)((({didUserSelect:e})=>{const{emoticonStyle:s}=(0,r.useSkypeStyles)((({themeColors:{iconDisabled:s}})=>({emoticonStyle:{alignSelf:"center",width:t.SELECTION_DOT_SIZE,height:t.SELECTION_DOT_SIZE,marginTop:t.SELECTION_DOT_MARGIN,backgroundColor:e?s:void 0,borderRadius:t.SELECTION_DOT_SIZE/2,overflow:"hidden"}})),[e]);return(0,i.jsx)(o.View,{style:s})}))},551356:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=i.__importDefault(s(794229)),a=s(815146),l=i.__importStar(s(85385)),d=i.__importStar(s(704704)),c=i.__importDefault(s(363091)),u=i.__importStar(s(920710)),h=i.__importDefault(s(233277)),p=s(73018),g=i.__importDefault(s(791384)),m=i.__importStar(s(888500)),S="more",_="previous";t.default=class{constructor(e){if(this._currentUserReactions=[],this._onActionButtonPress=(e,t,s)=>{const i=()=>{const t=e();t&&t.requestFocus&&t.requestFocus()};switch(s){case S:this._currentPackIndex++,this._showActionMenu(e,t);break;case _:this._currentPackIndex--,this._showActionMenu(e,t);break;case m.SXActionMenuCancel:case"cancel":l.track(this._reactionMenu),i();break;default:this._addOrRemoveReaction(s),i()}},this._message=e,this._reactionPack=n.default.getS4LMessagingFeatures().reactionPacks,o.isEmpty(this._reactionPack))return void l.warn(a.LogTraceArea.ReactionsActionSheet,"ReactionPack is empty");const t=c.default.getSkypeMri();this._currentUserReactions=o.filter(e.getReactions(),(e=>o.some(e.users,(e=>e.mri===t)))),this._currentPackIndex=0}showReactionActionSheet(e,t){this._showActionMenu(e,t),this._reactionMenu=new p.ReactionPickerTelemetry(this._message,p.ReactionOriginType.ReactionsActionSheet)}_showActionMenu(e,t){const s=[];o.each(this._reactionPack[this._currentPackIndex],(e=>{s.push({text:this._getEmoticonName(e),command:e})})),0!==this._currentPackIndex&&s.push({text:d.getString("Global.PreviousButtonTitle"),command:_}),this._currentPackIndex!==this._reactionPack.length-1&&s.push({text:d.getString("Global.MoreButtonTitle"),command:S}),m.default.showWithActionMenuConfig({options:{anchor:e,buttons:s},callback:s=>this._onActionButtonPress(e,t,s),rootViewId:t,invokingEvent:void 0})}_getEmoticonName(e){const t=r.default.getEmoticonByNameNoSubscription(e);return t&&t.description||e}_addOrRemoveReaction(e){const t={message:this._message,reactionAction:{reaction:e,reactionLevel:this._currentPackIndex,reactionAdded:!1,isCustomReaction:(0,h.default)().isCustomReaction(e)}},s=this._getEmoticonName(e);o.some(this._currentUserReactions,(t=>t.key===e))?(l.log(a.LogTraceArea.ReactionsActionSheet,"Removing the selected reaction",e),u.addRemoveReactionFromMessage(t,this._reactionMenu,(e=>{const t=e?"ReactionsMenu.YouRemovedReaction":"ReactionsMenu.YouRemovedReactionError";g.default.maybeAnnounceForAccessibility(d.getString(t,{reactionName:s}))}))):(l.log(a.LogTraceArea.ReactionsActionSheet,"Adding the selected reaction",e),t.reactionAction.reactionAdded=!0,u.addRemoveReactionFromMessage(t,this._reactionMenu,(e=>{const t=e?"ReactionsMenu.YouReacted":"ReactionsMenu.YouReactedError";g.default.maybeAnnounceForAccessibility(d.getString(t,{reactionName:s}))})))}}},158437:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsMenuPopup=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(704704)),a=s(595692),l=i.__importDefault(s(60599)),d=i.__importDefault(s(139221));class c extends l.default{constructor(e,t,s,i,o,n,r,a,l,d=0){super(s,(()=>{n&&n(),this._hidden=!0}),i,o),this._message=e,this._scenario=t,this._onReactionSelected=r,this._keepOpenAfterReactionSelected=a,this._hideAlternateReactionPacks=l,this._anchorOffsetOverride=d,this._hidden=!1,this._instanceId=c._instanceCounter++}_overrideAnchorOffset(e){return e+(this._anchorOffsetOverride||0)*(d.default.isRTL()?-1:1)}_getPopupId(){return c.popupId}_getAccessibilityTitle(){return r.getString("AccessibilityLabel.Reactions")}_getContainerStyle(){return n.Styles.createViewStyle({marginRight:4},!1)}_getPopupWidth(e){return e-4}_getPopupContent(e,t,s,i){return(0,o.jsx)(a.ReactionsPopupMenu,{message:this._message,scenario:this._scenario,onClose:this.dismissPopup,keepOpenAfterReactionSelected:this._keepOpenAfterReactionSelected,hideAlternateReactionPacks:this._hideAlternateReactionPacks,onReactionSelected:this._onReactionSelected,hidden:this._hidden,instanceId:this._instanceId,rootViewId:this._rootViewId})}}t.ReactionsMenuPopup=c,c._instanceCounter=0,c.popupId="reactionsMenuPopup"},595692:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsPopupMenu=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(331654),a=i.__importStar(s(516778)),l=i.__importDefault(s(815063)),d=i.__importStar(s(623627)),c=i.__importDefault(s(54720)),u=i.__importDefault(s(10966)),h=s(729827),p=i.__importDefault(s(794229)),g=s(815146),m=(i.__importDefault(s(207864)),i.__importDefault(s(446802))),S=i.__importDefault(s(453761)),_=i.__importStar(s(85385)),f=i.__importDefault(s(114818)),y=i.__importDefault(s(97595)),v=s(26703),C=i.__importStar(s(704704)),T=i.__importDefault(s(484700)),M=s(536748),b=i.__importDefault(s(924849)),I=i.__importDefault(s(363091)),w=i.__importDefault(s(159001)),P=s(510590),k=i.__importStar(s(920710)),A=i.__importDefault(s(233277)),x=s(73018),D=i.__importDefault(s(960282)),R=i.__importDefault(s(117475)),L=i.__importDefault(s(791384)),B=s(16549),F=s(641400),N=i.__importDefault(s(827361)),E=i.__importDefault(s(497910)),O=i.__importDefault(s(341994)),U=d.Size.Large,V=d.Size.Medium,H=(0,v.lazyProperties)({panel:()=>a.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:B.Color.transparent,marginHorizontal:4,maxWidth:420,overflow:"visible"}),panelNavigation:()=>a.Styles.createViewStyle({overflow:"hidden"}),scrollPanel:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"flex-end",overflow:"visible"}),viewContainer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"stretch",justifyContent:"center",overflow:"hidden",alignSelf:"stretch"}),emoticonContainer:()=>a.Styles.createViewStyle({flex:0,flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",overflow:"visible"}),emoticonContainerNavigation:()=>a.Styles.createViewStyle({justifyContent:"flex-start",alignContent:"center"}),scrollContainer:()=>a.Styles.createViewStyle({flex:0,overflow:"hidden",alignSelf:"center",alignContent:"center"}),panelMargin:()=>a.Styles.createViewStyle({marginHorizontal:30}),emoticon:()=>a.Styles.createViewStyle({flex:0,height:80,width:56,alignItems:"center",justifyContent:"center",overflow:"visible"}),defaultEmoticonForRN:()=>a.Styles.createViewStyle({width:53}),smallEmoticonForRN:()=>a.Styles.createViewStyle({height:64,width:44}),emoticonStyle:()=>a.Styles.createViewStyle({paddingTop:11,paddingBottom:5}),emoticonSelectedPlaceholder:()=>a.Styles.createViewStyle({alignSelf:"center",width:6,height:6}),emoticonSelected:()=>a.Styles.createViewStyle({backgroundColor:B.Color.blue,borderRadius:6}),navigationButtonContainer:()=>a.Styles.createViewStyle({flex:0,overflow:"visible",position:"absolute",top:0,bottom:0,justifyContent:"center"}),viewPageIndicator:()=>a.Styles.createViewStyle({flexDirection:"column",justifyContent:"space-around",alignItems:"stretch",paddingBottom:10}),nextButton:()=>a.Styles.createButtonStyle({right:10}),prevButton:()=>a.Styles.createButtonStyle({left:10}),scrollViewRTL:()=>a.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),customReactionsPanelButton:()=>a.Styles.createButtonStyle({position:"absolute",right:-8,bottom:-10,padding:5,borderRadius:15})});class j extends E.default{constructor(){super(...arguments),this._mountedRefsMap=new b.default,this._scrollViewFiredInitialLayout=!1,this._eventTracked=!1,this._isInitialized=!1,this._lastInstanceId=0,this._onClick=(e,t)=>{_.log(g.LogTraceArea.ReactionsPopupMenu,"_onClick - selectedReaction",t),this.state.isAnimatingPress||this.setState({isAnimatingPress:!0,selectedReactionKey:t})},this._onHoverStart=(e,t)=>{this.setState({hoverItem:t})},this._onHoverEnd=(e,t)=>{this.setState({hoverItem:void 0})},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onScrollViewLayout=e=>{this._scrollViewFiredInitialLayout||(this._scrollViewFiredInitialLayout=!0,this._scrollView&&void 0!==this._scrollViewPendingScrollAmount&&(this._scrollView.setScrollLeft(this._scrollViewPendingScrollAmount,!1),this._scrollViewPendingScrollAmount=void 0))},this._onScroll=(e,t)=>{var s;const i=n.clamp(Math.ceil(Math.floor(t)/this._reactionContainerWidth),0,this.state.reactionPacks.length-1);i!==this.state.currentPack&&(this.setState({currentPack:i}),this._scrollingDueToArrowClick?this._scrollingDueToArrowClick=!1:null===(s=this._openReactionMenuTelemetry)||void 0===s||s.recordUserAction(x.ReactionNavigationAction.Swipe))},this._isEmoticonFake=e=>!e,this._showPrevious=()=>{this._onNextButtonPress(!1)},this._showNext=()=>{this._onNextButtonPress(!0)},this._onBack=()=>(this._close(),_.log(g.LogTraceArea.HardwareBackButton,"goBack: true componentId: ReactionsPopupMenu"),!0),this._onEscape=()=>(this._close(),!0),this._setInitialScroll=e=>{this._scrollView&&this._scrollViewFiredInitialLayout?this._scrollView.setScrollLeft(e,!1):this._scrollViewPendingScrollAmount=e},this._reactionsToPackages=e=>{const t=e.length%6;if(t){const s=n.fill(Array(6-t),"");e=n.concat(e,s)}return n.chunk(e,6)}}_buildState(e,t){var s,i;const o={},d=this._getRootViewId();if(e.hidden&&!t)return o;if(this._isInitialized&&e.instanceId!==this._lastInstanceId&&this._uninitialize(),this._lastInstanceId=e.instanceId,o.width=D.default.getWidth(d),o.deviceOrientation=D.default.getDeviceOrientation(d),o.isMobileScreenSize=D.default.isMobileScreenSize(d),o.reactionPacks=this._reactionsToPackages((0,A.default)().getCustomReactions()),o.shouldAdjustScrollPosition=R.default.hasNonZeroSafeAreaInsets(),o.emoticonWidth=56,this._reactionContainerStyle=[H.panel],l.default.isMobile()){const e=53*((null===(s=o.reactionPacks)||void 0===s?void 0:s.length)?o.reactionPacks[0].length:6);if(o.emoticonWidth=o.width-8<e?44:53,o.isMobileScreenSize&&o.deviceOrientation===r.DeviceOrientation.Portrait){const e=o.width-8,t=a.Styles.createViewStyle({maxWidth:e},!1);this._reactionContainerStyle.push(t)}this._reactionContainerStyle.push(H.panelNavigation)}else!this._isInitialized&&D.default.isMinDesktopWidth(d)&&(o.emoticonWidth=44),this._isInitialized&&(o.emoticonWidth=this.state.emoticonWidth);if(t||!this._isInitialized){o.currentPack=0,o.selectedReactionKey="";const s=e.message.getReactions(),r=I.default.getSkypeMri();if(o.userReactions=n.filter(s,(e=>n.some(e.users,(e=>e.mri===r)))),(null===(i=o.userReactions)||void 0===i?void 0:i.length)>0)for(let e=0;e<o.reactionPacks.length;e++){const t=o.reactionPacks[e],s=k.getReactionName(o.userReactions[0].key);if(t.indexOf(s)>=0){o.currentPack=e;break}}e.hidden||(e.scenario&&e.scenario.markStepCompleted("BuiltSate",void 0,void 0,!0),t||this._initialize(e,n.merge(this.state,o)))}return _.log(g.LogTraceArea.ReactionsPopupMenu,"Built state with reactionPacks: "+JSON.stringify(o.reactionPacks)+" currentPack: "+o.currentPack),o}_getEmoticonName(e){const t=p.default.getEmoticonByNameNoSubscription(e);return t&&t.description||e}_onRemovingReactionDone(e,t){let s="ReactionsMenu.YouRemovedReactionError";const i=this._getEmoticonName(t);if(e&&(s="ReactionsMenu.YouRemovedReaction",this.isComponentMounted())){const e=n.filter(this.state.userReactions,(e=>e.key!==t));this.setState({userReactions:e})}L.default.maybeAnnounceForAccessibility(C.getString(s,{reactionName:i}))}_onAddingReactionDone(e,t){let s="ReactionsMenu.YouReactedError";const i=this._getEmoticonName(t);if(e&&(s="ReactionsMenu.YouReacted",this.isComponentMounted())){const e=[...this.state.userReactions,{key:t,users:[{mri:I.default.getSkypeMri(),time:Date.now()}]}];this.props.onReactionSelected&&this.props.onReactionSelected(t),this.setState({userReactions:e})}L.default.maybeAnnounceForAccessibility(C.getString(s,{reactionName:i}))}_completeClick(e){const t=k.separateReactionNameAndTone(e),s={message:this.props.message,reactionAction:{reaction:t.reactionNameWithoutTone,reactionLevel:this.state.currentPack,reactionAdded:!1,isCustomReaction:(0,A.default)().isCustomReaction(e),reactionTone:t.reactionTone}};this._eventTracked=!0,n.some(this.state.userReactions,(t=>t.key===e))?(_.log(g.LogTraceArea.ReactionsPopupMenu,"Removing the selected reaction",e),k.addRemoveReactionFromMessage(s,this._openReactionMenuTelemetry,(t=>this._onRemovingReactionDone(t,e)))):(_.log(g.LogTraceArea.ReactionsPopupMenu,"Adding the selected reaction",e),s.reactionAction.reactionAdded=!0,k.addRemoveReactionFromMessage(s,this._openReactionMenuTelemetry,(t=>{if(l.default.isMobile()&&O.default.doesMessageHaveHint(s.message.cuid)&&"yes"===s.reactionAction.reaction){T.default.hintShownAndUsed();const e=m.default.getDefaultMessageHintObject();e.wasFeatureUsedByUser=!0,O.default.setMessagesHintData(M.MessageHintsTypes.DoubleTapMessageToLike,e)}this._onAddingReactionDone(t,e)}))),this.setState({isAnimatingPress:!1}),this.props.keepOpenAfterReactionSelected||this._close()}_renderReactionContainer(){let e,t,s,i=[];this.state.reactionPacks.length>0&&(this._numberOfReactionsPerPack=this.state.reactionPacks[0].length);for(let e=0;e<this.state.reactionPacks.length;e++){const t=this._getEmoticonReactionsForPack(this.state.reactionPacks[e],e);i=i.concat(t)}this._numberOfReactions=i.length,this._reactionContainerWidth=this._numberOfReactionsPerPack*this.state.emoticonWidth;const r=[H.viewContainer],d=[H.emoticonContainer,H.emoticonContainerNavigation];let c=this.state.emoticonWidth*this._numberOfReactions;const u=l.default.isMobile(),h=!u;h&&(c+=30),d.push(a.Styles.createViewStyle({width:c},!1));const p=this._getContext().isRTL;if(h){const e=p?F.SkypeIcon.NavigationForward:F.SkypeIcon.NavigationBack,i=p?F.SkypeIcon.NavigationBack:F.SkypeIcon.NavigationForward;t=(0,o.jsx)(a.Animated.View,{style:[H.navigationButtonContainer,H.prevButton],onPress:this._showPrevious,children:(0,o.jsx)(S.default,{size:20,onPress:this._showPrevious,color:this._themeColors.iconLightFixed,hoverColor:this._themeColors.iconLightFixed,icon:e,title:C.getString("Global.PreviousButtonTitle"),disabled:0===this.state.currentPack})},"mouseControlsLeft"),s=(0,o.jsx)(a.Animated.View,{style:[H.navigationButtonContainer,H.nextButton],onPress:this._showNext,children:(0,o.jsx)(S.default,{size:20,onPress:this._showNext,color:this._themeColors.iconLightFixed,hoverColor:this._themeColors.iconLightFixed,icon:i,title:C.getString("Global.NextButtonTitle"),disabled:this.state.currentPack===this.state.reactionPacks.length-1})},"mouseControlsRight")}else{let t=0;const s=n.map(this.state.reactionPacks,(e=>({uid:(t++).toString()})));e=(0,o.jsx)(w.default,{currentPage:this.state.currentPack,pages:s,indicatorDotSize:10,indicatorMargin:1,maxIndicators:10}),r.push(H.viewPageIndicator)}const g=a.Styles.createViewStyle({width:u?this._reactionContainerWidth:this._reactionContainerWidth+30},!1),m=[H.scrollContainer,g];this._reverseLayout()&&m.push(H.scrollViewRTL);let _=(0,o.jsx)(a.ScrollView,{ref:this._onScrollViewRef,style:m,pagingEnabled:!0,horizontal:u,showsHorizontalScrollIndicator:!1,showsVerticalScrollIndicator:!1,keyboardShouldPersistTaps:!0,vertical:!1,onScroll:this._onScroll,scrollEnabled:u,onLayout:this._onScrollViewLayout,ignoreRTL:!0,children:(0,o.jsx)(a.View,{style:d,children:i})});return h&&(_=(0,o.jsx)(a.View,{style:[H.scrollPanel,H.panelMargin],children:_})),(0,o.jsxs)(a.View,{style:r,children:[t,_,s,e]})}_reverseLayout(){return!1}_onNextButtonPress(e){var t;this._scrollingDueToArrowClick=!0,null===(t=this._openReactionMenuTelemetry)||void 0===t||t.recordUserAction(x.ReactionNavigationAction.ArrowNavigation);const s=e?1:-1,i=(this.state.currentPack+s)*this._reactionContainerWidth;this._scrollView&&i>=0&&i<this._numberOfReactions*this.state.emoticonWidth&&this._scrollView.setScrollLeft(i,!0)}_getEmoticonReactionsForPack(e,t){return n.map(e,((e,s)=>{const i=e,r=k.separateReactionNameAndTone(i),c=n.some(this.state.userReactions,(e=>i===e.key)),u=[H.emoticonSelectedPlaceholder];c&&u.push(H.emoticonSelected);let h=P.ReactionButtonSelectionState.NotSelected;this.state.hoverItem&&this.state.hoverItem===i&&(h=P.ReactionButtonSelectionState.Selected);const p=h===P.ReactionButtonSelectionState.Selected,g=[H.emoticon];let m=U;this.state.emoticonWidth<53?(g.push(H.smallEmoticonForRN),m=V):this.state.emoticonWidth<56&&g.push(H.defaultEmoticonForRN);const S=this._getEmoticonName(r.reactionNameWithoutTone);let _=S;c&&(_+=", "+C.getString("Global.SelectedAccessibilityLabel"));const f=l.default.isMobile()?d.Size.Large:d.Size.ExtraLarge;return(0,o.jsxs)(a.View,{style:g,ignorePointerEvents:!0,children:[!this._isEmoticonFake(i)&&(0,o.jsx)(P.ReactionButton,{ref:this._mountedRefsMap.onComponentRef(i),title:S,animateEmoticon:p||c,size:f,renderSize:m,reactionName:r.reactionNameWithoutTone,style:H.emoticonStyle,onPress:this._onClick,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,selectionState:h,accessibilityLabel:_,tone:r.reactionTone}),(0,o.jsx)(a.View,{style:u})]},"reactionButton"+t.toString()+s.toString())}))}_close(){this.props.onClose&&this.props.onClose()}_initialize(e,t){if(c.default.subscribe(this._onBack),y.default.addEscapeHandler(this._onEscape),this._scrollView){const e=t.currentPack*this._reactionContainerWidth;t.shouldAdjustScrollPosition?n.delay(this._setInitialScroll,100,e):t.currentPack>0&&n.defer(this._setInitialScroll,e)}this._openReactionMenuTelemetry=new x.ReactionPickerTelemetry(e.message,x.ReactionOriginType.ReactionsPopupMenu),e.scenario&&!e.scenario.isResolved()&&e.scenario.finish(),this._isInitialized=!0}_uninitialize(){c.default.unsubscribe(this._onBack),y.default.removeEscapeHandler(this._onEscape),this._eventTracked||_.track(this._openReactionMenuTelemetry),this._isInitialized=!1}componentDidMount(){super.componentDidMount(),this.props.hidden||this._initialize(this.props,this.state)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),(0,f.default)(this.state.deviceOrientation,t.deviceOrientation)||(_.log(g.LogTraceArea.ReactionsPopupMenu,"Closing due to orientation change"),this._close())}componentDidUpdate(e,t,s){if(super.componentDidUpdate(e,t,s),this.props.hidden&&this._isInitialized&&(this._uninitialize(),n.defer(this._setInitialScroll,0)),!t.isAnimatingPress&&this.state.isAnimatingPress){const e=this.state.selectedReactionKey,t=this._mountedRefsMap.ref(e);t&&this.state.hoverItem!==e?t.animatePress((()=>{this._completeClick(e)})):this._completeClick(e)}}componentWillUnmount(){super.componentWillUnmount(),this._isInitialized&&this._uninitialize()}render(){return(0,o.jsxs)(a.View,{style:N.default.overflowVisible,children:[(0,o.jsx)(a.View,{style:this._reactionContainerStyle,children:this._renderReactionContainer()}),(0,o.jsx)(u.default,{styles:H.customReactionsPanelButton,origin:h.CustomReactionsType.Message})]})}}t.ReactionsPopupMenu=j},330699:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsPopupSummary=t.EmoticonHeight=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=(s(331654),s(614080)),a=i.__importStar(s(516778)),l=s(623627),d=i.__importDefault(s(54720)),c=s(284841),u=i.__importDefault(s(958868)),h=i.__importDefault(s(601976)),p=s(815146),g=i.__importStar(s(85385)),m=i.__importDefault(s(114818)),S=i.__importDefault(s(97595)),_=s(26703),f=i.__importDefault(s(363091)),y=i.__importDefault(s(740794)),v=i.__importStar(s(548056)),C=i.__importStar(s(73018)),T=i.__importStar(s(920710)),M=i.__importDefault(s(960282)),b=i.__importStar(s(437782)),I=i.__importDefault(s(452881)),w=s(16549),P=i.__importDefault(s(827361)),k=(i.__importDefault(s(601274)),i.__importDefault(s(760989))),A=i.__importDefault(s(337249));t.EmoticonHeight=v.frameHeights.emoticons.Size80;const x=12,D=(0,_.lazyProperties)({panel:()=>a.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:w.Color.transparent,borderRadius:10,height:t.EmoticonHeight,marginHorizontal:4,maxWidth:420,overflow:"hidden"}),emoticonHeaderTop:()=>a.Styles.createViewStyle({top:0}),emoticonHeaderBottom:()=>a.Styles.createViewStyle({bottom:0}),emoticonHeader:()=>a.Styles.createViewStyle({justifyContent:"center",alignItems:"center",height:v.frameHeights.emoticons.Size80,position:"absolute",left:0,right:0,flex:1,width:300}),virtualListContainer:()=>a.Styles.createViewStyle({paddingTop:x,paddingHorizontal:x,paddingBottom:x,flex:1,overflow:"hidden"}),virtualListContainerTop:()=>a.Styles.createViewStyle({paddingTop:t.EmoticonHeight}),virtualListContainerBottom:()=>a.Styles.createViewStyle({paddingBottom:t.EmoticonHeight})});class R extends u.default{constructor(){super(...arguments),this._animatedOpacityValue=new a.Animated.Value(0),this._animatedOpacityStyle=a.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onBack=()=>{const e=this._close();return g.log(p.LogTraceArea.HardwareBackButton,"goBack: "+e+" componentId: ReactionsPopupSummary"),e},this._onEscape=()=>(this._close(),!0),this._renderItem=e=>{let t,s="";return f.default.isMyMri(e.key)||(t=P.default.pointerCursor,s=e.displayName),(0,o.jsx)(I.default,{conversationId:this.props.conversationId,displayName:e.displayName,style:t,userMri:e.key,showMeLabel:!0,onItemPress:this._onPress,buttonTitle:s})},this._onVirtualListViewRef=e=>{this._virtualListView=e||void 0},this._onSummaryHeaderRef=e=>{this._summaryHeader=e||void 0},this._onHeaderPress=e=>{this._close(),this.props.onPress&&this.props.onPress(e)},this._onPress=e=>{const t=k.default.newCauseId();g.log(p.LogTraceArea.ReactionsPopupSummary,"_onPress - mri: "+b.mriOrId(e)+" causeId: "+t),f.default.isMyMri(e)||(this._close(),g.track(new C.ReactionPanelListItem(this.props.reaction.key,this.props.conversationId,this.props.reaction.users.length)),y.default.showDetailsPanelWithParams({mri:e,causeId:t,rootViewId:this._getRootViewId()}))}}_buildState(e,t){const s={},i=this._getRootViewId();s.width=Math.min(M.default.getWidth(i),300),s.maxHeight=402.3,s.deviceOrientation=M.default.getDeviceOrientation(i),s.isMobileScreenSize=M.default.isMobileScreenSize(i);const o=this.props;if(t||e.reaction!==o.reaction){const i=[];if(e.reaction.users.length>0){const t=(0,c.chain)(e.reaction.users,(0,c.map)((t=>({mri:t.mri,displayName:h.default.getMemberShortNameForConversation(e.conversationId,t.mri)}))),(0,c.sortBy)((e=>e.displayName)),(0,c.compact)());n.each(t,(e=>{i.push({key:e.mri,displayName:e.displayName,height:44,template:"convo",accessibilityTrait:a.Types.AccessibilityTrait.Button})}))}s.virtualListViewItemInfo=i,t&&e.scenario&&e.scenario.markStepCompleted("BuildSate",void 0,void 0,!0)}return s}_close(){return this.props.onClose&&this.props.onClose(),!0}componentDidMount(){super.componentDidMount(),d.default.subscribe(this._onBack),S.default.addEscapeHandler(this._onEscape),this._summaryHeader&&this._summaryHeader.requestFocus(),this.state.virtualListViewItemInfo.length&&this._maybeScrollToTop(),this.props.scenario&&this.props.scenario.finish()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,m.default)(this.state.virtualListViewItemInfo,t.virtualListViewItemInfo)||this._maybeScrollToTop()}componentWillUnmount(){super.componentWillUnmount(),d.default.unsubscribe(this._onBack),S.default.removeEscapeHandler(this._onEscape)}render(){const e=[D.panel],t=this._computeHeight();e.push(a.Styles.createViewStyle({width:this.state.width,height:t},!1));const s=[D.emoticonHeader],i=[D.virtualListContainer,this._animatedOpacityStyle];"top"===this.props.anchorPosition?(i.push(D.virtualListContainerTop),s.push(D.emoticonHeaderTop)):(s.push(D.emoticonHeaderBottom),i.push(D.virtualListContainerBottom));const{reactionTone:n,reactionNameWithoutTone:d}=T.separateReactionNameAndTone(this.props.reaction.key);return(0,o.jsxs)(a.View,{style:e,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,children:[(0,o.jsx)(a.Button,{style:s,ref:this._onSummaryHeaderRef,importantForAccessibility:a.Types.ImportantForAccessibility.Yes,onPress:this._onHeaderPress,children:(0,o.jsx)(l.AnimatedEmoticon,{size:l.Size.ExtraLarge,innerText:d,emoticonName:d,isStatic:!1,standaloneAnimation:!0,tone:n},d)}),(0,o.jsx)(a.Animated.View,{style:i,children:(0,o.jsx)(r.VirtualListView,{ref:this._onVirtualListViewRef,itemList:this.state.virtualListViewItemInfo,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0})})]})}_computeHeight(){const e=44*this.props.reaction.users.length+10+t.EmoticonHeight+x;let s;if(e>this.state.maxHeight)s=this.state.maxHeight;else{const i=A.default.measureWindow(this._getRootViewId()).height-t.EmoticonHeight-this.props.anchorHeight;e>i&&(s=i)}if(s){return 44*(Math.floor((s-t.EmoticonHeight-x)/44)+.45)+t.EmoticonHeight+x}return e}_maybeScrollToTop(){this._animatedOpacityValue.setValue(1)}}t.ReactionsPopupSummary=R,t.default=R},590599:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsSummaryPopup=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(704704)),r=s(330699),a=i.__importDefault(s(60599));class l extends a.default{constructor(e,t,s,i,o,n,r,a,l,d,c,u,h,p){super(i,r,o,n),this._conversationId=e,this._scenario=t,this._reaction=s,this._callerHeight=a,this._anchorPositionAnywhere=l,this._reactedByCurrentUser=d,this._showReactWithClickOption=c,this._onMouseEnter=u,this._onMouseLeave=h,this._onPress=p}_getPaddingInPopupCanvas(){return r.EmoticonHeight/2}_getPopupId(){return l.popupId}_getAccessibilityTitle(){return this._showReactWithClickOption?this._reactedByCurrentUser?n.getString("AccessibilityLabel.ReactionsSummaryRemoveReaction",{reactionName:this._reaction.key}):n.getString("AccessibilityLabel.ReactionsSummaryAddReaction",{reactionName:this._reaction.key}):n.getString("ReactionsDetailsOverlayPanel.ReactionButtonTitle",{reactionName:this._reaction.key})}_getPopupContent(e,t,s,i){return(0,o.jsx)(r.ReactionsPopupSummary,{conversationId:this._conversationId,scenario:this._scenario,reaction:this._reaction,onClose:this.dismissPopup,anchorPosition:e,anchorHeight:this._callerHeight,anchorPositionAnywhere:this._anchorPositionAnywhere,reactedByCurrentUser:this._reactedByCurrentUser,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onPress:this._onPress})}}t.ReactionsSummaryPopup=l,l.popupId="reactionsSummaryPopup"},169012:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.onClick=void 0;const i=s(197582),o=s(167606),n=(i.__importDefault(s(207864)),i.__importDefault(s(791384))),r=s(73018),a=i.__importDefault(s(794229)),l=i.__importDefault(s(233277)),d=i.__importStar(s(920710)),c=i.__importStar(s(704704)),u=i.__importStar(s(85385)),h=i.__importDefault(s(363091)),p=e=>{var t;const s=a.default.getEmoticonByNameNoSubscription(e);return null!==(t=null==s?void 0:s.description)&&void 0!==t?t:e};t.onClick=(e,t)=>{u.log(o.LogTraceArea.ReactionsPopupMenu,"_onClick - selectedReaction",e);const s=h.default.getSkypeMri(),i=new r.ReactionPickerTelemetry(t,r.ReactionOriginType.ReactionsPopupMenu),n=((e,t)=>{const s=d.separateReactionNameAndTone(e);return{message:t,reactionAction:{reaction:s.reactionNameWithoutTone,reactionLevel:40,reactionAdded:!1,isCustomReaction:(0,l.default)().isCustomReaction(e),reactionTone:s.reactionTone}}})(e,t);t.getReactions().reduce(((e,t)=>(t.users.some((e=>e.mri===s))&&e.set(t.key,t),e)),new Map).has(e)?d.removeReaction(e,n,i,g):d.addReaction(e,n,i,m)};const g=(e,t)=>{const s=p(t);e?n.default.maybeAnnounceForAccessibility(c.getString("ReactionsMenu.YouRemovedReaction",{reactionName:s})):n.default.maybeAnnounceForAccessibility(c.getString("ReactionsMenu.YouRemovedReactionError",{reactionName:s}))},m=(e,t)=>{const s=p(t);e?n.default.maybeAnnounceForAccessibility(c.getString("ReactionsMenu.YouReacted",{reactionName:s})):n.default.maybeAnnounceForAccessibility(c.getString("ReactionsMenu.YouReactedError",{reactionName:s}))}},926187:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReadReceiptsPopup=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(704704)),r=i.__importDefault(s(820359)),a=i.__importDefault(s(60599));class l extends a.default{constructor(e,t,s,i,o,n){super(s,i,o,n),this._conversationId=e,this._readReceiptsSum=t}_getPopupId(){return l.popupId}_getAccessibilityTitle(){return n.getString("StreamItem.ReadByPopupAccessibilityTitle")}_getPopupContent(e,t,s,i){return(0,o.jsx)(r.default,{conversationId:this._conversationId,readReceiptsSum:this._readReceiptsSum,onClose:this.dismissPopup,anchorPosition:e})}}t.ReadReceiptsPopup=l,l.popupId="readReceiptsPopup"},820359:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=(s(331654),s(614080)),r=i.__importStar(s(516778)),a=i.__importDefault(s(54720)),l=i.__importStar(s(44717)),d=i.__importDefault(s(958868)),c=i.__importDefault(s(601976)),u=s(815146),h=i.__importStar(s(85385)),p=i.__importDefault(s(114818)),g=i.__importDefault(s(97595)),m=s(26703),S=i.__importStar(s(704704)),_=i.__importDefault(s(740794)),f=i.__importDefault(s(960282)),y=i.__importDefault(s(452881)),v=s(16549),C=s(262725),T=i.__importDefault(s(760989)),M=i.__importDefault(s(337249)),b=(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({alignSelf:"center",alignItems:"stretch",justifyContent:"center",backgroundColor:v.Color.transparent,padding:12,overflow:"hidden"}),headlineText:()=>r.Styles.createTextStyle({color:v.Color.white,paddingBottom:18,height:33}),virtualList:()=>r.Styles.createViewStyle({flex:1,overflow:"hidden"})});class I extends d.default{constructor(){super(...arguments),this._onBack=()=>{const e=this._close();return h.log(u.LogTraceArea.HardwareBackButton,"goBack: "+e+" componentId: ReadReceiptsSummary"),e},this._onEscape=()=>(this._close(),!0),this._renderItem=e=>(0,o.jsx)(y.default,{displayName:e.displayName,userMri:e.key,timestamp:e.timestamp,buttonTitle:e.displayName,onItemPress:this._onPress}),this._onPress=e=>{const t=T.default.newCauseId();h.log(u.LogTraceArea.Navigation,"ReadReceiptsSummary._onPress, causeId: "+t),_.default.showDetailsPanelWithParams({mri:e,causeId:t,rootViewId:this._getRootViewId()})},this._onSummaryHeaderRef=e=>{this._summaryHeader=e||void 0}}_buildState(e,t){const s={},i=this._getRootViewId();s.width=Math.min(f.default.getWidth(i),300),s.maxHeight=387,s.deviceOrientation=f.default.getDeviceOrientation(i),s.isMobileScreenSize=f.default.isMobileScreenSize(i);const o=this.props;return!t&&(0,p.default)(e.readReceiptsSum,o.readReceiptsSum)||(s.virtualListViewItemInfo=e.readReceiptsSum.map((t=>({key:t.mri,displayName:c.default.getMemberShortNameForConversation(e.conversationId,t.mri),height:44,template:"convo",timestamp:t.timestamp}))).sort(((e,t)=>e.displayName.localeCompare(t.displayName)))),s}_close(){return this.props.onClose&&this.props.onClose(),!0}componentDidMount(){super.componentDidMount(),a.default.subscribe(this._onBack),g.default.addEscapeHandler(this._onEscape),this._summaryHeader&&this._summaryHeader.requestFocus()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}componentWillUnmount(){super.componentWillUnmount(),a.default.unsubscribe(this._onBack),g.default.removeEscapeHandler(this._onEscape)}render(){const e=[b.container],t=this._computeHeight();e.push(r.Styles.createViewStyle({width:this.state.width,height:t},!1));const s=l.isOneOnOneConversation(this.props.conversationId)?S.getString("StreamItem.ReadByCount"):S.getString("StreamItem.ReadByGroupCount",{count:this.props.readReceiptsSum.length});return(0,o.jsxs)(r.View,{style:e,children:[(0,o.jsx)(r.View,{ref:this._onSummaryHeaderRef,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:s,children:(0,o.jsx)(C.Subtitle,{style:b.headlineText,children:s})}),(0,o.jsx)(n.VirtualListView,{style:b.virtualList,itemList:this.state.virtualListViewItemInfo,renderItem:this._renderItem,animateChanges:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0})]})}_computeHeight(){const e=57+44*this.props.readReceiptsSum.length;if(e>this.state.maxHeight)return this.state.maxHeight;const t=M.default.measureWindow(this._getRootViewId()).height;if(e>t){return 44*(Math.floor((t-57)/44)+.5)+57}return e}}t.default=I},82133:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=(i.__importStar(s(496486)),i.__importStar(s(516778))),r=s(167606),a=i.__importStar(s(309520)),l=i.__importDefault(s(838264)),d=i.__importStar(s(44717)),c=i.__importDefault(s(266311)),u=s(154235),h=i.__importStar(s(637224)),p=i.__importDefault(s(970035)),g=i.__importStar(s(85385)),m=s(26703),S=i.__importStar(s(704704)),_=i.__importDefault(s(252089)),f=i.__importDefault(s(740794)),y=s(384860),v=i.__importStar(s(808164)),C=i.__importDefault(s(791384)),T=(i.__importDefault(s(776622)),s(334318)),M=i.__importDefault(s(477419)),b=i.__importDefault(s(127336)),I=i.__importStar(s(796967)),w=i.__importDefault(s(799585)),P=s(16549),k=s(641400),A=i.__importDefault(s(577267)),x=s(262725),D=i.__importDefault(s(497910)),R=s(384860),L=i.__importStar(s(438752)),B=s(22478),F=s(677982);var N;!function(e){e.Skype="Skype",e.SMS="SMS"}(N||(N={}));const E=(0,m.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,justifyContent:"space-between",marginBottom:10}),containerMobile:()=>n.Styles.createViewStyle({marginBottom:5,marginTop:5,marginHorizontal:10}),row:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),creditIcon:()=>n.Styles.createViewStyle({paddingLeft:15,paddingRight:5}),activityStyle:()=>n.Styles.createViewStyle({height:14}),recipientNumberRow:()=>n.Styles.createViewStyle({flexShrink:1,paddingRight:10,flexWrap:"wrap"}),smsButton:()=>n.Styles.createViewStyle({flexDirection:"row",backgroundColor:P.Color.transparent}),chatAndSmsGroup:()=>n.Styles.createViewStyle({flexDirection:"row",backgroundColor:P.Color.transparent,alignItems:"center"}),chatAndSmsButtonGroup:()=>n.Styles.createViewStyle({flexDirection:"row",backgroundColor:P.Color.transparent,borderRadius:4,borderWidth:1,padding:2,marginLeft:8}),skypeAndSMSButton:()=>n.Styles.createViewStyle({paddingHorizontal:8,paddingTop:2,paddingBottom:4,borderRadius:2}),skypeAndSMSButtonText:()=>n.Styles.createTextStyle({fontSize:14,fontWeight:"400",lineHeight:18})}),O="overflowPopupId";class U extends D.default{constructor(){super(...arguments),this._oldFragments=0,this._telemetryEvent=new y.SmsLineSwitcherShown,this._onRateInfoPress=()=>{this.canSendSMS()||(this.props.isSmsFailureScreenEnabled?f.default.navigateToSmsFailurePrompt(this.props.conversationId,this.props.phoneNumbers.length>0?this.props.phoneNumbers[0].number:"",!0):l.default.open(this._getRootViewId()))},this._onSwitcherButtonPressed=e=>{e===N.Skype?(g.track(new y.SmsLineSwitcherClick(y.SmsSwitcherTarget.Skype)),this.props.onPhoneNumberSelected(this.props.phoneNumbers[1])):(g.track(new y.SmsLineSwitcherClick(y.SmsSwitcherTarget.Sms)),L.EngagementTooltipStore.setTooltipSeen(B.EngagementTooltipType.SMSInfoLine),this.props.onPhoneNumberSelected(this.props.phoneNumbers[0]))},this._getChatAndSmsButtonStyle=e=>{const{themeColors:t}=this._getContext(),{selectedPhoneNumber:s}=this.props,i=[E.skypeAndSMSButton];return e===N.Skype?s||i.push({backgroundColor:t.iconSecondary}):(i.push({marginLeft:2}),s&&i.push({backgroundColor:t.iconSecondary})),i},this._getChatAndSmsTextStyle=e=>{const{themeColors:t}=this._getContext(),{selectedPhoneNumber:s}=this.props,i=t.textPrimary,o=t.textOnColor,n=[E.skypeAndSMSButtonText];return e===N.Skype?n.push({color:s?i:o}):n.push({color:s?o:i}),n},this._getAccentColor=()=>this._themeColors.textInteractive,this._onNumberPickerRef=e=>{this._numberPickerRef=e||void 0},this._onSMSSwitcherRef=e=>{e?(L.default.setSMSInfolineAnchor(e),L.default.enableSMSInfolineTooltip()):L.default.disableSMSInfolineTooltip()},this._getPopupAnchor=()=>this._numberPickerRef,this._onSwitcherPressed=()=>{this._showOverflowPopup()},this._showOverflowPopup=()=>{const e={getAnchor:this._getPopupAnchor,renderPopup:(e,t,s,i)=>(0,o.jsx)(A.default,{anchorPosition:e,anchorOffset:t,popupWidth:s,popupHeight:i,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,children:(0,o.jsx)(M.default,{phoneNumbers:this.props.phoneNumbers,onOptionSelected:this._onOptionSelected})}),positionPriorities:["top"],dismissIfShown:!0,rootViewId:this._getRootViewId()};c.default.showPopup(e,O)},this._onOptionSelected=e=>{this.props.onPhoneNumberSelected(e),c.default.dismissPopup(O,this._getRootViewId())}}_buildState(e,t){e.selectedPhoneNumber||(this._oldFragments=0);const s={primaryColor:_.default.getPrimaryColor()};return e.selectedPhoneNumber&&(s.smsPriceInfo=b.default.getSmsRateByPhoneNumber(e.selectedPhoneNumber.number)),s.enableSMSInfolineSwitcher=F.AppConfigStore.getS4LCommerceFeatures().enableSMSInfolineSwitcher,s}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSmsMode(!0)}componentWillUnmount(){super.componentWillUnmount(),this._telemetryEvent&&g.track(this._telemetryEvent)}componentDidUpdate(e,t,s){var i,o;if(super.componentDidUpdate(e,t,s),this._scheduleAccessibilityAnnouncement&&(this._announceSmsInfoChangeInScreenReader(),this._scheduleAccessibilityAnnouncement=!1),g.log(r.LogTraceArea.SMSClient,"prevProps.selectedPhoneNumber",e.selectedPhoneNumber,"this.props.selectedPhoneNumber",this.props.selectedPhoneNumber),e.selectedPhoneNumber&&!this.props.selectedPhoneNumber&&this._telemetryEvent.setSwitchedToSkype(!0),!e.selectedPhoneNumber&&this.props.selectedPhoneNumber){const{callerId:e}=F.AppConfigStore.getS4LCommerceFeaturesNoSubscription().callingSettingsPanel;e.refreshInfoOnSmsComposer&&b.default.updateData(this.props.selectedPhoneNumber.number),this._telemetryEvent.setSwitchedToSmsMode(!0)}(null===(i=this.props.creditEntitlement)||void 0===i?void 0:i.attributes)&&(null===(o=e.creditEntitlement)||void 0===o?void 0:o.attributes)&&this.props.selectedPhoneNumber&&this.props.creditEntitlement.attributes.currency!==e.creditEntitlement.attributes.currency&&b.default.updateData(this.props.selectedPhoneNumber.number)}getTelemetryEvent(){return this._telemetryEvent}requestFocus(){this._numberPickerRef&&this._numberPickerRef.requestFocus()}canSendSMS(){if(!this.state.smsPriceInfo)return!0;if(this.state.smsPriceInfo.failureReason===T.FailureReason.InsufficientFunds)return g.track(new R.SmsSendStatus(R.OneWaySmsAction.InsufficientFunds)),!1;const{fragments:e}=I.calculateSmsFragments(this.props.rawTextInput),t=this.props.creditEntitlement&&this.props.creditEntitlement.balance||0;return!(this.state.smsPriceInfo.rate&&this.state.smsPriceInfo.rate*e>t)}render(){const e=d.isPhoneMri(this.props.conversationId);let t;e||(t=this._renderTargetSwitcher());const s=[],i=(0,o.jsxs)(n.View,{style:E.row,children:[this._renderRateSection(),this._renderCreditSection()]},"rateAndCreditSection");e?s.push(this._renderRecipientNumberSection(),i):this.props.selectedPhoneNumber&&s.push(i);const r=[E.container,E.row];this.props.useMobileLayout&&r.push(E.containerMobile);const a=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0;return(0,o.jsxs)(n.View,{style:r,importantForAccessibility:a,children:[t,s]})}_renderRecipientNumberSection(){const e=d.getPhoneNumberFromMri(this.props.conversationId);if(e){const t=v.default.parseAndFormat(e,v.PhoneNumberFormat.INTERNATIONAL)||e;return(0,o.jsx)(x.Caption,{style:E.recipientNumberRow,textThemeColor:x.TextThemeColor.Primary,children:S.getString("SMSMessaging.SendSmsToNumberViaSkype",{phoneNumber:t})},"recipientNumberSection")}}_renderRateSection(){const{fragments:e,charactersRemaining:t}=I.calculateSmsFragments(this.props.rawTextInput);let s;if(this.state.smsPriceInfo){const{rate:i,currency:o,failureReason:n}=this.state.smsPriceInfo;n&&n!==T.FailureReason.InsufficientFunds?this._accessibilityLabelForRateSection=S.getString("SMSMessaging.SmsPriceFetchFailure"):i&&o&&(s=h.getFormattedRate(i*e,o,3),this._accessibilityLabelForRateSection=S.getString("SMSMessaging.SmsRateAndCharactersLabel",{charactersRemaining:t,formattedPrice:s})),this._oldFragments!==e&&(this._scheduleAccessibilityAnnouncement=!0,this._oldFragments=e)}const i=this.state.smsPriceInfo?void 0:(0,o.jsx)(w.default,{size:u.SXActivityIndicatorSize.ExtraSmall,tintColor:P.Color.blue,style:E.activityStyle}),r=(0,o.jsxs)(n.View,{style:E.row,children:[(0,o.jsxs)(x.Caption,{textThemeColor:x.TextThemeColor.Primary,children:[t,s?` | ${s}`:null]}),i]}),l=(0,o.jsx)(n.View,{title:1===e?this._accessibilityLabelForRateSection:void 0,importantForAccessibility:1===e?n.Types.ImportantForAccessibility.Yes:n.Types.ImportantForAccessibility.NoHideDescendants,children:r},"rateSection");if(1===e)return l;const d=n.Styles.createTextStyle({backgroundColor:this._getAccentColor(),marginRight:5},!1);return this._accessibilityLabelForRateSection=S.getString("SMSMessaging.SmsCount",{fragments:e})+this._accessibilityLabelForRateSection,(0,o.jsxs)(n.View,{style:E.row,title:this._accessibilityLabelForRateSection,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,children:[(0,o.jsx)(a.default,{count:e.toString(),rawCount:e,isHighPriority:!0,style:d,badgeSize:a.BadgeSize.Desktop}),l]},"rateSectionWithBadge")}_renderCreditSection(){if(!this.props.creditEntitlement)return;const e=this.props.creditEntitlement.balanceFormatted,t=(0,o.jsxs)(n.View,{style:E.row,children:[(0,o.jsx)(p.default,{icon:k.SkypeIcon.SkypeCredit,color:P.Color.yellow,style:E.creditIcon,size:k.IconSize.size16}),(0,o.jsx)(x.Caption,{textThemeColor:x.TextThemeColor.Primary,children:e})]}),s={key:"creditSection",importantForAccessibility:n.Types.ImportantForAccessibility.Yes,title:S.getString("SMSMessaging.CreditTitle",{balance:e||0}),children:t};return this.canSendSMS()?(0,o.jsx)(n.View,Object.assign({},s)):(0,o.jsx)(n.Button,Object.assign({},s,{onPress:this._onRateInfoPress}))}_renderTargetSwitcher(){const e=n.Styles.createTextStyle({color:this._getAccentColor()},!1),t=this.props.selectedPhoneNumber?v.default.parseAndFormat(this.props.selectedPhoneNumber.number,v.PhoneNumberFormat.INTERNATIONAL)||"":S.getString("SMSMessaging.SendViaSkypeStatic"),s=this.props.selectedPhoneNumber?"SMSMessaging.SendSmsToNumber":"SMSMessaging.SendViaSkype",i=(0,o.jsx)(x.Caption,{style:e,children:t},"label"),r=(0,o.jsx)(p.default,{icon:k.SkypeIcon.DownChevron,color:this._getAccentColor(),size:k.IconSize.size20}),a=this.props.selectedPhoneNumber?S.getString("SMSMessaging.SmsSelectorPhoneOptionAccessibilityTitle",{phoneNumber:this.props.selectedPhoneNumber.number}):S.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle");return this.state.enableSMSInfolineSwitcher?this._renderButtonGroupSwitcher(a):(0,o.jsxs)(n.Button,{ref:this._onNumberPickerRef,style:E.smsButton,title:a,disabled:this.props.disabled,onPress:this._onSwitcherPressed,children:[(0,o.jsx)(x.Caption,{textThemeColor:x.TextThemeColor.Primary,children:S.getParts(s,{target:i})}),r]})}_renderButtonGroupSwitcher(e){return(0,o.jsxs)(n.View,{style:E.chatAndSmsGroup,children:[(0,o.jsx)(n.Text,{style:[E.skypeAndSMSButtonText,{color:this._getContext().themeColors.textPrimary}],children:S.getString("SMSMessaging.SmsVia")}),(0,o.jsxs)(n.View,{style:[E.chatAndSmsButtonGroup,{borderColor:this._getContext().themeColors.dividerPrimary}],children:[(0,o.jsx)(n.Button,{title:e,style:this._getChatAndSmsButtonStyle(N.Skype),ref:this._onNumberPickerRef,onPress:()=>this._onSwitcherButtonPressed(N.Skype),children:(0,o.jsx)(n.Text,{style:this._getChatAndSmsTextStyle(N.Skype),children:S.getString("SMSMessaging.SmsOpenChatChannel")})}),(0,o.jsx)(n.Button,{ref:this._onSMSSwitcherRef,title:e,style:this._getChatAndSmsButtonStyle(N.SMS),onPress:()=>this._onSwitcherButtonPressed(N.SMS),children:(0,o.jsx)(n.Text,{style:this._getChatAndSmsTextStyle(N.SMS),children:S.getString("SMSMessaging.SmsOpenSMSChannel")})})]})]})}_setFocusToSwitcher(){this._numberPickerRef&&C.default.isMobileScreenReaderEnabled()&&this._numberPickerRef.requestFocus()}_announceSmsInfoChangeInScreenReader(){this._accessibilityLabelForRateSection&&C.default.maybeAnnounceForAccessibility(this._accessibilityLabelForRateSection)}}t.default=U},756815:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(154235),a=s(26703),l=i.__importStar(s(704704)),d=i.__importStar(s(808164)),c=i.__importDefault(s(660401)),u=s(641400),h=i.__importDefault(s(497910)),p=(0,a.lazyProperties)({option:()=>n.Styles.createButtonStyle({flexDirection:"row",alignItems:"stretch",marginVertical:5,paddingHorizontal:15,justifyContent:"flex-start"})});class g extends h.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onOptionSelected(this.props.phoneNumber)}}render(){let e,t,s;if(this.props.phoneNumber){let i=d.default.parseAndFormat(this.props.phoneNumber.number,d.PhoneNumberFormat.INTERNATIONAL);i||(i=this.props.phoneNumber.number),e=l.getString("SMSMessaging.SmsSelectorPhoneOptionAccessibilityTitle",{phoneNumber:i}),t=l.getString("SMSMessaging.SmsPhoneOption",{type:d.default.getStringForPhoneType(this.props.phoneNumber.type),phoneNumber:i}),s=u.SkypeIcon.MobileSmsNew}else e=l.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle"),t=l.getString("SMSMessaging.SendViaSkype",{target:l.getString("SMSMessaging.SendViaSkypeStatic"),chevron:""}),s=u.SkypeIcon.Message;return(0,o.jsx)(c.default,{style:p.option,buttonStyle:r.SXButtonStyle.ThemeNoBackground,buttonSize:r.SXButtonSize.Small,icon:s,title:t,onPress:this._onPress,accessibilityLabel:e})}}t.default=g},477419:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(186325)),a=s(26703),l=i.__importStar(s(704704)),d=i.__importDefault(s(756815)),c=s(262725),u=i.__importDefault(s(497910)),h=(0,a.lazyProperties)({container:()=>n.Styles.createViewStyle({minWidth:280,paddingBottom:10}),sendToSmsLabel:()=>n.Styles.createViewStyle({paddingHorizontal:15})});class p extends u.default{render(){return(0,o.jsxs)(n.View,{style:h.container,children:[this._renderSkypeOption(),(0,o.jsx)(r.default,{useLightTheme:!this._useDarkTheme(),marginBottom:5,marginLeft:7,marginRight:7}),(0,o.jsx)(c.Caption,{style:h.sendToSmsLabel,children:l.getString("SMSMessaging.SendSmsToLabel")}),this._renderPhoneOptions()]})}_renderPhoneOptions(){return this.props.phoneNumbers.map((e=>(0,o.jsx)(d.default,{phoneNumber:e,onOptionSelected:this.props.onOptionSelected},e.type+"_"+e.number)))}_renderSkypeOption(){return(0,o.jsx)(d.default,{onOptionSelected:this.props.onOptionSelected},"skype")}}t.default=p},654686:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=(s(331654),i.__importStar(s(859745))),a=i.__importStar(s(516778)),l=i.__importDefault(s(196687)),d=s(973585),c=i.__importDefault(s(615364)),u=i.__importDefault(s(776546)),h=s(535973),p=i.__importStar(s(555078)),g=i.__importDefault(s(453761)),m=i.__importDefault(s(970035)),S=i.__importStar(s(85385)),_=s(26703),f=i.__importStar(s(704704)),y=i.__importDefault(s(379610)),v=i.__importStar(s(954225)),C=s(786531),T=i.__importDefault(s(670363)),M=i.__importDefault(s(960282)),b=i.__importDefault(s(117475)),I=i.__importDefault(s(377556)),w=i.__importDefault(s(791384)),P=i.__importDefault(s(468492)),k=s(206467),A=i.__importDefault(s(20758)),x=s(641400),D=i.__importDefault(s(827361)),R=i.__importDefault(s(48076)),L=s(935086),B=s(262725),F=i.__importDefault(s(497910)),N=(0,_.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:0,flexDirection:"row",alignItems:"center",justifyContent:"space-between",position:"absolute",left:0,right:0}),containerLandscape:()=>a.Styles.createViewStyle({paddingHorizontal:34}),containerBottom:()=>a.Styles.createViewStyle({alignContent:"center",borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,justifyContent:"center",bottom:0}),containerHeader:()=>a.Styles.createViewStyle({borderTopWidth:0,borderLeftWidth:0,borderRightWidth:0,height:d.HeaderHeightModernizeChatSmallHeader,paddingTop:8,paddingBottom:8}),leftChildren:()=>a.Styles.createViewStyle({flex:-1,alignItems:"flex-start",flexDirection:"row"}),centerChildrenColumn:()=>a.Styles.createViewStyle({flex:1,alignItems:"flex-start",flexDirection:"column",justifyContent:"flex-start"}),selectMessagesTitleHeader:()=>a.Styles.createViewStyle({justifyContent:"flex-start"}),modernizeHeaderConversationTypeTitleHeader:()=>(0,_.lazyProperties)({base:()=>a.Styles.createTextStyle({marginHorizontal:4}),desktop:()=>a.Styles.createTextStyle({fontSize:A.default.controlFontSize.caption}),mobile:()=>a.Styles.createTextStyle({fontSize:A.default.controlFontSize.caption})}),centerChildrenRow:()=>a.Styles.createViewStyle({marginVertical:5,alignItems:"center",justifyContent:"flex-start",flexDirection:"row"}),rightChildren:()=>a.Styles.createViewStyle({flex:-1,alignItems:"flex-end",flexDirection:"row",paddingHorizontal:20}),centerChildrenAction:()=>a.Styles.createViewStyle({flex:-1,justifyContent:"center",alignItems:"center"}),centerChildrenActionSpacing:()=>a.Styles.createViewStyle({flex:1,paddingBottom:5}),buttonStyles:()=>a.Styles.createButtonStyle({padding:6}),iconContainer:()=>a.Styles.createViewStyle({flex:0,alignItems:"center"}),iconContainerWidthDesktop:()=>a.Styles.createViewStyle({width:80}),iconContainerWidthMobile:()=>a.Styles.createViewStyle({width:64}),iconContainerActionsMobileBottom:()=>a.Styles.createViewStyle({flex:1,alignItems:"center"}),spacerDesktop:()=>a.Styles.createViewStyle({width:80,height:x.IconSize.default}),spacerMobile:()=>a.Styles.createViewStyle({width:64,height:x.IconSize.default}),horizontalSpacer:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"flex-end",marginBottom:20,alignItems:"center"}),desktopContentContainer:()=>a.Styles.createViewStyle({width:v.messageStreamMaxContentWidth,alignSelf:"center",flex:-1,flexDirection:"row",justifyContent:"center"}),desktopContentContainerActions:()=>a.Styles.createViewStyle({justifyContent:"flex-end"}),closeButtonLandscape:()=>a.Styles.createButtonStyle({height:d.LandscapeButtonHeight,alignItems:"flex-start"}),closeButtonDesktop:()=>a.Styles.createButtonStyle({alignItems:"flex-start",paddingRight:38}),iconPadding:()=>a.Styles.createViewStyle({padding:1})});class E extends F.default{constructor(){super(...arguments),this._iconSize=x.IconSize.size24,this._onCancelButtonRef=e=>{this._cancelButton=e||void 0},this._onCancelMultipleMessages=e=>{this.cancelMultipleMessages()},this._onForwardMultipleMessages=e=>{this._actionTaken=L.SelectedMessagesActionType.Forward,p.forwardMessages(this.state.selectedMessages,C.MessageActionOrigin.StreamItemMultipleMessages,this.props.contextConversationId,this._onCancelOrComplete,this._getContext())},this._onRemoveMultipleMessages=e=>{this._actionTaken=L.SelectedMessagesActionType.Remove;const t=n.map(this.state.selectedMessages,(e=>e.message));y.default.deleteMultipleMessages(t,this._getRootViewId(),(()=>{this._onCancelOrComplete(),w.default.maybeAnnounceForAccessibility(f.getString("Global.RemoveMultipleMessages",{count:t.length}))}))},this._onCopyMultipleMessages=e=>{this._actionTaken=L.SelectedMessagesActionType.Copy,y.default.copyMultipleMessages(this.state.selectedMessages,this._getRootViewId()),this._onCancelOrComplete()},this._onCancelOrComplete=e=>{const t=!e,s=!!e&&e.length>0;if(t||s){this.props.onClosePanel(this._headerInitialPosition,this._actionsInitialPosition),P.default.deactivateSelectMessagesMode();const t=new C.SelectedMessagesTelemetry(this.props.conversationId,e?e.length:void 0,this.state.selectedMessages,this._actionTaken,this.state.commands);S.track(t)}}}_buildState(e,t){const s=R.default.isTabletUI(),i=this._getRootViewId(),o=(M.default.getDeviceOrientation(i),!1),r=P.default.getSelectedMessages(),l={leavePaddingForStatusBar:a.StatusBar.isOverlay()&&!1,statusBarHeight:b.default.statusBarHeight(),isLandscapeMobile:o,commands:{disabledCopy:!1,disabledForward:!1,disabledRemove:!1},selectedMessages:r,usePrimaryBackgroundColor:e.mobileUi||s,currentConversation:(0,c.default)().getConversation(e.conversationId)};let h;if(r.length>0&&l&&l.commands?n.each(r,(e=>{const t=this._isCommandDisabled([k.CommandTypes.Forward],e.actionMenuCommands),s=this._isCommandDisabled([k.CommandTypes.Remove],e.actionMenuCommands),i=this._isCommandDisabled([k.CommandTypes.Copy,k.CommandTypes.CopyLink,k.CommandTypes.CopyLocation,k.CommandTypes.CopyImage],e.actionMenuCommands);l.commands.disabledForward=l.commands.disabledForward||t,l.commands.disabledRemove=l.commands.disabledRemove||s,l.commands.disabledCopy=l.commands.disabledCopy||i})):(l.commands.disabledForward=!0,l.commands.disabledRemove=!0,l.commands.disabledCopy=!0),h=e.renderHeader?s?60:d.HeaderHeightCompositeBase:s?57:80,e.mobileUi&&!s){const t=70;h=e.renderHeader?t:void 0}if(this._containerHeightStyles=a.Styles.createViewStyle({height:h},!1),t&&(e.mobileUi?(this._headerInitialPosition=l.leavePaddingForStatusBar&&l.statusBarHeight>0?-70-l.statusBarHeight:-70,this._actionsInitialPosition=70+(e.bottomPadding||0)):(this._headerInitialPosition=-d.HeaderHeightCompositeExtended,this._actionsInitialPosition=(s?57:80)+(e.bottomPadding||0)),this._initialPosition=e.renderHeader?this._headerInitialPosition:this._actionsInitialPosition,e.panelAnimatedValue.setValue(this._initialPosition),this._innerMovingContainerYOffsetStyle=a.Styles.createAnimatedViewStyle({transform:[{translateY:e.panelAnimatedValue}]})),!e.mobileUi){const{left:e,right:t}=u.default.getSpacerWidths();l.leftDesktopSpacerWidth=e,l.rightDesktopSpacerWidth=t}return l}componentDidMount(){super.componentDidMount(),T.default.timing(this.props.panelAnimatedValue,{toValue:0,duration:r.Common.Duration.Default,easing:r.Easing.SkypeExpoOut5,useNativeDriver:!0}).start();const e=()=>{this.props.renderHeader&&this._cancelButton&&this._cancelButton.requestFocus()};n.delay(e,500)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this._countSelectedMessages(t.selectedMessages),o=this._countSelectedMessages(this.state.selectedMessages);this.props.renderHeader&&i!==o&&a.Accessibility.announceForAccessibility(f.getString("MessageStream.MessagesSelected",{count:o}))}_isCommandDisabled(e,t){return!!n.isUndefined(t)||n.intersection(e,t).length<=0}_countSelectedMessages(e){return n.filter(e,(e=>!e.forwardAlbumId||e.message.isAlbum())).length}render(){const e=this._countSelectedMessages(this.state.selectedMessages),t=f.getString("MessageStream.MessagesSelected",{count:e}),s=!this.props.mobileUi&&this.props.renderHeader;let i;0===e&&(i=f.getString("MessageStream.DisabledButtonNoSelection"));const n=f.getString("Global.ForwardButton"),r=f.getString("Global.RemoveLabel"),d=f.getString("MessageActionMenu.ShareMenuCopy"),c=f.getString("Global.CancelLabel"),u=i||(this.state.commands.disabledForward?f.getString("MessageStream.DisabledForward"):n),p=i||(this.state.commands.disabledRemove?f.getString("MessageStream.DisabledRemove"):r),g=i||(this.state.commands.disabledCopy?f.getString("MessageStream.DisabledCopy"):d),S=this._getButtonView(c,f.getString("Global.CancelLabel"),x.SkypeIcon.Cancel,this._onCancelMultipleMessages,void 0,!0),_=[N.container,this._containerHeightStyles,this._themeStyles.viewBorderStyle,this.state.usePrimaryBackgroundColor?this._themeStyles.primaryBackgroundColorStyle:this._themeStyles.buttonBackgroundColorStyle,this._innerMovingContainerYOffsetStyle,this.state.isLandscapeMobile?N.containerLandscape:void 0],y=[N.rightChildren];this.props.renderActions&&(_.push(N.containerBottom),y.push(N.centerChildrenAction),this.props.mobileUi&&y.push(N.centerChildrenActionSpacing)),this.props.renderHeader&&(this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&_.push(I.default.marginTopStyle(this.state.statusBarHeight)),_.push(N.containerHeader));const v=(0,o.jsx)(a.View,{style:N.leftChildren,children:S}),C=A.default.modernizeSmallPanelHeaderFontStyle(),T=N.modernizeHeaderConversationTypeTitleHeader,M=[N.modernizeHeaderConversationTypeTitleHeader.base,this.props.mobileUi?T.mobile:T.desktop,this._themeStyles.secondaryTextColorStyle],b=this.state.currentConversation&&this.state.currentConversation.isOneOnOne()?this.state.currentConversation.getOtherPartyMri():void 0,w=h.ConversationUtils.getConversationTitleForSelection({mri:this.props.conversationId,otherPartyMri:b}),P=(0,o.jsxs)(a.View,{style:[N.centerChildrenColumn,s?N.selectMessagesTitleHeader:void 0],accessibilityTraits:a.Types.AccessibilityTrait.Header,importantForAccessibility:a.Types.ImportantForAccessibility.Yes,children:[(0,o.jsx)(a.Text,{style:[D.default.flexNegativeOne,C,this._themeStyles.primaryTextColorStyle],numberOfLines:1,children:t}),(0,o.jsxs)(a.View,{style:N.centerChildrenRow,children:[(0,o.jsx)(m.default,{icon:h.ConversationUtils.getIconForConversation(this.state.currentConversation),color:this._themeColors.secondaryTextColor,size:x.IconSize.size14,style:N.iconPadding}),(0,o.jsx)(a.Text,{style:M,children:w})]})]});let k;if(this.props.renderHeader)k=(0,o.jsx)(a.View,{style:this.props.mobileUi?N.spacerDesktop:N.spacerMobile});else{const e=l.default.canForwardMessage()?this._getButtonView(n,u,x.SkypeIcon.ForwardItem,this._onForwardMultipleMessages,this.state.commands.disabledForward):void 0,t=this._getButtonView(d,g,x.SkypeIcon.Copy,this._onCopyMultipleMessages,this.state.commands.disabledCopy),s=this._getButtonView(r,p,x.SkypeIcon.Delete,this._onRemoveMultipleMessages,this.state.commands.disabledRemove),i=this.props.bottomPadding?[y,I.default.paddingBottomStyle(this.props.bottomPadding)]:y;k=(0,o.jsxs)(a.View,{style:i,children:[t,e,s]})}if(!this.props.mobileUi){const e=a.Styles.createViewStyle({minWidth:this.state.leftDesktopSpacerWidth},!1),t=a.Styles.createViewStyle({minWidth:this.state.rightDesktopSpacerWidth},!1);return(0,o.jsxs)(a.Animated.View,{style:_,children:[(0,o.jsx)(a.View,{style:[N.horizontalSpacer,e]}),(0,o.jsxs)(a.View,{style:[N.desktopContentContainer,this.props.renderActions?N.desktopContentContainerActions:void 0],children:[this.props.renderHeader?P:k,this.props.renderHeader?v:void 0]}),(0,o.jsx)(a.View,{style:[N.horizontalSpacer,t]})]})}return(0,o.jsxs)(a.Animated.View,{style:_,children:[this.props.renderHeader?v:void 0,this.props.renderHeader?P:void 0,k]})}_getButtonView(e,t,s,i,n,r){const l=this._themeColors.primaryIconColor,d=this._themeColors.iconHoverColor,c=(0,o.jsx)(g.default,{ref:r?this._onCancelButtonRef:void 0,icon:s,color:l,hoverColor:d,title:t,size:this._iconSize,onPress:i,style:N.buttonStyles,disabledOpacity:.2,disabled:n});let u=this.props.mobileUi?N.iconContainerWidthMobile:N.iconContainerWidthDesktop;const h=[this.props.renderActions?N.iconContainerActionsMobileBottom:N.iconContainer,u];let p;return r?(this.state.isLandscapeMobile&&h.push(N.closeButtonLandscape),this.props.mobileUi||(h.push(N.closeButtonDesktop),u=void 0)):p=(0,o.jsx)(B.Caption,{small:!this.state.isLandscapeMobile,style:D.default.flexNegativeOne,numberOfLines:1,accessibilityHidden:!0,textThemeColor:n?B.TextThemeColor.Disabled:B.TextThemeColor.Primary,children:e}),(0,o.jsxs)(a.View,{style:h,children:[c,p]})}cancelMultipleMessages(){this._actionTaken=L.SelectedMessagesActionType.Cancel,this._onCancelOrComplete()}}t.default=E},697231:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(317588)),a=s(154235),l=i.__importDefault(s(186325)),d=i.__importDefault(s(453761)),c=s(26703),u=i.__importStar(s(704704)),h=i.__importDefault(s(740794)),p=i.__importDefault(s(316026)),g=i.__importDefault(s(660401)),m=s(16549),S=i.__importDefault(s(20758)),_=s(641400),f=i.__importDefault(s(497910)),y=i.__importDefault(s(760989)),v=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"center",paddingHorizontal:50,paddingTop:20}),contentContainer:()=>n.Styles.createViewStyle({padding:20,borderRadius:10,marginTop:15,flexShrink:void 0}),closeButton:()=>n.Styles.createViewStyle({alignSelf:"flex-end",paddingTop:16}),buttonsWrapper:()=>n.Styles.createViewStyle({alignSelf:"center",alignItems:"center",flexDirection:"row",justifyContent:"center",paddingTop:10}),button:()=>n.Styles.createViewStyle({margin:10,minWidth:175}),image:()=>n.Styles.createViewStyle({height:122,width:160,marginBottom:20,alignSelf:"center"}),header:()=>n.Styles.createTextStyle({textAlign:"center"}),body:()=>n.Styles.createTextStyle({maxWidth:450,paddingTop:10})});class C extends f.default{constructor(){super(...arguments),this._removeSpeechConsentSuggestion=()=>{p.default.hideSpeechConsentSuggestion()},this._onTellMeMorePress=e=>{h.default.showSpeechConsentPanel({causeId:y.default.newCauseId(),rootViewId:this._getRootViewId()}),this._removeSpeechConsentSuggestion()},this._getContainerStyles=()=>{const e=[v.contentContainer];return this._useAccessibleTheme()&&e.push(n.Styles.createViewStyle({borderColor:this._useDarkTheme()?m.Color.white:m.Color.black,borderWidth:2},!0)),e}}_renderButtons(){return(0,o.jsxs)(n.View,{style:v.buttonsWrapper,children:[(0,o.jsx)(g.default,{style:v.button,buttonStyle:a.SXButtonStyle.ColorStroke,buttonSize:a.SXButtonSize.Medium,title:u.getString("SpeechConsentPanel.TellMeButton"),onPress:this._onTellMeMorePress}),(0,o.jsx)(g.default,{style:v.button,buttonStyle:a.SXButtonStyle.ColorStroke,buttonSize:a.SXButtonSize.Medium,title:this._getLabelForDismissSuggestionButton(),onPress:this._removeSpeechConsentSuggestion})]})}_getLabelForDismissSuggestionButton(){return p.default.lastTimeShowingSuggestion()?u.getString("SpeechConsentPanel.DontShowAgain"):u.getString("SpeechConsentPanel.MayBeLaterButton")}_getCloseButton(){return(0,o.jsx)(d.default,{onPress:this._removeSpeechConsentSuggestion,icon:_.SkypeIcon.ClosePanel,size:_.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,showHoverEffect:!0,style:v.closeButton,title:u.getString("Global.CloseButtonTitle")})}render(){return(0,o.jsxs)(n.View,{style:v.container,children:[(0,o.jsx)(l.default,{marginLeft:0,marginRight:0}),this._getCloseButton(),(0,o.jsxs)(n.View,{style:this._getContainerStyles(),children:[(0,o.jsx)(n.Image,{source:r.Collection.SPEECH_CONSENT_PROMPT,style:v.image,resizeMode:"contain"}),(0,o.jsx)(n.Text,{style:[v.header,S.default.panelHeaderFontStyle()],children:u.getString("SpeechConsentPanel.ConversationHeader")}),(0,o.jsx)(n.Text,{style:[v.header,v.body,S.default.bodyFontStyle()],children:u.getString("SpeechConsentPanel.ConversationBody")}),this._renderButtons()]})]})}}t.default=C},257044:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(340724)),a=s(26703),l=i.__importDefault(s(252089)),d=i.__importDefault(s(942724)),c=i.__importDefault(s(827361)),u=i.__importDefault(s(48076)),h=s(262725),p=i.__importDefault(s(497910)),g=(0,a.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10,paddingRight:0,paddingBottom:0,paddingLeft:0}),containerDesktop:()=>n.Styles.createViewStyle({marginLeft:50,marginRight:50}),containerTablet:()=>n.Styles.createViewStyle({marginLeft:50,marginRight:0}),whisker:()=>n.Styles.createViewStyle({flex:1,marginTop:5,marginBottom:5,marginLeft:0,marginRight:0,height:1,flexDirection:"row",opacity:.4}),whiskerLeft:()=>n.Styles.createViewStyle({marginRight:5}),whiskerRight:()=>n.Styles.createViewStyle({marginLeft:5}),whiskerAccessible:()=>n.Styles.createViewStyle({opacity:1}),thickerWhisker:()=>n.Styles.createViewStyle({height:2,opacity:.8}),text:()=>n.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:5,alignSelf:"center"})});class m extends p.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){return{isUsingStackNavigationContext:d.default.isUsingStackNavigationContext(),useTabletUI:u.default.isTabletUI(),text:e.textGetter?e.textGetter():e.text}}componentDidMount(){super.componentDidMount(),this.props.onMountItem&&this.props.onMountItem(this,this.props.focusStreamItemTextForMobileScreenReader)}focusItemForScreenReader(){this.isComponentMounted()&&this._componentRef&&this._componentRef.requestFocus()}render(){const e=[g.text,c.default.noWrap];this.props.dividerTypeIsLastRead&&!this._useAccessibleTheme()&&e.push(l.default.getTextColorStyleNoSubscription());const t=[g.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||t.push(this.state.useTabletUI?g.containerTablet:g.containerDesktop);const s=r.default.headerAccessibilityInfo(this.state.text);return(0,o.jsxs)(n.View,{style:t,ref:this._onComponentRef,tabIndex:-1,accessibilityLabel:s.accessibilityLabel,accessibilityTraits:s.accessibilityTraits,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,children:[this._whisker(g.whiskerLeft),(0,o.jsx)(h.Caption,{style:e,selectable:!1,messageStreamFontSize:this.props.messageStreamFontSize,accessibilityHidden:!0,children:this.state.text}),this._whisker(g.whiskerRight)]})}_whisker(e){if(this.props.dividerTypeIsLastRead){const t=[g.whisker,g.thickerWhisker,e];return this._useAccessibleTheme()?t.push(n.Styles.createViewStyle({backgroundColor:this._themeColors.primaryTextColor},!1)):t.push(l.default.getBackgroundColorStyleNoSubscription()),(0,o.jsx)(n.View,{style:t})}{const t=[g.whisker,this._themeStyles.secondaryViewColorStyle,e];return this._useAccessibleTheme()&&t.push(g.whiskerAccessible),(0,o.jsx)(n.View,{style:t})}}}t.default=m},108395:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(601976)),l=s(26703),d=i.__importStar(s(704704)),c=i.__importDefault(s(960282)),u=i.__importDefault(s(101820)),h=s(262725),p=i.__importDefault(s(497910)),g=(0,l.lazyProperties)({streamItemContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",overflow:"hidden",marginLeft:50,marginTop:8}),streamItemContainerComposite:()=>r.Styles.createViewStyle({marginLeft:50}),userNameText:()=>r.Styles.createTextStyle({flex:-1,marginRight:5})});class m extends p.default{_buildState(e,t){const s=n.compact(e.typingMris),i={compactedTypingMris:s,firstPersonTyping:void 0,secondPersonTyping:void 0,streamItemContainerHeight:Math.ceil(18*c.default.getContentSizeMultiplier())};return s.length>0&&(i.firstPersonTyping=a.default.getMemberShortNameForConversation(e.conversationId,s[0]),2===e.typingMris.length&&(i.secondPersonTyping=a.default.getMemberShortNameForConversation(e.conversationId,s[1]))),i}componentDidMount(){super.componentDidMount(),this.state.compactedTypingMris.length&&r.Accessibility.announceForAccessibility(d.getString("TypingIndicator.TypingAnnouncement"))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.compactedTypingMris.length&&!t.compactedTypingMris.length&&r.Accessibility.announceForAccessibility(d.getString("TypingIndicator.TypingAnnouncement"))}render(){const e=[g.streamItemContainer,r.Styles.createViewStyle({height:this.state.streamItemContainerHeight},!1)];return this.props.isUsingStackNavigationContext||e.push(g.streamItemContainerComposite),(0,o.jsx)(r.View,{style:e,children:this._renderOptionalTypingIndicator()})}_renderOptionalTypingIndicator(){if(this.state.compactedTypingMris.length)return[(0,o.jsx)(h.Caption,{style:g.userNameText,numberOfLines:1,children:this._getTypingText()},"caption"),(0,o.jsx)(u.default,{},"typingIndicator")]}_getTypingText(){return 1===this.state.compactedTypingMris.length&&this.state.firstPersonTyping?d.getString("TypingIndicator.OnePersonTyping",{typer:this.state.firstPersonTyping}):2===this.state.compactedTypingMris.length&&this.state.firstPersonTyping&&this.state.secondPersonTyping?d.getString("TypingIndicator.PeopleTyping",{peopleTyping:this.props.typingMris.length,firstTyper:this.state.firstPersonTyping,secondTyper:this.state.secondPersonTyping}):this.state.compactedTypingMris.length>2?d.getString("TypingIndicator.PeopleTyping",{peopleTyping:this.props.typingMris.length}):""}}t.default=m},101820:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(317588)),a=s(26703),l=i.__importDefault(s(497910));var d;!function(e){e[e.None=0]="None",e[e.Loop=1]="Loop"}(d||(d={}));const c=(0,a.lazyProperties)({newIndicatorImage:()=>n.Styles.createImageStyle({width:30,height:15,top:1,opacity:.8})});class u extends l.default{_buildState(e,t){const s={};return t&&(s.currentAnimationStep=d.None),s}componentDidMount(){super.componentDidMount(),this.setState({currentAnimationStep:d.Loop})}render(){if(this.state.currentAnimationStep===d.None)return null;let e;e=this._useAccessibleTheme()?this._useDarkTheme()?r.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:r.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:this._useDarkTheme()?r.Collection.TYPING_INDICATOR_NEXT_DARK:r.Collection.TYPING_INDICATOR_NEXT_LIGHT;const t=n.Styles.createViewStyle({width:75,height:15,overflow:"visible"},!1);return(0,o.jsx)(n.View,{style:t,children:(0,o.jsx)(n.Image,{style:c.newIndicatorImage,source:e,resizeMode:"contain"})})}}t.default=u},388401:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TodayBotRightPane=void 0;const i=s(197582),o=s(785893),n=s(667294),r=s(934797),a=s(298151),l=s(800153),d=i.__importDefault(s(916654)),c=s(736267),u=s(677982),h=s(526849),p=s(687441),g=s(197277),m=s(751365),S=s(342195),_=s(717775);t.TodayBotRightPane=(0,h.WithResub)((0,n.memo)((function({activeConversation:e,isArticleOpenedInApp:t,adVariation:s,suggestedChannels:i,nativeAdEnabled:u}){const h=(0,_.getAdsTelemetryStore)(),g=!t;(0,l.useRightPaneTelemetry)(e,g,t,a.RightPaneTelemetryOrigin.TodayBot,null==i?void 0:i.length);const{rootViewId:m}=(0,c.useCommonContext)();(0,n.useEffect)((()=>(h.generateSessionId(),()=>{h.clearSessionId()})),[]);const f=i?(0,o.jsx)(d.default,{suggestedChannels:i,activeConversationId:e},`${e}_suggestionscard`):void 0;return g?(0,o.jsx)(r.RightPaneWithAds,{sourceId:e,rootViewId:m,nativeAdEnabled:u,sidePaneAdVariation:s,nativeAdPlacementName:p.NativeAdPlacementName.TodayBotSidePane,rightPaneTelemetryOrigin:a.RightPaneTelemetryOrigin.TodayBot,betweenAdsContent:f,adOrigin:S.AdOrigin.TodayBot}):void 0})),(e=>{const{rightPaneSuggestedChannelsCount:t}=u.AppConfigStore.getS4LUiFeatures(),{todayBotSidePaneAdVariation:s,enableTodayBotSidePaneNativeAd:i}=u.AppConfigStore.getAdsFeatures(),o=(0,m.getUpsellRightPaneStore)(t).getItems(),n=e.activeConversation;return{activeConversation:n,isArticleOpenedInApp:(0,g.getRightPaneStore)().getIsArticleOpenedInApp(n),adVariation:s,suggestedChannels:o,nativeAdEnabled:i}}))},845745:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BookmarksPanelHeader=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(710427)),a=s(815146),l=i.__importDefault(s(453761)),d=i.__importDefault(s(970035)),c=s(26703),u=i.__importStar(s(704704)),h=i.__importDefault(s(740794)),p=i.__importDefault(s(942724)),g=i.__importDefault(s(450312)),m=i.__importDefault(s(20758)),S=s(641400),_=i.__importDefault(s(497910)),f=i.__importDefault(s(760989)),y=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1}),titleContainer:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,alignContent:"center",alignItems:"center"}),mobileTitleContainer:()=>n.Styles.createViewStyle({justifyContent:"center"}),title:()=>n.Styles.createTextStyle({font:m.default.font.uiDisplayBold,fontSize:m.default.controlFontSize.headerSizeSmall,flexShrink:1,paddingLeft:10}),mobileTitle:()=>n.Styles.createTextStyle({fontSize:m.default.controlFontSize.panelHeader,paddingLeft:3}),closeButton:()=>n.Styles.createButtonStyle({marginRight:12}),mobileCloseButton:()=>n.Styles.createViewStyle({marginLeft:10,marginRight:0}),spacer:()=>n.Styles.createViewStyle({width:32}),splitViewStyle:()=>n.Styles.createViewStyle({paddingLeft:20})});class v extends _.default{constructor(){super(...arguments),this._onClose=()=>{const e=f.default.newGuid();n.Accessibility.announceForAccessibility(u.getString("BookmarksConversation.BookmarksClosedAnnouncementText")),this.state.isUsingStackNavigationContext?h.default.goBack(e,this._getContext()):this.state.lastVisitedConversationId&&!this.state.isLeftPanelHiddenOnDesktop?h.default.navigateToConversation({causeId:e,convId:this.state.lastVisitedConversationId,origin:a.NavigationConversationOrigin.Search}):h.default.navigateToWelcomeScreen(e)}}_buildState(e,t){return{isUsingStackNavigationContext:p.default.isUsingStackNavigationContext(),lastVisitedConversationId:r.default.getLastVisitedConversationId(),isLeftPanelHiddenOnDesktop:g.default.isDesktopSplitNavStackCollapsed()}}render(){const e=this._getCloseButton(),t=this._getTitleElement(),s=(0,o.jsx)(n.View,{style:y.spacer});return this.state.isUsingStackNavigationContext?(0,o.jsxs)(n.View,{style:y.container,children:[e,t,s]}):(0,o.jsxs)(n.View,{style:y.container,children:[t,e]})}_getTitleElement(){const e=[y.title,this._themeStyles.primaryTextColorStyle],t=[y.titleContainer];return this.state.isUsingStackNavigationContext&&(e.push(y.mobileTitle),t.push(y.mobileTitleContainer)),this.state.isLeftPanelHiddenOnDesktop&&t.push(y.splitViewStyle),(0,o.jsxs)(n.View,{style:t,children:[(0,o.jsx)(d.default,{icon:S.SkypeIcon.Bookmarked,size:this.state.isUsingStackNavigationContext?S.IconSize.size18:S.IconSize.size28,color:this._themeColors.primaryTextColor,importantForAccessibility:n.Types.ImportantForAccessibility.No}),(0,o.jsx)(n.Text,{style:e,children:u.getString("BookmarksConversation.BookmarksChatTitle")})]})}_getCloseButton(){const e=[y.closeButton];return this.state.isUsingStackNavigationContext&&e.push(y.mobileCloseButton),(0,o.jsx)(l.default,{icon:S.SkypeIcon.ClosePanel,size:this.state.isUsingStackNavigationContext?S.IconSize.size24:S.IconSize.size32,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.iconHoverColor,style:e,onPress:this._onClose,title:u.getString("BookmarksConversation.CloseButtonLabel"),autoFocus:!0})}}t.BookmarksPanelHeader=v,t.default=v},973585:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeader=t.LandscapeButtonHeight=t.HeaderHeightModernizeChatSmallHeader=t.HeaderHeightMobileLandscape=t.PanelHeightMobileSmall=t.HeaderHeightMobile=t.HeaderHeightCompositeExtended=t.HeaderHeightCompositeBase=void 0;const i=s(197582),o=s(785893),n=s(496486),r=s(331654),a=i.__importDefault(s(994070)),l=i.__importStar(s(516778)),d=s(537180),c=s(344175),u=i.__importDefault(s(150343)),h=s(845745),p=s(619429),g=s(460515),m=i.__importDefault(s(859545)),S=i.__importDefault(s(556587)),_=i.__importStar(s(44717)),f=i.__importDefault(s(631681)),y=s(315742),v=s(154235),C=i.__importDefault(s(555436)),T=i.__importDefault(s(370914)),M=i.__importDefault(s(494118)),b=i.__importDefault(s(97467)),I=i.__importDefault(s(615364)),w=i.__importDefault(s(532821)),P=i.__importStar(s(170881)),k=i.__importDefault(s(601976)),A=s(815146),x=i.__importDefault(s(453761)),D=i.__importDefault(s(524526)),R=i.__importStar(s(85385)),L=i.__importDefault(s(214295)),B=s(26703),F=i.__importStar(s(704704)),N=i.__importDefault(s(50369)),E=i.__importDefault(s(416375)),O=i.__importDefault(s(341994)),U=i.__importDefault(s(363091)),V=i.__importDefault(s(740794)),H=i.__importDefault(s(942724)),j=i.__importDefault(s(450312)),z=i.__importDefault(s(960282)),W=i.__importDefault(s(117475)),G=i.__importDefault(s(377556)),K=i.__importDefault(s(523049)),q=i.__importStar(s(994962)),Q=i.__importDefault(s(374503)),X=s(376229),$=s(16549),J=s(641400),Y=i.__importStar(s(179582)),Z=i.__importDefault(s(827361)),ee=i.__importDefault(s(48076)),te=i.__importDefault(s(497910)),se=i.__importDefault(s(970029)),ie=i.__importStar(s(669327)),oe=s(596648),ne=i.__importDefault(s(746154)),re=i.__importDefault(s(685734)),ae=i.__importDefault(s(760989)),le=i.__importDefault(s(92179)),de=s(96575),ce=s(771840),ue=s(493680),he=s(154420),pe=s(953629),ge=i.__importDefault(s(139221)),me=i.__importDefault(s(369347)),Se=s(823102),_e=s(912871);t.HeaderHeightCompositeBase=97,t.HeaderHeightCompositeExtended=88,t.HeaderHeightMobile=70,t.PanelHeightMobileSmall=60,t.HeaderHeightMobileLandscape=44,t.HeaderHeightModernizeChatSmallHeader=59;t.LandscapeButtonHeight=32;const fe=(0,B.lazyProperties)({contentPanelHeader:()=>l.Styles.createViewStyle({flexDirection:"row",alignItems:"center",alignSelf:"stretch",justifyContent:"space-between",height:t.HeaderHeightMobile,overflow:"visible"}),contentPanelHeaderSmall:()=>l.Styles.createViewStyle({height:t.PanelHeightMobileSmall}),contentPanelGuestHeader:()=>l.Styles.createViewStyle({paddingLeft:16}),contentPanelHeaderLandscape:()=>l.Styles.createViewStyle({height:t.HeaderHeightMobileLandscape}),backButton:()=>l.Styles.createButtonStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:$.Color.transparent}),modernHeaderBackButton:()=>l.Styles.createButtonStyle({paddingLeft:0,paddingRight:0}),backButtonLandscapeNormalView:()=>l.Styles.createButtonStyle({height:52,paddingLeft:16,paddingRight:16}),backButtonModernizeSmallHeader:()=>l.Styles.createButtonStyle({height:t.HeaderHeightModernizeChatSmallHeader,paddingLeft:18,paddingRight:18}),headerControlsContainer:()=>l.Styles.createButtonStyle({flex:-1,alignSelf:"stretch",alignItems:"center",flexDirection:"row"}),headerButtonContainer:()=>l.Styles.createViewStyle({flex:1,overflow:"hidden",height:J.IconSize.default}),headerButtonInnerContainer:()=>l.Styles.createViewStyle({alignItems:"stretch",justifyContent:"center"}),headerButtonContainerLandscape:()=>l.Styles.createViewStyle({height:t.LandscapeButtonHeight}),leftControls:()=>l.Styles.createViewStyle({width:56,flexDirection:"row"}),userIconWrapper:()=>l.Styles.createButtonStyle({paddingRight:12}),tablet:()=>(0,B.lazyProperties)({contentPanelHeader:()=>l.Styles.createViewStyle({paddingLeft:20,paddingRight:5}),contentPanelHeaderAndroid:()=>l.Styles.createViewStyle({height:t.PanelHeightMobileSmall+1}),contentPanelHeaderWithIcon:()=>l.Styles.createViewStyle({paddingLeft:10}),headerButtonInnerContainer:()=>l.Styles.createViewStyle({alignSelf:"flex-start",overflow:"visible",height:J.IconSize.default}),conversationSwitcherIPad:()=>l.Styles.createViewStyle({height:X.SearchInputHeight.iOS}),conversationSwitcher:()=>l.Styles.createViewStyle({marginTop:-1})}),compositeNav:()=>(0,B.lazyProperties)({contentPanelHeader:()=>l.Styles.createViewStyle({paddingLeft:20,paddingRight:15,height:t.HeaderHeightCompositeBase}),contentPanelHeaderWithBackButton:()=>l.Styles.createViewStyle({paddingLeft:0}),contentPanelHeaderExperimental:()=>l.Styles.createViewStyle({height:t.HeaderHeightCompositeExtended}),headerButton:()=>l.Styles.createButtonStyle({alignSelf:"center",marginRight:10})}),modernizeSmallHeader:()=>(0,B.lazyProperties)({contentPanelHeader:()=>l.Styles.createViewStyle({paddingLeft:20,paddingRight:20}),contentPanelModernizedHeader:()=>l.Styles.createViewStyle({height:t.HeaderHeightModernizeChatSmallHeader}),smallPaddingControl:()=>l.Styles.createViewStyle({paddingRight:12}),headerButton:()=>l.Styles.createButtonStyle({alignSelf:"center",marginRight:10}),userIconWrapper:()=>l.Styles.createButtonStyle({paddingRight:12})})});class ye extends te.default{constructor(){super(...arguments),this._onContentPanelHeaderContainerRef=e=>{this._contentPanelHeaderContainerRef=e||void 0},this._anchorNavigateToDetailsPanel=()=>{const e=ae.default.newCauseId();R.log(A.LogTraceArea.Navigation,"ContentPanelHeader._anchorNavigateToDetailsPanel, causeId: "+e),this._intNavigateToDetailsPanel(e)},this._navigateToDetailsPanel=e=>{e&&e.stopPropagation();const t=ae.default.newCauseId();R.log(A.LogTraceArea.Navigation,"ContentPanelHeader._navigateToDetailsPanel, causeId: "+t),this._intNavigateToDetailsPanel(t)},this._onOpenMainWindowClick=()=>{const e=ae.default.newCauseId();R.log(A.LogTraceArea.Navigation,"ContentPanelHeader._openMainWindow, causeId: "+e);const t=this._getRootViewId();t!==v.MainRootViewId&&V.default.openMainWindow(!0,t,e)},this._onBackButtonClick=e=>{e.stopPropagation(),L.default.immediatelyResetUpdateInfo();const t=ae.default.newCauseId();le.default.createTrackerAndMarkPressTime(t,de.ScenarioName.ResponsivenessGoBackFromConversation,e),R.log(A.LogTraceArea.Navigation,"ContentPanelHeader._handleBackButtonClick, causeId: "+t),this.props.activeCallStatus===g.ActiveCallStatus.Connected&&ge.default.isEdgeShoreline()&&this.props.callId?me.default.CallNavigationHelper.answerOrJoinCall({conversationMri:this.state.conversationOwnerMri,callId:this.props.callId,knownToBeAnswer:!0,withVideo:!1,autoAnswer:!0,origin:A.NavigationCallOrigin.ConversationHeader},t):(V.default.goBack(t,this._getContext()),le.default.markActionDoneAndRemoveTracker(t))}}_buildState(e,t){const s=this._getRootViewId(),{enableGroupedConversations:i}=u.default.getS4LMessagingFeatures(),{enableMessageTranslation:o,enableTranslatorBotDeprecation:n,translatorBotDeprecationDate:a,translatorAgentId:d}=u.default.getS4LCMCFeatures(),c=(0,I.default)().getConversation(e.conversationId),h=H.default.isUsingStackNavigationContext(),g=_.isEncryptedThread(e.conversationId),S=ee.default.isTabletUI(),f=S?r.DeviceOrientation.Portrait:z.default.getDeviceOrientation(s),y=f===r.DeviceOrientation.Landscape,T=h||S||z.default.isTinyScreenSizeNoSubscription(s);let M=c&&c.isEncryptedThread()?c.getOtherPartyMriOrConvId():e.conversationId;if(null==c?void 0:c.isV2OneToOneThread()){const e=null==c?void 0:c.getOtherPartyMriForOneToOneThread();e&&(M=e)}const b=re.default.getConversationOwner(M),P=C.default.isConversationAccepted(b),A=c&&c.isOneOnOne()&&(_.isMriWithUserMetadata(b)||e.otherPartyMri&&_.isMriWithUserMetadata(e.otherPartyMri))&&(P||e.otherPartyMri&&_.isS4BBridgeMri(e.otherPartyMri)),x=_.isPhoneMri(e.conversationId)&&_.isOneOnOneConversation(e.conversationId),R=U.default.isGuestUser(),L=_.isGalleryInConversationSupported(e.conversationId)&&(A&&!_.isS4BBridgeMri(e.conversationId)||!e.otherPartyMri),B=!e.hideBackButton&&!R&&(this._getContext().isPresentedByMobileStackNavigator||this._getRootViewType()===v.RootViewType.SplitViewContent||w.default.collapseDesktopStackNavContext()&&j.default.isDesktopSplitNavStackCollapsed());return Object.assign(Object.assign({conversationOwnerMri:b,conversationName:c?k.default.getDisplayName(c.id):"",isMinDesktopWidth:z.default.isMinDesktopWidth(s),uiOrientation:f,leavePaddingForStatusBar:l.StatusBar.isOverlay()&&(f===r.DeviceOrientation.Portrait||!h),statusBarHeight:W.default.statusBarHeight(),useMobileUI:T,showConversationIcon:S&&!B,useTabletUI:S,isEncryptedThread:g,isGalleryEnabled:L,shouldShowUserPresence:A,shouldShowCallRate:x,showBackButton:B,showConversationSwitcher:i,hideBotCoachMarks:_.getMriNamespace(e.conversationId)===_.Namespaces.Bot,isGuestUser:R,isLandscape:y},ye._getScheduledCallState(e.conversationId,y,T)),{isTranslationFeatureEnabled:o,isTranslatorBotDeprecationEnabled:n,translatorBotDeprecationDate:a,canAccessConversationDetails:m.default.navigation().canAccessConversationDetails,translationState:D.default.getConversationTranslationState(e.conversationId)||p.TranslationState.Disabled,isThreadWithTranslatorBot:c&&c.hasSpecificAgentMember(d)&&c.getMemberMrisWithoutMe().length>1,isModernizeChatHeaderMobile:N.default.modernizeChatHeaderMobileVersion(),isMagicBot:(0,ue.isMagicBotConversation)(e.conversationId),isMyBot:_.isMyBotConversation(e.conversationId)})}componentDidMount(){super.componentDidMount(),this._newConversationSetup(),this._contentPanelHeaderContainerRef&&this._contentPanelHeaderContainerRef.setFocusLimited(!!this.props.preventAccessibilityFocus)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),e.conversationId!==this.props.conversationId&&(this._oldConversationCleanup(),this._newConversationSetup()),this.props.preventAccessibilityFocus!==e.preventAccessibilityFocus&&this._contentPanelHeaderContainerRef&&this._contentPanelHeaderContainerRef.setFocusLimited(!!this.props.preventAccessibilityFocus)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s)}componentWillUnmount(){super.componentWillUnmount(),this._oldConversationCleanup()}_oldConversationCleanup(){this._finishedSyncingSubscriptionToken&&(this._finishedSyncingSubscriptionToken.unsubscribe(),this._finishedSyncingSubscriptionToken=void 0),(0,Se.deletePeregrineTelemetryClient)(this.props.conversationId)}_newConversationSetup(){S.default.forceThreadDetailsFetchIfNeeded(this.props.conversationId),this._finishedSyncingSubscriptionToken=S.default.finishedSyncingConversation.subscribe((e=>{e===this.props.conversationId&&S.default.forceThreadDetailsFetchIfNeeded(this.props.conversationId)}))}_getLeftIcon(e=!1){let t,s,i,n,r=[fe.backButton];const a=this._themeColors.iconPrimary,l=this._themeColors.iconPrimary;return this.state.isModernizeChatHeaderMobile?e?(r=[...r,fe.backButtonModernizeSmallHeader],n=J.IconSize.size20):(r=[...r,fe.backButtonLandscapeNormalView],n=J.IconSize.size24):(r=[...r,fe.backButtonModernizeSmallHeader],n=J.IconSize.size16),this._getRootViewType()===v.RootViewType.SplitViewContent?(t=J.SkypeIcon.Menu,s=F.getString("CallPanel.OpenRecentsButtonTitle"),i=this._onOpenMainWindowClick):(t=this.props.contextConversationId?Y.closeIcon():Y.backIcon(),s=F.getString("Global.BackButtonTitle"),i=this._onBackButtonClick),(this.state.isMagicBot||this.state.isMyBot)&&(r=[...r,fe.modernHeaderBackButton]),(0,o.jsx)(x.default,{style:r,size:n,onPress:i,color:a,hoverColor:l,icon:t,title:s})}_getLeftControls(e){return(0,o.jsx)(l.View,{children:this._getLeftIcon(e)},"leftcontrols")}_getHeaderStyles(e){const s=[fe.contentPanelHeader,this.props.style,this._themeStyles.messageStreamBackgroundColorStyle,l.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)];if(this.state.useMobileUI)this.state.useTabletUI?(s.push(fe.tablet.contentPanelHeader),this.state.showConversationIcon&&s.push(fe.tablet.contentPanelHeaderWithIcon)):(this.state.isGuestUser||this.props.hideBackButton)&&s.push(fe.contentPanelGuestHeader),e?s.push(fe.contentPanelHeaderLandscape):s.push(fe.contentPanelHeaderSmall),s.push(fe.modernizeSmallHeader.smallPaddingControl),this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&s.push(G.default.marginTopStyle(this.state.statusBarHeight)),this.props.safeAreaHorizontalInsets&&G.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&s.push(G.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets));else{s.push([fe.modernizeSmallHeader.contentPanelHeader,this.state.showBackButton?fe.compositeNav.contentPanelHeaderWithBackButton:void 0]),s.push(fe.compositeNav.contentPanelHeaderExperimental);let e=0;this.state.leavePaddingForStatusBar&&this.state.statusBarHeight&&(e+=this.state.statusBarHeight,s.push(G.default.heightStyle(t.HeaderHeightCompositeExtended+this.state.statusBarHeight))),this.state.useTabletUI&&(e+=10),e&&s.push(G.default.paddingTopStyle(e)),this.props.safeAreaHorizontalInsets&&G.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&s.push(G.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets))}return s.push(fe.modernizeSmallHeader.contentPanelModernizedHeader),{headerStyles:s,headerWrapperStyle:[]}}_getChatIcon(){const e=this.state.canAccessConversationDetails;return(0,o.jsx)(l.Button,{style:fe.modernizeSmallHeader.userIconWrapper,onPress:e?this._navigateToDetailsPanel:void 0,importantForAccessibility:l.Types.ImportantForAccessibility.NoHideDescendants,accessibilityLabel:F.getString("MyProfilePanel.UserAvatarAccessibilityLabel",{user:this.state.conversationName}),children:(0,o.jsx)(ne.default,{mri:this.props.otherPartyMri||this.props.conversationId,isOneOnOne:!!this.props.otherPartyMri,size:oe.AvatarIconSize.Size40,showStatus:!1,statusBorderColor:this._themeColors.primaryBackgroundColor})},"leftcontrols-chaticon")}_getControlsContent(e,t){let s;const i=this._getChatIcon();if(this.state.useMobileUI){const r=[fe.headerButtonContainer];t&&r.push(fe.headerButtonContainerLandscape);const a=[fe.headerButtonInnerContainer];this.state.useTabletUI?a.push(fe.tablet.headerButtonInnerContainer):a.push(...r);const d=t,c=this.state.canAccessConversationDetails,u=(0,o.jsx)(l.View,{style:r,children:(0,o.jsx)(l.View,{style:a,children:(0,o.jsx)(E.default,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,colorThemeOverride:this._currentTheme,hideSecondRow:d,deviceOrientation:this.state.uiOrientation,shouldShowUserPresence:this.state.shouldShowUserPresence,shouldShowCallRate:this.state.shouldShowCallRate,hidePresenceIndicator:this.state.showConversationIcon,onTitlePress:c?this._navigateToDetailsPanel:void 0,conversationOwnerMri:this.state.conversationOwnerMri,isModernizeSmallHeaderMobile:this.state.isModernizeChatHeaderMobile})})},"centercontrols");s=(0,n.compact)([e,i,u])}else s=(0,o.jsxs)(l.View,{style:fe.headerControlsContainer,children:[e,i,this.state.hideBotCoachMarks?this._renderPanelHeader():this._renderCoachMarkPanelHeader()]},"controlscontent");return s}_renderOptionalGroupSwitcher(){return this._shouldRenderTabSwitcher()&&this.props.otherPartyMri?(0,o.jsx)(b.default,{style:this.state.useTabletUI?fe.tablet.conversationSwitcher:void 0,heightStyle:void 0,mri:this.props.otherPartyMri,currentConversationId:this.props.conversationId,safeAreaHorizontalInsets:this.props.safeAreaHorizontalInsets,preventAccessibilityFocus:this.props.preventAccessibilityFocus}):void 0}_renderOptionalScheduledCallBanner(){return this.state.scheduledCall&&this.state.shouldRenderScheduledCallBanner?(0,o.jsx)(K.default.ScheduledCallConversationBanner,{scheduledCall:this.state.scheduledCall}):void 0}_renderOptionalTranslationBanner(){return this.state.isTranslationFeatureEnabled&&this.state.translationState!==p.TranslationState.Disabled?(0,o.jsx)(se.default,{conversationId:this.props.conversationId,conversationName:this.state.conversationName}):void 0}_renderOptionalDeprecationTranslationBanner(){return this.state.isTranslatorBotDeprecationEnabled&&this.state.isThreadWithTranslatorBot?(0,o.jsx)(se.default,{conversationId:this.props.conversationId,conversationName:this.state.conversationName,translatorBotDeprecationDate:this.state.translatorBotDeprecationDate,isDeprecated:!0}):void 0}_renderCallControlButtons(){return(0,o.jsx)(T.default,{conversationOwnerMri:this.state.conversationOwnerMri,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,callId:this.props.callId,callJoinContext:this.props.callJoinContext,activeCallStatus:this.props.activeCallStatus,hasActiveCall:this.props.hasActiveCall,onCallStartedAnsweredOrJoined:this.props.onCallStartedAnsweredOrJoined,preventAccessibilityFocus:this.props.preventAccessibilityFocus,localAddressBookPhones:this.props.localAddressBookPhones,isGalleryEnabled:this.state.isGalleryEnabled,isMessageSearchPanelEnabled:this.props.isMessageSearchPanelEnabled,onToggleMessageSearchPanel:this.props.onToggleMessageSearchPanel,onGalleryPressed:this.props.onGalleryPressed,isMessageSearchPanelVisible:this.props.isMessageSearchPanelVisible,inviteToken:this.props.inviteToken})}render(){if(!(!this.state.isMagicBot&&!this.state.isMyBot)){let e,t=(0,o.jsx)(o.Fragment,{});return this.state.isMagicBot&&(t=(0,o.jsx)(ce.MagicBotHeaderTitle,{conversationId:this.props.conversationId,onPress:this.state.canAccessConversationDetails?this._navigateToDetailsPanel:void 0},"title"),e=(0,o.jsx)(ce.MagicBotConversationControls,{openToolboxByDefault:this.props.openMagicBotToolboxByDefault})),this.state.isMyBot&&(t=(0,o.jsx)(he.MyBotHeaderTitle,{conversationId:this.props.conversationId,onPress:this.state.canAccessConversationDetails?this._navigateToDetailsPanel:void 0},"title"),e=(0,o.jsx)(pe.MyBotConversationControls,{conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,hasActiveCall:this.props.hasActiveCall,isGalleryEnabled:!0,onGalleryPressed:this.props.onGalleryPressed})),(0,o.jsx)(d.SafeAreaView,{children:(0,o.jsx)(c.Row,{height:59,children:(0,o.jsx)(_e.EntityHeader,{CardControl:t,PreCardControls:this.state.showBackButton?this._getLeftControls(this.state.isLandscape):void 0,Controls:e})})})}const e=this.props.preventAccessibilityFocus?l.Types.ImportantForAccessibility.NoHideDescendants:void 0,t=this._getHeaderStyles(this.state.isLandscape),s=this.state.showBackButton?this._getLeftControls(this.state.isLandscape):void 0;if(_.isBookmarkConversation(this.props.conversationId)){const e=this.state.useMobileUI?void 0:this._themeStyles.secondaryBackgroundColorStyle;return(0,o.jsx)(l.View,{style:[t.headerWrapperStyle,e],children:(0,o.jsx)(l.View,{style:[t.headerStyles,e],children:(0,o.jsx)(h.BookmarksPanelHeader,{})})})}return(0,o.jsxs)(l.View,{style:t.headerWrapperStyle,ref:this._onContentPanelHeaderContainerRef,onLayout:this.props.onLayout,limitFocusWithin:l.Types.LimitFocusType.Limited,children:[(0,o.jsxs)(l.View,{style:t.headerStyles,importantForAccessibility:e,children:[this._getControlsContent(s,this.state.isLandscape),this._renderCallControlButtons()]}),this._renderOptionalGroupSwitcher(),this._renderOptionalScheduledCallBanner(),this._renderOptionalTranslationBanner(),this._renderOptionalDeprecationTranslationBanner()]})}_renderCoachMarkPanelHeader(){let e=F.getString("ContentPanelHeader.ProfileButtonAccessibilityLabel",{conversationName:this.state.conversationName});this.state.isEncryptedThread&&(e+=","+F.getString("ContentPanelHeader.PrivateConversationLabel"));const t={coachMarkType:y.CoachMarkType.ChatProfile,onAnchorPress:this._anchorNavigateToDetailsPanel,anchorAccessibilityLabel:e},s=[fe.headerControlsContainer,fe.compositeNav.headerButton,Z.default.pointerCursor];return this.state.isMinDesktopWidth&&s.push(Z.default.flexOne),(0,o.jsx)(f.default.View,Object.assign({style:s,disableTouchOpacityAnimation:!0},t,{children:this._renderPanelHeader()}),"centercontrols")}_renderPanelHeader(){const e=this.state.canAccessConversationDetails;return(0,o.jsx)(l.View,{style:Z.default.flexOne,children:(0,o.jsx)(M.default,{onPress:e?this._navigateToDetailsPanel:void 0,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,useTabletUI:this.state.useTabletUI,shouldShowUserPresence:this.state.shouldShowUserPresence,shouldShowCallRate:this.state.shouldShowCallRate,hidePresenceIndicator:this.state.showConversationIcon,hideSecondRow:!1,preventAccessibilityFocus:!e||this.props.preventAccessibilityFocus,colorThemeOverride:this._currentTheme,onToggleMessageSearchPanel:this.props.onToggleMessageSearchPanel,onGalleryPressed:this.props.onGalleryPressed,isMessageSearchPanelEnabled:this.props.isMessageSearchPanelEnabled,conversationOwnerMri:this.state.conversationOwnerMri})},"centercontrols")}_shouldRenderTabSwitcher(){return this.state.showConversationSwitcher&&!!this.props.otherPartyMri&&!this.props.hideConversationSwitcher}_intNavigateToDetailsPanel(e){R.log(A.LogTraceArea.Navigation,"ContentPanelHeader._intNavigateToDetailsPanel, causeId: "+e),a.default.isSupported()&&P.dismissAll(),ie.userProfileViewed(this.props.conversationId),this.props.onOpenDropdown?this.props.onOpenDropdown():V.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})}static _getScheduledCallState(e,t,s){const i=q.default.getUpcomingScheduledCallsByConversationId(e);let o,n=!1;if(i){const e=O.default.getScheduledCallsBannerDismissStates()||{};o=i.find((i=>{const o=e[i.id];return n=Q.default.shouldRenderScheduledCallBanner(t,s,q.ExpirationGracePeriodMs,i,o)}))}return{scheduledCall:o,shouldRenderScheduledCallBanner:n}}}t.ContentPanelHeader=ye,t.default=ye},370914:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeaderButtons=t.LandscapeButtonHeight=t.HeaderHeightCompositeExtended=t.HeaderHeightCompositeBase=void 0,t.shouldUseGradientBackgroundButton=Te;const i=s(197582),o=s(785893),n=s(331654),r=s(854646),a=i.__importStar(s(516778)),l=i.__importStar(s(496486)),d=s(148540),c=i.__importDefault(s(179075)),u=i.__importDefault(s(206483)),h=i.__importDefault(s(150343)),p=i.__importDefault(s(369347)),g=s(619429),m=i.__importDefault(s(549173)),S=s(873324),_=s(460515),f=i.__importDefault(s(859545)),y=i.__importStar(s(44717)),v=s(154235),C=i.__importDefault(s(373861)),T=i.__importDefault(s(615364)),M=s(535973),b=i.__importDefault(s(260928)),I=i.__importStar(s(170881)),w=i.__importDefault(s(546467)),P=i.__importDefault(s(732028)),k=s(379878),A=i.__importDefault(s(421852)),x=s(815146),D=i.__importStar(s(800662)),R=i.__importStar(s(85385)),L=s(26703),B=i.__importStar(s(704704)),F=i.__importDefault(s(455907)),N=s(966666),E=i.__importDefault(s(443333)),O=s(675862),U=i.__importDefault(s(252089)),V=i.__importDefault(s(201721)),H=i.__importDefault(s(740794)),j=i.__importDefault(s(942724)),z=s(113002),W=i.__importDefault(s(960282)),G=i.__importDefault(s(223815)),K=s(240804),q=i.__importDefault(s(660401)),Q=s(16549),X=i.__importDefault(s(139221)),$=s(641400),J=i.__importDefault(s(20758)),Y=i.__importDefault(s(48076)),Z=i.__importDefault(s(497910)),ee=i.__importStar(s(669327)),te=i.__importDefault(s(363091)),se=i.__importDefault(s(760989)),ie=i.__importDefault(s(288547)),oe=i.__importDefault(s(299137)),ne=i.__importDefault(s(379363)),re=i.__importDefault(s(808164)),ae=i.__importDefault(s(535174)),le=i.__importDefault(s(872263)),de=s(96737),ce=s(315742),ue=s(491839),he=s(184971),pe=s(539058),ge=s(803193),me=i.__importDefault(s(823548)),Se=i.__importDefault(s(555436)),_e=$.IconSize.size40,fe=$.IconSize.size32,ye=$.IconSize.size20;t.HeaderHeightCompositeBase=97,t.HeaderHeightCompositeExtended=100,t.LandscapeButtonHeight=32;const ve=(0,L.lazyProperties)({modernizeIconContainer:()=>a.Styles.createViewStyle({width:fe,height:fe,borderRadius:fe/2}),modernizeIconContainerWithBackground:()=>a.Styles.createViewStyle({width:_e,height:_e,borderRadius:_e/2}),controls:()=>a.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end"}),rightIconMargin:()=>a.Styles.createViewStyle({marginRight:8}),leftIconMargin:()=>a.Styles.createViewStyle({marginLeft:8}),leftIconMarginControl:()=>a.Styles.createViewStyle({marginLeft:4}),backgroundStyle:()=>({paddingLeft:15,paddingRight:20}),modernizedBackgroundStyle:()=>({paddingLeft:10,paddingRight:14}),modernizeMoreOptionsIconButton:()=>a.Styles.createViewStyle({width:$.IconSize.size20,marginLeft:8,marginRight:0}),compositeNav:()=>(0,L.lazyProperties)({controlsContainer:()=>a.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),headerButtonHover:()=>a.Styles.createViewStyle({opacity:.8}),gradientViewStyle:()=>a.Styles.createViewStyle({borderRadius:fe/2}),leftIconMargin:()=>a.Styles.createViewStyle({marginLeft:10})}),unsubscribeSubscribeButton:()=>a.Styles.createTextStyle({fontSize:J.default.controlFontSize.smallButton,fontFamily:J.default.fontFamily.uidDisplayRegular})});class Ce extends Z.default{constructor(){super(...arguments),this._ignoreDisposingCallObserving=!1,this.handleFocusEvent=e=>(R.log(x.LogTraceArea.ContentPanel,"ContentPanelHeaderButton.handleFocusEvent: "+e),!(e!==D.FocusEvent.OpenGoLiveNotification||!this._joinButton)&&(this._joinButton.requestFocus(),!0)),this._onJoinButtonRef=e=>{this._joinButton=e||void 0},this._onMoreOptionsButtonPress=()=>{if(!this._moreOptionsButtonRef)return;const e=this._getRootViewId(),t=se.default.newCauseId();ie.default.showWithContent({rootViewId:e,anchor:()=>this._moreOptionsButtonRef,content:(0,o.jsx)(oe.default,{onRowPress:()=>ie.default.close(e,t),descriptors:this._getExtendedChatControlsDescriptors()}),menuId:"more_options_header_menu",menuWidth:210,borderRadius:10,togglable:!0,onCloseMenu:()=>{ie.default.close(this._getRootViewId(),t)}},t)},this._onImageCreatorButtonPress=()=>{(0,de.navigateToImageGeneration)(this._getRootViewId(),pe.ImageGenerationOrigin.ContentPanelHeader)},this._onMoreOptionsButtonRef=e=>this._moreOptionsButtonRef=e||void 0,this._getAudioCallIcon=()=>this.state.multipleAudioCallOptionsAvailable?$.SkypeIcon.CallOptions:y.isPhoneMri(this.props.conversationId)?$.SkypeIcon.SkypeOut:$.SkypeIcon.CallStart,this._onJoinOrStartAudioCall=()=>this._onStartCall(!1),this._onStartVideoCall=()=>this._onStartCall(!0),this._onAddContact=()=>{if(I.dismissAll(),ee.contactAdded(this.props.conversationId),this.props.otherPartyMri){const e=this.state.skypeUserOwnerMri?[this.state.skypeUserOwnerMri]:[this.props.otherPartyMri];new b.default({peopleType:this.state.enableMyBot?K.PeopleType.AllExcludingMyBot:K.PeopleType.All,filterPeopleType:K.FilterType.GroupCapable,navigationOrigin:x.NavigationConversationOrigin.HeaderButtonNewGroupWithUser,invitedUsersMris:e,wizardSteps:[z.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else{new b.default({convId:y.asSkypeThreadIdMaybe(this.props.conversationId),navigationOrigin:x.NavigationConversationOrigin.HeaderButtonAddUserToGroup,peopleType:this.state.enableMyBot?K.PeopleType.AllExcludingMyBot:K.PeopleType.All,filterPeopleType:K.FilterType.GroupCapable,wizardSteps:[z.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}},this._onUnsubscribePress=()=>{u.default.showConfirmationAlert(B.getString("UserSettingsPanel.UnsubscribeEngagementBotTitle"),B.getString("UserSettingsPanel.UnsubscribeEngagementBotDescription"),B.getString("Global.Unsubscribe"),(()=>{w.default.archiveEngagementBot(this.props.conversationId,this._getRootViewId(),x.ArchiveConversationOrigin.ConversationHeader),V.default.setUserPreferencesLocal({enableInAppEngagementNotifications:!1,enablePushEngagementNotifications:!1})}),this._getRootViewId())},this._onSubscribePress=()=>{w.default.unarchiveEngagementBot(this.props.conversationId,j.default.isUsingStackNavigationContext(),this._getContext(),x.UnarchiveConversationOrigin.ConversationHeader),V.default.setUserPreferencesLocal({enableInAppEngagementNotifications:!0,enablePushEngagementNotifications:!0})},this._onStartCallPressed=()=>{R.log(x.LogTraceArea.JoinLink,"ContentPanelHeader._onStartCallPressed"),F.default.beginTrackingJoinMeetNow(N.MeetNowOrigin.CallPanel),H.default.navigateToCallPreviewView({conversationMri:this.props.conversationId,callOrigin:x.NavigationCallOrigin.ConversationHeader,isGoLive:!0})},this._onDontStartCall=()=>R.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader call button disabled"),this._onCallButtonRef=e=>{this._callButton=e||void 0},this._getCallButtonRef=()=>this._callButton}_buildState(e,t){const s=(0,T.default)(),i=s.getConversation(e.conversationId),o=j.default.isUsingStackNavigationContext(),r=y.isEncryptedThread(e.conversationId),a=Y.default.isTabletUI(),l=a?n.DeviceOrientation.Portrait:W.default.getDeviceOrientation(this._getRootViewId()),d=!!e.callId&&p.default.CallingStore.isCallIncoming(e.callId),u=e.conversationOwnerMri&&y.isSkypeIdMri(e.conversationOwnerMri)?e.conversationOwnerMri:void 0,m=u&&M.ConversationUtils.hasMultipleAudioCallOptions(u),S=h.default.getS4LCMCFeatures(),{conciergeBotSettings:_}=h.default.getEngagementFeatures(),v=y.getPhoneNumberFromMri(e.conversationId),C=ae.default.callerIdWarningForCountryByPhoneNumber(v),b=!(null==i?void 0:i.isEncryptedThread())&&(i&&Se.default.isIncomingContactInvitePending(i.id)||!!e.inviteToken&&e.otherPartyMri&&!Se.default.isContact(e.otherPartyMri)),I=_.enableVisibility&&y.isConciergeBotMri(e.conversationId),w=y.isReadOnlyConversation(e.conversationId)||I,A={isMinDesktopWidth:W.default.isSmallOrTinyScreenSize(this._getRootViewId()),uiOrientation:l,userColor:U.default.getPrimaryColor(),isUserBlocked:s.isConversationBlocked(i),isUserCreator:(null==i?void 0:i.creator())===te.default.getSkypeMri(),isBlockedPSTNMri:y.isBlockedPSTNMri(e.conversationId),isOutgoingVideoDisabled:p.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),showActiveCall:!d,useMobileUI:o,useTabletUI:a,isEncryptedThread:r,canInvitePeople:f.default.contacts().canInvitePeople,isCallIncoming:d,multipleAudioCallOptionsAvailable:m,enableJoinerCallPreview:S.enableJoinerCallPreview&&y.isGroupConversation(e.conversationId),hasActiveGoLive:!!i&&i.hasGoLive(),isPSTNGroup:M.ConversationUtils.isPSTNGroup(i),skypeUserOwnerMri:u,alwaysNavigateToLobby:null==i?void 0:i.isGroupConversation(),isGroupConversation:null==i?void 0:i.isGroupConversation(),isRegularMemberInModeratedGroup:i&&(0,O.isRegularMemberInModeratedGroup)(i),isConciergeBot:y.isConciergeBotMri(e.conversationId),isNewsChannel:(0,ge.isContentChannel)(i),isNewsBot:(0,ge.isTodayBot)(e.conversationId),isBookmark:y.isBookmarkConversation(e.conversationId),isSendImCapable:!!i&&me.default.isSendImCapable(i),isIncomingContactInvitePending:b,isReadOnlyConversation:w,enableInAppEngagementNotifications:!!V.default.getUserPreferencesLocal().enableInAppEngagementNotifications,enableObservingCall:S.enableObservingCall,callState:e.callId?p.default.CallingStore.getCallState(e.callId):void 0,enableContentPanelHeaderButtonsSubscribeToCallOnMount:S.enableContentPanelHeaderButtonsSubscribeToCallOnMount,enableMyBot:h.default.getS4LMessagingFeatures().enableMyBot,enableImageCreator:h.default.getS4LMessagingFeatures().enableImageCreator,shouldInactivateControlsAfterEndedCall:(0,ne.default)().shouldInactivateControlsAfterEndedCall(e.conversationId),callerIdWarning:C},x=y.isAgent(e.conversationId);A.isCallingCapable=!!i&&(!x||!i||c.default.isCallingCapable(i.id));const D=A.useMobileUI||!u&&!!y.isPhoneMri(e.conversationId)||y.isS4BBridgeMri(e.conversationId);A.canAddParticipant=!D&&(!x||!i||c.default.isGroupCapable(i.id));const R=r&&P.default.getHandshakeState(e.conversationId)!==k.SecureHandshakeState.Completed,L=A.skypeUserOwnerMri?A.skypeUserOwnerMri:e.conversationId;return A.skypeUserOwnerMri?A.isOutgoingCallingDisabled=!p.default.CallNavigationHelper.isOutgoingCallingAllowed(L):A.isOutgoingCallingDisabled=R||!p.default.CallNavigationHelper.isOutgoingCallingAllowed(L),A.isCallingDisabled=!p.default.CallNavigationHelper.isCallingAllowed(L),A.isOutgoingCallingDisabled?(A.outgoingCallingDisabledReason=p.default.CallNavigationHelper.whyOutgoingCallingIsNotAllowed(L),!A.outgoingCallingDisabledReason&&R&&(A.outgoingCallingDisabledReason=g.CallValidationFailureReason.E2eeHandshakeIncomplete)):A.outgoingCallingDisabledReason=void 0,A.isCallingDisabled&&(A.callingDisabledReason=p.default.CallNavigationHelper.whyCallingIsNotAllowed(L)),A.noCameraFound=!p.default.DeviceStore.hasCameras(),A}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isOutgoingCallingDisabled===t.isOutgoingCallingDisabled&&this.props.conversationId===e.conversationId||R.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader calling changed to "+(this.state.isOutgoingCallingDisabled?"disabled ":"allowed")+(this.state.isOutgoingCallingDisabled?" reason: "+this.state.outgoingCallingDisabledReason:"")),this.state.noCameraFound!==t.noCameraFound&&R.log(x.LogTraceArea.Calling,"ContentPanelHeaderButtons: noCamerasFound changed to: "+this.state.noCameraFound)}componentDidMount(){super.componentDidMount();const e=se.default.newCauseId();R.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader calling "+(this.state.isOutgoingCallingDisabled?"disabled ":"allowed")+(this.state.isOutgoingCallingDisabled?" reason: "+this.state.outgoingCallingDisabledReason:"")+"causeId: "+e),R.log(x.LogTraceArea.Calling,"ContentPanelHeaderButtons: noCamerasFound: "+this.state.noCameraFound),this._joinButton&&D.register(D.FocusEvent.OpenGoLiveNotification,this),this.state.enableObservingCall&&this.props.callId&&this.props.callJoinContext&&this.state.callState===d.CallState.None&&this.state.enableContentPanelHeaderButtonsSubscribeToCallOnMount&&p.default.CallingStore.subscribeToCall(this.props.conversationId,this.props.callId,this.props.callJoinContext,x.NavigationCallOrigin.ConversationHeader,e).then((()=>{R.log(x.LogTraceArea.Calling,"ContentPanel: subscribed to call: "+this.props.callId),this.isComponentMounted()||this.state.callState!==d.CallState.Observing||p.default.CallingStore.disposeObservingCalls(e)}))}componentWillUnmount(){super.componentWillUnmount();const e=se.default.newCauseId();this.state.enableObservingCall&&this.props.callId&&!this._ignoreDisposingCallObserving&&this.state.enableContentPanelHeaderButtonsSubscribeToCallOnMount&&p.default.CallingStore.disposeObservingCalls(e),this._ignoreDisposingCallObserving=!1}_getAudioAndVideoCallStatus(){if(this.state.alwaysNavigateToLobby)return{audioCallStatus:ue.ButtonStatus.Selected,videoCallStatus:this.state.noCameraFound?ue.ButtonStatus.Disabled:ue.ButtonStatus.Selected};let e,t;return this.state.isCallIncoming||this.state.isOutgoingCallingDisabled||this.state.shouldInactivateControlsAfterEndedCall?(e=ue.ButtonStatus.Disabled,t=ue.ButtonStatus.Disabled):this.props.hasActiveCall?(e=ue.ButtonStatus.Selected,t=this.state.noCameraFound?ue.ButtonStatus.Disabled:ue.ButtonStatus.Selected):(e=ue.ButtonStatus.Unselected,t=ue.ButtonStatus.Unselected),{audioCallStatus:e,videoCallStatus:t}}_getVideoCallButtonInfo(e){if((!this.props.hasActiveCall||this.props.hasActiveCall&&this.state.isCallIncoming)&&(!this.state.isOutgoingCallingDisabled||!this.state.useMobileUI)&&this.props.conversationId!==X.default.getEchoMri()&&(!y.isPhoneMri(this.props.conversationId)||this.state.skypeUserOwnerMri)&&(!this.state.isEncryptedThread||this.state.skypeUserOwnerMri)&&(!this.state.isPSTNGroup||this.state.skypeUserOwnerMri)&&!this.state.hasActiveGoLive){let t;t=this.state.isOutgoingCallingDisabled?C.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason):this.state.noCameraFound?B.getString("ContentPanelHeader.NoCameraVideoCallButtonTitle"):B.getString("ContentPanelHeader.VideoCallButtonTitle");const s=e!==ue.ButtonStatus.Disabled?this._onStartVideoCall:this._onDontStartCall;return{key:ue.HeaderButtonKey.VideoCallButton,icon:$.SkypeIcon.Video,iconSize:this.state.useMobileUI?ye:$.IconSize.size20,title:t,accessibilityLabel:t||B.getString("ContentPanelHeader.VideoCallButtonTitle"),onPress:s,status:e}}}_getJoinCallButtonInfo(){let e,t=ue.HeaderButtonKey.CallButton;const s=this.state.alwaysNavigateToLobby||!this.state.isCallingDisabled?ue.ButtonStatus.Selected:ue.ButtonStatus.Disabled;switch(this.props.activeCallStatus){case _.ActiveCallStatus.Connected:e=B.getString("CallBanner.GoToCallMessage"),t=ue.HeaderButtonKey.CallButtonConnected;break;case _.ActiveCallStatus.OnHold:e=B.getString("CallBanner.ResumeLiveCallMessage"),t=ue.HeaderButtonKey.CallButtonOnHold;break;default:e=B.getString("CallBanner.JoinLiveCallMessage")}let i=e;s===ue.ButtonStatus.Disabled&&(i=C.default.callingDisabledTooltip(this.state.callingDisabledReason));const o=s!==ue.ButtonStatus.Disabled?this._onJoinOrStartAudioCall:this._onDontStartCall;return{key:t,title:i,accessibilityLabel:i||B.getString("ContentPanelHeader.CallButtonTitle"),onPress:o,ref:this._onJoinButtonRef,status:s,buttonStyle:v.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:Q.AgnosticGradientFillButtonColors.green,gradientDirection:r.GradientDirection.BOTTOM_RIGHT,buttonText:e,iconSize:ye,isWideButton:!0,iconHorizontalMargin:4,icon:E.default.getMeetNowIcon()}}_getAudioCallButtonInfo(e){const t=ue.HeaderButtonKey.CallButton;let s=this.state.isEncryptedThread?B.getString("ContentPanelHeader.PrivateCallButtonTitle"):B.getString("ContentPanelHeader.CallButtonTitle");this.state.isOutgoingCallingDisabled&&(s=C.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason));const i=e!==ue.ButtonStatus.Disabled?this._onJoinOrStartAudioCall:this._onDontStartCall;return{key:t,title:s,accessibilityLabel:s||B.getString("ContentPanelHeader.CallButtonTitle"),onPress:i,ref:this._onCallButtonRef,icon:this._getAudioCallIcon(),iconSize:this.state.useMobileUI?ye:$.IconSize.size20,accessibilityTraits:this.state.multipleAudioCallOptionsAvailable?[a.Types.AccessibilityTrait.Button,a.Types.AccessibilityTrait.HasPopup]:void 0,status:e}}_getMoreOptionsButtonInfo(){if(!this._shouldUnfoldExtendedControlButtons())return{key:ue.HeaderButtonKey.MoreOptionsButton,ref:this._onMoreOptionsButtonRef,style:[ve.modernizeMoreOptionsIconButton],title:B.getString("ContentPanelHeaderTitle.MoreOptionsButtonTitle"),icon:$.SkypeIcon.MoreVertical,onPress:this._onMoreOptionsButtonPress,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ye}}_shouldShowJoinCallButton(){return this.props.hasActiveCall&&this.state.showActiveCall}_shouldShowStartCallButton(){return this.state.isGroupConversation&&!this.props.hasActiveCall}_getStartCallButtonInfo(){var e;let t=B.getString("MeetNow.StartCall"),s=ue.ButtonStatus.Unselected;return(this.state.isUserCreator&&this.state.isOutgoingCallingDisabled||this.state.isRegularMemberInModeratedGroup)&&(t=null!==(e=C.default.callingDisabledTooltip(this.state.outgoingCallingDisabledReason))&&void 0!==e?e:t,s=ue.ButtonStatus.Disabled),{key:ue.HeaderButtonKey.StartCallButton,title:t,status:s,icon:E.default.getMeetNowIcon(),buttonText:this._shouldUnfoldExtendedControlButtons()?B.getString("MeetNow.StartCall"):void 0,accessibilityLabel:B.getString("MeetNow.StartCall"),onPress:this._onStartCallPressed,iconSize:ye,iconHorizontalMargin:4}}_getFindButton(){return{key:ue.HeaderButtonKey.FindButton,title:B.getString("ContentPanelHeaderTitle.FindButtonTitle"),icon:$.SkypeIcon.Search,onPress:this.props.onToggleMessageSearchPanel,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ye}}_getGalleryButton(){return{key:ue.HeaderButtonKey.GalleryButton,title:B.getString("ContentPanelHeaderTitle.GalleryButtonTitle"),icon:$.SkypeIcon.Gallery1,onPress:this.props.onGalleryPressed,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ye}}_getModernizedAddContactsButton(){if(!this.state.canAddParticipant||this.props.hideAddContactButton)return;const e=this.state.isUserBlocked||this.state.isBlockedPSTNMri?ue.ButtonStatus.Disabled:ue.ButtonStatus.Unselected,t=this.props.otherPartyMri?B.getString("SetConversationParticipantsPanel.CreateNewGroupTitle"):B.getString("SetConversationParticipantsPanel.AddPeopleTitle");return{key:ue.HeaderButtonKey.ModernizedAddContactsButton,title:this.state.isUserBlocked?void 0:t,icon:$.SkypeIcon.ContactAdd,onPress:this._onAddContact,color:Q.Color.transparent,status:e,noBackgroundIcon:!0,iconSize:ye}}_getImageCreatorButton(){return{key:ue.HeaderButtonKey.ImageCreatorButton,title:B.getString("ContentPanelHeaderTitle.ImageCreatorButtonTitle"),icon:$.SkypeIcon.Designer,onPress:this._onImageCreatorButtonPress,color:Q.Color.transparent,noBackgroundIcon:!0,iconSize:ye,coachMarkType:ce.CoachMarkType.ImageCreator}}_getUnsubscribeButton(){const e=ue.ButtonStatus.Unselected,t=this.state.enableInAppEngagementNotifications,s=t?B.getString("Global.Unsubscribe"):B.getString("Global.Subscribe"),i=t?$.SkypeIcon.MailOff:$.SkypeIcon.Mail,o=this.state.enableInAppEngagementNotifications?this._onUnsubscribePress:this._onSubscribePress;return{key:ue.HeaderButtonKey.UnsubscribeButton,title:s,icon:i,buttonText:s,buttonTextStyle:[ve.unsubscribeSubscribeButton,this._themeStyles.buttonTextColorStyle],onPress:o,color:Q.Color.transparent,status:e,noBackgroundIcon:!0,iconSize:$.IconSize.size18,iconHorizontalMargin:4}}_getButtonDescriptors(){const e=this._getBarButtonInfo(),t=this._getExtendedChatControlsDescriptors();return[...this._shouldUnfoldExtendedControlButtons()?t:[],...e,!this.state.useMobileUI&&l.compact(t).length>0?this._getMoreOptionsButtonInfo():void 0]}_getBarButtonInfo(){const e=[];if(this.state.isConciergeBot)return[this._getUnsubscribeButton()];if(this.state.isCallingCapable)if(this._shouldShowStartCallButton())e.push(this._getStartCallButtonInfo());else{const t=this._getAudioAndVideoCallStatus();if(!this.state.isOutgoingVideoDisabled){const s=this._getVideoCallButtonInfo(t.videoCallStatus);s&&e.push(s)}const s=this._shouldShowJoinCallButton()?this._getJoinCallButtonInfo():this._getAudioCallButtonInfo(t.audioCallStatus);s&&e.push(s)}return e}_getExtendedChatControlsDescriptors(){const e=[this.props.isMessageSearchPanelEnabled?this._getFindButton():void 0,this.props.isGalleryEnabled?this._getGalleryButton():void 0];return this._showAddContactButton()&&e.push(this._getModernizedAddContactsButton()),this.state.enableImageCreator&&!this._shouldShowImageCreator()&&e.push(this._getImageCreatorButton()),e}_shouldShowImageCreator(){return this.state.isReadOnlyConversation||this.state.isNewsChannel||this.state.isNewsBot||this.state.isBookmark||this._hasPendingIncomingContactRequest()||this.props.isMessageSearchPanelVisible&&(this.state.useMobileUI||this.state.useTabletUI)}_hasPendingIncomingContactRequest(){return this.state.isSendImCapable&&this.state.isIncomingContactInvitePending&&!this.state.isReadOnlyConversation}_shouldUnfoldExtendedControlButtons(){return!this.state.useMobileUI&&!this.state.isMinDesktopWidth}_showAddContactButton(){return this.state.canInvitePeople&&!this.state.isRegularMemberInModeratedGroup}render(){const e=[ve.controls],t=this.props.preventAccessibilityFocus?a.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,i=this._getButtonDescriptors(),n=null==i?void 0:i.reduce(((e,i,o)=>{if(!i)return e;i.color=this._adjustButtonColor(i);const{buttonStyle:n,textColor:r,hoverStyle:a}=this._getBarButtonStyles(i,0===o),l=this._renderBarButton(i,r,n,a,t,s,o);return l?(e.push(l),e):e}),[]);return(0,o.jsx)(a.View,{style:this.state.useMobileUI?e:ve.compositeNav.controlsContainer,children:n},"rightcontrols")}_getBarButtonStyles(e,t){return{buttonStyle:this._getModernizedButtonStyle(e,t),textColor:this._getTextColor(e),hoverStyle:this._getHoverStyle(e)}}_getModernizedButtonStyle(e,t){if(e.buttonText)return[t?ve.leftIconMargin:ve.leftIconMarginControl];const s=e.status===ue.ButtonStatus.Disabled,i=[e.noBackgroundIcon?ve.modernizeIconContainer:ve.modernizeIconContainerWithBackground,e.noBackgroundIcon?ve.rightIconMargin:ve.leftIconMargin];return s&&i.push(a.Styles.createTextStyle({color:this._getContext().themeColors.iconDisabled},!1)),i}_getTextColor(e){return e.status===ue.ButtonStatus.Selected?this.state.useMobileUI?this.state.userColor:Q.Color.white:e.status===ue.ButtonStatus.Disabled?this._themeColors.iconDisabled:this._themeColors.headerIconColor}_getHoverStyle(e){if(!this.state.useMobileUI)return e.color?ve.compositeNav.headerButtonHover:this._themeStyles.buttonBackgroundHoverColorStyle}_renderBarButton(e,t,s,i,o,n,r){return e.buttonText?this._renderTextButton(e,t,s,r):e.icon?this._renderIconButton(e,t,s,i,o,n):void 0}_renderTextButton(e,t,s,i){const n=e.status===ue.ButtonStatus.Disabled,a=this._getButtonConfig(e.color,t,n),l=e.icon?ve.modernizedBackgroundStyle:this.state.useMobileUI?void 0:ve.backgroundStyle,d=[J.default.fontStyle.body];let c=e.color||e.status===ue.ButtonStatus.Disabled?v.SXButtonStyle.Custom:v.SXButtonStyle.GradientFill;e.buttonStyle&&(c=e.buttonStyle);const u={style:s,disabled:n,buttonConfig:a,backgroundStyle:l,textStyleOverride:d,buttonStyle:c,textStyleDeprecated:e.buttonTextStyle,buttonSize:v.SXButtonSize.Medium,iconSize:e.iconSize,key:e.key||`rightButton${i}`,icon:e.icon,gradientDirection:e.gradientDirection||r.GradientDirection.BOTTOM_RIGHT,reverseGradientColor:!0,iconHorizontalMargin:e.iconHorizontalMargin,title:e.buttonText,hoverText:e.title,accessibilityLabel:e.accessibilityLabel||e.buttonText,accessibilityTraits:e.accessibilityTraits,allowTextWrap:!1,onPress:e.onPress,accessoryView:e.accessoryView,agnosticGradientColor:e.agnosticGradientColor};return(0,o.jsx)(q.default,Object.assign({},u,{ref:e.ref}))}_renderIconButton(e,t,s,i,n,r){const a=e.status!==ue.ButtonStatus.Disabled?this._themeColors.iconPrimary:t,l=Te(!this.state.useMobileUI,e);return(0,o.jsx)(he.ContentPanelHeaderIconButton,{useGradientButton:l,descriptor:e,buttonStyle:s,hoverStyle:i,iconColor:a,importantForAccessibility:n,tabIndex:r},e.key)}_getButtonConfig(e,t,s){if(e)return e?{backgroundColor:e,textColor:this.state.isConciergeBot?this._themeColors.buttonTextColor:Q.Color.white}:{backgroundColor:this._themeColors.buttonBackgroundColor,hoverBackgroundColor:s?void 0:this._themeColors.buttonBackgroundHoverColor,textColor:t}}_onStartCall(e){const t=se.default.newCauseId();R.log(x.LogTraceArea.ContentPanel,"ContentPanelHeader._onStartCall("+e+") "+t);const s=()=>{ee.callStarted(this.props.conversationId,e),this.state.isGroupConversation&&F.default.beginTrackingJoinMeetNow(N.MeetNowOrigin.CallPanel),this.props.hasActiveCall&&this.props.activeCallStatus===_.ActiveCallStatus.Connected&&R.track(new S.FullChatUXTelemetryEvent(S.FullChatUXNavigation.Leave,this.props.conversationId,this.props.callId||""));const s=x.NavigationCallOrigin.ConversationHeader;!G.default.shouldShowInterstitial(this.props.conversationId,e)||this.props.callId?(this._ignoreDisposingCallObserving=!0,m.default.startCallOrMaybePrompt(this._getCallButtonRef,this._getRootViewId(),{skypeMri:this.state.skypeUserOwnerMri?this.state.skypeUserOwnerMri:this.props.conversationId,initiatingConversation:this.props.conversationId,onCallStartedAnsweredOrJoined:this.props.onCallStartedAnsweredOrJoined,userIntent:e?g.StartCallOrMaybePromptUserIntent.Video:g.StartCallOrMaybePromptUserIntent.Audio,phones:this.props.localAddressBookPhones,callOrigin:s,inviteOrigin:x.ContactInviteOrigin.ConversationHeader,showCallPreview:this.state.enableJoinerCallPreview},t,!1,this._getCallButtonRef)):G.default.maybeShowRinglessCallInterstitial(this.props.conversationId,e,s,t)},i=y.isPhoneMri(this.props.conversationId);if(i&&A.default.shouldRequestAcknowledgementNoSubscription())return void H.default.navigateToE911AcknowledgementPanel(t,this._getRootViewId(),s);const o=y.getPhoneNumberFromMri(this.props.conversationId);if(i&&o&&this.state.callerIdWarning){le.default.clearState();const e=se.default.newCauseId(),t=re.default.normalizePartialNumberWithCountryCode(o);H.default.navigateToPSTNDialerWithParams({prefilledNumber:t,navigationSource:x.DialerNavigationSource.ChatPanelHeader,causeId:e},this._getRootViewId())}else s()}_adjustButtonColor(e){return e.status===ue.ButtonStatus.Disabled?Q.Color.gray300:e.color}}function Te(e,t){return e&&!t.noBackgroundIcon&&t.status!==ue.ButtonStatus.Disabled}t.ContentPanelHeaderButtons=Ce,t.default=Ce},363437:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeaderDropdown=void 0;const i=s(197582),o=s(785893),n=s(331654),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(54720)),d=i.__importDefault(s(97572)),c=i.__importDefault(s(304623)),u=i.__importStar(s(44717)),h=i.__importDefault(s(135372)),p=i.__importStar(s(373861)),g=i.__importDefault(s(260928)),m=i.__importStar(s(60771)),S=s(815146),_=i.__importDefault(s(634424)),f=s(653305),y=i.__importDefault(s(479629)),v=i.__importDefault(s(560099)),C=i.__importStar(s(85385)),T=i.__importDefault(s(114818)),M=s(26703),b=i.__importStar(s(704704)),I=i.__importDefault(s(670363)),w=i.__importDefault(s(740794)),P=s(113002),k=i.__importDefault(s(453353)),A=i.__importDefault(s(960282)),x=s(240804),D=i.__importDefault(s(695050)),R=i.__importStar(s(160049)),L=i.__importDefault(s(400836)),B=i.__importDefault(s(776622)),F=s(16549),N=s(641400),E=i.__importDefault(s(827361)),O=i.__importDefault(s(685734)),U=i.__importDefault(s(760989)),V=i.__importDefault(s(337249)),H=i.__importDefault(s(958868));var j;!function(e){e[e.Visible=0]="Visible",e[e.Hiding=1]="Hiding",e[e.Hidden=2]="Hidden"}(j||(j={}));const z=(0,M.lazyProperties)({container:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:F.Color.transparent}),content:()=>r.Styles.createViewStyle({minHeight:50,alignSelf:"stretch",borderBottomLeftRadius:3,borderBottomRightRadius:3,flexDirection:"row"}),contentStacked:()=>r.Styles.createViewStyle({flexDirection:"column"}),background:()=>r.Styles.createViewStyle({flex:1,backgroundColor:F.Color.blackOverlay50}),rowStyle:()=>r.Styles.createViewStyle({paddingLeft:20}),menuSection:()=>r.Styles.createViewStyle({flex:1,flexBasis:0}),stackedSection:()=>r.Styles.createViewStyle({alignSelf:"stretch"}),gallerySection:()=>r.Styles.createViewStyle({flex:1,flexBasis:0,marginRight:15}),stackedGallerySection:()=>r.Styles.createViewStyle({alignSelf:"stretch",paddingHorizontal:20}),galleryButtonHeader:()=>r.Styles.createViewStyle({height:60}),galleryStacked:()=>r.Styles.createViewStyle({marginBottom:15}),hiddenContent:()=>r.Styles.createViewStyle({opacity:0})});class W extends H.default{constructor(){super(...arguments),this._isDragging=!1,this._contentTransform=0,this._contentContainerTransformValue=new r.Animated.Value(-200),this._contentContainerTransformStyle=r.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentContainerTransformValue}]}),this._backgroundOpacityValue=new r.Animated.Value(0),this._backgroundOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityValue}),this._onBackButtonPressed=()=>(this._dismiss(),!0),this._onLayoutChanged=e=>{const t={height:e.height,width:e.width};(0,T.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})},this._dismiss=()=>{this.showOrHide()},this._onHasGalleryItems=e=>{this.isComponentMounted()&&this.state.hasGalleryItems!==e&&this.setState({hasGalleryItems:e})},this._onPanVertical=e=>{const t=e.pageY-e.initialPageY;let s=this._contentTransform+t;if(s>0&&(s=0),this._contentContainerTransformValue.setValue(s),this._isDragging||(this._isDragging=!0),e.isComplete){this._contentTransform+=t;const s=this.state.viewDimensions.height/2;let i=!1;i=!(e.velocityY<-.1)&&this._contentTransform>s,i?this._presentContent(!0):this.showOrHide()}},this._renderMenuItem=(e,t)=>{if(e===p.MenuItem.ShareLink)return(0,o.jsx)(y.default,{style:t||z.rowStyle,conversationId:this.props.conversationId,hideDivider:!0,origin:f.ShareGroupButtonOrigin.ConversationHeader},"item"+e);let s,i,n,r,a=!1;switch(e){case p.MenuItem.NewGroup:s=N.SkypeIcon.ContactGroupTwoPersonas;const t=this.state.firstName||this.state.displayName;i=t?b.getString("UserSettingsPanel.CreateNewGroupWithUser",{userName:t}):b.getString("SetConversationParticipantsPanel.CreateNewGroupTitle"),n=this._onCreateNewGroupWithUser;break;case p.MenuItem.PrivateConversation:s=N.SkypeIcon.PrivateChatFill,i=b.getString("DetailsPanelHeader.StartPrivateConversationButtonTitle"),n=this._onStartPrivateConversation;break;case p.MenuItem.SendSMS:s=N.SkypeIcon.MobileSmsNew,i=b.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),n=this._onPressSMSMessageButton,r=this._onSmsButtonRef;break;case p.MenuItem.Settings:s=N.SkypeIcon.Info,i=b.getString("ConversationDropDown.SettingsTitle"),n=this._onNavigateToSettings;break;case p.MenuItem.Gallery:s=N.SkypeIcon.Gallery1,i=b.getString("GalleryPanel.DesktopPanelTitle"),n=this._onNavigateToGallery;break;case p.MenuItem.AddParticipants:s=N.SkypeIcon.ContactAdd,i=b.getString("GroupProfilePanel.AddToGroupTitle"),n=this._onNavigateToAddPeople,a=!this.state.isConnected;break;default:s=U.default.switchStatementExhaustiveChecking(e)}return(0,o.jsx)(D.default,{ref:r,style:t||z.rowStyle,icon:s,title:i,disabled:a,hideDivider:!0,onPress:n},"item"+e)},this._onCreateNewGroupWithUser=()=>{if(this._dismiss(),!this.props.otherPartyMri)return;new g.default({peopleType:x.PeopleType.All,filterPeopleType:x.FilterType.GroupCapable,invitedUsersMris:[this.props.otherPartyMri],navigationOrigin:S.NavigationConversationOrigin.UserProfileNewGroupWithUser,wizardSteps:[P.WizardSteps.setConvParticipants]}).start(this._getRootViewId())},this._onStartPrivateConversation=()=>{this._dismiss(),this.props.otherPartyMri&&m.createAndNavigateToPrivateConversation(this.props.otherPartyMri,S.E2EEInviteOrigin.UserProfile,this._getContext())},this._onPressSMSMessageButton=()=>{if(!this.props.otherPartyMri)return void this._dismiss();const e=U.default.newCauseId();C.log(S.LogTraceArea.Navigation,"UserProfileContent._onPressSMSMessageButton causeId: "+e),B.default.getPhoneNumberToNavigateTo(this.props.otherPartyMri,(()=>this._smsButtonRef),this._getRootViewId()).then((t=>{this._dismiss(),t&&this.props.otherPartyMri&&c.default.ensureConversationLoadedOrFaked(this.props.otherPartyMri).then((s=>{R.default.setFlowId(R.SmsFlowId.UserProfile),R.default.setNextFlowId(R.SmsFlowId.UserProfile),w.default.navigateToConversation({convId:this.props.otherPartyMri,origin:S.NavigationConversationOrigin.UserProfile,isNewConversation:s,causeId:e,selectedNumberForSMS:t})}))})).catch((()=>{}))},this._onNavigateToSettings=()=>{this._dismiss();const e=U.default.newCauseId();C.log(S.LogTraceArea.Navigation,"ContentPanelHeaderDropDown._onNavigateToSettings, causeId: "+e),w.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onNavigateToGallery=()=>{this._dismiss(),w.default.toggleGallery(this.props.conversationId,this._getContext())},this._onSmsButtonRef=e=>{this._smsButtonRef=e||void 0},this._onNavigateToAddPeople=()=>{if(this.state.isConnected){this._dismiss();new g.default({convId:this.props.conversationId,peopleType:x.PeopleType.AllExcludingBots,filterPeopleType:x.FilterType.GroupCapable,navigationOrigin:S.NavigationConversationOrigin.GroupProfile,wizardSteps:[P.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}}}_buildState(e,t){var s;const i=a.default.getS4LCMCFeatures(),o=e.otherPartyMri?O.default.getFullUserProfileByMri(e.otherPartyMri):void 0,n=this._getRootViewId(),r=L.default.isPaidUser(),l=u.isEncryptedThread(e.conversationId),c=e.otherPartyMri&&(d.default.isMriBlocked(e.otherPartyMri)||u.isBlockedPSTNMri(e.otherPartyMri)),h=void 0!==i.translatorAgentId&&d.default.isMriBlocked(i.translatorAgentId),g={deviceOrientation:A.default.getDeviceOrientation(n),displayName:null===(s=null==o?void 0:o.getDisplayName)||void 0===s?void 0:s.call(o),firstName:null==o?void 0:o.firstName,isConnected:k.default.isConnected()};if(t){g.shouldRenderContent=!1,g.visibility=j.Hidden;const e=V.default.measureWindow(this._getRootViewId());g.viewDimensions={height:200,width:e.width},g.hasGalleryItems=!1}return g.menuItems=p.default.getMenuItems({isMriBlocked:c,isEncryptedThread:l,hasTranslatorAgentId:!!i.translatorAgentId,isTranslatorMriBlocked:h,canShowSmsEntryPoint:r,otherPartyMri:e.otherPartyMri}),g}showOrHide(e){if(this.isComponentMounted()){let t;this.state.visibility===j.Visible?(t=j.Hiding,h.default.setCoachMarkEnabled(!0)):(t=j.Visible,h.default.setCoachMarkEnabled(!1),this._contentContainerTransformValue.setValue(-1*this.state.viewDimensions.height));const s=this.state.shouldRenderContent||t===j.Visible;this.setState({shouldRenderContent:s,visibility:t},e)}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.visibility!==t.visibility&&(this.state.visibility===j.Hiding?(this._dismissContent(!0),l.default.unsubscribe(this._onBackButtonPressed)):this.state.visibility===j.Visible&&(this._presentContent(!0),l.default.subscribe(this._onBackButtonPressed)))}_presentContent(e){this._expandOrCollapse(!0,e)}_dismissContent(e){this._expandOrCollapse(!1,e,(()=>{this.isComponentMounted()&&this.state.visibility===j.Hiding&&this.setState({visibility:j.Hidden})}))}_expandOrCollapse(e,t=!0,s){if(0===this.state.viewDimensions.height)return;const i=e?0:-1*this.state.viewDimensions.height,o=e?1:0,n=()=>{s&&s(),this._isDragging=!1};if(this._animation&&(this._animation.stop(),this._animation=void 0),t){const e=200;this._animation=r.Animated.parallel([I.default.timing(this._backgroundOpacityValue,{toValue:o,duration:e,easing:r.Animated.Easing.Out(),useNativeDriver:!0}),I.default.timing(this._contentContainerTransformValue,{toValue:i,duration:e,easing:r.Animated.Easing.Out(),useNativeDriver:!0})]),this._animation.start(n)}else this._backgroundOpacityValue.setValue(o),this._contentContainerTransformValue.setValue(i),n();this._contentTransform=i}render(){if(!this.state.shouldRenderContent)return null;const e=this.state.visibility===j.Hidden,t=[z.content,this._getContext().themeStyles.primaryBackgroundColorStyle],s=this.state.deviceOrientation===n.DeviceOrientation.Portrait;s&&t.push(z.contentStacked);const i=(0,o.jsx)(r.GestureView,{onPanVertical:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:r.Types.ImportantForAccessibility.No,children:(0,o.jsxs)(r.View,{style:t,onLayout:this._onLayoutChanged,children:[(0,o.jsx)(r.View,{style:s?z.stackedSection:z.menuSection,children:this.state.menuItems.map((e=>this._renderMenuItem(e)))}),(0,o.jsxs)(r.View,{style:s?z.stackedGallerySection:z.gallerySection,children:[this.state.hasGalleryItems?this._renderMenuItem(p.MenuItem.Gallery,z.galleryButtonHeader):void 0,(0,o.jsx)(_.default,{style:z.galleryStacked,conversationId:this.props.conversationId,usePortraitLayout:!0,useRoundedCorners:!0,hideWhenEmpty:!0,onItemPress:this._dismiss,onHasItems:this._onHasGalleryItems})]})]})}),a=[E.default.absoluteFill,this._contentContainerTransformStyle],l=[z.container];e&&l.push(z.hiddenContent);const d=e?void 0:(0,o.jsx)(v.default,{style:E.default.absoluteFill,onPress:this._dismiss,disableTouchOpacityAnimation:!0,children:(0,o.jsx)(r.Animated.View,{style:[z.background,this._backgroundOpacityStyle]})});return(0,o.jsxs)(r.Animated.View,{style:l,importantForAccessibility:e?r.Types.ImportantForAccessibility.NoHideDescendants:r.Types.ImportantForAccessibility.No,blockPointerEvents:e,children:[d,(0,o.jsx)(r.Animated.View,{style:a,ignorePointerEvents:!0,children:i})]})}}t.ContentPanelHeaderDropdown=W,t.default=W},184971:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPanelHeaderIconButton=t.ContentPanelHeaderIconButtonPresenter=void 0;const i=s(197582),o=s(785893),n=s(344175),r=s(516778),a=i.__importStar(s(309520)),l=s(964414),d=s(641400),c=s(526849),u=i.__importDefault(s(581163)),h=i.__importStar(s(187140)),p=s(206315),g=i.__importDefault(s(453761)),m=i.__importDefault(s(631681)),S=s(491839),_=({children:e})=>{const{badgeStyle:t}=(0,l.useRXStyles)((({themeColors:{iconDanger:e}})=>({badgeStyle:r.Styles.createViewStyle({backgroundColor:e})})),[]),{colors:{surfacePrimary:s}}=(0,n.useSUITheme)();return(0,o.jsxs)(n.Box,{children:[e,(0,o.jsx)(n.Box,{position:"absolute",top:.5,right:2.5,children:(0,o.jsx)(a.default,{rawCount:1,borderWidth:2,borderColor:s,isHighPriority:!0,fixedSize:!0,badgeSize:a.BadgeSize.Small,colorStyle:t})})]})};t.ContentPanelHeaderIconButtonPresenter=({useGradientButton:e,descriptor:t,isHighlighted:s,iconColor:i,hoverStyle:n,buttonStyle:r,importantForAccessibility:a,tabIndex:l})=>{var c,u,f,y;const{themeColors:{iconPrimary:v}}=(0,p.useSkypeTheme)();let C;const T={key:t.key,style:[...r,...t.style||[]],title:t.title,icon:t.icon,onPress:t.onPress,accessibilityLabel:t.accessibilityLabel,accessibilityTraits:t.accessibilityTraits,disabled:t.status===S.ButtonStatus.Disabled,importantForAccessibility:a,tabIndex:l};return C=e?(0,o.jsx)(h.default,Object.assign({ref:t.ref},T,{iconSize:t.iconSize,size:h.ActionButtonSize.Small,reverseGradientColor:!0})):t.coachMarkType?(0,o.jsx)(m.default.IconButton,Object.assign({ref:t.ref},T,{hoverStyle:n,size:null!==(c=t.iconSize)&&void 0!==c?c:d.IconSize.size20,color:i,hoverColor:v,toolTip:t.title,coachMarkType:t.coachMarkType,anchorAccessibilityLabel:null!==(f=null!==(u=t.accessibilityLabel)&&void 0!==u?u:t.title)&&void 0!==f?f:""})):(0,o.jsx)(g.default,Object.assign({ref:t.ref},T,{hoverStyle:n,size:null!==(y=t.iconSize)&&void 0!==y?y:d.IconSize.size20,color:i,hoverColor:v,toolTip:t.title})),s?(0,o.jsx)(_,{children:C}):C},t.ContentPanelHeaderIconButton=(0,c.WithResub)(t.ContentPanelHeaderIconButtonPresenter,(e=>Object.assign(Object.assign({},e),{isHighlighted:(0,u.default)().isButtonHighlighted(e.descriptor.key)})))},299137:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(516778)),n=i.__importDefault(s(513983)),r=i.__importDefault(s(225511)),a=(0,s(26703).lazyProperties)({rowStyle:()=>o.Styles.createViewStyle({minHeight:44})});class l extends n.default{_buildRows(e){const{descriptors:t,onRowPress:s}=e;return null==t?void 0:t.reduce(((e,t)=>{if(!t)return e;const{icon:i,iconSize:o,key:n,onPress:l,title:d}=t;return e.push({props:{key:n,icon:i,iconSize:o,titleText:d,onRowPress:()=>{null==l||l(),s()},style:[a.rowStyle],hideBorder:!0},builder:r.default.buildRow}),e}),[])}}t.default=l},494118:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(369347)),d=i.__importDefault(s(354676)),c=s(843890),u=i.__importDefault(s(179075)),h=i.__importStar(s(44717)),p=i.__importStar(s(567567)),g=i.__importDefault(s(498801)),m=i.__importDefault(s(373861)),S=i.__importStar(s(361971)),_=s(605507),f=i.__importDefault(s(615364)),y=i.__importStar(s(463519)),v=i.__importDefault(s(601976)),C=i.__importStar(s(242561)),T=i.__importStar(s(800662)),M=s(77395),b=i.__importDefault(s(970035)),I=i.__importDefault(s(524526)),w=i.__importStar(s(7040)),P=i.__importDefault(s(114818)),k=i.__importStar(s(94534)),A=s(26703),x=i.__importStar(s(704704)),D=i.__importDefault(s(487803)),R=i.__importStar(s(507700)),L=i.__importDefault(s(450312)),B=i.__importStar(s(808164)),F=i.__importDefault(s(769956)),N=s(16549),E=i.__importDefault(s(20758)),O=s(641400),U=i.__importDefault(s(235885)),V=i.__importDefault(s(497910)),H=i.__importDefault(s(601274)),j=i.__importDefault(s(38217)),z=i.__importDefault(s(839970)),W=i.__importDefault(s(685734)),G=(0,A.lazyProperties)({titleContainer:()=>r.Styles.createViewStyle({flex:1,paddingHorizontal:0,alignItems:"stretch",justifyContent:"center"}),headerContainer:()=>r.Styles.createViewStyle({flex:1,justifyContent:"center"}),firstRow:()=>r.Styles.createButtonStyle({justifyContent:"flex-start",flexDirection:"row"}),secondRow:()=>r.Styles.createViewStyle({flex:-1,justifyContent:"flex-start",flexDirection:"row"}),secondRowHeight:()=>r.Styles.createViewStyle({height:25}),secondRowDivider:()=>r.Styles.createViewStyle({marginLeft:7,marginRight:3}),secondRowDividerRN:()=>r.Styles.createViewStyle({marginHorizontal:0}),secondRowTextStyles:()=>r.Styles.createTextStyle({flex:-1,lineHeight:25,height:25}),conversationNameText:()=>r.Styles.createTextStyle({color:N.Color.black,font:E.default.font.uiDisplayBold,fontSize:E.default.controlFontSize.headerSizeSmall,flexShrink:1}),textTruncation:()=>r.Styles.createViewStyle({flexShrink:1}),userPresenceIndicator:()=>r.Styles.createViewStyle({width:8,height:8,borderRadius:4,marginRight:4,alignSelf:"center",bottom:0}),lockIcon:()=>r.Styles.createViewStyle({paddingRight:6,paddingTop:2}),conversationName:()=>r.Styles.createViewStyle({bottom:0,alignItems:"center",flexDirection:"row",flexShrink:1}),buttonIcon:()=>r.Styles.createTextStyle({minWidth:O.IconSize.size16,textAlign:"center",marginRight:3}),button:()=>r.Styles.createViewStyle({flexShrink:0,flexDirection:"row",alignItems:"center",paddingLeft:4,marginRight:7}),translatorButtonIcon:()=>r.Styles.createViewStyle({minWidth:O.IconSize.size16,marginRight:3}),translatorButton:()=>r.Styles.createViewStyle({flexShrink:0,flexDirection:"row",alignItems:"center",paddingLeft:4,marginRight:7}),noPaddingRightStyle:()=>r.Styles.createViewStyle({paddingRight:0}),manageGroupWrapper:()=>r.Styles.createViewStyle({height:20,width:23}),manageGroupIcon:()=>r.Styles.createTextStyle({paddingLeft:3,paddingTop:0,paddingRight:0,marginRight:0,lineHeight:20})});class K extends V.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==T.FocusEvent.MessageSearchClosed||!this._findButtonRef)&&(this._findButtonRef.requestFocus(),!0),this._onFirstRowButtonPress=e=>{this.props.onPress&&this.props.onPress(e)},this._onTranslatorPress=e=>{e.stopPropagation(),this._onFirstRowButtonPress(e)}}_buildState(e,t){const s=(0,f.default)().getConversation(e.conversationId);let i=v.default.getDisplayName(e.conversationOwnerMri);const o=h.isAgent(e.conversationId);i&&s&&!s.isThread()&&!o&&B.default.isPossiblyPhoneNumber(i)&&B.default.isPossibleNumber(i)&&(i=B.default.parseAndFormat(i,B.PhoneNumberFormat.INTERNATIONAL)||i);const n=a.default.getS4LMessagingFeatures(),c={conversationName:i,isEncryptedThread:h.isEncryptedThread(e.conversationId),memberCount:s?Math.max(s.getMemberCount(),0):0,groupedConversationsEnabled:n.enableGroupedConversations,moodReact:void 0,moodRawText:void 0,callRateText:void 0,theme:void 0,isGalleryShowing:L.default.isGalleryShowing(),isOneOnOne:!!s&&s.isOneOnOne(),isTranslatedConversation:l.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(e.conversationId)&&I.default.isConversationTranslated(e.conversationId),translatorLocale:I.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isTrustedAgent:o&&u.default.isTrustedAgent(e.conversationId)},p=e.conversationOwnerMri;if(e.shouldShowUserPresence&&p){const e=W.default.getFullUserProfileByMri(p);if(c.gender=e&&e.gender,c.userPresence=z.default.getCachedUserPresence(p),c.isUserActive=z.default.isActiveUser(p),e.mood){c.theme=this._currentTheme;const s=y.decodeFromContent(e.mood),i=S.toEntities(s,{supportEmoticons:!0});if(c.moodRawText=i?w.getRawText(i):void 0,c.moodLabel=R.getAccessibilityTitle(e.mood),t||!(0,P.default)(c.moodRawText,this.state.moodRawText)||c.theme!==this.state.theme){const e=this._themeColors,t=this._themeStyles,i=[this._getSecondLineStyle(t.secondaryTextColorStyle)];i.push(r.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const o={processing:{emoticons:C.ProcessingLevel.Full,quotes:C.ProcessingLevel.None,wikiMarkup:C.ProcessingLevel.Stripped,links:C.ProcessingLevel.Full,atMentions:C.ProcessingLevel.Stripped},renderMedia:!1,mediaPlaceholderIconColor:e.primaryTextColor,allowLargeEmoticons:!1,numberOfLines:1,textOverrideStyle:i,boldTextStyle:i,regularTextStyle:i,linkStyle:t.linkTextColorStyle};c.moodReact=(0,_.renderReact)(s,o).value}else c.moodReact=this.state.moodReact}}else e.shouldShowCallRate&&e.otherPartyMri&&(c.callRateText=d.default.getCallRateByMri(e.otherPartyMri));return c}componentDidMount(){super.componentDidMount(),this._updateLastSeenTextTimer=H.default.setInterval((()=>{this.state.userPresence&&this.state.userPresence.lastSeenAtUtc&&this.isComponentMounted()&&this.forceUpdate()}),6e4),T.register(T.FocusEvent.MessageSearchClosed,this),this._fetchUserPresence(this.props)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);this.props.conversationId!==e.conversationId&&this._fetchUserPresence(e)}componentWillUnmount(){super.componentWillUnmount(),n.isUndefined(this._updateLastSeenTextTimer)||H.default.clearInterval(this._updateLastSeenTextTimer),T.unregister(T.FocusEvent.MessageSearchClosed,this)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}_fetchUserPresence(e){const t=e.conversationOwnerMri;e.shouldShowUserPresence&&t&&F.default.forceFetchPresence(t)}_renderSecondRowText(e,t,s,i=this.props.onPress){const n=[this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle)];n.push(r.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const a=(0,o.jsx)(r.Text,{style:n,numberOfLines:1,children:e},"secondRowText");return this._renderSecondRowItems(a,void 0,t,s,i)}_renderSecondRowItems(e,t,s,i,n=this.props.onPress){return(0,o.jsxs)(r.View,{style:G.secondRow,children:[(0,o.jsxs)(M.HoverableButton,{onPress:n,style:G.secondRow,title:i,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants,tabIndex:-1,disableHoverOpacityStyles:!n,disableCursor:!n,children:[t,e]}),this._renderTranslatorButton()]})}_renderTranslatorButton(){if(this.state.isTranslatedConversation&&this.state.translatorLocale){const e=x.getString("ContentPanelHeaderTitle.TranslatedToTitle",{language:this._getLanguageTitle(this.state.translatorLocale)});return[this._renderDivider("translatorDivider"),(0,o.jsxs)(M.HoverableButton,{onPress:this._onTranslatorPress,style:G.translatorButton,title:x.getString("ContentPanelHeaderTitle.TranslatorButtonTitle"),importantForAccessibility:r.Types.ImportantForAccessibility.Yes,children:[(0,o.jsx)(b.default,{icon:O.SkypeIcon.SkypeTranslator,style:G.translatorButtonIcon,color:this._themeColors.secondaryTextColor,size:O.IconSize.size12}),(0,o.jsx)(r.Text,{style:this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),numberOfLines:1,children:e})]},"translator-button")]}}_renderDivider(e){const t=this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle),s=c.UICapabilities.inlineTextFormattingSupported()?[G.secondRowDivider,t]:[G.secondRowDividerRN,t];return(0,o.jsx)(U.default,{style:s},e)}render(){const e=[E.default.fontStyle.messagingStreamChatHeader,G.textTruncation,this._themeStyles.headerTextColorStyle];e.push(r.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const t=this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,i=this.state.isEncryptedThread&&!this.state.groupedConversationsEnabled?(0,o.jsx)(b.default,{icon:O.SkypeIcon.Lock,size:O.IconSize.size20,color:this._themeColors.headerTextColor,style:G.lockIcon},"lockIcon"):void 0,n=m.default.accessibilityLabel(this.state,!!this.props.hideSecondRow,!!this.props.shouldShowUserPresence,!!this.props.shouldShowCallRate),a=this.props.hideSecondRow?void 0:this._renderSecondRow(),l=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0,d=!this.state.isTrustedAgent&&this.props.onPress?this._getOptionalGroupManageIcon():void 0,c=(0,o.jsxs)(r.View,{style:G.headerContainer,children:[(0,o.jsx)(r.View,{style:G.firstRow,children:(0,o.jsx)(M.HoverableButton,{onPress:this.props.onPress?this._onFirstRowButtonPress:void 0,title:this.state.conversationName,style:G.textTruncation,accessibilityLabel:n,importantForAccessibility:t,tabIndex:s,activeOpacity:this.props.activeOpacity,disableHoverOpacityStyles:!this.props.onPress,disableCursor:!this.props.onPress,children:(0,o.jsxs)(r.View,{style:G.conversationName,children:[i,(0,o.jsx)(r.Text,{style:e,numberOfLines:1,ellipsizeMode:"tail",children:this.state.conversationName?this.state.conversationName.split("\n",1):""}),l,d]})})}),a]});return(0,o.jsx)(r.View,{style:G.titleContainer,children:c})}_getOptionalCertifiedIcon(){return(0,o.jsx)(g.default,{botMri:this.props.conversationId})}_getOptionalGroupManageIcon(){const e=this._themeColors.iconPrimary,t=this._themeColors.iconPrimary;return(0,o.jsx)(r.View,{style:G.manageGroupWrapper,children:(0,o.jsx)(D.default,{iconColorOverride:e,onPress:this.props.onPress,accessibilityLabel:x.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!1,style:G.manageGroupIcon,iconSize:O.IconSize.size20,hoverColor:t,disableHoverOpacityStyles:!0},`manageGroupButton-${this.props.conversationId}`)})}_renderSecondRow(){const e=[this._getSecondLineStyle(this._themeStyles.secondaryTextColorStyle)];e.push(r.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const t=h.isS4BBridgeMri(this.props.conversationId);if(this.props.shouldShowUserPresence&&!t){const t=p.getLastSeenPresenceText(this.state.userPresence,!1,this.state.gender,this.state.isUserActive);let s;const i=p.getHoverTitle(this.state.userPresence,this.state.gender);if(!this.props.hidePresenceIndicator&&this.state.userPresence&&this.state.userPresence.status&&(s=j.default.getPresenceIcon(m.default.getPresenceStatusForIcon(this.state.isUserActive,this.state.userPresence),G.userPresenceIndicator,O.IconSize.size8,void 0,i)),s||t||this.state.moodReact){const i=this.state.moodLabel?x.getString("ContentPanelHeaderTitle.MoodMessageWrapper",{moodMessage:this.state.moodLabel}):void 0,n=this.state.moodReact||(0,o.jsx)(r.Text,{style:e,numberOfLines:1,children:t},"userPresenceText");return this._renderSecondRowItems(n,s,i,this.state.moodRawText||t)}}else{if(!this.props.otherPartyMri){const e=x.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.state.memberCount});return this._renderSecondRowText(e,e,e)}if(this.props.shouldShowCallRate)return(0,o.jsx)(r.Text,{style:e,children:this.state.callRateText});if(t)return(0,o.jsx)(r.Text,{style:e,children:x.getString("ContentPanelHeaderTitle.TeamsInteropSubtitle")})}}_getSecondLineStyle(e){return[E.default.fontStyle.messagingStreamChatSubHeader,e]}_getLanguageTitle(e){const t=k.getShortLanguageTitle(e);return n.isEmpty(t)?e:t}}t.default=K},97467:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importStar(s(309520)),d=i.__importStar(s(44717)),c=i.__importDefault(s(574489)),u=i.__importDefault(s(306200)),h=i.__importDefault(s(603743)),p=i.__importDefault(s(892034)),g=i.__importDefault(s(615364)),m=i.__importDefault(s(343823)),S=s(535973),_=i.__importDefault(s(288547)),f=s(815146),y=i.__importDefault(s(453761)),v=i.__importStar(s(85385)),C=i.__importDefault(s(54945)),T=s(26703),M=i.__importStar(s(704704)),b=s(978493),I=i.__importDefault(s(924849)),w=i.__importDefault(s(201721)),P=i.__importDefault(s(740794)),k=i.__importDefault(s(942724)),A=i.__importDefault(s(960282)),x=i.__importDefault(s(377556)),D=i.__importStar(s(322094)),R=s(16549),L=s(641400),B=i.__importDefault(s(827361)),F=i.__importDefault(s(48076)),N=i.__importDefault(s(497910)),E=i.__importDefault(s(601274)),O=i.__importDefault(s(760989)),U=(0,T.lazyProperties)({wrapper:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start"}),wrapperStackNav:()=>r.Styles.createViewStyle({paddingTop:10}),hiddenTabsDropdownButtonContainer:()=>r.Styles.createViewStyle({width:50,flexDirection:"row",alignItems:"center",justifyContent:"center",paddingBottom:8}),hiddenTabsDropdownBadge:()=>r.Styles.createViewStyle({marginLeft:6}),hiddenTabsDropdownWithCounterContainer:()=>r.Styles.createViewStyle({width:62}),desktopTabContainer:()=>r.Styles.createViewStyle({minWidth:148}),hiddenTabContainer:()=>r.Styles.createViewStyle({height:40,paddingVertical:10,justifyContent:"flex-start",borderBottomWidth:0})});class V extends N.default{constructor(){super(...arguments),this._mountedRefsMap=new I.default,this._overflowTelemetrySent=!1,this._visitedConversations=[],this._renderConversationTab=(e,t,s)=>{let i;const n=this.state.conversationIds&&this.state.conversationIds.length||0;this.state.counts&&this.state.counts[e]&&this.state.counts[e].unreadCount&&(i=this.state.counts[e].unreadCount);const a=[];let l,d;return this.state.isSmallScreen||a.push(U.desktopTabContainer),(this.state.isSmallScreen||this.state.enableConversationTabsDropdown&&this.state.tabsConfiguration.hiddenConversations.length)&&a.push(B.default.flexOne),s&&this.state.enableConversationTabsDropdown&&(l=this._themeStyles.rowHoverViewStyle,d=this._themeStyles.rowHoverViewStyle,a.push(B.default.flexOne,U.hiddenTabContainer),t<this.state.conversationIds.length-1&&a.push(r.Styles.createViewStyle({borderColor:this._themeColors.surfaceSecondary,borderBottomWidth:1},!1))),(0,o.jsx)(h.default,{ref:this._mountedRefsMap.onComponentRef(e),convId:e,icon:S.ConversationUtils.getIconForConversationMri(e),tabPosition:t,totalTabs:n,tabContainerStyle:a,tabContainerHoverStyle:l,tabContainerSelectedStyle:d,selected:this.props.currentConversationId===e,focused:this.state.focusedConversationId===e,shouldUpdateOnFocus:this.state.hasFocus,badgeCount:i,onShowActionMenu:this._showActionMenu,onNavigateToConversation:this._navigateToConversation,preventAccessibilityFocus:this.props.preventAccessibilityFocus,hasMultipleSmsTabs:this._hasMultipleSmsTabs()},e)},this._onHiddenTabsDropdownButtonRef=e=>{this._hiddenTabsDropdownButtonRef=e||void 0},this._onHiddenTabsDropdownButtonPress=()=>{const e=O.default.newCauseId();v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._onHiddenTabsDropdownButtonPress isHiddenTabsDropdownVisible: "+this._isHiddenTabsDropdownVisible+" causeId: "+e),this._isHiddenTabsDropdownVisible?this._hideHiddenTabsDropdown(e):this._showHiddenTabsDropdown(this.state.tabsConfiguration.hiddenConversations,e)},this._navigateToConversation=e=>{const t=O.default.newCauseId();let s;v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._navigateToConversation, causeId: "+t),s=()=>{w.default.setLastOpenedTabForUser(this.props.mri,e),P.default.navigateToConversation({causeId:t,convId:e,shouldReplaceCurrentContext:!0,origin:f.NavigationConversationOrigin.TabSwitcher})},this.state.enableConversationTabsDropdown?this.setState({headTabId:e},s):s()},this._showActionMenu=(e,t)=>{m.default.open(e,t,(()=>this._mountedRefsMap.ref(t)),this._getContext())},this._onKeyPress=e=>{if(!this.isComponentMounted())return;const t=this.state.conversationIds;let s=n.findIndex(t,(e=>e===this.state.focusedConversationId));e.keyCode!==C.default.DOWN&&e.keyCode!==C.default.LEFT||(s-=1),e.keyCode!==C.default.UP&&e.keyCode!==C.default.RIGHT||(s+=1),s<0?s=t.length-1:s>=t.length&&(s=0),this.setState({focusedConversationId:t[s]})},this._onBlur=()=>{this._focusResetTimeout&&E.default.clearTimeout(this._focusResetTimeout),this._focusResetTimeout=E.default.setTimeout((()=>{this.isComponentMounted()&&this.state.focusedConversationId!==this.props.currentConversationId&&this.setState({hasFocus:!1,focusedConversationId:this.props.currentConversationId})}),250)},this._onFocus=()=>{this.isComponentMounted()&&!this.state.hasFocus&&this.setState({hasFocus:!0}),this._focusResetTimeout&&(E.default.clearTimeout(this._focusResetTimeout),this._focusResetTimeout=void 0)}}_buildState(e,t){const s=(0,g.default)().getConversation(e.currentConversationId),i=d.isOneOnOneConversation(e.mri)?u.default.getDisplayableConversationsForUser(e.currentConversationId):[],o=d.isOneOnOneConversation(e.mri)?u.default.getAllSiblingConversations(e.currentConversationId):[],r=a.default.getS4LMessagingFeaturesNoSubscription().enableConversationTabsDropdown;s&&!n.includes(this._visitedConversations,s)&&n.includes(o,s)&&!n.includes(i,s)&&this._visitedConversations.push(s);const l=p.default.getConversationsWithDraft(),h=n.intersection(l,o),m=n.intersection(this._visitedConversations,o);m.length||(this._visitedConversations=[]);const _=n.uniqBy(i.concat(m,h),"id"),f=S.ConversationUtils.getOrderedConversationIds(_,s),y=this._getRootViewId(),v=k.default.isUsingStackNavigationContext(),C=A.default.getWidth(y),T=e.currentConversationId,M=C<=750,b=M?0:D.default.getWidth(D.SideBar.Left),I={conversationIds:f,isSmallScreen:M,isStackNav:v,width:C,focusedConversationId:T,enableConversationTabsDropdown:r,isSmallDevice:A.default.isSmallDevice(y)};return this._hasMultipleConversations(I)?I.counts=n.reduce(f,((e,t)=>(e[t]=c.default.getMessageCountsForConversation(t),e)),{}):I.counts=void 0,t&&(I.hasFocus=!1),r&&(I.tabsConfiguration=this._getTabsConfiguration(f,I.width||0,b)),I}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),this.state.enableConversationTabsDropdown&&this.state.tabsConfiguration.hiddenConversations.length!==t.tabsConfiguration.hiddenConversations.length){const e=O.default.newCauseId();v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher.UNSAFE_componentWillUpdate, causeId: "+e),this._hideHiddenTabsDropdown(e)}}_hasMultipleConversations(e=this.state){return!!e.conversationIds&&e.conversationIds.length>1}_hasMultipleSmsTabs(e=this.state){return!!e.conversationIds&&e.conversationIds.filter((e=>d.isPhoneMri(e))).length>1}_renderTabsDropdownContainer(){if(!this.state.enableConversationTabsDropdown)return;if(!this.state.tabsConfiguration.hiddenConversations.length)return;const e=this.state.tabsConfiguration.hiddenConversations.map((e=>this.state.counts&&this.state.counts[e]&&this.state.counts[e].unreadCount||0)).reduce(((e,t)=>t+e)),t=r.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1),s=e&&!this.state.isSmallDevice?(0,o.jsx)(l.default,{count:e.toString(),rawCount:e,badgeSize:l.BadgeSize.Desktop,isHighPriority:!0,colorStyle:t,style:U.hiddenTabsDropdownBadge}):null,i=[U.hiddenTabsDropdownButtonContainer];e&&i.push(U.hiddenTabsDropdownWithCounterContainer);const n=this.props.preventAccessibilityFocus?r.Types.ImportantForAccessibility.NoHideDescendants:void 0;return(0,o.jsxs)(r.View,{style:i,importantForAccessibility:n,children:[(0,o.jsx)(y.default,{ref:this._onHiddenTabsDropdownButtonRef,icon:L.SkypeIcon.DownChevron,title:M.getString("Global.MoreButtonTitle"),color:R.Color.gray300,hoverColor:this._themeColors.iconHoverColor,size:L.IconSize.size15,onPress:this._onHiddenTabsDropdownButtonPress}),s]})}render(){const{tabsConfiguration:e,conversationIds:t}=this.state,s=this._hasMultipleConversations(),i=[U.wrapper,this._themeStyles.messageStreamBackgroundColorStyle];this.props.safeAreaHorizontalInsets&&x.default.hasHorizontalSafeAreas(this.props.safeAreaHorizontalInsets)&&i.push(x.default.horizontalPaddingStyle(this.props.safeAreaHorizontalInsets)),this.props.style&&i.push(this.props.style),this.state.isStackNav&&s&&i.push(U.wrapperStackNav),s&&this.props.heightStyle&&i.push(this.props.heightStyle);let a=[];return a=this.state.enableConversationTabsDropdown?s?n.map(e.visibleConversations,((e,t)=>this._renderConversationTab(e,t,!1))):void 0:s?n.map(t,((e,t)=>this._renderConversationTab(e,t,!1))):void 0,i.push(r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)),a?(0,o.jsxs)(r.View,{style:i,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityTraits:r.Types.AccessibilityTrait.TabList,onKeyPress:this._onKeyPress,onFocus:this._onFocus,onBlur:this._onBlur,children:[a,this._renderTabsDropdownContainer()]}):(0,o.jsx)(r.View,{style:i})}_hideHiddenTabsDropdown(e){v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._hideHiddenTabsDropdown, causeId: "+e),_.default.close(this._getRootViewId(),e)}_showHiddenTabsDropdown(e,t){v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher._showHiddenTabsDropdown, causeId: "+t);const s=e.map(((e,t)=>{const s=this._renderConversationTab(e,t,!0);return{builder:()=>s,props:{key:e+t,rowHeight:40}}}));this._isHiddenTabsDropdownVisible=!0,_.default.showWithBuilders({builders:s,anchor:()=>this._hiddenTabsDropdownButtonRef,rootViewId:this._getRootViewId(),getTitle:()=>{},onCloseMenu:e=>{v.log(f.LogTraceArea.Navigation,"ConversationGroupSwitcher.onCloseMenu, causeId: "+e),this._isHiddenTabsDropdownVisible=!1},staticContent:!0,useDesktopPopup:!0,menuId:"HiddenTabsMenu"})}_getTabsConfiguration(e,t,s){const i={hiddenConversations:[],visibleConversations:[]},o=t-s,r=A.default.isSmallDevice(this._getRootViewId());F.default.isTablet();let a=3;a=r?2:(o-62)/148;const l=Math.min(a,e.length),d=[...e];if(i.visibleConversations=d.splice(0,l),i.hiddenConversations=d,this.state&&void 0!==this.state.headTabId){const e=n.remove(i.hiddenConversations,(e=>e===this.state.headTabId));if(e.length){const t=i.visibleConversations.splice(-1,1,e[0]);i.hiddenConversations.unshift(t[0])}}return i.hiddenConversations.length&&!this._overflowTelemetrySent&&(this._overflowTelemetrySent=!0,v.track(new b.MessagingTabsHiddenEvent(i.visibleConversations.length,i.hiddenConversations.length))),i}}t.default=V},603743:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(309520)),a=i.__importStar(s(44717)),l=i.__importDefault(s(340724)),d=i.__importDefault(s(543915)),c=i.__importDefault(s(615364)),u=s(535973),h=s(26703),p=i.__importStar(s(704704)),g=i.__importStar(s(808164)),m=s(16549),S=i.__importDefault(s(827361)),_=s(262725),f=i.__importDefault(s(497910)),y=(0,h.lazyProperties)({conversationTitle:()=>n.Styles.createTextStyle({textAlign:"center",marginHorizontal:6}),conversationItem:()=>n.Styles.createViewStyle({paddingBottom:8,borderBottomWidth:2,borderStyle:"solid",borderColor:m.Color.transparent,flexDirection:"row",justifyContent:"center",alignItems:"center"}),conversationItemDesktop:()=>n.Styles.createViewStyle({paddingHorizontal:10}),conversationItemMobile:()=>n.Styles.createViewStyle({paddingHorizontal:8})});class v extends f.default{constructor(){super(...arguments),this._onShowActionMenu=e=>{e.stopPropagation(),e.preventDefault(),this.props.onShowActionMenu(e,this.props.convId)},this._onPress=e=>{e.stopPropagation(),e.preventDefault(),this.props.onNavigateToConversation(this.props.convId)},this._onTabKeyPress=e=>d.default.maybeHandleKeyPress(e,(()=>{this.props.onNavigateToConversation(this.props.convId)})),this._onComponentRef=e=>{this._componentRef=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})}}_buildState(e,t){const s=(0,c.default)().getConversation(e.convId);return{otherPartyMri:s&&s.getOtherPartyMri()||""}}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),e.shouldUpdateOnFocus&&e.focused&&!this.props.focused&&this._componentRef&&this._componentRef.requestFocus&&this._componentRef.requestFocus()}render(){const e=[y.conversationItem,S.default.noncollapsibleView,S.default.pointerCursor],t=[y.conversationTitle,n.Styles.createTextStyle({color:this._themeColors.secondaryTextColor},!1)];let s,i;const d=!!this.props.selected,c=u.ConversationUtils.getConversationNameForTab(this.props.convId,this.state.otherPartyMri,this.props.hasMultipleSmsTabs);let h=l.default.applyMoreOptionsAccessibilityHint(d?p.getString("ContentPanelHeader.CurrentConversationTab",{conversationType:c}):p.getString("ContentPanelHeader.SwitchToConversation",{conversationType:c}));if(this.props.badgeCount){h+=", "+p.getString("ContentPanelHeader.UnreadMessageCount",{count:this.props.badgeCount})}d?(i=this.props.tabContainerSelectedStyle,t.push(this._themeStyles.primaryTextColorStyle),e.push(n.Styles.createViewStyle({borderColor:this._themeColors.primaryTextColor},!1))):this.state.isHovering&&(s=this.props.tabContainerHoverStyle,e.push(n.Styles.createViewStyle({borderColor:this._themeColors.strokePrimary},!1))),this._useAccessibleTheme()&&t.push(this._themeStyles.primaryTextColorStyle),this.props.useMobileTabs?e.push(y.conversationItemMobile):e.push(y.conversationItemDesktop);const m=this.props.badgeCount&&!d?(0,o.jsx)(r.default,{count:this.props.badgeCount.toString(),rawCount:this.props.badgeCount,badgeSize:r.BadgeSize.Desktop,isHighPriority:!0,colorStyle:this.state.badgeColorStyle}):void 0,f=l.default.tabAccessibilityLabel(h,this.props.tabPosition,this.props.totalTabs,!1),v=l.default.tabAccessibilityTraits(d),C=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.Yes;let T;if(a.isConversationWithPhoneNumber(this.props.convId)){const e=a.stripMriNamespace(this.state.otherPartyMri);T=g.default.parseAndFormat(e,g.PhoneNumberFormat.INTERNATIONAL)||e}return(0,o.jsxs)(n.View,{ref:this._onComponentRef,style:[e,this.props.tabContainerStyle,s,i],tabIndex:this.props.focused?0:-1,onPress:this._onPress,onKeyPress:this._onTabKeyPress,onLongPress:this._onShowActionMenu,onContextMenu:this._onShowActionMenu,importantForAccessibility:C,accessibilityTraits:v,accessibilityLabel:f,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,title:T,children:[(0,o.jsx)(_.BodyText,{style:t,numberOfLines:1,children:c}),m]})}}t.default=v},727518:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectMessagesUIState=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(859745)),r=i.__importStar(s(516778)),a=i.__importDefault(s(179075)),l=i.__importDefault(s(150343)),d=i.__importDefault(s(659312)),c=i.__importDefault(s(805121)),u=i.__importDefault(s(369347)),h=s(843890),p=i.__importDefault(s(859545)),g=s(897704),m=i.__importStar(s(926101)),S=i.__importStar(s(172134)),_=i.__importStar(s(44717)),f=s(315742),y=s(973585),v=i.__importDefault(s(363437)),C=i.__importStar(s(185013)),T=i.__importDefault(s(574489)),M=i.__importDefault(s(202617)),b=i.__importDefault(s(615364)),I=i.__importDefault(s(260928)),w=i.__importDefault(s(691821)),P=i.__importStar(s(170881)),k=s(815146),A=i.__importDefault(s(296374)),x=i.__importStar(s(800662)),D=i.__importDefault(s(819336)),R=i.__importDefault(s(524526)),L=i.__importDefault(s(457468)),B=i.__importStar(s(85385)),F=i.__importDefault(s(214295)),N=i.__importDefault(s(97595)),E=s(26703),O=i.__importDefault(s(432091)),U=i.__importStar(s(704704)),V=i.__importDefault(s(791612)),H=i.__importDefault(s(574818)),j=s(106333),z=i.__importDefault(s(647780)),W=s(227313),G=s(875770),K=i.__importStar(s(632655)),q=s(777745),Q=s(675862),X=i.__importDefault(s(670363)),$=i.__importDefault(s(740794)),J=s(113002),Y=i.__importDefault(s(450312)),Z=i.__importDefault(s(960282)),ee=i.__importStar(s(437782)),te=i.__importDefault(s(117475)),se=i.__importDefault(s(377556)),ie=i.__importDefault(s(791384)),oe=s(376229),ne=s(240804),re=i.__importDefault(s(654686)),ae=i.__importDefault(s(468492)),le=i.__importDefault(s(322094)),de=s(16549),ce=i.__importDefault(s(827361)),ue=i.__importDefault(s(48076)),he=i.__importDefault(s(497910)),pe=s(464271),ge=i.__importDefault(s(160738)),me=i.__importDefault(s(760989)),Se=s(337249),_e=s(717413),fe=s(771840),ye=s(742403);var ve;!function(e){e[e.Active=0]="Active",e[e.Closing=1]="Closing",e[e.Deactive=2]="Deactive"}(ve||(t.SelectMessagesUIState=ve={}));const Ce=(0,E.lazyProperties)({headerWrapper:()=>r.Styles.createViewStyle({borderBottomWidth:1,borderStyle:"solid",borderColor:de.Color.transparent}),containerHorizontal:()=>r.Styles.createViewStyle({flexDirection:"row"}),contentPanel:()=>r.Styles.createViewStyle({flex:1,alignItems:"center"}),contentPanelContents:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),contentPanelLowerContents:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",paddingBottom:20}),contentPanelLowerContentsNoPadding:()=>r.Styles.createViewStyle({paddingBottom:0})});class Te extends he.default{constructor(){super(...arguments),this._virtualStreamRefCount=0,this._innerMovingContainerSelectMessagesHeader=new r.Animated.Value(0),this._innerMovingContainerSelectMessagesActions=new r.Animated.Value(0),this._searchStore=new M.default,this._coachMarkContext={coachMarkArea:f.CoachMarkAreaType.Conversation},this._onMessagePanelRef=e=>{this._messagePanel=e||void 0},this._onDropDownRef=e=>{this._dropdownRef=e||void 0},this._onSelectedMessagesHeaderRef=e=>{this._selectedMessagesHeaderRef=e||void 0},this._onMessageSearchPanelRef=e=>{this._messageSearchPanel=e||void 0},this._onMessageSent=()=>{if(this.state.isSearchShowing){const e=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"DesktopContentPanel._onMessageSent, causeId: "+e),$.default.closeSearchPanel(e,this._getContext(),!0)}},this._handleLaunchCamera=()=>{if(!h.UICapabilities.cameraSupported())return;P.dismissAll();const e=this.props.navContext;m.navigateToCaptureComboModalWithParams({capturedContentHandler:new g.CapturedContentHandlerForPosting(e.state.conversationId),conversationId:e.state.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0,allowOfficeLens:!0},this._getContext())},this._onToggleFindPanelWithOverflowConfig=e=>{const t=me.default.newCauseId();if(B.log(k.LogTraceArea.ContentPanel,"DesktopContentPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing)B.track(new j.MessageOverflowEvent(j.MessageOverflowAction.MessageOverflowCloseButtonClicked)),$.default.closeFindPanel(t,this._getContext());else{const s=this.props.navContext.state.conversationId;s&&(B.track(new j.MessageOverflowEvent(j.MessageOverflowAction.MessageOverflowOpenButtonClicked)),$.default.navigateToFindPanel(s,e,this._getContext(),t,this.state.useTabletUI?this._onCloseFindPanel:void 0),ie.default.maybeAnnounceForAccessibility(U.getString("FindPanel.FindPanelOpenedAccessibilityLabel")))}return!0},this._onCloseFindPanel=()=>{const e=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"DesktopContentPanel._onCloseFindPanel, causeId: "+e),$.default.closeFindPanel(e,this._getContext())},this._onToggleFindPanel=e=>{this._onToggleFindPanelWithOverflowConfig(e),w.default.close(this._getRootViewId())},this._onCallStartedAnsweredOrJoinedViaHeader=()=>{this.blurStream()},this._onOpenDropdown=()=>{this._dropdownRef&&this._dropdownRef.showOrHide()},this._onShowGestureHint=e=>{this.isComponentMounted()&&this.setState({toolTipInfo:e})},this._onDismissPopup=()=>{this.isComponentMounted()&&this.state.toolTipInfo&&this.setState({toolTipInfo:void 0})},this._onEscape=()=>(this._selectedMessagesHeaderRef&&this._selectedMessagesHeaderRef.cancelMultipleMessages(),!0),this._onCloseSelectMessagesPanel=(e,t)=>{if(!this.isComponentMounted())return;this.setState({currentSelectMessagesUIState:ve.Closing});const s=[X.default.timing(this._innerMovingContainerSelectMessagesHeader,{toValue:e,duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoIn5,useNativeDriver:!0}),X.default.timing(this._innerMovingContainerSelectMessagesActions,{toValue:t,duration:n.Common.Duration.Default,easing:n.Easing.SkypeExpoIn5,useNativeDriver:!0})];r.Animated.parallel(s).start((e=>{e.finished&&this.isComponentMounted()&&this.setState({currentSelectMessagesUIState:ve.Deactive})}))},this._trackSearchClosed=e=>{this._messageSearchPanel&&(B.track(new q.ClosedSearch(e,this._messageSearchPanel.didUserSearch(),this._messageSearchPanel.getLastSearchResultsCount(),this._messageSearchPanel.getNumberOfRequests())),this._messageSearchPanel.resetTelemetryParams())},this._startVideoCall=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;if(s&&u.default.CallNavigationHelper.isOutgoingCallingAllowed(s)){const e=me.default.newCauseId();B.log(k.LogTraceArea.Calling,"DesktopContentPanel._startVideoCall KeyboardShortcut"+e),u.default.CallNavigationHelper.startCall({conversationMri:s,withVideo:!0,origin:k.NavigationCallOrigin.DesktopContentPanel},e).then((()=>{ie.default.maybeAnnounceForAccessibility(U.getString("CallOrInviteMenu.StartVideoCallKeyboardShortcutAccessibilityLabel"))}))}return!0},this._startAudioCall=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;if(s&&u.default.CallNavigationHelper.isOutgoingCallingAllowed(s)){const e=me.default.newCauseId();B.log(k.LogTraceArea.Calling,"DesktopContentPanel._startAudioCall KeyboardShortcut"+e),u.default.CallNavigationHelper.startCall({conversationMri:s,withVideo:!1,origin:k.NavigationCallOrigin.DesktopContentPanel},e).then((()=>{ie.default.maybeAnnounceForAccessibility(U.getString("CallOrInviteMenu.StartAudioCallKeyboardShortcutAccessibilityLabel"))}))}return!0},this._showConversationProfile=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"DesktopContentPanel._showConversationProfile, causeId: "+s);const i=this.props.navContext.state.conversationId;return $.default.closeGenericDesktopModal(s,this._getRootViewId()),i&&$.default.showDetailsPanelWithParams({mri:i,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:s}),!0},this._addPeopleToConversation=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread||this.state.isS4BConversation)return!1;const s=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"DesktopContentPanel._addPeopleToConversation, causeId: "+s);const i=this.props.navContext.state.conversationId;if($.default.closeGenericDesktopModal(s,this._getRootViewId()),_.isGroupConversation(i)){new I.default({convId:_.asSkypeThreadIdMaybe(i),navigationOrigin:k.NavigationConversationOrigin.KeyboardShortcutAddPeopleToGroup,peopleType:ne.PeopleType.AllExcludingBots,filterPeopleType:ne.FilterType.GroupCapable,wizardSteps:[J.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}else{new I.default({peopleType:ne.PeopleType.AllExcludingBots,filterPeopleType:ne.FilterType.GroupCapable,navigationOrigin:k.NavigationConversationOrigin.KeyboardShortcutNewGroupWithUser,invitedUsersMris:[i],wizardSteps:[J.WizardSteps.setConvParticipants]}).start(this._getRootViewId())}return!0},this._markAsUnread=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId;return s&&this.state.unreadCount<1&&S.markMessageUnread(s),r.Accessibility.announceForAccessibility(U.getString("ConversationsListItem.MarkUnreadAnnouncement")),!0},this._enableMultipleMessagesMode=(e,t)=>t===this._getRootViewId()&&!this.state.isBookmarksThread&&(ae.default.activateSelectMessagesMode(t),!0),this._onGalleryPress=e=>{e&&(e.stopPropagation(),e.preventDefault());const t=Y.default.isGalleryShowing();$.default.toggleGallery(this.props.navContext.state.conversationId,this._getContext()),t?ie.default.maybeAnnounceForAccessibility(U.getString("AccessibilityLabel.GalleryClosed")):ie.default.maybeAnnounceForAccessibility(U.getString("AccessibilityLabel.GalleryOpened"))},this._onToggleMessageSearchPanel=e=>!!this.state.isMessageSearchPanelEnabled&&(this.state.isMessageSearchPanelVisible?(this._searchStore.cancelSearch(),this._trackSearchClosed(e),this._messageSearchPanelOpenOrigin===oe.MessageSearchToggleOrigin.HeaderIcon&&r.UserInterface.isNavigatingWithKeyboard()?x.setFocus(x.FocusEvent.MessageSearchClosed):this._focusMessageComposer(),this._messageSearchPanelOpenOrigin=void 0):(this.blurStream(),this._searchStore.resetSearch(),this._messageSearchPanelOpenOrigin=e,B.track(new q.OpenedSearch(e))),!0),this._onToggleSearchByShortcut=(e,t)=>!(!this.state.isMessageSearchPanelEnabled||t!==this._getRootViewId()||this.state.isBookmarksThread||this.state.isS4BConversation)&&(this._onToggleMessageSearchPanel(oe.MessageSearchToggleOrigin.KeyboardShortcut),!0),this._onToggleSearchByHeaderIcon=()=>{this._onToggleMessageSearchPanel(oe.MessageSearchToggleOrigin.HeaderIcon)},this._archiveConversation=(e,t)=>{if(t!==this._getRootViewId()||this.state.isBookmarksThread)return!1;const s=this.props.navContext.state.conversationId,i=(0,b.default)().getConversation(s),o=this._getContext();return!i||i.isArchived()||u.default.ActiveCallUIHelper.hasActiveCall(s)||d.default.showIfRequired(this._getRootViewId()).then((()=>{const e=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"[DesktopContentPanel] - _archiveConversation causeId: "+e),c.default.archiveConversation(s,k.ArchiveConversationOrigin.KeyboardShortcut,this._getRootViewId()),$.default.navigateAfterArchivingConversation(s,e,o)})),!0},this._focusMessageComposer=()=>{this._messagePanel&&this._messagePanel.focusTextInputForAccessibility()}}_buildState(e,t){const{tabletConversationDetailsEnabled:s}=l.default.getS4LUiFeatures(),i=e.navContext.state.conversationId,o=(0,b.default)().getConversation(i),n={bottomSafeAreaInset:te.default.bottomSafeAreaInset(4),isKeyboardShown:F.default.isKeyboardSeen(),showMagicBotConsentBanner:(0,_e.isMagicBotContainingConversation)(o)&&(null==o?void 0:o.isGroupConversation())},r=this.props,d=this._getRootViewId();n.otherPartyMri=o&&o.isOneOnOne()?o.getOtherPartyMri():void 0;const c=C.isConversationBlocked(i);n.responsiveWidth=Z.default.getResponsiveWidth(d),n.isFileUploadCapable=!L.default.isUsingGogoNetwork()&&i&&(!_.isAgent(i)||a.default.hasCapability(i,"file.send"))&&!c&&!(o&&o.isLogicalOneOnOneSmsConversation())&&!_.isS4BBridgeMri(i)&&!e.navContext.state.selectedNumberForSMS,n.hasConnectedCalls=u.default.CallingStore.hasConnectedCalls(),n.isConversationBlocked=c,n.localAddressBookContact=i&&_.isOneOnOneConversation(i)?O.default.getContactByCorrespondingMri(i):void 0;const h=u.default.ActiveCallUIHelper.getActiveCallInfo(i);return n.activeCallId=null==h?void 0:h.callId,n.activeCallJoinContext=null==h?void 0:h.liveState,n.hasActiveCall=u.default.ActiveCallUIHelper.hasActiveCall(i),n.activeCallStatus=u.default.ActiveCallUIHelper.activeCallStatus(i),n.unreadCount=i?T.default.getMessageCountsForConversation(i).unreadCount:0,n.useTabletUI=ue.default.isTabletUI(),n.useDropdown=!!n.otherPartyMri&&n.useTabletUI&&s,n.isSearchShowing=Y.default.isSearchShowing(),n.isFindPanelShowing=Y.default.isFindPanelShowing(d),n.isSelectMessagesModeActive=ae.default.isSelectMessagesModeActive(d),n.isNewsChannel=(0,ye.isContentChannel)(o),n.isNewsBot=(0,ye.isTodayBot)(i),n.isSelectMessagesModeActive?n.currentSelectMessagesUIState=ve.Active:!t&&K.shouldCancelMessageSelection(r.navContext.state.conversationId,e.navContext.state.conversationId)?n.currentSelectMessagesUIState=ve.Deactive:n.currentSelectMessagesUIState=this.state?this.state.currentSelectMessagesUIState:ve.Deactive,n.canSeeGuestUpsell=p.default.identity().canSeeGuestUpsell,n.isTranslatedConversation=R.default.isConversationTranslated(i),n.isMessageSearchPanelEnabled=_.isSearchInConversationSupported(i)&&!n.isTranslatedConversation,n.isMessageSearchPanelVisible=n.isMessageSearchPanelEnabled&&!!this._searchStore.getSearchQuery(),n.isBookmarksThread=_.isBookmarkConversation(i),n.isS4BConversation=_.isS4BBridgeMri(i),n}blurStream(){this._messagePanel&&this._messagePanel.blur()}_componentId(){return"DesktopContentPanel"}componentDidMount(){super.componentDidMount();const e=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"[DesktopContentPanel] - componentDidMount causeId: "+e),this._newConversationSetup(this.props.navContext,e),this._registerKeyboardHandlers();const{scrollToTimestamp:t}=this.props.navContext.state;if(t){const e=`[DesktopContentPanel] - componentDidMount, searchStore.setTimestamp: ${t}`;B.log(k.LogTraceArea.ContentPanel,e),this._searchStore.setTimestamp(t)}}UNSAFE_componentWillReceiveProps(e,t){const s=this.props.navContext,i=e.navContext,o=i.state.conversationId,n=o!==s.state.conversationId,r=me.default.newCauseId();B.log(k.LogTraceArea.ContentPanel,"[DesktopContentPanel] - UNSAFE_componentWillReceiveProps causeId: "+r,"Conversation id differs = "+n),n?(this.props.enableConversationSwitchWithoutRemount?this._oldConversationCleanup():this._virtualStreamRefCount++,this._searchStore.cancelSearch(),this._newConversationSetup(i,r)):V.default.isMediaPreviewEnabled(o)&&!this.props.navContext.state.selectedNumberForSMS&&e.navContext.state.selectedNumberForSMS&&H.default.destroy(o);const a=i.state.scrollToTimestamp;if(a){const e=`DesktopContentPanel, searchStore.setTimestamp: ${a}, causeId: ${r}`;B.log(k.LogTraceArea.ContentPanel,e),this._searchStore.setTimestamp(a,void 0,i.state.causeId)}super.UNSAFE_componentWillReceiveProps(e,t)}componentWillUnmount(){super.componentWillUnmount(),this._gifPreviewOpenSubscriptionToken&&this._gifPreviewOpenSubscriptionToken.unsubscribe(),this._gifPreviewCloseSubscriptionToken&&this._gifPreviewCloseSubscriptionToken.unsubscribe(),this._unregisterKeyboardHandlers(),N.default.removeEscapeHandler(this._onEscape),this._oldConversationCleanup(!0)}_newConversationSetup(e,t){const s=e.state.conversationId;s&&(B.log(k.LogTraceArea.ContentPanel,"[DesktopContentPanel] - maybePreheatCall for conversation, id: "+ee.mriOrId(s)+" causeId: "+t),u.default.CallPreheatHelper.maybePreheatCall(s,t)),e.state.origin===k.NavigationConversationOrigin.GoLiveNotification&&x.setFocus(x.FocusEvent.OpenGoLiveNotification)}_oldConversationCleanup(e=!1){const t=this.props.navContext,s=[pe.Scenarios.SearchToConversation,pe.Scenarios.RecommendationFromRecentsToConversation,pe.Scenarios.RecommendationFromContactsToConversation];ge.default.interruptScenarios(t.state.conversationId,s),ae.default.isSelectMessagesModeActive(this._getRootViewId())&&ae.default.deactivateSelectMessagesMode(),this.state.isMessageSearchPanelVisible&&this._trackSearchClosed(oe.MessageSearchToggleOrigin.NavigationOut)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isSelectMessagesModeActive!==this.state.isSelectMessagesModeActive&&(this.state.isSelectMessagesModeActive?N.default.addEscapeHandler(this._onEscape):N.default.removeEscapeHandler(this._onEscape))}render(){const e=le.default.getWidthNoSubscription(),t=this.props.navContext,s=this.state.toolTipInfo?(0,o.jsx)(A.default,{toolTipInfo:this.state.toolTipInfo,onDismiss:this._onDismissPopup,containerOffsetX:e}):void 0,i=this.state.useDropdown?(0,o.jsx)(v.default,{ref:this._onDropDownRef,conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri},t.state.conversationId):void 0,n=[Ce.containerHorizontal,this._themeStyles.primaryBackgroundColorStyle];this.props.enableConversationSwitchWithoutRemount?n.push(ce.default.flexOne):n.push(ce.default.absoluteFill),n.push(r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1));const a=Se.WindowDimensionUtils.measureWindow(this._getRootViewId()).width-e;let l,d;this.state.currentSelectMessagesUIState!==ve.Deactive&&(l=(0,o.jsx)(re.default,{ref:this._onSelectedMessagesHeaderRef,renderHeader:!0,conversationId:t.state.conversationId,mobileUi:this.state.useTabletUI,panelAnimatedValue:this._innerMovingContainerSelectMessagesHeader,onClosePanel:this._onCloseSelectMessagesPanel}),d=(0,o.jsx)(re.default,{renderActions:!0,conversationId:t.state.conversationId,panelAnimatedValue:this._innerMovingContainerSelectMessagesActions,onClosePanel:this._onCloseSelectMessagesPanel}));const c=this.state.canSeeGuestUpsell?(0,o.jsx)(D.default,{}):void 0,u=this.state.isSelectMessagesModeActive||this.state.isMessageSearchPanelVisible&&this.state.useTabletUI,h=(0,o.jsx)(y.ContentPanelHeader,{conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri,callId:this.state.activeCallId,callJoinContext:this.state.activeCallJoinContext,hasActiveCall:this.state.hasActiveCall,activeCallStatus:this.state.activeCallStatus,localAddressBookPhones:this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,onCallStartedAnsweredOrJoined:this._onCallStartedAnsweredOrJoinedViaHeader,onOpenDropdown:this.state.useDropdown?this._onOpenDropdown:void 0,preventAccessibilityFocus:u,hideConversationSwitcher:this.state.isSelectMessagesModeActive,onToggleMessageSearchPanel:this._onToggleSearchByHeaderIcon,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,isMessageSearchPanelEnabled:this.state.isMessageSearchPanelEnabled,onGalleryPressed:this._onGalleryPress,hideBackButton:this.props.navContext.state.hideBackButton,openMagicBotToolboxByDefault:this.props.navContext.state.openMagicBotToolboxByDefault,inviteToken:t.state.inviteToken}),p=(0,o.jsx)(W.MessageSearchPanelAnimatedWrapper,{conversationId:t.state.conversationId,onCancel:this._onToggleMessageSearchPanel,ref:this._onMessageSearchPanelRef,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,useMobileUI:this.state.useTabletUI,searchStore:this._searchStore}),g=this.state.useTabletUI?(0,o.jsx)(G.MobileSearchNavigationPanel,{useMobileUI:!0,searchStore:this._searchStore}):void 0,m=[Ce.contentPanelLowerContents,this.state.isBookmarksThread||this.state.isNewsChannel||this.state.isNewsBot?Ce.contentPanelLowerContentsNoPadding:void 0];return this.state.bottomSafeAreaInset&&!this.state.isKeyboardShown&&m.push(se.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),(0,o.jsx)(r.View,{style:n,children:(0,o.jsxs)(f.CoachMarkContext.Provider,{value:this._coachMarkContext,children:[(0,o.jsxs)(r.View,{style:ce.default.flexOne,children:[(0,o.jsxs)(r.View,{style:[Ce.headerWrapper,r.Styles.createViewStyle({borderBottomWidth:1,borderColor:this._getContext().themeColors.dividerPrimary},!1)],children:[h,p,l,c,this.state.showMagicBotConsentBanner?(0,o.jsx)(fe.MagicBotConsentBanner,{}):null]}),(0,o.jsxs)(r.View,{style:Ce.contentPanel,children:[(0,o.jsx)(r.View,{style:Ce.contentPanelContents,children:(0,o.jsx)(r.View,{style:m,children:(0,o.jsx)(z.default,{ref:this._onMessagePanelRef,enableConversationSwitchWithoutRemount:this.props.enableConversationSwitchWithoutRemount,conversationId:t.state.conversationId,otherPartyMri:this.state.otherPartyMri,focusedMessageCuid:t.state.focusedMessageCuid,forceRefreshFocus:t.state.forceRefreshFocus,allowUploads:this.state.isFileUploadCapable,isNewConversation:t.state.isNewConversation,isFindPanelHidden:!this.state.isFindPanelShowing,availableWidth:a,hasConnectedCalls:this.state.hasConnectedCalls,selectedNumberForSMS:t.state.selectedNumberForSMS,inviteToken:t.state.inviteToken,showBottomDivider:this.state.useTabletUI,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanel,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onInitialRenderComplete:this.props.onInitialRenderComplete,isInvisible:this.props.isInvisible,onMessageSent:this._onMessageSent,onShowGestureHint:this._onShowGestureHint,isSelectMessagesModeActive:this.state.isSelectMessagesModeActive,isFromSearch:this.state.isSearchShowing,isFromPeopleRecommendations:t.state.isFromPeopleRecommendations,isMessageSearchPanelVisible:this.state.isMessageSearchPanelVisible,focusJoinCallButton:this.props.navContext.state.origin===k.NavigationConversationOrigin.GoLiveNotification,directShareEventData:this.props.navContext.state.directShareEventData,isTranslatedConversation:this.state.isTranslatedConversation,searchStore:this._searchStore},this.props.enableConversationSwitchWithoutRemount?void 0:this._virtualStreamRefCount)})}),i]}),d,g]}),s]})})}_registerKeyboardHandlers(){const e=this.props.navContext.state.conversationId,t=(0,b.default)().getConversation(e);(0,Q.isRegularMemberInModeratedGroup)(t)||(N.default.addHandler(k.KeyboardShortcut.StartVideoCall,this._startVideoCall),N.default.addHandler(k.KeyboardShortcut.StartAudioCall,this._startAudioCall),N.default.addHandler(k.KeyboardShortcut.AddPeopleToConversation,this._addPeopleToConversation)),N.default.addHandler(k.KeyboardShortcut.ShowConversationProfile,this._showConversationProfile),N.default.addHandler(k.KeyboardShortcut.MarkAsUnread,this._markAsUnread),N.default.addHandler(k.KeyboardShortcut.EnableMultipleSelectMessages,this._enableMultipleMessagesMode),N.default.addHandler(k.KeyboardShortcut.ArchiveConversation,this._archiveConversation),N.default.addHandler(k.KeyboardShortcut.SearchInConversation,this._onToggleSearchByShortcut)}_unregisterKeyboardHandlers(){const e=this.props.navContext.state.conversationId,t=(0,b.default)().getConversation(e);(0,Q.isRegularMemberInModeratedGroup)(t)||(N.default.removeHandler(k.KeyboardShortcut.StartVideoCall,this._startVideoCall),N.default.removeHandler(k.KeyboardShortcut.StartAudioCall,this._startAudioCall),N.default.removeHandler(k.KeyboardShortcut.AddPeopleToConversation,this._addPeopleToConversation)),N.default.removeHandler(k.KeyboardShortcut.ShowConversationProfile,this._showConversationProfile),N.default.removeHandler(k.KeyboardShortcut.MarkAsUnread,this._markAsUnread),N.default.removeHandler(k.KeyboardShortcut.EnableMultipleSelectMessages,this._enableMultipleMessagesMode),N.default.removeHandler(k.KeyboardShortcut.ArchiveConversation,this._archiveConversation),N.default.removeHandler(k.KeyboardShortcut.SearchInConversation,this._onToggleSearchByShortcut)}}t.default=Te},976413:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(659938)),l=i.__importDefault(s(150343)),d=i.__importDefault(s(192478)),c=i.__importDefault(s(727518)),u=i.__importStar(s(85385)),h=s(26703),p=i.__importStar(s(440760)),g=i.__importDefault(s(574818)),m=s(244666),S=i.__importDefault(s(468492)),_=i.__importDefault(s(827361)),f=i.__importDefault(s(601274)),y=i.__importDefault(s(249156)),v=(0,h.lazyProperties)({container:()=>_.default.flexOne});class C extends d.default{constructor(){super(...arguments),this._refCounter=0,this._onAppExitCallback=()=>g.default.markSavedAsDraft(this.props.navContext.state.conversationId),this._onInitialRenderComplete=()=>{this._forceTimer&&(f.default.clearTimeout(this._forceTimer),this._forceTimer=void 0),this.setState({viewRendered:!0});const e=this._refCounter;n.delay((()=>{this.isComponentMounted()&&this.state.oldProps&&e===this._refCounter&&this.setState({oldProps:void 0})}),100)}}_buildState(e,t){const s={},i=this.props,o=e.navContext.state,n=i.navContext.state;return o.conversationId===n.conversationId&&o.scrollToTimestamp===n.scrollToTimestamp&&o.focusedMessageCuid===n.focusedMessageCuid&&o.forceRefreshFocus===n.forceRefreshFocus||(this._refCounter++,s.oldProps=i,s.viewRendered=!1),s.enableConversationSwitchWithoutRemount=l.default.getS4LMessagingFeatures().enableConversationSwitchWithoutRemount,s}componentDidMount(){super.componentDidMount(),l.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDraftsPersistentStorage&&(p.default.addObserver(p.LifecycleEventType.ON_EXIT,this._onAppExitCallback),this._appStateSubscription=a.default.subscribeForChanges("DesktopContentPanelManager",(e=>{n.includes([r.Types.AppActivationState.Inactive,r.Types.AppActivationState.Background],e)&&g.default.markSavedAsDraft(this.props.navContext.state.conversationId).then((()=>{const e=g.default.getConversationsWithMediaDraft().length;e>0&&u.track(new m.MediaPreviewAppExitWithDraftsEvent(e))})).catch(n.noop)})))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);this.props.navContext.id!==e.navContext.id&&(y.default.clear(e.navContext.state.conversationId),l.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?g.default.markSavedAsDraft(e.navContext.state.conversationId):g.default.destroy(e.navContext.state.conversationId,!0),S.default.isSelectMessagesModeActive(this._getRootViewId())&&S.default.deactivateSelectMessagesMode())}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),p.default.removeObserver(p.LifecycleEventType.ON_EXIT,this._onAppExitCallback),y.default.clear(this.props.navContext.state.conversationId),l.default.getS4LMessagingFeaturesNoSubscription().enableMediaPreviewDrafts?g.default.markSavedAsDraft(this.props.navContext.state.conversationId):g.default.destroy(this.props.navContext.state.conversationId,!0)}_renderContentPanelSwitch(){let e=null;this.state.oldProps&&(e=(0,o.jsx)(c.default,{navContext:this.state.oldProps.navContext,isInvisible:!0},this._refCounter-1),this._setForceShowPanelTimer());const t=(0,o.jsx)(c.default,{navContext:this.props.navContext,onInitialRenderComplete:this.state.oldProps?this._onInitialRenderComplete:void 0},this._refCounter),s=this.state.viewRendered?t:e;return[this.state.viewRendered?e:t,s]}render(){return this.state.enableConversationSwitchWithoutRemount?(0,o.jsx)(c.default,{navContext:this.props.navContext,enableConversationSwitchWithoutRemount:this.state.enableConversationSwitchWithoutRemount}):(0,o.jsx)(r.View,{style:v.container,children:this._renderContentPanelSwitch()})}_setForceShowPanelTimer(){const e=this._refCounter;this._forceTimer=f.default.setTimeout((()=>{this.isComponentMounted()&&this.state.oldProps&&e===this._refCounter&&this.setState({oldProps:void 0})}),l.default.getS4LMessagingFeaturesNoSubscription().oldContentPanelForceHideTimeout)}}t.default=C},912135:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GalleryButton=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(77395),a=i.__importDefault(s(970035)),l=s(26703),d=i.__importStar(s(704704)),c=s(641400),u=i.__importDefault(s(497910)),h=(0,l.lazyProperties)({icon:()=>n.Styles.createViewStyle({minWidth:c.IconSize.size16,marginRight:3}),galleryButton:()=>n.Styles.createViewStyle({flexShrink:0,flexDirection:"row",paddingLeft:4,paddingRight:4,alignItems:"center"})});class p extends u.default{constructor(){super(...arguments),this._onRef=e=>{this._button=e||void 0}}requestFocus(){this._button&&this._button.requestFocus()}render(){var e;const t=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=this.props.preventAccessibilityFocus?-1:void 0,i=d.getString("ContentPanelHeaderTitle.GalleryButtonTitle"),l=this.props.iconColorOverride?this.props.iconColorOverride:this._themeColors.secondaryTextColor;return(0,o.jsxs)(r.HoverableButton,{ref:this._onRef,style:[h.galleryButton,this.props.style],title:i,accessibilityLabel:this.props.accessibilityLabel?this.props.accessibilityLabel:i,onPress:this.props.onPress,importantForAccessibility:t,tabIndex:s,disabled:this.props.disabled,children:[(0,o.jsx)(a.default,{icon:c.SkypeIcon.Gallery1,style:h.icon,color:l,size:null!==(e=this.props.iconSize)&&void 0!==e?e:c.IconSize.size12}),this.props.hideIconText?void 0:this._getIconText()]})}_getIconText(){return(0,o.jsx)(n.Text,{style:this.props.textStyle,numberOfLines:1,children:d.getString("ContentPanelHeaderTitle.Gallery")})}}t.GalleryButton=p,t.default=p},487803:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(453761)),a=s(26703),l=i.__importStar(s(704704)),d=s(641400),c=i.__importDefault(s(497910)),u=(0,a.lazyProperties)({manageGroupButton:()=>n.Styles.createViewStyle({flexShrink:0,flexDirection:"row",paddingLeft:4,paddingRight:8,alignItems:"center",minWidth:d.IconSize.size16,marginRight:3})});class h extends c.default{requestFocus(){this._button&&this._button.requestFocus()}render(){var e,t;const s=this.props.preventAccessibilityFocus?n.Types.ImportantForAccessibility.NoHideDescendants:void 0,i=this.props.preventAccessibilityFocus?-1:void 0,a=l.getString("ConversationsListItem.ChatGroupManageLabel"),c=this.props.iconColorOverride?this.props.iconColorOverride:this._themeColors.textSecondary,h=null!==(e=this.props.hoverColor)&&void 0!==e?e:this._themeColors.iconHoverColor,p=this.props.isCompact?d.IconSize.size12:null!==(t=this.props.iconSize)&&void 0!==t?t:d.IconSize.size18;return(0,o.jsx)(r.default,{style:[u.manageGroupButton,this.props.style],title:a,accessibilityLabel:this.props.accessibilityLabel?this.props.accessibilityLabel:a,onPress:this.props.onPress,importantForAccessibility:s,tabIndex:i,disabled:this.props.disabled,icon:d.SkypeIcon.Settings,color:c,size:p,hoverColor:h})}}t.default=h},227313:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSearchPanelAnimatedWrapper=t.MessageSearchPanel=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(859745)),a=i.__importStar(s(516778)),l=i.__importDefault(s(150343)),d=i.__importDefault(s(557153)),c=s(26703),u=i.__importStar(s(704704)),h=s(875770),p=i.__importDefault(s(40107)),g=i.__importDefault(s(117475)),m=s(376229),S=i.__importDefault(s(497910)),_=s(309515),f=s(306194),y=i.__importDefault(s(760989)),v=i.__importDefault(s(163374)),C=s(140304);class T extends S.default{constructor(){super(...arguments),this._didSearch=!1,this._lastSearchResultsCount=0,this._numberOfRequests=0,this.didUserSearch=()=>this._didSearch,this.getLastSearchResultsCount=()=>this._lastSearchResultsCount,this.getNumberOfRequests=()=>this._numberOfRequests,this.resetTelemetryParams=()=>{this._didSearch=!1,this._lastSearchResultsCount=0,this._numberOfRequests=0},this._onViewRef=e=>{this._viewRef=e||void 0},this._onCancelButtonPress=()=>{this._onCancel(m.MessageSearchToggleOrigin.CancelButton)},this._onCancel=e=>{this._performSearchDebounced.cancel(),this.props.onCancel(e)},this._clearSearch=()=>{this._performSearchDebounced.cancel(),this.props.searchStore.resetSearch(),this.setState({searchQuery:""},(()=>this.requestFocus()))},this._onQueryTextChange=e=>{this.props.searchStore.getSearchQuery()&&(this.setState({searchQuery:e}),this._performSearchDebounced(e,this.props.conversationId))},this._performSearch=(e,t,s,i,o)=>{this._zeroTermSearch=0===e.length,this._scenarioID=i||y.default.newCauseId();const n=this._scenarioID;(0,_.willSearch)(f.ScenarioSearchTypes.MessageInConversation,n);const r=null!=o?o:this.state.messageSearchLimit;(0,_.searchCallSent)(f.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,r),this.props.searchStore.findQuery({query:e},t,n).then((e=>{(0,_.searchResultsReceived)(f.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,r),s&&this.props.searchStore.focusMessage(s),this._announceResultsFound(e)})).catch((e=>{const t=v.default.isNetworkingAvailable();(0,_.searchResultsNotReceived)(f.ScenarioSearchTypes.MessageInConversation,n,this._zeroTermSearch,-1,"",t,r)})),this._numberOfRequests++,this._didSearch=!0},this._performSearchDebounced=n.debounce(this._performSearch,300),this._onScrollToMessageFromSearch=n.debounce((()=>{const{results:e,currentMessageIndex:t}=this.state,{conversationId:s}=this.props;e.length&&e[t]&&(0,C.getMessageTimestamp)(e[t],s).then((e=>{s===this.props.conversationId&&this.props.searchStore.setTimestamp(null==e?void 0:e.timestamp,null==e?void 0:e.cuid,this._scenarioID,this._zeroTermSearch)}))}),300),this._announceResultsFound=n.debounce((e=>{const t=u.getString("ContentPanelHeader.SearchInConversationResultsFoundAnnouncement",{count:e});a.Accessibility.announceForAccessibility(t)}),300)}_buildState(e,t){const s={},i=l.default.getS4LMessagingFeatures();s.currentMessageIndex=e.searchStore.getFocusedMessageIndex(),s.results=e.searchStore.getResults(),s.isLoading=e.searchStore.isLoadingResults(),s.messageSearchLimit=i.inConversationMessageSearch.initialPageSize;const o=d.default.getSearchQuery();return o&&e.conversationId===o.conversationId?(this._performSearch(o.query,o.conversationId,o.messageId,o.sessionId,s.messageSearchLimit),s.searchQuery=o.query,d.default.resetSearchQuery()):t&&(s.searchQuery=""),s}componentDidUpdate(e,t,s){var i,o,n,r;super.componentDidUpdate(e,t,s);(null===(o=null===(i=t.results)||void 0===i?void 0:i[t.currentMessageIndex])||void 0===o?void 0:o.ClientMessageId)!==(null===(r=null===(n=this.state.results)||void 0===n?void 0:n[this.state.currentMessageIndex])||void 0===r?void 0:r.ClientMessageId)&&this._onScrollToMessageFromSearch(),!1===this.props.isMessageSearchPanelVisible&&!0===e.isMessageSearchPanelVisible&&this.setState({searchQuery:""})}requestFocus(){this._viewRef&&this._viewRef.requestFocus()}render(){const e=this.props.useMobileUI?void 0:(0,o.jsx)(h.MessageSearchPanelNavigation,{useMobileUI:this.props.useMobileUI,searchStore:this.props.searchStore});return(0,o.jsx)(p.default,{onCancel:this._onCancel,onChangeText:this._onQueryTextChange,onClearPress:this._clearSearch,ref:this._onViewRef,clearSearch:this._clearSearch,onCancelButtonPress:this._onCancelButtonPress,isLoading:this.state.isLoading,searchQuery:this.state.searchQuery,navigationComponent:e,disableUi:!this.props.isMessageSearchPanelVisible,searchStore:this.props.searchStore})}}t.MessageSearchPanel=T;const M=(0,c.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",position:"absolute",left:0,right:0,height:70})});class b extends S.default{constructor(e){super(e),this._animatedHeightValue=new a.Animated.Value(0),this._animatedOpacityValue=new a.Animated.Value(0),this._animatedPositionValueStackNav=new a.Animated.Value(-70),this._animatedMenuStyleStackNav=a.Styles.createAnimatedViewStyle({top:this._animatedPositionValueStackNav}),this._animatedMenuStyle=a.Styles.createAnimatedViewStyle({height:this._animatedHeightValue,opacity:this._animatedOpacityValue}),this.didUserSearch=()=>!!this._messageSearchRef&&this._messageSearchRef.didUserSearch(),this.getLastSearchResultsCount=()=>this._messageSearchRef?this._messageSearchRef.getLastSearchResultsCount():0,this.getNumberOfRequests=()=>this._messageSearchRef?this._messageSearchRef.getNumberOfRequests():0,this.resetTelemetryParams=()=>this._messageSearchRef&&this._messageSearchRef.resetTelemetryParams(),this._onMessageSearchRef=e=>{this._messageSearchRef=e||void 0},this._animatedHeightValue.setValue(e.isMessageSearchPanelVisible?61:0),this._animatedOpacityValue.setValue(e.isMessageSearchPanelVisible?1:0)}_buildState(e,t){const s={leavePaddingForStatusBar:a.StatusBar.isOverlay(),statusBarHeight:g.default.statusBarHeight()};return t&&this._animatedPositionValueStackNav.setValue(e.isMessageSearchPanelVisible?b._zeroPosition(s):-70),s}componentDidMount(){super.componentDidMount(),this._animate(this.props.isMessageSearchPanelVisible)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.props.isMessageSearchPanelVisible!==e.isMessageSearchPanelVisible&&this._animate(this.props.isMessageSearchPanelVisible)}_animate(e){if(this.isComponentMounted()){if(this._animation&&this._animation.stop(),this.props.useMobileUI)this._animation=a.Animated.timing(this._animatedPositionValueStackNav,{toValue:e?b._zeroPosition(this.state):-70,duration:r.Common.Duration.Default,easing:r.Easing.SkypeExpoInOut5});else{const t=a.Animated.timing(this._animatedHeightValue,{toValue:e?61:0,duration:500,easing:r.Easing.SkypeExpoInOut5}),s=a.Animated.timing(this._animatedOpacityValue,{toValue:e?1:0,duration:300,easing:r.Easing.Linear,delay:e?200:100});this._animation=a.Animated.parallel([t,s])}this._animation.start((()=>{this._animation=void 0})),this._messageSearchRef&&e&&this._messageSearchRef.requestFocus()}}render(){const e=this.props.isMessageSearchPanelVisible?this.props.importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants,t=this.props.useMobileUI?[M.container,this._themeStyles.primaryBackgroundColorStyle,this._animatedMenuStyleStackNav]:this._animatedMenuStyle;return(0,o.jsx)(a.Animated.View,{style:t,importantForAccessibility:e,children:(0,o.jsx)(T,Object.assign({},this.props,{ref:this._onMessageSearchRef}))})}static _zeroPosition(e){return(e.leavePaddingForStatusBar?e.statusBarHeight:0)||0}}t.MessageSearchPanelAnimatedWrapper=b},875770:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileSearchNavigationPanel=t.MessageSearchPanelNavigation=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(859745)),a=i.__importStar(s(516778)),l=i.__importDefault(s(453761)),d=s(26703),c=i.__importStar(s(704704)),u=i.__importDefault(s(791384)),h=s(16549),p=i.__importDefault(s(20758)),g=s(641400),m=s(262725),S=i.__importDefault(s(497910)),_=(0,d.lazyProperties)({rowCenterContainer:()=>a.Styles.createViewStyle({backgroundColor:h.Color.transparent,flexDirection:"row",alignItems:"center"}),buttonsContainer:()=>a.Styles.createViewStyle({flexDirection:"row"}),buttonStyle:()=>a.Styles.createViewStyle({padding:0,alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:10,marginRight:8}),results:()=>a.Styles.createViewStyle({marginRight:16}),stackNavigationOverrides:()=>(0,d.lazyProperties)({rowCenterContainer:()=>a.Styles.createViewStyle({height:50,borderTopWidth:1}),buttonsContainer:()=>a.Styles.createViewStyle({paddingLeft:10,paddingRight:10,width:88}),spacerStyle:()=>a.Styles.createViewStyle({width:88}),buttonStyle:()=>a.Styles.createViewStyle({marginRight:20}),results:()=>a.Styles.createTextStyle({fontSize:p.default.fontSize.size18,textAlign:"center",flexDirection:"row",flexGrow:1})})});class f extends S.default{constructor(){super(...arguments),this._onPrevButtonRef=e=>{this._prevButtonRef=e},this._onNextButtonRef=e=>{this._nextButtonRef=e},this._onChangeDirectionUp=()=>{this.props.searchStore.focusPreviousMessage(),this.props.searchStore.isFocusingPreviousDisabled()&&this._nextButtonRef&&this._nextButtonRef.requestFocus()},this._onChangeDirectionDown=()=>{this.props.searchStore.focusNextMessage(),this.props.searchStore.isFocusingNextDisabled()&&this._prevButtonRef&&this._prevButtonRef.requestFocus()}}_buildState(e,t){return{results:e.searchStore.getResults(),currentMessageIndex:e.searchStore.getFocusedMessageIndex(),isMovingUpDisabled:e.searchStore.isFocusingPreviousDisabled(),isMovingDownDisabled:e.searchStore.isFocusingNextDisabled()}}UNSAFE_componentWillUpdate(e,t,s){if(super.UNSAFE_componentWillUpdate(e,t,s),u.default.shouldAnnounceForAccessibility()&&t.currentMessageIndex!==this.state.currentMessageIndex){const e=c.getString("MessageSearchNavigation.NumberOfResults",{currentIndex:t.currentMessageIndex+1,totalNumberOfResults:this.state.results.length});a.Accessibility.announceForAccessibility(e)}}render(){const e=[_.rowCenterContainer];return this.props.useMobileUI&&(e.push(_.stackNavigationOverrides.rowCenterContainer),e.push(this._themeStyles.headerShadowBorderColorStyle),e.push(this._themeStyles.primaryBackgroundColorStyle)),(0,o.jsxs)(a.View,{style:e,children:[this.props.useMobileUI?[this._getButtons(),this._getCaption()]:[this._getCaption(),this._getButtons()],this._getOptionalSpacer()]})}_getCaption(){return this.props.useMobileUI?(0,o.jsx)(a.Text,{style:[_.stackNavigationOverrides.results,this._themeStyles.primaryTextColorStyle],children:c.getString("MessageSearchNavigation.NumberOfResults",{currentIndex:this.state.currentMessageIndex+1,totalNumberOfResults:this.state.results.length})},"caption"):(0,o.jsxs)(m.Caption,{style:_.results,textThemeColor:m.TextThemeColor.Primary,children:[n.isEmpty(this.state.results)?0:this.state.currentMessageIndex+1," / ",this.state.results.length]},"caption")}_getButtons(){const e=[_.buttonsContainer];this.props.useMobileUI&&e.push(_.stackNavigationOverrides.buttonsContainer);const t=[this.props.useMobileUI?_.stackNavigationOverrides.buttonStyle:_.buttonStyle,this.props.useMobileUI?void 0:this._themeStyles.buttonBackgroundColorStyle],s=this.props.useMobileUI?g.IconSize.size24:g.IconSize.size10,i=this.props.useMobileUI&&!this.state.isMovingUpDisabled?h.Color.blueDark:this._themeColors.primaryTextColor,n=this.props.useMobileUI&&!this.state.isMovingDownDisabled?h.Color.blueDark:this._themeColors.primaryTextColor;return(0,o.jsxs)(a.View,{style:e,children:[(0,o.jsx)(l.default,{disabled:this.state.isMovingUpDisabled,onPress:this._onChangeDirectionUp,icon:g.SkypeIcon.UpChevron,disabledOpacity:.4,size:s,color:i,hoverColor:this._themeColors.primaryTextColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:t,title:c.getString("ContentPanelHeader.SearchInConversationPreviousResultTitle"),ref:this._onPrevButtonRef}),(0,o.jsx)(l.default,{disabled:this.state.isMovingDownDisabled,onPress:this._onChangeDirectionDown,icon:g.SkypeIcon.DownChevron,disabledOpacity:.4,size:s,color:n,hoverColor:this._themeColors.primaryTextColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:t,title:c.getString("ContentPanelHeader.SearchInConversationNextResultTitle"),ref:this._onNextButtonRef})]},"buttons")}_getOptionalSpacer(){if(this.props.useMobileUI)return(0,o.jsx)(a.View,{style:_.stackNavigationOverrides.spacerStyle})}}t.MessageSearchPanelNavigation=f;const y=(0,d.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,height:50,position:"absolute",left:0,right:0})});class v extends S.default{constructor(){super(...arguments),this._animatedPositionValue=new a.Animated.Value(-50),this._animatedNavStyle=a.Styles.createAnimatedViewStyle({bottom:this._animatedPositionValue})}componentDidMount(){super.componentDidMount(),this._animate(this.state.isMessageSearchPanelVisible)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isMessageSearchPanelVisible!==t.isMessageSearchPanelVisible&&this._animate(this.state.isMessageSearchPanelVisible)}_buildState(e,t){const s={isMessageSearchPanelVisible:!!e.searchStore.getSearchQuery()};return t&&this._animatedPositionValue.setValue(this._bottomPosition(s.isMessageSearchPanelVisible)),s}_animate(e){this.isComponentMounted()&&(this._animation&&this._animation.stop(),this._animation=a.Animated.timing(this._animatedPositionValue,{toValue:this._bottomPosition(e),duration:r.Common.Duration.Default,easing:r.Easing.SkypeExpoInOut5}),this._animation.start((()=>{this._animation=void 0})))}_bottomPosition(e){return e?0:-50}render(){return(0,o.jsx)(a.Animated.View,{style:[y.container,this._animatedNavStyle,this.props.style],children:(0,o.jsx)(f,Object.assign({},this.props))})}}t.MobileSearchNavigationPanel=v},40107:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(154235),a=i.__importDefault(s(776546)),l=s(77395),d=i.__importDefault(s(453761)),c=i.__importDefault(s(970035)),u=i.__importDefault(s(54945)),h=s(26703),p=i.__importStar(s(704704)),g=i.__importStar(s(954225)),m=i.__importDefault(s(942724)),S=s(376229),_=i.__importDefault(s(799585)),f=s(16549),y=i.__importDefault(s(20758)),v=s(641400),C=i.__importDefault(s(48076)),T=s(262725),M=i.__importDefault(s(497910)),b={},I=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({paddingVertical:0,paddingHorizontal:0,flex:1,flexDirection:"row",overflow:"hidden"}),rightContainerStyle:()=>n.Styles.createViewStyle({borderLeftWidth:1,borderStyle:"solid",alignItems:"stretch"}),centerContainer:()=>n.Styles.createViewStyle({overflow:"hidden",backgroundColor:f.Color.transparent,flexGrow:0,flexShrink:1,flexDirection:"row",alignSelf:"flex-end",marginBottom:11,height:38,width:g.maxStreamContentWidth}),innerContainer:()=>n.Styles.createViewStyle({borderRadius:5,borderWidth:1,flex:1,flexDirection:"row"}),rowCenterContainer:()=>n.Styles.createViewStyle({backgroundColor:f.Color.transparent,flexDirection:"row",alignItems:"center"}),searchInput:()=>n.Styles.createTextInputStyle({flex:1,fontSize:y.default.controlFontSize.caption,backgroundColor:f.Color.transparent,height:20}),searchInputContainer:()=>n.Styles.createViewStyle({padding:8,flex:1,flexDirection:"row",alignItems:"center"}),searchInputIcon:()=>n.Styles.createViewStyle({marginRight:8}),closeButton:()=>n.Styles.createViewStyle({backgroundColor:f.Color.transparent,marginLeft:20}),loadingContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginHorizontal:10}),loader:()=>n.Styles.createViewStyle({padding:0}),cancelBtn:()=>n.Styles.createViewStyle({paddingHorizontal:20}),innerContainerRight:()=>n.Styles.createButtonStyle({paddingLeft:20}),stackNavigationOverrides:()=>(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",overflow:"hidden",alignItems:"stretch"}),leftSpacer:()=>n.Styles.createViewStyle({width:10}),rightSpacer:()=>n.Styles.createViewStyle({width:10}),centerContainer:()=>n.Styles.createViewStyle({overflow:"hidden",flexGrow:1,flexDirection:"row",alignSelf:"center",height:30}),searchInput:()=>n.Styles.createTextInputStyle({fontSize:y.default.controlFontSize.body}),innerContainer:()=>n.Styles.createViewStyle({borderRadius:15}),cancelBtn:()=>n.Styles.createViewStyle({paddingLeft:10})})});class w extends M.default{constructor(){super(...arguments),this._renderCancelButton=()=>this.state.useMobileUI?(0,o.jsx)(n.Button,{onPress:this.props.onCancelButtonPress,style:I.stackNavigationOverrides.cancelBtn,children:(0,o.jsx)(T.BodyText,{style:this._themeStyles.primaryTextColorStyle,children:p.getString("Global.CancelLabel")})}):(0,o.jsx)(l.HoverableButton,{onPress:this.props.onCancelButtonPress,style:I.cancelBtn,disabled:this.props.disableUi,children:(0,o.jsx)(T.Caption,{textThemeColor:T.TextThemeColor.Primary,children:p.getString("Global.CancelLabel")})}),this._renderLoading=()=>{if(this.props.isLoading)return(0,o.jsx)(n.View,{style:I.loadingContainer,children:(0,o.jsx)(_.default,{size:r.SXActivityIndicatorSize.ExtraSmall,tintColor:this._themeColors.primaryIconColor,style:I.loader,useRXIndicator:!0})})},this._renderNavigationComponent=()=>this.props.navigationComponent,this._renderSearchInput=()=>{const e=[I.searchInput,this.state.useMobileUI?I.stackNavigationOverrides.searchInput:void 0,this._themeStyles.primaryTextColorStyle],t=this.state.useMobileUI?p.getString("ContentPanelHeader.SearchConversationPlaceholderMobile"):p.getString("ContentPanelHeader.SearchConversationPlaceholder");return(0,o.jsxs)(n.View,{style:I.searchInputContainer,children:[(0,o.jsx)(c.default,{icon:v.SkypeIcon.Search,size:v.IconSize.size15,color:this._themeColors.secondaryTextColor,style:I.searchInputIcon}),(0,o.jsx)(n.TextInput,{ref:this._onSearchInputRef,style:e,onChangeText:this.props.onChangeText,value:this.props.searchQuery,placeholder:t,placeholderTextColor:this._themeColors.primaryTextColor,onKeyPress:this._onKeyPress,clearButtonMode:"never",importantForAccessibility:n.Types.ImportantForAccessibility.No,editable:!this.props.disableUi}),this._renderClearButton(),this._renderLoading()]})},this._renderClearButton=()=>{if(!this.props.isLoading&&""!==this.props.searchQuery)return(0,o.jsx)(d.default,{onPress:this.props.onClearPress,icon:v.SkypeIcon.ClosePanel,size:v.IconSize.size14,color:this._themeColors.secondaryTextColor,hoverColor:this._themeColors.secondaryTextColor,style:I.closeButton,showHoverEffect:!0,title:p.getString("ContentPanelHeader.SearchInConversationClearTitle")})},this._onSearchInputRef=e=>{this._searchInputRef=e||void 0},this._onKeyPress=e=>{e.keyCode===u.default.ENTER?(!0===e.shiftKey?this.props.searchStore.focusNextMessage():this.props.searchStore.focusPreviousMessage(),this.requestFocus()):e.keyCode===u.default.ESCAPE&&(""!==this.props.searchQuery?this.props.clearSearch():this.props.onCancel(S.MessageSearchToggleOrigin.EscapeKey))}}_buildState(e,t){let s={};t&&(s={leftSpacerWidth:10,rightSpacerWidth:10});const{left:i,right:o}=a.default.getSpacerWidths();return s.leftSpacerWidth=C.default.isTablet()?i:i+g.messageStreamOverflowWidth,s.rightSpacerWidth=C.default.isTablet()?o:o+g.messageStreamOverflowWidth,s.useMobileUI=m.default.isUsingStackNavigationContext()||C.default.isTablet(),s}_getSpacerStyle(e){return b[e]||(b[e]=n.Styles.createViewStyle({flex:1,minWidth:e})),b[e]}render(){const e=[I.innerContainer,this.state.useMobileUI?I.stackNavigationOverrides.innerContainer:void 0,this._themeStyles.dividerBorderColorStyle],t=[I.rowCenterContainer,I.rightContainerStyle,this._themeStyles.dividerBorderColorStyle],s=this.state.useMobileUI?I.stackNavigationOverrides.leftSpacer:this._getSpacerStyle(this.state.leftSpacerWidth),i=this.state.useMobileUI?I.stackNavigationOverrides.rightSpacer:this._getSpacerStyle(this.state.rightSpacerWidth);let r;this.state.useMobileUI||(r=(0,o.jsxs)(n.View,{style:t,children:[(0,o.jsx)(n.View,{style:[I.rowCenterContainer,I.innerContainerRight],children:this._renderNavigationComponent()}),this._renderCancelButton()]}));const a=this.state.useMobileUI?I.stackNavigationOverrides.centerContainer:I.centerContainer,l=this.state.useMobileUI?I.stackNavigationOverrides.container:I.container;return(0,o.jsxs)(n.View,{style:l,children:[(0,o.jsx)(n.View,{style:s}),(0,o.jsxs)(n.View,{style:a,children:[(0,o.jsxs)(n.View,{style:e,children:[this._renderSearchInput(),r]}),this.state.useMobileUI?this._renderCancelButton():void 0]}),(0,o.jsx)(n.View,{style:i})]})}requestFocus(){this._searchInputRef&&this._searchInputRef.requestFocus()}}t.default=w},416375:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(150343)),a=i.__importDefault(s(179075)),l=i.__importStar(s(44717)),d=i.__importDefault(s(631681)),c=s(315742),u=i.__importDefault(s(498801)),h=i.__importDefault(s(373861)),p=s(605507),g=i.__importDefault(s(615364)),m=i.__importStar(s(463519)),S=i.__importDefault(s(601976)),_=i.__importStar(s(242561)),f=i.__importDefault(s(970035)),y=i.__importDefault(s(114818)),v=s(26703),C=i.__importStar(s(704704)),T=i.__importDefault(s(487803)),M=i.__importStar(s(507700)),b=i.__importDefault(s(769956)),I=i.__importDefault(s(20758)),w=s(641400),P=s(262725),k=i.__importDefault(s(497910)),A=i.__importDefault(s(601274)),x=i.__importDefault(s(38217)),D=i.__importDefault(s(839970)),R=i.__importDefault(s(685734)),L=s(567567),B=w.IconSize.size15+5,F=w.IconSize.size15,N=(0,v.lazyProperties)({titleContainerNewComposer:()=>n.Styles.createViewStyle({alignItems:"stretch",justifyContent:"center"}),secondRowNewComposer:()=>n.Styles.createViewStyle({flexDirection:"row",marginTop:1,alignItems:"center",overflow:"visible"}),secondRowTextNewComposer:()=>n.Styles.createTextStyle({flex:-1,lineHeight:20}),moodText:()=>n.Styles.createTextStyle({overflow:"visible"}),userPresenceIndicator:()=>n.Styles.createViewStyle({width:8,height:8,borderRadius:4,marginRight:3}),placeholderContainerStyle:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",width:24,height:18}),chatNameIconWrapper:()=>n.Styles.createViewStyle({width:B,height:F}),certifiedIconWrapper:()=>n.Styles.createViewStyle({position:"relative",top:2}),textTruncation:()=>n.Styles.createViewStyle({flexShrink:1}),manageGroupIconWrapper:()=>n.Styles.createViewStyle({width:23,height:20,flexShrink:0}),manageGroupIcon:()=>n.Styles.createTextStyle({paddingLeft:3,paddingTop:2,paddingRight:0,marginRight:0,lineHeight:20,width:23,height:20}),conversationName:()=>n.Styles.createViewStyle({flexShrink:1,flexDirection:"row",marginRight:20})});class E extends k.default{_buildState(e,t){const s=(0,g.default)().getConversation(e.conversationId),i=r.default.getS4LMessagingFeatures(),o=l.isAgent(e.conversationId),d={conversationName:S.default.getDisplayName(R.default.getConversationOwner(e.conversationId)),isEncryptedThread:l.isEncryptedThread(e.conversationId),memberCount:s?Math.max(s.getMemberCount(),0):0,hideBotCoachMark:l.getMriNamespace(e.conversationId)===l.Namespaces.Bot,groupedConversationsEnabled:i.enableGroupedConversations,theme:void 0,isOneOnOne:!!s&&s.isOneOnOne(),isAgent:o,isTrustedAgent:o&&a.default.isTrustedAgent(e.conversationId)},c=e.conversationOwnerMri;if(e.shouldShowUserPresence&&c){const s=R.default.getFullUserProfileByMri(c);if(d.gender=s&&s.gender,d.userPresence=D.default.getCachedUserPresence(c),d.isUserActive=D.default.isActiveUser(c),s.mood&&!e.hideSecondRow){d.theme=this._currentTheme;const e=m.decodeFromContent(s.mood);if(d.moodRawText=s.mood,d.moodLabel=M.getAccessibilityTitle(s.mood),t||!(0,y.default)(d.moodRawText,this.state.moodRawText)||d.theme!==this.state.theme){const t=this._themeColors,s=this._themeStyles,i=[I.default.captionFontStyle(),N.secondRowTextNewComposer,N.moodText];i.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1));const o={processing:{emoticons:_.ProcessingLevel.Full,quotes:_.ProcessingLevel.None,wikiMarkup:_.ProcessingLevel.Stripped,links:_.ProcessingLevel.Full,atMentions:_.ProcessingLevel.Stripped},renderMedia:!1,mediaPlaceholderIconColor:t.primaryTextColor,allowLargeEmoticons:!1,numberOfLines:1,textOverrideStyle:i,boldTextStyle:i,regularTextStyle:i,linkStyle:s.linkTextColorStyle};d.moodReact=(0,p.renderReact)(e,o).value}else d.moodReact=this.state.moodReact}else d.moodReact=void 0,d.moodRawText=void 0}else d.moodReact=void 0,d.moodRawText=void 0;return d}componentDidMount(){super.componentDidMount(),this._updateLastSeenTextTimer=A.default.setInterval((()=>{this.state.userPresence&&this.state.userPresence.lastSeenAtUtc&&this.isComponentMounted()&&this.forceUpdate()}),6e4),this._fetchUserPresence(this.props)}componentWillUnmount(){super.componentWillUnmount(),this._updateLastSeenTextTimer&&A.default.clearInterval(this._updateLastSeenTextTimer)}_fetchUserPresence(e){e.shouldShowUserPresence&&e.conversationOwnerMri&&b.default.forceFetchPresence(e.conversationOwnerMri)}_userPresenceText(){let e;if(l.isS4BBridgeMri(this.props.conversationId))e=C.getString("ContentPanelHeaderTitle.TeamsInteropSubtitleShort");else{const t=l.isPhoneMri(this.props.conversationId)&&l.isSkypeId(this.props.conversationOwnerMri)||!l.isPhoneMri(this.props.conversationId);e=this.state.userPresence&&!this.state.isAgent&&t?(0,L.getLastSeenPresenceText)(this.state.userPresence,!1,this.state.gender,this.state.isUserActive):""}return e}_memberCountText(){return C.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:this.state.memberCount})}render(){const e=[N.titleContainerNewComposer,this.props.style];return this.state.hideBotCoachMark?this._renderWrapperPanelHeader(e):this._renderCoachMarkPanelHeader(e)}_renderSecondRowElement(){let e,t;const s=[N.secondRowTextNewComposer,I.default.fontStyle.messagingStreamChatSubHeader,this.props.isModernizeSmallHeaderMobile?I.default.fontStyle.messagingStreamChatSubHeaderMobile:void 0];if(s.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)),!this.props.hidePresenceIndicator&&this.state.userPresence&&this.state.userPresence.status&&(t=x.default.getPresenceIcon(h.default.getPresenceStatusForIcon(this.state.isUserActive,this.state.userPresence),N.userPresenceIndicator,w.IconSize.size8,void 0,void 0)),this.state.moodReact)e=this.state.moodReact;else if(this.props.shouldShowCallRate)this.props.hideSecondRow||this.props.otherPartyMri&&(e=(0,o.jsx)(P.Caption,{style:s,numberOfLines:1,children:this.state.callRateText}));else{const t=this.props.hideSecondRow?void 0:this.props.otherPartyMri?this._userPresenceText():this._memberCountText();e=t?(0,o.jsx)(P.Caption,{style:s,numberOfLines:1,children:t}):void 0}return e||t?(0,o.jsxs)(n.View,{style:N.secondRowNewComposer,children:[t,e]}):void 0}_renderPanelHeader(){const e=this.props.isModernizeSmallHeaderMobile?[I.default.modernizeSmallHeaderMobileFontStyle(this._currentTheme),N.textTruncation]:[I.default.modernizeSmallPanelHeaderFontStyle(this._currentTheme),N.textTruncation],t=this.state.isEncryptedThread&&!this.state.groupedConversationsEnabled?(0,o.jsx)(n.View,{style:N.placeholderContainerStyle,children:(0,o.jsx)(f.default,{icon:w.SkypeIcon.Lock,size:w.IconSize.size24,color:this._themeColors.primaryIconColor})}):void 0,s=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0,i=this.props.isModernizeSmallHeaderMobile||this.state.isTrustedAgent?void 0:this._getOptionalGroupManageIcon();return e.push(n.Styles.createTextStyle({color:this._getContext().themeColors.textPrimary},!1)),(0,o.jsxs)(n.View,{style:N.conversationName,children:[t,(0,o.jsx)(n.Text,{style:e,numberOfLines:1,ellipsizeMode:"tail",children:this.state.conversationName}),s,i]})}_getOptionalGroupManageIcon(){return(0,o.jsx)(n.View,{style:N.manageGroupIconWrapper,children:(0,o.jsx)(T.default,{iconColorOverride:this._themeColors.iconHoverColor,onPress:this.props.onTitlePress,accessibilityLabel:C.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!1,iconSize:w.IconSize.size20,style:N.manageGroupIcon,hoverColor:this._themeColors.headerIconColor,disableHoverOpacityStyles:!0},`manageGroupButton-${this.props.conversationId}`)})}_getOptionalCertifiedIcon(){const e=[N.chatNameIconWrapper,N.certifiedIconWrapper];return(0,o.jsx)(u.default,{botMri:this.props.conversationId,style:e})}_renderWrapperPanelHeader(e){return(0,o.jsxs)(n.Button,{onPress:this.props.onTitlePress,style:e,children:[this._renderPanelHeader(),this.props.hideSecondRow?void 0:this._renderSecondRowElement()]})}_renderCoachMarkPanelHeader(e){const t=h.default.accessibilityLabel(this.state,!!this.props.hideSecondRow,!!this.props.shouldShowUserPresence,!!this.props.shouldShowCallRate),s={coachMarkType:c.CoachMarkType.ChatProfile,onAnchorPress:this.props.onTitlePress,anchorAccessibilityLabel:t};return(0,o.jsxs)(d.default.Button,Object.assign({style:e,onPress:this.props.onTitlePress,title:t},s,{children:[this._renderPanelHeader(),this.props.hideSecondRow?void 0:this._renderSecondRowElement()]}))}}t.default=E},685804:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(262382)),a=i.__importStar(s(361096)),l=i.__importDefault(s(304623)),d=i.__importStar(s(172134)),c=i.__importStar(s(44717)),u=i.__importDefault(s(615364)),h=s(535973),p=i.__importDefault(s(601976)),g=s(815146),m=i.__importStar(s(85385)),S=i.__importStar(s(704704)),_=i.__importStar(s(888500)),f=i.__importStar(s(340482)),y="learnMore";class v{constructor(e,t,s,i){if(this._conversationIds=e,this._getAnchor=t,this._rootViewId=s,this._deletionSource=i,this._isBot=!1,this._getDeleteChatMenuItems=e=>{const t=[{text:e?S.getString("InfoPanel.ClearGroupConfirmationConfirmButtonTitle"):S.getString("ConfirmationDialog.DeleteLabel"),command:"deleteChat"}];return e&&t.push({text:S.getString("Global.LearnMore"),command:y}),{items:t,destructiveIndex:0}},this._deleteBotChat=()=>{if(!this._otherPartyMri)return n.Resolved();const e=c.stripMriNamespace(this._otherPartyMri);return m.track(new a.BotContactInteraction(g.BotsInteraction.DeleteBot,e,p.default.getDisplayName(this._conversationIds[0])||"")),r.default.removeAgentFromContacts(e)},this._deleteChat=()=>{const e=o.map(this._conversationIds,(e=>l.default.ensureConversationLoaded(e).then((()=>{if((0,u.default)().isConversationKnown(e)){const t=f.getConversationTypeForTelemetry(e);d.deleteConversationAsync(e,this._deletionSource,t)}}))));return n.all(e)},this._deleteConversation=()=>this._isBot?this._deleteBotChat().then(this._deleteChat):this._deleteChat(),this._onHandleDeleteChatMenuCommand=e=>{e===_.SXActionMenuCancel||this._handled||(e!==y?(this._handled=!0,this._deleteConversation().then((()=>{this._deffered.resolve(!0)})).catch((e=>{this._deffered.reject(e)}))):h.ConversationUtils.openClearLeaveConversationLearnMore())},this._onHandleCancelCommand=()=>{this._handled||(this._handled=!0,this._deffered.resolve(!1))},this._deffered=n.Defer(),this._handled=!1,1===e.length){const t=(0,u.default)().getConversation(e[0]);this._isGroupConv=!(!t||!c.isGroupConversation(t.id));const s=t&&t.isOneOnOne()?t.getOtherPartyMri():void 0;s&&(this._otherPartyMri=s,this._isBot=c.isAgent(s))}}open(){const e=this._isBot?S.getString("UserProfilePanel.DeleteBotConfirmationContent"):h.ConversationUtils.getDeleteConfirmationTitle(this._conversationIds);let t;t=this._isBot?S.getString("UserProfilePanel.DeleteBotConfirmationDialogContent"):this._conversationIds.length>1?S.getString("InfoPanel.DeleteConfirmationDialogContentGroup",{name:p.default.getShortDisplayName(this._conversationIds[0])||""}):this._isGroupConv?S.getString("InfoPanel.ClearGroupConfirmationDialogContent"):S.getString("InfoPanel.DeleteConfirmationDialogContent");const s=this._getDeleteChatMenuItems(this._isGroupConv),i={anchor:this._getAnchor,buttons:s.items,cancelButtonPosition:_.CancelButtonPosition.End,title:e,message:t,dialogAccessibilityTitle:t,destructiveButtonIndex:s.destructiveIndex};_.default.showWithActionMenuConfig({options:i,callback:this._onHandleDeleteChatMenuCommand,onCancel:this._onHandleCancelCommand,useAlertForDesktop:!0,useAlertForMobile:!1,rootViewId:this._rootViewId,invokingEvent:void 0})}getPromise(){return this._deffered.promise()}}v.showDialog=(e,t,s,i)=>{const o=new v(e,t,s,i);return o.open(),o.getPromise()},t.default=v},343823:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(627414),n=i.__importStar(s(44717)),r=s(527919),a=s(535973),l=i.__importDefault(s(732028)),d=s(379878),c=i.__importStar(s(704704)),u=i.__importStar(s(757838)),h=s(551302),p=i.__importDefault(s(888500)),g="delete",m="clear",S="endPrivate",_="safeCode";class f{constructor(e,t,s){this._convId=e,this._anchor=t,this._context=s,this._getOverflowMenuItems=()=>{const e=[];if(n.isEncryptedThread(this._convId)){const t=l.default.getHandshakeState(this._convId);t===d.SecureHandshakeState.Completed&&e.push({text:c.getString("InfoPanel.SafeCodeLabel"),command:_}),t!==d.SecureHandshakeState.None&&e.push({text:c.getString("InfoPanel.EndConversationLabel"),command:S})}return n.isOneOnOneConversation(this._convId)?e.push({text:a.ConversationUtils.getDeleteConfirmationTitle([this._convId]),command:g}):e.push({text:c.getString("InfoPanel.ClearGroupConfirmationDialogTitle"),command:m}),e},this._selectOverflowMenuItem=(e,t)=>{switch(p.default.dismiss(f.MenuId,t),e){case g:(0,r.deleteConversation)(this._convId,this._anchor,this._context,"ConversationTabActionMenu",o.DeleteConversationSource.TabSwitcher);break;case S:(0,h.endPrivateConversation)(this._convId,t);break;case _:(0,h.showPrivateConversationSafeCode)(this._convId,t)}},this._actionMenuConfig={anchor:t,useTheme:!0,positionPriorities:["bottom","top"],popupBeakSize:{height:0,width:0}}}show(e){const t=u.rootViewIdForComponentContext(this._context);p.default.showWithOptions({id:f.MenuId,config:this._actionMenuConfig,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:e=>this._selectOverflowMenuItem(e,t),rootViewId:t,invokingEvent:e})}static open(e,t,s,i){new f(t,s,i).show(e)}}f.MenuId="ConversationActionMenuId",t.default=f},969004:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(192478)),a=s(154235),l=s(26703),d=i.__importDefault(s(252089)),c=i.__importDefault(s(799585)),u=s(262725),h=i.__importDefault(s(601274)),p=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column",paddingHorizontal:40,paddingBottom:40,justifyContent:"center"}),message:()=>n.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:20})});class g extends r.default{constructor(){super(...arguments),this._announceA11y=()=>{this.isComponentMounted()&&this._isComponentVisible()&&this._a11yTimer&&(h.default.clearTimeout(this._a11yTimer),this._a11yTimer=void 0,n.Accessibility.announceForAccessibility(this.props.message))}}componentDidMount(){super.componentDidMount(),this._a11yTimer=h.default.setTimeout(this._announceA11y,500)}componentWillUnmount(){super.componentWillUnmount(),this._a11yTimer&&h.default.clearTimeout(this._a11yTimer)}render(){return(0,o.jsxs)(n.View,{style:p.container,children:[(0,o.jsx)(c.default,{size:a.SXActivityIndicatorSize.Large,tintColor:d.default.getPrimaryColorNoSubscription()}),(0,o.jsx)(u.BodyText,{bold:!0,style:p.message,children:this.props.message})]})}}t.default=g},749895:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewChatMenuItem=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(154235),a=i.__importDefault(s(453761)),l=s(26703),d=i.__importDefault(s(20758)),c=s(641400),u=i.__importDefault(s(497910)),h=(0,l.lazyProperties)({row:()=>n.Styles.createViewStyle({flex:1,justifyContent:"flex-start",flexDirection:"row",alignItems:"center",paddingVertical:r.NewChatMenuItemSizes.paddingVertical}),icon:()=>n.Styles.createViewStyle({width:c.IconSize.size20,height:c.IconSize.size20,marginHorizontal:20,justifyContent:"center"}),title:()=>n.Styles.createViewStyle({alignSelf:"center"})});class p extends u.default{constructor(){super(...arguments),this._onItemRef=e=>{this._itemRef=e||void 0},this._onPress=e=>{this.props.onPressItem(this.props.info.command,(()=>this._itemRef),this._getRootViewId(),e.shiftKey||e.metaKey)}}render(){const e=d.default.rowTitleFontStyle(this._currentTheme);return(0,o.jsxs)(n.View,{style:h.row,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.props.info.title,accessibilityTraits:n.Types.AccessibilityTrait.Button,onPress:this._onPress,ref:this._onItemRef,children:[(0,o.jsx)(a.default,{style:h.icon,icon:this.props.info.icon,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconPrimary,size:c.IconSize.size20}),(0,o.jsx)(n.Text,{style:[h.title,e],children:this.props.info.title})]})}}t.NewChatMenuItem=p,t.default=p},569817:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(614080),a=i.__importStar(s(516778)),l=s(154235),d=i.__importStar(s(932836)),c=i.__importDefault(s(457468)),u=s(26703),h=i.__importStar(s(704704)),p=i.__importDefault(s(443333)),g=s(749895),m=s(641400),S=i.__importDefault(s(827361)),_=i.__importDefault(s(497910)),f=(0,u.lazyProperties)({panel:()=>a.Styles.createViewStyle({flex:1,justifyContent:"flex-start",alignContent:"flex-start",alignSelf:"stretch",marginTop:10}),itemDivider:()=>a.Styles.createViewStyle({height:1,marginHorizontal:10})});class y extends _.default{constructor(){super(...arguments),this._renderItem=(e,t)=>[(0,o.jsx)(g.NewChatMenuItem,{onPressItem:this._onHandleCommand,info:e},e.key),(0,o.jsx)(a.View,{style:[f.itemDivider,this._themeStyles.dividerColorStyle]},"itemDivider")],this._onHandleCommand=(e,t,s,i)=>{d.default.handleAddMenuCommand(e,t,s,!0,i)}}_buildState({commands:e},t){const s={isUsingGogoNetwork:c.default.isUsingGogoNetwork()};return{menuItems:this._generateMenuItems(e,s)}}render(){return(0,o.jsx)(a.View,{style:S.default.flexOne,children:(0,o.jsx)(r.VirtualListView,{style:f.panel,itemList:this.state.menuItems,renderItem:this._renderItem,clickOnEnterPress:!0,accessibilityTrait:a.Types.AccessibilityTrait.List,animateChanges:!1,skipRenderIfItemUnchanged:!0,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,hoveredItemStyle:this._themeStyles.rowHoverViewStyle,showOverflow:!1,onInitialRenderComplete:this.props.onInitialRenderComplete,restoreFocusAfterUpdate:!0,disableScrolling:!0})})}_generateMenuItems(e,t){return n.compact(n.map(e,(e=>this._menuItemForHubCommand(e,t))))}static calculateHeight(e){return e*l.NewChatMenuItemSizes.height+65}_menuItemForHubCommand(e,t){switch(e){case d.HubCommands.AddConversationGroupCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:m.SkypeIcon.ContactGroupAdd,title:h.getString("Hub.NewGroupChatLabel")};case d.HubCommands.AddConversationModeratedGroupCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:m.SkypeIcon.ContactGroup,title:h.getString("Hub.NewModeratedGroupChatShortLabel")};case d.HubCommands.AddConversationPrivateCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:m.SkypeIcon.Privacy,title:h.getString("Hub.NewPrivateChatShortLabel")};case d.HubCommands.AddBotCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:m.SkypeIcon.BotAdd,title:h.getString("Hub.FindBotLabel")};case d.HubCommands.NewGroupCallCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:m.SkypeIcon.CallAdd,title:h.getString("Hub.NewCallLabel"),disabled:t.isUsingGogoNetwork};case d.HubCommands.NewCellularSmsConversationCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:m.SkypeIcon.MobileSmsNew,title:h.getString("Hub.NewCellularSmsChatLabel")};case d.HubCommands.NewMeetNowCommand:return{key:e,command:e,height:l.NewChatMenuItemSizes.height,template:e,icon:p.default.getMeetNowIcon(),title:h.getString("MeetNow.FeatureName")}}}}t.default=y},696677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=s(535973),a=i.__importDefault(s(601976)),l=i.__importStar(s(704704)),d=i.__importStar(s(888500)),c="deleteChat",u="deleteAll",h="__DELIMITER__";class p{constructor(e,t,s){this._convIds=e,this._getAnchor=t,this._rootViewId=s,this._getDeleteChatMenuItems=()=>{const e=[];return o.each(this._convIds,(t=>{e.push({text:r.ConversationUtils.getConversationTitleForSelection(t),command:c+h+t.mri})})),e.push({text:l.getString("InfoPanel.DeleteAll"),command:u}),{items:e,destructiveIndex:e.length-1}},this._handleCommand=e=>{const[t,s]=e.split(h);switch(t){case c:this._deffered.resolve([s]);break;case u:this._deffered.resolve(this._convIds.map((e=>e.mri)));break;case d.SXActionMenuCancel:this._deffered.resolve(void 0)}},this._deffered=n.Defer()}open(){const e=this._getDeleteChatMenuItems(),t=l.getString("InfoPanel.WhichConversationToDelete",{name:a.default.getShortDisplayName(this._convIds[0].mri)||""}),s={anchor:this._getAnchor,buttons:e.items,cancelButtonPosition:d.CancelButtonPosition.End,title:l.getString("InfoPanel.DeleteConfirmationDialogTitle"),message:t,dialogAccessibilityTitle:t,destructiveButtonIndex:e.destructiveIndex};d.default.showWithActionMenuConfig({options:s,callback:this._handleCommand,useAlertForDesktop:!0,rootViewId:this._rootViewId,invokingEvent:void 0,suppressModalDismissalEvents:!0})}getPromise(){return this._deffered.promise()}}p.showDialog=(e,t,s)=>{const i=new p(e,t,s);return i.open(),i.getPromise()},t.default=p},268505:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(970035)),a=s(26703),l=i.__importStar(s(704704)),d=s(954225),c=i.__importDefault(s(117475)),u=i.__importDefault(s(377556)),h=s(641400),p=i.__importDefault(s(827361)),g=s(262725),m=i.__importDefault(s(497910)),S=i.__importDefault(s(429955)),_=(0,a.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",paddingHorizontal:20,paddingVertical:15}),textContainer:()=>n.Styles.createViewStyle({paddingHorizontal:10}),heading:()=>n.Styles.createTextStyle({marginBottom:10})});class f extends m.default{constructor(){super(...arguments),this.onToggle=(e,t)=>{this.props.onChange(t)}}_buildState(e){return{bottomSafeAreaInset:c.default.bottomSafeAreaInset()}}render(){const e=this.state.bottomSafeAreaInset?u.default.paddingBottomStyle(this.state.bottomSafeAreaInset):void 0;return(0,o.jsxs)(n.View,{style:[_.container,e,this.props.style],children:[(0,o.jsx)(r.default,{icon:h.SkypeIcon.Link,size:h.IconSize.size20,color:this._themeColors.primaryIconColor}),(0,o.jsxs)(n.View,{style:[_.textContainer,p.default.flexOne],children:[(0,o.jsx)(g.BodyText,{style:_.heading,children:l.getString("SetConversationParticipantsPanel.ShareLinkFooterHeading")}),(0,o.jsx)(g.Caption,{messageStreamFontSize:d.MessageStreamFontSize.Large,children:l.getString("SetConversationParticipantsPanel.ShareLinkFooterCaption")})]}),(0,o.jsx)(S.default,{isOn:this.props.shareLink,onChange:this.onToggle})]})}}t.default=f},481121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(192478)),a=i.__importDefault(s(712562)),l=s(815146),d=i.__importStar(s(85385)),c=s(26703),u=i.__importStar(s(704704)),h=i.__importDefault(s(740794)),p=s(375258),g=i.__importDefault(s(827361)),m=i.__importDefault(s(760989)),S=(0,c.lazyProperties)({locationPanel:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch"})});class _ extends r.default{constructor(){super(...arguments),this._onCloseButtonRef=e=>{this._closeButtonRef=e||void 0},this._onClose=()=>{const e=m.default.newCauseId(),t=this._getContext();d.log(l.LogTraceArea.Navigation,"DesktopLocationPanel._onCloseButtonClick,  causeId: "+e),this.props.displayInModal?h.default.closeGenericDesktopModal(e,this._getRootViewId()):h.default.closeFindPanel(e,t)}}static getHeaderText(){return u.getString("LocationPicker.SendLocation")}componentDidMount(){super.componentDidMount(),this._closeButtonRef&&this._closeButtonRef.requestFocus()}render(){const e={setButtonRef:this._onCloseButtonRef};e.closeButtonType=p.CloseButtonType.Close,e.onPress=this._onClose;const t=(0,o.jsx)(p.SimplePanelHeader,{panelName:_.getHeaderText(),leftButton:e,useCenteredControls:!0});return(0,o.jsxs)(n.View,{style:[S.locationPanel,this._themeStyles.primaryBackgroundColorStyle],children:[t,this._renderPanelContent()]})}_renderPanelContent(){return(0,o.jsx)(a.default,{style:[g.default.flexOne,g.default.overflowVisible],conversationId:this.props.conversationId,displayInPopUp:!1,displayInModal:!!this.props.displayInModal})}_componentId(){return"LocationPanel"}}t.default=_},712562:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importDefault(s(336550)),a=s(694073),l=i.__importStar(s(516778)),d=i.__importDefault(s(192478)),c=i.__importStar(s(971988)),u=s(154235),h=s(117739),p=i.__importStar(s(761393)),g=i.__importDefault(s(984339)),m=s(815146),S=s(815146),_=i.__importDefault(s(560099)),f=i.__importStar(s(626065)),y=i.__importStar(s(85385)),v=s(26703),C=i.__importStar(s(704704)),T=s(313599),M=i.__importDefault(s(265609)),b=i.__importStar(s(576047)),I=i.__importDefault(s(91258)),w=i.__importDefault(s(750585)),P=i.__importDefault(s(252089)),k=i.__importDefault(s(363091)),A=i.__importDefault(s(740794)),x=i.__importDefault(s(817198)),D=i.__importDefault(s(863132)),R=i.__importDefault(s(960282)),L=s(96575),B=i.__importDefault(s(799585)),F=s(331079),N=i.__importDefault(s(827361)),E=i.__importDefault(s(760989)),O=700,U=450,V=(0,v.lazyProperties)({container:()=>l.Styles.createViewStyle({width:322,flexDirection:"column",borderRadius:3}),containerPopUp:()=>l.Styles.createViewStyle({width:O,height:U,flexDirection:"row",borderRadius:3}),containerModal:()=>l.Styles.createViewStyle({width:p.DefaultWidth,flexDirection:"column",borderRadius:3}),centerContent:()=>l.Styles.createViewStyle({justifyContent:"center",alignItems:"center",position:"absolute",top:0,bottom:0,right:0,left:0}),mobileSize:()=>(0,v.lazyProperties)({containerPopUp:()=>l.Styles.createViewStyle({width:320,height:U,flexDirection:"column",borderRadius:3}),placesContainerPopUp:()=>l.Styles.createViewStyle({width:320,height:U-180})}),map:()=>l.Styles.createViewStyle({justifyContent:"center",minHeight:280,flexBasis:1}),places:()=>(0,v.lazyProperties)({container:()=>l.Styles.createViewStyle({width:-78,height:700}),containerPopUp:()=>l.Styles.createViewStyle({width:O-400,height:U}),containerModal:()=>l.Styles.createViewStyle({width:p.DefaultWidth,flexBasis:1})})});class H extends d.default{constructor(){super(...arguments),this._setMapRef=e=>{this._map=e||void 0},this._onMapLoaded=()=>{this.isComponentMounted()&&this.setState({mapLoaded:!0})},this._onCurrentLocationChanged=e=>{this.isComponentMounted()&&this.setState({currentSelectedLocation:{latitude:e.latitude,longitude:e.longitude,latitudeDelta:T.LatitudeDelta,longitudeDelta:T.LongitudeDelta},selectedPlace:e,locationType:F.LocationType.Custom})},this._setSearchInputControlRef=e=>{this._searchInputControl=e||void 0},this._onInputTextChange=e=>{if(!this.isComponentMounted())return;const t=e.trim();this.setState({rawSearchQuery:e}),this._setSearchQuery(t)},this._setSearchQuery=n.throttle((e=>{this.isComponentMounted()&&this.setState({searchQuery:e})})),this._onCancelSearchPress=()=>{this.state.isSearchingPlaceActive&&(y.track(new b.LocationPickerSearchCancel(this.state.locationType)),this._blurSearchInput(),this.isComponentMounted()&&this.setState({rawSearchQuery:"",isSearchingPlaceActive:!1}))},this._onSetInitialLocation=e=>{this.isComponentMounted()&&this.setState({currentSelectedLocation:{latitude:e.latitude,longitude:e.longitude,latitudeDelta:T.LatitudeDelta,longitudeDelta:T.LongitudeDelta}})},this._onNearByPlaceFromSearchSelected=e=>{this._onNearByPlaceSetState(e,F.LocationType.Search),y.track(new b.LocationPickerNearbyClicked(F.LocationType.Search))},this._onSendPress=e=>{let t;const s=e.name,i=e.address;if(t=s===i?i:C.getString("LocationPicker.FullAddress",{addressFriendlyName:s,address:i}),t||(t=C.getString("LocationPicker.LocationSharedFallback")),!this.props.conversationId)return;const{latitude:o,longitude:n}=e,a=new f.LinkEntity(t,I.default.getBingMapsLocationUrl({latitude:o,latitudeDelta:T.LatitudeDelta,longitude:n,longitudeDelta:T.LongitudeDelta},s)),l=new f.GeoLocationEntity(this.state.locationType===F.LocationType.Current,k.default.getSkypeMri(),o,n,void 0,(new Date).getTime(),r.default.getDefaultId(),void 0,C.getLocale(),C.getLanguageFromLocale(),t,void 0,void 0,s,i,[a]);D.default.postMessageFromInput(this.props.conversationId,m.PostSource.LocationPicker,[l],c.MessageTypes.Location,{name:L.ScenarioName.SendLocation}),y.track(new b.LocationPickerSend(this.state.locationType));const d=E.default.newCauseId(),u=this._getContext();y.log(S.LogTraceArea.Navigation,"DesktopLocationWidget._onSendPress,  causeId: "+d),this.props.displayInPopUp?w.default.dismissPopup(this._getRootViewId()):this.props.displayInModal?A.default.closeGenericDesktopModal(d,this._getRootViewId()):A.default.closeFindPanel(d,u)}}_buildState(e,t){const s=this._getRootViewId(),i={isMobileScreenSize:R.default.isMobileScreenSize(s)||R.default.isMinDesktopWidth(s),locationType:t?F.LocationType.None:this.state.locationType,rawSearchQuery:t?"":this.state.rawSearchQuery},o=M.default.getLocationForBing();return t&&o&&(i.currentSelectedLocation={latitude:o.coords.latitude,longitude:o.coords.longitude,latitudeDelta:T.LatitudeDelta,longitudeDelta:T.LongitudeDelta}),i}componentDidMount(){super.componentDidMount(),y.track(new b.LocationPickerNavigationOpen(this.state.locationType))}componentWillUnmount(){super.componentWillUnmount(),y.track(new b.LocationPickerNavigationClose(this.state.locationType))}render(){let e,t;e=this.props.displayInPopUp?this.state.isMobileScreenSize?V.mobileSize.containerPopUp:V.containerPopUp:this.props.displayInModal?[V.containerModal,N.default.flexOne]:V.container,this.state.mapLoaded||(t=(0,o.jsx)(l.View,{style:[e,V.centerContent,this._themeStyles.primaryBackgroundColorStyle],children:(0,o.jsx)(B.default,{size:u.SXActivityIndicatorSize.Large,tintColor:P.default.getPrimaryColorNoSubscription()})}));const s=(0,o.jsx)(_.default,{style:[N.default.flexOne,this.props.displayInPopUp?void 0:V.map],children:(0,o.jsx)(h.DesktopBingMap,{ref:this._setMapRef,onCurrentLocationChanged:this._onCurrentLocationChanged,onLocationSend:this._onSendPress,onSetInitialLocation:this._onSetInitialLocation,onMapLoaded:this._onMapLoaded})});let i;i=this.props.displayInPopUp?this.state.isMobileScreenSize?V.mobileSize.placesContainerPopUp:V.places.containerPopUp:this.props.displayInModal?V.places.containerModal:V.places.container;const n=(0,o.jsxs)(l.View,{style:[this.props.displayInPopUp?void 0:N.default.flexOne,i],children:[(0,o.jsx)(l.View,{children:(0,o.jsx)(g.default,{ref:this._setSearchInputControlRef,blurOnSubmit:!0,autoFocus:!0,searchInputSmallMode:!0,hideCloseButton:!0,rawSearchQuery:this.state.rawSearchQuery,onInputTextChange:this._onInputTextChange,cancelSearch:this._onCancelSearchPress})}),(0,o.jsx)(l.View,{style:N.default.flexOne,children:(0,o.jsx)(x.default,{locationType:this.state.locationType,style:N.default.flexOne,query:this.state.searchQuery,searchModeOn:!0,latitude:this.state.currentSelectedLocation&&this.state.currentSelectedLocation.latitude,longitude:this.state.currentSelectedLocation&&this.state.currentSelectedLocation.longitude,sendItem:this._onSendPress,onItemSelected:this._onNearByPlaceFromSearchSelected})})]});return(0,o.jsxs)(l.View,{style:e,children:[s,n,t]})}_blurSearchInput(){this._searchInputControl&&this._searchInputControl.blurInput()}_onNearByPlaceSetState(e,t){this._blurSearchInput(),this._map&&this._map.sendCommand({type:a.Commands.SetNearbyLocation,location:{address:e.address,name:e.name,region:{center:{latitude:e.latitude,longitude:e.longitude},width:T.LatitudeDelta,height:T.LongitudeDelta}}})}}t.default=H},813994:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(119557),a=s(380157),l=i.__importStar(s(516778)),d=i.__importStar(s(187140)),c=i.__importStar(s(890484)),u=i.__importStar(s(239007)),h=i.__importStar(s(353021)),p=i.__importDefault(s(389659)),g=s(815146),m=i.__importDefault(s(453761)),S=i.__importStar(s(85385)),_=s(26703),f=i.__importStar(s(704704)),y=i.__importStar(s(901156)),v=i.__importDefault(s(627466)),C=i.__importDefault(s(252089)),T=i.__importDefault(s(251733)),M=i.__importDefault(s(246230)),b=s(96575),I=i.__importDefault(s(791384)),w=i.__importDefault(s(393443)),P=s(16549),k=i.__importDefault(s(20758)),A=s(641400),x=s(331079),D=i.__importDefault(s(827361)),R=i.__importDefault(s(497910)),L=i.__importDefault(s(760989)),B=s(154235),F=i.__importDefault(s(799585)),N=(0,_.lazyProperties)({container:()=>l.Styles.createViewStyle({height:89,alignItems:"center",flex:1}),progress:()=>l.Styles.createViewStyle({alignSelf:"stretch",height:8,backgroundColor:P.Color.gray100Overlay30}),progressBar:()=>D.default.absoluteFill,messageWrapper:()=>l.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flex:1}),message:()=>l.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",font:k.default.font.uiDisplayRegular,fontSize:k.default.fontSize.size17,flex:1,paddingHorizontal:16,paddingVertical:12}),messageTimeMaxedOut:()=>l.Styles.createTextStyle({color:P.Color.blue}),innerContainer:()=>l.Styles.createViewStyle({paddingRight:16,paddingLeft:4,flexDirection:"row",alignSelf:"stretch",alignItems:"center",flex:1,justifyContent:"space-between"}),cancelButton:()=>l.Styles.createViewStyle({height:A.IconSize.default,width:A.IconSize.size32}),sendButton:()=>l.Styles.createButtonStyle({borderRadius:A.IconSize.default/2,height:A.IconSize.default,width:A.IconSize.default}),desktopOverrides:()=>(0,_.lazyProperties)({container:()=>l.Styles.createViewStyle({height:50,alignItems:"center",flex:1,flexDirection:"row"}),innerContainer:()=>l.Styles.createViewStyle({borderRadius:25,paddingRight:10,paddingLeft:6}),progress:()=>l.Styles.createViewStyle({marginRight:8,marginLeft:6,flexShrink:0,flexGrow:1,alignSelf:"center",backgroundColor:P.Color.gray300Overlay70}),messageWrapper:()=>l.Styles.createViewStyle({flexGrow:0}),message:()=>l.Styles.createTextStyle({paddingHorizontal:10,fontSize:k.default.controlFontSize.tabHeader}),sendButton:()=>l.Styles.createButtonStyle({marginLeft:5,width:40,height:40}),cancelButton:()=>l.Styles.createViewStyle({width:40,height:40,borderRadius:20})}),loadingIndicator:()=>l.Styles.createTextStyle({flexGrow:1,fontSize:k.default.controlFontSize.tabHeader,paddingLeft:12})});class E extends R.default{constructor(){super(...arguments),this._progressBarWidth=0,this._progressBarAnimatedValue=new l.Animated.Value(0),this._progressBarAnimatedStyle=l.Styles.createAnimatedViewStyle({width:this._progressBarAnimatedValue}),this._audioManagerClient=new c.default(c.AudioManagerSource.AudioMessageComposer),this._onLayoutChanges=e=>{this._progressBarWidth=e.width},this._onCancelRecording=()=>{I.default.maybeAnnounceForAccessibility(f.getString("AudioMessageComposer.AudioMessageCancelled")),this.props.onDone(),S.track(new y.AudioMessageCancelEvent)},this._onSendRecording=()=>{const e=L.default.newCauseId();switch(S.log(g.LogTraceArea.AudioMessageComposer,"_onSendRecording causeId: "+e),h.default.getRecordingStateNoSubscription()){case h.RecordingState.StartingMic:case h.RecordingState.Recording:h.default.stopRecording();break;case h.RecordingState.None:return void S.error(g.LogTraceArea.AudioMessageComposer,"Cannot send audio message: not recording audio")}u.postAudio(this.props.conversationId,b.ScenarioName.SendAudioMessage).then((()=>{h.default.reset(),I.default.maybeAnnounceForAccessibility(f.getString("AudioMessageComposer.AudioMessageSent")),I.default.isMobileScreenReaderEnabled()?(w.default.SkypeMessageSent.playOnce(e),n.delay((()=>this.props.onDone()),1500)):this.props.onDone()}))},this._resetRecording=e=>{h.default.reset(),this._audioManagerClient.release(e)},this._startRecording=e=>{if(this._playerToken=v.default.registerAsPlayer(),this.state.microphonePermissionStatus===a.PermissionStatus.Granted){const t=I.default.isMobileScreenReaderEnabled()?r.AudioModes.CallPreferSpeaker:r.AudioModes.RecordAudioMessage;this._audioManagerClient.requestMode(t,e).then((e=>{e&&this.isComponentMounted()&&(v.default.setAsActive(this._playerToken),h.default.startRecording(250))}))}else this.state.microphonePermissionStatus===a.PermissionStatus.Unknown&&T.default.requestPermission(x.PermissionType.Microphone,x.PermissionPromptOptions.SkipPrePrompt).then((e=>{e===a.PermissionStatus.Granted&&(this.setState({microphonePermissionStatus:e}),h.default.startRecording(250))}))}}_buildState(e,t){const s=h.default.getRecordingState();return{elapsedRecordingTimeMs:h.default.getElapsedTimeMs(),recordingError:h.default.getRecordingError(),microphonePermissionStatus:T.default.permissionStatus(x.PermissionType.Microphone),sendDisabled:!n.includes([h.RecordingState.Recording,h.RecordingState.HasAudio],s),isRecording:s===h.RecordingState.Recording,isStartingMic:s===h.RecordingState.StartingMic}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=L.default.newCauseId();S.log(g.LogTraceArea.AudioMessageComposer,"componentDidUpdate causeId:",i);const o=h.default.getRecordingState(),n=h.default.getRecordingError();if(o===h.RecordingState.Recording)if(this.state.elapsedRecordingTimeMs>=this.props.maxRecordingTimeMs){h.default.stopRecording(),this._progressBarAnimatedValue.setValue(this._progressBarWidth);const e=f.getString("AudioMessageComposer.RecordingFinishedAccessibiltyAnnouncement");I.default.maybeAnnounceForAccessibility(e)}else{const e=this.state.elapsedRecordingTimeMs/this.props.maxRecordingTimeMs;this._progressBarAnimatedValue.setValue(Math.abs(this._progressBarWidth*e))}else n!==h.RecordingError.StartFailed&&n!==h.RecordingError.StopFailed||this._audioManagerClient.release(i)}componentDidMount(){super.componentDidMount();const e=L.default.newCauseId();S.log(g.LogTraceArea.AudioMessageComposer,"componentDidMount causeId:",e),this._startRecording(e)}componentWillUnmount(){super.componentWillUnmount();const e=L.default.newCauseId();S.log(g.LogTraceArea.AudioMessageComposer,"componentWillUnmount causeId:",e),this._resetRecording(e)}render(){let e;if(this.state.microphonePermissionStatus!==a.PermissionStatus.Granted)this.state.microphonePermissionStatus===a.PermissionStatus.Denied&&M.default.showDeniedPromptWithSettingsOption(x.PermissionType.Microphone,this._getRootViewId()),e=f.getString("AudioMessageComposer.NoMicrophoneAccess");else switch(this.state.recordingError){case h.RecordingError.None:break;case h.RecordingError.StartFailed:case h.RecordingError.StopFailed:e=f.getString("AudioMessageComposer.RecordingFailed");break;default:S.error(g.LogTraceArea.AudioMessageComposer,"Unhandled recording error case"+this.state.recordingError)}{const t=[N.innerContainer,N.desktopOverrides.innerContainer];return this._themeStyles.messageComposerBackgroundStyle&&t.push(this._themeStyles.messageComposerBackgroundStyle),(0,o.jsxs)(l.View,{style:N.desktopOverrides.container,children:[(0,o.jsxs)(l.View,{style:t,children:[this._getCancelButton(),this._getProgressBar(),this._getTimerElement(e)]}),this._getSendButton(e)]})}}_getSendButton(e){const t=[N.sendButton];return t.push(N.desktopOverrides.sendButton),(0,o.jsx)(d.default,{size:d.ActionButtonSize.Small,title:f.getString("AudioMessageComposer.SendButtonTitle"),onPress:this._onSendRecording,style:t,icon:A.SkypeIcon.Send,disabled:!n.isEmpty(e)||this.state.sendDisabled,flipIcon:this._getContext().isRTL,autoFocus:!0})}_getTimerElement(e){let t=e;if(!t){const e=Math.round(this.state.elapsedRecordingTimeMs/1e3),s=p.default.getElapsedTimePartsFromS(e);t=f.getString("AccessibilityLabel.NumberOfMinutesSecondsRecorded",{minuteCount:s.minutes,secondCount:s.seconds})}const s=[N.message,this._themeStyles.primaryTextColorStyle];return s.push(N.desktopOverrides.message),this.state.elapsedRecordingTimeMs>=this.props.maxRecordingTimeMs&&s.push(N.messageTimeMaxedOut),(0,o.jsx)(l.View,{accessibilityLabel:t,importantForAccessibility:l.Types.ImportantForAccessibility.Yes,style:N.desktopOverrides.messageWrapper,children:(0,o.jsx)(l.Text,{style:s,numberOfLines:2,importantForAccessibility:l.Types.ImportantForAccessibility.No,children:e||p.default.getElapsedTimeStringFromMs(this.state.elapsedRecordingTimeMs)})})}_getCancelButton(){if(this.state.isStartingMic)return(0,o.jsx)(F.default,{size:B.SXActivityIndicatorSize.ExtraSmall,tintColor:this._themeColors.primaryIconColor});const e=[N.cancelButton];return e.push(N.desktopOverrides.cancelButton),(0,o.jsx)(m.default,{title:f.getString("AudioMessageComposer.CancelButtonTitle"),disabled:this.state.isStartingMic,onPress:this._onCancelRecording,size:A.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,style:e,icon:A.SkypeIcon.Cancel})}_getProgressBar(){if(this.state.isStartingMic)return(0,o.jsx)(l.Text,{style:[N.loadingIndicator,this._themeStyles.primaryTextColorStyle],children:f.getString("Global.LoadingStatus")});const e=[N.progress];return e.push(N.desktopOverrides.progress),(0,o.jsx)(l.View,{style:e,onLayout:this._onLayoutChanges,children:(0,o.jsx)(l.Animated.View,{style:[N.progressBar,this._progressBarAnimatedStyle,C.default.getBackgroundColorStyleNoSubscription()]})})}}t.default=E},406962:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(317588)),a=s(26703),l=i.__importStar(s(704704)),d=i.__importDefault(s(497910)),c=(0,a.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:30}),image:()=>n.Styles.createImageStyle({width:142,height:132}),paragraph:()=>n.Styles.createTextStyle({marginTop:40,marginBottom:20}),paragraphCommon:()=>n.Styles.createTextStyle({textAlign:"center"})});class u extends d.default{render(){const e=this.props.isUsingStackNavigationContext?l.getString("BookmarksConversation.SecondParagraphMobile"):l.getString("BookmarksConversation.SecondParagraphDesktop");return(0,o.jsxs)(n.View,{style:c.container,children:[(0,o.jsx)(n.Image,{style:c.image,source:r.Collection.BOOKMARKS_EMPTY_STATE}),(0,o.jsx)(n.Text,{style:[this._themeStyles.secondaryTextColorStyle,c.paragraph,c.paragraphCommon],children:l.getString("BookmarksConversation.FirstParagraph")}),(0,o.jsx)(n.Text,{style:[this._themeStyles.secondaryTextColorStyle,c.paragraphCommon],children:e})]})}}t.default=u},967328:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(44717)),l=i.__importDefault(s(266311)),d=i.__importDefault(s(555436)),c=i.__importDefault(s(615364)),u=i.__importDefault(s(905786)),h=i.__importDefault(s(453761)),p=s(272626),g=i.__importDefault(s(586548)),m=i.__importDefault(s(89984)),S=i.__importDefault(s(697709)),_=i.__importDefault(s(311227)),f=s(26703),y=i.__importStar(s(704704)),v=i.__importDefault(s(899185)),C=s(16549),T=s(641400),M=i.__importDefault(s(577267)),b=i.__importDefault(s(497910)),I=(0,f.lazyProperties)({popupInnerView:()=>r.Styles.createViewStyle({minWidth:210}),buttonWithBackground:()=>r.Styles.createViewStyle({borderRadius:20,width:40,height:40,marginLeft:4}),redDot:()=>r.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:C.Color.red,position:"absolute",right:0,top:0})});class w extends b.default{constructor(){super(...arguments),this._onMoreButtonPress=e=>{this._openMorePopup(),this.state.shouldShowRedDot&&this.setState({shouldShowRedDot:!1}),this.props.onOverflowButtonPress&&this.props.onOverflowButtonPress(e)},this._onMoreButtonRef=e=>{this._moreButtonRef=e||void 0},this._openMorePopup=()=>{const e=S.default.filterIntegrations(n.values(this.state.allIntegrations),this._getIntegrationFilters()),t={getAnchor:()=>this._moreButtonRef,renderPopup:(t,s,i,n)=>(0,o.jsx)(M.default,{anchorPosition:t,anchorOffset:s,popupWidth:i,popupHeight:n,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,borderRadius:10,children:(0,o.jsx)(r.View,{style:I.popupInnerView,children:(0,o.jsx)(g.default,{conversationId:this.props.conversationId,hideAddInsTitle:!0,isInline:!0,onIntegrationPress:this._onIntegrationPress,overflowActionConfig:this.props.overflowConfig,otherPartyMri:this.props.otherPartyMri,filteredIntegrations:e})})}),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId(),onDismiss:this._onPopupDismiss};l.default.showPopup(t,"composerPopup"),this.setState({isPopupOpened:!0})},this._onPopupDismiss=()=>{this.setState({isPopupOpened:!1})},this._onIntegrationPress=e=>{u.default.openIntegration(e,this.props.conversationId,this._getContext(),void 0,void 0,void 0)},this._filterBing=e=>e.id!==p.IntegrationIds.Bing,this._filterHidden=e=>!e.hideInFindPanel,this._filterConnectors=e=>!_.default.isConnectorIntegration(e)||a.isGroupConversation(this.props.conversationId)}_buildState(e,t){const s=S.default.getProxiedIntegrations(n.compact(m.default.getIntegrations())),i={};n.each(s,(e=>{i[e.id]=e}));const o={shouldShowRedDot:v.default.isAnyMediaBarItemNew(e.overflowConfig.mediaBarItems),allIntegrations:i},r=(0,c.default)().getConversation(e.conversationId);return r&&(o.conversation=r,o.isConversationAccepted=!!r&&d.default.isConversationAccepted(r.id)),o}render(){const e=S.default.filterIntegrations(n.values(this.state.allIntegrations),this._getIntegrationFilters());if(n.isEmpty(this.props.overflowConfig.mediaBarItems)&&n.isEmpty(e))return null;const t=[I.buttonWithBackground,this._themeStyles.buttonBackgroundColorStyle],s=this.state.shouldShowRedDot?(0,o.jsx)(r.View,{style:I.redDot}):void 0;return this.state.isPopupOpened&&t.push(this._themeStyles.buttonBackgroundHoverColorStyle),(0,o.jsxs)(r.View,{children:[(0,o.jsx)(h.default,{color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:this.props.icon||T.SkypeIcon.More,size:T.IconSize.size20,style:t,hoverStyle:this._themeStyles.buttonBackgroundHoverColorStyle,accessibilityLabel:y.getString("Global.MoreOptions"),onPress:this._onMoreButtonPress,ref:this._onMoreButtonRef}),s]})}_getIntegrationFilters(){return[this._filterBing,this._filterConnectors,this._filterHidden]}}t.default=w},673e3:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(340724)),a=i.__importDefault(s(694154)),l=s(26703),d=s(16549),c=s(641400),u=i.__importDefault(s(497910)),h=c.IconSize.size20,p=(0,l.lazyProperties)({button:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start",minHeight:44}),iconAltView:()=>n.Styles.createViewStyle({height:h,width:h,borderRadius:10,backgroundColor:d.Color.gray100}),icon:()=>n.Styles.createImageStyle({height:h,width:h,borderRadius:10,justifyContent:"center",alignItems:"center"}),iconContainer:()=>n.Styles.createButtonStyle({height:h,width:h,justifyContent:"center",alignItems:"center",marginHorizontal:12}),buttonTitle:()=>n.Styles.createTextStyle({width:150,lineHeight:18,overflow:"visible"})});class g extends u.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted&&this.setState({isHovering:!1})},this._onPress=()=>{this.props.onIntegrationPress(this.props.integration)}}_buildState(e,t){const s={};return t&&(s.isHovering=!1),s}render(){const e=(0,o.jsx)(n.View,{style:p.iconAltView}),t=(0,o.jsx)(a.default,{origin:"IntegrationsView",altView:e,style:p.icon,containerStyle:p.iconContainer,source:this.props.integration.icon,resizeMode:"cover"}),s=[p.button];this.state.isHovering&&s.push(this._themeStyles.rowHoverViewStyle);const i=this.props.integration.name,l=this.props.integration.description;return(0,o.jsxs)(n.Button,{accessibilityLabel:r.default.combinedAccessibilityLabel(i,l),style:s,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd,children:[t,(0,o.jsx)(n.Text,{style:[this._themeStyles.primaryTextColorStyle,p.buttonTitle],children:i})]})}}t.default=g},295382:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(340724)),a=s(26703),l=i.__importDefault(s(899185)),d=i.__importDefault(s(612851)),c=i.__importDefault(s(827361)),u=i.__importDefault(s(497910)),h=(0,a.lazyProperties)({button:()=>n.Styles.combine(n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start",minHeight:44}),c.default.pointerCursor),buttonTitle:()=>n.Styles.createTextStyle({width:150,lineHeight:18,overflow:"visible"}),buttonTitleWithLabel:()=>n.Styles.createTextStyle({width:138,paddingRight:5}),mediaBarIconContainer:()=>n.Styles.createButtonStyle({marginHorizontal:4}),newLabel:()=>n.Styles.createButtonStyle({flex:1,marginRight:15})});class p extends u.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted&&this.setState({isHovering:!1})},this._onFocus=()=>{this.isComponentMounted&&this.setState({isFocused:!0})},this._onBlur=()=>{this.isComponentMounted&&this.setState({isFocused:!1})},this._onMediaBarPress=(e,t)=>{this.props.onMediaBarItemPress(e,t)},this._onMediaBarKeyPress=(e,t)=>{this.props.onMediaBarItemKeyPress(e,t)}}_buildState(e,t){const s={};return t&&(s.isHovering=!1,s.isFocused=!1,s.isNewItem=l.default.isMediaBarItemNew(e.mediaBarItem.id)),s}componentWillUnmount(){super.componentWillUnmount(),this.state.isNewItem&&l.default.setMediaBarItemAsSeen(this.props.mediaBarItem.id)}render(){const e=this.props.mediaBarItem.render(this.props.mediaBarItemProps),t=l.default.getMediaBarItemTitle(this.props.mediaBarItem.id),s=l.default.getMediaBarItemDescription(this.props.mediaBarItem.id),i=[h.button];(this.state.isHovering||this.state.isFocused)&&i.push(this._themeStyles.rowHoverViewStyle);const a=[this._themeStyles.primaryTextColorStyle,h.buttonTitle];return this.state.isNewItem&&a.push(h.buttonTitleWithLabel),(0,o.jsxs)(n.View,{accessibilityLabel:r.default.combinedAccessibilityLabel(t,s),importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:n.Types.AccessibilityTrait.Button,onPress:e=>this._onMediaBarPress(e,this.props.mediaBarItem),onKeyPress:e=>this._onMediaBarKeyPress(e,this.props.mediaBarItem),tabIndex:0,style:i,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,onFocus:this._onFocus,onBlur:this._onBlur,children:[(0,o.jsx)(n.View,{style:h.mediaBarIconContainer,children:e}),(0,o.jsx)(n.Text,{style:a,children:t}),this.state.isNewItem&&(0,o.jsx)(d.default,{style:h.newLabel})||void 0]})}}t.default=p},916260:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(667294),n=s(785893),r=s(174958),a=i.__importStar(s(496486)),l=s(331654),d=i.__importStar(s(516778)),c=i.__importStar(s(317588)),u=i.__importStar(s(397691)),h=s(623627),p=i.__importStar(s(603094)),g=i.__importDefault(s(97572)),m=i.__importDefault(s(354676)),S=i.__importStar(s(44717)),_=s(154235),f=i.__importDefault(s(555436)),y=i.__importDefault(s(734468)),v=i.__importDefault(s(615364)),C=i.__importDefault(s(601976)),T=i.__importDefault(s(37679)),M=s(815146),b=i.__importDefault(s(970035)),I=i.__importStar(s(85385)),w=i.__importDefault(s(117285)),P=s(26703),k=s(275897),A=s(483753),x=i.__importStar(s(147286)),D=i.__importStar(s(704704)),R=i.__importDefault(s(740794)),L=i.__importDefault(s(942724)),B=s(352549),F=i.__importDefault(s(625586)),N=i.__importDefault(s(960282)),E=i.__importStar(s(437782)),O=i.__importDefault(s(357692)),U=i.__importStar(s(122671)),V=i.__importDefault(s(439075)),H=i.__importDefault(s(655192)),j=i.__importDefault(s(799585)),z=i.__importDefault(s(660401)),W=s(16549),G=i.__importDefault(s(20758)),K=s(641400),q=s(331079),Q=i.__importDefault(s(827361)),X=i.__importDefault(s(48076)),$=i.__importDefault(s(535775)),J=s(262725),Y=i.__importDefault(s(497910)),Z=s(327740),ee=s(403396),te=s(596648),se=i.__importDefault(s(685734)),ie="processingInviteLink",oe=(0,P.lazyProperties)({contactInviteHeaderContainer:()=>d.Styles.createViewStyle({flex:1,alignItems:"center",borderBottomWidth:1,paddingBottom:20}),contactInviteHeaderContainerDesktop:()=>d.Styles.createViewStyle({justifyContent:"flex-start",flex:0}),userIcon:()=>d.Styles.createViewStyle({marginTop:20}),confirmationText:()=>d.Styles.createTextStyle({marginHorizontal:24,textAlign:"center"}),buttonContainer:()=>d.Styles.createViewStyle({flexDirection:"row",flex:0,alignSelf:"stretch",marginTop:20,marginHorizontal:24,justifyContent:"center"}),contactInviteButton:()=>d.Styles.createButtonStyle({height:60,flex:1,maxWidth:200}),contactInviteButtonHalfWidth:()=>d.Styles.createButtonStyle({flexBasis:0}),contactInviteButtonSpacer:()=>d.Styles.createButtonStyle({marginLeft:10}),annotationContainer:()=>d.Styles.createViewStyle({flex:0,flexDirection:"row",alignSelf:"stretch",marginHorizontal:16,marginTop:18,marginBottom:4,justifyContent:"center"}),annotationContainerColumn:()=>d.Styles.createViewStyle({alignSelf:"center",alignItems:"center",flexDirection:"column"}),annotationContainerColumnDesktop:()=>d.Styles.createViewStyle({alignSelf:"flex-start",alignItems:"flex-start",marginLeft:0}),annotationPart:()=>d.Styles.createViewStyle({flexDirection:"row",flex:-1,maxWidth:250}),annotationText:()=>d.Styles.createTextStyle({paddingLeft:4,flex:-1}),divider:()=>d.Styles.createViewStyle({flex:0,width:1,height:20,marginHorizontal:8}),pstnHeaderText:()=>d.Styles.createTextStyle({fontSize:G.default.controlFontSize.bodySmallDeprecated}),pstnImage:()=>d.Styles.createImageStyle({height:250,width:250}),pstnCtaButton:()=>d.Styles.createButtonStyle({minWidth:200,marginVertical:5,marginHorizontal:15}),pstnCtaButtonsContainer:()=>d.Styles.createViewStyle({justifyContent:"center"}),pstnCtaExplanationText:()=>d.Styles.createTextStyle({fontSize:G.default.controlFontSize.bodySmallDeprecated,marginVertical:5}),pstnCtaSeparatorText:()=>d.Styles.createTextStyle({marginVertical:10}),confirmationTextSmallViewSpacing:()=>d.Styles.createViewStyle({paddingTop:20}),experimentalInviteContainerDesktop:()=>d.Styles.createViewStyle({borderBottomWidth:1}),experimentalInviteBoxSection:()=>d.Styles.createViewStyle({marginTop:40,marginBottom:20,paddingVertical:15,paddingHorizontal:20,alignItems:"center",borderRadius:8}),experimentalInviteBoxSectionDesktop:()=>d.Styles.createViewStyle({width:360}),experimentalCommonMarginTop:()=>d.Styles.createViewStyle({marginTop:20}),experimentalInviteBoxSectionWide:()=>d.Styles.createViewStyle({width:440}),experimentalInviteBoxSectionMobile:()=>d.Styles.createViewStyle({marginTop:20,flex:1,alignSelf:"stretch",marginHorizontal:10}),experimentalInviteButton:()=>d.Styles.createViewStyle({minWidth:150,marginHorizontal:50,marginTop:20}),experimentalInviteButtonMobile:()=>d.Styles.createViewStyle({minWidth:100,alignSelf:"stretch"}),experimentalIncomingInviteButton:()=>d.Styles.createViewStyle({marginHorizontal:10,maxWidth:250}),experimentalInviteEmoticonContainer:()=>d.Styles.createViewStyle({marginBottom:20}),experimentalInviteText:()=>d.Styles.createTextStyle({paddingHorizontal:20,textAlign:"center"}),experimentalInviteAnnotationDivider:()=>d.Styles.createViewStyle({height:10}),experimentalInviteHeader:()=>d.Styles.createTextStyle({fontSize:20,textAlign:"center",flexShrink:1}),experimentalInviteButtonContainer:()=>d.Styles.createTextStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch",justifyContent:"center"}),experimentalHeaderContainer:()=>d.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",flex:1}),experimentalHeaderContainerDesktop:()=>d.Styles.createViewStyle({flexDirection:"row",overflow:"hidden",marginHorizontal:20}),experimentalHeaderTextDesktop:()=>d.Styles.createViewStyle({justifyContent:"center",flexShrink:1,alignItems:"flex-start",flexWrap:"wrap"}),experimentalHeaderTextContainerDesktop:()=>d.Styles.createViewStyle({flexShrink:0,flexGrow:0,flexDirection:"row",alignItems:"flex-start",overflow:"hidden"}),experimentalUserIconDesktop:()=>d.Styles.createViewStyle({marginRight:20}),experimentalUserIconMobile:()=>d.Styles.createViewStyle({alignSelf:"center"})});class ne extends Y.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._inviteButtonRef=e||void 0},this._onInvite=()=>{S.getPhoneNumberFromMri(this.props.conversationId)&&U.default.initiateJoinLinkInvite({target:new U.ShareSheetInvite,origin:M.ContactInviteOrigin.PstnChatWindow,showLoadingModalWhileGettingJoinLink:!0,recipientName:this.state.userShortDisplayName,anchor:()=>this._inviteButtonRef,rootViewId:this._getRootViewId()})},this._onAddCredit=()=>{R.default.navigateToBalanceStatePanel(M.BalancePanelSource.ContactInviteHeader,this._getRootViewId())},this._onAcceptInvite=e=>{I.log(M.LogTraceArea.Contacts,"ContactInviteHeader._onAcceptInvite"),this.props.inviteToken?(this._inviteAcceptanceScenario&&this._inviteAcceptanceScenario.markStepCompleted("AcceptButtonClicked"),k.LoadingDialog.show({dialogId:ie,dialogText:D.getString("UrlConverter.ProcessingInviteLinkMessage"),showActivityIndicator:!0,showCancelButton:!1},this._getRootViewId()),w.default.autoBuddy(this.props.inviteToken).then((e=>(I.log(M.LogTraceArea.AutoBuddy,`handleAutoBuddyInviteLink: autoBuddy [${e.Buddied}, ${r.pii.Omit(e.Uri)}]`),e.Buddied&&this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("AutobuddySucceed"),this._inviteAcceptanceScenario.isResolved()||(this._inviteAcceptanceScenario.finish(),this._inviteAcceptanceScenario=void 0)),e.Buddied||(I.warn(M.LogTraceArea.AutoBuddy,`Failed to autobuddy ${r.pii.Omit(this.props.inviteToken||"")}`),this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("AutobuddyFailed"),this._inviteAcceptanceScenario.isResolved()||(this._inviteAcceptanceScenario.fail("Failed to autobuddy"),this._inviteAcceptanceScenario=void 0))),this._acceptInvite()))).finally((()=>{k.LoadingDialog.dismiss(ie,this._getRootViewId())}))):this._acceptInvite()},this._onBlockInviter=()=>{const e={mriToBlock:this.state.inviterMri,rootViewId:this._getRootViewId(),reportContext:M.ReportContextListOptions.ContactRequest,isBlockingDialog:!0,conversationId:this.props.conversationId},t={navigateAway:!0,declineInvite:!0};if(this.state.isOneOnOneConversation){this.props.inviteToken&&this._inviteAcceptanceScenario&&(this._inviteAcceptanceScenario.markStepCompleted("BlockInviterClicked"),this._inviteAcceptanceScenario.finish(),this._inviteAcceptanceScenario=void 0);g.default.isMriBlocked(this.state.inviterMri)?(0,Z.unblockContact)(this.state.inviterMri):R.default.navigateToReportConcernModal(e,t)}else e.groupConversationId=this.props.conversationId,R.default.navigateToReportConcernModal(e,t)}}_buildState(e,t){const s=S.isOneOnOneConversation(e.conversationId);let i;if(s)i=e.otherPartyMri;else{const t=(0,v.default)().getConversation(e.conversationId);i=t?t.getAddedBy():void 0}const o=i?se.default.getFullUserProfileByMri(i):void 0,n=!!this._isPSTNConversationAndSmsAllowed()&&m.default.isPhoneMriTollFree(e.conversationId),r=T.default.getCreditEntitlement(),a=!!p.getPositiveCreditBalance(r)||T.default.userHasSubscriptions(),d=this._getRootViewId(),c=!!i&&!S.isPhoneMri(i);let u=!1;return!S.isOneOnOneConversation(e.conversationId)||S.isEncryptedThread(e.conversationId)||S.isV2OneToOneThread(e.conversationId)||(u=!f.default.isManuallyAddedContact(se.default.getConversationOwner(e.conversationId))),{isUsingStackNavigationContext:L.default.isUsingStackNavigationContext(),isSmallDevice:N.default.isSmallDevice(d),isSmallHeightView:N.default.isSmallDesktopHeightView(d),isMediumHeightView:N.default.isHeightSmallerThanThreshold(768,d),isLandscape:N.default.getDeviceOrientation(d)===l.DeviceOrientation.Landscape&&L.default.isUsingStackNavigationContext(),useTabletUI:X.default.isTabletUI(),inviterMri:i,isOneOnOneConversation:s,isTollFreeNumber:n,isPayingUser:a,userFullDisplayName:i?C.default.getDisplayName(i):D.getString("Notifications.UnknownUserShort"),userShortDisplayName:i?C.default.getShortDisplayName(i):D.getString("Notifications.UnknownUserShort"),gender:o?o.gender:void 0,gradientColors:i&&c?y.default.getGradientColors(i):void 0,primaryColor:i&&c?y.default.getPrimaryColor(i):void 0,isSearchingSkypeGraph:!1,showBlockPSTNUser:u,isPairedToSkypeUser:!!e.otherPartyMri&&se.default.getConversationOwner(e.otherPartyMri)!==e.otherPartyMri}}_getLocationFromSkypeGraphResult(e){return e.nodeProfileData.city&&e.nodeProfileData.state?D.getString("ContactInviteResponder.LocationCityState",{city:e.nodeProfileData.city,state:e.nodeProfileData.state}):e.nodeProfileData.city&&e.nodeProfileData.country?D.getString("ContactInviteResponder.LocationCityCountry",{city:e.nodeProfileData.city,country:e.nodeProfileData.country}):e.nodeProfileData.state&&e.nodeProfileData.country?D.getString("ContactInviteResponder.LocationStateCountry",{state:e.nodeProfileData.state,country:e.nodeProfileData.country}):e.nodeProfileData.city||e.nodeProfileData.state||e.nodeProfileData.country||""}componentDidMount(){if(super.componentDidMount(),!this.state.inviterMri)return;const e=S.getSkypeIdFromMri(this.state.inviterMri);e&&(O.default.searchPeopleAsync(e,Date.now().toString()).then((t=>{const s=t&&t.results?t.results:[];if(this.isComponentMounted()){const t=a.find(s,(t=>t.nodeProfileData&&t.nodeProfileData.skypeId===e));t?this.setState({location:this._getLocationFromSkypeGraphResult(t),numberOfMutualContacts:t.nodeConnectionData?t.nodeConnectionData.mutualFriendCount:0,isSearchingSkypeGraph:!1}):(I.warn(M.LogTraceArea.Contacts,"The Skype Graph did not return any data for SkypeID: "+E.mriOrId(e)),this.setState({location:void 0,numberOfMutualContacts:void 0,isSearchingSkypeGraph:!1}))}})).fail((t=>{I.error(M.LogTraceArea.Contacts,"Fetching loc and mutual contact data for ("+E.mriOrId(e)+") from the Skype Graph failed with: "+H.default.errorAsString(t))})),this.setState({isSearchingSkypeGraph:!0})),this.props.inviteToken&&(this._inviteAcceptanceScenario=new $.default(B.ScenarioName.InviteAcceptance),this._inviteAcceptanceScenario.start(),this._inviteAcceptanceScenario.markStepCompleted("AcceptInviteUIshown"))}componentWillUnmount(){super.componentWillUnmount(),this.props.inviteToken&&this._inviteAcceptanceScenario&&!this._inviteAcceptanceScenario.isResolved()&&(this._inviteAcceptanceScenario.invalidate(),this._inviteAcceptanceScenario=void 0)}render(){if(this.state.isOneOnOneConversation&&!this._isPSTNConversationAndSmsAllowed()&&!S.isEncryptedThread(this.props.conversationId))return this._renderInvite();const e=this.state.isSmallDevice?44:60,t=this.state.isUsingStackNavigationContext?void 0:this.state.gradientColors;let s,i,o;if(this.state.isUsingStackNavigationContext||(s=[oe.contactInviteHeaderContainerDesktop,this._themeStyles.messageStreamBackgroundColorStyle]),this.props.showWave&&this.props.onGreet&&(i=(0,n.jsx)(V.default,{conversationId:this.props.conversationId,displayName:this.state.userShortDisplayName,gender:this.state.gender,onGreet:this.props.onGreet})),!this.state.isSmallHeightView){const s=this.state.isUsingStackNavigationContext&&!this.props.isIncomingContactInvitePending;o=(0,n.jsxs)(F.default,{backgroundHeight:s?te.UserIconSize.Size120+e:te.UserIconSize.Size120,paddingTop:s?e:0,gradientColors:t,children:[this._renderPstnOrNonPstnConversationView(),this._renderPstnOptionsButtons()]})}return(0,n.jsxs)(d.View,{style:s,children:[(0,n.jsxs)(d.View,{style:[oe.contactInviteHeaderContainer,this.props.style,this._themeStyles.dividerBorderColorStyle],children:[o,this._renderOptionalConfirmationText(),this._renderAnnotationContainer(),this._renderOptionalButtonsContainer(),this._renderBlockUnWantedPSTNUserText(),this._renderBlockPSTNHyperLink()]}),i]})}_isPSTNConversationAndSmsAllowed(){return S.isPhoneMri(this.props.conversationId)}_renderBlockPSTNHyperLink(){if(!this.state.showBlockPSTNUser||!this.state.inviterMri)return;const e=D.getString("PSTNConversation.BlockPSTNNumber",{PSTNNumber:S.stripMriNamespace(this.state.inviterMri)});return(0,n.jsx)(d.Button,{onPress:this._onBlockInviter,accessibilityLabel:e,children:(0,n.jsx)(A.Link,{url:"#",onPress:this._onBlockInviter,children:e},"blockPSTNHyperLink")})}_renderBlockUnWantedPSTNUserText(){if(!this.state.showBlockPSTNUser)return;const e=[G.default.messagingHeaderFontStyle(!1,N.default.isSmallDeviceNoSubscription(this._getRootViewId()),this._currentTheme,!0),oe.confirmationText,this._isPSTNConversationAndSmsAllowed()?oe.pstnCtaExplanationText:void 0];return(0,n.jsx)(d.Text,{style:e,children:D.getString("PSTNConversation.BlockUnWantedPSTNUser")})}_showInviteToSkypeOption(){return this._isPSTNConversationAndSmsAllowed()&&!this.state.isTollFreeNumber&&!this.state.isPairedToSkypeUser}_showAddCreditOption(){return this._showInviteToSkypeOption()&&!this.state.isPayingUser}_getInviteToSkypeButtonConfig(){return{buttonStyle:this.state.isPayingUser?_.SXButtonStyle.DarkFill:_.SXButtonStyle.ThemeStroke,style:oe.pstnCtaButton}}_getAddCreditButtonConfig(){return{buttonStyle:this.state.isPayingUser?_.SXButtonStyle.ThemeStroke:_.SXButtonStyle.DarkFill,style:oe.pstnCtaButton}}_renderPstnOrNonPstnConversationView(){return this.state.isTollFreeNumber?(0,n.jsx)(d.Image,{source:c.Collection.PSTN_PHONE,style:oe.pstnImage}):!this._isPSTNConversationAndSmsAllowed()||this.state.isTollFreeNumber||this.state.isPairedToSkypeUser?(0,n.jsx)(ee.UserIcon,{userMri:this.props.conversationId,size:te.UserIconSize.Size120,style:oe.userIcon,importantForAccessibility:d.Types.ImportantForAccessibility.NoHideDescendants}):this.state.isPayingUser?(0,n.jsx)(d.Image,{source:c.Collection.PSTN_CLUSTER,style:oe.pstnImage}):(0,n.jsx)(d.Image,{source:c.Collection.PSTN_PHONE,style:oe.pstnImage})}_renderOptionalConfirmationText(){if(this._isPSTNConversationAndSmsAllowed())return;const e=[G.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,this._currentTheme,!0),oe.confirmationText,this._isPSTNConversationAndSmsAllowed()?oe.pstnHeaderText:void 0];return this.state.isSmallHeightView&&e.push(oe.confirmationTextSmallViewSpacing),(0,n.jsx)(J.PanelHeader,{style:e,children:this._getConfirmationTextString()})}_renderPstnOptionsButtons(){const e=[G.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,this._currentTheme,!0),oe.confirmationText,this._isPSTNConversationAndSmsAllowed()?oe.pstnCtaExplanationText:void 0];return this._showAddCreditOption()?(0,n.jsxs)(d.View,{style:oe.pstnCtaButtonsContainer,children:[(0,o.createElement)(z.default,Object.assign({},this._getInviteToSkypeButtonConfig(),{key:"invite",ref:this._onInviteButtonRef,buttonSize:_.SXButtonSize.Medium,onPress:this._onInvite,title:D.getString("PSTNConversation.InviteButtonLabel")})),(0,n.jsx)(J.PanelHeader,{style:e,children:D.getString("PSTNConversation.InviteLabel")}),(0,n.jsx)(J.PanelHeader,{style:[e,oe.pstnCtaSeparatorText],children:D.getString("PSTNConversation.InviteButtonAndAddCreditButtonsSeperatorLabel")}),(0,o.createElement)(z.default,Object.assign({},this._getAddCreditButtonConfig(),{key:"addCredit",buttonSize:_.SXButtonSize.Medium,onPress:this._onAddCredit,title:D.getString("PSTNConversation.AddCreditButtonLabel")})),(0,n.jsx)(J.PanelHeader,{style:e,children:D.getString("PSTNConversation.UseSkypeCreditToCallLabel")})]}):this._showInviteToSkypeOption()?(0,n.jsxs)(d.View,{style:oe.pstnCtaButtonsContainer,children:[(0,o.createElement)(z.default,Object.assign({},this._getInviteToSkypeButtonConfig(),{key:"invite",ref:this._onInviteButtonRef,buttonSize:_.SXButtonSize.Medium,onPress:this._onInvite,title:D.getString("PSTNConversation.InviteButtonLabel")})),(0,n.jsx)(J.PanelHeader,{style:e,children:D.getString("PSTNConversation.InviteLabel")})]}):void 0}_renderInvite(){let e,t;const s=[oe.experimentalInviteBoxSection,this._themeStyles.secondaryBackgroundColorStyle],i=[Q.default.alignItemsCenter,this._themeStyles.dividerBorderColorStyle],o=!this.state.isMediumHeightView,r=this._getConfirmationTextString();if(i.push(oe.experimentalInviteContainerDesktop),s.push(oe.experimentalInviteBoxSectionDesktop),this.state.isMediumHeightView&&s.push(oe.experimentalCommonMarginTop),this.props.isIncomingContactInvitePending&&this.state.inviterMri){const i=[oe.experimentalInviteButton,oe.experimentalIncomingInviteButton,Q.default.flexOne];if(o){const e="star";t=(0,n.jsx)(d.View,{style:oe.experimentalInviteEmoticonContainer,children:(0,n.jsx)(h.AnimatedEmoticon,{size:h.Size.Large,innerText:e,emoticonName:e,showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})})}s.push(oe.experimentalInviteBoxSectionWide),e=(0,n.jsxs)(d.View,{style:s,children:[t,(0,n.jsx)(J.BodyText,{style:oe.experimentalInviteText,numberOfLines:2,ellipsizeMode:"tail",children:r}),(0,n.jsxs)(d.View,{style:oe.experimentalInviteButtonContainer,children:[(0,n.jsx)(z.default,{title:D.getString("ContactInviteResponder.DeclineButtonText"),onPress:this._onBlockInviter,style:i,buttonStyle:this._useDarkTheme()?_.SXButtonStyle.ThemeStroke:_.SXButtonStyle.LightFill,buttonSize:_.SXButtonSize.Medium,disabled:this.state.isAcceptingContact},"declineContactInvite"),(0,n.jsx)(z.default,{title:D.getString("ContactInviteResponder.AcceptButtonText"),onPress:this._onAcceptInvite,style:i,buttonSize:_.SXButtonSize.Medium,showActivityIndicator:this.state.isAcceptingContact},"acceptContactInvite")]})]})}else if(this.props.showWave&&this.props.onGreet)o&&(t=(0,n.jsx)(d.View,{style:oe.experimentalInviteEmoticonContainer,children:(0,n.jsx)(h.AnimatedEmoticon,{size:h.Size.Large,innerText:"hi",emoticonName:"hi",showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})})),e=(0,n.jsxs)(d.View,{style:s,children:[t,(0,n.jsx)(J.BodyText,{style:oe.experimentalInviteText,numberOfLines:3,ellipsizeMode:"tail",children:r}),(0,n.jsx)(z.default,{style:oe.experimentalInviteButton,buttonSize:_.SXButtonSize.Medium,title:D.getString("MessageStream.SayHiButton"),allowTextWrap:!1,onPress:this.props.onGreet})]});else{if(o){let e;this.props.isContactInviteJustAccepted&&!S.isEncryptedThread(this.props.conversationId)||this.props.isEncryptedConversationEstablished?e="star":this.props.isAnyMessageInTheStream&&(e="sleepy"),e&&(t=(0,n.jsx)(d.View,{style:oe.experimentalInviteEmoticonContainer,children:(0,n.jsx)(h.AnimatedEmoticon,{size:h.Size.Large,innerText:e,emoticonName:e,showPlaceHolder:!0,standaloneAnimation:!0,placeholderBackgroundColor:this._themeColors.secondaryBackgroundColor})}))}e=(0,n.jsxs)(d.View,{style:s,children:[t,(0,n.jsx)(J.BodyText,{style:oe.experimentalInviteText,numberOfLines:2,ellipsizeMode:"tail",children:r})]})}const a=[oe.userIcon],l=[oe.experimentalHeaderContainer],c=[oe.experimentalCommonMarginTop],u=[];l.push(oe.experimentalHeaderContainerDesktop),c.push(oe.experimentalHeaderTextDesktop),u.push(oe.experimentalHeaderTextContainerDesktop),a.push(oe.experimentalUserIconDesktop);const p=this.state.isSmallDevice||this.state.isSmallHeightView?te.UserIconSize.Size60:te.UserIconSize.Size100;return(0,n.jsxs)(d.View,{style:i,accessibilityLabel:r,accessibilityLiveRegion:d.Types.AccessibilityLiveRegion.Polite,children:[(0,n.jsxs)(d.View,{style:l,children:[(0,n.jsx)(ee.UserIcon,{userMri:this.props.conversationId,size:p,style:a,importantForAccessibility:d.Types.ImportantForAccessibility.NoHideDescendants}),(0,n.jsxs)(d.View,{style:c,children:[(0,n.jsx)(J.PanelHeader,{style:[u,oe.experimentalInviteHeader],numberOfLines:1,ellipsizeMode:"tail",children:this.state.userFullDisplayName}),this._renderAnnotationContainer(!0)]})]}),e]})}_getConfirmationTextString(){if(this.props.isIncomingContactInvitePending){let e;return e=this.state.isOneOnOneConversation?"ContactInviteResponder.ConfirmationTextShort":"ContactInviteResponder.GroupConfirmationText",D.getString(e,{userName:this.state.userShortDisplayName})}if(this.props.isContactInviteJustAccepted&&!S.isEncryptedThread(this.props.conversationId)||this.props.isEncryptedConversationEstablished)return D.getString("MessageStream.SkypeFriendshipConfirmation");if(this._isPSTNConversationAndSmsAllowed())return D.getString("MessageStream.CallOrSendSMS");if(S.isEncryptedThread(this.props.conversationId))return D.getString("MessageStream.PrivateConversationHeaderFirstLine",{buddy:this.state.userShortDisplayName});const e=x.getLocalizeParamForGender(this.state.gender||q.eGender.Unspecified);return this.props.isAnyMessageInTheStream?D.getString("MessageStream.SkypeBeforeFriendshipConfirmation",{userName:this.state.userShortDisplayName,gender:e}):D.getString("MessageStream.GreetWithWaveActionLabel",{name:this.state.userShortDisplayName,gender:e})}_renderAnnotationContainer(e=!1){if(this.state.isSearchingSkypeGraph)return(0,n.jsx)(j.default,{size:_.SXActivityIndicatorSize.Small,tintColor:this.state.primaryColor||W.Color.blue});{let t,s,i;this.state.location&&(t=(0,n.jsxs)(d.View,{style:oe.annotationPart,children:[(0,n.jsx)(b.default,{icon:K.SkypeIcon.Location,size:K.IconSize.size15,color:this._themeColors.primaryTextColor}),(0,n.jsx)(J.BodyText,{style:oe.annotationText,numberOfLines:1,ellipsizeMode:"tail",children:this.state.location})]})),!a.isUndefined(this.state.numberOfMutualContacts)&&this.state.numberOfMutualContacts>=0&&(s=(0,n.jsxs)(d.View,{style:oe.annotationPart,children:[(0,n.jsx)(b.default,{icon:K.SkypeIcon.ContactGroupTwoPersonas,size:K.IconSize.size15,color:this._themeColors.primaryTextColor}),(0,n.jsx)(J.BodyText,{style:oe.annotationText,numberOfLines:1,ellipsizeMode:"tail",children:D.getString("ContactInviteResponder.MutualContactsCount",{count:this.state.numberOfMutualContacts})})]})),t&&s&&(i=e?(0,n.jsx)(d.View,{style:oe.experimentalInviteAnnotationDivider}):(0,n.jsx)(d.View,{style:[oe.divider,this._themeStyles.dividerColorStyle]}));const o=[oe.annotationContainer];return e&&(o.push(oe.annotationContainerColumn),o.push(oe.annotationContainerColumnDesktop)),(0,n.jsxs)(d.View,{style:o,children:[t,i,s]})}}_renderOptionalButtonsContainer(){if(this.props.isIncomingContactInvitePending&&this.state.inviterMri){const e=D.getString("ContactInviteResponder.DeclineButtonText"),t=D.getString("ContactInviteResponder.AcceptButtonText"),s=Math.abs(e.length-t.length)<=3,i=[oe.contactInviteButton];return s&&i.push(oe.contactInviteButtonHalfWidth),(0,n.jsxs)(d.View,{style:oe.buttonContainer,children:[(0,n.jsx)(z.default,{title:e,style:i,onPress:this._onBlockInviter,buttonStyle:_.SXButtonStyle.ThemeStroke,disabled:this.state.isAcceptingContact},"declineContactInvite"),(0,n.jsx)(z.default,{title:t,style:a.concat(i,oe.contactInviteButtonSpacer),onPress:this._onAcceptInvite,showActivityIndicator:this.state.isAcceptingContact},"acceptContactInvite")]})}}_acceptInvite(){if(I.log(M.LogTraceArea.Contacts,"ContactInviteHeader._acceptInvite"),this.setState({isAcceptingContact:!0}),!this.state.inviterMri)return u.Rejected("No inviterMri");return(this.state.isOneOnOneConversation?f.default.acceptContactInvite(this.state.inviterMri,this.props.conversationId):f.default.acceptGroupConversationInvite(this.props.conversationId,this.state.inviterMri)).then((()=>{var e,t;this.isComponentMounted()&&(this.setState({isAcceptingContact:!1}),null===(t=(e=this.props).onIncomingContactInviteAccepted)||void 0===t||t.call(e)),I.log(M.LogTraceArea.Contacts,"ContactInviteHeader._acceptInvite: finished successfully")}))}}t.default=ne},127829:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(397186),r=s(534808),a=s(980050),l=s(527272),d=s(575725),c=s(3995),u=s(358893),h=s(246263),p=s(974690),g=s(906786),m=s(502906),S=s(833701),_=s(940054),f=s(5682),y=s(381833),v=i.__importDefault(s(322652));class C extends((0,a.DataApiMixin)((0,a.ElementApiMixin)(a.Editor))){constructor(e,t){super(t),this.ui=new M(this,t.skype.label),this.sourceElement=e,this.model.document.createRoot()}destroy(){return this.updateSourceElement(),this.ui.destroy(),super.destroy()}static create(e,t){return new Promise((s=>{const i=new this(e,t);s(i.initPlugins().then((()=>i.ui.init(e))).then((()=>i.data.init((0,y.getDataFromElement)(e)))).then((()=>i.fire("ready"))).then((()=>i)))}))}}C.builtinPlugins=[n.BoldEditing,r.Clipboard,d.Enter,m.SelectAllEditing,d.ShiftEnter,S.Typing,f.UndoEditing,c.IndentEditing,n.ItalicEditing,u.LinkEditing,h.ListEditing,h.ListPropertiesEditing,p.Paragraph,g.PasteFromOffice,n.StrikethroughEditing,S.TextTransformation,n.CodeEditing],t.default=C;class T extends _.EditorUIView{constructor(e,t,s,i){super(e),this.editable=new _.InlineEditableUIView(e,t,s,i?{label:()=>i}:void 0)}}class M extends _.EditorUI{constructor(e,t){super(e),this._elementReplacer=new y.ElementReplacer,this.view=new T(e.locale,e.editing.view,e.sourceElement,t)}getToolbar(e){return(0,o.jsx)(v.default,Object.assign({editor:this.editor},e))}init(e){const t=this.editor,s=this.view,i=t.editing.view;this.view.render();const o=i.document.getRoot();if(o){s.editable.name=o.rootName,s.editable.render();const n=s.editable.element;n&&(this.setEditableElement(s.editable.name,n),this.focusTracker._elements.has(n)||this.focusTracker.add(n),s.editable.bind("isFocused").to(this.focusTracker),i.attachDomRoot(n),this._elementReplacer.replace(e,n));const r=t.config.get("placeholder");if(r){const e="string"==typeof r?r:r[o.rootName];e&&(o.placeholder=e)}(0,l.enablePlaceholder)({view:i,element:o,isDirectHost:!1,keepOnFocus:!0})}this.fire("ready")}destroy(){super.destroy(),this._elementReplacer.restore(),this.view.editable.destroy(),this.view.destroy()}}},990558:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSkypeConfig=function(e){return e.config.get("skype")}},811250:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(496486)),a=s(667294),l=s(703813),d=s(397691),c=s(6625),u=i.__importDefault(s(127829)),h=i.__importDefault(s(984865)),p=i.__importDefault(s(864599)),g=i.__importDefault(s(635476)),m=i.__importDefault(s(920585)),S=i.__importDefault(s(476073)),_=i.__importDefault(s(736731)),f=i.__importDefault(s(266340)),y=i.__importDefault(s(359309)),v=i.__importDefault(s(115271)),C=i.__importDefault(s(220400)),T=i.__importDefault(s(81845)),M=i.__importDefault(s(413900)),b=i.__importDefault(s(952138)),I=i.__importDefault(s(467523)),w=s(330380),P=i.__importDefault(s(794229)),k=s(85385),A=s(14269),x=s(315946),D=s(815146),R=new RegExp("^[ \\n]*$");function L(...e){(0,k.log)(D.LogTraceArea.MessageComposer,"[Editor]",...e)}t.default=(0,a.forwardRef)((function(e,t){const{language:s}=(0,w.useLocalization)(),i=(0,a.useRef)(null),D=(0,a.useRef)(null),B=(0,a.useRef)(0),F=(0,a.useRef)(0),N=(0,a.useRef)(""),E=(0,a.useRef)([]),O=(0,a.useRef)([]),U=e=>!r.isEmpty(e.match(R)),V=e=>e===N.current,H=(0,a.useRef)(new c.ComposingIndicationEventSender(e.onComposingActive,e.onComposingInactive)),j=(0,a.useRef)(new c.ContentUpdatedEventSender(e.intermediateContentUpdatedEventInterval,(t=>{e.customContext&&c.dataUpdateReceivedEvent.fire({forCustomContext:e.customContext,newContent:t})}),q)),z=(0,a.useRef)(new c.EmptyIndicationEventSender(U,e.onEmptyIndicationChanged)),W=(0,a.useRef)(new c.EqualsInitialContentEventSender(V,e.onEqualsInitialContentChanged)),G=(0,a.useRef)(new c.UncommittedChangesEventSender(e.onUncommittedChangesIndicationChanged));function K(){var e,t;return(null!==(t=null===(e=D.current)||void 0===e?void 0:e.getData())&&void 0!==t?t:"").replace(/&nbsp;/g," ").replace(/<\/p>\s*<p>/g,"<br>").replace(/<p>/g,"").replace(/<\/p>/g,"").replace(/<code>/g,"<pre>").replace(/<\/code>/g,"</pre>")}function q(){const e=K();return{downStreamDataVersion:B.current,entities:U(e)?[...E.current,...O.current]:[...E.current,{type:c.EditableEntityType.HTML,displayText:(new DOMParser).parseFromString(e,"text/html").documentElement.textContent,html:e},...O.current]}}function Q(e,t,s){const i=D.current;if(i){if(L(`Inserting entity of type ${e.type}`),e.type===c.EditableEntityType.Agnostic)switch(e.position){case c.AgnosticContentPosition.Leading:E.current.push(e);break;case c.AgnosticContentPosition.Tailing:O.current.push(e)}i.model.enqueueChange((o=>{switch(e.type){case c.EditableEntityType.Emoticon:i.model.insertContent(o.createElement("emoticon",{emoticonName:e.emoticonName,tone:e.tone}),t);break;case c.EditableEntityType.Link:i.execute("link",e.href);break;case c.EditableEntityType.AtMention:i.model.insertContent(o.createElement("atMention",{id:e.userMri,name:e.displayText}),t),i.model.insertContent(o.createText(" "));break;case c.EditableEntityType.SlashCommand:i.model.insertContent(o.createElement("slashCommand",{name:e.commandName}),t);break;case c.EditableEntityType.Agnostic:case c.EditableEntityType.PlainText:i.model.insertContent(o.createText(e.displayText),t);break;case c.EditableEntityType.HTML:const s=i.data.processor.toView(e.html.replace(/<pre/g,"<code").replace(/<\/pre/g,"</code"));s&&i.model.insertContent(i.data.toModel(s),t)}s&&i.model.enqueueChange((()=>{i.plugins.get("Delete").requestUndoOnBackspace()}))})),(0,x.focusEditor)(i)}}function X(e){var t;B.current=e.downStreamDataVersion,null===(t=D.current)||void 0===t||t.setData(""),E.current.length=0,O.current.length=0;for(const t of e.entities)Q(t);const s=e.entities.map((e=>e.displayText)).join("");N.current=s,H.current.setUserInactive(),z.current.notifyContentChanged(s),W.current.reset(),G.current.reset()}return(0,a.useImperativeHandle)(t,(()=>({dismissKeyboard(){},hasUncommittedChanges:()=>G.current.hasUncommittedChanges(),isEmpty:()=>U(K()),equalsInitialContent:()=>V(K()),getContent:()=>(0,d.Resolved)(q()),insertContent(e){Q(e)},requestFocus(){(0,x.focusEditor)(D.current)},setContent(e){r.zip(e.entities,q().entities).some((([e,t])=>!e||!t||e.displayText!==t.displayText||e.type!==t.type))?X(e):B.current=e.downStreamDataVersion},notifyBackspacePressedExternally(){},setAccessibilityFocus(){},blur(){var e;null===(e=i.current)||void 0===e||e.blur()},onDragDropText(e){},getToolbar(e){var t;return null===(t=D.current)||void 0===t?void 0:t.ui.getToolbar(e)}}))),(0,a.useEffect)((()=>{j.current.setUpdateInterval(e.intermediateContentUpdatedEventInterval);const t=j.current;return()=>{t.reset()}}),[e.intermediateContentUpdatedEventInterval]),(0,o.jsxs)("div",{id:"editorWrapper",ref:i,style:n.Styles.combine(e.style instanceof Array?r.reduce(e.style,((e,t)=>r.merge({},e,t))):e.style,{flex:1,overflowY:"auto",overflowX:"hidden",marginTop:3}),children:[(0,o.jsx)(h.default,Object.assign({},e)),(0,o.jsx)(l.CKEditor,{editor:u.default,config:{language:s.split("-")[0],extraPlugins:[y.default,S.default,_.default,p.default,f.default,v.default,C.default,T.default,g.default,m.default,M.default,b.default,I.default],placeholder:e.placeholder,skype:{getLocalDataVersion:()=>F.current,insertContent:Q,getEntityByShortcut:e=>{const t=P.default.getEmoticonByShortcut(e);return t?{type:c.EditableEntityType.Emoticon,emoticonName:t.id,tone:void 0,displayText:`(${t.id})`}:void 0},onCommit:()=>{var t;L("User committed content"),null===(t=e.onNewContentCommitted)||void 0===t||t.call(e,q())},onAbort:()=>{var t;L("User aborted content"),null===(t=e.onNewContentAborted)||void 0===t||t.call(e),(0,x.focusEditor)(D.current)},onPaste:t=>{var s;return L("User pasted content"),(0,k.track)(new A.HtmlFormatterEvent("paste")),null===(s=e.onPaste)||void 0===s||s.call(e,t),!e.shouldDefaultPaste(t.nativeEvent)},isEmpty:()=>U(K()),editLastMessage:()=>{var t;L("User requested to edit last message"),null===(t=e.onEditLastMessageRequested)||void 0===t||t.call(e)},autocomplete:{triggers:e.autoCompletionTriggers,request:e.onAutoCompletionRequested,navigate:e.onAutoCompletionNavigationKey,abort:e.onAutoCompletionRequestAborted,delay:e.delayedTriggersWaitTime},label:e.accessibilityLabel||e.placeholder}},onReady:t=>{D.current=t,e.initialContent&&(L("Setting initial content",e.initialContent),X(e.initialContent)),t.model.document.on("change:data",(()=>{F.current++;const e=K();H.current.setUserActive(),z.current.notifyContentChanged(e),W.current.notifyContentChanged(e),G.current.notifyContentChanged(),j.current.notifyContentChanged()})),(0,x.focusEditor)(t),L("Ready")},onBlur:()=>{var t;j.current.notifyFocusLoss(),null===(t=e.onBlur)||void 0===t||t.call(e)},onFocus:()=>{var t;null===(t=e.onFocus)||void 0===t||t.call(e)},onError:(e,t)=>{L(`[Error] ${e}`,t)}})]})}))},635476:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.model.schema.register("atMention",{inheritAllFrom:"$inlineObject",allowAttributes:["id","name"]}),e.conversion.for("upcast").elementToElement({view:"at",model:(e,{writer:t})=>t.createElement("atMention",{id:e.getAttribute("id"),name:e.getChild(0).data})}),e.conversion.for("dataDowncast").elementToElement({model:"atMention",view:(e,{writer:t})=>t.createContainerElement("at",{id:e.getAttribute("id")},t.createText(e.getAttribute("name")))}),e.conversion.for("editingDowncast").elementToElement({model:"atMention",view:(e,{writer:t})=>(0,i.toWidget)(t.createContainerElement("span",{class:"atMention"},t.createText("@"+e.getAttribute("name"))),t)})};const i=s(87662)},115271:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t,s,l,d;const c=(0,n.getSkypeConfig)(e),u=c.autocomplete;let h,p=!1;function g(){h&&(clearTimeout(h),h=void 0)}const m=null===(s=null===(t=u.triggers)||void 0===t?void 0:t.instantTriggers)||void 0===s?void 0:s.map((e=>({pattern:e,regexp:new RegExp(e)}))),S=null===(d=null===(l=u.triggers)||void 0===l?void 0:l.delayedTriggers)||void 0===d?void 0:d.map((e=>({pattern:e,regexp:new RegExp(e)})));e.editing.view.document.on("keydown",((e,t)=>{var s;p&&[i.keyCodes.enter,i.keyCodes.tab,i.keyCodes.arrowup,i.keyCodes.arrowdown,i.keyCodes.esc].includes(t.keyCode)&&(t.preventDefault(),e.stop(),null===(s=u.navigate)||void 0===s||s.call(u,t))}),{priority:"highest"});const _=new o.TextWatcher(e.model,(e=>{if(m){const t=a(e,m);if(t)return{match:t,instant:!0}}if(S){const t=a(e,S);if(t)return{match:t,instant:p}}return!1}));function f(){var e;g(),p&&(null===(e=u.abort)||void 0===e||e.call(u),p=!1)}_.on("matched",((t,s)=>{var i;if(g(),!(null===(i=s.batch)||void 0===i?void 0:i.isTyping))return;const o=s.match,n=s.instant;function a(){var t;const s=c.getLocalDataVersion();p=!0,null===(t=u.request)||void 0===t||t.call(u,o.text,o.pattern).then((t=>{if(p&&s===c.getLocalDataVersion()){p=!1;const s=e.model.document.selection.focus;if(!s)throw new Error("No focus in the editor");c.insertContent(t,e.model.createRange(s.getShiftedBy(-o.text.length),s))}})).catch((e=>{s===c.getLocalDataVersion()&&(p=!1)}))}h=n?setTimeout(a,0):setTimeout(a,u.delay||r)})),_.on("unmatched",f),e.on("change:isReadOnly",f)};const i=s(381833),o=s(833701),n=s(990558),r=500;function a(e,t){for(const s of t){const t=e.match(s.regexp);if(t&&2===t.length)return{text:t[1],pattern:s.pattern}}}},220400:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=(0,o.getSkypeConfig)(e);new i.TextWatcher(e.model,(e=>{const s=e.split(" ").pop();if(!s)return;const i=t.getEntityByShortcut(s);return i?{text:s,entity:i}:void 0})).on("matched",((s,i)=>{var o;if(!(null===(o=i.batch)||void 0===o?void 0:o.isTyping))return;const n=e.model.document.selection.focus;if(!n)throw new Error("No focus in the editor");t.insertContent(i.entity,e.model.createRange(n.getShiftedBy(-i.text.length),n),!0)}))};const i=s(833701),o=s(990558)},81845:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.on("ready",(()=>{const t={isEnabled:!0};Object.entries({bulletedList:/^[*-]\s$/,numberedList:/^1[.|)]\s$/}).forEach((([s,i])=>{(0,o.default)(e,t,i,s)})),Object.entries({bold:/(?:^|\s)(\*)(?!\s)([^*]+)(?<!\s)(\*)$/g,italic:/(?:^|\s)(_)(?!\s)([^_]+)(?<!\s)(_)$/g,strikethrough:/(?:^|\s)(~)(?!\s)([^~]+)(?<!\s)(~)$/g,code:/(?:^|\s)(`|```)(?!\s)([^`]+)(?<!\s)(`)/g}).forEach((([s,i])=>{(0,n.default)(e,t,i,r(e,s))})),(0,n.default)(e,t,/(\{code\})(.+)(\{code\})$/g,r(e,"code"))}))};const i=s(197582),o=i.__importDefault(s(680965)),n=i.__importDefault(s(692383));function r(e,t){return(s,i)=>{const o=e.commands.get(t);if(!(null==o?void 0:o.isEnabled))return!1;const n=e.model.schema.getValidRanges(i,t);for(const e of n)s.setAttribute(t,!0,e);s.removeSelectionAttribute(t)}}},266340:(e,t)=>{function s(e,t){e.editing.view.change((s=>{const i=e.editing.view.document.getRoot();i&&s.setAttribute("dir",t,i)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){let t=!1;e.editing.view.document.on("keydown",((e,s)=>{!s.domEvent.ctrlKey||"ShiftLeft"!==s.domEvent.code&&"ShiftRight"!==s.domEvent.code?t&&(t=!1):t=!0}),{priority:"high"}),e.editing.view.document.on("keyup",((i,o)=>{t&&"ShiftLeft"===o.domEvent.code?(s(e,"ltr"),o.preventDefault(),i.stop()):t&&"ShiftRight"===o.domEvent.code&&(s(e,"rtl"),o.preventDefault(),i.stop())}),{priority:"high"})}},952138:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.editing.view.document.on("keydown",((t,s)=>{const n=(0,o.getSkypeConfig)(e);s.keyCode===i.keyCodes.arrowup&&n.isEmpty()&&(n.editLastMessage(),s.preventDefault(),t.stop())}),{priority:"high"})};const i=s(381833),o=s(990558)},864599:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.model.schema.register("emoticon",{inheritAllFrom:"$inlineObject",allowAttributes:["emoticonName","tone"]}),e.conversion.for("upcast").elementToElement({view:"ss",model:"emoticon"}),e.conversion.for("upcast").attributeToAttribute({view:"type",model:"emoticonName"}),e.conversion.for("upcast").attributeToAttribute({view:"tone",model:"tone"}),e.conversion.for("dataDowncast").elementToElement({model:"emoticon",view:(e,{writer:t})=>{const{emoticonName:s,tone:i}=d(e);return t.createContainerElement("ss",{type:s,tone:i},t.createText(l(s,i)))}}),e.conversion.for("editingDowncast").elementToElement({model:"emoticon",view:(e,{writer:t})=>{const s=t.createContainerElement("span"),i=t.createRawElement("span",{style:"display: inline-block; overflow: hidden; vertical-align: text-top;"},(t=>{const{emoticonName:s,tone:i}=d(e);(0,n.createRoot)(t).render((0,o.jsx)(r.AnimatedEmoticon,{size:r.Size.ExtraSmall,emoticonName:s,tone:i?a.default.getItemToneFromString(i):void 0,innerText:l(s,i)}))}));return t.insert(t.createPositionAt(s,0),i),s}})};const i=s(197582),o=s(785893),n=s(620745),r=s(623627),a=i.__importDefault(s(336817));function l(e,t){return t?`(${e}:${t})`:`(${e})`}function d(e){return{emoticonName:e.getAttribute("emoticonName"),tone:e.getAttribute("tone")}}},476073:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.editing.view.document.on("keydown",((t,s)=>{var o,n;if(13===s.keyCode){const r=null===(o=e.model.document.selection.getFirstPosition())||void 0===o?void 0:o.parent;s.domEvent.ctrlKey||s.domEvent.metaKey||"paragraph"===(null==r?void 0:r.name)&&!s.domEvent.shiftKey?(0,i.getSkypeConfig)(e).onCommit():(null==r?void 0:r.isEmpty)&&(null===(n=e.commands.get("outdent"))||void 0===n?void 0:n.isEnabled)?e.execute("outdent"):(e.execute("enter"),e.editing.view.scrollToTheSelection()),s.preventDefault(),t.stop()}}),{priority:"high"})};const i=s(990558)},736731:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.keystrokes.set("esc",((t,s)=>{(0,i.getSkypeConfig)(e).onAbort(),s()}))};const i=s(990558)},467523:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.editing.view.document.on("keydown",((t,s)=>{const n=s.keyCode,r=e.model.document.selection;if(r&&r.isCollapsed&&!s.domEvent.shiftKey)if([i.keyCodes.arrowleft,i.keyCodes.arrowright].includes(n)){const r="ltr"===e.locale.contentLanguageDirection?n===i.keyCodes.arrowright:n===i.keyCodes.arrowleft,a=o(e,r);a&&(e.model.change((e=>{e.setSelection(e.createSelection(a,r?"after":"before"))})),s.preventDefault(),t.stop())}else if([i.keyCodes.backspace,i.keyCodes.delete].includes(n)){if(!e.model.canEditAt(r))return;const a=o(e,n===i.keyCodes.delete);a&&(e.model.change((e=>{e.remove(a)})),s.preventDefault(),t.stop())}}),{priority:"high"})};const i=s(381833);function o(e,t){var s,i;const o=e.model.document.selection,n=e.model.createSelection(o);if(e.model.modifySelection(n,{direction:t?"forward":"backward"}),n.isEqual(o))return null;const r=t?null===(s=n.focus)||void 0===s?void 0:s.nodeBefore:null===(i=n.focus)||void 0===i?void 0:i.nodeAfter;return r&&e.model.schema.isObject(r)?r:null}},413900:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.editing.view.document.on("clipboardInput",((t,s)=>{s.domEvent.nativeEvent=s.domEvent,(0,i.getSkypeConfig)(e).onPaste(s.domEvent)&&t.stop();const o=s.dataTransfer.getData("text/html");o&&"string"==typeof o&&o.includes("style=")&&(s.content=e.data.processor.toView(o.replace(/\s*style="[^"]*"/g,"")))}))};const i=s(990558)},920585:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.model.schema.register("slashCommand",{inheritAllFrom:"$inlineObject",allowAttributes:["name"]}),e.conversion.for("upcast").elementToElement({view:"slash",model:(e,{writer:t})=>t.createElement("slashCommand",{name:e.getChild(0).data.substring(1)})}),e.conversion.for("dataDowncast").elementToElement({model:"slashCommand",view:(e,{writer:t})=>t.createContainerElement("slash",null,t.createText("/"+e.getAttribute("name")))}),e.conversion.for("editingDowncast").elementToElement({model:"slashCommand",view:(e,{writer:t})=>(0,i.toWidget)(t.createContainerElement("span",{class:"slashCommand"},t.createText("/"+e.getAttribute("name"))),t)})};const i=s(87662)},359309:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.conversion.attributeToElement({model:"bold",view:"b",converterPriority:"high"}),e.conversion.attributeToElement({model:"italic",view:"i",converterPriority:"high"}),e.conversion.attributeToElement({model:"strikethrough",view:"s",converterPriority:"high"}),e.conversion.attributeToElement({model:"code",view:"code",converterPriority:"high",upcastAlso:["pre","code"]})}},984865:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const{themeColors:t}=(0,n.useSkypeTheme)();return(0,o.jsx)("style",{children:`\n    #editorWrapper * {\n        margin: 0;\n        cursor: text;\n        white-space: pre-wrap;\n        user-select: text;\n    }\n    #editorWrapper {\n        color: ${t.textChat};\n    }\n    #editorWrapper a {\n        color: ${e.linkTextColor};\n        text-decoration: underline;\n    }\n    #editorWrapper b {\n        font-family: ${r.default.fontFamily.uidDisplaySemibold};\n        font-weight: ${a.FontWeight.regular};\n    }\n\n    /* From ckeditor5-engine/theme/placeholder.css & ckeditor5-theme-lark/theme/ckeditor5-engine/placeholder.css */\n    .ck.ck-placeholder,\n    .ck .ck-placeholder {\n        position: relative;\n    }\n    .ck .ck-placeholder::before {\n        position: absolute;\n        left: 0;\n        right: 0;\n        content: attr(data-placeholder);\n        cursor: text;\n        color: ${e.placeholderTextColor};\n        /* See ckeditor/ckeditor5#469. */\n        pointer-events: none;\n    }\n    .ck.ck-read-only .ck-placeholder {\n        &::before {\n            display: none;\n        }\n    }\n    .ck.ck-reset_all .ck-placeholder {\n        position: relative;\n    }\n\n    .atMention {\n        background-color: ${e.atMentionBackgroundColor};\n        font-family: ${r.default.fontFamily.uidDisplayBold};\n        font-weight: ${a.FontWeight.regular};\n        padding-left: 2px;\n        padding-right: 2px;\n        border-radius: 4px;\n    }\n\n    .slashCommand {\n        background-color: ${e.agnosticContentBackgroundColor};\n        font-family: ${r.default.fontFamily.uidDisplayBold};\n        font-weight: ${a.FontWeight.regular};\n        padding-left: 2px;\n        padding-right: 2px;\n        border-radius: 4px;\n    }\n\n    .ck-link_selected {\n        background-color: ${e.agnosticContentBackgroundColor};\n    }\n`})};const i=s(197582),o=s(785893),n=s(206315),r=i.__importDefault(s(20758)),a=s(154235)},322652:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=P(e.editor).map((t=>(0,o.jsx)(w,Object.assign({},t,{editor:e.editor})))),[s,i]=(0,r.useState)(t.length);return(0,o.jsx)(l.Row,{flex:1,padding:T,borderTopWidth:1,borderLeftWidth:1,borderRightWidth:1,backgroundColor:"surfaceSecondary",borderColor:"dividerPrimary",borderTopLeftRadius:e.isTopPanel?24:void 0,borderTopRightRadius:e.isTopPanel?24:void 0,onLayout:e=>{const o=e.nativeEvent.layout.width-2*T,n=o>t.length*b?t.length:Math.floor(o/b);n!==s&&(h.default.dismissPopup(I,p.MainRootViewId),i(n))},children:s<t.length?[...t.slice(0,s-1),(0,o.jsx)(k,{editor:e.editor,buttons:t.slice(s-1)})]:t})};const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(667294),a=s(527272),l=s(344175),d=i.__importDefault(s(453761)),c=s(704704),u=s(641400),h=i.__importDefault(s(266311)),p=s(154235),g=s(206315),m=s(85385),S=s(14269),_=s(176098),f=s(964414),y=i.__importDefault(s(577267)),v=s(315946),C=i.__importDefault(s(220534)),T=10,M=u.IconSize.size32,b=M+4,I="richtext_toolbar_popup_id",w=(0,r.forwardRef)(((e,t)=>{let s;(0,r.useImperativeHandle)(t,(()=>({getAnchor:()=>s})));const{themeColors:i}=(0,g.useSkypeTheme)(),a=e.editor.commands.get(e.commandName),[l,c]=(0,r.useState)(!a||a.isEnabled);null==a||a.on("change:isEnabled",(()=>{c(null==a?void 0:a.isEnabled)}));const[h,p]=(0,r.useState)(null==a?void 0:a.value);null==a||a.on("change:value",(()=>{p(null==a?void 0:a.value)}));const{iconStyles:_}=(0,f.useRXStyles)((({themeColors:{surfacePrimary:e}})=>({iconStyles:n.Styles.createButtonStyle({backgroundColor:h?e:"transparent",borderRadius:5,margin:2,width:M,height:M,alignSelf:"center"},!1)})),[h]);return(0,o.jsx)(d.default,{ref:e=>s=e,style:_,icon:e.icon,size:u.IconSize.size16,color:i.iconPrimary,hoverColor:i.iconHoverColor,title:e.label,accessibilityLabel:e.label,onPress:()=>{(0,m.track)(new S.HtmlFormatterEvent(e.commandName)),e.onPress?e.onPress():e.editor.execute(e.commandName),(0,v.focusEditor)(e.editor)},disabled:!l},e.commandName)})),P=e=>(0,r.useMemo)((()=>[{icon:u.SkypeIcon.Bold,label:(0,c.getString)("Formatting.Bold"),commandName:"bold"},{icon:u.SkypeIcon.Italic,label:(0,c.getString)("Formatting.Italic"),commandName:"italic"},{icon:u.SkypeIcon.Strikethrough,label:(0,c.getString)("Formatting.StrikeThrough"),commandName:"strikethrough"},{icon:u.SkypeIcon.CodeSnippet,label:(0,c.getString)("Formatting.Code"),onPress:()=>e.execute("code"),commandName:"code"},{icon:u.SkypeIcon.Link,label:(0,c.getString)("Formatting.Hyperlink"),commandName:"link",onPress:()=>{var t,s;if(null===(t=e.commands.get("link"))||void 0===t?void 0:t.value)return void e.execute("unlink");let i="";const n=null===(s=e.model.document.selection.getFirstRange())||void 0===s?void 0:s.getItems();if(n)for(const e of n)e instanceof a.TextProxy&&(i+=e.data);const r=(0,o.jsx)(_.LinkModal,{initialSelection:i,onDone:t=>{e.model.change((s=>{s.setSelection(e.model.insertContent(s.createText(t.textToDisplay,e.model.document.selection.getAttributes()),e.model.document.selection.getFirstRange())),e.execute("link",C.default.amendUri(t.linkHref));const i=e.model.document.selection.getLastPosition();i&&s.setSelection(i),s.removeSelectionAttribute("linkHref")})),(0,v.focusEditor)(e)}});h.default.showModal(r,"linkModal",{rootViewId:p.MainRootViewId})}},{icon:u.SkypeIcon.TextBulletList,label:(0,c.getString)("Formatting.BulletedList"),commandName:"bulletedList"},{icon:u.SkypeIcon.TextNumberList,label:(0,c.getString)("Formatting.NumberedList"),commandName:"numberedList"},{icon:u.SkypeIcon.TextIndent,label:(0,c.getString)("Formatting.Indent"),commandName:"indent"},{icon:u.SkypeIcon.TextCollapse,label:(0,c.getString)("Formatting.Outdent"),commandName:"outdent"},{icon:u.SkypeIcon.ArrowUndo,label:(0,c.getString)("Formatting.Undo"),commandName:"undo"},{icon:u.SkypeIcon.ArrowRedo,label:(0,c.getString)("Formatting.Redo"),commandName:"redo"}]),[e]);function k(e){const{themeColors:t}=(0,g.useSkypeTheme)(),s=(0,r.useRef)(null);return(0,o.jsx)(w,{ref:s,editor:e.editor,icon:u.SkypeIcon.More,label:(0,c.getString)("Global.MoreOptions"),commandName:"more",onPress:()=>{h.default.showPopup({getAnchor:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.getAnchor()},renderPopup:(s,i,n,r)=>(0,o.jsx)(y.default,{anchorPosition:s,anchorOffset:i,popupWidth:n,popupHeight:r,fillColor:t.popoverBackgroundColor,strokeColor:t.popupBorderColor,skipPopupAutoFocus:!0,borderRadius:10,children:e.buttons}),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:p.MainRootViewId,onDismiss:()=>(0,v.focusEditor)(e.editor)},I)}},"more")}},315946:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.focusEditor=function(e){if(!e)return;setTimeout((()=>{i.default.isModalDisplayed("linkModal",o.MainRootViewId)||e.focus()}),500)};const i=s(197582).__importDefault(s(266311)),o=s(154235)},731036:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(815063),r=i.__importStar(s(397691)),a=s(815146),l=i.__importStar(s(800662)),d=i.__importStar(s(85385)),c=i.__importDefault(s(266862)),u=i.__importDefault(s(300480)),h=i.__importDefault(s(957677)),p=i.__importDefault(s(497910)),g=[l.FocusEvent.CloseRightPanel,l.FocusEvent.RefreshConversation,l.FocusEvent.DeclineCallFromCallBanner,l.FocusEvent.ClosePurchaseDialog,l.FocusEvent.VideoMessageClosed,l.FocusEvent.CloseUnansweredCallPanel],m=(l.FocusEvent.CloseRightPanel,l.FocusEvent.CloseUnansweredCallPanel,l.FocusEvent.CloseMobileSearchInConversation,n.BrowserEnvironment.isAndroid());class S extends p.default{constructor(){super(...arguments),this.handleFocusEvent=e=>(d.log(a.LogTraceArea.GenericUnsafe,"MessageComposer.handleFocusEvent"),!(!g.includes(e)||!this._child)&&(e===l.FocusEvent.VideoMessageClosed?this._child.focusVideoButton():this._child.requestFocus(),!0)),this._onChildRef=e=>{this._child=e||void 0}}_buildState(e,t){const s={isDesktopComposer:!0};return d.log(a.LogTraceArea.MessageComposer,"MessageComposer version: "+(s.isDesktopComposer?"DesktopComposerWithPopup":"V2")),s}componentDidMount(){super.componentDidMount(),l.register(g,this)}componentWillUnmount(){super.componentWillUnmount(),l.unregister(g,this)}blur(){this._child&&this._child.blur()}blurIfFocused(){this._child&&this._child.blurIfFocused()}requestFocus(){this._child&&this._child.requestFocus()}focusVideoButton(){this._child&&this._child.focusVideoButton&&this._child.focusVideoButton()}focusSendButton(){this._child&&this._child.focusSendButton&&this._child.focusSendButton()}focusOverflowButton(){this._child&&this._child.focusOverflowButton&&this._child.focusOverflowButton()}isFocused(){return!!this._child&&this._child.isFocused()}setTextInputAccessibilityFocus(){this._child&&this._child.setTextInputAccessibilityFocus()}getInputEntities(){return this._child?this._child.getInputEntities():r.Resolved([])}autoReplaceText(e,t,s){this._child&&this._child.autoReplaceText(e,t,s)}insertSearchResult(e,t,s){this._child&&this._child.insertSearchResult(e,t,s)}replaceText(e,t,s,i){this._child&&this._child.replaceText(e,t,s,i)}abortTextAutoCompletion(){this._child&&this._child.abortTextAutoCompletion()}getOverflowConfig(){return this._child?this._child.getOverflowConfig():void 0}onDragDropText(e){var t,s;null===(s=null===(t=this._child)||void 0===t?void 0:t.onDragDropText)||void 0===s||s.call(t,e)}render(){return m?(0,o.jsx)(h.default,Object.assign({ref:this._onChildRef},this.props)):this.state.isDesktopComposer?(0,o.jsx)(u.default,Object.assign({ref:this._onChildRef},this.props)):(0,o.jsx)(c.default,Object.assign({ref:this._onChildRef},this.props))}}t.default=S},957677:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(496486)),a=s(815063),l=i.__importDefault(s(326036)),d=i.__importDefault(s(994070)),c=s(6625),u=i.__importStar(s(397691)),h=i.__importStar(s(187140)),p=i.__importDefault(s(150343)),g=i.__importDefault(s(438752)),m=s(22478),S=s(865900),_=i.__importStar(s(603094)),f=s(745709),y=i.__importDefault(s(838264)),v=i.__importDefault(s(879248)),C=s(148166),T=s(843890),M=i.__importDefault(s(859545)),b=i.__importDefault(s(401189)),I=i.__importStar(s(172134)),w=i.__importStar(s(971988)),P=i.__importStar(s(44717)),k=i.__importDefault(s(135372)),A=s(154235),x=i.__importDefault(s(967328)),D=s(88942),R=i.__importStar(s(361971)),L=i.__importStar(s(559210)),B=i.__importDefault(s(892034)),F=i.__importDefault(s(615364)),N=i.__importStar(s(463519)),E=i.__importDefault(s(236041)),O=i.__importDefault(s(691821)),U=i.__importDefault(s(366535)),V=i.__importStar(s(170881)),H=i.__importDefault(s(601976)),j=s(871145),z=i.__importDefault(s(794229)),W=i.__importStar(s(242561)),G=i.__importDefault(s(37679)),K=s(815146),q=s(445290),Q=i.__importStar(s(640957)),X=s(609099),$=i.__importDefault(s(606617)),J=s(269614),Y=i.__importDefault(s(453761)),Z=i.__importDefault(s(457468)),ee=i.__importStar(s(626065)),te=i.__importStar(s(7040)),se=i.__importStar(s(85385)),ie=i.__importDefault(s(114818)),oe=i.__importDefault(s(97595)),ne=i.__importDefault(s(54945)),re=s(26703),ae=i.__importStar(s(704704)),le=i.__importDefault(s(978285)),de=s(87780),ce=s(750585),ue=s(985367),he=s(291498),pe=i.__importStar(s(901156)),ge=i.__importDefault(s(469701)),me=i.__importDefault(s(791612)),Se=i.__importDefault(s(574818)),_e=i.__importStar(s(500983)),fe=i.__importStar(s(187086)),ye=i.__importDefault(s(341126)),ve=i.__importDefault(s(58606)),Ce=i.__importStar(s(172792)),Te=s(954225),Me=i.__importStar(s(786531)),be=i.__importDefault(s(982323)),Ie=s(675862),we=i.__importDefault(s(252089)),Pe=i.__importDefault(s(201721)),ke=i.__importDefault(s(740794)),Ae=i.__importDefault(s(327400)),xe=s(54325),De=s(211625),Re=s(943265),Le=s(137836),Be=i.__importDefault(s(863132)),Fe=i.__importDefault(s(960282)),Ne=s(848523),Ee=s(96575),Oe=s(617910),Ue=i.__importDefault(s(791384)),Ve=s(712783),He=i.__importDefault(s(160049)),je=i.__importDefault(s(776622)),ze=i.__importDefault(s(82133)),We=s(337288),Ge=i.__importDefault(s(842252)),Ke=s(16549),qe=i.__importDefault(s(139221)),Qe=i.__importDefault(s(20758)),Xe=s(641400),$e=s(331079),Je=i.__importDefault(s(827361)),Ye=i.__importDefault(s(220534)),Ze=i.__importDefault(s(719006)),et=i.__importDefault(s(685734)),tt=i.__importDefault(s(760989)),st=i.__importDefault(s(579067)),it=s(717413),ot=s(854642),nt=s(216678),rt=s(333434),at=i.__importDefault(s(843954)),lt=s(850725),dt=i.__importDefault(s(404547)),ct=s(627414),ut=s(681679),ht=s(618629),pt=s(37308),gt=s(796967),mt=s(759714),St=i.__importDefault(s(127336)),_t=s(384860),ft=i.__importDefault(s(604266)),yt=i.__importDefault(s(808164)),vt=/^[,.;:?!'].*/;var Ct;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(Ct||(Ct={}));const Tt=(0,re.lazyProperties)({composerArea:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row"}),compositionAreaContainer:()=>n.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>n.Styles.createViewStyle({paddingLeft:8,flex:1,justifyContent:"center"}),inputArea:()=>n.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>n.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Ke.Color.transparent}),expandableAreaWithQuote:()=>n.Styles.createViewStyle({flex:1,maxHeight:48}),composerInner:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:12,marginHorizontal:16}),rightControlContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),multiQuoteArea:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaRedesign:()=>n.Styles.createViewStyle({position:"relative",borderRadius:4,elevation:2,shadowColor:Ke.Color.blackOverlay20,shadowOffset:{width:1,height:1.5},shadowRadius:1,marginTop:16,marginHorizontal:16,marginBottom:0,overflow:"hidden"}),multiQuoteAreaMessages:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:126,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessagesRedesign:()=>n.Styles.createViewStyle({flex:1,maxHeight:126,flexDirection:"row"}),multiQuoteAreaMessage:()=>n.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaLastMessage:()=>n.Styles.createViewStyle({marginBottom:0}),multiQuoteAreaClearButton:()=>n.Styles.createButtonStyle({alignSelf:"flex-start"}),multiQuoteAreaClearButtonRedesign:()=>n.Styles.createButtonStyle({position:"absolute",top:8,right:8}),quoteTextStyle:()=>n.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>n.Styles.createTextStyle({fontSize:Qe.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),sendButton:()=>n.Styles.createViewStyle({height:50}),actionButtonWithBackground:()=>n.Styles.createViewStyle({height:40,width:40,borderRadius:20}),actionButtonVerticalCenter:()=>n.Styles.createViewStyle({alignSelf:"center"}),textInputFocusButton:()=>n.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Ke.Color.transparent}),linkStyle:()=>n.Styles.createTextStyle({fontSize:Qe.default.controlFontSize.body,lineHeight:18,color:Ke.Color.gray400,fontFamily:Qe.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoteAuthor:()=>(0,re.lazyProperties)({text:()=>n.Styles.createTextStyle({fontSize:Qe.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>n.Styles.createTextStyle({marginTop:5,marginBottom:3})}),desktopOverrides:()=>(0,re.lazyProperties)({messageComposer:()=>n.Styles.createViewStyle({minHeight:48,justifyContent:"center"}),messageComposerAllRoundCorners:()=>n.Styles.createViewStyle({borderRadius:24}),messageComposerTopFlatCorners:()=>n.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:24,borderBottomRightRadius:24}),compositionAreaContainer:()=>n.Styles.createViewStyle({flexDirection:"column"}),compositionArea:()=>n.Styles.createViewStyle({paddingLeft:12,paddingRight:12}),compositionAreaRedesign:()=>n.Styles.createViewStyle({paddingLeft:0,paddingRight:12}),expandableArea:()=>n.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>n.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>n.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>n.Styles.createViewStyle({maxHeight:91}),composerInner:()=>n.Styles.createViewStyle({marginVertical:5,marginLeft:2,marginRight:12}),rightControlContainer:()=>n.Styles.createViewStyle({minHeight:48,marginLeft:4,alignItems:"flex-end"}),composerInnerIconWrapper:()=>n.Styles.createViewStyle({alignSelf:"flex-end",height:40,justifyContent:"center"})}),mediaBarWrapper:()=>n.Styles.createViewStyle({flexDirection:"row",height:50,alignItems:"center"}),mirrorText:()=>n.Styles.createTextStyle({color:Ke.Color.transparent}),sharedInputAndMirror:()=>n.Styles.createTextInputStyle({paddingVertical:0,paddingHorizontal:0,margin:0,fontSize:Qe.default.controlFontSize.messageComposerDesktop,font:Qe.default.font.uiDisplayRegular,wordBreak:"break-word",backgroundColor:Ke.Color.transparent,minHeight:22}),textInputContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,flexDirection:"row"}),textInput:()=>n.Styles.createTextInputStyle({flex:1,flexDirection:"row"}),entityText:()=>n.Styles.createTextStyle({flexDirection:"row",alignSelf:"center"}),atMentionText:()=>n.Styles.createTextStyle({borderRadius:4,backgroundColor:Ke.Color.blueOverlay10}),atMentionTextDark:()=>n.Styles.createTextStyle({borderRadius:4,backgroundColor:Ke.Color.blueOverlay30})});let Mt=45;class bt extends pt.MessageComposerBase{constructor(){super(...arguments),this._smsDestinationType=_t.DestinationType.Unknown,this._isPostingMessage=!1,this._isComposing=!1,this._inputAreaText="",this._currentSelectionStart=0,this._currentSelectionEnd=0,this._inputTextBeforeInsertion="",this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=Mt,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new n.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=n.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onStickerSelected=e=>{this.props.conversationId&&(Be.default.postMessageFromInput(this.props.conversationId,K.PostSource.MediaPicker,[e],w.MessageTypes.RichText,{name:Ee.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Be.default.postMessageFromInput(this.props.conversationId,K.PostSource.MediaPicker,[e],w.MessageTypes.RichText,{name:Ee.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)},this._onPhoneNumberForSmsSelected=e=>{const t=tt.default.newCauseId();se.log(K.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.twoWaySMSCapable?e&&ke.default.navigateToConversation({convId:P.getMriFromPhoneNumber(e),origin:K.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):ke.default.navigateToConversation({convId:this.props.conversationId,origin:K.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._debounceNewTextBeforeInsertionChanged=r.debounce(((e,t)=>{if(this.isComponentMounted()&&this.props.onInputTextChanged){const s=!(r.isEmpty(t)||r.last(t)instanceof ee.UnhandledEntity);this._inputTextBeforeInsertion!==e&&(this._inputTextBeforeInsertion=e,this.props.onInputTextChanged(e,s))}}),100),this._stopComposingDebounced=r.debounce(this._stopComposing,5e3),this._startComposingThrottled=r.throttle((()=>{this._isComposing=!0,Ze.default.setComposingState(!0,this.props.conversationId)}),1e4,{leading:!0}),this._onScroll=(e,t)=>{this.isComponentMounted()&&this.setState({offsetTop:t})},this._onSelectionChanged=(e,t)=>{if(this._textInputRef&&(this._currentSelectionStart=e,this._currentSelectionEnd=t,e===t)){const t=this._inputAreaText.substring(0,e);this._debounceNewTextBeforeInsertionChanged(t,this.state.inputEntities)}},this._onKeyPress=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e))return e.stopPropagation(),void e.preventDefault();if(e.keyCode!==ne.default.ENTER&&r.defer((()=>{const e=this._textInputRef;if(e){const t=e.getSelectionRange(),s=t.start===t.end?this._inputAreaText.substring(0,t.start):"";this._debounceNewTextBeforeInsertionChanged(s,this.state.inputEntities)}})),e.keyCode===ne.default.ENTER)this._handleEnterCombinations(e);else if(e.keyCode===ne.default.UP&&0===this.state.inputEntities.length)this.props.onEditLastMessage&&(se.log(K.LogTraceArea.MessageComposer,"onEditLastMessage"),this.props.onEditLastMessage()),e.stopPropagation(),e.preventDefault();else if(e.keyCode===ne.default.ESCAPE){if(this.state.selectedMediaBarItem===he.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop)return;this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&this.props.onClearEdit&&this._clearTextInput()}else e.keyCode===ne.default.DELETE&&(0===this.state.inputEntities.length||1===this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ee.EmoteEntity)&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit(),B.default.clearMessageInput(this.props.conversationId))},this._onInput=e=>{if(r.defer((()=>{this.isComponentMounted()&&this._afterNextOnInput&&(this._afterNextOnInput(),this._afterNextOnInput=void 0)})),this._inputAreaText===e)return;this._inputAreaText=e;const t=this._textInputRef;if(!t)return;const s=this._updateInputEntities(this.state.inputEntities,e),i=te.getRawText(s.newEntities);if(i!==e||s.insertionAdjustment){const e=t.getSelectionRange().end+s.insertionAdjustment;r.defer((()=>{this.isComponentMounted()&&(t.setValue(i),t.selectRange(e,e))}))}this._debounceNewTextBeforeInsertionChanged(i.substring(0,t.getSelectionRange().end),s.newEntities),this.isComponentMounted()&&this.setState({inputEntities:s.newEntities});0!==e.length&&t.isFocused()?(this._stopComposingDebounced.cancel(),this._startComposingThrottled()):this._stopComposingDebounced()},this._shouldDefaultPaste=e=>!(this.state.pasteAsQuotePreference&&ve.default.hasContent(e)),this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=Ne.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=Ne.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=Ne.SavedMessageType.Quoted),B.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else B.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&B.default.clearMessageInput(this.props.conversationId);const s=B.default.getSavedMessageInput(this.props.conversationId);(!s||s&&r.isEmpty(s.messages))&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{this.isComponentMounted()&&this.setState({inputEntities:this.state.inputEntities.slice(1,this.state.inputEntities.length)})},this._renderEmoticonPickerItem=e=>(0,o.jsx)(j.EmoticonPickerItem,Object.assign({},e)),this._renderSmsItem=e=>(0,o.jsx)(We.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>(0,o.jsx)(Q.default,Object.assign({acceptedFileTypes:Q.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>(0,o.jsx)(Q.default,Object.assign({acceptedFileTypes:Q.AcceptedFileTypes.All},e)),this._renderCameraItem=e=>(0,o.jsx)(C.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>(0,o.jsx)(Oe.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>(0,o.jsx)(Le.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>(0,o.jsx)(le.default,Object.assign({},e)),this._renderContactPickerItem=e=>(0,o.jsx)(D.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>(0,o.jsx)(f.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>(0,o.jsx)(st.default,Object.assign({},e)),this._renderPeopleItem=e=>(0,o.jsx)(xe.PeopleItem,Object.assign({},e)),this._renderAudioMessageItem=e=>(0,o.jsx)(S.AudioMessageItem,Object.assign({},e)),this._renderSendCreditItem=e=>(0,o.jsx)(Ve.SendCreditItem,Object.assign({},e)),this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._renderPesPickerPopup=()=>(0,o.jsx)(De.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),Mt=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case $e.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case $e.MediaBarCustomAction.LaunchEmoticon:Re.EmoticonPickerTelemetry.startOpenScenario(),Re.EmoticonPickerTelemetry.open(),this._onPickerActive(he.MediaBarItemKeys.Emoticon);break;case $e.MediaBarCustomAction.LaunchSticker:Re.StickerPickerTelemetry.open(),this._onPickerActive(he.MediaBarItemKeys.Sticker);break;case $e.MediaBarCustomAction.LaunchGif:Re.GifPickerTelemetry.open(),this._onPickerActive(he.MediaBarItemKeys.Gif);break;case $e.MediaBarCustomAction.MentionBing:this._mentionMagicBot();break;default:se.log(K.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._mentionMagicBot=()=>{const e=(0,it.getMagicBotId)(),t=H.default.getDisplayableProfile(e),s=t.getShortName(),i=t.getDisplayName();this.replaceText(0,i+" ","@Mention",new ee.AtMentionEntity(i,e,s,i)),se.track(new ot.MagicBotMentionedByClick)},this._onComposerOverflowPress=()=>{se.track(new pe.MediaBarItemPressed(Ct[Ct.OverflowButton],!0,this.props.conversationId,ue.MediaBarItemOrigin.MessageComposer))},this._onDismissMediaPicker=()=>{d.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(Re.EmoticonPickerTelemetry.startOpenScenario(),O.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&O.default.close(this._getRootViewId())},this._onPickerActive=e=>{this.isComponentMounted()&&this.setState({selectedMediaBarItem:e})},this._onMediaBarItemSelected=e=>{this.state.selectedMediaBarItem!==e&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===he.MediaBarItemKeys.Sms?"":e}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===he.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):je.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(r.noop))},this._onCancelEditClick=e=>{e.stopPropagation(),bt._announceForAccessibility(ae.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation(),se.track(new Me.MessageComposerControlEvent(Me.MessageComposerControls.SendButton,Me.MessageComposerControlAction.Click)),this._sendMessage()},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this.insertSearchResult=(e,t,s)=>{if(this._announceForAccessibility(e),this._textInputRef){let e=[];const t=B.default.getSavedMessageInput(this.props.conversationId);t&&t.inputEntities&&(e=t.inputEntities),this._appendEntityToList(e,s);const i=te.getRawText(e);this._textInputRef.setValue(i),this._inputAreaText=i,this.isComponentMounted()&&this.setState({inputEntities:e})}be.default.deactivateInlineSearch()},this.autoReplaceText=(e,t,s)=>{let i=0;const o=this._textInputRef;if(o){const e=o.getSelectionRange();i=e.end-e.start}n.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&ce.MediaBarItem.dismissPopup(this._getRootViewId()),this._announceForAccessibility(e),this.replaceText(i,e,t,s)},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=B.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{e.keyCode===ne.default.ESCAPE&&this.isComponentMounted()&&this._moreButton&&this._moreButton.requestFocus()},this._onFocus=()=>{const e={hasFocus:!0};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{if(!this._shouldDefaultPaste(e.nativeEvent)&&this.props.onKeyboardPaste)return void this.props.onKeyboardPaste(e);const t=e.nativeEvent;this.props.disableCopyPasteMedia||r.isEmpty((0,J.get)(t,["clipboardData","items"]))||r.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(r.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let i=t.getAsFile();if(i instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=r.attempt((t=>new File([t],e,{type:t.type})),i);r.isError(t)||(i=t),s.onload=()=>{if(i&&i.size>0){const e={file:i,extension:$.default.extractFileExtension(i.name)};this._sendFileWithDimensions(e,K.PostSource.Clipboard)}},s.readAsDataURL(i)}}})),bt._announceForAccessibility(ae.getString("MessageComposer.FilesSentLabel")))},this._getQuoteEntity=e=>{const t=H.default.getDisplayName(e.creator,!0),s=L.quoteMessage(e,t);return new ee.QuoteEntity(s,t,e,this.props.quotesTriggerType)},this._announceForAccessibilityForMessageSent=()=>{r.defer((()=>{this.isComponentMounted()&&bt._announceForAccessibility(ae.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{const t=this._textInputRef;if(t){const s=this._inputAreaText;if(s.length>0){let i="";i=this._currentSelectionStart!==this._currentSelectionEnd?s.substring(0,this._currentSelectionStart)+s.substring(this._currentSelectionEnd,s.length):this._currentSelectionEnd!==s.length?s.substring(0,this._currentSelectionEnd-1)+s.substring(this._currentSelectionEnd,s.length):e?s.substring(0,s.lastIndexOf(" ")):s.substring(0,this._currentSelectionEnd-1);const o=this._updateInputEntities(this.state.inputEntities,i);this._inputAreaText=i,t.setValue(i),this.isComponentMounted()&&this.setState({inputEntities:o.newEntities})}}},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&T.UICapabilities.desktopFilePickerSupported()&&!P.isPhoneMri(this.props.conversationId)&&!P.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=$.default.extractFileExtension(e.file.name),s=this._getRootViewType();if($.default.isVideoExtension(t)){const t={name:Ee.ScenarioName.SendVideo};Be.default.postVideoWithThumbnail([this.props.conversationId],e,K.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{bt._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}else if($.default.isImageExtension(t)){const t={name:Ee.ScenarioName.SendPicture};Be.default.postUpload([this.props.conversationId],e,K.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{bt._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:Ee.ScenarioName.SendFile};Be.default.postUpload([this.props.conversationId],e,K.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{bt._announceForAccessibility(ae.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};X.FilePickerUtils.isDocumentPickerSupported()?X.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):X.FilePickerUtils.showMultiFilesPicker(t,pe.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._setContent=(e,t)=>{se.log(K.LogTraceArea.MessageComposer,"MessageComposer._setContent"),this._setInputEntityStateDownstream(e,(()=>{t&&this.requestFocus()}))},this.requestFocus=()=>{this._textInputRef&&(a.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(he.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.focusOverflowButton=()=>{},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&this.props.explicitAccessibilityAnnoucement&&n.Accessibility.announceForAccessibility(this._placeholderText)}}_buildState(e,t){var s;const i=super._buildState(e,t),o=Pe.default.getUserPreferencesLocal(),n=p.default.getS4LMessagingFeatures(),{enableMagicBot:r,enableReplyMessageUnifiedUI:l}=n,d=(0,F.default)().getConversation(e.conversationId),u=(0,it.isMagicBotConversation)(e.conversationId),h=(0,it.isMagicBotContainingConversation)(d),g=Object.assign(Object.assign({},i),{enableMagicBot:r,isMagicBotConversation:u,isMagicBotContainingConversation:h,conversation:d,enableReplyMessageUnifiedUI:l}),m=this.props,S=this._getRootViewId(),f=p.default.getS4LCommerceFeatures();t&&(g.inputEntities=e.initialInputEntities||[],g.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,g.hasFocus=!1,g.selectedMediaBarItem="",g.offsetTop=0,g.currentNumberOfIconsInMediaBar=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav?1:3,g.pesPickerKeyboardHeight=276,g.messageComposerPastedContentType=c.PastedTextType.None,e.editedMessage&&(this._inputTextBeforeInsertion=te.getRawText(g.inputEntities),g.rawEditedMessage=this._inputTextBeforeInsertion));const y=P.isOneOnOneConversation(e.conversationId);g.delayedTriggersWaitTime=n.composerAutoCompletionDelay,g.mediaBarMenuOrder=this._mediaBarMenuOrder(n.mediaBarMenuOrder),g.isConversationWithPhoneNumber=P.isConversationWithPhoneNumber(e.conversationId),g.enableHandlingHTMLonPaste=n.enableHandlingHTMLonPaste,g.editable=!Ae.default.isAnimationPending()&&!e.disableActionOnMessageComposer,g.isSmallHeightView=Fe.default.isSmallDesktopHeightView(S),g.viewportWidth=e.availableWidth||Fe.default.getWidth(S),g.showAdditionalMediaBarItems=g.viewportWidth>=360,g.gradientColors=we.default.getGradientColors(),g.emoticons=z.default.getEmoticons(),g.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&O.default.shouldShow(S),g.messageStreamFontSize=Pe.default.getMessageStreamFontSize(),g.canUseAddins=M.default.addins().canUseAddins,g.editableEntities=_e.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(g.inputEntities||[],g.emoticons);const{selectedTabType:C,searchQuery:I}=O.default.getPickerSearchProps();g.selectedTabType=C,g.searchQuery=I,g.isEncryptedThreadThread=P.isEncryptedThread(e.conversationId),g.showLocationPicker=!e.hideLocationPickerIcon&&n.enableLocationSharingOnDesktopAndWeb&&!qe.default.isFireOS(),g.showContactPicker=!e.hideContactPickerIcon&&M.default.contacts().canInvitePeople,g.showVideoMessageIcon=!e.hideVideoMessageIcon&&!g.isEncryptedThreadThread&&p.default.isDesktopVIMEnabled()&&(E.default.isAVDeviceReady()||a.BrowserEnvironment.isChrome()),g.phoneNumbers=e.otherPartyMri&&et.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const w=P.isPhoneMri(e.conversationId);g.isOneOnOneConversation=y,g.creditEntitlement=G.default.getCreditEntitlement(),g.enableOnewaySms=(w||f.smsPromo.unpaidUserEnabled||!!_.getPositiveCreditBalance(g.creditEntitlement)||G.default.userHasSubscriptions())&&(w||y)&&g.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!P.isEncryptedThread(e.conversationId),g.quoteTextForSms=this._getQuotedTextForSms(m.quotedMessages,e.quotedMessages),g.disableHighBandwidthOperations=Z.default.isUsingGogoNetwork(),g.isCameraAvailable=T.UICapabilities.cameraSupported()&&b.default.isCameraAvailable(),g.sendMessageWithEnter=o.sendMessageWithEnter,g.pasteAsQuotePreference=o.pasteAsQuotesEnabled,g.twoWaySMSCapable=!!(null===(s=v.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let k=e.phoneNumberForSendingSms;if(!k&&P.isPhoneMri(e.conversationId)){const t=P.getPhoneNumberFromMri(e.conversationId);t&&(k={number:t,type:$e.PhoneNumberTypes.Other})}g.phoneNumberForSendingSms=k,g.isMediaPreviewEnabled=me.default.isMediaPreviewEnabled(e.conversationId),g.hasMediaPreviews=g.isMediaPreviewEnabled&&Se.default.getPreviews(e.conversationId).length>0,g.isSmsFailureScreenEnabled=g.enableOnewaySms&&f.callFailure.smsFailurePrompt.enabled;const A=f.cantSendSmsToTheUSWarning.enabled,x=St.default.getSmsRateByPhoneNumberSafely(null==k?void 0:k.number),D=v.default.getCallerIdPrimaryNumber();g.shouldPreventSMSTotheUS=(0,gt.shouldPreventSMSTotheUS)(A,null==x?void 0:x.fullRateInfo,D);const R=f.cantSendSmsToCNWarning.enabled;return g.shouldPreventSMSToNotSupportedDestination=(0,gt.shouldPreventSMSToNotSupportedDestination)(R,null==k?void 0:k.number,null==x?void 0:x.fullRateInfo),g.shouldPreventSMSToInvalidNumber=f.cantSendSmsToInvalidNumber.enabled&&!yt.default.getPhoneNumberDetails(null==k?void 0:k.number).isValidNumber,g.isRegularMemberInModeratedGroup=d&&(0,Ie.isRegularMemberInModeratedGroup)(d),g.sendMessageWithEnterEnabled=!!o.sendMessageWithEnter,t&&(He.default.setDefault(),He.default.commitNextFlowId(),this._checkForOutgoingSmsMessagesInConversation(g)),g}componentDidMount(){if(super.componentDidMount(),P.isPhoneMri(this.props.conversationId)){const e=P.getPhoneNumberFromMri(this.props.conversationId);e&&ft.default.getSortedUsersByPhoneNumberAsync(e).then((e=>{(null==e?void 0:e.length)>0?this._smsDestinationType=_t.DestinationType.ContactNumber:this._smsDestinationType=_t.DestinationType.PhoneNumber})).catch(r.noop)}else P.isSkypeIdMri(this.props.conversationId)&&(this._smsDestinationType=_t.DestinationType.Contact);n.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&d.default.isSupported()&&d.default.dismiss()}))),oe.default.addHandler(K.KeyboardShortcut.SendFile,this._showFilePicker),oe.default.addHandler(K.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),oe.default.addHandler(K.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._keyboardDismissRegistrationHandle=V.register(this),B.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated),this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&at.default.fetchLocation(),_e.maybeRefreshCallerIdData(!0,this.state.isConversationWithPhoneNumber),this._contentSetSubscriptionToken=(0,ht.subscribeToContentSetEvent)(this._setContent)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&I.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1;const i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state),this._inputTextBeforeInsertion="");let o=[];if(e.initialInputEntities&&e.initialInputEntities!==this.props.initialInputEntities&&(s=!0,o=e.initialInputEntities),e.editedMessage&&e.editedMessage!==this.props.editedMessage){const t=N.decode(e.editedMessage);o=R.toEntities(t,{supportEmoticons:!0,supportLinkEntity:!0}),s=!0,i.phoneNumberForSendingSms=void 0,this._inputTextBeforeInsertion=te.getRawText(this.state.inputEntities),i.rawEditedMessage=te.getRawText(o)}else e.editedMessage||(i.rawEditedMessage=void 0);this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ee.EmoteEntity&&(o=[])),s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=e.conversationId!==this.props.conversationId;let o=this.state.selectedMediaBarItem,n=!1;e&&e.conversationId&&this.props.conversationId&&!i||(n=this._shouldAutoFocusInput());const a=this._hasQuotes()&&!(0,ie.default)(this.props.quotedMessages,e.quotedMessages),l=this.props.editedMessage&&!(0,ie.default)(this.props.editedMessage,e.editedMessage),d=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;(0,ie.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ie.default)(this.props.editedMessage,e.editedMessage)&&(0,ie.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),n=a||l||d,this._inputAreaText=te.getRawText(this.state.inputEntities),l&&(this._inputAreaText=te.getRawText(this.state.inputEntities)),!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(o=""),n&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.hasFocus&&!r.isEmpty(this.state.inputEntities)&&k.default.hideCurrentCoachMark(),this.setState({selectedMediaBarItem:o}),_e.maybeRefreshCallerIdData(i,this.state.isConversationWithPhoneNumber)}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),B.default.commit(this.props.conversationId),p.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&B.default.storeSavedMessage(this.props.conversationId),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._contentSetSubscriptionToken&&(this._contentSetSubscriptionToken.unsubscribe(),this._contentSetSubscriptionToken=void 0),this._stopComposing(),d.default.isSupported()&&d.default.dismiss(),oe.default.removeHandler(K.KeyboardShortcut.SendFile,this._showFilePicker),oe.default.removeHandler(K.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),oe.default.removeHandler(K.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),V.unregister(this._keyboardDismissRegistrationHandle),B.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),g.default.disableTooltip(m.EngagementTooltipType.ExpressionPicker),mt.MessageComposerSendButtonTelemetry.inactive()}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}render(){return this._renderDesktopComposer()}dismissKeyboard(){}_getQuotedTextForSms(e,t){return t&&e!==t?r.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_renderQuote(){if(this.props.hideContentInMessageComposer)return;let e,t=this.props.quotedMessages,s=this._onClearQuoteButtonPress;if(r.isEmpty(t)&&this.props.editedMessage){const i=r.first(this.state.inputEntities);i instanceof ee.QuoteEntity&&(t=[this.props.editedMessage],e=te.decodeFromInput([i],!1),s=this._onClearEditMessageQuote)}if(t&&t.length>0){const i=Qe.default.font.uiDisplayBold,r=this.props.showTranslatedMessage||!1,a={linkStyle:this._useDarkTheme()?n.Styles.combine(Tt.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle):Tt.linkStyle,disableActions:this.props.disableActionOnMessageComposer,quoteSymbolStyle:{size:Xe.IconSize.size20,color:this._themeColors.textPrimary},atMentionStyle:i,atMentionMeOverrideStyle:i,asQuoteInComposer:!0,showTranslatedMessage:r,hasTranslation:r,renderOrigin:W.MessageRenderOrigin.MessageComposerCanvas};if(a.textOverrideStyle=[this._themeStyles.primaryTextColorStyle],a.quoteAttributeStyle=[Tt.quoteAttributeStyle],this.state.enableReplyMessageUnifiedUI?a.quoteAttributeStyle.push({color:this._themeColors.textPrimary}):(a.quotedTextStyle=Tt.quoteTextStyle,a.quoteAttributeStyle.push(this._themeStyles.secondaryTextColorStyle)),this.state.messageStreamFontSize!==Te.MessageStreamFontSize.Normal){const e=Qe.default.controlFontSize.messageStreamItemDesktop,t=Ce.getStyle(e,this.state.messageStreamFontSize),s=Ce.getStyle(Qe.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.state.messageStreamFontSize);a.textOverrideStyle.push(t),a.quoteAttributeStyle.push(s),a.fontSize=Ce.getSize(e,this.state.messageStreamFontSize)}const l=t.length-1,d=t.map(((t,s)=>(0,o.jsx)(n.View,{style:s===l?Tt.multiQuoteAreaLastMessage:Tt.multiQuoteAreaMessage,children:(0,o.jsx)(ye.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:a})},`quote-${s}`))),c=this.state.enableReplyMessageUnifiedUI?[Tt.multiQuoteAreaRedesign,{backgroundColor:this._themeColors.surfaceQuaternary}]:[Tt.multiQuoteArea],u=this.state.enableReplyMessageUnifiedUI?[Tt.multiQuoteAreaMessagesRedesign]:[Tt.multiQuoteAreaMessages,this._themeStyles.secondaryDividerBorderStyle];return{component:(0,o.jsxs)(n.View,{style:c,children:[(0,o.jsx)(n.View,{style:u,children:(0,o.jsx)(n.ScrollView,{style:Je.default.flexOne,children:d})}),(0,o.jsx)(Y.default,{title:ae.getString("MessageComposer.RemoveQuoteButtonTitle"),style:this.state.enableReplyMessageUnifiedUI?Tt.multiQuoteAreaClearButtonRedesign:Tt.multiQuoteAreaClearButton,onPress:s,size:this.state.enableReplyMessageUnifiedUI?Xe.IconSize.size20:Xe.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:Xe.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer},"clearbutton")]}),onClearQuoteHandler:s}}}_renderDesktopComposer(){const e=[Tt.composerInner,Tt.desktopOverrides.composerInner];let t;t=this.state.isSmallHeightView?this.props.quotedMessages?[Tt.expandableAreaWithQuote,Tt.desktopOverrides.expandableAreaWithQuoteSmallView]:[Tt.expandableArea,Tt.desktopOverrides.expandableAreaSmallView]:this.props.quotedMessages?[Tt.expandableAreaWithQuote,Tt.desktopOverrides.expandableAreaWithQuote]:[Tt.expandableArea,Tt.desktopOverrides.expandableArea];const s=[Je.default.flexOne,Tt.desktopOverrides.messageComposer];this._themeStyles.messageComposerBackgroundStyle&&s.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop?s.push(Tt.desktopOverrides.messageComposerTopFlatCorners):s.push(Tt.desktopOverrides.messageComposerAllRoundCorners);const i=this._renderQuote(),r=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,!!i),a=this._getRightIcon()||this._getMediaBar(!0),l=[Tt.rightControlContainer,Tt.desktopOverrides.rightControlContainer],d=(0,o.jsx)(n.View,{style:s,importantForAccessibility:n.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0,children:(0,o.jsx)(n.Animated.View,{style:this._inputAreaHeightStyle,children:(0,o.jsxs)(n.View,{style:[Tt.compositionAreaContainer,Tt.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea,children:[i&&i.component,this._getMediaPreviewPanel(),(0,o.jsxs)(n.View,{style:e,children:[this._getEmoticonPickerItem(),(0,o.jsxs)(n.View,{style:[Tt.compositionArea,this.state.enableReplyMessageUnifiedUI?Tt.desktopOverrides.compositionAreaRedesign:Tt.desktopOverrides.compositionArea],children:[this._renderEmoteAuthor(),r]})]})]},"composition")})});return(0,o.jsxs)(n.View,{style:Tt.composerArea,children:[(0,o.jsxs)(n.View,{style:Je.default.flexOne,children:[this._renderSmsInfoLine(),this._renderPesPicker(),d]}),(0,o.jsx)(n.View,{style:l,children:a})]})}_getRightIcon(){const e=Xe.IconSize.size20;let t;if(this._canCancelEdit(this.state,this.state.rawEditedMessage)){const s=[Tt.actionButtonWithBackground,Tt.actionButtonVerticalCenter,this._themeStyles.buttonBackgroundColorStyle];return t=this._themeStyles.buttonBackgroundHoverColorStyle,(0,o.jsx)(Y.default,{title:ae.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:s,hoverStyle:t,icon:Xe.SkypeIcon.Cancel})}if(this._sendControlEnabled(this.props,this.state,this._hasQuotes())){const t=this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&r.isEmpty(this.state.inputEntities);return t||mt.MessageComposerSendButtonTelemetry.activeAndTryTrack(),(0,o.jsx)(h.default,{title:ae.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:h.ActionButtonSize.Small,iconSize:e,style:Tt.sendButton,icon:Xe.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:t})}mt.MessageComposerSendButtonTelemetry.inactive()}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return(0,o.jsx)(ge.default,{conversationId:this.props.conversationId})}_renderPesPicker(){if(this.state.isShowingUnifiedPesPickerDesktop)return(0,o.jsxs)(n.View,{children:[(0,o.jsx)(U.default,{availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery,showCategorySwitcher:!0}),this._renderPesPickerPopup()]})}_getTextForSms(e){return`${this.state.quoteTextForSms}${te.getRawText(e)}`}_renderSmsInfoLine(){if(this.state.enableOnewaySms)return(0,o.jsx)(ze.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_renderEmoteAuthor(){const e=r.head(this.state.inputEntities);if(this.props.editedMessage&&e&&e instanceof ee.EmoteEntity){const t=[Tt.emoteAuthor.text];t.push(Tt.emoteAuthor.textDesktop),t.push(this._themeStyles.primaryTextColorStyle);const s=e.fallbackText.trim();return(0,o.jsx)(n.View,{children:(0,o.jsx)(n.Text,{style:t,children:s+"…"})})}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?ae.getString("MessageComposer.SmsMessagePlaceholderText"):ae.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t=!1){const s=[Tt.sharedInputAndMirror,this._themeStyles.primaryTextColorStyle],i=[Tt.sharedInputAndMirror,this._themeStyles.primaryTextColorStyle],r=[te.renderReact(this.state.inputEntities,{defaultStyle:Tt.entityText,atMentionStyle:this._useDarkTheme()?Tt.atMentionTextDark:Tt.atMentionText}),(0,o.jsx)(n.Text,{children:" "},"break")];if(i.push(Tt.mirrorText),i.push(n.Styles.createViewStyle({top:-this.state.offsetTop},!1)),s.push(Tt.textInput),this.state.messageStreamFontSize!==Te.MessageStreamFontSize.Normal){const e=Ce.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e),i.push(e)}const a=this.state.selectedMediaBarItem===he.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===he.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===he.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===he.MediaBarItemKeys.Sticker?(0,o.jsx)(n.Button,{style:Tt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:n.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=t?"":this._getDefaultPlaceholderText();const l=[Tt.textInputContainer],d=(0,o.jsxs)(n.View,{style:l,children:[(0,o.jsx)(n.TextInput,{ref:this._onTextInputRef,autoCorrect:!0,style:s,value:te.getRawText(this.state.inputEntities),maxLength:this.props.maxLength,multiline:!0,onChangeText:this._onInput,onKeyPress:this._onKeyPress,onSelectionChange:this._onSelectionChanged,onFocus:this._onFocus,onBlur:this._onBlur,onScroll:this._onScroll,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.textSecondary,keyboardAppearance:this._useDarkTheme()?"dark":"default",autoCapitalize:"sentences",editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,clearButtonMode:"never"}),a]});return(0,o.jsx)(n.View,{style:Tt.inputArea,children:(0,o.jsx)(n.Animated.View,{style:[...e],children:(0,o.jsxs)(n.View,{style:Je.default.flexOne,children:[(0,o.jsx)(n.Text,{style:i,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,textBreakStrategy:"simple",children:r}),d]})})})}_stopComposing(){this._startComposingThrottled.cancel(),this._stopComposingDebounced.cancel(),this._isComposing&&(this._isComposing=!1,Ze.default.setComposingState(!1,this.props.conversationId))}_clearTextInput(e=!0){this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit(),e&&B.default.clearMessageInput(this.props.conversationId),this._stopComposing(),this._debounceNewTextBeforeInsertionChanged("",[]),this.isComponentMounted()&&this.setState({inputEntities:[]})}_handleEnterCombinations(e){const t=e.ctrlKey||e.altKey||e.shiftKey;this.state.sendMessageWithEnterEnabled?t?e.shiftKey||this._startNewLine():(e.stopPropagation(),e.preventDefault(),this._sendMessage()):t&&(e.stopPropagation(),e.preventDefault(),this._sendMessage())}_startNewLine(){const e=this._textInputRef;if(e){const t=e.getSelectionRange();this.replaceText(t.end-t.start,"\n","",new ee.UnhandledEntity("\n"))}}_updateInputEntities(e,t,s=-1,i=void 0){const o=[];let n=0,a=0,l=0,d=t;for(s>=0&&(d=d.substring(0,s));l<e.length;){const t=e[l],s=t.text();if(0===d.indexOf(s))this._appendEntityToList(o,r.cloneDeep(t)),d=d.substring(s.length),n+=s.length,l++;else{let t=!1;const s=this._shortenAtMentionEntity(e,l,d);if(s)this._appendEntityToList(o,s.shortenedEntity),d=s.remainingText,a=-s.shortenAmount,t=!0,l++;else{let s=l;for(;s<e.length;){const i=te.getRawText(e,{startIndex:s}),r=d.indexOf(i);if(r>=0){r>0&&(this._appendEntityToList(o,new ee.UnhandledEntity(d.substring(0,r))),n+=r,d=d.substring(r)),t=!0,l=s;break}s++}}if(!t)break}}if(d&&(this._appendEntityToList(o,new ee.UnhandledEntity(d)),n+=d.length),n===s&&(i&&(o.push(i),n+=i.text().length),d=t.substring(n),d)){for(;l<e.length;){const t=te.getRawText(e,{startIndex:l}),s=d.indexOf(t);if(0===s){this._appendEntityToList(o,e[l]);const t=e[l].text().length;n+=t,d=d.substring(t),l++}else{if(!(s>0))break;this._appendEntityToList(o,new ee.UnhandledEntity(d.substring(0,s))),n+=s,d=d.substring(s)}}d&&this._appendEntityToList(o,new ee.UnhandledEntity(d))}return{newEntities:o,insertionAdjustment:a}}_appendEntityToList(e,t){const s=r.last(e);if(s instanceof ee.UnhandledEntity&&t instanceof ee.UnhandledEntity){const i=t.text(),o=e.length>1&&e[e.length-2]instanceof ee.AtMentionEntity;" "===s.text()&&o&&vt.test(i)?e.splice(e.length-1,1,t):s.appendText(i)}else e.push(t)}_shortenAtMentionEntity(e,t,s){let i=0,o=s;if(!(e[t]instanceof ee.AtMentionEntity))return;const n=e[t];if(!n.shortName||!n.displayName)return;if(e[t].text().length<n.displayName.length)return;let r=s.length;if(t<e.length-1){const i=te.getRawText(e,{startIndex:t+1});if(r=s.indexOf(i),r<0)return;if(o=s.substring(0,r),o.length>=n.displayName.length)return}if(0===o.indexOf(n.shortName)){i=r-n.shortName.length;return{shortenedEntity:n.clone(n.shortName),remainingText:s.substring(o.length),shortenAmount:i}}}_getEmoticonPickerItem(){if(this.props.hideEmoticonKeyboardIcon||P.isPhoneMri(this.props.conversationId)||P.isS4BBridgeMri(this.props.conversationId))return;const e=this.state.isShowingUnifiedPesPickerDesktop,t=this._onUnifiedPesPickerDesktopPress,s={id:he.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:e,onActive:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.primaryTextColor,hoverColorOverride:this._themeColors.secondaryTextColor,iconStyleOverride:void 0,showCategorySwitcher:!1,disabled:this.props.disableActionOnMessageComposer,origin:ue.MediaBarItemOrigin.MessageComposer,ref:e=>{g.default.setAnchor(m.EngagementTooltipType.ExpressionPicker,e)}};return(0,o.jsx)(n.View,{style:Tt.desktopOverrides.composerInnerIconWrapper,children:(0,o.jsx)(q.ExpressionPickerItem,Object.assign({},s))})}_hasQuotes(){return!r.isEmpty(this.props.quotedMessages)}_mediaBarItemDescriptor(e){switch(e){case he.MediaBarItemKeys.Emoticon:const t={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:!1};return{id:e,render:this._renderEmoticonPickerItem,propOverrides:t};case he.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem};case he.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,disabled:this.state.disableHighBandwidthOperations};case he.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,disabled:this.state.disableHighBandwidthOperations};case he.MediaBarItemKeys.MagicBotToolbox:return{id:e,render:this._renderMagicToolboxItem};case he.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,disabled:this.state.disableHighBandwidthOperations};case he.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem};case he.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem};case he.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,disabled:this.state.disableHighBandwidthOperations};case he.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem};case he.MediaBarItemKeys.Bing:const s={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,propOverrides:s};case he.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,disabled:this.state.disableHighBandwidthOperations};case he.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem};case he.MediaBarItemKeys.Audio:const i={onPress:this.props.onRecording};return{id:e,render:this._renderAudioMessageItem,propOverrides:i};case he.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:Ve.SendCreditItem.getVirtualKeyboard}}se.warn(K.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowBingButton(){return this._showBingButton(this.state)}_canShowMagicBotToolboxButton(){return this._showMagicBotToolboxButton(this.state)}_canShowSmsIcon(){return!1}_canShowEmoticonIcon(){return!this.props.hideEmoticonKeyboardIcon}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,i=r.map(e,(e=>{switch(e){case he.MediaBarItemKeys.Bing:if(this._canShowBingButton())return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.MagicBotToolbox:if(this._canShowMagicBotToolboxButton())return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Emoticon:if(this._canShowEmoticonIcon())return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&t)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.MediaPicker:if(!this.props.hideMediaPickerIcon&&!s&&t)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case he.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.Audio:if(this._canShowMicButton(this.props,this.state))return this._mediaBarItemDescriptor(e);break;case he.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return r.compact(i)}_canShowMicButton(e,t){return!(e.hideAudioMessage||!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations)}_getOverflowItemDescriptors(){const e=r.map(this.state.mediaBarMenuOrder,(e=>e)),t=this._getItemDescriptors(r.flatten(e),!0);return r.slice(t,this.state.currentNumberOfIconsInMediaBar)}_getMediaBarItemDescriptors(){if(this.props.hideMediaBar||this._isMediabarDisabled())return[];const e=this._getItemDescriptors(this.state.mediaBarMenuOrder,!0);return r.slice(e,0,this.state.currentNumberOfIconsInMediaBar)}_getMediaBar(e=!0){if(this._getRightIcon()||this.state.isShowingUnifiedPesPickerDesktop)return;const t=this._getMediaBarItemDescriptors();let s;if(this.state.isEncryptedThreadThread||(s=(0,o.jsx)(x.default,{overflowConfig:this.getOverflowConfig(),otherPartyMri:this.props.otherPartyMri,conversationId:this.props.conversationId,onOverflowButtonPress:this._onComposerOverflowPress,icon:void 0})),t.length>0){const i=!1;return(0,o.jsxs)(n.View,{style:Tt.mediaBarWrapper,children:[(0,o.jsx)(de.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:!1,showIcons:e,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight}),s]})}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Ge.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()&&this._animateInputAreaToTargetHeight()})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!r.isEmpty(t.inputEntities)||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews}_canCancelEdit(e,t){return!!t&&(t===this._inputAreaText||r.isEmpty(e.inputEntities))}replaceText(e,t,s,i){const o=this._textInputRef;if(o){const s=o.getSelectionRange(),n=this._inputAreaText;let a=n.substring(0,s.end-e)+t;s.end<n.length&&(a+=n.substring(s.end));const l=this._updateInputEntities(this.state.inputEntities,a,s.end-e,i);this._inputAreaText=a,o.setValue(a);const d=s.end+t.length-e+l.insertionAdjustment;this.isComponentMounted()&&this.setState({inputEntities:l.newEntities}),o.requestFocus(),this._currentSelectionStart!==d&&(this._afterNextOnInput=()=>{this._currentSelectionStart=d,this._currentSelectionEnd=d,o.selectRange(d,d)}),r.defer(this._debounceNewTextBeforeInsertionChanged,"",l.newEntities)}}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=_e.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,editableEntities:t})}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=_e.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t)}_sendFileWithDimensions(e,t){const s=Ye.default.getFileUrl(e);l.default.getImageSize(s).then((s=>{if(s&&(e.dimensions=s),this.state.isMediaPreviewEnabled)return me.default.addPreviews([e],this.props.conversationId,t);const i={name:Ee.ScenarioName.SendPicture};Be.default.postUpload([this.props.conversationId],e,t,!1,{scenarioInfo:i},this._getRootViewType())}))}_preventSendingSMSMessage(e){if(se.log(K.LogTraceArea.MessageComposer,"[MessageComposerAndroidBrowser] _preventSendingSMSMessage"),this.state.shouldPreventSMSTotheUS||this.state.shouldPreventSMSToNotSupportedDestination){const e=this.state.shouldPreventSMSToNotSupportedDestination?K.CantSendSmsWarningType.NotSupportedDestination:K.CantSendSmsWarningType.US;return se.log(K.LogTraceArea.MessageComposer,`[MessageComposerAndroidBrowser] _preventSendingSMSMessage preventing sending SMS to ${K.CantSendSmsWarningType[e]}`),ke.default.navigateToCantSendSMSWarning(e),!0}return this.state.shouldPreventSMSToInvalidNumber?(ke.default.navigateToCantSendSMSWarning(K.CantSendSmsWarningType.InvalidNumber),!0):!!(1===e.length&&e[0]instanceof ee.SmsEntity&&(se.log(K.LogTraceArea.MessageComposer,"[MessageComposerAndroidBrowser] _preventSendingSMSMessage preventing sending SMS"),this._smsInfoLineRef&&!this._smsInfoLineRef.canSendSMS()))&&(this.state.isSmsFailureScreenEnabled?ke.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):y.default.open(this._getRootViewId()),!0)}_sendMessage(){return i.__awaiter(this,void 0,void 0,(function*(){if(se.log(K.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;if(!(yield(0,lt.canSendMessageToMagicBot)(this.state.inputEntities,this.state.isMagicBotConversation)))return void this.dismissKeyboard();this._isPostingMessage=!0;const e=tt.default.newCauseId();se.log(K.LogTraceArea.MessageComposer,"sendMessage causeId: "+e);let t=[],s=0;if(this.props.quotedMessages&&(t=t.concat(this.props.quotedMessages.map(this._getQuoteEntity)),s=t.length),this.state.inputEntities.length>0&&(t=t.concat(this.state.inputEntities)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!r.isEmpty(this.state.inputEntities)){if(t=[new ee.SmsEntity(this._getTextForSms(this.state.inputEntities),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(t))return se.log(K.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),this._isPostingMessage=!1,void se.track(new _t.SmsSendStatus(_t.OneWaySmsAction.SmsCheckedAndStopped,this._smsDestinationType));se.track(new _t.SmsSendStatus(_t.OneWaySmsAction.SmsCheckedAndSent,this._smsDestinationType))}try{const i=(0,lt.isMagicBotMentioned)(t);!i||this.state.isOneOnOneConversation||this.state.isMagicBotContainingConversation||(yield dt.default.serviceAddMemberToThread(this.props.conversationId,(0,it.getMagicBotId)(),ct.AddMemberToThreadSource.BotAutoAdd,!(0,Ie.isModerated)(this.state.conversation)),se.log(K.LogTraceArea.MessageComposer,"sendMessage Magic bot auto-added to conversation because being mentioned."),se.track(new ot.MagicBotAutoAddedByMention));const o=i&&this.state.enableMagicBot&&this.state.isOneOnOneConversation&&!this.state.isMagicBotConversation;if(this._needsContext(i)&&!(0,ut.isUserInputEmptyOrHasWhitespaceOnly)(t)){const e=yield(0,rt.getContext)(!this.state.isOneOnOneConversation||o,this.state.conversation);t.push(e)}this._sendOneOnOneMagicBotMessageIfNeeded(o,t),yield me.default.sendPreviews(this.props.conversationId,e),s>1?u.all(t.map((e=>this._sendTextMessagePromise([e])))).finally((()=>{this._isPostingMessage=!1})):this._sendTextMessagePromise(t).finally((()=>{this._isPostingMessage=!1}))}finally{this._isPostingMessage=!1,this.state.hasFocus||this.requestFocus()}}))}_needsContext(e){return this.state.enableMagicBot&&nt.AIConsentService.getConsent()&&(e||this.state.isMagicBotConversation)}_sendTextMessagePromise(e){const t={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:e,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};return bt._sendTextMessage(t).then((e=>{if(e){if(this._handleAfterPostMessage(t.conversationId),se.log(K.LogTraceArea.MessageComposer,"sendMessage Message sent."),t.smsInfoLineRef){const e=t.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else se.log(K.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}))}static _sendTextMessage(e){if((0,ut.isUserInputEmptyOrHasWhitespaceOnly)(e.inputEntities))return e.inputEntities.length?se.log(K.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):se.log(K.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),u.Resolved(!1);if(e.onMessageSent(e.inputEntities,fe.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType))){const t=e.editedMessage?ae.getString("MessageComposer.MessageEditedLabel"):ae.getString("MessageComposer.MessageSentLabel");return bt._announceForAccessibility(t),u.Resolved(!0)}return u.Resolved(!1)}static _announceForAccessibility(e){Ue.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(B.default.getSavedMessageInput(e)&&(0,F.default)().fakeConversationTime(e,Date.now()),B.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this._stopComposing(),this._inputAreaText="",this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();ce.MediaBarItem.dismissPopup(e),O.default.close(e)}this._isPostingMessage=!1}_shouldAutoFocusInput(){return this._getRootViewId()!==A.MainRootViewId}_isMediabarDisabled(){return P.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}_announceForAccessibility(e){Ue.default.maybeAnnounceForAccessibility(e,0)}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return u.Resolved(this.state.inputEntities)}getOverflowConfig(){return this._overflowActions()}}t.default=bt},37308:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerBase=void 0;const i=s(197582),o=s(785893),n=s(167606),r=i.__importDefault(s(150343)),a=i.__importDefault(s(497910)),l=s(854642),d=s(82485),c=i.__importDefault(s(742631)),u=s(412955),h=i.__importStar(s(7040)),p=i.__importStar(s(44717)),g=i.__importDefault(s(863132)),m=i.__importDefault(s(114818)),S=i.__importDefault(s(677750)),_=s(493680),f=i.__importDefault(s(524388)),y=s(291498),v=s(181541),C=s(470177),T=i.__importDefault(s(245331)),M=s(618629);class b extends a.default{constructor(){super(...arguments),this._renderMagicToolboxItem=e=>{const t=this.state.isOneOnOneConversation?C.MagicBotToolboxTarget.OneToOne:C.MagicBotToolboxTarget.BingGroup;return(0,o.jsx)(v.MagicBotToolboxItem,Object.assign({},e,{target:t,ref:e.ref}))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),(0,m.default)(t.inputEntities,this.state.inputEntities)||S.default.setShouldShowToneSuggestionsForConversation(this.props.conversationId,(0,_.isToneRewriteEligibleInput)(this.state.inputEntities))}componentDidMount(){super.componentDidMount(),this._requestFocusSubscriptionToken=(0,M.subscribeToMessageComposerFocusRequest)(this.requestFocus)}componentWillUnmount(){super.componentWillUnmount(),this._requestFocusSubscriptionToken&&(this._requestFocusSubscriptionToken.unsubscribe(),this._requestFocusSubscriptionToken=void 0)}_buildState(e,t){const s=f.default.isMagicBotEnabled(e.conversationId),{enableAlwaysVisibleMagicBotToolboxGroups:i,enableImageCreator:o}=r.default.getS4LMessagingFeatures();return{isMagicBotEnabledOneOnOneConversation:s,enableAlwaysVisibleMagicBotToolboxGroups:i,enableImageCreator:o}}_shouldShowAIButton(e){return e.enableMagicBot&&!p.isAgent(e.conversation.id)&&!e.isMagicBotConversation}_showBingButton(e){return!1}_showMagicBotToolboxButton(e){return this._shouldShowAIButton(e)}_mediaBarMenuOrder(e){let t=[...e];return T.default.isSkypeClipsRecordingEnabled()||(t=t.filter((e=>e!==y.MediaBarItemKeys.SkypeClipsRecord))),r.default.getS4LWhiteboardFeatures().enableSkypeWhiteboard&&(t=[...t,y.MediaBarItemKeys.Whiteboard]),t}_showMagicBotToolboxInsteadOfBing(e,t){return!!e&&(p.isOneOnOneConversation(e.id)||t||!(0,_.isMagicBotContainingConversation)(e))}_sendOneOnOneMagicBotMessageIfNeeded(e,t){if(e){const e=this.state.conversation.getOtherPartyMri();if(e){if(!this.state.isMagicBotEnabledOneOnOneConversation){d.Instrumentation.log(n.LogTraceArea.MessageComposer,"sendMessage Bing was disabled, enabling it because Magic Bot was mentioned."),d.Instrumentation.track(new l.MagicBotOneOnOneToggle(l.MagicBotOneOnOneToggleOrigin.Message,!0));const e=(0,u.setMagicBotEnabled)(this.state.conversation.id,!0);e&&g.default.postMessage(e)}d.Instrumentation.log(n.LogTraceArea.MessageComposer,"sendMessage Sent message to Magic Bot one on one service because it was mentioned."),d.Instrumentation.track(new l.MagicBotOneOnOneMessageSent),c.default.sendOneOnOne(e,h.encode(t,!1))}}}}t.MessageComposerBase=b},367704:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflow=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(54720)),d=i.__importDefault(s(699775)),c=i.__importDefault(s(135372)),u=i.__importDefault(s(633958)),h=s(154235),p=i.__importDefault(s(186325)),g=s(815146),m=i.__importDefault(s(417988)),S=i.__importDefault(s(905786)),_=i.__importStar(s(85385)),f=i.__importDefault(s(311227)),y=s(26703),v=i.__importStar(s(704704)),C=s(291498),T=i.__importDefault(s(868130)),M=i.__importDefault(s(678968)),b=s(106333),I=i.__importDefault(s(427845)),w=i.__importDefault(s(117475)),P=(i.__importDefault(s(421334)),s(375258)),k=i.__importDefault(s(842252)),A=s(16549),x=s(641400),D=s(331079),R=i.__importDefault(s(827361)),L=i.__importDefault(s(497910)),B=i.__importDefault(s(337249));var F;!function(e){e[e.Yes=0]="Yes",e[e.No=1]="No",e[e.Maybe=2]="Maybe"}(F||(F={}));const N=(0,y.lazyProperties)({container:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,backgroundColor:A.Color.transparent}),containerStaticHeight:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,bottom:0,backgroundColor:A.Color.transparent}),containerHidden:()=>r.Styles.createViewStyle({opacity:0}),contentContainer:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,top:0,borderTopLeftRadius:h.CustomActionSheetBorderRadius,borderTopRightRadius:h.CustomActionSheetBorderRadius,flexDirection:"column-reverse"}),contentContainerStaticHeight:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,borderTopLeftRadius:h.CustomActionSheetBorderRadius,borderTopRightRadius:h.CustomActionSheetBorderRadius,flexDirection:"column-reverse"}),backgroundContainer:()=>R.default.absoluteFill,background:()=>r.Styles.createViewStyle({flex:1,backgroundColor:A.Color.blackOverlay50}),scrollView:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),content:()=>r.Styles.createViewStyle({alignSelf:"stretch",paddingTop:0}),divider:()=>r.Styles.createViewStyle({marginBottom:5}),headerShadow:()=>r.Styles.createViewStyle({left:0,right:0,height:1,marginBottom:-1})});class E extends L.default{constructor(){super(...arguments),this._gestureInterest=F.Maybe,this._isDragging=!1,this._contentTransform=0,this._headerOpacityValue=new r.Animated.Value(0),this._headerOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._headerOpacityValue}),this._backgroundOpacityValue=new r.Animated.Value(0),this._backgroundOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._backgroundOpacityValue}),this._contentContainerTransformValue=new r.Animated.Value(r.UserInterface.measureWindow().height),this._contentContainerTransformStyle=r.Styles.createAnimatedViewStyle({transform:[{translateY:this._contentContainerTransformValue}]}),this._headerTopValue=new r.Animated.Value(0),this._headerTopStyle=r.Styles.createAnimatedViewStyle({height:this._headerTopValue}),this._containerHeightValue=new r.Animated.Value(0),this._containerHeightStyle=r.Styles.createAnimatedViewStyle({height:this._containerHeightValue}),this._onHeaderRef=e=>{this._headerView=e||void 0},this._onBackButtonPressed=()=>(this._handleOnDismissCallback(),_.log(g.LogTraceArea.HardwareBackButton,"goBack: true componentId: MessageComposerOverflow"),!0),this._onLayoutChanged=e=>{const t=B.default.measureWindow(this._getRootViewId()),s=n.clone(t);this.state.viewDimensions.height===s.height&&this.state.viewDimensions.width===s.width||this.setState({viewDimensions:s,responsiveWidth:I.default.responsiveWidthForSize(t.width)})},this._onScroll=(e,t)=>{if(!this.isComponentMounted())return;const s=e<=1;s!==this.state.isScrolledToTop&&this.setState({isScrolledToTop:s})},this._onPan=e=>{this._gestureInterest=F.No,e.isComplete&&(this._gestureInterest=F.Maybe,this._isDragging=!1)},this._onPanVertical=e=>{this._gestureInterest===F.Maybe&&(this._gestureInterest=F.Yes);let t=0;if(this._gestureInterest===F.Yes){t=e.pageY-e.initialPageY;let s=this._contentTransform+t;if(s<0&&(s=0),this._contentContainerTransformValue.setValue(s),this.state.statusBarPadding){const e=s/(this.state.viewDimensions.height*this._sheetOffset()),t=this._mapVal(e,this.state.statusBarPadding,0);this._headerTopValue.setValue(t)}this._isDragging||(this._isDragging=!0)}if(e.isComplete){this._contentTransform+=t,this._gestureInterest=F.Maybe;const s=this.state.viewDimensions.height*this._sheetOffset();if(e.velocityY>.1&&this._contentTransform>=s&&this._onDismissCallback)this._handleOnDismissCallback();else{let t=!1;e.velocityY<-.1?t=this.state.expandEnabled:e.velocityY<.1&&(t=this.state.expandEnabled&&this._contentTransform<s),this._expandOrCollapse(t)}}},this._onBlur=()=>{this.state.config&&this.state.config.onBlur&&this.state.config.onBlur(),this._handleOnDismissCallback()},this._onFindComplete=()=>{this.props.onFindComplete&&this.props.onFindComplete(),this._handleOnDismissCallback(),this.props.findPerfScenario&&this.props.findPerfScenario.hasStarted()&&!this.props.findPerfScenario.isResolved()&&this.props.findPerfScenario.finish()},this._onWebViewClose=()=>{this.props.onWebViewClose&&this.props.onWebViewClose(),this._handleOnDismissCallback()},this._onCloseButtonClick=()=>{_.track(new b.MessageOverflowEvent(b.MessageOverflowAction.MessageOverflowCloseButtonClicked)),this._handleOnDismissCallback()},this._onCustomAction=(e,t)=>{if(e===D.MediaBarCustomAction.LaunchSearch){const e=d.default.getSearch();if(e){const t=f.default.transform(e,"");S.default.openIntegration(t,this.props.conversationId,this._getContext(),this._onFindComplete,this._onWebViewClose,void 0)}}else this.state.config&&this.state.config.onCustomAction&&this.state.config.onCustomAction(e,t)},this._onMoveShouldSetResponder=e=>(e.preventDefault(),e.stopPropagation(),!1),this._onScrollViewRef=e=>{this._scrollView=e||void 0}}_buildState(e,t){const s=a.default.getS4LIntegrationsFeatures().findPanelLayout,i={statusBarPadding:w.default.statusBarPadding(),bingSearch:d.default.getSearch(),expandEnabled:!1,safeAreaHorizontalPaddingStyle:w.default.horizontalPaddingStyle(),safeAreaHorizontalInsets:w.default.horizontalInsets(),useOverflowMenuGrid:a.default.getS4LMessagingFeatures().enableOverflowMenuGrid,includeOverflowMenuInFindPanel:s&&s.isFlatList&&s.includeMediaBarItemsInFlatList};if(t){i.hidden=!0,i.isHiding=!1,i.isExpanded=!1,i.isScrolledToTop=!0;const e=B.default.measureWindow(this._getRootViewId());i.viewDimensions={height:e.height,width:e.width},i.responsiveWidth=I.default.responsiveWidthForSize(e.width),i.config=void 0,i.shouldRenderFindPanel=!1}return i}componentDidMount(){super.componentDidMount(),this._containerHeightValue.setValue(this.state.viewDimensions.height)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.hidden!==t.hidden&&(this.state.hidden?(this._dismissContent(!0),l.default.unsubscribe(this._onBackButtonPressed)):(this._presentContent(!0),l.default.subscribe(this._onBackButtonPressed))),this.state.viewDimensions.height===t.viewDimensions.height&&this.state.statusBarPadding===t.statusBarPadding||(this._containerHeightValue.setValue(this.state.viewDimensions.height),this.state.hidden||this._expandOrCollapse(this.state.isExpanded,!0)),this.state.isScrolledToTop!==t.isScrolledToTop&&k.default.easeOut({value:this._headerOpacityValue,toValue:this.state.isScrolledToTop?0:1,useNativeDriver:!0}).start()}showOrHide(e,t,s,i){if(this._onDismissCallback=s,this.isComponentMounted()){const s=!e;this.state.hidden!==s&&(c.default.setCoachMarkEnabled(s),this.setState({hidden:s,config:t,isHiding:s},i))}}_mapVal(e,t,s){return t+(s-t)*e}_presentContent(e){this._expandOrCollapse(!1,e,(()=>{this.isComponentMounted()&&(this._headerView&&this._headerView.requestFocus(),this.setState({shouldRenderFindPanel:!0}))}))}_dismissContent(e){const t=()=>{this._scrollView&&this._scrollView.setScrollTop(0,!1),this.isComponentMounted()&&this.state.hidden&&this.state.isHiding&&this.setState({isHiding:!1,isScrolledToTop:!0,shouldRenderFindPanel:this.state.shouldRenderFindPanel})},s=this.state.expandEnabled?this.state.viewDimensions.height:this.state.viewDimensions.height*(1-this._sheetOffset());e?r.Animated.parallel([k.default.easeOut({value:this._backgroundOpacityValue,toValue:0,useNativeDriver:!0}),k.default.easeOut({value:this._contentContainerTransformValue,toValue:s,useNativeDriver:!0})]).start(t):(this._backgroundOpacityValue.setValue(0),this._contentContainerTransformValue.setValue(s),this._headerTopValue.setValue(0),t())}_expandOrCollapse(e,t=!0,s){if(0===this.state.viewDimensions.height)return;const i=e||!this.state.expandEnabled?0:this.state.viewDimensions.height*this._sheetOffset(),o=e?this.state.statusBarPadding:0,n=()=>{this.isComponentMounted()&&this.setState({isExpanded:e,shouldRenderFindPanel:!0}),s&&s(),this._isDragging=!1};t?(r.Animated.parallel([k.default.easeOut({value:this._backgroundOpacityValue,toValue:1,useNativeDriver:!0}),k.default.easeOut({value:this._contentContainerTransformValue,toValue:i,useNativeDriver:!0})]).start(n),k.default.easeOut({value:this._headerTopValue,toValue:o}).start()):(this._backgroundOpacityValue.setValue(1),this._contentContainerTransformValue.setValue(i),this._headerTopValue.setValue(o),n()),this._contentTransform=i}_sheetOffset(){let e=.5;return this.state.viewDimensions.width>this.state.viewDimensions.height?e=.9:this.state.expandEnabled?this.state.useOverflowMenuGrid&&(e=.6):e=.7,1-e}_handleOnDismissCallback(){this._onDismissCallback&&!this.state.hidden&&this._onDismissCallback()}_renderOverflowItems(){if(!this.state.viewDimensions.width||!this.state.config||this.state.includeOverflowMenuInFindPanel)return;const e=n.filter(this.state.config.mediaBarItems,(e=>e.id!==C.MediaBarItemKeys.Bing||!!this.state.bingSearch)),t={height:this.state.viewDimensions.height,width:this.state.viewDimensions.width-this.state.safeAreaHorizontalInsets.left-this.state.safeAreaHorizontalInsets.right},s={menuItems:e,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,responsiveWidth:this.state.responsiveWidth,onItemSelected:this.state.config.onItemSelected,onCustomAction:this._onCustomAction,onFocus:this.state.config.onFocus,onBlur:this._onBlur,viewDimensions:t};return this.state.useOverflowMenuGrid?(0,o.jsx)(M.default,Object.assign({},s)):(0,o.jsx)(T.default,Object.assign({},s))}render(){const e=this.state.hidden&&!this.state.isHiding,t=this.state.shouldRenderFindPanel?(0,o.jsx)(m.default,{conversationId:this.props.conversationId,isActive:!e,isInline:!0,hideAddInsTitle:!0,perfScenario:this.props.findPerfScenario,onFindComplete:this._onFindComplete,onWebViewClose:this._onWebViewClose,overflowActionConfig:this.state.config}):void 0,s=[N.content];this.state.safeAreaHorizontalPaddingStyle&&s.push(this.state.safeAreaHorizontalPaddingStyle);const i=this._renderOverflowItems(),n=this.state.includeOverflowMenuInFindPanel?void 0:(0,o.jsx)(p.default,{style:N.divider,marginLeft:20,marginRight:20}),a={ref:this._onScrollViewRef,style:N.scrollView,scrollEventThrottle:32,scrollEnabled:!this.state.expandEnabled||this.state.isExpanded,bounces:!1,onScroll:this._onScroll,onMoveShouldSetResponder:this._onMoveShouldSetResponder},l=(0,o.jsx)(r.ScrollView,Object.assign({},a,{children:(0,o.jsxs)(r.GestureView,{style:s,onPanVertical:!this.state.expandEnabled||this.state.isExpanded&&!this.state.isScrolledToTop?this._onPan:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:r.Types.ImportantForAccessibility.No,children:[i,n,t]})})),d={icon:x.SkypeIcon.ClosePanel,onPress:this._onCloseButtonClick,title:v.getString("Global.CloseButtonTitle")},c=(0,o.jsx)(r.GestureView,{onPanVertical:this._onPanVertical,panPixelThreshold:20,releaseOnRequest:!1,importantForAccessibility:r.Types.ImportantForAccessibility.No,children:(0,o.jsx)(P.SimplePanelHeader,{ref:this._onHeaderRef,panelName:v.getString("MessageComposerOverflow.AddTitle"),leftButton:d,hideBottomBorder:!0,dontFocusOnMount:!0})}),h=[this.state.expandEnabled?N.contentContainer:N.contentContainerStaticHeight,this._contentContainerTransformStyle,this._themeStyles.primaryBackgroundColorStyle];let g;this.state.expandEnabled||h.push(r.Styles.createViewStyle({height:this.state.viewDimensions.height*(1-this._sheetOffset())},!1)),g=e?[N.containerHidden]:this.state.expandEnabled?[N.container,this._containerHeightStyle]:[N.containerStaticHeight];const S=e?r.Types.ImportantForAccessibility.NoHideDescendants:r.Types.ImportantForAccessibility.No,_=e?void 0:(0,o.jsx)(r.Button,{style:N.backgroundContainer,onPress:this._onDismissCallback,disableTouchOpacityAnimation:!0,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants,children:(0,o.jsx)(r.Animated.View,{style:[N.background,this._backgroundOpacityStyle]})});return(0,o.jsx)(u.default,{isPresentedInMobileSheet:!0,children:(0,o.jsxs)(r.Animated.View,{style:g,blockPointerEvents:e,importantForAccessibility:S,onLayout:this._onLayoutChanged,children:[_,(0,o.jsxs)(r.Animated.View,{style:h,children:[l,(0,o.jsx)(r.Animated.View,{style:[N.headerShadow,this._themeStyles.headerShadowColorStyle,this._headerOpacityStyle]}),c,(0,o.jsx)(r.Animated.View,{style:this._headerTopStyle})]})]})})}}t.MessageComposerOverflow=E,t.default=E},868130:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflowCarousel=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(511548)),l=i.__importDefault(s(905786)),d=s(26703),c=s(997380),u=i.__importDefault(s(899185)),h=(0,d.lazyProperties)({overflowMenu:()=>r.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",marginBottom:5}),overflowMenuRTL:()=>r.Styles.createViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]})});class p extends a.default{_elementCount(){return this.props.menuItems.length}_height(){}_renderElements(e){if(!this.props.viewDimensions.width)return;const t=this.props.menuItems.length,s=l.default.columnWidthInfo(this.props.responsiveWidth,this.props.viewDimensions.width,0,0),i=t>s.columnCount,a=i?r.Styles.createViewStyle({width:Math.max(this.props.viewDimensions.width/(s.columnCount+.5),c.OverflowItemSizeInGridOrCarousel)},!1):s.columnWidthStyle;let d=n.map(this.props.menuItems,(e=>u.default.overflowItemForDescriptor(e,this.props,this._themeStyles,a)));const p=[h.overflowMenu];return i&&e&&(p.push(h.overflowMenuRTL),d=n.reverse(d)),{elements:(0,o.jsx)(r.View,{style:p,children:d}),useStaticContainer:!i}}}t.MessageComposerOverflowCarousel=p,t.default=p},678968:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerOverflowGrid=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(905786)),l=s(26703),d=i.__importDefault(s(899185)),c=i.__importDefault(s(497910)),u=(0,l.lazyProperties)({overflowMenu:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch"})});class h extends c.default{render(){if(!this.props.viewDimensions.width)return;const e=a.default.columnWidthInfo(this.props.responsiveWidth,this.props.viewDimensions.width,0,0).columnWidthStyle,t=n.map(this.props.menuItems,(t=>d.default.overflowItemForDescriptor(t,this.props,this._themeStyles,e)));return(0,o.jsx)(r.View,{style:u.overflowMenu,children:t})}}t.MessageComposerOverflowGrid=h,t.default=h},266862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(331654),a=s(815063),l=i.__importDefault(s(326036)),d=i.__importStar(s(994070)),c=i.__importStar(s(6625)),u=i.__importStar(s(516778)),h=i.__importStar(s(397691)),p=s(537180),g=i.__importStar(s(187140)),m=i.__importDefault(s(659938)),S=i.__importDefault(s(150343)),_=i.__importStar(s(603094)),f=i.__importDefault(s(438752)),y=s(22478),v=s(745709),C=i.__importDefault(s(838264)),T=i.__importDefault(s(879248)),M=s(148166),b=s(843890),I=i.__importDefault(s(859545)),w=(s(897704),i.__importStar(s(926101)),i.__importDefault(s(401189))),P=i.__importStar(s(172134)),k=i.__importStar(s(971988)),A=i.__importStar(s(44717)),x=i.__importDefault(s(631681)),D=i.__importDefault(s(135372)),R=s(315742),L=i.__importDefault(s(340724)),B=i.__importDefault(s(266311)),F=s(88942),N=i.__importStar(s(361971)),E=i.__importStar(s(559210)),O=i.__importDefault(s(892034)),U=i.__importDefault(s(615364)),V=i.__importStar(s(463519)),H=i.__importDefault(s(236041)),j=i.__importDefault(s(691821)),z=i.__importStar(s(170881)),W=i.__importDefault(s(601976)),G=s(472110),K=s(871145),q=i.__importDefault(s(794229)),Q=i.__importStar(s(242561)),X=i.__importDefault(s(37679)),$=s(815146),J=s(445290),Y=i.__importStar(s(640957)),Z=i.__importDefault(s(606617)),ee=s(268293),te=i.__importDefault(s(453761)),se=i.__importDefault(s(457468)),ie=i.__importStar(s(626065)),oe=i.__importStar(s(7040)),ne=i.__importStar(s(85385)),re=i.__importDefault(s(114818)),ae=i.__importDefault(s(214295)),le=i.__importDefault(s(97595)),de=i.__importDefault(s(54945)),ce=s(26703),ue=i.__importStar(s(440760)),he=i.__importStar(s(704704)),pe=i.__importDefault(s(978285)),ge=s(87780),me=s(750585),Se=s(985367),_e=i.__importStar(s(901156)),fe=i.__importDefault(s(791612)),ye=i.__importDefault(s(574818)),ve=i.__importStar(s(500983)),Ce=i.__importStar(s(187086)),Te=i.__importDefault(s(341126)),Me=i.__importStar(s(172792)),be=s(954225),Ie=i.__importStar(s(786531)),we=i.__importDefault(s(982323)),Pe=s(675862),ke=i.__importDefault(s(252089)),Ae=i.__importDefault(s(201721)),xe=i.__importDefault(s(740794)),De=i.__importDefault(s(942724)),Re=i.__importDefault(s(327400)),Le=s(54325),Be=i.__importStar(s(306194)),Fe=s(211625),Ne=s(943265),Ee=i.__importStar(s(548056)),Oe=s(137836),Ue=i.__importDefault(s(863132)),Ve=i.__importDefault(s(960282)),He=s(848523),je=s(96575),ze=s(617910),We=i.__importDefault(s(791384)),Ge=s(712783),Ke=i.__importDefault(s(160049)),qe=i.__importDefault(s(776622)),Qe=i.__importDefault(s(82133)),Xe=s(337288),$e=s(873008),Je=i.__importDefault(s(842252)),Ye=s(16549),Ze=i.__importDefault(s(139221)),et=i.__importDefault(s(20758)),tt=s(641400),st=s(331079),it=i.__importDefault(s(827361)),ot=i.__importDefault(s(48076)),nt=i.__importDefault(s(601274)),rt=i.__importDefault(s(220534)),at=i.__importDefault(s(719006)),lt=i.__importDefault(s(685734)),dt=i.__importDefault(s(760989)),ct=i.__importDefault(s(579067)),ut=i.__importDefault(s(92179)),ht=(i.__importDefault(s(450312)),s(717413)),pt=s(854642),gt=s(216678),mt=s(333434),St=i.__importDefault(s(843954)),_t=s(850725),ft=i.__importDefault(s(404547)),yt=s(627414),vt=s(681679),Ct=s(618629),Tt=s(37308),Mt=i.__importDefault(s(512299)),bt=s(796967),It=i.__importDefault(s(970035)),wt=s(384860),Pt=s(5540),kt=i.__importDefault(s(810033)),At=s(759714),xt=i.__importDefault(s(127336)),Dt=i.__importDefault(s(604266)),Rt=i.__importDefault(s(808164)),Lt=s(291498),Bt=Ye.Color.darkMessageComposerContentBackground,Ft=Ye.Color.gray400Overlay10,Nt=tt.IconSize.default,Et=tt.IconSize.default,Ot=Et-4,Ut=c.unicodeLetterRegex,Vt={instantTriggers:[`^(@[${Ut}-]{0,16} ?[${Ut}-]{0,16})$`,`.*\\W(@[${Ut}]{0,16} ?[${Ut}]{0,16})$`,"^(/\\w{0,16})$",".*(\\([a-zA-Z:]{2,16})$",".*(\\([a-zA-Z:]{2,16}:[1-6]?)$"],delayedTriggers:[".*\\b([A-Z][A-Za-z]{2,31})$"]};var Ht;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(Ht||(Ht={}));const jt=(0,ce.lazyProperties)({messageComposerNewComposer:()=>u.Styles.createViewStyle({marginBottom:5,paddingLeft:8}),messageComposerNewComposerSmallDevice:()=>u.Styles.createViewStyle({paddingLeft:2}),sendButton:()=>u.Styles.createViewStyle({borderRadius:Nt/2,height:Nt,width:Nt}),micButton:()=>u.Styles.createViewStyle({borderRadius:Nt/2,height:Nt,width:Nt,paddingLeft:6}),sendButtonHover:()=>u.Styles.createButtonStyle({backgroundColor:Ye.Color.blueOverlay70}),compositionAreaContainer:()=>u.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>u.Styles.createViewStyle({paddingLeft:8,flex:1,justifyContent:"center"}),compositionAreaRedesign:()=>u.Styles.createViewStyle({position:"relative",width:"100%",borderRadius:4,overflow:"hidden",marginTop:8,marginBottom:4,shadowColor:Ye.Color.blackOverlay20,elevation:2,shadowOffset:{width:1,height:1.5},shadowRadius:1}),compositionAreaNewComposer:()=>u.Styles.createViewStyle({paddingLeft:15,justifyContent:"flex-end",overflow:"visible"}),compositionAreaNewComposerRedesign:()=>u.Styles.createViewStyle({justifyContent:"flex-end",overflow:"visible"}),inputArea:()=>u.Styles.createViewStyle({flex:1,flexDirection:"row"}),expandableArea:()=>u.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Ye.Color.transparent}),expandableAreaNewComposer:()=>u.Styles.createViewStyle({maxHeight:110}),expandableAreaWithQuote:()=>u.Styles.createViewStyle({flex:1,maxHeight:48}),expandableAreaWithQuoteNewComposer:()=>u.Styles.createViewStyle({maxHeight:80}),expandableAreaWithQuoteNewComposerRedesign:()=>u.Styles.createViewStyle({maxHeight:200}),expandableAreaLandscapeMaxHeight:()=>u.Styles.createViewStyle({maxHeight:48}),composerInner:()=>u.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:12,marginHorizontal:16}),composerOuter:()=>u.Styles.createViewStyle({flex:1,flexDirection:"row"}),composerOuterRedesign:()=>u.Styles.createViewStyle({flex:1,paddingLeft:12,paddingRight:12,paddingTop:4,paddingBottom:4,alignContent:"center",overflow:"hidden"}),composerInnerMobile:()=>u.Styles.createViewStyle({marginTop:5,marginBottom:0,marginHorizontal:4}),composerInputRedesign:()=>u.Styles.createViewStyle({flexDirection:"row",width:"100%",alignItems:"center"}),composerInnerMobileNewComposer:()=>u.Styles.createViewStyle({marginTop:5,marginHorizontal:0}),composerInnerMobileNewComposerExtraPadding:()=>u.Styles.createViewStyle({marginLeft:3}),composerInnerLandscape:()=>u.Styles.createViewStyle({marginTop:4,marginBottom:2}),innerContainerNewComposer:()=>u.Styles.createViewStyle({alignItems:"flex-end"}),innerWrapperNewComposer:()=>u.Styles.createViewStyle({borderRadius:Ot/2,minHeight:Ot,alignItems:"center",marginBottom:2,marginHorizontal:3,overflow:"visible"}),innerWrapperNewComposerRedesign:()=>u.Styles.createViewStyle({borderRadius:Ot/2,minHeight:Ot,alignItems:"center",marginLeft:4,overflow:"visible"}),innerWrapperNewComposerForMediaPreview:()=>u.Styles.createViewStyle({alignItems:"flex-start"}),mediaPreviewWrapper:()=>u.Styles.createViewStyle({alignItems:"flex-start"}),innerWrapperNewComposerSmallDevice:()=>u.Styles.createViewStyle({marginHorizontal:0}),rightControlContainer:()=>u.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>u.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),quoteAreaRedesign:()=>u.Styles.createViewStyle({flex:1,paddingLeft:12}),quoteAreaNewComposer:()=>u.Styles.createViewStyle({paddingLeft:0,borderBottomWidth:1,marginBottom:5}),quoteAreaNewComposerRedesign:()=>u.Styles.createViewStyle({paddingLeft:0}),quoteTextStyle:()=>u.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>u.Styles.createTextStyle({fontSize:et.default.controlFontSize.messageStreamQuoteAttributeMobile}),attachmentButton:()=>u.Styles.createViewStyle({paddingLeft:12,alignItems:"flex-end"}),cameraButton:()=>u.Styles.createViewStyle({height:Nt,width:Nt}),overflowButton:()=>u.Styles.createViewStyle({height:Nt,width:Nt}),moreButton:()=>u.Styles.createViewStyle({paddingRight:8,alignItems:"flex-end",height:50}),skypeMessageTextInput:()=>u.Styles.createTextStyle({font:et.default.font.uiDisplayRegular,fontSize:et.default.controlFontSize.messageComposerMobile,minHeight:23,backgroundColor:Ye.Color.transparent}),textInputFocusButton:()=>u.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Ye.Color.transparent}),linkStyle:()=>u.Styles.createTextStyle({fontSize:et.default.controlFontSize.body,lineHeight:18,color:Ye.Color.gray400,fontFamily:et.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoticonIconNewComposer:()=>u.Styles.createButtonStyle({paddingTop:8,paddingLeft:0,paddingRight:8,paddingBottom:8}),emoticonIconNewComposerRedesign:()=>u.Styles.createButtonStyle({paddingTop:8,paddingLeft:0,paddingRight:0,paddingBottom:8}),emoticonIconWrapper:()=>u.Styles.createViewStyle({alignSelf:"flex-end"}),rightIconContainer:()=>u.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"space-between"}),clearQuoteNewComposer:()=>u.Styles.createButtonStyle({alignSelf:"flex-start",marginTop:6,marginBottom:10,paddingLeft:0,paddingRight:8}),clearQuoteNewComposerRedesign:()=>u.Styles.createButtonStyle({position:"absolute",top:8,right:8}),emoteAuthor:()=>(0,ce.lazyProperties)({text:()=>u.Styles.createTextStyle({fontSize:et.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"})}),mediaBarMargins:()=>u.Styles.createViewStyle({marginHorizontal:10})}),zt=p.StyleSheet.create({cameraButton:{height:Nt,width:Nt,alignItems:"center",justifyContent:"center"}});let Wt=45;class Gt extends Tt.MessageComposerBase{constructor(){super(...arguments),this._smsDestinationType=wt.DestinationType.Unknown,this._isPostingMessage=!1,this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=Wt,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new u.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=u.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._rightControlsWidthValue=new u.Animated.Value(2*Et),this._rightControlsWidthStyle=u.Styles.createAnimatedViewStyle({width:this._rightControlsWidthValue}),this._rightControlsOpacityValue=new u.Animated.Value(1),this._rightControlsOpacityStyle=u.Styles.createAnimatedViewStyle({opacity:this._rightControlsOpacityValue}),this.insertSearchResult=(e,t,s)=>{Gt._announceForAccessibility(e),this.autoReplaceText(e,t,s),we.default.deactivateInlineSearch()},this.autoReplaceText=(e,t,s)=>{if(u.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&me.MediaBarItem.dismissPopup(this._getRootViewId()),"Emoticon"===t){const e=he.getString("MessageComposer.AccessibilityAnnouncement_EmoticonInserted");Gt._announceForAccessibility(e)}else Gt._announceForAccessibility(e);if(this._textInputRef){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(s,this.state.emoticons);this._textInputRef.insertContent(e),this._textInputRef.requestFocus(),this._textInputRef.getContent().then((e=>{this.isComponentMounted()&&this._consumeNewUserInput(e)}))}},this.requestFocus=()=>{this._textInputRef&&(a.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusOverflowButton=()=>{this._overflowButtonRef&&this._overflowButtonRef.requestFocus()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(Lt.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&u.Accessibility.announceForAccessibility(this._placeholderText))},this._handleCustomKeyboardHiddenEvent=()=>{this._resetSelectedKeyboard()},this._resetSelectedKeyboard=()=>{this._trimTextInputIfEmpty()},this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onStickerSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,$.PostSource.MediaPicker,[e],k.MessageTypes.RichText,{name:je.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Ue.default.postMessageFromInput(this.props.conversationId,$.PostSource.MediaPicker,[e],k.MessageTypes.RichText,{name:je.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&(this.props.onClearQuotedMessage(!0),this._saveMessage(this.state.inputEntities,{clearQuoteMessage:!0}))},this._onPhoneNumberForSmsSelected=e=>{const t=dt.default.newCauseId();ne.log($.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.twoWaySMSCapable?e&&xe.default.navigateToConversation({convId:A.getMriFromPhoneNumber(e),origin:$.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):xe.default.navigateToConversation({convId:this.props.conversationId,origin:$.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._saveMessage=(e,t)=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let s,i=He.SavedMessageType.None;this.props.editedMessage?(s=[this.props.editedMessage],i=He.SavedMessageType.Edited):!(null==t?void 0:t.clearQuoteMessage)&&this.props.quotedMessages&&(s=this.props.quotedMessages,i=He.SavedMessageType.Quoted),O.default.saveMessageInput(this.props.conversationId,{messages:s,type:i,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else ne.log($.LogTraceArea.MessageComposer,"MessageComposer._saveMessage clearMessageInput."),O.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&(ne.log($.LogTraceArea.MessageComposer,"MessageComposer._onCancelPesSearch clearInputText."),O.default.clearMessageInput(this.props.conversationId));const s=O.default.getSavedMessageInput(this.props.conversationId);(!s||s&&!s.messages)&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onAnimatedViewRef=e=>{this._animatedViewRef=e||void 0},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{const e=n.head(this.state.inputEntities);this._textInputRef&&e instanceof ie.QuoteEntity&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e)||this.state.inputEntities;this._setInputEntityStateDownstream(t.slice(1,t.length))}))},this._renderEmoticonPickerItem=e=>(0,o.jsx)(K.EmoticonPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>(0,o.jsx)(ee.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>(0,o.jsx)($e.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>(0,o.jsx)(Xe.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>(0,o.jsx)(Y.default,Object.assign({acceptedFileTypes:Y.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>(0,o.jsx)(Y.default,Object.assign({acceptedFileTypes:Y.AcceptedFileTypes.All},e)),this._renderImageGenerationItem=e=>(0,o.jsx)(Pt.ImageGenerationItem,Object.assign({toggleOverflowMenu:this._onToggleOverflowMenu},e)),this._renderCameraItem=e=>(0,o.jsx)(M.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>(0,o.jsx)(ze.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>(0,o.jsx)(Oe.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>(0,o.jsx)(pe.default,Object.assign({},e)),this._renderContactPickerItem=e=>(0,o.jsx)(F.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>(0,o.jsx)(v.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>(0,o.jsx)(ct.default,Object.assign({},e)),this._renderPeopleItem=e=>(0,o.jsx)(Le.PeopleItem,Object.assign({},e)),this._renderSendCreditItem=e=>(0,o.jsx)(Ge.SendCreditItem,Object.assign({},e)),this._onOverflowButtonRef=e=>{this._overflowButtonRef=e||void 0},this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._onLaunchCameraFromComposer=()=>{ne.track(new _e.MediaBarItemPressed(Lt.MediaBarItemKeys.ComposerCamera,!0,this.props.conversationId,Se.MediaBarItemOrigin.MessageComposer)),this.props.onLaunchCamera&&(this._textInputRef&&this._textInputRef.dismissKeyboard(),this.props.onLaunchCamera())},this._getEmoticonPickerKeyboard=(e,t)=>{const s=this._keyboardHeight(),i=[it.default.overflowVisible];return s?i.push(u.Styles.createViewStyle({height:s},!1)):i.push(it.default.flexOne),(0,o.jsxs)(u.View,{style:i,children:[K.EmoticonPickerItem.getVirtualKeyboard(e,t),this._renderPesPickerPopup()]})},this._renderPesPickerPopup=()=>(0,o.jsx)(Fe.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!0}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._animatedViewRef&&(this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t)),Wt=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case st.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case st.MediaBarCustomAction.LaunchEmoticon:Ne.EmoticonPickerTelemetry.startOpenScenario(),Ne.EmoticonPickerTelemetry.open(),we.default.activatePicker(Ee.TabType.Emoticon),this._onPickerActive(Lt.MediaBarItemKeys.Emoticon);break;case st.MediaBarCustomAction.LaunchSticker:Ne.StickerPickerTelemetry.open(),we.default.activatePicker(Ee.TabType.ChatSticker),this._onPickerActive(Lt.MediaBarItemKeys.Sticker);break;case st.MediaBarCustomAction.LaunchGif:Ne.GifPickerTelemetry.open(),we.default.activatePicker(Ee.TabType.Gif),this._onPickerActive(Lt.MediaBarItemKeys.Gif);break;case st.MediaBarCustomAction.MentionBing:this._mentionMagicBot();break;case st.MediaBarCustomAction.LaunchBingToolbox:this._handleMagicBotToolboxOpen();break;default:ne.log($.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._mentionMagicBot=()=>{var e;const t=(0,ht.getMagicBotId)(),s=W.default.getDisplayableProfile(t),i={type:c.EditableEntityType.AtMention,displayText:s.getDisplayName()+" ",userMri:(0,ht.getMagicBotId)(),shortName:s.getShortName(),displayName:s.getDisplayName()};null===(e=this._textInputRef)||void 0===e||e.insertContent(i),ne.track(new pt.MagicBotMentionedByClick)},this._onComposerOverflowPress=()=>{ne.track(new _e.MediaBarItemPressed(Ht[Ht.OverflowButton],!0,this.props.conversationId,Se.MediaBarItemOrigin.MessageComposer)),this._onToggleOverflowMenu()},this._onComposerOverflowCoachMarkPress=()=>{ne.track(new _e.MediaBarItemPressed(Ht[Ht.OverflowButtonCoachMark],!0,this.props.conversationId,Se.MediaBarItemOrigin.MessageComposer)),this._onToggleOverflowMenu()},this._onToggleOverflowMenu=()=>{if(this.isComponentMounted()){let e=!1;if(this.props.onHandleOverflow&&(e=this.props.onHandleOverflow(this._overflowActions())),!e){const e=!this.state.showOverflowMenu;e&&(d.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard()),this.isComponentMounted()&&this.setState({showOverflowMenu:e,selectedMediaBarItem:e?"":this.state.selectedMediaBarItem})}}},this._onDismissMediaPicker=()=>{d.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onPickerActive=e=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&this.setState({selectedMediaBarItem:e,isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1})},this._handleMagicBotToolboxOpen=()=>{this.isComponentMounted()&&this.setState({isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1})},this._onMediaBarItemSelected=e=>{(this.state.isCollapsableMediaBarExpanded||this.state.selectedMediaBarItem!==e)&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===Lt.MediaBarItemKeys.Sms?"":e,isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===Lt.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):qe.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(n.noop))},this._onCancelEditClick=e=>{e.stopPropagation();const t=dt.default.newCauseId();ut.default.createOneShotTrackerAndMarkPressTime(t,je.ScenarioName.ResponsivenessCancelEditMessage,e),Gt._announceForAccessibility(he.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation();const t=dt.default.newCauseId();ut.default.createOneShotTrackerAndMarkPressTime(t,je.ScenarioName.ResponsivenessSendEditMessage,e),this._textInputRef&&(ne.track(new Ie.MessageComposerControlEvent(Ie.MessageComposerControls.SendButton,Ie.MessageComposerControlAction.Click)),this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e);t?this._sendMessage(t):this._setInputEntityStateDownstream(this.state.inputEntities)})))},this._onRecordButtonClick=e=>{e.stopPropagation();const t=dt.default.newCauseId();ut.default.createTrackerAndMarkPressTime(t,je.ScenarioName.ResponsivenessRecordAudio,e),ne.track(new _e.MediaBarItemPressed(Lt.MediaBarItemKeys.Audio,!0,this.props.conversationId,Se.MediaBarItemOrigin.MessageComposer)),this.props.onRecording&&this.props.onRecording(),ut.default.markActionDoneAndRemoveTracker(t)},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this._trimTextInputIfEmpty=()=>{this.isComponentMounted()&&!oe.getRawText(this.state.inputEntities).match(/\S|^$/)&&this._setInputEntityStateDownstream([])},this._onAutoCompletionRequested=(e,t)=>(this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this._wasRegexTriggered(t)&&(this._pendingMessageTextCompletionPromise=h.Defer(),this.props.onInputTextChanged(e,!1)),this._pendingMessageTextCompletionPromise?this._pendingMessageTextCompletionPromise.promise():h.Rejected()),this._onAutoCompletionRequestAborted=()=>{this._cancelAutoCompletionIfActive()},this._onAutoCompletionNavigationKey=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e),e.keyCode===de.default.ESCAPE)this._cancelAutoCompletionIfActive()},this._onUserInputActive=()=>{at.default.setComposingState(!0,this.props.conversationId)},this._onUserInputInactive=()=>{at.default.setComposingState(!1,this.props.conversationId)},this._onUserInputCommitted=e=>{const t=this._consumeNewUserInput(e);t&&(at.default.setComposingState(!1,this.props.conversationId),this._sendMessage(t))},this._onPastingText=e=>{this.isComponentMounted()&&this.setState({messageComposerPastedContentType:e})},this._setComposingStateInactiveDebounced=n.debounce((()=>{at.default.setComposingState(!1,this.props.conversationId)}),300,{leading:!0,trailing:!0}),this._onUserInputAborted=()=>{this.state.selectedMediaBarItem!==Lt.MediaBarItemKeys.Emoticon&&(this._setComposingStateInactiveDebounced(),this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&(this.props.onClearEdit&&this.props.onClearEdit(),ne.log($.LogTraceArea.MessageComposer,"MessageComposer._onUserInputAborted."),O.default.clearMessageInput(this.props.conversationId)),this._cancelAutoCompletionIfActive())},this._onUserInputEmptyIndicationChanged=e=>{this.isComponentMounted()&&this.setState({userInputIsEmpty:e}),this.props.onNativeComposerMessageEmptyStateChanged&&this.props.onNativeComposerMessageEmptyStateChanged()},this._onUserInputUncommittedChangesIndicationChanged=e=>{this.isComponentMounted()&&this.setState({hasUncommittedUserInput:e})},this._onEqualsInitialContentIndicationChanged=e=>{this.isComponentMounted()&&this.setState({equalsInitialContent:e})},this._onUserInputBackspacePressedAtHeadPos=()=>{this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.state.userInputIsEmpty&&this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit()},this._onAccessibilityAnnouncementRequested=e=>{if(e===c.AccessibilityAnnouncement.NewLineAdded)u.Accessibility.announceForAccessibility(he.getString("MessageComposer.AccessibilityAnnouncement_NewlineAdded"))},this._onEmoticonLoadCompleted=e=>{ne.track(new Be.ComposerEmoticonLoaded(e,De.default.isUsingStackNavigationContext()))},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=O.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._consumeNewUserInput=e=>{let t;return e.downStreamDataVersion>=this.state.inputEntitiesDataVersion&&(t=oe.applyEditableContentToInputEntities(e,this.state.inputEntities),this._setInputEntityStateUpstream(t)),t},this._onFocus=()=>{const e={hasFocus:!0,isCollapsableMediaBarExpanded:!1,showOverflowMenu:!1};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{const t=e.nativeEvent;!this.props.disableCopyPasteMedia&&t.clipboardData&&t.clipboardData.items&&0!==t.clipboardData.items.length&&(n.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(n.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let i=t.getAsFile();if(i instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=n.attempt((t=>new File([t],e,{type:t.type})),i);n.isError(t)||(i=t),s.onload=()=>{if(i&&i.size>0){const e={file:i,extension:Z.default.extractFileExtension(i.name)};this._sendFileWithDimensions(e,$.PostSource.Clipboard)}},s.readAsDataURL(i)}}})),Gt._announceForAccessibility(he.getString("MessageComposer.FilesSentLabel"))))},this._onPastePreviewInCaptureComplete=()=>{const e=dt.default.newCauseId();ne.log($.LogTraceArea.MessageComposer,"MessageComposer._onPastePreviewInCaptureComplete",e),this._pastePreviewCompletionHelper(!1)},this._onPastePreviewInCaptureCancel=()=>{const e=dt.default.newCauseId();ne.log($.LogTraceArea.MessageComposer,"MessageComposer._onPastePreviewInCaptureCancel",e),this._pastePreviewCompletionHelper(!0)},this._announceForAccessibilityForMessageSent=()=>{n.defer((()=>{this.isComponentMounted()&&Gt._announceForAccessibility(he.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{this._textInputRef&&this._textInputRef.notifyBackspacePressedExternally()},this._showFilePicker=(e,t)=>t===this._getRootViewId(),this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._updateAndStoreDraftInputEntitiesFromContent=e=>(ne.log($.LogTraceArea.MessageComposer,"MessageComposer._updateAndStoreDraftInputEntitiesFromContent causeId: "+e),this._textInputRef?this._textInputRef.getContent().then((e=>O.default.updateInputEntitiesFromContent(this.props.conversationId,e).commit(this.props.conversationId).storeSavedMessage(this.props.conversationId))):h.Resolved()),this._validateUrl=e=>rt.default.isUrlValid(e),this._setContent=(e,t)=>{ne.log($.LogTraceArea.MessageComposer,"MessageComposer._setContent"),this._setInputEntityStateDownstream(e,(()=>{t&&this.requestFocus()}))},this._renderMediaPreviewPanel=()=>{if(this.state.enableMediaPreviewOnMobile&&this.state.hasMediaPreviews)return(0,o.jsx)(Mt.default,{conversationId:this.props.conversationId})}}_buildState(e,t){var s;const i=super._buildState(e,t),o=S.default.getS4LMessagingFeatures(),{enableMagicBot:r,enableReplyMessageUnifiedUI:l,enableMediaPreviewOnMobile:d,enableHtmlAndroidComposer:u}=o,h=(0,U.default)().getConversation(e.conversationId),p=(0,ht.isMagicBotConversation)(e.conversationId),g=(0,ht.isMagicBotContainingConversation)(h),m=Object.assign(Object.assign({},i),{enableMagicBot:r,isMagicBotConversation:p,isMagicBotContainingConversation:g,conversation:h,enableReplyMessageUnifiedUI:l,enableMediaPreviewOnMobile:d,enableHtmlAndroidComposer:u}),f=this.props,y=this._getRootViewId(),v=S.default.getS4LCommerceFeatures();t&&(m.inputEntities=e.initialInputEntities||[],m.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,m.hasFocus=!1,m.isCollapsableMediaBarExpanded=!1,m.selectedMediaBarItem="",m.offsetTop=0,m.showOverflowMenu=!1,m.userInputIsEmpty=n.isEmpty(m.inputEntities),m.hasUncommittedUserInput=!1,m.equalsInitialContent=!0,m.currentNumberOfIconsInMediaBar=m.maxNumberOfIconsInMediaBarForWidth,m.pesPickerKeyboardHeight=276,m.messageComposerPastedContentType=c.PastedTextType.None);const C=De.default.isUsingStackNavigationContext();m.useTabletUI=ot.default.isTabletUI(),m.isKeyboardSeen=ae.default.isKeyboardSeen(),m.deviceOrientation=Ve.default.getDeviceOrientation(y),m.isSmallOrTinyScreen=Ve.default.isSmallOrTinyScreenSize(y),m.editable=!Re.default.isAnimationPending()&&!e.disableActionOnMessageComposer,m.isSmallHeightView=Ve.default.isSmallDesktopHeightView(y),m.viewportWidth=e.availableWidth||Ve.default.getWidth(y),m.showAdditionalMediaBarItems=m.viewportWidth>=360,m.gradientColors=ke.default.getGradientColors(),m.delayedTriggersWaitTime=o.composerAutoCompletionDelay,m.emoticons=q.default.getEmoticons(),m.isUsingStackNavigationContext=C,m.messageStreamFontSize=Ae.default.getMessageStreamFontSize(),m.canUseAddins=I.default.addins().canUseAddins,m.isMediaPickerInRightControlsForMobile=o.showMediaPickerInRightControlsForMobile,m.editableEntities=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(m.inputEntities||[],m.emoticons);const{selectedTabType:M,searchQuery:P}=j.default.getPickerSearchProps();m.selectedTabType=M,m.searchQuery=P,t&&!m.editable&&(m.overrideEditable=!0),m.showLocationPicker=!e.hideLocationPickerIcon&&!Ze.default.isFireOS(),m.showContactPicker=!e.hideContactPickerIcon&&I.default.contacts().canInvitePeople,m.showStickerPicker=!e.hideStickerPickerIcon,m.showGifPicker=!e.hideGifPickerIcon&&o.enablePesGifs,m.showVideoMessageIcon=!e.hideVideoMessageIcon&&!A.isEncryptedThread(e.conversationId)&&S.default.isDesktopVIMEnabled()&&(H.default.isAVDeviceReady()||a.BrowserEnvironment.isChrome());const k=A.isOneOnOneConversation(e.conversationId);m.overflowMenuOrderForMobileUI=o.overflowMenuOrder,m.mediaBarMenuOrder=this._mediaBarMenuOrder(o.mediaBarMenuOrder),m.isSmallDevice=Ve.default.isSmallDevice(y),m.useCompactLayout=m.isSmallDevice,m.phoneNumbers=e.otherPartyMri&&lt.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const x=A.isPhoneMri(e.conversationId);m.isOneOnOneConversation=k,m.creditEntitlement=X.default.getCreditEntitlement(),m.enableOnewaySms=(x||v.smsPromo.unpaidUserEnabled||!!_.getPositiveCreditBalance(m.creditEntitlement)||X.default.userHasSubscriptions())&&(x||k)&&m.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!A.isEncryptedThread(e.conversationId),m.quoteTextForSms=this._getQuotedTextForSms(f.quotedMessages,e.quotedMessages),m.disableHighBandwidthOperations=se.default.isUsingGogoNetwork(),m.isCameraAvailable=b.UICapabilities.cameraSupported()&&w.default.isCameraAvailable(),m.isConversationWithPhoneNumber=A.isConversationWithPhoneNumber(e.conversationId),m.sendMessageWithEnter=!!Ae.default.getUserPreferencesLocal().sendMessageWithEnter,m.enableImagePasteMobile=o.enableImagePasteMobile,m.twoWaySMSCapable=!!(null===(s=T.default.getCallerIdPrimaryNumber())||void 0===s?void 0:s.smsCapable);let D=e.phoneNumberForSendingSms;if(!D&&A.isPhoneMri(e.conversationId)){const t=A.getPhoneNumberFromMri(e.conversationId);t&&(D={number:t,type:st.PhoneNumberTypes.Other})}if(m.phoneNumberForSendingSms=D,m.isMobilePesPickerActive=we.default.isPickerActive(),!t&&!this.state.isMobilePesPickerActive&&m.isMobilePesPickerActive&&""===this.state.selectedMediaBarItem){we.default.getActiveTabType()===Ee.TabType.Gif&&(m.selectedMediaBarItem=Lt.MediaBarItemKeys.Gif)}m.isMediaPreviewEnabled=fe.default.isMediaPreviewEnabled(e.conversationId),m.hasMediaPreviews=m.isMediaPreviewEnabled&&ye.default.getPreviews(e.conversationId).length>0,m.enableHandlingHTMLonPaste=o.enableHandlingHTMLonPaste,m.isSmsFailureScreenEnabled=m.enableOnewaySms&&v.callFailure.smsFailurePrompt.enabled;const R=v.cantSendSmsToTheUSWarning.enabled,L=xt.default.getSmsRateByPhoneNumberSafely(null==D?void 0:D.number),B=T.default.getCallerIdPrimaryNumber();m.shouldPreventSMSTotheUS=(0,bt.shouldPreventSMSTotheUS)(R,null==L?void 0:L.fullRateInfo,B);const F=v.cantSendSmsToCNWarning.enabled;if(m.shouldPreventSMSToNotSupportedDestination=(0,bt.shouldPreventSMSToNotSupportedDestination)(F,null==D?void 0:D.number,null==L?void 0:L.fullRateInfo),m.shouldPreventSMSToInvalidNumber=v.cantSendSmsToInvalidNumber.enabled&&!Rt.default.getPhoneNumberDetails(null==D?void 0:D.number).isValidNumber,m.isRegularMemberInModeratedGroup=h&&(0,Pe.isRegularMemberInModeratedGroup)(h),t){Ke.default.setDefault(),Ke.default.commitNextFlowId();const t=this._rightControlsLayoutInfo(e,m);this._rightControlsWidthValue.setValue(t.width),this._rightControlsOpacityValue.setValue(t.opacity),this._checkForOutgoingSmsMessagesInConversation(m)}return m}componentDidMount(){if(super.componentDidMount(),this._dataUpdateSubscription=c.dataUpdateReceivedEvent.subscribe((({forCustomContext:e,newContent:t})=>{e===this.props.conversationId&&this._consumeNewUserInput(t)})),A.isPhoneMri(this.props.conversationId)){const e=A.getPhoneNumberFromMri(this.props.conversationId);e&&Dt.default.getSortedUsersByPhoneNumberAsync(e).then((e=>{(null==e?void 0:e.length)>0?this._smsDestinationType=wt.DestinationType.ContactNumber:this._smsDestinationType=wt.DestinationType.PhoneNumber})).catch(n.noop)}else A.isSkypeIdMri(this.props.conversationId)&&(this._smsDestinationType=wt.DestinationType.Contact);S.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&(ue.default.addObserver(ue.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._appStateSubscription=m.default.subscribeForChanges("MessageComposerV2",(e=>{if((!this._textInputRef||this._textInputRef.hasUncommittedChanges())&&n.includes([u.Types.AppActivationState.Inactive,u.Types.AppActivationState.Background],e)){const e=dt.default.newCauseId();ne.log($.LogTraceArea.MessageComposer,"MessageComposer._appStateSubscription causeId: "+e),this._updateAndStoreDraftInputEntitiesFromContent(e).then((()=>{const e=O.default.getConversationsNumber();e>0&&ne.track(new G.DraftMessageAppExitWithDrafts(e))})).catch(n.noop)}}))),this._customKeyboardDidHideListener=d.default.onCustomKeyboardEvent(d.CustomKeyboardEvent.customKeyboardHidden,this._handleCustomKeyboardHiddenEvent),this._nativeKeyboardDidHideListener=d.default.on(d.VirtualKeyboardEvent.keyboardDidHide,this._resetSelectedKeyboard),u.Modal.isDisplayed()||!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0}),this._textInputRef&&this.setState({userInputIsEmpty:this._textInputRef.isEmpty(),hasUncommittedUserInput:this._textInputRef.hasUncommittedChanges(),equalsInitialContent:this._textInputRef.equalsInitialContent()});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&d.default.isSupported()&&d.default.dismiss()}))),le.default.addHandler($.KeyboardShortcut.SendFile,this._showFilePicker),le.default.addHandler($.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),le.default.addHandler($.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._setAndroidCustomKeyboardHeight(),this._keyboardDismissRegistrationHandle=z.register(this),O.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated),this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&St.default.fetchLocation(),ve.maybeRefreshCallerIdData(!0,this.state.isConversationWithPhoneNumber),this._contentSetSubscriptionToken=(0,Ct.subscribeToContentSetEvent)(this._setContent)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1;const i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state));let o=[];if(e.editedMessage&&e.editedMessage!==this.props.editedMessage){const t=V.decode(e.editedMessage);o=N.toEntities(t,{supportEmoticons:!0,supportLinkEntity:!0,supportHtmlAndroid:this.state.enableHtmlAndroidComposer}),s=!0,i.phoneNumberForSendingSms=void 0}if(this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof ie.EmoteEntity&&(o=[])),e.initialInputEntities&&e.initialInputEntities[0]){const t=this.props.initialInputEntities&&this.props.initialInputEntities[0]?this.props.initialInputEntities[0].text():"",s=e.initialInputEntities[0].text(),i=O.default.getSavedMessageInput(e.conversationId);s!==t?this._setInputEntityStateDownstream(e.initialInputEntities):i&&0===this.state.editableEntities.length&&this._setInputEntityStateDownstream(i.inputEntities)}s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=e.conversationId!==this.props.conversationId;let o=this.state.selectedMediaBarItem,n=this.state.showOverflowMenu;const r=this._hasQuotes()&&!(0,re.default)(this.props.quotedMessages,e.quotedMessages),a=this.props.editedMessage&&!(0,re.default)(this.props.editedMessage,e.editedMessage),l=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;(0,re.default)(this.props.quotedMessages,e.quotedMessages)&&(0,re.default)(this.props.editedMessage,e.editedMessage)&&(0,re.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities);const d=r||a||l;if(!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(o=""),d&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.userInputIsEmpty&&this.state.hasUncommittedUserInput){const e=O.default.getSavedMessageInput(this.props.conversationId);e&&e.type===He.SavedMessageType.None&&(ne.track(new G.DraftMessageDeleted(e.timestamp)),ne.log($.LogTraceArea.MessageComposer,"MessageComposer.componentDidUpdate clear invalid draft."),O.default.clearMessageInput(this.props.conversationId))}this.props.onShowOverflow&&this.state.showOverflowMenu!==t.showOverflowMenu&&this.props.onShowOverflow(!!this.state.showOverflowMenu,this._overflowActions(),this._onToggleOverflowMenu);const c=this._rightControlsLayoutInfo(this.props,this.state),u=this._rightControlsLayoutInfo(e,t);(0,re.default)(c,u)||(this._rightControlsWidthValue.setValue(c.width),this._rightControlsOpacityValue.setValue(c.opacity),!c.isShowing&&this.state.showOverflowMenu&&(n=!1)),this.state.hasFocus&&D.default.hideCurrentCoachMark(),this.state.deviceOrientation===t.deviceOrientation&&this.props.headerHeightAndroid===e.headerHeightAndroid||(this._setAndroidCustomKeyboardHeight(),this._pesPickerPopup&&this._pesPickerPopup.hide()),i&&this._updateAndStoreDraftInputEntitiesFromContent(dt.default.newCauseId()),this.setState({showOverflowMenu:n,selectedMediaBarItem:o}),ve.maybeRefreshCallerIdData(i,this.state.isConversationWithPhoneNumber)}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),O.default.commit(this.props.conversationId),S.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&O.default.storeSavedMessage(this.props.conversationId),ue.default.removeObserver(ue.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._contentSetSubscriptionToken&&(this._contentSetSubscriptionToken.unsubscribe(),this._contentSetSubscriptionToken=void 0),d.default.isSupported()&&d.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard(),ae.default.setCustomKeyboardFixHeightAndroid(0),le.default.removeHandler($.KeyboardShortcut.SendFile,this._showFilePicker),le.default.removeHandler($.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),le.default.removeHandler($.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),z.unregister(this._keyboardDismissRegistrationHandle),O.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),f.default.disableTooltip(y.EngagementTooltipType.ExpressionPicker),At.MessageComposerSendButtonTelemetry.inactive()}render(){const e=[jt.composerInner,jt.composerInnerMobile,jt.innerContainerNewComposer],t=[];this.state.enableReplyMessageUnifiedUI?t.push(jt.composerOuterRedesign):t.push(jt.composerOuter);const s=[it.default.flexOne,jt.messageComposerNewComposer],i=this.state.enableReplyMessageUnifiedUI?jt.expandableAreaWithQuoteNewComposerRedesign:jt.expandableAreaWithQuoteNewComposer,a=this._hasQuotes()?[jt.expandableAreaWithQuote,i]:[jt.expandableArea,jt.expandableAreaNewComposer];this.state.enableReplyMessageUnifiedUI?(t.push(jt.innerWrapperNewComposerRedesign),this.state.enableMediaPreviewOnMobile&&t.push(jt.innerWrapperNewComposerForMediaPreview)):t.push(jt.innerWrapperNewComposer),this.state.useCompactLayout&&(s.push(jt.messageComposerNewComposerSmallDevice),t.push(jt.innerWrapperNewComposerSmallDevice)),t.push(u.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceSecondary},!1)),this._getContext().mode.isAccessible&&t.push(u.Styles.createViewStyle({borderWidth:1,borderColor:this._getContext().themeColors.dividerPrimary},!1));const l=this.state.deviceOrientation===r.DeviceOrientation.Landscape&&this.state.isUsingStackNavigationContext;l&&(a.push(jt.expandableAreaLandscapeMaxHeight),e.push(jt.composerInnerLandscape)),e.push(jt.composerInnerMobileNewComposer);const d=this._sendControlEnabled(this.props,this.state,this._hasQuotes()),c=this._canCancelEdit(this.state,this.props.editedMessage);let h,p,m,S,_,f,y;if(l){const e=d||c||this.state.disableHighBandwidthOperations||this.props.disableActionOnMessageComposer;h=this.state.isMediaPickerInRightControlsForMobile?n.compact([this._getMediaPickerButton(!0,e),this._getCameraButton(e),this._getLocationPickerButton(!0,e),this._getMagicBotToolboxButton(e)]):n.compact([this._getCameraButton(e),this._getMediaPickerButton(!0,e),this._getLocationPickerButton(!0,e),this._getMagicBotToolboxButton(e)]);const t=this._showRightControls(this.props,this.state,d);m=this._getOverflowMenuButton(t&&!this.state.isKeyboardSeen),S=this._getEmoticonPickerItem(!0),p=this._getMediaBar(!0,!1)}else{S=this._getEmoticonPickerItem(!0);const e=d||c||!!this.state.phoneNumberForSendingSms||this.state.disableHighBandwidthOperations||this.props.disableActionOnMessageComposer;h=this.state.isMediaPickerInRightControlsForMobile?n.compact([this._getMediaPickerButton(!0,e),this._getCameraButton(e),this._getLocationPickerButton(!0,e),this._getMagicBotToolboxButton(e)]):n.compact([this._getCameraButton(e),this._getMediaPickerButton(!0,e),this._getLocationPickerButton(!0,e),this._getMagicBotToolboxButton(e)]);const t=this._showRightControls(this.props,this.state,d);m=this._getOverflowMenuButton(t&&!this.state.isKeyboardSeen),p=this._getMediaBar(!0,!1)}let v,C=tt.SkypeIcon.Blank,T=!!this.props.disableActionOnMessageComposer,M=!1,b=!1;c?(_=he.getString("MessageComposer.CancelEditButtonTitle"),y=this._onCancelEditClick,C=tt.SkypeIcon.Cancel):d?(_=he.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),y=this._onSendButtonClick,C=tt.SkypeIcon.Send,T=this.state.userInputIsEmpty&&(!!this.state.phoneNumberForSendingSms||A.isS4BBridgeMri(this.props.conversationId)),M=this._getContext().isRTL,b=!0):this._showMicButton(this.props,this.state)&&(_=he.getString("MessageComposer.RecordButtonTitle"),f=L.default.combinedAccessibilityLabel(_,he.getString("MessageComposer.RecordButtonMobileAccessibilityHint")),y=this._onRecordButtonClick,C=tt.SkypeIcon.Microphone);const I=this.props.preventAccessibilityFocus?u.Types.ImportantForAccessibility.NoHideDescendants:void 0;_&&(b?(T||At.MessageComposerSendButtonTelemetry.activeAndTryTrack(),v=(0,o.jsx)(g.default,{size:this.state.useCompactLayout?g.ActionButtonSize.Tiny:g.ActionButtonSize.Small,title:_,accessibilityLabel:f||_,ref:this._onInputButtonRef,onPress:y,style:jt.sendButton,icon:C,disabled:T,importantForAccessibility:I,flipIcon:M,hideBorder:!0,useSmallIcon:!0})):(At.MessageComposerSendButtonTelemetry.inactive(),v=(0,o.jsx)(te.default,{title:_,accessibilityLabel:f||_,ref:this._onInputButtonRef,onPress:y,size:tt.IconSize.size24,color:d?this._themeColors.headerIconColor:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:jt.micButton,hoverStyle:jt.sendButtonHover,icon:C,disabled:T,importantForAccessibility:I,flipIcon:M})));const w=this._renderQuote(),P=w?(0,o.jsx)(te.default,{style:this.state.enableReplyMessageUnifiedUI?jt.clearQuoteNewComposerRedesign:jt.clearQuoteNewComposer,title:he.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:w.onClearQuoteHandler,size:this.state.enableReplyMessageUnifiedUI?tt.IconSize.size20:tt.IconSize.size16,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:tt.SkypeIcon.Cancel,disabled:this.props.disableActionOnMessageComposer},"clearbutton"):void 0,k=S&&P?(0,o.jsxs)(u.View,{style:jt.rightIconContainer,children:[P,S]},"rightIconContainer"):S||P,x=this.state.enableReplyMessageUnifiedUI?[jt.compositionAreaRedesign,{backgroundColor:this._themeColors.surfaceQuaternary},jt.compositionAreaNewComposerRedesign]:[jt.compositionArea,jt.compositionAreaNewComposer],D=[jt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle];D.push(l?jt.expandableAreaLandscapeMaxHeight:this._hasQuotes()?i:jt.expandableAreaNewComposer);const R=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(a,D,!!w),B=[jt.rightControlContainer,this._rightControlsWidthStyle];m||e.push(jt.composerInnerMobileNewComposerExtraPadding);const F=this.state.enableReplyMessageUnifiedUI?(0,o.jsxs)(u.View,{style:e,children:[m,(0,o.jsxs)(u.View,{style:t,children:[w&&(0,o.jsxs)(u.View,{style:x,importantForAccessibility:I,children:[w.component,P]}),this._renderMediaPreviewPanel(),this._renderEmoteAuthor(),(0,o.jsxs)(u.View,{style:jt.composerInputRedesign,children:[R,S]})]}),(0,o.jsxs)(u.Animated.View,{style:B,children:[v,h]})]}):(0,o.jsxs)(u.View,{style:e,children:[m,(0,o.jsxs)(u.View,{style:t,children:[(0,o.jsxs)(u.View,{style:x,importantForAccessibility:I,children:[w&&w.component,(0,o.jsx)(u.View,{style:jt.mediaPreviewWrapper,children:this._renderMediaPreviewPanel()}),this._renderEmoteAuthor(),R]}),k]}),(0,o.jsxs)(u.Animated.View,{style:B,children:[v,h]})]});return(0,o.jsxs)(u.View,{style:it.default.flexOne,importantForAccessibility:u.Types.ImportantForAccessibility.No,children:[(0,o.jsxs)(u.View,{style:s,children:[this._renderSmsInfoLine(!0),(0,o.jsx)(u.Animated.View,{style:this._inputAreaHeightStyle,ref:this._onAnimatedViewRef,children:(0,o.jsx)(u.View,{style:jt.compositionAreaContainer,onLayout:this._onLayoutInputArea,children:F},"composition")})]}),p,this.state.enableImageCreator&&(0,o.jsx)(kt.default,{})]})}dismissKeyboard(){this._textInputRef&&this._textInputRef.dismissKeyboard()}replaceText(e,t,s,i){if(this.requestFocus(),this._pendingMessageTextCompletionPromise){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(i,this.state.emoticons);this._pendingMessageTextCompletionPromise.resolve(e),this._pendingMessageTextCompletionPromise=void 0}this._cancelAutoCompletionIfActive()}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return this._textInputRef?this._textInputRef.getContent().then((e=>this._consumeNewUserInput(e)||this.state.inputEntities)):h.Resolved(this.state.inputEntities)}getOverflowConfig(){return this._overflowActions()}_getQuotedTextForSms(e,t){return t&&e!==t?n.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_hasQuotes(){return!n.isEmpty(this.props.quotedMessages)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&P.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}_setAndroidCustomKeyboardHeight(){}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}_renderQuote(){if(this.props.hideContentInMessageComposer)return;let e,t=n.first(this.props.quotedMessages),s=this._onClearQuoteButtonPress;if(!t&&this.props.editedMessage){const i=n.head(this.state.inputEntities);i instanceof ie.QuoteEntity&&(t=this.props.editedMessage,e=oe.decodeFromInput([i],!1),s=this._onClearEditMessageQuote)}if(t){const i={onClearQuote:void 0,linkStyle:jt.linkStyle,disableActions:this.props.disableActionOnMessageComposer,renderOrigin:Q.MessageRenderOrigin.MessageComposerCanvas,asQuoteInComposer:!0},n=[],r=[this._themeStyles.primaryTextColorStyle],a=et.default.font.uiDisplayBold;return this._useDarkTheme()&&(i.linkStyle=u.Styles.combine(jt.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle)),i.quoteAttributeStyle=[jt.quoteAttributeStyle],i.quoteSymbolStyle={size:tt.IconSize.size20,color:this._themeColors.textPrimary},i.textOverrideStyle=r,i.atMentionMeOverrideStyle=a,i.atMentionStyle=a,i.showTranslatedMessage=!!this.props.showTranslatedMessage,this.state.enableReplyMessageUnifiedUI?(n.push(jt.quoteAreaRedesign,jt.quoteAreaNewComposerRedesign),i.quoteAttributeStyle.push(this._themeStyles.primaryTextColorStyle)):(i.quotedTextStyle=jt.quoteTextStyle,n.push(jt.quoteArea,jt.quoteAreaNewComposer,this._themeStyles.secondaryDividerBorderStyle),i.quoteAttributeStyle.push(this._themeStyles.secondaryTextColorStyle)),{component:(0,o.jsx)(u.View,{style:n,children:(0,o.jsx)(Te.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:i})}),onClearQuoteHandler:s}}}_getTextForSms(e){return`${this.state.quoteTextForSms}${oe.getRawText(e)}`}_renderSmsInfoLine(e=!1){const t=!!this.state.phoneNumberForSendingSms||!!this.state.hasOutgoingSmsInConversation||!!this.state.smsToggledOn;if(this.state.enableOnewaySms&&(!e||t))return(0,o.jsx)(Qe.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,useMobileLayout:e,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_isStickerCategoryEnabled(){return this.state.showStickerPicker&&!this.state.phoneNumberForSendingSms}_isGifCategoryEnabled(){return this.state.showGifPicker&&!this.state.phoneNumberForSendingSms}_renderEmoteAuthor(){const e=n.head(this.state.inputEntities);if(this.props.editedMessage&&e&&e instanceof ie.EmoteEntity){const t=[jt.emoteAuthor.text,this._themeStyles.primaryTextColorStyle],s=e.fallbackText.trim();return(0,o.jsx)(u.View,{children:(0,o.jsx)(u.Text,{style:t,children:s+"…"})})}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?he.getString("MessageComposer.SmsMessagePlaceholderShortText"):he.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t,s=!1){const i=this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Sticker?(0,o.jsx)(u.Button,{style:jt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:u.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=s?"":this._getDefaultPlaceholderText();let r=et.default.controlFontSize.messageComposerMobile;this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal&&(r=Me.getSize(r,this.state.messageStreamFontSize));const a=this.props.disableCopyPasteMedia;return(0,o.jsx)(u.View,{style:jt.inputArea,children:(0,o.jsxs)(u.Animated.View,{style:[...e],children:[(0,o.jsx)(c.default,{ref:this._onTextInputRef,importantForAccessibility:"yes",accessibilityLabel:this._getDefaultPlaceholderText(),style:t,agnosticContentBackgroundColor:this._useDarkTheme()?Bt:Ft,atMentionBackgroundColor:this._themeColors.surfaceAccent,linkTextColor:this._themeColors.textPrimary,lineHeight:Math.round(1.2*r),maxLength:this.props.maxLength,onFocus:this._onFocus,onBlur:this._onBlur,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.textSecondary,keyboardAppearance:this._useDarkTheme()?"dark":"default",useGraphicalEmoticons:!0,enterKeyOnExtKeyboardSendsMessage:this.state.sendMessageWithEnter,editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,initialContent:ve.getEditableContentFromEditableEntities(this.state.editableEntities,this.state.inputEntitiesDataVersion),customContext:this.props.conversationId,intermediateContentUpdatedEventInterval:500,onNewContentCommitted:this._onUserInputCommitted,onNewContentAborted:this._onUserInputAborted,onEmptyIndicationChanged:this._onUserInputEmptyIndicationChanged,onUncommittedChangesIndicationChanged:this._onUserInputUncommittedChangesIndicationChanged,onEqualsInitialContentChanged:this._onEqualsInitialContentIndicationChanged,onEditLastMessageRequested:this._editLastMessage,onAccessibilityAnnouncementRequested:this._onAccessibilityAnnouncementRequested,onComposingActive:this._onUserInputActive,onComposingInactive:this._onUserInputInactive,onBackspacePressedAtHeadPosition:this._onUserInputBackspacePressedAtHeadPos,onEmoticonLoadCompleted:this._onEmoticonLoadCompleted,autoCompletionTriggers:Vt,onAutoCompletionRequested:this._onAutoCompletionRequested,onAutoCompletionRequestAborted:this._onAutoCompletionRequestAborted,onAutoCompletionNavigationKey:this._onAutoCompletionNavigationKey,delayedTriggersWaitTime:this.state.delayedTriggersWaitTime,convenienceSpaceReplacingChars:",.;:?!'",disableCopyPasteMedia:a,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,onPastingText:this._onPastingText,validateUrl:this._validateUrl,shouldDefaultPaste:n.constant(!0)}),i]})})}_getEmoticonPickerItem(e){if(this.props.hideEmoticonKeyboardIcon||this.props.hideMediaBar||A.isPhoneMri(this.props.conversationId)||A.isS4BBridgeMri(this.props.conversationId))return;const t=this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Sticker||this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Gif,s={id:Lt.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:t,onActive:this._onPickerActive,isMobileInterface:e,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,iconStyleOverride:this.state.enableReplyMessageUnifiedUI?jt.emoticonIconNewComposerRedesign:jt.emoticonIconNewComposer,showCategorySwitcher:this._isStickerCategoryEnabled(),disabled:this.props.disableActionOnMessageComposer,origin:Se.MediaBarItemOrigin.MessageComposer,ref:e=>{f.default.setAnchor(y.EngagementTooltipType.ExpressionPicker,e)}};return(0,o.jsx)(u.View,{style:jt.emoticonIconWrapper,children:(0,o.jsx)(J.ExpressionPickerItem,Object.assign({},s))})}_keyboardHeight(){return this.state.isSmallDevice?void 0:(this.state.isUsingStackNavigationContext,this.state.pesPickerKeyboardHeight)}_mediaBarItemDescriptor(e){const t=this._keyboardHeight();switch(e){case Lt.MediaBarItemKeys.Emoticon:const s={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:this._isStickerCategoryEnabled()};return{id:e,render:this._renderEmoticonPickerItem,getVirtualKeyboard:this._getEmoticonPickerKeyboard,propOverrides:s,keyboardHeight:t};case Lt.MediaBarItemKeys.Gif:const i={onGifSelected:this._onGifSelected,showCategorySwitcher:!this.props.hideEmoticonKeyboardIcon||this._isGifCategoryEnabled()};return{id:e,render:this._renderGifPickerItem,getVirtualKeyboard:ee.GifPickerItem.getVirtualKeyboard,propOverrides:i,keyboardHeight:t};case Lt.MediaBarItemKeys.Sticker:const o={onStickerSelected:this._onStickerSelected,showCategorySwitcher:!this.props.hideEmoticonKeyboardIcon};return{id:e,render:this._renderStickerPickerItem,getVirtualKeyboard:$e.StickerPickerItem.getVirtualKeyboard,propOverrides:o,keyboardHeight:t};case Lt.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem,getVirtualKeyboard:Xe.SmsItem.getVirtualKeyboard};case Lt.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,getVirtualKeyboard:Y.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Lt.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,getVirtualKeyboard:Y.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Lt.MediaBarItemKeys.ImageGeneration:return{id:e,render:this._renderImageGenerationItem,getVirtualKeyboard:Pt.ImageGenerationItem.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Lt.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,getVirtualKeyboard:M.CameraItem.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Lt.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem,getVirtualKeyboard:ze.ScheduleCallItem.getVirtualKeyboard};case Lt.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem,getVirtualKeyboard:Oe.PollItem.getVirtualKeyboard};case Lt.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,getVirtualKeyboard:pe.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Lt.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem,getVirtualKeyboard:F.ContactPickerItem.getVirtualKeyboard};case Lt.MediaBarItemKeys.Bing:const n={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,getVirtualKeyboard:v.BingSearchItem.getVirtualKeyboard,propOverrides:n};case Lt.MediaBarItemKeys.MagicBotToolbox:return{id:e,render:this._renderMagicToolboxItem};case Lt.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,getVirtualKeyboard:ct.default.getVirtualKeyboard,disabled:this.state.disableHighBandwidthOperations};case Lt.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem,getVirtualKeyboard:Le.PeopleItem.getVirtualKeyboard};case Lt.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:Ge.SendCreditItem.getVirtualKeyboard}}ne.warn($.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowSmsIcon(){return!this.props.hideSmsIcon&&this.state.enableOnewaySms&&this.state.phoneNumbers.length>0}_getItemDescriptors(e,t=!1){const s=t&&this.state.disableHighBandwidthOperations,i=n.map(e,(e=>{switch(e){case Lt.MediaBarItemKeys.Bing:return this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&!this.state.isMagicBotConversation?this._mediaBarItemDescriptor(e):void 0;case Lt.MediaBarItemKeys.MagicBotToolbox:if(super._showMagicBotToolboxButton(this.state))return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Emoticon:if(!this.props.hideEmoticonKeyboardIcon)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&(t||!this.state.useTabletUI||this.state.useTabletUI&&this.props.isInCall))return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.MediaPicker:if(this._shouldShowMediaItem(s,t))return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.FilePicker:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.ImageGeneration:if(!s)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Sticker:if(this._isStickerCategoryEnabled()&&(!t||!this.props.hideStickerPickerIcon))return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Gif:if(this._isGifCategoryEnabled())return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case Lt.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case Lt.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e)}}));return n.compact(i)}_shouldShowMediaItem(e,t=!1){return!this.props.hideMediaPickerIcon&&!e&&(t||!this.state.isMediaPickerInRightControlsForMobile||this.state.isSmallDevice||this.state.useTabletUI&&this.props.isInCall)}_getOverflowItemDescriptors(){const e=n.map(this.state.overflowMenuOrderForMobileUI,(e=>e));return this._getItemDescriptors(n.flatten(e))}_getMediaBarItemDescriptors(){return this.props.hideMediaBar||this._isMediabarDisabled()?[]:this._getItemDescriptors(this.state.mediaBarMenuOrder,!0)}_getOverflowMenuButton(e=!0){if(this.props.hideOverflowMenu||this.props.hideMediaBar||this.state.phoneNumberForSendingSms||A.isS4BBridgeMri(this.props.conversationId)||this.state.disableHighBandwidthOperations||!this.state.canUseAddins)return;const t=this.props.preventAccessibilityFocus?u.Types.ImportantForAccessibility.NoHideDescendants:void 0,s={size:this.state.useCompactLayout?g.ActionButtonSize.Tiny:g.ActionButtonSize.Small,title:he.getString("MessageComposerOverflow.AddTitle"),accessibilityLabel:he.getString("MessageComposerOverflow.AddTitle"),onPress:this._onComposerOverflowPress,style:jt.overflowButton,icon:tt.SkypeIcon.Plus,deselected:!e,hideBorder:!0,useSmallIcon:!0,disabled:this.props.disableActionOnMessageComposer,importantForAccessibility:t};return(0,o.jsx)(x.default.ActionButton,Object.assign({},s,{positions:[R.PopupAnchorPositon.Top,R.PopupAnchorPositon.Right],coachMarkType:R.CoachMarkType.ChatPlus,anchorAccessibilityLabel:he.getString("MessageComposerOverflow.AddTitle"),onAnchorPress:this._onComposerOverflowCoachMarkPress,anchorRef:this._onOverflowButtonRef}))}_getCameraButton(e=!1){const t=this.props.preventAccessibilityFocus?u.Types.ImportantForAccessibility.NoHideDescendants:void 0,s=he.getString("MediaBar.CameraButtonTitle"),i=this.state.enableMediaPreviewOnMobile?(0,o.jsx)(p.TouchableOpacity,{disabled:e,onPress:this._onLaunchCameraFromComposer,"aria-label":s,accessibilityLabel:s,style:zt.cameraButton,importantForAccessibility:this.props.preventAccessibilityFocus?"no-hide-descendants":void 0,children:(0,o.jsx)(It.default,{icon:tt.SkypeIcon.Camera,size:tt.IconSize.size24,color:this._themeColors.primaryIconColor})}):(0,o.jsx)(te.default,{title:s,onPress:this._onLaunchCameraFromComposer,size:tt.IconSize.size24,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:jt.cameraButton,icon:tt.SkypeIcon.Camera,disabled:e,importantForAccessibility:t});return this._showCameraButton(this.props,this.state)?(0,o.jsx)(u.Animated.View,{style:this._rightControlsOpacityStyle,children:i},Lt.MediaBarItemKeys.Camera):void 0}_getMediaPickerButton(e,t=!1){if(!this._showMediaPickerButton(this.props,this.state))return;const s=this.props.preventAccessibilityFocus?u.Types.ImportantForAccessibility.NoHideDescendants:void 0,i={id:Lt.MediaBarItemKeys.MediaPicker,active:this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.MediaPicker,onActive:this._onPickerActive,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:e,isMediaPickerInRightControlsForMobile:this.state.isMediaPickerInRightControlsForMobile,onFocus:this.requestFocus,onBlur:this.blur,onCustomAction:this._onHandleCustomAction,origin:Se.MediaBarItemOrigin.MessageComposer};return(0,o.jsx)(u.Animated.View,{style:this._rightControlsOpacityStyle,importantForAccessibility:s,children:(0,o.jsx)(u.View,{style:jt.emoticonIconWrapper,children:(0,o.jsx)(Y.default,Object.assign({acceptedFileTypes:Y.AcceptedFileTypes.MediaOnly},i))})},Lt.MediaBarItemKeys.MediaPicker)}_getLocationPickerButton(e,t=!1){if(!this._showLocationButton(this.props,this.state))return;const s=this.props.preventAccessibilityFocus?u.Types.ImportantForAccessibility.NoHideDescendants:void 0,i={id:Lt.MediaBarItemKeys.Location,active:this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.Location,onActive:this._onPickerActive,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:e,onFocus:this.requestFocus,onBlur:this.blur,onCustomAction:this._onHandleCustomAction,origin:Se.MediaBarItemOrigin.MessageComposer};return(0,o.jsx)(u.Animated.View,{style:this._rightControlsOpacityStyle,importantForAccessibility:s,children:(0,o.jsx)(pe.default,Object.assign({},i))},Lt.MediaBarItemKeys.Location)}_getMagicBotToolboxButton(e=!1){if(!this._showMagicBotToolboxButtonMobileUI(this.state))return;const t=this.props.preventAccessibilityFocus?u.Types.ImportantForAccessibility.NoHideDescendants:void 0,s={id:Lt.MediaBarItemKeys.MagicBotToolbox,active:this.state.selectedMediaBarItem===Lt.MediaBarItemKeys.MagicBotToolbox,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isMobileInterface:!0,onBlur:this.requestFocus,onCustomAction:this._onHandleCustomAction,origin:Se.MediaBarItemOrigin.MessageComposer,iconStyleOverride:jt.cameraButton};return(0,o.jsx)(u.Animated.View,{style:this._rightControlsOpacityStyle,importantForAccessibility:t,children:this._renderMagicToolboxItem(s)},Lt.MediaBarItemKeys.MagicBotToolbox)}_getMediaBar(e,t=!0){const s=this._getMediaBarItemDescriptors();if(s.length>0){const i=!u.Modal.isDisplayed()&&!!this._textInputRef&&!e&&!this.state.hasFocus&&this.state.isCollapsableMediaBarExpanded;return(0,o.jsx)(ge.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:s,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:e,showIcons:t,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight})}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Je.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()&&this._animateInputAreaToTargetHeight()})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_rightControlsLayoutInfo(e,t){const s=this._showRightControls(e,t,void 0);let i,o=0;return s&&!this._showMicButton(e,t)||(o=1),s&&(this._showCameraButton(e,t)&&o++,this._showMediaPickerButton(e,t)&&o++,this._showLocationButton(e,t)&&o++,this._showBingButtonMobileUI(t)&&o++,this._showMagicBotToolboxButtonMobileUI(t)&&o++),i=o?s?Et*o:Et+(t.useCompactLayout?0:5):5,{width:i,opacity:s?1:0,isShowing:s}}_showMicButton(e,t){return!(!e.onRecording||t.phoneNumberForSendingSms||t.disableHighBandwidthOperations||A.isS4BBridgeMri(e.conversationId))}_showCameraButton(e,t){return t.isCameraAvailable&&this._showCameraOrMediaButtonCommon(e,t)}_showMediaPickerButton(e,t){return t.showAdditionalMediaBarItems&&(!t.isUsingStackNavigationContext||t.isMediaPickerInRightControlsForMobile)&&this._showCameraOrMediaButtonCommon(e,t)}_showCameraOrMediaButtonCommon(e,t){return!(e.hideMediaPickerIcon||e.hideMediaBar||t.phoneNumberForSendingSms||t.disableHighBandwidthOperations||A.isS4BBridgeMri(e.conversationId))}_showLocationButton(e,t){return!t.isUsingStackNavigationContext&&t.showAdditionalMediaBarItems&&!e.hideLocationPickerIcon&&!e.hideMediaBar&&!t.phoneNumberForSendingSms&&!t.disableHighBandwidthOperations&&!A.isS4BBridgeMri(e.conversationId)&&!Ze.default.isFireOS()}_showBingButtonMobileUI(e){return super._showBingButton(e)}_showMagicBotToolboxButtonMobileUI(e){return this._showMagicBotToolboxButton(e)&&this._showMagicBotToolboxInsteadOfBing(e.conversation,e.enableAlwaysVisibleMagicBotToolboxGroups)}_showRightControls(e,t,s){const i=n.isUndefined(s)?this._sendControlEnabled(e,t,!!e.quotedMessages):s,o=this._canCancelEdit(t,e.editedMessage);return!i&&!o&&!t.phoneNumberForSendingSms}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!t.userInputIsEmpty||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews||A.isS4BBridgeMri(e.conversationId)}_canCancelEdit(e,t){if(!t)return!1;const s=V.decode(t),i=N.toEntities(s,{supportEmoticons:!0,supportLinkEntity:!0,supportHtmlAndroid:e.enableHtmlAndroidComposer});return i.length>0?i.length===e.inputEntities.length&&i.every(((t,s)=>this._isEqualEntities(e.inputEntities[s],i[s]))):!e.hasUncommittedUserInput||e.userInputIsEmpty||e.equalsInitialContent}_isEqualEntities(e,t){return e instanceof ie.HtmlEntity?t instanceof ie.HtmlEntity?t.html===e.html:t.text()===e.html:t.text()===e.text()}_wasRegexTriggered(e){return n.includes(Vt.instantTriggers,e)||n.includes(Vt.delayedTriggers,e)}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&(ne.log($.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateUpstream set inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,editableEntities:t}))}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this._textInputRef&&this._textInputRef.setContent(ve.getEditableContentFromEditableEntities(i,s)),this.isComponentMounted()&&(ne.log($.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateDownstream inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t))}_pastePreviewCompletionHelper(e){B.default.dismissModal("PastePreviewModal",this._getRootViewId()),ne.track(new Ie.MessageComposerTelemetry(this.props.conversationId,e,Ie.MessageComposerAction.Paste))}_sendFileWithDimensions(e,t){const s=rt.default.getFileUrl(e);l.default.getImageSize(s).then((s=>{if(s&&(e.dimensions=s),this.state.isMediaPreviewEnabled)return fe.default.addPreviews([e],this.props.conversationId,t);const i={name:je.ScenarioName.SendPicture};Ue.default.postUpload([this.props.conversationId],e,t,!1,{scenarioInfo:i},this._getRootViewType())}))}_preventSendingSMSMessage(e){if(ne.log($.LogTraceArea.MessageComposer,"[MessageComposerV2] _preventSendingSMSMessage"),this.state.shouldPreventSMSTotheUS||this.state.shouldPreventSMSToNotSupportedDestination){const e=this.state.shouldPreventSMSToNotSupportedDestination?$.CantSendSmsWarningType.NotSupportedDestination:$.CantSendSmsWarningType.US;return ne.log($.LogTraceArea.MessageComposer,`[MessageComposerV2] _preventSendingSMSMessage preventing sending SMS to ${$.CantSendSmsWarningType[e]}`),xe.default.navigateToCantSendSMSWarning(e),!0}return this.state.shouldPreventSMSToInvalidNumber?(xe.default.navigateToCantSendSMSWarning($.CantSendSmsWarningType.InvalidNumber),!0):!!(1===e.length&&e[0]instanceof ie.SmsEntity&&(ne.log($.LogTraceArea.MessageComposer,"[MessageComposerV2] _preventSendingSMSMessage preventing sending SMS"),this._smsInfoLineRef&&!this._smsInfoLineRef.canSendSMS()))&&(this.state.isSmsFailureScreenEnabled?xe.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):C.default.open(this._getRootViewId()),!0)}_getQuoteEntity(e){const t=W.default.getDisplayName(e.creator,!0),s=E.quoteMessage(e,t);return new ie.QuoteEntity(s,t,e,this.props.quotesTriggerType)}_sendMessage(e){return i.__awaiter(this,void 0,void 0,(function*(){if(ne.log($.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;if(!(yield(0,_t.canSendMessageToMagicBot)(e,this.state.isMagicBotConversation)))return void this.dismissKeyboard();this._isPostingMessage=!0;const t=dt.default.newCauseId();ne.log($.LogTraceArea.MessageComposer,"sendMessage causeId: "+t);let s=[];if(this.props.quotedMessages&&this.props.quotedMessages.map((e=>s.push(this._getQuoteEntity(e)))),e.length>0&&(s=s.concat(e)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!this.state.userInputIsEmpty){if(s=[new ie.SmsEntity(this._getTextForSms(e),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(s))return ne.log($.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),this._isPostingMessage=!1,void ne.track(new wt.SmsSendStatus(wt.OneWaySmsAction.SmsCheckedAndStopped,this._smsDestinationType));ne.track(new wt.SmsSendStatus(wt.OneWaySmsAction.SmsCheckedAndSent,this._smsDestinationType))}try{const e=(0,_t.isMagicBotMentioned)(s);!e||this.state.isOneOnOneConversation||this.state.isMagicBotContainingConversation||(yield ft.default.serviceAddMemberToThread(this.props.conversationId,(0,ht.getMagicBotId)(),yt.AddMemberToThreadSource.BotAutoAdd,!(0,Pe.isModerated)(this.state.conversation)),ne.log($.LogTraceArea.MessageComposer,"sendMessage Magic bot auto-added to conversation because being mentioned."),ne.track(new pt.MagicBotAutoAddedByMention));const i=e&&this.state.enableMagicBot&&this.state.isOneOnOneConversation&&!this.state.isMagicBotConversation;if(this._needsContext(e)&&!(0,vt.isUserInputEmptyOrHasWhitespaceOnly)(s)){const e=yield(0,mt.getContext)(!this.state.isOneOnOneConversation||i,this.state.conversation);s.push(e)}this._sendOneOnOneMagicBotMessageIfNeeded(i,s),yield fe.default.sendPreviews(this.props.conversationId,t);try{const e={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:s,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,textInputRef:this._textInputRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};if(yield Gt._sendTextMessage(e)){if(this._handleAfterPostMessage(e.conversationId),ne.log($.LogTraceArea.MessageComposer,"sendMessage Message sent."),e.smsInfoLineRef){const t=e.smsInfoLineRef.getTelemetryEvent();t&&(this.state.phoneNumberForSendingSms?t.setSmsWasSent(!0):t.setSkypeMessageSent(!0))}}else ne.log($.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}finally{this._isPostingMessage=!1}}finally{this.state.hasFocus||this.requestFocus()}}))}_needsContext(e){return this.state.enableMagicBot&&gt.AIConsentService.getConsent()&&(e||this.state.isMagicBotConversation)}static _sendTextMessage(e){if((0,vt.isUserInputEmptyOrHasWhitespaceOnly)(e.inputEntities))return e.inputEntities.length?ne.log($.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):ne.log($.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),h.Resolved(!1);if(e.onMessageSent(e.inputEntities,Ce.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType))){const t=O.default.getSavedMessageInput(e.conversationId);if(t){const s=e.textInputRef&&!e.textInputRef.equalsInitialContent()||!1;ne.track(new G.DraftMessageWasSent(s,t.timestamp))}const s=e.editedMessage?he.getString("MessageComposer.MessageEditedLabel"):he.getString("MessageComposer.MessageSentLabel");return Gt._announceForAccessibility(s),We.default.isMobileScreenReaderEnabled()?nt.default.sleep(1e3).then((()=>!0)):h.Resolved(!0)}return h.Resolved(!1)}static _announceForAccessibility(e){We.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(O.default.getSavedMessageInput(e)&&(0,U.default)().fakeConversationTime(e,Date.now()),ne.log($.LogTraceArea.MessageComposer,"MessageComposer._handleAfterPostMessage"),O.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:"",inputEntities:[],editableEntities:[]}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();me.MediaBarItem.dismissPopup(e),j.default.close(e)}this._isPostingMessage=!1}_isMediabarDisabled(){return A.isS4BBridgeMri(this.props.conversationId)||!!this.state.isConversationWithPhoneNumber}}t.default=Gt},300480:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(815063),a=i.__importDefault(s(326036)),l=i.__importDefault(s(994070)),d=i.__importStar(s(6625)),c=i.__importStar(s(516778)),u=i.__importStar(s(397691)),h=i.__importStar(s(187140)),p=i.__importDefault(s(659938)),g=i.__importDefault(s(150343)),m=i.__importDefault(s(438752)),S=s(22478),_=s(865900),f=i.__importStar(s(603094)),y=s(745709),v=i.__importDefault(s(838264)),C=i.__importDefault(s(879248)),T=s(148166),M=s(843890),b=i.__importDefault(s(859545)),I=i.__importDefault(s(401189)),w=i.__importStar(s(172134)),P=i.__importStar(s(971988)),k=i.__importStar(s(44717)),A=i.__importDefault(s(135372)),x=s(154235),D=i.__importDefault(s(967328)),R=s(88942),L=i.__importStar(s(361971)),B=i.__importStar(s(559210)),F=i.__importDefault(s(892034)),N=i.__importDefault(s(615364)),E=i.__importStar(s(463519)),O=i.__importDefault(s(236041)),U=i.__importDefault(s(691821)),V=i.__importDefault(s(366535)),H=i.__importStar(s(170881)),j=i.__importDefault(s(601976)),z=s(472110),W=s(871145),G=i.__importDefault(s(794229)),K=i.__importDefault(s(37679)),q=s(815146),Q=s(445290),X=i.__importStar(s(640957)),$=s(609099),J=i.__importDefault(s(606617)),Y=s(269614),Z=s(268293),ee=i.__importDefault(s(453761)),te=i.__importDefault(s(457468)),se=i.__importStar(s(626065)),ie=i.__importStar(s(7040)),oe=i.__importStar(s(85385)),ne=i.__importDefault(s(114818)),re=i.__importDefault(s(97595)),ae=i.__importDefault(s(54945)),le=s(26703),de=i.__importStar(s(440760)),ce=i.__importStar(s(704704)),ue=i.__importDefault(s(372290)),he=i.__importDefault(s(978285)),pe=s(87780),ge=s(750585),me=s(985367),Se=i.__importStar(s(901156)),_e=i.__importDefault(s(469701)),fe=i.__importDefault(s(791612)),ye=i.__importDefault(s(574818)),ve=i.__importStar(s(500983)),Ce=i.__importStar(s(187086)),Te=i.__importDefault(s(58606)),Me=i.__importStar(s(172792)),be=s(954225),Ie=i.__importStar(s(786531)),we=s(675862),Pe=i.__importDefault(s(252089)),ke=i.__importDefault(s(201721)),Ae=i.__importDefault(s(740794)),xe=i.__importDefault(s(942724)),De=i.__importDefault(s(327400)),Re=s(54325),Le=i.__importStar(s(306194)),Be=s(137836),Fe=i.__importDefault(s(863132)),Ne=i.__importDefault(s(960282)),Ee=i.__importDefault(s(249156)),Oe=s(848523),Ue=s(96575),Ve=s(617910),He=i.__importDefault(s(791384)),je=s(712783),ze=i.__importDefault(s(160049)),We=i.__importDefault(s(776622)),Ge=i.__importDefault(s(82133)),Ke=s(337288),qe=s(873008),Qe=i.__importDefault(s(842252)),Xe=s(16549),$e=i.__importDefault(s(139221)),Je=i.__importDefault(s(20758)),Ye=s(641400),Ze=s(331079),et=s(397982),tt=i.__importDefault(s(827361)),st=i.__importDefault(s(220534)),it=i.__importDefault(s(719006)),ot=i.__importDefault(s(685734)),nt=i.__importDefault(s(760989)),rt=i.__importDefault(s(579067)),at=i.__importDefault(s(176098)),lt=i.__importDefault(s(59622)),dt=i.__importDefault(s(404136)),ct=s(717413),ut=s(854642),ht=s(216678),pt=s(333434),gt=i.__importDefault(s(843954)),mt=s(850725),St=i.__importDefault(s(404547)),_t=s(627414),ft=s(681679),yt=s(618629),vt=s(37308),Ct=i.__importDefault(s(677750)),Tt=i.__importDefault(s(943286)),Mt=s(651087),bt=s(796967),It=i.__importDefault(s(245331)),wt=i.__importDefault(s(633780)),Pt=s(5540),kt=s(759714),At=s(384860),xt=i.__importDefault(s(127336)),Dt=i.__importDefault(s(604266)),Rt=i.__importDefault(s(808164)),Lt=s(211625),Bt=s(291498),Ft=s(943265),Nt=i.__importDefault(s(811250)),Et=Xe.Color.darkMessageComposerContentBackground,Ot=Xe.Color.gray400Overlay10,Ut=d.unicodeLetterRegex,Vt={instantTriggers:[`^(@[${Ut}-]{0,16} ?[${Ut}-]{0,16})$`,`.*\\W(@[${Ut}]{0,16} ?[${Ut}]{0,16})$`,"^(/\\w{0,16})$",".*(\\([a-zA-Z:]{2,16})$",".*(\\([a-zA-Z:]{2,16}:[1-6]?)$"],delayedTriggers:[".*\\b([A-Z][A-Za-z]{2,31})$"]};var Ht;!function(e){e[e.OverflowButton=0]="OverflowButton",e[e.OverflowButtonCoachMark=1]="OverflowButtonCoachMark"}(Ht||(Ht={}));const jt=(0,le.lazyProperties)({composerArea:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row"}),compositionAreaContainer:()=>c.Styles.createViewStyle({position:"absolute",flexDirection:"row",left:0,right:0,bottom:0}),compositionArea:()=>c.Styles.createViewStyle({flex:1,justifyContent:"center"}),inputArea:()=>c.Styles.createViewStyle({flexDirection:"row"}),expandableArea:()=>c.Styles.createViewStyle({flex:1,maxHeight:96,backgroundColor:Xe.Color.transparent}),expandableAreaWithQuote:()=>c.Styles.createViewStyle({flex:1,maxHeight:48}),composerInner:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:12,marginHorizontal:16}),rightControlContainer:()=>c.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),quoteArea:()=>c.Styles.createViewStyle({flex:1,paddingTop:6,paddingLeft:12}),multiQuoteArea:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>c.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:126,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>c.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaLastMessage:()=>c.Styles.createViewStyle({marginBottom:0}),multiQuoteAreaClearButton:()=>c.Styles.createButtonStyle({alignSelf:"flex-start"}),quoteTextStyle:()=>c.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>c.Styles.createTextStyle({fontSize:Je.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),sendButton:()=>c.Styles.createViewStyle({height:50}),actionButtonWithBackground:()=>c.Styles.createViewStyle({height:40,width:40,borderRadius:20}),actionButtonVerticalCenter:()=>c.Styles.createViewStyle({alignSelf:"center"}),skypeMessageTextInput:()=>c.Styles.createTextStyle({font:Je.default.font.uiDisplayRegular,fontSize:Je.default.controlFontSize.messageComposerDesktop,minHeight:23,backgroundColor:Xe.Color.transparent}),textInputFocusButton:()=>c.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,backgroundColor:Xe.Color.transparent}),linkStyle:()=>c.Styles.createTextStyle({fontSize:Je.default.controlFontSize.body,lineHeight:18,color:Xe.Color.gray400,fontFamily:Je.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),emoteAuthor:()=>(0,le.lazyProperties)({text:()=>c.Styles.createTextStyle({fontSize:Je.default.controlFontSize.messageComposerDesktop,marginTop:7,fontStyle:"italic"}),textDesktop:()=>c.Styles.createTextStyle({marginTop:5,marginBottom:3})}),desktopOverrides:()=>(0,le.lazyProperties)({messageComposer:()=>c.Styles.createViewStyle({minHeight:48,justifyContent:"center"}),messageComposerAllRoundCorners:()=>c.Styles.createViewStyle({borderRadius:24}),messageComposerTopFlatCorners:()=>c.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:24,borderBottomRightRadius:24}),compositionAreaContainer:()=>c.Styles.createViewStyle({flexDirection:"column"}),quoteArea:()=>c.Styles.createViewStyle({flex:1,paddingTop:15,paddingBottom:0,paddingLeft:20,paddingRight:20}),compositionAreaNoPesPicker:()=>c.Styles.createViewStyle({paddingLeft:21}),compositionAreaNoRichTextEditor:()=>c.Styles.createViewStyle({paddingRight:21}),expandableArea:()=>c.Styles.createViewStyle({maxHeight:175}),expandableAreaWithQuote:()=>c.Styles.createViewStyle({maxHeight:133}),expandableAreaSmallView:()=>c.Styles.createViewStyle({maxHeight:133}),expandableAreaWithQuoteSmallView:()=>c.Styles.createViewStyle({maxHeight:91}),composerInner:()=>c.Styles.createViewStyle({marginVertical:5,marginHorizontal:2}),rightControlContainer:()=>c.Styles.createViewStyle({minHeight:48,marginLeft:4,alignItems:"flex-end"}),composerInnerIconWrapper:()=>c.Styles.createViewStyle({alignSelf:"flex-end",height:40,justifyContent:"center"})}),mediaBarWrapper:()=>c.Styles.createViewStyle({flexDirection:"row",height:50,alignItems:"center"})});let zt=45;class Wt extends vt.MessageComposerBase{constructor(){super(...arguments),this._smsDestinationType=At.DestinationType.Unknown,this._isPostingMessage=!1,this._gotInitialInputAreaHeight=!1,this._inputAreaHeight=zt,this._inputAreaTargetHeight=this._inputAreaHeight,this._inputAreaHeightValue=new c.Animated.Value(this._inputAreaHeight),this._inputAreaHeightStyle=c.Styles.createAnimatedViewStyle({height:this._inputAreaHeightValue}),this._onEmoticonSelected=e=>{this.autoReplaceText(e.text(),"Emoticon",e)},this._onStickerSelected=e=>{this.props.conversationId&&(Fe.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],P.MessageTypes.RichText,{name:Ue.ScenarioName.SendSticker},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._onGifSelected=e=>{this.props.conversationId&&(Fe.default.postMessageFromInput(this.props.conversationId,q.PostSource.MediaPicker,[e],P.MessageTypes.RichText,{name:Ue.ScenarioName.SendGif},void 0,this._getRootViewType()),this._announceForAccessibilityForMessageSent()),this._closePesPickerAndFocusTextInput()},this._closePesPickerAndFocusTextInput=()=>{this._closeUnifiedPesPickerDesktop(),this.setTextInputAccessibilityFocus()},this._onSMSInfoLineRef=e=>{this._smsInfoLineRef=e||void 0},this._onPhoneNumberForSmsSelected=e=>{const t=nt.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onPhoneNumberForSmsSelected causeId: "+t),this.state.twoWaySMSCapable?e&&Ae.default.navigateToConversation({convId:k.getMriFromPhoneNumber(e),origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t}):Ae.default.navigateToConversation({convId:this.props.conversationId,origin:q.NavigationConversationOrigin.SMSNumberSwitch,selectedNumberForSMS:e,causeId:t})},this._onVisibleSelectionRect=e=>{},this._shouldDefaultPaste=e=>!(this.state.pasteAsQuotePreference&&Te.default.hasContent(e)),this._saveMessage=e=>{if(e&&e.length>0||this._hasQuotes()||this.props.editedMessage){let t,s=Oe.SavedMessageType.None;this.props.editedMessage?(t=[this.props.editedMessage],s=Oe.SavedMessageType.Edited):this.props.quotedMessages&&(t=this.props.quotedMessages,s=Oe.SavedMessageType.Quoted),F.default.saveMessageInput(this.props.conversationId,{messages:t,type:s,inputEntities:e,inputEntitiesDataVersion:this.state.inputEntitiesDataVersion,timestamp:Date.now()})}else oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._saveMessage clearMessageInput."),F.default.clearMessageInput(this.props.conversationId)},this._onCancelPesSearch=(e,t)=>{e&&(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onCancelPesSearch clearInputText."),F.default.clearMessageInput(this.props.conversationId));const s=F.default.getSavedMessageInput(this.props.conversationId);(!s||s&&n.isEmpty(s.messages))&&(this.props.quotedMessages&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit());const i=s?s.inputEntities:[];this._setInputEntityStateDownstream(i,t),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onEditorInputRef=e=>{this._textInputRef=e||void 0},this._onClearEditMessageQuote=()=>{const e=n.head(this.state.inputEntities);this._textInputRef&&e instanceof se.QuoteEntity&&this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e)||this.state.inputEntities;this._setInputEntityStateDownstream(t.slice(1,t.length))}))},this._renderEmoticonPickerItem=e=>(0,o.jsx)(W.EmoticonPickerItem,Object.assign({},e)),this._renderGifPickerItem=e=>(0,o.jsx)(Z.GifPickerItem,Object.assign({},e)),this._renderStickerPickerItem=e=>(0,o.jsx)(qe.StickerPickerItem,Object.assign({},e)),this._renderSmsItem=e=>(0,o.jsx)(Ke.SmsItem,Object.assign({},e)),this._renderMediaPickerItem=e=>(0,o.jsx)(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.MediaOnly},e)),this._renderFilePickerItem=e=>(0,o.jsx)(X.default,Object.assign({acceptedFileTypes:X.AcceptedFileTypes.All},e)),this._renderFilePickerPopupItem=e=>(0,o.jsx)(wt.default,Object.assign({getItemDescriptors:this._getItemDescriptors,onItemSelected:this._onMediaBarItemSelected,onFocus:this._onFocus,onBlur:this._onBlur,onHandleCustomAction:this._onHandleCustomAction},e)),this._renderCameraItem=e=>(0,o.jsx)(T.CameraItem,Object.assign({},e)),this._renderScheduleCallItem=e=>(0,o.jsx)(Ve.ScheduleCallItem,Object.assign({},e)),this._renderPollItem=e=>(0,o.jsx)(Be.PollItem,Object.assign({},e)),this._renderLocationPickerItem=e=>(0,o.jsx)(he.default,Object.assign({},e)),this._renderContactPickerItem=e=>(0,o.jsx)(R.ContactPickerItem,Object.assign({},e)),this._renderBingSearchItem=e=>(0,o.jsx)(y.BingSearchItem,Object.assign({},e)),this._renderVideoMessageItem=e=>(0,o.jsx)(rt.default,Object.assign({},e)),this._renderSkypeClipsRecordItem=e=>(0,o.jsx)(Tt.default,Object.assign({},e)),this._renderWhiteboardItem=e=>(0,o.jsx)(ue.default,Object.assign({},e)),this._renderPeopleItem=e=>(0,o.jsx)(Re.PeopleItem,Object.assign({},e)),this._renderAudioMessageItem=e=>$e.default.isEdgeShoreline()?(0,o.jsx)(_.AudioMessageItem,Object.assign({},e,{onPress:this.props.onRecording})):(0,o.jsx)(_.AudioMessageItem,Object.assign({},e)),this._renderSendCreditItem=e=>(0,o.jsx)(je.SendCreditItem,Object.assign({},e)),this._renderImageGenerationItem=e=>(0,o.jsx)(Pt.ImageGenerationItem,Object.assign({},e)),this._getItemDescriptors=(e,t=!1)=>{const s=t&&this.state.disableHighBandwidthOperations,i=n.map(e,(e=>{switch(e){case Bt.MediaBarItemKeys.Bing:if(this._canShowBingButton())return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.MagicBotToolbox:if(this._canShowMagicBotToolboxButton())return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Camera:if(!this.props.hideMediaPickerIcon&&this.state.isCameraAvailable)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Sms:if(this._canShowSmsIcon())return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Emoticon:if(this._canShowEmoticonIcon())return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Location:if(this.state.showLocationPicker&&!s&&t)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Contact:if(this.state.showContactPicker)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.MediaPicker:if(!this.props.hideMediaPickerIcon&&!s&&t)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.FilePicker:case Bt.MediaBarItemKeys.FilePickerPopup:if(!this.props.hideFilePicker&&!s)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Sticker:if(!t||!this.props.hideStickerPickerIcon)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Gif:break;case Bt.MediaBarItemKeys.ScheduleCall:if(!this.props.hideScheduleCallIcon&&!s&&!this.state.isRegularMemberInModeratedGroup)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Poll:if(!this.props.hidePollIcon)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.People:return this._mediaBarItemDescriptor(e);case Bt.MediaBarItemKeys.VideoMessage:if(this.state.showVideoMessageIcon&&!s)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.Audio:if(this._canShowMicButton(this.props,this.state))return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.SendCredit:if(!this.props.hideSendCreditIcon&&!s)return this._mediaBarItemDescriptor(e);break;case Bt.MediaBarItemKeys.SkypeClipsRecord:case Bt.MediaBarItemKeys.ImageGeneration:case Bt.MediaBarItemKeys.Whiteboard:if(!s)return this._mediaBarItemDescriptor(e)}}));return n.compact(i)},this._onMediaBarRef=e=>{this._mediaBarRef=e||void 0},this._renderPesPickerPopup=()=>(0,o.jsx)(Lt.PesPickerPopup,{ref:this._onPesPickerPopupRef,renderMobileInterface:!1}),this._onPesPickerPopupRef=e=>{this._pesPickerPopup=e||void 0},this._getPesPickerPopupRef=()=>this._pesPickerPopup,this._onCustomKeyboardClose=()=>{this._pesPickerPopup&&this._pesPickerPopup.hide()},this._onLayoutInputArea=e=>{const t=Math.ceil(e.height);this._gotInitialInputAreaHeight?(this._inputAreaTargetHeight=t,this._animateInputAreaToTargetHeight()):(this._inputAreaTargetHeight=t,this._inputAreaHeight=t,this._inputAreaHeightValue.setValue(t),zt=t,this._gotInitialInputAreaHeight=!0)},this._onHandleCustomAction=(e,t)=>{switch(e){case Ze.MediaBarCustomAction.LaunchCamera:this.props.onLaunchCamera&&this.props.onLaunchCamera();break;case Ze.MediaBarCustomAction.LaunchEmoticon:Ft.EmoticonPickerTelemetry.startOpenScenario(),Ft.EmoticonPickerTelemetry.open(),this._onPickerActive(Bt.MediaBarItemKeys.Emoticon);break;case Ze.MediaBarCustomAction.LaunchSticker:Ft.StickerPickerTelemetry.open(),this._onPickerActive(Bt.MediaBarItemKeys.Sticker);break;case Ze.MediaBarCustomAction.LaunchGif:Ft.GifPickerTelemetry.open(),this._onPickerActive(Bt.MediaBarItemKeys.Gif);break;case Ze.MediaBarCustomAction.MentionBing:this._mentionMagicBot();break;default:oe.log(q.LogTraceArea.MessageComposer,"_onHandleCustomAction unhandled action: "+e)}},this._onComposerOverflowPress=()=>{oe.track(new Se.MediaBarItemPressed(Ht[Ht.OverflowButton],!0,this.props.conversationId,me.MediaBarItemOrigin.MessageComposer))},this._onDismissMediaPicker=()=>{l.default.showNativeKeyboard(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""})},this._mentionMagicBot=()=>{const e=(0,ct.getMagicBotId)(),t=j.default.getDisplayableProfile(e),s={type:d.EditableEntityType.AtMention,displayText:t.getDisplayName(),userMri:(0,ct.getMagicBotId)(),shortName:t.getShortName(),displayName:t.getDisplayName()};this._textInputRef&&this._textInputRef.insertContent(s),oe.track(new ut.MagicBotMentionedByClick)},this._onUnifiedPesPickerDesktopPress=()=>{this.state.isShowingUnifiedPesPickerDesktop||(Ft.EmoticonPickerTelemetry.startOpenScenario(),U.default.open(this._getRootViewId()))},this._closeUnifiedPesPickerDesktop=()=>{this.state.isShowingUnifiedPesPickerDesktop&&U.default.close(this._getRootViewId())},this._onPickerActive=e=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&this.setState({selectedMediaBarItem:e})},this._onEditorActive=()=>{this._textInputRef&&this._textInputRef.getContent().then(this._consumeNewUserInput),this.isComponentMounted()&&Ee.default.setVisibility(this.props.conversationId,!1)},this._onMediaBarItemSelected=e=>{this.state.selectedMediaBarItem!==e&&(this.isComponentMounted()&&this.setState({selectedMediaBarItem:e===Bt.MediaBarItemKeys.Sms?"":e}),this.props.onMediaItemSelected&&this.props.onMediaItemSelected()),e===Bt.MediaBarItemKeys.Sms&&(1===this.state.phoneNumbers.length?this._toggleSmsSending(!0,this.state.phoneNumbers[0]):We.default.showNumberSelectionPopup((()=>this._smsInfoLineRef),this._getRootViewId(),this.props.conversationId,this.state.phoneNumbers,!1).then((e=>{this._toggleSmsSending(!0,e)})).catch(n.noop))},this._onCancelEditClick=e=>{e.stopPropagation(),Wt._announceForAccessibility(ce.getString("MessageComposer.MessageEditingCanceledLabel")),this._handleAfterPostMessage(this.props.conversationId)},this._onSendButtonClick=e=>{e.stopPropagation(),this._textInputRef&&(oe.track(new Ie.MessageComposerControlEvent(Ie.MessageComposerControls.SendButton,Ie.MessageComposerControlAction.Click)),this._textInputRef.getContent().then((e=>{const t=this._consumeNewUserInput(e);t?this._sendMessage(t):this._setInputEntityStateDownstream(this.state.inputEntities)})))},this._onInputButtonRef=e=>{this._inputButton=e||void 0},this.insertSearchResult=(e,t,s)=>{Wt._announceForAccessibility(e),this.autoReplaceText(e,t,s)},this.autoReplaceText=(e,t,s)=>{if(c.UserInterface.isNavigatingWithKeyboard()&&this.state.selectedMediaBarItem&&ge.MediaBarItem.dismissPopup(this._getRootViewId()),"Emoticon"===t){const e=ce.getString("MessageComposer.AccessibilityAnnouncement_EmoticonInserted");Wt._announceForAccessibility(e)}else Wt._announceForAccessibility(e);if(this._textInputRef){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(s,this.state.emoticons);this._textInputRef.insertContent(e),this._textInputRef.requestFocus(),this._textInputRef.getContent().then((e=>{this.isComponentMounted()&&this._consumeNewUserInput(e)}))}},this._onAutoCompletionRequested=(e,t)=>(this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this._wasRegexTriggered(t)&&(this._pendingMessageTextCompletionPromise=u.Defer(),this.props.onInputTextChanged(e,!1)),this._pendingMessageTextCompletionPromise?this._pendingMessageTextCompletionPromise.promise():u.Rejected()),this._onAutoCompletionRequestAborted=()=>{this._cancelAutoCompletionIfActive()},this._onAutoCompletionNavigationKey=e=>{if(this.props.onKeyPress&&this.props.onKeyPress(e),e.keyCode===ae.default.ESCAPE)this._cancelAutoCompletionIfActive()},this._onUserInputActive=()=>{it.default.setComposingState(!0,this.props.conversationId)},this._onUserInputInactive=()=>{it.default.setComposingState(!1,this.props.conversationId)},this._onUserInputCommitted=e=>{const t=this._consumeNewUserInput(e);t&&(it.default.setComposingState(!1,this.props.conversationId),this._sendMessage(t))},this._onPastingText=e=>{this.isComponentMounted()&&this.setState({messageComposerPastedContentType:e})},this._setComposingStateInactiveDebounced=n.debounce((()=>{it.default.setComposingState(!1,this.props.conversationId)}),300,{leading:!0,trailing:!0}),this._onUserInputAborted=()=>{this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.Emoticon||this.state.isShowingUnifiedPesPickerDesktop||(this._setComposingStateInactiveDebounced(),this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.props.editedMessage&&(this.props.onClearEdit&&this.props.onClearEdit(),oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._onUserInputAborted."),F.default.clearMessageInput(this.props.conversationId)),this._cancelAutoCompletionIfActive())},this._onUserInputEmptyIndicationChanged=e=>{this.isComponentMounted()&&this.setState({userInputIsEmpty:e}),this.props.onNativeComposerMessageEmptyStateChanged&&this.props.onNativeComposerMessageEmptyStateChanged()},this._onUserInputUncommittedChangesIndicationChanged=e=>{this.isComponentMounted()&&this.setState({hasUncommittedUserInput:e})},this._onEqualsInitialContentIndicationChanged=e=>{this.isComponentMounted()&&this.setState({equalsInitialContent:e})},this._onUserInputBackspacePressedAtHeadPos=()=>{this._hasQuotes()&&this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0),this.state.userInputIsEmpty&&this.props.editedMessage&&this.props.onClearEdit&&this.props.onClearEdit()},this._onAccessibilityAnnouncementRequested=e=>{if(e===d.AccessibilityAnnouncement.NewLineAdded)c.Accessibility.announceForAccessibility(ce.getString("MessageComposer.AccessibilityAnnouncement_NewlineAdded"))},this._onEmoticonLoadCompleted=e=>{oe.track(new Le.ComposerEmoticonLoaded(e,xe.default.isUsingStackNavigationContext()))},this._onPartiallyEnteredMsgStoreUpdated=e=>{if(e===this.props.conversationId){const t=F.default.getSavedMessageInput(e);t&&t.inputEntitiesDataVersion===this.state.inputEntitiesDataVersion&&this._setInputEntityStateUpstream(t.inputEntities)}},this._consumeNewUserInput=e=>{let t;return e.downStreamDataVersion===this.state.inputEntitiesDataVersion&&(t=ie.applyEditableContentToInputEntities(e,this.state.inputEntities),this._setInputEntityStateUpstream(t)),t},this._onCompositionAreaPress=e=>{this.state.hasFocus||this._hasQuotes()||this.requestFocus()},this._onCompositionAreaKeyPress=e=>{e.keyCode===ae.default.ESCAPE&&this.isComponentMounted()&&this._moreButton&&this._moreButton.requestFocus()},this._onFocus=()=>{const e={hasFocus:!0};this.isComponentMounted()&&this.setState(e)},this._onBlur=()=>{const e={hasFocus:!1};this.isComponentMounted()&&this.setState(e),this.props.onBlur&&this.props.onBlur()},this._onPaste=e=>{if(!this._shouldDefaultPaste(e.nativeEvent)&&this.props.onKeyboardPaste)return void this.props.onKeyboardPaste(e);const t=e.nativeEvent;this.props.disableCopyPasteMedia||n.isEmpty((0,Y.get)(t,["clipboardData","items"]))||n.some(t.clipboardData.items,(e=>"text/plain"===e.type))||(n.each(t.clipboardData.items,(t=>{if("image/png"===t.type){e.stopPropagation(),e.preventDefault();const s=new FileReader;let i=t.getAsFile();if(i instanceof e.nativeEvent.target.ownerDocument.defaultView.Blob){const e="image_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".png",t=n.attempt((t=>new File([t],e,{type:t.type})),i);n.isError(t)||(i=t),s.onload=()=>{if(i&&i.size>0){const e={file:i,extension:J.default.extractFileExtension(i.name)};this._sendFileWithDimensions(e,q.PostSource.Clipboard)}},s.readAsDataURL(i)}}})),Wt._announceForAccessibility(ce.getString("MessageComposer.FilesSentLabel")))},this._getQuoteEntity=e=>{const t=j.default.getDisplayName(e.creator,!0),s=B.quoteMessage(e,t);return new se.QuoteEntity(s,t,e,this.props.quotesTriggerType)},this._announceForAccessibilityForMessageSent=()=>{n.defer((()=>{this.isComponentMounted()&&Wt._announceForAccessibility(ce.getString("MessageComposer.MessageSentLabel"))}))},this._handleEmoticonBackspacePress=e=>{this._textInputRef&&this._textInputRef.notifyBackspacePressedExternally()},this._showFilePicker=(e,t)=>{if(t!==this._getRootViewId())return!1;if(this.state.editable&&M.UICapabilities.desktopFilePickerSupported()&&!k.isPhoneMri(this.props.conversationId)&&!k.isS4BBridgeMri(this.props.conversationId)){const t=e=>{const t=J.default.extractFileExtension(e.file.name),s=this._getRootViewType();if(J.default.isVideoExtension(t)){const t={name:Ue.ScenarioName.SendVideo};Fe.default.postVideoWithThumbnail([this.props.conversationId],e,q.PostSource.MediaPicker,!1,t,void 0,void 0,void 0,s).then((()=>{Wt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else if(J.default.isImageExtension(t)){const t={name:Ue.ScenarioName.SendPicture};Fe.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{Wt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}else{const t={name:Ue.ScenarioName.SendFile};Fe.default.postUpload([this.props.conversationId],e,q.PostSource.MediaPicker,!1,{scenarioInfo:t},s).then((()=>{Wt._announceForAccessibility(ce.getString("MessageComposer.FileSentLabel"))}))}this.requestFocus()};$.FilePickerUtils.isDocumentPickerSupported()?$.FilePickerUtils.showDocumentPicker(t,this._getRootViewId()):$.FilePickerUtils.showMultiFilesPicker(t,Se.FilePickerOrigin.MessageComposer,void 0,this._getRootViewId(),e)}return!0},this._editLastMessageKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this._editLastMessage(),!0),this._focusKeyboardShortcut=(e,t)=>t===this._getRootViewId()&&(this.requestFocus(),!0),this._editLastMessage=()=>{this.props.onEditLastMessage&&this.props.onEditLastMessage()},this._updateAndStoreDraftInputEntitiesFromContent=e=>(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._updateAndStoreDraftInputEntitiesFromContent causeId: "+e),this._textInputRef?this._textInputRef.getContent().then((e=>F.default.updateInputEntitiesFromContent(this.props.conversationId,e).commit(this.props.conversationId).storeSavedMessage(this.props.conversationId))):u.Resolved()),this._validateUrl=e=>st.default.isUrlValid(e),this._setContent=(e,t)=>{oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._setContent, inputEntities length: "+(null==e?void 0:e.length)),this._setInputEntityStateDownstream(e,(()=>{t&&this.requestFocus()}))},this.requestFocus=()=>{this._textInputRef&&(r.BrowserEnvironment.isEngineEdgeHTML()&&document.activeElement&&document.activeElement.blur(),this._textInputRef.requestFocus())},this.blur=()=>{this._textInputRef&&this._textInputRef.blur()},this.focusVideoButton=()=>{const e=this._mediaBarRef?this._mediaBarRef.getItemById(Bt.MediaBarItemKeys.VideoMessage):void 0;e&&e.requestFocus()},this.focusSendButton=()=>{this._inputButton&&this._inputButton.requestFocus()},this.focusOverflowButton=()=>{},this.setTextInputAccessibilityFocus=()=>{this._textInputRef&&(this.state.isSmallOrTinyScreen||this._textInputRef.setAccessibilityFocus(),this.props.explicitAccessibilityAnnoucement&&c.Accessibility.announceForAccessibility(this._placeholderText))}}_buildState(e,t){var s,i;const o=super._buildState(e,t),a=ke.default.getUserPreferencesLocal(),l=g.default.getS4LMessagingFeatures(),c=(0,N.default)().getConversation(e.conversationId),{enableMagicBot:u,enableReplyMessageUnifiedUI:h,enableHtmlComposer:p}=l,m=(0,ct.isMagicBotConversation)(e.conversationId),S=(0,ct.isMagicBotContainingConversation)(c),_=Object.assign(Object.assign({},o),{enableMagicBot:u,isMagicBotConversation:m,isMagicBotContainingConversation:S,conversation:c,enableReplyMessageUnifiedUI:h,enableHtmlComposer:p}),y=this.props,v=this._getRootViewId(),T=g.default.getS4LCommerceFeatures();t&&(_.inputEntities=e.initialInputEntities||[],_.inputEntitiesDataVersion=e.initialInputEntitiesDataVersion||0,_.hasFocus=!1,_.selectedMediaBarItem="",_.offsetTop=0,_.userInputIsEmpty=n.isEmpty(_.inputEntities),_.hasUncommittedUserInput=!1,_.equalsInitialContent=!0,_.currentNumberOfIconsInMediaBar=this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav||$e.default.isEdgeShoreline()?1:3,_.pesPickerKeyboardHeight=276,_.messageComposerPastedContentType=null!==(s=e.pastedTextType)&&void 0!==s?s:d.PastedTextType.None);const w=k.isOneOnOneConversation(e.conversationId);_.delayedTriggersWaitTime=l.composerAutoCompletionDelay,_.mediaBarMenuOrder=this._mediaBarMenuOrder(It.default.isSkypeClipsRecordingEnabled()&&-1===l.mediaBarMenuOrder.indexOf(Bt.MediaBarItemKeys.SkypeClipsRecord)?[...l.mediaBarMenuOrder,Bt.MediaBarItemKeys.SkypeClipsRecord]:l.mediaBarMenuOrder),_.isConversationWithPhoneNumber=k.isConversationWithPhoneNumber(e.conversationId),_.enableHandlingHTMLonPaste=l.enableHandlingHTMLonPaste,_.isSmallOrTinyScreen=Ne.default.isSmallOrTinyScreenSize(v)||r.EnvironmentInfo.isMobile(),_.editable=!De.default.isAnimationPending()&&!e.disableActionOnMessageComposer,_.isSmallHeightView=Ne.default.isSmallDesktopHeightView(v),_.viewportWidth=e.availableWidth||Ne.default.getWidth(v),_.showAdditionalMediaBarItems=_.viewportWidth>=360,_.gradientColors=Pe.default.getGradientColors(),_.emoticons=G.default.getEmoticons(),_.isShowingUnifiedPesPickerDesktop=!e.hideMediaBar&&U.default.shouldShow(v),_.messageStreamFontSize=ke.default.getMessageStreamFontSize(),_.canUseAddins=b.default.addins().canUseAddins,_.editableEntities=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(_.inputEntities||[],_.emoticons);const{selectedTabType:P,searchQuery:A}=U.default.getPickerSearchProps();_.selectedTabType=P,_.searchQuery=A,_.isEncryptedThreadThread=k.isEncryptedThread(e.conversationId),_.showLocationPicker=!e.hideLocationPickerIcon&&l.enableLocationSharingOnDesktopAndWeb&&!$e.default.isFireOS(),_.showContactPicker=!e.hideContactPickerIcon&&b.default.contacts().canInvitePeople,_.showVideoMessageIcon=!e.hideVideoMessageIcon&&!_.isEncryptedThreadThread&&g.default.isDesktopVIMEnabled()&&(O.default.isAVDeviceReady()||r.BrowserEnvironment.isChrome()),_.phoneNumbers=e.otherPartyMri&&ot.default.getFullUserProfileByMri(e.otherPartyMri).phones||[];const x=k.isPhoneMri(e.conversationId);_.creditEntitlement=K.default.getCreditEntitlement(),_.isOneOnOneConversation=w,_.enableOnewaySms=(x||T.smsPromo.unpaidUserEnabled||!!f.getPositiveCreditBalance(_.creditEntitlement)||K.default.userHasSubscriptions())&&(x||w)&&_.phoneNumbers.length>0&&!e.editedMessage&&!e.hideSmsIcon&&!k.isEncryptedThread(e.conversationId),_.quoteTextForSms=this._getQuotedTextForSms(y.quotedMessages,e.quotedMessages),_.disableHighBandwidthOperations=te.default.isUsingGogoNetwork(),_.isCameraAvailable=M.UICapabilities.cameraSupported()&&I.default.isCameraAvailable(),_.sendMessageWithEnter=a.sendMessageWithEnter,_.pasteAsQuotePreference=a.pasteAsQuotesEnabled,_.twoWaySMSCapable=!!(null===(i=C.default.getCallerIdPrimaryNumber())||void 0===i?void 0:i.smsCapable);let D=e.phoneNumberForSendingSms;if(!D&&k.isPhoneMri(e.conversationId)){const t=k.getPhoneNumberFromMri(e.conversationId);t&&(D={number:t,type:Ze.PhoneNumberTypes.Other})}_.phoneNumberForSendingSms=D,_.isMediaPreviewEnabled=fe.default.isMediaPreviewEnabled(e.conversationId),_.hasMediaPreviews=_.isMediaPreviewEnabled&&ye.default.getPreviews(e.conversationId).length>0,_.isSmsFailureScreenEnabled=_.enableOnewaySms&&T.callFailure.smsFailurePrompt.enabled,_.isRegularMemberInModeratedGroup=c&&(0,we.isRegularMemberInModeratedGroup)(c),_.richTextEditorVisible=Ee.default.panelOpened(e.conversationId),_.isToneRewritePanelOpen=Ct.default.isPanelOpen();const R=T.cantSendSmsToTheUSWarning.enabled,L=C.default.getCallerIdPrimaryNumber(),B=xt.default.getSmsRateByPhoneNumberSafely(null==D?void 0:D.number);_.shouldPreventSMSTotheUS=(0,bt.shouldPreventSMSTotheUS)(R,null==B?void 0:B.fullRateInfo,L);const F=T.cantSendSmsToCNWarning.enabled;return _.shouldPreventSMSToNotSupportedDestination=(0,bt.shouldPreventSMSToNotSupportedDestination)(F,null==D?void 0:D.number,null==B?void 0:B.fullRateInfo),_.shouldPreventSMSToInvalidNumber=T.cantSendSmsToInvalidNumber.enabled&&!Rt.default.getPhoneNumberDetails(null==D?void 0:D.number).isValidNumber,t&&(ze.default.setDefault(),ze.default.commitNextFlowId(),this._checkForOutgoingSmsMessagesInConversation(_)),_}componentDidMount(){if(super.componentDidMount(),this._dataUpdateSubscription=d.dataUpdateReceivedEvent.subscribe((({forCustomContext:e,newContent:t})=>{e===this.props.conversationId&&this._consumeNewUserInput(t)})),k.isPhoneMri(this.props.conversationId)){const e=k.getPhoneNumberFromMri(this.props.conversationId);e&&Dt.default.getSortedUsersByPhoneNumberAsync(e).then((e=>{(null==e?void 0:e.length)>0?this._smsDestinationType=At.DestinationType.ContactNumber:this._smsDestinationType=At.DestinationType.PhoneNumber})).catch(n.noop)}else k.isSkypeIdMri(this.props.conversationId)&&(this._smsDestinationType=At.DestinationType.Contact);g.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&(de.default.addObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._appStateSubscription=p.default.subscribeForChanges("MessageComposerWithPopup",(e=>{if((!this._textInputRef||this._textInputRef.hasUncommittedChanges())&&n.includes([c.Types.AppActivationState.Inactive,c.Types.AppActivationState.Background],e)){const e=nt.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._appStateSubscription causeId: "+e),this._updateAndStoreDraftInputEntitiesFromContent(e).then((()=>{const e=F.default.getConversationsNumber();e>0&&oe.track(new z.DraftMessageAppExitWithDrafts(e))})).catch(n.noop)}}))),c.Modal.isDisplayed()||!this._shouldAutoFocusInput()&&!this.props.shouldAutoFocus||this.props.preventFocusOnMount||this.requestFocus(),this.state.overrideEditable&&this.setState({overrideEditable:void 0}),this._textInputRef&&this.setState({userInputIsEmpty:this._textInputRef.isEmpty(),hasUncommittedUserInput:this._textInputRef.hasUncommittedChanges(),equalsInitialContent:this._textInputRef.equalsInitialContent()});const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{!e&&l.default.isSupported()&&l.default.dismiss()}))),re.default.addHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.addHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.addHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),this._keyboardDismissRegistrationHandle=H.register(this),F.default.onInputEntitiesUpdatedEvent.subscribe(this._onPartiallyEnteredMsgStoreUpdated),this.state.enableMagicBot&&this.state.isMagicBotContainingConversation&&gt.default.fetchLocation(),ve.maybeRefreshCallerIdData(!0,this.state.isConversationWithPhoneNumber),this._contentSetSubscriptionToken=(0,yt.subscribeToContentSetEvent)(this._setContent)}_checkForOutgoingSmsMessagesInConversation(e){e.enableOnewaySms&&w.didUserSendSmsInLast30Days(this.props.conversationId).then((e=>{this.isComponentMounted()&&this.setState({hasOutgoingSmsInConversation:e})}))}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t);let s=!1;const i={};this.props.conversationId&&e.conversationId&&this.props.conversationId===e.conversationId||(s=!0,i.inputEntities=this.props.initialInputEntities||[],i.inputEntitiesDataVersion=this.state.inputEntitiesDataVersion+1,i.hasOutgoingSmsInConversation=!1,i.phoneNumberForSendingSms=void 0,this._checkForOutgoingSmsMessagesInConversation(this.state));let o=[];if(e.initialInputEntities&&e.initialInputEntities!==this.props.initialInputEntities&&(s=!0,o=e.initialInputEntities),e.editedMessage&&e.editedMessage!==this.props.editedMessage){const t=E.decode(e.editedMessage);o=L.toEntities(t,{supportEmoticons:!0,supportLinkEntity:!0,supportHTML:this.state.enableHtmlComposer}),s=!0,i.phoneNumberForSendingSms=void 0}this.props.editedMessage&&!e.editedMessage&&(s=!0,i.phoneNumberForSendingSms=void 0,this.state.inputEntities.length&&this.state.inputEntities[0]instanceof se.EmoteEntity&&(o=[])),s&&(this._setInputEntityStateDownstream(o),this.setState(i))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=e.conversationId!==this.props.conversationId;let o=this.state.selectedMediaBarItem,n=!1;e&&e.conversationId&&this.props.conversationId&&!i||(n=this._shouldAutoFocusInput());const r=this._hasQuotes()&&!(0,ne.default)(this.props.quotedMessages,e.quotedMessages),a=this.props.editedMessage&&!(0,ne.default)(this.props.editedMessage,e.editedMessage),l=this.state.hasMediaPreviews&&this.state.hasMediaPreviews!==t.hasMediaPreviews;if((0,ne.default)(this.props.quotedMessages,e.quotedMessages)&&(0,ne.default)(this.props.editedMessage,e.editedMessage)&&(0,ne.default)(t.inputEntities,this.state.inputEntities)||this._saveMessage(this.state.inputEntities),n=r||a||l,!e.inlineSearchModeActive&&this.props.inlineSearchModeActive&&(o=""),n&&this.requestFocus(),!t.enableOnewaySms&&this.state.enableOnewaySms&&this._checkForOutgoingSmsMessagesInConversation(this.state),this.state.userInputIsEmpty&&this.state.hasUncommittedUserInput){const e=F.default.getSavedMessageInput(this.props.conversationId);e&&e.type===Oe.SavedMessageType.None&&(oe.track(new z.DraftMessageDeleted(e.timestamp)),oe.log(q.LogTraceArea.MessageComposer,"MessageComposer.componentDidUpdate clear invalid draft."),F.default.clearMessageInput(this.props.conversationId))}this.state.hasFocus&&!this.state.userInputIsEmpty&&A.default.hideCurrentCoachMark(),this.setState({selectedMediaBarItem:o}),i&&this._updateAndStoreDraftInputEntitiesFromContent(nt.default.newCauseId()),!t.isShowingUnifiedPesPickerDesktop&&this.state.isShowingUnifiedPesPickerDesktop&&Ct.default.closePanel(),!t.isToneRewritePanelOpen&&this.state.isToneRewritePanelOpen&&U.default.close(this._getRootViewId()),ve.maybeRefreshCallerIdData(i,this.state.isConversationWithPhoneNumber)}componentWillUnmount(){super.componentWillUnmount(),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._dataUpdateSubscription&&(this._dataUpdateSubscription.unsubscribe(),this._dataUpdateSubscription=void 0),F.default.commit(this.props.conversationId),g.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&F.default.storeSavedMessage(this.props.conversationId),de.default.removeObserver(de.LifecycleEventType.ON_EXIT,this._updateAndStoreDraftInputEntitiesFromContent),this._customKeyboardDidHideListener&&(this._customKeyboardDidHideListener.remove(),this._customKeyboardDidHideListener=void 0),this._nativeKeyboardDidHideListener&&(this._nativeKeyboardDidHideListener.remove(),this._nativeKeyboardDidHideListener=void 0),this._customKeyboardSeenListener&&(this._customKeyboardSeenListener.remove(),this._customKeyboardSeenListener=void 0),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._contentSetSubscriptionToken&&(this._contentSetSubscriptionToken.unsubscribe(),this._contentSetSubscriptionToken=void 0),l.default.isSupported()&&l.default.dismiss(),this._textInputRef&&this._textInputRef.dismissKeyboard(),re.default.removeHandler(q.KeyboardShortcut.SendFile,this._showFilePicker),re.default.removeHandler(q.KeyboardShortcut.EditMessage,this._editLastMessageKeyboardShortcut),re.default.removeHandler(q.KeyboardShortcut.FocusMessageComposer,this._focusKeyboardShortcut),H.unregister(this._keyboardDismissRegistrationHandle),F.default.onInputEntitiesUpdatedEvent.unsubscribe(this._onPartiallyEnteredMsgStoreUpdated),m.default.disableTooltip(S.EngagementTooltipType.ExpressionPicker),kt.MessageComposerSendButtonTelemetry.inactive()}_overflowActions(){return{onItemSelected:this._onMediaBarItemSelected,onCustomAction:this._onHandleCustomAction,mediaBarItems:this._getOverflowItemDescriptors(),onFocus:this.requestFocus,onBlur:this.blur}}render(){const e=[jt.composerInner,jt.desktopOverrides.composerInner];let t;const s=[jt.skypeMessageTextInput,this._themeStyles.primaryTextColorStyle];this.state.isSmallHeightView?(t=this.props.quotedMessages?[jt.expandableAreaWithQuote,jt.desktopOverrides.expandableAreaWithQuoteSmallView]:[jt.expandableArea,jt.desktopOverrides.expandableAreaSmallView],s.push(this.props.quotedMessages?jt.desktopOverrides.expandableAreaWithQuoteSmallView:jt.desktopOverrides.expandableAreaSmallView)):(t=this.props.quotedMessages?[jt.expandableAreaWithQuote,jt.desktopOverrides.expandableAreaWithQuote]:[jt.expandableArea,jt.desktopOverrides.expandableArea],s.push(this.props.quotedMessages?jt.desktopOverrides.expandableAreaWithQuote:jt.desktopOverrides.expandableArea));const i=[tt.default.flexOne,jt.desktopOverrides.messageComposer];if(this._themeStyles.messageComposerBackgroundStyle&&i.push(this._themeStyles.messageComposerBackgroundStyle),this.state.isShowingUnifiedPesPickerDesktop||this.state.isToneRewritePanelOpen?i.push(jt.desktopOverrides.messageComposerTopFlatCorners):i.push(jt.desktopOverrides.messageComposerAllRoundCorners),i.push(c.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceSecondary},!1)),this._getContext().mode.isAccessible&&i.push(c.Styles.createViewStyle({borderWidth:1,borderColor:this._getContext().themeColors.dividerPrimary},!1)),this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal){const e=Me.getStyleFromStyle(s,this.state.messageStreamFontSize);s.push(e)}const n=!!this.props.quotedMessages&&this.props.quotedMessages.length>0&&!this.props.hideContentInMessageComposer,r=this.props.hideContentInMessageComposer?void 0:this._renderTextInput(t,s,n),a=this._getRightIcon()||this._getMediaBar(!0),l=[jt.rightControlContainer,jt.desktopOverrides.rightControlContainer],d=this._getEmoticonPickerItem(),u=this._getContext().isPresentedByMobileStackNavigator?void 0:this._getRichtextEditorItem(),h=[jt.compositionArea,d?void 0:jt.desktopOverrides.compositionAreaNoPesPicker,u?void 0:jt.desktopOverrides.compositionAreaNoRichTextEditor],p=(0,o.jsxs)(c.View,{style:h,children:[this._renderEmoteAuthor(),r]}),g=(0,o.jsx)(c.View,{style:i,importantForAccessibility:c.Types.ImportantForAccessibility.No,onPress:this._onCompositionAreaPress,onKeyPress:this._onCompositionAreaKeyPress,disableTouchOpacityAnimation:!0,children:(0,o.jsx)(c.Animated.View,{style:this._inputAreaHeightStyle,children:(0,o.jsxs)(c.View,{style:[jt.compositionAreaContainer,jt.desktopOverrides.compositionAreaContainer],onLayout:this._onLayoutInputArea,children:[this._renderRichtextEditor(),n&&this._renderQuoteArea(),this._getMediaPreviewPanel(),(0,o.jsxs)(c.View,{style:e,children:[d,p,u]})]},"composition")})});return(0,o.jsxs)(c.View,{style:jt.composerArea,children:[(0,o.jsxs)(c.View,{style:tt.default.flexOne,children:[this._renderSmsInfoLine(),this._renderToneRewritePanel(),this._renderPesPicker(),g]}),(0,o.jsx)(c.View,{style:l,children:a})]})}dismissKeyboard(){this._textInputRef&&this._textInputRef.dismissKeyboard()}_getQuotedTextForSms(e,t){return t&&e!==t?n.join(t.map((e=>this._getQuoteEntity(e).textForSMS()))):""}_renderQuoteArea(){return this.state.enableReplyMessageUnifiedUI?(0,o.jsx)(dt.default,{quotedMessages:this.props.quotedMessages,onClearQuotedMessage:this.props.onClearQuotedMessage,onClearEditMessageQuote:this._onClearEditMessageQuote,showTranslatedMessage:this.props.showTranslatedMessage,disableActions:this.props.disableActionOnMessageComposer,editedMessage:this.props.editedMessage,inputEntities:this.state.inputEntities,messageStreamFontSize:this.state.messageStreamFontSize}):(0,o.jsx)(lt.default,{quotedMessages:this.props.quotedMessages,onClearQuotedMessage:this.props.onClearQuotedMessage,onClearEditMessageQuote:this._onClearEditMessageQuote,showTranslatedMessage:this.props.showTranslatedMessage,disableActions:this.props.disableActionOnMessageComposer,editedMessage:this.props.editedMessage,inputEntities:this.state.inputEntities,messageStreamFontSize:this.state.messageStreamFontSize})}_getRightIcon(){const e=Ye.IconSize.size20;let t;if(this._canCancelEdit(this.state,this.props.editedMessage)){const s=[jt.actionButtonWithBackground,jt.actionButtonVerticalCenter,this._themeStyles.buttonBackgroundColorStyle];return t=this._themeStyles.buttonBackgroundHoverColorStyle,(0,o.jsx)(ee.default,{title:ce.getString("MessageComposer.CancelEditButtonTitle"),ref:this._onInputButtonRef,onPress:this._onCancelEditClick,size:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,style:s,hoverStyle:t,icon:Ye.SkypeIcon.Cancel})}if(this._sendControlEnabled(this.props,this.state,this._hasQuotes())){const t=this.props.disableActionOnMessageComposer||!!this.state.phoneNumberForSendingSms&&this.state.userInputIsEmpty;return t||kt.MessageComposerSendButtonTelemetry.activeAndTryTrack(),(0,o.jsx)(h.default,{title:ce.getString(this.props.editedMessage?"MessageComposer.EditButtonTitle":"MessageComposer.SendButtonTitle"),ref:this._onInputButtonRef,onPress:this._onSendButtonClick,size:h.ActionButtonSize.Small,iconSize:e,style:jt.sendButton,icon:Ye.SkypeIcon.Send,flipIcon:this._getContext().isRTL,disabled:t})}kt.MessageComposerSendButtonTelemetry.inactive()}_getMediaPreviewPanel(){if(this.state.isMediaPreviewEnabled)return(0,o.jsx)(_e.default,{conversationId:this.props.conversationId})}_renderPesPicker(){if(this.state.isShowingUnifiedPesPickerDesktop)return(0,o.jsxs)(c.View,{children:[(0,o.jsx)(V.default,{availableWidth:this.props.availableWidth,pesPickerPopupRef:this._getPesPickerPopupRef,onEmoticonSelected:this._onEmoticonSelected,onStickerSelected:this._onStickerSelected,onGifSelected:this._onGifSelected,onClose:this._closeUnifiedPesPickerDesktop,showCategorySwitcher:!0,selectedTabType:this.state.selectedTabType,searchQuery:this.state.searchQuery}),this._renderPesPickerPopup()]})}_renderRichtextEditor(){var e;const t={conversationId:this.props.conversationId,textInputRef:this._textInputRef,isTopPanel:!this.state.isShowingUnifiedPesPickerDesktop&&!this.state.isToneRewritePanelOpen};return this.state.richTextEditorVisible?this.state.enableHtmlComposer?null===(e=this._textInputRef)||void 0===e?void 0:e.getToolbar(t):(0,o.jsx)(at.default,Object.assign({},t)):void 0}_renderToneRewritePanel(){return this.state.isToneRewritePanelOpen?(0,o.jsx)(Mt.ToneRewriteComposerPanel,{}):void 0}_getTextForSms(e){return`${this.state.quoteTextForSms}${ie.getRawText(e)}`}_renderSmsInfoLine(){if(this.state.enableOnewaySms)return(0,o.jsx)(Ge.default,{rawTextInput:this._getTextForSms(this.state.inputEntities),conversationId:this.props.conversationId,phoneNumbers:this.state.phoneNumbers,onPhoneNumberSelected:this._onPhoneNumberForSmsSelected,selectedPhoneNumber:this.state.phoneNumberForSendingSms,creditEntitlement:this.state.creditEntitlement,ref:this._onSMSInfoLineRef,disabled:this.props.disableActionOnMessageComposer,preventAccessibilityFocus:this.props.preventAccessibilityFocus,isSmsFailureScreenEnabled:this.state.isSmsFailureScreenEnabled})}_renderEmoteAuthor(){const e=n.head(this.state.inputEntities);if(this.props.editedMessage&&e instanceof se.EmoteEntity){const t=[jt.emoteAuthor.text,jt.emoteAuthor.textDesktop,this._themeStyles.primaryTextColorStyle],s=e.fallbackText.trim();return(0,o.jsx)(c.View,{children:(0,o.jsx)(c.Text,{style:t,children:s+"…"})})}}_getDefaultPlaceholderText(){return this.state.phoneNumberForSendingSms?ce.getString("MessageComposer.SmsMessagePlaceholderText"):ce.getString("MessageComposer.MessagePlaceholderShortText")}_renderTextInput(e,t,s=!1){const i=this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.MediaPicker||this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.Emoticon||this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.Gif||this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.Sticker||this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.Richtext?(0,o.jsx)(c.Button,{style:jt.textInputFocusButton,onPress:this._onDismissMediaPicker,importantForAccessibility:c.Types.ImportantForAccessibility.No}):void 0;this._placeholderText=s?"":this._getDefaultPlaceholderText();let n=Je.default.controlFontSize.messageComposerDesktop;this.state.messageStreamFontSize!==be.MessageStreamFontSize.Normal&&(n=Me.getSize(n,this.state.messageStreamFontSize));const r={importantForAccessibility:"yes",onVisibleSelectionRect:this._onVisibleSelectionRect,accessibilityLabel:this._getDefaultPlaceholderText(),style:t,agnosticContentBackgroundColor:this._useDarkTheme()?Et:Ot,atMentionBackgroundColor:this._themeColors.surfaceAccent,linkTextColor:this._themeColors.textPrimary,lineHeight:Math.round(1.2*n),maxLength:this.props.maxLength,onFocus:this._onFocus,onBlur:this._onBlur,onPaste:this._onPaste,placeholder:this._placeholderText,placeholderTextColor:this._themeColors.textSecondary,keyboardAppearance:this._useDarkTheme()?"dark":"default",useGraphicalEmoticons:!0,enterKeyOnExtKeyboardSendsMessage:this.state.sendMessageWithEnter,editable:void 0!==this.state.overrideEditable?this.state.overrideEditable:this.state.editable,initialContent:ve.getEditableContentFromEditableEntities(this.state.editableEntities,this.state.inputEntitiesDataVersion),customContext:this.props.conversationId,intermediateContentUpdatedEventInterval:500,onNewContentCommitted:this._onUserInputCommitted,onNewContentAborted:this._onUserInputAborted,onEmptyIndicationChanged:this._onUserInputEmptyIndicationChanged,onUncommittedChangesIndicationChanged:this._onUserInputUncommittedChangesIndicationChanged,onEqualsInitialContentChanged:this._onEqualsInitialContentIndicationChanged,onEditLastMessageRequested:this._editLastMessage,onAccessibilityAnnouncementRequested:this._onAccessibilityAnnouncementRequested,onComposingActive:this._onUserInputActive,onComposingInactive:this._onUserInputInactive,onBackspacePressedAtHeadPosition:this._onUserInputBackspacePressedAtHeadPos,onEmoticonLoadCompleted:this._onEmoticonLoadCompleted,autoCompletionTriggers:Vt,onAutoCompletionRequested:this._onAutoCompletionRequested,onAutoCompletionRequestAborted:this._onAutoCompletionRequestAborted,onAutoCompletionNavigationKey:this._onAutoCompletionNavigationKey,delayedTriggersWaitTime:this.state.delayedTriggersWaitTime,convenienceSpaceReplacingChars:",.;:?!'",disableCopyPasteMedia:this.props.disableCopyPasteMedia,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,onPastingText:this._onPastingText,validateUrl:this._validateUrl,shouldDefaultPaste:this._shouldDefaultPaste,conversationId:this.props.conversationId,enableMagicBot:this.state.enableMagicBot};return(0,o.jsx)(c.View,{style:jt.inputArea,children:(0,o.jsxs)(c.Animated.View,{style:[...e],children:[this.state.enableHtmlComposer?(0,o.jsx)(Nt.default,Object.assign({},r,{ref:this._onEditorInputRef})):(0,o.jsx)(d.default,Object.assign({},r,{ref:this._onTextInputRef})),i]})})}_getEmoticonPickerItem(){if(this.props.hideEmoticonKeyboardIcon||k.isPhoneMri(this.props.conversationId)||k.isS4BBridgeMri(this.props.conversationId))return;const e={id:Bt.MediaBarItemKeys.Emoticon,key:"emoticonPicker",active:this.state.isShowingUnifiedPesPickerDesktop,onActive:this._onUnifiedPesPickerDesktopPress,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,onFocus:this.requestFocus,onBlur:this.blur,onInputChange:this.autoReplaceText,onEmoticonSelected:this._onEmoticonSelected,onEmoticonBackspacePress:this._handleEmoticonBackspacePress,pesPickerPopupRef:this._getPesPickerPopupRef,preventAccessibilityFocus:this.props.preventAccessibilityFocus,colorOverride:this._themeColors.primaryTextColor,hoverColorOverride:this._themeColors.secondaryTextColor,iconStyleOverride:void 0,showCategorySwitcher:!1,disabled:this.props.disableActionOnMessageComposer,origin:me.MediaBarItemOrigin.MessageComposer,ref:e=>{m.default.setAnchor(S.EngagementTooltipType.ExpressionPicker,e)}};return(0,o.jsx)(c.View,{style:jt.desktopOverrides.composerInnerIconWrapper,children:(0,o.jsx)(Q.ExpressionPickerItem,Object.assign({},e))})}_getRichtextEditorItem(){if(k.isPhoneMri(this.props.conversationId)||k.isS4BBridgeMri(this.props.conversationId))return;const e={id:Bt.MediaBarItemKeys.Richtext,key:"richtextPicker",active:this.state.selectedMediaBarItem===Bt.MediaBarItemKeys.Richtext,onActive:this._onEditorActive,onFocus:this.requestFocus,onBlur:this.blur,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,origin:me.MediaBarItemOrigin.MessageComposer};return(0,o.jsx)(c.View,{style:jt.desktopOverrides.composerInnerIconWrapper,children:(0,o.jsx)(et.RichtextEditorItem,Object.assign({},e))})}_hasQuotes(){return!n.isEmpty(this.props.quotedMessages)}_mediaBarItemDescriptor(e){switch(e){case Bt.MediaBarItemKeys.Emoticon:const t={onEmoticonSelected:this._onEmoticonSelected,pesPickerPopupRef:this._getPesPickerPopupRef,showCategorySwitcher:!1};return{id:e,render:this._renderEmoticonPickerItem,propOverrides:t};case Bt.MediaBarItemKeys.Gif:const s={onGifSelected:this._onGifSelected,showCategorySwitcher:!1};return{id:e,render:this._renderGifPickerItem,propOverrides:s};case Bt.MediaBarItemKeys.Sticker:const i={onStickerSelected:this._onStickerSelected,showCategorySwitcher:!1};return{id:e,render:this._renderStickerPickerItem,propOverrides:i};case Bt.MediaBarItemKeys.Sms:return{id:e,render:this._renderSmsItem};case Bt.MediaBarItemKeys.MediaPicker:return{id:e,render:this._renderMediaPickerItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.FilePicker:return{id:e,render:this._renderFilePickerItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.FilePickerPopup:return{id:e,render:this._renderFilePickerPopupItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.Camera:return{id:e,render:this._renderCameraItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.ScheduleCall:return{id:e,render:this._renderScheduleCallItem};case Bt.MediaBarItemKeys.Poll:return{id:e,render:this._renderPollItem};case Bt.MediaBarItemKeys.Location:return{id:e,render:this._renderLocationPickerItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.Contact:return{id:e,render:this._renderContactPickerItem};case Bt.MediaBarItemKeys.Bing:const o={onBlur:this._onBlur};return{id:e,render:this._renderBingSearchItem,propOverrides:o};case Bt.MediaBarItemKeys.MagicBotToolbox:return{id:e,render:this._renderMagicToolboxItem};case Bt.MediaBarItemKeys.VideoMessage:return{id:e,render:this._renderVideoMessageItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.People:return{id:e,render:this._renderPeopleItem};case Bt.MediaBarItemKeys.Audio:const n={onPress:this.props.onRecording};return{id:e,render:this._renderAudioMessageItem,propOverrides:n};case Bt.MediaBarItemKeys.SendCredit:return{id:e,render:this._renderSendCreditItem,getVirtualKeyboard:je.SendCreditItem.getVirtualKeyboard};case Bt.MediaBarItemKeys.SkypeClipsRecord:return{id:e,render:this._renderSkypeClipsRecordItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.ImageGeneration:return{id:e,render:this._renderImageGenerationItem,disabled:this.state.disableHighBandwidthOperations};case Bt.MediaBarItemKeys.Whiteboard:return{id:e,render:this._renderWhiteboardItem,disabled:this.state.disableHighBandwidthOperations}}oe.warn(q.LogTraceArea.MessageComposer,"No media bar descriptor for "+e)}_canShowBingButton(){return this._showBingButton(this.state)}_canShowMagicBotToolboxButton(){return this._showMagicBotToolboxButton(this.state)}_canShowSmsIcon(){return!1}_canShowEmoticonIcon(){return!this.props.hideEmoticonKeyboardIcon}_canShowMicButton(e,t){return!(e.hideAudioMessage||!e.onRecording||t.phoneNumberForSendingSms||this._isPresentedInSidebar()||t.disableHighBandwidthOperations)}_getOverflowItemDescriptors(){const e=n.map(this.state.mediaBarMenuOrder,(e=>e)),t=this._getItemDescriptors(n.flatten(e),!0);return n.slice(t,this.state.currentNumberOfIconsInMediaBar)}_getMediaBarItemDescriptors(){if(this.props.hideMediaBar||this._isMediabarDisabled())return[];const e=this._getItemDescriptors(this.state.mediaBarMenuOrder,!0);return n.slice(e,0,this.state.currentNumberOfIconsInMediaBar)}_getMediaBar(e=!0){if(this._getRightIcon()||this.state.isShowingUnifiedPesPickerDesktop||this.state.isToneRewritePanelOpen)return;const t=this._getMediaBarItemDescriptors();let s;if(this.state.isEncryptedThreadThread||(s=(0,o.jsx)(D.default,{overflowConfig:this.getOverflowConfig(),otherPartyMri:this.props.otherPartyMri,conversationId:this.props.conversationId,onOverflowButtonPress:this._onComposerOverflowPress,icon:void 0})),t.length>0){const i=!1;return(0,o.jsxs)(c.View,{style:jt.mediaBarWrapper,children:[(0,o.jsx)(pe.MediaBar,{ref:this._onMediaBarRef,activeId:this.state.selectedMediaBarItem,itemDescriptors:t,conversationId:this.props.conversationId,otherPartyMri:this.props.otherPartyMri,isMobileInterface:!1,showIcons:e,onInputChange:this.autoReplaceText,onItemSelected:this._onMediaBarItemSelected,onFocus:this.requestFocus,onBlur:this.blur,onCustomKeyboardClose:this._onCustomKeyboardClose,onBackspace:this._handleEmoticonBackspacePress,onCustomAction:this._onHandleCustomAction,preventAccessibilityFocus:this.props.preventAccessibilityFocus,onMessageSent:this.props.onMessageSent,onCloseSearch:this._onCancelPesSearch,clearEditInChatsComposer:this.props.onClearEdit,autoFocusFirstItem:i,disableActionOnMediaBar:this.props.disableActionOnMessageComposer,focusCustomKeyboardWhenShown:!0,announceForAccessibilityForMessageSent:this._announceForAccessibilityForMessageSent,customKeyboardHeight:this.state.pesPickerKeyboardHeight}),s]})}}_animateInputAreaToTargetHeight(){this._inputAreaAnimation||this._inputAreaTargetHeight===this._inputAreaHeight||(this._inputAreaHeight=this._inputAreaTargetHeight,this._inputAreaAnimation=Qe.default.easeOut({value:this._inputAreaHeightValue,toValue:this._inputAreaTargetHeight}),this._inputAreaAnimation.start((()=>{this._inputAreaAnimation=void 0,this.isComponentMounted()&&this._animateInputAreaToTargetHeight()})))}_toggleSmsSending(e,t){this._onPhoneNumberForSmsSelected(t),this.isComponentMounted()&&this.setState({smsToggledOn:e})}_sendControlEnabled(e,t,s){return e.showSendControlWhenEmpty||!t.userInputIsEmpty||s||!!t.phoneNumberForSendingSms||t.hasMediaPreviews}_canCancelEdit(e,t){return!!t&&(!e.hasUncommittedUserInput||e.userInputIsEmpty||e.equalsInitialContent)}replaceText(e,t,s,i){if(this.requestFocus(),this._pendingMessageTextCompletionPromise){const e=ve.getEditableEntityFromInputEntityAndConsiderAlternatives(i,this.state.emoticons);this._pendingMessageTextCompletionPromise.resolve(e),this._pendingMessageTextCompletionPromise=void 0}this._cancelAutoCompletionIfActive()}abortTextAutoCompletion(){this._cancelAutoCompletionIfActive()}_wasRegexTriggered(e){return n.includes(Vt.instantTriggers,e)||n.includes(Vt.delayedTriggers,e)}_cancelAutoCompletionIfActive(){this._pendingMessageTextCompletionPromise&&(this._pendingMessageTextCompletionPromise.reject(),this._pendingMessageTextCompletionPromise=void 0),this.props.onInputTextChanged&&this.props.onInputTextChanged("",!0)}_setInputEntityStateUpstream(e){const t=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this.isComponentMounted()&&(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateUpstream set inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,editableEntities:t}))}_setInputEntityStateDownstream(e,t){const s=this.state.inputEntitiesDataVersion+1,i=ve.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives(e,this.state.emoticons);this._textInputRef&&this._textInputRef.setContent(ve.getEditableContentFromEditableEntities(i,s)),this.isComponentMounted()&&(oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._setInputEntityStateDownstream inputEntities.length: "+(null==e?void 0:e.length)),this.setState({inputEntities:e,inputEntitiesDataVersion:s,editableEntities:i},t))}_sendFileWithDimensions(e,t){const s=st.default.getFileUrl(e);a.default.getImageSize(s).then((s=>{if(s&&(e.dimensions=s),this.state.isMediaPreviewEnabled)return fe.default.addPreviews([e],this.props.conversationId,t);const i={name:Ue.ScenarioName.SendPicture};Fe.default.postUpload([this.props.conversationId],e,t,!1,{scenarioInfo:i},this._getRootViewType())}))}_preventSendingSMSMessage(e){if(oe.log(q.LogTraceArea.MessageComposer,"[MessageComposerWithPopup] _preventSendingSMSMessage"),this.state.shouldPreventSMSTotheUS||this.state.shouldPreventSMSToNotSupportedDestination){const e=this.state.shouldPreventSMSToNotSupportedDestination?q.CantSendSmsWarningType.NotSupportedDestination:q.CantSendSmsWarningType.US;return oe.log(q.LogTraceArea.MessageComposer,`[MessageComposerWithPopup] _preventSendingSMSMessage preventing sending SMS to ${q.CantSendSmsWarningType[e]}`),Ae.default.navigateToCantSendSMSWarning(e),!0}return this.state.shouldPreventSMSToInvalidNumber?(Ae.default.navigateToCantSendSMSWarning(q.CantSendSmsWarningType.InvalidNumber),!0):!(!(1===e.length&&e[0]instanceof se.SmsEntity&&this._smsInfoLineRef)||this._smsInfoLineRef.canSendSMS())&&(oe.log(q.LogTraceArea.MessageComposer,"[MessageComposerWithPopup] _preventSendingSMSMessage preventing sending SMS"),this.state.isSmsFailureScreenEnabled?Ae.default.navigateToSmsFailurePrompt(this.props.conversationId,this.state.phoneNumberForSendingSms?this.state.phoneNumberForSendingSms.number:"",!1):v.default.open(this._getRootViewId()),!0)}_sendMessage(e){return i.__awaiter(this,void 0,void 0,(function*(){if(oe.log(q.LogTraceArea.MessageComposer,"sendMessage isPostingMessage: "+this._isPostingMessage),this._isPostingMessage)return;if(!(yield(0,mt.canSendMessageToMagicBot)(e,this.state.isMagicBotConversation)))return void this.dismissKeyboard();this._isPostingMessage=!0;const t=nt.default.newCauseId();oe.log(q.LogTraceArea.MessageComposer,"sendMessage causeId: "+t);let s=[],i=0;if(this.props.quotedMessages&&(s=s.concat(this.props.quotedMessages.map(this._getQuoteEntity)),i=s.length),e.length>0&&(s=s.concat(e)),this.state.enableOnewaySms&&this.state.phoneNumberForSendingSms&&!this.state.userInputIsEmpty){if(s=[new se.SmsEntity(this._getTextForSms(e),this.state.phoneNumberForSendingSms.number)],this._preventSendingSMSMessage(s))return oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message prevented from being send."),this._isPostingMessage=!1,void oe.track(new At.SmsSendStatus(At.OneWaySmsAction.SmsCheckedAndStopped,this._smsDestinationType));oe.track(new At.SmsSendStatus(At.OneWaySmsAction.SmsCheckedAndSent,this._smsDestinationType))}try{const e=(0,mt.isMagicBotMentioned)(s,this.state.enableHtmlComposer);!e||this.state.isOneOnOneConversation||this.state.isMagicBotContainingConversation||(yield St.default.serviceAddMemberToThread(this.props.conversationId,(0,ct.getMagicBotId)(),_t.AddMemberToThreadSource.BotAutoAdd,!(0,we.isModerated)(this.state.conversation)),oe.log(q.LogTraceArea.MessageComposer,"sendMessage Magic bot auto-added to conversation because being mentioned."),oe.track(new ut.MagicBotAutoAddedByMention));const o=e&&this.state.enableMagicBot&&this.state.isOneOnOneConversation&&!this.state.isMagicBotConversation;if(this._needsContext(e)&&!(0,ft.isUserInputEmptyOrHasWhitespaceOnly)(s)){const e=yield(0,pt.getContext)(!this.state.isOneOnOneConversation||o,this.state.conversation);s.push(e)}this._sendOneOnOneMagicBotMessageIfNeeded(o,s),yield fe.default.sendPreviews(this.props.conversationId,t),i>1?u.all(s.map((e=>this._sendTextMessagePromise([e])))).finally((()=>{this._isPostingMessage=!1})):this._sendTextMessagePromise(s).finally((()=>{this._isPostingMessage=!1}))}finally{this._isPostingMessage=!1,this.state.hasFocus||this.requestFocus()}}))}_needsContext(e){return this.state.enableMagicBot&&ht.AIConsentService.getConsent()&&(e||this.state.isMagicBotConversation)}_sendTextMessagePromise(e){const t={conversationId:this.props.conversationId,editedMessage:this.props.editedMessage,inputEntities:e,onMessageSent:this.props.onMessageSent,phoneNumberForSendingSms:this.state.phoneNumberForSendingSms,smsInfoLineRef:this._smsInfoLineRef,textInputRef:this._textInputRef,enableHandlingHTMLonPaste:this.state.enableHandlingHTMLonPaste,messageComposerPastedContentType:this.state.messageComposerPastedContentType};return Wt._sendTextMessage(t).then((e=>{if(e){if(this._handleAfterPostMessage(t.conversationId),oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message sent."),t.smsInfoLineRef){const e=t.smsInfoLineRef.getTelemetryEvent();e&&(this.state.phoneNumberForSendingSms?e.setSmsWasSent(!0):e.setSkypeMessageSent(!0))}}else oe.log(q.LogTraceArea.MessageComposer,"sendMessage Message not sent.")}))}static _sendTextMessage(e){if((0,ft.isUserInputEmptyOrHasWhitespaceOnly)(e.inputEntities))return e.inputEntities.length?oe.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter with only whitespace message content."):oe.log(q.LogTraceArea.MessageComposer,"sendMessage User pressed enter without entering any message content."),u.Resolved(!1);if(e.onMessageSent(e.inputEntities,Ce.convertPastedTextTypeToTelemetry(e.messageComposerPastedContentType))){const t=e.editedMessage?ce.getString("MessageComposer.MessageEditedLabel"):ce.getString("MessageComposer.MessageSentLabel");Wt._announceForAccessibility(t);const s=F.default.getSavedMessageInput(e.conversationId);if(s){const t=e.textInputRef&&!e.textInputRef.equalsInitialContent()||!1;oe.track(new z.DraftMessageWasSent(t,s.timestamp))}return u.Resolved(!0)}return u.Resolved(!1)}static _announceForAccessibility(e){He.default.maybeAnnounceForAccessibility(e,0)}_handleAfterPostMessage(e){if(F.default.getSavedMessageInput(e)&&(0,N.default)().fakeConversationTime(e,Date.now()),oe.log(q.LogTraceArea.MessageComposer,"MessageComposer._handleAfterPostMessage"),F.default.clearMessageInput(e),this.props.conversationId===e){this.state.hasFocus||this.requestFocus(),this.setTextInputAccessibilityFocus(),this._setInputEntityStateDownstream([]),this._cancelAutoCompletionIfActive(),this.isComponentMounted()&&this.setState({selectedMediaBarItem:""}),this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(),this.props.onClearEdit&&this.props.onClearEdit();const e=this._getRootViewId();ge.MediaBarItem.dismissPopup(e),U.default.close(e),Ct.default.closePanel()}this._isPostingMessage=!1}_shouldAutoFocusInput(){return!this.state.isSmallOrTinyScreen||this._getRootViewId()!==x.MainRootViewId}_isMediabarDisabled(){return k.isS4BBridgeMri(this.props.conversationId)||!!this.state.phoneNumberForSendingSms||!!this.state.isConversationWithPhoneNumber}_isPresentedInSidebar(){return this._getContext().isPresentedInDesktopLeftNav||this._getContext().isPresentedInDesktopRightNav}isFocused(){return this.state.hasFocus}blurIfFocused(){this.state.hasFocus&&this.blur()}getInputEntities(){return this._textInputRef?this._textInputRef.getContent().then((e=>this._consumeNewUserInput(e)||this.state.inputEntities)):u.Resolved(this.state.inputEntities)}getOverflowConfig(){return this._overflowActions()}onDragDropText(e){var t;null===(t=this._textInputRef)||void 0===t||t.onDragDropText(e)}}t.default=Wt},703689:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageTextCompletion=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(623627)),l=i.__importDefault(s(150343)),d=i.__importStar(s(44717)),c=i.__importDefault(s(615364)),u=i.__importDefault(s(601976)),h=i.__importDefault(s(794229)),p=i.__importDefault(s(970035)),g=i.__importStar(s(626065)),m=s(26703),S=i.__importStar(s(704704)),_=s(493680),f=s(375230),y=i.__importDefault(s(363091)),v=i.__importStar(s(701034)),C=i.__importDefault(s(655192)),T=s(16549),M=i.__importDefault(s(20758)),b=s(641400),I=s(781181),w=s(262725),P=i.__importDefault(s(497910)),k=s(403396),A=s(596648),x=s(154235),D=M.default.fontSize.size13Deprecated,R=b.IconSize.size20,L=A.UserIconSize.Size24,B=(0,m.lazyProperties)({textCompletionMenuItem:()=>r.Styles.createTextStyle({fontSize:D,font:M.default.font.uiDisplayRegular}),textCompletionMenuItemSelected:()=>r.Styles.createTextStyle({color:T.Color.blue}),atMentionMenu:()=>(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),iconContainer:()=>r.Styles.createViewStyle({flexDirection:"row",marginRight:8}),name:()=>r.Styles.createTextStyle({fontSize:D,font:M.default.font.uiDisplayRegular}),nameSelected:()=>r.Styles.createTextStyle({fontWeight:x.FontWeight.bold}),allIcon:()=>r.Styles.createViewStyle({marginRight:8,padding:2})}),slashCommandMenu:()=>(0,m.lazyProperties)({container:()=>r.Styles.createTextStyle({alignItems:"center"}),commandName:()=>r.Styles.createTextStyle({fontSize:D,font:M.default.font.uiDisplayBold}),usageHint:()=>r.Styles.createTextStyle({fontSize:M.default.fontSize.size13Deprecated,font:M.default.font.uiDisplayRegular}),textSelected:()=>r.Styles.createTextStyle({color:T.Color.blue}),descriptionSelected:()=>r.Styles.createTextStyle({color:T.Color.blueOverlay70})}),emoticonMenuItem:()=>(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emoticonContainer:()=>r.Styles.createViewStyle({flexDirection:"row",marginRight:8})})});class F extends P.default{constructor(){super(...arguments),this._preventDoubleTextReplacement=!1,this._onEntityDeectors=()=>this._entityDetectors,this._onReplaceText=(e,t,s,i)=>{this._preventDoubleTextReplacement||(this.props.onReplaceText(e,t,s,i),this._preventDoubleTextReplacement=!0)},this._onTextCompletionRef=e=>{this._textCompletion=e||void 0}}_buildState(e,t){const s={},i=(0,c.default)().getConversation(e.conversationId),{enableMagicBot:o}=l.default.getS4LMessagingFeatures();s.userAtMentionInfo=this._buildAtMentionInfo(i,o),this._entityDetectors=this._getEntityDetectors(i);const n=this.props,r=t||n.conversationId!==e.conversationId;return(r||n.showSlashCommands!==e.showSlashCommands)&&e.showSlashCommands&&r&&(s.slashCommands=v.getVisibleCommands(e.conversationId)),t&&(s.inputText=""),s}setInputText(e,t){this.setState({inputText:e,forceHide:t}),this._preventDoubleTextReplacement=!1}render(){const e=this.state.forceHide?"":this.state.inputText;return(0,o.jsx)(I.TextCompletion,{ref:this._onTextCompletionRef,style:this.props.style,entityDetectors:this._onEntityDeectors,inputText:e,onReplaceText:this._onReplaceText,onTextReplacementCandidatesShown:this.props.onTextReplacementCandidatesShown,candidatesToDisplay:8,maxMenuHeight:this.props.maxMenuHeight,leftOffset:this.props.leftOffset})}_buildAtMentionInfo(e,t){const s=!!e&&d.isSkypeIdMri(e.id),i={};if(!e||!e.isThread()&&!s||e.isEncryptedThread())return i;const o={};let r=e?n.map(e.getThreadMembers(),(e=>e.id)):[];if(s){const t=e.getOtherPartyMri();t&&(r=[t])}const a=(0,_.getMagicBotId)();return!t||!s&&r.includes(a)||r.splice(0,0,a),n.each(r,(e=>{if(y.default.isMyMri(e))return;const t=u.default.getDisplayableProfile(e);if(!i[e]){const s=t.getDisplayName(void 0,!0),n=(0,_.isMagicBotConversation)(e)?"Bing":t.getShortName(!0),r=n?C.default.deburrLowerCase(n):void 0;i[e]={shortName:n,shortNameNormalized:r,displayName:s,displayNameNormalized:s?C.default.deburrLowerCase(s):void 0,sharesShortName:!1,isAgent:d.isAgent(e)},n&&r&&(o[r]?(i[o[r]].sharesShortName=!0,i[e].sharesShortName=!0):o[r]=e)}})),i}_escapeForRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}_getEntityDetectors(e){const t="(("+this._escapeForRegExp(n.values(h.default.getEmoticonFirstLetterMap()).join(" ")).split(" ").join("|")+")"+h.default.getValidEmoticonCharactersPattern()+"{2,})$",s=[{entityType:"@Mention",match:/\B@([^@?!\n[\]{}|\/<>]*)$/i,search:(e,t,s)=>{const i=e.toLowerCase(),o=this._getCandidatesForAtMention(e,!1,1,!1),n=(0,c.default)().getConversation(this.props.conversationId);if(n&&!n.isOneOnOne()){const t=S.getString("MessageComposer.QouteAll");0===t.indexOf(i)&&o.splice(0,0,{entity:new g.AtMentionEntity(t,"*"),charsToReplace:e.length+1,replacementText:t,priority:1})}return o},render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250},{entityType:"@Mention",match:/([^?!\n[\]{}|\/<>]{3,})$/i,search:(e,t,s)=>this._getCandidatesForAtMention(e,t,0,!0),render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250},{entityType:"SlashCommand",match:/^\/(\w*)$/i,search:(e,t,s)=>{const i=[];if(this.props.showSlashCommands){const t=n.filter(this.state.slashCommands,(t=>0===t.command.indexOf(e)));n.each(t,(t=>{const s=new g.CommandEntity("/"+t.command+" ",t.command,t.usageHint||"",t.description);i.push({entity:s,charsToReplace:e.length+1,replacementText:"/"+t.command+" "})}))}return i},render:(e,t)=>this._renderSlashCommandMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.CommandSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:400},{entityType:"Emoticon",match:new RegExp(t,"i"),search:(e,t,s)=>(0,f.GetEmoticonSuggestions)(e,t,s),render:(e,t)=>this._renderEmoticonMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.EmoticonSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:170}];return e&&n.find(e.getThreadMembers(),(e=>"28:dd02eb70-197a-4dbc-8591-e4e88a5093a0"===e.id))&&s.push({entityType:"@Mention",match:/(zo)$/i,search:(e,t,s)=>this._getCandidatesForAtMention(e,t,0,!0,2),render:(e,t)=>this._renderAtMentionMenuItem(e.entity,t),createAccessibilityLabel:(e,t,s)=>this._createSuggestionItemAccessibilityLabel("MessageComposer.MentionSuggestion",e.entity?e.entity.text():"",t,s),maxPopupWidth:250}),s}_getCandidatesForAtMention(e,t,s,i,o=3){const r=[],a=C.default.deburr(e),l=[];if(i){const e=a.split(" ");let s=1;const i=t?0:1;for(let t=e.length-1;t>=i&&s<=4;t--){const i=e.slice(t,t+s).join(" "),n=i.toLowerCase();i.length>=o&&i[0]!==n[0]&&l.push(n),s++}}else l.push(a.toLowerCase());return l.length>0&&n.each(this.state.userAtMentionInfo,((e,t)=>{n.each(l,(i=>{const o=e.shortNameNormalized&&e.shortNameNormalized.length>=i.length&&e.shortNameNormalized.substring(0,i.length)===i,a=e.displayNameNormalized&&e.displayNameNormalized.length>=i.length&&e.displayNameNormalized.substring(0,i.length)===i;if(o||a){let l=e.shortName;(!o||e.sharesShortName||e.isAgent)&&(l=e.displayName);const d={entity:new g.AtMentionEntity(l,t,e.shortName,e.displayName),charsToReplace:i.length+s,replacementText:l,uniqueKey:t,priority:o||e.sharesShortName&&a?2:3},c=n.findIndex(r,(e=>e.uniqueKey===t));if(c>=0){const e=r[c].priority||0;d.priority<e&&r.splice(c,1,d)}else r.push(d)}}))})),r}_renderAtMentionMenuItem(e,t){const s=e.text();let i,a;if(s===e.shortName&&n.startsWith(e.displayName,s)){const n=[B.atMentionMenu.name,r.Styles.createTextStyle({color:this._themeColors.textSecondary},!1)];t&&n.push(B.atMentionMenu.nameSelected),i=(0,o.jsx)(r.Text,{style:n,numberOfLines:1,children:e.displayName.substring(s.length)})}e.userMri&&(a="*"===e.userMri?(0,o.jsx)(p.default,{icon:b.SkypeIcon.ContactGroup,size:R,color:t?this._themeColors.iconPrimary:this._themeColors.iconSecondary,style:B.atMentionMenu.allIcon}):(0,o.jsx)(r.View,{style:B.atMentionMenu.iconContainer,children:(0,o.jsx)(k.UserIcon,{userMri:d.sanitizeMri(e.userMri,d.Namespaces.SkypeId),size:L})}));const l=[B.atMentionMenu.name,r.Styles.createTextStyle({color:this._themeColors.textPrimary},!1)];return t&&l.push(B.atMentionMenu.nameSelected),(0,o.jsxs)(r.View,{style:B.atMentionMenu.container,children:[a,(0,o.jsx)(r.Text,{style:l,numberOfLines:1,children:s}),i]})}_renderSlashCommandMenuItem(e,t){let s;const i=[B.slashCommandMenu.commandName,this._themeStyles.primaryTextColorStyle],n=[B.slashCommandMenu.usageHint,this._themeStyles.primaryTextColorStyle],a=t?B.slashCommandMenu.textSelected:void 0;if(a&&(i.push(a),n.push(a)),e.description){const i=[this._themeStyles.tertiaryTextColorStyle],n=t?B.slashCommandMenu.descriptionSelected:void 0;n&&i.push(n),s=(0,o.jsx)(w.Caption,{style:i,numberOfLines:1,children:e.description})}return(0,o.jsxs)(r.View,{children:[(0,o.jsxs)(r.Text,{style:B.slashCommandMenu.container,numberOfLines:1,children:[(0,o.jsx)(r.Text,{style:i,numberOfLines:1,children:e.commandName}),(0,o.jsx)(r.Text,{style:n,numberOfLines:1,children:" "+e.usageHint})]}),s]})}_renderEmoticonMenuItem(e,t){const s=[B.textCompletionMenuItem,this._themeStyles.primaryTextColorStyle];return t&&s.push(B.textCompletionMenuItemSelected),(0,o.jsxs)(r.View,{style:B.emoticonMenuItem.container,children:[(0,o.jsx)(r.View,{style:B.emoticonMenuItem.emoticonContainer,children:(0,o.jsx)(a.AnimatedEmoticon,{innerText:e.text(),emoticonName:e.emoticonName,size:a.Size.Small,isStatic:!1,tone:e.tone})}),(0,o.jsx)(r.Text,{style:s,numberOfLines:1,children:"  "+e.text()})]})}_createSuggestionItemAccessibilityLabel(e,t,s,i){return S.getString(e,{name:t,itemIndex:s,itemsCount:i})}handleKeyDown(e){return!!this._textCompletion&&this._textCompletion.handleKeyDown(e)}}t.MessageTextCompletion=F,t.default=F},144084:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({onInitialRenderComplete:e}){const{mode:{isDark:t}}=(0,h.useSkypeTheme)(),{paragraphCommon:s}=(0,p.useRXStyles)((({themeColors:e})=>({paragraphCommon:n.Styles.createTextStyle({textAlign:"center",color:e.textOnAccent,fontSize:24,lineHeight:32,font:g.default.font.uiDisplayBold},!1)})),[]),{secondParagraphCommon:i}=(0,p.useRXStyles)((({themeColors:e})=>({secondParagraphCommon:n.Styles.createTextStyle({textAlign:"center",color:e.engagementBannerTextColor,fontSize:16,lineHeight:20},!1)})),[]);(0,l.useEffect)((()=>{e()}),[]);const c=t?r.Collection.MYBOT_EMPTY_STATE_DARK:r.Collection.MYBOT_EMPTY_STATE;return(0,o.jsxs)(a.View,{style:m.container,children:[(0,o.jsx)(u.BodyText,{style:s,children:d.getString("MyBotConversation.FirstParagraph")}),(0,o.jsx)(u.BodyText,{style:[i,S.paragraph],children:d.getString("MyBotConversation.SecondParagraphDesktop")}),(0,o.jsx)(n.Image,{style:S.image,source:c})]})};const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importStar(s(317588)),a=s(537180),l=s(667294),d=i.__importStar(s(704704)),c=s(26703),u=s(825419),h=s(206315),p=s(964414),g=i.__importDefault(s(20758)),m=a.StyleSheet.create({container:{flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:30}}),S=(0,c.lazyProperties)({image:()=>n.Styles.createLinkStyle({width:"80%",height:310,maxWidth:600}),paragraph:()=>n.Styles.createTextStyle({paddingBottom:28,paddingTop:8})})},260714:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const[t,s]=(0,l.useState)(!1),[i,h]=(0,l.useState)(!1),{enableMyBotQRDialog:f}=M.default.getS4LMessagingFeaturesNoSubscription(),{pinNormalContainer:P}=(0,_.useSkypeStyles)((({themeColors:e})=>({pinNormalContainer:{position:"absolute",top:0,left:0,right:0,alignItems:"center",justifyContent:"center",paddingLeft:10,display:"flex",flexDirection:"row",backgroundColor:e.surfacePrimary,color:e.textSecondary,borderBottomColor:e.surfaceSecondary,borderBottomWidth:1}})),[]),{linkStyle:k}=(0,_.useRXStyles)((({themeColors:e})=>({linkStyle:r.Styles.createTextStyle({textDecorationLine:"underline",color:e.textPrimary},!1)})),[]),{titleStyle:A}=(0,_.useRXStyles)((({themeColors:e})=>({titleStyle:r.Styles.createTextStyle({fontSize:15,lineHeight:20,color:e.textPrimary,font:v.default.font.uiDisplayBold},!1)})),[]),{contentStyle:x}=(0,_.useRXStyles)((({themeColors:e})=>({contentStyle:r.Styles.createTextStyle({fontWeight:"400",fontSize:14,lineHeight:18,color:e.textPrimary},!1)})),[]),{themeColors:{iconPrimary:D}}=(0,S.useSkypeTheme)(),R=()=>{h(!0)},L=()=>{h(!1)},B=()=>{b.default.show(),T.Instrumentation.track(new C.MyBotQRImgCilck(e.isNoMessage))};if(t)return null;return(0,o.jsxs)(n.View,{style:P,children:[f?(0,o.jsx)(r.View,{style:I.qrContainer,onMouseEnter:R,onMouseLeave:L,onPress:B,children:(0,o.jsx)(r.Image,{style:w.image,source:i?a.Collection.MYBOT_QR_CODE_HOVER:a.Collection.MYBOT_QR_CODE})}):(0,o.jsx)(r.Image,{style:w.image,source:a.Collection.MYBOT_QR_CODE}),(0,o.jsxs)(n.View,{style:I.leftPanel,children:[(0,o.jsx)(m.RowTitle,{style:A,children:d.getString("MyBotConversation.FRETitleDesktop")}),(0,o.jsx)(g.BodyText,{style:x,children:d.getString("MyBotConversation.FREContentDesktop")})]}),(0,o.jsx)(n.View,{style:I.rightPanel,children:(0,o.jsx)(c.default,{icon:u.SkypeIcon.ClosePanel,color:D,hoverColor:D,size:u.IconSize.size14,style:[I.closeButton],onPress:()=>{T.Instrumentation.track(new C.MyBotFreHeadClose(e.isNoMessage)),y.LocalStorage.setItem(y.StorageKeys.FreBuildVersion,p.default.getAppVersion()),s(!0)},title:d.getString("Global.CloseButtonTitle")})})]})};const i=s(197582),o=s(785893),n=s(537180),r=i.__importStar(s(516778)),a=i.__importStar(s(317588)),l=s(667294),d=i.__importStar(s(704704)),c=i.__importDefault(s(453761)),u=s(641400),h=s(16549),p=i.__importDefault(s(139221)),g=s(825419),m=s(262725),S=s(206315),_=s(964414),f=s(26703),y=s(444314),v=i.__importDefault(s(20758)),C=s(563748),T=s(82485),M=i.__importDefault(s(150343)),b=i.__importDefault(s(146846)),I=n.StyleSheet.create({leftPanel:{flexGrow:1,flexShrink:1,marginRight:"auto",paddingTop:10,paddingBottom:10,paddingRight:8},rightPanel:{flexGrow:0,flexShrink:0,marginLeft:"auto",marginRight:10,display:"flex",flexDirection:"row",alignItems:"center"},qrContainer:{padding:4},closeButton:{marginRight:6,width:24,height:24,borderRadius:12,backgroundColor:h.Color.transparent}}),w=(0,f.lazyProperties)({image:()=>r.Styles.createImageStyle({width:53,height:53,marginRight:10,marginTop:4,marginBottom:4})})},59622:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(242561)),l=i.__importStar(s(172792)),d=i.__importStar(s(704704)),c=i.__importStar(s(626065)),u=i.__importStar(s(7040)),h=s(26703),p=i.__importDefault(s(497910)),g=i.__importDefault(s(20758)),m=i.__importDefault(s(341126)),S=i.__importDefault(s(453761)),_=s(641400),f=s(954225),y=s(16549),v=i.__importDefault(s(827361)),C=(0,h.lazyProperties)({linkStyle:()=>r.Styles.createTextStyle({fontSize:g.default.controlFontSize.body,lineHeight:18,color:y.Color.gray400,fontFamily:g.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),quoteTextStyle:()=>r.Styles.createTextStyle({fontStyle:"italic"}),quoteAttributeStyle:()=>r.Styles.createTextStyle({fontSize:g.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),multiQuoteAreaLastMessage:()=>r.Styles.createViewStyle({marginBottom:0}),multiQuoteArea:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",marginTop:15,marginBottom:0,marginLeft:20,marginRight:20}),multiQuoteAreaMessages:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",maxHeight:200,paddingBottom:15,borderBottomWidth:1,borderStyle:"solid"}),multiQuoteAreaMessage:()=>r.Styles.createViewStyle({marginBottom:12}),multiQuoteAreaClearButton:()=>r.Styles.createButtonStyle({alignSelf:"flex-start"})});class T extends p.default{constructor(){super(...arguments),this._onClearQuoteButtonPress=()=>{this.props.onClearQuotedMessage&&this.props.onClearQuotedMessage(!0)}}render(){let e,t=this.props.quotedMessages,s=this._onClearQuoteButtonPress;if(n.isEmpty(t)&&this.props.editedMessage){const i=n.first(this.props.inputEntities);i instanceof c.QuoteEntity&&(t=[this.props.editedMessage],e=u.decodeFromInput([i],!1),s=this.props.onClearEditMessageQuote)}if(t&&t.length>0){const i=g.default.font.uiDisplayBold,n=this.props.showTranslatedMessage||!1,c={linkStyle:this._useDarkTheme()?r.Styles.combine(C.linkStyle,this._themeStyles.linkTextColorStyle||this._themeStyles.primaryTextColorStyle):C.linkStyle,disableActions:this.props.disableActions,quoteSymbolStyle:{size:_.IconSize.size20,color:this._themeColors.primaryTextColor},quotedTextStyle:C.quoteTextStyle,atMentionStyle:i,atMentionMeOverrideStyle:i,showTranslatedMessage:n,hasTranslation:n,renderOrigin:a.MessageRenderOrigin.MessageComposerCanvas,asQuoteInComposer:!0};if(c.textOverrideStyle=[this._themeStyles.primaryTextColorStyle],c.quoteAttributeStyle=[C.quoteAttributeStyle,this._themeStyles.secondaryTextColorStyle],this.props.messageStreamFontSize!==f.MessageStreamFontSize.Normal){const e=g.default.controlFontSize.messageStreamItemDesktop,t=l.getStyle(e,this.props.messageStreamFontSize),s=l.getStyle(g.default.controlFontSize.messageStreamQuoteAttributeDesktop,this.props.messageStreamFontSize);c.textOverrideStyle.push(t),c.quoteAttributeStyle.push(s),c.fontSize=l.getSize(e,this.props.messageStreamFontSize)}const u=t.length-1,h=t.map(((t,s)=>(0,o.jsx)(r.View,{style:s===u?C.multiQuoteAreaLastMessage:C.multiQuoteAreaMessage,children:(0,o.jsx)(m.default,{message:t,preDecodedMessage:e,wrapInQuote:!e,options:c})},`quote-${s}`)));return(0,o.jsxs)(r.View,{style:C.multiQuoteArea,children:[(0,o.jsx)(r.View,{style:[C.multiQuoteAreaMessages,this._themeStyles.secondaryDividerBorderStyle],children:(0,o.jsx)(r.ScrollView,{style:v.default.flexOne,children:h})}),(0,o.jsx)(S.default,{title:d.getString("MessageComposer.RemoveQuoteButtonTitle"),style:C.multiQuoteAreaClearButton,onPress:s,size:_.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,icon:_.SkypeIcon.Cancel,disabled:this.props.disableActions},"clearbutton")]})}}}t.default=T},404136:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(667294),l=s(537180),d=i.__importStar(s(242561)),c=i.__importStar(s(172792)),u=i.__importStar(s(704704)),h=i.__importStar(s(626065)),p=i.__importStar(s(7040)),g=i.__importDefault(s(20758)),m=i.__importDefault(s(341126)),S=i.__importDefault(s(453761)),_=s(641400),f=s(954225),y=s(16549),v=s(964414),C=s(206315),T=s(26703),M=i.__importDefault(s(827361)),b=(0,T.lazyProperties)({linkStyle:()=>r.Styles.createTextStyle({fontSize:g.default.controlFontSize.body,lineHeight:18,color:y.Color.gray400,fontFamily:g.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"}),quoteAttributeStyle:()=>r.Styles.createTextStyle({fontSize:g.default.controlFontSize.messageStreamQuoteAttributeDesktop,marginTop:0,marginBottom:0}),multiQuoteAreaClearButton:()=>r.Styles.createButtonStyle({position:"absolute",top:8,right:8})});t.default=(0,a.memo)((e=>{const{mode:t,themeColors:s}=(0,C.useSkypeTheme)(),i=(0,v.useSkypeStyles)((({themeColors:e})=>({multiQuoteAreaLastMessage:{marginBottom:0,borderRadius:4},multiQuoteAreaMessage:{marginBottom:12,borderRadius:4,overflow:"hidden"},multiQuoteArea:{position:"relative",flex:1,flexDirection:"row",margin:16,marginBottom:0,backgroundColor:e.surfaceQuaternary,borderRadius:4,overflow:"hidden",shadowColor:y.Color.blackOverlay20,shadowOffset:{width:1,height:1.5},shadowRadius:1},multiQuoteAreaMessages:{flex:1,maxHeight:300,flexDirection:"row"}})),[]);let a,T=e.quotedMessages,I=()=>{var t;null===(t=e.onClearQuotedMessage)||void 0===t||t.call(e,!0)};if(n.isEmpty(T)&&e.editedMessage){const t=n.first(e.inputEntities);t instanceof h.QuoteEntity&&(T=[e.editedMessage],a=p.decodeFromInput([t],!1),I=e.onClearEditMessageQuote)}if(!T||T.length<=0)return null;const w=g.default.font.uiDisplayBold,P=e.showTranslatedMessage||!1,k={color:s.linkTextColor},A={color:s.primaryTextColor},x={linkStyle:t.isDark?r.Styles.combine(b.linkStyle,k||A):b.linkStyle,disableActions:e.disableActions,quoteSymbolStyle:{size:_.IconSize.size20,color:s.textPrimary},atMentionStyle:w,atMentionMeOverrideStyle:w,showTranslatedMessage:P,hasTranslation:P,renderOrigin:d.MessageRenderOrigin.MessageComposerCanvas,asQuoteInComposer:!0};if(x.textOverrideStyle=[A],x.quoteAttributeStyle=[b.quoteAttributeStyle,A],e.messageStreamFontSize!==f.MessageStreamFontSize.Normal){const t=g.default.controlFontSize.messageStreamItemDesktop,s=c.getStyle(t,e.messageStreamFontSize),i=c.getStyle(g.default.controlFontSize.messageStreamQuoteAttributeDesktop,e.messageStreamFontSize);x.textOverrideStyle.push(s),x.quoteAttributeStyle.push(i),x.fontSize=c.getSize(t,e.messageStreamFontSize)}const D=T.length-1,R=T.map(((e,t)=>(0,o.jsx)(l.View,{style:t===D?i.multiQuoteAreaLastMessage:i.multiQuoteAreaMessage,children:(0,o.jsx)(m.default,{message:e,preDecodedMessage:a,wrapInQuote:!a,options:x})},`quote-${t}`)));return(0,o.jsxs)(l.View,{style:i.multiQuoteArea,children:[(0,o.jsx)(l.View,{style:i.multiQuoteAreaMessages,children:(0,o.jsx)(r.ScrollView,{style:M.default.flexOne,children:R})}),(0,o.jsx)(S.default,{title:u.getString("MessageComposer.RemoveQuoteButtonTitle"),style:b.multiQuoteAreaClearButton,onPress:I,size:_.IconSize.size20,color:s.textPrimary,hoverColor:s.iconHoverColor,icon:_.SkypeIcon.Cancel,disabled:e.disableActions},"clearbutton")]})}))},176098:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkModal=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(6625),l=i.__importDefault(s(453761)),d=s(26703),c=i.__importStar(s(704704)),u=i.__importDefault(s(497910)),h=s(641400),p=s(16549),g=i.__importDefault(s(220534)),m=i.__importDefault(s(525864)),S=i.__importDefault(s(266311)),_=s(154235),f=i.__importDefault(s(54945)),y=s(375258),v=i.__importDefault(s(827361)),C=i.__importDefault(s(186325)),T=i.__importDefault(s(817672)),M=s(485692),b=s(82485),I=s(14269),w=345,P=(0,d.lazyProperties)({linkModal:()=>(0,d.lazyProperties)({container:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column"}),textInput:()=>r.Styles.createTextInputStyle({flex:1,paddingVertical:19,lineHeight:22,backgroundColor:p.Color.transparent}),contentContainer:()=>r.Styles.createViewStyle({flexGrow:1,marginHorizontal:20})}),container:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start",padding:10,borderTopWidth:1,borderLeftWidth:1,borderRightWidth:1}),containerRoundedCorners:()=>r.Styles.createViewStyle({borderTopLeftRadius:24,borderTopRightRadius:24}),iconButton:()=>r.Styles.createButtonStyle({width:h.IconSize.size32,height:h.IconSize.size32,alignSelf:"center"})});class k extends u.default{constructor(){super(...arguments),this._onPress=e=>{e.preventDefault(),this.props.onDone({textToDisplay:this.state.textToDisplay||this.state.linkHref,linkHref:this.state.linkHref}),this._dismissDialog()},this._dismissDialog=()=>{S.default.dismissModal("linkModal",this._getRootViewId())},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._onLinkInputRef=e=>{this._linkInputRef=e||void 0},this.requestTextInputFocus=()=>{var e;null===(e=this._textInputRef)||void 0===e||e.requestFocus()},this.requestLinkInputFocus=()=>{var e;null===(e=this._linkInputRef)||void 0===e||e.requestFocus()},this._onKeyDown=e=>!(e.keyCode!==f.default.ENTER||!g.default.isUrlValid(this.state.linkHref))&&(this._onPress(e),!0),this._dismissModal=()=>{S.default.dismissModal("linkModal",this._getRootViewId())}}_buildState(e,t){if(t){const t=g.default.isUrlValid(e.initialSelection);return{textToDisplay:t?"":e.initialSelection,linkHref:t?e.initialSelection:""}}return{}}componentDidMount(){super.componentDidMount(),r.Input.keyDownEvent.subscribe(this._onKeyDown),this.state.textToDisplay?this.requestLinkInputFocus():this.requestTextInputFocus()}componentWillUnmount(){super.componentWillUnmount(),r.Input.keyDownEvent.unsubscribe(this._onKeyDown)}render(){const e={text:c.getString("LinkCreation.DialogConfirmationButton"),onPress:this._onPress,disabled:!g.default.isUrlValid(this.state.linkHref)},t=r.Styles.createTextInputStyle({color:this._useDarkTheme()?p.Color.white:p.Color.black},!1);return(0,o.jsxs)(m.default,{dialogId:"linkModal",closeOnClickOutside:!0,maxWidth:w,fullScreen:!1,useFullSizeContainer:!0,containerStyle:this._themeStyles.primaryBackgroundColorStyle,children:[(0,o.jsx)(y.SimplePanelHeader,{panelName:c.getString("LinkCreation.Header"),leftButton:{closeButtonType:y.CloseButtonType.Close,onPress:this._dismissModal},useCenteredControls:!0}),(0,o.jsx)(r.View,{style:P.linkModal.container,children:(0,o.jsx)(r.View,{style:[v.default.flexOne],children:(0,o.jsxs)(r.View,{style:P.linkModal.contentContainer,children:[(0,o.jsx)(r.TextInput,{style:[P.linkModal.textInput,t],placeholder:c.getString("LinkCreation.TextToDisplayPlaceholder"),value:this.state.textToDisplay,onChangeText:e=>this.setState({textToDisplay:e}),ref:this._onTextInputRef}),(0,o.jsx)(C.default,{}),(0,o.jsx)(r.TextInput,{style:[P.linkModal.textInput,t],placeholder:c.getString("LinkCreation.LinkAddressPlaceholder"),value:this.state.linkHref,onChangeText:e=>this.setState({linkHref:e}),ref:this._onLinkInputRef}),(0,o.jsx)(C.default,{})]})})}),(0,o.jsx)(T.default,{button:e})]})}}t.LinkModal=k;class A extends u.default{constructor(){super(...arguments),this._makeLink=e=>({type:a.EditableEntityType.PlainText,displayText:`[${null==e?void 0:e.textToDisplay}](${null==e?void 0:e.linkHref})`}),this._getSelectedText=()=>{let e="";if(this.props.textInputRef){const t=this.props.textInputRef.getEditorState(),s=t.getSelection(),i=t.getCurrentContent().getPlainText(),o=s.getAnchorOffset(),n=s.getFocusOffset();e=i.substring(o,n)}return e},this._createEntityType=(e,t)=>{if(this.props.textInputRef){const s=this.props.textInputRef.getEditorState().getSelection(),i=this._getSelectedText(),o=e===M.FormatterTypes.Link?this._makeLink(t):{type:a.EditableEntityType.PlainText,displayText:`${e}${i}${e}`};if(this.props.textInputRef.insertContent(o,s),0===i.length&&e!==M.FormatterTypes.Link){const t=this._getCaretPosition();if(n.isUndefined(t))return;const s=t+e.length;n.defer((()=>{this.props.textInputRef&&this.props.textInputRef.setCaretPosition(s)}))}}},this._renderBoldButton=()=>(0,o.jsx)(l.default,{style:P.iconButton,icon:h.SkypeIcon.Bold,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:c.getString("Formatting.Bold"),accessibilityLabel:c.getString("Formatting.Bold"),onPress:this._onBoldButtonClick,autoFocus:!0}),this._onBoldButtonClick=()=>{this._createEntityType(M.FormatterTypes.Bold),b.Instrumentation.track(new I.FormatterConsumedEvent(M.FormatterTypes.Bold))},this._renderItalicButton=()=>(0,o.jsx)(l.default,{style:P.iconButton,icon:h.SkypeIcon.Italic,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:c.getString("Formatting.Italic"),accessibilityLabel:c.getString("Formatting.Italic"),onPress:this._onItalicButtonClick}),this._onItalicButtonClick=()=>{this._createEntityType(M.FormatterTypes.Italic),b.Instrumentation.track(new I.FormatterConsumedEvent(M.FormatterTypes.Italic))},this._renderStrikeButton=()=>(0,o.jsx)(l.default,{style:P.iconButton,icon:h.SkypeIcon.Strikethrough,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:c.getString("Formatting.StrikeThrough"),accessibilityLabel:c.getString("Formatting.StrikeThrough"),onPress:this._onStrikeButtonClick}),this._onStrikeButtonClick=()=>{this._createEntityType(M.FormatterTypes.StrikeThrough),b.Instrumentation.track(new I.FormatterConsumedEvent(M.FormatterTypes.StrikeThrough))},this._renderCodeButton=()=>(0,o.jsx)(l.default,{style:P.iconButton,icon:h.SkypeIcon.CodeSnippet,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:c.getString("Formatting.Code"),accessibilityLabel:c.getString("Formatting.Code"),onPress:this._onCodeButtonClick}),this._onCodeButtonClick=()=>{this._createEntityType(M.FormatterTypes.Code),b.Instrumentation.track(new I.FormatterConsumedEvent(M.FormatterTypes.Code))},this._renderHyperlinkButton=()=>(0,o.jsx)(l.default,{style:P.iconButton,icon:h.SkypeIcon.Link,size:h.IconSize.size16,color:this._themeColors.iconPrimary,hoverColor:this._themeColors.iconHoverColor,title:c.getString("Formatting.Hyperlink"),accessibilityLabel:c.getString("Formatting.Hyperlink"),onPress:this._onHyperlinkButtonClick}),this._onHyperlinkButtonClick=()=>{const e=(0,o.jsx)(k,{initialSelection:this._getSelectedText(),onDone:e=>{this._createEntityType(M.FormatterTypes.Link,e)}});b.Instrumentation.track(new I.FormatterConsumedEvent(M.FormatterTypes.Link)),S.default.showModal(e,"linkModal",{rootViewId:_.MainRootViewId})}}_getCaretPosition(){if(this.props.textInputRef){return this.props.textInputRef.getEditorState().getSelection().getAnchorOffset()}}render(){const e=r.Styles.createViewStyle({backgroundColor:this._useDarkTheme()?p.Color.darkThemeSecondaryBackground:this._themeColors.surfacePrimary,borderColor:this._themeColors.dividerPrimary},!1),t=[P.container,e];return this.props.isTopPanel&&A&&t.push(P.containerRoundedCorners),(0,o.jsxs)(r.View,{style:t,children:[this._renderBoldButton(),this._renderItalicButton(),this._renderStrikeButton(),this._renderCodeButton(),this._renderHyperlinkButton()]})}}t.default=A},439075:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(623627),a=s(154235),l=s(26703),d=i.__importStar(s(704704)),c=i.__importDefault(s(960282)),u=i.__importDefault(s(660401)),h=i.__importDefault(s(497910)),p=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"center",padding:20,marginTop:15,marginRight:15,marginLeft:15,marginBottom:5,borderStyle:"solid",borderBottomWidth:1}),row:()=>n.Styles.createViewStyle({marginBottom:20}),noBorder:()=>n.Styles.createViewStyle({borderTopWidth:0,borderBottomWidth:0})});class g extends h.default{_buildState(e,t){let s=!0;{const t=this._getRootViewId(),i=c.default.getHeight(t),o=c.default.getWidth(t);(i<700||o<1e3)&&(s=!!e.alwaysForceEmoticon)}return{showEmoticon:s}}render(){if(!this.props.displayName)return null;const e=void 0===this.props.showBorder||this.props.showBorder;let t;return this.state.showEmoticon&&(t=(0,o.jsx)(n.View,{style:p.row,children:(0,o.jsx)(r.AnimatedEmoticon,{size:r.Size.ExtraLarge,emoticonName:"hi"})})),(0,o.jsxs)(n.View,{style:[this._themeStyles.dividerBorderColorStyle,p.container,e?{}:p.noBorder],children:[t,(0,o.jsx)(n.View,{children:(0,o.jsx)(u.default,{buttonSize:a.SXButtonSize.Small,title:d.getString("MessageStream.WaveButton"),allowTextWrap:!1,onPress:this.props.onGreet})})]})}}t.default=g},379610:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(451021)),r=i.__importDefault(s(900407)),a=i.__importDefault(s(560679)),l=i.__importStar(s(397691)),d=i.__importDefault(s(206483)),c=i.__importDefault(s(957867)),u=i.__importDefault(s(925494)),h=i.__importStar(s(987364)),p=i.__importStar(s(172134)),g=i.__importStar(s(971988)),m=i.__importStar(s(591312)),S=i.__importStar(s(459287)),_=i.__importDefault(s(389659)),f=i.__importStar(s(170881)),y=i.__importDefault(s(601976)),v=i.__importDefault(s(151938)),C=i.__importStar(s(242561)),T=s(815146),M=i.__importStar(s(265847)),b=i.__importDefault(s(532016)),I=i.__importStar(s(47013)),w=i.__importStar(s(920440)),P=i.__importStar(s(85385)),k=i.__importStar(s(704704)),A=i.__importDefault(s(656681)),x=i.__importStar(s(75776)),D=i.__importDefault(s(519093)),R=s(606933),L=i.__importDefault(s(321783)),B=s(786531),F=i.__importDefault(s(503411)),N=i.__importDefault(s(740794)),E=s(334635),O=s(822701),U=i.__importDefault(s(863132)),V=i.__importDefault(s(524617)),H=i.__importStar(s(437782)),j=i.__importStar(s(928314)),z=i.__importDefault(s(655192)),W=(i.__importDefault(s(220534)),s(240265)),G=i.__importStar(s(149418));t.default=new class{deleteMessage(e,t,s,i){const o=D.default.isMediaItem(e);let n=s?s.title:"",r=s?s.body:"";if(!s){let t="Global.RemoveMessage",s="Global.RemoveMessageContent";const i=g.getMessageTypeGroup(e);i===g.MessageTypeGroups.Picture?(t="Global.RemovePhoto",s="Global.RemoveMessagePhotoContent"):i===g.MessageTypeGroups.Video?(t="Global.RemoveVideo",s="Global.RemoveMessageVideoContent"):(o||e.isAlbum())&&(t="Global.RemoveMedia",s="Global.RemoveMessageMediaContent"),n=k.getString(t),r=k.getString(s)}const a=[{text:k.getString("Global.CancelLabel"),isCancel:!0},{text:k.getString("Global.RemoveLabel"),onPress:()=>this._delete(e,i),style:"destructive",isSubmit:!0}];d.default.showWithOptions({title:n,dialogAccessibilityTitle:r,message:r,buttons:a,rootViewId:t})}deleteMultipleMessages(e,t,s){const i=k.getString("Global.RemoveMultipleMessages",{count:e.length}),n=k.getString("Global.RemoveMultipleMessagesContent",{count:e.length}),r=[{text:k.getString("Global.CancelLabel"),isCancel:!0},{text:k.getString("Global.RemoveLabel"),onPress:()=>{o.each(e,(e=>{this._delete(e)})),s()},style:"destructive",isSubmit:!0}];d.default.showWithOptions({title:i,dialogAccessibilityTitle:n,message:n,buttons:r,rootViewId:t})}cancelFailedSend(e){const{conversationId:t,createdTime:s}=e;U.default.cancelFailedPost(e);const i=new B.MessageActionTelemetry(t,e,s,B.MessageActionOrigin.StreamItem,B.MessageActionType.CancelRejected);P.track(i)}retryFailedSend(e){const t=e.getSendRetryInfo();if(t&&U.default.canRetry(t)){const s=this._getDocId(e);U.default.retry(t,s);const i=new B.MessageActionTelemetry(e.conversationId,e,e.createdTime,B.MessageActionOrigin.StreamItem,B.MessageActionType.RetryFailed,s);P.track(i)}else P.warn(T.LogTraceArea.MessageOptionsHelper,"StreamItem: Cannot retry failed send with this info, but we gave the option to retry")}_getDocId(e){const t=e.getSendRetryInfo();if(t&&t.kind===O.PostUploadInfoKind)return o.first(t.messagesForPosting[e.conversationId].amsreferences)}_delete(e,t){e.hasAlbumId()?this._deleteAlbumMessage(e):U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete),t&&t()}_deleteAlbumMessage(e){const t=e.getAlbumId();if(e.isAlbum())return void this._deleteAlbum(e);const s=A.default.getAlbumMessage(t);s&&1===A.default.getAllMediaMessagesForAlbum(t).length?this._deleteAlbum(s):U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete)}_deleteAlbum(e){const t=e.getAlbumId(),s=A.default.getAllMediaMessagesForAlbum(t);U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete),o.each(s,(e=>U.default.deleteMessage(e,T.PostSource.MessageOptionsDelete)))}cancelMessageSend(e,t){if(D.default.isVideo(e)){const s=k.getString("VideoNode.CancelSendTitle"),i=k.getString("VideoNode.CancelSendBody"),o=[{text:k.getString("Global.YesLabel"),onPress:()=>this._cancelMessageSend(e,B.MessageActionOrigin.StreamItem),style:"destructive",isSubmit:!0},{text:k.getString("Global.NoLabel"),isCancel:!0}];d.default.showWithOptions({title:s,dialogAccessibilityTitle:i,message:i,buttons:o,rootViewId:t})}else this._cancelMessageSend(e,B.MessageActionOrigin.StreamItem)}_cancelMessageSend(e,t){const s=e,{conversationId:i,createdTime:n}=s;o.each(s.getUnacknowledgedClientMessageIds(),(e=>{U.default.cancelPostMessage(i,e)}));const r=this._getDocId(e),a=new B.MessageActionTelemetry(i,s,n,t,B.MessageActionType.Cancel,r);P.track(a)}_getReportContextForMessage(e){switch(g.getMessageTypeGroup(e)){case g.MessageTypeGroups.UriFile:return T.ReportContextListOptions.FileMessage;case g.MessageTypeGroups.Picture:return T.ReportContextListOptions.PictureMessage;case g.MessageTypeGroups.Audio:return T.ReportContextListOptions.AudioMessage;case g.MessageTypeGroups.Video:return T.ReportContextListOptions.VideoMessage;default:return T.ReportContextListOptions.Message}}reportMessage(e,t){f.dismissAll();const s={mriToBlock:e.creator,rootViewId:t,content:e,reportContext:this._getReportContextForMessage(e),isBlockingDialog:!1,conversationId:e.conversationId};N.default.navigateToReportConcernModal(s)}showReportedMessage(e){p.markMessageReported(e,!1);const{conversationId:t,createdTime:s}=e,i=new B.MessageActionTelemetry(t,e,s,B.MessageActionOrigin.StreamItem,B.MessageActionType.ShowReportedMessage);P.track(i)}_getTextToCopy(e,t,s){let i,o;return s?i=s:j.isTextSelected()?i=j.getSelectedText():(i=m.renderText(t,{message:e,processing:C.ProcessingDefaults.Stripped}),t.hasHtmlContent()&&(o=G.renderHtml(t))),{textToCopy:i,htmlToCopy:o}}_copyTextToClipboard(e,t,s){const{textToCopy:i,htmlToCopy:o}=this._getTextToCopy(e,t,s);o?a.default.setHtml(o,i):i&&(0,W.writeTextToClipboard)(i)}copyMultipleMessages(e,t){let s="";o.each(e,(e=>{const t=y.default.getMemberShortNameForConversation(e.message.conversationId,e.message.creator),i=_.default.getDisplayTimeString(e.message.createdTime),o=k.getString("MessageStream.CopyMetadata",{displayName:t,time:i}),n=m.renderText(e.node,{message:e.message,processing:C.ProcessingDefaults.Stripped})+"\r\r";s=s+o+"\r"+n})),s&&(0,W.writeTextToClipboard)(s.trim()),F.default.scheduleTextMessage(k.getString("MessageStream.MessageCopied"),void 0,t)}getTextToCopy(e,t,s){return this._getTextToCopy(e,t,s)}copyMessage(e,t,s,i){this._copyTextToClipboard(e,t,i);const o=new B.MessageActionTelemetry(e.conversationId,e,e.createdTime,B.MessageActionOrigin.StreamItem,B.MessageActionType.Copy);F.default.scheduleTextMessage(k.getString("MessageStream.MessageCopied"),void 0,s),P.track(o)}copyLinkMessage(e,t){(0,W.writeTextToClipboard)(e);const s=new B.MessageActionTelemetry(t.conversationId,t,t.createdTime,B.MessageActionOrigin.StreamItem,B.MessageActionType.CopyLink);P.track(s)}copyLocationMessage(e,t){this._copyTextToClipboard(e,t,void 0);const s=new B.MessageActionTelemetry(e.conversationId,e,e.createdTime,B.MessageActionOrigin.StreamItem,B.MessageActionType.Copy);P.track(s)}viewLink(e,t){e&&d.default.showOKAlert("",e,t,!0)}copyImageFromMessage(e){const t=D.default.getMediaDescriptorForItem(e);if(t&&t.mediaType===E.PictureViewer.MediaType){this.copyImage(t.fullResolutionUrl);const s=new B.MessageActionTelemetry(e.conversationId,e,e.createdTime,B.MessageActionOrigin.StreamItem,B.MessageActionType.Copy);P.track(s)}else P.warn(T.LogTraceArea.MessageOptionsHelper,"Trying to copy message that is not an image as an image.")}copyImage(e){w.copyImageToClipboard(e)}markMessageUnread(e,t){const{conversationId:s,createdTime:i}=e,o=new B.MessageActionTelemetry(s,e,i,B.MessageActionOrigin.StreamItem,B.MessageActionType.MarkMessageUnread);P.track(o),p.markMessageUnreadFromGivenMessage(e).then((e=>{t&&t(e)})).catch((e=>{P.warn(T.LogTraceArea.MessageOptionsHelper,"StreamItem could not set consumption horizon")}))}openOnDesktop(e,t,s,i,o,n){return!1}openMediaLocationOnDesktop(e){this._openFileLocation(h.getFileCacheKeyMedia(e,!0))}openFileLocationOnDesktop(e){const t=e.getFirstUriObjectChild(R.UriObjectFileNode);if(!t)return;const s=new u.default(t.getFileContentUrlSanitized()).getDocumentId();s&&this._openFileLocation(s)}_openFileLocation(e){const t=b.default.getLocalUri(e);t&&I.openFileLocation(t)}_trackDownload(e,t,s,i,o){const n=v.default.downloadUpdated.subscribe((r=>{if(r.key!==e||!r.isFinished)return;const a=r.amsGetStatusTransfer&&r.amsGetStatusTransfer.success,l=r.downloadTransfer&&r.downloadTransfer.success;(a||l)&&r.downloadTempLocalUri?o?o(e,r.downloadTempLocalUri):this._downloadSuccess(e,r.downloadTempLocalUri,t,s,i):(i&&s.hasAlbumId()&&A.default.markAlbumMessageDownloadCompleted(s.getAlbumId(),s.cuid),F.default.scheduleTextMessage(k.getString("MediaViewer.SaveFailure"),void 0,t)),F.default.removeToastMessage(`${e}-downloading`),n.unsubscribe()}));i&&s.hasAlbumId()&&!A.default.isDownloadingAlbum(s.getAlbumId())&&A.default.startAlbumDownload(s.getAlbumId()),this._showDownloadingToast(`${e}-downloading`,t)}_downloadSuccess(e,t,s,i,o){let n=k.getString("MediaViewer.SaveSuccess");if(o&&i.hasAlbumId()){const e=i.getAlbumId();if(A.default.markAlbumMessageDownloadCompleted(e,i.cuid),A.default.isDownloadingAlbum(e))return;A.default.getAllMediaMessagesForAlbum(e).length>1&&(n=k.getString("MediaViewer.SaveAllSuccess"))}F.default.scheduleMessage({key:e,textMessage:n,onPress:()=>I.openFile(t),rootViewId:s})}_handleFileFromCache(e,t){if(M.default.isLocalCacheSupported()&&M.default.isKnown(e)){const s=M.default.getLocalUri(e);if(s)return t(s),!0}return!1}saveToDesktop(e,t,s,i,n,a,d){{const i=g.getMessageTypeGroup(e);o.isEmpty(s)&&(i===g.MessageTypeGroups.Picture?s=k.getString("StreamItem.SavePictureFileName"):i===g.MessageTypeGroups.Video&&(s=k.getString("StreamItem.SaveVideoFileName"))),r.default.saveFile(t,s)}return this._checkFileStatusAvailabilityAsync(t).then((()=>!0)).fail((e=>(P.error(T.LogTraceArea.MessageOptionsHelper,`saveToDesktop failed: ${z.default.errorAsString(e)}`),F.default.scheduleTextMessage(k.getString("MediaViewer.SaveFailure"),void 0,a),l.Resolved(!1))))}desktopSaveAs(e,t,s,i,o,n){}_checkFileStatusAvailabilityAsync(e){const t=new u.default(e),s=t.getDocumentId(),i=t.getViewId();return s&&i?c.default.getStatusAsync(s,i).then((e=>e?l.Resolved():l.Rejected(`Check file status availability async failed. StatusInfo:  ${z.default.errorAsString(e)}`))):l.Rejected("Check file status availability async failed, amsObjectId missing.")}downloadToCameraRoll(e,t,s,i,o,n,r){const a=h.getFileCacheKeyMedia(e,!0);this.saveToDesktop(e,t,s,a,i,o,n).then((a=>{if(a)return;const l=h.getFileCacheKeyMedia(e,!0),d=M.default.getLocalUri(l);d?this.saveToCameraRoll(e,d,o,n,r):x.default.isQueued(l)||V.default.requestCameraRollPermission().then((a=>{if(P.log(T.LogTraceArea.MessageOptionsHelper,"downloadToCameraRoll: Access allowed?",a?"yes":"no"),a){const a=v.default.isDownloadNotificationEnabled()?l:void 0,d=new x.QueueItem(l,t,s,"streamItem",Date.now()+36e5,M.CacheEvictionKind.UserInvolved,Date.now(),a);x.default.add(d,i).then((s=>{s.cancelled?P.log(T.LogTraceArea.StreamItem,"Media prefetching cancelled for: ",H.dev_unknownOmit(l),H.dev_unknownOmit(t)):this.saveToCameraRoll(e,s.url,o,n,((e,t)=>{a&&e&&t&&v.default.notifyFinished(a,d.filename,t),null==r||r(e)}))})).catch((e=>{P.error(T.LogTraceArea.MessageOptionsHelper,"Something went wrong in prefetching media to cache: ",l,H.dev_unknownOmit(t),z.default.errorAsString(e))}))}}))}))}saveToCameraRoll(e,t,s,i,o){const r="downloading";V.default.requestCameraRollPermission().then((a=>{if(P.log(T.LogTraceArea.MessageOptionsHelper,"CameraRoll: Access allowed?",a?"yes":"no"),a){const a=g.getMessageTypeGroup(e);let l="photo";a===g.MessageTypeGroups.Video?l="video":a===g.MessageTypeGroups.Audio&&(l="audio");const d="audio"===l?void 0:l;i&&e.hasAlbumId()?A.default.isDownloadingAlbum(e.getAlbumId())||(A.default.startAlbumDownload(e.getAlbumId()),this._showDownloadingToast(r,s)):this._showDownloadingToast(r,s),n.default.saveToCameraRoll(t,d).then((n=>{P.log(T.LogTraceArea.MessageOptionsHelper,"Saved successfully to the CameraRoll",H.dev_unknownOmit(t)),this._onCameraRollSave(l,s,e.getAlbumId(),i),o&&o(!0,n)})).catch((e=>{let t;P.error(T.LogTraceArea.MessageOptionsHelper,"Error saving to the CameraRoll.",z.default.errorAsString(e)),t="photo"===l?k.getString("MessageActionMenu.PhotoSaveFailNotification"):"audio"===l?k.getString("MessageActionMenu.AudioSaveFailNotification"):k.getString("MessageActionMenu.VideoSaveFailNotification"),t&&F.default.scheduleTextMessage(t,void 0,s),o&&o(!1)})).finally((()=>{i&&e.hasAlbumId()&&(A.default.markAlbumMessageDownloadCompleted(e.getAlbumId(),e.cuid),A.default.isDownloadingAlbum(e.getAlbumId()))||F.default.removeToastMessage(r)}))}}))}_onCameraRollSave(e,t,s,i){let o;switch(e){case"photo":o=k.getString("MessageActionMenu.PhotoSavedNotification");break;case"audio":o=k.getString("MessageActionMenu.AudioSavedNotification");break;case"video":o=k.getString("MessageActionMenu.VideoSavedNotification");break;default:o=k.getString("MediaViewer.SaveAsSuccess")}if(i&&s){if(A.default.isDownloadingAlbum(s))return;A.default.getAllMediaMessagesForAlbum(s).length>1&&(o=k.getString("MediaViewer.SaveAllSuccess"))}F.default.scheduleTextMessage(o,void 0,t)}_showDownloadingToast(e,t){F.default.scheduleMessage({key:e,duration:3e5,textMessage:k.getString("MediaViewer.Downloading"),rootViewId:t})}dumpMessage(e,t){const s=JSON.stringify(e,null,t?4:void 0),i=S.createMessageInfoFromEscapedText(e.conversationId,T.PostSource.StreamItemCommand,s);L.default.cachedStoreFor(e.conversationId,void 0).feedEphemeralMessage(i)}}},770169:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StatusPillView=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(815146),l=i.__importDefault(s(560099)),d=i.__importStar(s(85385)),c=s(26703),u=i.__importStar(s(704704)),h=i.__importDefault(s(791384)),p=s(218902),g=i.__importDefault(s(842252)),m=s(16549),S=i.__importDefault(s(915305)),_=s(140304),f=i.__importDefault(s(827361)),y=s(262725),v=i.__importDefault(s(497910)),C=i.__importDefault(s(601274)),T=s(262725),M=i.__importDefault(s(740794)),b=i.__importDefault(s(970035)),I=s(641400),w=s(710664),P=s(677982),k=(0,c.lazyProperties)({stickyStreamDividerContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"center",alignItems:"flex-end",overflow:"hidden"}),textStyle:()=>(0,c.lazyProperties)({default:()=>r.Styles.createTextStyle({color:m.Color.gray400}),white:()=>r.Styles.createTextStyle({color:m.Color.white}),whiteSearch:()=>r.Styles.createTextStyle({flexDirection:"row",color:m.Color.white,alignItems:"center",justifyContent:"center"}),searchButtons:()=>r.Styles.createTextStyle({fontSize:12})}),pill:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center",minHeight:30,borderRadius:15,paddingHorizontal:25,backgroundColor:m.Color.gray100Overlay80}),pillStyle:()=>(0,c.lazyProperties)({default:()=>r.Styles.createViewStyle({backgroundColor:m.Color.gray100Overlay80}),darkGreyBg:()=>r.Styles.createViewStyle({backgroundColor:m.Color.gray300}),blackBg:()=>r.Styles.createViewStyle({backgroundColor:m.Color.black}),blueBg:()=>r.Styles.createViewStyle({backgroundColor:m.Color.blue}),searchHistoryButtons:()=>r.Styles.createViewStyle({flexDirection:"row",paddingLeft:8})}),relativePosition:()=>r.Styles.createViewStyle({position:"relative"}),searchButton:()=>r.Styles.createViewStyle({flexDirection:"row",paddingLeft:8,alignItems:"center"}),icons:()=>r.Styles.createViewStyle({flexDirection:"row",paddingRight:3})}),A=e=>{d.log(a.LogTraceArea.ConnectivityStatusBar,e)},x=e=>n.isUndefined(e.status)?void 0:p.PillStatus[e.status];class D extends v.default{constructor(){super(...arguments),this._verticalAnimatedValue=new r.Animated.Value(-40.7),this._verticalAnimatedStyle=r.Styles.createAnimatedViewStyle({transform:[{translateY:this._verticalAnimatedValue}]}),this.touch=()=>{this.state.content?(this._hiding&&this._animation&&(A("touch: currently hiding, stopping animation"),this._animation.stop()),this.state.shown||this._showing||(A("touch: hidden, start the animation"),this._animation=g.default.easeOut({value:this._verticalAnimatedValue,toValue:0}),this._showing=!0,this._animation.start((()=>{A("touch: show animation finished"),this.isComponentMounted()&&(this._showing=!1,this.setState({shown:!0}),this._scheduleHide())}))),this._hideTimeout&&(A("touch: hide timer exists, cleaning and scheduling new one"),C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0,this._scheduleHide())):A("touch: returning, no content")},this.handleMouseEnter=()=>{this.state.status===p.PillStatus.SEARCH&&this._hideTimeout&&(A("touch: hide timer exists, cleaning because user is hovering over the pill"),C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0)},this.handleMouseLeave=()=>{this.state.status===p.PillStatus.SEARCH&&this._scheduleHide(3e3)},this._scheduleHide=(e=5e3)=>{var t,s;if(!this._shouldAutoHide(this.state))return void A("scheduleHide: early return, _shouldAutoHide returned false. NOT scheduling timer");let i;A("scheduleHide: scheduling hide"),i=this.state.status===p.PillStatus.SEARCH?e:null!==(s=null===(t=this.props.customAutoHideBehaviour)||void 0===t?void 0:t.customAutoHideTimeout)&&void 0!==s?s:1500,this._hideTimeout=C.default.setTimeout(this._dangerouslyHideWithoutTimer,i)},this._dangerouslyHideWithoutTimer=()=>{!this._hiding&&this.state.shown&&(this._hideTimeout&&(C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0),this._animation=g.default.easeOut({value:this._verticalAnimatedValue,toValue:-40.7}),this._hiding=!0,A("scheduleHide: starting hide animation"),this._animation.start((()=>{var e,t;A("scheduleHide: hide animation finished"),this.isComponentMounted()&&(this._hiding=!1,this.setState({shown:!1}),null===(t=null===(e=this.props.customAutoHideBehaviour)||void 0===e?void 0:e.onAutoHidden)||void 0===t||t.call(e))})))},this._onPress=e=>{var t,s;e.stopPropagation(),this._dangerouslyHideWithoutTimer(),null===(s=(t=this.props).onClickOverride)||void 0===s||s.call(t)},this._getLastImageSent=e=>{e.stopPropagation(),this.props.conversationId&&(d.track(new w.EnhancedHistorySearchEvent(w.EnhancedHistorySearchActionType.QuickLastImage)),this._revealInConversation(this.state.lastMediaInConversation))},this._getLastLinkSent=e=>{e.stopPropagation(),this.props.conversationId&&(d.track(new w.EnhancedHistorySearchEvent(w.EnhancedHistorySearchActionType.QuickLastLink)),this._revealInConversation(this.state.lastLinkInConversation))},this._revealInConversation=n.debounce((e=>{e&&(0,_.getGalleryItemTimestamp)(e.cuid,e.conversationId,Number(e.getOriginalServerId())).then((t=>{this.isComponentMounted&&(this._scheduleHide(0),M.default.navigateToMessageFromSearchMessagePanel((null==t?void 0:t.timestamp)||e.createdTime,e.conversationId,this._getRootViewId()))}))}),300)}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this.props.statusPillInstance.setMessageStreamStore(this.props.messageStreamStore)}UNSAFE_componentWillReceiveProps(e,t){super.UNSAFE_componentWillReceiveProps(e,t),this.props.statusPillInstance.setMessageStreamStore(e.messageStreamStore)}_shouldAutoHide(e){var t,s;return null!==(s=!(null===(t=this.props.customAutoHideBehaviour)||void 0===t?void 0:t.autoHideDisabled))&&void 0!==s?s:!n.includes([p.PillStatus.NO_CONNECTION,p.PillStatus.CONNECTING,p.PillStatus.UPDATING],e.status)}_shouldDisableClickEvents(e){return this._shouldAutoHide(e)&&void 0===this.props.onClickOverride}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.content!==t.content&&(A(`The content changed: ${x(t)} -> ${x(this.state)}, calling touch().`),this.touch(),this._announceUpdatedStateForA11y(this.state,t)),!this._shouldAutoHide(t)&&this._shouldAutoHide(this.state)&&(A("ShouldAutoHide changed from false to true, calling _scheduleHide()."),this._scheduleHide())}componentWillUnmount(){super.componentWillUnmount(),this.props.statusPillInstance.setMessageStreamStore(void 0),this._hideTimeout&&(C.default.clearTimeout(this._hideTimeout),this._hideTimeout=void 0)}componentDidMount(){super.componentDidMount(),this._shouldAutoHide(this.state)||(A(`Just mounted, displaying content that shouldn't be auto hidden: ${x(this.state)} `),this.touch())}_buildState(e,t){var s;const i=void 0!==e.connectionStatusOnly&&e.connectionStatusOnly,o=e.customContent?p.PillStatus.INFO:e.statusPillInstance.getPillStatus(),n={showAsUnread:e.statusPillInstance.showAsUnread(),content:null!==(s=e.customContent)&&void 0!==s?s:e.statusPillInstance.getContent(i,e.conversationId),status:o,accentColor:this._getContext().userColor.primaryAccent};return e.conversationId&&(n.lastMediaInConversation=S.default.getMediaForConversation(e.conversationId,Date.now(),1,t,!0,void 0)[0],n.lastLinkInConversation=S.default.getLinksForConversation(e.conversationId,Date.now(),1,t,!0)[0]),t&&(n.shown=!1,n.enabledForInfo=void 0!==e.customContent,n.disableForUpdates=P.AppConfigStore.getS4LMessagingFeatures().enableConversationSyncLie),n}_getPillStyle(){const e=this._getAccentColor(),t=r.Styles.createViewStyle({backgroundColor:this._themeColors.surfaceInteractive},!1),s=r.Styles.createTextStyle({color:this._themeColors.textOnColor},!1);return{[p.PillStatus.NO_CONNECTION]:[k.pillStyle.blackBg,k.textStyle.white],[p.PillStatus.CAPTIVE_PORTAL]:[k.pillStyle.blackBg,k.textStyle.white],[p.PillStatus.CONNECTING]:[k.pillStyle.darkGreyBg,k.textStyle.white],[p.PillStatus.UPDATING]:[t,s],[p.PillStatus.SEARCH]:[r.Styles.createViewStyle({backgroundColor:e.backgroundColor},!1),k.textStyle.white],[p.PillStatus.INFO]:this.props.shouldRespectAccentColor?[r.Styles.createViewStyle({backgroundColor:e.backgroundColor},!1),r.Styles.createTextInputStyle({color:e.textColor},!1)]:this.state.showAsUnread?[k.pillStyle.blueBg,k.textStyle.white]:[k.pillStyle.default,k.textStyle.default]}[this.state.status]||[k.pillStyle.default,k.textStyle.default]}render(){if(!this.state.content)return A("rendering empty content, returning null"),null;if(this.state.status===p.PillStatus.INFO&&!this.state.enabledForInfo)return null;if(this.state.disableForUpdates&&this.state.status===p.PillStatus.UPDATING)return null;if(this.state.status===p.PillStatus.CAPTIVE_PORTAL||this.state.status===p.PillStatus.NO_CONNECTION)return null;const[e,t]=this._getPillStyle(),s=this.props.maxWidth?r.Styles.createViewStyle({maxWidth:this.props.maxWidth},!1):void 0,i=this.props.customContent?r.Styles.createViewStyle({paddingHorizontal:16,paddingVertical:4},!1):void 0,n=[k.pill,this._verticalAnimatedStyle,e,s,i],a=void 0===this.props.customContent?r.Styles.createViewStyle({height:37},!1):void 0,d=[(this.state.status,p.PillStatus.SEARCH,k.stickyStreamDividerContainer),f.default.noncollapsibleView,a];let c;return this.props.disableAbsolutePosition&&d.push(k.relativePosition),c=this.state.status===p.PillStatus.SEARCH&&(this.state.lastLinkInConversation||this.state.lastMediaInConversation)?(0,o.jsxs)(r.View,{style:k.textStyle.whiteSearch,children:[(0,o.jsx)(y.Caption,{style:t,children:u.getString("RevealMedia.StatusPillTitle")}),(0,o.jsxs)(r.View,{style:k.pillStyle.searchHistoryButtons,children:[this.state.lastMediaInConversation&&(0,o.jsxs)(r.Button,{style:k.searchButton,onPress:this._getLastImageSent,children:[(0,o.jsx)(b.default,{icon:I.SkypeIcon.Gallery1,size:I.IconSize.size16,color:m.Color.white,style:k.icons}),(0,o.jsx)(T.Subtitle,{style:[t,k.textStyle.searchButtons],children:u.getString("RevealMedia.StatusPillLastImage")})]}),this.state.lastLinkInConversation&&(0,o.jsxs)(r.Button,{style:k.searchButton,onPress:this._getLastLinkSent,children:[(0,o.jsx)(b.default,{icon:I.SkypeIcon.Link,size:I.IconSize.size16,color:m.Color.white,style:k.icons}),(0,o.jsx)(T.Subtitle,{style:[t,k.textStyle.searchButtons],children:u.getString("RevealMedia.StatusPillLastLink")})]})]})]}):(0,o.jsx)(r.Button,{onPress:this._onPress,disabled:this._shouldDisableClickEvents(this.state),disabledOpacity:1,children:(0,o.jsx)(y.Caption,{style:[t,void 0===this.props.customContent?void 0:{flexWrap:"wrap",wordBreak:"break-word"}],numberOfLines:void 0===this.props.customContent?1:void 0,messageStreamFontSize:this.props.messageStreamFontSize,children:this.state.content})}),(0,o.jsx)(l.default,{ignorePointerEvents:this.state.status!==p.PillStatus.SEARCH,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,style:d,children:(0,o.jsx)(r.Animated.View,{style:n,ignorePointerEvents:!0,children:c})},"statusPill")}_announceUpdatedStateForA11y(e,t){if(h.default.shouldAnnounceForAccessibility())return t.status===p.PillStatus.CONNECTING&&e.status!==p.PillStatus.CONNECTING?r.Accessibility.announceForAccessibility(u.getString("ConnectivityStatusBar.Connected")):e.status===p.PillStatus.CONNECTING?r.Accessibility.announceForAccessibility(u.getString("ConnectivityStatusBar.Connecting")):e.status===p.PillStatus.UPDATING?r.Accessibility.announceForAccessibility(u.getString("ConnectivityStatusBar.UpdatingConversation")):void 0}_getAccentColor(){return this._useAccessibleTheme()?{backgroundColor:this._themeColors.primaryTextColor,textColor:this._themeColors.primaryBackgroundColor}:{backgroundColor:this._themeColors.textOnAccent,textColor:this._themeColors.surfaceAccent}}setEnabledForInfo(e){return this.isComponentMounted()&&e&&this.setState({enabledForInfo:e}),this}}t.StatusPillView=D},748266:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdatePillView=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(537180),a=i.__importStar(s(667294)),l=s(859745),d=s(815146),c=i.__importStar(s(85385)),u=i.__importStar(s(704704)),h=s(262725),p=s(964414),g=i.__importDefault(s(791384)),m=s(526849),S=s(218902),_=l.Common.Duration.Default,f=e=>{c.log(d.LogTraceArea.ConnectivityStatusBar,e)},y=()=>{const e=a.useRef(),t=()=>{e.current&&(clearTimeout(e.current),e.current=void 0)};return{clearTimer:t,setTimer:(s,i)=>{t(),e.current=setTimeout(s,i)}}};t.UpdatePillView=(0,m.WithResub)((e=>{const[t,s]=a.useState(!1),[i,l]=a.useState(!1),d=a.useRef(new r.Animated.Value(-40.7)),{clearTimer:c,setTimer:m}=y(),{clearTimer:v,setTimer:C}=y(),T=(0,p.useSkypeStyles)((({themeColors:e})=>({pillWrapper:{position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"center",alignItems:"center",overflow:"hidden",height:37,pointerEvents:"box-none"},pill:{alignItems:"center",justifyContent:"center",minHeight:30,borderRadius:15,paddingHorizontal:25,backgroundColor:e.surfaceInteractive},pillText:{color:e.textOnColor,fontSize:12}})),[]),M=a.useCallback((()=>{r.Animated.timing(d.current,{toValue:3,duration:_,easing:r.Easing.out(r.Easing.ease),useNativeDriver:!0}).start()}),[]),b=a.useCallback((()=>{r.Animated.timing(d.current,{toValue:-40.7,duration:_,easing:r.Easing.in(r.Easing.ease),useNativeDriver:!0}).start()}),[]),I=a.useCallback((e=>{e.stopPropagation(),b(),v(),c()}),[b,c,v]),w=a.useCallback((()=>{g.default.shouldAnnounceForAccessibility()&&n.Accessibility.announceForAccessibility(u.getString("ConnectivityStatusBar.UpdatingConversation"))}),[]);return a.useEffect((()=>{s(e.pillStatus===S.PillStatus.UPDATING)}),[e.pillStatus]),a.useEffect((()=>(t?(c(),C((()=>{l(!0)}),1500)):(v(),m((()=>{l(!1)}),500)),()=>{c(),v()})),[t,C,m,c,v]),a.useEffect((()=>{i?(f("UpdatePill playing show animation"),w(),M()):(f("UpdatePill playing hide animation"),b())}),[i,M,b,w]),(0,o.jsx)(r.View,{style:T.pillWrapper,children:(0,o.jsx)(r.Animated.View,{style:[T.pill,{transform:[{translateY:d.current}]}],children:(0,o.jsx)(r.Pressable,{onPress:I,children:(0,o.jsx)(h.Caption,{messageStreamFontSize:e.messageStreamFontSize,children:(0,o.jsx)(r.Text,{style:T.pillText,children:u.getString("ConnectivityStatusBar.UpdatingConversation")})})})})},"statusPill")}),(e=>({pillStatus:e.pillStoreInstace.getPillStatus(),messageStreamFontSize:e.messageStreamFontSize})))},822871:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AltMsgView=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(166552)),a=s(844104),l=i.__importDefault(s(827361));class d extends n.Component{constructor(e){super(e),this._dynamicList=null,this._observableListSubscription=null,this._onDynamicListRef=e=>{this._dynamicList=e,this._observableListSubscription&&this._observableListSubscription.unsubscribe(),this._dynamicList&&(this._dynamicList.onDataChanged(0,Number.MAX_VALUE,0,this.props.observableList.getItemList()),this._observableListSubscription=this.props.observableList.listChanged.subscribe(this._onDataChanged))},this._onDataChanged=e=>{if(this._dynamicList){let t=0,s=0;e.type!==a.ListModificationType.RemoveItems&&e.type!==a.ListModificationType.ReplaceItems&&e.type!==a.ListModificationType.MoveItems||void 0!==e.removeIndex&&e.count&&(t=e.removeIndex,s=e.count);let i=0,o=[];e.type!==a.ListModificationType.AddItems&&e.type!==a.ListModificationType.ReplaceItems&&e.type!==a.ListModificationType.MoveItems||void 0!==e.insertIndex&&e.items&&(i=e.insertIndex,o=e.items),this._dynamicList.onDataChanged(t,s,i,o)}},this._onLayout=e=>{this.props.onLayout&&this.props.onLayout(e),this.setState({isListVisible:!0})},this._onListViewportChange=e=>{if(this.props.onVisibleRangeChanged&&e.itemsInViewport){const t=e.itemsInViewport.first,s=e.itemsInViewport.last,i=e.itemsFullyInViewport?e.itemsFullyInViewport.first:t,o=e.itemsFullyInViewport?e.itemsFullyInViewport.last:i;this.props.onVisibleRangeChanged(t,s,i,o)}},this.state={isListVisible:!1}}render(){return(0,o.jsx)(n.View,{style:l.default.flexOne,onLayout:this._onLayout,children:this.state.isListVisible&&(0,o.jsx)(r.default,{ref:this._onDynamicListRef,renderItem:this.props.renderItem,onViewportChange:this._onListViewportChange,initialScrollIndex:this.props.initialScrollIndex})})}scrollToBottom(){this._dynamicList&&this._dynamicList.scrollToEnd()}scrollToPosition(e,t,s=!1){this._dynamicList&&this._dynamicList.scrollToPosition(e)}focusMessage(e){}}t.AltMsgView=d},597542:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VirtualMessageView=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=(i.__importDefault(s(288400)),s(614080)),a=i.__importStar(s(859745)),l=i.__importStar(s(516778)),d=s(844104),c=i.__importStar(s(815146)),u=i.__importStar(s(85385)),h=i.__importDefault(s(114818)),p=i.__importDefault(s(214295)),g=i.__importDefault(s(54945)),m=s(26703),S=i.__importDefault(s(327400)),_=i.__importDefault(s(421334)),f=s(285661),y=s(86859),v=s(842252),C=i.__importDefault(s(827361)),T=y.SwiftSuggestionStyles.suggestionsBarHeight,M=!1,b=(0,m.lazyProperties)({scrollOuterContainer:()=>l.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"}),scrollInnerContainer:()=>l.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),scrollView:()=>l.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch",flexDirection:"column"}),staticContainer:()=>l.Styles.createViewStyle({flex:-1,opacity:1,flexDirection:"column"}),compositeItemsListContainer:()=>l.Styles.createViewStyle({flex:1,flexDirection:"row"})}),I={},w={};var P,k;!function(e){e[e.UnmeasuredAbove=0]="UnmeasuredAbove",e[e.UnmeasuredBelow=1]="UnmeasuredBelow",e[e.UnmeasuredInside=2]="UnmeasuredInside",e[e.UnmeasuredInsideNoAnimation=3]="UnmeasuredInsideNoAnimation",e[e.Measured=4]="Measured"}(P||(P={})),function(e){e[e.Undefined=0]="Undefined",e[e.WaitingForScroll=1]="WaitingForScroll"}(k||(k={}));class A{constructor(){this._average=0,this._count=0}input(e){const t=1/(this._count+1),s=t*this._count;this._average=e*t+this._average*s,this._count++}correct(e){this._average+=e/this._count}getAverage(){return Math.round(this._average)}}class x extends l.Component{constructor(e){super(e),this._lastScrollTop=0,this._lastScrollTopSetByUser=0,this._lastScrollLeft=0,this._viewportHeight=0,this._oldViewportHeight=0,this._viewportWidth=0,this._lastContainerLayoutTime=0,this._virtualListCells={},this._virtualListCellRefCallbacks={},this._scrollOuterContainerHeight=0,this._contentWidth=-1,this._isMounted=!1,this._containerHeight=0,this._containerHeightValue=new l.Animated.Value(this._containerHeight),this._containerAnimatedStyle=l.Styles.createAnimatedViewStyle({height:this._containerHeightValue}),this._isInitialInnerScrollContainerHeightMeasured=!1,this._innerScrollContainerHeight=0,this._innerScrollContainerHeightValue=new l.Animated.Value(this._innerScrollContainerHeight),this._scrollInnerContainerStyle=l.Styles.createAnimatedViewStyle({height:this._innerScrollContainerHeightValue}),this._itemList=[],this._itemMap={},this._isRenderDirty=!1,this._itemListChangedSinceLastVisibleRangeChange=!1,this._heightAboveRenderBlockEstimate=0,this._heightAboveRenderBlockCorrection=0,this._heightOfRenderBlock=0,this._heightBelowRenderBlockEstimate=0,this._heightBelowRenderBlockCorrection=0,this._itemsAboveRenderBlock=0,this._itemsInRenderBlock=0,this._itemsBelowRenderBlock=0,this._pendingMeasures={},this._pendingMounts={},this._pendingAnimations={},this._filledViewableScreen=!1,this._heightCache={},this._renderInfoCache={},this._lastPartialTopVisibleItem=-1,this._lastPartialBottomVisibleItem=-1,this._lastWholeTopVisibleItem=-1,this._lastWholeBottomVisibleItem=-1,this._onListChangedQueue=[],this._onLayoutItemQueue=[],this._onAnimateStartStopItemQueue=[],this._currentAverageHeight=0,this._averageHeightCounter=new A,this._isScreenReaderEnabled=!1,this._onLayoutOuterScrollContainer=e=>{if(u.log(c.LogTraceArea.VirtualMessageView,"onLayoutOuterScrollContainer: width "+e.width+" height "+e.height),!this._isMounted)return;const t=0!==p.default.getUpdateInfo().height;if(!this.props.allowKeyboardLayoutUpdates&&t&&this._isInitialInnerScrollContainerHeightMeasured)return void u.log(c.LogTraceArea.VirtualMessageViewDebug,"onLayoutOuterScrollContainer: ignoring event because keyboard is shown, height: "+Math.round(e.height));const s=Math.round(e.height);0!==s?(t||(this._isInitialInnerScrollContainerHeightMeasured=!0),this._scrollOuterContainerHeight=s,0===this._innerScrollContainerHeight?(this._innerScrollContainerHeight=s,this._innerScrollContainerHeightValue.setValue(s),this._currentState.onLayoutListContainer(e,!0)):this._currentState.onLayoutListContainer(e,!1)):u.log(c.LogTraceArea.VirtualMessageViewDebug,"onLayoutOuterScrollContainer: height is 0 - probably transient event during rotation")},this._onScroll=(e,t)=>{this._onScrollHandler(e,t)},this._onScrollHandlerDebounced=n.debounce(this._onScrollHandler,100),this._onReportUserScrollEvent=()=>{this._reportUserScrollEvent&&(this._reportUserScrollEvent=!1,this.props.onUserScroll&&this.props.onUserScroll(this._lastScrollTop,this._lastScrollLeft))},this._onAnimateStartStopItem=(e,t)=>{this._isMounted&&(t?this._pendingAnimations[e]=e:delete this._pendingAnimations[e])},this._onKeyPress=e=>{if(e.keyCode!==g.default.UP&&e.keyCode!==g.default.DOWN||!this._renderedItemKeys||!this._focusedItemKey)return;if(e.altKey||e.ctrlKey||e.shiftKey)return;const t=this._renderedItemKeys.filter((e=>e!==f.ItemListKey.Composing)),s=t.indexOf(this._focusedItemKey);let i,o,n,r;s>=0&&(i=this._virtualListCells[this._focusedItemKey]),s>=0&&(r=s+(e.keyCode===g.default.UP?-1:1),o=t[r]),o||(r=this._renderedItemKeys.length-1,o=t[r]),o&&(n=this._virtualListCells[o]),n&&i!==n&&(i&&i.setFocusLimited(!0),n.setFocusLimited(!1),this._focusedItemKey=o,n.focusCell(),e.preventDefault(),e.stopPropagation(),n.props.focusable||this._onKeyPress(e))},this._onCellFocus=e=>{this._isFocused=!!e},this._stateOnLayoutListContainer=e=>{this._currentState&&this._currentState.onLayoutListContainer(e,!0)},this._stateOnScroll=(e,t)=>{this._currentState&&this._currentState.onScroll(e,t)},this._onScrollBeginDrag=()=>{u.log(c.LogTraceArea.VirtualMessageViewDebug,"onScrollBeginDrag"),this._isDragging=!0},this._onScrollEndDrag=()=>{u.log(c.LogTraceArea.VirtualMessageViewDebug,"onScrollEndDrag"),this._isDragging=!1,this._currentState&&this._currentState.onScrollEndDrag()},this._stateOnLayoutItem=(e,t)=>{var s;null===(s=this._currentState)||void 0===s||s.onLayoutItem(e,t)},this._stateOnAnimateStartStopItem=(e,t)=>{this._currentState&&this._currentState.onAnimateStartStopItem(e,t)},this._stateControllerScrollPositionSet=()=>{this._currentState&&this._currentState.onControllerScrollPositionSet()},this._stateOnListChanged=(e,t)=>{this._currentState&&(this._itemListChangedSinceLastVisibleRangeChange=!0,this._currentState.onListChanged(e,t))},this._vmvControllerRefCallback=e=>{this._vmvController=e},this._scrollViewRefCallback=e=>{this._scrollView=e},e.observableList.listChanged.subscribe(this._stateOnListChanged),this._screenReaderDetectionStoreToken=_.default.subscribe((()=>{this._isScreenReaderEnabled=_.default.isMobileScreenReaderEnabled(),this._isScreenReaderEnabled})),this._isScreenReaderEnabled=_.default.isMobileScreenReaderEnabled(),this.setCurrentState(new x.Initialization(this),e)}setCurrentState(e,t){this._currentState=e,this._currentState.init(t||this.props)}UNSAFE_componentWillReceiveProps(e,t){(0,h.default)(this.props,e)||(this.props.contentMaxWidth,e.contentMaxWidth,this.props.observableList,e.observableList,this.props.leftSpacerWidth===e.leftSpacerWidth&&this.props.rightSpacerWidth===e.rightSpacerWidth&&this.props.useWideLayout===e.useWideLayout||this._resizeAllItems(e))}_getBottomSpacerHeight(){return this.props.canShowSuggestions?T:0}_initItemList(e,t){this._renderInfoCache={},this._pendingMeasures={},this._pendingMounts={},this._pendingAnimations={},this._itemListChangedSinceLastVisibleRangeChange=!0,u.log(c.LogTraceArea.VirtualMessageView,"_initItemList: New count: "+e.length);const s={};n.each(e,((e,t)=>{s[e.key]=t})),this._filledViewableScreen=!1;const i=this._calcHeightOfItems(e,0,e.length-1);this._itemsAboveRenderBlock=e.length,this._itemsInRenderBlock=0,this._itemsBelowRenderBlock=0,this._heightAboveRenderBlockCorrection=i,this._heightAboveRenderBlockEstimate=0,this._heightOfRenderBlock=0,this._heightBelowRenderBlockCorrection=0,this._heightBelowRenderBlockEstimate=0,this._itemMap=s,this._itemList=e,this._initialScrollIndex=t.initialScrollIndex}_isAndroidScreenReaderEnabled(){return this._isScreenReaderEnabled&&M}_itemsMoved(e,t){this._itemMap=this._regenerateItemMap(e);const s={type:d.ListModificationType.RemoveItems,removeIndex:t.removeIndex,count:t.count};this._processItemsRemoved(this._itemList,s);const i=n.map(this._itemList,(e=>e));i.splice(t.removeIndex,t.count),this._itemList=i;const o=[];for(let s=t.insertIndex;s<t.insertIndex+t.count;s++)o.push(e[s]);const r={type:d.ListModificationType.AddItems,insertIndex:t.insertIndex,items:o};this._processItemsAdded(this._itemList,e,r),this._itemList=e}_regenerateItemMap(e){const t={};return n.each(e,((e,s)=>{t[e.key]=s})),t}_itemsAdded(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsAdded(this._itemList,e,t),this._itemList=e}_processItemsAdded(e,t,s){const i=s.insertIndex,o=s.items,r=this._itemsAboveRenderBlock+this._itemsInRenderBlock,a=this._getMaxPendingMounts()-n.size(this._pendingMounts),l=s.options&&!1===s.options.animateFromBottom;if(i<=this._itemsAboveRenderBlock&&0!==this._itemsInRenderBlock)this._heightAboveRenderBlockCorrection+=this._calcHeightOfItems(t,i,i+o.length-1),this._itemsAboveRenderBlock+=o.length,u.log(c.LogTraceArea.VirtualMessageViewDebug,"_processItemsAdded adding "+o.length+" above render block");else if((i>r||i===r&&o.length>a&&l)&&0!==this._itemsInRenderBlock)this._itemsBelowRenderBlock+=o.length,this._heightBelowRenderBlockCorrection+=this._calcHeightOfItems(t,i,i+o.length-1),u.log(c.LogTraceArea.VirtualMessageViewDebug,"_processItemsAdded adding "+o.length+" below render block");else{const t=this._calcHeightOfItems(e,i,e.length-1),s=this._containerHeight-this._getBottomSpacerHeight()-t;n.each(o,(e=>{const t=this._getHeightOfItem(e),i=l?P.UnmeasuredInsideNoAnimation:P.UnmeasuredInside;this._allocateRenderBlockItem(e,i,t,s)}))}}_itemsReplaced(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsRemoved(this._itemList,t);const s=n.map(this._itemList,(e=>e));s.splice(t.removeIndex,t.count),this._itemList=s,this._processItemsAdded(this._itemList,e,t),this._itemList=e}_itemsRemoved(e,t){this._itemMap=this._regenerateItemMap(e),this._processItemsRemoved(this._itemList,t),this._itemList=e}_processItemsRemoved(e,t){const s=t.removeIndex,i=t.removeIndex+t.count-1,o=this._itemsAboveRenderBlock,n=this._itemsInRenderBlock;u.log(c.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved _itemsAboveRenderBlock "+this._itemsAboveRenderBlock+" _itemsInRenderBlock "+this._itemsInRenderBlock+" _itemsBelowRenderBlock "+this._itemsBelowRenderBlock);for(let t=s;t<o&&t<=i;t++){const s=e[t];u.log(c.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" above render block"),this._heightAboveRenderBlockCorrection-=this._getHeightOfItem(s),this._itemsAboveRenderBlock--,this._deleteItemFromCaches(s.key,!0)}const r=o+n-1,a=this._getViewportBottom();for(let t=Math.max(s,o);t<=r&&t<=i;t++){const s=e[t];u.log(c.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" from render block"),this._itemsInRenderBlock--;const i=this._getHeightOfItem(s);this._heightOfRenderBlock-=i;const o=this._renderInfoCache[s.key];this._isRenderDirty=!0,this._makeCellInvisibleDeferred(s.key),this._deleteItemFromCaches(s.key,!0),o&&(o.top+i<=a+30?this._adjustScrollPositionAfterReconcile(-i):this._adjustScrollPositionUntilReconcile(-i))}for(let t=Math.max(s,r+1);t<=i;t++){const s=e[t];u.log(c.LogTraceArea.VirtualMessageViewDebug,"_processItemsRemoved removing item #"+t+" with key "+s.key+" below render block"),this._heightBelowRenderBlockCorrection-=this._getHeightOfItem(s),this._itemsBelowRenderBlock--,this._deleteItemFromCaches(s.key,!0)}}_deleteItemFromCaches(e,t=!1){t&&delete this._heightCache[e],delete this._renderInfoCache[e],delete this._pendingMeasures[e],delete this._pendingMounts[e]}_updateViewportWidth(e){e!==this._viewportWidth&&(u.log(c.LogTraceArea.VirtualMessageView,"New viewport width: "+e),this._viewportWidth=e,this._resizeAllItems(this.props))}_updateViewportHeight(e){e!==this._viewportHeight&&(u.log(c.LogTraceArea.VirtualMessageView,"New viewport height: "+e),this._viewportHeight=e)}_onLayoutListContainer(e){let t=Math.round(e.width);const s=Math.round(e.height);this._isMounted&&0!==t&&0!==s&&(this.props.horizontalPadding&&(t-=this.props.horizontalPadding.left+this.props.horizontalPadding.right),this._lastContainerLayoutTime=Date.now().valueOf(),this._updateViewportWidth(t),this._updateViewportHeight(s),this._renderIfDirty(),this.props.onLayout&&this.props.onLayout(e))}_onLayoutItem(e,t){if(!this._isMounted)return!1;const s=this._itemMap[e];if(void 0===s||void 0===this._renderInfoCache[e])return u.log(c.LogTraceArea.VirtualMessageViewDebug,"onLayout: unexpected event for item "+e),!1;delete this._pendingMeasures[e],delete this._pendingMounts[e],t=Math.round(t);const i=this._itemList[s],o=this._getHeightOfItem(i),n=t-o;if(this._isHeightOfItemKnown(i)&&Math.abs(n)<=1)return!1;i.height||(this._isHeightOfItemKnown(i)?this._averageHeightCounter.correct(n):this._averageHeightCounter.input(t)),this._heightCache[e]=t;const r=this._renderInfoCache[e];return 0===n&&r.measureState===P.Measured||(u.log(c.LogTraceArea.VirtualMessageViewDebug,"onLayout: Item Height Changed: "+e+" - Old: "+o+", New: "+t+", measureState: "+P[r.measureState]),s<this._itemsAboveRenderBlock?this._heightAboveRenderBlockCorrection+=n:s>=this._itemsAboveRenderBlock+this._itemsInRenderBlock?this._heightBelowRenderBlockCorrection-=n:(this._heightOfRenderBlock+=n,r.measureState===P.UnmeasuredAbove?this._adjustScrollPositionAfterReconcile(n):r.measureState===P.UnmeasuredBelow?this._adjustScrollPositionUntilReconcile(n):r.measureState===P.UnmeasuredInside?r.top<=this._getViewportBottom()+30?this._adjustScrollPositionAfterReconcile(t):this._adjustScrollPositionUntilReconcile(t):r.measureState===P.UnmeasuredInsideNoAnimation?this._adjustScrollPositionUntilReconcile(t):r.measureState===P.Measured&&(r.top+o<=this._getViewportBottom()?this._adjustScrollPositionAfterReconcile(n):this._adjustScrollPositionUntilReconcile(n))),r.measureState=P.Measured),0!==n}_adjustScrollPositionAfterReconcile(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"_adjustScrollPositionAfterReconcile "+e),this._heightAboveRenderBlockCorrection+=e,this._heightAboveRenderBlockEstimate-=e}_adjustScrollPositionUntilReconcile(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"_adjustScrollPositionUntilReconcile "+e),this._heightBelowRenderBlockCorrection+=e,this._heightBelowRenderBlockEstimate-=e}_onScrollHandler(e,t){e=Math.round(e),t=Math.round(t),this._lastScrollTop!==e&&(this._lastScrollTopSetByUser===e&&this._lastScrollTop!==e||(this._reportUserScrollEvent=!0,this._lastScrollTopSetByUser=e,this._lastScrollTop=e,this._lastScrollLeft=t,this._onReportUserScrollEvent()))}_allocateRenderBlockItem(e,t,s,i){this._pendingMounts[e.key]=e.key,this._isHeightOfItemKnown(e)?t=P.Measured:this._pendingMeasures[e.key]=e.key;const o=this._shouldShowItem(e);this._renderInfoCache[e.key]={top:i,measureState:t,isVisible:o,shouldUpdate:!0},this._isRenderDirty=!0,this._itemsInRenderBlock++,this._heightOfRenderBlock+=s,u.log(c.LogTraceArea.VirtualMessageViewDebug,"Allocating new render block item for "+e.key+" H="+s+" Y="+i," V="+o),this._forceUpdateCell(e.key)}_forceUpdateCell(e){this._virtualListCells[e]&&n.defer((()=>{const t=this._virtualListCells[e];t&&this._isMounted&&t.forceUpdate()}))}_getEffectiveScrollTop(){return 0===this._containerHeight?-this._viewportHeight:this._lastScrollTop}_removeItemsFromRenderBlock(){const e=this._getEffectiveScrollTop(),t=Math.max(6*this._viewportHeight,3072),s=e-t,i=e+this._viewportHeight+t;let o=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,n=o-this._heightOfRenderBlock;for(;this._itemsInRenderBlock>0;){const e=this._itemsAboveRenderBlock,t=this._itemList[e];if(!this._isHeightOfItemKnown(t))break;const i=this._getHeightOfItem(t);if(n+i>=s)break;this._isRenderDirty=!0,this._itemsInRenderBlock--,this._heightOfRenderBlock-=i,this._itemsAboveRenderBlock++,this._heightAboveRenderBlockEstimate+=i,n+=i,this._deleteItemFromCaches(t.key),u.log(c.LogTraceArea.VirtualMessageViewDebug,"Culled Item From Top: "+t.key)}for(;this._itemsInRenderBlock>0;){const e=this._itemsAboveRenderBlock+this._itemsInRenderBlock-1,t=this._itemList[e];if(!this._isHeightOfItemKnown(t))break;const s=this._getHeightOfItem(t);if(o-s<=i)break;this._isRenderDirty=!0,this._itemsInRenderBlock--,this._heightOfRenderBlock-=s,this._itemsBelowRenderBlock++,this._heightBelowRenderBlockEstimate+=s,o-=s,this._deleteItemFromCaches(t.key),u.log(c.LogTraceArea.VirtualMessageViewDebug,"Culled Item From Bottom: "+t.key)}}_addInitialItemToRenderBlock(){let e=!1,t=0,s=this._itemList.length-1;if(void 0!==this._initialScrollIndex)s=this._initialScrollIndex,e=!this._filledViewableScreen,t=this._getEffectiveScrollTop()+Math.floor(.25*this._viewportHeight);else if(this._filledViewableScreen){let i=this._containerHeight-this._getBottomSpacerHeight();const o=this._getEffectiveScrollTop()+this._viewportHeight;for(;i>=o&&s>0;){const e=this._itemList[s];i-=this._getHeightOfItem(e),s--}e=!0,t=this._getEffectiveScrollTop()+this._viewportHeight-this._getHeightOfItem(this._itemList[s])}u.log(c.LogTraceArea.VirtualMessageView,"_addInitialItemToRenderBlock referenceIndex: "+s+" out of "+this._itemList.length);const i=this._itemList[s];this.props.shouldFocusInitialItem&&(this._itemKeyToFocus=i.key),this.props.isMessageSearchPanelVisible&&void 0!==this._initialScrollIndex&&this._itemKeyToFocusNext(i.key);const o=this._getHeightOfItem(i);this._heightAboveRenderBlockEstimate-=o,this._itemsInRenderBlock=0,this._heightOfRenderBlock=0,this._itemsAboveRenderBlock=s;const n=this._calcHeightOfItems(this._itemList,0,s-1);this._heightAboveRenderBlockCorrection=n-this._heightAboveRenderBlockEstimate,this._itemsBelowRenderBlock=this._itemList.length-this._itemsAboveRenderBlock-1;const r=this._calcHeightOfItems(this._itemList,s+1,this._itemList.length-1);if(this._heightBelowRenderBlockCorrection=r-this._heightBelowRenderBlockEstimate,e){const e=t-this._heightAboveRenderBlockEstimate;this._adjustScrollPositionAfterReconcile(-e),this._adjustScrollPositionUntilReconcile(e)}const a=e?P.UnmeasuredBelow:P.UnmeasuredAbove;this._allocateRenderBlockItem(i,a,o,this._heightAboveRenderBlockEstimate-this._getBottomSpacerHeight()),u.log(c.LogTraceArea.VirtualMessageView,"New item count above: "+this._itemsAboveRenderBlock)}_getMaxPendingMounts(){return S.default.isAnimationPending()?1:10}_expandRenderBlock(e,t){const s=this._getEffectiveScrollTop(),i=s-e,o=s+this._viewportHeight+t,r=this._getMaxPendingMounts();let a=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,l=a-this._heightOfRenderBlock;for(;this._itemsBelowRenderBlock>0&&a<o;){if(n.size(this._pendingMounts)>=r)return;const e=this._itemList[this._itemsAboveRenderBlock+this._itemsInRenderBlock],t=this._getHeightOfItem(e);this._allocateRenderBlockItem(e,P.UnmeasuredBelow,t,a),a+=t,this._itemsBelowRenderBlock--,this._heightBelowRenderBlockEstimate-=t}for(;this._itemsAboveRenderBlock>0&&l>i;){if(n.size(this._pendingMounts)>=r)return;const e=this._itemList[this._itemsAboveRenderBlock-1],t=this._getHeightOfItem(e);this._allocateRenderBlockItem(e,P.UnmeasuredAbove,t,l-t),l-=t,this._itemsAboveRenderBlock--,this._heightAboveRenderBlockEstimate-=t}}_calcNewRenderedItemState(e=!0,t=!0){if(0===this._itemList.length)return;this._removeItemsFromRenderBlock();const s=0===this._itemsInRenderBlock;s&&this._itemList.length>0&&this._addInitialItemToRenderBlock();const i=e&&this._filledViewableScreen&&Date.now().valueOf()-this._lastContainerLayoutTime>500;this._repositionCells({animate:i});const o=t&&!s&&this._filledViewableScreen?Math.min(Math.max(5*this._viewportHeight,2048),4096):0;this._expandRenderBlock(o,o)}_getViewportBottom(){return this._lastScrollTop+this._viewportHeight-this._getBottomSpacerHeight()}_checkAndReportVisibleRangeChanges(){if(this.props.onVisibleRangeChanged&&this._isMounted&&this._filledViewableScreen){const e=this._lastScrollTop,t=this._getViewportBottom();let s=-1,i=-1,o=-1,n=-1;const r=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate,a=r-this._heightOfRenderBlock;if(a<t||r>e){let l=a;for(let t=0;t<this._itemsInRenderBlock;t++){const i=this._getHeightOfItem(this._itemList[t+this._itemsAboveRenderBlock]);if(l>=e&&-1===o&&(o=t+this._itemsAboveRenderBlock),l+=i,l>e&&-1===s&&(s=t+this._itemsAboveRenderBlock),-1!==s&&-1!==o)break}l=r;for(let e=this._itemsInRenderBlock-1;e>=0;e--){const s=this._getHeightOfItem(this._itemList[e+this._itemsAboveRenderBlock]);if(l<=t&&-1===n&&(n=e+this._itemsAboveRenderBlock),l-=s,l<t&&-1===i&&(i=e+this._itemsAboveRenderBlock),-1!==i&&-1!==n)break}}(this._itemListChangedSinceLastVisibleRangeChange||this._lastPartialTopVisibleItem!==s||this._lastPartialBottomVisibleItem!==i||this._lastWholeTopVisibleItem!==o||this._lastWholeBottomVisibleItem!==n)&&(this._itemListChangedSinceLastVisibleRangeChange=!1,this._lastPartialTopVisibleItem=s,this._lastPartialBottomVisibleItem=i,this._lastWholeTopVisibleItem=o,this._lastWholeBottomVisibleItem=n,u.log(c.LogTraceArea.VirtualMessageViewDebug,"Visible Range Changed: Partial: "+this._lastPartialTopVisibleItem+"-"+this._lastPartialBottomVisibleItem+", Whole: "+this._lastWholeTopVisibleItem+"-"+this._lastWholeBottomVisibleItem),this.props.onVisibleRangeChanged(this._lastPartialTopVisibleItem,this._lastPartialBottomVisibleItem,this._lastWholeTopVisibleItem,this._lastWholeBottomVisibleItem))}}_setContainerHeight(e){return this._containerHeight!==e&&(u.log(c.LogTraceArea.VirtualMessageView,"setContainerHeight Old: "+this._containerHeight+" New: "+e),this._containerHeight=e,this._containerHeightValue.setValue(e),!0)}_getNewContainerHeight(){const e=this._heightAboveRenderBlockEstimate+this._heightAboveRenderBlockCorrection+this._heightOfRenderBlock+this._heightBelowRenderBlockEstimate+this._heightBelowRenderBlockCorrection+this._getBottomSpacerHeight();return Math.max(e,this._viewportHeight)}_reconcileCorrections(e){if(0===this._itemList.length)return!1;let t=!1;this._oldViewportHeight=this._viewportHeight;Math.abs(this._scrollOuterContainerHeight-this._innerScrollContainerHeight)>1&&(u.log(c.LogTraceArea.VirtualMessageView,"Forcing recalculations because viewport size changed, old _viewportHeight: "+this._viewportHeight+" new _viewportHeight: "+this._scrollOuterContainerHeight),this._innerScrollContainerHeight=this._scrollOuterContainerHeight,this._viewportHeight=this._scrollOuterContainerHeight,this._innerScrollContainerHeightValue.setValue(this._scrollOuterContainerHeight),t=!0);let s=this._getNewContainerHeight();if(0===this._heightAboveRenderBlockCorrection&&0===this._heightBelowRenderBlockCorrection&&this._containerHeight===s||(t=!0,u.log(c.LogTraceArea.VirtualMessageView,"Forcing recalculations because container size changed, _heightAboveRenderBlockCorrection: "+this._heightAboveRenderBlockCorrection+" _heightBelowRenderBlockCorrection: "+this._heightBelowRenderBlockCorrection+" _containerHeight: "+this._containerHeight+" newContainerHeight: "+s)),t){this._applyNewAverageToEstimates(),s=this._getNewContainerHeight();const t=this._setContainerHeight(s);return this._completeReconcileCorrections(e,t)}return!1}_applyNewAverageToEstimates(){const e=this._averageHeightCounter.getAverage();if(this._currentAverageHeight===e)return;const t=e-this._currentAverageHeight,s=t*this._calcUnknownHeightItemsCount(this._itemList,0,this._itemsAboveRenderBlock-1);this._heightAboveRenderBlockCorrection+=s;const i=t*this._calcUnknownHeightItemsCount(this._itemList,this._itemsAboveRenderBlock+this._itemsInRenderBlock,this._itemList.length-1);this._heightBelowRenderBlockCorrection+=i,u.log(c.LogTraceArea.VirtualMessageViewDebug," applyNewAverageToEstimates currentAverageHeight: "+this._currentAverageHeight+", newAverageHeight "+e+", aboveHeightAdjustment "+s+", belowHeightAdjustment "+i),this._currentAverageHeight=e}_completeReconcileCorrections(e,t){const s=this._viewportHeight-this._oldViewportHeight;let i=this._heightAboveRenderBlockCorrection-s;if(u.log(c.LogTraceArea.VirtualMessageView,"_reconcileCorrections: initial="+e+" A="+this._heightAboveRenderBlockCorrection+" B="+this._heightBelowRenderBlockCorrection+" viewPortHeightDelta="+s),this._heightAboveRenderBlockEstimate+=this._heightAboveRenderBlockCorrection,this._heightAboveRenderBlockCorrection=0,this._heightBelowRenderBlockEstimate+=this._heightBelowRenderBlockCorrection,this._heightBelowRenderBlockCorrection=0,e&&!n.isUndefined(this._initialScrollIndex)&&this._initialScrollIndex>=0){if(this._initialScrollIndex>=this._itemsAboveRenderBlock&&this._initialScrollIndex<=this._itemsAboveRenderBlock+this._itemsInRenderBlock){let e=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate-this._heightOfRenderBlock;for(let t=this._itemsAboveRenderBlock;t<this._initialScrollIndex;t++)e+=this._getHeightOfItem(this._itemList[t]);i=e-Math.floor(.25*this._viewportHeight)}this._initialScrollIndex=void 0}return this._setNewScrollTop(this._lastScrollTop+i,!1),this._repositionCells({}),!1}_setNewScrollTop(e,t){e=Math.round(e),e=Math.min(e,this._containerHeight-this._viewportHeight),(e=Math.max(e,0))!==this._lastScrollTop&&(u.log(c.LogTraceArea.VirtualMessageViewDebug,"Setting scroll top: "+e),this._lastScrollTop=e,this._scrollView&&(delete this._pendingSetScrollTop,this._setScrollTop(e,t)))}_adjustScrollTopAndRepositionCells(e,t){if(e=Math.round(e),e=Math.min(e,this._containerHeight-this._viewportHeight-this._lastScrollTop),0!==(e=Math.max(e,-this._lastScrollTop))){if(this._lastScrollTop+=e,u.log(c.LogTraceArea.VirtualMessageViewDebug,"Adjusting scroll top: "+e+" (absolute value "+this._lastScrollTop+")"),this._vmvController){const t=this._repositionCells({sendToNative:!1});return this._vmvController.scrollBy(e,t,this._isAndroidScreenReaderEnabled()),!0}this._scrollView&&(t?this._pendingSetScrollTop=this._lastScrollTop:this._setScrollTop(this._lastScrollTop,!1),this._repositionCells({}))}return!1}_validateHeightInvariants(e=!0){u.log(c.LogTraceArea.VirtualMessageViewDebug," AE:"+this._heightAboveRenderBlockEstimate+" AC:"+this._heightAboveRenderBlockCorrection+" RB:"+this._heightOfRenderBlock+" BE:"+this._heightBelowRenderBlockEstimate+" BC:"+this._heightBelowRenderBlockCorrection);this._calcHeightOfItems(this._itemList,0,this._itemsAboveRenderBlock-1),this._calcHeightOfItems(this._itemList,this._itemsAboveRenderBlock+this._itemsInRenderBlock,this._itemList.length-1),this._calcHeightOfItems(this._itemList,this._itemsAboveRenderBlock,this._itemsAboveRenderBlock+this._itemsInRenderBlock-1),this._itemsAboveRenderBlock,this._itemsBelowRenderBlock,this._itemsInRenderBlock;if(this._containerHeight>0&&e){const e=this._heightAboveRenderBlockEstimate+this._heightOfRenderBlock+this._heightBelowRenderBlockEstimate+this._getBottomSpacerHeight();Math.max(e,this._viewportHeight)}return!0}_popInvisibleIntoView(){this._filledViewableScreen=!0;for(let e=0;e<this._itemsInRenderBlock;e++){const t=this._itemList[this._itemsAboveRenderBlock+e],s=this._renderInfoCache[t.key];s.isVisible||(s.isVisible=!0)}this._repositionCells({dissallowVisibilityChanges:!1}),this.props.onInitialRenderComplete&&this.props.onInitialRenderComplete()}_repositionCells(e){const t=!!e.staggerAnimations,s=!!n.isUndefined(e.sendToNative)||e.sendToNative,i=[],o=[],r=this._containerHeight-this._getBottomSpacerHeight()-this._heightBelowRenderBlockEstimate;let a=r,l=0;for(let n=this._itemsInRenderBlock-1;n>=0;n--){const d=this._itemList[this._itemsAboveRenderBlock+n];a-=this._getHeightOfItem(d),t&&(l=Math.floor(.1*(r-a)));const h=this._renderInfoCache[d.key];if(!h){u.error(c.LogTraceArea.VirtualMessageViewDebug,"Missing renderInfo for "+d.key);continue}const p=this._virtualListCells[d.key];if(p&&i.push({component:p,yPosition:a}),s){const t=e.dissallowVisibilityChanges?h.isVisible:this._shouldShowItem(d);this._setCellTopAndVisibility(d.key,t,a,l,e)&&o.push({key:d.key,yPosition:a,visibility:t})}}return s&&n.size(o)>0&&u.log(c.LogTraceArea.VirtualMessageViewDebug,"_repositionCells: "+n.reduce(o,((e,t)=>e+"("+t.key+","+t.yPosition+","+(t.visibility?"Y":"N")+")"),"")),i}_setCellTopAndVisibility(e,t,s,i,o){const n=!!o.animate,r=this._renderInfoCache[e];if(!r)return u.error(c.LogTraceArea.VirtualMessageViewDebug,"Missing renderInfo for "+e),!1;const l=n&&r.isVisible&&!this._isAndroidScreenReaderEnabled();r.isVisible=t,r.top=s;const d=this._virtualListCells[e];let h=!1;return d&&this._filledViewableScreen&&(d.getTop()!==s&&(d.setTop({top:s,animate:l,animationDelay:i,animationEasingFunction:a.Easing.SkypeEaseOut,animationDuration:v.AnimationDuration.Short}),h=!0),d.isVisible()!==t&&(d.setVisibility(t),h=!0)),h}_makeCellInvisibleDeferred(e){n.defer((()=>{const t=this._virtualListCells[e],s=this._renderInfoCache[e];t&&!s&&t.setVisibility(!1)}))}_resizeAllItems(e){if(this._viewportWidth<=0)return;const t=this._viewportWidth-(e.leftSpacerWidth||0)-(e.rightSpacerWidth||0),s=e.contentMaxWidth&&t>e.contentMaxWidth?e.contentMaxWidth:t;s>0&&this._contentWidth!==s&&(this._contentWidth=s,this._itemsInRenderBlock>0&&(this._isRenderDirty=!0))}_renderIfDirty(){this._isRenderDirty&&this._isMounted&&this.forceUpdate()}_focusCellIfNeeded(){if(this._itemKeyToFocus){const e=this._virtualListCells[this._itemKeyToFocus];e&&(e.focusCell(),this._itemKeyToFocus=void 0)}}render(){const e=[];u.log(c.LogTraceArea.VirtualMessageViewDebug,"Rendering "+this._itemsInRenderBlock+" items starting at "+this._itemsAboveRenderBlock),this._renderedItemKeys=[];for(let t=0;t<this._itemsInRenderBlock;t++){const s=this._itemList[this._itemsAboveRenderBlock+t],i=this._renderInfoCache[s.key],n=this._isAndroidScreenReaderEnabled()?"ac_"+s.key:s.key;this._renderedItemKeys.push(s.key),e.push((0,o.jsx)(r.VirtualListCell,{ref:this._getVirtualListCellRefCallback(s.key),onLayout:this._stateOnLayoutItem,itemKey:s.key,item:s,width:this._contentWidth,top:i?i.top:0,isVisible:!!i&&i.isVisible,isActive:!0,isFocused:!1,onAnimateStartStop:this._stateOnAnimateStartStopItem,useTransformOptimization:!this._isAndroidScreenReaderEnabled(),shouldUpdate:!i||i.shouldUpdate,renderItem:this.props.renderItem,focusable:s.focusable,onCellFocus:this._onCellFocus,limitFocusWithin:l.Types.LimitFocusType.Accessible},n)),i&&(i.shouldUpdate=!1)}u.log(c.LogTraceArea.VirtualMessageViewDebug,"Item Render Complete");const t=[b.staticContainer,this.props.style,this._containerAnimatedStyle,this._getItemContainerStyle(this.props.contentMaxWidth)];this.props.showOverflow&&t.push(C.default.overflowVisible),this.props.horizontalPadding&&this.props.horizontalPadding.left&&t.push(l.Styles.createViewStyle({marginLeft:this.props.horizontalPadding.left},!1));let s=(0,o.jsx)(l.Animated.View,{style:n.compact(t),onLayout:e=>{if(Math.trunc(e.height)===Math.trunc(this._containerHeight)){const e=this._pendingSetScrollTop;delete this._pendingSetScrollTop,e&&this._scrollView&&this._setScrollTop(e,!1)}},children:e});return this.props.useWideLayout&&(s=(0,o.jsxs)(l.View,{style:b.compositeItemsListContainer,children:[(0,o.jsx)(l.View,{style:this._getSpacerStyle(this.props.leftSpacerWidth)}),s,(0,o.jsx)(l.View,{style:this._getSpacerStyle(this.props.rightSpacerWidth)})]})),(0,o.jsx)(l.View,{style:b.scrollOuterContainer,onLayout:this._onLayoutOuterScrollContainer,children:(0,o.jsx)(l.Animated.View,{style:[b.scrollInnerContainer,this._scrollInnerContainerStyle],children:(0,o.jsxs)(l.ScrollView,{onLayout:this._stateOnLayoutListContainer,onScroll:this._stateOnScroll,keyboardDismissMode:this.props.keyboardDismissMode,keyboardShouldPersistTaps:this.props.keyboardShouldPersistTaps,ref:this._scrollViewRefCallback,scrollEventThrottle:32,style:b.scrollView,scrollsToTop:this.props.scrollsToTop,scrollEnabled:this.props.scrollEnabled,overScrollMode:"never",onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onKeyPress:this._onKeyPress,children:[null,s]})})})}_setScrollTop(e,t){var s;null===(s=this._scrollView)||void 0===s||s.setScrollTop(e,t)}_getSpacerStyle(e){return I[e]||(I[e]=l.Styles.createViewStyle({flex:1,minWidth:e})),I[e]}_getItemContainerStyle(e){return w[e]||(w[e]=l.Styles.createViewStyle({width:e})),w[e]}_getVirtualListCellRefCallback(e){return this._virtualListCellRefCallbacks[e]||(this._virtualListCellRefCallbacks[e]=t=>{t?this._virtualListCells[e]=t:(delete this._virtualListCells[e],delete this._virtualListCellRefCallbacks[e])}),this._virtualListCellRefCallbacks[e]}componentDidMount(){this._isMounted=!0,this._componentDidRender()}componentWillUnmount(){this._currentState=void 0,this._isMounted=!1,_.default.unsubscribe(this._screenReaderDetectionStoreToken)}componentDidUpdate(e,t,s){this._componentDidRender()}_componentDidRender(){if(u.log(c.LogTraceArea.VirtualMessageViewDebug,"Component Did Render"),this._isRenderDirty=!1,this._renderedItemKeys){let e;const t=this._renderedItemKeys.filter((e=>e!==f.ItemListKey.Composing));if(this._focusedItemKey){if(e=t.indexOf(this._focusedItemKey),e<0||!this._isFocused)if(e>=0){const s=this._virtualListCells[t[e]];s&&s.setFocusLimited(!0)}else e=t.length-1}else e=t.length-1;if(this._focusedItemKey=t[e],this._focusedItemKey){const e=this._virtualListCells[this._focusedItemKey];e&&e.setFocusLimited(!1)}}}scrollToBottom(){this._currentState&&this._currentState.onScrollToPosition(-1,!1)}scrollToPosition(e,t,s=!1){this._currentState&&(this._currentState.onScrollToPosition(e,s),this._itemKeyToFocusNext(t))}focusMessage(e){let t;n.eachRight(this._virtualListCells,(s=>{s.props.item&&n.endsWith(s.props.item.key,e)&&(t=s)})),t&&t.focusCell()}_itemKeyToFocusNext(e){const t=this._virtualListCells[e],s=this._virtualListCells[this._focusedItemKey];t&&(t.setFocusLimited(!1),s&&s.setFocusLimited(!0)),this._focusedItemKey=e}_shouldShowItem(e){return this._filledViewableScreen&&this._isHeightOfItemKnown(e)&&0===n.size(this._pendingMeasures)}_calcHeightOfItems(e,t,s){let i=0;for(let o=t;o<=s;o++)i+=this._getHeightOfItem(e[o]);return i}_calcUnknownHeightItemsCount(e,t,s){let i=0;for(let o=t;o<=s;o++){const t=e[o];i+=t.height||this._isHeightOfItemKnown(t)?0:1}return i}_isHeightOfItemKnown(e){return void 0!==this._heightCache[e.key]}_getHeightOfItem(e){return e?void 0!==this._heightCache[e.key]?this._heightCache[e.key]:e.height?e.height:this._currentAverageHeight:0}}t.VirtualMessageView=x,x.Initialization=class{constructor(e){this.view=e,this._initializationState=k.Undefined}init(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Initialization","init"),this.view._initItemList(e.observableList.getItemList(),e)}onLayoutListContainer(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Initialization","onLayoutListContainer"),t&&this.view._onLayoutListContainer(e),this._moveToNextIfReady()}onListChanged(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Initialization","onListChanged"),this.view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){this.view._onScrollToPositionEvent=e}onScroll(e,t){}onLayoutItem(e,t){this.view._onLayoutItem(e,t),this._moveToNextIfReady()}onAnimateStartStopItem(e,t){}onControllerScrollPositionSet(){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Initialization","onControllerScrollPositionSet"),this._finishInitialization()}onScrollEndDrag(){}_canMoveNext(){return 0===n.size(this.view._pendingMeasures)&&this._initializationState!==k.WaitingForScroll&&0!==this.view._viewportHeight}_moveToNextIfReady(){if(this._canMoveNext()){if(0===this.view._itemList.length)return this.view._filledViewableScreen=!0,void this.view.setCurrentState(new x.Idle(this.view));this.view._calcNewRenderedItemState(!1),this.view._renderIfDirty(),this._canMoveNext()&&(u.log(c.LogTraceArea.VirtualMessageViewDebug,"Initialization","starting reconcileCorrections"),this.view._reconcileCorrections(!0),this._finishInitialization())}}_finishInitialization(){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Initialization","starting popInvisibleIntoView"),this.view._popInvisibleIntoView(),this.view._scrollView&&this.view._setScrollTop(this.view._lastScrollTop,!1),this.view.setCurrentState(new x.Wait(this.view,100))}},x.Idle=class{constructor(e){this.view=e,this._needsReconcilation=!1,this._reconcileCorrectionsDebounced=n.debounce((()=>{if(this.view._isMounted){if(n.size(this.view._pendingMeasures)>0||n.size(this.view._pendingAnimations)>0||this.view._isDragging)return void this._reconcileCorrectionsDebounced();this._reconcileCorrections()}}),1e3)}init(e){for(u.log(c.LogTraceArea.VirtualMessageViewDebug,"Idle","init"),n.each(this.view._onAnimateStartStopItemQueue,(e=>{u.log(c.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued onAnimateStartStopItem for "+e.itemKey),this.view._onAnimateStartStopItem(e.itemKey,e.animateStart)})),this.view._onAnimateStartStopItemQueue=[],n.each(this.view._onLayoutItemQueue,(e=>{this.view._onLayoutItem(e.itemKey,e.newHeight)})),this.view._onLayoutItemQueue=[],this.view._onLayoutListContainerEvent&&(u.log(c.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued onLayoutListContainer"),this.view._onLayoutListContainer(this.view._onLayoutListContainerEvent)),this.view._onLayoutListContainerEvent=void 0,this.view._reportUserScrollEvent&&(u.log(c.LogTraceArea.VirtualMessageViewDebug,"Idle","processing queued reportUserScrollEvent"),this.view._onReportUserScrollEvent());n.size(this.view._onListChangedQueue)>0;){const e=this.view._onListChangedQueue.splice(0,1)[0];if(u.log(c.LogTraceArea.VirtualMessageView,"Idle","processing queued onListChanged"+JSON.stringify(n.omit(e.listModification,["items"]))+", "+n.map(e.listModification.items,(e=>e.key))),this._processOnListChanged(e.listModification,e.updatedList))return}this._processPendingOnScrollToPosition(),this._finishEventProcessing()}_processPendingOnScrollToPosition(){n.isUndefined(this.view._onScrollToPositionEvent)||(u.log(c.LogTraceArea.VirtualMessageViewDebug,"processing queued onScrollToPosition"),this._processOnScrollToPosition(this.view._onScrollToPositionEvent,!1),this.view._onScrollToPositionEvent=void 0)}onLayoutListContainer(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Idle","onLayoutListContainer"),t&&this.view._onLayoutListContainer(e),this._finishEventProcessing()}_finishEventProcessing(e=!1){if(!this._needsReconcilation){const t=this.view._lastScrollTop<=0||this.view._lastScrollTop>=this.view._containerHeight-this.view._viewportHeight;this._needsReconcilation=t&&e}if(n.size(this.view._pendingAnimations)>0)return this._reconcileCorrectionsDebounced.cancel(),void this.view.setCurrentState(new x.WaitForAnimation(this.view));if(n.size(this.view._pendingMeasures)>0)return;if(this._needsReconcilation&&!this.view._isDragging)return void this._reconcileCorrections();const t=!this._needsReconcilation;this.view._checkAndReportVisibleRangeChanges(),this.view._calcNewRenderedItemState(!0,t),this.view._renderIfDirty(),this.view._focusCellIfNeeded(),this._reconcileCorrectionsDebounced()}_reconcileCorrections(){return this._needsReconcilation=!1,this.view._repositionCells({animate:!1}),this.view._reconcileCorrections(!1),this._processPendingOnScrollToPosition(),this.view._checkAndReportVisibleRangeChanges(),this.view._calcNewRenderedItemState(),this.view._renderIfDirty(),!1}onListChanged(e,t){u.log(c.LogTraceArea.VirtualMessageView,"Idle","onListChanged "+JSON.stringify(n.omit(e,["items"]))+", "+n.map(e.items,(e=>e.key))),this._processOnListChanged(e,t)||(this.view._renderIfDirty(),this._finishEventProcessing())}_processOnListChanged(e,t){if(n.each(t,(e=>{const t=this.view._renderInfoCache[e.key];if(t&&!t.shouldUpdate){const s=this.view._itemMap[e.key],i=this.view._itemList[s];t.shouldUpdate=this.view.props.shouldUpdateItem(i,e)}})),e.type===d.ListModificationType.AddItems){if(this.view._itemsAdded(t,e),n.size(this.view._pendingMeasures)>0)return this._reconcileCorrectionsDebounced.cancel(),this.view.setCurrentState(new x.WaitForModifiedItemsRender(this.view,e)),this.view._renderIfDirty(),!0}else if(e.type===d.ListModificationType.RemoveItems)this.view._itemsRemoved(t,e),this.view._repositionCells({animate:!0});else if(e.type===d.ListModificationType.ReplaceItems){if(this.view._itemsReplaced(t,e),n.size(this.view._pendingMeasures)>0)return this._reconcileCorrectionsDebounced.cancel(),this.view.setCurrentState(new x.WaitForModifiedItemsRender(this.view,e)),this.view._renderIfDirty(),!0}else e.type===d.ListModificationType.MoveItems&&this.view._itemsMoved(t,e);return this.view._isRenderDirty=!0,!1}onScrollToPosition(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Idle","onScrollToPosition");if(n.size(this.view._pendingMeasures)>0||n.size(this.view._pendingAnimations)>0)return this.view._onScrollToPositionEvent=e,void(this._needsReconcilation=!0);this._reconcileCorrections()?this.view._onScrollToPositionEvent=e:(this._processOnScrollToPosition(e,t),this._finishEventProcessing())}_processOnScrollToPosition(e,t){const s=this.view._containerHeight-this.view._viewportHeight;if(-1===e)this.view._setNewScrollTop(s,t);else{const i=this.view._itemList,o=this.view._getHeightOfItem(this.view._itemList[e]);let n=this.view._calcHeightOfItems(i,0,e)-o-Math.floor(.25*this.view._viewportHeight);n=n>s?s:n,this.view._setNewScrollTop(n,t)}}onScroll(e,t){this.view._onScroll(e,t),this._finishEventProcessing(!0)}onLayoutItem(e,t){(this.view._onLayoutItem(e,t)||0===n.size(this.view._pendingMounts))&&this._finishEventProcessing(!0)}onAnimateStartStopItem(e,t){this.view._onAnimateStartStopItem(e,t),this._finishEventProcessing()}onControllerScrollPositionSet(){u.warn(c.LogTraceArea.VirtualMessageView,"Idle - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){this._finishEventProcessing(!0)}},x.WaitForModifiedItemsRender=class{constructor(e,t){this._view=e,this._listModification=t}init(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","init")}onLayoutListContainer(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForModifiedItemsRender","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){if(this._view._onLayoutItem(e,t),0===n.size(this._view._pendingMeasures)){if(this._listModification.type===d.ListModificationType.AddItems){const t=this._listModification.options&&this._listModification.options.animateFromBottom,s=this._view._renderInfoCache[e].top;if(s<=this._view._getViewportBottom()+30&&s>=this._view._lastScrollTop){if(this._view._repositionCells({animate:!0,dissallowVisibilityChanges:!0}),t){const e=this._view._containerHeight-this._view._getBottomSpacerHeight()-this._view._heightBelowRenderBlockEstimate,t={animate:!1};n.each(this._listModification.items,(s=>{this._view._renderInfoCache[s.key]&&this._view._setCellTopAndVisibility(s.key,!0,e,0,t)}))}this._view._repositionCells({animate:!0,staggerAnimations:true})}}else this._view._repositionCells({animate:!0});n.size(this._view._pendingAnimations)>0?this._view.setCurrentState(new x.WaitForAnimation(this._view)):this._view.setCurrentState(new x.Idle(this._view))}}onAnimateStartStopItem(e,t){this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){u.warn(c.LogTraceArea.VirtualMessageView,"WaitForModifiedItemsRender - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},x.Wait=class{constructor(e,t){this._view=e,n.delay((()=>{this._view._isMounted&&this._view.setCurrentState(new x.Idle(this._view))}),t)}init(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Wait","init")}onLayoutListContainer(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Wait","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Wait","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Wait","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Wait","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"Wait","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){u.warn(c.LogTraceArea.VirtualMessageView,"Wait - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},x.WaitForAnimation=class{constructor(e){this._view=e}init(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","init")}onLayoutListContainer(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onScroll"),this._view._onScroll(e,t)}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForAnimation","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t),0===n.size(this._view._pendingAnimations)&&this._view.setCurrentState(new x.Idle(this._view))}onControllerScrollPositionSet(){u.warn(c.LogTraceArea.VirtualMessageView,"WaitForAnimation - onControllerScrollPositionSet - Unexpected event")}onScrollEndDrag(){}},x.WaitForScrollPositionSet=class{constructor(e){this._view=e}init(e){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","init")}onLayoutListContainer(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onLayoutListContainer"),t&&(this._view._onLayoutListContainerEvent=e)}onListChanged(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onListChanged"),this._view._onListChangedQueue.push({listModification:e,updatedList:t})}onScrollToPosition(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onScrollToPosition"),this._view._onScrollToPositionEvent=e}onScroll(e,t){}onLayoutItem(e,t){this._view._onLayoutItemQueue.push({itemKey:e,newHeight:t})}onAnimateStartStopItem(e,t){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onAnimateStartStopItem"),this._view._onAnimateStartStopItem(e,t)}onControllerScrollPositionSet(){u.log(c.LogTraceArea.VirtualMessageViewDebug,"WaitForScrollPositionSet","onControllerScrollPositionSet"),this._view._repositionCells({}),this._view.setCurrentState(new x.Idle(this._view))}onScrollEndDrag(){}}},608213:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({conversationId:e,onPress:t,Title:s,accessibilityLabel:i}){return(0,o.jsx)(r.default,{AvatarSlot:(0,o.jsx)(n.ConversationAvatar,{id:e,size:"md"},"avatar"),TitleSlot:s,onPress:t,accessibilityLabel:i})};const i=s(197582),o=s(785893),n=s(343055),r=i.__importDefault(s(49860))},858700:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(217041),r=i.__importDefault(s(601976)),a=s(673115);class l extends n.ComponentBase{_buildState(e){var t;const s=r.default.getDisplayName(e.id);return e.onConversationNameChange&&s&&(void 0===this.state||s!==(null===(t=this.state)||void 0===t?void 0:t.conversationName))&&e.onConversationNameChange(s),{conversationName:s}}render(){return(0,o.jsx)(a.EntityTitle,{name:this.state.conversationName,Subtitle:this.props.Subtitle,isVerified:this.props.isVerified})}}t.default=l},953629:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyBotConversationControls=function(e){return(0,o.jsx)(n.default,{conversationId:e.conversationId,isGalleryEnabled:e.isGalleryEnabled,otherPartyMri:e.otherPartyMri,hasActiveCall:e.hasActiveCall,onGalleryPressed:e.onGalleryPressed})};const i=s(197582),o=s(785893),n=i.__importDefault(s(370914))},154420:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyBotHeaderTitle=function({conversationId:e,onPress:t}){const[s,i]=(0,n.useState)("");return(0,o.jsx)(c.EntityCard,{AvatarSlot:(0,o.jsx)(l.default,{userMri:e,size:d.UserIconSize.Size40}),TitleSlot:(0,o.jsx)(r.default,{id:e,onConversationNameChange:i}),onPress:t,accessibilityLabel:`${s}  ${(0,a.getString)("UserProfilePanel.ViewProfileLabel")}`})};const i=s(197582),o=s(785893),n=s(667294),r=i.__importDefault(s(858700)),a=s(704704),l=i.__importDefault(s(403396)),d=s(596648),c=s(825419)},507164:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationCard=t.ConversationTitle=void 0;const i=s(197582);var o=s(858700);Object.defineProperty(t,"ConversationTitle",{enumerable:!0,get:function(){return i.__importDefault(o).default}});var n=s(608213);Object.defineProperty(t,"ConversationCard",{enumerable:!0,get:function(){return i.__importDefault(n).default}})},848822:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationIcon=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(217041),a=s(854646),l=s(968739),d=i.__importStar(s(44717)),c=i.__importDefault(s(734468)),u=i.__importDefault(s(601976)),h=i.__importDefault(s(694154)),p=i.__importDefault(s(970035)),g=s(26703),m=s(16549),S=i.__importDefault(s(20758)),_=s(641400),f=i.__importDefault(s(827361)),y=i.__importDefault(s(266872)),v=i.__importStar(s(972830)),C=i.__importDefault(s(517518)),T=i.__importDefault(s(460403)),M=i.__importDefault(s(403396)),b=i.__importDefault(s(38217)),I=s(596648),w=i.__importDefault(s(685734)),P=I.UserIconSize.Size20+2,k=(0,g.lazyProperties)({convIconDefault:()=>n.Styles.createViewStyle({backgroundColor:m.Color.gray400,alignItems:"center",justifyContent:"center"}),meetNowIcon:()=>n.Styles.createViewStyle({backgroundColor:m.Color.blue}),meetNowIconDarkHightContrast:()=>n.Styles.createViewStyle({backgroundColor:m.Color.gray50}),meetNowIconLightHightContrast:()=>n.Styles.createViewStyle({backgroundColor:m.Color.gray400}),container:()=>n.Styles.createViewStyle({borderRadius:0,overflow:"visible"}),messageAuthorAvatarContainer:()=>n.Styles.createViewStyle({position:"absolute",justifyContent:"center",bottom:-4,right:-4,width:P,height:P,borderRadius:P/2,alignItems:"center"}),borderOverlayStyle:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0})}),A={convIconSizes:(0,g.lazyProperties)({size24:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size24,height:I.ConversationIconSize.Size24,borderRadius:I.ConversationIconSize.Size24/2}),size:_.IconSize.size16,color:m.Color.white}),size28:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size28,height:I.ConversationIconSize.Size28,borderRadius:I.ConversationIconSize.Size28/2}),size:_.IconSize.size16,color:m.Color.white}),size30:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size30,height:I.ConversationIconSize.Size30,borderRadius:I.ConversationIconSize.Size30/2}),size:_.IconSize.size16,color:m.Color.white}),size36:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size36,height:I.ConversationIconSize.Size36,borderRadius:I.ConversationIconSize.Size36/2}),size:_.IconSize.size20,color:m.Color.white}),size40:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size40,height:I.ConversationIconSize.Size40,borderRadius:I.ConversationIconSize.Size40/2}),size:_.IconSize.size20,color:m.Color.white}),size44:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size44,height:I.ConversationIconSize.Size44,borderRadius:I.ConversationIconSize.Size44/2}),size:_.IconSize.size28,color:m.Color.white}),size50:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size50,height:I.ConversationIconSize.Size50,borderRadius:I.ConversationIconSize.Size50/2}),size:_.IconSize.size24,color:m.Color.white}),size60:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size60,height:I.ConversationIconSize.Size60,borderRadius:I.ConversationIconSize.Size60/2}),size:_.IconSize.size24,color:m.Color.white}),size64:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size64,height:I.ConversationIconSize.Size64,borderRadius:I.ConversationIconSize.Size64/2}),size:_.IconSize.size28,color:m.Color.white}),size100:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size100,height:I.ConversationIconSize.Size100,borderRadius:I.ConversationIconSize.Size100/2}),size:_.IconSize.size48,color:m.Color.white}),size120:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size120,height:I.ConversationIconSize.Size120,borderRadius:I.ConversationIconSize.Size120/2}),size:_.IconSize.size48,color:m.Color.white}),size160:()=>({dimensionsStyles:n.Styles.createViewStyle({width:I.ConversationIconSize.Size160,height:I.ConversationIconSize.Size160,borderRadius:I.ConversationIconSize.Size160/2}),size:_.IconSize.size48,color:m.Color.white}),botBorderRadius:()=>n.Styles.createViewStyle({borderRadius:7})})};class x extends r.ComponentBase{_buildState(e,t){const s=e.conversationId?u.default.getDisplayableProfile(e.conversationId):void 0,i=y.default.shouldUseInitialsForConversationIcon(),o=y.default.isAccessibleTheme()?m.Color.white:void 0,n=e.conversationId?c.default.getPrimaryColor(e.conversationId):void 0,r=y.default.isDarkTheme(),a=y.default.isAccessibleTheme();let d,h;if(e.conversationId){const{background:t,textColor:s}=(0,l.getAvatarColorsFromMri)(e.conversationId);d=t,h=this._getIconFontColor(a,r,s)}else d=[m.Color.blue,m.Color.white],h=this._getIconFontColor(a,r);return{conversationImageUrl:s?T.default.getAuthenticatedUrl(s.getAvatarUrl()):void 0,skypeToken:C.default.getSkypeToken(),primaryColor:o||n,conversationNameInitials:i&&s?s.getUpperCaseInitials():void 0,lastMessageAuthorDisplayName:e.lastMessageAuthorMri?w.default.getDisplayableUserByMri(e.lastMessageAuthorMri).displayName:void 0,conversationGradientColors:d,conversationIconFontColor:h,useInitialsForConvIcon:i,useDarkTheme:r,useAccessibleTheme:a}}render(){const e=this.state.conversationImageUrl,t=this.props.altName,s=this._getIconStyleInfo(),i=this.state.conversationIconFontColor,r=[k.convIconDefault,b.default.getCachedBackgroundColorStyle(b.default.getIconBackgroundColor(this.state.primaryColor,this.state.useAccessibleTheme,this.state.useDarkTheme),this.props.colorThemeOverride?v.isDarkTheme(this.props.colorThemeOverride):this.state.useDarkTheme),s.dimensionsStyles],l=this._getAvatarBorderColor(),c=b.default.getCachedBorderColorStyle(l);let u;if(this.state.useInitialsForConvIcon&&this.state.conversationNameInitials){const e=[...x._getFontSizeStyles(this.props.size,i),f.default.transparentBackground];u=(0,o.jsx)(n.Text,{style:e,numberOfLines:1,allowFontScaling:!1,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants,children:this.state.conversationNameInitials})}else{const e=_.SkypeIcon.ContactGroupTwoPersonas;u=(0,o.jsx)(p.default,{icon:e,color:this.state.conversationIconFontColor,size:s.size,style:f.default.transparentBackground})}const g=[k.convIconDefault,r],m=this.state.useAccessibleTheme?(0,o.jsx)(n.View,{style:r,children:u}):(0,o.jsx)(a.GradientView,{style:g,colors:this.state.conversationGradientColors,direction:a.GradientDirection.BOTTOM_RIGHT,children:u}),S="ConversationIcon; MRINamespace:"+(this.props.conversationId?d.Namespaces[d.getMriNamespace(this.props.conversationId)]:"null");return(0,o.jsxs)(h.default,{origin:S,source:e,skypeToken:this.state.skypeToken,altView:m,title:t,containerStyle:[s.dimensionsStyles,k.container],style:s.dimensionsStyles,resizeMode:"cover",importantForAccessibility:this.props.importantForAccessibility,blockUntrustedDomains:!0,onPress:this.props.onPress,accessibilityLabel:this.props.accessibilityLabel,children:[this._renderBorderOverlay(c,s.dimensionsStyles),this.props.showLastMessageAuthor?this._getLastMessageAuthorAvatar():void 0]})}_renderBorderOverlay(e,t){if(e)return(0,o.jsx)(n.View,{style:[e,t,k.borderOverlayStyle]})}_getLastMessageAuthorAvatar(){const e=[k.messageAuthorAvatarContainer];return e.push(n.Styles.createViewStyle({backgroundColor:this._getAvatarBorderColor(this.props.statusBorderColor)},!1)),(0,o.jsx)(n.View,{style:e,children:(0,o.jsx)(M.default,{size:I.UserIconSize.Size20,userMri:this.props.lastMessageAuthorMri,title:this.state.lastMessageAuthorDisplayName,showTitleOnHover:!0,borderRadiusOverride:I.UserIconSize.Size20/2,hideBorder:!0})})}_getIconStyleInfo(){switch(this.props.size){case I.ConversationIconSize.Size24:return A.convIconSizes.size24;case I.ConversationIconSize.Size28:return A.convIconSizes.size28;case I.ConversationIconSize.Size30:return A.convIconSizes.size30;case I.ConversationIconSize.Size36:return A.convIconSizes.size36;case I.ConversationIconSize.Size40:return A.convIconSizes.size40;case I.ConversationIconSize.Size44:return A.convIconSizes.size44;case I.ConversationIconSize.Size50:return A.convIconSizes.size50;case I.ConversationIconSize.Size60:return A.convIconSizes.size60;case I.ConversationIconSize.Size64:return A.convIconSizes.size64;case I.ConversationIconSize.Size100:return A.convIconSizes.size100;case I.ConversationIconSize.Size120:return A.convIconSizes.size120;case I.ConversationIconSize.Size160:return A.convIconSizes.size160;default:return A.convIconSizes.size40}}static _getFontSizeStyles(e,t){const s=Math.ceil(e/(e<=I.ConversationIconSize.Size40?3:4)),i=t+s;let o=x._cachedFontSizeStyles[i];return o||(o=n.Styles.createTextStyle({fontSize:s,font:S.default.font.uiDisplayBold,color:t||m.Color.white}),x._cachedFontSizeStyles[i]=o),[o]}_getIconFontColor(e,t,s){return e?t?m.Color.black:m.Color.white:s||m.Color.white}_getAvatarBorderColor(e){return e||(this.state.useAccessibleTheme?this.state.useDarkTheme?m.Color.gray100:m.Color.gray400:this.state.useDarkTheme?m.Color.whiteOverlay40:m.Color.blackOverlay10)}}t.ConversationIcon=x,x._cachedFontSizeStyles={},t.default=x},236827:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(85755),r=s(44557),a=s(825419),l=i.__importDefault(s(958868)),d=s(888500),c=s(482564),u=s(812822),h=i.__importDefault(s(150343)),p=i.__importDefault(s(260928)),g=i.__importDefault(s(740794)),m=i.__importDefault(s(201721)),S=s(85385),_=s(815146),f=s(240804),y=i.__importDefault(s(760989)),v=i.__importDefault(s(245331)),C=s(123985),T=s(113002);class M extends l.default{constructor(){super(...arguments),this._getConfig=()=>({anchor:()=>this,positionPriorities:["bottom","right"],popupBeakSize:{width:0,height:0}}),this._handleMenuCommand=e=>{const t=y.default.newCauseId();switch((0,S.log)(_.LogTraceArea.Navigation,`[CreateMenu] handle menu command, causeId: ${t}`),(0,S.track)(new c.HubPlusButtonEvent(e)),e){case r.MeetNowButtonActionCommands.CreateMeetNow:case r.MeetNowButtonActionCommands.JoinMeetNow:const t=e===r.MeetNowButtonActionCommands.CreateMeetNow?r.MeetNowOrigin.RecentChatsHubDesktop:r.MeetNowOrigin.JoinLobby;n.MeetNowHelpers.handleMeetNowActionMenuCommand(e,t);break;case C.ADD_CONVERSATION_MODERATED_GROUP_COMMAND:new p.default({navigationOrigin:_.NavigationConversationOrigin.NewModeratedGroup,peopleType:f.PeopleType.All,filterPeopleType:f.FilterType.GroupCapable}).start(this._getRootViewId());break;case C.ADD_CONVERSATION_GROUP_COMMAND:new p.default({navigationOrigin:_.NavigationConversationOrigin.NewGroup,peopleType:f.PeopleType.All,filterPeopleType:f.FilterType.GroupCapable}).start(this._getRootViewId());break;case C.ADD_CONVERSATION_1ON1_COMMAND:new p.default({creating1on1Conversation:!0,peopleType:f.PeopleType.All,filterPeopleType:f.FilterType.None,isSingleContactSelect:!0,navigationOrigin:_.NavigationConversationOrigin.NewChat,wizardSteps:[T.WizardSteps.setConvParticipants]}).start(this._getRootViewId());break;case C.ADD_CONVERSATION_PRIVATE_COMMAND:new p.default({creating1on1Conversation:!0,peopleType:f.PeopleType.AllExcludingBots,filterPeopleType:f.FilterType.None,isSingleContactSelect:!0,navigationOrigin:_.NavigationConversationOrigin.NewPrivateChat,wizardSteps:[T.WizardSteps.setConvParticipants]}).start(this._getRootViewId());break;case C.ADD_CELLULAR_SMS_CONVERSATION_COMMAND:new p.default({creating1on1Conversation:!0,peopleType:f.PeopleType.AllWithPhoneNumbers,filterPeopleType:f.FilterType.CallCapable,isSingleContactSelect:!0,navigationOrigin:_.NavigationConversationOrigin.NewChat,wizardSteps:[T.WizardSteps.setConvParticipants],createCellularSmsConversation:!0}).start(this._getRootViewId());break;case C.CREATE_CLIPS_RECORDING_COMMAND:m.default.setRecordedClipFromCreateButton(!0),g.default.navigateToSkypeClipsRecorder(u.SkypeClipsRecordScenario.compose);case d.SXActionMenuCancel:}}}_buildState(){return{hasSkypeClips:v.default.isSkypeClipsRecordingEnabled(),hasNewChannel:h.default.getS4LUiFeatures().enableUGCCreationContextMenu}}render(){return(0,o.jsx)(a.ContextMenu,{id:"create_menu",variant:"grouped",config:this._getConfig(),items:this._getGroupedMenuItems(),onCommand:this._handleMenuCommand,trigger:this.props.trigger,onOpen:this.props.onOpen})}_getGroupedMenuItems(){return(0,C.getExperimentCreateMenuItems)({hasSMS:!0,hasSkypeClips:this.state.hasSkypeClips,hasNewChannel:this.state.hasNewChannel})}}t.default=M},27249:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(912838),a=s(295939),l=s(601505),d=i.__importDefault(s(958868)),c=s(12407),u=s(605804),h=s(297886),p=s(85385),g=s(185201);function m({selectedFilter:e,onFilterChange:t,ControlSlot:s}){const i=(0,r.useRecentFilterPills)();return(0,o.jsxs)(n.Column,{children:[(0,o.jsx)(n.Row,{children:(0,o.jsxs)(n.Row,{flex:"1",paddingX:"size160",paddingY:"size40",height:"size400",justifyContent:"space-between",flexWrap:"nowrap",backgroundColor:"surfacePrimary",children:[(0,o.jsx)(n.SegmentedControl,{variant:"segmented",onSelectionChange:t,items:i,selectedId:e}),s]})}),"channels"===e?(0,o.jsx)(h.StoreEntryPoint,{}):null]})}class S extends d.default{constructor(){super(...arguments),this._store=(0,a.getConversationsListStore)(),this._filtersStore=(0,a.getRecentsFilterStore)(),this._contentChannelsFREStore=new c.FRESuggestionsStore,this._handleFilterChange=e=>{var t;this._filtersStore.setFilterMode(e),(0,p.track)(new g.RecentsPillTabNavigationEvent(e)),"channels"!==e||(null===(t=this._contentChannelsFREStore)||void 0===t?void 0:t.isCompleted())||0!==this._store.getShownConversations().length||(0,l.navigateToChannelsFRE)(this._getRootViewId(),u.ContentChannelFREOpenedTelemetryOrigin.ChannelTab)}}_buildState(){return{selectedFilter:this._filtersStore.getFilterMode()}}render(){return(0,o.jsx)(m,{selectedFilter:this.state.selectedFilter,onFilterChange:this._handleFilterChange,ControlSlot:this.props.ControlSlot})}}t.default=S},816198:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(26703),a=i.__importDefault(s(497910)),l=(0,r.lazyProperties)({container:()=>n.Styles.createButtonStyle({overflow:"visible",height:8,alignItems:"center",justifyContent:"center"}),divider:()=>n.Styles.createViewStyle({height:1,alignSelf:"stretch"})});class d extends a.default{render(){let e;return this.props.suppressBaseDivider||(e=(0,o.jsx)(n.View,{style:[l.divider,this._themeStyles.dividerColorStyle]})),(0,o.jsx)(n.View,{style:[l.container,this.props.style],ignorePointerEvents:!0,children:e})}}t.default=d},52593:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=s(537180),l=i.__importDefault(s(117475)),d=i.__importDefault(s(20758)),c=s(964414),u=i.__importDefault(s(43823));t.default=(0,r.memo)((({conversationName:e,origin:t,isBottomSheetOpen:s,conversationIcon:i,menuItems:h,onItemSelected:p})=>{const g=(0,r.useRef)(null),m=(0,r.useRef)(null),S=(0,r.useMemo)((()=>["50%","100%"]),[]),[_,f]=(0,r.useState)(S);(0,r.useEffect)((()=>{var e,t;s?null===(e=g.current)||void 0===e||e.present():null===(t=g.current)||void 0===t||t.dismiss()}),[s]);const{titleStyle:y}=(0,c.useSkypeStyles)((({themeColors:{textPrimary:e}})=>({titleStyle:{fontSize:d.default.fontSize.size17,lineHeight:22,color:e,marginTop:10}})),[]);return(0,o.jsx)(n.BottomSheet,{ref:g,snapPoints:_,children:(0,o.jsx)(n.BottomSheetScrollView,{children:(0,o.jsxs)(n.Box,{paddingX:"size160",marginBottom:10,onLayout:e=>{var t,s;const i=null===(s=null===(t=e.nativeEvent)||void 0===t?void 0:t.layout)||void 0===s?void 0:s.height;i&&"number"==typeof i&&i>0&&i!==m.current&&(m.current=i,f([e.nativeEvent.layout.height+24+l.default.bottomSafeAreaInsetNoSubscription()]))},children:[(0,o.jsxs)(n.Box,{flex:"1",alignItems:"center",paddingY:"size160",children:[i,(0,o.jsx)(a.Text,{style:y,children:e})]}),(0,o.jsx)(u.default,{menuItems:h,onItemSelected:p,origin:t})]})})})}))},327613:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListItem=void 0;const i=s(197582),o=s(785893),n=s(344175),r=i.__importDefault(s(485234)),a=s(496486),l=s(167606),d=s(762595),c=s(854646),u=i.__importStar(s(516778)),h=i.__importStar(s(317588)),p=i.__importDefault(s(369347)),g=i.__importDefault(s(455907)),m=s(966666),S=s(26178),_=s(737298),f=i.__importDefault(s(549173)),y=i.__importDefault(s(524526)),v=s(619429),C=s(460515),T=s(742403),M=i.__importDefault(s(19831)),b=i.__importStar(s(309520)),I=i.__importDefault(s(844445)),w=i.__importDefault(s(453761)),P=i.__importDefault(s(970035)),k=i.__importStar(s(888500)),A=i.__importDefault(s(660401)),x=i.__importStar(s(450301)),D=s(262725),R=i.__importDefault(s(998929)),L=i.__importDefault(s(659312)),B=i.__importDefault(s(827361)),F=i.__importDefault(s(497910)),N=i.__importDefault(s(232665)),E=(i.__importDefault(s(206483)),i.__importDefault(s(38217))),O=i.__importDefault(s(927568)),U=i.__importStar(s(435395)),V=i.__importDefault(s(363091)),H=s(693352),j=s(901156),z=s(190697),W=s(196761),G=i.__importStar(s(340482)),K=s(843890),q=i.__importDefault(s(20758)),Q=i.__importDefault(s(791384)),X=i.__importDefault(s(150343)),$=s(527919),J=i.__importDefault(s(740794)),Y=i.__importDefault(s(601976)),Z=i.__importDefault(s(201721)),ee=i.__importDefault(s(341994)),te=i.__importDefault(s(942724)),se=i.__importDefault(s(450312)),ie=i.__importDefault(s(389659)),oe=i.__importStar(s(85385)),ne=i.__importStar(s(704704)),re=i.__importDefault(s(503411)),ae=i.__importStar(s(437782)),le=s(154235),de=s(815146),ce=s(773151),ue=s(16549),he=s(641400),pe=i.__importDefault(s(179075)),ge=i.__importDefault(s(262382)),me=s(502796),Se=s(854642),_e=s(216678),fe=i.__importDefault(s(932541)),ye=s(717413),ve=i.__importDefault(s(766298)),Ce=i.__importStar(s(152010)),Te=i.__importDefault(s(574818)),Me=s(403396),be=i.__importDefault(s(498801)),Ie=i.__importDefault(s(395270)),we=i.__importDefault(s(187250)),Pe=i.__importStar(s(507700)),ke=i.__importDefault(s(458910)),Ae=i.__importStar(s(500645)),xe=i.__importDefault(s(555436)),De=i.__importDefault(s(999261)),Re=i.__importDefault(s(839970)),Le=i.__importDefault(s(685734)),Be=s(596648),Fe=i.__importStar(s(800662)),Ne=s(26703),Ee=i.__importDefault(s(760989)),Oe=i.__importDefault(s(114818)),Ue=i.__importStar(s(463519)),Ve=i.__importStar(s(971988)),He=i.__importStar(s(44717)),je=i.__importStar(s(567567)),ze=i.__importDefault(s(404547)),We=i.__importDefault(s(304623)),Ge=i.__importDefault(s(556587)),Ke=i.__importStar(s(172134)),qe=s(535973),Qe=i.__importStar(s(459287)),Xe=i.__importStar(s(46209)),$e=i.__importDefault(s(805121)),Je=i.__importDefault(s(96309)),Ye=s(379878),Ze=i.__importDefault(s(235549)),et=i.__importDefault(s(574489)),tt=i.__importDefault(s(306200)),st=i.__importDefault(s(892034)),it=i.__importDefault(s(615364)),ot=i.__importDefault(s(732028)),nt=s(137092),rt=i.__importStar(s(954225)),at=s(627414),lt=i.__importStar(s(242561)),dt=s(848822),ct=i.__importDefault(s(341126)),ut=i.__importStar(s(131708)),ht=i.__importStar(s(433614)),pt=i.__importStar(s(823684)),gt=i.__importDefault(s(459778)),mt=i.__importDefault(s(638260)),St=i.__importDefault(s(793778)),_t=s(605804),ft=s(803193),yt=s(601505),vt=i.__importStar(s(170881)),Ct=i.__importDefault(s(52593)),Tt=i.__importDefault(s(207864)),Mt=s(993277),bt=i.__importDefault(s(92179)),It=s(96575),wt=rt.messageTextLineHeight,Pt=he.IconSize.size16,kt=he.IconSize.size10,At=he.IconSize.size12,xt=he.IconSize.size20,Dt=(0,Ne.lazyProperties)({row:()=>u.Styles.createViewStyle({flexDirection:"row"}),listItemWrapper:()=>u.Styles.createViewStyle({overflow:"visible",backgroundColor:ue.Color.transparent}),listItemBaseForChats:()=>u.Styles.createViewStyle({flexDirection:"row",alignItems:"center",height:100}),listItemBaseForBing:()=>u.Styles.createViewStyle({flexDirection:"column",justifyContent:"center"}),listItemBase:()=>u.Styles.createViewStyle({flex:1,paddingTop:10,paddingBottom:10,overflow:"visible"}),listItemBaseHorizontalPadding:()=>u.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.leftDesktop,paddingRight:le.RowPaddingModernize.rightDesktop,paddingBottom:le.RowPaddingModernize.bottom,paddingTop:le.RowPaddingModernize.top}),listItemCompact:()=>u.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),listItemMobile:()=>u.Styles.createViewStyle({paddingTop:6,paddingBottom:6}),infoSection:()=>u.Styles.createViewStyle({alignItems:"flex-end",alignSelf:"stretch",marginLeft:4,marginTop:10}),linkText:()=>u.Styles.createTextStyle({flex:-1,fontSize:q.default.controlFontSize.cardTitle,marginBottom:3}),linkTextUnreadSelected:()=>u.Styles.createTextStyle({font:q.default.font.uiDisplayBold}),accessoryIcon:()=>u.Styles.createTextStyle({alignSelf:"flex-end",marginLeft:4}),accessoryIconMobile:()=>u.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginTop:4}),accessoryIconMobileCompact:()=>u.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),lastMessageTimeText:()=>u.Styles.createTextInputStyle({marginVertical:5}),lastMessageText:()=>u.Styles.createTextStyle({flex:1,lineHeight:wt}),infoSectionRN:()=>u.Styles.createViewStyle({paddingTop:5,marginTop:0}),cardContentBase:()=>u.Styles.createViewStyle({flex:1,alignItems:"flex-start",alignSelf:"stretch",justifyContent:"center"}),cardContentCompact:()=>u.Styles.createViewStyle({marginLeft:10}),cardContentSmall:()=>u.Styles.createViewStyle({marginLeft:12}),displayName:()=>u.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),displayNameBase:()=>u.Styles.createViewStyle({alignSelf:"stretch",paddingRight:6}),lastMessageAccessoryIcon:()=>u.Styles.createViewStyle({flexShrink:0,flexGrow:0,paddingRight:4,paddingTop:3,height:wt}),lastMessageContainer:()=>u.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",alignItems:"center",overflow:"visible",flex:1}),lastMessageContainerWeb:()=>u.Styles.createViewStyle({height:wt,overflow:"hidden"}),typingIndicatorContainer:()=>u.Styles.createViewStyle({paddingVertical:2,height:22}),callButtonsContainer:()=>u.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",overflow:"visible"}),joinButtonStyle:()=>u.Styles.createViewStyle({overflow:"visible"}),optionalButton:()=>u.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:ue.Color.transparent}),optionalAccessoryButton:()=>u.Styles.createViewStyle({alignItems:"center",marginLeft:15,backgroundColor:ue.Color.transparent}),badgeView:()=>u.Styles.createViewStyle({marginLeft:4}),categoryIconView:()=>u.Styles.createViewStyle({marginLeft:4}),categoryIconViewCompact:()=>u.Styles.createViewStyle({marginLeft:9}),categoryIconViewCommon:()=>u.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),indicatorImage:()=>u.Styles.createImageStyle({width:30,height:15}),inlineIndicatorImage:()=>u.Styles.createImageStyle({position:"absolute",top:4}),compositeNav:()=>(0,Ne.lazyProperties)({listItemBase:()=>u.Styles.createViewStyle({paddingTop:0,paddingBottom:3}),listItemBaseHorizontalPaddingModernize:()=>u.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.leftDesktop,paddingRight:le.RowPaddingModernize.rightDesktop}),listItemBaseCompact:()=>u.Styles.createViewStyle({paddingTop:0,paddingBottom:0}),listItemBaseCompactHorizontalPaddingModernize:()=>u.Styles.createViewStyle({paddingLeft:le.RowPaddingModernize.leftDesktop,paddingRight:le.RowPaddingModernize.rightDesktop}),infoSectionExtraPadding:()=>u.Styles.createViewStyle({marginTop:6}),infoSectionLeftNav:()=>u.Styles.createViewStyle({marginTop:4}),infoSectionCompact:()=>u.Styles.createViewStyle({flexDirection:"row",alignItems:"center",overflow:"visible"}),accessoryViewCompact:()=>u.Styles.createViewStyle({marginLeft:5,overflow:"visible"}),linkText:()=>u.Styles.createTextStyle({fontSize:q.default.controlFontSize.body,font:q.default.font.uiDisplayRegular,marginBottom:0}),linkTextExtraCompact:()=>u.Styles.createTextStyle({fontSize:q.default.controlFontSize.bodySmallDeprecated}),inlineText:()=>u.Styles.createTextStyle({fontSize:q.default.controlFontSize.body,lineHeight:19}),accessoryIcon:()=>u.Styles.createTextStyle({marginTop:2}),lastMessageTimeText:()=>u.Styles.createTextInputStyle({marginVertical:6}),darkThemeRead:()=>u.Styles.createViewStyle({opacity:.8}),lastMessageText:()=>u.Styles.createTextStyle({fontSize:q.default.controlFontSize.body})}),cardContent:()=>u.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch"}),errorSymbolContainer:()=>u.Styles.createViewStyle({alignItems:"center",justifyContent:"center",marginBottom:2,width:Pt+6,height:Pt}),errorSymbol:()=>u.Styles.createViewStyle({paddingRight:6}),reducedHighlight:()=>u.Styles.createViewStyle({opacity:.5}),swipeActionsBackground:()=>u.Styles.createViewStyle({top:-.5,bottom:1}),userPresenceIndicator:()=>u.Styles.createViewStyle({width:kt,height:kt,borderRadius:kt/2,marginHorizontal:1,marginLeft:5}),modernizeUserPresenceIndicator:()=>u.Styles.createViewStyle({width:kt,height:kt,borderRadius:kt/2,marginHorizontal:5}),mobileCertifiedIconWrapper:()=>u.Styles.createViewStyle({position:"relative",bottom:1}),bingIconForCompactView:()=>u.Styles.createViewStyle({justifyContent:"center"})});class Rt extends F.default{constructor(){super(...arguments),this._cardContentAndDividerTransformValue=new u.Animated.Value(0),this._cardContentOpacityValue=new u.Animated.Value(1),this._toggleBottomSheet=()=>{this.setState({isBottomSheetOpened:!this.state.isBottomSheetOpened}),this.state.isBottomSheetOpened&&(Tt.default.triggerFeedback(),vt.dismissAll())},this._conversationSwipeActionForCommand=e=>{const t=ut.default.conversationSwipeActionForCommand(e,this.props.conversationId,this._currentTheme,this._useCompactLayout(),this._onHandleMoreMenuCommand);return t&&(t.backgroundColor=this._getContext().themeColors.surfaceInteractive,t.iconColor=this._getContext().themeColors.iconOnColor),t},this._onDropStarted=()=>{const e=this._container;if(!e)return;if(!this.state.allUserConversations||0===this.state.allUserConversations.length)return void e.onDragDropContinue(this.props.conversationId);const t=qe.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,nt.ConversationUIType.OneOnOneSkype),s=qe.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,nt.ConversationUIType.Private),i=t&&t.id;s&&s.id;i&&e.onDragDropContinue(i)},this._containerRefCallback=e=>{this._container=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._onAccessibilityAction=e=>{const t=e.nativeEvent;if(t&&!(0,a.isEmpty)(t.actionName)){const e=this._getMoreMenuItems().items.filter((e=>(0,Oe.default)(e.text,t.actionName)));this._onHandleMoreMenuCommand(e[0].command)}},this._onHandleContextMenu=e=>{M.default.showContextMenu(e,this._getRootViewId(),{getMenuGroups:this._getContextMenuGroups,onItemSelected:this._onHandleMoreMenuCommand})},this._onHandleLongPress=e=>{0},this._onArchiveConversation=()=>{L.default.showIfRequired(this._getRootViewId()).then((()=>{this._archiveConversation()}))},this._getContextMenuGroups=()=>ut.default.getMenuSections(Object.assign({},this._getMenuItems())),this._onHandleMoreMenuCommand=e=>{const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"ConversationsListItem._onHandleMoreMenuCommand, conversationId: "+ae.mriOrId(this.props.conversationId)+", command: "+e+", causeId: "+t);const s=He.isOneOnOneConversation(this.props.conversationId)&&X.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&!He.isMyBotConversation(this.props.conversationId);switch(e){case Mt.ConversationCommands.AudioCall:this._startCall(v.StartCallOrMaybePromptUserIntent.Audio,t);break;case Mt.ConversationCommands.Call:this._startCall(v.StartCallOrMaybePromptUserIntent.Generic,t);break;case Mt.ConversationCommands.ManageGroup:J.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:t});break;case Mt.ConversationCommands.CopyLink:ve.default.getConversationJoinLink(this.props.conversationId).then((e=>{we.default.shareToClipboard(e),this._sendConfiramtionToast(ne.getString("MeetNow.LinkCopied")),this._trackMeetNowClick(m.MeetNowClickType.ClickCopyLink)})).fail((()=>{this._sendConfiramtionToast(ne.getString("MeetNow.GenericErrorTitle")),this._trackMeetNowClick(m.MeetNowClickType.CopyLinkFailed)}));break;case Mt.ConversationCommands.Profile:J.default.showDetailsPanelWithParams({mri:this.props.conversationId,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:t});break;case Mt.ConversationCommands.Favorite:s?tt.default.addToFavorites(this.props.conversationId):ke.default.addConversation(this.props.conversationId);break;case Mt.ConversationCommands.Unfavorite:s?tt.default.removeFromFavorites(this.props.conversationId):ke.default.removeConversation(this.props.conversationId);break;case Mt.ConversationCommands.MagicBotPin:(0,ye.pinMagicBotConvListTop)();break;case Mt.ConversationCommands.MagicBotUnpin:(0,ye.unpinMagicBotConvListTop)();break;case Mt.ConversationCommands.LeaveConversation:this._handleLeaveConversation();break;case Mt.ConversationCommands.ClearConversation:case Mt.ConversationCommands.DeleteConversation:(0,$.deleteConversationGroup)(this.props.conversationId,(()=>this._container),this.context,"ConversationListItem",at.DeleteConversationSource.ConversationListItem);break;case Mt.ConversationCommands.MarkRead:s?tt.default.markGroupAsRead(this.props.conversationId):Ke.markConversationRead(this.props.conversationId);break;case Mt.ConversationCommands.MarkUnread:Ke.markMessageUnread(this.props.conversationId);break;case Mt.ConversationCommands.AddBotToContacts:ge.default.addAgentAsContact(He.stripMriNamespace(this.props.conversationId)).then((()=>{We.default.ensureConversationLoadedOrFaked(this.props.conversationId).then((()=>{J.default.navigateToConversation({convId:this.props.conversationId,origin:de.NavigationConversationOrigin.Recents,causeId:t,isNewConversation:!0})}))}));break;case Mt.ConversationCommands.DeleteBotFromContacts:(0,$.deleteConversation)(this.props.conversationId,(()=>this._container),this.context,"ConversationListItem",at.DeleteConversationSource.ConversationListItem);break;case Mt.ConversationCommands.BlockContact:const e={mriToBlock:this.state.otherPartyMri||this.props.conversationId,rootViewId:this._getRootViewId(),reportContext:de.ReportContextListOptions.BlockContact,isBlockingDialog:!0,conversationId:this.props.conversationId},o={onCancelPress:void 0};J.default.navigateToReportConcernModal(e,o,at.BlockConversationSource.ConversationListItem);break;case Mt.ConversationCommands.Unblock:const n=this.state.otherPartyMri||this.props.conversationId;this.state.isOneOnOne&&this.state.isRecipientBlocked&&xe.default.unblockContact(n,at.BlockConversationSource.ConversationListItem).then((()=>{(0,ye.isMagicBotConversation)(n)&&_e.AIConsentService.checkAndRequestConsentIfNecessary(Se.AIConsentOrigin.UnblockMagicBot,fe.default)}));break;case Mt.ConversationCommands.Archive:this._onArchiveConversation();break;case Mt.ConversationCommands.Unarchive:this._intOnUnarchiveConversation(t);break;case Mt.ConversationCommands.More:this._onHandleLongPress();break;case Mt.ConversationCommands.Mute:ze.default.setConversationSubscription(this.props.conversationId,He.SubscriptionTypes.Muted).then((()=>{oe.track(new W.ChatNotificationsToggleSetting(!1,void 0,this.props.conversationId,He.SubscriptionTypes.Muted,l.NotificationsSource.ConversationListItem,i))}));break;case Mt.ConversationCommands.Unmute:ze.default.setConversationSubscription(this.props.conversationId,"").then((()=>{oe.track(new W.ChatNotificationsToggleSetting(!0,void 0,this.props.conversationId,"",l.NotificationsSource.ConversationListItem,i))}));break;case ft.ContentChannelsCommands.Unfollow:(0,yt.handleUnfollow)(this.props.conversationId,void 0,_t.ContentChannelTelemetryOrigin.List);case k.SXActionMenuCancel:}const i=G.getConversationTypeForTelemetry(this.props.conversationId);oe.track(new pt.ConversationListItemClicked(this.props.conversationId,e,void 0,i)),this.state.enableConversationContextMenuInBottomSheet&&this.state.isBottomSheetOpened&&this.setState({isBottomSheetOpened:!1})},this._requestFocusWithDelay=()=>{(0,a.delay)((()=>{this.isComponentMounted()&&this.requestFocus()}),200)},this._onMarkConversationUnread=()=>{this.isComponentMounted()&&this.setState({markAsUnreadShowUnreadCount:!0})},this._archiveConversation=()=>{const e=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_archiveConversation, causeId: "+e),Ke.setConversationSubscription(this.props.conversationId,He.SubscriptionTypes.Muted),$e.default.archiveConversation(this.props.conversationId,de.ArchiveConversationOrigin.ContextMenu,this._getRootViewId()),J.default.navigateAfterArchivingConversation(this.props.conversationId,e,this._getContext())},this._unarchiveConversation=()=>{const e=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_unarchiveConversation, causeId: "+e),Ke.setConversationSubscription(this.props.conversationId,He.SubscriptionTypes.Normal),$e.default.unarchiveConversation(this.props.conversationId,de.UnarchiveConversationOrigin.ContextMenu)},this._onCallButtonPress=e=>{e.stopPropagation();const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_onCallButtonPress, causeId: "+t),this._startCall(v.StartCallOrMaybePromptUserIntent.Audio,t)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_onVideoCallButtonPress, causeId: "+t),this._startCall(v.StartCallOrMaybePromptUserIntent.Video,t)},this._onJoinCallButtonPress=e=>{e.stopPropagation();const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_onJoinCallButtonPress, causeId: "+t),this._startCall(v.StartCallOrMaybePromptUserIntent.Generic,t)},this._onEndCallButtonPress=e=>{if(e.stopPropagation(),this.state.callId){const e=Ee.default.newCauseId();mt.default.trackHangUpButtonClick(this.state.callId,e),new _.EndCallCommand(this.state.callId).execute()}},this._onConversationAudioButtonRef=e=>{this._conversationAudioButtonRef=e||void 0},this._onDragStartContact=e=>{Xe.default.addDragAndDropContactInformation(e,this.state.ownerConversationId,this.state.conversationDisplayName,H.DragOrigin.RecentConversations)},this._onPress=e=>{bt.default.createTrackerAndMarkPressTime(this.props.conversationId,It.ScenarioName.ResponsivenessGoToConversation,e),this._completeOnPress(this.props.origin)},this._completeOnPress=e=>{const t=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"ConversationsListItem._onPress, causeId: "+t),u.UserInterface.isNavigatingWithKeyboard()&&Q.default.maybeAnnounceForAccessibility(ne.getString("Global.EnteringChatAnnouncement",{chatName:this.state.conversationDisplayName})),this.props.isSelected?u.UserInterface.isNavigatingWithKeyboard()&&Fe.setFocus(Fe.FocusEvent.RefreshConversation):!this.state.isUsingStackNav&&this.state.callId&&this.state.hasActiveCall&&this.state.activeCallStatus===C.ActiveCallStatus.Connected?p.default.CallNavigationHelper.rejoinCall(this.props.conversationId,this.state.callId,t,de.NavigationCallOrigin.ConversationListItem,!0):J.default.navigateToConversation({convId:this.props.conversationId,origin:e,causeId:t}),St.default.setShowMyBotFloatToolTip(!1)}}_buildState(e,t){var s;const{enableMagicBot:i,enableGroupedConversations:o,enableMediaPreviewDrafts:n,hideConversationsListSectionHeaders:l,enableConversationsCategoriesIcon:d,magicBotSuggestionshDebounceTimeout:c,enableConversationContextMenuInBottomSheet:u}=X.default.getS4LMessagingFeatures(),{enableJoinerCallPreview:h,enableMessageTranslation:g,enableShowingResumeCallInConversationListItem:m}=X.default.getS4LCMCFeatures(),S=et.default.getMessageCountsForConversation(e.conversationId,!0),_=(0,it.default)(),f=_.getConversation(e.conversationId);f||oe.warn(de.LogTraceArea.ConversationsListItem,"ConversationsListItem: _buildState, conversation "+ae.mriOrId(e.conversationId)+" doesn't exist");const v=!!f&&f.isOneOnOne(),M=v&&f?f.getOtherPartyMri():void 0;let b;f&&this._shouldDisplayLastMessage(f)&&(b=_.getFakeLastMessageFallback(e.conversationId)||f.lastMessage);const I=Ze.default.getComposingUsers(e.conversationId),w=te.default.isUsingStackNavigationContext(),P=this.props,k=De.default.isCurrentUserActive();let A=!!this.state&&this.state.markAsUnreadShowUnreadCount;this.state&&this.state.markAsUnreadShowUnreadCount&&(!e.isSelected&&P.isSelected||this.state.unreadCount>0&&0===S.unreadCount)&&(A=!1);const x=t||!e.isSelected||this.state.displayedUnreadCount||!k||A,D=He.isMyBotConversation(e.conversationId),R=v&&o&&!D?tt.default.isGroupMarkedAsFavorite(e.conversationId):!!f&&f.isFavorite(),L=He.isEncryptedThread(e.conversationId),B=M||e.conversationId,F=Le.default.getConversationOwner(B),N=Y.default.getDisplayName(F)||"",E=Y.default.getShortDisplayName(F)||"",O=M?Pe.getCustomStatusFromMri(M):void 0,U=b&&b.hasAlbumId()&&!b.isSendRejected(),V=Te.default.getDraftPreviews(e.conversationId),H=X.default.getEngagementFeatures().conciergeBotSettings.enableVisibility&&He.isConciergeBotMri(e.conversationId),j=!!M&&He.isAgent(M),z=gt.default.shouldShowCategories(),W=(0,ye.isMagicBotConversation)(e.conversationId),G={conversationTimestamp:this._getConversationTimestamp(f,n),conversationLastMessage:b,conversationDisplayName:N,conversationShortDisplayName:E,isFavorite:R,isMuted:!!f&&f.isMuted(),markAsUnreadShowUnreadCount:A,highPriorityUnreadCount:S.highPriorityUnreadCount,unreadCount:S.unreadCount,displayedUnreadCount:x?S.unreadCount:0,unreadCountOverflowed:S.unreadCountOverflowed,isMriAContact:!!M&&xe.default.isContact(Le.default.getConversationOwner(M)),isMriAnAgent:j,isEngagementBot:H,isMyBot:D,isJoinEnabled:null==f?void 0:f.isJoinEnabled(),isCallingAllowed:p.default.CallNavigationHelper.isCallingAllowed(e.conversationId),isRecipientBlocked:_.isConversationBlocked(f),isEncrypted:L,isTeamsUser:He.isS4BBridgeMri(e.conversationId),isNewsBot:(0,T.isTodayBot)(null==f?void 0:f.id),useMobileUI:w,otherPartyMri:M,isUsingStackNav:w,isOneOnOne:v,iOSAccessibilityActionEnabled:!1,addAccessibilityHint:!0,enableJoinerCallPreview:h&&He.isGroupConversation(e.conversationId),isLastMessageCallEvent:b&&Ve.isCallMessageType(b),displayBlockButton:f&&this._shouldDisplayBlockOption(f),allUserConversations:tt.default.getDisplayableConversationsForUser(F),ownerConversationId:F,isArchived:!!f&&f.isArchived(),draft:st.default.getSavedMessageInput(e.conversationId),mood:O&&O.mood,moodEmoticonType:O&&O.moodEmoticonType,moodEmoticonTone:O&&O.moodEmoticonTone,moodAccessibilityLabel:O&&O.mood&&O.moodEmoticonType&&Pe.getAccessibilityTitle(O.mood),enableMediaPreviewDrafts:n,mediaDraft:(0,r.default)(V),isLastMessageFromAlbum:U,isTranslated:g&&y.default.isConversationTranslated(e.conversationId),lastMessageAuthorAvatarSwitchedOn:Z.default.getLastMessageAuthorAvatarSwitchedOn(),alwaysNavigateToLobby:null==f?void 0:f.isGroupConversation(),isTrustedAgent:j&&pe.default.isTrustedAgent(e.conversationId),isStackNavAndNotArchived:w&&!(null==f?void 0:f.isArchived()),enableMagicBot:i,magicBotUnpin:W&&ee.default.getMagicBotConvListUnpin(),enableMagicBotSuggestions:i&&W,hideConversationsListSectionHeaders:l,enableConversationsCategoriesIcon:d,showCategories:z,magicBotSuggestionshDebounceTimeout:c,enableConversationContextMenuInBottomSheet:u,isBottomSheetOpened:!1,enableShowingResumeCallInConversationListItem:m,fakeDraftMessage:void 0};if(G.draft?G.fakeDraftMessage=Qe.createFakeDraftMessage(e.conversationId,G.draft):G.enableMediaPreviewDrafts&&G.mediaDraft&&(G.fakeDraftMessage=Qe.createFakeMediaDraftMessage(e.conversationId,G.mediaDraft,Te.default.getDraftPreviewTimestamp(e.conversationId))),M)if(He.isMriWithUserMetadata(M)&&xe.default.isConversationAccepted(e.conversationId))G.mriForUserPresence=M;else{const e=null===(s=G.allUserConversations)||void 0===s?void 0:s.find((e=>He.isMriWithUserMetadata(e.id)&&xe.default.isConversationAccepted(e.id)));e&&(G.mriForUserPresence=e.id)}this._activityIndicatorOffset=G.useMobileUI?-25:-22,f&&f.isThread()&&Ge.default.prioritizeConversation(f.id,!1,!0);const K=p.default.ActiveCallUIHelper.getActiveCallId(e.conversationId);G.callId=K,G.hasActiveCall=p.default.ActiveCallUIHelper.hasActiveCall(e.conversationId),G.allowOutboundVideo=p.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:p.default.CallingStore.isPSTNCallWithNullCheck(G.callId,e.conversationId),isEncryptedCall:L,conversationMri:e.conversationId}),G.activeCallStatus=p.default.ActiveCallUIHelper.activeCallStatus(e.conversationId),G.activeCallDuration=this._getCallDuration(G.callId);const q=t||e.conversationId!==P.conversationId,Q=I.length>0;if(q&&(G.isHovering=!1),G.conversationLastMessage?(t||G.conversationLastMessage!==this.state.conversationLastMessage)&&(this._cachedLastMessageLabel=this._getLastMessageAccessibilityLabel(G.conversationLastMessage)):this._cachedLastMessageLabel="",G.allUserConversations){const e=qe.ConversationUtils.getConversationForGivenType(G.allUserConversations,nt.ConversationUIType.Private);G.isPrivateConversationHandshakeCompleted=!!e&&ot.default.getHandshakeState(e.id)===Ye.SecureHandshakeState.Completed}if(G.showTypingState=!e.isSelected&&!G.isMuted&&Q&&(!G.isEncrypted||ot.default.getHandshakeState(e.conversationId)===Ye.SecureHandshakeState.Completed),f&&e.conversationId===P.conversationId&&this.state&&G.unreadCount&&G.unreadCount>this.state.unreadCount&&Je.default.setPreviousConsumptionHorizon(e.conversationId,f.getConsumptionHorizon()),G.mriForUserPresence){G.statusTypes=Ae.contactAllowedStatuses();let t=Re.default.getUserStatusWithOptions(G.mriForUserPresence,G.statusTypes);t&&(t=Ae.maskedUserStatus(t)),G.userPresence=(0,a.clone)(Re.default.getCachedUserPresence(G.mriForUserPresence)),G.userStatus=e.rowSize===ce.RowSize.ExtraCompact?t:void 0}else G.statusTypes=void 0,G.userStatus=void 0;return G.shouldRenderJoinButtonForActiveCall=G.enableJoinerCallPreview&&G.hasActiveCall&&G.activeCallStatus!==C.ActiveCallStatus.Connected&&!(G.callId&&p.default.CallingStore.isCallIncoming(G.callId)),G}componentWillUnmount(){super.componentWillUnmount(),this._onMarkConversationUnreadToken&&this._onMarkConversationUnreadToken.unsubscribe()}componentDidMount(){var e,t;super.componentDidMount();const s=this._isTyping(this.state),i=this._indicatorInfo(s,this.state.hasActiveCall);this._cardContentAndDividerTransformValue.setValue(i.offset),this._cardContentOpacityValue.setValue(i.contentOpacity),this._onMarkConversationUnreadToken=Je.default.markConversationUnreadCallback(this.props.conversationId,this._onMarkConversationUnread),this.state.isMyBot&&this.state.isFavorite&&!Z.default.isMyBotTooltipVisibleNoSubscription()&&this.props.rowSize!==ce.RowSize.ExtraCompact&&St.default.setMyBotItemReady(),null===(t=(e=this.props).onComponentDidMount)||void 0===t||t.call(e)}_shouldComponentUpdate(e,t,s,i,o,n){return e?this.state.showTypingState!==s.showTypingState||this.state.hasActiveCall!==s.hasActiveCall||this.state.unreadCount!==s.unreadCount||this.state.conversationLastMessage!==s.conversationLastMessage:super._shouldComponentUpdate(e,t,s,i,o,n)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this._pauseWhenNotVisible()||this._intComponentDidUpdate(e,t)}_componentDidUpdate(e,t,s){super._componentDidUpdate(e,t,s),this._intComponentDidUpdate(e,t)}_getCallDuration(e){return e?p.default.CallDurationStore.getCallDurationInSeconds(e):0}_intComponentDidUpdate(e,t){const s=this._isTyping(this.state),i=this._isTyping(t),o=this._indicatorInfo(s,this.state.hasActiveCall);this._cardContentAndDividerTransformValue.setValue(o.offset),s===i&&this.state.hasActiveCall===t.hasActiveCall||(this._cardContentAndDividerAnimation&&this._cardContentAndDividerAnimation.stop(),this._cardContentAndDividerAnimation=u.Animated.parallel([u.Animated.timing(this._cardContentAndDividerTransformValue,{toValue:o.offset,duration:150,easing:u.Animated.Easing.Out()}),u.Animated.timing(this._cardContentOpacityValue,{toValue:o.contentOpacity,duration:200,delay:o.contentOpacity?100:0,easing:u.Animated.Easing.Out()})]),this._cardContentAndDividerAnimation.start())}_indicatorInfo(e,t){return e&&!t?{offset:this._activityIndicatorOffset,contentOpacity:0}:t&&!this._useCompactLayout()&&this._isPresentedInDesktopLeftNav()?{offset:-8,contentOpacity:0}:{offset:0,contentOpacity:1}}_renderMobileBackgroundView(){if(!this.state.isUsingStackNav&&(this.state.isHovering||this.props.isSelected))return(0,o.jsx)(u.View,{style:B.default.absoluteFill,ignorePointerEvents:!0})}_backgroundColorStyles(){if(!this.state.isUsingStackNav)return[U.getListItemBackgroundStyle(this.props.isSelected,this.state.isHovering,this._themeColors)]}_renderCallButtons(){return this.state.shouldRenderJoinButtonForActiveCall?this._renderJoinCallControls():this.state.activeCallStatus===C.ActiveCallStatus.Connected?this._renderEndCallControls():this._renderAcceptCallControls()}requestFocus(){this._container&&this._container.requestFocus()}_renderJoinCallControls(){const e={textColor:this._themeColors.textOnColor};this._useAccessibleTheme()&&this._useDarkTheme()&&(e.textColor=this._themeColors.textOnColor);const t={buttonStyle:le.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:ue.AgnosticGradientFillButtonColors.green,gradientDirection:c.GradientDirection.BOTTOM_RIGHT},s=this.state.enableShowingResumeCallInConversationListItem&&this.state.activeCallStatus===C.ActiveCallStatus.OnHold?ne.getString("CallControlsOverFlowMenu.ResumeCall"):ne.getString("CallBanner.JoinLiveCallMessage");return(0,o.jsx)(A.default,Object.assign({buttonSize:le.SXButtonSize.Small,style:Dt.joinButtonStyle,title:s,onPress:this._onJoinCallButtonPress,disabled:this._isJoinCallButtonDisabled(),buttonConfig:e},t))}_renderEndCallControls(){return(0,o.jsx)(u.View,{style:Dt.callButtonsContainer,children:(0,o.jsx)(S.CallButton,{title:ne.getString("CallControls.CallButtonEndCall"),accessibilityLabel:ne.getString("CallControls.CallButtonEndCall"),onPress:this._onEndCallButtonPress,icon:he.SkypeIcon.CallEnd,size:S.CallButtonSize.ExtraSmall,isToggledOn:!1,isCallEndButton:!0,backgroundStyle:S.CallButtonBackgroundStyle.Solid,spacing:S.CallButtonSpacing.None})})}_renderAcceptCallControls(){const e=this._useCompactLayout()&&this.state.hasActiveCall,t=e&&!this.state.useMobileUI||this._isPresentedInDesktopLeftNav(),s=this._themeColors.iconHoverColor,i=this._themeColors.iconPrimary,n=t?he.IconSize.size16:he.IconSize.size24,r=e||t?Dt.optionalAccessoryButton:Dt.optionalButton,a=this.state.activeCallStatus===C.ActiveCallStatus.OnHold,l=a?ne.getString("OngoingCall.OngoingCallOnHoldTitle"):ne.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationDisplayName}),d=(0,o.jsx)(w.default,{ref:this._onConversationAudioButtonRef,size:n,onPress:this._onCallButtonPress,color:i,hoverColor:s,icon:this._getAcceptCallAudioButtonIcon(a),style:r,title:l,accessibilityLabel:l});if(this.state.allowOutboundVideo){const e=ne.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationDisplayName}),t=(0,o.jsx)(w.default,{size:n,onPress:this._onVideoCallButtonPress,color:i,hoverColor:s,icon:he.SkypeIcon.Video,style:r,title:e,accessibilityLabel:e});return(0,o.jsxs)(u.View,{style:Dt.callButtonsContainer,children:[t,d]})}return d}_getAcceptCallAudioButtonIcon(e){return e?he.SkypeIcon.Pause:this.state.isEncrypted?he.SkypeIcon.PrivateCallFill:he.SkypeIcon.CallStart}_getMessageContentOptions(e){const t=this._useAccessibleTheme()&&(this.state.isHovering||this.props.isSelected)?this._themeColors.textOnColor:this._themeColors.textPrimary;return{processing:lt.ProcessingDefaults.Preview,renderMedia:!1,mediaPlaceholderIconColor:t,allowLargeEmoticons:!1,trimToFirstLine:!0,forceLayoutInRTL:!0,numberOfLines:1,textOverrideStyle:e,renderLocation:!0,forceStaticAnimatedEmoticons:!0,fontSize:this._themeColors.bubbleFontSize,allowTextFallbackEmoticons:!0,showPlaceholderEmoticons:!1,placeholderBackgroundColor:ue.Color.transparent,atMentionStyle:e,atMentionMeOverrideStyle:e,renderSimpleAtMentions:!0}}render(){var e;const t=this._useCompactLayout(),s=this._isTyping(this.state),i=this.state.displayedUnreadCount>0;let r,l;this._useCompactLayout()||(r=this._getOptionalLastMessageContent(s),this.state.hasActiveCall&&(l=this._renderCallButtons()));const c=(0,ye.isMagicBotConversation)(this.props.conversationId)&&!this.state.magicBotUnpin,h=this.state.iOSAccessibilityActionEnabled?this._getMoreMenuItems().items.map((e=>({name:e.text,label:e.text}))):void 0,p=ut.default.getAccessibilityLabel({conversationDisplayName:this.state.conversationDisplayName,isOneOnOne:this.state.isOneOnOne,presence:this.state.userPresence,isRecipientBlocked:this.state.isRecipientBlocked,isMagicBotPinned:c,isFavorite:this.state.isFavorite,lastMessageLabel:this._cachedLastMessageLabel,lastMessageTime:this._getLastMessageTime(!0),hasActiveCall:this.state.hasActiveCall,activeCallStatus:this.state.activeCallStatus,isTyping:s,isMuted:this.state.isMuted,displayedUnreadCount:this.state.displayedUnreadCount,addAccessibilityHint:this.state.addAccessibilityHint,isSelected:this.props.isSelected,isAgent:He.isAgent(this.props.conversationId),moodAccessibilityLabel:this.state.moodAccessibilityLabel}),g=this._onHandleContextMenu;let m;const S=[Dt.listItemBase,this.state.enableMagicBotSuggestions?Dt.listItemBaseForBing:Dt.listItemBaseForChats,Dt.listItemBaseHorizontalPadding];this.state.useMobileUI?m=this._renderMobileBackgroundView():(S.push(t?Dt.compositeNav.listItemBaseCompact:Dt.compositeNav.listItemBase,t?Dt.compositeNav.listItemBaseCompactHorizontalPaddingModernize:Dt.compositeNav.listItemBaseHorizontalPaddingModernize,B.default.pointerCursor),S.push(this._backgroundColorStyles())),this.state.useMobileUI&&(S.push(this._backgroundColorStyles()),S.push(t?Dt.listItemCompact:Dt.listItemMobile));const _=this._getItemHeightStyle();_&&S.push(_);const f=this._isDraggable(),y=ut.default.rowDecorator({conversationId:this.props.conversationId,useExtraCompactLayout:this.props.rowSize===ce.RowSize.ExtraCompact,userStatus:this.state.userStatus,hasActiveCall:this.state.hasActiveCall,isEncrypted:this.state.isEncrypted,isOneOnOne:this.state.isOneOnOne,isTranslated:this.state.isTranslated,isTeamsUser:this.state.isTeamsUser});let v;switch(y.type){case ut.RowDecoratorType.Avatar:v=this._renderIcon();break;case ut.RowDecoratorType.Icon:v=this._renderCompactDecoratorIcon(y.icon);break;case ut.RowDecoratorType.Status:v=void 0!==!this.state.userStatus?E.default.getPresenceIcon(this.state.userStatus,this.state.isStackNavAndNotArchived?Dt.modernizeUserPresenceIndicator:Dt.userPresenceIndicator,kt,void 0,void 0):this._renderCompactDecoratorSpacer();break;default:case ut.RowDecoratorType.None:v=this._renderCompactDecoratorSpacer()}const C=(0,o.jsxs)(o.Fragment,{children:[m,v,this._renderConversationCard(r,i),this._renderInfoSection(c),l]}),T=(0,o.jsx)(R.default.View,{style:S,accessibilityTraits:[u.Types.AccessibilityTrait.Button,u.Types.AccessibilityTrait.MenuItem],accessibilityLabel:p,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,onPress:this._onPress,onLongPress:g,onContextMenu:g,activeOpacity:.7,importantForAccessibility:u.Types.ImportantForAccessibility.Yes,children:this.state.enableMagicBotSuggestions?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.Row,{children:C}),this._renderSuggestionsForBing()]}):C});let M;if(K.UICapabilities.dragAndDropSupported()&&this._allowsUpload())M=(0,o.jsx)(I.default,{ref:this._containerRefCallback,style:Dt.listItemWrapper,origin:j.FilePickerOrigin.DragAndDropToRecentConversationsLists,conversationId:this.props.conversationId,onDragEnter:this._onHoverStart,onDragLeave:this._onHoverEnd,onDropStarted:this._onDropStarted,dropTargetSource:Xe.DropTargetOrigin.ConversationListItem,children:f?(0,o.jsx)(d.DragDroppableView,{style:Dt.listItemWrapper,useChildrenThumbnail:!0,useThumbnailExplicitMaxWidth:!0,onDragStart:this._onDragStartContact,children:T}):T});else{const t={accessibilityActions:h,onAccessibilityAction:h?this._onAccessibilityAction:void 0};if(this.props.enableSwipeActions){const s=ut.default.getSwipeActions(this.state.isArchived,this.state.hasActiveCall,this.state.displayedUnreadCount>0,this.state.isMuted,!1),i=s.rightActions.map(this._conversationSwipeActionForCommand),n=null===(e=s.leftActions)||void 0===e?void 0:e.map(this._conversationSwipeActionForCommand),r=[];s.overScrollRight&&r.push(x.SwipableItemActionSide.Right),s.overScrollLeft&&r.push(x.SwipableItemActionSide.Left),M=(0,o.jsx)(x.default,Object.assign({ref:this._containerRefCallback,itemId:this.props.conversationId,style:Dt.listItemWrapper,layoutType:x.SwipeActionLayout.Reveal,rightActions:(0,a.compact)(i),leftActions:(0,a.compact)(n),overscrollSides:r,onSwiping:this.props.onSwiping,dragThreshold:30,swipeDistanceThreshold:s.overScrollDistance,backgroundStyle:Dt.swipeActionsBackground,numberOfLines:2},t,{children:T}))}else M=(0,o.jsx)(u.View,Object.assign({ref:this._containerRefCallback,style:Dt.listItemWrapper},t,{children:T}))}const b=this.state.enableConversationContextMenuInBottomSheet?(0,o.jsx)(Ct.default,{conversationIcon:this._renderIcon(Be.AvatarIconSize.Size36),conversationName:this.state.conversationDisplayName,isBottomSheetOpen:this.state.isBottomSheetOpened,origin:de.NavigationConversationOrigin.Recents,onItemSelected:this._onHandleMoreMenuCommand,menuItems:this._getMoreMenuItems().items}):void 0;return(0,o.jsxs)(o.Fragment,{children:[M,b]})}_getOptionalLastMessageContent(e){let t;const s=[Dt.lastMessageContainer];s.push(Dt.lastMessageContainerWeb);const i=[q.default.fontStyle.body,Dt.lastMessageText,this._useDarkTheme()?this._themeStyles.secondaryTextColorStyle:this._themeStyles.primaryTextColorStyle];if(this.state.useMobileUI||i.push([Dt.compositeNav.lastMessageText,this._themeStyles.secondaryTextColorStyle]),i.push(U.getItemSubtitleTextStyle(this.state.useMobileUI)),i.push(u.Styles.createTextStyle({color:this._accessibleTextColor(this._themeColors.textPrimary)},!1)),this.state.hasActiveCall){let e;this._isPresentedInDesktopLeftNav()||this.state.activeCallStatus===C.ActiveCallStatus.OnHold&&(e=ne.getString("CallPanel.OnHoldHeader")),this.state.activeCallStatus===C.ActiveCallStatus.Connected&&this.state.activeCallDuration>0&&(e=ie.default.getElapsedTimeStringFromS(this.state.activeCallDuration)),e&&(t=(0,o.jsx)(u.View,{style:s,children:(0,o.jsx)(u.Text,{style:i,numberOfLines:1,children:e})}))}else if(e){s.push(Dt.typingIndicatorContainer);const e=this._renderTypingIndicator(Dt.indicatorImage,[Dt.inlineIndicatorImage,Dt.indicatorImage]);t=(0,o.jsxs)(u.View,{style:s,children:[(0,o.jsx)(u.Text,{style:i,numberOfLines:1,children:""}),e]})}else if(this._canDisplayDraft()&&this.state.fakeDraftMessage){const e=this.state.isEncrypted?(0,o.jsx)(u.Text,{style:i,numberOfLines:1,children:ne.getString("MessageComposer.DraftDecorator")+" "+(X.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?ne.getString("ConversationsListItem.PrivateMessage"):ne.getString("ConversationsListItem.PrivateConversationLabel"))}):(0,o.jsx)(ct.default,{message:this.state.fakeDraftMessage,options:this._getMessageContentOptions(i)});t=(0,o.jsx)(u.View,{style:s,children:e})}else if(this.state.isEncrypted&&!this.state.isLastMessageCallEvent)t=(0,o.jsx)(u.View,{style:s,children:(0,o.jsx)(u.Text,{style:i,numberOfLines:1,children:X.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?ne.getString("ConversationsListItem.PrivateMessage"):ne.getString("ConversationsListItem.PrivateConversationLabel")})});else if(this.state.conversationLastMessage){let e;if(this.state.isLastMessageFromAlbum)return(0,o.jsx)(u.View,{style:s,children:(0,o.jsx)(u.Text,{style:i,numberOfLines:1,children:ne.getString("ConversationsListItem.MediaAlbumItems")})});this.state.conversationLastMessage.isSendRejected()&&(e=(0,o.jsx)(u.View,{style:Dt.errorSymbolContainer,children:(0,o.jsx)(P.default,{icon:he.SkypeIcon.Error,size:Pt,color:this._themeColors.destructiveTextColor,style:Dt.errorSymbol})})),t=(0,o.jsxs)(u.View,{style:s,children:[e,(0,o.jsx)(ct.default,{message:this.state.conversationLastMessage,options:this._getMessageContentOptions(i)})]})}return t}_renderCompactDecoratorSpacer(){return(0,o.jsx)(u.View,{style:this.state.isStackNavAndNotArchived?Dt.modernizeUserPresenceIndicator:Dt.userPresenceIndicator})}_renderCompactDecoratorIcon(e){if(e)return(0,o.jsx)(P.default,{icon:e,size:this.state.isStackNavAndNotArchived?xt:At,style:this.state.enableMagicBotSuggestions?Dt.bingIconForCompactView:void 0,color:this._useDarkTheme()?this._themeColors.secondaryTextColor:this._themeColors.primaryIconColor})}_triggerFileUpload(e){const t=this._container;t&&t.onDragDropContinue(e)}_allowsUpload(){if(this.state.allUserConversations&&this.state.allUserConversations.length>0){const e=qe.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,nt.ConversationUIType.OneOnOneSkype),t=qe.ConversationUtils.getConversationForGivenType(this.state.allUserConversations,nt.ConversationUIType.Private);if(!e&&!t)return!1;if(t&&!e)return!1}return!0}_renderIcon(e){var t;let s;const i=this._isPresentedInDesktopLeftNav(),n=E.default.getIconSize(e||this.props.conversationIconSize),r=!this.state.isUsingStackNav&&this.props.isSelected,a=!r||i&&!this._useDarkTheme()?void 0:this._themeColors.primaryBackgroundColor,l=je.getHoverTitle(this.state.userPresence);let d;if(d=i?r?this._themeColors.secondaryRowHighlightColor:this._themeColors.secondaryBackgroundColor:r?this._themeColors.rowHighlightColor:this._themeColors.primaryBackgroundColor,this.state.isOneOnOne)s=(0,o.jsx)(Me.UserIcon,{userMri:this.state.otherPartyMri,size:n.user,title:l,backgroundColor:a,statusTypes:this.state.statusTypes,statusBorderColor:d,importantForAccessibility:u.Types.ImportantForAccessibility.NoHideDescendants});else{let e,i;this.state.conversationLastMessage&&(e=Ve.isThreadActivityType(this.state.conversationLastMessage.messagetype)?Ce.getMessageInitiator(this.state.conversationLastMessage):null===(t=this.state.conversationLastMessage)||void 0===t?void 0:t.creator,i=!this._useCompactLayout()&&this.state.lastMessageAuthorAvatarSwitchedOn&&!Ve.isEventCallEndedMessageType(this.state.conversationLastMessage)),s=(0,o.jsx)(dt.ConversationIcon,{conversationId:this.props.conversationId,altName:this.state.conversationDisplayName,size:n.conversation,backgroundColor:a,statusBorderColor:d,lastMessageAuthorMri:e,showLastMessageAuthor:i,importantForAccessibility:u.Types.ImportantForAccessibility.NoHideDescendants})}return s}_renderConversationCard(e,t){const s=[Dt.cardContentBase];let i;if(this.state.useMobileUI&&!this._useCompactLayout()?s.push(Dt.cardContentSmall):s.push(Dt.cardContentCompact),t||this.props.isSelected||this.state.useMobileUI||!this._useDarkTheme()||s.push(Dt.compositeNav.darkThemeRead),e){const t=this.state.isLastMessageCallEvent?void 0:this._renderOptionalMessageTypeIcon();i=(0,o.jsxs)(u.Animated.View,{style:Dt.cardContent,children:[t,e]})}const n=[Dt.displayNameBase,Dt.displayName],r=this._getDisplayNameStyle();let a;if(this._useCompactLayout()&&this._canDisplayDraft()){const e=[r,this._themeStyles.secondaryTextColorStyle,B.default.flexZero];e.push(u.Styles.createTextStyle({color:this._themeColors.textSecondary},!1)),a=(0,o.jsx)(u.Text,{style:e,numberOfLines:1,children:ne.getString("MessageComposer.DraftDecorator")+" "})}const l=this.state.mood&&this.state.moodEmoticonType?(0,o.jsx)(Ie.default,{mood:this.state.mood,moodEmoticonType:this.state.moodEmoticonType,moodEmoticonTone:this.state.moodEmoticonTone}):void 0,d=this.state.isTrustedAgent?this._getOptionalCertifiedIcon():void 0;return(0,o.jsxs)(u.View,{style:s,children:[(0,o.jsxs)(u.View,{style:n,children:[a,(0,o.jsx)(u.Text,{style:r,numberOfLines:1,children:this.state.conversationDisplayName}),l,d]}),i]})}_renderSuggestionsForBing(){return(0,o.jsx)(me.BingConversationSuggestion,{conversationId:this.props.conversationId,debounceTimeout:this.state.magicBotSuggestionshDebounceTimeout})}_canDisplayDraft(){return this.state.draft&&!this.state.unreadCount||this.state.enableMediaPreviewDrafts&&this.state.mediaDraft&&!this.state.unreadCount}_optionalMessageTypeIcon(){return ut.default.optionalMessageTypeIcon(this.props.rowSize===ce.RowSize.ExtraCompact,this.state.isEncrypted,this.state.isTranslated,this.props.conversationId,this.state.isLastMessageFromAlbum)}_renderOptionalMessageTypeIcon(){if(this.props.rowSize===ce.RowSize.ExtraCompact)return;const e=this._optionalMessageTypeIcon();return e?this._getMessageTypeIcon(e):void 0}_getOptionalCertifiedIcon(){return(0,o.jsx)(be.default,{botMri:this.props.conversationId,style:undefined})}_getMessageTypeIcon(e){let t=this._useDarkTheme()?this._themeColors.textSecondary:this._themeColors.textPrimary;return this.state.useMobileUI||(t=this._themeColors.textSecondary),t=this._accessibleTextColor(this._themeColors.textPrimary),(0,o.jsx)(P.default,{icon:e,size:he.IconSize.size15,color:t,style:Dt.lastMessageAccessoryIcon})}_renderTypingIndicator(e,t){const s=[e];let i;!this.state.isUsingStackNav&&t&&s.push(t),i=this._useAccessibleTheme()?this._useDarkTheme()?this.state.isHovering||this.props.isSelected?h.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:h.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:this.state.isHovering||this.props.isSelected?h.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_DARK:h.Collection.TYPING_INDICATOR_NEXT_HIGHCONTRAST_LIGHT:this._useDarkTheme()?h.Collection.TYPING_INDICATOR_NEXT_DARK:h.Collection.TYPING_INDICATOR_NEXT_LIGHT;const n=(0,o.jsx)(u.Image,{style:s,source:i,resizeMode:"contain"},"typing");return this.state.isUsingStackNav?(0,o.jsx)(N.default,{style:t,children:n},"typing"):n}_renderInfoSection(e){const t=this._useCompactLayout(),s=this._isTyping(this.state),i=[Dt.lastMessageTimeText];this.state.isUsingStackNav||i.push(Dt.compositeNav.lastMessageTimeText),i.push(u.Styles.createTextStyle({color:this._accessibleTextColor(this._themeColors.textSecondary)},!1));const n=t&&s?this._renderTypingIndicator(Dt.indicatorImage,i):void 0;let r;const a=(0,ye.isMagicBotConversation)(this.props.conversationId),l=this.state.showCategories&&this.state.enableConversationsCategoriesIcon&&(this.state.isFavorite||a);let d;this.state.hasActiveCall||n||(r=(0,o.jsx)(D.Caption,{style:i,numberOfLines:1,selected:this.props.isSelected,children:this._getLastMessageTime()})),t?d=[Dt.compositeNav.infoSectionCompact]:(d=[Dt.infoSection],this.state.useMobileUI||d.push(this._isPresentedInDesktopLeftNav()?Dt.compositeNav.infoSectionLeftNav:Dt.compositeNav.infoSectionExtraPadding));const c=this._renderAccessoryView();return r||n||c?(0,o.jsxs)(u.View,{style:d,children:[n,(0,o.jsxs)(u.View,{style:Dt.row,children:[r,l?this._renderCategoryIcon(this.state.isFavorite,e):null]}),c]}):void 0}_renderCategoryIcon(e,t){let s;return t?s=he.SkypeIcon.Pin:e&&(s=he.SkypeIcon.Favourite),s?(0,o.jsx)(P.default,{style:[Dt.categoryIconViewCommon,this._useCompactLayout()?Dt.categoryIconViewCompact:Dt.categoryIconView],size:he.IconSize.size16,color:this._themeColors.iconSecondary,icon:s}):null}_renderAccessoryView(){let e;const t=this._useCompactLayout();if(!this.state.hasActiveCall||t){if(t&&this.state.hasActiveCall)e=this._renderCallButtons();else if(this.state.isMuted)e=(0,o.jsx)(P.default,Object.assign({icon:he.SkypeIcon.NotificationOff},this._accessoryStyleInfo()));else if(this.state.displayedUnreadCount){const s=this.state.displayedUnreadCount;let i=s.toString();s&&this.state.unreadCountOverflowed&&(i=ne.getString("Global.CountOverflow",{count:i}));const n=this.state.isOneOnOne||!!this.state.highPriorityUnreadCount,r=this.state.useMobileUI&&t?b.BadgeSize.Desktop:b.BadgeSize.Default,a=this._useAccessibleTheme()&&(this.state.isHovering||this.props.isSelected);e=(0,o.jsx)(b.default,{style:Dt.badgeView,count:i,rawCount:s,colorStyle:a?u.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1):u.Styles.createViewStyle({backgroundColor:this._themeColors.surfaceInteractive},!1),isHighPriority:n,badgeSize:r,themeOverride:a})}e&&t&&(e=(0,o.jsx)(u.View,{style:Dt.compositeNav.accessoryViewCompact,children:e}))}return e}_accessoryStyleInfo(){const e=[Dt.accessoryIcon];return this._useCompactLayout()?e.push(Dt.accessoryIconMobileCompact):this.state.useMobileUI?e.push(Dt.accessoryIconMobile):e.push(Dt.compositeNav.accessoryIcon),{style:e,size:this.state.useMobileUI?he.IconSize.size16:he.IconSize.size14,color:this._themeColors.secondaryTextColor}}_getItemHeightStyle(){if(!this.props.itemHeight)return;let e=Rt._heightStyleCache[this.props.itemHeight];return e||(e=u.Styles.createViewStyle({height:this.props.itemHeight}),Rt._heightStyleCache[this.props.itemHeight]=e),e}_isTyping(e){return e.showTypingState&&!e.hasActiveCall&&!e.isEncrypted}_getDisplayNameStyle(){const e=[Dt.linkText,this._themeStyles.primaryTextColorStyle];return this.state.useMobileUI?(this._useCompactLayout()&&e.push(q.default.fontStyle.body),(!this.state.isUsingStackNav&&this.props.isSelected||this.state.displayedUnreadCount)&&e.push(Dt.linkTextUnreadSelected)):(e.push(Dt.compositeNav.linkText,Dt.compositeNav.inlineText),this.props.rowSize===ce.RowSize.ExtraCompact&&e.push(Dt.compositeNav.linkTextExtraCompact),this.state.displayedUnreadCount&&e.push(Dt.linkTextUnreadSelected)),e.push(U.getItemTitleTextStyle(this.props.isSelected,this.state.displayedUnreadCount>0)),this.state.isStackNavAndNotArchived&&e.push(U.getItemTitleTextStyle(this.props.isSelected,this.state.displayedUnreadCount>0,!0)),e.push(u.Styles.createTextStyle({color:this._accessibleTextColor(this._themeColors.textPrimary)},!1)),e}_getLastMessageTime(e=!1){return this.state.conversationTimestamp?ie.default.getDisplayDateTimeMixedString(this.state.conversationTimestamp,e):""}_intOnUnarchiveConversation(e){oe.log(de.LogTraceArea.ConversationsListItem,"ConversationsListItem._intOnUnarchiveConversation, causeId: "+e),this._unarchiveConversation(),this.props.isSelected&&!this.state.isUsingStackNav&&J.default.navigateAfterUnarchivingConversation(this.state.otherPartyMri||this.props.conversationId,e,this._getContext())}_getMoreMenuItems(){return ut.default.getMenuItems(Object.assign({},this._getMenuItems()))}_getMenuItems(){return{conversationId:this.props.conversationId,conversationShortDisplayName:this.state.conversationShortDisplayName,isFavorite:this.state.isFavorite,isOneOnOne:this.state.isOneOnOne,isMriAnAgent:this.state.isMriAnAgent,isMriAContact:this.state.isMriAContact,isRecipientBlocked:this.state.isRecipientBlocked,isCallingAllowed:this.state.isCallingAllowed,hasActiveCall:this.state.hasActiveCall,displayedUnreadCount:this.state.displayedUnreadCount,displayBlockButton:this.state.displayBlockButton,isArchived:this.state.isArchived,isEngagementBot:this.state.isEngagementBot,isMyBot:this.state.isMyBot,isJoinEnabled:this.state.isJoinEnabled,magicBotEnabled:this.state.enableMagicBot,magicBotUnpin:this.state.magicBotUnpin,isMuted:this.state.isMuted,isNewsBot:this.state.isNewsBot,isNewsChannel:!1}}_trackMeetNowClick(e){oe.track(new z.MeetNowClickEvent(void 0,{origin:m.MeetNowOrigin.ConversationListContextMenu},e))}_sendConfiramtionToast(e){const t={duration:5e3,textMessage:e,key:"copied_link_copied",rootViewId:this._getRootViewId(),accessibilityLabel:e};re.default.scheduleMessage(t)}_getLastMessageAccessibilityLabel(e){const t=Ue.decode(e);return ht.toAccessibilityLabel(t,{message:e,includeSenderInformationInAccessibilityLabel:!1,includeReactionInformationInAccessibilityLabel:!1})}_handleLeaveConversation(){const e=Ee.default.newCauseId();oe.log(de.LogTraceArea.ConversationsListItem,"_handleLeaveConversation, causeId: "+e);const t=this._getRootViewId();(0,O.default)(this.props.conversationId,(()=>{this.state.isUsingStackNav||se.default.getActiveConversationId(t)!==this.props.conversationId||J.default.navigateToDesktopRecents(e)}),t,at.RemoveMemberFromThreadSource.ConversationListItem)}_isJoinCallButtonDisabled(){return!this.state.alwaysNavigateToLobby&&!this.state.isCallingAllowed}_startCall(e,t){oe.log(de.LogTraceArea.ConversationsListItem,"_startCall, causeId: "+t),this.state.isOneOnOne||g.default.beginTrackingJoinMeetNow(m.MeetNowOrigin.ConversationsListPanel),f.default.startCallOrMaybePrompt((()=>this._conversationAudioButtonRef||(this.isComponentMounted()?this:void 0)),this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:e,showSmsOption:!1,callOrigin:de.NavigationCallOrigin.ConversationListItem,inviteOrigin:de.ContactInviteOrigin.Unknown,showCallPreview:this.state.enableJoinerCallPreview},t)}_useCompactLayout(){return this.props.rowSize===ce.RowSize.Compact||this.props.rowSize===ce.RowSize.ExtraCompact}_pauseWhenNotVisible(){return this.state.isUsingStackNav}_shouldDisplayLastMessage(e){return!(e.getTimestamp()<14926392e5||e.isThread()&&e.isDeleted())}_shouldDisplayBlockOption(e){return!(e.lastMessage&&!Ve.isCallOrSmsMessageType(e.lastMessage)&&V.default.isMyMri(e.lastMessage.creator))}_isDraggable(){return Xe.default.isDragAndDropContactsEnabled()&&this.state.isOneOnOne&&!He.isAgent(this.props.conversationId)}click(e){this._completeOnPress(e)}_getConversationTimestamp(e,t){if(!e)return;const s=Math.max(st.default.getDraftTimestampForConversation(e.id)||0,t&&Te.default.getDraftPreviewTimestamp(e.id)||0,(0,it.default)().getFakeTimestamp(e.id)||0,e.getTimestamp()||0);return s||void 0}_accessibleTextColor(e){return this._useAccessibleTheme()&&(this.state.isHovering||this.props.isSelected)?this._themeColors.textOnColor:e}}t.ConversationsListItem=Rt,Rt._heightStyleCache={},t.default=Rt},483125:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListItemWrapper=function({renderItem:e,itemHeight:t,rowSize:s,isSelected:i,isMobileUI:C,accessibilityLabel:T,contextMenuConfig:M,swipeActionsConfig:b,onPress:I,channelId:w,channelName:P,avatarUrl:k}){const A=(0,r.useRef)(null),x=(0,r.useMemo)((()=>["50%","100%"]),[]),[D,R,L]=(0,a.useHovering)(),B=s===c.RowSize.Compact||s===c.RowSize.ExtraCompact,F=P?y.default.convertDisplayNameToUpperCaseInitials(P):"",[N,E]=(0,r.useState)(k),O=(0,r.useCallback)((()=>E(void 0)),[]);(0,r.useEffect)((()=>{E(k)}),[k]);const{containerStyle:U,titleStyle:V}=(0,h.useRXStyles)((({themeColors:{surfacePrimaryAccent:e,textPrimary:s}})=>({containerStyle:n.Styles.createViewStyle({flex:1,height:t,backgroundColor:D||i?e:void 0,borderRadius:8,marginHorizontal:C?0:8,paddingHorizontal:8,paddingBottom:C||B?0:3},!1),titleStyle:{fontFamily:S.default.fontFamily.uidDisplayRegular,fontSize:S.default.fontSize.size17,lineHeight:22,color:s,marginTop:10}})),[t,B,D,i,C]),H=(0,r.useRef)(),j=(0,m.getChannelsRecentsListMenuSections)(null==M?void 0:M.items),z=(0,r.useCallback)((e=>{var t;null===(t=A.current)||void 0===t||t.dismiss(),null==M||M.onItemPress(e)}),[M]),W=()=>{var e;null===(e=null==A?void 0:A.current)||void 0===e||e.present()},G=(0,o.jsx)(a.BottomSheet,{ref:A,snapPoints:x,children:(0,o.jsx)(a.BottomSheetScrollView,{children:(0,o.jsxs)(a.Box,{paddingX:"size160",marginBottom:"size120",children:[(0,o.jsxs)(a.Box,{flex:"1",alignItems:"center",paddingY:"size160",children:[(0,o.jsx)(p.EntityAvatar,{avatarUrl:N,onImageError:O,size:(0,_.mapToConversationAvatarSize)(f.AvatarIconSize.Size36),variant:"square",FallbackSlot:(0,o.jsx)(p.EntityInitialsAvatar,{id:w||"",initials:F,variant:"square",size:(0,_.mapToConversationAvatarSize)(f.AvatarIconSize.Size36)})}),(0,o.jsx)(l.Text,{style:V,children:P})]}),(0,o.jsx)(g.MenuContent,{onCommand:z,groups:j})]})})}),K=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p.ContextMenu,{id:v,variant:"grouped",items:j,config:{anchor:()=>H.current},onCommand:z,trigger:t=>(0,o.jsx)(d.default.View,{ref:H,style:U,onMouseEnter:R,onMouseLeave:L,onPress:I,onLongPress:W,onContextMenu:e=>{((e,t)=>{t.preventDefault(),e(t)})(t,e)},accessibilityLabel:T,accessibilityTraits:[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.MenuItem],importantForAccessibility:n.Types.ImportantForAccessibility.Yes,children:e({isHovering:D})})}),G]});if(b)return(0,o.jsx)(u.SwipeActionsWrapper,{swipeActionsConfig:b,isCompactLayout:B,contextMenuItems:null==M?void 0:M.items,onContextMenuRN:W,children:K});return K};const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(667294),a=s(344175),l=s(537180),d=i.__importDefault(s(998929)),c=s(773151),u=s(340929),h=s(964414),p=s(825419),g=s(54904),m=s(38700),S=i.__importDefault(s(20758)),_=s(705795),f=s(596648),y=i.__importDefault(s(148473)),v="recentsChannelsContextMenu"},340929:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SwipeActionsWrapper=function({swipeActionsConfig:e,isCompactLayout:t,contextMenuItems:s,onContextMenuRN:i,children:g}){const{overScrollDistance:m}=a.default.getS4LUiFeaturesNoSubscription().recentChatsSwipeActionsConfig,{containerStyle:S,backgroundStyle:_}=(0,c.useRXStyles)((()=>({containerStyle:r.Styles.createViewStyle({overflow:"visible",backgroundColor:d.Color.transparent},!1),backgroundStyle:r.Styles.createViewStyle({top:-.5,bottom:1},!1)})),[]),f=(0,n.useCallback)((t=>{e.onItemPress(t)}),[e,i]),y=(0,h.useSwipeActions)(e.leftItems||[],f,e.conversationId,!!t),v=(0,h.useSwipeActions)(e.rightItems||[],f,e.conversationId,!!t),C=(0,p.useSwipeOverscroll)(),{accessibilityActions:T,onAccessibilityAction:M}=(0,u.useSwipeAccessibilityActions)(s,f);return(0,o.jsx)(l.default,{itemId:e.conversationId,style:S,backgroundStyle:_,layoutType:l.SwipeActionLayout.Reveal,leftActions:y,rightActions:v,overscrollSides:C,onSwiping:e.onSwipe,dragThreshold:30,swipeDistanceThreshold:m,numberOfLines:2,accessibilityActions:T,onAccessibilityAction:M,children:g})};const i=s(197582),o=s(785893),n=s(667294),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importStar(s(450301)),d=s(16549),c=s(964414),u=s(439630),h=s(806646),p=s(356119);s(993277)},175799:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListItemWrapper=void 0;var i=s(483125);Object.defineProperty(t,"ConversationsListItemWrapper",{enumerable:!0,get:function(){return i.ConversationsListItemWrapper}})},439630:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSwipeAccessibilityActions=function(e,t){const s=e?n.default.getMenuItems(Object.assign({},e)).items:void 0,i=(0,o.useCallback)((e=>{0}),[s,t]);return{accessibilityActions:undefined,onAccessibilityAction:i}};const i=s(197582),o=s(667294),n=i.__importDefault(s(131708))},806646:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSwipeActions=function(e,t,s,i){const{theme:r,themeColors:a}=(0,o.useCommonContext)(),l=[];for(const o of e){const e=n.default.conversationSwipeActionForCommand(o,s,r,i,t);e&&(e.backgroundColor=a.surfaceInteractive,e.iconColor=a.iconOnColor,l.push(e))}return l};const i=s(197582),o=s(736267),n=i.__importDefault(s(131708))},356119:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useSwipeOverscroll=function(){const{overScrollLeft:e,overScrollRight:t}=i.default.getS4LUiFeaturesNoSubscription().recentChatsSwipeActionsConfig,s=[];t&&s.push(o.SwipableItemActionSide.Right);e&&s.push(o.SwipableItemActionSide.Left);return s};const i=s(197582).__importDefault(s(150343)),o=s(450301)},566153:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(317588)),r=i.__importStar(s(496486)),a=i.__importStar(s(815063)),l=s(614080),d=i.__importStar(s(516778)),c=s(297886),u=s(803193),h=s(264277),p=s(601505),g=s(318315),m=s(12407),S=s(605804),_=i.__importDefault(s(367911)),f=i.__importDefault(s(186325)),y=i.__importDefault(s(453761)),v=i.__importDefault(s(970035)),C=i.__importDefault(s(452045)),T=i.__importDefault(s(45810)),M=i.__importDefault(s(660401)),b=s(262725),I=i.__importDefault(s(381967)),w=i.__importDefault(s(417411)),P=i.__importDefault(s(314290)),k=i.__importDefault(s(827361)),A=i.__importDefault(s(497910)),x=i.__importDefault(s(721657)),D=i.__importDefault(s(266311)),R=s(589640),L=i.__importDefault(s(97595)),B=i.__importDefault(s(459778)),F=i.__importDefault(s(296114)),N=s(503308),E=s(697091),O=s(985947),U=i.__importDefault(s(20758)),V=i.__importDefault(s(377556)),H=s(715405),j=i.__importDefault(s(150343)),z=i.__importDefault(s(48076)),W=i.__importDefault(s(740794)),G=i.__importDefault(s(664821)),K=(i.__importDefault(s(18026)),s(375369)),q=i.__importDefault(s(214295)),Q=i.__importDefault(s(201721)),X=i.__importDefault(s(341994)),$=i.__importDefault(s(942724)),J=i.__importDefault(s(450312)),Y=i.__importDefault(s(690051)),Z=i.__importStar(s(960282)),ee=i.__importDefault(s(421334)),te=(i.__importDefault(s(659938)),i.__importStar(s(85385))),se=i.__importStar(s(704704)),ie=s(154235),oe=s(413686),ne=s(815146),re=s(773151),ae=s(16549),le=s(641400),de=s(20107),ce=s(385855),ue=i.__importDefault(s(149249)),he=i.__importDefault(s(330647)),pe=s(957993),ge=s(77322),me=i.__importDefault(s(246655)),Se=i.__importDefault(s(326544)),_e=i.__importDefault(s(247286)),fe=s(473711),ye=s(493680),ve=i.__importDefault(s(710427)),Ce=s(128054),Te=i.__importDefault(s(189559)),Me=i.__importDefault(s(123716)),be=i.__importDefault(s(332091)),Ie=i.__importDefault(s(571209)),we=s(135405),Pe=i.__importDefault(s(283385)),ke=i.__importDefault(s(383595)),Ae=s(166980),xe=s(917387),De=i.__importDefault(s(378812)),Re=s(596648),Le=i.__importStar(s(800662)),Be=s(26703),Fe=i.__importDefault(s(924849)),Ne=i.__importDefault(s(760989)),Ee=i.__importStar(s(44717)),Oe=s(751930),Ue=s(295939),Ve=i.__importDefault(s(574489)),He=i.__importDefault(s(306200)),je=i.__importDefault(s(615364)),ze=i.__importDefault(s(793778)),We=s(491839),Ge=s(538407),Ke=s(327613),qe=i.__importDefault(s(981710)),Qe=i.__importDefault(s(479856)),Xe=i.__importDefault(s(112055)),$e=i.__importDefault(s(207864)),Je=i.__importStar(s(170881)),Ye=i.__importDefault(s(929012)),Ze=s(185201),et="ConversationsListPanel",tt=(0,Be.lazyProperties)({panel:()=>d.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),filterButtonContainer:()=>d.Styles.createViewStyle({width:44,alignItems:"center",justifyContent:"center"}),filterButtonContainerModernized:()=>d.Styles.createViewStyle({width:32,marginRight:16,alignItems:"center",justifyContent:"center",borderRadius:10,marginVertical:4}),icon:()=>d.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:le.IconSize.default,height:le.IconSize.default}),iconModernized:()=>d.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:le.IconSize.size32,flex:1}),ipadChatListContainer:()=>d.Styles.createViewStyle({paddingTop:ce.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT}),emptyStateContainer:()=>d.Styles.createViewStyle({flex:1,paddingVertical:10,paddingHorizontal:10,justifyContent:"center",alignItems:"stretch"}),emptyStateContainerItemsAtTop:()=>d.Styles.createViewStyle({justifyContent:"flex-start"}),emptyStateContainerTopPadding:()=>d.Styles.createViewStyle({paddingTop:20}),emptyStateText:()=>d.Styles.createTextStyle({textAlign:"center"}),emptyStateTextSecondLine:()=>d.Styles.createTextStyle({paddingTop:5,textAlign:"center"}),emptyStateTextSecondLineV2:()=>d.Styles.createTextStyle({marginHorizontal:30}),emptyStateTextsContainer:()=>d.Styles.createViewStyle({alignItems:"flex-start",alignSelf:"center",marginHorizontal:35}),emptyStateTextWithIconContainer:()=>d.Styles.createViewStyle({marginTop:10,flexDirection:"row",alignItems:"flex-start",flex:1}),emptyStateTextWithIconContainerV2:()=>d.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",flex:1}),emptyStateTextWithIcon:()=>d.Styles.createTextStyle({textAlign:"left",flex:1}),emptyStateTextIcon:()=>d.Styles.createViewStyle({marginRight:10}),emptyStateImageV1:()=>d.Styles.createImageStyle({height:130,width:130,alignSelf:"center"}),emptyStateImageV2:()=>d.Styles.createImageStyle({width:280,height:176,marginBottom:20,alignSelf:"center"}),syncContactsButton:()=>d.Styles.createButtonStyle({alignSelf:"center",marginTop:20,marginHorizontal:40}),syncContactsButtonV2:()=>d.Styles.createButtonStyle({marginTop:40,width:180,borderRadius:30,paddingVertical:10}),syncContactsButtonV2Small:()=>d.Styles.createButtonStyle({marginTop:20}),textStyleOverride:()=>d.Styles.createTextStyle({fontWeight:ie.FontWeight.bold,fontSize:U.default.controlFontSize.button}),emptyStateSyncContactImage:()=>d.Styles.createImageStyle({height:152,width:200,marginBottom:20,alignSelf:"center"}),emptyStateSyncContactImageSmall:()=>d.Styles.createImageStyle({marginBottom:0}),learnMoreButton:()=>d.Styles.createTextStyle({fontSize:U.default.controlFontSize.button})});class st extends A.default{constructor(){super(...arguments),this._headerUXStore=(0,g.getHeaderUXStore)(),this._filterStore=(0,Ue.getRecentsFilterStore)(),this._currentScrollTop=0,this._currentSwipeScrollTop=0,this._shadowVisible=!1,this._conversationItemRefs=new Fe.default,this._shadowOpacityValue=new d.Animated.Value(0),this._shadowOpacityStyle=d.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._initialRenderCompleteCalled=!1,this._followStore=(0,g.getFollowStore)(),this._upsellStore=(0,g.getUpsellListStore)((0,m.mapToUpsellListMaxResults)(j.default.getS4LUiFeaturesNoSubscription().upsellListItemsCount)),this._upsellCardStore=(0,g.getChannelsUpsellCardStore)(),this._onAppStateChange=e=>{this._closeCurrentSwipeView(),this._maybeShowSayHiPopup(e)},this._debouncedClickOnConversationListItem=r.debounce((e=>{e.click(ne.NavigationConversationOrigin.KeyboardShortcutRecents)}),50),this._onNavigateToPreviousConversation=()=>{if(this.state.currentConversationIndex>0){const e=r.findLast(this.state.itemList,(e=>!!e.isNavigable),this.state.currentConversationIndex-1);e&&this._clickOnConversation(e.key)}return!0},this._onNavigateToNextConversation=()=>{const e=r.find(this.state.itemList,(e=>!!e.isNavigable),this.state.currentConversationIndex+1);return e&&this._clickOnConversation(e.key),!0},this.handleFocusEvent=e=>{te.log(ne.LogTraceArea.GenericUnsafe,"ConversationsListPanel.handleFocusEvent");const t=this.state.activeConversationId&&(0,je.default)().isClearApplicableAndKeepInRecents(this.state.activeConversationId);return!(e!==Le.FocusEvent.Recent&&e!==Le.FocusEvent.ConversationDeleted||t||!this.focusFirst())||!(e!==Le.FocusEvent.CancelMobileSearch||!this._searchInputButton)&&(this._searchInputButton.focusButton(),!0)},this._handleBottomSheetItemSelected=e=>{this._closeBottomSheet(),B.default.onHandleMenuCommand(e,this._getRootViewId(),void 0)},this._onListFilterChange=e=>{var t;this._filterStore.setFilterMode(e),te.track(new Ze.RecentsPillTabNavigationEvent(e)),"channels"!==e||(null===(t=this._contentChannelsFREStore)||void 0===t?void 0:t.isCompleted())||0!==this._store.getShownConversations().length||(0,p.navigateToChannelsFRE)(this._getRootViewId(),S.ContentChannelFREOpenedTelemetryOrigin.ChannelTab)},this._renderAdBanner=e=>{if(!e)return null;const t=d.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1);return(0,o.jsx)(be.default,{adsGuid:e.adsGuid,adGuid:e.adGuid,isLastItem:e.isLastItem,dimensions:e.dimensions,placementId:e.placementId,canHide:e.canHide,provider:e.provider,style:t})},this._onInitialRenderComplete=()=>{this._initialRenderCompleteCalled||(G.default.recentsRendered(),this._initialRenderCompleteCalled=!0)},this._onLayoutVlvContainer=e=>{this.isComponentMounted()&&(this.state.listItemContainerHeight===e.height&&this.state.listItemContainerWidth===e.width||this.setState({listItemContainerHeight:e.height,listItemContainerScreenAvailableHeight:this._getItemContainerHeightDisregardingKeyboard(e.height,this.state),listItemContainerWidth:e.width}))},this._onLayoutEmptyState=e=>{this.isComponentMounted()&&this.setState({emptyStateHeight:e.height})},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._debouncedOnEndReached=r.debounce((()=>{te.log(ne.LogTraceArea.ConversationsListItem,"ConversationsListPanel._debouncedOnEndReached LoadMoreConversations"),this._store.loadMoreConversations()}),200),this._onEndReached=()=>{te.log(ne.LogTraceArea.ConversationsListItem,"ConversationsListPanel._onEndReached"),this._debouncedOnEndReached()},this._updateScrollYValue=e=>{!this.state.enableCollapsibleHeaderSearch||this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()||this.setState({vlvScrollY:e}),(0,K.getHubTabScrollStore)("recents").setValue(e)},this._onScroll=e=>{var t,s;if(this._updateScrollYValue(e),null===(s=(t=this.props).onScroll)||void 0===s||s.call(t,e,this._currentScrollTop),!this.state.isUsingStackNavigationOrMobileView){const t=e>0;this._shadowVisible!==t&&(this._shadowOpacityValue.setValue(t?.5:0),this._shadowVisible=t)}(e>this._currentSwipeScrollTop+40||e<this._currentSwipeScrollTop-40)&&this._closeCurrentSwipeView(),this._currentScrollTop=e},this._closeCurrentSwipeView=()=>{if(this._currentSwipableItemRef){const e=this._currentSwipableItemRef.ref();e&&e.close()&&(this._currentSwipableItemRef=void 0)}},this._onPressLearnMore=()=>{te.track(new E.ClickedLearnMoreOnEmptyStateCta),ke.default.showDialog({isSmallDevice:this.state.deviceSize===Z.DeviceSize.Small,isUsingStackNavigationContext:this.state.isUsingStackNavigationOrMobileView,onCancel:()=>{}},this._getRootViewId())},this._shouldRenderEmptyStateImage=e=>!0,this._handleUpsellItemPress=e=>(0,p.navigateToContentChannel)(e,this._getRootViewId()),this._handleUpsellCardFollowToggle=(e,t)=>{this._handleFollowToggle(e,t,S.ContentChannelTelemetryOrigin.UpsellCard)},this._handleUpsellListFollowToggle=(e,t)=>{this._handleFollowToggle(e,t,S.ContentChannelTelemetryOrigin.SuggestedList)},this._handleFollowToggle=(e,t,s)=>{const i=(0,H.generateCorrelationVector)();if(t)this._followStore.unfollowChannel(e.id,e.market,i).then((t=>te.track((0,h.successfulUnfollow)(e.id,null==t?void 0:t.statusCode,s,i))),(t=>{te.error(ne.LogTraceArea.GenericUnsafe,`${[et]} Error leaving channel ${e.id}: ${t}`),te.track((0,h.failedUnfollow)(e.id,null==t?void 0:t.statusCode,s,i))}));else{if(!e)return;this._followStore.followChannel(e,i).then((t=>te.track((0,h.successfulFollow)(e.id,null==t?void 0:t.statusCode,s,i))),(t=>{te.error(ne.LogTraceArea.GenericUnsafe,`${[et]} Error joining channel ${e.id}: ${t}`),te.track((0,h.failedFollow)(e.id,null==t?void 0:t.statusCode,s,i))}))}},this._renderItem=e=>{if(!e)return(0,o.jsx)(d.View,{});if(e.key===We.ConversationListItemNames.searchBar){const t=e,s=this._themeColors.iconSecondary,i=this._themeColors.iconSecondary;let n;t.safeAreaHorizontalInsets&&V.default.hasHorizontalSafeAreas(t.safeAreaHorizontalInsets)&&(n=V.default.horizontalPaddingStyle(t.safeAreaHorizontalInsets));const r=(0,o.jsx)(Pe.default,{ref:this._onSearchInputButtonRef,buttonOnly:!0,placeholderText:this.state.isMobile?se.getString("SearchInputControl.PlaceHolderTextShort"):se.getString("ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),accessibilityLabel:se.getString("HubHeaderPanel.SearchHubAccessibilityLabel"),useIOSStyles:!this.state.isMobile&&t.useIOSSearchStyles,safeAreaPaddingStyle:n,onPress:this._handleMobileSearchButtonClick,showSearchIcon:this.state.isMobile},"search");if(!t.showFilterIcon)return r;const a=this._constructContainerStyles(t),l=this._constructFilterButtonStyles(t),c=(0,o.jsx)(y.default,{ref:this._onFilterButtonRef,size:this.state.isMobile?le.IconSize.size20:le.IconSize.size16,style:this.state.isMobile?tt.iconModernized:tt.icon,onPress:this._onFilterButtonClick,color:s,hoverColor:i,icon:this.state.isMobile?le.SkypeIcon.FilterMenu:le.SkypeIcon.Filter,title:se.getString("MobileRecentsFilter.ManageChats"),autoFocus:!0});return(0,o.jsxs)(d.View,{style:a,children:[r,(0,o.jsx)(d.View,{style:l,children:c})]})}if(e.key.startsWith(We.ConversationListItemNames.header)){const t=e;return(0,o.jsx)(Qe.default,{title:t.title||""})}if(e.key===We.ConversationListItemNames.topSpacer)return(0,o.jsx)(d.View,{},"topSpacer");if(e.key===We.ConversationListItemNames.divider){const t=[d.Styles.createViewStyle({height:null==e?void 0:e.height},!1)];return(0,o.jsx)(f.default,{style:t})}if(e.key.startsWith(We.ConversationListItemNames.itemSpacer))return(0,o.jsx)(d.View,{style:d.Styles.createViewStyle({height:e.height},!1)},e.key);if(e.key===We.ConversationListItemNames.bottomSpacer)return(0,o.jsx)(d.View,{},"bottomSpacer");if(e.key.substring(0,We.ConversationListItemNames.header.length)===We.ConversationListItemNames.header){const t=e;return(0,o.jsx)(Qe.default,{title:t.title})}if(e.key===We.ConversationListItemNames.notificationsPrompt)return(0,o.jsx)(P.default,{});if(e.key===We.ConversationListItemNames.finishSetupPrompt)return(0,o.jsx)(me.default,{});if(e.key===We.ConversationListItemNames.emptyState){const t=e;return this._renderEmptyStateListItem(t)}if(e.key===We.ConversationListItemNames.nativeAd){const t=e,s={adsGuid:t.adsGuid,adGuid:t.adGuid,dimensions:t.dimensions,placementId:t.placementId,canHide:t.canHide,provider:t.provider};return t.adType===de.AdsType.ListItemNarrow?(0,o.jsx)(Te.default,Object.assign({},s)):(0,o.jsx)(Me.default,Object.assign({},s))}if(e.key===We.ConversationListItemNames.loadingIndicator)return xe.ActivityIndicatorHelper.renderItem(e,this._themeColors.secondaryTextColor);if(e.key===We.ConversationListItemNames.conversationsListBanner)return(0,Ce.getBannerComponent)(this.state.conversationsListBanner)||(0,o.jsx)(o.Fragment,{});const t=e,s=this._getIconSize(t.rowSize,t.useMobileView,t.isUsingStackNavigationContext,t.useCompactIcon);if(e.key===We.ConversationListItemNames.engagementBanner){const t=e.template,s=Ge.ConversationsListHelper.getEngagementBannerProps(t,this._getContext());if(Ge.ConversationsListHelper.isEngagementBannerConfigModernizedType(s))return(0,o.jsx)(ge.EngagementBannerModernized,Object.assign({},s));if(!r.isUndefined(s))return(0,o.jsx)(pe.EngagementBanner,Object.assign({},s))}if(e.template===We.ConversationListItemNames.upsellChannel){const t=e;return(0,o.jsx)(c.ChannelsItem,{channelItem:t,onFollowToggle:()=>{this._handleUpsellListFollowToggle(t,t.isFollowed)},onItemPress:()=>this._handleUpsellItemPress({channelId:t.id,channelName:t.name,isVerified:t.isVerified,isFollowed:t.isFollowed,avatarUrl:t.avatarUrl||"",latestHorizonId:t.lastEventHorizonId,lastContentId:void 0,lastViewedHorizonIdUpdatedAt:void 0,followersCount:t.followersCount,channelSource:t.author,shortId:t.shortId,market:t.market,origin:S.ContentChannelTelemetryOrigin.SuggestedList})})}if(e.template===We.ConversationListItemNames.upsellCard){const t=e.contents;return(null==t?void 0:t.length)?(0,o.jsx)(c.ChannelsUpsellCard,{items:t,onItemPress:e=>this._handleUpsellItemPress(Object.assign(Object.assign({},e),{origin:S.ContentChannelTelemetryOrigin.UpsellCard})),onFollowToggle:this._handleUpsellCardFollowToggle}):(0,o.jsx)(o.Fragment,{})}if(e.template===We.ConversationListItemNames.contentChannel)return(0,o.jsx)(c.ContentChannelsConversationItem,{channelId:(0,u.stripFakeContentChannelConversationPrefix)(e.key),isSelected:t.isSelected,itemHeight:t.height,rowSize:t.rowSize,avatarSize:s,enableSwipeActions:this.state.enableSwipeActions,onSwipe:this._onSwiping});const i=this.state.viewType===We.ConversationsListMode.ArchivedConversations?ne.NavigationConversationOrigin.ArchivedConversations:ne.NavigationConversationOrigin.Recents;return(0,o.jsx)(Ke.ConversationsListItem,{ref:this._conversationItemRefs.onComponentRef(t.key),itemHeight:t.height,conversationId:t.key,isSelected:t.isSelected,conversationIconSize:s,rowSize:t.rowSize,origin:i,enableSwipeActions:this.state.enableSwipeActions,onSwiping:this.state.enableSwipeActions?this._onSwiping:void 0,onComponentDidMount:this._onInitialRenderComplete},"convItem")},this._headerPanelRef=e=>{this._mybotRef=e||void 0},this.getMyBotRef=()=>this._mybotRef,this._getIconSize=(e,t,s,i)=>e===re.RowSize.Compact||e===re.RowSize.ExtraCompact||i?s?this.state.isUsingStackNavigationContext?Re.AvatarIconSize.Size44:Re.AvatarIconSize.Size40:Re.AvatarIconSize.Size24:this.state.isUsingStackNavigationContext?Re.AvatarIconSize.Size64:Re.AvatarIconSize.Size40,this._onSwiping=(e,t,s,i,o)=>{e&&(this._currentSwipeScrollTop=Math.max(this._currentScrollTop,0)),this.isComponentMounted()&&this.state.isSwiping!==e&&this.setState({isSwiping:e}),s&&this._currentScrollTop!==this._currentSwipeScrollTop&&this._scrollView&&this._scrollView.scrollToTop(!0,this._currentSwipeScrollTop),this._currentSwipableItemRef&&this._currentSwipableItemRef.itemId===i.itemId||o||(this._closeCurrentSwipeView(),t&&(this._currentSwipableItemRef=i))},this._handleMobileSearchButtonClick=e=>{const t=Ne.default.newCauseId();te.log(ne.LogTraceArea.ConversationsListItem,"ConversationListPanel._handleMobileSearchButtonClick, causeId: "+t),e&&e.stopPropagation(),te.track(new N.PressAction(N.PressScenario.SearchNavigation,ne.SearchPanelInitiator.RecentsListSearchButton)),W.default.navigateToSearch({searchOrigin:ne.SearchPanelInitiator.RecentsListSearchButton},t)},this._onFilterButtonRef=e=>{this._filterButton=e||void 0},this._onSearchInputButtonRef=e=>{this._searchInputButton=e||void 0},this._toggleBottomSheet=()=>{this.setState((e=>({isBottomSheetOpened:!e.isBottomSheetOpened})),(()=>{this.state.isBottomSheetOpened&&($e.default.triggerFeedback(),Je.dismissAll())}))},this._closeBottomSheet=()=>{this.state.isBottomSheetOpened&&this.setState({isBottomSheetOpened:!1})},this._onFilterButtonClick=e=>{te.track(new N.PressAction(N.PressScenario.SearchAccessory,ne.SearchAccessoryOrigin.ConversationList,"Filter")),this.state.enableConversationListFiltersInBottomSheet?this._toggleBottomSheet():B.default.showOptionsMenu((()=>this._filterButton),this._getRootViewId(),e)},this._onSyncContactsClick=()=>{Ge.ConversationsListHelper.syncContactsClickHandler(this._getRootViewId(),oe.DialogNavOrigin.ChatsEmptyState)}}_buildState(e,t){var s;const i=this._getRootViewId(),o=j.default.getS4LMessagingFeatures(),n=j.default.getOnboardingFeatures(),{enableRecentChatsSwipeActions:l,enableCollapsibleHeaderSearch:d,enableContentChannels:c,numberOfChannelsToShowEmptyState:h,enableUpsellCard:p}=j.default.getS4LUiFeatures(),g=_e.default.isChildOrMinor();t&&this._upsellCardStore.needsCycling()&&this._upsellCardStore.cycleContents();const S=c&&!g,_=this._headerUXStore.arePillsAvailable();(t||this.state.arePillsAvailable!==_)&&(this._store=_?(0,Ue.getConversationsListStore)():ve.default,this._contentChannelsFREStore=S?new m.FRESuggestionsStore:void 0);const f=$.default.isUsingStackNavigationContext(),y=f||e.useMobileView;let v=J.default.getActiveConversationId(i);if(!v){const e=J.default.getActiveContentChannelId();v=e?(0,u.addFakeContentChannelConversationPrefix)(e):void 0}const C=Q.default.getUserPreferencesLocal().recentsSortedBy||re.RecentsSortBy.Time,T=st._getRecentsViewModeType(e,y);let M=0;const b=this._getContext(),I=new Ge.ConversationsListHelper(i,!!y,b.isPresentedInDesktopLeftNav);let w;if(C===re.RecentsSortBy.Unread&&!y){const e=Ve.default.getConversationsWithUnreadCounts();v&&v in e&&(w=v)}const P=this.state?this.state.itemList.length:0,k=this.state&&this.state.listItemContainerScreenAvailableHeight?this.state.listItemContainerScreenAvailableHeight:void 0,A=this.state&&this.state.listItemContainerWidth?this.state.listItemContainerWidth:void 0,D=X.default.getMagicBotConvListUnpin(),R=S?this._filterStore.getFilterMode():"all",L=this._store.getShownConversations();"all"!==R&&"chats"!==R||((0,ye.maybeAddMagicBotToRecents)(L,o.enableMagicBot,D),(0,Oe.maybeAddMyBotToRecents)(L,o.enableMyBot));const F="channels"!==R?Ie.default.getBannerPlacement(we.BannerPlacement.ConversationList):null,N=g?[]:(0,u.mapToSuggestedChannelsListForConversationsList)(this._upsellStore.getItems(),v),O=R in p&&p[R]&&this._upsellCardStore.shouldShowCard()?this._upsellCardStore.getCardContents():[],U=(0,u.mapToUpsellCardListItemInfoForConversationsList)({activeConversationId:v},O),V="channels"===R?h:void 0,H=I.getConversationsItemsList(this._getConversationList(L,o.enableConvListInitialRenderLimit),N,U,e.topInset,F,e,t,P,w,C,k,A,v,this._getContext().language,o.enableMagicBot,D,o.enableMyBot,R),W=I.numberOfMeaningfulItemsCount(R,N,U),G=I.shouldContainEmptyStateItem(V,W),K=I.getConversationAdBanner(e.useMobileView,A),se=ee.default.isMobileScreenReaderEnabled();let ie=0;T===We.ConversationsListMode.AllConversations&&(M=I.getFavoritesCount(),ie=I.getShownConversationsCount()-M,te.log(ne.LogTraceArea.ConversationsListItem,"ConversationsListPanel._buildState user has "+M+"favorites conversationand shown non-favorites conversation"+ie));const oe=T!==We.ConversationsListMode.AllConversations&&I.isAnyConversationArchived(),ae=Z.default.isMobileScreenSize(i)&&!z.default.isTabletUI(),le=o.enableKeyboardNavigationBetweenConversations&&!b.isPresentedInSplitView,de=o.emoticonForEmptyChatsTab,ce=H.filter((e=>e.template===We.ConversationListItemNames.contentChannel)).length,ue={favoritesCount:M,displayEmptyStateScreen:G,isMobileScreenSize:ae,isMobileScreenReaderEnabled:se,isUsingStackNavigationOrMobileView:y,useIOSSearchStyles:x.default.shouldUseIOSSearchStyles(),safeAreaHorizontalInsets:I.getSafeAreaHorizontalInsets(!0),renderDesktopFilter:this._showDesktopFilter(R,y,ae,ce,e.useDesktopUtilityBar),viewType:T,hasArchivedConversations:oe,enableSwipeActions:l,enableKeyboardNavigationBetweenConversations:le,recentConversationsIncrementor:o.recentConversationsIncrementor,shownConvsCount:ie,showEmptyState:I.getShownConversationsCount()<2,itemList:H,keyboardHeight:q.default.getUpdateInfo().height,canLoadConversationsFromMemory:(0,je.default)().canPossiblyShowMoreRecentConversations(),nativeAdBanner:K,emptyStateDesignV2:n.conversationsListEmptyStateDesignV2,enableEmptyStateCTADesignV2:n.enableEmptyStateCTADesignV2,emptyStateBanner:n.features.emptyStateBanner,deviceSize:Z.default.deviceSize(i),screenWidth:Z.default.getWidth(this._getRootViewId()),isUsingStackNavigationContext:f&&!oe,isMobile:a.default.isMobile(),isChild:_e.default.isChild(),activeConversationId:v,enableCollapsibleHeaderSearch:d,emptyStateEmoticon:de,magicBotUnpin:D,conversationsListBanner:F,arePillsAvailable:_&&T===We.ConversationsListMode.AllConversations,selectedFilterPill:R,isBotItemReady:ze.default.isMyBotItemReady(),enableConversationListFiltersInBottomSheet:o.enableConversationListFiltersInBottomSheet,contextMenuItems:B.default.getMenuItems(void 0,o.enableConversationListFiltersInBottomSheet)},pe=j.default.getS4LMessagingFeatures().enableRecyclerListViewUseCases;ue.enabledRecyclerView=pe.indexOf("MainScreen.Tabs.Chat")>-1;const ge=v?He.default.getAllSiblingConversations(v):[];return ue.currentConversationIndex=le?r.findIndex(H,(e=>e.key===v||!!r.find(ge,(t=>t.id===e.key)))):void 0,ue.myBotConversationIndex=o.enableMyBot&&o.enableShowFloatTooltips?r.findIndex(H,(e=>e.key===Ee.getMyBotId())):0,t&&(ue.isSwiping=!1),(t||R!==this.state.selectedFilterPill)&&(T===We.ConversationsListMode.ArchivedConversations||this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()||(ue.vlvScrollY=0),null===(s=this._scrollView)||void 0===s||s.scrollToTop(!1)),ue.currentConversationIndex=le?r.findIndex(H,(e=>e.key===v||!!r.find(ge,(t=>t.id===e.key)))):void 0,t||this.state.trackedEmptyStateEvent||!ue.showEmptyState||T!==We.ConversationsListMode.AllConversations||Y.default.getSyncAddressBookPrivacySetting()||(ue.trackedEmptyStateEvent=!0,te.track(new E.DisplayedEmptyStateCta(E.EmptyStateOrigin.NoRecentConversations))),ue.shouldShowRewardsUpsell=he.default.getShouldShowRewardsUpsellView(),ue.shouldShowSayHiPopup=e.isActiveTab&&De.default.shouldShowSayHiPopup(),ue}componentDidMount(){if(super.componentDidMount(),this.setState({initialRenderComplete:!0}),Le.register(this._focusEvents(),this),G.default.conversationListPanelRendered(),this.state.enableKeyboardNavigationBetweenConversations&&(L.default.addHandler(ne.KeyboardShortcut.NavigateToPreviousConversation,this._onNavigateToPreviousConversation),L.default.addHandler(ne.KeyboardShortcut.NavigateToNextConversation,this._onNavigateToNextConversation)),this.state.enableSwipeActions){const e=this._getContext().componentVisibilityStatus;e&&(this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{e||this._closeCurrentSwipeView()})))}}_getConversationList(e,t){var s;return!(null===(s=this.state)||void 0===s?void 0:s.initialRenderComplete)&&t?e.slice(0,Math.min(e.length,5)):e}_maybeShowSayHiPopup(e){if(e===d.Types.AppActivationState.Active&&this.state.shouldShowSayHiPopup){const{skypeContactsLength:e,shortCircuitContactsLength:t}=De.default.getSayHiPeopleListLengthNoSubscribe();te.track(new O.SayHiPopupTelemetryEvent(O.SayHiPopupAction.ShouldShow,Se.default.isStartupNewUser(),e,t));const s="SayHiPopup",i=()=>{D.default.dismissModal(s,this._getRootViewId())};D.default.showModal((0,o.jsx)(Ae.SayHiPopup,{dialogId:s,handlePopupDissmiss:i}),s,{rootViewId:this._getRootViewId()})}}_focusEvents(){const e=[Le.FocusEvent.Recent];return this.state.isUsingStackNavigationOrMobileView||e.push(Le.FocusEvent.ConversationDeleted),this._isPresentedInTabletLeftNav()&&e.push(Le.FocusEvent.CancelMobileSearch),e}_clickOnConversation(e){const t=this._conversationItemRefs.ref(e);this._scrollView&&t&&this.state.viewType===We.ConversationsListMode.AllConversations&&(this._scrollView.scrollToItem(e,!1),this._debouncedClickOnConversationListItem(t))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);if(!(this.state.viewType===We.ConversationsListMode.ArchivedConversations)||this.state.isUsingStackNavigationOrMobileView||this.state.hasArchivedConversations||ve.default.setConversationsListMode(We.ConversationsListMode.AllConversations),!this.props.isActiveTab&&e.isActiveTab&&this._closeCurrentSwipeView(),this._loadMoreConversationsIfNeeded(),this.state.isBotItemReady){const e=this._conversationItemRefs.ref(Ee.getMyBotId());e&&this._headerPanelRef(e),ze.default.setShowMyBotFloatToolTip(!0),ze.default.setMyBotItemIndex(this.state.myBotConversationIndex)}this.props.isActiveTab&&this._maybeShowSayHiPopup(d.Types.AppActivationState.Active)}componentWillUnmount(){super.componentWillUnmount(),Le.unregister(this._focusEvents(),this),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),this.state.enableKeyboardNavigationBetweenConversations&&(L.default.removeHandler(ne.KeyboardShortcut.NavigateToPreviousConversation,this._onNavigateToPreviousConversation),L.default.removeHandler(ne.KeyboardShortcut.NavigateToNextConversation,this._onNavigateToNextConversation))}render(){const e=this.props.topInset?{top:this.props.topInset,left:0,bottom:0,right:0}:void 0,t=this._renderOptionalEmptyState(),s=t?void 0:this._renderOptionalHubDesktopPicker(),i=s?this._renderShadow():void 0,n=this.props.onScroll||!this.state.isUsingStackNavigationOrMobileView||this.state.enableSwipeActions?this._onScroll:this._updateScrollYValue;let r=(0,o.jsx)(l.VirtualListView,{ref:this._onScrollViewRef,itemList:this.state.itemList,renderItem:this._renderItem,scrollsToTop:this.props.isScrollToTopTarget,animateChanges:!this.props.disableChangeAnimation,skipRenderIfItemUnchanged:!this.state.showEmptyState,keyboardDismissMode:this._getContext().isPresentedInDesktopLeftNav?"on-drag":void 0,showOverflow:V.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets),scrollIndicatorInsets:e,horizontalPadding:this.state.safeAreaHorizontalInsets,onScroll:n,accessibilityLabel:se.getString("ConversationsListPanel.ConversationsList"),accessibilityTrait:d.Types.AccessibilityTrait.List,disableScrolling:this.state.isSwiping,onEndReached:this._isRecentsView()?this._onEndReached:void 0,endReachedThreshold:100,screenWidth:this.state.screenWidth,enabledRecyclerView:this.state.enabledRecyclerView,style:this.state.displayEmptyStateScreen?R.styles.panelWrapperStyle:void 0});i&&(r=(0,o.jsxs)(d.View,{style:k.default.flexOne,children:[r,i]}));const c=!a.BrowserEnvironment.isMobile()&&this.state.conversationsListBanner&&!this.state.shouldShowRewardsUpsell,u=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Ye.default,{ContentSlot:r,EmptySlot:t}),c?(0,Ce.getBannerComponent)(this.state.conversationsListBanner):null,this._renderAdBanner(this.state.nativeAdBanner),this.state.shouldShowRewardsUpsell?(0,o.jsx)(ue.default,{}):null]}),h=!this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav()?(0,o.jsx)(qe.default,{maxScrollY:50,scrollY:this.state.vlvScrollY,conversationListFilterMode:this.state.selectedFilterPill,filterButtonRef:this._onFilterButtonRef,onListFilterChange:this._onListFilterChange,onFilterButtonPress:this._onFilterButtonClick,onSearchPress:this._handleMobileSearchButtonClick}):null,p=[tt.panel,d.Styles.createViewStyle({backgroundColor:this._themeColors.surfacePrimary},!1)],g=this.state.enableConversationListFiltersInBottomSheet?(0,o.jsx)(Xe.default,{isBottomSheetOpen:this.state.isBottomSheetOpened,onItemSelected:this._handleBottomSheetItemSelected,onClose:this._closeBottomSheet,menuItems:this.state.contextMenuItems}):null;return(0,o.jsxs)(d.View,{style:p,onLayout:this._onLayoutVlvContainer,children:[s,h,u,g]})}focusFirst(){return!!this._scrollView&&(this._scrollView.scrollToTop(!1),this._scrollView.focus(!0),!0)}scrollToTop(){this._scrollView&&this._scrollView.scrollToTop(!0)}_getConversationItems(e){return r.filter(e,(e=>!r.includes(We.ConversationListItemNames,e.key)))}_getItemContainerHeightDisregardingKeyboard(e,t){return t.keyboardHeight<=0?e:t.listItemContainerScreenAvailableHeight?t.listItemContainerScreenAvailableHeight:t.listItemContainerHeight?t.listItemContainerHeight:e}_shouldComponentUpdate(e,t,s,i,o,n){return e?!F.default.comparator(s.itemList,o.itemList):super._shouldComponentUpdate(e,t,s,i,o,n)}_getEmptyStateListItemHeight(e,t,s){const i=t-r.sumBy(e,(e=>e.key===We.ConversationListItemNames.emptyState?0:e.height));return s<=i?i:s}_isRecentsView(){return this.props.viewType===We.ConversationsListMode.AllConversations||this.state.viewType===We.ConversationsListMode.AllConversations}_showDesktopFilter(e,t,s,i,o){return!(t||s&&!o||!("channels"!==e||i>0))}_renderOptionalHubDesktopPicker(){return this.state.renderDesktopFilter?(0,o.jsx)(I.default,{newActionPickerContext:this.props.newActionPickerContext}):void 0}_renderOptionalEmptyState(){if(this.state.displayEmptyStateScreen&&this.state.emptyStateEmoticon){const e="channels"===this.state.selectedFilterPill?"ConversationsListPanelEmptyState.EmptyChannelsHeaderAlternative":"ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative",t="channels"===this.state.selectedFilterPill?"ConversationsListPanelEmptyState.EmptyChannelsText":"ConversationsListPanelEmptyState.EmptyChatsText";return(0,o.jsx)(C.default,{emoticon:this.state.emptyStateEmoticon,topSlot:(0,o.jsx)(T.default,{headerText:se.getString(e),bodyText:this._getEmptyStateTextWithIcon(t,le.SkypeIcon.Search,this._themeColors.secondaryTextColor,le.IconSize.size18),useThemeHeaderColor:!0})},"noChatsItem")}}_renderShadow(){return(0,o.jsx)(w.default,{opacityStyle:this._shadowOpacityStyle})}_getEmptyStateContainerStyles(e){const t=[tt.emptyStateContainer];if(this.state.listItemContainerHeight&&this.state.emptyStateHeight){const s=1===e.height?this._getEmptyStateListItemHeight(this.state.itemList,this.state.listItemContainerHeight,this.state.emptyStateHeight):e.height;t.push(d.Styles.createViewStyle({height:s},!1))}else this.state.emptyListAndIllustration||t.push(d.Styles.createViewStyle({opacity:0},!1));return t.push(tt.emptyStateContainerItemsAtTop),this.state.isMobileScreenSize||t.push(tt.emptyStateContainerTopPadding),t}_renderEmptyStateListItem(e){const t=this._getEmptyStateContainerStyles(e);let s;this._shouldRenderEmptyStateImage(e)&&(s=(0,o.jsx)(d.Image,{style:tt.emptyStateImageV1,source:n.Collection.ONBOARDING_CHATS_EMPTYSTATE_V1}));let i=se.getString("ConversationsListPanelEmptyState.NotSyncedHeaderAlternative"),r=se.getString("ConversationsListPanelEmptyState.NotSyncedFirstTextAlternative");const a=se.getString("ConversationsListPanelEmptyState.NotSyncedSecondTextAlternative"),l=se.getString("ConversationsListPanelEmptyState.SyncAddressBookButtonAlternative");let c;if(e.hideSyncAddressBookCta){const e=void 0;i=se.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative"),r=se.getString("ConversationsListPanelEmptyState.SearchCTATextAlternative"),c=(0,o.jsxs)(d.View,{style:tt.emptyStateTextsContainer,children:[(0,o.jsxs)(d.View,{style:tt.emptyStateTextWithIconContainerV2,children:[(0,o.jsx)(v.default,{icon:le.SkypeIcon.Search,size:le.IconSize.size16,color:this._themeColors.textSecondary,style:tt.emptyStateTextIcon},"searchIcon"),(0,o.jsx)(b.BodyText,{style:tt.emptyStateTextWithIcon,textThemeColor:b.TextThemeColor.Secondary,children:r})]}),e]})}else if(this.state.isChild)c=null;else{if(this.state.enableEmptyStateCTADesignV2)return this._getEmptyStateCTADesignV2(t);c=(0,o.jsxs)(d.View,{children:[(0,o.jsx)(b.BodyText,{style:tt.emptyStateText,textThemeColor:b.TextThemeColor.Secondary,children:r}),(0,o.jsx)(b.BodyText,{style:tt.emptyStateTextSecondLine,textThemeColor:b.TextThemeColor.Secondary,children:a}),(0,o.jsx)(M.default,{style:tt.syncContactsButton,buttonSize:ie.SXButtonSize.Medium,onPress:this._onSyncContactsClick,title:l,allowTextWrap:!0})]})}return(0,o.jsxs)(d.View,{style:t,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState,children:[s,(0,o.jsx)(_.default,{headerText:i}),c]})}_getEmptyStateCTADesignV2(e){const t=se.getString("ConversationsListPanelEmptyState.SyncAddressBookButtonAlternative"),s=this.state.deviceSize===Z.DeviceSize.Small,i=[tt.syncContactsButton,tt.syncContactsButtonV2,s?tt.syncContactsButtonV2Small:void 0],r=[tt.emptyStateSyncContactImage,s?tt.emptyStateSyncContactImageSmall:void 0];return(0,o.jsxs)(d.View,{style:e,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState,children:[(0,o.jsx)(d.Image,{style:r,source:n.Collection.ONBOARDING_SYNC_CONTACTS_V2}),(0,o.jsx)(_.default,{headerText:se.getString("ConversationsListPanelEmptyState.EmptyChatsHeaderAlternative")}),(0,o.jsx)(b.BodyText,{style:[tt.emptyStateTextSecondLine,tt.emptyStateTextSecondLineV2],textThemeColor:b.TextThemeColor.Secondary,children:se.getString("ConversationsListPanelEmptyState.NotSyncedSecondTextAlternative")}),(0,o.jsx)(M.default,{style:i,textStyleOverride:[tt.textStyleOverride],buttonSize:ie.SXButtonSize.Medium,onPress:this._onSyncContactsClick,title:t,accessibilityLabel:t,allowTextWrap:!1,icon:void 0,iconSize:le.IconSize.size18,iconPositon:ie.SXButtonIconPosition.End}),(0,o.jsx)(M.default,{onPress:this._onPressLearnMore,buttonStyle:ie.SXButtonStyle.Custom,buttonConfig:{textColor:ae.Color.blue,backgroundColor:ae.Color.transparent},textStyleOverride:[tt.learnMoreButton],buttonSize:ie.SXButtonSize.Small,title:se.getString("UserSettingsPanel.HotkeysLearnMoreLink")})]})}_renderMobileEmptyStateListItemV2(e){const t=this._getEmptyStateContainerStyles(e);let s,i,r,a=this.state.emptyStateDesignV2.backgroundVariant;switch(this.state.isChild&&(a=fe.ChatsEmptyStateBackground.MeetNow),a){case fe.ChatsEmptyStateBackground.MeetNow:s=n.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_MEETNOW,i="ConversationsListPanelEmptyState.EmptyChatsCTATextMeetNow",r=le.SkypeIcon.MeetNow;break;case fe.ChatsEmptyStateBackground.Search:s=n.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_SEARCH,i="ConversationsListPanelEmptyState.EmptyChatsCTATextSearch",r=le.SkypeIcon.Search;break;case fe.ChatsEmptyStateBackground.Chat:default:s=n.Collection.ONBOARDING_CHATS_EMPTYSTATE_V2_CHAT,i="ConversationsListPanelEmptyState.EmptyChatsCTATextChat",r=le.SkypeIcon.Topic}const l=this._getEmptyStateTextWithIcon(i,r,this._themeColors.primaryTextColor,le.IconSize.size18),c=(0,o.jsx)(b.BodyText,{style:tt.emptyStateText,textThemeColor:b.TextThemeColor.Primary,children:l});return(0,o.jsxs)(d.View,{style:t,ignorePointerEvents:!0,onLayout:this._onLayoutEmptyState,children:[(0,o.jsx)(d.Image,{style:tt.emptyStateImageV2,source:s}),(0,o.jsx)(d.View,{style:tt.emptyStateTextsContainer,children:(0,o.jsx)(d.View,{style:tt.emptyStateTextWithIconContainerV2,children:c})})]})}_getEmptyStateTextWithIcon(e,t,s,i){const n=R.styles.bodyIconStyle;return se.getParts(e,{icon:(0,o.jsx)(d.Text,{children:(0,o.jsx)(v.default,{icon:t,size:i,color:s,style:n})},"searchIcon")})}_renderContactsCta(e,t,s){return(0,o.jsxs)(d.View,{style:tt.emptyStateTextWithIconContainer,children:[(0,o.jsx)(v.default,{icon:le.SkypeIcon.Contact,size:e,color:t,style:s},"contactsIcon"),(0,o.jsx)(b.BodyText,{style:tt.emptyStateTextWithIcon,textThemeColor:b.TextThemeColor.Secondary,children:se.getString("ConversationsListPanelEmptyState.ContactsCTATextAlternative")})]})}_constructFilterButtonStyles(e){var t;const s=[];return s.push(...this.state.isMobile?[tt.filterButtonContainerModernized,this._themeStyles.searchModernizeColorStyle,this._useAccessibleTheme()?this._themeStyles.searchBorderModernizeColorStyle:void 0]:[tt.filterButtonContainer]),(null===(t=e.safeAreaHorizontalInsets)||void 0===t?void 0:t.right)&&s.push(d.Styles.createViewStyle({right:e.safeAreaHorizontalInsets.right},!1)),s.push(d.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceOnAccent},!1)),s}_constructContainerStyles(e){const t=[k.default.flexRow];return e.safeAreaHorizontalInsets&&t.push(d.Styles.createViewStyle({marginLeft:-1*e.safeAreaHorizontalInsets.left,marginRight:-1*e.safeAreaHorizontalInsets.right},!1)),t.push(d.Styles.createViewStyle({paddingBottom:8,backgroundColor:this._getContext().themeColors.surfaceAccent},!1)),t}_pauseWhenNotVisible(){return $.default.isUsingStackNavigationContextNoSubscription()}static _getRecentsViewModeType(e,t){let s=We.ConversationsListMode.AllConversations;return t?e.viewType&&(s=e.viewType):s=ve.default.getConversationsListMode(),s}_loadMoreConversationsIfNeeded(){if(this.state.canLoadConversationsFromMemory&&!this.state.isUsingStackNavigationOrMobileView&&this.state.listItemContainerHeight&&this.state.itemList){const e=new Ge.ConversationsListHelper(this._getRootViewId(),!1,this._isPresentedInDesktopLeftNav()).getNumberOfConversationsToFit(this.state.listItemContainerHeight),t=this._getConversationItems(this.state.itemList).length,s=e-t;e>=t&&(te.log(ne.LogTraceArea.ConversationsListItem,"LoadMoreConversations Increasing the limit to show more conversations, screen can fit "+e+", conversations shown: ",t),this._store.loadMoreConversations(s))}}}t.default=st},981710:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importDefault(s(815063)),r=s(217041),a=i.__importDefault(s(150343)),l=s(385855),d=i.__importDefault(s(247286)),c=i.__importDefault(s(659494)),u=i.__importDefault(s(880323)),h=i.__importDefault(s(606995)),p=s(297886);function g({mobileUX:e,scrollY:t,maxScrollY:s=0,conversationListFilterMode:i,filterButtonRef:n,onListFilterChange:r,onFilterButtonPress:a,onSearchPress:d,enableRecentsFilterPills:g}){const m=g?(0,o.jsxs)(u.default,{top:l.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT,maxScrollY:s,scrollY:t,children:[(0,o.jsx)(h.default,{ref:n,selectedFilter:i,onFilerMenuPress:a,onChange:r}),"channels"===i?(0,o.jsx)(p.StoreEntryPoint,{}):null]}):null;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.default,{ref:n,scrollY:t,mobileUX:e,maxScrollY:s,onSearchPress:d,onFilterButtonPress:a,enableRecentsFilterPills:g}),m]})}class m extends r.ComponentBase{_buildState(){const{enableContentChannels:e}=a.default.getS4LUiFeatures(),t=d.default.isChildOrMinor();return{enableRecentsFilterPills:e&&!t,mobileUX:n.default.isMobile()}}render(){return(0,o.jsx)(g,{filterButtonRef:this.props.filterButtonRef,mobileUX:this.state.mobileUX,scrollY:this.props.scrollY,maxScrollY:this.props.maxScrollY,enableRecentsFilterPills:this.state.enableRecentsFilterPills,conversationListFilterMode:this.props.conversationListFilterMode,onListFilterChange:this.props.onListFilterChange,onFilterButtonPress:this.props.onFilterButtonPress,onSearchPress:this.props.onSearchPress})}}t.default=m},880323:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({top:e,scrollY:t,maxScrollY:s,children:n}){return void 0!==t?(0,i.jsx)(o.Sliding,{value:t,valueFrom:0,valueTo:s,minSlideValue:e,maxSlideValue:0,children:n}):(0,i.jsx)(i.Fragment,{children:n})};const i=s(785893),o=s(887480)},479856:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(958868)),a=s(26703),l=(i.__importStar(s(704704)),s(262725)),d=i.__importDefault(s(942724)),c=(0,a.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"row",alignItems:"center",paddingTop:6,paddingBottom:6,paddingHorizontal:16}),containerPaddingModernizeMobile:()=>n.Styles.createViewStyle({paddingHorizontal:16,paddingTop:8,paddingBottom:8}),containerSmall:()=>n.Styles.createViewStyle({paddingTop:10}),sectionTitleText:()=>n.Styles.createTextStyle({flex:-1,flexDirection:"row"})});class u extends r.default{_buildState(e,t){return{isUsingStackNavigationContext:d.default.isUsingStackNavigationContext()}}render(){const e=!1,t=n.Types.ImportantForAccessibility.NoHideDescendants;let s;const i=[c.container];this._isPresentedInDesktopLeftNav()&&i.push(c.containerSmall),this.state.isUsingStackNavigationContext&&i.push(c.containerPaddingModernizeMobile),this.props.style&&i.push(this.props.style),i.push(n.Styles.createTextStyle({color:this.context.themeColors.textSecondary},!1));const r={style:c.sectionTitleText,numberOfLines:1,accessibilityHidden:!0,useMobileUI:this.state.isUsingStackNavigationContext},a=this.props.title,d=(0,o.jsx)(l.Subtitle,Object.assign({},r,{children:a}));return(0,o.jsx)(n.View,{style:i,importantForAccessibility:t,accessibilityTraits:undefined,accessibilityLabel:s,children:d})}}t.default=u},606995:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(785893),o=s(344175),n=s(667294),r=s(912838),a=s(873494),l=s(704704),d=(0,n.forwardRef)((({selectedFilter:e,onChange:t,onFilerMenuPress:s},n)=>{const d=(0,r.useRecentFilterPills)();return(0,i.jsxs)(o.Row,{paddingX:"size200",paddingTop:"size80",paddingBottom:"size40",height:a.FILTERS_HEIGHT,space:"size80",justifyContent:"space-between",flexWrap:"nowrap",backgroundColor:"surfacePrimary",children:[(0,i.jsx)(o.SegmentedControl,{variant:"segmented",onSelectionChange:t,items:d,selectedId:e}),(0,i.jsx)(o.IconButton,{ref:n,icon:"filter",accessibilityLabel:(0,l.getString)("MobileRecentsFilter.ManageChats"),onPress:s})]})}));d.displayName="Filters",t.default=d},112055:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=s(537180),l=s(815146),d=s(964414),c=i.__importStar(s(704704)),u=i.__importDefault(s(43823)),h=i.__importDefault(s(117475)),p=i.__importDefault(s(20758)),g=({isBottomSheetOpen:e,menuItems:t,onItemSelected:s,onClose:i})=>{const g=(0,r.useRef)(null),m=(0,r.useRef)(null),S=(0,r.useMemo)((()=>["50%","100%"]),[]),[_,f]=(0,r.useState)(S);(0,r.useEffect)((()=>{var t,s;e?null===(t=g.current)||void 0===t||t.present():null===(s=g.current)||void 0===s||s.dismiss()}),[e]);const{titleStyle:y}=(0,d.useSkypeStyles)((({themeColors:{textPrimary:e}})=>({titleStyle:{fontSize:p.default.fontSize.size17,fontFamily:p.default.fontFamily.uidDisplayRegular,lineHeight:22,color:e,marginTop:10}})),[]);return(0,o.jsx)(n.BottomSheet,{ref:g,snapPoints:_,onDismiss:i,children:(0,o.jsx)(n.BottomSheetScrollView,{children:(0,o.jsxs)(n.Box,{paddingX:"size160",marginBottom:10,onLayout:e=>{var t,s;const i=null===(s=null===(t=e.nativeEvent)||void 0===t?void 0:t.layout)||void 0===s?void 0:s.height;i&&"number"==typeof i&&i>0&&i!==m.current&&(m.current=i,f([i+24+h.default.bottomSafeAreaInsetNoSubscription()]))},children:[(0,o.jsx)(n.Box,{flex:"1",alignItems:"center",paddingY:"size160",children:(0,o.jsx)(a.Text,{style:y,children:c.getString("MobileRecentsFilter.ManageChats")})}),(0,o.jsx)(u.default,{menuItems:t,onItemSelected:s,origin:l.SearchAccessoryOrigin.ConversationList})]})})})};g.displayName="FiltersContextMenu",t.default=(0,r.memo)(g)},659494:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(516778),r=s(667294),a=i.__importDefault(s(453761)),l=s(206315),d=s(964414),c=s(704704),u=s(641400),h=s(927164),p=(0,r.forwardRef)((({mobileUX:e,scrollY:t,maxScrollY:s,onSearchPress:i,onFilterButtonPress:r,enableRecentsFilterPills:p},g)=>{const{themeColors:{iconSecondary:m}}=(0,l.useSkypeTheme)(),{iconStyle:S}=(0,d.useRXStyles)((()=>({iconStyle:n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",width:e?u.IconSize.size32:u.IconSize.default,height:e?void 0:u.IconSize.default,flex:e?1:void 0})})),[e]),_=p?void 0:(0,o.jsx)(a.default,{ref:g,size:e?u.IconSize.size20:u.IconSize.size16,style:S,onPress:r,color:m,hoverColor:m,icon:e?u.SkypeIcon.FilterMenu:u.SkypeIcon.Filter,title:(0,c.getString)("MobileRecentsFilter.ManageChats"),autoFocus:!0});return void 0!==t?(0,o.jsx)(h.CollapsibleHeaderSearch,{value:t,valueFrom:0,valueTo:s,placeholder:(0,c.getString)(e?"SearchInputControl.PlaceHolderTextShort":"ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),onPress:i,accessory:_}):(0,o.jsx)(h.HeaderSearch,{accessory:_,placeholder:(0,c.getString)(e?"SearchInputControl.PlaceHolderTextShort":"ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),onPress:i})}));t.default=p},873494:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.STORE_ENTRY_TOP=t.FILTERS_HEIGHT=t.STORE_ENTRY_HEIGHT=void 0,t.STORE_ENTRY_HEIGHT=52,t.FILTERS_HEIGHT=44,t.STORE_ENTRY_TOP=t.FILTERS_HEIGHT+8},825502:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=(i.__importStar(s(496486)),i.__importStar(s(516778))),r=i.__importStar(s(397691)),a=i.__importStar(s(44717)),l=i.__importDefault(s(399599)),d=i.__importDefault(s(615364)),c=i.__importDefault(s(389659)),u=i.__importDefault(s(601976)),h=i.__importStar(s(242561)),p=s(815146),g=i.__importDefault(s(557153)),m=i.__importStar(s(85385)),S=s(26703),_=i.__importStar(s(704704)),f=i.__importStar(s(435395)),y=i.__importDefault(s(998929)),v=i.__importDefault(s(341126)),C=i.__importStar(s(954225)),T=i.__importDefault(s(363091)),M=i.__importDefault(s(740794)),b=i.__importStar(s(437782)),I=i.__importDefault(s(655192)),w=s(16549),P=i.__importDefault(s(20758)),k=s(262725),A=i.__importDefault(s(497910)),x=i.__importDefault(s(601274)),D=s(403396),R=s(596648),L=i.__importDefault(s(760989)),B=i.__importDefault(s(179075)),F=i.__importDefault(s(498801)),N=s(742403),E=s(123117),O=C.messageTextLineHeight,U=(0,S.lazyProperties)({card:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",paddingVertical:8}),cardHorizontalPadding:()=>n.Styles.createViewStyle({paddingHorizontal:8}),iconAndContentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:4}),cardContentContainer:()=>n.Styles.createViewStyle({marginBottom:2}),cardContentContainerWeb:()=>n.Styles.createViewStyle({maxHeight:3*O}),cardContentText:()=>n.Styles.createTextStyle({lineHeight:O}),userIcon:()=>n.Styles.createViewStyle({flexDirection:"row",marginRight:12,alignSelf:"flex-start"}),contentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),title:()=>n.Styles.createTextStyle({flexShrink:1,alignItems:"center",flexDirection:"row"}),footer:()=>n.Styles.createTextStyle({flexShrink:1})});class V extends A.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0},this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHovering:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHovering:!1})},this._onPress=()=>{if(this.props.searchResult.ConversationId){const e=this.props.searchResult.ConversationId,t=this.props.searchResult.MessageId,s=this.props.searchResult.ServerMessageId?Number(this.props.searchResult.ServerMessageId):void 0;let i;i=t?r.fromThenable(E.MessagesRepository.getMessageByCuid(e,t)).then((e=>e?e.createdTime:r.Rejected(void 0))).catch((i=>(m.log(p.LogTraceArea.Search,"ContentSearchMessageResult could not fetch message conversationId="+b.mriOrId(e)+" cuid="+t+" id="+s+(i?" err="+I.default.errorAsString(i):"")),s))):r.Resolved(s),i.then((s=>{this._navigateToConversation(s,e,t)})),this.props.onSearchMessagePress&&this.props.onSearchMessagePress(this,t)}}}_buildState(e,t){const s=(0,d.default)().getConversation(e.searchResult.ConversationId),i=s&&(!s.isOneOnOne()||T.default.isMyMri(e.searchResult.From)),o=B.default.getAgentDescriptionForMri(e.searchResult.From).isTrusted;return{isHovering:!1,creatorName:u.default.getDisplayName(e.searchResult.From),formattedTimestamp:this._getElapsedTimeAndUpdateTimer(e),conversationName:i?u.default.getDisplayName(e.searchResult.ConversationId):"",isTrustedAgent:o,isNewsChannel:(0,N.isContentChannel)(s)}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}render(){let e="";const t=this.props.searchResult,s=t.From;a.isMri(s)&&(e=this.state.creatorName);const i=[P.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,U.cardContentText,f.getItemSubtitleTextStyle()],r=f.getItemTitleTextStyle(!1,!1),d=this.state.isTrustedAgent||this.state.isNewsChannel?this.props.searchResult.From:void 0,c=e?(0,o.jsxs)(n.View,{style:U.title,children:[(0,o.jsx)(k.RowTitle,{style:r,numberOfLines:1,children:e.split("\n",1)}),d?(0,o.jsx)(F.default,{botMri:d}):void 0]}):void 0,u=Object.assign(Object.assign({},h.ProcessingDefaults.Preview),{atMentions:h.ProcessingLevel.Full}),p=[i,P.default.font.uiDisplayBold],g={processing:u,renderMedia:!1,mediaPlaceholderIconColor:w.Color.gray200,allowLargeEmoticons:!1,numberOfLines:3,textOverrideStyle:i,atMentionStyle:p,atMentionMeOverrideStyle:p,renderSimpleAtMentions:!0,isGlobalSearch:!0},m=l.default.simulateFullMessage(t,"");if(!m)return null;const S=[U.cardContentContainer];S.push(U.cardContentContainerWeb);const _=[U.card,U.cardHorizontalPadding],C=!(!this.state.isHovering&&!this.props.isPseudoFocused);(this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())&&_.push(f.getListItemBackgroundStyle(!1,C,this._themeColors));const T=this.state.formattedTimestamp.value+" "+this.state.conversationName,M=this.state.formattedTimestamp.valueAccessible+" "+this.state.conversationName,b=(0,o.jsxs)(n.View,{style:U.iconAndContentContainer,children:[(0,o.jsx)(n.View,{style:U.userIcon,children:(0,o.jsx)(D.UserIcon,{size:R.UserIconSize.Size40,userMri:s})}),(0,o.jsxs)(n.View,{style:U.contentContainer,children:[c,(0,o.jsx)(n.View,{style:S,children:(0,o.jsx)(v.default,{message:m,rawSearchQuery:this.props.rawSearchQuery,options:g})}),(0,o.jsx)(n.View,{accessibilityLabel:M,children:(0,o.jsx)(k.Caption,{style:U.footer,numberOfLines:1,children:T.split("\n",1)})})]})]}),I={ref:this._onContainerRef};return(0,o.jsx)(y.default.View,Object.assign({},I,{style:_,onPress:this._onPress,onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,importantForAccessibility:undefined,accessibilityTraits:[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.MenuItem],children:b}))}_getElapsedTimeAndUpdateTimer(e){const t=new Date(e.searchResult.CreationDate).valueOf(),s=Date.now()-t;if(s>=36e5){const e=c.default.getDisplayDateTimeString(t);return{value:e,valueAccessible:e}}{const e=6e4-Math.floor(s%6e4);if(x.default.setTimeout((()=>{this._updateTimeState()}),e),s>=6e4){const e=Math.floor(s/6e4).toString();return{value:_.getString("SearchResultsList.ElapsedTimeMinutes",{minutes:e}),valueAccessible:_.getString("SearchResultsList.ElapsedTimeMinutesAccessible",{minutes:e})}}return{value:_.getString("SearchResultsList.ElapsedTimeOneMinute"),valueAccessible:_.getString("SearchResultsList.ElapsedTimeOneMinuteAccessible")}}}_updateTimeState(){this.isComponentMounted()&&this.setState({formattedTimestamp:this._getElapsedTimeAndUpdateTimer(this.props)})}_navigateToConversation(e,t,s){const i=L.default.newCauseId();this.props.rawSearchQuery&&g.default.setSearchQuery({query:this.props.rawSearchQuery,conversationId:t,messageId:s,sessionId:i}),M.default.navigateToConversationFromSearch({convId:t,scrollToTimestamp:e,causeId:i})}}t.default=V},912838:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useRecentFilterPills=function(){const{language:e}=(0,o.useLocalization)();return(0,i.useMemo)((()=>[{id:"all",label:(0,n.getString)("ConversationsListPanel.ViewModeAll")},{id:"chats",label:(0,n.getString)("ConversationsListPanel.ViewModeChats")},{id:"channels",label:(0,n.getString)("ConversationsListPanel.ViewModeChannels")}]),[e])};const i=s(667294),o=s(330380),n=s(704704)},341126:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(496486),r=i.__importStar(s(516778)),a=i.__importDefault(s(179075)),l=i.__importDefault(s(150343)),d=i.__importDefault(s(262382)),c=i.__importDefault(s(804144)),u=i.__importDefault(s(404547)),h=i.__importDefault(s(304623)),p=i.__importStar(s(971988)),g=s(627414),m=i.__importStar(s(44717)),S=i.__importDefault(s(555436)),_=i.__importStar(s(559210)),f=i.__importStar(s(605507)),y=i.__importDefault(s(958868)),v=i.__importDefault(s(615364)),C=i.__importStar(s(459287)),T=i.__importStar(s(463519)),M=i.__importDefault(s(601976)),b=i.__importStar(s(242561)),I=s(815146),w=s(77395),P=i.__importStar(s(85385)),k=s(26703),A=i.__importStar(s(50350)),x=i.__importStar(s(704704)),D=s(606933),R=i.__importStar(s(606933)),L=i.__importDefault(s(682432)),B=s(675862),F=i.__importDefault(s(363091)),N=i.__importDefault(s(740794)),E=i.__importDefault(s(863132)),O=i.__importDefault(s(960282)),U=i.__importStar(s(437782)),V=s(224802),H=s(36381),j=i.__importDefault(s(994962)),z=s(332975),W=i.__importDefault(s(655192)),G=i.__importDefault(s(117083)),K=s(16549),q=i.__importDefault(s(20758)),Q=i.__importDefault(s(48076)),X=i.__importStar(s(771369)),$=s(151619),J=i.__importDefault(s(220534)),Y=i.__importDefault(s(760989)),Z=i.__importDefault(s(453761)),ee=s(641400),te=i.__importDefault(s(827361)),se=s(786531),ie=(0,k.lazyProperties)({messageContentsViewContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),atMentionMe:()=>r.Styles.createTextStyle({font:q.default.font.uiDisplaySemibold,color:K.Color.orange}),mentionIconStyle:()=>r.Styles.createTextStyle({color:K.Color.whiteOverlay50,backgroundColor:K.Color.transparent,marginTop:-3,marginBottom:4}),inlineViewWrapper:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",flex:1}),reportedMessageStyle:()=>r.Styles.createTextStyle({fontStyle:"italic"}),translationContainer:()=>r.Styles.createViewStyle({flexDirection:"column"}),translateLinkStyleRight:()=>r.Styles.createTextStyle({textAlign:"right"}),translateLinkStyleLeft:()=>r.Styles.createTextStyle({textAlign:"left"}),translateLinkHoveredStyle:()=>r.Styles.createTextStyle({opacity:1}),translateIcon:()=>r.Styles.createViewStyle({paddingHorizontal:10,paddingVertical:6,borderRadius:8,width:40,height:32,marginLeft:10}),translateIconWrapper:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"nowrap",alignContent:"stretch"})});class oe extends y.default{constructor(){super(...arguments),this._onToggleTranslationPressed=()=>{this.props.options&&this.props.options.onToggleTranslation&&this.props.options.onToggleTranslation()},this._onToggleTranslationOptionsPressed=()=>{var e,t,s,i;if(this.props.options&&this.props.options.onToggleTranslateOptions){const o=null===(e=this.state.translateMetadata)||void 0===e?void 0:e.oloc,n=null===(i=null===(s=null===(t=this.state.translateMetadata)||void 0===t?void 0:t.translations)||void 0===s?void 0:s[0])||void 0===i?void 0:i.loc;this.props.options.onToggleTranslateOptions(this._translateOptionsButtonRef,o,n)}},this._getTranslateButtonRef=e=>{this._translateOptionsButtonRef=e||void 0}}_buildState(e,t){const s=l.default.getS4LCMCFeatures(),{enableReplyMessageUnifiedUI:i}=l.default.getS4LMessagingFeatures(),o={cmcFeatures:s,isOwnMessage:F.default.isMyMri(e.message.creator),enableMessageTranslation:s.enableMessageTranslation,enableReplyMessageUnifiedUI:i};t&&(o.onFollowQuoteLinkDefault=(t,s,i)=>{if(t.preventDefault(),h.default.getConversationMetaFromMemoryCache(s)){const t=Y.default.newCauseId();P.log(I.LogTraceArea.MessageContent,"MessageContent.onFollowQuoteLinkDefault, causeId: "+t),P.track(new se.MessageContentClicked(e.message,!0)),N.default.navigateToConversation({convId:s,scrollToTimestamp:i,forceRefreshFocus:!0,origin:I.NavigationConversationOrigin.QuoteLink,causeId:t})}},o.onSwiftReplyActionLinkDefault=(t,s,i=[])=>{t.preventDefault();const o=C.createSwiftResponseMessageInfo(e.message.conversationId,I.PostSource.SwiftReply,s,i,e.message.creator);E.default.postMessage(o)},o.onSwiftSkypeUriActionLinkDefault=(t,s,i)=>{t.preventDefault();const o=Y.default.newCauseId();P.log(I.LogTraceArea.MessageContent,"MessageContent.onSwiftSkypeUriActionLinkDefault, causeId: "+o);const n=s.substring(6),r=n.split("?")[0];if("add_to_this_conversation"===n.split("?")[1]){const t=(0,v.default)().getConversation(e.message.conversationId);if(t&&t.isThread()){const s=(0,B.isModerated)(t);u.default.serviceAddMemberToThread(e.message.conversationId,r,g.AddMemberToThreadSource.SwiftCard,!s).fail((()=>{P.log(I.LogTraceArea.MessageContent,"Could not add "+U.mriOrId(r)+" to "+U.mriOrId(e.message.conversationId)+": Chat service request failed.")}))}else if(S.default.isContact(r))h.default.ensureConversationLoadedOrFaked(r).then((()=>{N.default.navigateToConversation({convId:r,origin:I.NavigationConversationOrigin.SwiftCardLink,causeId:o})}));else{const e=a.default.getAgentDescriptionForMri(r);d.default.addAgentAsContact(e.agentId).then((()=>{h.default.ensureConversationLoadedOrFaked(r).then((()=>{N.default.navigateToConversation({convId:r,isNewConversation:!0,origin:I.NavigationConversationOrigin.SwiftCardLink,causeId:o})}))}),(()=>{P.log(I.LogTraceArea.MessageContent,"Failed to add agent from the swift card")}))}}else P.log(I.LogTraceArea.MessageContent,"Unsupported skype uri query")},o.onOAuthActionLinkDefault=(t,s,i)=>{t.preventDefault();const o=Y.default.newCauseId();if(P.log(I.LogTraceArea.MessageContent,"MessageContent.onOAuthActionLinkDefault, causeId: "+o),s&&i){const t=s+"&userid="+encodeURIComponent(F.default.getSkypeId())+"&threadid="+encodeURIComponent(e.message.conversationId);J.default.isUrlValid(t)&&A.openUrlWithParams({origin:I.BrowserOrigin.AuthActionLink,url:t,options:{onNavigationStateChange:e=>{e.url.startsWith(i)&&N.default.closeInAppBrowser(o,this._getContext())}},rootViewId:this._getRootViewId()})}},o.onCallInviteAccepted=t=>{j.default.acceptInvitation(t),P.track(new V.ScheduledCallRSVPEvent(H.ScheduleCallRSVPEntryPoint.MessageStream,H.ScheduledCallInvitationStatus.Accepted,e.message.conversationId,t))},o.onCallInviteDeclined=t=>{j.default.declineInvitation(t),P.track(new V.ScheduledCallRSVPEvent(H.ScheduleCallRSVPEntryPoint.MessageStream,H.ScheduledCallInvitationStatus.Declined,e.message.conversationId,t))});const r=(0,n.cloneDeep)(e.options||{});let y;if(r.message=e.message,o.isOwnMessage||S.default.isConversationAccepted(e.message.conversationId)||(r.blurMedia=!0,r.processing=r.processing||{},r.processing.links=b.ProcessingLevel.Stripped),r.onFollowQuoteLink||(r.onFollowQuoteLink=o.onFollowQuoteLinkDefault||this.state.onFollowQuoteLinkDefault),r.onSwiftReplyActionLink||(r.onSwiftReplyActionLink=o.onSwiftReplyActionLinkDefault||this.state.onSwiftReplyActionLinkDefault),r.onSwiftSkypeUriActionLink||(r.onSwiftSkypeUriActionLink=o.onSwiftSkypeUriActionLinkDefault||this.state.onSwiftSkypeUriActionLinkDefault),r.atMentionMeOverrideStyle||(r.atMentionMeOverrideStyle=ie.atMentionMe),e.message.properties&&e.message.properties[p.MessageProperties.Prototype]&&(r.swiftCardState=W.default.parseJsonWithDefault(e.message.properties[p.MessageProperties.Prototype],{}),r.swiftCardState.disableActions=e.disableActions),r.swiftCardState||(r.swiftCardState={disableActions:e.disableActions}),r.isMobileScreenSize||(r.isMobileScreenSize=O.default.isMobileScreenSize(this._getRootViewId())),r.onOAuthActionLink||(r.onOAuthActionLink=o.onOAuthActionLinkDefault||this.state.onOAuthActionLinkDefault),r.onCallInviteAccepted||(r.onCallInviteAccepted=o.onCallInviteAccepted||this.state.onCallInviteAccepted),r.onCallInviteDeclined||(r.onCallInviteDeclined=o.onCallInviteDeclined||this.state.onCallInviteDeclined),e.wrapInQuote){const t=M.default.getDisplayName(e.message.creator,!0),s=_.quoteMessage(e.message,t);y=T.Parser.root([s])}else y=e.preDecodedMessage||T.decode(e.message),o.enableMessageTranslation&&r.hasTranslation&&(y=this._maybeTranslateQuotes(e,y,r));r.textOnlyForEmoticons=y.getNumberOfEmoticons()>l.default.dangerouslyGetS4LMessagingFeatures().maxNumberEmoticonsPerMessage,r.onPressSuggestedTextHighlight=t=>{var s;const i=null===(s=r.suggestedTextHighlights)||void 0===s?void 0:s.find((e=>e.phrase===t));if(!i||!i.sanitizedAction)return;const o=i.sanitizedAction;switch(o.type){case b.SwiftActionTypes.openUrl:G.default.handleOpenUrl(o,e.message.conversationId,this._getRootViewId());break;case b.SwiftActionTypes.openView:G.default.handleOpenView(o,e.message.conversationId,this._getRootViewId());case b.SwiftActionTypes.invoke:}G.default.textHighlightPressedTelemetry(o,e.message)};const w=e.message.messagetype===p.MessageTypes.Text,k=e.message.messagetype===p.MessageTypes.RichText,x=m.isAgent(e.message.creator);let D,R,z;if(e.message.isReported())D=this._renderReportedMessage(r);else if(r.urlPreviewData)D=f.renderLinkAsPreview(r);else{const t=m.isPhoneMri(e.message.conversationId),s=s=>{let i=X.extraTextNodeParsing(s,!t&&(w||k&&x),!0,e.options&&e.options.suggestedTextHighlights);return i=(0,$.transformUnicodeEmojis)(i),i=this._maybeHighlightSearchResults(e,i),f.renderReact(i,r,e.searchStore)};if(D=s(y),(w||k)&&e.message.isBookmark()){const t=c.default.getBookmarkEditedMessage(e.message.cuid,e.message);if(t){P.log(I.LogTraceArea.Bookmarks,"Rendering new version of bookmark message.");R=s(T.decode(t))}}if(o.enableMessageTranslation&&r.hasTranslation){const t=L.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);if(t){o.translateMetadata=p.getMessageTranslationMetadata(t.content);let i=T.decode(t);if(e.wrapInQuote){const e=M.default.getDisplayName(t.creator,!0),s=_.quoteMessage(t,e);i=T.Parser.root([s])}else if(p.hasQuote(e.message.content)){let t=y.getQuoteNodes();t=t.map((t=>this._translateQuoteNode(e.message.conversationId,t,!!o.isOwnMessage,!0))),i=T.Parser.root(t.concat([i]))}z=s(i)}}}return o.renderEditedBookmarkResult=R,o.renderTranslatedReact=z,o.renderResult=D,o}render(){var e,t,s;const i=this._getContentElement(),a=!!(null===(e=this.props.options)||void 0===e?void 0:e.conversationTranslated)&&this.state.renderTranslatedReact&&!Q.default.isTabletNoSubscription(),l=!(null===(t=this.props.options)||void 0===t?void 0:t.conversationTranslated)&&this.state.renderTranslatedReact&&(null===(s=this.props.options)||void 0===s?void 0:s.showTranslatedMessage),d=(0,n.compact)([...Array.isArray(i)?i:[i],a&&this._getTranslateLink()]);if(this.state.renderResult.renderAsInline&&1===d.length&&!l)return i;const c=this.state.renderResult.renderAsInline;if(l){const e=c?ie.inlineViewWrapper:ie.messageContentsViewContainer,t=[this.state.renderTranslatedReact&&ie.translationContainer];return(0,o.jsxs)(r.View,{style:[e,ie.translateIconWrapper],onLayout:c?void 0:this.props.onLayout,children:[(0,o.jsx)(r.View,{style:[t,te.default.flexOne],children:d}),this._getTranslateIcon()]},this.props.message.cuid)}const u=[c?ie.inlineViewWrapper:ie.messageContentsViewContainer,this.state.renderTranslatedReact&&ie.translationContainer];return this.state.enableReplyMessageUnifiedUI&&(this.props.wrapInQuote||p.hasQuote(this.props.message.content))&&u.push(te.default.overflowVisible),(0,o.jsx)(r.View,{style:u,onLayout:c?void 0:this.props.onLayout,children:d},this.props.message.cuid)}_renderReportedMessage(e){const t=R.PlainTextNode.fromPlainText(x.getString("MessageContentNodes.ReportedMessageFallback")),s=T.Parser.root([t]);return e.textOverrideStyle=r.Styles.combine(e.textOverrideStyle,ie.reportedMessageStyle),f.renderReact(s,e,this.props.searchStore)}_maybeHighlightSearchResults(e,t){var s,i;let o=!1;const n=F.default.isMyMri(e.message.creator),r=e.searchStore;let a;if(r){if(r.isMessageInConvSearchResults(e.message.cuid)){const t=r.getSearchQuery();t&&(o=r.isMessageFocused(e.message.cuid),a=t.query)}}else a=e.rawSearchQuery;return a&&(t=(0,z.highlightSearchResults)(t,a,o,n,null!==(i=null===(s=e.options)||void 0===s?void 0:s.isGlobalSearch)&&void 0!==i&&i)),t}_maybeTranslateQuotes(e,t,s){if(s.showTranslatedMessage)return t;const i=F.default.isMyMri(e.message.creator),o=t.getQuoteNodes().map((t=>this._translateQuoteNode(e.message.conversationId,t,i,!1)));return T.Parser.root(o.concat(t.children.filter((e=>!(e instanceof D.QuoteNode)))))}_translateQuoteNode(e,t,s,i){if(t&&t.cuid){const o=L.default.getTranslatedMessage(e,t.cuid);if(o){if(i!==(F.default.isMyMri(o.creator)!==s)){const e=M.default.getDisplayName(o.creator,!0);return _.quoteMessage(o,e)}}}return t}_getContentElement(){var e;return this.props.message.isBookmark()&&this.state.renderEditedBookmarkResult?this.state.renderEditedBookmarkResult.value:this.state.renderTranslatedReact&&(null===(e=this.props.options)||void 0===e?void 0:e.showTranslatedMessage)?this.state.renderTranslatedReact.value:this.state.renderResult.value}_getTranslateLink(){if(!this.props.options||this.props.wrapInQuote)return null;const e=`${this.props.message.cuid}-link`,t=[this.props.options.translationLinkStyle,q.default.fontStyle.captionSelected,this.state.isOwnMessage?ie.translateLinkStyleRight:ie.translateLinkStyleLeft],s=this.props.options.showTranslatedMessage?x.getString("Translator.MessageShowOriginal"):x.getString("Translator.MessageShowTranslation"),i=this.props.options.showTranslatedMessage?x.getString("Translator.MessageShowTranslation"):x.getString("Translator.MessageShowOriginal");return(0,o.jsx)(r.View,{accessibilityLabel:i,accessibilityTraits:r.Types.AccessibilityTrait.Switch,onPress:this._onToggleTranslationPressed,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,children:(0,o.jsx)(w.HoverableLink,{url:"#",style:t,hoverStyle:ie.translateLinkHoveredStyle,onPress:this._onToggleTranslationPressed,children:s},e)})}_getTranslateIcon(){if(!this.props.options||this.props.wrapInQuote)return null;const e=`${this.props.message.cuid}-btn`,t=r.Styles.combine([ie.translateIcon,this.props.options.translationIconStyle]),s=x.getString("Translator.TranslationOptions");return(0,o.jsx)(r.View,{style:t,ref:this._getTranslateButtonRef,onPress:this._onToggleTranslationOptionsPressed,children:(0,o.jsx)(Z.default,{size:ee.IconSize.size20,color:this._getContext().themeColors.primaryIconColor||K.Color.black,icon:ee.SkypeIcon.Translate,title:s,accessibilityLabel:s,accessibilityTraits:r.Types.AccessibilityTrait.Button,onPress:this._onToggleTranslationOptionsPressed,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,tabIndex:0},e)})}}t.default=oe},583490:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackgroundPickerItem=void 0;const i=s(197582),o=s(785893),n=i.__importDefault(s(326036)),r=i.__importStar(s(516778)),a=s(854646),l=s(968739),d=i.__importDefault(s(694154)),c=i.__importDefault(s(453761)),u=i.__importStar(s(704704)),h=s(16549),p=s(641400),g=i.__importDefault(s(970035)),m=s(626065),S=i.__importStar(s(85385)),_=s(26703),f=s(186907),y=s(791915),v=s(308861),C=s(785541),T=i.__importDefault(s(497910)),M=(0,_.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",alignSelf:"stretch",paddingHorizontal:10}),iconButton:()=>r.Styles.createViewStyle({paddingRight:6}),iconButtonBackground:()=>r.Styles.createButtonStyle({borderWidth:1,borderStyle:"solid",borderColor:h.Color.gray200,alignItems:"center",justifyContent:"center"}),iconButtonNoBorder:()=>r.Styles.createButtonStyle({borderWidth:0}),stickerImage:()=>r.Styles.createViewStyle({width:20,height:20}),checkmark:()=>r.Styles.createViewStyle({position:"absolute",right:3,bottom:0,marginRight:0,flex:0,alignSelf:"center",width:14,height:14,borderRadius:14,borderWidth:1,borderStyle:"solid",alignItems:"center",justifyContent:"center",backgroundColor:h.Color.blueDark,borderColor:h.Color.white}),checkmarkIcon:()=>r.Styles.createViewStyle({padding:3.5})}),b={colors:[{key:"Blue",colorGradientStart:h.Color.blueLight,colorGradientEnd:h.Color.blueDark},{key:"Blueviolet",colorGradientStart:h.Color.blurpleLight,colorGradientEnd:h.Color.blurpleDark},{key:"Redviolet",colorGradientStart:h.Color.purpleLight,colorGradientEnd:h.Color.purpleDark},{key:"Red",colorGradientStart:h.Color.pinkLight,colorGradientEnd:h.Color.pinkDark},{key:"Orange",colorGradientStart:h.Color.orangeLight,colorGradientEnd:h.Color.orangeDark},{key:"White",colorGradientStart:h.Color.gray50,colorGradientEnd:h.Color.gray200}]};class I extends T.default{constructor(){super(...arguments),this._onSelectBackgroundColor=e=>{if(this.setState({selectedBackgroundColor:e}),this.props.onSelectBackgroundColorInfo){this.props.onSelectBackgroundColorInfo({key:e.key,colors:[e.colorGradientStart,e.colorGradientEnd]},this.props.iconEntity);const t={tabType:this.props.selectedTabType,triggeredBy:this.props.triggeredBy};S.track(new y.PesBackgroundColorTelemetryEvent(t))}},this._mapColorGradientToColorInfo=()=>{var e,t,s;return{key:null===(e=this.state.selectedBackgroundColor)||void 0===e?void 0:e.key,colors:[null===(t=this.state.selectedBackgroundColor)||void 0===t?void 0:t.colorGradientStart,null===(s=this.state.selectedBackgroundColor)||void 0===s?void 0:s.colorGradientEnd]}}}_buildState(e,t){const s={};return t&&e.iconEntity&&(s.selectedBackgroundColor=b.colors[0]),s}render(){const e=this.props.iconEntity?this.state.generatedColors:b;return e&&e.colors.length?(0,o.jsx)(r.View,{style:M.container,children:e.colors.map((e=>(0,o.jsx)(w,{iconEntity:this.props.iconEntity,selectedColorInfo:this.state.selectedBackgroundColor,colorInfo:e,onSelect:this._onSelectBackgroundColor,staticIcon:this.props.staticIcon},e.key)))}):null}componentDidMount(){super.componentDidMount(),this.props.onSelectBackgroundColorInfo&&!this.props.iconEntity&&this.props.onSelectBackgroundColorInfo(this._mapColorGradientToColorInfo()),this.props.iconEntity&&this._generateBackgroundColors()}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s);const i=this.props.iconEntity!==e.iconEntity,o=this.state.generatedColors!==t.generatedColors;i&&this.props.iconEntity&&this._generateBackgroundColors(),o&&this.props.onSelectBackgroundColorInfo&&this.props.onSelectBackgroundColorInfo(this._mapColorGradientToColorInfo(),this.props.iconEntity)}_generateBackgroundColors(){const e=(0,l.getInputEntityUrl)(this.props.iconEntity,f.EmoticonSize.Small);e&&n.default.getColorHarmonies(e).then((e=>{this.setState({generatedColors:null!=e?e:b,selectedBackgroundColor:(null!=e?e:b).colors[0]})})).catch((()=>{this.setState({generatedColors:b,selectedBackgroundColor:b.colors[0]})}))}}t.default=I;class w extends r.Component{constructor(){super(...arguments),this._onSelect=()=>{this.props.onSelect&&this.props.onSelect(this.props.colorInfo),r.Accessibility.announceForAccessibility(this._getAccessibilityLabel(!0))}}render(){const{iconEntity:e,selectedColorInfo:t,colorInfo:s,staticIcon:i,large:n}=this.props,l=(null==t?void 0:t.key)===s.key;if(!e&&!i)return null;const d=n?f.EmoticonSize.Large:f.EmoticonSize.Small,c=e?e instanceof m.EmoticonEntity?this._getEmoticonIcon(d):this._getStickerIcon():this._getStaticIcon(),u=i?M.iconButtonNoBorder:void 0,h=n?60:32,p=[M.iconButtonBackground,r.Styles.createButtonStyle({width:h,height:h,borderRadius:h/2},!1)];return(0,o.jsxs)(r.Button,{style:M.iconButton,onPress:this._onSelect,autoFocus:l,accessibilityLabel:this._getAccessibilityLabel(l),children:[(0,o.jsx)(a.GradientView,{style:[p,u],colors:[s.colorGradientStart,s.colorGradientEnd],direction:a.GradientDirection.BOTTOM_RIGHT,children:c}),l&&this._renderCheckmark()]},s.key)}_getAccessibilityLabel(e){const t=(0,l.getLocalizedColorName)(this.props.colorInfo.key);return`${u.getString("MeetNow.BackgroundPickerItemLabel",{color:t})}${e?`, ${u.getString("Global.SelectedAccessibilityLabel")}`:""}`}_getEmoticonIcon(e=f.EmoticonSize.Small){const t=this.props.iconEntity;if(!t)return null;const s={id:t.emoticonName,tone:t.tone,firstFrame:0,frameCount:0};return(0,o.jsx)(v.StaticEmoticon,{emoticonInfo:s,size:e},"emoticon")}_getStickerIcon(){const e=this.props.iconEntity,t=(0,C.getStickerUrl)(e.uri,C.StickerSize.ThumbLarge,!1,!0);return(0,o.jsx)(d.default,{origin:"StickerThumbnail",style:M.stickerImage,containerStyle:M.stickerImage,resizeMode:"cover",source:t},"sticker")}_getStaticIcon(){const e="White"===this.props.colorInfo.key?h.Color.gray400:h.Color.white;return this.props.staticIcon&&(0,o.jsx)(c.default,{size:p.IconSize.size16,color:e,hoverColor:e,icon:this.props.staticIcon,title:u.getString("PesPicker.MeetNowTitle")})}_renderCheckmark(){return(0,o.jsx)(r.View,{style:M.checkmark,children:(0,o.jsx)(g.default,{style:M.checkmarkIcon,icon:p.SkypeIcon.Ok,size:p.IconSize.size12,color:h.Color.white})})}}t.BackgroundPickerItem=w},141547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(804144)),a=s(315742),l=i.__importDefault(s(958868)),d=i.__importDefault(s(296374)),c=s(641400);class u extends l.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:n.Animated.Easing.OutBack()},this._toolTipConfig=()=>({getElement:this.props.anchor,positions:[a.PopupAnchorPositon.Bottom],durationMs:3500,title:this.props.title,optionalIcon:c.SkypeIcon.Bookmarked,anchorAccessibilityLabel:this.props.accessibilityLabel,instanceId:this.state.instanceId,rootViewId:this._getRootViewId()}),this._onBookmarkTooltipDismiss=()=>{r.default.bookmarkTooltipDisplayed()}}_buildState(e,t){return{instanceId:e.instanceId||"unknown"}}render(){return(0,o.jsx)(d.default,{toolTipInfo:this._toolTipConfig(),animateDismissal:!0,animationConfig:this._toolTipAnimationConfig,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:this.props.offsetX,containerOffsetY:this.props.offsetY,onDismiss:this._onBookmarkTooltipDismiss})}}t.default=u},843813:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(497910)),a=i.__importStar(s(704704)),l=s(77395),d=i.__importDefault(s(970035)),c=s(16549),u=s(641400),h=s(262725),p=(0,s(26703).lazyProperties)({containerStyle:()=>n.Styles.createViewStyle({paddingTop:20,alignSelf:"center"}),buttonStyle:()=>n.Styles.createButtonStyle({paddingVertical:10,paddingHorizontal:20,flexDirection:"row",borderRadius:30,borderWidth:1,maxWidth:180}),iconStyleMargin:()=>n.Styles.createViewStyle({marginRight:10}),textColor:()=>n.Styles.createTextStyle({color:c.Color.gray400})});class g extends r.default{constructor(){super(...arguments),this._uploadAvatarImage=()=>{this.props.onImageUploadSelected&&this.props.onImageUploadSelected()}}render(){return(0,o.jsx)(n.View,{style:p.containerStyle,children:(0,o.jsxs)(l.HoverableButton,{style:p.buttonStyle,onPress:this._uploadAvatarImage,accessibilityLabel:a.getString("PesPicker.ImageUploaderTabPlaceholder"),children:[(0,o.jsx)(d.default,{icon:u.SkypeIcon.Media,style:p.iconStyleMargin,color:this._useAccessibleTheme()?c.Color.black:c.Color.gray400,size:u.IconSize.size20}),(0,o.jsx)(h.BodyText,{style:p.textColor,children:a.getString("PesPicker.ImageUploaderTabPlaceholder")})]})})}}t.default=g},270127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocationPickerPin=t.PinSize=t.CurrentLocationPinHeight=t.NonCurrentLocationPinHeight=void 0;const i=s(197582),o=s(785893),n=s(13253),r=i.__importStar(s(516778)),a=i.__importStar(s(4937)),l=i.__importDefault(s(601976)),d=i.__importDefault(s(970035)),c=i.__importStar(s(85385)),u=s(26703),h=i.__importStar(s(704704)),p=i.__importStar(s(576047)),g=i.__importDefault(s(363091)),m=s(16549),S=s(641400),_=i.__importStar(s(179582)),f=s(331079),y=s(262725),v=i.__importDefault(s(497910));t.NonCurrentLocationPinHeight=99,t.CurrentLocationPinHeight=135,t.PinSize=22;const C=t.PinSize/2+5,T=(0,u.lazyProperties)({popover:()=>(0,u.lazyProperties)({contentContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderRadius:8,paddingHorizontal:10,backgroundColor:m.Color.gray400}),textContainer:()=>r.Styles.createViewStyle({paddingVertical:10,maxWidth:250,alignSelf:"center"}),narrowTextContainer:()=>r.Styles.createViewStyle({maxWidth:200}),caret:()=>r.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",marginTop:-2,width:12,height:8,backgroundColor:m.Color.transparent}),textFirstLine:()=>r.Styles.createTextStyle({color:m.Color.white}),textSecondLine:()=>r.Styles.createTextStyle({flex:1,color:m.Color.gray200}),textSecondLineAccessible:()=>r.Styles.createTextStyle({flex:1,color:m.Color.white})}),mapMarkerStyle:()=>r.Styles.createTextStyle({alignSelf:"center",backgroundColor:"transparent",marginTop:5}),mapMarkerCurrentStyle:()=>r.Styles.createTextStyle({marginTop:C}),mapMarkerCurrentStyleDesktop:()=>r.Styles.createTextStyle({marginTop:0}),pinStyle:()=>r.Styles.createViewStyle({height:t.PinSize,width:t.PinSize,borderRadius:2*t.PinSize,backgroundColor:m.Color.gray400,borderWidth:3,borderColor:m.Color.white}),sendButtonStyle:()=>r.Styles.createTextStyle({justifyContent:"center",alignItems:"center",width:S.IconSize.default,height:S.IconSize.default})});class M extends v.default{constructor(){super(...arguments),this._onPressPopover=()=>{this.props.onPressPopupOver&&this.state.address&&this.props.onPressPopupOver(this.state.address.addressFriendlyName,this.state.address.fullAddress,this.state.address.shortAddress)}}_buildState(e,t){e.locationType===f.LocationType.Current&&e.userMri;const s={postedByCurrentUser:e.userMri&&g.default.isMyMri(e.userMri),address:{}};if(!s.postedByCurrentUser&&e.conversationId&&e.userMri&&(s.userName=l.default.getMemberShortNameForConversation(e.conversationId,e.userMri)),(t||e.overrideAddress)&&(s.isAddressOverwritten=!1,e.overrideAddress)){const t=h.getString("LocationPicker.FullAddress",{addressFriendlyName:e.overrideAddress.addressFriendlyName,address:e.overrideAddress.address});s.address.addressFriendlyName=e.overrideAddress.addressFriendlyName,s.address.fullAddress=t,s.address.shortAddress=e.overrideAddress.address,s.isAddressOverwritten=!0}return s}componentDidMount(){super.componentDidMount(),this._resolveAddress(this.props)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),(e.overrideAddress||e.location!==this.props.location)&&this._resolveAddress(e)}requestFocus(){}render(){const e=[T.mapMarkerStyle];this.props.hideLocationPin&&e.push(T.mapMarkerCurrentStyleDesktop);const t=this.props.hideLocationPin?null:(0,o.jsx)(r.View,{style:T.pinStyle});return(0,o.jsxs)(r.View,{style:this.props.style,children:[this._getPopover(),(0,o.jsx)(r.View,{style:e,children:t})]})}_getPopover(){if(this.props.showSendPopover||this.props.showViewerPopover){const e=this._getPopoverTextElement();let t;return this.props.showSendPopover?t=(0,o.jsxs)(r.View,{style:T.popover.contentContainer,children:[e,(0,o.jsx)(r.Button,{title:h.getString("LocationPicker.SendButtonTitle"),onPress:this._onPressPopover,autoFocus:!0,children:(0,o.jsx)(d.default,{style:T.sendButtonStyle,size:S.IconSize.size24,color:m.Color.white,icon:S.SkypeIcon.Send})})]}):this.props.showViewerPopover&&(t=(0,o.jsxs)(r.Button,{style:T.popover.contentContainer,onPress:this._onPressPopover,children:[e,(0,o.jsx)(d.default,{style:T.sendButtonStyle,size:S.IconSize.size24,color:m.Color.white,icon:_.navForwardIcon()})]})),(0,o.jsxs)(r.View,{children:[t,this._getCaret()]})}return null}_getPopoverTextElement(){const e=this._getTextLines();let t;e.second&&(t=(0,o.jsx)(y.BodyText,{numberOfLines:1,allowFontScaling:!1,style:this._useAccessibleTheme()?T.popover.textSecondLineAccessible:T.popover.textSecondLine,children:e.second}));const s=[T.popover.textContainer];return this.props.narrow&&s.push(T.popover.narrowTextContainer),(0,o.jsxs)(r.View,{style:s,children:[(0,o.jsx)(y.RowTitle,{numberOfLines:1,allowFontScaling:!1,style:T.popover.textFirstLine,children:e.first}),t]})}_getTextLines(){const e=this._getCurrentLocationString();let t="";return this.props.showViewerPopover?t=h.getString("LocationPicker.TapToSeeOnMapLabel"):this.state.address&&(this.props.locationType===f.LocationType.Current?t=this.state.address.fullAddress:this.state.isAddressOverwritten?t=this.state.address.shortAddress:this.state.address.locality&&this.state.address.zipCode&&(t=this.state.address.state?h.getString("LocationPicker.LocalAddressLabel",{locality:this.state.address.locality,state:this.state.address.state,zipcode:this.state.address.zipCode}):h.getString("LocationPicker.LocalAddressNoStateLabel",{locality:this.state.address.locality,zipcode:this.state.address.zipCode}))),{first:e,second:t}}_getCurrentLocationString(){let e;return this.props.locationType===f.LocationType.Current?e=this.state.postedByCurrentUser?h.getString("LocationPicker.YourLocationLabel"):this.state.userName?h.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.userName}):void 0:this.state.address&&(e=this.state.address.addressFriendlyName,e||(e=this.state.address.streetName&&this.state.address.streetNumber?h.getString("LocationPicker.LocalStreetLabel",{streetName:this.state.address.streetName,streetNumber:this.state.address.streetNumber}):h.getString("LocationPicker.NoValidAddressFallback"))),e}_getCaret(){return(0,o.jsx)(n.ImageSvg,{style:T.popover.caret,webShadow:"3px 3px 6px rgba(0, 175, 240, 0.2)",width:12,height:8,children:(0,o.jsx)(n.SvgPath,{strokeColor:m.Color.gray400,strokeWidth:1,strokeOpacity:0,fillColor:m.Color.gray400,fillOpacity:1,d:"M12,0 l0,0 c0,0 0,0 0,0 l0,0 c0,0 0,0 0,0 l0,0 l-6,8 l-6,-8 l0,0 c0,0 0,0 0,0 l0,0 c0,0 0,0 0,0 z"})})}_resolveAddress(e){if(!e.skipAddressResolution&&!e.overrideAddress&&e.location&&!this._queryingGeocodingServices){this._queryingGeocodingServices=!0;const t=(new Date).getTime();a.resolveAdddress({lat:e.location.latitude,lng:e.location.longitude}).then((s=>{this._queryingGeocodingServices=!1;const i=this.isComponentMounted(),o=null!==s;i&&this.setState({address:s});const n=(new Date).getTime();c.track(new p.LocationPickerResolveAddress(e.locationType,o,i,n-t))})).catch((s=>{this._queryingGeocodingServices=!1;const i=this.isComponentMounted(),o=(new Date).getTime();c.track(new p.LocationPickerResolveAddress(e.locationType,!1,i,o-t))}))}}}t.LocationPickerPin=M,t.default=M},239394:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MyBotFloatTooltip=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(667294),a=s(537180),l=s(167606),d=s(315742),c=i.__importDefault(s(296374)),u=s(26703),h=i.__importDefault(s(20758)),p=i.__importDefault(s(150343)),g=i.__importDefault(s(201721)),m=s(736267),S=s(938827),_=s(526849),f=i.__importDefault(s(601274)),y=s(82485),v=s(563748),C=i.__importDefault(s(793778)),T=i.__importDefault(s(135372)),M=i.__importDefault(s(543915)),b=S.HOUR,I=(0,u.lazyProperties)({describeDestopStyle:()=>n.Styles.createTextStyle({marginTop:4,marginBottom:4,marginLeft:8,marginRight:20}),describeMobileStyle:()=>n.Styles.createTextStyle({marginTop:6,marginBottom:12,marginLeft:10,marginRight:24}),textDesktopStyle:()=>n.Styles.createTextStyle({fontSize:h.default.controlFontSize.caption}),textMobileStyle:()=>n.Styles.createTextStyle({fontSize:h.default.controlFontSize.rowTitle}),closeDesktopStyle:()=>n.Styles.createTextStyle({top:8,right:8}),closeMobileStyle:()=>n.Styles.createTextStyle({top:12,right:12})}),w=a.StyleSheet.create({viewContainer:{width:"100%",height:"100%",position:"absolute"}});t.MyBotFloatTooltip=(0,_.WithResub)((e=>{const t=(0,r.useRef)(null),[s]=(0,r.useState)(e.instanceId||"unknown"),[i,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[S,_]=(0,r.useState)(-2),C=(0,m.useCommonContext)(),P={duration:250,easing:n.Animated.Easing.OutBack()},{enableMyBot:k,enableShowFloatTooltips:A,myBotIndex:x}=e,D=()=>{u(!1),p(!1),g.default.setMyBotTooltipVisible(!0)};return(0,r.useEffect)((()=>{const e=f.default.setTimeout((()=>{i&&g.default.setMyBotTooltipVisible(!0)}),2500);return()=>{e&&f.default.clearTimeout(e)}}),[i]),(0,r.useEffect)((()=>{const e=k&&A,t=T.default.isCoachMarkBeingShown({markType:d.CoachMarkType.Profile}),s=g.default.isMyBotTooltipVisibleNoSubscription(),i=e&&(h||!s&&!t);y.Instrumentation.log(l.LogTraceArea.CoachMarks,"[MyBotFloatTooltip]",`[enableMyBot: ${k}]`,`[enableShowFloatTooltips: ${A}]`,`[shouldUpdatePostion: ${h}]`,`[isMyBotTooltipSeen: ${s}]`,`[isOtherCoachMarkBeingShown: ${t}]`),u(i),i&&y.Instrumentation.track(new v.MyBotTooltipShow)}),[k,A,h]),(0,r.useEffect)((()=>{const e=f.default.setTimeout((()=>{t.current?(t.current.updatePosition(),p(!0)):p(!1)}),300);return()=>{e&&f.default.clearTimeout(e)}}),[x,t]),(0,r.useEffect)((()=>{e.parentRef&&M.default.measureLayoutRelativeToWindow(e.parentRef).then((e=>{_(e.y)}))}),[e.parentRef]),i?(0,o.jsx)(a.View,{style:w.viewContainer,children:(0,o.jsx)(c.default,{toolTipInfo:{getElement:e.anchor,positions:[d.PopupAnchorPositon.Top],durationMs:b,description:e.title,anchorAccessibilityLabel:e.accessibilityLabel,instanceId:s,rootViewId:C.rootViewId},animateDismissal:!0,animationConfig:P,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:0,containerOffsetY:S,hideTitle:!0,onDismiss:()=>{y.Instrumentation.track(new v.MyBotTooltipClose(v.MyBotTooltipCloseType.TouchScreenClose)),D()},descriptionStyle:I.describeDestopStyle,popupRadius:7,popupBeakHeight:5,popupBeakWidth:10,leftMargin:12,rightMargin:12,beakOffset:22,textStyle:I.textDesktopStyle,onPressClose:()=>{y.Instrumentation.track(new v.MyBotTooltipClose(v.MyBotTooltipCloseType.ClickBtnClose)),D()},closeStyle:I.closeDesktopStyle,ref:t})}):(0,o.jsx)(o.Fragment,{})}),(e=>{const{enableMyBot:t,enableShowFloatTooltips:s}=p.default.getS4LMessagingFeatures(),i=C.default.getMyBotItemIndex();return Object.assign(Object.assign({},e),{enableMyBot:t,enableShowFloatTooltips:s,myBotIndex:i})}))},817198:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocationPickerId=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(614080),a=i.__importStar(s(516778)),l=i.__importStar(s(397691)),d=i.__importDefault(s(150343)),c=i.__importDefault(s(25309)),u=i.__importDefault(s(340724)),h=s(154235),p=i.__importStar(s(85385)),g=s(26703),m=i.__importStar(s(704704)),S=i.__importStar(s(576047)),_=i.__importDefault(s(252089)),f=s(932251),y=i.__importDefault(s(799585)),v=s(262725),C=i.__importDefault(s(497910));var T,M;!function(e){e[e.Ready=0]="Ready",e[e.Fetching=1]="Fetching",e[e.Failed=2]="Failed",e[e.Complete=3]="Complete"}(T||(T={})),function(e){e.BingFooter="nbpl_bingFooter",e.BingHeader="nbpl_bingHeader",e.BingPlace="nbpl_bingPlace"}(M||(M={})),t.LocationPickerId="LocationPicker";const b={key:"bingHeader",template:M.BingHeader,height:43,isNavigable:!1,isHoverable:!1,accessibilityGroup:r.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:m.getString("LocationPicker.NearByPlacesLabel")},I={key:"bingFooter",template:M.BingFooter,height:46,isNavigable:!1,isHoverable:!1,accessibilityGroup:r.Types.AccessibilityGroupMarker.End,accessibilityTrait:a.Types.AccessibilityTrait.None},w=(0,g.lazyProperties)({container:()=>a.Styles.createViewStyle({alignSelf:"stretch",flexDirection:"column",alignItems:"flex-start"}),spinner:()=>a.Styles.createViewStyle({flex:1,justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),errorContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),errorMessage:()=>a.Styles.createTextStyle({textAlign:"center"}),listContainer:()=>a.Styles.createViewStyle({alignSelf:"stretch"}),poweredByImage:()=>a.Styles.createImageStyle({flexDirection:"row",justifyContent:"center",marginVertical:8,paddingVertical:15}),nearbyTitleContainer:()=>a.Styles.createViewStyle({paddingHorizontal:10,paddingTop:20,paddingBottom:8,flexDirection:"row",alignItems:"flex-end",justifyContent:"space-between"})});class P extends C.default{constructor(){super(...arguments),this._renderItem=e=>{switch(e.template){case M.BingHeader:const t=m.getString("LocationPicker.NearByPlacesLabel"),s=m.getString("LocationPicker.PoweredByBingMapsLabel"),i=!0,n=i?u.default.headerAccessibilityInfo(t,s):void 0;return(0,o.jsxs)(a.View,{style:[w.nearbyTitleContainer,this._themeStyles.primaryBackgroundColorStyle],accessibilityLabel:n?n.accessibilityLabel:void 0,accessibilityTraits:n?n.accessibilityTraits:void 0,importantForAccessibility:i?a.Types.ImportantForAccessibility.Yes:void 0,children:[(0,o.jsx)(v.Subtitle,{accessibilityHidden:!!i,children:t}),(0,o.jsx)(v.Caption,{accessibilityHidden:!!i,children:s})]},e.key);case M.BingFooter:return(0,o.jsx)(a.Image,{style:w.poweredByImage,accessibilityLabel:m.getString("LocationPicker.PoweredByBingMapsLabel"),source:this.state.poweredByBingImageUrl,resizeMode:"contain"},e.key);case M.BingPlace:return(0,o.jsx)(f.BingListItem,{id:e.key,suggestion:e.suggestion,onPlaceSelected:this.props.onItemSelected,onPlaceSent:this.props.sendItem,onRemoveItem:this._onRemoveItem},e.key);default:return[]}},this._onRemoveItem=e=>{this.setState({itemList:n.filter(this.state.itemList,(t=>t.key!==e))})}}_buildState(e,t){const s={};return t&&(s.itemList=[],s.service=T.Ready,s.poweredByBingImageUrl=d.default.getS4LMessagingFeatures().bingMapsPoweredByImageUrl),s}componentDidMount(){super.componentDidMount(),this._fetchLocations(this.props.latitude,this.props.longitude,this.props.query)}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),e.latitude===this.props.latitude&&e.longitude===this.props.longitude&&e.query===this.props.query||this._fetchLocations(e.latitude,e.longitude,e.query)}_fetchLocations(e,t,s){if(!e||!t)return;this._runningSearchTasks&&n.each(this._runningSearchTasks,(e=>e.cancel()));let i=this.state.service;if(this._runningSearchTasks=[],null==s?void 0:s.length){i=T.Fetching;const o=c.default.getInstance().getAutoSuggestResults(e,t,s);this._runningSearchTasks.push(o.then((e=>{let t=this.state.itemList;const s=n.findIndex(t,(e=>e.key===I.key));s>=0&&(t=t.slice(s+1));const i=[];(null==e?void 0:e.length)&&i.push(b),i.push(...n.map(e,((e,t)=>({template:M.BingPlace,height:84,key:`${e.id}_${t}`,suggestion:e,accessibilityTrait:a.Types.AccessibilityTrait.Button})))),(null==e?void 0:e.length)&&i.push(I),this.isComponentMounted()&&this.setState({itemList:[...i,...t],service:T.Complete})})))}const o=(new Date).getTime();l.all(this._runningSearchTasks).then((()=>{const e=this.isComponentMounted(),t=(new Date).getTime();p.track(new S.LocationPickerNearByFetching(this.props.locationType,e,t-o)),this._runningSearchTasks=void 0})).fail((e=>{const t=this.isComponentMounted(),s=(new Date).getTime();p.track(new S.LocationPickerNearByFetchingFailed(this.props.locationType,t,s-o,e&&n.isNumber(e.statusCode)?e.statusCode:0))})),this.setState({service:i,itemList:[]})}_renderLocationItems(){return this.state.itemList.length?(0,o.jsx)(r.VirtualListView,{itemList:this.state.itemList,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!0,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,style:w.listContainer,accessibilityLabel:m.getString("LocationPicker.NearByPlacesListLabel")}):(0,o.jsx)(a.View,{style:w.listContainer})}render(){const e=[w.container,this._themeStyles.primaryBackgroundColorStyle,this.props.style],t=this.state.service===T.Fetching?(0,o.jsx)(a.View,{style:w.spinner,children:(0,o.jsx)(y.default,{size:h.SXActivityIndicatorSize.Medium,tintColor:_.default.getPrimaryColorNoSubscription()})}):void 0,s=this._shouldRenderError()?(0,o.jsx)(a.View,{style:w.errorContainer,children:(0,o.jsx)(a.Text,{style:[w.errorMessage,this._themeStyles.secondaryTextColorStyle],children:m.getString(this.props.searchModeOn?"LocationPicker.NoResultsFound":"LocationPicker.NoPlacesNearByFound")})}):void 0;return(0,o.jsxs)(a.View,{style:e,children:[this._renderLocationItems(),t,s]})}_shouldRenderError(){return!this.props.latitude||!this.props.longitude||this.state.service===T.Failed||this.state.service===T.Complete&&this.state.itemList.length<=1||n.isEmpty(this.props.query)}}t.default=P},932251:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingListItem=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(217041),a=i.__importDefault(s(25309)),l=i.__importDefault(s(694154)),d=i.__importDefault(s(970035)),c=s(26703),u=s(998929),h=s(16549),p=s(641400),g=s(262725),m=i.__importDefault(s(497910)),S=(0,c.lazyProperties)({listItem:()=>n.Styles.createViewStyle({flexDirection:"row",paddingHorizontal:10,paddingVertical:12}),placePicture:()=>n.Styles.createViewStyle({width:60,height:60,marginRight:10}),extraInfoContainer:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center"}),placeName:()=>n.Styles.createTextStyle({marginBottom:5}),alternateView:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:60,height:60,alignItems:"center",justifyContent:"center",backgroundColor:h.Color.gray300})});class _ extends m.default{constructor(){super(...arguments),this._onPlaceSelectedOrSent=()=>{n.UserInterface.isNavigatingWithKeyboard()&&this.props.onPlaceSent?this.props.onPlaceSent():this.props.onPlaceSelected()},this._hoverStart=()=>{this.setState({isHovering:!0})},this._hoverEnd=()=>{this.setState({isHovering:!1})}}render(){const e=(0,o.jsx)(n.View,{style:S.alternateView,children:(0,o.jsx)(d.default,{icon:p.SkypeIcon.Location,size:p.IconSize.size20,color:h.Color.white})}),t=[S.listItem];return this.state.isHovering&&t.push(this._themeStyles.rowHighlightViewStyle),(0,o.jsx)(n.View,{children:(0,o.jsxs)(u.MaybeListItem.Button,{style:t,onPress:this._onPlaceSelectedOrSent,onFocus:this.props.onPlaceSelected,onHoverStart:this._hoverStart,onHoverEnd:this._hoverEnd,children:[(0,o.jsx)(l.default,{origin:"NearByPlacePhoto",resizeMode:"cover",title:this.props.name,source:this.props.photoUrl,style:S.placePicture,containerStyle:S.placePicture,altView:e,errorView:e},"placePhoto"),(0,o.jsxs)(n.View,{style:S.extraInfoContainer,children:[(0,o.jsx)(g.RowTitle,{style:S.placeName,numberOfLines:1,children:this.props.name}),(0,o.jsx)(g.BodyText,{numberOfLines:1,textThemeColor:g.TextThemeColor.Secondary,children:this.props.address})]})]},this.props.name+this.props.address)})}}class f extends r.ComponentBase{constructor(e){super(e),this._onSelected=()=>{this.state.place&&this.props.onPlaceSelected(this.state.place)},this._onSent=()=>{this.state.place&&this.props.onPlaceSent&&this.props.onPlaceSent(this.state.place)},this._bingMapsClient=a.default.getInstance()}componentDidMount(){super.componentDidMount(),this._bingMapsClient.getLocationDetail(this.props.suggestion).then((e=>{this.isComponentMounted()&&this.setState({place:e})})).catch((()=>{this.isComponentMounted()&&this.props.onRemoveItem(this.props.id)}))}render(){return(0,o.jsx)(_,{name:this.props.suggestion.name,address:this.props.suggestion.address,photoUrl:this.state.place&&this.state.place.photoUrl,onPlaceSelected:this._onSelected,onPlaceSent:this._onSent})}}t.BingListItem=f},95561:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SMSInfoLineTooltip=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(667294),a=i.__importDefault(s(296374)),l=s(736267),d=s(938827),c=s(526849),u=s(22478),h=i.__importDefault(s(438752)),p=i.__importStar(s(704704)),g=i.__importDefault(s(201721)),m=s(26703),S=(0,m.lazyProperties)({text:()=>n.Styles.createTextStyle({fontSize:14,fontWeight:"400",lineHeight:20}),closeIcon:()=>n.Styles.createViewStyle({width:20,height:20,padding:2,top:6})});t.SMSInfoLineTooltip=(0,c.WithResub)((e=>{const t=(0,l.useCommonContext)(),{tooltipInfo:s,tooltipIsSeen:i}=e,c=(0,r.useMemo)((()=>({duration:250,easing:n.Animated.Easing.OutBack()})),[]),u=(0,r.useCallback)((()=>{if(!s)return;const{anchor:e,title:i,durationMs:o,positions:n}=s;return{getElement:()=>e,title:i,durationMs:o||d.HOUR,positions:n,anchorAccessibilityLabel:p.getString("SMSMessaging.SmsSelectorSkypeOptionAccessibilityTitle"),instanceId:"SMSInfolineTooltip",rootViewId:t.rootViewId}}),[t.rootViewId,s]);return!s||i?(0,o.jsx)(o.Fragment,{}):(0,o.jsx)(a.default,{toolTipInfo:u(),animateDismissal:!0,animationConfig:c,textMarginVertical:4,textMarginHorizontal:8,containerOffsetY:5,textStyle:S.text,closeStyle:S.closeIcon,popupRadius:8,onPress:s.onPress,onPressClose:s.onPressClose,onDismiss:s.onDismiss})}),(e=>{const t=h.default.getSMSInfolineTooltip();return Object.assign(Object.assign({},e),{tooltipIsSeen:g.default.isEngagementTooltipSeen(u.EngagementTooltipType.SMSInfoLine),tooltipInfo:t})}))},261349:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(315742),a=i.__importDefault(s(958868)),l=i.__importDefault(s(296374)),d=s(641400);class c extends a.default{constructor(){super(...arguments),this._toolTipAnimationConfig={duration:250,easing:n.Animated.Easing.OutBack()},this._toolTipConfig=()=>({getElement:this.props.anchor,positions:[r.PopupAnchorPositon.Bottom],durationMs:3500,title:this.props.title,optionalIcon:d.SkypeIcon.Lightbulb,anchorAccessibilityLabel:this.props.accessibilityLabel,instanceId:this.state.instanceId,rootViewId:this._getRootViewId()}),this._onTooltipClick=e=>{this.props.onPress&&this.props.onPress(e)}}_buildState(e,t){return{instanceId:e.instanceId||"unknown"}}render(){return(0,o.jsx)(l.default,{toolTipInfo:this._toolTipConfig(),animateDismissal:!1,animationConfig:this._toolTipAnimationConfig,textMarginHorizontal:10,textMarginVertical:10,containerOffsetX:this.props.offsetX,containerOffsetY:this.props.offsetY,onPress:this._onTooltipClick})}}t.default=c},748117:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(44717)),l=i.__importDefault(s(266311)),d=i.__importDefault(s(958868)),c=i.__importDefault(s(615364)),u=i.__importStar(s(170881)),h=i.__importDefault(s(601976)),p=i.__importDefault(s(732028)),g=i.__importDefault(s(109367)),m=s(379878),S=s(26703),_=i.__importStar(s(704704)),f=i.__importDefault(s(942724)),y=i.__importDefault(s(960282)),v=i.__importDefault(s(525864)),C=s(16549),T=i.__importDefault(s(20758)),M=s(262725),b=(0,S.lazyProperties)({contentContainer:()=>r.Styles.createViewStyle({flexDirection:"column",flex:1}),safeCodeSummaryText:()=>r.Styles.createTextStyle({paddingVertical:16,color:C.Color.white}),safeCodeText:()=>r.Styles.createTextStyle({paddingRight:15,paddingBottom:10,color:C.Color.white,fontFamily:T.default.fontFamily.monospace}),safeCodeTextContainer:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",maxWidth:280})}),I="SafeCodeDialog";class w extends d.default{_buildState(e,t){const s=this._getRootViewId();return{isUsingStackNavigationContext:f.default.isUsingStackNavigationContext(),width:y.default.getWidth(s),recipientShortName:h.default.getShortDisplayName(e.mri),isEncryptedThreadEstablished:p.default.getHandshakeState(e.conversationId)===m.SecureHandshakeState.Completed}}static hideSafeCode(e){l.default.isModalDisplayed(I,e)&&l.default.dismissModal(I,e)}static showForConversationId(e,t){const s=(0,c.default)().getConversation(e);if(s){const i=s.getOtherPartyMri();i&&g.default.getFingerprint(a.asSkypeThreadId(e)).then((s=>{u.dismissAll();const n=(0,o.jsx)(w,{conversationId:e,mri:i,fingerprint:s});l.default.showModal(n,I,{rootViewId:t})}))}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.isEncryptedThreadEstablished&&!this.state.isEncryptedThreadEstablished&&w.hideSafeCode(this._getRootViewId())}render(){const e=[{text:_.getString("Global.CloseButtonTitle"),isCancel:!0}],t=[b.contentContainer];const s=_.getString("InfoPanel.SafeCodeDialogHeading",{recipientName:this.state.recipientShortName}),i=_.getString("InfoPanel.SafeCodeDialogTitle");return(0,o.jsx)(v.default,{dialogId:I,text:i,buttons:e,closeOnClickOutside:!0,accessibilityLabel:i,children:(0,o.jsxs)(r.View,{style:t,children:[(0,o.jsx)(M.BodyText,{style:b.safeCodeSummaryText,children:_.getString("InfoPanel.SafeCodeDialogBody")}),(0,o.jsx)(M.BodyText,{bold:!0,style:b.safeCodeSummaryText,children:s}),(0,o.jsx)(r.View,{style:b.safeCodeTextContainer,children:this._formatFingerprint()})]})})}_formatFingerprint(){const e=n.map(n.chunk(this.props.fingerprint,5),(e=>n.join(e,"")));return n.map(e,(e=>(0,o.jsx)(r.Text,{style:[T.default.fontStyle.secondaryButton,b.safeCodeText],children:e},e)))}}t.default=w},476622:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(154235),r=i.__importDefault(s(732028)),a=s(379878),l=i.__importStar(s(704704)),d=i.__importDefault(s(942724)),c=s(551302),u=s(641400),h=i.__importDefault(s(497910)),p=s(483877);class g extends h.default{constructor(){super(...arguments),this._showSafeCode=e=>{e.stopPropagation(),(0,c.showPrivateConversationSafeCode)(this.props.conversationId,this._getRootViewId())}}_buildState(e,t){return{isUsingStackNavigationContext:d.default.isUsingStackNavigationContext(),isEncryptedThreadEstablished:r.default.getHandshakeState(e.conversationId)===a.SecureHandshakeState.Completed}}render(){return(0,o.jsx)(p.WideButton,{icon:u.SkypeIcon.PrivateSessionKey,label:l.getString("InfoPanel.SafeCodeLabel"),onPressed:this._showSafeCode,hideArrow:!0,disabled:!this.state.isEncryptedThreadEstablished,buttonStyles:this.state.isUsingStackNavigationContext?void 0:n.ListItem.small.shortHeightStyle})}}t.default=g},943824:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ImagePreview=t.UrlPreview=t.PreviewInfo=t.FilePreview=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(154235),a=i.__importDefault(s(694154)),l=s(495681),d=i.__importDefault(s(970035)),c=s(26703),u=i.__importDefault(s(799585)),h=s(16549),p=i.__importDefault(s(20758)),g=s(641400),m=i.__importDefault(s(827361)),S=s(262725),_=i.__importDefault(s(497910)),f=(0,c.lazyProperties)({previewIconContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:h.Color.blue,justifyContent:"center",alignItems:"center"}),previewIconContainerUrl:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),previewInfoContainer:()=>n.Styles.createViewStyle({flexDirection:"column",justifyContent:"center"}),previewInfo2Container:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}),previewInfo2ContainerForContact:()=>n.Styles.createViewStyle({justifyContent:"center",paddingRight:5}),previewTextSmall1:()=>n.Styles.createTextStyle({backgroundColor:h.Color.transparent,textAlign:"left"}),previewTextSmall2:()=>n.Styles.createTextStyle({backgroundColor:h.Color.transparent,textAlign:"left",textAlignVertical:"center",marginTop:2}),previewTextLarge1:()=>n.Styles.createTextStyle({textAlign:"center",color:h.Color.black,fontSize:p.default.fontSize.size20}),previewTextLarge2:()=>n.Styles.createTextStyle({color:h.Color.black,fontSize:p.default.fontSize.size18}),spinnerContainer:()=>n.Styles.createTextInputStyle({alignSelf:"stretch",marginRight:10,justifyContent:"center",alignItems:"center"}),imageContainerPreview:()=>n.Styles.createImageStyle({flex:1,alignSelf:"stretch"}),fileIcon:()=>n.Styles.createViewStyle({margin:8}),fileIconCaption:()=>n.Styles.createTextStyle({paddingHorizontal:4,maxWidth:110}),iconPadding:()=>n.Styles.createViewStyle({paddingRight:4})});class y extends _.default{render(){let e,t,s,i,r=h.Color.white;this.props.borderRadius&&(s=n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));const a=[f.previewIconContainer,s];if(this.props.fileName){r=this._themeColors.primaryIconColor,a.push(this._themeStyles.primaryBackgroundColorStyle),i=f.fileIcon;const s=l.FileIconHelper.getIconFromFileType(this.props.fileName,this.props.fileType);e=s.icon,t=(0,o.jsx)(S.BodyText,{bold:!0,ellipsizeMode:"tail",numberOfLines:1,style:f.fileIconCaption,children:s.displayString})}return(!e||this.props.isShareWithContact&&e===g.SkypeIcon.File)&&(e=g.SkypeIcon.FileMultiple),(0,o.jsxs)(n.View,{style:a,children:[(0,o.jsx)(d.default,{icon:e,size:g.IconSize.size32,color:r,style:i}),t]})}}t.FilePreview=y;class v extends _.default{render(){const e=[f.previewTextSmall1,this.props.isShareWithContact?f.previewTextLarge1:void 0,this.props.lineStyles],t=[f.previewTextSmall2,this.props.lineStyles,this.props.isShareWithContact?f.previewTextLarge2:void 0,this.props.lineStyles];let s,i;if(this.props.firstLine){const t=this.props.iconToShowFirstLine?(0,o.jsx)(d.default,{icon:this.props.iconToShowFirstLine,size:g.IconSize.size16,color:this._themeColors.primaryTextColor,style:f.iconPadding}):void 0,i=(0,o.jsx)(S.BodyText,{style:e,numberOfLines:1,ellipsizeMode:"tail",bold:!0,size:S.BodyTextSize.SmallDeprecated,children:this.props.firstLine});s=t?(0,o.jsxs)(n.View,{style:f.previewInfo2Container,children:[t,i]}):i}if(this.props.secondLine){const e=this.props.iconToShowSecondLine?(0,o.jsx)(d.default,{icon:this.props.iconToShowSecondLine,size:g.IconSize.size12,color:this._themeColors.secondaryTextColor,style:f.iconPadding}):void 0;i=(0,o.jsxs)(n.View,{style:[f.previewInfo2Container,this.props.isShareWithContact?f.previewInfo2ContainerForContact:void 0],children:[e,(0,o.jsx)(S.Caption,{style:t,ellipsizeMode:"tail",numberOfLines:1,children:this.props.secondLine})]})}return(0,o.jsxs)(n.View,{style:f.previewInfoContainer,children:[s,i]})}}t.PreviewInfo=v;class C extends _.default{render(){let e;this.props.borderRadius&&(e=n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));let t,s=[];return this.props.urlThumbnail?(t=(0,o.jsx)(T,{imagePreviewHeight:this.props.imagePreviewHeight,imagePreviewWidth:this.props.imagePreviewWidth,borderRadius:this.props.borderRadius,urlThumbnail:this.props.urlThumbnail}),s=[m.default.shadowStyle,m.default.absoluteFill,e]):(t=(0,o.jsx)(d.default,{icon:g.SkypeIcon.Link,size:g.IconSize.size40,color:this._themeColors.primaryIconColor}),s.push(f.previewIconContainerUrl)),(0,o.jsx)(n.View,{style:s,children:t})}}t.UrlPreview=C;class T extends _.default{render(){const e=n.Styles.createViewStyle({flex:1},!1);let t;this.props.borderRadius&&(t=n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1));const s=(0,o.jsx)(n.View,{style:[f.spinnerContainer,e],children:(0,o.jsx)(u.default,{size:r.SXActivityIndicatorSize.Small,tintColor:this._themeColors.primaryIconColor})}),i=(0,o.jsx)(y,{borderRadius:this.props.borderRadius}),l=n.Styles.createImageStyle({overlayColor:this._themeColors.primaryBackgroundColor},!1);return(0,o.jsx)(a.default,{containerStyle:[f.imageContainerPreview,t],style:[f.imageContainerPreview,t,l],origin:"ShareWithContactPanel",source:this.props.urlThumbnail,resizeMode:"cover",altView:s,errorView:i})}}t.ImagePreview=T},835221:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(154235),a=i.__importStar(s(784151)),l=s(26703),d=i.__importStar(s(704704)),c=i.__importDefault(s(252089)),u=i.__importDefault(s(791384)),h=i.__importDefault(s(799585)),p=i.__importDefault(s(660401)),g=s(641400),m=i.__importDefault(s(827361)),S=i.__importDefault(s(497910)),_=s(815146),f=(0,l.lazyProperties)({containerWidth:()=>n.Styles.createViewStyle({minWidth:77,marginRight:2}),spinnerContainer:()=>m.default.alignItemsCenter,containerSmall:()=>n.Styles.createViewStyle({height:30})});class y extends S.default{constructor(){super(...arguments),this._renderSendButton=()=>{const e=this.props.origin===_.SearchResultsListOrigin.SayHiPopup?d.getString("SayHiPopup.SayHiButtonBeforeSending"):d.getString("ShareWithPanel.SendButton");return(0,o.jsx)(p.default,{title:e,accessibilityLabel:this.state.accessibilityLabel,buttonSize:r.SXButtonSize.Small,onPress:this._onSendPress,tabIndex:-1,importantForAccessibility:void 0})},this._onSendPress=e=>{e.stopPropagation(),this.props.onSendMessageButtonPress(this.props.userMri)},this._renderSendingIndicator=()=>(0,o.jsx)(h.default,{size:r.SXActivityIndicatorSize.Small,tintColor:this.state.color}),this._renderSentIndicator=()=>{const e=d.getString("ShareWithPanel.SentLabel");return(0,o.jsx)(p.default,{title:e,accessibilityLabel:this.state.accessibilityLabel,buttonStyle:r.SXButtonStyle.ColorStroke,buttonSize:r.SXButtonSize.Small,onPress:this._onSendPress,disabled:!0,icon:g.SkypeIcon.Ok,disabledOpacityOverride:!0,tabIndex:-1,importantForAccessibility:void 0})}}_buildState(e,t){const s=a.default.getStateForMri(e.userMri);return{sendingState:s,color:this._useAccessibleTheme()?this._themeColors.primaryTextColor:c.default.getPrimaryColor(),accessibilityLabel:this._getAccessibilityLabelForMRI(e.rowTitle,s)}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),t.sendingState!==a.ForwardMessageState.Sent&&this.state.sendingState===a.ForwardMessageState.Sent&&u.default.maybeAnnounceForAccessibility(d.getString("MessageComposer.MessageSentLabel"))}render(){let e;const t=[f.containerWidth];return this.state.sendingState===a.ForwardMessageState.Sending?(t.push(f.spinnerContainer),e=this._renderSendingIndicator()):this.state.sendingState===a.ForwardMessageState.Sent?(t.push(f.containerSmall),e=this._renderSentIndicator()):(t.push(f.containerSmall),e=this._renderSendButton()),(0,o.jsx)(n.View,{style:t,children:e})}_getAccessibilityLabelForMRI(e,t){let s="ShareWithPanel.SendToAccessibilityLabel";return t===a.ForwardMessageState.Sent&&(s="ShareWithPanel.SentToAccessibilityLabel"),d.getString(s,{displayName:e})}}t.default=y},510404:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importDefault(s(815063)),a=s(331654),l=s(149374),d=i.__importStar(s(516778)),c=i.__importDefault(s(974634)),u=i.__importStar(s(397691)),h=i.__importDefault(s(150343)),p=i.__importDefault(s(808467)),g=i.__importStar(s(971988)),m=i.__importDefault(s(633958)),S=s(943824),_=i.__importDefault(s(349004)),f=i.__importStar(s(459287)),y=i.__importDefault(s(389659)),v=i.__importStar(s(242561)),C=s(815146),T=i.__importDefault(s(61784)),M=i.__importDefault(s(606617)),b=i.__importStar(s(784151)),I=i.__importStar(s(626065)),w=i.__importStar(s(7040)),P=i.__importStar(s(85385)),k=i.__importDefault(s(214295)),A=s(26703),x=i.__importStar(s(704704)),D=i.__importDefault(s(884030)),R=i.__importDefault(s(341126)),L=i.__importDefault(s(740794)),B=i.__importDefault(s(942724)),F=s(113002),N=i.__importDefault(s(863132)),E=i.__importDefault(s(244466)),O=i.__importDefault(s(960282)),U=i.__importDefault(s(117475)),V=s(96575),H=s(286517),j=s(240804),z=i.__importDefault(s(657764)),W=s(966515),G=i.__importDefault(s(110895)),K=i.__importDefault(s(817672)),q=s(375258),Q=s(928722),X=i.__importDefault(s(655192)),$=i.__importDefault(s(989314)),J=s(16549),Y=i.__importDefault(s(20758)),Z=s(641400),ee=i.__importDefault(s(827361)),te=s(262725),se=i.__importDefault(s(229634)),ie=i.__importStar(s(277208)),oe=i.__importDefault(s(220534)),ne=s(403396),re=s(596648),ae=i.__importDefault(s(760989)),le=s(844086),de=s(154235),ce=r.default.isMobile()?140:205,ue=r.default.isMobile()?20:0,he=r.default.isMobile()?110:185,pe=r.default.isMobile()?110:185,ge=10,me=(0,A.lazyProperties)({container:()=>d.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),previewContainerCommon:()=>d.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch"}),previewContainer:()=>d.Styles.createViewStyle({padding:10}),previewContainerModernizedMobile:()=>d.Styles.createViewStyle({padding:16}),previewContainerModernized:()=>d.Styles.createViewStyle({paddingHorizontal:36,paddingTop:16,paddingBottom:10}),mediaPreviewContainer:()=>d.Styles.createViewStyle({height:he,width:pe,alignSelf:"stretch",marginRight:10,justifyContent:"center",alignItems:"center",borderRadius:ge}),mediaPreviewForwardContainerDesktop:()=>d.Styles.createViewStyle({height:110,width:110}),frontImageContainerPreview:()=>d.Styles.createViewStyle({position:"absolute",top:7,left:0,right:0,bottom:0,borderRadius:ge}),backImageContainerPreview:()=>d.Styles.createViewStyle({position:"absolute",top:2,left:7,right:7,bottom:7,borderRadius:ge}),imagesCount:()=>d.Styles.createTextStyle({position:"absolute",bottom:0,left:0,right:0,lineHeight:24,borderBottomLeftRadius:ge,borderBottomRightRadius:ge,color:J.Color.white,backgroundColor:J.Color.blackOverlay60,textAlign:"center",elevation:3}),messageAndButtonAndPreviewInfoContainer:()=>d.Styles.createViewStyle({flex:1,paddingTop:12,paddingLeft:12,paddingRight:12,paddingBottom:8,borderRadius:ge,overflow:"visible",flexDirection:"column",justifyContent:"space-between"}),messageMobile:()=>d.Styles.createTextInputStyle({backgroundColor:J.Color.transparent,paddingRight:15,flex:1,height:80,fontSize:Y.default.fontSize.size17}),textInputHeightMobile:()=>d.Styles.createTextInputStyle({height:60}),messageDesktopForward:()=>d.Styles.createTextInputStyle({backgroundColor:J.Color.transparent,flex:1}),messageForwardCanvas:()=>d.Styles.createTextInputStyle({margin:12}),quotePreviewArea:()=>d.Styles.createViewStyle({flex:1,paddingTop:12,paddingHorizontal:12}),quotesPreviewContainerCommon:()=>d.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",borderRadius:10,borderWidth:0}),quotesPreviewContainerWithTextInput:()=>d.Styles.createViewStyle({margin:10}),quotesPreviewContainerWithTextInputMobile:()=>d.Styles.createViewStyle({margin:16}),quotesPreviewContainerWithTextInputModernized:()=>d.Styles.createViewStyle({marginHorizontal:36,marginTop:16,marginBottom:10}),quotePreviewTextStyle:()=>d.Styles.createTextStyle({fontSize:Z.IconSize.size16,lineHeight:21}),previewInfoWithoutThumbnail:()=>d.Styles.createTextStyle({maxWidth:420}),previewInfoWithThumbnail:()=>d.Styles.createTextStyle({maxWidth:300}),quoteContainerForwardMobile:()=>d.Styles.createViewStyle({height:139}),quoteContainerForwardDesktopRedesign:()=>d.Styles.createViewStyle({height:99}),quoteContainerForwardDesktop:()=>d.Styles.createViewStyle({height:47}),previewLocationPin:()=>d.Styles.createViewStyle({backgroundColor:J.Color.black,height:22,width:22,borderRadius:44,borderWidth:3,borderColor:J.Color.white,borderStyle:"solid",position:"absolute",top:55,left:55}),secondaryButton:()=>d.Styles.createButtonStyle({position:"absolute",height:40,width:40,top:10,right:10})}),Se={[C.SearchType.ZeroInput]:[{groupType:C.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations,isCollapsible:!0},{groupType:C.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders,isCollapsible:!0}],[C.SearchType.ZeroInputWithChannel]:[{groupType:C.SearchResultsListGroup.ShareChannel},{groupType:C.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations,isCollapsible:!0},{groupType:C.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders,isCollapsible:!0}],[C.SearchType.ZeroInputWithMagicBot]:[{groupType:C.SearchResultsListGroup.ShareMagicBot},{groupType:C.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations,isCollapsible:!0},{groupType:C.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders,isCollapsible:!0}],[C.SearchType.ShortQuery]:[{groupType:C.SearchResultsListGroup.AllPeopleWithoutAddressBook},{groupType:C.SearchResultsListGroup.GroupChats}],[C.SearchType.LongQuery]:[{groupType:C.SearchResultsListGroup.AllPeopleWithoutAddressBook},{groupType:C.SearchResultsListGroup.GroupChats},{groupType:C.SearchResultsListGroup.PublicDirectory}]};class _e extends p.default{constructor(){super(...arguments),this._onKeyDownEvent=new c.default,this._keyboardAnimatedHeightValue=new d.Animated.Value(0),this._keyboardAnimatedHeightStyle=d.Styles.createAnimatedViewStyle({height:this._keyboardAnimatedHeightValue}),this._hasUsedSearch=!1,this._wasSharePanelDismissedByUser=!1,this._goBack=e=>(P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._goBack,  causeId: "+e),this.props.onShareCancel&&(this.props.onShareCancel(),this._dismissed=!0),this._wasSharePanelDismissedByUser=!0,D.default.hideProcessingDialog(!1),super._goBack(e)),this._onSearchResultsListRef=e=>{this._searchResultsListRef=e||void 0},this._onExternalShareButtonRef=e=>{this._externalShareButtonRef=e||void 0},this._onProfileRemoved=()=>{this._searchResultsListRef&&this._searchResultsListRef.focusFirst()},this._onInputChanged=e=>{this.isComponentMounted()&&(!1===this._hasUsedSearch&&e.length>0&&(this._hasUsedSearch=!0),this.setState({inputText:e}))},this._onExternalSharePress=()=>{if(this.props.onExternalShare)if(this.props.entryPoint===C.SharePanelEntryOrigin.MessageActionMenu){const e=this._getStreamItemUrl();n.isString(e)&&this.props.onExternalShare(e,this._externalShareButtonRef)}else this.props.onExternalShare(void 0,this._externalShareButtonRef)},this._isDoneButtonDisabled=()=>!this.isComponentMounted()||!this.state.shareDestinations||this.state.shareDestinations.length<=0,this._getHeader=()=>{let e;if(!this.props.isExternalWindow){const t={closeButtonType:this.props.navigationDirection===Q.StackNavigationDirection.Push?q.CloseButtonType.Back:q.CloseButtonType.Close,onPress:this._cancelShare,title:x.getString("ShareWithPanel.CloseButtonTitle")},s=this._getHeaderText(this.state),i=this.props.accessibilityLabelTitle||n.trimEnd(s,".");e=(0,o.jsx)(q.SimplePanelHeader,{panelName:s,accessibleName:i,leftButton:t,hideBottomBorder:!this._enablePreview})}const t=this._enablePreview?this._renderPreviewAndText():void 0;return(0,o.jsxs)(d.View,{children:[e,t]})},this._getStreamItemUrl=()=>{var e,t;if(this.props.multipleMessagesParameters.length>0){const s=this.props.multipleMessagesParameters[0].swiftMessage;if(null==s?void 0:s.attachments)return null===(t=null===(e=s.attachments[0].content)||void 0===e?void 0:e.tap)||void 0===t?void 0:t.value}},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onSendButtonPress=e=>{const t=ae.default.newCauseId();P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._onSendButtonPress,  causeId: "+t),b.default.updateSendingStatus(e,b.ForwardMessageState.Sending),this.state.shareDestinations.push(e),this.isComponentMounted()&&this.setState({shareDestinations:this.state.shareDestinations,headerConfig:Object.assign(Object.assign({},this.state.headerConfig),{key:"header"+this.state.shareDestinations.length})}),this._completeSharingProcess([e],t)},this._cancelShare=()=>{const e=ae.default.newCauseId();P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._cancelShare, causeId: "+e),this._goBack(e)},this._shareDone=()=>{const e=ae.default.newCauseId();return P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareDone, causeId: "+e),this._wasSharePanelDismissedByUser=!0,D.default.hideProcessingDialog(!1),super._goBack(e)},this._onInput=e=>{this._savedMessageInput=e,this.isComponentMounted()&&this.setState({previewMessage:e,headerConfig:Object.assign(Object.assign({},this.state.headerConfig),{key:"header"+e})})},this._headerHeight=()=>{const{sharePreviewType:e}=this.props,t=[F.SharePreviewType.AudioMessage,F.SharePreviewType.Location,F.SharePreviewType.File,F.SharePreviewType.Audio],s=this._enablePreview?ce:0,i=e&&t.includes(e)?ue:0,o=this.state.enableMagicBotShare?-10:0;return(this.state.deviceOrientation!==a.DeviceOrientation.Landscape?this.state.isSmallDevice?q.HeaderHeightSmall:q.HeaderHeight:this.state.isSmallDevice?q.HeaderHeightLandscapeSmall:q.HeaderHeightLandscape)+this.state.statusBarPadding+s+i+o}}_buildState(e,t){const s=this._getRootViewId(),{modernizeSearchPanel:i,enableForwardingQuotes:o,enableMagicBot:r,enableMyBot:a,enableReplyMessageUnifiedUI:l}=h.default.getS4LMessagingFeatures(),{enableContentChannels:c}=h.default.getS4LUiFeatures();let u={statusBarPadding:U.default.statusBarPadding(),deviceOrientation:O.default.getDeviceOrientation(s),isSmallDevice:O.default.isSmallDevice(s),modernizeSearchPanel:i,enableForwardingQuotes:o,enableMagicBotShare:r&&e.isMagicBotShare,enableChannelShare:c&&e.isChannelShare,enableMyBot:a,enableReplyMessageUnifiedUI:l};if(t&&(this._conversationSelectionController=new _.default,this._finishButtonAnimatedHeightValue=new d.Animated.Value(0),this._dismissed=!1,u.urlThumbnail=void 0,u.inputText="",u.shareDestinations=[],this._enableForwardPreview=n.isUndefined(e.showForwardPreview)||e.showForwardPreview,this._enablePreview=n.isUndefined(this._enableForwardPreview)?e.enableMediaPreview:this._enableForwardPreview,this._enablePreview)){u=this._tryGetUrlPreview(e,u);const t=n.find(e.multipleMessagesParameters,(e=>!!e.messageContent));u.previewMessage=this._isUrlShare||e.showForwardPreview||e.sharePreviewType!==F.SharePreviewType.Text?void 0:t&&t.messageContent,this._savedMessageInput=u.previewMessage}u.isUsingStackNavigationContext=B.default.isUsingStackNavigationContext(),u.keyboardUpdateInfo=k.default.getUpdateInfo(),u.keyboardResizeMode=k.default.getResizeMode(),u.selectedMris=this._conversationSelectionController.getSelectedConversations(),u.canSubmit=this._conversationSelectionController.getSelectedConversations().length>0;const p=e.sharePreviewType===F.SharePreviewType.Text,m=e.sharePreviewType===F.SharePreviewType.MultipleMessages&&n.every(e.multipleMessagesParameters,(e=>e.messageType===g.MessageTypes.Text||e.messageType===g.MessageTypes.EncryptedText)),S=p||m;return u.includePrivateConversations=e.showForwardPreview&&S,u.excludeS4B=!S,u.headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight,key:"header"+u.previewMessage},u}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._searchController=new z.default,b.default.reset()}componentDidMount(){super.componentDidMount();const e=this.props.multipleMessagesParameters.length>0&&this.props.multipleMessagesParameters[0].conversationId;e&&(this._conversationSelectionController.addConversation(e),this.setState({canSubmit:!0}),d.Animated.timing(this._finishButtonAnimatedHeightValue,{toValue:48,duration:250,easing:d.Animated.Easing.InOut()}).start())}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this._keyboardAnimatedHeightValue.setValue(t.keyboardUpdateInfo.height)}componentWillUnmount(){super.componentWillUnmount();const e=ae.default.newCauseId();P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel.componentWillUnmount,  causeId: "+e),b.default.reset(),!this._dismissed&&this.props.onShareCancel&&this.props.onShareCancel(),this._searchController&&this._searchController.destroy(),P.track(new W.SharePanelTelemetry(this.props.entryPoint,this.state.shareDestinations.length,this._hasUsedSearch,!!this._savedMessageInput)),this.state.shareDestinations.length>0&&this._wasSharePanelDismissedByUser&&(this.props.showForwardPreview&&n.each(this.props.multipleMessagesParameters,(t=>{this._onShareCompleteForMessage(t,this.state.shareDestinations,e)})),!this.props.onShareComplete||this.props.onShareCancel&&this._dismissed||this.props.onShareComplete(this.state.shareDestinations,!!this.state.previewMessage))}render(){const e=this.state.keyboardResizeMode===l.KeyboardAwareResizeMode.None?(0,o.jsx)(d.Animated.View,{style:this._keyboardAnimatedHeightStyle}):void 0,t=!d.UserInterface.isNavigatingWithKeyboard();return(0,o.jsx)(m.default,{goBack:this._goBack,children:(0,o.jsxs)(le.KeyboardAvoidingView,{style:[me.container,this._themeStyles.primaryBackgroundColorStyle],children:[(0,o.jsxs)(d.View,{style:me.container,children:[(0,o.jsx)(E.default,{searchController:this._searchController,headerConfig:this.state.headerConfig,onCancel:this._cancelShare,peopleType:j.PeopleType.AllExcludingBots,includeGroups:!0,autoFocusOnInput:t,autoFocusWhenActive:!0,selectorController:this._conversationSelectionController,useCollapsableHeader:!1,onKeyDown:this._onSearchInputKeyDown,isUrlRequestComplete:!!this.state.urlThumbnail,inputText:this.state.inputText,onInputChanged:this._onInputChanged,colorThemeOverride:this.props.colorThemeOverride,onProfileRemoved:this._onProfileRemoved,noFixedHeight:this._isHeightUnknownForHeader(),showSendButtonOnEverySearchItemUI:!0},"peopleInput"),(0,o.jsx)(H.SearchResultsList,{useItemSeparator:!this.state.modernizeSearchPanel,ref:this._onSearchResultsListRef,rawSearchQuery:this.state.inputText,origin:C.SearchResultsListOrigin.ShareWithPanel,searchResultGroups:this._getSearchResultsGroup(),searchController:this._searchController,arePeopleSelectableForInvite:!1,selectedMris:this.state.selectedMris,peopleType:this.state.enableMyBot?j.PeopleType.PeopleWithMyBot:j.PeopleType.AllExcludingBots,maxNumberOfSuggestedContacts:20,excludePstn:!0,excludeS4B:this.state.excludeS4B,userMrisToExclude:this.props.userMrisToExclude,keyDownEvent:this._onKeyDownEvent,colorThemeOverride:this.props.colorThemeOverride,excludeEncrypted:!this.state.includePrivateConversations,includePrivateConversationsWithHandshake:this.state.includePrivateConversations,onSendMessageButtonPress:this._onSendButtonPress,disableItemOnLongPress:!0,disableRowHoverStyle:!0,excludeNewsChannels:!0,excludeNewsBot:!0,channelShortId:this.props.channelShortId,channelId:this.props.channelId})]}),(0,o.jsx)(K.default,{button:this._getActionDoneButton(),secondaryButton:this._getExternalShareButton()}),e]})})}_componentId(){return"ShareWithPanel"}_isHeightUnknownForHeader(){return!this.state.isUsingStackNavigationContext||this.props.sharePreviewType===F.SharePreviewType.Text}_getActionDoneButton(){return{onPress:this._shareDone,disabled:this._isDoneButtonDisabled(),text:x.getString("Global.DoneButtonTitle"),accessibilityLabel:x.getString("Global.DoneButtonTitle")}}_getExternalShareButton(){if(void 0!==this.props.onExternalShare)return{onPress:this._onExternalSharePress,icon:Z.SkypeIcon.Share,iconSize:Z.IconSize.size24,buttonStyle:de.SXButtonStyle.Custom,backgroundStyle:{borderRadius:40,paddingLeft:0,paddingRight:0},buttonConfig:{backgroundColor:J.Color.gray200},style:me.secondaryButton,setButtonRef:this._onExternalShareButtonRef}}_tryGetUrlPreview(e,t){if(e.sharePreviewType!==F.SharePreviewType.Text)return t;if(e.showForwardPreview){const s=n.filter(e.multipleMessagesParameters,(e=>!!e.urlPreviewData));if(s&&1===s.length){const e=s[0].urlPreviewData;e&&e.isValid&&(this._isUrlShare=!0,t=Object.assign(Object.assign({},t),{urlThumbnail:e.urlPreviewMetadata.thumbnail,site:e.urlPreviewMetadata.site,infoUrl:e.urlPreviewMetadata.url}))}return t}let s;return e.multipleMessagesParameters.length>0&&(s=e.multipleMessagesParameters[0].messageContent||e.multipleMessagesParameters[0].url),s&&oe.default.isUrlValid(s)?(this._isUrlShare=!0,se.default.getUrlInfoAsync(s).then((e=>{if(!s)return;const t=ie.getUrlPreviewInformationFromMetadata(e,s),i=t.hasThumbnail?t.urlPreviewMetadata.thumbnail:void 0,o=t.urlPreviewMetadata.site,n=t.urlPreviewMetadata.url;this.isComponentMounted()&&this.setState({urlThumbnail:i,site:o,infoUrl:n})})).catch((e=>{P.error(C.LogTraceArea.ShareWithPanel,"Error generating url preview in ShareWithPanel: "+X.default.errorAsString(e))})),t):t}_getOptionalContentPreviewAsQuoteStyles(){const e=[me.quotesPreviewContainerCommon];return this.state.modernizeSearchPanel?e.push(me.quotesPreviewContainerWithTextInputModernized):e.push(me.quotesPreviewContainerWithTextInput),e.push(this._themeStyles.secondaryBackgroundColorStyle),e}_getPreviewContentStyles(){const e=[me.previewContainerCommon];return this.state.modernizeSearchPanel?e.push(me.previewContainerModernized):e.push(me.previewContainer),e}_renderPreviewAndText(){let e,t,s,i;const a=!this.props.isExternalWindow&&!r.default.isMobile(),l=[me.mediaPreviewContainer,a?me.mediaPreviewForwardContainerDesktop:void 0];let c;if(c=this.state.urlThumbnail?me.previewInfoWithThumbnail:me.previewInfoWithoutThumbnail,this._isUrlShare)this.state.urlThumbnail&&(e=(0,o.jsx)(S.UrlPreview,{imagePreviewHeight:he,imagePreviewWidth:pe,borderRadius:ge,urlThumbnail:this.state.urlThumbnail})),t=this._getOptionalPreviewInfo({firstLine:this.state.site,secondLine:this.state.infoUrl,isUrlPreview:!0,iconToShowSecondLine:Z.SkypeIcon.Link,lineStyles:c});else{let r=n.filter(this.props.multipleMessagesParameters,(e=>!n.isUndefined(e.localMediaThumbnailUri)));const a=this.props.sharePreviewType===F.SharePreviewType.Audio,c=me.previewInfoWithThumbnail;let u;switch(this.props.sharePreviewType){case F.SharePreviewType.Video:t=this._getOptionalPreviewInfo({firstLine:x.getString("ShareWithPanel.VideoPreviewInfo"),iconToShowFirstLine:Z.SkypeIcon.Video,lineStyles:c}),e=this._renderThumbnailsPreview(r);break;case F.SharePreviewType.MixedVideoAndPhoto:case F.SharePreviewType.Photo:e=this._renderThumbnailsPreview(r);break;case F.SharePreviewType.AudioMessage:const h=this.props.multipleMessagesParameters&&this.props.multipleMessagesParameters.length>0?this.props.multipleMessagesParameters[0].audioMessageDuration:void 0,p=h?y.default.getElapsedTimeStringFromS(Math.ceil(h/1e3)):void 0;t=this._getOptionalPreviewInfo({firstLine:x.getString("ShareWithPanel.AudioMessagePreviewInfo"),secondLine:p?x.getString("ShareWithPanel.AudioMessageDuration",{duration:p}):void 0,iconToShowFirstLine:n.isUndefined(p)?Z.SkypeIcon.Microphone:void 0,iconToShowSecondLine:p?Z.SkypeIcon.Microphone:void 0,lineStyles:me.previewInfoWithThumbnail});break;case F.SharePreviewType.File:case F.SharePreviewType.Audio:let g;if(l.push(this._themeStyles.viewBorderStyle),r&&1===r.length){const e=r[0];g=e.localMediaThumbnailUri&&this._getFileNameFromUrl(e.localMediaThumbnailUri)}else r=n.filter(this.props.multipleMessagesParameters,(e=>!n.isUndefined(e.fileName))),r&&1===r.length&&(g=r[0].fileName,u=a?r[0].fileType:void 0);const m=G.default.getPreviewInfoSizeInBytes(r),_=m?T.default.formatFileSize(m,2).formattedString:void 0;e=(0,o.jsx)(S.FilePreview,{borderRadius:ge,fileName:g,fileType:u}),t=this._getOptionalPreviewInfo({firstLine:G.default.getPreviewInfoTitle(r,this.props.sharePreviewType),secondLine:_,lineStyles:c});break;case F.SharePreviewType.Contact:let f,v,C="",M="";r=n.filter(this.props.multipleMessagesParameters,(e=>!n.isUndefined(e.contactInfo&&e.contactInfo.skypeId))),r&&1===r.length&&(f=r[0]),f&&f.contactInfo&&(C=f.contactInfo.skypeId,M=f.contactInfo.fullName,v=f.contactInfo.userMri),v&&(e=this._renderContactPreview(v)),t=this._getOptionalPreviewInfo({firstLine:M,secondLine:C,lineStyles:c});break;case F.SharePreviewType.SwiftCards:let b,I;if(r=n.filter(this.props.multipleMessagesParameters,(e=>!n.isUndefined(e.swiftMessage))),r&&1===r.length){r[0].localMediaThumbnailUri&&(e=this._renderThumbnailsPreview(r));const t=r[0].swiftMessage;if(t){t.attachments&&1===t.attachments.length&&(b=t.summary,I=$.default.getSwiftCardInfoTitle(t))}}t=this._getOptionalPreviewInfo({firstLine:b,secondLine:I,lineStyles:c,isUrlPreview:!0,iconToShowSecondLine:Z.SkypeIcon.Link});break;case F.SharePreviewType.Text:if(!this.props.showForwardPreview)break;const w=n.filter(this.props.multipleMessagesParameters,(e=>!n.isUndefined(e.message)));if(w.length&&w[0]){const e=w[0].message;if(!e||this.state.enableForwardingQuotes&&w[0].sendAsForwardedQuote)break;i=this._renderQuotePreview(e)}break;case F.SharePreviewType.Location:if(r=n.filter(this.props.multipleMessagesParameters,(e=>!n.isUndefined(e.locationInfo))),e=this._renderThumbnailsPreview(r),e&&(s=(0,o.jsx)(d.View,{style:me.previewLocationPin})),r&&r.length){const e=r[0].locationInfo;e&&(t=this._getOptionalPreviewInfo({firstLine:e.topAddress,secondLine:e.bottomAddress,lineStyles:c}))}}}const u=[];a?u.push(me.messageDesktopForward):(u.push(me.messageMobile),(this.props.sharePreviewType===F.SharePreviewType.SwiftCards||this._isUrlShare&&e)&&u.push(me.textInputHeightMobile));const h=[this._themeStyles.primaryTextColorStyle,u,i?me.messageForwardCanvas:void 0],p=[me.messageAndButtonAndPreviewInfoContainer,this._themeStyles.messageComposerBackgroundStyle],g=e?(0,o.jsx)(d.View,{style:l,children:e}):void 0,m=(0,o.jsx)(d.TextInput,{autoCorrect:!0,value:this.state.previewMessage,style:h,maxLength:25e3,multiline:!i,blurOnSubmit:!!i,onChangeText:this._onInput,placeholder:x.getString("ShareWithPanel.MessagePlaceHolder"),placeholderTextColor:this._themeColors.secondaryTextColor,keyboardAppearance:this._useDarkTheme()?"dark":"default",autoCapitalize:"sentences",editable:!this.state.isTextInputDisabled,clearButtonMode:"never"},"optionalInputText");return i?(0,o.jsxs)(d.View,{style:this._getOptionalContentPreviewAsQuoteStyles(),children:[i,m]}):(0,o.jsxs)(d.View,{style:this._getPreviewContentStyles(),children:[g,s,(0,o.jsxs)(d.View,{style:p,children:[m,t]})]})}_getOptionalPreviewInfo(e){return(0,o.jsx)(S.PreviewInfo,{firstLine:e.firstLine,secondLine:e.secondLine,isUrlPreview:e.isUrlPreview||!1,colorThemeOverride:this.props.colorThemeOverride,iconToShowFirstLine:e.iconToShowFirstLine,iconToShowSecondLine:e.iconToShowSecondLine,lineStyles:e.lineStyles})}_renderQuotePreview(e){const t=[this._themeStyles.primaryTextColorStyle,Y.default.font.uiDisplayBold],s={numberOfLines:1,renderOrigin:v.MessageRenderOrigin.ForwardCanvas,textOverrideStyle:[me.quotePreviewTextStyle,this._themeStyles.primaryTextColorStyle],atMentionStyle:t,atMentionMeOverrideStyle:this._themeStyles.primaryTextColorStyle,quoteSymbolStyle:{size:Z.IconSize.size20,color:this._themeColors.textPrimary},quoteSeparatorStyle:d.Styles.createViewStyle({borderColor:this._themeColors.secondaryTextColor,marginBottom:0},!1),renderSimpleAtMentions:!0},i=[me.quotePreviewArea];return this.state.enableReplyMessageUnifiedUI?i.push(me.quoteContainerForwardDesktopRedesign):i.push(me.quoteContainerForwardDesktop),(0,o.jsx)(d.View,{style:i,children:(0,o.jsx)(R.default,{message:e,wrapInQuote:!0,options:s})})}_renderContactPreview(e){return(0,o.jsx)(ne.UserIcon,{userMri:e,size:re.UserIconSize.Size110,borderRadiusOverride:ge},"contact-preview")}_renderThumbnailsPreview(e){if(!n.isUndefined(e)&&0===e.length)return;const t=[],s=e[0],i=e[1];let r;if(n.isUndefined(s.localMediaThumbnailUri))return;if(i){const s=(0,o.jsx)(S.ImagePreview,{imagePreviewHeight:he,imagePreviewWidth:pe,borderRadius:ge,urlThumbnail:i.localMediaThumbnailUri});t.push((0,o.jsx)(d.View,{style:[ee.default.shadowStyle,me.backImageContainerPreview],children:s},"image-back"));const n=G.default.getPreviewInfoTitle(e,this.props.sharePreviewType);r=(0,o.jsx)(te.Caption,{style:me.imagesCount,children:n},"images-count")}const a=(0,o.jsx)(S.ImagePreview,{imagePreviewHeight:he,imagePreviewWidth:he,borderRadius:ge,urlThumbnail:s.localMediaThumbnailUri});return i?(t.push((0,o.jsx)(d.View,{style:[ee.default.shadowStyle,me.frontImageContainerPreview],children:a},"image-front")),r&&t.push(r),t):a}_getSearchResultsGroup(){const e=Se,t=n.trim(this.state.inputText);return 0===t.length?this.state.enableMagicBotShare?e[C.SearchType.ZeroInputWithMagicBot]:this.state.enableChannelShare?e[C.SearchType.ZeroInputWithChannel]:e[C.SearchType.ZeroInput]:t.length<h.default.getConfigSettingsNoSubscription().search.longQueryCharCount?e[C.SearchType.ShortQuery]:e[C.SearchType.LongQuery]}_completeSharingProcess(e,t){P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcess,  causeId: "+t);let s=!0;if(this.state.previewMessage){const t=this.props.sharePreviewType===F.SharePreviewType.Text&&!this._isUrlShare;this.props.showForwardPreview&&t||G.default.sendPreviewTextMessage(e,this.state.previewMessage)}n.each(this.props.multipleMessagesParameters,(i=>{s=s&&this._shareOrForwardMessage(i,e,t)})),n.each(e,(e=>{b.default.updateSendingStatus(e,b.ForwardMessageState.Sent)}))}_shareOrForwardMessage(e,t,s){P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareOrForwardMessage,  causeId: "+s);let i=!0;return e&&!n.isEmpty(t)&&(e.mediaSelection?(this._completeSharingProcessForMediaSelection(e.mediaSelection,t,s),i=!1):!n.isEmpty(e.forwardMediaInfos)&&!e.swiftMessage||e.messageType===g.MessageTypes.MediaAlbum?this._completeForwardProcessForMedia(e,t,s):e.messageType&&(i=this._shareMessageBasedOnType(e,t,s))),this.props.showForwardPreview||this._onShareCompleteForMessage(e,t,s),i}_onShareCompleteForMessage(e,t,s){P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._onShareCompleteForMessage,  causeId: "+s),e.onShareCompleteForMessage&&(this._isUrlShare&&!n.isUndefined(s)&&this.props.entryPoint===C.SharePanelEntryOrigin.External&&this._completeSharingProcessForGenericMessage(e,t,s),e.onShareCompleteForMessage(t))}_shareMessageBasedOnType(e,t,s){let i;P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._shareMessageBasedOnType,  causeId: "+s);let o=!1;switch(e.messageType){case g.MessageTypes.RichText:case g.MessageTypes.Location:case g.MessageTypes.Contacts:i=this._completeSharingProcessForGenericMessage(e,t,s),o=!0,this._onPostComplete(i);break;case g.MessageTypes.Media_Card:e.adaptiveCardMessage?(i=this._completeSharingProcessForAdaptiveCard(e,t,s),o=!0):(i=this._completeSharingProcessForMediaCard(e,t,s),o=!0),this._onPostComplete(i);break;case g.MessageTypes.UriObject:this._completeSharingProcessForPhoto(e,t,s).then((e=>{this._onPostComplete(e)}));break;case g.MessageTypes.Media_Video:this._completeSharingProcessForVideo(e,t,s).then((e=>{this._onPostComplete(e)}))}return o}_onPostComplete(e){this.props.onPostComplete&&this.props.onPostComplete(e)}_completeSharingProcessForGenericMessage(e,t,s){if(P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForGenericMessage,  causeId: "+s),n.isEmpty(t))return P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForGenericMessage, nothing to share, causeId: "+s),[];const i=[];return n.each(t,(t=>{if(e.url||this._isUrlShare){const s=e.url||e.messageContent;if(!s)return;const o=G.default.sendUrlAsLink(s,t);i.push(o)}else if(e.inputEntities){let s;const o=[e.inputEntities];this._savedMessageInput&&this.props.sharePreviewType===F.SharePreviewType.Text&&(this.state.enableForwardingQuotes&&e.sendAsForwardedQuote?this._shareMessage(t,this._savedMessageInput,e.message,e.messageType,i):(s=new I.UnhandledEntity(this._savedMessageInput),o.push(s)));const n=G.default.shareMessageEntities(t,o,e.message,e.messageType);i.push(n)}else e.messageContent&&this._shareMessage(t,e.messageContent,e.message,e.messageType,i)})),i}_shareMessage(e,t,s,i,o){const n=f.createForwardMessageInfo(e,C.PostSource.ShareWith,t||"",i,void 0,void 0,s?g.getForwardedTeamsProperties(s.properties):void 0);N.default.postMessage(n),o.push({clientMessageId:n.messageForPosting.clientmessageid,conversationId:e})}_completeSharingProcessForAdaptiveCard(e,t,s){const i=[];return P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForAdaptiveCard,  causeId: "+s),n.isEmpty(t)?(P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForAdaptiveCard, nothing to share, causeId: "+s),i):(n.each(t,(t=>{if(e.adaptiveCardMessage){const s={type:e.adaptiveCardMessage.type,attachments:e.adaptiveCardMessage.attachments},o=w.encode([new I.AdaptiveUriObjectEntity(s,t,!0)],!1),n=f.createForwardMessageInfo(t,C.PostSource.ShareWith,o,e.messageType);N.default.postMessage(n),i.push({clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:t})}})),i)}_completeSharingProcessForMediaCard(e,t,s){const i=[];return P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaCard,  causeId: "+s),n.isEmpty(t)?(P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaCard, nothing to share, causeId: "+s),i):(n.each(t,(t=>{if(e.swiftMessage){const s={type:e.swiftMessage.type,attachments:e.swiftMessage.attachments,summary:e.swiftMessage.summary},o=w.encode([new I.SwiftUriObjectEntity(s,t,!0,e.swiftMessage.summary)],!1),n=f.createForwardSwiftMessageInfo(t,C.PostSource.ShareWith,o,e.messageType,s,e.forwardMediaInfos);N.default.postMessage(n),i.push({clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:t})}})),i)}_completeForwardProcessForMedia(e,t,s){P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeForwardProcessForMediaSelection,  causeId: "+s),n.isEmpty(t)?P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeForwardProcessForMediaSelection, nothing to forward, causeId: "+s):n.each(t,(t=>{N.default.postMessage(f.createForwardMessageInfo(t,C.PostSource.ShareWith,e.messageContent||"",e.messageType,e.forwardMediaInfos,e.albumId))}))}_completeSharingProcessForMediaSelection(e,t,s){P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaSelection,  causeId: "+s),n.isEmpty(t)?P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForMediaSelection, nothing to share, causeId: "+s):D.default.postMediaSelections(e,t,C.PostSource.ShareWith,{},void 0,s).then((()=>{L.default.navigateToHub(s)}))}_completeSharingProcessForPhoto(e,t,s){if(P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto,  causeId: "+s),n.isEmpty(t))return P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto, nothing to share, causeId: "+s),u.Resolved([]);const i=e.localMediaObjectUri;if(i){const o=this._getFileNameFromUrl(i),n={file:{uri:i,name:o,size:e.fileSize,type:"image/jpg"},extension:M.default.extractFileExtension(o)};return e.width&&e.height&&(n.dimensions={width:e.width,height:e.height}),N.default.postUploadAndShowFeedbackToast(t,n,C.PostSource.ShareWith,void 0,void 0,void 0,{name:V.ScenarioName.SendMessage}).finally((()=>{L.default.navigateToHub(s)}))}return P.warn(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForPhoto, no uri for the photo!  causeId: "+s),u.Rejected()}_completeSharingProcessForVideo(e,t,s){if(P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo,  causeId: "+s),n.isEmpty(t))return P.log(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, nothing to share, causeId: "+s),u.Resolved([]);const i=e.localMediaObjectUri;if(i){const o=i.substring(i.lastIndexOf("/")+1),n={file:{uri:i,name:o,size:e.fileSize,type:"video/mp4"},extension:M.default.extractFileExtension(o)};if(e.width&&e.height&&(n.dimensions={width:e.width,height:e.height}),e.localMediaThumbnailUri){const i=e.localMediaThumbnailUri,r=M.default.extractFileName(o)+"-thumbnail.jpg";n.thumbnail={file:{uri:i,name:r,size:0,type:"image/jpg"},extension:M.default.extractFileExtension(o)},e.width&&e.height&&(n.thumbnail.dimensions={width:e.width,height:e.height});const a={name:V.ScenarioName.SendVideo};return N.default.postVideoWithThumbnail(t,n,C.PostSource.ShareWith,!1,a).finally((()=>{L.default.navigateToHub(s)}))}return P.warn(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, the local media thumbnail uri is not present. causeId: "+s),u.Rejected()}return P.warn(C.LogTraceArea.ShareWithPanel,"ShareWithPanel._completeSharingProcessForVideo, no uri for the video! causeId: "+s),u.Rejected()}_getHeaderText(e){return this.props.shareMessageTitle||x.getString("ShareWithPanel.ShareWithHeader")}_getFileNameFromUrl(e){return e.substring(e.lastIndexOf("/")+1)}}t.default=_e},608300:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({callerMri:e,duration:t,timestamp:s}){const[i,u]=(0,a.useState)(""),{textStyle:h}=(0,l.useSkypeStyles)((({themeColors:{textSecondary:e}})=>({textStyle:{fontSize:12,lineHeight:14,fontWeight:"400",color:e}})),[]);(0,a.useEffect)((()=>{e&&u(c.default.getShortDisplayName(e))}),[e]);const p=t?d.default.getFormattedDuration(t,!1):void 0;return(0,o.jsxs)(n.Row,{children:[(0,o.jsx)(r.Text,{style:h,children:i?i+" | ":""},"caller-name"),(0,o.jsx)(r.Text,{style:h,children:s?d.default.getDisplayTimeString(s):void 0},"call-timestamp"),(0,o.jsx)(r.Text,{style:h,children:t?" | "+p:""},"call-duration")]})};const i=s(197582),o=s(785893),n=s(344175),r=s(537180),a=s(667294),l=s(964414),d=i.__importDefault(s(389659)),c=i.__importDefault(s(601976))},592097:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({callInfo:e}){return(0,o.jsxs)(n.Box,{children:[(0,o.jsx)(a.default,{callStatusType:e.callStatusType,isEncrypted:e.isEncrypted}),(0,o.jsx)(r.default,{timestamp:e.timestamp,duration:e.duration,callerMri:e.callStatusType===l.CallStatusType.Missed?e.callerMri:void 0})]})};const i=s(197582),o=s(785893),n=s(344175),r=i.__importDefault(s(608300)),a=i.__importDefault(s(581980)),l=s(42733)},581980:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({callStatusType:e,preview:t,isEncrypted:s}){const{textStyle:i,previewTextStyle:d}=(0,a.useSkypeStyles)((({themeColors:{textDanger:t,textPrimary:s,textSecondary:i}})=>({textStyle:{fontSize:13,lineHeight:20,fontWeight:"500",color:(0,l.shouldGetWarningColor)(e)?t:s},previewTextStyle:{fontSize:12,lineHeight:14,fontWeight:"400",color:(0,l.shouldGetWarningColor)(e)?t:i}})),[e]);return(0,o.jsx)(n.Row,{children:(0,o.jsx)(r.Text,{style:t?d:i,children:s?h(e):u(e)},"call-status")})};const i=s(197582),o=s(785893),n=s(344175),r=s(537180),a=s(964414),l=s(42733),d=i.__importStar(s(704704)),c=i.__importDefault(s(760989));const u=e=>{switch(e){case l.CallStatusType.Started:return d.getString("CallCard.CallStartedStatusMessage");case l.CallStatusType.Missed:return d.getString("CallCard.CallMissedStatusMessage");case l.CallStatusType.Ended:return d.getString("CallCard.CallEndedStatusMessage");case l.CallStatusType.Declined:return d.getString("CallCard.CallDeclinedStatusMessage");case l.CallStatusType.NoAnswer:return d.getString("CallCard.CallNoAnswerStatusMessage");case l.CallStatusType.Failed:return d.getString("CallCard.CallFailedStatusMessage");default:return c.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}},h=e=>{switch(e){case l.CallStatusType.Started:return d.getString("CallCard.EncryptedCallStartedStatusMessage");case l.CallStatusType.Missed:return d.getString("CallCard.EncryptedCallMissedStatusMessage");case l.CallStatusType.Ended:return d.getString("CallCard.EncryptedCallEndedStatusMessage");case l.CallStatusType.Declined:return d.getString("CallCard.EncryptedCallDeclinedStatusMessage");case l.CallStatusType.NoAnswer:return d.getString("CallCard.EncryptedCallNoAnswerStatusMessage");case l.CallStatusType.Failed:return d.getString("CallCard.EncryptedCallFailedStatusMessage");default:return c.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}},42733:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateCallMarkerInfo=t.optionallySetStatusToNoAnswer=t.shouldGetWarningColor=t.CallStatusType=void 0;const i=s(197582),o=s(496486),n=s(167606),r=i.__importStar(s(657784)),a=s(189963),l=i.__importDefault(s(363091)),d=s(82485),c=i.__importDefault(s(760989)),u=i.__importStar(s(44717));var h;!function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended",e[e.Missed=2]="Missed",e[e.NoAnswer=3]="NoAnswer",e[e.Declined=4]="Declined",e[e.Failed=5]="Failed"}(h||(t.CallStatusType=h={}));t.shouldGetWarningColor=e=>{switch(e){case h.Started:case h.Ended:return!1;case h.Missed:case h.NoAnswer:case h.Failed:case h.Declined:return!0;default:return c.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}};t.optionallySetStatusToNoAnswer=(e,t)=>e===h.Missed?l.default.isMyMri(t)?h.NoAnswer:h.Missed:e;t.calculateCallMarkerInfo=(e,t)=>{let s=g(e);return t&&e.type!==r.CallCardType.Started&&(s=p(t,s)),s};const p=(e,t)=>{let s=t.type,i=t.duration;if(e)if(e.callState===a.CallState.Failed)s=h.Failed;else if(e.callState===a.CallState.Missed&&e.callDirection===a.CallDirection.Incoming)s=h.Missed;else if(e.callState===a.CallState.Missed&&e.callDirection===a.CallDirection.Outgoing)s=h.NoAnswer;else if(e.callState===a.CallState.Declined)s=h.Declined;else if(e.callState===a.CallState.Accepted&&e.callDirection===a.CallDirection.Outgoing&&e.forwardingInfo&&e.forwardingInfo.acceptedBy&&e.forwardingInfo.acceptedBy.type===a.ParticipantType.Voicemail)s=h.NoAnswer;else if(e.callState===a.CallState.Accepted&&e.callDirection===a.CallDirection.Outgoing&&e.callType===a.CallType.MultiParty&&1===(0,o.size)(e.participants))s=h.NoAnswer;else if(e.callState===a.CallState.Accepted&&(s=h.Ended,e.connectTime&&e.endTime)){const t=new Date(e.connectTime).getTime(),s=new Date(e.endTime).getTime();t&&s&&s>t&&(i=(0,o.floor)((s-t)/1e3))}return Object.assign(Object.assign({},t),{type:s,duration:i})},g=e=>{const t=!!e.conversationId&&u.isThread(e.conversationId),s=!!e.conversationId&&u.isPhoneMri(e.conversationId),i=!!e.conversationId&&u.isGroupConversation(e.conversationId),a=r.default.getCallCardUsers(e.children),l=(0,o.filter)(a,(e=>e.isParticipant));let c,p=h.Ended;const g=(0,o.size)(e.children),m=(0,o.size)(a),S=(0,o.size)(l);g!==m&&d.Instrumentation.warn(n.LogTraceArea.CallCard,`renderPartListNodeParts() user mismatch. tree: ${g} card: ${m} participants: ${S}type: ${p} thread: ${t} PSTN: ${s}`);const _=S>1;return e.type===r.CallCardType.Started?p=h.Started:i&&!_||!i&&e.type===r.CallCardType.Missed?p=h.Missed:(c=r.default.getCallUsersMaxDuration(a),p=h.Ended),{callId:e.callId,conversationId:e.conversationId,type:p,duration:c}}},127497:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getIcon=void 0,t.default=function({callStatusType:e,preview:s}){const{themeColors:{iconDanger:i,textPrimary:d}}=(0,r.useSkypeTheme)(),{iconStyle:u,previewIconStyle:h}=(0,a.useRXStyles)((()=>({iconStyle:{paddingRight:8},previewIconStyle:{paddingRight:3}})),[]);return(0,o.jsx)(n.default,{icon:(0,t.getIcon)(e),size:s?l.IconSize.size14:l.IconSize.size20,color:(0,c.shouldGetWarningColor)(e)?i:d,style:s?h:u},"call-status-icon")};const i=s(197582),o=s(785893),n=i.__importDefault(s(970035)),r=s(206315),a=s(964414),l=s(641400),d=i.__importDefault(s(760989)),c=s(42733);t.getIcon=e=>{switch(e){case c.CallStatusType.Started:case c.CallStatusType.Ended:return l.SkypeIcon.CallsInverted;case c.CallStatusType.Missed:return l.SkypeIcon.CallInFilled;case c.CallStatusType.NoAnswer:return l.SkypeIcon.CallOutFilled;case c.CallStatusType.Failed:case c.CallStatusType.Declined:return l.SkypeIcon.CallDisabled;default:return d.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}},81231:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(148540),r=s(667294),a=i.__importDefault(s(150343)),l=i.__importDefault(s(592097)),d=i.__importDefault(s(127497)),c=i.__importDefault(s(369347)),u=s(42733),h=i.__importDefault(s(839264)),p=s(44717),g=i.__importDefault(s(661088)),m=i.__importDefault(s(721841)),S=s(736267),_=s(964414),f=s(526849),y=i.__importDefault(s(535174));t.default=(0,f.WithResub)((0,r.memo)((({callInfo:e,callState:t,activeCallId:s,callerIdWarning:i})=>{const{isPresentedInDesktopContentPanel:r}=(0,S.useCommonContext)(),{boxStyle:c}=(0,_.useSkypeStyles)((({})=>({boxStyle:{marginStart:r?50:16}})),[r]);e.callStatusType=(0,u.optionallySetStatusToNoAnswer)(e.callStatusType,e.callerMri);const f=(0,o.jsx)(d.default,{callStatusType:e.callStatusType}),y=(0,o.jsx)(l.default,{callInfo:e}),v=e.callStatusType===u.CallStatusType.Started,C=(0,p.isGroupConversation)(e.conversationId),T=e.callId===s,M=a.default.getS4LMessagingFeaturesNoSubscription().enableSystemMessageJoinCallButton,b=t===n.CallState.None||t===n.CallState.Observing;let I;return v&&C?M&&T&&b&&(I=(0,o.jsx)(h.default,{conversationMri:e.conversationId})):I=(0,o.jsx)(g.default,{conversationMri:e.conversationId,callerIdWarning:i}),(0,o.jsx)(m.default,{additionalStyle:c,leftSlot:f,centerSlot:y,rightSlot:I})})),(e=>{const t=c.default.CallingStore.getCallState(e.callInfo.callId),s=c.default.ActiveCallUIHelper.getActiveCallInfo(e.callInfo.conversationId),i=null==s?void 0:s.callId,o=(0,p.getPhoneNumberFromMri)(e.callInfo.conversationId),n=y.default.callerIdWarningForCountryByPhoneNumber(o);return Object.assign(Object.assign({},e),{callState:t,activeCallId:i,callerIdWarning:n})}))},792629:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallSystemMessagePreview=void 0;const i=s(197582),o=s(785893),n=s(344175),r=i.__importStar(s(516778)),a=i.__importDefault(s(608300)),l=i.__importDefault(s(127497)),d=i.__importDefault(s(581980)),c=s(42733),u=s(964414);t.CallSystemMessagePreview=({callStatusType:e,callerMri:t,duration:s})=>{const{container:i}=(0,u.useRXStyles)((()=>({container:r.Styles.createTextStyle({width:150,height:22},!1)})),[]);return e=(0,c.optionallySetStatusToNoAnswer)(e,t),(0,o.jsx)(r.View,{style:i,children:(0,o.jsxs)(n.Row,{height:22,alignItems:"center",children:[(0,o.jsx)(l.default,{callStatusType:e,preview:!0}),(0,o.jsx)(d.default,{callStatusType:e,preview:!0}),(0,o.jsx)(a.default,{duration:s})]})})}},839264:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({conversationMri:e}){const{buttonStyle:t}=(0,m.useRXStyles)((({themeColors:{strokeHighContrast:e}})=>({buttonStyle:{borderRadius:25,borderColor:e,borderWidth:1}})),[]),s=(0,_.useCommonContext)(),i=(0,n.useCallback)((e=>{const t=g.default.newCauseId();d.Instrumentation.log(r.LogTraceArea.MessageStream,"onJoinCall, causeId: "+t),S.default.startCallOrMaybePrompt((()=>{}),s.rootViewId,{skypeMri:e,userIntent:f.StartCallOrMaybePromptUserIntent.Generic,showSmsOption:!1,callOrigin:u.NavigationCallOrigin.MessageStream,inviteOrigin:u.ContactInviteOrigin.MessageStream,showCallPreview:!0},t)}),[s.rootViewId]),y=c.getString("SystemMessage.JoinCall");return(0,o.jsx)(h.default,{title:y,accessibilityLabel:y,buttonSize:p.SXButtonSize.Small,style:t,buttonStyle:p.SXButtonStyle.AgnosticGradientFill,gradientDirection:a.GradientDirection.BOTTOM_RIGHT,agnosticGradientColor:l.AgnosticGradientFillButtonColors.green,onPress:()=>i(e)},"call-system-msg-join-call-button")};const i=s(197582),o=s(785893),n=s(667294),r=s(167606),a=s(854646),l=s(16549),d=s(82485),c=i.__importStar(s(704704)),u=s(815146),h=i.__importDefault(s(660401)),p=s(154235),g=i.__importDefault(s(760989)),m=s(964414),S=i.__importDefault(s(549173)),_=s(736267),f=s(619429)},661088:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({conversationMri:e,callerIdWarning:t}){const{rootViewId:s}=(0,y.useCommonContext)(),i=(0,n.useCallback)((()=>{v(e,s,t)}),[e,s,t]),{themeColors:{iconOnAccent:r,surfacePrimary:l}}=(0,m.useSkypeTheme)(),{buttonStyle:d}=(0,g.useRXStyles)((({themeColors:{strokeHighContrast:e}})=>({buttonStyle:{borderRadius:25,borderColor:e,borderWidth:1}})),[]);return(0,o.jsx)(a.default,{backgroundColor:l,style:d,iconColor:r,icon:h.SkypeIcon.CallsInverted,size:a.ActionButtonSize.Small,onPress:i},"call-system-msg-start-call-button")};const i=s(197582),o=s(785893),n=s(667294),r=s(167606),a=i.__importStar(s(187140)),l=i.__importDefault(s(369347)),d=s(82485),c=s(44717),u=s(815146),h=s(641400),p=i.__importDefault(s(760989)),g=s(964414),m=s(206315),S=i.__importDefault(s(872263)),_=i.__importDefault(s(808164)),f=i.__importDefault(s(740794)),y=s(736267);const v=(e,t,s)=>{const i=p.default.newCauseId();d.Instrumentation.log(r.LogTraceArea.CallNavigation,`[StartCallButton][onStartCall] causeId: ${i}`);const o=(0,c.getPhoneNumberFromMri)(e);if((0,c.isPhoneMri)(e)&&o&&s){S.default.clearState();const e=p.default.newCauseId(),s=_.default.normalizePartialNumberWithCountryCode(o);return void f.default.navigateToPSTNDialerWithParams({prefilledNumber:s,navigationSource:u.DialerNavigationSource.StartCallButton,causeId:e},t)}const n={conversationMri:e,withVideo:!1,origin:u.NavigationCallOrigin.SystemMessageStartCall};(0,c.isGroupConversation)(e)?l.default.CallNavigationHelper.startCallWithPreview(n,i):l.default.CallNavigationHelper.startCall(n,i)}},721841:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({leftSlot:e,centerSlot:t,rightSlot:s,isPreview:i,useColumnDirection:c,additionalStyle:u}){const{isPresentedByMobileStackNavigator:h,isPresentedInDesktopContentPanel:p}=(0,r.useCommonContext)(),{mode:{isAccessible:g}}=(0,l.useSkypeTheme)(),{rowStyle:m}=(0,a.useSkypeStyles)((({themeColors:{surfacePrimary:e,surfaceQuaternary:t,strokeHighContrast:s}})=>({rowStyle:{borderRadius:8,borderColor:s,borderWidth:1,backgroundColor:g?e:t,marginHorizontal:48,marginVertical:10,padding:16,maxWidth:h?320:450,minWidth:p?260:220,width:"100%"}})),[g,h,p]);return i?(0,o.jsx)(d.default,{reactParts:t}):(0,o.jsx)(n.Box,{style:u,alignItems:"center",children:(0,o.jsxs)(n.Row,{style:m,flexDirection:c?"column":"row",children:[(0,o.jsx)(n.Column,{justifyContent:"center",alignItems:"center",children:e}),(0,o.jsx)(n.Column,{flex:1,justifyContent:"center",children:t}),(0,o.jsx)(n.Column,{justifyContent:"center",alignItems:"center",children:s})]})})};const i=s(197582),o=s(785893),n=s(344175),r=s(736267),a=s(964414),l=s(206315),d=i.__importDefault(s(156993))},156993:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({reactParts:e}){const{textStyle:t}=(0,n.useSkypeStyles)((({themeColors:{textPrimary:e}})=>({textStyle:{color:e,fontWeight:"normal"}})),[]);return(0,i.jsx)(o.Text,{selectable:!1,numberOfLines:1,ellipsizeMode:"tail",style:t,children:e})};const i=s(785893),o=s(537180),n=s(964414)},522778:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({text:e,mri:t,isPreview:s}){const i=(0,r.useCallback)((()=>{t&&d.default.showDetailsPanelWithParams({mri:t,showConversationSettings:!0,rootViewId:l.MainRootViewId,causeId:p.default.newCauseId()})}),[t]);return(0,o.jsx)(a.Text,{children:(0,o.jsxs)(a.View,{style:m.wrapper,children:[t?(0,o.jsx)(a.Text,{children:(0,o.jsx)(h.default,{size:c.UserIconSize.Size14,userMri:t,hideBorder:!0,style:S.avatar})}):null,(0,o.jsx)(u.default,{text:e,onPress:t?i:void 0,isPreview:s,useSemiBold:!s})]})})};const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(667294),a=s(537180),l=s(154235),d=i.__importDefault(s(740794)),c=s(596648),u=i.__importDefault(s(624882)),h=i.__importDefault(s(403396)),p=i.__importDefault(s(760989)),g=s(26703),m=a.StyleSheet.create({wrapper:{flexGrow:0,flexShrink:1,flexDirection:"row",alignItems:"center"}}),S=(0,g.lazyProperties)({avatar:()=>n.Styles.createViewStyle({marginBottom:-2,marginRight:3})})},624882:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({text:e,isPreview:t,onPress:s,useSemiBold:i}){const{textStyle:l}=(0,a.useSkypeStyles)((({themeColors:{textPrimary:e}})=>({textStyle:{color:e,fontSize:t?14:12,fontWeight:i?"600":"400",fontFamily:i?r.default.fontFamily.uidDisplaySemibold:void 0}})),[t,i]);return(0,o.jsx)(n.Text,{style:l,onPress:t?void 0:s,children:e})};const i=s(197582),o=s(785893),n=s(537180),r=i.__importDefault(s(20758)),a=s(964414)},143581:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({text:e,isPreview:t}){const s=(0,o.jsx)(r.default,{text:e});return(0,o.jsx)(n.default,{centerSlot:s,isPreview:t})};const i=s(197582),o=s(785893),n=i.__importDefault(s(721841)),r=i.__importDefault(s(624882))},605507:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.renderLinkAsPreview=t.renderReact=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(823719)),r=i.__importStar(s(496486)),a=i.__importStar(s(516778)),l=s(389008),d=s(217041),c=i.__importStar(s(623627)),u=i.__importDefault(s(150343)),h=i.__importDefault(s(398745)),p=i.__importDefault(s(300047)),g=s(852930),m=i.__importDefault(s(957895)),S=s(657784),_=i.__importDefault(s(385213)),f=i.__importDefault(s(460072)),y=s(186754),v=i.__importDefault(s(788286)),C=i.__importDefault(s(859545)),T=i.__importStar(s(63484)),M=i.__importStar(s(971988)),b=i.__importStar(s(44717)),I=s(154235),w=i.__importDefault(s(827064)),P=i.__importDefault(s(348047)),k=s(656472),A=i.__importStar(s(194504)),x=i.__importStar(s(591312)),D=i.__importStar(s(463519)),R=s(196509),L=s(229620),B=i.__importStar(s(242561)),F=s(815146),N=s(495681),E=i.__importDefault(s(513612)),O=i.__importDefault(s(575354)),U=s(287167),V=s(183049),H=s(789439),j=i.__importStar(s(7040)),z=i.__importStar(s(85385)),W=s(26703),G=i.__importStar(s(50350)),K=i.__importDefault(s(778408)),q=i.__importStar(s(704704)),Q=i.__importDefault(s(313599)),X=i.__importDefault(s(928109)),$=i.__importDefault(s(253829)),J=s(781035),Y=i.__importStar(s(606933)),Z=i.__importDefault(s(379610)),ee=i.__importStar(s(954225)),te=s(203705),se=i.__importDefault(s(363091)),ie=s(638340),oe=s(548056),ne=i.__importDefault(s(915845)),re=i.__importDefault(s(200750)),ae=s(789603),le=s(643833),de=i.__importDefault(s(472126)),ce=i.__importDefault(s(655192)),ue=i.__importDefault(s(778098)),he=i.__importDefault(s(212803)),pe=i.__importDefault(s(374137)),ge=i.__importDefault(s(405119)),me=s(16549),Se=i.__importDefault(s(20758)),_e=s(641400),fe=i.__importDefault(s(827361)),ye=i.__importDefault(s(435243)),ve=i.__importDefault(s(220534)),Ce=i.__importDefault(s(760989)),Te=i.__importDefault(s(606617)),Me=i.__importDefault(s(224672)),be=i.__importDefault(s(369347)),Ie=s(847394),we=s(187180),Pe=s(82021),ke=i.__importDefault(s(81231)),Ae=s(792629),xe=i.__importDefault(s(423046)),De=i.__importDefault(s(454547)),Re=i.__importDefault(s(180914)),Le=i.__importDefault(s(517400)),Be=s(119735),Fe=s(470177),Ne=s(493680),Ee=s(42733),Oe=i.__importDefault(s(143581)),Ue=i.__importDefault(s(721841)),Ve=i.__importDefault(s(624882)),He=i.__importDefault(s(522778)),je=i.__importDefault(s(393625)),ze=i.__importDefault(s(171267)),We=i.__importDefault(s(222004)),Ge=i.__importDefault(s(787723)),Ke=i.__importDefault(s(740794)),qe=s(55544),Qe=s(464029),Xe=s(384406),$e=ee.messageTextLineHeight,Je=oe.frameHeights.emoticons.SMALL+2,Ye=(0,W.lazyProperties)({onlyEmoticonsStyleExtraExtraLarge:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size120+8},!1),onlyEmoticonsStyleExtraLarge:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size80},!1),onlyEmoticonsStyleLarge:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size40},!1),onlyEmoticonsStyleMedium:()=>a.Styles.createViewStyle({margin:4,width:oe.frameHeights.emoticons.Size32},!1),onlyEmojiStyleSmallVerticalAlign:()=>a.Styles.createTextStyle({verticalAlign:"text-bottom",marginHorizontal:2,width:oe.frameHeights.emoticons.SMALL},!1),onlyEmoticonsStyleSmall:()=>a.Styles.createTextStyle({paddingTop:4,paddingLeft:2,width:oe.frameHeights.emoticons.SMALL+4,height:Je,overflow:"visible"},!1),onlyEmoticonsStyleSmallNoText:()=>a.Styles.createTextStyle({paddingTop:0},!1),onlyEmojiStyleExtraExtraLarge:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size120,fontStyle:"normal",fontSize:90},!1),onlyEmojiStyleExtraLarge:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size80,fontStyle:"normal",fontSize:63},!1),onlyEmojiStyleLarge:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size40,fontStyle:"normal",fontSize:30},!1),onlyEmojiStyleMedium:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.Size32,fontStyle:"normal",fontSize:22},!1),onlyEmojiStyleSmall:()=>a.Styles.createTextStyle({lineHeight:oe.frameHeights.emoticons.SMALL,fontStyle:"normal",fontSize:15},!1),smallEmojiDesktopRenderNormalization:()=>a.Styles.createTextStyle({top:2,paddingRight:2},!1),horizontalPadding:()=>a.Styles.createViewStyle({paddingHorizontal:2},!1)});class Ze extends A.TransformerBase{constructor(e,t,s){super(),this._root=t,this._key=0,this.transformEditMessageMetaDataNode=this._skip,this.transformLegacyQuoteNode=this._skip,this._onExecuteAdaptiveCardAction=e=>{if(e.type!==l.Types.ActionTypes.actionOpenUrl)return;const t=e;t&&ve.default.isUrlValid(t.url)&&(t.preview?Z.default.viewLink(t.url,I.MainRootViewId):G.openUrl(F.BrowserOrigin.AdaptiveCard,t.url,I.MainRootViewId))},this.transformUnknownNode=this._renderChildren,this.transformTextWrapperNode=this._skip,this.transformTargetUserNode=this._skip,this.transformTargetLegacyUserNode=this._skip,this.transformTargetRoleNode=this._skip,this.transformTargetsNode=this._skip,this.transformMetaNode=this._skip,this.transformUriObjectNode=this._renderChildren,this.transformSkypeVideoMessageNode=this._renderChildren,this.transformPartNode=this._skip,this.transformEndedNode=this._skip,this.transformGuestNameUpdateTargetNode=r.identity,this._renderStringParts=(e,t)=>{const s=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages;return r.flatMap(e,((e,i)=>r.isString(e)?s?(0,o.jsx)(Ve.default,{text:e,isPreview:!this._options.renderMedia},this._generateReactKey(t,i)):(0,o.jsx)(a.Text,{style:r.compact([this._options.systemTextStyle,this._options.textOverrideStyle]),selectable:!this._useInheritedStyle&&this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,children:e},this._generateReactKey(t,i)):r.isArray(e)?this._renderStringParts(e):e))},this._renderArbitraryText=(e,t)=>{const s=D.decodeFromContent(e),i=r.clone(this._options);return i.textOverrideStyle=r.flatten(r.compact([i.textOverrideStyle,t])),new Ze(i,this._root,this._searchStore).transform(s)},this._renderTextNode=(e,t)=>{const s=r.clone(this._options);return s.textOverrideStyle=r.flatten(r.compact([s.textOverrideStyle,t])),new Ze(s,this._root,this._searchStore).transform(e)},this._formatListAsDisplayNames=e=>{const t=[];return r.each(e,((s,i)=>{t.push(this._formatAsDisplayName(s)),i!==e.length-1&&t.push((0,o.jsx)(a.Text,{style:r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,children:", "},","+i))})),t},this._formatAsDisplayName=(e,t="")=>(0,o.jsx)(L.DisplayName,{mri:e,fallbackText:t,renderName:this._formatParticipantName},this._appendUniqueKeyValue(e)),this._formatParticipantName=(e,t,s)=>u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages?(0,o.jsx)(He.default,{text:e,mri:t,isPreview:!this._options.renderMedia}):(0,o.jsx)(a.Text,{style:r.compact([this._options.systemEmphasisTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,children:e},this._appendUniqueKeyValue(e)),this._formatAtMentionParticipantName=e=>this._formatParticipantName("@"+e),this._renderMessageParts=(e,t)=>{const s=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,i=this._renderStringParts(e,t);return(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:s?void 0:this._options.numberOfLines||0,forceLayoutInRTL:this._options.forceLayoutInRTL,forceDirection:!0,children:i},this._appendUniqueKeyValue("localizeParts"))},this._options=this._optionsWithDefaults(e),this._searchStore=s,this._useInheritedStyle=!!this._options.inheritColor}static _getDefaultOptions(e){const t=Math.round(e);return Ze._defaultOptions[t]||(Ze._defaultOptions[t]={message:void 0,onlyEmoticons:!1,numberOfEmoticons:0,onlyUnicodeEmoji:!1,numberOfUnicodeEmoji:0,processing:{},lineBreakString:"\n",renderMedia:!0,mediaPlaceholderIconColor:me.Color.gray400,blurMedia:!1,allowTextSelection:!1,allowClickableLinks:!0,regularTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,letterSpacing:-.2,fontFamily:Se.default.fontFamily.uidDisplayRegular,color:me.Color.gray400,alignSelf:"stretch",backgroundColor:me.Color.transparent},!1),italicTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,fontStyle:"italic",backgroundColor:me.Color.transparent},!1),boldTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,font:Se.default.font.uiDisplaySemibold,backgroundColor:me.Color.transparent},!1),strikeThroughStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,textDecorationLine:"line-through",backgroundColor:me.Color.transparent},!1),preTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,fontFamily:Se.default.fontFamily.monospace,fontStyle:"normal"},!1),listStyle:a.Styles.createViewStyle({flexDirection:"column",paddingLeft:24},!1),nestedListStyle:a.Styles.createViewStyle({flexDirection:"column",paddingLeft:24},!1),listItemStyle:a.Styles.createViewStyle({flexDirection:"row",paddingLeft:0,marginBottom:0},!1),listItemContentStyle:a.Styles.createTextStyle({flexShrink:1,fontSize:t},!1),listItemPrefixStyle:a.Styles.createTextStyle({alignSelf:"flex-start",paddingRight:6,fontSize:t},!1),systemTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,fontFamily:Se.default.fontFamily.uidDisplayRegular,color:me.Color.gray400},!1),systemEmphasisTextStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,font:Se.default.font.uiDisplaySemibold,color:me.Color.gray400},!1),atMentionStyle:a.Styles.createTextStyle({font:Se.default.font.uiDisplaySemibold,color:me.Color.gray400},!1),quotedTextStyle:a.Styles.createTextStyle(u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?{color:me.Color.gray400,fontSize:t,lineHeight:$e}:{color:me.Color.gray400,fontSize:t,lineHeight:$e,fontStyle:"italic"},!1),quoteAttributeStyle:a.Styles.createTextStyle({color:me.Color.gray400,fontSize:Se.default.controlFontSize.bodySmallDeprecated,lineHeight:18,font:Se.default.font.uiDisplayRegular},!1),quoteSeparatorStyle:a.Styles.createViewStyle({borderColor:me.Color.gray300,borderBottomWidth:1},!1),linkStyle:a.Styles.createTextStyle({fontSize:t,lineHeight:$e,color:me.Color.white,fontFamily:Se.default.fontFamily.uidDisplayRegular,textDecorationLine:"underline"},!1),imageCreatorContainerRadiusStyle:a.Styles.createViewStyle({borderBottomLeftRadius:0,borderBottomRightRadius:0},!1),footNoteTextStyle:a.Styles.createTextStyle({fontSize:10,lineHeight:12},!1),renderSimpleAtMentions:!1,linkedMessages:[],hasTranslation:!1,attributions:new Map}),Ze._defaultOptions[t]}_optionsWithDefaults(e){const t=e.fontSize||Se.default.controlFontSize.messageStreamItemDesktop;return r.defaults(e,Ze._getDefaultOptions(t))}_renderChildren(e){return this._renderReactNodes(e.children)}_skip(){return{value:null,stopProcessing:!1,renderAsInline:!0}}_aggregateInlines(e,t,s,i,n){const l=[];let d=[];if(r.each(e,(e=>{r.isString(e)?d.push(e):(d.length&&(l.push(d.join("")),d=[]),l.push(e))})),d.length&&l.push(d.join("")),l.length>1&&!i){const e=r.flatten(r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]));return s?l:r.map(l,(s=>r.isString(s)?(0,o.jsx)(a.Text,{style:e,selectable:this._options.allowTextSelection,forceDirection:n,textBreakStrategy:"simple",children:s},this._appendUniqueKeyValue(t)):s))}if(1!==l.length||!s&&r.isString(l[0])||i&&l[0].type!==a.Text){const e=r.flatten(r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]));return[(0,o.jsx)(a.Text,{ref:this._options.onSelectableText,selectable:!this._useInheritedStyle&&this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,style:e,allowFontScaling:this._options.allowFontScaling,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,forceLayoutInRTL:this._options.forceLayoutInRTL,forceDirection:n||void 0,textBreakStrategy:"simple",children:l},t)]}return l}_renderReactNodes(e,t=!1,s){const i=[];let o,n=[],a=!1,l=!0;const d=e.length;for(let c=0;c<d;c++){let d;const u=e[c];if(u?(d=u.accept(this),d||(d=this._skip())):d=this._skip(),d.value&&(o=(void 0===o||o)&&d.forceDirection,d.renderAsInline?r.isArray(d.value)?n=n.concat(d.value):n.push(d.value):(l=!1,n.length>0&&(i.push(...this._aggregateInlines(n,this._appendUniqueKeyValue("inline"),t,!!s,d.forceDirection)),n=[]),i.push(d.value))),d.stopProcessing){a=!0;break}}n.length>0&&i.push(...this._aggregateInlines(n,this._appendUniqueKeyValue("inline"),t,!!s,o));let c=null;return 1===i.length?c=i[0]:i.length>1&&(c=i),{value:c,stopProcessing:a,renderAsInline:l}}_useLargeEmoticons(){const{allowLargeEmoticons:e,onlyEmoticons:t,onlyUnicodeEmoji:s,numberOfEmoticons:i,numberOfUnicodeEmoji:o}=this._options;return!!e&&(t&&i<=3||s&&o<=3)}_generateReactKey(e,...t){return this._appendUniqueKeyValue(e?e.getTag():"_")+t.join("")}_appendUniqueKeyValue(e){return this._key++,e+this._key.toString()}transform(e){return e.accept(this)}transformRootNode(e){return this._useLargeEmoticons()?this._renderReactNodes(e.children,!1,!1):this._renderReactNodes(e.children,!1,!0)}transformPlainTextNode(e){return this._renderPlainText(e.getRawText(),e)}transformHighlightedNode(e,t,s,i){if(!e.children)return{value:null,stopProcessing:!1};const n=this._renderReactNodes(e.children,!0,!1);return Object.assign(Object.assign({},n),{value:(0,o.jsx)(V.HighlightedNode,{isPrimarySearchResult:!!t,allowTextSelection:this._options.allowTextSelection,textOverrideStyle:this._options.textOverrideStyle,isOwnMessage:!!s,isGlobalSearch:!!i,children:n.value},this._generateReactKey(e))})}_renderSingleLine(e,t){return{value:e,stopProcessing:!1}}_renderLineBreak(e){return this._options.trimToFirstLine?{value:null,stopProcessing:!0,renderAsInline:!0}:{value:this._options.lineBreakString,stopProcessing:!1,renderAsInline:!0}}transformAtMentionNode(e){if(!this._options.renderSimpleAtMentions)switch(this._options.processing.atMentions){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t=!1;const s=Ce.default.unescapeXml(e.id);let i;"*"===s?t=!0:(i=b.isMri(s)?s:b.skypeIdToMri(s),se.default.isMyMri(i)&&(t=!0));const n=r.compact([this._options.regularTextStyle,this._options.textOverrideStyle,this._options.atMentionStyle,fe.default.pointerCursor]);t&&this._options.atMentionMeOverrideStyle&&n.push(this._options.atMentionMeOverrideStyle);const a=r.clone(this._options);a.textOverrideStyle=n;let l=e.children;e.isAllMention()&&(l=[Y.PlainTextNode.fromPlainText(e.getLocalizedAllMention())]);const d=new Ze(a,this._root,this._searchStore)._renderReactNodes(l),c=C.default.navigation().canAccessUserDetails&&!t&&!e.isInQuote();return{value:(0,o.jsx)(h.default,{style:n,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines,allowFontScaling:this._options.allowFontScaling,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,onPressProfileMriToShow:c?i:void 0,onContextMenu:this._options.onContextMenu,onPressInterceptionCallback:this._options.onPressInterceptionCallback,renderSimpleAtMention:this._options.renderSimpleAtMentions,skipAtSymbol:e.isLegacyAtMention,children:d.value},this._generateReactKey(e)),stopProcessing:d.stopProcessing,renderAsInline:!0}}transformUserMriNode(e){return{value:this._formatAsDisplayName(Ce.default.unescapeXml(e.mri),Ce.default.unescapeXml(e.textNode.getRawText())),stopProcessing:!1,renderAsInline:!0}}transformUnicodeEmojiNode(e){const t=this._useLargeEmoticons();let s,i;switch(s=t&&1===this._options.numberOfUnicodeEmoji?this._options.singleEmoticonSize||this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraExtraLarge:t?this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraLarge:c.Size.Small,t&&!this._options.allowHugeEmoticons&&(s=c.Size.Large),this._unicodeEmojiColorStyle||(this._unicodeEmojiColorStyle=a.Styles.createTextStyle({color:this._options.mediaPlaceholderIconColor},!1)),s){case c.Size.Small:i=[Ye.onlyEmojiStyleSmall,this._unicodeEmojiColorStyle],i=[Ye.onlyEmojiStyleSmall,this._unicodeEmojiColorStyle,Ye.smallEmojiDesktopRenderNormalization];break;case c.Size.Medium:i=[Ye.onlyEmojiStyleMedium,this._unicodeEmojiColorStyle];break;case c.Size.Large:i=[Ye.onlyEmojiStyleLarge,this._unicodeEmojiColorStyle];break;case c.Size.ExtraLarge:i=[Ye.onlyEmojiStyleExtraLarge,this._unicodeEmojiColorStyle];break;case c.Size.ExtraExtraLarge:i=[Ye.onlyEmojiStyleExtraExtraLarge,this._unicodeEmojiColorStyle]}return{value:(0,o.jsx)(a.Text,{style:i,selectable:this._options.allowTextSelection,children:e.emojiTextNode.getRawText()},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformEmoticonNode(e){switch(this._options.processing.emoticons){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=Ce.default.unescapeXml(e.type),s=e.children[0].getRawText()||"",i=A.trimToFirstLineIfNeeded(s,!!this._options.trimToFirstLine),n=this._useLargeEmoticons();let r,a=[];switch(r=n&&1===this._options.numberOfEmoticons?this._options.singleEmoticonSize||this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraExtraLarge:n?this._options.emoticonsOnlyEmoticonSize||c.Size.ExtraLarge:c.Size.Small,n&&!this._options.allowHugeEmoticons&&(r=c.Size.Large),r){case c.Size.Small:a=[Ye.onlyEmojiStyleSmallVerticalAlign];break;case c.Size.Medium:a=[Ye.onlyEmoticonsStyleMedium];break;case c.Size.Large:a=[Ye.onlyEmoticonsStyleLarge];break;case c.Size.ExtraLarge:a=[Ye.onlyEmoticonsStyleExtraLarge];break;case c.Size.ExtraExtraLarge:a=[Ye.onlyEmoticonsStyleExtraExtraLarge]}return{value:(0,o.jsx)(c.AnimatedEmoticon,{innerText:i.value,emoticonName:t,size:r,style:a,preventSelectable:!this._options.allowTextSelection,onlyRenderFallbackText:this._options.textOnlyForEmoticons,isStatic:this._options.forceStaticAnimatedEmoticons,allowTextFallback:this._options.allowTextFallbackEmoticons,showPlaceHolder:this._options.showPlaceholderEmoticons,placeholderBackgroundColor:this._options.placeholderBackgroundColor,fallbackTextStyle:!n&&this._options.textOverrideStyle?this._options.textOverrideStyle:void 0,tone:e.tone},this._generateReactKey(e)),stopProcessing:i.stopProcessing,renderAsInline:i.renderAsInline}}transformFlagNode(e){switch(this._options.processing.emoticons){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}return this._renderReactNodes(e.children)}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent){return{value:(0,o.jsx)(ae.QuoteOnly,{mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),stopProcessing:!0,renderAsInline:!0}}switch(this._options.processing.quotes){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=this._options.renderOrigin===B.MessageRenderOrigin.ChatCanvas||this._options.renderOrigin===B.MessageRenderOrigin.CallCanvas;let s=this._options.numberOfLines||(t?void 0:1);const i=r.clone(this._options);i.onlyEmoticons=!1,i.inheritColor=!0,i.numberOfLines=s,i.maxContentSizeMultiplier=this._options.maxContentSizeMultiplier&&Math.min(this._options.maxContentSizeMultiplier,Ze._maxContentSizeMultiplierForQuotes),i.allowTextSelection=!1;const n=new Ze(i,this._root,this._searchStore)._renderReactNodes(e.children),a=!e.children.some((e=>e instanceof Y.UriObjectNode||e instanceof Y.ContactNode||e instanceof Y.PictureNode||e instanceof Y.VideoNode||e instanceof Y.VideoMessageNode||e instanceof Y.LocationNode||e instanceof Y.AudioNode||e instanceof Y.AudioMessageNode||e instanceof Y.UnknownNode)),l=e.author&&Ce.default.unescapeXml(e.author),d=e.authorname&&Ce.default.unescapeXml(e.authorname),c=this._options.renderOrigin===B.MessageRenderOrigin.MessageComposerCanvas&&e.conversation&&be.default.ActiveCallUIHelper.hasActiveCall(e.conversation);return{value:u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?(0,o.jsx)(le.QuoteNodeRedesign,{onlyInlineNodeChildren:a,children:n.value,options:this._options,conversationId:e.conversation,messageTimestamp:Number(e.messageid),numberOfLines:s||0,authorSkypeId:l,authorname:d,timestamp:1e3*e.timestamp,message:this._options.message,onContextMenu:this._options.onContextMenu,searchStore:this._searchStore,narrowView:c},this._generateReactKey(e)):(0,o.jsx)(ae.QuoteNode,{children:n.value,options:this._options,conversationId:e.conversation,messageTimestamp:Number(e.messageid),numberOfLines:s||0,authorSkypeId:l,authorname:d,timestamp:1e3*e.timestamp,message:this._options.message,onContextMenu:this._options.onContextMenu,searchStore:this._searchStore,narrowView:c},this._generateReactKey(e)),stopProcessing:n.stopProcessing,renderAsInline:!1}}transformWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t;switch(e.getTag()){case"i":t=this._options.italicTextStyle;break;case"b":t=this._options.boldTextStyle;break;case"s":t=this._options.strikeThroughStyle;break;case"pre":t=this._options.preTextStyle;break;default:t=this._options.regularTextStyle}const s=r.every(e.children,(e=>e instanceof Y.PlainTextNode)),i=r.flatten(r.compact([this._options.textOverrideStyle,t])),n=r.clone(this._options);n.textOverrideStyle=i;const l=new Ze(n,this._root,this._searchStore)._renderReactNodes(e.children,s),d={style:i,key:this._generateReactKey(e),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0};return{value:l.renderAsInline?(0,o.jsx)(a.Text,Object.assign({},d,{selectable:this._options.allowTextSelection,children:l.value})):(0,o.jsx)(a.View,Object.assign({},d,{children:l.value})),stopProcessing:l.stopProcessing,renderAsInline:l.renderAsInline}}transformListWikiMarkupNode(e){if(this._options.trimToFirstLine)return{value:this._options.startsWithWikiMarkupList?this._renderReactNodes([e.children[0]]).value:null,stopProcessing:!0,renderAsInline:!0};switch(this._options.processing.wikiMarkup){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}let t;switch(e.getTag()){case"ul":case"ol":t=e.level?this._options.nestedListStyle:this._options.listStyle;break;case"li":t=this._options.listItemStyle;break;default:t=this._options.regularTextStyle}const s=e.children.every((e=>e instanceof Y.PlainTextNode)),i=r.flatten([this._options.textOverrideStyle,t].filter((e=>!!e))),n=Object.assign({},this._options);if(n.textOverrideStyle=i,"li"===e.getTag())return this._renderListItem(e,n);const l=new Ze(n,this._root,this._searchStore)._renderReactNodes(e.children.filter((e=>!(e instanceof Y.PlainTextNode&&["\n","\r"].includes(e.getRawText())))),s),d=!["ul","ol"].includes(e.getTag())&&l.renderAsInline,c={style:i,key:this._generateReactKey(e),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0},u=d?a.Text:a.View;return{value:(0,o.jsx)(u,Object.assign({},c,{children:l.value})),stopProcessing:l.stopProcessing,renderAsInline:d}}_renderListItem(e,t){const s=new Ze(t,this._root,this._searchStore);let i=e.children.findIndex((e=>{var t;return["ul","ol"].includes(null!==(t=null==e?void 0:e.getTag())&&void 0!==t?t:"")})),n=null;-1===i?i=e.children.length:n=s._renderReactNodes([e.children[i]]);const r=e.children.slice(0,i),l=s._renderReactNodes(r.filter((e=>!(e instanceof Y.PlainTextNode&&["\n","\r"].includes(e.getRawText()))))),d=l.renderAsInline?a.Text:a.View,c=(0,o.jsx)(d,{children:l.value}),u=e.ordered?e.order+". ":{0:"⦁ ",1:"⚬ "}[e.level||0]||"▪ ",h=s._renderReactNodes([Y.PlainTextNode.fromPlainText(u)]).value;return{value:(0,o.jsxs)(a.View,{children:[(0,o.jsxs)(a.View,{style:this._options.listItemStyle,children:[(0,o.jsx)(a.Text,{style:this._options.listItemPrefixStyle,selectable:!1,children:h}),(0,o.jsx)(a.View,{style:this._options.listItemContentStyle,children:c})]}),null==n?void 0:n.value]},this._generateReactKey(e)),stopProcessing:(null==n?void 0:n.stopProcessing)||l.stopProcessing,renderAsInline:!1}}transformLinkNode(e){switch(this._options.processing.links){case B.ProcessingLevel.None:return this._skip();case B.ProcessingLevel.Stripped:return this._renderReactNodes(e.children)}const t=e.getSanitizedHref();if(!t)return this._renderReactNodes(e.children);this._useInheritedStyle=!0;const s=r.flatten(r.compact([this._options.textOverrideStyle,fe.default.pointerCursor])),i=r.clone(this._options);i.onSelectableText=void 0,i.textOverrideStyle=s;const n=new Ze(i,this._root,this._searchStore)._renderReactNodes(e.children,!1);this._useInheritedStyle=!1;return{value:(0,o.jsx)(K.default,{message:this._options.message,decodedNode:this._root,style:r.compact([this._options.linkStyle,this._options.textOverrideStyle]),url:t,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,numberOfLines:this._options.numberOfLines||0,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback,children:n.value},this._generateReactKey(e)),stopProcessing:n.stopProcessing,renderAsInline:!0}}transformAttributionNode(e){var t,s;if(this._options.processing.links===B.ProcessingLevel.None)return this._skip();if(this._options.processing.links===B.ProcessingLevel.Stripped)return this._renderReactNodes(e.children);if(!e.getSanitizedHref())return this._renderReactNodes(e.children);let i;if(e.index)this._options.attributions.set(e.index,e);else{this._useInheritedStyle=!0;const t=r.flatten([this._options.textOverrideStyle,fe.default.pointerCursor].filter((e=>!!e))),s=Object.assign({},this._options);s.onSelectableText=void 0,s.textOverrideStyle=t,i=new Ze(s,this._root,this._searchStore)._renderReactNodes(e.children,!1),this._useInheritedStyle=!1}return{value:(0,o.jsx)(Ie.AttributionNode,{node:e,attributions:this._options.attributions,message:this._options.message,decodedNode:this._root,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback,children:null!==(t=null==i?void 0:i.value)&&void 0!==t?t:e.index},this._generateReactKey(e)),stopProcessing:null!==(s=null==i?void 0:i.stopProcessing)&&void 0!==s&&s,renderAsInline:!0}}transformAttributionsTextNode(e){if(this._options.processing.links===B.ProcessingLevel.None)return this._skip();if(this._options.processing.links===B.ProcessingLevel.Stripped)return this._renderReactNodes(e.children);const t=Object.assign(Object.assign({},this._options),{textOverrideStyle:r.flatten([this._options.textOverrideStyle,a.Styles.createTextStyle({cursor:"inherit"},!1)].filter((e=>!!e))),onSelectableText:void 0}),s=new Ze(t,this._root,this._searchStore)._renderReactNodes(e.children,!1);return{value:(0,o.jsx)(Pe.AttributionsTextNode,{href:e.getSanitizedHref(),attributions:this._options.attributions,message:this._options.message,decodedNode:this._root,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,renderOrigin:this._options.renderOrigin,children:s.value},this._generateReactKey(e)),stopProcessing:null==s?void 0:s.stopProcessing,renderAsInline:!0}}transformAttributionsGroupNode(e){const t=Object.assign(Object.assign({},this._options),{attributions:new Map}),s=e.children.filter((e=>!(e instanceof Y.PlainTextNode)||""!==e.getRawText().trim())),i=new Ze(t,this._root,this._searchStore)._renderReactNodes(s,!1,!0);return t.attributions.forEach(((e,t)=>this._options.attributions.set(t,e))),Object.assign(Object.assign({},i),{value:(0,o.jsx)(a.Text,{children:i.value},this._generateReactKey(e))})}transformBingResponseNode(e){this._options.attributions=new Map;const t=this._renderReactNodes(e.children,!1,!0),s=[...this._options.attributions.entries()].sort((([e],[t])=>+e-+t)).map((e=>e[1]));return{value:(0,o.jsx)(we.BingResponseNode,{attributions:s,message:this._options.message,decodedNode:this._root,messageActions:this._options.messageActions,linkSelectable:this._options.allowTextSelection,linkClickable:this._options.allowClickableLinks,supportsCopy:!!this._options.supportsCopy,onLongPress:this._options.overrideLongPressForLinks?this._options.onLongPressContent:void 0,onEdit:this._options.onEdit,onQuote:this._options.onQuote,renderOrigin:this._options.renderOrigin,onPressInterceptionCallback:this._options.onPressInterceptionCallback,numberOfLines:this._options.numberOfLines,children:t.value},this._generateReactKey(e)),stopProcessing:null==t?void 0:t.stopProcessing,renderAsInline:!1}}transformDeepLinkNode(e){const t=e.children.find((e=>e instanceof Y.ContextNode));let s=null;if(t){const{text:e,deeplink:i,icon:n}=t.encodedAttr();"string"!=typeof e||"string"!=typeof i||n&&"string"!=typeof n||(s=(0,o.jsx)(je.default,{text:e,actionUri:i,icon:n}))}return{value:s,stopProcessing:!1,renderAsInline:!0}}transformEmoteNode(e){const t=this._renderReactNodes(e.children,!0);return{value:[this._formatAsDisplayName(Ce.default.unescapeXml(e.escapedAuthorMri),Ce.default.unescapeXml(e.escapedFallbackText)),(0,o.jsx)(a.Text,{style:r.compact([this._options.regularTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,maxContentSizeMultiplier:this._options.maxContentSizeMultiplier,children:" "},e.escapedAuthorMri||e.escapedFallbackText)].concat(t.value),stopProcessing:t.stopProcessing,renderAsInline:!0}}transformSuggestedTextHighlightNode(e){const t=this._renderReactNodes(e.children,!0);return{value:(0,o.jsx)(ue.default,{style:r.compact([this._options.regularTextStyle,this._options.linkStyle,this._options.textOverrideStyle]),activityId:e.getActivityId(),text:e.getPhrase(),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,onHighlightedTextPressed:this._options.onPressSuggestedTextHighlight,children:t.value},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformContextNode(e){return{value:null,stopProcessing:!1,renderAsInline:!0}}transformRosterContextNode(){return{value:null,stopProcessing:!0,renderAsInline:!0}}transformLocationContextNode(){return{value:null,stopProcessing:!0,renderAsInline:!0}}transformSwiftUriObjectNode(e){if(this._options.renderMedia&&e.swiftChild)return this._renderReactNodes([e.swiftChild]);const t=e.children.filter((e=>e instanceof Y.AdaptiveCardNode));if(this._options.renderMedia&&t.length)return this._renderReactNodes(t);return{value:(0,o.jsx)(pe.default,{creatorMri:this._options.message.creator,message:this._options.message,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformSwiftNode(e){const t={preview:{renderPreview:!this._options.renderMedia,numberOfLines:1,stylesOverride:this._options.textOverrideStyle,isTextSelectable:!1},message:this._options.message,isInKeyboard:this._options.isInKeyboard,leftPaddingSwiftCarousel:this._options.leftPaddingSwiftCarousel,isMobileScreenSize:this._options.isMobileScreenSize,textOverrideStyle:this._options.textOverrideStyle,renderText:(e,t)=>this._renderArbitraryText(e,t),renderReact:(e,t)=>this._renderTextNode(e,t),onSelectionPress:this._options.onSwiftCardSelectionPress,onReplyActionLink:this._options.onSwiftReplyActionLink,onSkypeUriActionLink:this._options.onSwiftSkypeUriActionLink,swiftCardState:this._options.swiftCardState,onOAuthActionLink:this._options.onOAuthActionLink,onDisableScroll:this._options.onDisableScroll,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onContentHorizontalScroll:this._options.onContentHorizontalScroll,renderOrigin:this._options.renderOrigin,availableSpace:this._options.availableSpace,renderDimensions:this._options.constrainedDimensions},s=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content),{enableReplyMessageUnifiedUI:i,enableSwiftNodeReplyMessageUnifiedUI:n}=u.default.getS4LMessagingFeaturesNoSubscription();let r;return r=i&&n?s?(0,o.jsx)(De.default,{swiftMessage:e.swiftMessage,options:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),conversationId:e.conversationId,message:this._options.message,isActionable:!1,displayInReplyMessage:!0},this._generateReactKey(e)):(0,o.jsx)(he.default,{swiftMessage:e.swiftMessage,options:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),conversationId:e.conversationId,message:this._options.message,isActionable:!0},this._generateReactKey(e)):(0,o.jsx)(he.default,{swiftMessage:e.swiftMessage,options:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),conversationId:e.conversationId,message:this._options.message,isActionable:!s},this._generateReactKey(e)),{value:r,stopProcessing:!1,renderAsInline:!1}}transformScheduledCallInviteNode(e){if(!r.isUndefined(e.canceledTimeMs))return this._skip();return{value:(0,o.jsx)(de.default,{scheduledCallId:e.scheduledCallId,isSender:e.isSender,options:this._options,renderDimensions:this._options.constrainedDimensions},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!1}}transformAdaptiveCardNode(e){const t={leftPaddingCarousel:this._options.leftPaddingSwiftCarousel,onContentHorizontalScroll:this._options.onContentHorizontalScroll};return{value:(0,o.jsx)(ge.default,{adaptiveCardMessage:e.adaptiveCardMessage,conversationId:e.conversationId,message:this._options.message,renderOptions:t,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),onExecuteAdaptiveCardAction:this._onExecuteAdaptiveCardAction,placeholderLoadingEnabled:!0}),stopProcessing:!1,renderAsInline:!1}}transformContactNode(e){const t=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);let s;return s=u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?t?(0,o.jsx)(P.default,{tree:e,selectable:this._options.allowTextSelection,message:this._options.message,renderDimensions:this._options.constrainedDimensions||R.UndefinedDimensions}):(0,o.jsx)(w.default,{tree:e,selectable:this._options.allowTextSelection,message:this._options.message,renderDimensions:this._options.constrainedDimensions||R.ContactNodeSizes.Regular,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,isActionable:!0}):(0,o.jsx)(w.default,{tree:e,selectable:this._options.allowTextSelection,message:this._options.message,renderDimensions:this._options.constrainedDimensions||R.ContactNodeSizes.Regular,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,isActionable:!t}),{value:s,stopProcessing:!1,renderAsInline:!1}}transformContactsNode(e){if(this._options.trimToFirstLine){const t=q.getString("ContentToReactTransformer.ContactCardIconPreviewLabel");return{value:this._getContentPlaceholderResult(e,_e.SkypeIcon.ContactCard,t),stopProcessing:!0,renderAsInline:!0}}const t=this._renderReactNodes(e.children,!0);return{value:(0,o.jsx)(a.View,{children:t.value},"contact-list"),stopProcessing:t.stopProcessing,renderAsInline:!1}}transformFileNode(e){return{value:(0,o.jsx)(a.Text,{style:r.compact([this._options.systemTextStyle,this._options.textOverrideStyle]),selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,children:e.nameChild.getRawText()},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0}}transformFilesNode(e){const[t]=this._renderStringParts([q.getString("ContentToDisplayTransformerBase.FilesReceivedNotSupported")],e);if(this._options.trimToFirstLine)return{value:t,stopProcessing:!0,renderAsInline:!0};const s=this._renderLineBreak(e).value,i=this._renderReactNodes(e.children,!0);return{value:[t,s,(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,numberOfLines:this._options.numberOfLines||0,children:this._renderLineBreakBetweenElements(i).value},this._generateReactKey(e))],stopProcessing:i.stopProcessing,renderAsInline:!0}}transformSmsNode(e){const t=j.convertRawTextToInputEntities(e.smsContentUnescaped),s=j.decodeFromInput(t,!1),i=Object.assign(Object.assign({},this._options),{onlyEmoticons:s.hasOnlyEmoticonsOrWhitespaceText(),numberOfEmoticons:s.getNumberOfEmoticons(),onlyQuotedContent:s.hasOnlyQuotedContent()});return new Ze(i,this._root,this._searchStore)._renderReactNodes(s.children)}transformCallerIDNode(e){return{value:(0,o.jsx)(_.default,{layoutOption:e.layoutOption}),stopProcessing:!0,renderAsInline:!1}}transformMmsNode(e){return this._renderReactNodes(e.contentNodes)}transformStickerNode(e){const t=e.getSourceUrlSanitized();let s;return s=this._options.renderMedia?(0,o.jsx)(ze.default,{src:t,showPlaceholder:!0,dimension:oe.frameHeights.stickers.Size75,name:e.getNameForUI()},this._generateReactKey(e)):this._getContentPlaceholderResult(e,_e.SkypeIcon.Sticker,q.getString("ContentToReactTransformer.StickerMediaIconPreviewLabel")),{value:s,stopProcessing:!1,renderAsInline:!1}}transformLocationNode(e){let t,s=!1;const i=e.addressSanitized,n=!this._options.message.isForwarded()&&e.isUserLocation,r=e.userMri||this._options.message.creator,a=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);if(u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI)this._options.renderMedia?t=a?(0,o.jsx)($.default,{renderDimensions:this._options.constrainedDimensions,message:this._options.message,originalCreatorMri:r,isUserLocation:n,latitude:e.latitude,longitude:e.longitude,fullAddress:i,addressFriendlyName:e.addressFriendlyNameSanitized,shortAddress:e.shortAddressSanitized,activeOpacityOverride:this._options.activeOpacityOverride},this._generateReactKey(e)):(0,o.jsx)(Q.default,{message:this._options.message,originalCreatorMri:r,isUserLocation:n,latitude:e.latitude,longitude:e.longitude,fullAddress:i,addressFriendlyName:e.addressFriendlyNameSanitized,shortAddress:e.shortAddressSanitized,bingMapsUrl:e.bingUrl,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride},this._generateReactKey(e)):(t=(0,o.jsx)(Re.default,{conversationId:this._options.message.conversationId,isUserLocation:n,address:i,authorMri:r,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),s=!0);else{if(!this._options.renderLocation)return this._renderReactNodes(e.children);this._options.renderMedia?t=(0,o.jsx)(Q.default,{message:this._options.message,originalCreatorMri:r,isUserLocation:n,latitude:e.latitude,longitude:e.longitude,fullAddress:i,addressFriendlyName:e.addressFriendlyNameSanitized,shortAddress:e.shortAddressSanitized,bingMapsUrl:e.bingUrl,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride},this._generateReactKey(e)):(t=(0,o.jsx)(X.default,{conversationId:this._options.message.conversationId,isUserLocation:n,address:i,authorMri:r,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e)),s=!0)}return{value:t,stopProcessing:!1,renderAsInline:s}}transformTranslationNode(e){return this._renderReactNodes([e.contentNode])}transformDataNode(e){if(e.type===te.DataMessageContentType.TranslationSettings){const t=A.getTranslationActionString(e.content);return{value:(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:t},this._generateReactKey(e)),stopProcessing:!1,renderAsInline:!0,forceDirection:!0}}return this._renderReactNodes(e.children)}transformUriObjectFileNode(e){let t,s=!1;const i=e.getNameForUI()||q.getString("ContentToReactTransformer.FileMediaIconPreviewLabel"),n=e.getFileContentUrlSanitized(),r=this._options.constrainedDimensions||R.UndefinedDimensions,a=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);if(this._options.renderMedia)t=a?u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?this._getMediaPreviewItemRedesign(i,e.getFileType().toString(),e.getSizeInBytes(),n,this._options.asQuoteInComposer?B.MessageRenderOrigin.MessageComposerCanvas:B.MessageRenderOrigin.ChatCanvas,r):this._getMediaPreviewItem(i,e.getFileType().toString(),e.getSizeInBytes(),n):(0,o.jsx)(E.default,{message:this._options.message,fileSubType:e.getFileSubType(),contentUrl:n,displayFilename:i,downloadFilename:e.getNameForDownload(),mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,fileSizeInBytes:e.getSizeInBytes(),onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,renderOrigin:this._options.renderOrigin,renderDimensions:r,authorMri:this._options.message.creator,isUserInformationShown:this._options.showUserName||this._options.showTimestamp,disableActions:this._options.disableActions,activeOpacityOverride:this._options.activeOpacityOverride,allowTextSelection:this._options.allowTextSelection,isFileAvailable:T.isFileAvailable(this._options.message.createdTime),isDraggingEnabled:this._options.isDraggingEnabled,searchStore:this._searchStore,isActionable:!this._options.asQuoteInComposer},this._generateReactKey(e,this._options.message.cuid));else{const o=N.FileIconHelper.getIconFromFileType(i);t=this._getContentPlaceholderResult(e,o.icon,i,this._options.mediaPlaceholderIconColor?void 0:o.iconColor),s=!0}return{value:t,stopProcessing:!1,renderAsInline:s}}transformPictureNode(e){let t,s=!1;const i=q.getString("ContentToReactTransformer.PhotoMediaIconPreviewLabel"),n=e.getNameForDownload()||i,r=e.getSizeInBytes(),a=e.getDisplayThumbnailUrlSanitized(this._options.blurMedia),l=this._options.constrainedDimensions||R.UndefinedDimensions,d=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);if(this._options.renderMedia)if(d)t=u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?this._getMediaPreviewItemRedesign(n,e.getFileType().toString(),e.getSizeInBytes(),a,this._options.asQuoteInComposer?B.MessageRenderOrigin.MessageComposerCanvas:B.MessageRenderOrigin.ChatCanvas,l):this._getMediaPreviewItem(n,e.getFileType().toString(),e.getSizeInBytes(),a);else{t=(0,o.jsx)(ne.default,{thumbnailUrl:a,showDownloadIcon:this._options.blurMedia,contentUrl:e.getDisplayUrlSanitized(),fileName:n,renderOrigin:this._options.renderOrigin,fileSizeInBytes:r,renderDimensions:l,hideSendingIndicator:this._options.hideSendingIndicators,authorMri:this._options.message.creator,containerRadiusStyles:this._options.containerRadiusStyle,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,onThumbnailLoaded:this._options.onThumbnailLoaded,activeOpacityOverride:this._options.activeOpacityOverride,disableActions:this._options.disableActions,isMessageInSendingState:this._options.isMessageInSendingState,isDraggingEnabled:this._options.isDraggingEnabled,message:this._options.message,isRetryCommandSupported:this._options.isRetryCommandSupported},this._generateReactKey(e));if(u.default.getS4LWhiteboardFeatures().enableSkypeWhiteboard&&(0,qe.getContainerIdFromContent)(this._options.message.content)){const s={pictureNode:t,navigateToWhiteboard:()=>{const e=this._options.message.getMessageContentFromServerMessages()||this._options.message.content,t=this._options.message.creator,s=(0,qe.getContainerIdFromContent)(e);Ke.default.navigateToWhiteboard(this._options.message.conversationId,t,void 0,void 0,s,this._options.message)},options:this._options};t=(0,o.jsx)(Qe.WhiteboardNode,Object.assign({},s),this._generateReactKey(e))}}else t=this._getContentPlaceholderResult(e,_e.SkypeIcon.FilePicture,i),s=!1;return{value:t,stopProcessing:!1,renderAsInline:s}}transformImageCreatorPictureNode(e){const t=Object.assign(Object.assign({},this._options),{containerRadiusStyle:[this._options.containerRadiusStyle,this._options.imageCreatorContainerRadiusStyle]}),s=new Ze(t,this._root,this._searchStore).transformPictureNode(e);if(!this._options.renderMedia)return s;return{value:(0,o.jsx)(Xe.ImageCreatorPictureNode,{showFootnote:!this._options.asQuoteInComposer,postedByCurrentUser:!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator),hasReactions:this._options.message.hasReactions(),children:s.value},this._generateReactKey(e)),stopProcessing:s.stopProcessing,renderAsInline:s.renderAsInline}}transformVideoNode(e){let t,s=!1;const i=q.getString("ContentToReactTransformer.VideoMediaIconPreviewLabel"),n=e.getNameForDownload()||i,r=e.getSizeInBytes(),a=e.getDisplayThumbnailUrlSanitized(this._options.blurMedia),l=this._options.constrainedDimensions||R.UndefinedDimensions,d=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);return this._options.renderMedia?t=d?u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?this._getMediaPreviewItemRedesign(n,e.getFileType().toString(),e.getSizeInBytes(),a,this._options.asQuoteInComposer?B.MessageRenderOrigin.MessageComposerCanvas:B.MessageRenderOrigin.ChatCanvas,l):this._getMediaPreviewItem(n,e.getFileType().toString(),e.getSizeInBytes(),a):(0,o.jsx)(We.default,{thumbnailUrl:a,contentUrl:e.getDisplayUrlSanitized(),fileSizeInBytes:r,renderDimensions:l,authorMri:this._options.message.creator,containerStyles:this._options.containerRadiusStyle,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,activeOpacityOverride:this._options.activeOpacityOverride,disableActions:this._options.disableActions,renderOrigin:this._options.renderOrigin,subType:e.getSubType(),isMessageInSendingState:this._options.isMessageInSendingState,message:this._options.message,isDraggingEnabled:this._options.isDraggingEnabled,isRetryCommandSupported:this._options.isRetryCommandSupported},this._generateReactKey(e)):(t=this._getContentPlaceholderResult(e,_e.SkypeIcon.FileVideo,i),s=!0),{value:t,stopProcessing:!1,renderAsInline:s}}transformVideoMessageNode(e){let t,s=!1;const i=q.getString("ContentToReactTransformer.VideoMediaIconPreviewLabel"),n=e.getNameForDownload()||i,r=e.getSizeInBytes(),a=e.getDisplayThumbnailUrlSanitized(this._options.blurMedia),l=this._options.constrainedDimensions||R.UndefinedDimensions,d=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);if(this._options.renderMedia)t=d?u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?this._getMediaPreviewItemRedesign(n,e.getFileType().toString(),e.getSizeInBytes(),a,this._options.asQuoteInComposer?B.MessageRenderOrigin.MessageComposerCanvas:B.MessageRenderOrigin.ChatCanvas,l):this._getMediaPreviewItem(n,e.getFileType().toString(),e.getSizeInBytes(),a):(0,o.jsx)(We.default,{thumbnailUrl:a,contentUrl:e.getDisplayUrlSanitized(),fileSizeInBytes:r,renderDimensions:this._options.constrainedDimensions||R.UndefinedDimensions,authorMri:this._options.message.creator,containerStyles:this._options.containerRadiusStyle,renderOrigin:this._options.renderOrigin,onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,onMountContent:this._options.onMountContent,onShowContent:this._options.onShowContent,onHideContent:this._options.onHideContent,disableActions:this._options.disableActions,subType:e.getSubType(),isMessageInSendingState:this._options.isMessageInSendingState,message:this._options.message,isDraggingEnabled:this._options.isDraggingEnabled},this._generateReactKey(e));else{const o=u.default.getS4LMessagingFeaturesNoSubscription().useNewVideoMessageIcon?_e.SkypeIcon.MessageVideo:_e.SkypeIcon.Videomail;t=this._getContentPlaceholderResult(e,o,i),s=!0}return{value:t,stopProcessing:!1,renderAsInline:s}}transformAudioNode(e){var t,s,i,n;let r,a=!1;const l=this._options.constrainedDimensions||R.UndefinedDimensions,d=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);return this._options.renderMedia?r=d?u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?this._getMediaPreviewItemRedesign(null!==(t=e.getNameForUI())&&void 0!==t?t:"",e.getFileType().toString(),null!==(s=e.getSizeInBytes())&&void 0!==s?s:0,e.getDisplayUrlSanitized(),this._options.asQuoteInComposer?B.MessageRenderOrigin.MessageComposerCanvas:B.MessageRenderOrigin.ChatCanvas,l):this._getMediaPreviewItem(null!==(i=e.getNameForUI())&&void 0!==i?i:"",e.getFileType().toString(),null!==(n=e.getSizeInBytes())&&void 0!==n?n:0,e.getDisplayUrlSanitized()):(0,o.jsx)(O.default,{shouldShowWaveForm:!1,authorMri:this._options.message.creator,contentUrl:e.getDisplayUrlSanitized(),contentExtension:Te.default.extractFileExtension(e.getNameForDownload()),displayFilename:e.getNameForUI(),fileSizeInBytes:e.getSizeInBytes(),message:this._options.message,onContextMenu:this._options.onContextMenu,onLongPress:this._options.onLongPressContent,renderDimensions:l},this._generateReactKey(e)):(r=this._getContentPlaceholderResult(e,_e.SkypeIcon.VolumeMid,q.getString("ContentToReactTransformer.AudioFileMediaIconPreviewLabel")),a=!0),{value:r,stopProcessing:!1,renderAsInline:a}}transformAudioMessageNode(e){var t;let s,i=!1;const n=this._options.constrainedDimensions||R.UndefinedDimensions,r=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);return this._options.renderMedia?s=r&&u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?(0,o.jsx)(Ge.default,{contentUrl:e.getDisplayUrlSanitized(),defaultDurationMs:e.getAudioDurationMs(),renderOrigin:this._options.renderOrigin,renderDimensions:n}):(0,o.jsx)(p.default,{shouldShowWaveForm:!0,authorMri:this._options.message.creator,contentUrl:e.getDisplayUrlSanitized(),audioTranscriptionUrl:null===(t=e.getAudioTranscritionUrlSanitized)||void 0===t?void 0:t.call(e),contentExtension:Te.default.extractFileExtension(e.getNameForDownload()),displayFilename:e.getNameForUI(),fileSizeInBytes:e.getSizeInBytes(),audioMessageDurationMs:e.getAudioDurationMs(),message:this._options.message,onLongPress:this._options.onLongPressContent,renderDimensions:n},this._generateReactKey(e)):(s=this._getContentPlaceholderResult(e,_e.SkypeIcon.Microphone,q.getString("ContentToReactTransformer.AudioMessageMediaIconPreviewLabel")),i=!0),{value:s,stopProcessing:!1,renderAsInline:i}}_getContentPlaceholderResult(e,t,s,i){return(0,o.jsx)(k.ContentPlaceholder,{icon:t,label:s,iconColorOverride:i,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e,this._options.message.cuid))}_getThreadActivityParts(e,t=[]){const{authorMri:s,personMris:i}=A.getThreadActivityMemberParts(e.initiator,t);return{authorReact:this._formatAsDisplayName(s),personsReact:this._formatListAsDisplayNames(i),authorMri:s}}transformAddMemberNode(e){const t=e.content,{authorReact:s,personsReact:i,authorMri:n}=this._getThreadActivityParts(e,t),r=A.getAddMemberLocalizeInfo(s,i,i.length>0),l=[this._renderStringWithGender(r,n,e)];if(i.length>0){const t=this._renderLineBreak(e);if(!t.stopProcessing){const s=(0,o.jsx)(g.BotDisclosure,{targets:e.content,conversationId:e.conversationId,prependValue:t.value,renderBotName:this._formatParticipantName,renderAtMentionBotName:this._formatAtMentionParticipantName,renderStringParts:this._renderStringParts,textOverrideStyle:this._options.textOverrideStyle,allowTextSelection:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines},this._generateReactKey(e));l.push(s)}}const d=this._renderStringParts(l,e),c=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,h=!c;return{value:c?(0,o.jsx)(Ue.default,{centerSlot:d,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("add")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:d},this._appendUniqueKeyValue("add")),stopProcessing:!1,renderAsInline:h,forceDirection:!0}}transformDeleteMemberNode(e){const t=e.content,{authorReact:s,personsReact:i,authorMri:n}=this._getThreadActivityParts(e,t),r=b.isThread(n)?void 0:s,l=A.getDeleteMemberNodeLocalizeInfo(r,i,i.length>0),d=[this._renderStringWithGender(l,n,e)],c=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,h=!c;return{value:c?(0,o.jsx)(Ue.default,{centerSlot:d,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("delete")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:d},this._appendUniqueKeyValue("delete")),stopProcessing:!1,renderAsInline:h,forceDirection:!0}}transformRoleUpdateNode(e){const t=[e.content[0]],{authorReact:s,personsReact:i,authorMri:n}=this._getThreadActivityParts(e,t),r=e.content[0].roleChild.getRawText(),l=A.getRoleUpdateNodeLocalizeInfo(s,i,r),d=[this._renderStringWithGender(l,n,e)],c=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,h=!c;return{value:c?(0,o.jsx)(Ue.default,{centerSlot:d,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("update")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:d},this._appendUniqueKeyValue("update")),stopProcessing:!1,renderAsInline:h,forceDirection:!0}}transformTopicUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=e.content.getRawText(),n=D.decodeFromContent(i),r=new Ze(this._options,this._root,this._searchStore).transform(n).value,l=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,d=!l,c=A.getTopicUpdateNodeLocalizeInfo(t,l?i:r),h=[this._renderStringWithGender(c,s,e)];return{value:l?(0,o.jsx)(Ue.default,{centerSlot:h,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("topic")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:h},this._appendUniqueKeyValue("topic")),stopProcessing:!1,renderAsInline:d,forceDirection:!0}}transformHandshakeInviteNode(e){const{authorReact:t,personsReact:s,authorMri:i}=this._getThreadActivityParts(e,e.content),n=se.default.isMyMri(e.initiator.getRawText()),r=A.getHandshakeInviteNodeLocalizedInfo(n?s[0]:t,n),l=[this._renderStringWithGender(r,i,e)],d=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,c=!d;return{value:d?(0,o.jsx)(Ue.default,{centerSlot:l,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("e2eeinvite")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:l},this._appendUniqueKeyValue("e2eeinvite")),stopProcessing:!1,renderAsInline:c,forceDirection:!0}}transformHandshakeAcceptNode(e){const{authorReact:t,personsReact:s,authorMri:i}=this._getThreadActivityParts(e,e.content),n=se.default.isMyMri(e.initiator.getRawText()),r=A.getHandshakeAcceptNodeLocalizedInfo(n?s[0]:t,n),l=[this._renderStringWithGender(r,i,e)],d=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,c=!d;return{value:d?(0,o.jsx)(Ue.default,{centerSlot:l,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("e2eeaccept")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:l},this._appendUniqueKeyValue("e2eeaccept")),stopProcessing:!1,renderAsInline:c,forceDirection:!0}}transformHandshakeCompleteNode(){const e=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,t=q.getString("ContentToDisplayTransformerBase.E2eeInvitationConfirmed");return{value:e?(0,o.jsx)(Oe.default,{text:t,isPreview:!this._options.renderMedia}):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,children:t},this._appendUniqueKeyValue("e2eecomplete")),stopProcessing:!1,renderAsInline:!0}}transformHandshakeRejectNode(){const e=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,t=q.getString("ContentToDisplayTransformerBase.E2eeInvitationRejected");return{value:e?(0,o.jsx)(Oe.default,{text:t,isPreview:!this._options.renderMedia}):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,children:t},this._appendUniqueKeyValue("e2eereject")),stopProcessing:!1,renderAsInline:!0}}transformPictureUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getPictureUpdateNodeLocalizeInfo(t),n=[this._renderStringWithGender(i,s,e)],r=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,l=!r;return{value:r?(0,o.jsx)(Ue.default,{centerSlot:n,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("picture")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:n},this._appendUniqueKeyValue("picture")),stopProcessing:!1,renderAsInline:l}}transformHistoryDisclosedUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getHistoryDisclosedUpdateLocalizeInfo(t,e.nowDisclosed),n=[this._renderStringWithGender(i,s,e)],r=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,l=!r;return{value:r?(0,o.jsx)(Ue.default,{centerSlot:n,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("history")):(0,o.jsx)(a.Text,{style:[this._options.textOverrideStyle,Ye.horizontalPadding],selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:n},this._appendUniqueKeyValue("history")),stopProcessing:!1,renderAsInline:l,forceDirection:!0}}transformJoiningEnabledUpdateNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getJoiningEnabledUpdateNodeLocalizeInfo(t,e.nowEnabled),n=[this._renderStringWithGender(i,s,e)],r=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,l=!r;return{value:r?(0,o.jsx)(Ue.default,{centerSlot:n,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("join")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:n},this._appendUniqueKeyValue("join")),stopProcessing:!1,renderAsInline:l,forceDirection:!0}}transformLegacyMemberAddedNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=this.transformLinkNode(e.link),n=A.getLegacyMemberAddedNodeLocalizeInfo(t,i.value),r=[this._renderStringWithGender(n,s,e)],l=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,d=!l;return{value:l?(0,o.jsx)(Ue.default,{centerSlot:r,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("add")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:r},this._appendUniqueKeyValue("add")),stopProcessing:i.stopProcessing,renderAsInline:d,forceDirection:!0}}transformLegacyMemberUpgradedNode(e){const{authorReact:t,authorMri:s}=this._getThreadActivityParts(e),i=A.getLegacyMemberUpgradedNodeLocalizeInfo(t),n=[this._renderStringWithGender(i,s,e)],r=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,l=!r;return{value:r?(0,o.jsx)(Ue.default,{centerSlot:n,isPreview:!this._options.renderMedia},this._appendUniqueKeyValue("upgrade")):(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:n},this._appendUniqueKeyValue("upgrade")),stopProcessing:!1,renderAsInline:l,forceDirection:!0}}isEndTimestampValid(e){return!!e.endTime&&!isNaN(e.endTime)&&e.endTime>0}getTimeStampFromCallMarkerInfo(e){return e.endTime&&this.isEndTimestampValid(e)?e.endTime:this._options.message.createdTime}transformPartListNode(e){var t,s;const i=v.default.calculateCallMarkerInfo(e),n=(0,Ee.calculateCallMarkerInfo)(e),r=this._options.message.conversationId,a=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableCallSystemMessages,l={timestamp:this.getTimeStampFromCallMarkerInfo(n),callStatusType:n.type,callerMri:this._options.message.creator,duration:n.duration,callId:n.callId,conversationId:r},d=a?(0,o.jsx)(ke.default,{callInfo:l},this._generateReactKey(e)):(0,o.jsx)(f.default,{callId:i.callId,duration:i.duration,markerType:i.type,timestamp:this._options.message.createdTime,messagesSentDuringCall:null!==(s=null===(t=this._options.message.properties)||void 0===t?void 0:t.messagesSentDuringCall)&&void 0!==s&&s,conversationId:r,callerMri:this._options.message.creator,style:this._options.callMarkerStyle},this._generateReactKey(e)),c=a?(0,o.jsx)(Ae.CallSystemMessagePreview,{callStatusType:n.type,duration:n.duration,callerMri:this._options.message.creator},this._generateReactKey(e)):(0,o.jsx)(y.CallMarkerPreview,{callId:i.callId,duration:i.duration,markerType:i.type,conversationId:r,mediaPlaceholderIconColor:this._options.mediaPlaceholderIconColor,regularTextStyle:this._options.regularTextStyle,textOverrideStyle:this._options.textOverrideStyle},this._generateReactKey(e));return{value:this._options.renderMedia?d:c,stopProcessing:!1,renderAsInline:!this._options.renderMedia}}transformCallInfoUriObjectNode(e){let t;const s=this._options.message.creator,i="Call"===e.containerType,n=i?_e.SkypeIcon.CallStart:_e.SkypeIcon.CallQualityIndicator,r=i?q.getString("CallCard.CallStartedStatusMessage"):e.label;let l=!1;if(this._options.renderMedia){const i=this._options.message.isMessageLie()&&!this._options.message.isEphemeral();t=(0,o.jsx)(a.Button,{onPress:this._options.onPress,children:(0,o.jsx)(m.default,{callId:e.callId,cardType:S.CallCardType.Cast,conversationId:e.threadId,creatorMri:s,createdTime:this._options.message.createdTime,messageText:r,iconText:n,locationName:e.locationName,isPSTN:!1,isSending:i,containerRadiusStyles:this._options.containerRadiusStyle})})}else t=this._getContentPlaceholderResult(e,n,r),l=!0;return{value:t,stopProcessing:!1,renderAsInline:l}}transformNgcUpgradeNode(e){return{value:(0,o.jsx)(ie.NgcUpgradeSystemMessageNode,{userMrisOrNames:e.userMrisOrNames,systemTextStyle:this._options.systemTextStyle,textOverrideStyle:this._options.textOverrideStyle,numberOfLines:this._options.numberOfLines}),stopProcessing:!1,renderAsInline:!0}}transformPollNode(e){let t;const s=this._options.asQuoteInComposer||M.hasQuote(this._options.message.content);return t=this._options.renderMedia?s&&u.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?(0,o.jsx)(xe.default,{title:Ce.default.unescapeXml(e.title),renderDimensions:this._options.constrainedDimensions||R.UndefinedDimensions}):(0,o.jsx)(re.default,{conversationId:this._options.message.conversationId,message:this._options.message,title:Ce.default.unescapeXml(e.title),expirationTimeMs:e.expirationTimeMs,options:e.options,allowMultipleVotes:e.allowMultipleVotes,isActionable:!this._options.asQuoteInComposer},this._generateReactKey(e)):this._getContentPlaceholderResult(e,_e.SkypeIcon.Poll,q.getString("Poll.PlaceholderText")),{value:t,stopProcessing:!1,renderAsInline:!1}}transformMediaAlbumNode(e){let t=null;if(this._options.linkedMessages.length>1){const s=!this._options.message||!this._options.message.creator||se.default.isMyMri(this._options.message.creator);t=(0,o.jsx)(J.MediaAlbumNode,{linkedMessages:this._options.linkedMessages,albumId:this._options.message.getAlbumId(),onPress:this._options.onPress,onLongPress:this._options.onLongPressContent,onContextMenu:this._options.onContextMenu,containerRadiusStyles:this._options.containerRadiusStyle,constrainedDimensions:this._options.constrainedDimensions,postedByCurrentUser:s,hasReactions:this._options.message.hasReactions()},this._generateReactKey(e))}return{value:t,stopProcessing:!1,renderAsInline:!1}}transformHtmlNode(e){let t;if(r.isUndefined(this._options.numberOfLines)&&this._options.renderMedia){let s=null;const i=this._renderReactNodes(e.children,!0);return i.value&&(s=(0,o.jsx)(a.Text,{style:[this._options.textOverrideStyle,e.isQuote()?this._options.quotedTextStyle:void 0],children:i.value})),t=[(0,o.jsx)(H.HtmlNode,{tree:e,message:this._options.message,options:this._options,renderDimensions:this._options.constrainedDimensions||R.UndefinedDimensions,createChildReact:(e,t)=>new Ze(t,this._root)._renderReactNodes(e)},this._generateReactKey(e)),s],{value:t,stopProcessing:i.stopProcessing,renderAsInline:!1}}{let s=x.renderText(e);return s?(1===this._options.numberOfLines&&(s=r.split(s,"\n")[0]),t=H.HtmlNode.highlightText(e,this._options.message,s)||this._renderStringParts([s],e)):t=n.DomUtils.findOne((e=>"img"===e.name),e.getHtmlDom())?this._getContentPlaceholderResult(e,_e.SkypeIcon.FilePicture,q.getString("ContentToReactTransformer.PhotoMediaIconPreviewLabel")):"",{value:t,stopProcessing:!1,renderAsInline:!0}}}transformGuestNameUpdateNode(e){var t;const s=null===(t=r.first(e.content))||void 0===t?void 0:t.encodedAttr(),i=null==s?void 0:s.newName,n=null==s?void 0:s.oldName,l=u.default.getS4LMessagingFeaturesNoSubscription().enableActionableSystemMessages,d=n&&i?q.getString("ContentToDisplayTransformerBase.GuestNameUpdate",{oldName:n,newName:i}):"",c=(0,o.jsx)(Oe.default,{text:d,isPreview:!this._options.renderMedia}),h=i&&n?(0,o.jsx)(a.Text,{style:this._options.textOverrideStyle,selectable:this._options.allowTextSelection,numberOfLines:this._options.numberOfLines||0,forceDirection:!0,children:d},this._appendUniqueKeyValue("guestNameUpdate")):null;return{value:l?c:h,stopProcessing:!1,renderAsInline:!0}}transformMagicBotToolboxNode(e){if(!this._options.renderMedia)return{value:(0,o.jsx)(Be.MagicBotToolboxNodeFallback,{label:e.label,numberOfLines:this._options.numberOfLines},this._appendUniqueKeyValue("magicBotToolbox")),stopProcessing:!1,renderAsInline:!1};const t=b.isOneOnOneConversation(this._options.message.conversationId),s=(0,Ne.isMagicBotConversation)(this._options.message.conversationId);let i=t?Fe.MagicBotToolboxTarget.OneToOne:Fe.MagicBotToolboxTarget.BingGroup;s&&(i=Fe.MagicBotToolboxTarget.Bing);return{value:(0,o.jsx)(Be.MagicBotToolboxNode,{onLongPress:this._options.onContextMenu,target:i,items:e.items,showMore:e.showMore},this._appendUniqueKeyValue("magicBotToolbox")),stopProcessing:!1,renderAsInline:!1}}_renderStringWithGender(e,t,s){return(0,o.jsx)(U.GenderLocalizedMessage,{mri:t,localizeKey:e.key,localizeParams:e.params,tree:s,renderMessage:this._renderMessageParts},this._appendUniqueKeyValue("localizedMessage"))}_getMediaPreviewItem(e,t,s,i){const n={data:{file:{uri:i,name:e,type:t,size:s},extension:Te.default.extractFileExtension(e)},uid:this._options.message.cuid,originator:F.PostSource.MessageComposer,thumbnailUrl:i};return(0,o.jsx)(Me.default,{preview:n,index:0,onItemPress:()=>{},previewMode:!0,isNavigatingWithKeyboard:!1},"key"+n.uid)}_getMediaPreviewItemRedesign(e,t,s,i,n,r){const a={data:{file:{uri:i,name:e,type:t,size:s},extension:Te.default.extractFileExtension(e)},uid:this._options.message.cuid,originator:F.PostSource.MessageComposer,thumbnailUrl:i};return(0,o.jsx)(Le.default,{preview:a,index:0,onItemPress:()=>{},isNavigatingWithKeyboard:!1,renderOrigin:n,renderDimensions:r},"key"+a.uid)}}Ze._defaultOptions={},Ze._maxContentSizeMultiplierForQuotes=2;let et=class{renderReact(e,t={},s){try{const i=r.defaults(t,{onlyEmoticons:e.hasOnlyEmoticonsOrWhitespaceText(),onlyUnicodeEmoji:e.hasOnlyUnicodeEmoji(),numberOfEmoticons:e.getNumberOfEmoticons(),numberOfUnicodeEmoji:e.getNumberOfUnicodeEmoji(),onlyQuotedContent:e.hasOnlyQuotedContent(),startsWithWikiMarkupList:e.startsWithWikiMarkupList()}),o=new Ze(i,e,s);return o.transform(e)}catch(e){z.error(F.LogTraceArea.GenericUnsafe,"ContentToReactTransformer: Failed to transform tree: "+ce.default.errorAsString(e))}return{value:null,renderAsInline:!1,stopProcessing:!1}}renderLinkAsPreview(e){return{renderAsInline:!1,stopProcessing:!0,value:(0,o.jsx)(ye.default,{obfuscate:e.obfuscateUrlPreview,urlPreviewData:e.urlPreviewData,urlPreviewOnly:e.urlPreviewOnly,thumbnailRadiusStyle:e.urlPreviewThumbnailRadiusStyle,style:e.containerRadiusStyle,message:e.message,onLongPress:e.onLongPressContent,renderOrigin:e.renderOrigin,activeOpacityOverride:e.activeOpacityOverride,disableActions:e.disableActions,onContextMenu:e.onContextMenu,renderDimensions:e.constrainedDimensions,searchStore:e.searchStore},"urlpreview")}}};i.__decorate([d.disableWarnings],et.prototype,"renderReact",null),i.__decorate([d.disableWarnings],et.prototype,"renderLinkAsPreview",null),et=i.__decorate([d.AutoSubscribeStore],et);const tt=new et;t.renderReact=tt.renderReact,t.renderLinkAsPreview=tt.renderLinkAsPreview},332975:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SearchTermHighlightingTransformer=void 0,t.transformToHighlighted=f,t.transformToHighlightedText=function(e,t,s,i,n){const r=y(t);return f(e,r,((e,t)=>(0,o.jsx)(l.HighlightedNode,{isPrimarySearchResult:s,isOwnMessage:i,allowTextSelection:n,children:e},t)),(e=>e))},t.createQueryRegex=y,t.highlightSearchResults=function(e,t,s,i,o){try{return m(t,s,i,o).transform(e)}catch(e){d.error(a.LogTraceArea.GenericUnsafe,"SearchTermHighlightingTransformer: Failed to transform tree: "+u.default.errorAsString(e))}return e};const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(284841),a=s(815146),l=s(183049),d=i.__importStar(s(85385)),c=s(606933),u=i.__importDefault(s(655192)),h=/^\b$/;class p{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformHighlightedNode=n.identity,this.transformUnknownNode=n.identity,this.transformEditMessageMetaDataNode=n.identity,this.transformUserMriNode=n.identity,this.transformFlagNode=n.identity,this.transformLegacyQuoteNode=n.identity,this.transformBingResponseNode=n.identity,this.transformBingImageCreatorNode=n.identity,this.transformAttributionsTextNode=n.identity,this.transformAttributionsGroupNode=n.identity,this.transformEmoteNode=n.identity,this.transformContextNode=n.identity,this.transformRosterContextNode=n.identity,this.transformLocationContextNode=n.identity,this.transformTextWrapperNode=n.identity,this.transformTargetUserNode=n.identity,this.transformTargetLegacyUserNode=n.identity,this.transformTargetRoleNode=n.identity,this.transformTargetsNode=n.identity,this.transformContactNode=n.identity,this.transformContactsNode=n.identity,this.transformFileNode=n.identity,this.transformFilesNode=n.identity,this.transformSmsNode=n.identity,this.transformMmsNode=n.identity,this.transformLocationNode=n.identity,this.transformMetaNode=n.identity,this.transformUriObjectNode=n.identity,this.transformUriObjectFileNode=n.identity,this.transformPictureNode=n.identity,this.transformVideoNode=n.identity,this.transformVideoMessageNode=n.identity,this.transformAudioNode=n.identity,this.transformAudioMessageNode=n.identity,this.transformCallInfoUriObjectNode=n.identity,this.transformStickerNode=n.identity,this.transformSkypeVideoMessageNode=n.identity,this.transformAddMemberNode=n.identity,this.transformDeleteMemberNode=n.identity,this.transformRoleUpdateNode=n.identity,this.transformTopicUpdateNode=n.identity,this.transformHandshakeInviteNode=n.identity,this.transformHandshakeAcceptNode=n.identity,this.transformHandshakeCompleteNode=n.identity,this.transformHandshakeRejectNode=n.identity,this.transformPictureUpdateNode=n.identity,this.transformHistoryDisclosedUpdateNode=n.identity,this.transformJoiningEnabledUpdateNode=n.identity,this.transformLegacyMemberAddedNode=n.identity,this.transformLegacyMemberUpgradedNode=n.identity,this.transformPartNode=n.identity,this.transformPartListNode=n.identity,this.transformEndedNode=n.identity,this.transformSwiftUriObjectNode=n.identity,this.transformSwiftNode=n.identity,this.transformAdaptiveCardNode=n.identity,this.transformScheduledCallInviteNode=n.identity,this.transformNgcUpgradeNode=n.identity,this.transformSuggestedTextHighlightNode=n.identity,this.transformPollNode=n.identity,this.transformCallerIDNode=n.identity,this.transformMediaAlbumNode=n.identity,this.transformTranslationNode=n.identity,this.transformDataNode=n.identity,this.transformGuestNameUpdateNode=n.identity,this.transformGuestNameUpdateTargetNode=n.identity,this.transformMagicBotToolboxNode=n.identity,this.transformDeepLinkNode=n.identity,this.transformImageCreatorPictureNode=n.identity,this._keywords=S(this._options.query),this._queryRegex=_(this._keywords)}_default(e){const t=(0,r.chain)(e.children,(0,r.map)((e=>{const t=e&&e.accept(this);return t instanceof c.RootNode?n.compact(t.children):t})),(0,r.compact)(),(0,r.flatten)());return e.cloneWithChildren(t)}_parseChildren(e){return(0,r.chain)(e.children,(0,r.map)((e=>{if(!e)return[];const t=this.transform(e);return t instanceof c.RootNode?n.compact(t.children):[t]})),(0,r.flatten)())}transform(e){return 0===this._keywords.length?e:e.accept(this)}transformPlainTextNode(e){const t=e.getRawText(),s=this._parseText(t);if(1===s.length)return s[0];return c.RootNode.parse(s)}_parseText(e){return f(e,this._queryRegex,(e=>c.HighlightedNode.fromPlainText(e,this._options.isPrimarySearchResult,this._options.isOwnMessage,this._options.isGlobalSearch)),(e=>c.PlainTextNode.fromPlainText(e)))}transformAtMentionNode(e){return c.AtMentionNode.parse(this._parseChildren(e),e.encodedAttr())}transformEmoticonNode(e){const t=e.type.toLocaleLowerCase();return n.includes(this._keywords,t)?c.HighlightedNode.parse([e],this._options.isPrimarySearchResult,this._options.isOwnMessage,void 0,this._options.isGlobalSearch):e}transformUnicodeEmojiNode(e){return e.emojiTextNode}transformQuoteNode(e){return c.QuoteNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag(),void 0)}transformWikiMarkupNode(e){return c.WikiMarkupNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag())}transformListWikiMarkupNode(e){const t=c.ListWikiMarkupNode.parse(this._parseChildren(e),e.encodedAttr(),e.getTag());return null!=t?t:e}transformLinkNode(e){return c.LinkNode.parse(this._parseChildren(e),e.encodedAttr())}transformAttributionNode(e){const t=c.AttributionNode.parse(this._parseChildren(e),e.encodedAttr());return null!=t?t:e}transformHtmlNode(e){return e.cloneAsSearchResult(this._options.query,this._options.isPrimarySearchResult)}}let g;t.SearchTermHighlightingTransformer=p;const m=(e,t,s,i)=>(!g||g.query===e&&g.isPrimarySearchResult===t&&g.isOwnMessage===s||(g=void 0),g||(g={query:e,isPrimarySearchResult:t,isOwnMessage:s,transformer:new p({query:e,isPrimarySearchResult:t,isOwnMessage:s,isGlobalSearch:i})}),g.transformer);function S(e){return u.default.deburrLocaleLowerCase(e.trim()).split(/[\s]+/).filter(n.negate(n.isEmpty))}function _(e){if(e.length>0){const t=n.map(e,(e=>n.escapeRegExp(e)));return new RegExp(`(${t.join("|")})`,"g")}return h}function f(e,t,s,i){const o=u.default.deburrLocaleLowerCase(e);if(-1===o.search(t))return[i(e)];const n=[];let r,a=0;for(;(r=t.exec(o))&&(a!==r.index&&n.push(i(e.substring(a,r.index))),void 0!==r.index);)a=r.index+r[0].length,n.push(s(e.substring(r.index,a),"highlight.at."+r.index));return a!==e.length&&n.push(i(e.substring(a,e.length))),t.lastIndex=0,n}function y(e){return _(S(e))}},398745:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(958868)),a=s(815146),l=i.__importStar(s(85385)),d=i.__importDefault(s(740794)),c=i.__importDefault(s(760989));class u extends r.default{constructor(){super(...arguments),this._showProfile=()=>{const e=c.default.newCauseId();l.log(a.LogTraceArea.Navigation,"AtMentionNode._showProfile, causeId: "+e);const t=this.props.onPressProfileMriToShow;t&&d.default.showDetailsPanelWithParams({mri:t,rootViewId:this._getRootViewId(),causeId:e})}}render(){const{style:e,selectable:t,numberOfLines:s=0,allowFontScaling:i,onContextMenu:r,children:a,skipAtSymbol:l,maxContentSizeMultiplier:d,onPressProfileMriToShow:c,onPressInterceptionCallback:u,renderSimpleAtMention:h}=this.props,p={style:e,selectable:t,numberOfLines:s,allowFontScaling:i,maxContentSizeMultiplier:d},g=l?null:"@";return c&&!h&&(p.onPress=u||this._showProfile,p.onContextMenu=r),(0,o.jsxs)(n.Text,Object.assign({},p,{children:[g,a]}))}}t.default=u},852930:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BotDisclosure=void 0,t.getBotsForDisclosure=S;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(217041),l=i.__importDefault(s(58886)),d=i.__importDefault(s(179075)),c=s(284841),u=i.__importStar(s(44717)),h=i.__importStar(s(194504)),p=i.__importDefault(s(615364)),g=i.__importDefault(s(363091)),m=s(717413);function S(e,t,s,i){const o=n.some(e,(e=>g.default.isMyMri(e.getRawText())));let r=[];if(o){const e=(0,p.default)().getConversation(t);e&&(r=n.filter(e.getMemberMris(),(e=>u.isAgent(e))))}else r=(0,c.chain)(e,(0,c.map)((e=>e.getRawText())),(0,c.filter)((e=>u.isAgent(e))));const a=[],h=[];return n.each(r,(e=>{const t=d.default.getAgentDescriptionForMri(e),n=l.default.canListenToAllMessages(t.disclosures),r=t.displayName,c=(0,m.getMagicBotId)()===e;if(n)a.push(s(r));else{const e={botName:s(r),atMentionBotName:i(r),isMagicBot:c,isMe:o};h.push(e)}})),{allMessagesBotsFormatted:a,atMentionOnlyBotsFormatted:h}}class _ extends a.ComponentBase{_buildState(e,t){return S(e.targets,e.conversationId,e.renderBotName,e.renderAtMentionBotName)}render(){const{allMessagesBotsFormatted:e,atMentionOnlyBotsFormatted:t}=this.state;if(e.length>0||t.length>0){const s=h.renderBotDisclosureParts(e,t);this.props.prependValue&&s.unshift(this.props.prependValue);const i=this.props.renderStringParts(s);return(0,o.jsx)(r.Text,{style:this.props.textOverrideStyle,selectable:this.props.allowTextSelection,numberOfLines:this.props.numberOfLines||0,children:i},"BotDisclosure")}return null}}t.BotDisclosure=_},299973:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallInviteNodeBase=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(389659)),a=s(815146),l=i.__importDefault(s(970035)),d=i.__importStar(s(85385)),c=s(26703),u=i.__importStar(s(704704)),h=i.__importStar(s(954225)),p=i.__importDefault(s(960282)),g=i.__importDefault(s(184457)),m=s(36381),S=i.__importDefault(s(374503)),_=s(16549),f=s(641400),y=i.__importDefault(s(827361)),v=s(262725),C=i.__importDefault(s(497910)),T=i.__importDefault(s(760989)),M=(0,c.lazyProperties)({backgroundContainer:()=>n.Styles.createViewStyle({paddingTop:15,borderRadius:8,flex:1}),callInfo:()=>(0,c.lazyProperties)({wrapper:()=>n.Styles.createViewStyle({marginLeft:15,marginRight:15,overflow:"visible"}),wrapperV2:()=>y.default.alignItemsCenter,subject:()=>n.Styles.createTextStyle({marginTop:8,marginBottom:2}),datetime:()=>n.Styles.createTextStyle({marginTop:8,marginBottom:10}),calendarIcon:()=>n.Styles.createViewStyle({marginTop:5,marginRight:5,marginBottom:5,top:1}),calendarIconWrapper:()=>n.Styles.createViewStyle({height:f.IconSize.size32,width:f.IconSize.size32,alignItems:"center",justifyContent:"center",borderRadius:f.IconSize.size32,paddingLeft:3})}),statusIcon:()=>n.Styles.createViewStyle({margin:5})});class b extends C.default{constructor(){super(...arguments),this._onPress=()=>{const e=T.default.newCauseId();d.log(a.LogTraceArea.ScheduleCall,"CallInviteNodeBase._onPress causeId: "+e),g.default.NavigationActions.navigateToScheduledOverviewPanel({entryPoint:m.ScheduleCallEntryPoint.MessageStream,scheduledCallId:this.props.scheduledCall.id},this._getRootViewId())},this._getHeaderRef=e=>{this._headerRef=e}}_buildState(e,t){const s={};if(e.renderDimensions)s.cardWidth=e.renderDimensions.width;else if(e.messagePadding){const t=this._getRootViewId(),i=p.default.getWidth(t),o=p.default.isSmallDevice(t);s.cardWidth=o?i-e.messagePadding:h.adaptiveCardMessageFixedWidth}else s.cardWidth=h.adaptiveCardMessageFixedWidth;return s.accessibilityResumeLabel=S.default.getAccessibilityLabelForScheduledCall(e.scheduledCall),s}render(){const e=n.Styles.createViewStyle({width:this.state.cardWidth},!1),t=[M.backgroundContainer,this._themeStyles.cardColorStyle,y.default.pointerCursor,e],s=r.default.getConditionalDateTimeString(this.props.scheduledCall.datetimeMs);let i=_.Color.blue;const a=[M.callInfo.calendarIconWrapper];a.push(n.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfaceInteractive},!1)),i=this._getContext().themeColors.iconOnColor;const d=(0,o.jsxs)(n.Button,{style:[M.callInfo.wrapper,M.callInfo.wrapperV2],importantForAccessibility:n.Types.ImportantForAccessibility.Yes,onPress:this._onPress,onLongPress:this.props.onLongPress,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:this.state.accessibilityResumeLabel,ref:this._getHeaderRef,children:[(0,o.jsx)(n.View,{style:a,children:(0,o.jsx)(l.default,{icon:f.SkypeIcon.Schedule,size:f.IconSize.size18,color:i,style:M.callInfo.calendarIcon})}),(0,o.jsx)(v.CardTitle,{numberOfLines:2,style:[M.callInfo.subject,this._themeStyles.headerTextColorStyle],children:S.default.getScheduledCallSubject(this.props.scheduledCall.subject)}),(0,o.jsx)(v.Caption,{children:u.getString("ContentToReactTransformer.ScheduledCallPreviewLabel")}),(0,o.jsx)(v.Caption,{numberOfLines:2,style:M.callInfo.datetime,children:s})]});return(0,o.jsxs)(n.View,{style:t,children:[d,this.renderContent()]})}getTextAndIconForStatus(e,t){let s,i;switch(e){case m.ScheduledCallInvitationStatus.Unknown:s=u.getString("ScheduledCallCard.InvitedStatus");break;case m.ScheduledCallInvitationStatus.Accepted:s=u.getString("ScheduledCallCard.AcceptedStatus"),i=(0,o.jsx)(l.default,Object.assign({size:f.IconSize.size16,style:M.statusIcon},this.getIconPropsForStatus(e,t)),"icon");break;case m.ScheduledCallInvitationStatus.Declined:s=u.getString("ScheduledCallCard.DeclinedStatus"),i=(0,o.jsx)(l.default,Object.assign({size:f.IconSize.size16,style:M.statusIcon},this.getIconPropsForStatus(e,t)),"icon");break;default:return T.default.switchStatementExhaustiveChecking(e)}return{statusText:s,optionalIcon:i}}getIconPropsForStatus(e,t){switch(e){case m.ScheduledCallInvitationStatus.Accepted:return{icon:f.SkypeIcon.Ok,color:t?this._themeColors.secondaryTextColor:_.Color.green};case m.ScheduledCallInvitationStatus.Declined:return{icon:f.SkypeIcon.Cancel,color:t?this._themeColors.secondaryTextColor:_.Color.red};default:return T.default.switchStatementExhaustiveChecking(e)}}}t.CallInviteNodeBase=b},963786:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(299973),a=i.__importDefault(s(186325)),l=i.__importDefault(s(970035)),d=s(26703),c=i.__importStar(s(704704)),u=i.__importDefault(s(363091)),h=s(36381),p=i.__importDefault(s(20758)),g=s(641400),m=(0,d.lazyProperties)({responseStatus:()=>(0,d.lazyProperties)({responseButtonsContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"space-around",overflow:"visible",height:44}),responseButton:()=>n.Styles.createButtonStyle({flex:1,alignItems:"center"}),inviteeStatus:()=>n.Styles.createViewStyle({flexGrow:1,flexShrink:0,flexDirection:"row",alignItems:"center",justifyContent:"center",height:44,paddingHorizontal:15})}),verticalDivider:()=>n.Styles.createViewStyle({width:1,height:44})});class S extends r.CallInviteNodeBase{constructor(){super(...arguments),this._onAccept=e=>{e.stopPropagation(),this.props.onCallInviteAccepted(this.props.scheduledCall.id,this.state.mySkypeMri),this._headerRef&&this._headerRef.requestFocus()},this._onDecline=e=>{e.stopPropagation(),this.props.onCallInviteDeclined(this.props.scheduledCall.id,this.state.mySkypeMri),this._headerRef&&this._headerRef.requestFocus()}}_buildState(e,t){const s=super._buildState(e,t);s.mySkypeMri=u.default.getSkypeMri();const i=e.scheduledCall.invitations[s.mySkypeMri];return i&&(t||!t&&i.invitationStatus!==h.ScheduledCallInvitationStatus.Unknown)&&(s.responseStatus=i.invitationStatus||h.ScheduledCallInvitationStatus.Unknown),s}renderContent(){let e;return this.state.responseStatus===h.ScheduledCallInvitationStatus.Unknown?e=this._renderResponseButtons():this.state.responseStatus&&(e=this._renderResponseStatus(this.state.responseStatus)),[(0,o.jsx)(a.default,{style:this._themeStyles.messageStreamBackgroundColorStyle},"divider"),(0,o.jsx)(n.View,{children:e},"invite_status")]}_renderResponseButtons(){return(0,o.jsxs)(n.View,{style:m.responseStatus.responseButtonsContainer,children:[(0,o.jsx)(n.Button,{onPress:this._onAccept,accessibilityLabel:c.getString("ScheduledCallCard.AcceptButton"),style:m.responseStatus.responseButton,children:(0,o.jsx)(l.default,Object.assign({size:g.IconSize.size24},this.getIconPropsForStatus(h.ScheduledCallInvitationStatus.Accepted)),"accept")}),(0,o.jsx)(a.default,{style:[m.verticalDivider,this._themeStyles.messageStreamBackgroundColorStyle]},"buttonDivider"),(0,o.jsx)(n.Button,{onPress:this._onDecline,accessibilityLabel:c.getString("ScheduledCallCard.DeclineButton"),style:m.responseStatus.responseButton,children:(0,o.jsx)(l.default,Object.assign({size:g.IconSize.size24},this.getIconPropsForStatus(h.ScheduledCallInvitationStatus.Declined)),"decline")})]})}_renderResponseStatus(e){const{statusText:t,optionalIcon:s}=this.getTextAndIconForStatus(e);return(0,o.jsxs)(n.View,{style:m.responseStatus.inviteeStatus,children:[s,(0,o.jsx)(n.Text,{importantForAccessibility:n.Types.ImportantForAccessibility.No,style:[p.default.fontStyle.tertiaryButton,this._themeStyles.primaryTextColorStyle],children:t})]})}}t.default=S},852528:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(299973),l=i.__importDefault(s(601976)),d=i.__importDefault(s(186325)),c=s(26703),u=i.__importDefault(s(742347)),h=s(36381),p=s(16549),g=s(596648),m=(0,c.lazyProperties)({dividerDark:()=>r.Styles.createViewStyle({backgroundColor:p.Color.gray300}),avatars:()=>r.Styles.createViewStyle({margin:10})});class S extends a.CallInviteNodeBase{_buildState(e,t){const s=super._buildState(e,t),i=[];return n.each(e.scheduledCall.invitations,((e,t)=>{i.push({name:l.default.getDisplayName(t),status:e.invitationStatus||h.ScheduledCallInvitationStatus.Unknown,skypeId:t})})),s.invitees=i,s}renderContent(){return[(0,o.jsx)(d.default,{marginLeft:15,marginRight:15,style:this._useDarkTheme()?m.dividerDark:this._themeStyles.dividerColorStyle},"divider"),(0,o.jsx)(u.default,{shouldUseInvitationStatusToFilter:!0,shouldShowFilteredStatusAsLabel:!0,style:m.avatars,avatarSize:g.UserIconSize.Size24,avatarBorderWidth:0,invitations:this.props.scheduledCall.invitations},"invitees-avatar-list")]}}t.default=S},186754:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerPreview=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(217041),a=i.__importDefault(s(851692)),l=i.__importStar(s(788286)),d=i.__importStar(s(44717)),c=i.__importDefault(s(970035)),u=s(26703),h=s(16549),p=(0,u.lazyProperties)({contentPlaceholderContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",marginBottom:-2,width:20,height:16}),contentPlaceholderPadding:()=>n.Styles.createViewStyle({paddingRight:4})});class g extends r.ComponentBase{_buildState(e,t){const s=a.default.getCallLog(e.callId),i=l.default.calculateCallMarkerInfoFromPath(s,e.callId,e.conversationId,e.markerType,e.duration);return{markerType:i.type,duration:i.duration}}render(){const e=[this.props.regularTextStyle,this.props.textOverrideStyle],t=p.contentPlaceholderPadding,s=l.CallMarkerDisplayUtils.getIcon(this.state.markerType),i=(0,o.jsx)(n.View,{style:p.contentPlaceholderContainer,children:(0,o.jsx)(c.default,{icon:s,size:16,color:this.props.mediaPlaceholderIconColor?this.props.mediaPlaceholderIconColor:h.Color.white,style:t})},"placeholderIcon"),r=this.state.markerType,a=this.props.conversationId,u=a&&d.isEncryptedThread(a)?l.CallMarkerDisplayUtils.getTextForEncryptedThread(r,this.state.duration):l.CallMarkerDisplayUtils.getText(r,this.state.duration);return(0,o.jsxs)(n.Text,{style:e,ellipsizeMode:"middle",children:[i,u]})}}t.CallMarkerPreview=g},827064:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=i.__importDefault(s(859545)),a=i.__importStar(s(44717)),l=i.__importStar(s(196509)),d=s(815146),c=s(323318),u=i.__importStar(s(85385)),h=s(26703),p=i.__importStar(s(704704)),g=i.__importDefault(s(998929)),m=i.__importStar(s(752004)),S=i.__importStar(s(786531)),_=i.__importDefault(s(363091)),f=i.__importDefault(s(740794)),y=i.__importDefault(s(808164)),v=s(16549),C=s(331079),T=s(262725),M=i.__importDefault(s(497910)),b=s(403396),I=s(596648),w=i.__importDefault(s(760989)),P=l.contactNodeHeight,k=(0,h.lazyProperties)({contactCardContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",borderStyle:"solid",borderRadius:10}),senderBorderRadius:()=>n.Styles.createViewStyle({borderBottomRightRadius:0}),recieverBorderRadius:()=>n.Styles.createViewStyle({borderTopLeftRadius:0}),dataContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",marginTop:8}),textContainer:()=>n.Styles.createViewStyle({flex:-1,flexDirection:"column",alignItems:"center",marginTop:10}),fullName:()=>n.Styles.createTextStyle({flex:-1,lineHeight:22,paddingBottom:5,paddingHorizontal:10}),skypeId:()=>n.Styles.createTextStyle({flex:-1,lineHeight:16,paddingHorizontal:10}),btnContainer:()=>n.Styles.createViewStyle({paddingVertical:15,borderStyle:"solid",borderTopWidth:2,paddingHorizontal:12}),btnText:()=>n.Styles.createTextStyle({textAlign:"center"}),textWrapper:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row"})});class A extends M.default{constructor(){super(...arguments),this._onPress=()=>{const e=w.default.newCauseId();u.log(d.LogTraceArea.Navigation,"ContactNode._onPress, causeId: "+e),r.default.contacts().canHaveContacts?f.default.navigateToConversation({convId:this.state.contactUserMri,origin:d.NavigationConversationOrigin.SharedContactCard,causeId:e}):f.default.navigateToGuestUpsell(c.GuestUpsellType.LeaveGroup),this.props.message&&u.track(new S.MessageContentClicked(this.props.message,!1))}}_buildState(e,t){let s;if(e.tree.isPstn&&e.tree.skypeId){const t={number:y.default.normalizePartialNumberWithCountryCode(e.tree.skypeId),type:C.PhoneNumberTypes.Other};s=a.getMriFromPhoneNumber(t)}else s=e.tree.isS4B&&e.tree.skypeId?a.getMriFromS4BId(e.tree.skypeId):a.skypeIdToMri(e.tree.skypeId);return{contactUserMri:s,isSentByCurrentUser:e.message&&_.default.isMyMri(e.message.creator)}}render(){const e=m.getStyleForDimensions(this.props.renderDimensions),t=n.Styles.createTextStyle({maxWidth:this.props.renderDimensions.width},!1),s=this.props.tree.fullName,i=(0,o.jsx)(n.View,{style:k.textWrapper,children:(0,o.jsx)(T.BodyText,{style:[k.fullName,t],size:T.BodyTextSize.BigDeprecated,bold:!0,numberOfLines:1,ellipsizeMode:"middle",accessibilityHidden:!0,children:s})}),r=this.props.isActionable?(0,o.jsx)(T.Caption,{style:[k.skypeId,t],numberOfLines:1,ellipsizeMode:"tail",textThemeColor:T.TextThemeColor.Primary,accessibilityHidden:!0,children:this.props.tree.skypeId}):void 0,a=p.getString("ContactCard.ChatButtonTitle"),l=s?p.getString("ContactCard.ChatButtonAccessibilityLabel",{userName:s}):a,d=this.props.isActionable?(0,o.jsx)(n.Button,{style:[k.btnContainer,this._themeStyles.primaryBorderColorStyle],onPress:this._onPress,onLongPress:this.props.onLongPress,title:a,disabled:_.default.isMyMri(this.state.contactUserMri),accessibilityLabel:l,children:(0,o.jsx)(T.BodyText,{size:T.BodyTextSize.BigDeprecated,bold:!0,style:k.btnText,children:a})}):void 0,c=(0,o.jsx)(b.UserIcon,{userMri:this.state.contactUserMri,backgroundColor:v.Color.gray100,size:I.UserIconSize.Size50,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants}),u=this.state.isSentByCurrentUser?k.senderBorderRadius:k.recieverBorderRadius,h=n.Styles.createTextStyle({maxHeight:P},!1);return(0,o.jsxs)(g.default.View,{style:[h,k.contactCardContainer,e,u,this._themeStyles.cardColorStyle],onContextMenu:this.props.onContextMenu,keepOriginalProps:!0,children:[(0,o.jsxs)(n.View,{style:k.dataContainer,children:[c,(0,o.jsxs)(n.View,{style:k.textContainer,children:[i,r]})]}),d]})}}t.default=A},348047:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=i.__importStar(s(516778)),a=s(537180),l=i.__importStar(s(44717)),d=i.__importDefault(s(363091)),c=i.__importDefault(s(808164)),u=s(16549),h=s(331079),p=s(403396),g=s(596648),m=s(526849),S=s(964414),_=i.__importStar(s(196509)),f=i.__importDefault(s(20758)),y=s(154235);t.default=(0,n.memo)((0,m.WithResub)((e=>{const t="Skype ID: "+e.tree.skypeId,s=(0,S.useSkypeStyles)((({themeColors:t})=>{var s;return{contactCardContainer:{flexDirection:"column",borderRadius:4,height:132,width:null!==(s=e.renderDimensions.width)&&void 0!==s?s:"100%",maxWidth:_.replyNodeWidth},dataContainer:{flex:1,alignItems:"center",justifyContent:"flex-start",backgroundColor:t.surfacePrimary,padding:16},textContainer:{alignItems:"center",marginTop:12,width:"100%"},fullName:{fontSize:f.default.fontSize.size15,fontWeight:y.FontWeight.medium,lineHeight:20,color:t.textPrimary,textAlign:"center",width:"100%"},skypeId:{fontSize:f.default.fontSize.size12,fontWeight:y.FontWeight.regular,lineHeight:20,color:t.textSecondary,wordBreak:"break-all",textAlign:"center",width:"100%"}}}),[e.renderDimensions.width]);return(0,o.jsx)(a.View,{style:s.contactCardContainer,children:(0,o.jsxs)(a.View,{style:s.dataContainer,children:[(0,o.jsx)(p.UserIcon,{userMri:e.contactUserMri,backgroundColor:u.Color.gray100,size:g.UserIconSize.Size48,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants}),(0,o.jsxs)(a.View,{style:s.textContainer,children:[(0,o.jsx)(a.Text,{style:s.fullName,numberOfLines:1,ellipsizeMode:"middle",accessible:!1,children:e.tree.fullName}),(0,o.jsx)(a.Text,{style:s.skypeId,numberOfLines:1,ellipsizeMode:"tail",lineBreakMode:"tail",accessible:!1,accessibilityLabel:t,children:t})]})]})})}),(e=>{let t;if(e.tree.isPstn&&e.tree.skypeId){const s={number:c.default.normalizePartialNumberWithCountryCode(e.tree.skypeId),type:h.PhoneNumberTypes.Other};t=l.getMriFromPhoneNumber(s)}else t=e.tree.isS4B&&e.tree.skypeId?l.getMriFromS4BId(e.tree.skypeId):l.skypeIdToMri(e.tree.skypeId);return Object.assign(Object.assign({},e),{contactUserMri:t,isSentByCurrentUser:e.message&&d.default.isMyMri(e.message.creator)})})))},656472:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentPlaceholder=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(217041),l=i.__importDefault(s(970035)),d=s(26703),c=s(16549),u=i.__importDefault(s(827361)),h=(0,d.lazyProperties)({contentPlaceholderContainer:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",marginBottom:-2,width:20,height:16}),contentPlaceholderPadding:()=>r.Styles.createViewStyle({paddingRight:4})});class p extends a.ComponentBase{render(){const e=n.compact([this.props.regularTextStyle,this.props.textOverrideStyle,u.default.noWrap]);let t=this.props.iconColorOverride;!t&&this.props.mediaPlaceholderIconColor&&(t=this.props.mediaPlaceholderIconColor);const s=(0,o.jsx)(r.View,{style:h.contentPlaceholderContainer,children:(0,o.jsx)(l.default,{icon:this.props.icon,size:16,color:null!=t?t:c.Color.white,style:h.contentPlaceholderPadding})},"placeholderIcon");return(0,o.jsxs)(r.Text,{style:e,numberOfLines:this.props.numberOfLines||0,selectable:this.props.allowTextSelection,ellipsizeMode:"middle",children:[this.props.isNewsChannel||this.props.isNewsBot?null:s,this.props.label]})}}t.ContentPlaceholder=p},393625:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({icon:e,text:t,actionUri:s}){const{rootViewId:i}=(0,c.useCommonContext)(),u=(0,a.useCallback)((()=>{l.openUrl(d.BrowserOrigin.DeepLinkNode,s,i,{openInExternalBrowser:!1})}),[s,i]);return(0,o.jsx)(n.Pressable,{onPress:u,children:(0,o.jsxs)(r.Row,{alignItems:"center",space:"size40",children:[e&&(0,o.jsx)(r.Icon,{icon:e,size:"xs"}),(0,o.jsx)(r.Caption,{text:t,variant:"2"})]})})};const i=s(197582),o=s(785893),n=s(537180),r=s(344175),a=s(667294),l=i.__importStar(s(50350)),d=s(815146),c=s(736267)},229620:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayName=void 0,t.displayNameText=a;const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(601976));function a(e,t){return e&&r.default.getDisplayName(e)||o.trimEnd(t)}class l extends n.ComponentBase{_buildState(e,t){return{name:a(e.mri,e.fallbackText)}}render(){return this.props.renderName(this.state.name,this.props.mri)}}t.DisplayName=l},287167:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GenderLocalizedMessage=void 0,t.localizeMessageParts=function(e,t,s){const i=u(e,s);return a.getParts(t,i)},t.localizeMessageString=function(e,t,s){const i=u(e,s);return a.getString(t,i)};const i=s(197582),o=s(217041),n=i.__importStar(s(44717)),r=i.__importStar(s(147286)),a=i.__importStar(s(704704)),l=s(331079),d=i.__importDefault(s(685734)),c="gender";function u(e,t){const s=e&&!n.isThread(e)&&d.default.getFullUserProfileByMri(e).gender||l.eGender.Unspecified;return t[c]=r.getLocalizeParamForGender(s),t}class h extends o.ComponentBase{_buildState(e,t){const s=u(e.mri,e.localizeParams);return{messageParts:a.getParts(e.localizeKey,s)}}render(){return this.props.renderMessage(this.state.messageParts,this.props.tree)}}t.GenderLocalizedMessage=h},183049:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HighlightedNode=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(667294),a=s(26703),l=s(736267),d=i.__importDefault(s(252089)),c=i.__importDefault(s(150343)),u=s(473483),h=i.__importDefault(s(827361)),p=s(526849),g=(0,a.lazyProperties)({searchResultBackgroundStyle:()=>n.Styles.createViewStyle({padding:2,borderRadius:3})});t.HighlightedNode=(0,p.WithResub)((({allowTextSelection:e,children:t,currentSearchResultBackgroundColor:s,currentSearchResultTextColor:i,isGlobalSearch:a,isPrimarySearchResult:d,searchResultsBackgroundColor:c,searchResultsTextColor:p,textOverrideStyle:m,modernizeSearchPanel:S})=>{const{userColor:{primaryAccent:_}}=(0,l.useCommonContext)(),{primaryAccent:f}=(0,u.getDefaultUnknownColorInfo)(),y=(0,r.useMemo)((()=>{const{addPaddings:e,backgroundStyle:t,textStyle:o}=((e,t,s,i,o,r,a,l,d)=>{let c,u,p=!1;return a&&l?(c=h.default.transparentBackground,u=n.Styles.createTextStyle({color:null!=e?e:t},!1)):(c=n.Styles.createViewStyle({backgroundColor:d?s:i},!1),u=n.Styles.createTextStyle({color:d?o:r},!1),p=!0),{addPaddings:p,backgroundStyle:c,textStyle:u}})(_,f,s,c,i,p,S,null!=a&&a,d);let r=[t,o];return e&&r.push(g.searchResultBackgroundStyle),m&&(r=[m,r]),r}),[S,a,m,_,f,d,s,c,i,p]);return(0,o.jsx)(n.Text,{style:y,selectable:e,children:t})}),(e=>{const{modernizeSearchPanel:t}=c.default.getS4LMessagingFeatures(),s=d.default.getCurrentSearchResultBackgroundColor(),i=d.default.getSearchResultsBackgroundColor(e.isOwnMessage),o=d.default.getCurrentSearchResultTextColor(),n=d.default.getSearchResultsTextColor(e.isOwnMessage);return Object.assign(Object.assign({},e),{currentSearchResultBackgroundColor:s,searchResultsBackgroundColor:i,currentSearchResultTextColor:o,searchResultsTextColor:n,modernizeSearchPanel:t})}))},354337:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlInlineImage=void 0;const i=s(197582),o=s(785893),n=i.__importDefault(s(499560)),r=i.__importStar(s(516778)),a=i.__importStar(s(317588)),l=i.__importDefault(s(150343)),d=i.__importStar(s(987364)),c=i.__importDefault(s(543915)),u=i.__importDefault(s(958868)),h=i.__importDefault(s(694154)),p=i.__importDefault(s(606617)),g=i.__importDefault(s(453761)),m=s(26703),S=i.__importStar(s(704704)),_=i.__importStar(s(752004)),f=i.__importDefault(s(813635)),y=s(966259),v=i.__importDefault(s(952376)),C=i.__importDefault(s(211124)),T=s(16549),M=s(641400),b=i.__importStar(s(179582)),I=s(331079),w=i.__importDefault(s(827361)),P=i.__importDefault(s(460403)),k=i.__importDefault(s(220534)),A=(0,m.lazyProperties)({backgroundImage:()=>[w.default.absoluteFill,r.Styles.createViewStyle({opacity:.5})],alternateViewContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:T.Color.gray200}),headerContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-end",backgroundColor:T.Color.transparent}),moreButton:()=>r.Styles.createTextStyle({height:48,width:48})});class x extends u.default{constructor(){super(...arguments),this._mediaViewerController={getOptions:()=>({animateOpenClose:!0,showCustomHeader:!0,showCustomFooter:!1}),renderCustomHeader:(e,t)=>(0,o.jsx)(r.View,{style:A.headerContainer,children:(0,o.jsx)(g.default,{ref:this._setMoreButtonRef,size:M.IconSize.size24,style:A.moreButton,onPress:t=>this._showMoreMenu(t,e),color:T.Color.white,hoverColor:T.Color.gray300,icon:b.moreIcon(),title:S.getString("Global.MoreOptions")})}),renderCustomFooter:e=>(0,o.jsx)(f.default,{hideLeftButton:!1,hideRightReactionButton:!0,message:this.props.message,mediaDescriptor:e}),getMediaLocationInWindow:e=>c.default.measureLayoutRelativeToWindow((()=>this))},this._setMoreButtonRef=e=>{this._moreButton=e||void 0},this._onPress=e=>{const t=`${this.props.message.cuid}_${(0,n.default)(this.props.source).toString()}`,s=p.default.extractFileNameWithExtension(this.props.source),i=p.default.extractFileExtension(s)?s:t+".jpg",o=this.props.originalDimensions.width&&this.props.originalDimensions.height?{width:this.props.originalDimensions.width,height:this.props.originalDimensions.height}:void 0,r=this.props.thumbnailDimensions.width&&this.props.thumbnailDimensions.height?{width:this.props.thumbnailDimensions.width,height:this.props.thumbnailDimensions.height}:void 0,a={id:t,mediaType:y.MediaViewerTypes.Picture,downloadFileName:i,thumbnailUrl:this.state.thumbnailUrl,displayResolutionUrl:this.state.fullSizeUrl,fullResolutionUrl:this.state.fullSizeUrl,originalSize:o,thumbnailSize:r};C.default.showWithConfig({initialMedia:a,controller:this._mediaViewerController,rootViewId:this._getRootViewId()})}}_showMoreMenu(e,t){v.default.showWithConfig({message:this.props.message,mediaDescriptor:t,componentContext:this._getContext(),anchor:()=>this._moreButton,invokingEvent:e})}_buildState(e,t){let s,i;const o=d.getDocumentId(e.source);if(o)s=d.getDisplayUrl(o,I.UploadFileType.Picture,I.MediaViewSize.ThumbnailUncropped),i=d.getDisplayUrl(o,I.UploadFileType.Picture,I.MediaViewSize.Full);else{const t=l.default.getS4LMessagingFeatures().asmImageProxy;s=k.default.addUrlParameter(t,"url",encodeURIComponent(e.source)),i=s}return{thumbnailUrl:P.default.getAuthenticatedUrl(s),fullSizeUrl:P.default.getAuthenticatedUrl(i)}}render(){const e=[A.alternateViewContainer],t=(0,o.jsx)(r.View,{style:e,children:(0,o.jsx)(r.Image,{style:A.backgroundImage,resizeMode:"cover",source:a.Collection.WIGGLE_PATTERN_350})}),s=_.getStyleForDimensions(this.props.thumbnailDimensions);return(0,o.jsx)(h.default,{origin:"HtmlNode",containerStyle:s,style:[this.props.style,s],source:this.state.thumbnailUrl,resizeMode:"contain",onPress:this._onPress,altView:t,errorView:t})}}t.HtmlInlineImage=x},789439:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlNode=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(823719)),r=i.__importStar(s(496486)),a=i.__importDefault(s(104644)),l=i.__importStar(s(516778)),d=i.__importStar(s(971988)),c=i.__importDefault(s(958868)),u=i.__importStar(s(196509)),h=s(354337),p=s(525097),g=i.__importDefault(s(556037)),m=s(606933),S=i.__importDefault(s(363091)),_=s(548056),f=s(332975),y=i.__importDefault(s(827361));class v extends c.default{constructor(){super(...arguments),this._createEmoticonNodeFromHtml=e=>{const t=m.PlainTextNode.fromPlainText("("+e+")"),s=new m.EmoticonNode(t,e,void 0),i=r.clone(this.props.options);i.allowLargeEmoticons=!1,i.allowHugeEmoticons=!1;return this.props.createChildReact([s],i).value},this._createImageNodeFromHtml=(e,t)=>{const s={width:this._getPixelDimension(t.width),height:this._getPixelDimension(t.height)},i=u.getScaledThumbnailDimensions(s,this.props.renderDimensions);return{result:(0,o.jsx)(h.HtmlInlineImage,{message:this.props.message,originalDimensions:s,thumbnailDimensions:i,style:t,source:e}),renderInline:!1}},this._createAtMentionNodeFromHtml=e=>{const t=d.getTeamsMentionProperties(this.props.message.properties);if(t){const s=r.find(t,(t=>t.itemid+""==e+""));if(s&&s.mri){const t=s.displayName,i=m.PlainTextNode.fromPlainText(t||e),o=new m.AtMentionNode([i],s.mri,!1,e);let n;this.props.tree.isQuote()?(n=r.clone(this.props.options),n.textOverrideStyle=n.quotedTextStyle):n=this.props.options;return this.props.createChildReact([o],n).value}}},this._createTextNodeFromHtml=e=>{const t=e.replace(/\r\n/g,"\n");return v.highlightText(this.props.tree,this.props.message,t)||t},this._onScrollViewLayout=e=>{this._scrollLayoutWidth=e.width,this._updateScrollIndicator()},this._onContentSizeChange=(e,t)=>{this._scrollContentWidth=e,this._updateScrollIndicator()}}_buildState(e,t){let s;const i=this.props;if(t||e.tree!==i.tree){const t=[],i=e.tree.getHtmlDom(),o=this._transformHtmlForRendering(r.cloneDeep(i),t,e.tree.isQuote());r.each(t,(e=>n.DomUtils.removeElement(e))),s=new g.default(o)}else s=this.state.htmlDom;return{htmlDom:s,renderResult:a.default.htmlToReact(s.value,{defaultTextStyle:[e.options.regularTextStyle,e.options.textOverrideStyle,y.default.overflowVisible],emoticonSize:_.frameHeights.emoticons.SMALL,renderEmoticon:this._createEmoticonNodeFromHtml,renderImage:this._createImageNodeFromHtml,renderAtMention:this._createAtMentionNodeFromHtml,renderTextNode:this._createTextNodeFromHtml}),needsHorizontalScroll:this.state&&this.state.needsHorizontalScroll||!1}}_transformHtmlForRendering(e,t,s){return r.map(e,(e=>{if(s&&"text"===e.type&&r.trim(e.data)){const t=e.parent;if(t&&"tag"===t.type&&"i"===t.name)return e;const s=new n.Element("i",{},[e]);return n.DomUtils.replaceElement(e,s),s}if("tag"===e.type&&"img"===e.name&&e.attribs&&e.attribs.itemtype===p.SemanticObjectSchemas.amsImage){const s=n.DomUtils.getSiblings(e),i=r.findIndex(s,e);if(i>=0){let e=i-1;for(;e>=0&&this._checkForLineBreaks(s[e],t);)e--;for(e=i+1;e<s.length&&this._checkForLineBreaks(s[e],t);)e++}}return e.children&&(e.children=this._transformHtmlForRendering(e.children,t,s)),e}))}_checkForLineBreaks(e,t){return"tag"===e.type&&"br"===e.name?(t.push(e),!0):"text"===e.type&&0===r.trim(e.data).length}_getPixelDimension(e){if(r.isString(e)&&r.endsWith(e,"px")){const t=e;return r.toNumber(t.slice(0,-2))}if(r.isNumber(e))return r.toNumber(e)}static highlightText(e,t,s){const i=e.getSearchQuery();if(i)return(0,f.transformToHighlightedText)(s,i,e.isPrimarySearchResult(),S.default.isMyMri(t.creator))}_updateScrollIndicator(){r.isUndefined(this._scrollContentWidth)||r.isUndefined(this._scrollLayoutWidth)||this.setState({needsHorizontalScroll:this._scrollContentWidth>this._scrollLayoutWidth})}render(){return(0,o.jsx)(l.ScrollView,{style:y.default.flexOne,horizontal:!0,vertical:!1,showsHorizontalScrollIndicator:this.state.needsHorizontalScroll,onLayout:this._onScrollViewLayout,onContentSizeChange:this._onContentSizeChange,children:this.state.renderResult})}}t.HtmlNode=v},778408:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=(i.__importStar(s(496486)),i.__importStar(s(516778))),r=i.__importDefault(s(196687)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(958868)),d=i.__importDefault(s(19831)),c=s(815146),u=i.__importDefault(s(663823)),h=i.__importStar(s(85385)),p=i.__importStar(s(50350)),g=(i.__importStar(s(704704)),i.__importDefault(s(353010))),m=i.__importStar(s(786531)),S=s(900440),_=s(206467),f=i.__importDefault(s(872820)),y="web-link";class v extends l.default{_buildState(e){return{magicBotId:a.default.getS4LMessagingFeatures().magicBotId}}constructor(e){super(e),this._getReactionMenuAnchor=()=>this._linkRef,this._getContextMenuItems=()=>{let e=[];return this.props.messageActions&&(e=[...this.props.messageActions.actionMenuCommands]),this.props.supportsCopy&&e.push(_.CommandTypes.CopyLink),this._commandManager.getSXMenuItems(this._createCommandOptions(),e)},this._onLinkRef=e=>{this._linkRef=e||void 0},this._onPress=e=>{var t,s,i;if(!1!==this.props.linkClickable)if(this.props.onPressInterceptionCallback)this.props.onPressInterceptionCallback();else{if(u.default.potentiallyMarkItemViewed(this.props.message,this.props.renderOrigin),g.default.isPiPEnabled()){const e=f.default.getYoutubeVideoPropsFromUrl(this.props.url);if(e)return void g.default.setContentProps(e)}(null===(t=this.props.message)||void 0===t?void 0:t.creator)===this.state.magicBotId&&(null===(s=this.props.message)||void 0===s?void 0:s.conversationId)&&h.track(new m.MessageLink(null===(i=this.props.message)||void 0===i?void 0:i.conversationId)),p.openUrlWithParams({origin:c.BrowserOrigin.LinkNode,url:this.props.url,options:{conversationId:this.props.message?this.props.message.conversationId:void 0,preventInAppNavigationForGuest:!r.default.canNavigateInApp()},rootViewId:this._getRootViewId()})}else e.stopPropagation()},this._onStreamItemCommandSelected=(e,t)=>{this._intOnCommandSelected(e,t.rootViewId)},this._onCommandSelected=e=>{this._intOnCommandSelected(e,this._getRootViewId())},this._onLongPress=e=>{if(this.props.onLongPress)this.props.onLongPress(e);else if(this.props.supportsCopy){const t=[_.CommandTypes.CopyLink],s=this._createCommandOptions();this._commandManager.showSXPopup(s,t,y,(()=>this._linkRef),this._getRootViewId(),e)}},this._commandManager=new S.StreamItemCommandManager(this._onStreamItemCommandSelected)}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s)}requestFocus(){this._linkRef&&this._linkRef.requestFocus()}render(){let e=(0,o.jsx)(n.Link,{ref:this._onLinkRef,style:this.props.style,url:this.props.url,title:this.props.url,onPress:this._onPress,onLongPress:this._onLongPress,selectable:this.props.linkSelectable,numberOfLines:this.props.numberOfLines,maxContentSizeMultiplier:this.props.maxContentSizeMultiplier,tabIndex:this.props.onPressInterceptionCallback?-1:void 0,children:this.props.children});return this.props.onPressInterceptionCallback||(e=(0,o.jsx)(d.default,{wrapperOnly:!1,getMenuItems:this._getContextMenuItems,onItemSelected:this._onCommandSelected,renderAsText:!0,children:e})),e}_intOnCommandSelected(e,t){this._commandManager.dismissSXPopup(y,t),this._commandManager.onActionMenuOptionSelected(this._createCommandOptions(),e)}_createCommandOptions(){return{message:this.props.message,decodedNode:this.props.decodedNode,url:this.props.url,onQuoteCallback:this.props.onQuote,onEditCallback:this.props.onEdit,renderOrigin:this.props.renderOrigin,getReactionMenuPopupAnchor:this._getReactionMenuAnchor,componentContext:this._getContext()}}}t.default=v},313599:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LongitudeDelta=t.LatitudeDelta=void 0;const i=s(197582),o=s(785893),n=s(857969),r=i.__importStar(s(516778)),a=i.__importDefault(s(601976)),l=s(815146),d=i.__importDefault(s(694154)),c=i.__importStar(s(265847)),u=i.__importStar(s(85385)),h=s(26703),p=i.__importStar(s(50350)),g=i.__importStar(s(704704)),m=i.__importStar(s(270127)),S=i.__importStar(s(576047)),_=s(91258),f=i.__importDefault(s(91258)),y=i.__importDefault(s(998929)),v=i.__importDefault(s(363091)),C=(i.__importDefault(s(740794)),i.__importDefault(s(655192))),T=s(16549),M=s(331079),b=i.__importDefault(s(48076)),I=s(262725),w=i.__importDefault(s(497910));t.LatitudeDelta=.0421,t.LongitudeDelta=.0221;const P=(0,h.lazyProperties)({container:()=>r.Styles.createViewStyle({width:_.MapWidth,height:_.LocationHeight,alignItems:"stretch"}),mapSnapshotStyle:()=>r.Styles.createViewStyle({height:0,width:0}),mapStyle:()=>r.Styles.createViewStyle({height:_.MapHeight,width:_.MapWidth}),locationPin:()=>r.Styles.createViewStyle({position:"absolute",top:_.MapHeight/2-m.PinSize/2,left:_.MapWidth/2-m.PinSize/2}),footerContainer:()=>r.Styles.createViewStyle({paddingHorizontal:10,height:_.FooterHeight,justifyContent:"center"}),footerRadius:()=>r.Styles.createViewStyle({borderBottomLeftRadius:10,borderBottomRightRadius:0}),footerRadiusOtherUsers:()=>r.Styles.createViewStyle({borderBottomLeftRadius:10,borderBottomRightRadius:10}),footerTextFirstLine:()=>r.Styles.createTextStyle({marginBottom:5}),mapSnapshotAlternateView:()=>r.Styles.createViewStyle({flex:1,alignSelf:"center",alignItems:"center",justifyContent:"center",width:_.MapWidth,height:_.MapHeight,backgroundColor:T.Color.gray200}),topRadius:()=>r.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),topRadiusOtherUsers:()=>r.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:10})});class k extends w.default{constructor(){super(...arguments),this._setMapViewRef=e=>{this._mapView=e},this._onPress=e=>{u.track(new S.LocationViewerOpen(this.props.message.conversationId,this.props.message)),p.openUrlWithParams({origin:l.BrowserOrigin.LocationNode,url:this.props.bingMapsUrl,options:{conversationId:this.props.message?this.props.message.conversationId:void 0},rootViewId:this._getRootViewId()})},this._onLongPress=e=>{this.props.onLongPress&&this.props.onLongPress(e)}}_buildState(e,t){const s=f.default.getLocationRegionFromLatLong(e.latitude,e.longitude),i={wasOriginallyPostedByCurrentUser:v.default.isMyMri(e.originalCreatorMri),wasLastPostedByCurrentUser:v.default.isMyMri(e.message.creator),shouldRenderSnapshot:this._canTakeMapSnapshot(),latitudeValue:s.latitude,longitudeValue:s.longitude,fileId:f.default.getFileIdForLocation(e.message.cuid),useTabletUI:b.default.isTabletUI()};return i.wasOriginallyPostedByCurrentUser||(i.creatorName=a.default.getMemberShortNameForConversation(e.message.conversationId,e.originalCreatorMri)),c.default.isKnown(i.fileId)?i.mapSnapshotUri=c.default.getLocalUri(i.fileId):i.mapSnapshotUri=f.default.getBingMapsImageUrl(s,_.MapWidth,_.MapHeight),i}_canTakeMapSnapshot(){return!0}componentDidMount(){if(super.componentDidMount(),this.state.shouldRenderSnapshot&&!this.state.mapSnapshotUri&&this._mapView){const e={latitude:this.state.latitudeValue,longitude:this.state.longitudeValue,latitudeDelta:_.LatitudeLongitudeDelta,longitudeDelta:_.LatitudeLongitudeDelta*(_.MapWidth/_.MapHeight)};this._mapView.takeSnapshot(_.MapWidth,_.MapHeight,e,((e,t)=>{if(e)return void u.warn(l.LogTraceArea.LocationNode,"Unable to takeSnapshot: "+C.default.errorAsString(e));if(!t)return void u.warn(l.LogTraceArea.LocationNode,"Unable to takeSnapshot: snapshot is undefined");const s="file://"+t.uri;c.default.isKnown(this.state.fileId)||c.default.save(this.state.fileId,s,this.state.fileId+_.LocationSuffix+".png",Date.now()+6048e5,!1,c.CacheEvictionKind.Preview,Date.now()).then((()=>{this.isComponentMounted()&&this.setState({mapSnapshotUri:c.default.getLocalUri(this.state.fileId)})})).fail((e=>{u.warn(l.LogTraceArea.LocationNode,"Unable to move the screenshot: "+e.code)}))}))}}render(){const e={latitude:this.state.latitudeValue,longitude:this.state.longitudeValue,latitudeDelta:t.LatitudeDelta,longitudeDelta:t.LongitudeDelta};let s,i,a,l=this.props.addressFriendlyName;if(this.props.isUserLocation&&(l=this.state.wasOriginallyPostedByCurrentUser?g.getString("LocationPicker.YourLocationLabel"):g.getString("LocationPicker.OtherPersonLocationLabel",{name:this.state.creatorName||""})),l&&(s=(0,o.jsx)(I.CardTitle,{style:P.footerTextFirstLine,numberOfLines:1,children:l})),this.props.fullAddress){const e=this.props.addressFriendlyName?this.props.shortAddress:this.props.fullAddress;i=(0,o.jsx)(I.Caption,{textThemeColor:I.TextThemeColor.Primary,numberOfLines:1,children:e})}if(s||i){const e=[P.footerContainer,this._themeStyles.cardColorStyle,this.state.wasLastPostedByCurrentUser?P.footerRadius:P.footerRadiusOtherUsers];a=(0,o.jsxs)(r.View,{style:e,children:[s,i]})}const c=(0,o.jsx)(m.default,{style:this.state.shouldRenderSnapshot?P.locationPin:void 0,userMri:this.props.originalCreatorMri,locationType:this.props.isUserLocation?M.LocationType.Current:M.LocationType.None},"locationpin"),u=this.state.shouldRenderSnapshot?c:(0,o.jsx)(n.MapMarker,{coordinate:e,children:c});let h,p;const S=this.state.wasLastPostedByCurrentUser?P.topRadius:P.topRadiusOtherUsers;if(this.state.shouldRenderSnapshot){const e=[P.mapSnapshotAlternateView,S],t=(0,o.jsx)(r.View,{style:e,children:c});p=(0,o.jsx)(d.default,{origin:"LocationSnapshot",resizeMode:"cover",source:this.state.mapSnapshotUri,style:e,containerStyle:e,altView:t,errorView:t,children:c})}if(!this.state.mapSnapshotUri){const t=[this.state.shouldRenderSnapshot?P.mapSnapshotStyle:P.mapStyle,S];h=(0,o.jsx)(n.MapView,{ref:this._setMapViewRef,initialRegion:e,style:t,scrollEnabled:!1,cacheEnabled:!1,pitchEnabled:!1,rotateEnabled:!1,showsUserLocation:!1,loadingEnabled:!1,zoomEnabled:!1,showsMyLocationButton:!0,toolbarEnabled:!1,liteMode:!0,disableRegionChangeUpdates:!0,children:u})}return(0,o.jsxs)(y.default.Button,{style:[P.container,S],onPress:this._onPress,onLongPress:this._onLongPress,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.activeOpacityOverride,keepOriginalProps:!0,disabled:this.props.disableActions,disabledOpacity:1,children:[h,p,a]},"location")}}t.default=k},253829:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LongitudeDelta=t.LatitudeDelta=void 0;const i=s(197582),o=s(785893),n=s(857969),r=i.__importStar(s(516778)),a=s(667294),l=s(537180),d=i.__importStar(s(496486)),c=i.__importDefault(s(601976)),u=s(815146),h=i.__importDefault(s(694154)),p=i.__importStar(s(265847)),g=i.__importStar(s(85385)),m=s(26703),S=i.__importStar(s(704704)),_=i.__importStar(s(270127)),f=s(91258),y=i.__importDefault(s(91258)),v=i.__importDefault(s(998929)),C=i.__importDefault(s(363091)),T=i.__importDefault(s(655192)),M=s(16549),b=s(331079),I=i.__importDefault(s(48076)),w=s(526849),P=s(964414),k=i.__importStar(s(196509));t.LatitudeDelta=.0421,t.LongitudeDelta=.0221;const A=(0,m.lazyProperties)({container:()=>r.Styles.createViewStyle({flexGrow:1,height:f.LocationHeight,alignItems:"stretch"}),mapSnapshotStyle:()=>r.Styles.createViewStyle({height:0,width:0}),mapStyle:()=>r.Styles.createViewStyle({height:f.MapHeight,flexGrow:1}),locationPin:()=>r.Styles.createViewStyle({position:"absolute",top:f.MapHeight/2-_.PinSize/2,left:f.MapWidth/2-_.PinSize/2}),mapSnapshotAlternateView:()=>r.Styles.createViewStyle({flex:1,alignSelf:"center",alignItems:"center",justifyContent:"center",width:"100%",height:f.MapHeight,backgroundColor:M.Color.gray200})});t.default=(0,a.memo)((0,w.WithResub)((e=>{var s;const i=(0,a.useRef)(),[c,m]=(0,a.useState)(e.mapSnapshotUri),y=(0,P.useSkypeStyles)((({themeColors:e})=>({footerTextFirstLine:{color:e.textPrimary,fontSize:15,lineHeight:20,fontWeight:"600"},footerTextSecondLine:{color:e.textSecondary,fontSize:12,lineHeight:20,fontWeight:"400"},footerContainer:{paddingHorizontal:10,height:f.FooterHeight,justifyContent:"center",borderBottomLeftRadius:4,borderBottomRightRadius:4,backgroundColor:e.surfaceOnAccent}})),[]),C={latitude:e.latitudeValue,longitude:e.longitudeValue,latitudeDelta:t.LatitudeDelta,longitudeDelta:t.LongitudeDelta};let M=e.addressFriendlyName;e.isUserLocation&&(M=e.wasOriginallyPostedByCurrentUser?S.getString("LocationPicker.YourLocationLabel"):S.getString("LocationPicker.OtherPersonLocationLabel",{name:e.creatorName||""}));const I=M?(0,o.jsx)(l.Text,{style:y.footerTextFirstLine,ellipsizeMode:"tail",numberOfLines:1,children:M}):void 0,w=e.addressFriendlyName?e.shortAddress:e.fullAddress,x=e.fullAddress?(0,o.jsx)(l.Text,{style:y.footerTextSecondLine,ellipsizeMode:"tail",numberOfLines:1,children:d.capitalize(w)}):void 0,D=I||x?(0,o.jsxs)(l.View,{style:y.footerContainer,children:[I,x]}):void 0,R=(0,o.jsx)(_.default,{style:e.shouldRenderSnapshot?A.locationPin:void 0,userMri:e.originalCreatorMri,locationType:e.isUserLocation?b.LocationType.Current:b.LocationType.None},"locationpin"),L=e.shouldRenderSnapshot?R:(0,o.jsx)(n.MapMarker,{coordinate:C,children:R}),B=c?void 0:(0,o.jsx)(n.MapView,{ref:i,initialRegion:C,style:[e.shouldRenderSnapshot?A.mapSnapshotStyle:A.mapStyle],scrollEnabled:!1,cacheEnabled:!1,pitchEnabled:!1,rotateEnabled:!1,showsUserLocation:!1,loadingEnabled:!1,zoomEnabled:!1,showsMyLocationButton:!0,toolbarEnabled:!1,liteMode:!0,disableRegionChangeUpdates:!0,children:L});let F;if(e.shouldRenderSnapshot){const e=[A.mapSnapshotAlternateView],t=(0,o.jsx)(r.View,{style:e,children:R});F=(0,o.jsx)(h.default,{origin:"LocationSnapshot",resizeMode:"cover",source:c,style:e,containerStyle:e,altView:t,errorView:t,children:R})}return(0,a.useEffect)((()=>{m(e.mapSnapshotUri)}),[e.mapSnapshotUri]),(0,a.useEffect)((()=>{if(e.shouldRenderSnapshot&&!c&&i.current){const t={latitude:e.latitudeValue,longitude:e.longitudeValue,latitudeDelta:f.LatitudeLongitudeDelta,longitudeDelta:f.LatitudeLongitudeDelta*(f.MapWidth/f.MapHeight)};i.current.takeSnapshot(f.MapWidth,f.MapHeight,t,((t,s)=>{if(t)return void g.warn(u.LogTraceArea.LocationNode,"Unable to takeSnapshot: "+T.default.errorAsString(t));if(!s)return void g.warn(u.LogTraceArea.LocationNode,"Unable to takeSnapshot: snapshot is undefined");const i="file://"+s.uri;p.default.isKnown(e.fileId)||p.default.save(e.fileId,i,e.fileId+f.LocationSuffix+".png",Date.now()+6048e5,!1,p.CacheEvictionKind.Preview,Date.now()).then((()=>{m(p.default.getLocalUri(e.fileId))})).fail((e=>{g.warn(u.LogTraceArea.LocationNode,"Unable to move the screenshot: "+e.code)}))}))}}),[]),(0,o.jsxs)(v.default.Button,{disabled:!0,keepOriginalProps:!0,style:[A.container,{width:null===(s=e.renderDimensions)||void 0===s?void 0:s.width,maxWidth:k.replyNodeWidth}],activeOpacity:e.activeOpacityOverride,disabledOpacity:1,children:[B,F,D]},"location")}),((e,t)=>{const s=y.default.getLocationRegionFromLatLong(e.latitude,e.longitude),i={wasOriginallyPostedByCurrentUser:C.default.isMyMri(e.originalCreatorMri),shouldRenderSnapshot:!0,latitudeValue:s.latitude,longitudeValue:s.longitude,fileId:y.default.getFileIdForLocation(e.message.cuid),useTabletUI:I.default.isTabletUI()};return i.wasOriginallyPostedByCurrentUser||(i.creatorName=c.default.getMemberShortNameForConversation(e.message.conversationId,e.originalCreatorMri)),p.default.isKnown(i.fileId)?i.mapSnapshotUri=p.default.getLocalUri(i.fileId):i.mapSnapshotUri=y.default.getBingMapsImageUrl(s,f.MapWidth,f.MapHeight),Object.assign(Object.assign({},e),i)})))},928109:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(217041),r=s(656472),a=i.__importDefault(s(601976)),l=i.__importStar(s(704704)),d=i.__importDefault(s(363091)),c=s(641400);class u extends n.ComponentBase{_buildState(e,t){const s={postedByCurrentUser:d.default.isMyMri(e.authorMri)};return s.postedByCurrentUser||(s.creatorName=a.default.getMemberShortNameForConversation(e.conversationId,e.authorMri)),s}render(){let e=this.props.address;return this.props.isUserLocation?e=d.default.isMyMri(this.props.authorMri)?l.getString("LocationPicker.SharedCurrentLocationYou"):l.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.creatorName||""}):e||(e=l.getString("ContentToReactTransformer.LocationMessageMediaIconPreviewLabel")),(0,o.jsx)(r.ContentPlaceholder,{icon:c.SkypeIcon.Location,label:e,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.default=u},180914:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=s(656472),a=i.__importDefault(s(601976)),l=i.__importStar(s(704704)),d=i.__importDefault(s(363091)),c=s(641400),u=s(526849);t.default=(0,n.memo)((0,u.WithResub)((e=>{let t=e.address;return e.isUserLocation?t=d.default.isMyMri(e.authorMri)?l.getString("LocationPicker.SharedCurrentLocationYou"):l.getString("LocationPicker.SharedCurrentLocation",{userName:e.creatorName||""}):t||(t=l.getString("ContentToReactTransformer.LocationMessageMediaIconPreviewLabel")),(0,o.jsx)(r.ContentPlaceholder,{icon:c.SkypeIcon.Location,label:t,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:e.mediaPlaceholderIconColor,regularTextStyle:e.regularTextStyle,textOverrideStyle:e.textOverrideStyle})}),((e,t)=>{const s={postedByCurrentUser:d.default.isMyMri(e.authorMri)};return s.postedByCurrentUser||(s.creatorName=a.default.getMemberShortNameForConversation(e.conversationId,e.authorMri)),Object.assign(Object.assign({},e),s)})))},194557:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PromptItem=function({item:e,width:t,onPress:s,onLongPress:i}){const r=(0,n.useCallback)((()=>{s(e)}),[e,s]);return(0,o.jsx)(S,{color:e.color,icon:e.icon,title:e.title,width:t,onPress:r,onLongPress:i})},t.ShowMoreItem=function({width:e,onPress:t,onLongPress:s}){return(0,o.jsx)(S,{icon:p.SkypeIcon.More,title:d.getString("MagicBot.ToolboxMessageShowMore"),accessibilityLabel:d.getString("MagicBot.ToolboxMessageShowMoreAccessibilityLabel"),width:e,onPress:t,onLongPress:s})};const i=s(197582),o=s(785893),n=s(667294),r=s(516778),a=s(537180),l=s(344175),d=i.__importStar(s(704704)),c=s(154235),u=i.__importDefault(s(970035)),h=i.__importDefault(s(20758)),p=s(641400),g=s(206315),m=s(964414);function S({icon:e,title:t,color:s,accessibilityLabel:i,width:d,onPress:S,onLongPress:_}){const{themeColors:f}=(0,g.useSkypeTheme)(),y=s?f[s]:f.iconPrimary,[v,C]=(0,n.useState)(130),{containerStyle:T,titleStyle:M}=(0,m.useSkypeStyles)((({themeColors:e,mode:{isAccessible:t}})=>({containerStyle:{width:d,minHeight:v,borderWidth:1,borderRadius:10,backgroundColor:e.surfaceSecondary,borderColor:t?e.dividerPrimary:"transparent",cursor:"pointer"},titleStyle:{fontSize:h.default.fontSize.size14,fontWeight:c.FontWeight.semiBold,lineHeight:18,color:e.textPrimary}})),[v,d]),b=(0,n.useCallback)((({width:e})=>{C(e)}),[]);return(0,o.jsx)(r.View,{onLayout:b,children:(0,o.jsx)(r.Button,{accessibilityLabel:i,onPress:S,onLongPress:_,children:(0,o.jsxs)(l.Column,{flex:"1",justifyContent:"flex-end",alignItems:"flex-start",padding:"size120",space:"size120",style:T,children:[(0,o.jsx)(u.default,{size:p.IconSize.size24,color:y,icon:e}),(0,o.jsx)(a.Text,{style:M,children:t})]})})})}},822255:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=s(344175),a=s(167606),l=s(618629),d=s(626065),c=s(771840),u=s(470177),h=s(194557),p=s(526849),g=i.__importDefault(s(179075)),m=s(493680),S=s(82485),_=s(854642),f=s(96737),y=s(736267),v=s(539058);const C=(0,p.WithResub)((function({items:e,showMore:t,target:s,agentDescription:i,onLongPress:p}){const{rootViewId:g}=(0,y.useCommonContext)(),m="bing"!==s,C=(0,n.useCallback)((e=>{if(e.action===u.MagicBotToolboxAction.Message){const t=[new d.UnhandledEntity(e.prompt)];if(m){const e=new d.AtMentionEntity(i.getDisplayName(),i.getMri());t.unshift(e,new d.UnhandledEntity(" "))}(0,l.triggerContentSetEvent)(t,!0),(0,l.requestMessageComposerFocus)()}else e.action===u.MagicBotToolboxAction.ImageCreator&&(0,f.navigateToImageGeneration)(g,v.ImageGenerationOrigin.MagicToolboxMessage,e.prompt);S.Instrumentation.log(a.LogTraceArea.MagicBot,`Press magic bot toolbox item, id: ${e.id}`),S.Instrumentation.track(new _.MagicBotToolboxItemClick("NO_SECTION",e.id,_.MagicBotToolboxItemOrigin.Message))}),[m,g,i]),{openMagicBotToolbox:T}=(0,c.useMagicBotToolbox)({target:s}),M=(0,n.useCallback)((()=>{T(),S.Instrumentation.track(new _.MagicBotToolboxOpen(_.MagicBotToolboxOrigin.ToolboxMessageShowMore,s))}),[T,s]),[b,I]=(0,n.useState)(130),w=(0,n.useCallback)((e=>{I((e.nativeEvent.layout.width-8)/2)}),[]),P=(0,n.useMemo)((()=>{const s=t?(0,o.jsx)(h.ShowMoreItem,{width:b,onPress:M,onLongPress:p}):void 0,i=e.reduce(((t,i,n)=>{if(n%2==1)return t;const a=e[n+1];return t.push((0,o.jsxs)(r.Row,{width:268,space:8,children:[(0,o.jsx)(h.PromptItem,{item:i,width:b,onPress:C,onLongPress:p}),a?(0,o.jsx)(h.PromptItem,{item:a,width:b,onPress:C,onLongPress:p}):s]},i.id)),t}),[]);return t&&e.length%2==0&&i.push((0,o.jsx)(r.Row,{width:268,children:s},"showMore")),i}),[e,t,b,C,M,p]);return(0,o.jsx)(r.Column,{space:"size80",onLayout:w,children:P})}),(e=>Object.assign(Object.assign({},e),{agentDescription:g.default.getAgentDescriptionForMri((0,m.getMagicBotId)())})));t.default=C},105060:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function({label:e,numberOfLines:t}){const{themeColors:s}=(0,a.useSkypeTheme)(),{container:i,iconContainer:g}=(0,l.useSkypeStyles)((()=>({iconContainer:{width:h,height:p,paddingRight:u},container:{flexDirection:"row",alignItems:"center",height:r.default.messageTextLineHeight}})),[]),{style:m}=(0,l.useRXStyles)((()=>({style:{fontSize:r.default.fontSize.size14,flexShrink:1}})),[]);return(0,o.jsxs)(n.Box,{style:i,children:[(0,o.jsx)(n.Box,{style:g,children:(0,d.getIcon)(d.SkypeIcon.Sparkle,d.IconSize.size16,s.iconPrimary)}),(0,o.jsx)(c.BodyText,{style:m,numberOfLines:t,children:e})]})};const i=s(197582),o=s(785893),n=s(344175),r=i.__importDefault(s(20758)),a=s(206315),l=s(964414),d=s(641400),c=s(825419),u=4,h=16+u,p=16},119735:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MagicBotToolboxNodeFallback=t.MagicBotToolboxNode=void 0;const i=s(197582);var o=s(822255);Object.defineProperty(t,"MagicBotToolboxNode",{enumerable:!0,get:function(){return i.__importDefault(o).default}});var n=s(105060);Object.defineProperty(t,"MagicBotToolboxNodeFallback",{enumerable:!0,get:function(){return i.__importDefault(n).default}})},638340:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NgcUpgradeSystemMessageNode=void 0,t.ngcUpgradeMessageText=h;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(217041),l=i.__importStar(s(44717)),d=i.__importDefault(s(601976)),c=i.__importStar(s(704704));function u(e){return l.isMri(e)?d.default.getDisplayName(e):e}function h(e){let t;if(1===n.size(e))t=c.getString("NgcUpgradeNode.NgcUpgradeOneMessage",{user:u(e[0])||""});else{const s=n.last(e),i=n.filter(e,(e=>e!==s));t=c.getString("NgcUpgradeNode.NgcUpgradeManyMessage",{users:n.map(i,(e=>u(e))).join(", "),lastUser:u(s)||""})}return t}class p extends a.ComponentBase{_buildState(e,t){return{ngcUpgradeMessage:h(e.userMrisOrNames)}}render(){return(0,o.jsx)(r.Text,{style:[this.props.systemTextStyle,this.props.textOverrideStyle],numberOfLines:this.props.numberOfLines||0,children:this.state.ngcUpgradeMessage},"ngcUpgradeMessage")}}t.NgcUpgradeSystemMessageNode=p},200750:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(623627)),l=i.__importDefault(s(150343)),d=i.__importDefault(s(389659)),c=i.__importDefault(s(186325)),u=i.__importDefault(s(970035)),h=i.__importStar(s(85385)),p=s(26703),g=i.__importStar(s(704704)),m=s(186907),S=i.__importDefault(s(904210)),_=i.__importDefault(s(762900)),f=i.__importDefault(s(125611)),y=s(658171),v=i.__importStar(s(790525)),C=s(16549),T=s(641400),M=s(262725),b=i.__importDefault(s(497910)),I=(0,p.lazyProperties)({attribution:()=>(0,p.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"row",paddingTop:10,paddingBottom:15,paddingHorizontal:15}),text:()=>r.Styles.createTextStyle({lineHeight:16,paddingLeft:8})}),cardContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",overflow:"visible",width:240,borderTopLeftRadius:10,borderTopRightRadius:10,borderBottomLeftRadius:10,borderBottomRightRadius:0}),details:()=>(0,p.lazyProperties)({button:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",marginVertical:12,marginHorizontal:3}),text:()=>r.Styles.createTextStyle({lineHeight:22})}),divider:()=>r.Styles.createViewStyle({height:1,backgroundColor:C.Color.white}),expiration:()=>(0,p.lazyProperties)({text:()=>r.Styles.createTextStyle({lineHeight:16,paddingTop:10,paddingLeft:15})}),title:()=>r.Styles.createTextStyle({lineHeight:24,paddingHorizontal:15,paddingTop:15,marginBottom:5}),winner:()=>(0,p.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"column",paddingHorizontal:15,paddingTop:15}),emoticonContainer:()=>r.Styles.createViewStyle({flexDirection:"column",paddingBottom:28,backgroundColor:C.Color.white,alignItems:"center"}),header:()=>r.Styles.createTextStyle({lineHeight:24}),text:()=>r.Styles.createTextStyle({paddingTop:15,paddingBottom:27,paddingHorizontal:15,color:C.Color.black}),textInPreviewMode:()=>r.Styles.createTextStyle({color:C.Color.black,paddingVertical:5}),title:()=>r.Styles.createTextStyle({lineHeight:16,paddingVertical:5,fontStyle:"italic"})})});class w extends b.default{constructor(){super(...arguments),this._onVote=e=>{v.selectVote(this.props.message,v.getMyVotes(this.state.pollVotes),e,this.props.expirationTimeMs,this.props.allowMultipleVotes,y.VoteOrigin.Card)},this._onViewPollDetails=()=>{h.track(new y.PollDetailsOpenedEvent(this.props.message)),S.default.navigateToPollSummaryPanel({conversationId:this.props.conversationId,message:this.props.message,title:this.props.title,expirationTimeMs:this.props.expirationTimeMs,options:this.props.options,allowMultipleVotes:this.props.allowMultipleVotes},this._getRootViewId())}}_buildState(e){const t=l.default.getS4LMessagingFeatures(),s=e.message.getPollData(),i=v.combinePollOptionsAndVotes(e.options,s,e.message,!1),o=f.default.getPollByMessageCuid(e.message.cuid);return{pollVotes:i,isPollExpired:v.isPollExpired(o?o.expirationTimeMs:e.expirationTimeMs),noVotesEmoticonName:t.pollNoVotesEmoticonName,winnerEmoticonName:t.pollWinnerEmoticonName}}render(){return this.state.isPollExpired?this._renderResultsCardForExpiredPoll():this._renderCardForUnexpiredPoll()}_renderResultsCardForExpiredPoll(){return(0,o.jsxs)(r.View,{style:[I.cardContainer,this._themeStyles.cardColorStyle],importantForAccessibility:r.Types.ImportantForAccessibility.No,children:[this._renderWinnerHeader(),this._renderAttribution(),(0,o.jsx)(c.default,{style:I.divider}),this._renderDetailsButton()]},"pollCardNode_"+this.props.message.getLatestServerMessageId())}_renderCardForUnexpiredPoll(){return(0,o.jsxs)(r.View,{style:[I.cardContainer,this._themeStyles.cardColorStyle],importantForAccessibility:r.Types.ImportantForAccessibility.No,children:[this._renderTitle(),this._renderOptions(),this._renderExpiration(),this._renderAttribution(),(0,o.jsx)(c.default,{style:I.divider}),this._renderDetailsButton()]},"pollCardNode_"+this.props.message.getLatestServerMessageId())}_renderWinnerHeader(){const e=v.getMaxVoteOptions(this.state.pollVotes),t=this.props.isActionable?(0,o.jsx)(M.CardTitle,{style:[I.winner.header,this._themeStyles.headerTextColorStyle],useSmallTitle:!1,children:this._getWinnerTitle(e)}):void 0;return(0,o.jsxs)(r.View,{style:I.winner.container,importantForAccessibility:r.Types.ImportantForAccessibility.No,children:[t,(0,o.jsx)(M.Caption,{style:I.winner.title,children:this.props.title}),this._renderWinnerIcon(e)]},"pollCardNode_"+this.props.message.getLatestServerMessageId())}_getWinnerTitle(e){return!e||n.isEmpty(e)?g.getString("Poll.NoVotesWinnerLabel"):e.length>1?g.getString("Poll.TieLabel"):g.getString("Poll.WinnerLabel")}_renderWinnerIcon(e){const t=[I.winner.emoticonContainer];return this.props.isActionable||t.push(r.Styles.createViewStyle({paddingBottom:20})),(0,o.jsxs)(r.View,{style:t,importantForAccessibility:r.Types.ImportantForAccessibility.No,children:[(0,o.jsx)(M.CardTitle,{style:this.props.isActionable?I.winner.text:I.winner.textInPreviewMode,useSmallTitle:!this.props.isActionable,children:n.join(e,g.getString("Poll.TieVotesSeparator"))}),(0,o.jsx)(a.AnimatedEmoticon,{emoticonName:this._getEmoticonName(e),size:this.props.isActionable?m.EmoticonSize.ExtraLarge:m.EmoticonSize.Medium})]})}_getEmoticonName(e){return n.isEmpty(e)?this.state.noVotesEmoticonName:this.state.winnerEmoticonName}_renderTitle(){return(0,o.jsx)(r.View,{importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:g.getString("Poll.StreamItemAccessibilityLabel",{question:this.props.title}),children:(0,o.jsx)(M.CardTitle,{style:[I.title,this._themeStyles.headerTextColorStyle],useSmallTitle:!1,children:this.props.title})})}_renderOptions(){if(!n.isEmpty(this.state.pollVotes)&&this.props.isActionable)return n.map(n.keys(this.state.pollVotes),((e,t)=>this._renderPollOption(t,e,this.state.pollVotes[e])))}_renderPollOption(e,t,s){return(0,o.jsx)(_.default,{expirationTimeMs:this.props.expirationTimeMs,index:e,onVote:this._onVote,option:t,users:s},"pollOption"+e)}_renderExpiration(){if(!this.props.isActionable)return;const e=g.getString("Poll.ExpirationDateLabel",{expirationDate:d.default.getConditionalDateTimeString(this.props.expirationTimeMs)});return(0,o.jsx)(M.Caption,{style:I.expiration.text,children:e})}_renderAttribution(){return(0,o.jsxs)(r.View,{style:I.attribution.container,children:[(0,o.jsx)(u.default,{icon:T.SkypeIcon.Poll,size:T.IconSize.size16,color:this._themeColors.primaryIconColor}),(0,o.jsx)(M.Caption,{style:I.attribution.text,children:g.getString("Poll.Header")})]})}_renderDetailsButton(){if(!this.props.isActionable)return;const e=this.state.isPollExpired?g.getString("Poll.SummaryButtonTextAfterExpiration"):g.getString("Poll.SummaryButtonTextBeforeExpiration");return(0,o.jsx)(r.Button,{style:I.details.button,accessibilityLabel:e,onPress:this._onViewPollDetails,children:(0,o.jsx)(M.BodyText,{style:I.details.text,bold:!0,children:e})})}}t.default=w},423046:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=s(537180),a=i.__importDefault(s(970035)),l=s(641400),d=s(206315),c=s(964414),u=i.__importStar(s(704704)),h=i.__importDefault(s(20758)),p=s(154235);t.default=(0,n.memo)((e=>{const{themeColors:t}=(0,d.useSkypeTheme)(),s=(0,c.useSkypeStyles)((({themeColors:t})=>({container:{padding:16,borderRadius:4,backgroundColor:t.surfacePrimary,minWidth:e.renderDimensions.width},title:{color:t.textPrimary,fontSize:h.default.fontSize.size15,fontWeight:p.FontWeight.bold,lineHeight:20},rowDirection:{marginTop:8,flexDirection:"row"},typeText:{color:t.textSecondary,fontSize:h.default.fontSize.size12,fontWeight:p.FontWeight.regular,lineHeight:16,marginLeft:4}})),[e.renderDimensions.width]);return(0,o.jsxs)(r.View,{style:s.container,children:[(0,o.jsxs)(r.Text,{style:s.title,children:[e.title," "]}),(0,o.jsxs)(r.View,{style:s.rowDirection,children:[(0,o.jsx)(a.default,{icon:l.SkypeIcon.Poll,size:l.IconSize.size16,color:t.textPrimary}),(0,o.jsx)(r.Text,{style:s.typeText,children:u.getString("Poll.PlaceholderText")})]})]})}))},789603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuoteOnly=t.QuoteNode=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=(s(331654),i.__importStar(s(516778))),a=s(217041),l=i.__importDefault(s(970035)),d=i.__importDefault(s(304623)),c=i.__importStar(s(44717)),u=s(656472),h=i.__importDefault(s(958868)),p=i.__importDefault(s(615364)),g=i.__importDefault(s(389659)),m=i.__importDefault(s(601976)),S=i.__importStar(s(242561)),_=i.__importDefault(s(453761)),f=s(26703),y=i.__importStar(s(704704)),v=i.__importDefault(s(363091)),C=i.__importDefault(s(960282)),T=s(332975),M=s(16549),b=s(641400),I=i.__importStar(s(179582)),w=(i.__importDefault(s(48076)),s(657802)),P=(0,f.lazyProperties)({quoteContainer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"column",backgroundColor:M.Color.transparent}),quoteContainerInDesktopComposer:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:15}),quoteContainerInForwardCanvas:()=>r.Styles.createViewStyle({flex:1,flexDirection:"row",paddingBottom:12}),quoteSeparator:()=>r.Styles.createViewStyle({borderStyle:"solid",borderBottomWidth:1,marginBottom:5}),quoteSeparatorInChat:()=>r.Styles.createViewStyle({marginBottom:14}),openQuote:()=>r.Styles.createViewStyle({marginBottom:4,flexDirection:"row"}),quoteTextDesktopStyles:()=>r.Styles.createTextStyle({paddingRight:4}),quoteAttribute:()=>r.Styles.createTextStyle({marginTop:6,marginBottom:12}),quoteContentContainer:()=>r.Styles.createViewStyle({flex:1,paddingLeft:20}),quoteContentContainerInForwardCanvas:()=>r.Styles.createViewStyle({flex:1,paddingHorizontal:10}),quoteContentTextInComposer:()=>r.Styles.createViewStyle({flex:1,maxHeight:250,alignSelf:"stretch"}),quoteContentTextInStream:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),clearQuoteButton:()=>r.Styles.createButtonStyle({position:"absolute",top:4,right:0,marginTop:-5})});class k extends h.default{constructor(){super(...arguments),this._onPressQuote=e=>{e.stopPropagation(),this.props.options.onPressInterceptionCallback?this.props.options.onPressInterceptionCallback():this.state.conversationIdForNavigation&&this.props.messageTimestamp&&this.props.options.onFollowQuoteLink&&this.props.options.onFollowQuoteLink(e,this.state.conversationIdForNavigation,this.props.messageTimestamp)},this._onLongPress=e=>{e.stopPropagation(),this.props.options.onLongPressContent&&this.props.options.onLongPressContent(e)}}_buildState(e,t){let s;if(e.authorSkypeId){const t=c.skypeIdToMri(e.authorSkypeId);t&&(s=m.default.getDisplayName(t))}s||(s=e.authorname||e.authorSkypeId);const i=y.getString("ContentToReactTransformer.QuoteNodeAttributeText",{name:s.trim(),date:g.default.getDisplayDateTimeString(e.timestamp)}),o=e.searchStore?e.searchStore.getSearchQuery():void 0;let n;n=o&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,T.transformToHighlightedText)(i,o.query,e.searchStore.isMessageFocused(e.message.cuid),v.default.isMyMri(e.message.creator)):[i];const r=this._getRootViewId();return{attributeText:n,suppressAttribution:(e.options.renderOrigin,S.MessageRenderOrigin.ChatCanvas,e.options.renderOrigin===S.MessageRenderOrigin.ForwardCanvas),isSmallDevice:C.default.isSmallDevice(r),replySymbol:I.getReplySymbol(),conversationIdForNavigation:this._getConverstionIdForNavigation(e)}}render(){let e;if(!this.props.options.onlyQuotedContent||this.props.options.renderOrigin===S.MessageRenderOrigin.ForwardCanvas){const t=n.compact([P.quoteSeparator,this.props.options.renderOrigin===S.MessageRenderOrigin.ChatCanvas?P.quoteSeparatorInChat:void 0,this.props.options.quoteSeparatorStyle]);e=(0,o.jsx)(r.View,{style:t},"quote.separator")}const t=[this._getOpenQuote(),this._getQuoteContent()];let s,i=P.quoteContainer;this.props.options.renderOrigin===S.MessageRenderOrigin.ForwardCanvas?i=P.quoteContainerInForwardCanvas:this.props.options.renderOrigin!==S.MessageRenderOrigin.ChatCanvas&&this.props.options.renderOrigin!==S.MessageRenderOrigin.CallCanvas&&(i=P.quoteContainerInDesktopComposer);const a=[S.MessageRenderOrigin.ForwardCanvas,S.MessageRenderOrigin.MessageComposerCanvas];return s=n.includes(a,this.props.options.renderOrigin)?(0,o.jsx)(r.View,{style:i,children:t},"quote.maybeclickable"):n.isUndefined(this.state.conversationIdForNavigation)?t:(0,o.jsx)(r.Button,{style:i,onPress:this._onPressQuote,onLongPress:void 0,onContextMenu:this.props.onContextMenu,activeOpacity:this.props.options.activeOpacityOverride,disabled:this.props.options.disableActions,disabledOpacity:1,children:t},"quote.maybeclickable"),(0,o.jsxs)(r.View,{style:P.quoteContainer,children:[s,e,this._getQuoteCloseButton()]})}_getConverstionIdForNavigation(e){if(!e.conversationId||!e.messageTimestamp)return;if(v.default.isMyMri(e.conversationId))return e.options.message&&e.options.message.creator;const t=d.default.getConversationMetaFromMemoryCache(e.conversationId);if(t&&(0,p.default)().ableToViewConversation(e.conversationId)){if(!t.conv.isThread()){if(n.isUndefined(e.authorSkypeId)||n.isUndefined(e.options.message))return;if(!v.default.isMyMri(c.skypeIdToMri(e.authorSkypeId))&&!v.default.isMyMri(e.options.message.creator))return}return e.conversationId}}_getOpenQuote(){var e,t,s,i;return(0,o.jsx)(l.default,{icon:this.state.replySymbol,size:null!==(t=null===(e=this.props.options.quoteSymbolStyle)||void 0===e?void 0:e.size)&&void 0!==t?t:b.IconSize.size16,color:null!==(i=null===(s=this.props.options.quoteSymbolStyle)||void 0===s?void 0:s.color)&&void 0!==i?i:M.Color.black,style:P.openQuote,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants},"quote.open")}_getQuoteContent(){const e=this.state.suppressAttribution?void 0:(0,o.jsx)(r.Text,{style:[P.quoteAttribute,this.props.options.textOverrideStyle,this.props.options.quoteAttributeStyle],children:this.state.attributeText},"quote.author"),t=this.props.options.renderOrigin===S.MessageRenderOrigin.ChatCanvas||this.props.options.renderOrigin===S.MessageRenderOrigin.ForwardCanvas||this.props.options.renderOrigin===S.MessageRenderOrigin.CallCanvas?P.quoteContentTextInStream:P.quoteContentTextInComposer,s=[this.props.options.textOverrideStyle,this.props.options.quotedTextStyle,P.quoteTextDesktopStyles],i=(0,w.hasOnlyInlineElements)(this.props.children)?(0,o.jsx)(r.Text,{style:s,numberOfLines:this.props.numberOfLines,children:this.props.children}):(0,o.jsx)(r.View,{children:this.props.children});let n;return this.props.narrowView||(n=this.props.options.renderOrigin===S.MessageRenderOrigin.ForwardCanvas?P.quoteContentContainerInForwardCanvas:P.quoteContentContainer),(0,o.jsxs)(r.View,{style:n,children:[(0,o.jsx)(r.View,{style:t,children:i}),e]},"quote.content")}_getQuoteCloseButton(){return this.props.options.renderOrigin!==S.MessageRenderOrigin.ChatCanvas&&this.props.options.onClearQuote?(0,o.jsx)(_.default,{style:P.clearQuoteButton,title:y.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:this.props.options.onClearQuote,size:b.IconSize.size16,color:M.Color.gray300,hoverColor:M.Color.black,icon:b.SkypeIcon.Cancel,disabled:this.props.options.disableActions}):void 0}}t.QuoteNode=k;class A extends a.ComponentBase{_buildState(e,t){return{replySymbol:I.getReplySymbol()}}render(){return(0,o.jsx)(u.ContentPlaceholder,{icon:this.state.replySymbol,label:y.getString("ContentToReactTransformer.QuoteIconPreviewLabel"),mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle})}}t.QuoteOnly=A},643833:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuoteNodeRedesign=void 0;const i=s(197582),o=s(785893),n=s(496486),r=s(667294),a=i.__importStar(s(516778)),l=(s(331654),s(537180)),d=i.__importDefault(s(970035)),c=i.__importDefault(s(304623)),u=i.__importStar(s(44717)),h=i.__importDefault(s(615364)),p=i.__importDefault(s(389659)),g=i.__importDefault(s(601976)),m=i.__importStar(s(242561)),S=i.__importDefault(s(453761)),_=i.__importStar(s(704704)),f=i.__importDefault(s(363091)),y=(i.__importDefault(s(960282)),s(332975)),v=s(16549),C=s(641400),T=i.__importStar(s(179582)),M=(i.__importDefault(s(48076)),s(657802)),b=s(526849),I=s(736267),w=s(964414),P=s(206315),k=i.__importDefault(s(20758)),A=s(154235),x=i.__importDefault(s(827361)),D=e=>{if(!e.conversationId||!e.messageTimestamp)return;if(f.default.isMyMri(e.conversationId))return e.options.message&&e.options.message.creator;const t=c.default.getConversationMetaFromMemoryCache(e.conversationId);if(t&&(0,h.default)().ableToViewConversation(e.conversationId)){if(!t.conv.isThread()){if((0,n.isUndefined)(e.authorSkypeId)||(0,n.isUndefined)(e.options.message))return;if(!f.default.isMyMri(u.skypeIdToMri(e.authorSkypeId))&&!f.default.isMyMri(e.options.message.creator))return}return e.conversationId}};t.QuoteNodeRedesign=(0,b.WithResub)((0,r.memo)((e=>{var t,s,i,r;const{rootViewId:c}=(0,I.useCommonContext)(),{themeColors:u}=(0,P.useSkypeTheme)(),h=e.options.renderOrigin===m.MessageRenderOrigin.ChatCanvas,p=e.options.renderOrigin===m.MessageRenderOrigin.ForwardCanvas,g=e.options.renderOrigin===m.MessageRenderOrigin.MessageComposerCanvas,f=p||!h&&!1,y=(0,w.useSkypeStyles)((({themeColors:t})=>{const s=g?0:2;return{container:{flexGrow:1,flexShrink:1,flexDirection:"row",backgroundColor:!e.wasCreatedByCurrentUser||g||p?t.surfaceQuaternary:t.surfaceAccent,borderTopRightRadius:e.wasCreatedByCurrentUser?0:4,borderBottomRightRadius:4},containerBorderRadius:{[e.wasCreatedByCurrentUser?"borderTopRightRadius":"borderTopLeftRadius"]:0},containerBoxShadow:{elevation:2,shadowColor:v.Color.blackOverlay20,shadowOffset:{width:1,height:1.5},shadowRadius:1,shadowOpacity:1},containerShadowWrapper:{flex:1,paddingRight:s,paddingBottom:s,marginBottom:g?0:6,borderRadius:4,overflow:"hidden"},quoteContainer:{flex:1,flexDirection:"row"},quoteContent:{padding:8,flexGrow:1,flexShrink:1,width:"100%"},quoteAttribute:{color:t.textPrimary},quoteContainerInComposer:{flex:1,flexDirection:"row",marginRight:15},quoteContainerInForwardCanvas:{flex:1,flexDirection:"row"},quoteContentContainer:{flex:1},quoteContentText:{flex:1,alignSelf:"stretch",marginTop:10,marginBottom:10},clearQuoteButton:{position:"absolute",top:4,right:0,marginTop:-5},quoteIndicator:{width:3,borderBottomLeftRadius:3,backgroundColor:t.surfaceInteractive},fileMetaSeparator:{width:1,height:12,marginHorizontal:6,backgroundColor:t.textPrimary},fileMetaText:{fontSize:k.default.fontSize.size12,fontWeight:A.FontWeight.regular,color:t.textPrimary}}}),[e.wasCreatedByCurrentUser,g,p]),T=t=>{t.stopPropagation(),e.options.onPressInterceptionCallback?e.options.onPressInterceptionCallback():e.conversationIdForNavigation&&e.messageTimestamp&&e.options.onFollowQuoteLink&&e.options.onFollowQuoteLink(t,e.conversationIdForNavigation,e.messageTimestamp)};let b=y.quoteContainer;const D=[y.container,y.containerBoxShadow],R=[y.containerShadowWrapper];p?b=y.quoteContainerInForwardCanvas:h||e.options.renderOrigin===m.MessageRenderOrigin.CallCanvas||(b=y.quoteContainerInComposer),g||R.push(y.containerBorderRadius);let L=(0,o.jsx)(l.View,{style:b,children:(0,o.jsxs)(l.View,{style:y.quoteContent,children:[(0,o.jsx)(d.default,{icon:e.replySymbol,size:null!==(s=null===(t=e.options.quoteSymbolStyle)||void 0===t?void 0:t.size)&&void 0!==s?s:C.IconSize.size16,color:null!==(r=null===(i=e.options.quoteSymbolStyle)||void 0===i?void 0:i.color)&&void 0!==r?r:v.Color.black,importantForAccessibility:a.Types.ImportantForAccessibility.NoHideDescendants},"quote.open"),(()=>{const t=f?void 0:(0,o.jsx)(a.Text,{style:[{color:u.textPrimary},e.options.textOverrideStyle,e.options.quoteAttributeStyle],children:e.attributeText},"quote.author"),s=[e.options.textOverrideStyle,e.options.quotedTextStyle],i=e.narrowView?void 0:y.quoteContentContainer;let r;return r=(0,M.hasOnlyInlineElements)(e.children)?p?(0,o.jsx)(a.Text,{style:s,children:(0,o.jsx)(l.Text,{numberOfLines:e.numberOfLines,children:e.children})}):(0,o.jsx)(a.Text,{style:s,numberOfLines:!(0,n.isUndefined)(e.conversationIdForNavigation)&&!e.message.isForwarded()||g?e.numberOfLines:void 0,children:e.children}):(0,o.jsx)(l.View,{children:e.children}),(0,o.jsxs)(l.View,{style:i,children:[(0,o.jsx)(l.View,{style:y.quoteContentText,children:r}),t]},"quote.content")})()]})},"quote.maybeclickable");const B=[m.MessageRenderOrigin.ForwardCanvas,m.MessageRenderOrigin.MessageComposerCanvas];return(0,n.includes)(B,e.options.renderOrigin)||(0,n.isUndefined)(e.conversationIdForNavigation)||(L=(0,o.jsx)(a.Button,{onPress:T,onLongPress:void 0,onContextMenu:e.onContextMenu,activeOpacity:e.options.activeOpacityOverride,disabled:e.options.disableActions,disabledOpacity:1,style:x.default.flexOne,children:L})),(0,o.jsx)(l.View,{style:R,children:(0,o.jsxs)(l.View,{style:D,children:[(0,o.jsx)(l.View,{style:y.quoteIndicator}),L,(()=>{if(!h&&e.options.onClearQuote)return(0,o.jsx)(S.default,{style:y.clearQuoteButton,title:_.getString("MessageComposer.RemoveQuoteButtonTitle"),onPress:e.options.onClearQuote,size:C.IconSize.size16,color:v.Color.gray300,hoverColor:v.Color.black,icon:C.SkypeIcon.Cancel,disabled:e.options.disableActions})})()]})})})),(e=>{var t,s;let i;if(e.authorSkypeId){const t=u.skypeIdToMri(e.authorSkypeId);t&&(i=g.default.getDisplayName(t))}i||(i=e.authorname||e.authorSkypeId);const o=_.getString("ContentToReactTransformer.QuoteNodeAttributeText",{name:null!==(t=null==i?void 0:i.trim())&&void 0!==t?t:"",date:p.default.getDisplayDateTimeString(e.timestamp)}),n=e.searchStore?e.searchStore.getSearchQuery():void 0,r=n&&e.searchStore&&e.searchStore.isMessageInConvSearchResults(e.message.cuid)?(0,y.transformToHighlightedText)(o,n.query,e.searchStore.isMessageFocused(e.message.cuid),f.default.isMyMri(e.message.creator)):[o];return Object.assign(Object.assign({},e),{wasCreatedByCurrentUser:!!(null===(s=e.options.message)||void 0===s?void 0:s.creator)&&f.default.isMyMri(e.options.message.creator),attributeText:r,replySymbol:T.getReplySymbol(),conversationIdForNavigation:D(e)})}))},472126:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importDefault(s(963786)),r=i.__importDefault(s(852528)),a=s(656472),l=i.__importDefault(s(958868)),d=i.__importStar(s(704704)),c=i.__importDefault(s(994962)),u=i.__importStar(s(446574)),h=s(641400);class p extends l.default{_buildState(e,t){let s;if(u.HasStarted(c.default)){const i=t?e.options.message:void 0;s=c.default.getScheduledCallById(e.scheduledCallId,i)}return{scheduledCall:s}}render(){let e;return e=this.props.options.renderMedia&&this.state.scheduledCall&&this.props.options.onCallInviteAccepted&&this.props.options.onCallInviteDeclined?this.props.isSender?(0,o.jsx)(r.default,{scheduledCall:this.state.scheduledCall,message:this.props.options.message,onLongPress:this.props.options.onLongPressContent,messagePadding:this.props.options.messagePadding,renderDimensions:this.props.renderDimensions}):(0,o.jsx)(n.default,{scheduledCall:this.state.scheduledCall,onCallInviteAccepted:this.props.options.onCallInviteAccepted,onCallInviteDeclined:this.props.options.onCallInviteDeclined,message:this.props.options.message,onLongPress:this.props.options.onLongPressContent,renderDimensions:this.props.renderDimensions}):(0,o.jsx)(a.ContentPlaceholder,{icon:h.SkypeIcon.Schedule,label:d.getString("ContentToReactTransformer.ScheduledCallPreviewLabel"),mediaPlaceholderIconColor:this.props.options.mediaPlaceholderIconColor,regularTextStyle:this.props.options.regularTextStyle,textOverrideStyle:this.props.options.textOverrideStyle}),e}}t.default=p},778098:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(217041);class a extends r.ComponentBase{constructor(){super(...arguments),this._onPressed=()=>{this.props.onHighlightedTextPressed&&this.props.onHighlightedTextPressed(this.props.text,this.props.activityId)}}render(){return(0,o.jsx)(n.Text,{style:this.props.style,selectable:this.props.selectable,numberOfLines:this.props.numberOfLines,onPress:this._onPressed,children:this.props.children})}}t.default=a},212803:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(217041),r=s(242561),a=i.__importDefault(s(663823)),l=i.__importDefault(s(981464)),d=s(823102),c=s(803193),u={height:130,width:240};class h extends n.ComponentBase{constructor(){super(...arguments),this._onSwiftCardPressTelemetryCallback=()=>{a.default.potentiallyMarkItemViewed(this.props.message,this.props.options.renderOrigin)}}static getConstrainedWidth(e){return l.default.getConstrainedWidth(e)}_componentDidRender(){var e;if(this.props.conversationId){const t=(0,c.getArticleSwiftMessageTelemetryUrl)(this.props.swiftMessage);t&&(null===(e=(0,d.getOrCreatePeregrineTelemetryClient)(this.props.conversationId))||void 0===e||e.assignIdentifier(t))}}render(){const e=this.props.options;return this.props.options.renderOrigin!==r.MessageRenderOrigin.CompositeGalleryCanvas&&this.props.options.renderOrigin!==r.MessageRenderOrigin.StackGalleryCanvas||(e.onSwiftCardPressTelemetryCallback=this._onSwiftCardPressTelemetryCallback),this.props.options.renderOrigin===r.MessageRenderOrigin.MessageComposerCanvas&&(e.availableSpace=u),(0,o.jsx)(l.default,{swiftMessage:this.props.swiftMessage,options:e,postedByCurrentUser:this.props.postedByCurrentUser,conversationId:this.props.conversationId,displayInPreviewMode:!this.props.isActionable})}}t.default=h},454547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=s(242561),a=i.__importDefault(s(981464)),l=i.__importDefault(s(663823)),d={height:150,width:240},c=e=>{const t=e.options,s=()=>{l.default.potentiallyMarkItemViewed(e.message,e.options.renderOrigin)};return e.options.renderOrigin!==r.MessageRenderOrigin.CompositeGalleryCanvas&&e.options.renderOrigin!==r.MessageRenderOrigin.StackGalleryCanvas||(t.onSwiftCardPressTelemetryCallback=s),e.options.renderOrigin===r.MessageRenderOrigin.MessageComposerCanvas&&(t.availableSpace=d),(0,o.jsx)(a.default,{swiftMessage:e.swiftMessage,options:t,postedByCurrentUser:e.postedByCurrentUser,conversationId:e.conversationId,displayInPreviewMode:!e.isActionable,displayInReplyMessage:e.displayInReplyMessage})};c.getConstrainedWidth=e=>a.default.getConstrainedWidth(e),t.default=(0,n.memo)(c)},374137:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(217041),r=s(656472),a=i.__importStar(s(591312)),l=i.__importStar(s(463519)),d=i.__importDefault(s(601976)),c=i.__importStar(s(242561)),u=i.__importDefault(s(606617)),h=i.__importStar(s(704704)),p=s(606933),g=s(641400),m=i.__importDefault(s(615364)),S=s(742403);class _ extends n.ComponentBase{_buildState(e,t){var s;const i=null===(s=e.message)||void 0===s?void 0:s.conversationId,o=i?(0,m.default)().getConversation(i):void 0;return{labelText:this._getLabelText(d.default.getDisplayName(e.creatorMri)),icon:this._getIcon(),isNewsChannel:(0,S.isContentChannel)(o),isNewsBot:(0,S.isTodayBot)(i)}}_getLabelText(e){let t;if(this.props.message){const s=l.decode(this.props.message).getFirstUriObjectChild(p.SwiftUriObjectNode);s&&(t=a.renderText(s,{message:this.props.message,processing:{quotes:c.ProcessingLevel.None,wikiMarkup:c.ProcessingLevel.Stripped},trimToFirstLine:!0}),"Card"===t&&(t=h.getString("SwiftCard.Card")),s.getCardType()===u.default.imageContentTypes.gif&&e&&(t=h.getString("ContentToReactTransformer.GifCardIconPreviewLabel",{creator:e})))}return t||(t=e?h.getString("ContentToReactTransformer.CardIconPreviewLabelLong",{creator:e}):h.getString("ContentToReactTransformer.CardIconPreviewLabelShort")),t}_getIcon(){if(this.props.message){const e=l.decode(this.props.message).getFirstUriObjectChild(p.SwiftUriObjectNode);if(e&&e&&e.getCardType()===u.default.imageContentTypes.gif)return g.SkypeIcon.Gif}return g.SkypeIcon.Card}render(){return(0,o.jsx)(r.ContentPlaceholder,{icon:this.state.icon,label:this.state.labelText,numberOfLines:1,allowTextSelection:!1,mediaPlaceholderIconColor:this.props.mediaPlaceholderIconColor,regularTextStyle:this.props.regularTextStyle,textOverrideStyle:this.props.textOverrideStyle,isNewsChannel:this.state.isNewsChannel,isNewsBot:this.state.isNewsBot})}}t.default=_},864130:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionNode=void 0;const i=s(197582),o=s(785893),n=s(516778),r=i.__importDefault(s(150343)),a=i.__importDefault(s(20758)),l=s(964414),d=i.__importDefault(s(19831)),c=s(998908),u=s(701032),h=s(526849),p=s(786531);t.AttributionNode=(0,h.WithResub)((({node:e,attributions:t,isFooter:s,children:i,supportsCopy:r,linkSelectable:h,linkClickable:g,message:m,decodedNode:S,messageActions:_,renderOrigin:f,magicBotId:y,onPress:v,onLongPress:C,onQuote:T,onEdit:M,onPressInterceptionCallback:b})=>{var I;const{commandManagerRef:w,commandOptions:P,linkRef:k,handleLinkRef:A,contextMenuItems:x,handleCommandSelected:D}=(0,c.useAttributionNodeExtras)({node:e,supportsCopy:r,linkClickable:g,message:m,decodedNode:S,messageActions:_,renderOrigin:f,onPress:v,onLongPress:C,onQuote:T,onEdit:M}),{handlePress:R,handleLongPress:L,handleHoverStart:B,handleHoverEnd:F}=(0,u.useAttributionNodePressEvents)({node:e,attributions:t,message:m,supportsCopy:r,linkClickable:g,renderOrigin:f,magicBotId:y,commandManagerRef:w,commandOptions:P,linkRef:k,attributionType:s?p.AttributionType.Footer:p.AttributionType.InlineAttribution,onPress:v,onLongPress:C}),N=(0,l.useRXStyles)((e=>({mobileViewContainer:n.Styles.createViewStyle({overflow:"visible"},!1),container:n.Styles.createTextStyle({overflow:"visible",marginVertical:s?4:0,marginHorizontal:2,height:s?24:20},!1),mobileContainer:n.Styles.createViewStyle({position:"relative",overflow:"visible"},!1),desktopWrapper:n.Styles.createTextStyle({flexGrow:0,lineHeight:s?24:20,height:s?24:20},!1),attributionWrapperStyle:n.Styles.createViewStyle({transform:[{translateY:s?0:4}]},!1),attributionStyle:n.Styles.createViewStyle({height:s?24:20,top:-1,marginVertical:s?4:0,paddingVertical:s?4:2,borderRadius:4,backgroundColor:e.themeColors.surfaceSecondaryAccent,overflow:"visible"},!1),attributionLinkStyle:n.Styles.createLinkStyle({color:e.themeColors.textSecondaryInteractive,paddingHorizontal:7,lineHeight:16},!1),copyLink:{position:"absolute",left:0,right:0,height:20,overflow:"hidden"},copyLinkMobileWrapper:n.Styles.createViewStyle({position:"absolute",left:0,right:0,height:20,overflow:"hidden",transform:[{translateY:4}]},!1)})),[s]),E=[a.default.fontStyle.captionSelected,N.attributionLinkStyle];E.push(N.attributionStyle);const O=(0,o.jsx)(n.Link,{ref:A,style:E,url:null!==(I=null==e?void 0:e.getSanitizedHref())&&void 0!==I?I:"#",title:null==e?void 0:e.getSanitizedHref(),onPress:R,onLongPress:L,onHoverStart:B,onHoverEnd:F,numberOfLines:1,tabIndex:b?-1:void 0,children:(0,o.jsx)(n.Text,{selectable:!1,children:i})}),U=(0,o.jsx)(n.Text,{selectable:h,style:N.copyLink,children:null==e?void 0:e.getSanitizedHref()}),V=(0,o.jsx)(d.default,{wrapperStyle:N.desktopWrapper,wrapperOnly:!1,getMenuItems:x,onItemSelected:D,renderAsText:!0,children:O}),H=U;return(0,o.jsxs)(n.Text,{style:N.container,children:[H,V]})}),(e=>Object.assign(Object.assign({},e),{magicBotId:r.default.getS4LMessagingFeatures().magicBotId})))},847394:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionNode=void 0;var i=s(864130);Object.defineProperty(t,"AttributionNode",{enumerable:!0,get:function(){return i.AttributionNode}})},998908:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionNodeExtras=void 0;const i=s(667294),o=s(736267),n=s(900440),r=s(206467);t.useAttributionNodeExtras=e=>{var t,{node:s,href:a=(null!==(t=null==s?void 0:s.getSanitizedHref())&&void 0!==t?t:"#"),supportsCopy:l,message:d,decodedNode:c,messageActions:u,renderOrigin:h,onQuote:p,onEdit:g}=e;const m=(0,o.useCommonContext)(),S=(0,i.useRef)(void 0),_=(0,i.useMemo)((()=>({message:d,decodedNode:c,url:a,onQuoteCallback:p,onEditCallback:g,renderOrigin:h,getReactionMenuPopupAnchor:()=>{var e;return null!==(e=S.current)&&void 0!==e?e:void 0},componentContext:m})),[m,c,a,d,g,p,h]),f=(0,i.useRef)(void 0),y=(0,i.useCallback)(((e,t)=>{var s,i;null===(s=f.current)||void 0===s||s.dismissSXPopup("attribution-link",t),null===(i=f.current)||void 0===i||i.onActionMenuOptionSelected(_,e)}),[_]),v=(0,i.useCallback)(((e,t)=>y(e,t.rootViewId)),[y]);(0,i.useEffect)((()=>{f.current=new n.StreamItemCommandManager(v)}),[v]);const C=(0,i.useCallback)((e=>y(e,m.rootViewId)),[m.rootViewId,y]),T=(0,i.useCallback)((()=>{var e,t;const s=[];return u&&s.push(...u.actionMenuCommands),l&&s.push(r.CommandTypes.CopyLink),null!==(t=null===(e=f.current)||void 0===e?void 0:e.getSXMenuItems(_,s))&&void 0!==t?t:[]}),[_,u,l]);return{handleLinkRef:(0,i.useCallback)((e=>S.current=null!=e?e:void 0),[]),contextMenuItems:T,handleCommandSelected:C,commandManagerRef:f,commandOptions:_,linkRef:S}}},701032:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionNodePressEvents=void 0;const i=s(197582),o=s(667294),n=s(736267),r=s(206467),a=(i.__importStar(s(704704)),i.__importStar(s(786531))),l=i.__importDefault(s(663823)),d=i.__importDefault(s(353010)),c=i.__importDefault(s(872820)),u=s(82485),h=s(815146),p=i.__importDefault(s(196687)),g=i.__importStar(s(50350)),m=i.__importDefault(s(48076)),S=i.__importDefault(s(942724)),_=s(353090);t.useAttributionNodePressEvents=({node:e,attributions:t,supportsCopy:s,commandOptions:i,commandManagerRef:f,linkRef:y,linkClickable:v,href:C,message:T,renderOrigin:M,magicBotId:b,attributionType:I,onLongPress:w,onPress:P})=>{var k,A;const x=null!==(A=null!==(k=null==e?void 0:e.getSanitizedHref())&&void 0!==k?k:C)&&void 0!==A?A:"#",D=(0,n.useCommonContext)(),{openAttributionsOverlay:R,hoverEndCloseAttributionsOverlay:L}=(0,_.useAttributionsOverlay)({attributions:t,activeAttributionIndex:null==e?void 0:e.index,linkClickable:v,message:T,anchor:()=>y.current}),B=(0,o.useMemo)((()=>S.default.isUsingStackNavigationContextNoSubscription()||m.default.isTabletUINoSubscription()),[]),F=(0,o.useCallback)((e=>{var t;if(w)w(e);else if(s){const s=[r.CommandTypes.CopyLink],o=i;null===(t=f.current)||void 0===t||t.showSXPopup(o,s,"attribution-link",(()=>y.current),D.rootViewId,e)}}),[i,D.rootViewId,x,w,s]),N=(0,o.useCallback)(((e,t)=>{if(v)if(P)P(e,t);else{if(B&&I!==a.AttributionType.Footer)return R();if(l.default.potentiallyMarkItemViewed(T,M),d.default.isPiPEnabled()){const e=c.default.getYoutubeVideoPropsFromUrl(x);if(e)return void d.default.setContentProps(e)}(null==T?void 0:T.creator)===b&&(null==T?void 0:T.conversationId)&&u.Instrumentation.track(new a.MessageAttribution(null==T?void 0:T.conversationId,I,"Bing")),g.openUrlWithParams({origin:h.BrowserOrigin.AttributionNode,url:x,options:{conversationId:T?T.conversationId:void 0,preventInAppNavigationForGuest:!p.default.canNavigateInApp()},rootViewId:D.rootViewId})}else e.stopPropagation()}),[D.rootViewId,x,T,P,M,b,v,I,R]),E=(0,o.useCallback)((()=>{var e;I!==a.AttributionType.Footer&&(null===(e=y.current)||void 0===e||e.focus(),R())}),[I,R]);return{handlePress:N,handleLongPress:F,handleHoverStart:E,handleHoverEnd:(0,o.useCallback)((()=>I!==a.AttributionType.Footer&&L()),[I,L])}}},697512:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionListItem=void 0;const i=s(197582),o=s(785893),n=s(516778),r=s(667294),a=s(537180),l=s(964414),d=i.__importDefault(s(20758)),c=s(825419),u=s(262725),h=i.__importDefault(s(694154)),p=s(16549),g=s(187056),m=s(736267),S={shadowColor:p.Color.blackOverlay20,shadowRadius:3,shadowOffset:{height:1,width:0}};t.AttributionListItem=({attribution:e,isAd:t,isHovered:s,linkClickable:i,message:p,rootViewId:_})=>{var f;const y=(0,m.useCommonContext)(),[v,C]=(0,r.useState)(!1),T=(0,r.useMemo)((()=>v||s),[s,v]),M=(0,r.useCallback)((()=>C(!0)),[]),b=(0,r.useCallback)((()=>C(!1)),[]),I=(0,g.useAttributionItemPressHandler)({attribution:e,linkClickable:i,message:p,rootViewId:_}),w=(0,l.useRXStyles)((e=>({index:n.Styles.createTextStyle({marginRight:y.isRTL?0:16,marginLeft:y.isRTL?16:0,alignItems:"center",justifyContent:"center",textAlign:"center",paddingHorizontal:6,minWidth:20,height:20,borderRadius:4,lineHeight:20,backgroundColor:e.themeColors.surfaceSecondaryAccent,color:e.themeColors.textSecondaryInteractive}),image:n.Styles.createImageStyle({width:32,height:32,marginRight:y.isRTL?0:8,marginLeft:y.isRTL?8:0}),title:n.Styles.createTextStyle({fontSize:17,lineHeight:20,color:e.themeColors.textInteractive,font:d.default.font.uiDisplaySemibold}),url:n.Styles.createTextStyle({lineHeight:20}),description:n.Styles.createTextStyle({lineHeight:20})})),[y.isRTL]),P=(0,l.useSkypeStyles)((()=>({wrapper:Object.assign({overflow:"visible",boxSizing:"border-box",paddingVertical:12,paddingHorizontal:12,flexDirection:y.isRTL?"row-reverse":"row",justifyContent:"flex-start",alignItems:"center",borderRadius:12},T?S:{}),textsContainer:{flexDirection:"column",overflow:"hidden",flexShrink:1},attributionContainer:{flexDirection:y.isRTL?"row-reverse":"row",alignItems:"center",flexShrink:1}})),[T,y.isRTL]);return(0,o.jsxs)(a.Pressable,{style:P.wrapper,onPress:I,onHoverIn:M,onHoverOut:b,onHoverStart:M,onHoverEnd:b,children:[!t&&(0,o.jsx)(c.Caption,{selected:!0,style:w.index,children:e.index}),(0,o.jsxs)(a.View,{style:P.attributionContainer,children:[e.logo&&(0,o.jsx)(h.default,{containerStyle:w.image,origin:"AttributionItem",resizeMode:"contain",source:e.logo}),(0,o.jsxs)(a.View,{style:P.textsContainer,children:[(0,o.jsx)(u.RowTitle,{ellipsizeMode:"tail",numberOfLines:1,style:w.title,children:null!==(f=e.title)&&void 0!==f?f:e.anchor}),(0,o.jsx)(c.Caption,{ellipsizeMode:"tail",numberOfLines:1,style:w.url,children:e.getSanitizedHref()}),e.description&&(0,o.jsx)(c.Caption,{ellipsizeMode:"tail",numberOfLines:1,style:w.description,children:e.description})]})]})]})}},268248:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionsOverlay=t.overlayPadding=void 0;const i=s(197582),o=s(785893),n=s(537180),r=s(667294),a=s(697512),l=i.__importDefault(s(48076)),d=i.__importDefault(s(942724));t.overlayPadding=16;t.AttributionsOverlay=({attributions:e,activeAttributionIndex:s,linkClickable:i,rootViewId:c,message:u,onMouseEnter:h,onMouseLeave:p})=>{const[g,m]=(0,r.useState)(!1),S=(0,r.useMemo)((()=>d.default.isUsingStackNavigationContextNoSubscription()||l.default.isTabletUINoSubscription()),[]),_=(0,r.useMemo)((()=>n.StyleSheet.create({container:{cursor:"default",padding:t.overlayPadding,overflow:"visible"},scrollableContainer:{maxHeight:500},wrapper:{overflow:"visible"}})),[]),f=(0,r.useCallback)((e=>{null==h||h(e),m(!0)}),[h]),y=(0,r.useCallback)((e=>{null==p||p(e),m(!1)}),[p]),v=(0,o.jsx)(n.View,{style:_.wrapper,children:e.map((e=>(0,o.jsx)(a.AttributionListItem,{attribution:e,linkClickable:i,isHovered:!g&&s===e.index,rootViewId:c,message:u},e.index)))});return(0,o.jsx)(n.Pressable,{style:_.container,onMouseEnter:f,onMouseLeave:y,children:S?(0,o.jsx)(n.ScrollView,{style:_.scrollableContainer,children:v}):v})}},187056:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionItemPressHandler=void 0;const i=s(197582),o=s(667294),n=i.__importStar(s(786531)),r=i.__importStar(s(50350)),a=i.__importDefault(s(353010)),l=i.__importDefault(s(872820)),d=s(82485),c=s(815146),u=i.__importDefault(s(196687));t.useAttributionItemPressHandler=({linkClickable:e,message:t,attribution:s,rootViewId:i})=>(0,o.useCallback)((o=>{if(e){if(a.default.isPiPEnabled()){const e=l.default.getYoutubeVideoPropsFromUrl(s.getSanitizedHref());if(e)return void a.default.setContentProps(e)}d.Instrumentation.track(new n.MessageAttribution(t.conversationId,n.AttributionType.Overlay,"Bing")),r.openUrlWithParams({origin:c.BrowserOrigin.AttributionNode,url:s.getSanitizedHref(),options:{conversationId:t?t.conversationId:void 0,preventInAppNavigationForGuest:!u.default.canNavigateInApp()},rootViewId:i})}else o.stopPropagation()}),[e,t,s,i])},353090:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAttributionsOverlay=void 0;const i=s(197582),o=s(785893),n=s(667294),r=s(537180),a=i.__importDefault(s(288547)),l=s(736267),d=i.__importDefault(s(760989)),c=s(268248),u=s(410098),h=i.__importDefault(s(601274));t.useAttributionsOverlay=({attributions:e,activeAttributionIndex:t,linkClickable:s,message:i,anchor:p})=>{const g=(0,l.useCommonContext)(),{width:m,height:S}=(0,r.useWindowDimensions)(),[_,f]=(0,n.useState)(m),[y,v]=(0,n.useState)(""),C=(0,n.useRef)(),T=(0,n.useRef)(),[M,b]=(0,n.useState)(),[I,w]=(0,n.useState)(),P=(0,n.useCallback)((e=>e.reduce(((e,t)=>e+(t.description?84:64)),0)+2*c.overlayPadding),[]),k=(0,n.useCallback)((()=>{I&&(h.default.clearTimeout(I),w(void 0)),M&&(h.default.clearTimeout(M),b(void 0))}),[I,M]),A=(0,n.useCallback)((()=>{k(),a.default.close(g.rootViewId,y)}),[y,k,g.rootViewId]),x=(0,n.useCallback)((()=>{k(),b(h.default.setTimeout((()=>{b(void 0),C.current||T.current||A()}),50))}),[k,A]),D=(0,n.useCallback)((()=>{T.current=!1,x()}),[x]),R=(0,n.useCallback)((()=>{C.current=!0}),[]),L=(0,n.useCallback)((()=>{C.current=!1,x()}),[x]),B=(0,n.useCallback)((()=>{if(!e)return;const n=d.default.newCauseId(),r=[...e.values()];v(n),a.default.showWithContent({getTitle:()=>{},content:(0,o.jsx)(c.AttributionsOverlay,{attributions:r,activeAttributionIndex:t,linkClickable:s,onMouseEnter:R,onMouseLeave:L,rootViewId:g.rootViewId,message:i}),anchor:p,menuId:"",rootViewId:g.rootViewId,menuWidth:Math.min(700,m-16),menuHeight:Math.min(P(r),500,S),headerConfig:{headerType:u.HeaderType.Slim},onCloseMenu:A},n)}),[e,t,s,R,L,g.rootViewId,i,p,m,P,S,A]),F=(0,n.useCallback)((()=>{k(),T.current=!0,w(h.default.setTimeout((()=>{w(void 0),B()}),50))}),[k,B]);return(0,n.useEffect)((()=>{m!==_&&(A(),f(m))}),[A,_,m]),{openAttributionsOverlay:F,closeAttributionsOverlay:A,hoverEndCloseAttributionsOverlay:D}}},82021:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AttributionsTextNode=void 0;const i=s(197582),o=s(785893),n=s(667294),r=s(516778),a=s(537180),l=i.__importDefault(s(150343)),d=s(998908),c=s(701032),u=s(964414),h=s(526849),p=i.__importDefault(s(19831)),g=s(517363),m=s(786531);t.AttributionsTextNode=(0,h.WithResub)((({children:e,attributions:t,href:s,linkSelectable:i,supportsCopy:l,linkClickable:h,message:S,decodedNode:_,messageActions:f,renderOrigin:y,magicBotId:v,onPress:C,onLongPress:T,onQuote:M,onEdit:b})=>{const I=(0,n.useContext)(g.BingResponseHoveredContext),w=(()=>{const[e,t]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{var e,s;const[i,o]=[!0,!1].map((e=>s=>{"Control"===s.key&&t(e)}));return null===(e=null===window||void 0===window?void 0:window.addEventListener)||void 0===e||e.call(window,"keydown",i),null===(s=null===window||void 0===window?void 0:window.addEventListener)||void 0===s||s.call(window,"keyup",o),()=>{var e,t;null===(e=null===window||void 0===window?void 0:window.removeEventListener)||void 0===e||e.call(window,"keydown",i),null===(t=null===window||void 0===window?void 0:window.removeEventListener)||void 0===t||t.call(window,"keyup",o)}}),[]),e})(),{commandManagerRef:P,commandOptions:k,linkRef:A,handleLinkRef:x,contextMenuItems:D,handleCommandSelected:R}=(0,d.useAttributionNodeExtras)({href:s,supportsCopy:l,linkClickable:h,message:S,decodedNode:_,messageActions:f,renderOrigin:y,onLongPress:T,onQuote:M,onEdit:b}),{handlePress:L,handleLongPress:B}=(0,c.useAttributionNodePressEvents)({attributions:t,message:S,supportsCopy:l,linkClickable:h,renderOrigin:y,magicBotId:v,commandManagerRef:P,commandOptions:k,linkRef:A,href:s,attributionType:m.AttributionType.InlineText,onPress:C,onLongPress:T}),F=(0,u.useSkypeStyles)((e=>({link:{textDecorationLine:I?"underline":"none",textDecorationColor:e.themeColors.textSecondary,textDecorationStyle:"dotted",textUnderlineOffset:4,color:e.themeColors.textPrimary,cursor:w?"pointer":"text"}})),[I,w]),N=w?(0,o.jsx)(r.Link,{ref:x,url:null!=s?s:"#",title:s,onPress:L,onLongPress:B,selectable:i,numberOfLines:1,tabIndex:-1,children:(0,o.jsx)(a.Text,{style:F.link,children:e})}):(0,o.jsx)(a.Text,{style:F.link,children:e});return(0,o.jsx)(p.default,{wrapperOnly:!1,getMenuItems:D,onItemSelected:R,renderAsText:!0,children:N})}),(e=>Object.assign(Object.assign({},e),{magicBotId:l.default.getS4LMessagingFeatures().magicBotId})))},517363:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingResponseHoveredContext=void 0;const i=s(667294);t.BingResponseHoveredContext=(0,i.createContext)(!1)},187180:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BingResponseNode=function({attributions:e,message:t,decodedNode:s,messageActions:i,linkSelectable:T,linkClickable:M,supportsCopy:b,onLongPress:I,onEdit:w,onQuote:P,renderOrigin:k,onPressInterceptionCallback:A,children:x,numberOfLines:D}){const R=(0,p.useCommonContext)(),[L,B]=(0,n.useState)(!1),[F,N]=(0,n.useState)(!1),{dividerStyle:E,attributionsContainer:O,learnMoreText:U,reducedHeightContainer:V}=(0,l.useRXStyles)((e=>({dividerStyle:r.Styles.createViewStyle({borderColor:e.themeColors.strokeSecondary,borderTopWidth:1,borderStyle:"solid",marginVertical:S},!1),learnMoreText:r.Styles.createTextStyle({textAlign:R.isRTL?"right":"left",lineHeight:_,marginBottom:f},!1),attributionsContainer:r.Styles.createTextStyle({flexDirection:R.isRTL?"row-reverse":"row",flexWrap:"wrap",paddingBottom:v,marginLeft:y},!1),reducedHeightContainer:r.Styles.createViewStyle({overflow:"hidden",maxHeight:D?D*g.default.messageTextLineHeight:void 0},!1)})),[R.isRTL,D]);let H,j=[];e.length>C+1?[H,j]=[e.slice(0,C),e.slice(C)]:H=e;const z=e=>{var n,r;return(0,o.jsx)(c.AttributionNode,{node:e,isFooter:!0,message:t,decodedNode:s,messageActions:i,linkSelectable:T,linkClickable:M,supportsCopy:b,onLongPress:I,onEdit:w,onQuote:P,renderOrigin:k,onPressInterceptionCallback:A,children:d.getString("BingResponseNode.FooterAttributionText",{index:null!==(n=e.index)&&void 0!==n?n:"1",anchor:null!==(r=e.anchor)&&void 0!==r?r:""})},e.index)},W=j.length?(0,o.jsx)(c.AttributionNode,{isFooter:!0,onPress:e=>{e.preventDefault(),B(!L)},message:t,decodedNode:s,messageActions:i,linkSelectable:!1,supportsCopy:!1,linkClickable:!0,children:d.getString("BingResponseNode.PlusMore",{count:j.length})}):null,G=H.map(z),K=j.map(z),q=(0,n.useCallback)((()=>N(!0)),[]),Q=(0,n.useCallback)((()=>N(!1)),[]),X=(0,m.useFocus)({onFocus:q,onBlur:Q});let $=x;0;const J=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.View,{style:E}),(0,o.jsx)(r.View,{accessibilityTraits:r.Types.AccessibilityTrait.Header,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,children:(0,o.jsx)(h.Caption,{selected:!0,style:U,children:d.getString("BingResponseNode.LearnMore")})}),(0,o.jsxs)(r.View,{style:O,children:[G,L?K:W]})]});return(0,o.jsx)(u.BingResponseHoveredContext.Provider,{value:F,children:(0,o.jsx)(a.View,{onTouchStart:X,children:(0,o.jsxs)(r.View,{onMouseEnter:q,onMouseLeave:Q,children:[$,!D&&e.length?J:null]})})})};const i=s(197582),o=s(785893),n=s(667294),r=s(516778),a=s(537180),l=s(964414),d=i.__importStar(s(704704)),c=s(847394),u=s(517363),h=s(825419),p=s(736267),g=i.__importDefault(s(20758)),m=(s(657802),s(683625)),S=12,_=20,f=4,y=-2,v=6,C=2},683625:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useFocus=void 0;const i=s(667294),o=s(513835);t.useFocus=({onFocus:e,onBlur:t})=>{const[s,n]=(0,i.useState)(),r=(0,i.useCallback)((t=>{n(t.target),e()}),[e]),a=(0,i.useCallback)((e=>{s&&e.target!==s&&(n(void 0),t())}),[t,s]);return(0,o.useRootTouchEvents)(o.TouchEventType.TouchStart,a),r}},373861:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MenuItem=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=s(619429),a=i.__importStar(s(44717)),l=i.__importStar(s(704704)),d=i.__importDefault(s(776622)),c=i.__importDefault(s(139221)),u=i.__importStar(s(500645)),h=s(567567),p=s(15752);var g;!function(e){e.Settings="settings",e.SendSMS="sendsms",e.PrivateConversation="privateconversation",e.NewGroup="newgroup",e.ShareLink="sharelink",e.AddParticipants="addparticipants",e.Gallery="gallery"}(g||(t.MenuItem=g={}));t.default=new class{constructor(){this._validateMenuItem=(e,t)=>{switch(e){case g.Settings:case g.ShareLink:case g.AddParticipants:return!0;case g.SendSMS:return t.otherPartyMri&&t.canShowSmsEntryPoint&&d.default.canSendSMSToMri(t.otherPartyMri);case g.PrivateConversation:return t.otherPartyMri&&!t.isEncryptedThread&&t.otherPartyMri!==c.default.getEchoMri()&&!a.isAgent(t.otherPartyMri)&&!a.isPhoneMri(t.otherPartyMri);case g.NewGroup:return!t.isEncryptedThread;default:return!1}}}accessibilityLabel(e,t,s,i){let o=l.getString("ContentPanelHeader.ProfileButtonAccessibilityLabel",{conversationName:e.conversationName})+", ";if(e.isEncryptedThread&&(o+=l.getString("ContentPanelHeader.PrivateConversationLabel")+", "),!t)if(s&&e.userPresence){const t=u.accessibilityLabelForUserStatus(e.userPresence);t&&(o+=t+", "),e.moodLabel?o+=e.moodLabel+", ":e.moodRawText?o+=l.getString("ContentPanelHeaderTitle.MoodMessageWrapper",{moodMessage:e.moodRawText})+", ":e.isUserActive||e.userPresence.status===p.UserStatus.Busy||e.isEncryptedThread||(o+=(0,h.getLastSeenPresenceText)(e.userPresence,!1,e.gender,e.isUserActive,!0),o+=", ")}else e.memberCount&&(i&&e.callRateText&&(o+=e.callRateText+", "),e.isOneOnOne||(o+=l.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:e.memberCount})+", "));return o+=l.getString("UserProfilePanel.ViewProfileLabel"),o}callingDisabledTooltip(e){let t;switch(e){case r.CallValidationFailureReason.GroupTooLarge:t=l.getString("ContentPanelHeader.CallDisabledToolTip");break;case r.CallValidationFailureReason.RegularMemberInModeratedGroup:t=l.getString("ContentPanelHeader.CallDisabledModeratedToolTip");break;case r.CallValidationFailureReason.PlatformNotSupported:t=l.getString("ContentPanelHeader.PlatformNotSupportedTooltip");break;case r.CallValidationFailureReason.E2eeHandshakeIncomplete:case r.CallValidationFailureReason.GogoNetwork:default:t=void 0}return t}getMenuItems(e){if(e.isMriBlocked)return[];const t=n.default.getS4LUiFeaturesNoSubscription().contextHeaderDropdownActions,s=[];return o.each(e.otherPartyMri?t.oneOnOne:t.group,(t=>{this._validateMenuItem(t,e)&&s.push(t)})),s}getPresenceStatusForIcon(e,t){return e?p.UserStatus.Online:u.getMappedStatusIfValid(t)}}},538407:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListHelper=t.engagementBannerModernizedHeight=t.engagementBannerHeight=void 0;const i=s(197582),o=i.__importStar(s(317588)),n=s(331654),r=s(815063),a=s(380157),l=s(614080),d=i.__importStar(s(516778)),c=i.__importDefault(s(398315)),u=i.__importDefault(s(911108)),h=i.__importDefault(s(386730)),p=i.__importDefault(s(369347)),g=s(85755),m=s(44557),S=s(803193),_=s(318315),f=i.__importDefault(s(314290)),y=i.__importDefault(s(721657)),v=i.__importDefault(s(38217)),C=i.__importStar(s(435395)),T=i.__importDefault(s(459778)),M=s(333211),b=i.__importDefault(s(139221)),I=s(224958),w=s(815146),P=i.__importDefault(s(326544)),k=i.__importStar(s(85385)),A=i.__importStar(s(704704)),x=i.__importDefault(s(574818)),D=i.__importDefault(s(247286)),R=i.__importStar(s(658726)),L=i.__importDefault(s(935506)),B=s(975741),F=i.__importDefault(s(150343)),N=i.__importDefault(s(260928)),E=i.__importDefault(s(532821)),O=i.__importDefault(s(48076)),U=i.__importDefault(s(740794)),V=i.__importDefault(s(942724)),H=i.__importDefault(s(251733)),j=i.__importDefault(s(690051)),z=i.__importDefault(s(960282)),W=i.__importDefault(s(117475)),G=i.__importDefault(s(266872)),K=i.__importStar(s(437782)),q=s(154235),Q=s(413686),X=s(773151),$=s(641400),J=s(20107),Y=s(331079),Z=i.__importDefault(s(135372)),ee=s(22478),te=s(717413),se=s(135405),ie=s(240804),oe=s(376229),ne=s(596648),re=i.__importDefault(s(839970)),ae=i.__importStar(s(44717)),le=i.__importDefault(s(463899)),de=i.__importDefault(s(574489)),ce=i.__importDefault(s(306200)),ue=i.__importDefault(s(892034)),he=i.__importDefault(s(710427)),pe=i.__importDefault(s(615364)),ge=s(491839),me=i.__importDefault(s(100357));t.engagementBannerHeight=64,t.engagementBannerModernizedHeight=88;const Se=[ee.EngagementBannerType.SyncContacts],_e=e=>e=>e.isOneOnOne()&&F.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&!ae.isMyBotConversation(e.id)?ce.default.isGroupMarkedAsFavorite(e.id):e.isFavorite(),fe=e=>Se.includes(e);class ye{constructor(e,t,s){this._shownConversations=[],this._recentConversations=[],this._conversationsListStore=(0,pe.default)(),this._archivedConversations=this._conversationsListStore.getSortedArchivedConversations(),this._rowSize=T.default.recentRowSizeAndChanges(),this._contentSizeMultiplier=z.default.getContentSizeMultiplier(),this._onboardingFeatures=F.default.getOnboardingFeatures(),this._conversationSorter=e=>{let t=0;const s=ue.default.getSavedMessageInput(e.id);s&&s.timestamp?t=s.timestamp:F.default.getS4LMessagingFeatures().enableMediaPreviewDrafts&&(t=x.default.getDraftPreviewTimestamp(e.id)||0);const i=(0,pe.default)().getFakeTimestamp(e.id),o=e.getTimestamp();return-((0,c.default)([i,t,o])||0)},this._rootViewId=e,this._isUsingStackNavigationContext=t,this._isPresentedInDesktopLeftNav=s}getShownConversationsCount(){return this._shownConversations.length}getFavoritesCount(){return this._shownConversations.filter((e=>e.isFavorite())).length}_partitionConversationBasedOnSort(e,t,s,i){let o=[],n=[];const r=this._recentConversations;switch(s){case X.RecentsSortBy.Time:if(t){const e=(0,u.default)(r,_e());o=e[0],n=e[1]}else n=r;return this._normalizeResults([],o,n);case X.RecentsSortBy.Unread:const s=de.default.getConversationsWithUnreadCounts(),a=t=>{const o=F.default.getS4LMessagingFeatures();if(ue.default.getDraftTimestampForConversation(t.id))return!0;if(o.enableMediaPreviewDrafts&&x.default.getDraftPreviewTimestamp(t.id))return!0;if((0,S.isFakeContentChannelConversation)(t)){const e=(0,S.stripFakeContentChannelConversationPrefix)(t.id),{unreadCount:s}=(0,_.getContentChannelsStore)().getChannelWithFetch(e)||{};return!!s}if(this._isUsingStackNavigationContext)return s[t.id]&&!t.isMuted();return i===t.id&&e===i&&!t.isMuted()||s[t.id]&&!t.isMuted()},l=e=>(0,S.isContentChannel)(e)||(0,S.isFakeContentChannelConversation)(e);if(t){const e=(0,u.default)(r,_e()),t=(0,u.default)(e[0],a),s=t[0].concat(t[1]),i=(0,u.default)(e[1],a),d=(0,u.default)(i[0],l);o=s,n=d[1].concat(d[0]).concat(i[1])}else{const e=(0,u.default)(r,a),t=(0,u.default)(e[0],l);n=t[1].concat(t[0]).concat(e[1])}return this._normalizeResults([],o,n);case X.RecentsSortBy.Active:const d=re.default.getActiveUserMris(),[c,h]=(0,u.default)(r,(e=>d[e.id])),[p,g]=(0,u.default)(h,_e());return this._normalizeResults(c,p,g);default:return[]}}_normalizeResults(e,t,s){return[e,t,s].map((e=>this._mapConversationsToIds(ce.default.filterGrouped1on1s(e))))}_mapConversationsToIds(e){return e.map((e=>e.id))}_pinMybotToTopFavorite(e,t){if(!t)return e;const s=ae.getMyBotId(),i=e.findIndex((e=>e===s));if(-1===i)return e;const o=[...e];return o.splice(i,1),o.unshift(s),o}isAnyConversationArchived(){return this._archivedConversations.length>0}_getListItemHeight(e,t){const s=Math.min(this._contentSizeMultiplier,q.MaxContentSizeMultiplier),i=z.default.isMobileScreenSize(this._rootViewId)&&!O.default.isTabletUI()&&!E.default.collapseDesktopStackNavContext(),o=this._isUsingStackNavigationContext?0:5;if(this._rowSize===X.RowSize.ExtraCompact)return 36*(s||1);if(this._rowSize===X.RowSize.Compact){return(this._isUsingStackNavigationContext?56:40)*(s||1)+o}{const n=e?50:i?35:44,r=e?t?26:28:10,a=e?t?76:78:i?35:55;return Math.max(a,n+o+Math.round(r*s))}}_mapConversationsToListItem(e,t=[],s,i,o,n,r,a,l=(e=>!1)){return e.reduce(((e,d,c)=>{const u=!!i&&this._isSelected(d,t,s,i);return e.push(this._allocateListItem(d,c,l(c),u,o,r,a),this._getItemSpacer(2,n.idx++)),e}),[])}_allocateListItem(e,t,s,i,o,n,r){let a;b.default.isElectronOsx()&&(a=A.getString("ConversationsListItem.ConversationItemLabel"));let l=this._getListItemHeight(o,n);return F.default.getS4LMessagingFeaturesNoSubscription().enableMagicBot&&(0,te.isMagicBotConversation)(e)&&(l+=38),{key:e,height:l,index:t,isLastItem:s,isNavigable:!0,template:this._getListItemTemplate(e),isUsingStackNavigationContext:this._isUsingStackNavigationContext,itemHeight:-1,useMobileView:o,isSelected:i,rowSize:this._rowSize,useCompactIcon:r,ariaRoleDescription:a,accessibilityTrait:d.Types.AccessibilityTrait.ListItem,obfuscatedKeyForLogging:K.mriOrId(e)}}_isSelected(e,t,s,i){if(e===i)return!0;const o=s.find((t=>t.id===e));if(o&&o.isOneOnOne()&&!o.hasActiveCall()){const e=(0,pe.default)().getConversation(i);if(e&&e.isOneOnOne()&&!e.hasActiveCall()&&!t.some((t=>t===e.id||t===o.id)))return!0}return!1}_getListItemTemplate(e){const t=this._shownConversations.find((t=>t.id===e));return t&&(0,S.isFakeContentChannelConversation)(t)?ge.ConversationListItemNames.contentChannel:ae.isThread(e)?ge.ConversationListItemNames.groupChat:ge.ConversationListItemNames.oneOnOneConv}_getTopInset(e){return{key:ge.ConversationListItemNames.topSpacer,height:e,template:ge.ConversationListItemNames.topSpacer,isNavigable:!1}}_getItemSpacer(e,t){return{key:ge.ConversationListItemNames.itemSpacer+t,height:e,template:ge.ConversationListItemNames.itemSpacer,isNavigable:!1}}_getDivider(e){return{key:ge.ConversationListItemNames.divider,height:e,template:ge.ConversationListItemNames.divider,isNavigable:!1}}_getBottomPadding(e){return{key:ge.ConversationListItemNames.bottomSpacer,height:e,template:ge.ConversationListItemNames.bottomSpacer,isNavigable:!1}}_getNotificationsPrompt(e){const t=this._getNotificationPromptListItemHeight(e);return{key:ge.ConversationListItemNames.notificationsPrompt,height:t,template:ge.ConversationListItemNames.notificationsPrompt}}_getNotificationPromptListItemHeight(e){let t=144;return t=z.default.getDeviceOrientation(this._rootViewId)===n.DeviceOrientation.Landscape?71:e||this._isPresentedInDesktopLeftNav?f.default.containsLargeContent()?190:160:144,t*Math.min(this._contentSizeMultiplier||1,q.MaxContentSizeMultiplier)}_getLoadingIndicator(e,t){return{key:ge.ConversationListItemNames.loadingIndicator,height:this._getListItemHeight(e,t),template:ge.ConversationListItemNames.loadingIndicator,isUsingStackNavigationContext:this._isUsingStackNavigationContext,measureHeight:!1,isNavigable:!1}}_getSearchBar(e,t,s){const i=y.default.shouldUseIOSSearchStyles(),o=t?oe.SearchInputHeight.modernizedSmall:i?oe.SearchInputHeight.iOS:z.default.isSmallDevice(this._rootViewId)?oe.SearchInputHeight.small:oe.SearchInputHeight.default;return{key:ge.ConversationListItemNames.searchBar,height:o,template:ge.ConversationListItemNames.searchBar,isUsingStackNavigationContext:this._isUsingStackNavigationContext,showFilterIcon:!!e,useIOSSearchStyles:i,theme:G.default.colorTheme(),safeAreaHorizontalInsets:this.getSafeAreaHorizontalInsets(t),language:s}}_getFinishSetupPrompt(e){return{key:ge.ConversationListItemNames.finishSetupPrompt,height:e||this._isPresentedInDesktopLeftNav?160:144,template:ge.ConversationListItemNames.finishSetupPrompt}}_getEngagementBanner(e){return{key:ge.ConversationListItemNames.engagementBanner,height:fe(e)?t.engagementBannerModernizedHeight:t.engagementBannerHeight,template:e}}getSafeAreaHorizontalInsets(e){const t=C.getRowPadding(e),s=Object.assign({},W.default.horizontalInsets());return s.left&&(s.left=Math.max(s.left-(this._isUsingStackNavigationContext?t.left:t.leftDesktop),0)),s.right&&(s.right=Math.max(s.right-(this._isUsingStackNavigationContext?t.right:t.rightDesktop),0)),s}_getRecentsViewModeType(e){let t=ge.ConversationsListMode.AllConversations;return this._isUsingStackNavigationContext?e&&(t=e):t=he.default.getConversationsListMode(),t}createSectionHeader(e,t){const s=A.getString(e);return{key:ge.ConversationListItemNames.header+e,height:(0,M.getCategoryHeaderHeight)(t),template:ge.ConversationListItemNames.header,title:s,isNavigable:!1,accessibilityGroup:l.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:s,accessibilityTrait:d.Types.AccessibilityTrait.None}}_createSectionHeaderSpacer(e){return{key:ge.ConversationListItemNames.header+e,height:20,template:ge.ConversationListItemNames.header,title:"",isNavigable:!1,isHoverable:!1}}_getIconSize(e,t,s){return e===X.RowSize.Compact||e===X.RowSize.ExtraCompact||s?t?ne.AvatarIconSize.Size40:ne.AvatarIconSize.Size24:t?ne.AvatarIconSize.Size40:ne.AvatarIconSize.Size36}_getBaseAdHeight(e){return e.adsType===J.AdsType.PanelBanner?80:e.provider===J.AdsProvider.MeetNow&&e.adsType===J.AdsType.ListItem?140:e.adsType===J.AdsType.ListItemNarrow?78:154}_createNativeAdItem(e,t,s,i){const o=F.default.getAdsFeatures().placementSettings.conversationList,n=t||300,r=this._getIconSize(this._rowSize,!!this._isUsingStackNavigationContext,!!i),a=L.default.calculateConversationListNativeAdDimensions(n,this._getBaseAdHeight(e),this._getListItemHeight(s),L.default.includeMediaInAdHeight(e),r,v.default.getIconSize(r).user,o.dynamicDimensionsSettings);return{key:ge.ConversationListItemNames.nativeAd,adsGuid:e.guid,adGuid:e.ads[0],isLastItem:!1,height:a.totalHeight,dimensions:a,placementId:o.placementIds[0],template:ge.ConversationListItemNames.topSpacer,accessibilityTrait:d.Types.AccessibilityTrait.Group,accessibilityLabel:A.getString("NativeAd.AdAccessibilityLabel"),isUsingStackNavigationContext:!!this._isUsingStackNavigationContext,canHide:o.canHide,provider:e.provider,adType:e.adsType}}_insertNativeAdIntoList(e,t,s,i,o,n,r,a,l){const d=F.default.getAdsFeatures().placementSettings.conversationList,c=n||z.default.getHeight(this._rootViewId),u=this._createNativeAdItem(s,r,a,l),h=L.default.calculateNativeAdsPositionInListView({maxHeight:c,items:e,startPosition:i,additionalGroupsStartPositions:o,nativeAdsHeight:u.height,adsConfig:d});h===e.length?this._pushNativeAdToTheEnd(u,e,t):e.splice(h,0,u)}_pushNativeAdToTheEnd(e,t,s){e.isLastItem=!0,s.length&&t.length&&t[t.length-1].key===s[s.length-1]&&(t[t.length-1].isLastItem=!1),t.push(e)}_setRecentsConversations(e){this._recentConversations=(0,h.default)(e,this._conversationSorter)}_splitConversationBasedOnOngoingCalls(){const e=p.default.CallingStore.getConnectedOrOutgoingCallIds().map((e=>p.default.CallingStore.getCallConversationMri(e)));return(0,u.default)(this._shownConversations,(t=>t.hasActiveCall()||e.includes(t.id)))}_splitConversationsForMagicBot(){return(0,u.default)(this._recentConversations,(this._recentConversations,e=>!!F.default.getS4LMessagingFeaturesNoSubscription().enableMagicBot&&(0,te.isMagicBotConversation)(e.id)))}_isMagicBotOnlyConversation(){return 0===this._shownConversations.length||1===this._shownConversations.length&&1===this._shownConversations.filter((e=>(0,te.isMagicBotConversation)(e.id))).length}_hasUserSyncedContacts(){return!H.default.systemPromptHasNotBeenDisplayed(Y.PermissionType.Contacts)&&H.default.permissionStatus(Y.PermissionType.Contacts)===a.PermissionStatus.Granted}_isPermissionsPromptRequired(){return H.default.systemPromptHasNotBeenDisplayed(Y.PermissionType.Microphone)||!this._onboardingFeatures.enableInContextCameraPermission&&H.default.systemPromptHasNotBeenDisplayed(Y.PermissionType.Camera)}_shouldDisplayFinishSetupPrompt(){if(!me.default.skipCleanupPrompt(se.PromptViewName.FinishiSetupPrompt))return!1;let e=!1;P.default.isSetupWizardCompleted(),P.default.isOnboardingSkipped();return D.default.isChild()&&(e=!1),e}_shouldShowMobileNotificationPrompt(e,t){return e&&t&&!1}getNumberOfConversationsToFit(e){return Math.floor(e/this._getListItemHeight(!1))}getArchivedConversation(e){if(!e)return this._archivedConversations;const t=this._conversationsListStore.getArchivedChannels(),s=this._conversationsListStore.getArchivedChats();switch(e){case"channels":return[];case"chats":return s;default:return[...s,...t]}}getConversationsItemsList(e,t,s,i,o,n,a,l,d,c,u,h,p,g,m=!1,S=!1,_=!1,f){this._shownConversations=e;const y=this._onboardingFeatures.features.emptyStateBanner,v=P.default.getBannerState(),C=me.default.skipCleanupEngagementBanner(),M=!D.default.isChild()&&y.enabled&&v===ee.EngagementBannerAction.NotDisplayed&&!o&&C,b=r.BrowserEnvironment.isMobile(),I=b&&o,A=null===o&&!M&&s,x=this._splitConversationBasedOnOngoingCalls();this._setRecentsConversations(x[1]);let N=[[]];!m||S||this._isMagicBotOnlyConversation()||(N=this._splitConversationsForMagicBot(),this._setRecentsConversations(N[1]));const E=[];let U=[],H=[],j=[];const W=p?ce.default.getAllSiblingConversations(p):[];i&&E.push(this._getTopInset(i));const G=this._getRecentsViewModeType(n.viewType),q=V.default.isUsingStackNavigationContext(),Q={idx:0};if(G===ge.ConversationsListMode.ArchivedConversations)E.push.apply(E,this._mapConversationsToListItem(this._mapConversationsToIds(this.getArchivedConversation(f)),[],W,p,n.useMobileView,Q,q,n.useCompactIcon));else if(G===ge.ConversationsListMode.AllConversations){const e=F.default.getAdsFeatures(),i=T.default.shouldShowCategories(),o=this._shownConversations,r=e.placementSettings.conversationList,S=(L.default.shouldGetAdsInConversationsList(J.AdsType.ListItem,o)||L.default.shouldGetAdsInConversationsList(J.AdsType.ListItemNarrow,o))&&this._rowSize===X.RowSize.Default,C=this._mapConversationsToIds(x[0]),P=this._mapConversationsToIds(N[0]);n.useMobileView&&!n.hideSearchBar&&(E.push(this._getSearchBar(n.showFilterIcon,q,g)),E.push(this._getItemSpacer(8,Q.idx++)));const D=this._shouldDisplayFinishSetupPrompt(),V=F.default.getS4LMessagingFeatures(),G=this._shouldShowMobileNotificationPrompt(V.enableNotificationPrompt,n.useMobileView)&&!D,$=z.default.isMobileScreenSize(this._rootViewId)&&!O.default.isTabletUI();G&&E.push(this._getNotificationsPrompt($)),D&&E.push(this._getFinishSetupPrompt($)),[U,H,j]=this._partitionConversationBasedOnSort(d,i,c,p);const Y=i&&c!==X.RecentsSortBy.Active&&(C.length>0||P.length>0||H.length>0);let te=!1;const se=!V.hideConversationsListSectionHeaders;if(n.useMobileView&&!se&&(E.push(this._getItemSpacer(8,Q.idx++)),te=!0),C.length>0){if(se&&(Y||this._isPresentedInDesktopLeftNav)){const e=Y||!this._isPresentedInDesktopLeftNav;e&&(te=!0,E.push(this._getItemSpacer(2,Q.idx++))),q&&(E.push(this._getItemSpacer(8,Q.idx++)),te=!0),E.push(this.createSectionHeader("ConversationsListPanel.OngoingCallsTitle",q)),e&&E.push(this._getItemSpacer(2,Q.idx++))}E.push.apply(E,this._mapConversationsToListItem(C,C,W,p,n.useMobileView,Q,q,n.useCompactIcon)),se&&!Y&&this._isPresentedInDesktopLeftNav&&E.push(this._createSectionHeaderSpacer("ongoingcall"))}const ie=[];m&&P.length>0&&(se&&Y&&(te||(E.push(this._getItemSpacer(2,Q.idx++)),te=!0),q&&!te&&(E.push(this._getItemSpacer(8,Q.idx++)),te=!0),E.push(this.createSectionHeader("ConversationsListPanel.MagicBotTitle",q)),E.push(this._getItemSpacer(2,Q.idx++))),ie.push({groupName:J.AdsListGroupType.MagicBot,position:E.length-1}),E.push.apply(E,this._mapConversationsToListItem(P,C,W,p,n.useMobileView,Q,q,n.useCompactIcon))),U&&U.length>0&&E.push.apply(E,this._mapConversationsToListItem(U,C,W,p,n.useMobileView,Q,q,n.useCompactIcon)),H.length>0&&(H=this._pinMybotToTopFavorite(H,_),se&&Y&&(te||(E.push(this._getItemSpacer(2,Q.idx++)),te=!0),q&&!te&&(E.push(this._getItemSpacer(8,Q.idx++)),te=!0),E.push(this.createSectionHeader("ConversationsListPanel.FavoritesTitle",q)),E.push(this._getItemSpacer(2,Q.idx++))),ie.push({groupName:J.AdsListGroupType.Favourites,position:E.length-1}),E.push.apply(E,this._mapConversationsToListItem(H,C,W,p,n.useMobileView,Q,q,n.useCompactIcon))),H.length>0&&!se&&i&&j.length>0&&!A&&(E.push(this._getItemSpacer(4,Q.idx++)),E.push(this._getDivider(.5)),E.push(this._getItemSpacer(6,Q.idx++))),A&&E.push(s),se&&Y&&(te||(E.push(this._getItemSpacer(2,Q.idx++)),te=!0),q&&!te&&(E.push(this._getItemSpacer(8,Q.idx++)),te=!0),E.push(this.createSectionHeader("ConversationsListPanel.ChatsTitle",q)),E.push(this._getItemSpacer(2,Q.idx++))),ie.push({groupName:J.AdsListGroupType.Recents,position:E.length-1}),E.push.apply(E,this._mapConversationsToListItem(j,C,W,p,n.useMobileView,Q,q,n.useCompactIcon,(e=>e===j.length-1))),he.default.areConversationsLoading()&&E.push(this._getLoadingIndicator(n.useMobileView,q));const oe=E.length-1,ne=S?R.default.getAdsState(r.placementIds[0],{refreshIntervalInMinutes:r.refreshIntervalInMinutes,isAdMediaClickable:r.isAdMediaClickable,placementName:B.NativeAdPlacementName.ConversationList,provider:r.provider,adsType:r.adsType,otherProviders:r.otherProviders,testDevices:e.testDevices}):void 0;ne&&ne.status===R.AdsStatus.Loaded&&this._insertNativeAdIntoList(E,j,ne,oe,ie,u,h,n.useMobileView,n.useCompactIcon),"channels"===f&&E.push(...t);const re={[ee.EngagementBannerType.CreateGroup]:this._getCreateGroupOrFallbackBanner.bind(this),[ee.EngagementBannerType.SyncContacts]:this._getSyncContactOrFallbackBanner.bind(this),[ee.EngagementBannerType.MeetNow]:this._getMeetNowOrFallbackBanner.bind(this)};if(M){const e=Z.default.isCoachMarkBeingShown();if(k.log(w.LogTraceArea.ConversationsListItem,`\n                     Conditions for the CTA Banner _bannerState - ${v},\n                     isCoachMarkBeingShown - ${e}\n                     shouldDisplayFinishSetupPrompt - ${D}\n                     active calls - ${C.length}\n                     BannerType - ${this._onboardingFeatures.features.emptyStateBanner.type}\n                 `),!D&&!G&&!e&&0===C.length){const e=re[y.type](E);if(void 0!==e){const t=E.findIndex((e=>e.template===ge.ConversationListItemNames.searchBar)),s=1;E.splice(t+s,0,this._getEngagementBanner(e))}}}if(I){const e=E.findIndex((e=>e.template===ge.ConversationListItemNames.searchBar))+(b?2:1);E.splice(e,0,{key:ge.ConversationListItemNames.conversationsListBanner,height:120,measureHeight:!0,template:ge.ConversationListItemNames.conversationsListBanner})}a&&(le.default.trackSortByFilter(c),le.default.trackRowSize(this._rowSize),le.default.trackShowCategories(i));const ae=n.bottomPadding?E.length+1:E.length;"off"===V.convPanelLoggingLevel||!a&&ae===l||(k.log(w.LogTraceArea.ConversationsListItem,"ConversationsListPanel buildState: "+ae+" items, "+U.length+" top, "+H.length+" favorites, "+j.length+" rest, sorted by "+X.RecentsSortBy[c]),"full"===V.convPanelLoggingLevel&&k.log(w.LogTraceArea.ConversationsListItem,`ConversationsListPanel buildState: top: [${U.map((e=>K.mriOrId(e))).join(", ")}], favorites: [${H.map((e=>K.mriOrId(e))).join(", ")}], rest: [${j.map((e=>K.mriOrId(e))).join(", ")}]`))}return n.bottomPadding&&E.push(this._getBottomPadding(n.bottomPadding)),E.filter((e=>void 0!==e))}shouldContainEmptyStateItem(e=2,t=0){return this._shownConversations.length+t<e&&void 0!==j.default.getSyncAddressBookPrivacySetting()}numberOfMeaningfulItemsCount(e,t,s){let i=0;return"channels"===e&&(i=null==t?void 0:t.filter((e=>e.template===ge.ConversationListItemNames.upsellChannel)).length),(null==s?void 0:s.contents)&&(i+=s.contents.length),i}_getCreateGroupOrFallbackBanner(e){return e.some((e=>e.template===ge.ConversationListItemNames.groupChat))?ee.EngagementBannerType.MeetNow:ee.EngagementBannerType.CreateGroup}_getMeetNowOrFallbackBanner(e){return ee.EngagementBannerType.MeetNow}_getSyncContactOrFallbackBanner(e){const t=H.default.permissionStatus(Y.PermissionType.Contacts),s=e.find((e=>e.key===ge.ConversationListItemNames.emptyState)),i=void 0===s||s.hideSyncAddressBookCta,o=e.filter((e=>this._isItemConversationOrGroupChat(e))).length;return t===a.PermissionStatus.Unknown&&i&&o<=this._onboardingFeatures.features.emptyStateBanner.syncContactsBannerConvCountLimit?ee.EngagementBannerType.SyncContacts:ee.EngagementBannerType.MeetNow}_isItemConversationOrGroupChat(e){return e.template===ge.ConversationListItemNames.groupChat||e.template===ge.ConversationListItemNames.oneOnOneConv}getConversationAdBanner(e,t){const s=F.default.getAdsFeatures(),i=s.placementSettings.conversationList,o=L.default.shouldGetAdsInConversationsList(J.AdsType.PanelBanner,this._shownConversations)&&!e?R.default.getAdsState(i.placementIds[0],{refreshIntervalInMinutes:i.refreshIntervalInMinutes,isAdMediaClickable:i.isAdMediaClickable,placementName:B.NativeAdPlacementName.ConversationList,provider:i.provider,adsType:i.adsType,otherProviders:i.otherProviders,testDevices:s.testDevices}):void 0;if(!o||o.status!==R.AdsStatus.Loaded)return;const n=t||300;return this._createNativeAdItem(o,n,!1,!1)}static syncContactsClickHandler(e,t){U.default.navigateToSyncAddressBook({origin:t,hideSkipButton:!0},void 0,e)}static isEngagementBannerConfigModernizedType(e){return void 0!==e&&"image"in e&&!("icon"in e)}static getEngagementBannerProps(e,t){return fe(e)?this.getEngagementBannerModernizedProps(e,t):this.getEngagementBannerLegacyProps(e,t)}static getEngagementBannerOnCloseHandler(e){return()=>{P.default.setBannerState(ee.EngagementBannerAction.Dismissed),k.track(new I.EngagementBannerTelemetryEvent(e,ee.EngagementBannerAction.Dismissed))}}static getEngagementBannerModernizedProps(e,t){return e===ee.EngagementBannerType.SyncContacts?{title:A.getString("UserSettingsPanel.SyncAddressBook"),description:A.getString("ConversationsListPanelEmptyState.SyncContactsEngagementBannerDescription"),bannerType:ee.EngagementBannerType.SyncContacts,image:o.Collection.SYNC_CONTACTS_PEOPLE,onClick:()=>{ye.syncContactsClickHandler(t.rootViewId,Q.DialogNavOrigin.RecentChatsBanner),P.default.setBannerState(ee.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,ee.EngagementBannerAction.Clicked))},onClose:this.getEngagementBannerOnCloseHandler(e)}:this.getEngagementBannerLegacyProps(e,t)}static getEngagementBannerLegacyProps(e,t){const s=this.getEngagementBannerOnCloseHandler(e);switch(e){case ee.EngagementBannerType.CreateGroup:return{title:A.getString("ConversationsListPanelEmptyState.FirstGroupEngagementBannerTitle"),description:A.getString("ConversationsListPanelEmptyState.FirstGroupEngagementBannerDescription"),bannerType:ee.EngagementBannerType.CreateGroup,icon:$.SkypeIcon.ContactGroupAdd,size:$.IconSize.size28,onClick:()=>{new N.default({navigationOrigin:w.NavigationConversationOrigin.NewGroup,peopleType:ie.PeopleType.All,filterPeopleType:ie.FilterType.GroupCapable}).start(t.rootViewId),P.default.setBannerState(ee.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,ee.EngagementBannerAction.Clicked))},onClose:s};case ee.EngagementBannerType.SyncContacts:return{title:A.getString("UserSettingsPanel.SyncAddressBook"),description:A.getString("ConversationsListPanelEmptyState.SyncContactsEngagementBannerDescription"),bannerType:ee.EngagementBannerType.SyncContacts,icon:$.SkypeIcon.ContactCard,size:$.IconSize.size28,onClick:()=>{ye.syncContactsClickHandler(t.rootViewId,Q.DialogNavOrigin.RecentChatsBanner),P.default.setBannerState(ee.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,ee.EngagementBannerAction.Clicked))},onClose:s};case ee.EngagementBannerType.MeetNow:default:return{title:A.getString("Onboarding.LandingScreenWithCardsCardTitle7"),description:A.getString("ConversationsListPanelEmptyState.MeetNowEngagementBannerDescription"),bannerType:ee.EngagementBannerType.MeetNow,icon:$.SkypeIcon.MeetNow,size:$.IconSize.size28,onClick:()=>{g.MeetNowHelpers.showNewMeetNow(m.MeetNowOrigin.RecentChatsBanner),P.default.setBannerState(ee.EngagementBannerAction.Clicked),k.track(new I.EngagementBannerTelemetryEvent(e,ee.EngagementBannerAction.Clicked))},onClose:s}}}}t.ConversationsListHelper=ye},131708:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLeaveSectionMenuItems=t.RowDecoratorType=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=s(460515),a=i.__importStar(s(44717)),l=i.__importDefault(s(340724)),d=s(154235),c=i.__importStar(s(704704)),u=s(16549),h=s(641400),p=i.__importDefault(s(48076)),g=i.__importStar(s(972830)),m=i.__importStar(s(500645)),S=s(717413),_=s(803193),f=s(815146),y=s(993277);var v,C;!function(e){e.More="more",e.Call="call",e.Archive="archive",e.MarkRead="markread",e.Mute="mute"}(v||(v={})),function(e){e[e.Avatar=0]="Avatar",e[e.Status=1]="Status",e[e.Icon=2]="Icon",e[e.None=3]="None"}(C||(t.RowDecoratorType=C={}));class T{static getMenuSections(e){return[{key:"magicBotPin",menuItems:this._getMagicBotPinTopMenuItems(e)},{key:"favoriteSection",menuItems:this._getFavoriteSectionMenuItems(e)},{key:"otherSection",menuItems:this._getOtherSectionMenuItems(e)},{key:"leaveSection",menuItems:(0,t.getLeaveSectionMenuItems)(e)}]}static getMenuItems(e){let s=[];s=[...this._getMagicBotPinTopMenuItems(e),...this._getFavoriteSectionMenuItems(e),...this._getOtherSectionMenuItems(e),...(0,t.getLeaveSectionMenuItems)(e)];return{items:s,destructiveIndex:s.length-1}}static getSwipeActions(e,t,s,i,r){if(t)return{rightActions:[]};{const{recentChatsSwipeActionsConfig:t}=n.default.getS4LUiFeaturesNoSubscription();return{rightActions:o.compact(o.map(t.right,(t=>(t!==v.Call||!r)&&(!(t===v.Mute&&(!r||r&&void 0===i))&&this._commandToAction(t,e,s,!!i))))),leftActions:t.left?o.compact(o.map(t.left,(t=>(t!==v.MarkRead||!r)&&this._commandToAction(t,e,s,!!i)))):void 0,overScrollLeft:t.overScrollLeft,overScrollRight:t.overScrollRight,overScrollDistance:t.overScrollDistance}}}static _commandToAction(e,t,s,i){switch(e){case v.More:return y.ConversationCommands.More;case v.Call:return y.ConversationCommands.AudioCall;case v.MarkRead:return s?y.ConversationCommands.MarkRead:y.ConversationCommands.MarkUnread;case v.Archive:return t?y.ConversationCommands.Unarchive:y.ConversationCommands.Archive;case v.Mute:return i?y.ConversationCommands.Unmute:y.ConversationCommands.Mute}}static conversationSwipeActionForCommand(e,t,s,i,o){let n;const r=u.Color.white;let l,d=u.Color.gray300;switch(e){case y.ConversationCommands.More:n=h.SkypeIcon.More,l=i?void 0:c.getString("Global.MoreButtonTitle"),d=g.isDarkTheme(s)?u.Color.gray400:u.Color.gray300;break;case y.ConversationCommands.Archive:n=h.SkypeIcon.Hide,l=i?void 0:c.getString("Global.HideLabel"),d=u.Color.blueDark;break;case y.ConversationCommands.Unarchive:n=h.SkypeIcon.QuickLook,l=i?void 0:c.getString("Global.UnhideLabel"),d=u.Color.blueDark;break;case y.ConversationCommands.MarkRead:n=h.SkypeIcon.MessageRead,l=i?void 0:c.getString("ConversationsListItem.MarkReadLabelShort"),d=u.Color.blueDark;break;case y.ConversationCommands.MarkUnread:n=h.SkypeIcon.MessageUnread,l=i?void 0:c.getString("ConversationsListItem.MarkUnreadLabelShort"),d=u.Color.blueDark;break;case y.ConversationCommands.Mute:n=h.SkypeIcon.NotificationOff,l=i?void 0:c.getString("ConversationsListItem.MuteLabel"),d=u.Color.blueDark;break;case y.ConversationCommands.Unmute:n=h.SkypeIcon.Notification,l=i?void 0:c.getString("ConversationsListItem.UnmuteLabel"),d=u.Color.blueDark;break;case y.ConversationCommands.Call:case y.ConversationCommands.AudioCall:n=a.isPhoneMri(t)?h.SkypeIcon.SkypeOut:h.SkypeIcon.CallStart,l=i?void 0:c.getString("Hub.NewCallMenuShortLabel"),d=u.Color.blueMedium}if(n)return{command:e,icon:n,iconColor:r,backgroundColor:d,label:l,onComplete:o}}static getAccessibilityLabel(e){let t="";if(e.isMagicBotPinned&&(t+=c.getString("ConversationsListItem.PinnedConversation")),e.isFavorite&&(t+=c.getString("ConversationsListItem.FavoriteConversation")),e.isAgent&&(t+=c.getString("ConversationsListItem.BotConversation")+", "),t+=e.conversationDisplayName+", ",e.isOneOnOne){const s=m.accessibilityLabelForUserStatus(e.presence);s&&(t+=s+", "),e.moodAccessibilityLabel&&(t+=e.moodAccessibilityLabel+", "),t+=c.getString("ConversationsListItem.OneonOneConversationLabel")}else t+=c.getString("ConversationsListItem.GroupConversationLabel");return e.hasActiveCall&&e.activeCallStatus!==r.ActiveCallStatus.None?t+=", "+(e.activeCallStatus===r.ActiveCallStatus.OnHold?c.getString("OngoingCall.OngoingCallOnHoldTitle"):c.getString("OngoingCall.OngoingCallTitle")):t+=c.getString("ConversationsListItem.LastMessageLabel",{message:e.lastMessageLabel,time:e.lastMessageTime}),e.isRecipientBlocked&&(t+=c.getString("ConversationsListItem.BlockedContact")),e.hasActiveCall||(e.isMuted?t+=c.getString("ConversationsListItem.MutedConversationLabel"):t+=c.getString("ConversationsListItem.NewMessages",{count:e.displayedUnreadCount||0}),e.isTyping&&(t+=c.getString("ConversationsListItem.ParticipantTyping"))),e.isSelected&&(t+=c.getString("Global.SelectedAccessibilityLabel")),e.addAccessibilityHint&&(t=l.default.applyMoreOptionsAccessibilityHint(t)),t}static rowDecorator(e){if(e.useExtraCompactLayout){if(e.hasActiveCall)return{type:C.Icon,icon:h.SkypeIcon.CallAnimSmall4};if(o.isUndefined(e.userStatus)){if(e.isOneOnOne){if(e.isTeamsUser)return{type:C.Icon,icon:h.SkypeIcon.MSTeams};{const t=e.conversationId?T.optionalMessageTypeIcon(!!e.useExtraCompactLayout,!!e.isEncrypted,!!e.isTranslated,e.conversationId):void 0;return t?{type:C.Icon,icon:t}:{type:C.None}}}return{type:C.Icon,icon:h.SkypeIcon.ContactGroup}}return{type:C.Status}}return{type:C.Avatar}}static optionalMessageTypeIcon(e,t,s,i,o){return o?h.SkypeIcon.Media:t?h.SkypeIcon.Lock:a.isPhoneMri(i)?e?h.SkypeIcon.SkypeOut:h.SkypeIcon.MobileSmsNew:e&&a.isAgent(i)?h.SkypeIcon.Bot:e&&a.isOneOnOneConversation(i)?h.SkypeIcon.Contact:p.default.isTabletNoSubscription()&&s?h.SkypeIcon.SkypeTranslator:void 0}}T._getFavoriteSectionMenuItems=e=>{const{enableConversationContextMenuInBottomSheet:t}=n.default.getS4LMessagingFeaturesNoSubscription(),s=[];return e.isArchived||(e.isFavorite?s.push({text:c.getString("ConversationsListItem.UnfavoriteLabel"),command:y.ConversationCommands.Unfavorite,icon:t?h.SkypeIcon.StarOff:d.SXMenuIcon.StarOff,category:f.ItemCommandActionCategory.Main}):s.push({text:c.getString("ConversationsListItem.FavoriteLabel"),command:y.ConversationCommands.Favorite,icon:t?h.SkypeIcon.Star:d.SXMenuIcon.Favorite,category:f.ItemCommandActionCategory.Main})),s},T._getMagicBotPinTopMenuItems=e=>{const t=[],{enableConversationContextMenuInBottomSheet:s}=n.default.getS4LMessagingFeaturesNoSubscription();return e.magicBotEnabled&&(0,S.getMagicBotId)()===e.conversationId&&(e.magicBotUnpin?t.push({text:c.getString("ConversationsListItem.MagicBotPinLabel"),command:y.ConversationCommands.MagicBotPin,icon:s?h.SkypeIcon.Pin:d.SXMenuIcon.Pin,category:f.ItemCommandActionCategory.Main}):t.push({text:c.getString("ConversationsListItem.MagicBotUnpinLabel"),command:y.ConversationCommands.MagicBotUnpin,icon:s?h.SkypeIcon.PinOff:d.SXMenuIcon.PinOff,category:f.ItemCommandActionCategory.Main})),t},T._getOtherSectionMenuItems=e=>{const{enableContentChannels:t}=n.default.getS4LUiFeaturesNoSubscription(),{enableConversationContextMenuInBottomSheet:s}=n.default.getS4LMessagingFeaturesNoSubscription(),i=e.isNewsChannel,o=[];e.isOneOnOne?o.push({text:c.getString("ConversationsListItem.ChatOneOnOneProfileLabel"),command:y.ConversationCommands.Profile,icon:s?h.SkypeIcon.PersonCircle:d.SXMenuIcon.Profile,category:f.ItemCommandActionCategory.Secondary}):e.isNewsChannel||o.push({text:c.getString("ConversationsListItem.ChatGroupManageLabel"),command:y.ConversationCommands.ManageGroup,icon:s?h.SkypeIcon.Settings:d.SXMenuIcon.Settings,category:f.ItemCommandActionCategory.Secondary}),e.isOneOnOne||!e.isJoinEnabled||e.isNewsChannel||o.push({text:c.getString("ConversationsListItem.CopyLinik"),command:y.ConversationCommands.CopyLink,icon:s?h.SkypeIcon.Link:d.SXMenuIcon.Copy,category:f.ItemCommandActionCategory.Secondary});const r=e.displayedUnreadCount>0&&!e.isArchived;if(e.isMyBot||!r||i||o.push({text:c.getString("ConversationsListItem.MarkReadLabel"),command:y.ConversationCommands.MarkRead,icon:s?h.SkypeIcon.Glasses:d.SXMenuIcon.ReadMark,category:f.ItemCommandActionCategory.Main}),e.isMyBot||r||i||o.push({text:c.getString("ConversationsListItem.MarkUnreadLabel"),command:y.ConversationCommands.MarkUnread,icon:s?h.SkypeIcon.GlassesOff:d.SXMenuIcon.UnreadMark,category:f.ItemCommandActionCategory.Main}),!i)if(e.isArchived){const t=e.isNewsChannel?"ContentChannels.ChannelsSwipeMenuUnhideOption":"ConversationsListItem.UnhideItemLabel";o.push({text:c.getString(t),command:y.ConversationCommands.Unarchive,icon:s?h.SkypeIcon.Eye:d.SXMenuIcon.UnhideMark,category:f.ItemCommandActionCategory.Main})}else if(!e.hasActiveCall){const t=e.isNewsChannel?"ContentChannels.ChannelsSwipeMenuHideOption":"ConversationsListItem.HideItemLabel";o.push({text:c.getString(t),command:y.ConversationCommands.Archive,icon:s?h.SkypeIcon.EyeOff:d.SXMenuIcon.HideMark,category:f.ItemCommandActionCategory.Main})}return e.isMriAnAgent||(e.isOneOnOne?o.push({text:c.getString("InfoPanel.DeleteConversationLabel"),command:y.ConversationCommands.DeleteConversation,icon:s?h.SkypeIcon.Bin:d.SXMenuIcon.Delete,category:f.ItemCommandActionCategory.Destructive}):e.isNewsChannel||o.push({text:c.getString("InfoPanel.ClearGroupConversationLabel"),command:y.ConversationCommands.ClearConversation,icon:s?h.SkypeIcon.Broom:d.SXMenuIcon.Clear,category:f.ItemCommandActionCategory.Destructive})),e.isOneOnOne&&!e.isMriAContact&&(e.isRecipientBlocked?o.push({text:c.getString("ConversationsListItem.UnblockContact",{displayName:e.conversationShortDisplayName}),command:y.ConversationCommands.Unblock,icon:s?h.SkypeIcon.Clear:d.SXMenuIcon.Block,category:f.ItemCommandActionCategory.Main}):e.displayBlockButton&&o.push({text:c.getString("ConversationsListItem.BlockContact",{displayName:e.conversationShortDisplayName}),command:y.ConversationCommands.BlockContact,icon:s?h.SkypeIcon.Clear:d.SXMenuIcon.Block,category:f.ItemCommandActionCategory.Destructive})),!e.isMriAnAgent||e.isEngagementBot||e.isMyBot||o.push({text:c.getString("ConversationsListItem.DeleteBot",{displayName:e.conversationShortDisplayName}),command:y.ConversationCommands.DeleteBotFromContacts,icon:s?h.SkypeIcon.Bin:d.SXMenuIcon.Delete,category:f.ItemCommandActionCategory.Destructive}),i&&t&&o.push(...(0,_.getOtherMenuItems)().items),e.isOneOnOne&&!e.isNewsBot||void 0===e.isMuted||(e.isMuted?o.push({text:c.getString("ConversationsListItem.UnmuteLabel"),command:y.ConversationCommands.Unmute,icon:s?h.SkypeIcon.Speaker:d.SXMenuIcon.Notification,category:f.ItemCommandActionCategory.Main}):o.push({text:c.getString("ConversationsListItem.MuteLabel"),command:y.ConversationCommands.Mute,icon:s?h.SkypeIcon.SpeakerOff:d.SXMenuIcon.NotificationOff,category:f.ItemCommandActionCategory.Main})),o},t.default=T;t.getLeaveSectionMenuItems=({isOneOnOne:e,isNewsChannel:t})=>{const s=[],{enableConversationContextMenuInBottomSheet:i}=n.default.getS4LMessagingFeaturesNoSubscription();return e||t||s.push({text:c.getString("InfoPanel.LeaveConversationLabel"),command:y.ConversationCommands.LeaveConversation,icon:i?h.SkypeIcon.ArrowExit:d.SXMenuIcon.Leave,category:f.ItemCommandActionCategory.Destructive}),t&&s.push(...(0,_.getMenuItems)().items),s}},657802:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasOnlyInlineElements=void 0;const i=s(197582),o=i.__importStar(s(516778)),n=s(537180),r=s(623627),a=i.__importDefault(s(398745)),l=s(183049),d=i.__importDefault(s(778408)),c=s(847394),u=s(82021),h=[o.Text,n.Text,r.AnimatedEmoticon,d.default,c.AttributionNode,u.AttributionsTextNode,a.default,l.HighlightedNode];t.hasOnlyInlineElements=e=>o.Children.toArray(e).every((e=>h.includes(e.type)))},899185:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=s(26703),d=s(704704),c=s(985367),u=s(291498),h=s(997380),p=i.__importDefault(s(201721)),g=s(262725),m=(0,l.lazyProperties)({overflowItem:()=>r.Styles.createViewStyle({width:h.OverflowItemSizeInList,height:h.OverflowItemSizeInList,borderRadius:10,alignItems:"center",justifyContent:"center",marginRight:20}),overflowRoundedItem:()=>r.Styles.createViewStyle({width:h.OverflowItemSizeInGridOrCarousel,height:h.OverflowItemSizeInGridOrCarousel,borderRadius:h.OverflowItemSizeInGridOrCarousel/2,alignItems:"center",justifyContent:"center",marginHorizontal:5}),overflowItemContainer:()=>r.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),iconText:()=>r.Styles.createTextStyle({lineHeight:16,paddingVertical:10,alignItems:"center",marginHorizontal:1})});const S=new class{overflowItemForDescriptor(e,t,s,i){const n=this.getMediaBarItemProps(t,s,e),a=e.render(n);return(0,o.jsxs)(r.View,{style:[m.overflowItemContainer,i],children:[a,(0,o.jsx)(g.Caption,{style:m.iconText,numberOfLines:1,accessibilityHidden:!0,children:this.getMediaBarItemTitle(e.id)})]},e.id)}isMediaBarItemNew(e){const{mediaBarNewItems:t}=a.default.getS4LMessagingFeaturesNoSubscription();return t.includes(e)&&!p.default.isMediaBarNewItemSeen(e)}setMediaBarItemAsSeen(e){p.default.setMediaBarNewItemSeen(e,!0)}isAnyMediaBarItemNew(e){return e.some((e=>this.isMediaBarItemNew(e.id)))}getMediaBarItemTitle(e){let t;switch(e){case u.MediaBarItemKeys.Bing:t=(0,d.getString)("MediaBar.BingSearchTitle");break;case u.MediaBarItemKeys.MagicBotToolbox:t=(0,d.getString)("MediaBar.MagicBotToolboxTitle");break;case u.MediaBarItemKeys.FilePicker:t=(0,d.getString)("MediaBar.MediaAndFilePickerTitle");break;case u.MediaBarItemKeys.Camera:t=(0,d.getString)("QuickCapturePanel.CameraButtonTitle");break;case u.MediaBarItemKeys.Location:t=(0,d.getString)("MediaBar.LocationTitle");break;case u.MediaBarItemKeys.Contact:t=(0,d.getString)("MediaBar.ContactTitle");break;case u.MediaBarItemKeys.MediaPicker:t=(0,d.getString)("MediaBar.MediaTitle");break;case u.MediaBarItemKeys.ScheduleCall:t=(0,d.getString)("MediaBar.ScheduleCallTitle");break;case u.MediaBarItemKeys.Sms:t=(0,d.getString)("MediaBar.SMSTitle");break;case u.MediaBarItemKeys.People:t=(0,d.getString)("MediaBar.PeopleTitle");break;case u.MediaBarItemKeys.Poll:t=(0,d.getString)("MediaBar.PollTitle");break;case u.MediaBarItemKeys.VideoMessage:t=(0,d.getString)("MediaBar.VideoMessageTitle");break;case u.MediaBarItemKeys.SkypeClipsRecord:t=(0,d.getString)("MediaBar.SkypeClipsRecordTitle");break;case u.MediaBarItemKeys.SendCredit:t=(0,d.getString)("MediaBar.SendCreditTitle");break;case u.MediaBarItemKeys.Audio:t=(0,d.getString)("MessageComposer.RecordButtonTitle");break;case u.MediaBarItemKeys.Whiteboard:t=(0,d.getString)("Whiteboard.WhiteboardTitle");break;case u.MediaBarItemKeys.ImageGeneration:t=(0,d.getString)("MediaBar.ImageGenerationTitle")}return t}getMediaBarItemDescription(e){let t;switch(e){case u.MediaBarItemKeys.Location:t=(0,d.getString)("MediaBar.LocationDescription");break;case u.MediaBarItemKeys.MediaPicker:t=(0,d.getString)("MediaBar.MediaDescription");break;case u.MediaBarItemKeys.VideoMessage:t=(0,d.getString)("MediaBar.VideoMessageDescription");break;case u.MediaBarItemKeys.SkypeClipsRecord:t=(0,d.getString)("MediaBar.SkypeClipsRecordDescription");break;case u.MediaBarItemKeys.Whiteboard:t=(0,d.getString)("Whiteboard.WhiteboardDescription");break;case u.MediaBarItemKeys.FilePicker:t=(0,d.getString)("MediaBar.MediaAndFilePickerDescription");break;case u.MediaBarItemKeys.Contact:t=(0,d.getString)("MediaBar.ContactPickerDescription");break;case u.MediaBarItemKeys.Bing:t=(0,d.getString)("MediaBar.BingSearchDescription");break;case u.MediaBarItemKeys.MagicBotToolbox:t=(0,d.getString)("MediaBar.MagicBotToolboxDescription");break;case u.MediaBarItemKeys.Sms:t=(0,d.getString)("MediaBar.SMSDescription");break;case u.MediaBarItemKeys.ScheduleCall:t=(0,d.getString)("MediaBar.ScheduleCallDescription");break;case u.MediaBarItemKeys.Poll:t=(0,d.getString)("MediaBar.PollDescription");break;case u.MediaBarItemKeys.SendCredit:t=(0,d.getString)("MediaBar.SendCreditDescription");break;case u.MediaBarItemKeys.ImageGeneration:t=(0,d.getString)("MediaBar.ImageGenerationDescription")}return t}getMediaBarItemProps(e,t,s,i=!0){const o=[i?m.overflowRoundedItem:m.overflowItem,t.buttonBackgroundColorStyle];return n.extend({id:s.id,key:s.id,conversationId:e.conversationId,otherPartyMri:e.otherPartyMri,presentedInOverflowMenu:!0,active:!1,iconStyleOverride:o,isMobileInterface:!0,disabled:s.disabled,onActive:e.onItemSelected,onCustomAction:e.onCustomAction,onFocus:e.onFocus,onBlur:e.onBlur,origin:c.MediaBarItemOrigin.MessageOverflow},s.propOverrides)}};t.default=S},497821:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessagesSearchHelper=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=s(217041),a=s(917387),l=i.__importDefault(s(825502)),d=s(815146),c=i.__importStar(s(704704)),u=s(376229),h=i.__importDefault(s(923728)),p=i.__importDefault(s(717508)),g=s(96249),m="messagesHeader",S="messagesFooter",_="msg_";class f extends r.ComponentBase{constructor(){super(...arguments),this._onPress=(e,t)=>{this.props.item.onListItemClick&&this.props.item.onListItemClick(e,void 0,d.SearchResultsListGroup.Messages)}}render(){return(0,o.jsx)(l.default,{itemHeight:this.props.item.height-1,searchResult:this.props.result,rawSearchQuery:this.props.rawSearchQuery,isPseudoFocused:this.props.item.isPseudoFocused,onSearchMessagePress:this._onPress})}}const y={footer:S,header:m};class v extends g.SearchSectionHelper{constructor(){super(...arguments),this._renderSearchResultItem=e=>{if(!n.isUndefined(e.item.index)&&this._searchConfig.messages[e.item.index])return(0,o.jsx)(f,Object.assign({result:this._searchConfig.messages[e.item.index]},e))}}static _getKey(e){return _+e.ConversationId+e.MessageId}buildConfig(e,t,s){return{messages:t.searchController.getMessagesResults(),isShowingMore:!!s.isShowingMore[d.SearchResultsListGroup.Messages],contentSizeMultiplier:s.contentSizeMultiplier,limit:e.isCollapsible?this._getMaxItemsInGroup(e):void 0,hideHeader:!!e.hideHeader,hideHeaderCaption:!!e.hideHeader}}getItems(e,t,s,i,o,n=!1){const r={itemHeight:u.SearchItemHeights.messageBaseItemHeight+Math.round(65*this._searchConfig.contentSizeMultiplier),itemTemplate:"content",measureHeightForNonHeaderItems:!0,showSectionEvenIfEmpty:!1,hideHeader:this._searchConfig.hideHeader||this._searchConfig.hideHeaderCaption,hideHeaderTitle:this._searchConfig.hideHeaderCaption,header:c.getString("SearchResultsList.MessagesHeader"),hasHeaderWithButtons:!0},a=g.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,sourceList:this._searchConfig.messages,getKey:v._getKey,keys:y,renderConfig:r,groupType:d.SearchResultsListGroup.Messages,onFooterPress:o,limit:this._searchConfig.limit,forceInsertFooter:n}),l=a.defaultList;return this._searchConfig.isShowingMore&&l.push(...a.listWithRestOfItems),a.footerItem&&l.push(a.footerItem),l}renderItem(e,t=!1){return e.item.key===m?this._renderHeaderItem(e):e.item.key===S?this._renderFooterItem(e.item,t):e.item.key.substring(0,4)===_?this._renderSearchResultItem(e):void 0}_renderHeaderItem(e){const t=e.item;return(0,o.jsx)(p.default,{sectionTitle:t.hideTitle?void 0:c.getString("SearchResultsList.MessagesHeader"),enableNewSearchHeader:e.customizeExperienceByContactsLevel})}_renderFooterItem(e,t){return t?a.ActivityIndicatorHelper.renderItem(a.ActivityIndicatorHelper.getListItem(e.key)):(0,o.jsx)(h.default,{shouldShowAllResults:this._searchConfig.isShowingMore,groupType:d.SearchResultsListGroup.Messages,onShowMorePress:e.onPress})}}t.MessagesSearchHelper=v},776622:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(963721)),a=i.__importStar(s(44717)),l=s(331079),d=i.__importDefault(s(685734));t.default=class{static canSendSMSToMri(e){return!(!a.isPhoneMri(e)||a.isBlockedPSTNMri(e))||o.size(d.default.getFullUserProfileByMri(e).phones)>0}static getPhoneNumberToNavigateTo(e,t,s){const i=d.default.getFullUserProfileByMriNoSubscription(e).phones||[];if(a.isPhoneMri(e)||a.getMriNamespace(e)===a.Namespaces.OneToOneTextMessage){const t={number:a.getPhoneNumberFromMri(e)||"",type:l.PhoneNumberTypes.Other};return n.Resolved(t)}return i.length?1===i.length?n.Resolved(i[0]):this.showNumberSelectionPopup(t,s,e,i,!1):n.Resolved(void 0)}static showNumberSelectionPopup(e,t,s,i,o){const a=n.Defer();return r.default.showSendSmsPrompt(e,t,s,i,(e=>{a.resolve(e)}),o),a.promise()}}},849252:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=s(537180),l=i.__importStar(s(516778)),d=s(641400),c=s(815146),u=s(26703),h=s(206315),p=i.__importDefault(s(207864)),g=i.__importDefault(s(970035)),m=i.__importDefault(s(20758)),S=(0,u.lazyProperties)({icon:()=>l.Styles.createViewStyle({paddingRight:10})}),_=({menuItem:e,origin:t,onItemSelected:s})=>{const{themeColors:{textPrimary:i,iconDanger:l,textDanger:u}}=(0,h.useSkypeTheme)(),_=(0,r.useCallback)((()=>{p.default.triggerFeedback(),s(e.command,t)}),[e.command,s,t]);return(0,o.jsx)(a.Pressable,{onPress:_,children:(0,o.jsxs)(n.Row,{paddingX:"size160",paddingY:"size120",borderBottomWidth:1,borderBottomColor:"surfacePrimary",backgroundColor:"surfaceSecondary",alignItems:"center",children:[e.icon&&(0,o.jsx)(n.Box,{children:(0,o.jsx)(g.default,{color:e.category===c.ItemCommandActionCategory.Destructive?l:i,style:S.icon,size:d.IconSize.size24,icon:e.icon})}),(0,o.jsx)(a.Text,{style:[e.category===c.ItemCommandActionCategory.Destructive?{color:u}:{color:i},{fontSize:m.default.fontSize.size15}],children:e.text})]})},"command"+e.text)};_.displayName="CommandButton",t.default=(0,r.memo)(_)},504336:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(344175),r=s(667294),a=i.__importDefault(s(849252)),l=({menuItems:e,origin:t,onItemSelected:s})=>(0,o.jsx)(n.Column,{width:"100%",accessibilityRole:"button",children:e.map((e=>(0,o.jsx)(a.default,{menuItem:e,origin:t,onItemSelected:s})))});l.displayName="CommandButtons",t.default=(0,r.memo)(l)},43823:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(496486),r=s(344175),a=s(667294),l=i.__importDefault(s(504336));t.default=(0,a.memo)((({menuItems:e,origin:t,onItemSelected:s})=>{const i=(0,n.groupBy)(e,(e=>e.category));return(0,o.jsx)(r.Column,{width:"100%",children:Object.entries(i).map((([e,i])=>(0,o.jsx)(r.Box,{borderRadius:10,marginTop:10,overflow:"hidden",children:(0,o.jsx)(l.default,{menuItems:i,onItemSelected:s,origin:t})},e)))})}))},355088:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createImage=t.debugDumpMessagePretty=t.debugDumpMessage=t.cancelPoll=t.editScheduledCall=t.cancelScheduledCall=t.viewLink=t.selectMessages=t.showReportedMessage=t.reportMessage=t.markReadToHere=t.openFileLocation=t.openMediaLocation=t.copyLocationMessage=t.copyLinkMessage=t.copyImage=t.copyMessage=t.translateOneMessage=t.translateMessage=t.bookmarkMessage=t.forwardMessage=t.retryFailedSend=t.cancelFailedSend=t.cancelEditMessage=t.cancelSendMessage=t.removeMessage=t.quoteSelection=t.searchSelection=t.getUrlParams=t.webSearchInMobile=t.quoteMessage=t.editMessage=t.viewInChat=t.saveMediaAs=t.saveFileAs=t.saveMedia=t.addReaction=void 0;const i=s(197582),o=s(496486),n=i.__importDefault(s(206483)),r=i.__importDefault(s(150343)),a=i.__importStar(s(987364)),l=i.__importDefault(s(418443)),d=i.__importDefault(s(196687)),c=i.__importStar(s(790330)),u=i.__importDefault(s(804144)),h=i.__importStar(s(971988)),p=s(971988),g=s(44717),m=s(154235),S=i.__importStar(s(463519)),_=s(815146),f=s(609099),y=i.__importDefault(s(606617)),v=i.__importStar(s(555078)),C=i.__importDefault(s(663823)),T=i.__importDefault(s(446802)),M=i.__importStar(s(85385)),b=i.__importStar(s(50350)),I=i.__importStar(s(704704)),w=i.__importDefault(s(656681)),P=s(732469),k=i.__importStar(s(51789)),A=i.__importDefault(s(519093)),x=s(606933),D=s(606933),R=i.__importDefault(s(484700)),L=s(536748),B=i.__importDefault(s(379610)),F=s(786531),N=i.__importDefault(s(682432)),E=i.__importDefault(s(503411)),O=i.__importDefault(s(201721)),U=i.__importDefault(s(341994)),V=i.__importDefault(s(740794)),H=i.__importDefault(s(450312)),j=s(334635),z=i.__importDefault(s(125611)),W=i.__importDefault(s(551356)),G=s(158437),K=i.__importDefault(s(184457)),q=s(224802),Q=s(36381),X=i.__importDefault(s(994962)),$=i.__importDefault(s(374503)),J=i.__importDefault(s(791384)),Y=i.__importStar(s(928314)),Z=s(206467),ee=i.__importDefault(s(139221)),te=s(331079),se=s(935086),ie=i.__importDefault(s(760989)),oe=s(233584),ne=i.__importDefault(s(220534)),re=s(217596),ae=s(641400),le=s(55544),de=i.__importDefault(s(64812)),ce=s(138245),ue=s(96737),he=s(591312),pe=s(539058);t.addReaction=e=>({command:Z.CommandTypes.AddReaction,category:_.ItemCommandActionCategory.React,localizationKey:"StreamItem.React",onCommandSelected:()=>{if(C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.AddReaction),e.screenReaderEnabled){new W.default(e.message).showReactionActionSheet(e.getReactionMenuPopupAnchor,e.componentContext.rootViewId)}else{if(!e.getReactionMenuPopupAnchor||!e.getReactionMenuPopupAnchor())return;new G.ReactionsMenuPopup(e.message,void 0,e.getReactionMenuPopupAnchor,e.componentContext.rootViewId,e.componentContext.rootViewType).show()}}});t.saveMedia=e=>{const t=k.getSaveToDirectoryLocalizationKeys(e.message),s=e.message&&e.message.isAlbum();return{command:Z.CommandTypes.SaveMedia,category:_.ItemCommandActionCategory.Secondary,localizationKey:t.key,localizationKeyParameters:t.params,icon:t.icon,onCommandSelected:()=>{if(s){w.default.getAllMediaMessagesForAlbum(e.message.getAlbumId()).forEach((t=>{const s=S.decode(t).getFirstUriObjectChild(D.DisplayableMedia);s&&ge(s,t,e.componentContext.rootViewId,!0,"")}))}else{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.SaveMedia);const t=e.decodedNode.getFirstUriObjectChild(D.DisplayableMedia);t&&ge(t,e.message,e.componentContext.rootViewId,!1)}}}};const ge=(e,t,s,i,o)=>{const n=ie.default.newCauseId();M.log(_.LogTraceArea.Navigation,"onSaveMedia, causeId: "+n);const r=A.default.getMediaDescriptorForItem(t);let a;switch(r&&r.mediaType){case j.PictureViewer.MediaType:case oe.VideoViewer.MediaType:case l.default.MediaType:a=r.downloadFileName;break;default:return}r&&M.track(new P.MediaDownloadTelemetryEvent(t,P.MediaDownloadActionOrigin.StreamItem,P.MediaDownloadReason.SaveToDownloads,y.default.extractFileExtension(a)));const d=e.getNameForDownload()||e.getFullResolutionUrlSanitized();o||(o=O.default.getUserPreferencesLocal().fileDownloadPathDesktop);const c=f.FilePickerUtils.getFileUri(d,o);B.default.downloadToCameraRoll(t,e.getFullResolutionUrlSanitized(),c,n,s,i)};t.saveFileAs=e=>{const t=e.decodedNode.getFirstUriObjectChild(D.UriObjectFileNode);if(t)return{command:Z.CommandTypes.SaveAsFile,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionSaveAs",icon:m.SXMenuIcon.Save,onCommandSelected:()=>{const s=ie.default.newCauseId();M.log(_.LogTraceArea.Navigation,"onSaveAs, causeId: "+s),C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.SaveAsFile);const i=t.getFileContentUrlSanitized(),o=t.getNameForDownload();if(i&&o){const t=a.getDocumentId(i);if(t){const i=a.getDisplayUrl(t,te.UploadFileType.File);B.default.desktopSaveAs(t,o,i,s,e.message,e.componentContext.rootViewId)}}}}};t.saveMediaAs=e=>{const t=e.message&&e.message.isAlbum();return{command:Z.CommandTypes.SaveAsMedia,category:_.ItemCommandActionCategory.Secondary,localizationKey:t?"StreamItem.ActionSaveAll":"StreamItem.ActionSaveAs",icon:m.SXMenuIcon.Save,onCommandSelected:()=>{const s=ie.default.newCauseId();if(M.log(_.LogTraceArea.Navigation,"onSaveMediaAs, causeId: "+s),C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.SaveAsMedia),t)f.FilePickerUtils.showOpenDialog({properties:["openDirectory"]},(t=>{w.default.getAllMediaMessagesForAlbum(e.message.getAlbumId()).forEach((s=>{const i=S.decode(s).getFirstUriObjectChild(D.DisplayableMedia);i&&ge(i,s,e.componentContext.rootViewId,!0,t.path)}))}));else{let t,i;const o=A.default.getMediaDescriptorForItem(e.message);switch(o&&o.mediaType){case j.PictureViewer.MediaType:t=o.downloadFileName,i=o.fullResolutionUrl;break;case oe.VideoViewer.MediaType:t=o.downloadFileName,i=o.videoUrl;break;case l.default.MediaType:t=o.downloadFileName,i=o.audioUrl;break;default:return}t&&i&&(o&&M.track(new P.MediaDownloadTelemetryEvent(e.message,P.MediaDownloadActionOrigin.StreamItem,P.MediaDownloadReason.SaveAs,y.default.extractFileExtension(t))),B.default.desktopSaveAs(a.getFileCacheKeyMedia(e.message,!0),t,i,s,e.message,e.componentContext.rootViewId))}}}};t.viewInChat=e=>({command:Z.CommandTypes.ViewInChat,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ViewInChat",icon:m.SXMenuIcon.SlideSearch,onCommandSelected:()=>{const t=ie.default.newCauseId();M.log(_.LogTraceArea.Navigation,"StreamItemCommands.viewInChat, causeId: "+t),C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.ViewInChat),V.default.navigateToConversation({convId:e.message.conversationId,causeId:t,focusedMessageCuid:e.message.cuid,scrollToTimestamp:Number(e.message.createdTime),origin:_.NavigationConversationOrigin.Gallery})}});t.editMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.Edit,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionEdit",icon:t?ae.SkypeIcon.Topic:m.SXMenuIcon.Edit,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.Edit),e.onEditCallback&&e.onEditCallback(e.message)}}};t.quoteMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription(),{pasteAsQuotesEnabled:s}=O.default.getUserPreferencesLocalNoSubscription(),i=t?ae.SkypeIcon.Reply:m.SXMenuIcon.Reply;return{command:Z.CommandTypes.Quote,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionReply",icon:i,isVisible:()=>!(s&&me(e)),onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.Quote),e.onQuoteCallback&&e.onQuoteCallback([e.message],se.QuotesTriggerType.ActionMenu)}}};t.webSearchInMobile=e=>{const{enableConversationSearchInMobile:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.WebSearch,category:_.ItemCommandActionCategory.Secondary,localizationKey:"SearchResultsList.WebSearchHeader",icon:ae.SkypeIcon.Search,isVisible:()=>t,onCommandSelected:()=>{var t,s;M.track(new ce.ContextMenuTelemetryEvents(ce.ContextMenuAction.WebSearchEntryClicked));let i=e.message,o=e.decodedNode,n=I.getLanguageFromLocale().toLowerCase().trim();let a=I.getLocale().toLowerCase().substring(3,5).trim();if(e.hasTranslation&&e.showTranslatedMessage){const l=N.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);if(l){i=l,o=S.decode(l);const e=h.getMessageTranslationMetadata(l.content),d=null===(s=null===(t=null==e?void 0:e.translations)||void 0===t?void 0:t[0])||void 0===s?void 0:s.loc,c=r.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech.filter((e=>"es-MX"!==e)),u=new Map;c.forEach((e=>{if(5===e.length)switch(e){case"fr-FR":u.set("fr",e);break;case"fr-CA":u.set("fr-CA",e);break;case"zh-TW":u.set("zh-Hant",e);break;case"pt-BR":u.set("pt",e);break;case"pt-PT":u.set("pt-PT",e);break;case"es-ES":u.set("es",e);break;case"en-US":u.set("en",e);break;case"en-GB":u.set("en-GB",e);break;case"zh-CN":u.set("zh-hans",e);break;default:u.set(e.substring(0,2),e)}}));const p=d?u.get(d):void 0;p?(n=p.substring(0,2),a=p.substring(3,5)):(M.log(_.LogTraceArea.Error,`failed to get matched locale with translated language ${d}`),n="en",a="us")}}const{textToCopy:l}=B.default.getTextToCopy(i,o,e.selectedText);V.default.navigateToSearchConversation({queryText:l,language:n,countryCode:a},ie.default.newCauseId())}}};t.getUrlParams=(e,t)=>{const s=r.default.getS4LMessagingFeaturesNoSubscription().bingSearch,i=encodeURIComponent(e);let o=`${s.host}${i}`;ne.default.isUrlValid(o)&&(o=ne.default.addUrlParameter(o,"form",re.FormCode.FORM_CODE_SEARCH_IN_CONVERSATION),o=ne.default.addUrlParameter(o,"PC",(0,re.getPartnerCode)()));const n={browserTitle:I.getString("MessageStream.BingSearchSidebarTitle",e?{selectedText:`'${e}'`}:void 0),preventInAppNavigationForGuest:!d.default.canNavigateInApp(),conversationId:t.contextConversationId,openInExternalBrowser:!s.tryOpenInAppBrowser,useBingMiniCanvas:!0};return{origin:_.BrowserOrigin.LinkNode,url:o,rootViewId:t.componentContext.rootViewId,options:n}};t.searchSelection=e=>{const s=Y.getSelectedText(),i=(0,o.truncate)(s,{length:20,omission:I.getString("Global.TruncationText")}),n=r.default.getS4LMessagingFeaturesNoSubscription().bingSearchMessageHint.enabled;return{command:Z.CommandTypes.SearchSelection,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.SearchSelection",localizationKeyParameters:i?{selectedText:`'${i}'`}:void 0,icon:m.SXMenuIcon.SearchSelection,isVisible:()=>me(e),onCommandSelected:i=>{const o=e.message;let r;if(n){R.default.hintShownAndUsed();const e=U.default.getMessageHintsUserData(L.MessageHintsTypes.HighlightToBingSearch);o.cuid!==(null==e?void 0:e.hintMessageId)||e.wasFeatureUsedByUser||(r=!0);const t=T.default.getDefaultMessageHintObject();t.wasFeatureUsedByUser=!0,U.default.setMessagesHintData(L.MessageHintsTypes.HighlightToBingSearch,t)}M.track(new F.MessageActionTelemetry(o.conversationId,o,o.createdTime,i||F.MessageActionOrigin.StreamItemDesktopContextMenu,F.MessageActionType.SearchSelection,void 0,r));const a=(0,t.getUrlParams)(s,e);b.openUrlWithParams(a)}}};t.quoteSelection=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription(),s=t?ae.SkypeIcon.Reply:m.SXMenuIcon.Reply;return{command:Z.CommandTypes.QuoteSelection,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionReplyToSelection",icon:s,isVisible:()=>me(e),onCommandSelected:()=>{if(C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.QuoteSelection),e.onQuoteSelection)e.onQuoteSelection();else if(e.onQuoteCallback&&(Y.isTextSelected()||e.selectedText)){const t=e.message.applyMessageForPostingLie(Y.getNewMessageFromSelection(e.message.conversationId,e.selectedText).messageForPosting);e.onQuoteCallback([t],se.QuotesTriggerType.Selection)}}}};const me=e=>Y.isTextSelected()||!!e.selectedText;t.removeMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription(),s=e.message&&e.message.messagetype===p.MessageTypes.MediaAlbum?"StreamItem.ActionRemoveAll":"StreamItem.ActionRemove";return{command:Z.CommandTypes.Remove,category:_.ItemCommandActionCategory.Destructive,localizationKey:s,icon:t?ae.SkypeIcon.Delete:m.SXMenuIcon.Dismiss,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.Remove),B.default.deleteMessage(e.message,e.componentContext.rootViewId,void 0,(()=>{J.default.maybeAnnounceForAccessibility(I.getString("Global.RemoveMessageConfirmation"))}))}}};t.cancelSendMessage=e=>({command:Z.CommandTypes.CancelSend,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionRemove",onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.CancelSend),B.default.cancelMessageSend(e.message,e.componentContext.rootViewId)}});t.cancelEditMessage=e=>({command:Z.CommandTypes.CancelEdit,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionCancelEdit",onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.CancelEdit),B.default.cancelFailedSend(e.message)}});t.cancelFailedSend=e=>({command:Z.CommandTypes.CancelFailedSend,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionRemove",onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.CancelFailedSend),B.default.cancelFailedSend(e.message)}});t.retryFailedSend=e=>({command:Z.CommandTypes.RetryFailedSend,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionRetry",onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.RetryFailedSend),B.default.retryFailedSend(e.message)}});t.forwardMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription(),s=e.message&&e.message.messagetype===p.MessageTypes.MediaAlbum?"StreamItem.ActionForwardAll":"StreamItem.ActionForward";return{command:Z.CommandTypes.Forward,category:_.ItemCommandActionCategory.Main,localizationKey:s,icon:t?ae.SkypeIcon.ForwardItem:m.SXMenuIcon.Forward,isVisible:()=>d.default.canForwardMessage()&&!e.message.isMessageInEncryptedThread(),onCommandSelected:t=>i.__awaiter(void 0,void 0,void 0,(function*(){C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.Forward);let s=e.message;if(r.default.getS4LWhiteboardFeaturesNoSubscription().enableSkypeWhiteboard){const e=(0,le.getContainerIdFromContent)(s.content);if(e){const t=yield de.default.createContainer();if(t){yield de.default.copyOverContent(e,t);const i=s.getMutableClone();i.content=(0,le.getContentWithUpdatedContainerId)(s.content,t),s=i}}}const i=s.isAlbum()?ie.default.newGuid():void 0;if(s.isBookmark()){const e=s.getBookmarkMetadata();if(e){const t=s.getMutableClone();t.creator=e.bookmarkSourceCreatorId||s.creator,t.createdTime=e.bookmarkSourceComposeTime||s.createdTime,s=t}}const o=[{message:s,node:e.decodedNode,forwardAlbumId:i}];if(s.isAlbum()){w.default.getAllMediaMessagesForAlbum(s.getAlbumId()).forEach((e=>{o.push({message:e,node:S.decode(e),forwardAlbumId:i})}))}const n=s.isBookmark()?F.MessageActionOrigin.BookmarksViewer:t||F.MessageActionOrigin.StreamItem;v.forwardMessages(o,n,e.contextConversationId,void 0,e.componentContext,e.onExternalShare)}))}};t.bookmarkMessage=e=>{if(!e.message)return;const t=e.message.isBookmark(),s=e.message.isBookmarkSourceForCurrentUser(),i=t||s?"StreamItem.RemoveBookmark":"StreamItem.AddBookmark",o=H.default.isDesktopSplitNavStackCollapsedNoSubscription(),{enableReactionsInBottomSheet:n}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.Bookmark,category:_.ItemCommandActionCategory.Secondary,localizationKey:i,icon:n?ae.SkypeIcon.Bookmark:m.SXMenuIcon.Bookmark,isVisible:()=>d.default.canBookmarkMessage()&&!e.message.isEphemeral()&&!e.message.isMessageInEncryptedThread()&&!e.message.isMessageInS4BBridgeConversation()&&!e.message.isEmote(),onCommandSelected:i=>{let n;e.message.isAlbum()&&(n=ie.default.newGuid());const r=[{message:e.message,node:e.decodedNode,forwardAlbumId:n}];if(e.message.isAlbum()){w.default.getAllMediaMessagesForAlbum(e.message.getAlbumId()).forEach((e=>{r.push({message:e,node:S.decode(e),forwardAlbumId:n})}))}const a=t?F.MessageActionOrigin.BookmarksViewer:i||F.MessageActionOrigin.StreamItem,l=s||t?void 0:t=>{u.default.setBookmarkAdded();const s=I.getString("BookmarksTooltips.BookmarkAddedToastText"),i=`${s} ${I.getString("BookmarksTooltips.BookmarkAddedToastLabel")}`;o?E.default.scheduleMessage({key:"bookmarkAdded",textMessage:s,actionLabel:I.getString("BookmarksTooltips.BookmarkAddedToastLabel"),accessibilityLabel:i,onPress:()=>V.default.navigateToConversation({convId:g.BookmarksThreadId,causeId:ie.default.newCauseId(),origin:_.NavigationConversationOrigin.InAppNotification}),rootViewId:e.componentContext.rootViewId}):J.default.maybeAnnounceForAccessibility(i)};c.bookmarkMessageAction(r,a,l)}}};t.translateMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.Translate,category:_.ItemCommandActionCategory.Secondary,localizationKey:e.showTranslatedMessage?"Translator.MessageShowOriginal":"Translator.MessageShowTranslation",isVisible:()=>!!e.isConversationTranslated,icon:t?ae.SkypeIcon.Translate:m.SXMenuIcon.Translate,onCommandSelected:()=>{var t;null===(t=e.onTranslateCallback)||void 0===t||t.call(e)}}};t.translateOneMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.TranslateOne,category:_.ItemCommandActionCategory.Secondary,localizationKey:e.showTranslatedMessage?"Translator.MessageShowOriginal":"StreamItem.ActionTranslate",isVisible:()=>!e.isConversationTranslated,icon:t?ae.SkypeIcon.Translate:m.SXMenuIcon.Translate,onCommandSelected:()=>{var t;null===(t=e.onTranslateOneCallback)||void 0===t||t.call(e)}}};function Se(e,t,s,i){t&&e.onCopy?e.onCopy():B.default.copyMessage(s||e.message,i||e.decodedNode,e.componentContext.rootViewId,e.selectedText)}t.copyMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.Copy,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopy",icon:t?ae.SkypeIcon.Copy:m.SXMenuIcon.Copy,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.Copy);const t=Y.isTextSelected()||!!e.selectedText;if(e.hasTranslation&&e.showTranslatedMessage){const s=N.default.getTranslatedMessage(e.message.conversationId,e.message.cuid);s&&Se(e,t,s,S.decode(s))}else Se(e,t)}}};t.copyImage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.CopyImage,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopy",icon:t?ae.SkypeIcon.Copy:m.SXMenuIcon.Copy,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.CopyImage);const t=S.decode(e.message).getFirstUriObjectChild(x.PictureNode);M.track(new P.MediaDownloadTelemetryEvent(e.message,P.MediaDownloadActionOrigin.StreamItem,P.MediaDownloadReason.Copy,t?y.default.extractFileExtension(t.getNameForUI()):void 0)),B.default.copyImageFromMessage(e.message)}}};t.copyLinkMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.CopyLink,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopyLink",icon:t?ae.SkypeIcon.Copy:m.SXMenuIcon.CopyLink,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.CopyLink),B.default.copyLinkMessage(e.url,e.message)}}};t.copyLocationMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.CopyLocation,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ActionCopy",icon:t?ae.SkypeIcon.Copy:m.SXMenuIcon.Copy,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.CopyLocation),B.default.copyLocationMessage(e.message,e.decodedNode)}}};t.openMediaLocation=e=>({command:Z.CommandTypes.OpenMediaLocation,category:_.ItemCommandActionCategory.Secondary,localizationKey:ee.default.getPlatformType()===_.PlatformType.OSX?"StreamItem.ActionOpenFileLocationMac":"StreamItem.ActionOpenFileLocation",icon:ee.default.getPlatformType()===_.PlatformType.OSX?m.SXMenuIcon.OpenFolder:m.SXMenuIcon.Open,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.OpenMediaLocation),B.default.openMediaLocationOnDesktop(e.message)}});t.openFileLocation=e=>({command:Z.CommandTypes.OpenFileLocation,category:_.ItemCommandActionCategory.Secondary,localizationKey:ee.default.getPlatformType()===_.PlatformType.OSX?"StreamItem.ActionOpenFileLocationMac":"StreamItem.ActionOpenFileLocation",icon:ee.default.getPlatformType()===_.PlatformType.OSX?m.SXMenuIcon.OpenFolder:m.SXMenuIcon.Open,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.OpenFileLocation),B.default.openFileLocationOnDesktop(e.decodedNode)}});t.markReadToHere=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.MarkReadToHere,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionUnreadFromHere",icon:t?ae.SkypeIcon.UnreadMark:m.SXMenuIcon.UnreadMark,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.MarkReadToHere),B.default.markMessageUnread(e.message,e.onMarkAsUnread)}}};t.reportMessage=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.Report,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionReportMessage",icon:t?ae.SkypeIcon.Warning:m.SXMenuIcon.Warning,onCommandSelected:()=>{C.default.potentiallyMarkCommandSelected(e.message,e.renderOrigin,Z.CommandTypes.Report);const t={mriToBlock:e.message.creator,rootViewId:e.componentContext.rootViewId,content:e.message,conversationId:e.message.conversationId};V.default.navigateToReportConcernModal(t)}}};t.showReportedMessage=e=>({command:Z.CommandTypes.ShowReported,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionShowReportedMessage",onCommandSelected:()=>{B.default.showReportedMessage(e.message)}});t.selectMessages=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.SelectMessages,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.SelectMessages",icon:t?ae.SkypeIcon.CheckmarkCircle:m.SXMenuIcon.Checkmark,onCommandSelected:()=>{e.onSelectMessagesCommandCallback&&e.onSelectMessagesCommandCallback(e.contextConversationId)}}};t.viewLink=e=>({command:Z.CommandTypes.ViewLink,category:_.ItemCommandActionCategory.Secondary,localizationKey:"StreamItem.ViewLink",onCommandSelected:()=>{B.default.viewLink(e.displayUrl,e.componentContext.rootViewId)}});t.cancelScheduledCall=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.CancelScheduledCall,category:_.ItemCommandActionCategory.Destructive,localizationKey:"ScheduledCallCard.DeleteScheduledCallOverflowItem",icon:t?ae.SkypeIcon.Delete:m.SXMenuIcon.Dismiss,onCommandSelected:()=>{const t=e.decodedNode.getFirstUriObjectChild(D.ScheduledCallInviteNode);if(!t)return void M.error(_.LogTraceArea.ScheduleCall,"Canceling a ScheduledCall message but no Scheduled Call node was found");const s=I.getString("ScheduleCall.DeleteDialogTitle"),i=$.default.getLocalizedDeleteDialogMessage(t.subject),o=[{text:I.getString("Global.CancelLabel"),isCancel:!0},{text:I.getString("Global.DeleteLabel"),isSubmit:!0,onPress:()=>{X.default.cancelScheduledCall(t.scheduledCallId),M.track(new q.ScheduledCallCancelEvent(Q.ScheduleCallCancelEventEntryPoint.MessageStream,t.conversationId)),J.default.maybeAnnounceForAccessibility(I.getString("ScheduleCall.DeletedAnnoucement",{title:t.subject+""}))},style:"destructive"}];n.default.showWithOptions({title:s,message:i,buttons:o,dialogAccessibilityTitle:i,rootViewId:e.componentContext.rootViewId})}}};t.editScheduledCall=e=>{const{enableReactionsInBottomSheet:t}=r.default.getS4LMessagingFeaturesNoSubscription();return{command:Z.CommandTypes.EditScheduledCall,category:_.ItemCommandActionCategory.Main,localizationKey:"ScheduledCallCard.ViewDetailsOverflowItem",icon:t?ae.SkypeIcon.Calendar:m.SXMenuIcon.Calendar,onCommandSelected:()=>{const t=ie.default.newCauseId();M.log(_.LogTraceArea.ScheduleCall,"StreamItemCommands.editScheduledCall causeId: "+t);const s=e.decodedNode.getFirstUriObjectChild(D.ScheduledCallInviteNode);if(!s)return void M.error(_.LogTraceArea.ScheduleCall,"Editing a ScheduledCall message but no Scheduled Call node was found");const i=X.default.getScheduledCallById(s.scheduledCallId);i&&K.default.NavigationActions.navigateToScheduledOverviewPanel({entryPoint:Q.ScheduleCallEntryPoint.MessageStream,scheduledCallId:i.id},e.componentContext.rootViewId)}}};t.cancelPoll=e=>{const t={title:I.getString("Poll.DeleteDialogTitle"),body:I.getString("Poll.DeleteDialogMessage")};return{command:Z.CommandTypes.CancelPoll,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.ActionRemove",icon:m.SXMenuIcon.Dismiss,onCommandSelected:()=>{B.default.deleteMessage(e.message,e.componentContext.rootViewId,t,(()=>{e.decodedNode.getFirstUriObjectChild(D.PollNode)?(z.default.cancelPoll(e.message.cuid),J.default.maybeAnnounceForAccessibility(I.getString("Poll.DeleteConfirmation"))):M.error(_.LogTraceArea.PollStore,"Removing a Poll message but no Poll node was found")}))}}};t.debugDumpMessage=e=>({command:Z.CommandTypes.DebugDumpMessage,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.DumpMessage",onCommandSelected:()=>{B.default.dumpMessage(e.message,!1)}});t.debugDumpMessagePretty=e=>({command:Z.CommandTypes.DebugDumpMessagePretty,category:_.ItemCommandActionCategory.Destructive,localizationKey:"StreamItem.DumpMessagePretty",onCommandSelected:()=>{B.default.dumpMessage(e.message,!0)}});t.createImage=e=>({command:Z.CommandTypes.CreateImage,category:_.ItemCommandActionCategory.Main,localizationKey:"StreamItem.ActionCreateImage",icon:m.SXMenuIcon.Designer,onCommandSelected:()=>{(0,ue.navigateToImageGeneration)(e.componentContext.rootViewId,pe.ImageGenerationOrigin.MessageContextMenu,Y.getSelectedText()||(0,he.renderText)(e.decodedNode))}})},285661:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ItemListKey=void 0,t.ItemListKey={ReadOnlyChatHeader:"readOnlyChatHeader",ContactInviteHeaderItem:"contactInviteHeaderItem",ContactInviteHeaderSpacer:"contactInviteHeaderSpacer",Composing:"composing",UnreadMarker:"unread",DateMarkerPrefix:"d_",MessagePrefix:"m_",ReadReceiptPrefix:"readReceipt",InviteMorePeople:"inviteMorePeople",SpeechConsent:"speechConsent",OldFriendBack:"oldFriendBack"}},493129:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(987364)),r=i.__importStar(s(44717)),a=i.__importStar(s(473483)),l=i.__importDefault(s(148473)),d=i.__importStar(s(704704)),c=i.__importDefault(s(363091)),u=s(331079),h=i.__importStar(s(692610));class p extends l.default{constructor(e,t){super(),this._conversationId=e,this._conversation=t,this._displayName=this._calcDisplayName(),this._conversationMemberShortNames={}}isImmutable(){return!1}updateConversationAndCheckIfChanged(e){const t=this._displayName,s=this.getAvatarUrl(),i=this.getColor();this._conversation=e,this._displayName=this._calcDisplayName();let n=t!==this._displayName;n||(n=o.some(this._conversationMemberShortNames,((e,t)=>e!==this._getAndUpdateMemberShortName(t))));s!==this.getAvatarUrl()&&(n=!0);return i!==this.getColor()&&(n=!0),n}getDisplayName(e,t){return this._displayName||super.getDisplayName(e||d.getString("Notifications.UnknownGroupConversation"),t)}getUniqueId(){return this.getMri()}getMri(){return this._conversationId}_getFirstName(){}_getLastName(){}getMemberShortName(e){return this._conversationMemberShortNames[e]||this._getAndUpdateMemberShortName(e)}_getAndUpdateMemberShortName(e){let t;const s=h.getDisplayableProfile(e);if(this._conversation&&r.isThread(this._conversationId)){let i=s.getShortName(),n=!1;i&&(i=i.trim().toLowerCase(),n=!o.some(this._conversation.getThreadMembers(),(t=>{if(t.id===e)return!1;const s=h.getDisplayableProfile(t.id).getShortName();return s&&i===s.trim().toLowerCase()}))),t=n?s.getShortName():s.getDisplayName()}else t=s.getShortName();return this._conversationMemberShortNames[e]=t,t}getAvatarUrl(){let e=this._conversation&&this._conversation.isThread()?this._conversation.getThreadProperty(r.ThreadProps.Picture):void 0;if(e&&0===e.indexOf("URL@")){e=e.substring(4);const t=u.MediaViewSize.Thumbnail,s=n.getDocumentId(e);return s&&n.getDisplayUrl(s,u.UploadFileType.GroupAvatar,t)}if(!e||0!==e.indexOf("P2P@"))return e}getColor(){return this._conversation?this._conversation.color():a.getDefaultColorInfo(this._conversationId)}_calcDisplayName(){if(!this._conversation)return;const e=this._conversation.topicName();if(e){const t=this._conversation.getThreadMembers(),s=o.compact(o.map(t,(e=>r.getSkypeIdFromMri(e.id))));s.push("...");const i=e.split(", ");return o.intersection(s,i).length===i.length?this._generateTitleName():r.unescapeTextWithoutXml(e)}return this._generateTitleName()}_generateTitleName(){if(!this._conversation)return;const e=this._conversation.getThreadMembers(),t=o.filter(e,(e=>!c.default.isMyMri(e.id)));let s;if(0!==t.length){s=o.map(t.length<=3?t:t.slice(0,2),(e=>h.getDisplayableProfile(e.id).getDisplayName())).join(", "),t.length>3&&(s+=", "+d.getString("DisplayInfoStore.ListOtherNames",{count:t.length-2}))}return 1===e.length&&(s=d.getString("Global.UntitledChat")),s}}t.default=p},214189:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaximumGroupConversationNameLength=t.ConversationHistoryTimeSpanImportant=void 0;const i=s(197582),o=i.__importDefault(s(150343)),n=i.__importDefault(s(296114)),r=i.__importDefault(s(370073));t.ConversationHistoryTimeSpanImportant=2592e6,t.MaximumGroupConversationNameLength=50;class a extends n.default{constructor(e,t,s,i){super(),e?(this.conv=r.default.fromDatabaseObject(e.conv),this.syncInfo=e.syncInfo,this.counts=e.counts,this._needsSync=e._needsSync,this._isHighlight=e._isHighlight,this._forceToRecents=e._forceToRecents):(this.conv=t,this.syncInfo=s,this.counts=i,this._needsSync=this.needsSyncMessages()||this.needsSyncThreadDetails()||this.conv.hasPendingLies()?1:0,this._isHighlight=this.conv.isHighlightsThread()?1:0,this._forceToRecents=i&&i.unreadCount>0||this.conv.isFavorite()?1:0)}isImmutable(){return!0}static fromDatabaseObject(e){return e?new a(e):void 0}static newFakeEmptyMeta(e,t=void 0){const s=this.newEmptySyncInfo(),i=r.default.newFakeEmptyConversation(e,t);return new a(void 0,i,s,void 0)}static newEmptySyncInfo(){return{messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}}static firstTimeMeta(e,t,s){return new a(void 0,e,t,s)}updateConversation(e){return e===this.conv?this:new a(void 0,e,this.syncInfo,this.counts)}updateSyncInfo(e){return e===this.syncInfo?this:new a(void 0,this.conv,e,this.counts)}updateConversationAndSyncInfo(e,t){return e===this.conv&&t===this.syncInfo?this:new a(void 0,e,t,this.counts)}updateCounts(e){return e===this.counts?this:new a(void 0,this.conv,this.syncInfo,e)}updateEverything(e,t,s){return e===this.conv&&t===this.syncInfo&&s===this.counts?this:new a(void 0,e,t,s)}needsSyncMessages(){return!this.conv.isBricked&&this.syncInfo.messagesStale&&this.conv.isCurrentUserMember()&&this.conv.isSyncEnabled(o.default.getS4LMessagingFeaturesNoSubscription().syncSettings)}needsSyncThreadDetails(){return!(this.conv.isBricked||!this.conv.isSyncEnabled(o.default.getS4LMessagingFeaturesNoSubscription().syncSettings)||this.conv.isReactionsThread()||!this.conv.isCurrentUserMember())&&(!!this.conv.needsForceSyncThreadDetails()||!this.conv.hasApplicableMembersData())}}t.default=a},462478:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},536748:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageViewItemInfo=t.MessageHintsTypes=void 0,function(e){e[e.DoubleTapMessageToLike=1]="DoubleTapMessageToLike",e[e.TapOnReactionToReactTheSame=2]="TapOnReactionToReactTheSame",e[e.HighlightToBingSearch=3]="HighlightToBingSearch",e[e.ContextMenuHint=4]="ContextMenuHint"}(s||(t.MessageHintsTypes=s={}));t.MessageViewItemInfo=class{constructor(e,t,s,i){this.key=e,this.skypeMessage=t,this.shouldItemFocusOnMobile=s,this.height=i,this.focusable=!0}}},848523:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SavedMessageType=void 0,t.convertSavedMessageInputToDbSkypeDraftsInput=function(e,t){const s=(0,a.decodeFromInput)(t.inputEntities,!1),i=o.head(t.messages),n=o.tail(t.messages);return{conversationId:e,inputEntitiesDataVersion:t.inputEntitiesDataVersion,type:t.type,timestamp:t.timestamp,message:i,restMessages:o.size(n)>0?n:void 0,inputEntities:s.encodeToString()}},t.convertDbSkypeDraftsInputToSavedMessageInput=function(e,t,s){const{conversationId:i,inputEntities:a,inputEntitiesDataVersion:c,type:u,timestamp:h}=e,p=u===d.None?void 0:o.compact(o.map([e.message,...e.restMessages||[]],l.default.fromDatabaseObject)),g=(0,n.toEntities)(r.decodeFromContent(a),{supportEmoticons:!0,supportHTML:t,supportHtmlAndroid:s});return{conversationId:i,messages:p,inputEntities:g,inputEntitiesDataVersion:c,type:u,timestamp:h||Date.now()}};const i=s(197582),o=i.__importStar(s(496486)),n=s(361971),r=i.__importStar(s(463519)),a=s(7040),l=i.__importDefault(s(997226));var d;!function(e){e[e.None=0]="None",e[e.Edited=1]="Edited",e[e.Quoted=2]="Quoted"}(d||(t.SavedMessageType=d={}))},370073:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadPropLiesAllowed=t.PropLieType=t.ConvPropLiesAllowed=t.MagicUnreadPinnedNumber=t.MagicFavoritesPinnedNumber=void 0;const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=s(657784),a=i.__importDefault(s(60433)),l=s(619429),d=i.__importStar(s(971988)),c=s(135356),u=i.__importStar(s(44717)),h=i.__importStar(s(473483)),p=i.__importDefault(s(296114)),g=s(815146),m=i.__importStar(s(85385)),S=i.__importDefault(s(114818)),_=i.__importDefault(s(363091)),f=i.__importDefault(s(997226)),y=i.__importDefault(s(655192)),v=s(331079),C=i.__importStar(s(442699)),T=s(593501),M="skypeid=";n.invert(u.ConversationProps),n.invert(u.ThreadProps);var b;t.MagicFavoritesPinnedNumber=31536e8,t.MagicUnreadPinnedNumber=15768e8,t.ConvPropLiesAllowed={[u.ConversationProps.Alerts]:!0,[u.ConversationProps.ConsumptionHorizon]:!0,[u.ConversationProps.Pinned]:!0,[u.ConversationProps.Subscription]:!0,[u.ConversationProps.ConversationStatus]:!0,[u.ConversationProps.ConversationBlocked]:!0,[u.ConversationProps.Color]:!0,[u.ConversationProps.Archived]:!0},function(e){e[e.Local=1]="Local",e[e.Global=2]="Global"}(b||(t.PropLieType=b={})),t.ThreadPropLiesAllowed={[u.ThreadProps.TopicName]:b.Global,[u.ThreadProps.Picture]:b.Global,[u.ThreadProps.JoinEnabled]:b.Global,[u.ThreadProps.MagicBotEnabled]:b.Global,[u.ThreadProps.LiveState]:b.Local,[u.ThreadProps.LastLeaveAt]:b.Local};const I=/identity="(.*?)"/g,w=/type="(.*?)"/g,P=[d.MessageTypes.HandshakeInvite,d.MessageTypes.HandshakeAccept,d.MessageTypes.HandshakeComplete];class k extends p.default{constructor(e,t=!1){super(),this.id=e.id,this.mriNamespace=u.getMriNamespace(this.id),this.convViewVersion=e.convViewVersion,this._convProps=e._convProps,this._memberProps=e._memberProps,this._convPropLieInfo=e._convPropLieInfo,this._consumptionHorizonPropVersion=e._consumptionHorizonPropVersion,this.memberConsumptionHorizonsSorted=e.memberConsumptionHorizonsSorted,this.threadDetailsVersion=e.threadDetailsVersion,this._threadProps=e._threadProps,this._threadPropLieInfo=e._threadPropLieInfo,this._threadMembers=e._threadMembers,this._forceSyncThreadDetails=e._forceSyncThreadDetails||!1,this.lastMessage=e.lastMessage?f.default.fromDatabaseObject(e.lastMessage):void 0,this.lastCallTime=e.lastCallTime,this.lastCallDirection=e.lastCallDirection,this.isFake=e.isFake,this.isBricked=this._isBricked(e),this._timestamp=e._timestamp||this._calcTimestamp(),this._searchTerms=(t?e._searchTerms:this._generateSearchTerms())||"",this._lastHandshakeChangeTime=e._lastHandshakeChangeTime}_isBricked(e){return!!u.isBrickedOneToOneThread(e.id)||!u.isOneOnOneConversation(e.id)&&e.isBricked}_generateSearchTerms(){const e=[];let t=this.topicName();t&&(t=u.unescapeTextWithoutXml(t),e.push(t));const s=this.getMemberMrisWithoutMe();return s&&e.push(...s),e.join(" ")}isImmutable(){return!0}static _mergeLastMessage(e,t){return e&&!n.isEmpty(e)?t?t.applyServerMessage(e):f.default.fromFirstServerMessage(e):t}static fromRawConversation(e,t){let s=k._mergeLastMessage(e.lastMessage,t);return s&&s.isMergingBotHighlightMessageLocal(e.id)&&(s=void 0),new k({id:e.id,convViewVersion:e.version,_convProps:e.properties,_memberProps:e.memberProperties,_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:e.threadProperties,_threadPropLieInfo:void 0,_threadMembers:void 0,lastMessage:s,lastCallTime:void 0,lastCallDirection:void 0,isFake:!1,isBricked:!1,_timestamp:void 0,_forceSyncThreadDetails:!1})}static fromRawThread(e){return new k({id:e.id,convViewVersion:0,_convProps:{},_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:e.version,_threadProps:this._removeInvalidThreadProps(e.properties),_threadPropLieInfo:void 0,_threadMembers:e.members,lastMessage:void 0,lastCallTime:void 0,lastCallDirection:void 0,isFake:!1,isBricked:!1,_forceSyncThreadDetails:!1})}static newFakeEmptyConversation(e,t=void 0){return new k({id:e,convViewVersion:0,_convProps:{},_convPropLieInfo:void 0,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:u.isThread(e)?{}:void 0,_threadPropLieInfo:void 0,lastMessage:void 0,_threadMembers:t?[{id:t,role:c.ThreadMemberRoles.User},{id:_.default.getSkypeMri(),role:c.ThreadMemberRoles.User}]:void 0,lastCallDirection:void 0,lastCallTime:void 0,isFake:!0,isBricked:!1,_forceSyncThreadDetails:!1})}static fromDatabaseObject(e){return e?new k(e,!0):void 0}mergeConversationUpdate(e,t){const s=k._mergeLastMessage(e.lastMessage,t);if(e.version<=this.convViewVersion)return m.log(g.LogTraceArea.SkypeConversationLocal,"Ignoring out of date conversation:, ",o.pii.Mri(this.id),"New version:",e.version,"<=",this.convViewVersion,"lastMessage version:",this.lastMessage?this.lastMessage.getLatestServerMessageVersion():"n/a","new lastMessage version:",s?s.getLatestServerMessageVersion():"n/a"),this;let i,r=!1;if(e.threadProperties){if(i=n.cloneDeep(this._threadProps)||{},void 0!==e.threadProperties[u.ThreadProps.TopicName]){const t=(Boolean(this._threadProps)&&this.getThreadProperty(u.ThreadProps.TopicName)||"").toString().length;let s=!0;e.threadProperties[u.ThreadProps.TopicName].toString().length>=60&&(t<60?r=!0:s=!1),s&&(i[u.ThreadProps.TopicName]=e.threadProperties[u.ThreadProps.TopicName])}n.each(u.getThreadPropsInConversationView(),(t=>{e.threadProperties[t]?i[t]=e.threadProperties[t]:delete i[t]}))}let a,l=e.properties;this._consumptionHorizonPropVersion&&this._consumptionHorizonPropVersion>e.version&&(a=this._consumptionHorizonPropVersion,l=n.cloneDeep(l),l[u.ConversationProps.ConsumptionHorizon]=this._convProps[u.ConversationProps.ConsumptionHorizon]);const[d,c,h]=this._calcNewServerMessageInfo(this.lastCallTime,this.lastCallDirection,s,!1);return new k({id:this.id,convViewVersion:e.version,_convProps:l,_convPropLieInfo:this._convPropLieInfo,_memberProps:e.memberProperties,_consumptionHorizonPropVersion:a,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:i,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:d,lastCallTime:c,lastCallDirection:h,isFake:!1,isBricked:!1,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:r})}mergeThreadUpdate(e){if(this._forceSyncThreadDetails)m.log(g.LogTraceArea.SkypeConversationLocal,"Force syncing thread update: "+o.pii.Mri(this.id)+"New version: "+e.version+", old version: "+this.threadDetailsVersion);else if(this.threadDetailsVersion&&e.version<=this.threadDetailsVersion)return m.log(g.LogTraceArea.SkypeConversationLocal,"Ignoring out of date thread: ",o.pii.Mri(this.id),"New version:",e.version,"<=",this.threadDetailsVersion),this;const t=k._removeInvalidThreadProps(e.properties);if(this._threadProps&&(this._threadProps[u.ThreadProps.LastJoinAt]&&(t[u.ThreadProps.LastJoinAt]=this._threadProps[u.ThreadProps.LastJoinAt]),this._threadProps[u.ThreadProps.LastLeaveAt]&&(t[u.ThreadProps.LastLeaveAt]=this._threadProps[u.ThreadProps.LastLeaveAt])),void 0===t[u.ThreadProps.TopicName]&&(t[u.ThreadProps.TopicName]=""),this._threadProps&&(this._threadProps[u.ThreadProps.ThreadDetailsVersion]||Number(this._threadProps[u.ThreadProps.ThreadDetailsVersion])<e.version)&&(t[u.ThreadProps.ThreadDetailsVersion]=e.version.toString()),this.isEncryptedThread()){const e=this.getEncryptionHandshake(),s=this._parseSecureHandshake(t[u.ThreadProps.SecureHandshake]);if(e&&s){const i=u.ThreadProps.SecureDeviceSwitch;"None"!==e.HandshakeState&&(this._threadProps&&this._threadProps[i]?t[i]=!0:t[i]=e.InviteId!==s.InviteId);const o=u.ThreadProps.SecureHandshakeOnceEstablished;this._threadProps&&!n.isUndefined(this._threadProps[o])?t[o]=this._threadProps[o]:"Completed"===s.HandshakeState&&(t[o]=!0)}}return new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_memberProps:this._memberProps,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:e.version,_threadProps:t,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:u.filterMembersProp(e.members),lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:!1,isBricked:!1,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:!1})}mergeMessageLocal(e,t){const[s,i,o,n,r]=this._calcNewServerMessageInfo(this.lastCallTime,this.lastCallDirection,e,t);return r?new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_memberProps:this._memberProps,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:s,lastCallTime:i,lastCallDirection:o,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:n,_forceSyncThreadDetails:this._forceSyncThreadDetails}):this}mergeConsumptionHorizonPush(e,t){if(t&&(t<this.convViewVersion||this._consumptionHorizonPropVersion&&t<this._consumptionHorizonPropVersion))return this;const s=n.cloneDeep(this._convProps);s[u.ConversationProps.ConsumptionHorizon]=e;const i=u.getServerTimestampFromConsumptionHorizon(e),r=this.getConsumptionHorizonTimestamp();return r>i&&m.log(g.LogTraceArea.SkypeConversationLocal,"Remote consumption horizon is older then local: ",o.pii.Mri(this.id)," remove:",i," local:",r),new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:s,_convPropLieInfo:this._convPropLieInfo,_memberProps:this._memberProps,_consumptionHorizonPropVersion:t,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}mergeMemberConsumptionHorizons(e){let t=!1;const s=n.keyBy(this.memberConsumptionHorizonsSorted||[],(e=>e.id));if(n.each(e,(e=>{const i=u.getServerTimestampFromConsumptionHorizon(e.consumptionhorizon),n=u.getConsumptionHorizonUpdateTime(e.consumptionhorizon);(!s[e.id]||s[e.id].consumptionHorizon<i)&&(t=!0,s[e.id]={id:e.id,consumptionHorizon:i,consumptionHorizonUpdateTime:n}),m.log(g.LogTraceArea.SkypeConversationLocal,"Merging member consumption horizons: ",o.pii.Mri(this.id)," id:",o.pii.Mri(e.id)," consumptionHorizon:",i," updated:",n," wasUpdated:",t)})),!t)return this;const i=n.sortBy(n.values(s),(e=>e.consumptionHorizon));return new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,_memberProps:this._memberProps,memberConsumptionHorizonsSorted:i,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}dropLastMessage(){return new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:this._convPropLieInfo,_memberProps:this._memberProps,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:this._threadProps,_threadPropLieInfo:this._threadPropLieInfo,_threadMembers:this._threadMembers,lastMessage:void 0,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}_setNewPropInfo(e,t,s,i){return new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:e,_convPropLieInfo:t,_consumptionHorizonPropVersion:this._consumptionHorizonPropVersion,_memberProps:this._memberProps,memberConsumptionHorizonsSorted:this.memberConsumptionHorizonsSorted,threadDetailsVersion:this.threadDetailsVersion,_threadProps:s,_threadPropLieInfo:i,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:this.isBricked,_lastHandshakeChangeTime:this._lastHandshakeChangeTime,_forceSyncThreadDetails:this._forceSyncThreadDetails})}setConvPropertyLie(e,t,s){if(this._convProps[e]===t&&(!this._convPropLieInfo||!(e in this._convPropLieInfo)||this._convPropLieInfo[e].value===t&&(0,S.default)(this._convPropLieInfo[e].additionalParams,s)))return this;const i=this.getConversationProperty(e);if(e===u.ConversationProps.ConsumptionHorizon&&s&&"false"===s.bookmark&&!u.isConsumptionHorizonNewer(i,t))return this;const o=n.cloneDeep(this._convPropLieInfo)||{};return o[e]={value:t,additionalParams:s},this._setNewPropInfo(this._convProps,o,this._threadProps,this._threadPropLieInfo)}revertConvPropertyLie(e,t,s){if(!this._convPropLieInfo||!this._convPropLieInfo[e]||this._convPropLieInfo[e].value!==t||!(0,S.default)(this._convPropLieInfo[e].additionalParams,s))return this;let i=n.cloneDeep(this._convPropLieInfo)||{};return delete i[e],n.isEmpty(i)&&(i=void 0),this._setNewPropInfo(this._convProps,i,this._threadProps,this._threadPropLieInfo)}confirmConvPropertyLieApplied(e,t,s){if(!this._convPropLieInfo||!this._convPropLieInfo[e]||this._convPropLieInfo[e].value!==t||!(0,S.default)(this._convPropLieInfo[e].additionalParams,s))return this;const i=this.getConversationProperty(e);let o=n.cloneDeep(this._convPropLieInfo)||{};delete o[e],n.isEmpty(o)&&(o=void 0);const r=n.cloneDeep(this._convProps);return r[e]=i,this._setNewPropInfo(r,o,this._threadProps,this._threadPropLieInfo)}setThreadPropertyLie(e,t){if(this._threadProps,!(this._threadProps[e]!==t||this._threadPropLieInfo&&e in this._threadPropLieInfo&&this._threadPropLieInfo[e].value!==t))return this;const s=n.cloneDeep(this._threadPropLieInfo)||{};return s[e]={value:t},this._setNewPropInfo(this._convProps,this._convPropLieInfo,this._threadProps,s)}revertThreadPropertyLie(e,t){if(!this._threadPropLieInfo||!this._threadPropLieInfo[e]||this._threadPropLieInfo[e].value!==t)return this;let s=n.cloneDeep(this._threadPropLieInfo)||{};return delete s[e],n.isEmpty(s)&&(s=void 0),this._setNewPropInfo(this._convProps,this._convPropLieInfo,this._threadProps,s)}confirmThreadPropertyLieApplied(e,t){if(!this._threadPropLieInfo||!this._threadPropLieInfo[e]||this._threadPropLieInfo[e].value!==t)return this;let s=n.cloneDeep(this._threadPropLieInfo)||{};delete s[e],n.isEmpty(s)&&(s=void 0);const i=n.cloneDeep(this._threadProps);return i[e]=t,this._setNewPropInfo(this._convProps,this._convPropLieInfo,i,s)}brickConversation(){const e=n.cloneDeep(this._threadProps);return e&&(e[u.ThreadProps.ThreadDetailsVersion]="0"),new k({id:this.id,convViewVersion:this.convViewVersion,_convProps:this._convProps,_convPropLieInfo:void 0,_memberProps:this._memberProps,_consumptionHorizonPropVersion:void 0,memberConsumptionHorizonsSorted:void 0,threadDetailsVersion:0,_threadProps:e,_threadPropLieInfo:void 0,_threadMembers:this._threadMembers,lastMessage:this.lastMessage,lastCallTime:this.lastCallTime,lastCallDirection:this.lastCallDirection,isFake:this.isFake,isBricked:!0,_forceSyncThreadDetails:!1})}_calcNewServerMessageInfo(e,t,s,i){if(!s||(0,T.isMagicBotOneOnOneControlMessage)(s)||s&&s.isMergingBotHighlightMessageLocal(this.id))return[this.lastMessage,e,t,this._lastHandshakeChangeTime,!1];if(!s)return[this.lastMessage,e,t,this._lastHandshakeChangeTime,!1];let o,r=!1,a=this.lastMessage,l=e,c=t,h=this._lastHandshakeChangeTime;if(this.lastMessage){const e=this.lastMessage.getLatestServerMessageVersion();o=e?Number(e):0}else o=0;const p=s.getLatestServerMessageVersion(),S=p?Number(p):0;let _=!1;if(_=s.isDeletedMessage()||s.isReported()?!!this.lastMessage&&this.lastMessage.cuid===s.cuid:!this.lastMessage||s.createdTime>this.lastMessage.createdTime||S>=o&&(s.createdTime===this.lastMessage.createdTime||this.lastMessage.cuid===s.cuid)||i&&(this.lastMessage.isDeletedMessage()||this.lastMessage.isUnreconciledEdit()||this.lastMessage.isCanceledScheduledCall()||this.lastMessage.isReported()||this.lastMessage.isHiddenTranslationSettingsMessage()||this.lastMessage.isHiddenInPreviewTranslation(this.isTranslated())||u.isConciergeBotMri(this.lastMessage.creator)&&!this.lastMessage.isAllowedEngagementBotMessage()),_&&(a=s,r=!0,m.log(g.LogTraceArea.SkypeConversationLocal,`Updated last message to cuid: ${s.cuid} createdTime ${s.createdTime}`)),s.messagetype===d.MessageTypes.Call){const t=e;l=e?Math.max(e,s.createdTime):s.createdTime,c=k._getCallType(s.content),l!==t&&(r=!0)}return n.includes(P,s.messagetype)&&(h=n.max([h,s.createdTime]),r=r||h!==this._lastHandshakeChangeTime),[a,l,c,h,r]}static _getCallType(e){const t=I.exec(e);if(t&&t.length>0&&_.default.getSkypeId()===t[1])return v.CallDirectionType.Outgoing;{const t=w.exec(e);return t&&t.length>0&&t[1]===r.CallCardType.Missed?v.CallDirectionType.Missed:v.CallDirectionType.Incoming}}static _removeInvalidThreadProps(e){const t=n.cloneDeep(e);return delete t[u.ThreadProps.LastJoinAt],delete t[u.ThreadProps.LastLeaveAt],t}isCurrentUserMember(){return!this.isBricked&&(!this.isThread()||(this._threadMembers&&this.threadDetailsVersion&&this.threadDetailsVersion>=this.convViewVersion?n.some(this._threadMembers,(e=>_.default.isMyMri(e.id))):!(this._threadProps&&this._threadProps[u.ThreadProps.LastLeaveAt]&&(!this._threadProps[u.ThreadProps.LastJoinAt]||Number(this._threadProps[u.ThreadProps.LastJoinAt])<Number(this._threadProps[u.ThreadProps.LastLeaveAt])))))}isDeleted(){const e=this.getDeletedTimestamp(),t=this.getSecureHandshakeTimestamp();return!(e<=0)&&(!this._timestamp||e>=this._timestamp&&e>=t)}getDeletedTimestamp(){const e=this.getConversationProperty(u.ConversationProps.DeleteTimestamp);return e?Number(e):0}getSecureHandshakeTimestamp(){const e=this.isEncryptedThread()?this.getEncryptionHandshake():void 0;return e?Date.parse(e.LastUpdateTs):0}isUserMember(e){return this.isThread()?n.includes(this.getMemberMris(),e):this.id===e||!!_.default.isMyMri(e)}hasAgentMember(){return this.isThread()?n.some(this.getThreadMembers(),(e=>u.isAgent(e.id))):u.isAgent(this.id)}isThread(){return this.mriNamespace===u.Namespaces.Thread}isOneOnOne(){return this._isOneOnOneNonReentrantCheck()||this.isLogicalOneOnOneSmsConversation()||this.isV2OneToOneThread()}isOneToOneThread(){return u.isOneToOneThread(this.id)}isOneToOneUserConvWithThreadIdSupport(){return u.isOneToOneThreadUserMriNamespace(this.id)}_isOneOnOneNonReentrantCheck(){return u.isMriNamespaceUser(this.mriNamespace)||this.mriNamespace===u.Namespaces.OneToOneTextMessage||u.isOneToOneThread(this.id)||u.isEncryptedThread(this.id)}isV2OneToOneThread(){return u.isV2Thread(this.id)&&this.isSticky()}getOneOnOneThreadId(){if(u.isV2Thread(this.id))return this.isSticky()?this.id:void 0;if(u.isOneToOneThreadUserMriNamespace(this.id)){const e=this._convProps[u.ConversationProps.OneToOneThreadId];return e?u.Namespaces.Thread+":"+e:(m.track(new C.DevDebug("buildOneOnOneThreadId",this.id)),u.buildOneOnOneThreadId(this.id))}}getTrackableConversationId(){return this.isOneOnOne()?this.getOneOnOneThreadId():this.id}getOtherPartyMri(){if(u.isMriNamespaceUser(this.mriNamespace)||this.mriNamespace===u.Namespaces.OneToOneTextMessage)return this.id;let e=this.getThreadMembers().find((e=>!_.default.isMyMri(e.id)&&u.isSkypeIdMri(e.id)));return e||(e=this.getThreadMembers().find((e=>!_.default.isMyMri(e.id)&&u.isOneToOneThreadUserMriNamespace(e.id)))),e?e.id:void 0}getOtherPartyMriForOneToOneThread(){const e=n.find(this.getThreadMembers(),(e=>!_.default.isMyMri(e.id)));return e?e.id:void 0}getOtherPartyMriOrConvId(){return(this.isOneOnOne()?this.getOtherPartyMri():void 0)||this.id}isHighlightsThread(){return u.isHighlightsThread(this.id)}isBotHighlightsThread(){return u.isBotHighlightsThread(this.id)}isReactionsThread(){return!!this.isThread()&&!(this.getThreadProperty(u.ThreadProps.ThreadType)!==u.ThreadTypes.Reactions&&!u.isReactionsThread(this.id))}isBookmarksThread(){return u.isBookmarkConversation(this.id)}isMyBotThread(){return u.isMyBotConversation(this.id)}isEncryptedThread(){return u.isEncryptedThread(this.id)}isSkypeSMSConversation(){return u.isPhoneMri(this.id)}isLogicalOneOnOneSmsConversation(){return u.isPhoneMri(this.id)}isSyncEnabled(e){return!this.isHighlightsThread()&&(!(e&&e.skipCastSync&&this.isReactionsThread())&&!(e&&e.skipSmsMmsSync&&u.isSmsMmsThread(this.id)))}hasSpecificAgentMember(e){return!!e&&n.includes(this.getMemberMrisWithoutMe(),e)}getLastJoinAt(){if(this._threadProps)return Number(this._threadProps[u.ThreadProps.LastJoinAt])}topicName(){if(this.isThread())return this.getThreadProperty(u.ThreadProps.TopicName)}getSuggestedActions(e,t){return t?this._getSuggestedActionsV2(e):this._getSuggestedActionsV1()}_getSuggestedActionsV1(){const e=y.default.parseJsonErrorToUndefined(this._convProps[u.ConversationProps.SuggestedActions]);return e&&e.messageId?{messageId:e.messageId.toString(),to:e.to,actions:n.map(e.actions,(e=>({title:e.title,value:e.value,type:e.type,image:e.image,pageTitle:e.displayText,attributes:e.channelData?e.channelData.telemetryData:void 0})))}:void 0}_getSuggestedActionsV2(e){}getSuggestedMessageActivity(e){}creator(){if(!this._threadProps||!this._threadProps[u.ThreadProps.Creator]){if(this.isBotHighlightsThread()){const e=u.getSkypeIdFromHighlightsThreadMri(this.id);return e?u.asMri(e):void 0}if(this.isHighlightsThread()){const e=u.getSkypeIdFromHighlightsThreadMri(this.id);return e?u.idAndNamespaceToMri(e,u.Namespaces.SkypeId):void 0}return this.isOneOnOne()&&!this.isThread()?this.id:void 0}const e=this._threadProps[u.ThreadProps.Creator],t=e.split(";");if(1===t.length)return e;let s;for(let e=t.length-1;e>=0;e--){const i=t[e];if(0===i.indexOf(M))return u.skypeIdToMri(i.substring(8));!s&&u.isMri(i)&&(s=i)}return s}createdDate(){return this._threadProps&&this._threadProps[u.ThreadProps.CreatedAt]?parseInt(this._threadProps[u.ThreadProps.CreatedAt],10):void 0}color(){return this._convProps&&this._convProps[u.ConversationProps.Color]?h.deserializeColorInfo(this._convProps[u.ConversationProps.Color]):h.getDefaultColorInfo(this.id)}getConnector(e){this._threadProps;const t=n.find(n.keys(this._threadProps),(t=>t===u.stripMriNamespace(e)));return t?y.default.parseJsonErrorToUndefined(this._threadProps[t]):void 0}getWebhookUrl(e){this._threadProps;const t=n.filter(n.keys(this._threadProps),(e=>n.startsWith(e,u.ConnectorThreadPropPrefix))),s=n.find(t,(t=>{if(!t)return!1;const s=y.default.parseJsonErrorToUndefined(this._threadProps[t]);return s?e===s.displayName:(m.log(g.LogTraceArea.SkypeConversationLocal,"Parsing failed for key: "+t+", value: "+this._threadProps[t]),!1)}));if(!s)return void m.log(g.LogTraceArea.SkypeConversationLocal,"No matching thread prop found for "+o.pii.Omit(e));const i=y.default.parseJsonErrorToUndefined(this._threadProps[s]);return i&&i.incomingUrl}getConnectorMris(){return n.compact(n.map(n.keys(this._threadProps),(e=>{if(n.startsWith(e,u.ConnectorThreadPropPrefix))return u.sanitizeMri(e,u.Namespaces.Bot)})))}getTimestamp(){return this._timestamp}getSortRank(){return this._timestamp+(this.isFavorite()?t.MagicFavoritesPinnedNumber:0)}_calcTimestamp(){const e=[0];return this.lastMessage&&e.push(this.lastMessage.createdTime),this._threadProps&&(this._threadProps[u.ThreadProps.CreatedAt]&&e.push(this._threadProps[u.ThreadProps.CreatedAt]),this._threadProps[u.ThreadProps.LastJoinAt]&&e.push(this._threadProps[u.ThreadProps.LastJoinAt]),this._threadProps[u.ThreadProps.LastLeaveAt]&&e.push(this._threadProps[u.ThreadProps.LastLeaveAt])),Math.max.apply(Math,e)}hasPendingLies(){return!!this._convPropLieInfo||!!this._threadPropLieInfo}getPendingConvPropLies(){return this._convPropLieInfo}getPendingThreadPropLies(){return this._threadPropLieInfo}isUserAlertsEnabled(){const e=this.getConversationProperty(u.ConversationProps.Alerts);return!e||"true"===e.toLowerCase()}isArchived(){return!!this.getConversationProperty(u.ConversationProps.Archived)}canDisplayArchived(){const e=this.getConversationProperty(u.ConversationProps.Archived);return!e||e<this._timestamp}isMuted(){return this.getSubscription()===u.SubscriptionTypes.Muted}isLoud(){return this.getSubscription()===u.SubscriptionTypes.Loud}isFavorite(){const e="true"===(this.getConversationProperty(u.ConversationProps.Pinned)||"").toLowerCase(),t="true"===(this.getConversationProperty(u.ConversationProps.Favorite)||"").toLowerCase();return e||t}isTranslated(){return this.getTranslationState()===l.TranslationState.Enabled}isTranslationDisabled(){return!n.includes([l.TranslationState.Enabled,l.TranslationState.Requested,l.TranslationState.Pending],this.getTranslationState())}getTranslationState(){if(this._convProps[u.ConversationProps.Translated]){const e=this.getConversationProperty(u.ConversationProps.Translated),t=parseInt(l.TranslationState[e],10);return t||l.TranslationState.Disabled}return l.TranslationState.Disabled}getMessageTranslationLocale(){return this.isThread()?this.getThreadProperty(u.ThreadProps.MessageTranslationLocale):this.getConversationProperty(u.ConversationProps.MessageTranslationLocale)}isJoinEnabled(){return this.isThread()&&"true"===(this.getThreadProperty(u.ThreadProps.JoinEnabled)||"").toLowerCase()}isMagicBotEnabled(){return"true"===(this.getThreadProperty(u.ThreadProps.MagicBotEnabled)||"").toLowerCase()}isModerated(){return this.isThread()&&"true"===(this.getThreadProperty(u.ThreadProps.ModeratedThread)||"").toLowerCase()}isSticky(){return this.isThread()&&"true"===(this.getThreadProperty(u.ThreadProps.IsSticky)||"").toLowerCase()}getBannedSkypeIds(){const e=this.isThread()&&this.getThreadProperty(u.ThreadProps.BannedUserList)||"";if(e){const t=n.map(e.split(","),(e=>u.getSkypeIdFromMri(u.asMri(e))));return n.compact(t)}return[]}isHistoryDisclosed(){return this.isThread()&&"true"===(this.getThreadProperty(u.ThreadProps.HistoryDisclosed)||"").toLowerCase()}isGuestJoinDisabled(){return this.isThread()&&"true"===(this.getThreadProperty(u.ThreadProps.DisableAnonymousJoin)||"").toLowerCase()}getSubscription(){if(!this.isUserAlertsEnabled())return u.SubscriptionTypes.Muted;const e=this.getConversationProperty(u.ConversationProps.Subscription);return e===u.SubscriptionTypes.Muted?u.SubscriptionTypes.Loud:e||u.SubscriptionTypes.Loud}hasActiveCall(){return this.isThread()&&a.default.isLiveStateValid(this.liveState())}hasGoLive(){const e=this.validLiveState();return!!e&&a.default.isLiveStateForGoLive(e)}validLiveState(){const e=this.liveState();return a.default.isLiveStateValid(e)?e:void 0}liveState(){if(!this.isThread())return;const e=this.getThreadProperty(u.ThreadProps.LiveState);if(!e)return;const t=y.default.parseJsonErrorToUndefined(e);return t&&t.groupCallInitiator?(t.groupCallInitiator=u.sanitizeMri(t.groupCallInitiator,u.Namespaces.SkypeId),t):void 0}getConsumptionHorizon(){const e=this.getConversationProperty(u.ConversationProps.ConsumptionHorizon);if(e)return e;if(this.isThread()&&!this.isHighlightsThread()){const e=this.getLastJoinAt()||0;return e+";"+e+";0"}return"0;0;0"}getConsumptionHorizonTimestamp(){return u.getServerTimestampFromConsumptionHorizon(this.getConsumptionHorizon())}getConversationProperty(e){if(this._convPropLieInfo&&e in this._convPropLieInfo){const t=this._convPropLieInfo[e];if(e===u.ConversationProps.ConsumptionHorizon&&t.additionalParams&&"false"===t.additionalParams.bookmark&&!u.isConsumptionHorizonNewer(this._convProps[e],this._convPropLieInfo[e].value))return this._convProps[e];const s=this._convPropLieInfo[e].value;return null===s?void 0:s}return u.getProperty(e,this._convProps,u.ConversationPropsMapping,this.id)}getConversationPropertyLie(e){if(this._convPropLieInfo&&e in this._convPropLieInfo){const t=this._convPropLieInfo[e];return e===u.ConversationProps.ConsumptionHorizon&&t.additionalParams&&"false"===t.additionalParams.bookmark&&!u.isConsumptionHorizonNewer(this._convProps[e],this._convPropLieInfo[e].value)?this._convProps[e]:this._convPropLieInfo[e].value||void 0}}getThreadProperty(e,t=!0){if(this._threadProps,t&&this._threadPropLieInfo&&e in this._threadPropLieInfo){const t=this._threadPropLieInfo[e].value;return null===t?void 0:t}return u.getProperty(e,this._threadProps,u.ThreadPropsMapping,this.id)}areThreadDetailsStale(){if(!this._threadProps)return!1;if(this.isFake&&this._isOneOnOneNonReentrantCheck())return!1;if(this._forceSyncThreadDetails)return!0;const e=Number(this._threadProps[u.ThreadProps.ThreadDetailsVersion]);return!e||this.threadDetailsVersion<e}isAdmin(e){return n.some(this.getThreadMembers(),(t=>t.id===e&&t.role===c.ThreadMemberRoles.Admin))}getThreadMembers(){if(!this.isThread())return[];if(this.areThreadDetailsStale()&&this.convViewVersion>this.threadDetailsVersion){const e=this._threadProps[u.ThreadProps.ConvView_MemberListString];if(e&&n.isString(e)){const t=y.default.parseJsonErrorToUndefined(e);if(t)return n.compact(n.map(t,(e=>e?n.isString(e)?{id:e,role:c.ThreadMemberRoles.User}:{id:e.MemberMri,role:1===e.MemberRole?c.ThreadMemberRoles.Admin:c.ThreadMemberRoles.User}:void 0)))}}return this._threadMembers||[]}getMemberMris(){return this.isThread()?n.map(this.getThreadMembers(),(e=>e.id)):[this.id,_.default.getSkypeMri()]}getMemberMrisWithoutMe(){return u.getMemberMrisWithoutMe(this.getMemberMris())}getMemberCount(){return this.isThread()?this.areThreadDetailsStale()&&u.ThreadProps.ConvView_MemberCount in this._threadProps?Number(this._threadProps[u.ThreadProps.ConvView_MemberCount]):this.getThreadMembers().length:this._convProps[u.ConversationProps.Participants]?this._convProps[u.ConversationProps.Participants].split(",").length:2}getConversationStatus(e=!1){var t,s,i,o,n;if(this.isV2OneToOneThread()&&this._memberProps){const r=!!(null===(t=this._memberProps.relationshipState)||void 0===t?void 0:t.blockTime),a=null!==(i=null===(s=this._memberProps.relationshipState)||void 0===s?void 0:s.inQuarantine)&&void 0!==i&&i,l=null!==(n=null===(o=this._memberProps.relationshipState)||void 0===o?void 0:o.quarantineCounter)&&void 0!==n?n:0,d=!a&&l>0,c=!a&&!r&&!l&&e;return a?g.ConversationStatus.AcceptPendingRecipient:d?g.ConversationStatus.AcceptPendingSender:c?g.ConversationStatus.Accepted:void 0}const r=this._convProps[u.ConversationProps.ConversationStatus];if(r){const e=r;return parseInt(g.ConversationStatus[e],10)}}getConversationBlocked(){var e;return this.isV2OneToOneThread()&&this._memberProps?!!(null===(e=this._memberProps.relationshipState)||void 0===e?void 0:e.blockTime):this._convProps[u.ConversationProps.ConversationBlocked]?"true"===this._convProps[u.ConversationProps.ConversationBlocked].toLowerCase():void 0}getAddedBy(){if(this._convProps[u.ConversationProps.ConversationStatusProperties]){const e=this._convProps[u.ConversationProps.ConversationStatusProperties],t=y.default.parseJsonErrorToUndefined(e);return t&&t.AddedBy}}getAcceptPendingMessageCount(){var e;if(this.isV2OneToOneThread()&&this._memberProps)return null===(e=this._memberProps.relationshipState)||void 0===e?void 0:e.quarantineCounter;if(this._convProps[u.ConversationProps.ConversationStatusProperties]){const e=this._convProps[u.ConversationProps.ConversationStatusProperties],t=y.default.parseJsonErrorToUndefined(e);return t&&t.AcceptPendingMessageCount}}getEncryptionHandshake(){const e=this.getThreadProperty(u.ThreadProps.SecureHandshake);return this._parseSecureHandshake(e)}getLastEncryptionHandshakeChange(){return this._lastHandshakeChangeTime}isSwitchingSecureDevice(){return!!this.getThreadProperty(u.ThreadProps.SecureDeviceSwitch)}_parseSecureHandshake(e){if(!e)return;const t=y.default.parseJsonErrorToUndefined(e);if(!t)return void m.error(g.LogTraceArea.SkypeConversationLocal,`Failed to parse handshake info of secure thread ${o.pii.Mri(this.id)}`);const s=y.default.parseJsonErrorToUndefined(t.APartyKeyBundle),i=y.default.parseJsonErrorToUndefined(t.BPartyKeyBundle);return Object.assign(Object.assign({},t),{APartyPreKeyBundle:s,BPartyPreKeyBundle:i})}hasApplicableMembersData(){if(this.isBricked)return!1;if(!this.isCurrentUserMember())return!0;if(!this.isThread())return!0;if(u.ThreadProps.ConvView_MemberListString in this._threadProps)return!0;if(u.ThreadProps.ConvView_MemberCount in this._threadProps){if(Number(this._threadProps[u.ThreadProps.ConvView_MemberCount])>12)return!0}return!this.areThreadDetailsStale()}needsForceSyncThreadDetails(){return this._forceSyncThreadDetails}isGroupConversation(){return this.isThread()&&u.isGroupConversation(this.id)}getSource(){if(this.isThread())return this.getThreadProperty(u.ThreadProps.Source)}isLegacyMeetNowThread(){return this.isThread()&&this.getThreadProperty(u.ThreadProps.ThreadType)===u.ThreadTypes.LegacyMeetNow}}t.default=k},902940:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fromClipboardObject=function(e){return i.default.fromFirstAcknowledgedLie({id:e.id,composetime:e.composetime,content:e.content,contenttype:e.contenttype,messagetype:e.messagetype},e.conversationId,e.creactor,e.createdTime)},t.toClipboardObject=function(e){return{id:e.getLatestServerMessageId()||"",content:e.content,composetime:new Date(e.composeTime).toDateString(),contenttype:e.contenttype,messagetype:e.messagetype,conversationId:e.conversationId,creactor:e.creator,createdTime:e.createdTime}};const i=s(197582).__importDefault(s(997226))},997226:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217003),r=i.__importDefault(s(150343)),a=s(619429),l=s(284841),d=i.__importStar(s(971988)),c=i.__importStar(s(44717)),u=i.__importDefault(s(453221)),h=s(815146),p=i.__importStar(s(85385)),g=i.__importDefault(s(114818)),m=i.__importDefault(s(363091)),S=s(384860),_=s(331079),f=i.__importDefault(s(760989)),y=s(796967),v=i.__importDefault(s(808164)),C=/\u2028|\u2029/g,T=(0,n.createRegExp)(n.Patterns.MATCH_IGNORABLE_SYMBOLS,"g"),M=/identity="(.*?)"/g,b=/(?:<|&lt;)quote((?:\s+[^=]+="[^"]+")+)\s*(?:>|&gt;)([^]*?)(?:<|&lt;)\/quote(?:>|&gt;)/gi,I=/([^\s=]+)="([^"]+)"/gi;class w extends u.default{constructor(e,t,s,i,n,r,a,l=!1,u,g,S,_,f,y=!1){var v,M,b;if(super(e),e){if(this.createdTime>=7e15&&(this.createdTime=Date.now()),this._isSendRejected){const e=o.findLast(this._unacknowledgedLies,(e=>!o.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid))));this._sendRejectedCMID=e?e.clientmessageid:void 0}}else if(t||s||i){if(t){this._serverMessages=o.orderBy(t,[e=>e.version||e.id,e=>e.content?e.content.length:0,e=>e.properties?1:0]);{const e=this._serverMessages[0];for(let t=1;t<this._serverMessages.length;){const s=this._serverMessages[t-1],i=this._serverMessages[t];s.version===i.version?(this._serverMessages.splice(t-1,1),p.log(h.LogTraceArea.MessageStream,"Message "+s.id+" removed as not important")):!i.skypeeditedid&&i.id>e.id&&i.content!==e.content?(this._serverMessages.splice(t,1),p.log(h.LogTraceArea.MessageStream,"Message "+i.id+" removed as a fraud")):t++}}const e=o.find(this._serverMessages,(e=>!e.skypeeditedid))||o.head(this._serverMessages);if(e){this.cuid=c.getCuidForMessage(e);const t=c.getParsedConversationId(e);this.conversationId=t||r,this.createdTime=Number(e.id),this.creator=c.getCreatorMriForMessageFromLink(e.from);const s=Date.parse(e.composetime);this.composeTime=s||this.createdTime,e.messagetype!==d.MessageTypes.Call&&this._isOriginalConfirmedServerMessage(e)&&(this._serverMessages=o.filter(this._serverMessages,(e=>c.getCreatorMriForMessageFromLink(e.from)===this.creator)))}}else{const e=o.head(i)||o.head(s);if(e&&(this.cuid=c.getCuidForMessage(e)),this.conversationId=r,this.createdTime=S,e&&e===o.head(i)&&e.id&&(this.createdTime=Number(e.id)),e){const t=Date.parse(e.composetime);this.composeTime=t||this.createdTime}this.creator=a}let e,I;o.isEmpty(s)&&o.isEmpty(i)||(this._acknowledgedLies=o.filter(i,(e=>!o.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid||t.version>=e.version)))),this._unacknowledgedLies=o.filter(s,(e=>!(o.some(this._serverMessages,(t=>t.clientmessageid===e.clientmessageid))||e.cancel&&o.some(this._serverMessages,(t=>t.clientmessageid===e.skypeeditedid))))));let w=!1;{const t=(e,t)=>o.maxBy([e,t],(e=>e?new Date(e.composetime).getTime():0)),s=e=>o.findLast(e,(e=>!d.isDeletedMessage(e)));e=t(s(this._acknowledgedLies),s(this._unacknowledgedLies)),I=t(o.last(this._acknowledgedLies),o.last(this._unacknowledgedLies)),u&&I&&I.clientmessageid===u&&d.isDeletedMessage(I)&&(w=!0)}const P=o.findLast(this._serverMessages,(e=>this._isContentEdited(e))),k=this.getOriginalServerMessage(),A=(w?e:I)||P||k||I;(A.clientmessageid===u||w&&I&&I.clientmessageid===u)&&(this._sendRejectedCMID=u,this._sendRetryInfo=g),this.content=(A.content||"").replace(T,"").replace(C,"\n"),this.messagetype=A.messagetype,this.contenttype=A.contenttype,A.skypeemoteoffset&&(this.skypeemoteoffset=Number(A.skypeemoteoffset)),A.skypeeditoffset&&(this.skypeeditoffset=Number(A.skypeeditoffset)),A.skypeguid&&(this.skypeguid=A.skypeguid),A.amsreferences&&(this.amsreferences=o.clone(A.amsreferences));const x=P||k;x&&x.fromline&&(this.fromline=x.fromline);const D=this._serverMessages&&this._serverMessages.length?this._getServerMessageForProperties():(w?e:void 0)||I;let R=D?o.cloneDeep(D.properties):void 0;o.isEmpty(n)||(this._unacknowledgedPropSets=n,o.each(n,(e=>{R||(R={}),R[e.key]=e.value})));const L=null===(v=this._serverMessages)||void 0===v?void 0:v.filter((e=>{var t;return null===(t=e.properties)||void 0===t?void 0:t[d.MessageProperties.SuggestedActions]})),B=null===(b=null===(M=null==L?void 0:L.pop())||void 0===M?void 0:M.properties)||void 0===b?void 0:b[d.MessageProperties.SuggestedActions];B&&(R=null!=R?R:{},R[d.MessageProperties.SuggestedActions]=B),this.properties=R,this._isEphemeral=l,this._isCallReaction=y,this._fileEncryptionKeys=_,this.reported=f,this._countsType=this.countsForUnreadCounts()?this._countsForHighPriorityUnreadCounts()?2:1:void 0,this._isMyMessage=m.default.isMyMri(this.creator)?1:0}}static fromDatabaseObject(e){return e?new w(e):void 0}static fromFirstLie(e,t,s,i,o=!1,n=!1){return new w(void 0,void 0,[e],void 0,void 0,t,s,o,void 0,void 0,i,void 0,void 0,n)}static fromFirstAcknowledgedLie(e,t,s,i,o=!1){return new w(void 0,void 0,void 0,[e],void 0,t,s,o,void 0,void 0,i)}static fromFirstServerMessage(e){if(c.getParsedConversationId(e))return new w(void 0,[e]);p.warn(h.LogTraceArea.MessageStream,"Message "+e.id+" has invalid conversationLink")}isImmutable(){return!0}rejectMessageSend(e,t,s){return this._sendRejectedCMID===e&&this.createdTime===t&&(0,g.default)(this._sendRetryInfo,s)?this:new w(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,e,s,t,this._fileEncryptionKeys,this.reported)}applyServerMessage(e){let t=this._unacknowledgedPropSets;if(t){const s=this._getServerMessageForProperties();s&&s.id===e.id&&s.version<e.version&&(t=void 0)}if(c.isPhoneMri(this.conversationId)&&e.properties){const t=d.getSmsDeliveryReport(this.properties),s=d.getSmsDeliveryReport(e.properties);if(!t&&s){const t=this.getLatestRelevantRequestId(),i=this.getLatestRelevantClientMessageId()||this.getOriginalClientMessageId(),o=(0,y.getPhoneNumberFromMessageContent)(e.content),{possibleCountry:n}=v.default.getPhoneNumberDetails(o);p.track(new S.SmsDeliveryReportStatus(d.isSmsDeliveredSuccessfully(s),s,i,t,n))}}const s=(this._serverMessages||[]).concat(e);return new w(void 0,s,this._unacknowledgedLies,this._acknowledgedLies,t,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}applyMessageForPostingLie(e){const t=(this._unacknowledgedLies||[]).concat(e);return new w(void 0,this._serverMessages,t,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,void 0,void 0,this.createdTime,this._fileEncryptionKeys,this.reported)}revertMessageForPostingLie(e){const t=o.filter(this._unacknowledgedLies,(t=>t.clientmessageid!==e));if(!(t.length||this._serverMessages&&this._serverMessages.length)){const e={clientmessageid:f.default.newClientMessageId(),content:this.content.substring(0,this.skypeemoteoffset||0),contenttype:this.contenttype,messagetype:this.messagetype,skypeeditedid:this.getOriginalClientMessageId(),composetime:(new Date).toISOString(),cancel:!0};t.push(e)}return new w(void 0,this._serverMessages,t,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}applyPropertyLie(e,t){const s=(this._unacknowledgedPropSets||[]).concat({key:e,value:t});return new w(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,s,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}revertPropertyLie(e,t){const s=o.filter(this._unacknowledgedPropSets,(s=>s.key!==e||s.value!==t));return new w(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,s,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}acknowledgeMessageLie(e,t,s){const i=o.partition(this._unacknowledgedLies,(t=>t.clientmessageid===e)),n=o.last(i[0]);if(!n)return this;const r=Object.assign(Object.assign({},n),{id:t,version:s}),a=(this._acknowledgedLies||[]).concat(r);return new w(void 0,this._serverMessages,i[1],a,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,this.reported)}addFileKeyMaterial(e){return(0,g.default)(e,this._fileEncryptionKeys)?this:new w(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,e,this.reported)}markAsReported(e){return e===this.reported?this:new w(void 0,this._serverMessages,this._unacknowledgedLies,this._acknowledgedLies,this._unacknowledgedPropSets,this.conversationId,this.creator,this._isEphemeral,this._sendRejectedCMID,this._sendRetryInfo,this.createdTime,this._fileEncryptionKeys,e)}clone(){return o.cloneDeep(this)}getMutableClone(){return this.clone()}getUniqueReactions(){const e=d.getCleanedEmotionMetadata(this.properties),t=o.flatten(o.map(e,(e=>o.map(e.users,(t=>({key:e.key,mri:t.mri,time:t.time})))))),s=o.groupBy(t,(e=>e.mri)),i=o.mapValues(s,((e,t)=>o.maxBy(e,(e=>e.time)))),n=o.groupBy(i,(e=>e.key));return o.sortBy(o.map(n,((e,t)=>({key:t,users:e}))),(e=>-e.users.length))}getReactionsAndFilterMri(e){const t=this.getUniqueReactions();let s;for(let i=0;i<t.length;i++)if(o.some(t[i].users,(t=>t.mri===e))){s=t[i].key;break}return{mriReactionKey:s,fullListReactions:t}}hasReactions(){const e=d.getCleanedEmotionMetadata(this.properties);return!o.isEmpty(e)}getReactions(){const e=d.getCleanedEmotionMetadata(this.properties),t=o.flatten(o.map(e,(e=>o.map(e.users,(t=>({key:e.key,mri:t.mri,time:t.time})))))),s=o.groupBy(t,(e=>e.key));return o.orderBy(o.map(s,((e,t)=>({key:t,users:e}))),[e=>-e.users.length,e=>-o.maxBy(e.users,(e=>e.time)).time])}hasUserReactedOnMessage(e){return this.getCleanedEmotionAnnotations().some((t=>t.users.some((t=>t.mri===e))))}isLastChangeScheduledCallMetadata(){return d.isScheduledCallMetadataType(this.messagetype)}isLastChangeReactionConsumptionHorizonUpdate(){if(!this._serverMessages)return!1;const e=this.getLatestServerMessage();if(!e)return!1;const t=this._getCurrentUserReactionConsumptionHorizonFromProperties(e.properties);if(!t)return!1;const s=this._serverMessages[this._serverMessages.length-2];if(s){const e=this._getCurrentUserReactionConsumptionHorizonFromProperties(s.properties);if(e)return e!==t}return!0}isMyMessage(){return 1===this._isMyMessage}_getCurrentUserReactionConsumptionHorizonFromProperties(e){const t=d.getEmotionMetadata(e);if(!t)return;const s=o.find(t,(e=>e.key===d.MessageAnnotations.ReactionsConsumptionHorizon));if(!s)return;const i=o.find(s.users,(e=>m.default.isMyMri(e.mri)));return i?i.time:void 0}_getCurrentUserScheduledCallConsumptionHorizonFromProperties(e){const t=d.getScheduledCallConsumptionHorizons(e);if(!t)return;const s=o.find(t,((e,t)=>m.default.isMyMri(t)));return o.isUndefined(s)?void 0:s}getReactionUpdates(e){const t={added:[],removed:[]},s=o.filter(d.flattenEmotionMetadata(this.getCleanedEmotionAnnotations()),(e=>!m.default.isMyMri(e.mri)));if(!e)return t.added=s,t;const i=o.filter(d.flattenEmotionMetadata(e.getCleanedEmotionAnnotations()),(e=>!m.default.isMyMri(e.mri)));return t.added=o.differenceWith(s,i,o.isEqual),t.removed=o.differenceWith(i,s,o.isEqual),t}hasUrlPreviewMetadata(){return d.getUrlPreviewMetadata(this.properties).length>0}isForwarded(){return d.getForwardMetadata(this.properties).isForwarded}isBookmark(){return c.isBookmarkConversation(this.conversationId)}getBookmarkMetadata(){return d.getBookmarkMetadata(this.properties)}isBookmarkSourceForCurrentUser(){return!!this.getBookmarkSourceMetadataForCurrentUser()}getBookmarkSourceMetadataForCurrentUser(){return d.getBookmarkMetadataForUser(this.properties,m.default.getSkypeMri())}isBookmarkSourceDeletedMessageForCurrentUser(){if(!this._serverMessages)return!1;if(!this.getLatestServerMessage())return!1;const e=this._serverMessages[this._serverMessages.length-2];return!!e&&(this.isDeletedMessage()&&!!d.getBookmarkMetadataForUser(e.properties,m.default.getSkypeMri()))}getBookmarkSourceMetadataForCurrentUserFromPreviousMessage(){if(!this._serverMessages)return;const e=this._serverMessages[this._serverMessages.length-2];return e?d.getBookmarkMetadataForUser(e.properties,m.default.getSkypeMri()):void 0}getUrlPreviewMetadata(e){if(!e)return;const t=d.getUrlPreviewMetadata(this.properties);if(0===t.length)return;const s=e.trim(),i=o.find(t,(e=>e.key.trim()===s));return i?i.value:void 0}getEmotionAnnotations(){return d.getEmotionMetadata(this.properties)}getCleanedEmotionAnnotations(){return d.getCleanedEmotionMetadata(this.properties)}getPollData(){return d.getPollMetadata(this.properties)}getScheduledCallsResponses(){return d.getScheduledCallMetadata(this.properties)}getSuggestedActions(){const e=this.properties?this.properties[d.MessageProperties.SuggestedActions]:void 0;return e?{creator:this.creator,to:e.to,actions:o.map(e.actions,(e=>({botId:this.creator,title:e.title,value:e.value,type:e.type,image:e.image,pageTitle:e.displayText,attributes:e.channelData?e.channelData.telemetryData:void 0})))}:void 0}isEmote(){const e=this.getOriginalServerMessage();return e?Number(e.skypeemoteoffset)>0:(this.skypeemoteoffset||0)>0}isEdited(){return!(!this.properties||!this.properties[d.MessageProperties.EditTime]&&!this.properties[d.MessageProperties.DeleteTime])||(this.isEditLie()||o.some(this._serverMessages,(e=>!!e.skypeeditedid)))}isEditLie(){return!o.isEmpty(this._unacknowledgedLies)&&!!o.last(this._unacknowledgedLies).skypeeditedid||!o.isEmpty(this._acknowledgedLies)&&!!o.last(this._acknowledgedLies).skypeeditedid}isDeletedMessage(){return!(!this.properties||!this.properties[d.MessageProperties.DeleteTime])||d.isDeletedMessage(this)}isAllowedEngagementBotMessage(){const e=r.default.getEngagementFeatures().conciergeBotSettings;return e.enableVisibility&&c.isConciergeBotMri(this.creator)&&-1!==e.allowedRecentMessageTypes.indexOf(this.messagetype)}isTranslationSettings(){return o.includes([d.MessageTypes.TranslationSettings],this.messagetype)&&!!d.getTranslationSettingsMetadata(this.content)}isHiddenTranslationSettingsMessage(){if(!this.isTranslationSettings())return!1;const e=d.getTranslationSettingsMetadata(this.content),t=d.getTranslationSettingsState(this.content);if(e&&void 0!==t){if(e.isUpdate)return!0;if(!o.includes([a.TranslationState.Disabled,a.TranslationState.Enabled],t))return m.default.isMyMri(this.creator)}return!1}isTranslation(){return this.messagetype===d.MessageTypes.Translation}isHiddenInPreviewTranslation(e){return!!this.isTranslation()&&(e?!r.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation||m.default.isMyMri(this.creator):!m.default.isMyMri(this.creator))}getMessageContentFromServerMessages(){const e=o.find(this._serverMessages,(e=>""!==e.content));return e?e.content:void 0}getServerMessages(){return this._serverMessages}isDeletedHighlightServerMessage(){return this.isDeletedMessage()&&o.some(this._serverMessages,(e=>d.isHighlightMessageType(e)))}isMutated(){const e=this._getServerMessageForProperties();return e&&e.version>e.id||!o.isEmpty(this._unacknowledgedPropSets)}hasUnseenReactions(){const e=this.getLastReactionTimeExcludingCurrentUser();if(o.isUndefined(e))return!1;return this.getReactionsReadTimeForCurrentUser()<e}isAlbum(){return this.hasAlbumId()&&this.messagetype===d.MessageTypes.MediaAlbum}isAlbumItem(){return this.hasAlbumId()&&this.messagetype!==d.MessageTypes.MediaAlbum}hasAlbumId(){return this.properties&&this.properties[d.MessageProperties.AlbumId]}getAlbumId(){return this.properties&&this.properties[d.MessageProperties.AlbumId]}getBingImageTrackingMetadata(){return this.properties&&this.properties[d.MessageProperties.BingImageTrackingMetadata]}hasBingImageTrackingMetadata(){return this.properties&&this.properties[d.MessageProperties.BingImageTrackingMetadata]}getAlbumIdFromPreviousMessage(){if(!this._serverMessages)return;const e=this._serverMessages[this._serverMessages.length-2];return e&&e.properties?e.properties[d.MessageProperties.AlbumId]:void 0}isUnreconciledEdit(){return!o.isEmpty(this._serverMessages)&&!this.getOriginalServerMessage()}isMessageLie(){return!o.isEmpty(this._unacknowledgedLies)}isPropertyLie(){return!o.isEmpty(this._unacknowledgedPropSets)}isCurrentVersionKnownByServer(){return this.isAnyVersionKnownByServer()&&!this.isMessageLie()&&!this.isPropertyLie()}isAnyVersionKnownByServer(){return!!this._serverMessages&&this._serverMessages.length>0||!!this._acknowledgedLies&&this._acknowledgedLies.length>0}isUnsent(){return!this._isEphemeral&&!this.isAnyVersionKnownByServer()}isEphemeral(){return!!this._isEphemeral}isCallReaction(){return!!this._isCallReaction||c.isReactionsThread(this.conversationId)}isSendRejected(){return!!this._sendRejectedCMID}getSendRejectedCMID(){return this._sendRejectedCMID}getSendRetryInfo(){return this._sendRetryInfo}isBotHighlightMessage(){return c.isBotHighlightsThread(this.conversationId)&&-1!==this.content.indexOf(c.BotHighlightMessageContent)}isHighlightMessage(){return c.isHighlightsThread(this.conversationId)&&(d.isHighlightMessageType(this)||this.isBotHighlightMessage())}isHighlightFollow(){return!!c.isHighlightsThread(this.conversationId)&&(this.messagetype===d.MessageTypes.AddMember||this.messagetype===d.MessageTypes.DeleteMember||this.messagetype===d.MessageTypes.HighlightsFollow||this.messagetype===d.MessageTypes.HighlightsRemoveFollow||this.messagetype===d.MessageTypes.HighlightsRefuseFollow)}isHighlightFollowRequest(){return!!c.isHighlightsThread(this.conversationId)&&this.messagetype===d.MessageTypes.HighlightsFollow}isHighlightFollowRemove(){return!!c.isHighlightsThread(this.conversationId)&&this.messagetype===d.MessageTypes.HighlightsRemoveFollow}isHighlightFollowAcceptedByOther(){return!!c.isHighlightsThread(this.conversationId)&&(!c.isMyHighlightThread(this.conversationId)&&this.messagetype===d.MessageTypes.AddMember)}isHighlightFollowAcceptedByMe(){return!!c.isHighlightsThread(this.conversationId)&&(c.isMyHighlightThread(this.conversationId)&&this.messagetype===d.MessageTypes.AddMember)}isMessageInEncryptedThread(){return c.isEncryptedThread(this.conversationId)}isMessageInS4BBridgeConversation(){return c.isS4BBridgeMri(this.conversationId)}isE2eeHandshakeTypeAllowedForNotification(){return c.isEncryptedThread(this.conversationId)&&(this.messagetype===d.MessageTypes.HandshakeInvite||this.messagetype===d.MessageTypes.HandshakeAccept||this.messagetype===d.MessageTypes.HandshakeComplete)&&!this._isCurrentUserInitiator()}getLatestRelevantClientMessageId(){const e=o.findLast(this._serverMessages,(e=>this._isContentEdited(e)))||this.getOriginalServerMessage();return e?e.skypeeditedid||e.clientmessageid:void 0}getLatestRelevantRequestId(){const e=o.findLast(this._serverMessages,(e=>this._isContentEdited(e)))||this.getOriginalServerMessage();return(0,y.getRequestId)(null==e?void 0:e.content)}_isContentEdited(e){return!!e.skypeeditedid||!(!e.properties||!e.properties[d.MessageProperties.EditTime]&&!e.properties[d.MessageProperties.DeleteTime])}getLatestServerMessageVersion(){const e=this.getLatestServerMessage();return e&&(e.version||e.id)}getLatestServerMessage(){return o.last(this._serverMessages)}getLatestServerMessageId(){const e=o.findLast(this._serverMessages,(e=>this._isContentEdited(e)));return e&&e.id||this.getOriginalServerId()}getLastReactionTimeExcludingCurrentUser(){const e=this.getCleanedEmotionAnnotations();if(o.isEmpty(e))return;const t=(0,l.chain)(e,(0,l.map)((e=>e.users)),(0,l.flatten)(),(0,l.filter)((e=>!m.default.isMyMri(e.mri))));if(o.isEmpty(t))return;return o.maxBy(t,(e=>e.time)).time}getOriginalClientMessageId(){const e=this.getOriginalServerMessage()||o.head(this._acknowledgedLies)||o.head(this._unacknowledgedLies);return e&&(e.skypeeditedid||e.clientmessageid)}getOriginalServerMessage(){return o.find(this._serverMessages,(e=>!!this._isOriginalConfirmedServerMessage(e)))}_isOriginalConfirmedServerMessage(e){const t=e&&this.messagetype===d.MessageTypes.Call&&e.skypeguid===this.skypeguid;return e&&(c.getCuidForMessage(e)===this.cuid||t)&&!e.skypeeditedid}getOriginalServerId(){const e=this.getOriginalServerMessage()||o.head(this._acknowledgedLies);return e&&e.id}_getServerMessageForProperties(){const e=this.getOriginalServerId();if(e)return o.findLast(this._serverMessages,(t=>t.id===e))}getServerIdForPropertyChanges(){return this.getOriginalServerId()}getCHID(){if(!this.skypeguid)return this.cuid;const e=this.getLatestServerMessage();return e?e.skypeeditedid||e.clientmessageid||e.id:this.getOriginalServerId()}getConsumptionHorizonString(){const e=this.getOriginalServerId();if(!e)return void p.warn(h.LogTraceArea.MessageStream,"getConsumptionHorizonString called on an unreconciled edit");const t=this.getCHID();return o.isUndefined(t)?void 0:c.getConsumptionHorizonForMessageAndCHID(e,t)}getUnacknowledgedClientMessageIds(){return o.map(this._unacknowledgedLies,(e=>e.clientmessageid))}test_getServerMessages(){return this._serverMessages||[]}push_getThreadTopic(){const e=o.maxBy(this._serverMessages,(e=>e.version));return e?e.threadtopic:void 0}push_getSenderDisplayName(){const e=o.maxBy(this._serverMessages,(e=>e.version));return e?e.imdisplayname:void 0}static test_fromFirstServerMessage(e){return w.fromFirstServerMessage(e)}_isTargetingMe(){return null!==this.content.match(`<target>${o.escapeRegExp(m.default.getSkypeMri())}</target>`)}getCountsType(){return this._countsType}countsForUnreadCounts(){if(this.isEphemeral())return!1;if(m.default.isMyMri(this.creator))return!1;if(!this.isShownInStream())return!1;if(this.isUnreconciledEdit())return!1;if((this.messagetype===d.MessageTypes.HandshakeInvite||this.messagetype===d.MessageTypes.HandshakeAccept||this.messagetype===d.MessageTypes.HandshakeReject||this.messagetype===d.MessageTypes.HandshakeComplete)&&this._isTargetingMe())return!0;if(d.isThreadActivityType(this.messagetype))return!1;if(c.isHighlightsThread(this.conversationId)&&!this.isHighlightMessage())return!1;if(d.getMessageTypeGroup(this)===d.MessageTypeGroups.Calling){if(!o.startsWith(this.content,"<partlist"))return!1;if(c.isGroupConversation(this.conversationId)){const e=m.default.getSkypeId();let t;for(;t=M.exec(this.content);)if(t[1]===e)return M.lastIndex=0,!1}else if(-1===this.content.indexOf('type="missed"'))return!1}return!this.hasAlbumId()||this.isAlbum()}countsForReadReceipts(){if(this.isEphemeral())return!1;if(!this.isShownInStream())return!1;if(this.isUnreconciledEdit())return!1;if(d.isThreadActivityType(this.messagetype))return!1;return d.getMessageTypeGroup(this)!==d.MessageTypeGroups.Calling}_countsForHighPriorityUnreadCounts(){const e=this.getMessageNotificationClass();return e===_.MessageNotificationClass.OneOnOne||e===_.MessageNotificationClass.MentionedOrQuoted}getMessageNotificationClass(){let e=_.MessageNotificationClass.Normal;if(r.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation&&this.isTranslationSettings()&&!this.isHiddenTranslationSettingsMessage())return e;return d.getMessageTypeGroup(this)===d.MessageTypeGroups.System?_.MessageNotificationClass.SystemInformational:(m.default.isMyMri(this.creator)||(this.isCurrentUserMentionedOrQuoted()?e=_.MessageNotificationClass.MentionedOrQuoted:c.isUserMri(this.conversationId)&&(e=_.MessageNotificationClass.OneOnOne)),e)}isShownInStream(){if(this.isDeletedMessage())return!1;if(this.isUnreconciledEdit())return!1;if(this.messagetype===d.MessageTypes.HighlightsFollow||this.messagetype===d.MessageTypes.HighlightsRefuseFollow||this.messagetype===d.MessageTypes.HighlightsRemoveFollow)return!1;const e=d.getMessageTypeGroup(this);return!(e!==d.MessageTypeGroups.Calling||!d.isCallInfoForCallMessageType(this)&&!d.isEventCallStartedMessageType(this))||e!==d.MessageTypeGroups.Engagement&&(e!==d.MessageTypeGroups.Translation&&(this.isTranslationSettings()?!!r.default.getS4LCMCFeaturesNoSubscription().enableMessageTranslation&&!this.isHiddenTranslationSettingsMessage():!this.isCanceledScheduledCall()&&e!==d.MessageTypeGroups.None))}isShownInPreview(e){return(this.isShownInStream()||this.isTranslation())&&!this.isReported()&&!this.isHiddenInPreviewTranslation(e)}isCanceledScheduledCall(){if(!d.isScheduledCallType(this.messagetype))return!1;const e=this.content.match(/canceledTimeMs=/i);return!o.isEmpty(e)}isCurrentUserMentionedOrQuoted(e=!0){return o.some(m.default.getMyMris(),(t=>this._isUserAtMentioned(t,e)||w._testUserIsQuoted(this.content,t)))}isCurrentUserMentioned(e=!0){return o.some(m.default.getMyMris(),(t=>this._isUserAtMentioned(t,e)))}isCurrentUserQuoted(){return o.some(m.default.getMyMris(),(e=>w._testUserIsQuoted(this.content,e)))}_isCurrentUserInitiator(){return o.some(m.default.getMyMris(),(e=>w._testUserIsInitiator(this.content,e)))}_isUserAtMentioned(e,t){const s=t?"?:\\*|":"";return this.messagetype===d.MessageTypes.TeamsHtml?!!o.find(d.getTeamsMentionProperties(this.properties),(t=>t.mri===e)):!!this.content&&null!==this.content.match(`<at id="(${s}${o.escapeRegExp(e)})">.*?</at>`)}static _testUserIsInitiator(e,t){return!!e&&null!==e.match(`.+initiator>${o.escapeRegExp(t)}</.+`)}static _testUserIsQuoted(e,t){const s=c.getSkypeIdFromMri(t);if(!s||!e)return!1;let i,o=!1;for(;(i=b.exec(e))&&!o;){const e=i[1];let t;for(;(t=I.exec(e))&&!o;)o=3===t.length&&"author"===t[1]&&t[2]===s}return I.lastIndex=0,b.lastIndex=0,o}isReactionRead(){const e=this.getLastReactionTimeExcludingCurrentUser();if(o.isUndefined(e))return!0;const t=this.getReactionsReadTimeForCurrentUser()||0;return!!e&&e<=t}getReactionsReadTimeForCurrentUser(){const e=this._getCurrentUserReactionConsumptionHorizonFromProperties(this.properties);return o.isUndefined(e)?0:e}getScheduledCallReadTimeForCurrentUser(){const e=this._getCurrentUserScheduledCallConsumptionHorizonFromProperties(this.properties);return o.isUndefined(e)?0:e}getFileEncryptionKeys(){return this._fileEncryptionKeys}isKnownServerMessageVersion(e){return o.some(this._serverMessages,(t=>t.version===e))}isMergingBotHighlightMessageLocal(e){return c.isAgent(e)&&-1!==this.content.indexOf(c.BotHighlightMessageContent)}getAcknowledgedLies(){return this._acknowledgedLies}isReported(){return!!this.reported}isEmoticonCallReaction(){return void 0!==this.getEmoticonCallReactionKey()}getEmoticonCallReactionKey(){const e=/^<ss type=\"(.*)\">\(([^\(]*)\)<\/ss><c_i/g.exec(this.content),t=/^\((flag_.*)\)<c_i/g.exec(this.content);return e&&e.length>2?e[2]:t?t[1]:void 0}}t.default=w},100166:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CSRequestScenarios=void 0,t.calcConvViewParam=h,t.calcThreadViewParam=p,t.calcMessagesViewParam=function(){return o.compact(["supportsExtendedHistory","msnp24Equivalent","supportsMessageProperties"]).join("|")},t.calcMessageViewParam=g,t.getMyProperties=function(){return{method:"GET",path:"v1/users/ME/properties",scenario:"getMyProperties"}},t.setMyProperty=m,t.setMyUserRing=function(e){return m(d.ServerUserProps.UserRing,e)},t.createThread=function(e,t,s,i={}){t&&(i[d.ThreadProps.TopicName]=t);s&&(i[d.ThreadProps.IsSticky]=!0,i[d.ThreadProps.ThreadType]="Chat");return{method:"POST",path:"v1/threads",passedData:{members:o.map(e,((e,t)=>({id:t,role:e===c.ThreadMemberAccessType.Admin?l.ThreadMemberRoles.Admin:l.ThreadMemberRoles.User}))),properties:i},scenario:"createThread"}},t.addMemberToThread=function(e,t,s=!0){return{method:"PUT",path:"v1/threads/"+encodeURIComponent(e)+"/members/"+t,passedData:{role:s?l.ThreadMemberRoles.Admin:l.ThreadMemberRoles.User},scenario:"addMemberToThread",mriForTelemetry:e}},t.addMembersToThread=function(e,t){const s="v1/threads/"+encodeURIComponent(e)+"/members",i={members:o.map(t,((e,t)=>({id:t,role:e===c.ThreadMemberAccessType.Admin?l.ThreadMemberRoles.Admin:l.ThreadMemberRoles.User})))};return{method:"POST",path:s,passedData:i,scenario:"addMembersToThread",mriForTelemetry:e}},t.removeMemberFromThread=function(e,t){return{method:"DELETE",path:"v1/threads/"+encodeURIComponent(e)+"/members/"+t,scenario:"removeMemberFromThread",mriForTelemetry:e}},t.getThread=function(e){return{method:"GET",path:"v1/threads/"+encodeURIComponent(e)+"?view="+encodeURIComponent("msnp24Equivalent"),scenario:"getThread",mriForTelemetry:e}},t.setThreadProperty=function(e,t,s){return{method:"PUT",path:"v1/threads/"+encodeURIComponent(e)+"/properties?name="+encodeURIComponent(t),passedData:{[t]:s},scenario:"setThreadProperty",mriForTelemetry:e,conversationId:e}},t.invokeAgentRequest=function(e,t,s,i){return{method:"POST",path:"v1/agents/"+encodeURIComponent(e)+"/invoke",passedData:{conversation:{id:t},value:s,name:i},scenario:"invokeAgentRequest",mriForTelemetry:e}},t.getWebhookUrl=function(e,t){return{method:"POST",path:"v1/threads/"+encodeURIComponent(e)+"/integrations",passedData:t,scenario:"getWebhookUrl"}},t.enumerateEndpoints=function(){return{path:"v1/users/ME/endpoints",method:"GET",timeout:6e4,priority:n.WebRequestPriority.Normal,scenario:"enumerateEndpoints",isV1OnlyRequest:!0}},t.createEndpoint=function(e){return{path:"v1/users/ME/endpoints",method:"POST",passedData:{endpointFeatures:e},timeout:6e4,priority:n.WebRequestPriority.Critical,scenario:t.CSRequestScenarios.createEndpoint,isLogin:!0,isV1OnlyRequest:!0}},t.updateEndpoint=function(e,s){return{path:"v1/users/ME/endpoints/"+e,method:"PUT",passedData:{endpointFeatures:s},timeout:6e4,priority:n.WebRequestPriority.Critical,endpointId:e,scenario:t.CSRequestScenarios.updateEndpoint,isLogin:!0,isV1OnlyRequest:!0}},t.deleteEndpoint=function(e){return{path:"v1/users/ME/endpoints/"+e,method:"DELETE",timeout:6e4,priority:n.WebRequestPriority.Critical,endpointId:e,scenario:"deleteEndpoint",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.clearEndpoint=function(e){return{method:"PUT",path:"v1/users/ME/endpoints/"+e,passedData:{},endpointId:e,scenario:"clearEndpoint",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.publishEndpointPresence=function(e,t){return{method:"PUT",path:"v1/users/ME/endpoints/"+e+"/presenceDocs/messagingService",passedData:t,endpointId:e,timeout:6e4,scenario:"publishEndpointPresence",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.getEndpointPresenceDoc=function(e){return{method:"GET",path:"v1/users/ME/endpoints/"+e+"/presenceDocs/messagingService",endpointId:e,timeout:6e4,scenario:"getEndpointPresenceDoc",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.createSubscription=function(e,t){return{method:"POST",path:"v1/users/ME/endpoints/"+e+"/subscriptions",passedData:t,endpointId:e,scenario:"createSubscription",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.deleteSubscription=function(e,s){return{method:"DELETE",path:"v1/users/ME/endpoints/"+e+"/subscriptions/"+encodeURIComponent(s),endpointId:e,scenario:t.CSRequestScenarios.deleteSubscription,requiresEndpoint:!0,isV1OnlyRequest:!0}},t.updateSubscriptionProperty=function(e,t,s,i){return{method:"PUT",path:"v1/users/ME/endpoints/"+e+"/subscriptions/"+encodeURIComponent(t)+"?name="+encodeURIComponent(s),passedData:{[s]:i},endpointId:e,scenario:"updateSubscriptionProperty",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.pollSubscription=function(e,t,s){let i="v1/users/ME/endpoints/"+encodeURIComponent(e)+"/subscriptions/"+encodeURIComponent(t)+"/poll";void 0!==s&&(i+="?ackId="+s);return{method:"POST",path:i,endpointId:e,timeout:9e4,priority:n.WebRequestPriority.Critical,scenario:"pollSubscription",requiresEndpoint:!0,isV1OnlyRequest:!0}},t.getMyConversations=function(e="All",t=1,s,i=100){let o="v1/users/ME/conversations?view="+encodeURIComponent(h());o+="&pageSize="+Math.min(i,100),s?o+="&syncState="+encodeURIComponent(s):(o+="&startTime="+t,null!=e&&(o+="&targetType="+encodeURIComponent(e)));return{method:"GET",path:o,scenario:"getMyConversations"}},t.getConversationMessage=function(e,t){return{method:"GET",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"?view="+encodeURIComponent(g()),scenario:"getConversationMessage",mriForTelemetry:e,conversationId:e}},t.postMessageToConversation=function(e,s,i=t.CSRequestScenarios.postMessageToConversation){let o="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages";return o=u.default.addUrlParameter(o,"x-ecs-etag",encodeURIComponent(r.default.getCachedEcsConfigEtag()),!0),{method:"POST",path:o,passedData:s,priority:n.WebRequestPriority.High,scenario:i,mriForTelemetry:e,conversationId:e}},t.setMessageProperty=function(e,t,s,i,o=!1){let n="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"/properties?name="+encodeURIComponent(s);o||s!==a.MessageProperties.Emotions||(n=u.default.addUrlParameter(n,"x-ecs-etag",encodeURIComponent(r.default.getCachedEcsConfigEtag()),!0));return{method:o?"DELETE":"PUT",path:n,passedData:{[s]:i},scenario:"setMessageProperty",mriForTelemetry:e,conversationId:e}},t.editMessage=function(e,t,s,i){return{method:"PUT",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t),passedData:{messagetype:s,content:i},scenario:"editMessage",mriForTelemetry:e,conversationId:e}},t.deleteMessage=function(e,t){return{method:"DELETE",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t),scenario:"deleteMessage",mriForTelemetry:e,conversationId:e}},t.deleteConversation=function(e){return{method:"DELETE",path:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages",scenario:"deleteConversation",mriForTelemetry:e}},t.getMemberConsumptionHorizons=function(e){return{method:"GET",path:"v1/threads/"+encodeURIComponent(e)+"/consumptionhorizons",scenario:"consumptionhorizons",conversationId:e}},t.e2eeInvite=function(e,t,s,i){const o={DeviceId:e,KeyBundle:JSON.stringify(t),InviteeId:s,ThreadId:i};return{method:"POST",path:"v1/e2ee/v1/invite",passedData:o,scenario:"e2eeInvite",isV1OnlyRequest:!r.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enableE2eeRequests}},t.e2eeAccept=function(e,t,s){const i="v1/e2ee/v1/invite/"+t,o={DeviceId:e,KeyBundle:JSON.stringify(s)};return{method:"PUT",path:i,passedData:o,scenario:"e2eeAccept",isV1OnlyRequest:!r.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enableE2eeRequests}},t.e2eeConfirm=function(e){return{method:"PUT",path:"v1/e2ee/v1/invite/"+e,passedData:{},scenario:"e2eeConfirm",isV1OnlyRequest:!r.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enableE2eeRequests}},t.e2eeReject=function(e){return{method:"DELETE",path:"v1/e2ee/v1/invite/"+e,scenario:"e2eeReject",isV1OnlyRequest:!r.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enableE2eeRequests}},t.deleteConnectors=function(e,t){return{method:"DELETE",path:"v1/threads/"+e+"/integrations/"+t,scenario:"deleteConnectors"}};const i=s(197582),o=i.__importStar(s(496486)),n=s(662783),r=i.__importDefault(s(150343)),a=i.__importStar(s(971988)),l=s(135356),d=i.__importStar(s(44717)),c=s(331079),u=i.__importDefault(s(220534));function h(){return o.compact(["supportsExtendedHistory","msnp24Equivalent"]).join("|")}function p(){return"msnp24Equivalent"}function g(){return o.compact(["msnp24Equivalent","supportsMessageProperties"]).join("|")}function m(e,t){return{method:"PUT",path:"v1/users/ME/properties?name="+encodeURIComponent(e),passedData:{[e]:t},scenario:"setMyProperty"}}t.CSRequestScenarios={createEndpoint:"createEndpoint",updateEndpoint:"updateEndpoint",updateSubscription:"updateSubscription",deleteSubscription:"deleteSubscription",postMessageToConversation:"postMessageToConversation",userComposingState:"userComposingState",navigateToChat:"navigateToChat",createThreadOnMessagePost:"createThreadOnMessagePost"}},194504:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TransformerBase=void 0,t.trimToFirstLineIfNeeded=function(e,t){let s=e,i=!1;t&&(s=e.split(/[\r\n]/)[0],i=s.length<e.length);return{value:s,stopProcessing:i,renderAsInline:!0}},t.getContactInfo=function(e){let t;e.fullName&&e.skypeId?t=a.getString("ContentToDisplayTransformerBase.ContactInfo",{fullName:e.fullName,skypeId:e.skypeId}):e.fullName?t=e.fullName:e.skypeId&&(t=a.getString("ContentToDisplayTransformerBase.ContactInfoOnlySkypeId",{skypeId:e.skypeId}));return t},t.getThreadActivityMemberParts=function(e,t){const s=e.getRawText(),i=o.reject(t,(e=>e.getRawText()===s)),n=o.map(i,(e=>e.getRawText()));return{authorMri:s,personMris:n}},t.getDeleteMemberNodeLocalizeInfo=function(e,t,s){if(o.isUndefined(e))return{key:"ContentToDisplayTransformerBase.RemovedGuestFromConversationMessage",params:{person:t}};if(s)return{key:"ContentToDisplayTransformerBase.RemovedFromConversationMessage",params:{initiator:e,person:t}};return{key:"ContentToDisplayTransformerBase.RemovedSelfFromConversationMessage",params:{initiator:e}}},t.getAddMemberLocalizeInfo=function(e,t,s){return s?{key:"ContentToDisplayTransformerBase.AddedToConversationMessage",params:{initiator:e,person:t}}:{key:"ContentToDisplayTransformerBase.JoinConversationMessage",params:{initiator:e}}},t.renderBotDisclosureParts=function(e,t){const s=[];return o.each(e,(e=>{s.push.apply(s,a.getParts("ContentToDisplayTransformerBase.BotReceivesAllContentText",{botName:e})),s.push("\n")})),o.each(t,(e=>{let t="ContentToDisplayTransformerBase.BotReceivesAtMentionMessagesText";e.isMagicBot&&e.isMe?t="ContentToDisplayTransformerBase.MagicBotReceivesAtMentionMessagesForMeText":e.isMagicBot&&(t="ContentToDisplayTransformerBase.MagicBotReceivesAtMentionMessagesText"),s.push.apply(s,a.getParts(t,{botName:e.botName,atMentionBotName:e.atMentionBotName})),s.push("\n")})),s},t.getRoleUpdateNodeLocalizeInfo=function(e,t,s){return o.isEmpty(t)?{key:"ContentToDisplayTransformerBase.RoleUpdateSelfMessage",params:{initiator:e,role:s}}:{key:"ContentToDisplayTransformerBase.RoleUpdateMessage",params:{initiator:e,person:t,role:s}}},t.getTopicUpdateNodeLocalizeInfo=function(e,t){return{key:"ContentToDisplayTransformerBase.TopicUpdateMessage",params:{initiator:e,topic:t}}},t.getHandshakeInviteNodeLocalizedInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.E2eeInvitationSent",params:{BParty:e}}:{key:"ContentToDisplayTransformerBase.E2eeInvitationReceived",params:{AParty:e}}},t.getHandshakeAcceptNodeLocalizedInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.E2eeInvitationAccepted",params:{AParty:e}}:{key:"ContentToDisplayTransformerBase.E2eeInvitationGotAccepted",params:{BParty:e}}},t.getPictureUpdateNodeLocalizeInfo=function(e){return{key:"ContentToDisplayTransformerBase.PictureUpdateMessage",params:{initiator:e}}},t.getHistoryDisclosedUpdateLocalizeInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.HistoryDisclosedUpdateMessage",params:{initiator:e}}:{key:"ContentToDisplayTransformerBase.HistoryHiddenUpdateMessage",params:{initiator:e}}},t.getJoiningEnabledUpdateNodeLocalizeInfo=function(e,t){return t?{key:"ContentToDisplayTransformerBase.JoiningEnabledUpdateMessage",params:{initiator:e}}:{key:"ContentToDisplayTransformerBase.JoiningDisabledUpdateMessage",params:{initiator:e}}},t.getLegacyMemberAddedNodeLocalizeInfo=function(e,t){return{key:"ContentToDisplayTransformerBase.LegacyMemberAddedMessage",params:{initiator:e,link:t}}},t.getLegacyMemberUpgradedNodeLocalizeInfo=function(e){return{key:"ContentToDisplayTransformerBase.LegacyMemberUpgradeMessage",params:{initiator:e}}},t.getTranslationActionString=function(e){switch(r.getTranslationSettingsState(e)){case n.TranslationState.Enabled:return a.getString("ContentToDisplayTransformerBase.TranslationsEnabledMessage");case n.TranslationState.Pending:return a.getString("ContentToDisplayTransformerBase.TranslationsRequestedMessage");case n.TranslationState.Cancelled:return a.getString("ContentToDisplayTransformerBase.TranslationRequestCancelled");case n.TranslationState.Declined:return a.getString("ContentToDisplayTransformerBase.TranslationRequestDeclined");case n.TranslationState.Disabled:default:return a.getString("ContentToDisplayTransformerBase.TranslationsDisabledMessage")}};const i=s(197582),o=i.__importStar(s(496486)),n=s(619429),r=i.__importStar(s(971988)),a=i.__importStar(s(704704));t.TransformerBase=class{_renderPlainText(e,t){const s=e.split(/\r\n|\n|\r|\f|\x0b|\x85|\u2028|\u2029/);return this._renderLineBreakBetweenLines(s,t)}_renderSingleLine(e,t){return{value:e,stopProcessing:!1,renderAsInline:!0}}_renderLineBreak(e){return{value:"\r",stopProcessing:!1,renderAsInline:!0}}_renderLineBreakBetweenLines(e,t){if(!o.isArray(e))return{value:e,stopProcessing:!1,renderAsInline:!0};const s=e;let i=!1;const n=[];o.each(s,((e,o)=>{if(e||1===s.length){const s=this._renderSingleLine(e,t);if(s.stopProcessing)return i=!0,!1;n.push(s.value)}if(o<s.length-1){const e=this._renderLineBreak(t);if(e.stopProcessing)return i=!0,!1;n.push(e.value)}return!0}));return{value:1===n.length?n[0]:n,stopProcessing:i,renderAsInline:!0}}_renderLineBreakBetweenElements(e,t){if(!o.isArray(e))return e;const s=e;let i=!1;const n=[];o.each(s,((e,o)=>{if(e.value||1===s.length){if(e.stopProcessing)return i=!0,!1;n.push(e.value)}if(o<s.length-1){const e=this._renderLineBreak(t);if(e.stopProcessing)return i=!0,!1;n.push(e.value)}return!0}));return{value:1===n.length?n[0]:n,stopProcessing:i,renderAsInline:!0}}}},149418:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentToHtmlTransformer=void 0,t.renderHtml=function(e,t={}){try{const s=r.defaults(t,{utfFallback:t.utfFallback||!1,onlyQuotedContent:e&&e.hasOnlyQuotedContent&&e.hasOnlyQuotedContent(),processing:t.processing||{},lineBreakString:"<br/>"}),i=new v(s);return i.transform(e).value||""}catch(e){g.error(h.LogTraceArea.GenericUnsafe,"ContentToHtmlTransformer: Failed to transform tree: "+S.default.errorAsString(e))}return""};const i=s(197582),o=s(247915),n=i.__importStar(s(823719)),r=i.__importStar(s(496486)),a=i.__importStar(s(987364)),l=s(154235),d=s(591312),c=i.__importDefault(s(389659)),u=i.__importStar(s(242561)),h=s(815146),p=s(525097),g=i.__importStar(s(85385)),m=i.__importStar(s(704704)),S=i.__importDefault(s(655192)),_=i.__importDefault(s(20758)),f=s(331079),y=`font-family: ${_.default.fontFamily.uidDisplayRegular}; 'font-weight: ${l.FontWeight.regular}; color: #252423`;class v extends d.ContentToTextTransformer{transformRootNode(e){const t=super.transformRootNode(e);if(t.value){const e=`<div style="${y}">${t.value}</div>`;return r.assign({},t,{value:e})}return t}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent||this._options.processing.quotes===u.ProcessingLevel.None||this._options.processing.quotes===u.ProcessingLevel.Stripped)return super.transformQuoteNode(e);const t=this._default(e),s=1e3*e.timestamp;return{value:`[${c.default.getDisplayDateStringFull(s)}] ${e.getAuthorNameWithFallbackUnescaped()}:<blockquote style="background-color: rgba(37,36,35,0.05); border-left-color: #e1dfdd; border-left-style: solid; border-left-width: 4px; padding: 8px">${t.value}</blockquote>`,stopProcessing:t.stopProcessing}}transformHtmlNode(e){const t=this._transformHtmlDom(r.cloneDeep(e.getHtmlDom()),!1),s=n.DomUtils.getOuterHTML(t,{decodeEntities:!1,xmlMode:!0}),i=this._renderTextNodes(e.children,this._options.lineBreakString);return{value:s+i.value,stopProcessing:i.stopProcessing}}_transformHtmlDom(e,t){return r.map(e,(e=>{let s=e;return"tag"===e.type&&("img"===e.name&&e.attribs&&e.attribs.itemtype===p.SemanticObjectSchemas.amsImage?s=this._createAmsFallbackLink(e):(e.attribs&&"copy-paste-table"===e.attribs.class||t&&("td"===e.name||"th"===e.name))&&(s=this._annotateCopyPasteTable(e),t=!0)),s.children&&(s.children=this._transformHtmlDom(s.children,t)),s}))}_createAmsFallbackLink(e){const t=a.getDocumentId(e.attribs&&e.attribs.src||"");if(t){const s=a.getDocumentUrls(t,f.UploadFileType.Picture).fallback,i=new o.Text(m.getString("InputEntity.SharedPhotoFallbackText")),r=new o.Text(s),l=new o.Element("a",{href:s}),d=new o.Element("div",{});return n.DomUtils.appendChild(l,r),n.DomUtils.appendChild(d,i),n.DomUtils.appendChild(d,l),n.DomUtils.replaceElement(e,d),d}return e}_annotateCopyPasteTable(e){const t=r.clone(e);return t.attribs?delete t.attribs.class:t.attribs={},t.attribs.style="td"===e.name||"th"===e.name?"padding: 4pt; border: solid 1px rgba(22,35,58,0.36)":"border: solid 1px rgba(22,35,58,0.36); background-color: #fff; color: #252423; border-collapse: collapse",e}}t.ContentToHtmlTransformer=v},901782:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentToImBackTransformer=void 0,t.toEntities=function(e){const t=new d;return t.transform(e)};const i=s(197582),o=i.__importStar(s(496486)),n=s(284841),r=i.__importStar(s(591312)),a=i.__importStar(s(626065)),l=i.__importDefault(s(760989));class d{constructor(){this.transformRootNode=this._default,this.transformUnknownNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformAtMentionNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._default,this.transformFlagNode=this._default,this.transformQuoteNode=this._toEmptyEntity,this.transformLegacyQuoteNode=this._toEmptyEntity,this.transformWikiMarkupNode=this._default,this.transformListWikiMarkupNode=this._default,this.transformLinkNode=this._default,this.transformBingResponseNode=this._default,this.transformDeepLinkNode=this._default,this.transformAttributionNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformRosterContextNode=this._default,this.transformLocationContextNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformTranslationNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,n.chain)(e.children,(0,n.map)((e=>e&&e.accept(this))),(0,n.compact)(),(0,n.flatten)())}_toUnhandledEntity(e,t){return o.isString(t)||(t=r.renderText(e)),[new a.UnhandledEntity(t)]}_toEmptyEntity(){return[new a.UnhandledEntity("")]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoteNode(e){return[new a.UnhandledEntity(l.default.unescapeXml(e.escapedFallbackText))]}transformContextNode(e){return[new a.ContextEntity(e.encodedAttr())]}}t.ContentToImBackTransformer=d},361971:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentToInputEntityTransformer=void 0,t.toEntities=function(e,t){const s=new d(t);return s.transform(e)};const i=s(197582),o=i.__importStar(s(496486)),n=s(284841),r=i.__importStar(s(591312)),a=i.__importStar(s(626065)),l=i.__importDefault(s(760989));class d{constructor(e){this._capabilities=e,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformFlagNode=this._toUnhandledEntity,this.transformLegacyQuoteNode=this._default,this.transformBingResponseNode=this._default,this.transformDeepLinkNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformContextNode=this._toUnhandledEntity,this.transformRosterContextNode=this._toUnhandledEntity,this.transformLocationContextNode=this._toUnhandledEntity,this.transformSuggestedTextHighlightNode=this._toUnhandledEntity,this.transformUnknownNode=this._default,this.transformSwiftNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformTranslationNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,n.chain)(e.children,(0,n.map)((e=>e&&e.accept(this))),(0,n.compact)(),(0,n.flatten)())}_toUnhandledEntity(e,t){return o.isString(t)||(t=r.renderText(e)),[new a.UnhandledEntity(t)]}transform(e){return e.accept(this)}transformRootNode(e){if(!this._capabilities.supportHTML)return this._default(e);const t=e.getQuoteNodes();return[...Array.prototype.concat(...t.map(this.transformQuoteNode)),new a.HtmlEntity("",e.children.filter((e=>!t.includes(e))).map((e=>e.encodeToString().replace(/\n/g,"<br>"))).join(""))]}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformAtMentionNode(e){var t;let s=null===(t=e.children[0])||void 0===t?void 0:t.getRawText();return e.isAllMention()&&(s=e.getLocalizedAllMention()),[new a.AtMentionEntity(s,e.id,void 0,void 0,e.itemid)]}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoticonNode(e){return this._capabilities.supportEmoticons?[new a.EmoticonEntity(r.renderText(e),e.type,e.tone)]:this._toUnhandledEntity(e)}transformQuoteNode(e){return[new a.QuoteEntity(e)]}transformWikiMarkupNode(e){const t=this._default(e),s=l.default.unescapeXml(e.rawPre),i=e.rawPost&&l.default.unescapeXml(e.rawPost);return this._capabilities.supportHtmlAndroid?[new a.HtmlEntity("",e.encodeToString())]:[new a.WikiMarkupEntity(t,e.getTag(),s,i)]}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformEmoteNode(e){return[new a.EmoteEntity(e)]}transformLinkNode(e){if(this._capabilities.supportLinkEntity){const t=e.children.length>0?e.children[0].getRawText():e.getSanitizedHref();return[new a.LinkEntity(t,e.getSanitizedHref())]}return this._toUnhandledEntity(e)}transformAttributionNode(e){var t;if(this._capabilities.supportLinkEntity){const s=null===(t=e.children[0])||void 0===t?void 0:t.getRawText();return[new a.AttributionEntity(null!=s?s:e.getSanitizedHref(),e.getSanitizedHref(),e.index)]}return this._toUnhandledEntity(e)}}t.ContentToInputEntityTransformer=d},559210:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quoteRenderer=void 0,t.quoteMessage=function(e,s){const i=n.getSkypeIdFromMri(e.creator);s=o.isString(s)?s:i;const d=Math.round(e.createdTime/1e3),c=r.decode(e);if(c.hasOnlyQuotedContent()&&c.children[0]instanceof a.QuoteNode)return c.children[0];return function(e,s,i,n,r){const d=o.flatten([a.LegacyQuoteNode.parse([a.PlainTextNode.fromPlainText("["+n+"] "+(i||s)+": ")]),t.quoteRenderer.transform(e),a.LegacyQuoteNode.parse([a.PlainTextNode.fromPlainText("\n\n<<< ")])]);let c;if(r.isBookmark()){const e=r.getBookmarkMetadata();c=e&&e.bookmarkSourceConversationId}return new a.QuoteNode(d,s&&l.default.escapeXml(s),i&&l.default.escapeXml(i),n,c||r.conversationId,r.getOriginalServerId(),r.cuid)}(c,i,s,d,e)};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(44717)),r=i.__importStar(s(463519)),a=i.__importStar(s(606933)),l=i.__importDefault(s(760989)),d=s(677982);t.quoteRenderer=new class{constructor(){this.transformRootNode=this._default,this.transformPlainTextNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._default,this.transformFlagNode=this._default,this.transformLegacyQuoteNode=this._default,this.transformWikiMarkupNode=this._default,this.transformListWikiMarkupNode=this._default,this.transformLinkNode=this._default,this.transformBingResponseNode=this._default,this.transformDeepLinkNode=this._default,this.transformAttributionNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformEmoteNode=this._default,this.transformContextNode=this._asEmpty,this.transformRosterContextNode=this._asEmpty,this.transformLocationContextNode=this._asEmpty,this.transformSwiftUriObjectNode=this._default,this.transformSwiftNode=this._default,this.transformScheduledCallInviteNode=this._default,this.transformAdaptiveCardNode=this._asEmpty,this.transformUnknownNode=this._default,this.transformTextWrapperNode=this._default,this.transformTargetUserNode=this._default,this.transformTargetLegacyUserNode=this._default,this.transformTargetRoleNode=this._default,this.transformTargetsNode=this._default,this.transformContactNode=this._default,this.transformContactsNode=this._default,this.transformFileNode=this._default,this.transformFilesNode=this._default,this.transformPollNode=this._default,this.transformMetaNode=this._default,this.transformUriObjectNode=this._default,this.transformUriObjectFileNode=this._default,this.transformPictureNode=this._default,this.transformVideoNode=this._default,this.transformVideoMessageNode=this._default,this.transformAudioNode=this._default,this.transformAudioMessageNode=this._default,this.transformSkypeVideoMessageNode=this._default,this.transformStickerNode=this._default,this.transformCallInfoUriObjectNode=this._default,this.transformAddMemberNode=this._default,this.transformDeleteMemberNode=this._default,this.transformRoleUpdateNode=this._default,this.transformTopicUpdateNode=this._default,this.transformHandshakeInviteNode=this._default,this.transformHandshakeAcceptNode=this._default,this.transformHandshakeCompleteNode=this._default,this.transformHandshakeRejectNode=this._default,this.transformPictureUpdateNode=this._default,this.transformHistoryDisclosedUpdateNode=this._default,this.transformJoiningEnabledUpdateNode=this._default,this.transformLegacyMemberAddedNode=this._default,this.transformLegacyMemberUpgradedNode=this._default,this.transformPartNode=this._default,this.transformPartListNode=this._default,this.transformEndedNode=this._default,this.transformNgcUpgradeNode=this._default,this.transformHtmlNode=this._default,this.transformCallerIDNode=this._asEmpty,this.transformMediaAlbumNode=this._asEmpty,this.transformDataNode=this._asEmpty,this.transformGuestNameUpdateNode=this._default,this.transformGuestNameUpdateTargetNode=o.identity,this.transformMagicBotToolboxNode=this._default,this.transformImageCreatorPictureNode=this._default}_default(e){const t=o.map(e.children,(e=>e&&e.accept(this)));return e.cloneWithChildren(t)}_asEmpty(e){return a.PlainTextNode.fromPlainText("")}transform(e){return e.accept(this)}transformHighlightedNode(e){const[t]=e.children;if(t)return t.accept(this)}transformAtMentionNode(e){return this._default(a.AtMentionNode.transformToNonAlertingNode(e))}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformQuoteNode(e){return this._asEmpty(e)}transformSmsNode(e){return a.PlainTextNode.fromPlainText(e.smsContentUnescaped)}transformMmsNode(e){return a.MmsNode.parseMms(e.rawContent)}transformTranslationNode(e){return a.TranslationNode.parse(e.translation,e.originalLocale)}transformLocationNode(e){return d.AppConfigStore.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?a.LocationNode.parse(e.children,e.encodedAttr()):a.PlainTextNode.fromPlainText(e.addressSanitized)}}},591312:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentToTextTransformer=void 0,t.renderText=function(e,t={}){try{const s=n.defaults(t,{utfFallback:t.utfFallback||!1,onlyQuotedContent:e&&e.hasOnlyQuotedContent&&e.hasOnlyQuotedContent(),processing:t.processing||{},lineBreakString:"\r"}),i=new C(s);return i.transform(e).value||""}catch(e){m.error(h.LogTraceArea.GenericUnsafe,"ContentToTextTransformer: Failed to transform tree: "+y.default.errorAsString(e))}return""};const i=s(197582),o=i.__importStar(s(823719)),n=i.__importStar(s(496486)),r=s(852930),a=i.__importStar(s(788286)),l=i.__importStar(s(44717)),d=i.__importStar(s(194504)),c=s(229620),u=i.__importStar(s(242561)),h=s(815146),p=s(287167),g=s(525097),m=i.__importStar(s(85385)),S=i.__importStar(s(704704)),_=i.__importDefault(s(363091)),f=s(638340),y=i.__importDefault(s(655192)),v=i.__importDefault(s(760989));class C extends d.TransformerBase{constructor(e){super(),this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._skip,this.transformAtMentionNode=e=>{const t=this._renderTextNodes(e.children);let s=t.value;return e.isAllMention()&&(s=e.getLocalizedAllMention()),Object.assign(Object.assign({},t),{value:s})},this.transformFlagNode=this._default,this.transformLegacyQuoteNode=this._skip,this.transformBingResponseNode=this._default,this.transformDeepLinkNode=this._default,this.transformAttributionsTextNode=this._default,this.transformContextNode=this._default,this.transformSuggestedTextHighlightNode=this._default,this.transformSwiftNode=this._skip,this.transformAdaptiveCardNode=this._skip,this.transformUnknownNode=this._default,this.transformTextWrapperNode=this._skip,this.transformTargetUserNode=this._skip,this.transformTargetLegacyUserNode=this._skip,this.transformTargetRoleNode=this._skip,this.transformTargetsNode=this._skip,this.transformFileNode=this._default,this.transformScheduledCallInviteNode=this._default,this.transformLocationNode=this._default,this.transformMetaNode=this._skip,this.transformUriObjectNode=this._default,this.transformUriObjectFileNode=this._default,this.transformPictureNode=this._default,this.transformImageCreatorPictureNode=this._default,this.transformAudioNode=this._default,this.transformAudioMessageNode=this._default,this.transformVideoNode=this._default,this.transformVideoMessageNode=this._default,this.transformStickerNode=this._default,this.transformSkypeVideoMessageNode=this._default,this.transformPartNode=this._skip,this.transformEndedNode=this._skip,this.transformPollNode=this._default,this.transformMediaAlbumNode=this._default,this.transformCallInfoUriObjectNode=this._skip,this.transformCallerIDNode=this._default,this.transformDataNode=this._skip,this.transformGuestNameUpdateTargetNode=n.identity,this._options=e}static addUtfFallback(e,t){C._utfFallback[e]=t}_default(e){return this._renderTextNodes(e.children)}_skip(){return{value:void 0,stopProcessing:!1}}_renderTextNodes(e,t=""){const s=[];let i=!1;const o=e.length;for(let t=0;t<o;t++){const o=e[t];let n=o&&o.accept(this);if(n||(m.warn(h.LogTraceArea.GenericUnsafe,"renderText returned falsy",o,this._options),n={value:void 0,stopProcessing:!1}),s.push(n.value),n.stopProcessing){i=!0;break}}return{value:s.join(t),stopProcessing:i}}transform(e){return e.accept(this)}transformRootNode(e){return this._default(e)}transformPlainTextNode(e){const t=this._renderPlainText(e.getRawText(),e);return{value:n.isArray(t.value)?t.value.join(""):t.value,stopProcessing:t.stopProcessing}}_renderLineBreak(e){return this._options.trimToFirstLine?{value:void 0,stopProcessing:!0}:{value:this._options.lineBreakString,stopProcessing:!1}}transformUserMriNode(e){const t=(0,c.displayNameText)(v.default.unescapeXml(e.mri),v.default.unescapeXml(e.textNode.getRawText()));return d.trimToFirstLineIfNeeded(t,!!this._options.trimToFirstLine)}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformEmoticonNode(e){return this._options.utfFallback&&e.type in C._utfFallback?{value:C._utfFallback[e.type],stopProcessing:!1}:this._default(e)}transformQuoteNode(e){if(this._options.trimToFirstLine&&this._options.onlyQuotedContent)return{value:S.getString("ContentToTextTransformer.QuotedMessageReceivedToast"),stopProcessing:!0};switch(this._options.processing.quotes){case u.ProcessingLevel.None:return this._skip();case u.ProcessingLevel.Stripped:const t=this._default(e);return t.stopProcessing?t:{value:t.value+this._options.lineBreakString,stopProcessing:t.stopProcessing}}const t=this._options.lineBreakString,s=this._default(e);return{value:this._options.skipAuthor?"":`[${e.timestamp}] ${e.getAuthorNameWithFallbackUnescaped()}: `+s.value+(s.stopProcessing?"":t+t+"<<< "),stopProcessing:s.stopProcessing}}transformWikiMarkupNode(e){switch(this._options.processing.wikiMarkup){case u.ProcessingLevel.None:return this._skip();case u.ProcessingLevel.Stripped:return this._default(e)}const t=[e.rawPreNode,...e.children];return e.rawPostNode&&t.push(e.rawPostNode),this._renderTextNodes(t)}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformLinkNode(e){return{value:e.getSanitizedHref(),stopProcessing:!1}}transformAttributionNode(e){return e.index?{value:e.getSanitizedHref(),stopProcessing:!1}:this._default(e)}transformAttributionsGroupNode(e){const t=e.children.reduce(((e,t)=>{var s;return(null===(s=e[e.length-1])||void 0===s?void 0:s.stopProcessing)?e:e.concat([null==t?void 0:t.accept(this)])}),[]),s=t.some((e=>null==e?void 0:e.stopProcessing));return{value:t.map((e=>null==e?void 0:e.value)).join(" "),stopProcessing:s}}transformEmoteNode(e){const t=(0,c.displayNameText)(v.default.unescapeXml(e.escapedAuthorMri),v.default.unescapeXml(e.escapedFallbackText)),s=this._renderTextNodes(e.children);return{value:t+" "+s.value,stopProcessing:s.stopProcessing}}transformRosterContextNode(){return{value:void 0,stopProcessing:!0}}transformLocationContextNode(){return{value:void 0,stopProcessing:!0}}transformSwiftUriObjectNode(e){return{value:new C(this._options).transform(e.titleChild).value,stopProcessing:!1}}transformContactNode(e){return{value:d.getContactInfo(e),stopProcessing:!1}}transformContactsNode(e){if(this._options.trimToFirstLine){return{value:S.getString("ContentToDisplayTransformerBase.ContactsSent"),stopProcessing:!0}}let t;if(this._options.message&&this._options.message.creator&&!_.default.isMyMri(this._options.message.creator)){const e="ContentToDisplayTransformerBase.ContactsReceived",s={initiator:(0,c.displayNameText)(this._options.message.creator,this._options.message.creator)};t=(0,p.localizeMessageString)(this._options.message.creator,e,s)}else t=S.getString("ContentToDisplayTransformerBase.ContactsSent");const s=this._renderTextNodes(e.children,", ");return t+=": "+s.value,{value:t,stopProcessing:s.stopProcessing}}transformFilesNode(e){const t=S.getString("ContentToDisplayTransformerBase.FilesReceivedNotSupported");if(this._options.trimToFirstLine)return{value:t,stopProcessing:!0};const s=this._renderLineBreak(e),i=this._renderTextNodes(e.children,", ");return{value:[t,s.value,i.value].join(""),stopProcessing:i.stopProcessing}}transformSmsNode(e){return d.trimToFirstLineIfNeeded(e.smsContentUnescaped,!!this._options.trimToFirstLine)}transformMmsNode(e){return this._renderTextNodes(e.contentNodes)}_getThreadActivityMemberParts(e,t,s){const{authorMri:i,personMris:o}=d.getThreadActivityMemberParts(t,s);return{authorName:(0,c.displayNameText)(i,i),personNames:n.map(o,(e=>(0,c.displayNameText)(e,e))),authorMri:i}}transformAddMemberNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=d.getAddMemberLocalizeInfo(t,s.join(", "),s.length>0);let a=(0,p.localizeMessageParts)(i,o.key,o.params);if(s.length>0){const t=this._renderLineBreak(e);if(!t.stopProcessing){const{allMessagesBotsFormatted:s,atMentionOnlyBotsFormatted:i}=(0,r.getBotsForDisclosure)(e.content,e.conversationId,n.identity,(e=>"@"+e));if(s.length>0||i.length>0){const e=d.renderBotDisclosureParts(s,i);a=a.concat(t.value,n.compact(e))}}}return{value:a.join(""),stopProcessing:!1}}transformDeleteMemberNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=l.isThread(i)?void 0:t,{key:n,params:r}=d.getDeleteMemberNodeLocalizeInfo(o,s.join(", "),s.length>0);return{value:(0,p.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformRoleUpdateNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,[e.content[0]]),o=e.content[0].roleChild.getRawText(),{key:n,params:r}=d.getRoleUpdateNodeLocalizeInfo(t,s.join(", "),o);return{value:(0,p.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformTopicUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),i=e.content.getRawText(),{key:o,params:n}=d.getTopicUpdateNodeLocalizeInfo(t,i);return{value:(0,p.localizeMessageParts)(s,o,n).join(""),stopProcessing:!1}}transformHandshakeInviteNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=_.default.isMyMri(i),{key:n,params:r}=d.getHandshakeInviteNodeLocalizedInfo(o?s[0]:t,o);return{value:(0,p.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformHandshakeAcceptNode(e){const{authorName:t,personNames:s,authorMri:i}=this._getThreadActivityMemberParts(this._options,e.initiator,e.content),o=_.default.isMyMri(i),{key:n,params:r}=d.getHandshakeAcceptNodeLocalizedInfo(o?s[0]:t,o);return{value:(0,p.localizeMessageParts)(i,n,r).join(""),stopProcessing:!1}}transformHandshakeCompleteNode(){return{value:S.getString("ContentToDisplayTransformerBase.E2eeInvitationConfirmed"),stopProcessing:!1}}transformHandshakeRejectNode(){return{value:S.getString("ContentToDisplayTransformerBase.E2eeInvitationRejected"),stopProcessing:!1}}transformPictureUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=d.getPictureUpdateNodeLocalizeInfo(t);return{value:(0,p.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformHistoryDisclosedUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=d.getHistoryDisclosedUpdateLocalizeInfo(t,e.nowDisclosed);return{value:(0,p.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformJoiningEnabledUpdateNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=d.getJoiningEnabledUpdateNodeLocalizeInfo(t,e.nowEnabled);return{value:(0,p.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformLegacyMemberAddedNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),i=this.transformLinkNode(e.link),{key:o,params:n}=d.getLegacyMemberAddedNodeLocalizeInfo(t,i.value);return{value:(0,p.localizeMessageParts)(s,o,n).join(""),stopProcessing:i.stopProcessing}}transformLegacyMemberUpgradedNode(e){const{authorName:t,authorMri:s}=this._getThreadActivityMemberParts(this._options,e.initiator),{key:i,params:o}=d.getLegacyMemberUpgradedNodeLocalizeInfo(t);return{value:(0,p.localizeMessageParts)(s,i,o).join(""),stopProcessing:!1}}transformPartListNode(e){const t=a.default.calculateCallMarkerInfo(e);return{value:a.CallMarkerDisplayUtils.getText(t.type,t.duration),stopProcessing:!1}}transformNgcUpgradeNode(e){return{value:(0,f.ngcUpgradeMessageText)(e.userMrisOrNames),stopProcessing:!1}}transformTranslationNode(e){return{value:e.translation,stopProcessing:!1}}_getHtmlInnerTextWalker(e,t){n.each(e,(e=>{if(o.DomUtils.isTag(e)){const s=o.DomUtils.getName(e);if("br"===s)t.text+="\n",t.pendingSeparator=void 0;else if("img"===s&&e.attribs&&e.attribs.alt&&e.attribs.itemtype===g.SemanticObjectSchemas.emoji)t.text+=e.attribs.alt;else{const i=["p","div","h1","h2","h3","h4","h5","h6","tr","img"],o=n.indexOf(i,s)>=0?"\n":void 0;t.pendingSeparator=o,e.children&&this._getHtmlInnerTextWalker(e.children,t),t.pendingSeparator=t.pendingSeparator||o}}else{const s=o.DomUtils.getText(e).replace(/\r?\n/g," ");s&&(t.text+=(t.text&&t.pendingSeparator?t.pendingSeparator:"")+s,t.pendingSeparator=void 0)}}))}_getHtmlInnerText(e){const t={text:""};return this._getHtmlInnerTextWalker(e,t),n.trim(t.text," ").replace(/ +(?= )/g,"")}transformHtmlNode(e){let t=this._getHtmlInnerText(e.getHtmlDom());const s=this._renderTextNodes(e.children,this._options.lineBreakString);return s.value&&(t+=this._options.lineBreakString+s.value),{value:t,stopProcessing:s.stopProcessing}}transformGuestNameUpdateNode(e){var t;const s=null===(t=n.first(e.content))||void 0===t?void 0:t.encodedAttr(),i=null==s?void 0:s.newName,o=null==s?void 0:s.oldName;return{value:i&&o?S.getString("ContentToDisplayTransformerBase.GuestNameUpdate",{oldName:o,newName:i}):void 0,stopProcessing:!1}}transformMagicBotToolboxNode(e){return{value:e.label,stopProcessing:!1}}}t.ContentToTextTransformer=C,C._utfFallback={}},463519:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0,t.registerParser=function(e){t.Parser=e},t.decodeFromContent=function(e){return m(e,void 0,"message content string")},t.decode=function(e,t,s){if(e instanceof u.default)return m(e.content,e,"messageLocal");{const i={creator:t,conversationId:s,content:e.content,contenttype:e.contenttype,messagetype:e.messagetype,properties:e.properties,skypeeditoffset:e.skypeeditoffset,skypeemoteoffset:e.skypeemoteoffset?parseInt(e.skypeemoteoffset,10):void 0,skypeguid:e.skypeguid,isMessageLie:()=>!e.id,isEmote:()=>!!e.skypeemoteoffset};return m(i.content,i,"messagePosting")}};const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(150343)),a=i.__importStar(s(971988)),l=i.__importStar(s(242561)),d=s(815146),c=i.__importStar(s(85385)),u=i.__importDefault(s(997226)),h=i.__importDefault(s(655192)),p=i.__importDefault(s(760989)),g=i.__importStar(s(518214));function m(e,s,i){try{return function(e,s){let i=e||"",n=0;s&&s.skypeeditoffset&&s.skypeeditoffset>0&&(n+=Number(s.skypeeditoffset));let r,u="";if(s&&s.isEmote()){const e=s&&s.skypeemoteoffset;e&&e>0&&(n>0&&c.error(d.LogTraceArea.Deserializer,"Both skypeeditoffset and skypeemoteoffset: which comes first?",o.pii.Omit(JSON.stringify(s))),n+=e,u=i.substring(0,e))}n>0&&(i=i.substring(n));let h=!1;const m=!s||!s.messagetype||a.isXmlMessageType(s.messagetype);if(!s||m){if(i&&i.indexOf("<")>-1){const e=g.parse(i,l.rootTagName);if(e){r=_(S(e,s),s)}else c.log(d.LogTraceArea.Deserializer,"Could not XML parse content",o.pii.Omit(JSON.stringify({content:i,item:s}))),h=!0}}else if(s&&(a.isJsonMessageType(s.messagetype)||a.isHtmlMessageType(s.messagetype))){const e=t.Parser.parseFromMessageType(i,s.messagetype,s);e?r=t.Parser.root([e]):h=!0}if(!r){m||(i=p.default.escapeXml(i));const e=t.Parser.parseXmlText(i);r=_(t.Parser.root([e],h),s)}s&&s.isEmote()&&(r=t.Parser.emote(r,s.creator,u));return r}(e,s)}catch(e){return c.error(d.LogTraceArea.Deserializer,"Failed to parse "+i,h.default.errorAsString(e)),t.Parser.root([],!0)}}function S(e,s){const i=n.clone(e.attributes),o=[];n.each(e.children,(e=>{if(e.isTag){const t=S(e,s);o.push(t)}else{const s=e,i=t.Parser.parseXmlText(s.string);o.push(i)}}));const r=t.Parser.parse(o,i,e.name,s);return r||t.Parser.parseUnknown(o,i,e.name,s)}function _(e,s){if(!r.default.getS4LMessagingFeaturesNoSubscription().transformCorruptedMessages||!s)return e;let i;try{i=a.getMessageTypeGroup(s)}catch(t){return c.error(d.LogTraceArea.Deserializer,"Failed to transform corrupted message - Unknown message type.",o.pii.Omit(JSON.stringify(s))),e}const l=[a.MessageTypeGroups.System,a.MessageTypeGroups.Calling];if(n.includes(l,i)&&e.children&&1===e.children.length){const i=e.children[0];if(i&&s&&!n.includes(i.getMessageTypes(),s.messagetype)){const e=t.Parser.parseUnknown([],{},"",s);return t.Parser.root([e],!1)}}return e}t.Parser=void 0},626065:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlEntity=t.MagicBotToolboxInputEntity=t.GuestNameUpdateEntity=t.TranslationSettingsEntity=t.DataEntity=t.DeepLinkContextEntity=t.DeepLinkEntity=t.ContextEntity=t.NewTopicContextEntity=t.BingContextEntity=t.PartListEntity=t.CallInfoEntity=t.CallReactionMetadataEntity=t.SwiftEntity=t.LocationEntity=t.GeoLocationEntity=t.AdaptiveUriObjectEntity=t.PollInputEntity=t.ScheduledCallInviteUriObjectEntity=t.SwiftUriObjectEntity=t.MediaAlbumEntity=t.MediaEntity=t.StickerEntity=t.CallerIDEntity=t.WikiMarkupEntity=t.AttributionEntity=t.LinkEntity=t.SmsEntity=t.ContactEntity=t.QuoteEntity=t.CommandEntity=t.SuggestedTextHighlightEntity=t.FlagEntity=t.EmoticonEntity=t.EmoteEntity=t.AtMentionEntity=t.DoNotFormatEntity=t.EditMessageMetaDataEntity=t.EscapedEntity=t.UnhandledEntity=t.InputEntity=void 0;const i=s(197582),o=s(785893),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importDefault(s(150343)),l=i.__importStar(s(987364)),d=(i.__importStar(s(44717)),i.__importStar(s(591312))),c=i.__importStar(s(766698)),u=i.__importDefault(s(389659)),h=i.__importStar(s(242561)),p=s(815146),g=i.__importStar(s(85385)),m=i.__importStar(s(704704)),S=i.__importStar(s(606933)),_=s(186907),f=i.__importStar(s(115578)),y=s(705427),v=s(36381),C=i.__importDefault(s(902530)),T=i.__importDefault(s(160049)),M=i.__importDefault(s(139221)),b=s(331079),I=i.__importDefault(s(220534)),w=i.__importDefault(s(760989));class P{constructor(e){this.children=e}renderReact(e,t){return(0,o.jsx)(r.Text,{style:e.defaultStyle,textBreakStrategy:"simple",children:this.children[0]},t)}}t.InputEntity=P;class k extends P{constructor(e){super(e?n.isString(e)?[e]:e:[])}text(){return this.children.join("")}decode(){return S.PlainTextNode.fromPlainText(this.text())}appendText(e){e&&this.children.push(e)}renderReact(e,t){return(0,o.jsx)(r.Text,{style:e.defaultStyle,textBreakStrategy:"simple",children:this.text()},t)}}t.UnhandledEntity=k;t.EscapedEntity=class extends P{constructor(e){super([e])}text(){return this.children.join("")}decode(){return S.PlainTextNode.fromEscapedXml(this.text())}};t.EditMessageMetaDataEntity=class extends P{constructor(e,t,s=(t?Math.floor(t/1e3):void 0),i=S.EditMessageMetaDataNode.ExpectedT){super([]),this.fallbackSkypeId=e,this.originalArrivalTime=t,this.originalArrivalTimeSeconds=s,this.t=i}text(){return""}decode(){return S.EditMessageMetaDataNode.parse([],{a:w.default.escapeXml(this.fallbackSkypeId),ts_ms:""+this.originalArrivalTime,ts:""+this.originalArrivalTimeSeconds,t:""+this.t})}renderReact(e,t){return null}};t.DoNotFormatEntity=class extends P{constructor(e){super([e])}text(){return this.children[0]}decode(){return S.PlainTextNode.fromEscapedXml(this.text())}};class A extends P{constructor(e,t,s,i,o){super([e]),this.userMri=t,this.shortName=s,this.displayName=i,this.itemid=o}text(){return this.children[0]}decode(){return S.AtMentionNode.parse([S.PlainTextNode.fromPlainText(this.children[0])],{id:w.default.escapeXml(this.userMri),itemid:this.itemid})}clone(e){return new A(e,this.userMri,this.shortName,this.displayName,this.itemid)}renderReact(e,t){return(0,o.jsx)(r.Text,{style:n.compact([e.defaultStyle,e.atMentionStyle]),textBreakStrategy:"simple",children:this.children[0]},t)}}t.AtMentionEntity=A;t.EmoteEntity=class extends P{constructor(e){super([e.escapedFallbackText]),this._escapedFallbackText=e.escapedFallbackText,this.fallbackText=w.default.unescapeXml(this._escapedFallbackText)}text(){return""}decode(){return S.PlainTextNode.fromEscapedXml(this._escapedFallbackText)}renderReact(e,t){return null}};t.EmoticonEntity=class extends P{constructor(e,t,s){super([e]),this.emoticonName=t,this.tone=s}text(){const e=this.children[0];if(this.tone&&e.length>2&&"("===n.first(e)&&")"===n.last(e)){const t=_.DiverseToneSeparator+this.tone+")";if(!n.endsWith(e,t))return e.slice(0,-1)+t}return e}defaultToneText(){return this.children[0]}decode(){const e=w.default.escapeXml(this.emoticonName),t=w.default.escapeXml(this.text());return S.EmoticonNode.parse([S.PlainTextNode.fromEscapedXml(t)],{type:e,tone:String(this.tone)})}renderReact(e,t){return(0,o.jsx)(r.Text,{style:n.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple",children:this.children[0]},t)}};t.FlagEntity=class extends P{constructor(e,t){super([e]),this.flagName=t}text(){return this.children[0]}decode(){return S.FlagNode.parse([S.PlainTextNode.fromPlainText(this.children[0])],{country:w.default.escapeXml(this.flagName)})}renderReact(e,t){return(0,o.jsx)(r.Text,{style:e.emoticonAndFlagStyle,textBreakStrategy:"simple",children:this.children[0]},t)}};t.SuggestedTextHighlightEntity=class extends P{constructor(e,t,s){super([e]),this.activityId=t,this.actionsIndexes=s}text(){return this.children[0]}decode(){return S.SuggestedTextHighlightNode.parse([S.PlainTextNode.fromPlainText(this.text())],{actionsIndexes:this.actionsIndexes.join(";"),activityId:this.activityId})}};t.CommandEntity=class extends P{constructor(e,t,s,i){super([e]),this.commandName=t,this.usageHint=s,this.description=i,this.usageHint=this.usageHint||""}text(){return this.children[0]}decode(){return g.log(p.LogTraceArea.InputEntity,"Decode() called on CommandEntity",this),new k(this.text()).decode()}};t.QuoteEntity=class extends P{constructor(e,t="",s,i,o){super([]),this.quoteNode=e,this.quotedMessage=s,this.quotesTriggerType=i,this.quotesMessageType=o,this.authorname=t;const n=e;this.author=n.author,this.timestamp=n.timestamp,this.conversationId=n.conversation,this.messagetimestamp=void 0===n.messageid?void 0:Number(n.messageid)}text(e){const t=e&&e.showQuotedText?h.ProcessingLevel.Stripped:h.ProcessingLevel.None;return d.renderText(this.quoteNode,{processing:{quotes:t}})}textForSMS(){const e=u.default.getAbsoluteDisplayDateTimeString(1e3*this.timestamp),t=d.renderText(this.quoteNode,{processing:{quotes:h.ProcessingLevel.Stripped}});return e+" "+this.authorname+":\n> "+t+"\n"}decode(){return this.quoteNode}};t.ContactEntity=class extends P{constructor(e,t,s,i,o){super([]),this._skypeId=e,this._fullName=t,this._isPstn=s,this._pstnName=i,this._isS4B=o}getSkypeId(){return this._skypeId}getFullName(){return this._fullName}isPstn(){return this._isPstn}isS4B(){return this._isS4B}text(){return""}decode(){const e=S.ContactNode.parse([],{t:S.ContactNode.getEncodedTypeAttr(this._isPstn,this._isS4B),p:this._pstnName,s:this._skypeId,f:this._fullName});return S.ContactsNode.parse([e])}};t.SmsEntity=class extends P{constructor(e,t){super([]),this._smsTextUnescaped=e,this._smsReceipient=t,this._flowId=T.default.getFlowId(),this._deliveryMethodText="reliable",this._uiVersion=M.default.getUIVersion(),this._fingerprint=C.default.CallingFingerprintId.get(),this._restApiVersion="2"}text(e){return this._smsTextUnescaped}decode(){const e=w.default.newGuid(),t=[S.UnknownNode.parse([S.PlainTextNode.fromPlainText("chatservice")],{},"deliveryReportVersion"),S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._uiVersion)],{},"uiVersion")],{enableSmsFingerprintId:s,smsFingerprintIdTag:i}=a.default.dangerouslyGetS4LMessagingFeatures();return s&&this._fingerprint&&t.push(S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._fingerprint)],{},i)),S.SmsNode.parse([S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._restApiVersion)],{},"restApiVersion"),S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._smsTextUnescaped)],{},"encoded_body"),S.UnknownNode.parse([S.UnknownNode.parse(t,{},"skype"),S.UnknownNode.parse([S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._flowId)],{},"flowId"),S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._deliveryMethodText)],{},"deliveryMethod")],{},"control"),S.UnknownNode.parse([S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._smsTextUnescaped)],{},"body")],{},"content")],{},"defaults"),S.UnknownNode.parse([S.UnknownNode.parse([S.UnknownNode.parse([S.PlainTextNode.fromPlainText(e)],{},"requestId"),S.UnknownNode.parse([S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this._smsReceipient)],{},"address")],{},"recipient")],{},"bulkItem")],{},"bulkItems")],{alt:w.default.escapeXml(this._smsTextUnescaped)})}renderReact(e){return(0,o.jsx)(r.Text,{style:n.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple",children:this._smsTextUnescaped},"smsEntity")}};class x extends P{constructor(e,t){super([e]),this.href=t}text(){return this.children[0]}computeType(){const e=I.default.getURIComponents(this.href);return e&&e.type}decode(){return S.LinkNode.parse([S.PlainTextNode.fromPlainText(this.children[0])],{href:w.default.escapeXml(this.href)})}}t.LinkEntity=x;t.AttributionEntity=class extends P{constructor(e,t,s){super([e]),this.href=t,this.index=s}text(){return this.children[0]}decode(){return S.AttributionNode.parse([S.PlainTextNode.fromPlainText(this.children[0])],{href:w.default.escapeXml(this.href),index:this.index})}};t.WikiMarkupEntity=class extends P{constructor(e,t,s,i){super(e),this.tag=t,this.raw_pre=s,this.raw_post=i}text(){return this.raw_pre+n.map(this.children,(e=>e.text())).join("")+(this.raw_post||"")}decode(){const e=n.map(this.children,(e=>e.decode()));return S.WikiMarkupNode.parse(e,{raw_pre:w.default.escapeXml(this.raw_pre),raw_post:this.raw_post&&w.default.escapeXml(this.raw_post)},this.tag)}renderReact(e,t){return(0,o.jsx)(r.Text,{style:e.defaultStyle,textBreakStrategy:"simple",children:this.text()},t)}};t.CallerIDEntity=class extends P{constructor(e){super([e]),this._layoutOption=e}text(){return""}decode(){return S.CallerIDNode.parse([],{layoutOption:this._layoutOption})}};t.StickerEntity=class extends P{constructor(e,t,s,i,o=m.getString("InputEntity.StickerFallbackText"),n=a.default.getS4LMessagingFeaturesNoSubscription().stickersNotSupportedFallbackUrl){super([n]),this.id=e,this.uri=t,this.url_thumbnail=s,this.originalName=i,this.fallbackMessage=o,this.fallbackUrl=n}text(){return this.children[0]}decode(){const e=[S.PlainTextNode.fromPlainText(this.fallbackMessage),S.LinkNode.parseFromHref(this.fallbackUrl)];return this.originalName&&e.push(S.UnknownNode.parse([],{v:w.default.escapeXml(this.originalName)},"OriginalName")),S.UriObjectNode.parse(e,{uri:w.default.escapeXml(this.uri),url_thumbnail:w.default.escapeXml(this.url_thumbnail),type:"Sticker.1"})}renderReact(e,t){return(0,o.jsx)(r.Text,{style:n.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple",children:this.children[0]},t)}};t.MediaEntity=class extends P{constructor(e,t,s,i,o,n,r,a,l,d,c){super([s]),this.localUri=e,this.localThumbnailUrl=t,this.fallbackUrl=s,this.azureMSUrl=i,this.uploadType=o,this.filename=n,this.fileSize=r,this.dimensions=a,this.amsDocumentId=l,this.audioMessageDurationMs=d,this.whiteboardContainerId=c}text(){return this.children[0]}decode(){let e,t,s;switch(this.uploadType){case b.UploadFileType.Picture:t="Picture",e=m.getString("InputEntity.SharedPhotoFallbackText");break;case b.UploadFileType.ImageCreatorPicture:t="Picture",s="ImageCreator",e=m.getString("InputEntity.SharedPhotoFallbackText");break;case b.UploadFileType.Video:t="Video",e=m.getString("InputEntity.SharedVideoFallbackText");break;case b.UploadFileType.VideoMessage:t="Video",s="Message",e=m.getString("InputEntity.VideoMessageFallbackText");break;case b.UploadFileType.Audio:t="Audio",e=m.getString("InputEntity.AudioFileFallbackText");break;case b.UploadFileType.AudioMessage:t="Audio",s="Message",e=m.getString("InputEntity.AudioMessageFallbackText");break;case b.UploadFileType.PDF:t="File",s="PDF",e=m.getString("InputEntity.FileFallbackText");break;case b.UploadFileType.Word:t="File",s="Word",e=m.getString("InputEntity.FileFallbackText");break;case b.UploadFileType.Excel:t="File",s="Excel",e=m.getString("InputEntity.FileFallbackText");break;case b.UploadFileType.Powerpoint:t="File",s="Powerpoint",e=m.getString("InputEntity.FileFallbackText");break;case b.UploadFileType.AVI:t="File",s="AVI",e=m.getString("InputEntity.FileFallbackText");break;case b.UploadFileType.Zip:t="File",s="Zip",e=m.getString("InputEntity.FileFallbackText");break;default:case b.UploadFileType.File:t="File",e=m.getString("InputEntity.FileFallbackText")}const i={uri:this.amsDocumentId?l.getLegacyDocumentUrl(this.amsDocumentId):w.default.escapeXml(this.localUri),url_thumbnail:this.amsDocumentId?l.getLegacyDisplayUrl(this.amsDocumentId,this.uploadType):this.localThumbnailUrl&&w.default.escapeXml(this.localThumbnailUrl),url_azurems:this.azureMSUrl&&w.default.escapeXml(this.azureMSUrl),type:t+".1"+(s?"/"+s+".1":""),doc_id:this.amsDocumentId,duration_ms:this.audioMessageDurationMs,whiteboardContainerId:this.whiteboardContainerId};this.dimensions&&(i.width=this.dimensions.width.toString(),i.height=this.dimensions.height.toString());const o=this.filename&&w.default.escapeXml(this.filename),r=[S.PlainTextNode.fromPlainText(e),S.LinkNode.parseFromHref(this.fallbackUrl),S.UnknownNode.parse([],{v:o},"OriginalName"),S.UnknownNode.parse([],{v:this.fileSize},"FileSize")];[b.UploadFileType.Picture,b.UploadFileType.ImageCreatorPicture].includes(this.uploadType)&&!n.isEmpty(o)&&r.push(S.MetaNode.parse([],{type:"photo",originalName:o},"meta",void 0));return S.UriObjectNode.parseFromSanitizedParts(r,i,this.localUri,this.localThumbnailUrl,this.azureMSUrl,void 0)}renderReact(e,t){return(0,o.jsx)(r.Text,{style:n.compact([e.defaultStyle,e.emoticonAndFlagStyle]),textBreakStrategy:"simple",children:this.children[0]},t)}};t.MediaAlbumEntity=class extends P{constructor(e){super([""]),this.albumId=e}text(){return""}decode(){const e={albumId:this.albumId};return S.MediaAlbumNode.parse([],e)}};class D extends P{constructor(e,t,s,i,o){super(o?[o]:[D.DEFAULT_FALLBACK_URI]),this.conversationId=e,this.skipSanitization=t,this.title=s,this.url_thumbnail=D.DEFAULT_THUMBNAIL_URI,this.fallbackUrl=D.DEFAULT_FALLBACK_URI,i&&(this.url_thumbnail=i),o&&(this.fallbackUrl=o)}text(){return this.children[0]}decode(){const e=m.getString("InputEntity.SwiftFallbackText"),t={type:"SWIFT.1",uri:void 0,url_thumbnail:w.default.escapeXml(this.url_thumbnail)},s=[S.PlainTextNode.fromPlainText(e),S.LinkNode.parseFromHref(this.fallbackUrl),S.UnknownNode.parse([S.PlainTextNode.fromPlainText(this.title)],{},"Title")],i=this._getCardNode();i&&s.push(i);return S.UriObjectNode.parseFromSanitizedParts(s,t,void 0,this.url_thumbnail,void 0,void 0)}renderReact(e,t){return null}}D.DEFAULT_THUMBNAIL_URI="https://urlp.asm.skype.com/v1/url/content?url=https://neu1-urlp.secure.skypeassets.com/static/card-128x128.png",D.DEFAULT_FALLBACK_URI="https://go.skype.com/cards.unsupported";t.SwiftUriObjectEntity=class extends D{constructor(e,t,s,i,o,n){super(t,s,i,o,n),this.swiftMessage=e}_getCardNode(){return S.SwiftNode.parseSwift(this.swiftMessage,this.conversationId,void 0,this.skipSanitization)}};class R extends P{constructor(e,t,s,i="",o,n){super([i]),this._scheduledCallId=e,this._datetimeMs=t,this._reminder=s,this._subject=i,this._canceledTimeMs=o,this._editedTimeMs=n,this._fallbackMessage=m.getString("InputEntity.CallInviteFallbackText"),this._fallbackUrl=a.default.getS4LCMCFeaturesNoSubscription().scheduledCallNotSupportedFallbackUrl}static fromScheduledCall(e){return new R(e.id,e.datetimeMs.toString(),e.reminder.toString(),e.subject,e.canceledTimeMs&&e.canceledTimeMs.toString()||void 0,e.editedTimeMs&&e.editedTimeMs.toString()||void 0)}text(e){return this._subject}decode(){const e=[S.PlainTextNode.fromPlainText(this._fallbackMessage),S.LinkNode.parseFromHref(this._fallbackUrl)],t={type:v.ScheduleCallMessageNodeName,scheduledCallId:this._scheduledCallId,datetimeMs:this._datetimeMs,reminder:this._reminder,subject:this._subject,canceledTimeMs:this._canceledTimeMs,editedTimeMs:this._editedTimeMs};return S.UriObjectNode.parseFromSanitizedParts(e,t,void 0,void 0,void 0,void 0)}}t.ScheduledCallInviteUriObjectEntity=R;t.PollInputEntity=class extends P{constructor(e,t,s,i){super([e]),this._title=e,this._expirationDate=t,this._options=s,this._allowMultupleVotes=i}text(){return this._title}decode(){const e=[];this._title&&e.push(S.PlainTextNode.fromPlainText(this._title));const t={type:y.PollCardNodeName,title:this._title,expirationTimeMs:this._expirationDate,optionsEncoded:f.encodePollOptions(this._options),allowMultipleVotes:this._allowMultupleVotes?"true":"false"};return S.UriObjectNode.parseFromSanitizedParts(e,t,void 0,void 0,void 0,void 0)}};t.AdaptiveUriObjectEntity=class extends D{constructor(e,t,s,i,o,n){super(t,s,i,o,n),this.adaptiveMessage=e}_getCardNode(){return S.AdaptiveCardNode.parseAdaptiveCard(this.adaptiveMessage,this.conversationId,void 0)}};t.GeoLocationEntity=class extends P{constructor(e,t,s,i,o,n,r,a,l,d,c,u,h,p,g,m=[]){super(m),this.isUserLocation=e,this.userMri=t,this.latitude=s,this.longitude=i,this.accuracy=o,this.timestamp=n,this.timezone=r,this.altitude=a,this.locale=l,this.language=d,this.address=c,this.name=u,this.img=h,this.addressFriendlyName=p,this.shortAddress=g}text(){return""}decode(){const e={isUserLocation:this.isUserLocation?"1":"0",latitude:n.isFinite(this.latitude)?Math.round(1e6*this.latitude):void 0,longitude:n.isFinite(this.longitude)?Math.round(1e6*this.longitude):void 0,horizontalAccuracy:n.isFinite(this.accuracy)?this.accuracy:void 0,verticalAccuracy:n.isFinite(this.accuracy)?this.accuracy:void 0,timeStamp:n.isFinite(this.timestamp)?this.timestamp:void 0,altitude:n.isFinite(this.altitude)?Math.round(100*this.altitude):void 0,timezone:n.isNil(this.timezone)?void 0:w.default.escapeXml(this.timezone),locale:n.isNil(this.locale)?void 0:w.default.escapeXml(this.locale),language:n.isNil(this.language)?void 0:w.default.escapeXml(this.language),name:n.isNil(this.name)?void 0:w.default.escapeXml(this.name),address:n.isNil(this.address)?"":w.default.escapeXml(this.address),img:n.isNil(this.img)?void 0:w.default.escapeXml(this.img),addressFriendlyName:n.isNil(this.addressFriendlyName)?"":w.default.escapeXml(this.addressFriendlyName),shortAddress:n.isNil(this.shortAddress)?"":w.default.escapeXml(this.shortAddress),userMri:n.isNil(this.userMri)?void 0:w.default.escapeXml(this.userMri)},t=n.map(this.children,(e=>e.decode()));return S.LocationNode.parse(t,e)}renderReact(e,t){return null}};t.LocationEntity=class extends P{constructor(e,t=[]){super(t),this._attributes=e,this._attributes.allowNoLink=!0}text(){return""}decode(){return S.LocationNode.parse(this.children.map((e=>e.decode())),this._attributes)}};t.SwiftEntity=class extends P{constructor(e,t,s,i=!1){if(super([""]),this.swift=e,this.conversationId=t,this._skipSanitization=i,this._b64="",s)this._b64=s;else{const e=JSON.stringify(this.swift);this._b64=c.btoaUtf8(e)}}text(){return this.children[0]}decode(){return this._decoded||(this._decoded=S.SwiftNode.parseSwift(this.swift,this.conversationId,this._b64,this._skipSanitization)),this._decoded}renderReact(e,t){return null}};t.CallReactionMetadataEntity=class extends P{constructor(e,t=b.ReactionsTextStyle.Default,s=b.ReactionsTextType.Default,i){super([""]),this.id=e,this.style=t,this.internalType=s,this.userMri=i}text(){return""}decode(){return S.UnknownNode.parse([],{id:w.default.escapeXml(this.id),style:this.style,internalType:this.internalType,userMri:this.userMri?w.default.escapeXml(this.userMri):""},"c_i")}renderReact(e,t){return null}};t.CallInfoEntity=class extends P{constructor(e,t,s,i,o,n){super([""]),this.callId=e,this.threadId=t,this.isCast=s,this.timestamp=i,this.label=o,this.locationName=n}text(){return""}decode(){const e=(this.isCast,m.getString("InputEntity.CallMessageFallback"));return S.CallInfoUriObjectNode.parse([S.PlainTextNode.fromPlainText(e)],{uri:void 0,url_thumbnail:void 0,type:"Cast.1",callId:this.callId,threadId:this.threadId,containerType:this.isCast?"Cast":"Call",timestamp:this.timestamp.toString(),label:this.label&&w.default.escapeXml(this.label),locationName:this.locationName&&w.default.escapeXml(this.locationName)})}renderReact(e,t){return null}};t.PartListEntity=class extends P{constructor(e,t,s,i){super(s),this.callId=e,this.type=t,this.alt=i}text(){return""}decode(){const e={callId:this.callId?this.callId:"",type:this.type,alt:this.alt?w.default.escapeXml(this.alt):""};return S.PartListNode.parse(this.children,e)||S.UnknownNode.parse([],e,"PartList")}};t.BingContextEntity=class extends P{constructor(e,t,s,i){super([...(null==t?void 0:t.map((e=>new B(e))))||[],...s?[new L(s.encrypted,s.source)]:[],...i?[new F]:[]]),this.attributes=e}text(){return""}decode(){return S.ContextNode.parse(this.children.map((e=>e.decode())),this.attributes)}renderReact(e,t){return null}};class L extends P{constructor(e,t){super([]),this._location=e,this._source=t}text(){return""}decode(){return S.LocationContextNode.parse([],{encrypted:this._location,source:this._source})}}class B extends P{constructor(e){super([]),this._roster=e}text(){return""}decode(){return S.RosterContextNode.parse([],{id:this._roster.id,name:this._roster.displayName})}}class F extends P{constructor(){super([])}text(){return""}decode(){return S.NewTopicContextNode.parse()}}t.NewTopicContextEntity=F;t.ContextEntity=class extends P{constructor(e){super([]),this.attributes=e}text(e){return""}decode(){return S.ContextNode.parse([],this.attributes)}renderReact(e,t){return null}};t.DeepLinkEntity=class extends P{constructor(e,t,s,i){super([new N(e,s,i),new x(e,t)])}text(){return""}decode(){return S.DeepLinkNode.parse(this.children.map((e=>e.decode())))}};class N extends P{constructor(e,t,s){super([]),this._text=e,this._deeplink=t,this._icon=s}text(){return""}decode(){return S.ContextNode.parse(this.children.map((e=>e.decode())),{text:this._text,deeplink:this._deeplink,icon:this._icon})}renderReact(e,t){return null}}t.DeepLinkContextEntity=N;t.DataEntity=class extends P{constructor(e,t,s,i){super(s),this.type=e,this.content=t,this.alt=i}text(){return""}decode(){const e={content:this.content||"",type:this.type,alt:this.alt?w.default.escapeXml(this.alt):""};return S.DataNode.parse(e)||S.UnknownNode.parse([],e,"Data")}};t.TranslationSettingsEntity=class extends P{constructor(e,t,s,i){super(s),this.type=e,this.content=t,this.alt=i}text(){return""}decode(){const e={content:this.content||"",type:this.type,alt:this.alt?w.default.escapeXml(this.alt):""};return S.TranslationSettingsNode.parse(e)||S.UnknownNode.parse([],e,"Data")}};t.GuestNameUpdateEntity=class extends P{constructor(e){super(e)}text(){return""}decode(){return S.GuestUpdateNode.parse(this.children,{},"GuestNameUpdate",void 0)}};t.MagicBotToolboxInputEntity=class extends P{constructor(e,t,s){super([""]),this._items=e,this._showMore=t,this._label=s}text(){return this.children[0]}decode(){const e=JSON.stringify(this._items),t={type:"MagicBotToolbox",itemsEncoded:c.btoaUtf8(e),showMore:this._showMore?"true":"false",label:this._label};return S.MagicBotToolboxNode.parseFromSanitizedParts([],t)}};t.HtmlEntity=class extends P{constructor(e,t){super([e]),this.html=t}text(){return this.children[0]}decode(){return S.HtmlNode.parse(this.html,void 0)}hasAtMention(e){return this.html.includes(`<at id="${e}">`)}extractLinks(){const e=[],t=/<a href="([^"]+)">/g;let s;for(;s=t.exec(this.html);)e.push(s[1]);return e}}},7040:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleSuggestedTextHighlights=function(e,t){const s=o.compact(o.map(t,(e=>e.phrase)));if(o.isEmpty(s))return e;const i=function(e){if(e.length>0){const t="("+o.map(e,(e=>o.escapeRegExp(e))).join("|")+")";return new RegExp(t,"g")}return C}(s);return T(e,i,(e=>{const s=o.find(t,(t=>t.phrase===e));return s?new c.SuggestedTextHighlightEntity(s.phrase,s.activityId,s.actionsIndexes):new c.UnhandledEntity(e)}))},t.handleEmoticons=I,t.hasOnlyEmoticonsOrWhitespaceText=function(e){const t=R(e.smsContentUnescaped);return D(t,!1).hasOnlyEmoticonsOrWhitespaceText()},t.handleLinks=k,t.encode=A,t.renderReact=function(e,t){return e.map(((e,s)=>e.renderReact(t,s)))},t.test_handleEntities=function(e){return x(e)},t.decodeFromInput=D,t.convertRawTextToInputEntities=R,t.encodeRawText=function(e){return A(R(e),!1)},t.getRawText=L,t.getTextForSms=function(e){const t=o.find(e,(e=>e instanceof c.QuoteEntity)),s=L(e);return t?(t.textForSMS()||"")+s:s},t.getEditableContentFromInputEntities=function(e,t,s){return{entities:e.map(((e,t)=>B(e,s,t))),downStreamDataVersion:t}},t.getEditableEntityFromInputEntity=B,t.applyEditableContentToInputEntities=function(e,t){const s=[];return o.each(e.entities,(e=>{let i;switch(e.type){case n.EditableEntityType.Agnostic:{const s=e;void 0!==s.originId&&s.originId<t.length&&(i=t[s.originId]);break}case n.EditableEntityType.AtMention:{const t=e;i=new c.AtMentionEntity(t.displayText,t.userMri,t.shortName,t.displayName);break}case n.EditableEntityType.Emoticon:{const t=e;i=new c.EmoticonEntity(t.displayText,t.emoticonName,t.tone);break}case n.EditableEntityType.Link:{const t=e;i=new c.LinkEntity(t.displayText,t.href);break}case n.EditableEntityType.PlainText:{const t=e;i=new c.UnhandledEntity(t.displayText);break}case n.EditableEntityType.SlashCommand:{const t=e;i=new c.CommandEntity(t.displayText,t.commandName,t.usageHint,t.description);break}case n.EditableEntityType.HTML:{const t=e;i=new c.HtmlEntity(t.displayText,t.html);break}}i&&s.push(i)})),s};const i=s(197582),o=i.__importStar(s(496486)),n=s(6625),r=s(284841),a=i.__importStar(s(463519)),l=i.__importDefault(s(794229)),d=i.__importStar(s(157013)),c=i.__importStar(s(626065)),u=s(186907),h=i.__importDefault(s(220534)),p=i.__importStar(s(117746)),g=i.__importStar(s(704704)),m=/\b(?:www\.|https?\:\/\/)[A-Z\u00a1-\uffff0-9-_.~!*'();:@&+$%,/?#[\]{|}<=>^]+/gi,S=/\b[^@\s]+@\S+\.[a-z]+/gi,_=/\bskype:(?:[^\W\s]|\.|\+|-|\:|\;)+?(?:[^\s\n\#\[\]]*)/gi,f=/\S+/g,y=".,!?:;\"'",v=/\[.*?\]\(\b(?:www\.|https?\:\/\/)[A-Z\u00a1-\uffff0-9-_.~!*'();:@&+$%,/?#[\]{|}<=>^]+?\)/gi,C=/^\b$/;function T(e,t,s){let i=[];return o.each(e,(e=>{if(!(e instanceof c.UnhandledEntity))return void i.push(e);const n=e.text();o.last(i)instanceof c.UnhandledEntity||i.push(new c.UnhandledEntity);let r,a=0;for(;r=t.exec(n);){if(r.index!==a){const e=n.substring(a,r.index);o.last(i).appendText(e)}const e=s(...r),t=o.isArray(e)?e:[e];if(o.head(t)instanceof c.UnhandledEntity){const e=t.shift();o.last(i).appendText(e.text())}i=i.concat(t),o.last(i)instanceof c.UnhandledEntity||i.push(new c.UnhandledEntity),a=r.index+r[0].length}if(a<n.length){const e=n.substring(a);o.last(i).appendText(e)}o.last(i).text()||i.pop()})),i}function M(e,t=0,s=e.length){const i=[];let o=s;for(let n=s-1;n>=t;--n){let t=e.substring(n,o);if(l.default.isEmoticon(t)){for(;n>0;){const s=e.substring(n-1,o);if(!l.default.isEmoticon(s))break;n--,t=e.substring(n,o)}const s=d.getEmoticonTone(t),r=d.getSanitizedEmoticonName(t);i.push(new c.EmoticonEntity(r,l.default.getEmoticonByShortcut(t).id,s)),o=n}else if("("===t[0]){const e=t.match(/^\(flag:(..)\)$/i);if(e){const s=e[1].toLowerCase();l.default.hasCountry(s)&&(i.push(new c.FlagEntity(t,s)),o=n)}}}return i.length?(0!==o&&i.push(new c.UnhandledEntity(e.substring(t,o))),i.reverse()):null}function b(e){for(let t=e.length;t>0;t--){const s=M(e,0,t);if(s)return t!==e.length&&s.push(new c.UnhandledEntity(e.substring(t))),1===s.length?s[0]:s;const i=e[t-1];if(-1===y.indexOf(i))break}return new c.UnhandledEntity(e)}function I(e){return T(e,f,b)}function w(e){let t=e;const s=-1===y.indexOf(o.last(t))?t.length:t.length-1;let i=s;for(;i>=0&&-1!==")>}".indexOf(t[i-1]);i--);if(i<s){const e=function(e,t){const s=o.mapValues(o.groupBy(t),o.constant(0));for(let t=0;t<e.length;t++){const i=e[t];s.hasOwnProperty(i)&&s[i]++}return s}(t.substring(0,i),"()<>{}"),n={")":e["("]-e[")"],">":e["<"]-e[">"],"}":e["{"]-e["}"]};for(;i<s;i++){const e=t[i];if(!(n.hasOwnProperty(e)&&n[e]>0))break;--n[e]}}let n="";i!==t.length&&(n=t.substring(i),t=t.substring(0,i));const r=h.default.createSanitizedHref(t);if(r){const e=new c.LinkEntity(r.text,r.href);return r.trailingCharacters||n?[e,new c.UnhandledEntity(n+(r.trailingCharacters||""))]:e}return new c.UnhandledEntity(e)}function P(e){const t=new c.UnhandledEntity(e),s=T([t],m,w),i=T(s,f,b),o=i[1],n=i[0];let r,a=n.text().trim();const l=g.getString("MessageComposer.DraftDecorator"),d=a.startsWith(l);return d&&(a=a.slice(l.length)),r=a.substring(1,a.length-2).trim(),d&&(r=l.concat(r)),o&&o.href&&n&&r.length>0?new c.LinkEntity(r,o.href):t}function k(e){const t=T(e,v,P),s=T(t,m,w),i=T(s,S,w);return T(i,_,w)}function A(e,t){return D(e,t).encodeToString()}function x(e){const{prefix:t,entities:s}=p.splitWikiMarkupPrefix(e),i=t!==p.WikiPrefix.DoNotFormat?I(s):s,o=t===p.WikiPrefix.None?function(e){return p.encodeWikiMarkupWithoutPrefix(e)}(i):i;return t===p.WikiPrefix.DoNotFormat?[new c.DoNotFormatEntity(A(o,!0))]:k(o)}function D(e,t){if(!e.length)return a.Parser.root([a.Parser.parseXmlText("")]);let s=e;t||(s=x(e));const i=o.map(s,(e=>e.decode()));return a.Parser.root(i)}function R(e){return x([new c.UnhandledEntity(e)])}function L(e,t={}){return(0,r.chain)(e,(0,r.drop)(t.startIndex||0),(0,r.map)((e=>e.text(t))),(0,r.join)(""))}function B(e,t,s){if(e instanceof c.AtMentionEntity){const t=e;return{type:n.EditableEntityType.AtMention,originId:s,displayText:t.text(),userMri:t.userMri,shortName:t.shortName||"",displayName:t.displayName||""}}if(e instanceof c.CommandEntity){const t=e;return{type:n.EditableEntityType.SlashCommand,originId:s,displayText:t.text().trim(),commandName:t.commandName,usageHint:t.usageHint,description:t.description}}if(e instanceof c.EmoteEntity){const t=e;return{type:n.EditableEntityType.Agnostic,originId:s,displayText:t.fallbackText||"?",position:n.AgnosticContentPosition.Leading}}if(e instanceof c.EmoticonEntity){const i=e,o=i.defaultToneText().toLowerCase(),r=t[d.getSanitizedEmoticonName(o)],a=r?d.getEmoticonUrl(r.id,u.EmoticonSize.Small,!0,e.tone,r.etag):void 0;return{type:n.EditableEntityType.Emoticon,originId:s,tone:i.tone,displayText:i.text(),emoticonName:i.emoticonName,url:a}}if(e instanceof c.LinkEntity){const t=e;if(t.text()===t.href||h.default.isUrlValid(t.text())){return{type:n.EditableEntityType.Link,originId:s,displayText:t.text(),href:t.href}}return{type:n.EditableEntityType.PlainText,originId:s,displayText:`[${t.text()}](${t.href})`}}if(e instanceof c.QuoteEntity){return{type:n.EditableEntityType.Agnostic,originId:s,displayText:e.text(),position:n.AgnosticContentPosition.Leading}}if(e instanceof c.UnhandledEntity){const t=e;return{type:n.EditableEntityType.PlainText,displayText:t.text(),originId:s}}if(e instanceof c.WikiMarkupEntity){const t=e;return{type:n.EditableEntityType.PlainText,displayText:t.text(),originId:s}}if(e instanceof c.HtmlEntity){const t=e;return{type:n.EditableEntityType.HTML,originId:s,displayText:t.text(),html:t.html}}return{type:n.EditableEntityType.Agnostic,originId:s,displayText:e.text()||"?",position:n.AgnosticContentPosition.InPlaceWithTextStream}}},606933:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DisplayableMedia=t.UriObjectFileNode=t.ScheduledCallInviteNode=t.AdaptiveCardNode=t.SwiftNode=t.SwiftUriObjectNode=t.UriObjectNode=t.FilesNode=t.FileNode=t.MetaNode=t.LocationNode=t.MmsNode=t.SmsNode=t.ContactsNode=t.ContactNode=t.TargetsNode=t.TargetRoleNode=t.TargetLegacyUserNode=t.TargetUserNode=t.TargetNode=t.TextWrapperNode=t.CallerIDNode=t.DeepLinkNode=t.ContextNode=t.LocationContextNode=t.NewTopicContextNode=t.RosterContextNode=t.SuggestedTextHighlightNode=t.EmoteNode=t.AttributionsGroupNode=t.AttributionsTextNode=t.AttributionNode=t.BingResponseNode=t.LinkNode=t.ListWikiMarkupNode=t.WikiMarkupNode=t.LegacyQuoteNode=t.HighlightedNode=t.QuoteNode=t.FlagNode=t.EmoticonNode=t.UnicodeEmojiNode=t.UserMriNode=t.AtMentionNode=t.EditMessageMetaDataNode=t.HtmlNode=t.PlainTextNode=t.UnknownNode=t.RootNode=t.InternalNode=void 0,t.MagicBotToolboxNode=t.GuestUpdateNode=t.GuestUpdateTargetNode=t.TranslationNode=t.TranslationSettingsNode=t.DataNode=t.PollNode=t.NgcUpgradeSystemMessageNode=t.CallReactionMetadataNode=t.CallInfoUriObjectNode=t.EndedNode=t.PartListNode=t.PartNode=t.LegacyMemberUpgradedNode=t.LegacyMemberAddedNode=t.JoiningEnabledUpdateNode=t.HistoryDisclosedUpdateNode=t.PictureUpdateNode=t.HandshakeRejectNode=t.HandshakeCompleteNode=t.HandshakeAcceptNode=t.HandshakeInviteNode=t.TopicUpdateNode=t.RoleUpdateNode=t.DeleteMemberNode=t.AddMemberNode=t.ThreadActivity=t.SkypeVideoMessageNode=t.StickerNode=t.MediaAlbumNode=t.AudioMessageNode=t.AudioNode=t.VideoMessageNode=t.VideoNode=t.ImageCreatorPictureNode=t.PictureNode=t.DisplayableMediaWithThumbnail=void 0,t.init=function(){g.registerParser(H)};const i=s(197582),o=i.__importStar(s(823719)),n=i.__importStar(s(496486)),r=s(867782),a=i.__importDefault(s(820473)),l=i.__importDefault(s(150343)),d=i.__importStar(s(987364)),c=s(284841),u=i.__importStar(s(971988)),h=i.__importStar(s(44717)),p=i.__importStar(s(766698)),g=i.__importStar(s(463519)),m=i.__importStar(s(74939)),S=i.__importStar(s(242561)),_=s(815146),f=s(49463),y=i.__importDefault(s(598178)),v=i.__importDefault(s(556037)),C=i.__importStar(s(85385)),T=i.__importStar(s(704704)),M=s(203705),b=i.__importDefault(s(363091)),I=i.__importDefault(s(336817)),w=s(186907),P=i.__importStar(s(115578)),k=i.__importStar(s(118837)),A=s(36381),x=i.__importDefault(s(655192)),D=i.__importDefault(s(583530)),R=s(331079),L=s(845270),B=i.__importDefault(s(220534)),F=i.__importDefault(s(760989)),N=i.__importDefault(s(615364)),E=s(742403),O=s(413983),U=/content-type=\".*?\"/g;class V{static registerForXml(e,t){return V._XmlParsers[e]=t,e}static registerForXmlWithMessageTypes(e,t,...s){return V._XmlParsers[e]=(e,i,o,r)=>r&&r.messagetype&&n.some(s)&&!n.includes(s,r.messagetype)?void 0:t(e,i,o,r),e}static registerForJson(e,t){return V._JsonParsers[e]=t,"_"+e}static registerInvalid(e){return V._InvalidParsers[e]=!0,e}static getXmlParser(e){return V._XmlParsers.hasOwnProperty(e)?V._XmlParsers[e]:void 0}static getJsonParser(e){return V._JsonParsers.hasOwnProperty(e)?V._JsonParsers[e]:void 0}static isInvalidParser(e){return!!V._InvalidParsers[e]}}V._XmlParsers={},V._JsonParsers={},V._InvalidParsers={};const H=new class{parse(e,t,s,i){V.isInvalidParser(s)&&C.warn(_.LogTraceArea.GenericUnsafe,"Trying to decode an invalid tag",s);const o=V.getXmlParser(s);return o?o(e,t,s,i):void 0}parseXmlText(e){return K.fromEscapedXml(e)}parseFromMessageType(e,t,s){const i=V.getJsonParser(t);return i?i(e,s):void 0}parseUnknown(e,t,s,i){return W.parse(e,t,s,i)}root(e,t=!1){return new z(e,t)}emote(e,t,s){const i=F.default.escapeXml(t),o=F.default.escapeXml(s),r=n.clone(e.children);return r.unshift(new ce(i,o)),H.root(r,e.parsingFailed())}};class j{constructor(e,t){this.children=e,this._tag=t}getTag(){return this._tag}getMessageTypes(){return j._messageTypes}cloneWithChildren(e){const t=this.getTag(),s=V.getXmlParser(t);return s&&s(e,this.encodedAttr(),this.getTag(),void 0)}encode(){return this._encodeParts(this._encodeChildren(),n.mapValues(this.encodedAttr(),(e=>n.isString(e)||n.isNull(e)||n.isUndefined(e)?e:e.toString())),this.getTag())}encodeToString(){const e=this.encode();return n.isArray(e)?n.flattenDeep(e).join(""):e||""}encodedAttr(){return{}}isEmptyTextNodeOrContainingWhitespacesOnly(){return!1}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!1}getUriObjectNode(e){}_encodeParts(e,t,s,i=!1){if(s){const o=n.map(t,((e,t)=>n.isUndefined(e)||n.isNull(e)?void 0:t+'="'+e+'"')),r=n.compact(o).join(" "),a="<"+s+(r?" "+r:"");return i&&n.isEmpty(e)?[a+"/>"]:[a+">",e,"</"+s+">"]}return e}_encodeChildren(e=!1){const t=n.map(this.children,(e=>e&&e.encode())),s=n.first(t);return e&&1===t.length&&s?s:t}}t.InternalNode=j,j._messageTypes=[];class z extends j{constructor(e,t=!1){super(e,z._defaultTag),this._parsingFailed=t}parsingFailed(){return this._parsingFailed}accept(e){return e.transformRootNode(this)}encode(){return this._encodeChildren(!0)}isEmptyTextNodeOrContainingWhitespacesOnly(){return n.every(this.children,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}isEmptyTextNodeOrContainingSpaceCharsOnly(){return n.every(this.children,(e=>!!e&&e.isEmptyTextNodeOrContainingSpaceCharsOnly()))}hasOnlyEmoticonsOrSpaceChars(){return n.every(this.children,(e=>e instanceof Y||!!e&&e.isEmptyTextNodeOrContainingSpaceCharsOnly()))}hasOnlyEmoticonsOrWhitespaceText(){return n.every(this.children,(e=>e instanceof Y||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}hasOnlyUnicodeEmoji(){return n.every(this.children,(e=>e instanceof J||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}getNumberOfEmoticons(){return n.size(n.filter(this.children,(e=>e instanceof Y)))}getNumberOfDiverseEmoticons(){const e=n.filter(this.children,(e=>e instanceof Y));return n.size(n.filter(e,(e=>e.tone&&e.tone!==w.DefaultDiverseTone)))}getNumberOfUnicodeEmoji(){return n.size(n.filter(this.children,(e=>e instanceof J)))}getNumberOfDirectMentions(){return n.size(n.filter(this.children,(e=>e instanceof X&&F.default.unescapeXml(e.id)!==X.AllMentionId)))}hasAllMention(){return n.some(this.children,(e=>e instanceof X&&F.default.unescapeXml(e.id)===X.AllMentionId))}hasMagicBotMention(){return n.some(this.children,(e=>e instanceof X&&F.default.unescapeXml(e.id)===l.default.getS4LMessagingFeaturesNoSubscription().magicBotId))}getLinkNodeChildren(){return n.filter(this.children,(e=>e instanceof ne))}getNumberOfWebLinks(){return n.size(n.filter(this.getLinkNodeChildren(),(e=>e.getUrlType()===L.UrlType.Web)))}hasOnlyWebLinks(){return n.every(this.children,(e=>e instanceof ne&&e.getUrlType()===L.UrlType.Web))}getWebLinks(){return(0,c.chain)(this.getLinkNodeChildren(),(0,c.filter)((e=>e.getUrlType()===L.UrlType.Web)),(0,c.map)((e=>e.getSanitizedHref())))}hasOnlyQuotedContent(){return n.every(this.children,(e=>e instanceof ee||!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))}startsWithWikiMarkupList(){return this.children[0]instanceof oe}getFirstUriObjectChild(e){let t;return n.each(this.children,(s=>(t=s&&s.getUriObjectNode(e),!t))),t}getFirstContactNode(){let e;return n.each(this.children,(t=>(t instanceof De&&t.children.length&&(e=t.children[0]),!e))),e}getQuoteNodes(){const e=[];return n.each(this.children,(t=>{t instanceof ee&&e.push(t)})),e}hasWikiMarkup(){return n.some(this.children,(e=>e instanceof ie))}hasHtmlContent(){return n.some(this.children,(e=>e instanceof q))||n.some(this.getQuoteNodes(),(e=>n.some(e.children,(e=>e instanceof q))))}isOnlyHyperLink(){var e,t;const s=this.children&&this.children[0];if(s&&1===(null===(e=s.children)||void 0===e?void 0:e.length)&&s instanceof ne){return s.getSanitizedHref()!==(s.children[0]instanceof K&&(null===(t=s.children[0])||void 0===t?void 0:t.getEscapedText()))}return!1}static parse(e,t={}){if(n.isEmpty(t))return new z(e,n.some(e,(e=>!e)));C.warn(_.LogTraceArea.GenericUnsafe,"Parsed RootNode has unknown attributes",t)}}t.RootNode=z,z._defaultTag=V.registerForXml(S.rootTagName,z.parse);class W extends j{constructor(e,t,s,i){super(e,s),this.attributes=t,this.item=i}cloneWithChildren(e){return W.parse(e,this.encodedAttr(),this.getTag(),void 0)}accept(e){return e.transformUnknownNode(this)}encodedAttr(){return this.attributes}static parse(e,t,s,i){return new W(e,t,s,i)}}t.UnknownNode=W,W._defaultTag=V.registerInvalid("");class G extends j{static register(e,t){return V.registerForXmlWithMessageTypes(e,t,u.MessageTypes.RichText)}accept(e){throw"Must override"}}class K extends G{constructor(e,t,s){super([],e),this._escapedText=t,this._text=s}getRawText(){return void 0===this._text&&(this._text=F.default.unescapeXml(this._escapedText)),this._text}getEscapedText(){return void 0===this._escapedText&&(this._escapedText=F.default.escapeXml(this._text)),this._escapedText}static merge(e){const t=n.map(e,(e=>e.encode())).join("");return K.fromEscapedXml(t)}cloneWithChildren(e){return K.fromEscapedXml(this.getEscapedText())}accept(e){return e.transformPlainTextNode(this)}encode(){return this.getTag()===K._lineBreakTag?"<br/>":this.getEscapedText()}isEmptyTextNodeOrContainingWhitespacesOnly(){return""===this.getEscapedText().trim()}isEmptyTextNodeOrContainingSpaceCharsOnly(){return""===this.getEscapedText().replace(/ /g,"")}static parse(e,t,s){if(s===K._lineBreakTag)return new K(K._lineBreakTag,void 0,"\n")}static fromPlainText(e){return new K(K._defaultTag,void 0,e)}static fromEscapedXml(e){return new K(K._defaultTag,e,void 0)}}t.PlainTextNode=K,K._defaultTag=V.registerInvalid("_text"),K._lineBreakTag=G.register("br",K.parse);class q extends G{constructor(e,t){super(e,q._defaultTag),this.children=e,this._dom=t,this._searchQuery="",this._isPrimarySearchResult=!1,this._isQuote=!1}cloneWithChildren(e){const t=new q(e,this._dom);return t._searchQuery=this._searchQuery,t._isPrimarySearchResult=this._isPrimarySearchResult,t._isQuote=this._isQuote,t}accept(e){return e.transformHtmlNode(this)}encode(){return o.DomUtils.getOuterHTML(this.getHtmlDom(),{decodeEntities:!1,xmlMode:!0})}getHtmlDom(){return this._dom.value}cloneAsSearchResult(e,t){const s=this.cloneWithChildren(this.children);return s._searchQuery=e,s._isPrimarySearchResult=t,s}cloneAsQuote(){const e=this.cloneWithChildren(this.children);return e._isQuote=!0,e}getSearchQuery(){return this._searchQuery}isPrimarySearchResult(){return this._isPrimarySearchResult}isQuote(){return this._isQuote}static parse(e,t){let s;const i=new o.DomHandler(((e,t)=>{e?C.warn(_.LogTraceArea.GenericUnsafe,"HtmlNode failed to parse HTML"):s=t})),r=new o.Parser(i,{decodeEntities:!1,xmlMode:!0});r.write(y.default.sanitizeHtml(e)),r.end();const a=[];if(t){const e=u.getTeamsFileProperties(t.properties);n.each(e,(e=>{const t=e.fileInfo&&(e.fileInfo.shareUrl||e.fileInfo.fileUrl);if(t){const s=B.default.createSanitizedHref(t);if(s&&s.href){n.isEmpty(a)||a.push(K.fromPlainText("\n"));const i=e.fileName||s.href,o=K.fromPlainText(i);a.push(new ne([o],t,s.href,s.urlType))}}}))}return s?new q(a,new v.default(s)):void 0}}t.HtmlNode=q,q._defaultTag=V.registerForJson(u.MessageTypes.TeamsHtml,q.parse);class Q extends G{constructor(e,t,s,i){super([],Q._defaultTag),this.fallbackSkypeId=e,this.originalArrivalTime=t,this.originalArrivalTimeSeconds=s,this.messageTypeEnum=i}accept(e){return e.transformEditMessageMetaDataNode(this)}encodedAttr(){return{a:this.fallbackSkypeId,ts_ms:this.originalArrivalTime,ts:this.originalArrivalTimeSeconds,t:this.messageTypeEnum}}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){const s=t.a&&n.isString(t.a)&&F.default.unescapeXml(t.a),i=t.ts_ms?parseInt(t.ts_ms,10):void 0,o=t.ts?parseInt(t.ts,10):void 0,r=t.t&&parseInt(t.t,10);if((o||i)&&s&&r===Q.ExpectedT)return new Q(s,i,o,r)}}t.EditMessageMetaDataNode=Q,Q.ExpectedT=61,Q._defaultTag=G.register("e_m",Q.parse);class X extends G{constructor(e,t,s,i){super(e,X._defaultTag),this.children=e,this.id=t,this.isLegacyAtMention=s,this.itemid=i}accept(e){return e.transformAtMentionNode(this)}encodedAttr(){return{id:this.id,itemid:this.itemid}}isAllMention(){return this.id===X.AllMentionId||this.id===X.AllMentionIdNonAlerting}isInQuote(){return this.id===X.DirectMentionIdNonAlerting||this.id===X.AllMentionIdNonAlerting}getLocalizedAllMention(){return T.getString("MessageComposer.QouteAll")}static transformToNonAlertingNode(e){const t=e.isAllMention()?X.AllMentionIdNonAlerting:X.DirectMentionIdNonAlerting;return new X(e.children,t,e.isLegacyAtMention,void 0)}static parse(e,t){if(!e||!t.id)return;let s=!1;if(n.every(e,(e=>e instanceof K))){s="@"===K.merge(e).getRawText()[0]}return new X(e,t.id,s,t.itemid)}}t.AtMentionNode=X,X.AllMentionId="*",X.AllMentionIdNonAlerting="_*_",X.DirectMentionIdNonAlerting=" ",X._defaultTag=G.register("at",X.parse);class $ extends G{constructor(e,t){super([e],$._defaultTag),this.textNode=e,this.mri=t}accept(e){return e.transformUserMriNode(this)}encodedAttr(){return{mri:this.mri}}static parse(e,t){const s=ye(e);if(s&&t.mri)return new $(s,t.mri)}}t.UserMriNode=$,$._defaultTag=G.register("usermri",$.parse);class J extends G{constructor(e){super([e],J._defaultTag),this.emojiTextNode=e}accept(e){return e.transformUnicodeEmojiNode(this)}static parse(e){const t=ye(e);if(t)return new J(t)}static fromPlainText(e){return new J(K.fromPlainText(e))}}t.UnicodeEmojiNode=J,J._defaultTag=G.register("_emoji",J.parse);class Y extends G{constructor(e,t,s){super([e],Y._defaultTag),this.type=t,this.tone=s}accept(e){return e.transformEmoticonNode(this)}encodedAttr(){return this.tone?{type:this.type,tone:this.tone}:{type:this.type}}static parse(e,t){const s=ye(e);if(s&&t.type){const e=t.tone?I.default.getItemToneFromString(t.tone):void 0;return new Y(s,t.type,e)}}}t.EmoticonNode=Y,Y._defaultTag=V.registerForXml("ss",Y.parse);class Z extends G{constructor(e,t){super([e],Z._defaultTag),this.country=t}accept(e){return e.transformFlagNode(this)}encodedAttr(){return{country:this.country}}static parse(e,t){const s=ye(e);if(s&&t.country)return new Z(s,t.country)}}t.FlagNode=Z,Z._defaultTag=V.registerForXml("flag",Z.parse);class ee extends G{constructor(e,t,s,i,o,n,r){super(e,ee._defaultTag),this.author=t,this.authorname=s,this.timestamp=i,this.conversation=o,this.messageid=n,this.cuid=r}getAuthorNameWithFallbackUnescaped(){return F.default.unescapeXml(this.authorname||this.author)}accept(e){return e.transformQuoteNode(this)}encodedAttr(){return{author:this.author,authorname:this.authorname,timestamp:this.timestamp,conversation:this.conversation,messageid:this.messageid,cuid:this.cuid}}static parse(e,t,s,i){const o=t.timestamp?parseInt(t.timestamp,10):void 0;if((t.author||t.authorname)&&n.isFinite(o)){const s=l.default.getS4LMessagingFeaturesNoSubscription().enableParsingHtmlMessages?n.map(e,(e=>{if(e&&"div"===e.getTag()){const t=q.parse(e.encodeToString(),i);return t?t.cloneAsQuote():void 0}return e})):e;return new ee(s,t.author,t.authorname,o,t.conversation,t.messageid,t.cuid)}}}t.QuoteNode=ee,ee._defaultTag=V.registerForXmlWithMessageTypes("quote",ee.parse,u.MessageTypes.RichText,u.MessageTypes.EncryptedText);class te extends G{constructor(e,t,s,i){super([e],te._defaultTag),this._isBackgroundTransparent=!!t,this._isOwnMessage=!!s,this._isGlobalSearch=!!i}cloneWithChildren(e){return te.parse(e,this._isBackgroundTransparent,this._isOwnMessage,this.encodedAttr(),this._isGlobalSearch)}accept(e){return e.transformHighlightedNode(this,this._isBackgroundTransparent,this._isOwnMessage,this._isGlobalSearch)}static fromPlainText(e,t,s,i){return new te(K.fromPlainText(e),t,s,i)}static parse(e,t,s,i,o){n.isEmpty(i)||C.warn(_.LogTraceArea.GenericUnsafe,"attributes ignored while creating HighlightNode");const r=n.first(e);if(r)return new te(r,t,s,o)}}t.HighlightedNode=te,te._defaultTag=V.registerInvalid("_highlighted");class se extends G{constructor(e){super([e],se._defaultTag)}accept(e){return e.transformLegacyQuoteNode(this)}static parse(e){if(n.every(e,(e=>e instanceof K))){const t=K.merge(e);return new se(t)}}}t.LegacyQuoteNode=se,se._defaultTag=V.registerForXmlWithMessageTypes("legacyquote",se.parse,u.MessageTypes.RichText,u.MessageTypes.EncryptedText);class ie extends G{constructor(e,t,s,i){super(e,t),this.rawPre=s,this.rawPost=i,this.rawPreNode=K.fromEscapedXml(s),i&&(this.rawPostNode=K.fromEscapedXml(i))}accept(e){return e.transformWikiMarkupNode(this)}encodedAttr(){return{raw_pre:this.rawPre,raw_post:this.rawPost}}static parse(e,t,s){const i=t.raw_pre||ie._tagToDefaultMarkup[s],o=(i||"").toLowerCase().trim(),r=t.raw_post||ie._preToPostDefaultMarkup[o];if(n.includes(ie._tags,s)&&i)return new ie(e,s,i,r)}}t.WikiMarkupNode=ie,ie._tagToDefaultMarkup={b:"*",i:"_",s:"~",pre:"```"},ie._preToPostDefaultMarkup={"*":"*",_:"_","~":"~","```":"```","{code}":"{code}","!!":void 0},ie._tags=n.map(n.keys(ie._tagToDefaultMarkup),(e=>V.registerForXml(e,ie.parse)));class oe extends ie{constructor(e,t,s,i,o,n,r){super(e,t,s,i),this.level=o,this.order=n,this.ordered=r,this.rawPreNode="li"===t?K.fromPlainText("  ".repeat(o)+(r?`${n}. `:s)):this.rawPreNode}accept(e){return e.transformListWikiMarkupNode(this)}encodedAttr(){return Object.assign(Object.assign({},super.encodedAttr()),{level:this.level,order:this.order,ordered:+this.ordered})}_updateChildren(e){return oe._childrenUpdater[this.getTag()](this.children,e)}static parse(e,t,s){var i,o,n;const r=null!==(i=t.raw_pre)&&void 0!==i?i:oe._tagToDefaultMarkup[s],a=(null!=r?r:"").toLowerCase();let l=null!==(o=t.raw_post)&&void 0!==o?o:oe._preToPostDefaultMarkup[a];const d=+(t.level||0),c=+(t.order||1),u=!!+(null!==(n=t.ordered)&&void 0!==n?n:"ol"===s);if(l="li"===s&&e.some((e=>e instanceof oe))?"":l,e="li"===s?e.map((e=>e instanceof K?K.fromPlainText(e.getRawText()):e)):e.filter((e=>e instanceof oe)),oe._tags.includes(s))return new oe(oe._childrenUpdater[s](e,d),s,r||"",l,d,c,u)}static _update(e,t,s,i){const o=e.rawPre||(["ul","ol"].includes(e.getTag())&&t>0?"\n":"");return new oe(e._updateChildren(t),e.getTag(),o,e.rawPost,t,s,i)}}t.ListWikiMarkupNode=oe,oe._childrenUpdater={li:(e,t)=>e.map((e=>e instanceof oe?oe._update(e,t+1,e.order,e.ordered):e)),ul:(e,t)=>e.filter((e=>e instanceof oe)).map((e=>oe._update(e,t,e.order,!1))),ol:(e,t)=>e.filter((e=>e instanceof oe)).map(((e,s)=>oe._update(e,t,s+1,!0)))},oe._tagToDefaultMarkup={li:"- ",ul:"",ol:""},oe._preToPostDefaultMarkup={"- ":"\r","":void 0},oe._tags=Object.keys(oe._tagToDefaultMarkup).map((e=>V.registerForXml(e,oe.parse)));class ne extends G{constructor(e,t,s,i){super(e,ne._defaultTag),this._href=t,this._sanitizedHref=s,this._urlType=i}getSanitizedHref(){return this._sanitizedHref}getUrlType(){return this._urlType}accept(e){return e.transformLinkNode(this)}encodedAttr(){return{href:this._href}}static parse(e,t){if(t.href){const s=B.default.createSanitizedHref(F.default.unescapeXml(t.href));if(s&&s.href)return new ne(e,t.href,s.href,s.urlType)}}static parseFromHref(e){const t=F.default.escapeXml(e);return ne.parse([K.fromEscapedXml(t)],{href:t})}}t.LinkNode=ne,ne._defaultTag=V.registerForXml("a",ne.parse);class re extends G{constructor(e){super(e,re._defaultTag)}accept(e){return e.transformBingResponseNode(this)}static parse(e){return new re(e)}}t.BingResponseNode=re,re._defaultTag=V.registerForXml("bing-response",re.parse);class ae extends G{constructor(e,t,s,i,o,n,r,a){super(e,ae._defaultTag),this._href=t,this._sanitizedHref=s,this.index=i,this.anchor=o,this.title=n,this.description=r,this.logo=a}getSanitizedHref(){return this._sanitizedHref}accept(e){return e.transformAttributionNode(this)}encodedAttr(){return{href:this._href,index:this.index,anchor:this.anchor}}static parse(e,t){var s;const i=t.index&&F.default.unescapeXml(t.index),o=t.anchor&&F.default.unescapeXml(t.anchor),n=t.title&&F.default.unescapeXml(t.title),r=t.description&&F.default.unescapeXml(t.description),a=t.logo&&F.default.unescapeXml(t.logo);if(i&&o)if(t.href){const s=B.default.createSanitizedHref(F.default.unescapeXml(t.href));if(null==s?void 0:s.href)return new ae(e,t.href,s.href,i,o,n,r,a)}else if(e.some((e=>e instanceof ne))){const t=null===(s=e.find((e=>e instanceof ne)))||void 0===s?void 0:s.getSanitizedHref();if(t)return new ae(e,t,t,i,o,n,r,a)}}}t.AttributionNode=ae,ae._defaultTag=V.registerForXml("attribution",ae.parse);class le extends G{constructor(e,t,s){super(e,le._defaultTag),this._href=t,this._sanitizedHref=s}getSanitizedHref(){return this._sanitizedHref}accept(e){return e.transformAttributionsTextNode(this)}static parse(e,t){var s;const i=t.href&&(null===(s=B.default.createSanitizedHref(F.default.unescapeXml(t.href)))||void 0===s?void 0:s.href);return new le(e,t.href,i)}encodedAttr(){return{href:this._href}}}t.AttributionsTextNode=le,le._defaultTag=V.registerForXml("attributions-text",le.parse);class de extends G{constructor(e){super(e,de._defaultTag)}accept(e){return e.transformAttributionsGroupNode(this)}static parse(e){const t=e.filter((e=>de._attributionsGroupMembers.some((t=>e instanceof t))));return new de(t)}}t.AttributionsGroupNode=de,de._attributionsGroupMembers=[ae,le],de._defaultTag=V.registerForXml("attributions-group",de.parse);class ce extends G{constructor(e,t){super([],ce._defaultTag),this.escapedAuthorMri=e,this.escapedFallbackText=t}cloneWithChildren(e){return new ce(this.escapedAuthorMri,this.escapedFallbackText)}accept(e){return e.transformEmoteNode(this)}encode(){}isEmptyTextNodeOrContainingWhitespacesOnly(){return!1}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!1}}t.EmoteNode=ce,ce._defaultTag=V.registerInvalid("_emote");class ue extends G{constructor(e,t,s){super([e],ue._defaultTag),this.textNode=e,this.activityId=t,this._actionsIndexes=s}getActionsIndexes(){return n.compact(n.map(this._actionsIndexes.split(";"),(e=>parseInt(e,10))))}getActivityId(){return this.activityId}getPhrase(){return this.textNode.getRawText()}accept(e){return e.transformSuggestedTextHighlightNode(this)}getAttr(){return{actionsIndex:this._actionsIndexes,activityId:this.activityId}}static parse(e,t){const s=ye(e);if(s&&t.activityId)return new ue(s,t.activityId,t.actionsIndex)}}t.SuggestedTextHighlightNode=ue,ue._defaultTag=G.register("highlightedEntity",ue.parse);class he extends G{constructor(e,t){super([],he._defaultTag),this.id=e,this.name=t}accept(e){return e.transformRosterContextNode(this)}encodedAttr(){return{id:this.id,name:this.name}}static parse(e,t){if(t.id&&t.name)return new he(t.id,t.name)}}t.RosterContextNode=he,he._defaultTag=G.register("roster",he.parse);class pe extends G{constructor(){super([],pe._defaultTag)}static parse(){return new pe}}t.NewTopicContextNode=pe,pe._defaultTag=G.register("newTopic",pe.parse);class ge extends G{constructor(e,t){super([],ge._defaultTag),this.encrypted=e,this.source=t}accept(e){return e.transformLocationContextNode(this)}encodedAttr(){return{encrypted:this.encrypted,source:this.source}}static parse(e,t){if(t.encrypted&&t.source)return new ge(t.encrypted,t.source)}}t.LocationContextNode=ge,ge._messageTypes=[u.MessageTypes.RichText],ge._defaultTag=V.registerForXmlWithMessageTypes("location",ge.parse,...ge._messageTypes);class me extends G{constructor(e,t){super(e,me._defaultTag),this._attributes=t}getContextForKey(e){const t=F.default.escapeXml(e),s=this._attributes[t];return s?F.default.unescapeXml(""+s):void 0}accept(e){return e.transformContextNode(this)}encodedAttr(){return this._attributes}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){if(t)return new me(e,t)}}t.ContextNode=me,me._defaultTag=G.register(m.contextTagName,me.parse);class Se extends G{constructor(e){super(e,Se._defaultTag)}accept(e){return e.transformDeepLinkNode(this)}static parse(e){return new Se(e)}}t.DeepLinkNode=Se,Se._defaultTag=V.registerForXml("deeplink",Se.parse);class _e extends G{constructor(e){super([],_e._defaultTag),this.layoutOption=e}cloneWithChildren(){return new _e(this.layoutOption)}accept(e){return e.transformCallerIDNode(this)}encodedAttr(){return{layoutOption:this.layoutOption}}static parse(e,t){return new _e(t.layoutOption||"text")}}t.CallerIDNode=_e,_e._defaultTag=V.registerForXml("_callerid",_e.parse);class fe extends j{}function ye(e,t=!1){if(1===e.length){const t=e[0];if(t instanceof K)return t}else{if(0===e.length&&t)return K.fromEscapedXml("");if(n.every(e,(e=>e instanceof K)))return K.merge(e)}}function ve(e,t){const s=e[t];if(s&&1===s.length)return s[0]}function Ce(e){const t=n.groupBy(e,(e=>e&&e.getTag())),s=ve(t,be.tags.EventTime),i=ve(t,be.tags.Initiator),o=function(e){const t=ve(e,S.multiTargetsTagName),s=e[S.targetTagName];return t&&s?s.concat(t.children):t?t.children:s&&s.length?s:void 0}(t);return s&&i&&o?[s,i,o]:void 0}function Te(e){const t=n.groupBy(e,(e=>e&&e.getTag())),s=ve(t,be.tags.EventTime),i=ve(t,be.tags.Initiator),o=ve(t,be.tags.Value);return s&&i&&o?[s,i,o]:void 0}var Me;!function(e){e[e.None=0]="None",e[e.NonEmpty=1]="NonEmpty",e[e.Mri=2]="Mri",e[e.Number=3]="Number"}(Me||(Me={}));class be extends fe{getRawText(){return this._rawText}getMessageTypes(){return be._messageTypes}constructor(e,t){super([e],t),this._rawText=e.getRawText()}accept(e){return e.transformTextWrapperNode(this)}static parse(e,t,s){if(!be._tagChecks.hasOwnProperty(s)){const i=n.includes(be._registeredTags,s)?"unregistered (but known)":"unknown";return void C.warn(_.LogTraceArea.GenericUnsafe,"TextWrapperNode.parse called with "+i+" tag",e,t,s)}const i=be._tagChecks[s];let o=ye(e,i.check===Me.None);if(o){switch(i.check){case Me.None:case Me.NonEmpty:break;case Me.Mri:const e=o.getRawText(),t=/^(\d+:[^;]+)/.exec(e),s=t&&t[1];if(!s||!h.isMri(s))return;e!==s&&(o=K.fromPlainText(s));break;case Me.Number:if(!n.isFinite(parseInt(o.getRawText(),10)))return}return new be(o,s)}}}t.TextWrapperNode=be,be._messageTypes=[u.MessageTypes.RoleUpdate,u.MessageTypes.Call],be.tags={EventTime:"eventtime",Initiator:"initiator",Id:"id",Role:"role",Value:"value",Name:"name",Duration:"duration"},be._tagChecks={[be.tags.EventTime]:{check:Me.Number,messagetypes:[]},[be.tags.Initiator]:{check:Me.Mri,messagetypes:[]},[be.tags.Id]:{check:Me.Mri,messagetypes:[u.MessageTypes.RoleUpdate]},[be.tags.Role]:{check:Me.NonEmpty,messagetypes:[u.MessageTypes.RoleUpdate]},[be.tags.Value]:{check:Me.None,messagetypes:[]},[be.tags.Name]:{check:Me.NonEmpty,messagetypes:[u.MessageTypes.Call]},[be.tags.Duration]:{check:Me.Number,messagetypes:[u.MessageTypes.Call]}},be._registeredTags=n.map(be._tagChecks,((e,t)=>e.messagetypes&&e.messagetypes.length?V.registerForXmlWithMessageTypes(t,be.parse,...e.messagetypes):V.registerForXml(t,be.parse)));class Ie extends fe{constructor(e){super(e,Ie._defaultTag)}getRawText(){const e=n.head(this.children);if(e.getRawText)return e.getRawText();return C.warn(_.LogTraceArea.GenericUnsafe,"TargetNode.children[0] is not an IPlainTextNode",this),""}getMessageTypes(){return Ie._messageTypes}static parse(e){return 1===e.length?we.parseTargetUser(e):2===e.length?ke.parseTargetRole(e):void 0}}t.TargetNode=Ie,Ie._messageTypes=[u.MessageTypes.AddMember,u.MessageTypes.RoleUpdate,u.MessageTypes.DeleteMember,u.MessageTypes.LegacyMemberAdded,u.MessageTypes.LegacyMemberUpgraded,u.MessageTypes.HandshakeInvite,u.MessageTypes.HandshakeAccept,u.MessageTypes.HandshakeComplete,u.MessageTypes.HandshakeReject,u.MessageTypes.GuestNameUpdate],Ie._defaultTag=V.registerForXmlWithMessageTypes(S.targetTagName,Ie.parse,...Ie._messageTypes);class we extends Ie{accept(e){return e.transformTargetUserNode(this)}static parseTargetUser(e){const t=ye(e),s=t?t.getRawText():void 0;if(s&&h.isMri(s)&&t)return new we([t])}}t.TargetUserNode=we;class Pe extends we{accept(e){return e.transformTargetLegacyUserNode(this)}static parseTargetLegacyUser(e){const t=ye(e);if(t)return new Pe([t])}}t.TargetLegacyUserNode=Pe;class ke extends Ie{constructor(e,t){super([e,t]),this.idChild=e,this.roleChild=t}accept(e){return e.transformTargetRoleNode(this)}static parseTargetRole(e){const t=n.groupBy(e,(e=>e&&e.getTag())),s=ve(t,be.tags.Id),i=ve(t,be.tags.Role);if(s&&i)return new ke(s,i)}}t.TargetRoleNode=ke;class Ae extends fe{constructor(e){super(e,Ae._defaultTag)}accept(e){return e.transformTargetsNode(this)}getMessageTypes(){return Ae._messageTypes}static parse(e){if(e.length>0&&n.every(e,(e=>e instanceof Ie)))return new Ae(e)}}t.TargetsNode=Ae,Ae._messageTypes=[u.MessageTypes.AddMember,u.MessageTypes.RoleUpdate,u.MessageTypes.DeleteMember,u.MessageTypes.LegacyMemberAdded,u.MessageTypes.LegacyMemberUpgraded,u.MessageTypes.GuestNameUpdate],Ae._defaultTag=V.registerForXmlWithMessageTypes(S.multiTargetsTagName,Ae.parse,...Ae._messageTypes);class xe extends fe{constructor(e,t,s,i){super([],xe._defaultTag),this.skypeId=e,this.fullName=t,this.isPstn=s,this.isS4B=i,this.fullName&&(this.fullName=F.default.unescapeXml(this.fullName))}static getEncodedTypeAttr(e=!1,t=!1){return e?"":t?"b":"s"}accept(e){return e.transformContactNode(this)}encodedAttr(){return{t:xe.getEncodedTypeAttr(this.isPstn,this.isS4B),s:this.skypeId,f:this.fullName}}getMessageTypes(){return xe._messageTypes}static parse(e,t){let s,i,o=!1,n=!1;if("s"===t.t)s=t.s,i=t.f?t.f:"";else if("b"===t.t)s=t.s,i=t.f?t.f:"",n=!0;else{s=i=t.p||t.s,o=!0}if(0===e.length&&(s||i))return new xe(s,i,o,n)}}t.ContactNode=xe,xe._messageTypes=[u.MessageTypes.Contacts,u.MessageTypes.RichText],xe._defaultTag=V.registerForXmlWithMessageTypes("c",xe.parse,...xe._messageTypes);class De extends fe{constructor(e){super(e,De._defaultTag)}accept(e){return e.transformContactsNode(this)}getMessageTypes(){return De._messageTypes}static parse(e){if(e.length>0&&n.every(e,(e=>e instanceof xe)))return new De(e)}}t.ContactsNode=De,De._messageTypes=[u.MessageTypes.Contacts],De._defaultTag=V.registerForXmlWithMessageTypes("contacts",De.parse,...De._messageTypes);class Re extends fe{constructor(e,t){super(e,Re._defaultTag),this._smsContentEscaped=t,this.smsContentUnescaped=F.default.unescapeXml(this._smsContentEscaped)}accept(e){return e.transformSmsNode(this)}encodedAttr(){return{alt:this._smsContentEscaped}}getMessageTypes(){return Re._messageTypes}static parse(e,t){const s=n.find(e,(e=>e instanceof W&&"defaults"===e.getTag())),i=s&&n.find(s.children,(e=>e instanceof W&&"content"===e.getTag())),o=i&&n.find(i.children,(e=>e instanceof W&&"body"===e.getTag()));if(o&&o.children&&o.children.length>=1&&o.children[0]instanceof K){const t=o.children[0];return new Re(e,t.encode())}if(n.isString(t.alt))return new Re(e,t.alt)}}t.SmsNode=Re,Re._messageTypes=[u.MessageTypes.Sms],Re._defaultTag=V.registerForXmlWithMessageTypes("sms",Re.parse,...Re._messageTypes);class Le extends fe{constructor(e,t,s){super([],Le._defaultTag),this.rawContent=e,this.content=t,this.contentNodes=s}accept(e){return e.transformMmsNode(this)}encode(){return this.rawContent}getMessageTypes(){return Le._messageTypes}getUriObjectNode(e){let t;return n.each(this.contentNodes,(s=>(t=s.getUriObjectNode(e),!t))),t}static parseMms(e){if(e){const t=x.default.parseJsonErrorable(e);if(!n.isError(t)&&t&&t.content_list){const s=n.map(t.content_list,(e=>{if(!(e&&e.headers&&e.headers.content_type&&e.content&&e.content.location))return null;const t=e.content.location.toLowerCase();if(e.headers.content_type.indexOf("text/plain")>-1){const s=e.content.text;if(s&&"inline"===t)return K.fromPlainText(s)}else if(e.headers.content_type.indexOf("image/")>-1){const s=e;if("ams"===t&&s.content.object_id){const e=d.getDocumentUrls(s.content.object_id,R.UploadFileType.Picture);return qe.parse([],{uri:e.original,url_thumbnail:e.preview,type:"Picture.1"})}}return null})),i=n.compact(s);if(!i.length&&t.subject){const e=K.fromPlainText(t.subject);i.push(e)}if(i.length)return new Le(e,t,i)}}return Le._parseFallback(e)}static parse(e,t){return C.warn(_.LogTraceArea.GenericUnsafe,"MmsNode.parse called",e,t),Le._parseFallback(void 0)}static _parseFallback(e){const t=K.fromPlainText(T.getString("MessageContentNodes.MmsFallback"));return new Le(e,void 0,[t])}}t.MmsNode=Le,Le._messageTypes=[u.MessageTypes.Mms],Le._defaultTag=V.registerForJson(u.MessageTypes.Mms,Le.parseMms);class Be extends fe{constructor(e,t,s,i,o,n,r,a,d,c){super(e,l.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?V.registerForXmlWithMessageTypes("location",Be.parse,u.MessageTypes.Location,u.MessageTypes.RichText):Be._defaultTag),this._attributes=t,this.isUserLocation=s,this.latitude=i,this.longitude=o,this.addressSanitized=n,this.userMri=r,this.shortAddressSanitized=a,this.addressFriendlyNameSanitized=d,this.bingUrl=c}accept(e){return e.transformLocationNode(this)}encodedAttr(){return this._attributes}getMessageTypes(){return l.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?[u.MessageTypes.Location,u.MessageTypes.RichText]:Be._messageTypes}static parse(e,t){if("allowNoLink"in t){return new Be(e,t,!0,void 0,void 0,void 0,void 0,void 0,void 0,"")}const s=n.find(e,(e=>e instanceof ne));if(s){const i=t,o=B.default.getURIComponents(s.getSanitizedHref());if(o&&o.host&&o.pathname&&"www.bing.com"===o.host.toLowerCase()&&("maps/"===o.pathname.toLowerCase()||"maps/default.aspx/"===o.pathname.toLowerCase())){const t="1"===i.isUserLocation;let o=n.isString(i.latitude)?parseInt(i.latitude,10):i.latitude;o=n.isFinite(o)?o:void 0;let r=n.isString(i.longitude)?parseInt(i.longitude,10):i.longitude;r=n.isFinite(r)?r:void 0;const a=i.address&&F.default.unescapeXml(i.address),l=i.userMri&&F.default.unescapeXml(i.userMri),d=i.shortAddress&&F.default.unescapeXml(i.shortAddress),c=i.addressFriendlyName&&F.default.unescapeXml(i.addressFriendlyName);return new Be(e,i,t,o,r,a,l,d,c,s.getSanitizedHref())}}}}t.LocationNode=Be,Be._messageTypes=[u.MessageTypes.Location],Be._defaultTag=V.registerForXmlWithMessageTypes("location",Be.parse,...Be._messageTypes);class Fe extends fe{constructor(e,t){super([],Fe._defaultTag),this.type=e,this.originalName=t}accept(e){return e.transformMetaNode(this)}encodedAttr(){return{type:this.type,originalName:this.originalName}}getMessageTypes(){return Fe._messageTypes}static parse(e,t,s,i){let o=t.originalName;if(!o&&i){const e=U.exec(i.content);if(e&&1===e.length){const t=e[0],s=t.substring(t.indexOf("/")+1,t.length-1);o=F.default.newGuid()+"."+s}}if(0===e.length&&t.type&&o)return new Fe(t.type,o)}}t.MetaNode=Fe,Fe._messageTypes=[u.MessageTypes.UriObject],Fe._defaultTag=V.registerForXmlWithMessageTypes("meta",Fe.parse,...Fe._messageTypes);class Ne extends fe{constructor(e,t,s,i){super([e],Ne._defaultTag),this.nameChild=e,this.size=t,this.index=s,this.tid=i}accept(e){return e.transformFileNode(this)}encodedAttr(){return{size:this.size,index:this.index,tid:this.tid}}getMessageTypes(){return Ne._messageTypes}static parse(e,t){const s=ye(e);if(s){const e=t.size?parseInt(t.size,10):void 0,i=t.index?parseInt(t.index,10):void 0;if(n.isFinite(e)&&n.isFinite(i)&&t.tid)return new Ne(s,e,i,t.tid)}}}t.FileNode=Ne,Ne._messageTypes=[u.MessageTypes.Files],Ne._defaultTag=V.registerForXmlWithMessageTypes("file",Ne.parse,...Ne._messageTypes);class Ee extends fe{constructor(e,t){super(e,Ee._defaultTag),this.alt=t}accept(e){return e.transformFilesNode(this)}encodedAttr(){return{alt:this.alt}}getMessageTypes(){return Ee._messageTypes}static parse(e,t){if((e=n.reject(e,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly()))).length>0&&n.every(e,(e=>e instanceof Ne)))return new Ee(e,t.alt)}}t.FilesNode=Ee,Ee._messageTypes=[u.MessageTypes.Files],Ee._defaultTag=V.registerForXmlWithMessageTypes("files",Ee.parse,...Ee._messageTypes);class Oe extends fe{constructor(e,t,s,i,o){if(super(e,Oe._defaultTag),this._attr=t,this._sanitizedUrl=s,this._sanitizedThumbnailUrl=i,this._sanitizedAzureMSUrl=o,this._originalDimensions={width:void 0,height:void 0},t.width&&t.height){const e=parseInt(t.width,10),s=parseInt(t.height,10);e>0&&s>0&&(this._originalDimensions.width=e,this._originalDimensions.height=s)}const r=n.keyBy(e,(e=>e?e.getTag():"undefined")),a=r.OriginalName instanceof W?r.OriginalName:void 0;let l;a&&(l=a.encodedAttr().v,l&&(l=l.replace(/[\u202A-\u202E\u2066-\u2069]/g,""))),this._objectNameUnescaped=l&&F.default.unescapeXml(l),this._amsDocumentId=t.doc_id}getMessageTypes(){return Oe._messageTypes}getNameForUI(){return this._objectNameUnescaped}getNameForDownload(){const e=this.getNameForUI();return e&&k.lossyForUserFile(e)}getOriginalDimensions(){return this._originalDimensions}accept(e){return e.transformUriObjectNode(this)}encodedAttr(){return this._attr}getUriObjectNode(e){return this instanceof e?this:void 0}getSubType(){if(this._attr.type){const e=this._attr.type.split("/");return Oe._subtypeFromParts(e)}}static _subtypeFromParts(e){return e[1]?e[1].split(".")[0]:""}static parse(e,t,s,i){const o=!!i&&i.isMessageLie()&&b.default.isMyMri(i.creator),n=t.uri&&Oe.sanitizeUrl(t.uri,o),r=Oe.sanitizeUrl(t.url_thumbnail,o),a=Oe.sanitizeUrl(t.url_azurems,o);return!t.doc_id&&n&&(t.doc_id=d.getDocumentId(n)),Oe.parseFromSanitizedParts(e,t,n,r,a,i)}static sanitizeUrl(e,t){if(e){const s=F.default.unescapeXml(e);if(t){const e=f.FileUploadCacheUtils.getAbsoluteFromLocalCacheUri(s);if(B.default.isFileOrBlob(e))return e}if(l.default.isTrustedDomain(s,!0))return B.default.sanitizeUrl(s)}}static parseFromSanitizedParts(e,t,s,i,o,r){if(t.type){const n=t.type.split("/"),a=n[0].split(".")[0],l=this._subtypeFromParts(n);if("Sticker"===a)return et.parseFromSanitizedParts(e,t,s,i);if("Picture"===a&&l===u.UriObjectTypeSubTypes.Picture.ImageCreator)return Qe.parseFromSanitizedParts(e,t,s,i);if("Picture"===a)return qe.parseFromSanitizedParts(e,t,s,i);if("Video"===a&&l===u.UriObjectTypeSubTypes.Video.Message)return $e.parseFromSanitizedParts(e,t,s,i,o);if("Video"===a)return Xe.parseFromSanitizedParts(e,t,s,i,o);if("Audio"===a&&l===u.UriObjectTypeSubTypes.Audio.Message)return Ye.parseFromSanitizedParts(e,t,s,i);if("Audio"===a)return Je.parseFromSanitizedParts(e,t,s,i);if("File"===a||"PDF"===a||"Word"===a||"Excel"===a||"Powerpoint"===a||"Zip"===a)return We.parseFromSanitizedParts(e,t,s,i,o);if("SWIFT"===a)return Ue.parseFromSanitizedParts(e,t,s,i);if("ScheduledCallInvite"===a)return ze.parseFromSanitizedParts(e,t,s,i,o,r);if("Poll"===a)return Tt.parseFromSanitizedParts(e,t,s,i,o);if("Cast"===a)return yt.parseFromSanitizedParts(e,t,s,i);if("MagicBotToolbox"===a)return kt.parseFromSanitizedParts(e,t)}else{const o=n.find(e,(e=>e instanceof Fe));if(o&&"photo"===o.type)return qe.parseFromSanitizedParts(e,t,s,i)}}}t.UriObjectNode=Oe,Oe._messageTypes=[u.MessageTypes.RichText,...u.UriObjectMessageTypes],Oe._defaultTag=V.registerForXmlWithMessageTypes("URIObject",Oe.parse,...Oe._messageTypes);class Ue extends Oe{constructor(e,t,s,i,o){super(e,t,void 0,s,void 0),this.swiftChild=i,this.titleChild=o}accept(e){return e.transformSwiftUriObjectNode(this)}static parseFromSanitizedParts(e,t,s,i){const o=n.find(e,(e=>e instanceof He)),r=n.find(e,(e=>!!e&&"Title"===e.getTag()))||K.fromPlainText(T.getString("SwiftCard.Card"));if(i)return new Ue(e,t,i,o,r)}getCardType(){var e;if(!(null===(e=this.swiftChild)||void 0===e?void 0:e.swiftMessage))return;const t=this.swiftChild.swiftMessage.attachments;if(t&&t.length){const e=t[0].content;if(e&&e.images&&e.images.length)return e.images[0].type}}}t.SwiftUriObjectNode=Ue;class Ve extends fe{constructor(){super([],Ve._defaultTag)}getMessageTypes(){return Ve._messageTypes}static isAdaptiveCardMessage(e){return!(!e.attachments||!n.isArray(e.attachments))&&n.some(e.attachments,(e=>e.contentType===r.AdaptiveCardContentTypes.adaptive))}_encodeParts(e,t,s,i=!1){return super._encodeParts(e,t,s,!0)}static parse(e,t,s,i){if(!t.b64)return;const o=p.atobUtf8(t.b64),n=o&&x.default.parseJsonErrorToUndefined(o);if(!n)return;const r=i?i.conversationId:void 0;if(Ve.isAdaptiveCardMessage(n))return je.parseAdaptiveCard(n,r,t.b64);{const e=i&&i.isMessageLie()&&b.default.isMyMri(i.creator),s=r&&(0,E.isContentChannel)((0,N.default)().getConversation(r))||(null==i?void 0:i.creator)&&(0,E.isTodayBot)(i.creator);return He.parseSwift(n,r,t.b64,!1,e,s)}}}Ve._messageTypes=[u.MessageTypes.RichText,u.MessageTypes.Media_Card],Ve._defaultTag=V.registerForXmlWithMessageTypes("Swift",Ve.parse,...Ve._messageTypes);class He extends Ve{constructor(e,t,s){super(),this.swiftMessage=e,this.conversationId=t,this.b64=s}accept(e){return e.transformSwiftNode(this)}encodedAttr(){if(!this.b64){const e=JSON.stringify(this.swiftMessage);this.b64=p.btoaUtf8(e)}return{b64:this.b64}}static parseSwift(e,t,s,i,o,n){const r=i?e:D.default.sanitizeSwiftMessage(e,o,n);return r?new He(r,t,s):void 0}}t.SwiftNode=He;class je extends Ve{constructor(e,t,s){super(),this.adaptiveCardMessage=e,this.conversationId=t,this.b64=s}accept(e){return e.transformAdaptiveCardNode(this)}encodedAttr(){if(!this.b64){const e=JSON.stringify(this.adaptiveCardMessage);this.b64=p.btoaUtf8(e)}return{b64:this.b64}}static parseAdaptiveCard(e,t,s){const i=l.default.getS4LMessagingFeaturesNoSubscription().enableAdaptiveCardLibs?e:a.default.sanitizeAdaptiveCardMessage(e);return i?new je(i,t,s):void 0}}t.AdaptiveCardNode=je;class ze extends Oe{constructor(e,t,s,i,o,n,r,a,l,d,c,u,h){super(e,t,s,i,o),this.subject=n,this.datetimeMs=r,this.reminder=a,this.conversationId=l,this.scheduledCallId=d,this.isSender=c,this.canceledTimeMs=u,this.editedTimeMs=h}accept(e){return e.transformScheduledCallInviteNode(this)}static parseFromSanitizedParts(e,t,s,i,o,r){const a=!!r&&b.default.isMyMri(r.creator),l=r&&r.conversationId,d=t.datetimeMs&&Number(t.datetimeMs)||void 0,c=t.canceledTimeMs&&Number(t.canceledTimeMs)||void 0,u=t.editedTimeMs&&Number(t.editedTimeMs)||void 0,h=t.reminder&&Number(t.reminder)||A.ScheduledCallReminder.Minutes15;if(d&&n.isString(t.scheduledCallId))return new ze(e,t,s,i,o,n.isString(t.subject)?t.subject:void 0,d,h,l,t.scheduledCallId,a,c,u)}}t.ScheduledCallInviteNode=ze;class We extends Oe{constructor(e,t,s,i,o){super(e,t,s,i,o);const r=n.keyBy(this.children,(e=>e?e.getTag():"undefined")).FileSize;this._fileSubType=this._getFileSubType(t.type);const a=r?parseInt(r.encodedAttr().v,10):0;this._objectSizeUnescaped=n.isFinite(a)?a:0}_getFileSubType(e){var t;switch(null===(t=e.split("/")[1])||void 0===t?void 0:t.split(".")[0]){case"PDF":return R.UploadFileType.PDF;case"AVI":return R.UploadFileType.AVI;case"Zip":return R.UploadFileType.Zip;case"Audio":return R.UploadFileType.Audio;case"Word":return R.UploadFileType.Word;case"Excel":return R.UploadFileType.Excel;case"Powerpoint":return R.UploadFileType.Powerpoint;default:return R.UploadFileType.File}}getFileContentUrlSanitized(){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.File):this._sanitizedUrl||""}getDisplayThumbnailUrlSanitized(){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,this._fileSubType):this._sanitizedThumbnailUrl||""}getFileType(){return R.UploadFileType.File}getFileSubType(){return this._fileSubType}getSizeInBytes(){return this._objectSizeUnescaped}accept(e){return e.transformUriObjectFileNode(this)}static parseFromSanitizedParts(e,t,s,i,o){if(s)return new We(e,t,s,void 0,void 0)}}t.UriObjectFileNode=We;class Ge extends We{}t.DisplayableMedia=Ge;class Ke extends Ge{}t.DisplayableMediaWithThumbnail=Ke;class qe extends Ke{constructor(e,t,s,i,o){if(super(e,t,s,i,o),!this._objectNameUnescaped){const e=n.keyBy(this.children,(e=>e?e.getTag():"undefined")),t=e.meta instanceof Fe?e.meta:void 0;t&&t.originalName&&(this._objectNameUnescaped=t.originalName)}this._sanitizedThumbnailUrl||(this._sanitizedThumbnailUrl=this._sanitizedUrl)}getDisplayUrlSanitized(e=!1){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.MobilePreview):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return l.default.getS4LMessagingFeaturesNoSubscription().enableFullResolutionImageDownload?this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.Full):this._sanitizedUrl||"":this.getDisplayUrlSanitized()}getDisplayMobilePreviewUrlSanitized(){return this.getDisplayUrlSanitized()}getDisplayUrlAsThumbnailSanitized(){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,R.MediaViewSize.Thumbnail):this._sanitizedUrl||""}getDisplayThumbnailUrlSanitized(e=!1){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Picture,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.ThumbnailUncropped):this._sanitizedThumbnailUrl||""}getFileType(){return R.UploadFileType.Picture}getNameForUI(){const e=super.getNameForUI();if(!e){return"Skype_Picture_"+(new Date).toISOString().replace(/[:\.\-]/g,"_")+".jpeg"}return e}accept(e){return e.transformPictureNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s||i)return new qe(e,t,s,i,void 0)}}t.PictureNode=qe,qe.parse=Oe.parse;class Qe extends qe{accept(e){return e.transformImageCreatorPictureNode(this)}getFileType(){return R.UploadFileType.ImageCreatorPicture}static parseFromSanitizedParts(e,t,s,i){if(s||i)return new Qe(e,t,s,i,void 0)}}t.ImageCreatorPictureNode=Qe;class Xe extends Ke{getDisplayUrlSanitized(){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Video,R.MediaViewSize.Full):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return this.getDisplayUrlSanitized()}getDisplayUrlMediaProvider(){return S.MediaProvider.AMS}getDisplayThumbnailUrlSanitized(e=!1){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Video,e?R.MediaViewSize.ThumbnailBlurred:R.MediaViewSize.ThumbnailUncropped):this._sanitizedThumbnailUrl||""}getNameForUI(){const e=super.getNameForUI();return e||"Skype_Video.mp4"}getFileType(){return R.UploadFileType.Video}accept(e){return e.transformVideoNode(this)}static parseFromSanitizedParts(e,t,s,i,o){if(s||i||o)return new Xe(e,t,s,i,o)}}t.VideoNode=Xe,Xe.parse=Oe.parse;class $e extends Xe{getNameForUI(){const e=super.getNameForUI();return e||"Skype_Video_Message.mp4"}accept(e){return e.transformVideoMessageNode(this)}getFileType(){return R.UploadFileType.VideoMessage}static parseFromSanitizedParts(e,t,s,i,o){if(s||i||o)return new $e(e,t,s,i,o)}}t.VideoMessageNode=$e,$e.parse=Oe.parse;class Je extends Ge{getDisplayUrlSanitized(){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.Audio,R.MediaViewSize.Full):this._sanitizedUrl||""}getFullResolutionUrlSanitized(){return this.getDisplayUrlSanitized()}accept(e){return e.transformAudioNode(this)}getFileType(){return R.UploadFileType.Audio}static parseFromSanitizedParts(e,t,s,i){if(s)return new Je(e,t,s,void 0,void 0)}}t.AudioNode=Je,Je.parse=Oe.parse;class Ye extends Je{constructor(e,t,s,i,o){super(e,t,s,i,void 0),this.audioDurationMs=o}getDisplayUrlSanitized(){return this._amsDocumentId?d.getDisplayUrl(this._amsDocumentId,R.UploadFileType.AudioMessage,R.MediaViewSize.Full):this._sanitizedUrl||""}getAudioTranscritionUrlSanitized(){return this._amsDocumentId?d.getTranscriptionUrl(this._amsDocumentId):this._sanitizedUrl||""}accept(e){return e.transformAudioMessageNode(this)}getFileType(){return R.UploadFileType.AudioMessage}getAudioDurationMs(){return this.audioDurationMs}static parseFromSanitizedParts(e,t,s,i){if(s)return new Ye(e,t,s,void 0,Number(t.duration_ms)||void 0)}}t.AudioMessageNode=Ye,Ye.parse=Oe.parse;class Ze extends fe{constructor(e,t,s){super(e,Ze._defaultTag),this.attributes=t,this._albumId=s}getMessageTypes(){return Ze._messageTypes}encodedAttr(){return this.attributes}getAlbumId(){return this._albumId}accept(e){return e.transformMediaAlbumNode(this)}static parse(e,t){if(n.isString(t.albumId))return new Ze(e,t,t.albumId)}}t.MediaAlbumNode=Ze,Ze._messageTypes=[u.MessageTypes.MediaAlbum],Ze._defaultTag=V.registerForXmlWithMessageTypes("MediaAlbum",Ze.parse,...Ze._messageTypes);class et extends Oe{constructor(e,t,s,i){super(e,t,s,i,void 0)}getSourceUrlSanitized(){return this._sanitizedUrl}accept(e){return e.transformStickerNode(this)}static parseFromSanitizedParts(e,t,s,i){if(s)return new et(e,t,s,i)}}t.StickerNode=et;class tt extends fe{constructor(e,t){super(e,tt._defaultTag),this.attr=t}getMessageTypes(){return tt._messageTypes}accept(e){return e.transformSkypeVideoMessageNode(this)}encodedAttr(){return this.attr}static parse(e,t){if(n.isString(t.sid)&&0!==t.sid.length)return new tt(e,t)}}t.SkypeVideoMessageNode=tt,tt._messageTypes=[u.MessageTypes.SkypeVideoMessage],tt._defaultTag=V.registerForXmlWithMessageTypes("videomessage",tt.parse,...tt._messageTypes);class st extends fe{constructor(e,t,s,i){super([].concat(e,t,s),i),this.eventTime=e,this.initiator=t,this.content=s}static isCreatorTrusted(e){return!!e.creator&&h.isThread(e.creator)}}t.ThreadActivity=st;class it extends st{constructor(e,t,s,i){super(e,t,s,it._defaultTag),this.conversationId=i}getMessageTypes(){return it._messageTypes}accept(e){return e.transformAddMemberNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof we))&&i&&st.isCreatorTrusted(i))return new it(e,t,s,i.conversationId)}}}t.AddMemberNode=it,it._messageTypes=[u.MessageTypes.AddMember],it._defaultTag=V.registerForXmlWithMessageTypes("addmember",it.parse,...it._messageTypes);class ot extends st{constructor(e,t,s){super(e,t,s,ot._defaultTag)}getMessageTypes(){return ot._messageTypes}accept(e){return e.transformDeleteMemberNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof we))&&i&&st.isCreatorTrusted(i))return new ot(e,t,s)}}}t.DeleteMemberNode=ot,ot._messageTypes=[u.MessageTypes.DeleteMember],ot._defaultTag=V.registerForXmlWithMessageTypes("deletemember",ot.parse,...ot._messageTypes);class nt extends st{constructor(e,t,s){super(e,t,s,nt._defaultTag)}getMessageTypes(){return nt._messageTypes}accept(e){return e.transformRoleUpdateNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof ke))&&i&&st.isCreatorTrusted(i))return new nt(e,t,s)}}}t.RoleUpdateNode=nt,nt._messageTypes=[u.MessageTypes.RoleUpdate],nt._defaultTag=V.registerForXmlWithMessageTypes("roleupdate",nt.parse,...nt._messageTypes);class rt extends st{constructor(e,t,s){super(e,t,s,rt._defaultTag)}getMessageTypes(){return rt._messageTypes}accept(e){return e.transformTopicUpdateNode(this)}static parse(e,t,s,i){const o=Te(e);if(o){const[e,t,s]=o;if(i&&st.isCreatorTrusted(i))return new rt(e,t,s)}}}t.TopicUpdateNode=rt,rt._messageTypes=[u.MessageTypes.TopicUpdate],rt._defaultTag=V.registerForXmlWithMessageTypes("topicupdate",rt.parse,...rt._messageTypes);class at extends st{constructor(e,t,s){super(e,t,s,at._defaultTag)}getMessageTypes(){return at._messageTypes}accept(e){return e.transformHandshakeInviteNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof we))&&i&&st.isCreatorTrusted(i))return new at(e,t,s)}}}t.HandshakeInviteNode=at,at._messageTypes=[u.MessageTypes.HandshakeInvite],at._defaultTag=V.registerForXmlWithMessageTypes("handshakeinvite",at.parse,...at._messageTypes);class lt extends st{constructor(e,t,s){super(e,t,s,lt._defaultTag)}getMessageTypes(){return lt._messageTypes}accept(e){return e.transformHandshakeAcceptNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof we))&&i&&st.isCreatorTrusted(i))return new lt(e,t,s)}}}t.HandshakeAcceptNode=lt,lt._messageTypes=[u.MessageTypes.HandshakeAccept],lt._defaultTag=V.registerForXmlWithMessageTypes("handshakeaccept",lt.parse,...lt._messageTypes);class dt extends st{constructor(e,t,s){super(e,t,s,dt._defaultTag)}getMessageTypes(){return dt._messageTypes}accept(e){return e.transformHandshakeCompleteNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof we))&&i&&st.isCreatorTrusted(i))return new dt(e,t,s)}}}t.HandshakeCompleteNode=dt,dt._messageTypes=[u.MessageTypes.HandshakeComplete],dt._defaultTag=V.registerForXmlWithMessageTypes("handshakecomplete",dt.parse,...dt._messageTypes);class ct extends st{constructor(e,t,s){super(e,t,s,ct._defaultTag)}getMessageTypes(){return ct._messageTypes}accept(e){return e.transformHandshakeRejectNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof we))&&i&&st.isCreatorTrusted(i))return new ct(e,t,s)}}}t.HandshakeRejectNode=ct,ct._messageTypes=[u.MessageTypes.HandshakeReject],ct._defaultTag=V.registerForXmlWithMessageTypes("handshakereject",ct.parse,...ct._messageTypes);class ut extends st{constructor(e,t,s){super(e,t,s,ut._defaultTag)}getMessageTypes(){return ut._messageTypes}accept(e){return e.transformPictureUpdateNode(this)}static parse(e,t,s,i){const o=Te(e);if(o){const[e,t,s]=o;if(i&&st.isCreatorTrusted(i))return new ut(e,t,s)}}}t.PictureUpdateNode=ut,ut._messageTypes=[u.MessageTypes.PictureUpdate],ut._defaultTag=V.registerForXmlWithMessageTypes("pictureupdate",ut.parse,...ut._messageTypes);class ht extends st{constructor(e,t,s,i){super(e,t,s,ht._defaultTag),this.nowDisclosed=i}getMessageTypes(){return ht._messageTypes}accept(e){return e.transformHistoryDisclosedUpdateNode(this)}static parse(e,t,s,i){const o=Te(e);if(o){const[e,t,s]=o;if(i&&st.isCreatorTrusted(i)){const i=s.getRawText().toLocaleLowerCase();return new ht(e,t,s,"false"!==i)}}}}t.HistoryDisclosedUpdateNode=ht,ht._messageTypes=[u.MessageTypes.HistoryDisclosedUpdate],ht._defaultTag=V.registerForXmlWithMessageTypes("historydisclosedupdate",ht.parse,...ht._messageTypes);class pt extends st{constructor(e,t,s,i){super(e,t,s,pt._defaultTag),this.nowEnabled=i}getMessageTypes(){return pt._messageTypes}accept(e){return e.transformJoiningEnabledUpdateNode(this)}static parse(e,t,s,i){const o=Te(e);if(o){const[e,t,s]=o;if(i&&st.isCreatorTrusted(i)){const i=s.getRawText().toLocaleLowerCase();return new pt(e,t,s,"false"!==i)}}}}t.JoiningEnabledUpdateNode=pt,pt._messageTypes=[u.MessageTypes.JoiningEnabledUpdate],pt._defaultTag=V.registerForXmlWithMessageTypes("joiningenabledupdate",pt.parse,...pt._messageTypes);class gt extends st{constructor(e,t,s){super(e,t,s,gt._defaultTag),this.link=gt._link}getMessageTypes(){return gt._messageTypes}accept(e){return e.transformLegacyMemberAddedNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof Pe))&&i&&st.isCreatorTrusted(i))return new gt(e,t,s)}}}t.LegacyMemberAddedNode=gt,gt._link=ne.parseFromHref("https://www.skype.com/en/download-skype/skype-for-computer/"),gt._messageTypes=[u.MessageTypes.LegacyMemberAdded],gt._defaultTag=V.registerForXmlWithMessageTypes("legacymemberadded",gt.parse,...gt._messageTypes);class mt extends st{constructor(e,t,s){super(e,t,s,mt._defaultTag)}getMessageTypes(){return mt._messageTypes}accept(e){return e.transformLegacyMemberUpgradedNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;if(n.every(s,(e=>e instanceof Pe))&&i&&st.isCreatorTrusted(i))return new mt(e,t,s)}}}t.LegacyMemberUpgradedNode=mt,mt._messageTypes=[u.MessageTypes.LegacyMemberUpgraded],mt._defaultTag=V.registerForXmlWithMessageTypes("legacymemberupgraded",mt.parse,...mt._messageTypes);class St extends fe{constructor(e,t,s,i){super([e].concat(t||[]),St._defaultTag),this.nameChild=e,this.durationChild=t,this.identity=s,this.live_identity=i}getMessageTypes(){return St._messageTypes}accept(e){return e.transformPartNode(this)}encodedAttr(){return{identity:this.identity,live_identity:this.live_identity}}static parse(e,t){if(2===(e=n.reject(e,(e=>!e||e.isEmptyTextNodeOrContainingWhitespacesOnly()))).length||1===e.length){const s=n.keyBy(e,(e=>e?e.getTag():"undefined")),i=s[be.tags.Name]instanceof be?s[be.tags.Name]:void 0,o=s[be.tags.Duration]instanceof be?s[be.tags.Duration]:void 0;if(i)return new St(i,o,String(t.identity),String(t.live_identity))}}}t.PartNode=St,St._messageTypes=[u.MessageTypes.Call],St._defaultTag=V.registerForXmlWithMessageTypes("part",St.parse,...St._messageTypes);class _t extends fe{constructor(e,t,s,i,o){super(e,_t._defaultTag),this.type=t,this.alt=s,this.callId=i,this.conversationId=o}accept(e){return e.transformPartListNode(this)}encodedAttr(){return{type:this.type,alt:this.alt,callId:this.callId}}getMessageTypes(){return _t._messageTypes}static parse(e,t,s,i){let o;if(e=n.reject(e,(e=>!!e&&e.isEmptyTextNodeOrContainingWhitespacesOnly())),n.isString(t.callId)&&t.callId.length)o=t.callId;else{if(!i||!n.isString(i.skypeguid)||0===i.skypeguid.length)return;o=i.skypeguid}const r=i?i.conversationId:void 0;if(n.every(e,(e=>e instanceof St)))return new _t(e,n.isString(t.type)?t.type:void 0,String(t.alt),o,r)}}t.PartListNode=_t,_t._messageTypes=[u.MessageTypes.Call],_t._defaultTag=V.registerForXmlWithMessageTypes("partlist",_t.parse,..._t._messageTypes);class ft extends fe{constructor(e){super(e,ft._defaultTag)}accept(e){return e.transformEndedNode(this)}getMessageTypes(){return ft._messageTypes}static parse(e){if(0===e.length)return new ft(e)}}t.EndedNode=ft,ft._messageTypes=[u.MessageTypes.Call],ft._defaultTag=V.registerForXmlWithMessageTypes("ended",ft.parse,...ft._messageTypes);class yt extends Oe{constructor(e,t,s,i,o,n,r,a){super(e,t,void 0,void 0,void 0),this.callId=s,this.threadId=i,this.containerType=o,this.timestamp=n,this.label=r,this.locationName=a}accept(e){return e.transformCallInfoUriObjectNode(this)}static parseFromSanitizedParts(e,t,s,i){if(!(n.isString(t.callId)&&t.threadId&&h.isThread(t.threadId)&&n.isString(t.containerType)&&n.isString(t.timestamp)))return;const o=n.isString(t.label)?F.default.unescapeXml(t.label):void 0,r=n.isString(t.locationName)?F.default.unescapeXml(t.locationName):void 0,a=Number(t.timestamp);return n.isNaN(a)?void 0:new yt(e,t,t.callId,t.threadId,t.containerType,a,o,r)}}t.CallInfoUriObjectNode=yt;class vt extends G{constructor(e,t,s,i){super([],vt._defaultTag),this._id=e,this._style=t,this._internalType=s,this._userMri=i}accept(e){return e.transformUnknownNode(this)}encodedAttr(){return{id:this._id,style:this._style,internalType:this._internalType,userMri:this._userMri}}getStyle(){return this._style||R.ReactionsTextStyle.Default}getInternalType(){return this._internalType||R.ReactionsTextType.Default}getUserMri(){return this._userMri}isEmptyTextNodeOrContainingWhitespacesOnly(){return!0}isEmptyTextNodeOrContainingSpaceCharsOnly(){return!0}static parse(e,t){if(0===e.length&&n.isString(t.id))return new vt(t.id,t.style?parseInt(t.style,10):void 0,t.internalType?parseInt(t.internalType,10):void 0,t.userMri)}}t.CallReactionMetadataNode=vt,vt._defaultTag=V.registerForXml("c_i",vt.parse);class Ct extends fe{constructor(e,t,s,i){super(e,Ct._defaultTag),this.type=t,this._rawUserMrisOrNames=s,this.userMrisOrNames=i}encodedAttr(){return{type:this.type,users:this._rawUserMrisOrNames}}accept(e){return e.transformNgcUpgradeNode(this)}static parse(e,t){if("ngcUpgradeMessage"===t.type)return new Ct(e,t.type,String(t.users),n.isString(t.users)?F.default.unescapeXml(t.users).split(","):[])}}t.NgcUpgradeSystemMessageNode=Ct,Ct._defaultTag=V.registerForXml("systemMessage",Ct.parse);class Tt extends Oe{constructor(e,t,s,i,o,n,r,a,l){super(e,t,s,i,o),this.children=e,this.title=n,this.expirationTimeMs=r,this.options=a,this.allowMultipleVotes=l}accept(e){return e.transformPollNode(this)}getAttr(){return{}}static parseFromSanitizedParts(e,t,s,i,o){const r=t.expirationTimeMs&&Number(t.expirationTimeMs)||Date.now(),a=n.isString(t.title)?t.title:"",l=n.isString(t.optionsEncoded)?P.decodePollOptions(t.optionsEncoded):[],d="true"===t.allowMultipleVotes;return new Tt(e,t,s,i,o,a,r,l,d)}}t.PollNode=Tt;class Mt extends fe{constructor(e,t,s,i){super([],i||Mt._defaultTag),this.type=e,this.content=t,this.contentNode=s,this._customTag=i}accept(e){return e.transformDataNode(this)}encode(){return this.content}getMessageTypes(){return Mt._messageTypes}static parse(e){const{type:t,content:s}=e;if(t){const e=parseInt(M.DataMessageContentType[t],10);if(e&&s){const i=K.fromPlainText(t||"");return new Mt(e,s,i)}}return Mt.parseFallback()}static parseData(e){if(e){const t=x.default.parseJsonErrorToUndefined(e);if(t&&t.type){const s=K.fromPlainText(M.DataMessageContentType[t.type]);return new Mt(t.type,e,s)}}return Mt.parseFallback()}static parseFallback(){const e=K.fromPlainText(T.getString("MessageContentNodes.DataFallback"));return new Mt(M.DataMessageContentType.Unknown,"",e)}}t.DataNode=Mt,Mt._messageTypes=[u.MessageTypes.Data,u.MessageTypes.TranslationSettings],Mt._defaultTag=V.registerForJson(u.MessageTypes.Data,Mt.parseData);class bt extends Mt{constructor(e,t,s){super(e,t,s,bt._defaultTagValue),this.type=e,this.content=t,this.contentNode=s}static parse(e){const{type:t,content:s}=e;if(t){const e=parseInt(M.DataMessageContentType[t],10);if(e&&s){const i=K.fromPlainText(t||"");return new bt(e,s,i)}}return Mt.parseFallback()}static parseData(e){if(e){const t=x.default.parseJsonErrorToUndefined(e);if(t&&t.type){const s=K.fromPlainText(M.DataMessageContentType[t.type]);return new bt(t.type,e,s)}}return Mt.parseFallback()}}t.TranslationSettingsNode=bt,bt._defaultTagValue=V.registerForJson(u.MessageTypes.TranslationSettings,Mt.parseData);class It extends fe{constructor(e,t,s){super([],It._defaultTag),this.translation=e,this.originalLocale=t,this.contentNode=s}accept(e){return e.transformTranslationNode(this)}encode(){return this.translation}getUriObjectNode(e){return this.contentNode.getUriObjectNode(e)}getMessageTypes(){return It._messageTypes}static parse(e,t){if(e&&t){const s=K.fromPlainText(e);return new It(e,t,s)}return It._parseFallback(e)}static parseTranslation(e){if(e){const t=u.getMessageTranslationMetadata(e);if(t){const e=K.fromPlainText(t.translations[0].translation);return new It(t.translations[0].translation,t.oloc,e)}}return It._parseFallback(e)}static _parseFallback(e){const t=K.fromPlainText(T.getString("MessageContentNodes.TranslationFallback"));return new It(e,void 0,t)}}t.TranslationNode=It,It._messageTypes=[u.MessageTypes.Translation],It._defaultTag=V.registerForJson(u.MessageTypes.Translation,It.parseTranslation);class wt extends Ie{constructor(e,t){super([]),this.oldName=e,this.newName=t}accept(e){return e.transformGuestNameUpdateTargetNode(this)}encodedAttr(){return{oldName:this.oldName,newName:this.newName}}}t.GuestUpdateTargetNode=wt;class Pt extends st{constructor(e,t,s){super(e,t,s,Pt._defaultTag)}getMessageTypes(){return Pt._messageTypes}accept(e){return e.transformGuestNameUpdateNode(this)}static parse(e,t,s,i){const o=Ce(e);if(o){const[e,t,s]=o;return new Pt(e,t,s)}return new Pt(new be(K.fromPlainText(""),""),new be(K.fromPlainText(""),""),[new wt(String(t.oldName),String(t.newName))])}}t.GuestUpdateNode=Pt,Pt._messageTypes=[u.MessageTypes.GuestNameUpdate],Pt._defaultTag=V.registerForXml("guestNameUpdate",Pt.parse);class kt extends Oe{constructor(e,t,s,i,o){super(e,t,void 0,void 0,void 0),this.items=s,this.showMore=i,this.label=o}accept(e){return e.transformMagicBotToolboxNode(this)}static parseFromSanitizedParts(e,t){if(!t.itemsEncoded)return;const s=p.atobUtf8(t.itemsEncoded);if(!s)return;const i=x.default.parseJsonErrorToUndefined(s);if(!i)return;const o="true"===t.showMore,{enableImageCreator:n}=l.default.getS4LMessagingFeaturesNoSubscription(),r=T.getString("MagicBot.ToolboxMessageDefaultLabel"),a=F.default.unescapeXml(t.label||r);return new kt(e,t,(0,O.processEngagementApiResponseItem)(i,void 0,void 0,n),o,a)}}t.MagicBotToolboxNode=kt},771369:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extraTextNodeParsing=function(e,t,s,i){try{return new h({extractEmoticons:t,extractLinks:s,extractSuggestedTextHighlights:i}).transform(e)}catch(e){d.error(r.LogTraceArea.GenericUnsafe,"TextEntityExtractionTransformer: Failed to transform tree: "+u.default.errorAsString(e))}return e};const i=s(197582),o=i.__importStar(s(496486)),n=s(284841),r=s(815146),a=i.__importStar(s(626065)),l=i.__importStar(s(7040)),d=i.__importStar(s(85385)),c=i.__importStar(s(606933)),u=i.__importDefault(s(655192));class h{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformEditMessageMetaDataNode=o.identity,this.transformHighlightedNode=o.identity,this.transformAtMentionNode=o.identity,this.transformUserMriNode=o.identity,this.transformEmoticonNode=o.identity,this.transformFlagNode=o.identity,this.transformQuoteNode=this._default,this.transformLegacyQuoteNode=o.identity,this.transformWikiMarkupNode=this._default,this.transformListWikiMarkupNode=this._default,this.transformLinkNode=o.identity,this.transformBingResponseNode=o.identity,this.transformDeepLinkNode=o.identity,this.transformAttributionNode=o.identity,this.transformAttributionsTextNode=o.identity,this.transformAttributionsGroupNode=o.identity,this.transformEmoteNode=o.identity,this.transformContextNode=o.identity,this.transformRosterContextNode=o.identity,this.transformLocationContextNode=o.identity,this.transformSwiftUriObjectNode=o.identity,this.transformSwiftNode=o.identity,this.transformAdaptiveCardNode=o.identity,this.transformScheduledCallInviteNode=o.identity,this.transformUnknownNode=o.identity,this.transformTextWrapperNode=o.identity,this.transformTargetUserNode=o.identity,this.transformTargetLegacyUserNode=o.identity,this.transformTargetRoleNode=o.identity,this.transformTargetsNode=o.identity,this.transformContactNode=o.identity,this.transformContactsNode=o.identity,this.transformFileNode=o.identity,this.transformFilesNode=o.identity,this.transformSmsNode=o.identity,this.transformMmsNode=o.identity,this.transformLocationNode=o.identity,this.transformMetaNode=o.identity,this.transformUriObjectNode=o.identity,this.transformUriObjectFileNode=o.identity,this.transformPictureNode=o.identity,this.transformVideoNode=o.identity,this.transformVideoMessageNode=o.identity,this.transformAudioNode=o.identity,this.transformAudioMessageNode=o.identity,this.transformSkypeVideoMessageNode=o.identity,this.transformCallInfoUriObjectNode=o.identity,this.transformStickerNode=o.identity,this.transformAddMemberNode=o.identity,this.transformDeleteMemberNode=o.identity,this.transformRoleUpdateNode=o.identity,this.transformTopicUpdateNode=o.identity,this.transformHandshakeInviteNode=o.identity,this.transformHandshakeAcceptNode=o.identity,this.transformHandshakeCompleteNode=o.identity,this.transformHandshakeRejectNode=o.identity,this.transformPictureUpdateNode=o.identity,this.transformHistoryDisclosedUpdateNode=o.identity,this.transformJoiningEnabledUpdateNode=o.identity,this.transformLegacyMemberAddedNode=o.identity,this.transformLegacyMemberUpgradedNode=o.identity,this.transformPartNode=o.identity,this.transformPartListNode=o.identity,this.transformEndedNode=o.identity,this.transformPollNode=o.identity,this.transformNgcUpgradeNode=o.identity,this.transformSuggestedTextHighlightNode=o.identity,this.transformCallerIDNode=o.identity,this.transformMediaAlbumNode=o.identity,this.transformTranslationNode=o.identity,this.transformDataNode=o.identity,this.transformHtmlNode=o.identity,this.transformGuestNameUpdateNode=o.identity,this.transformGuestNameUpdateTargetNode=o.identity,this.transformMagicBotToolboxNode=o.identity,this.transformImageCreatorPictureNode=o.identity}_default(e){const t=(0,n.chain)(e.children,(0,n.map)((e=>{const t=e&&e.accept(this);return t instanceof c.RootNode?o.compact(t.children):t})),(0,n.compact)(),(0,n.flatten)());return e.cloneWithChildren(t)}transform(e){return e.accept(this)}transformPlainTextNode(e){const t=e.getRawText();if(!t)return e;let s=[new a.UnhandledEntity(t)];this._options.extractEmoticons&&(s=l.handleEmoticons(s)),this._options.extractLinks&&(s=l.handleLinks(s)),this._options.extractSuggestedTextHighlights&&(s=l.handleSuggestedTextHighlights(s,this._options.extractSuggestedTextHighlights));const i=o.map(s,(e=>e.decode()));return 1===i.length?i[0]:c.RootNode.parse(i)}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}}},151619:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeEmojiTransformer=void 0,t.transformUnicodeEmojis=function(e,t){try{return new h({lookupEmoticons:t}).transform(e)}catch(e){l.error(a.LogTraceArea.GenericUnsafe,"TextEntityExtractionTransformer: Failed to transform tree: "+c.default.errorAsString(e))}return e};const i=s(197582),o=i.__importDefault(s(312846)),n=i.__importStar(s(496486)),r=s(284841),a=s(815146),l=i.__importStar(s(85385)),d=s(606933),c=i.__importDefault(s(655192)),u=(0,o.default)();class h{constructor(e){this._options=e,this.transformRootNode=this._default,this.transformHighlightedNode=n.identity,this.transformUnknownNode=n.identity,this.transformEditMessageMetaDataNode=n.identity,this.transformAtMentionNode=n.identity,this.transformUserMriNode=n.identity,this.transformUnicodeEmojiNode=n.identity,this.transformEmoticonNode=n.identity,this.transformFlagNode=n.identity,this.transformQuoteNode=n.identity,this.transformLegacyQuoteNode=n.identity,this.transformWikiMarkupNode=n.identity,this.transformListWikiMarkupNode=n.identity,this.transformLinkNode=n.identity,this.transformBingResponseNode=n.identity,this.transformDeepLinkNode=n.identity,this.transformAttributionNode=n.identity,this.transformAttributionsTextNode=n.identity,this.transformAttributionsGroupNode=n.identity,this.transformEmoteNode=n.identity,this.transformContextNode=n.identity,this.transformRosterContextNode=n.identity,this.transformLocationContextNode=n.identity,this.transformTextWrapperNode=n.identity,this.transformTargetUserNode=n.identity,this.transformTargetLegacyUserNode=n.identity,this.transformTargetRoleNode=n.identity,this.transformTargetsNode=n.identity,this.transformContactNode=n.identity,this.transformContactsNode=n.identity,this.transformFileNode=n.identity,this.transformFilesNode=n.identity,this.transformSmsNode=n.identity,this.transformMmsNode=n.identity,this.transformLocationNode=n.identity,this.transformMetaNode=n.identity,this.transformUriObjectNode=n.identity,this.transformUriObjectFileNode=n.identity,this.transformPictureNode=n.identity,this.transformVideoNode=n.identity,this.transformVideoMessageNode=n.identity,this.transformAudioNode=n.identity,this.transformAudioMessageNode=n.identity,this.transformCallInfoUriObjectNode=n.identity,this.transformStickerNode=n.identity,this.transformSkypeVideoMessageNode=n.identity,this.transformAddMemberNode=n.identity,this.transformDeleteMemberNode=n.identity,this.transformRoleUpdateNode=n.identity,this.transformTopicUpdateNode=n.identity,this.transformHandshakeInviteNode=n.identity,this.transformHandshakeAcceptNode=n.identity,this.transformHandshakeCompleteNode=n.identity,this.transformHandshakeRejectNode=n.identity,this.transformPictureUpdateNode=n.identity,this.transformHistoryDisclosedUpdateNode=n.identity,this.transformJoiningEnabledUpdateNode=n.identity,this.transformLegacyMemberAddedNode=n.identity,this.transformLegacyMemberUpgradedNode=n.identity,this.transformPartNode=n.identity,this.transformPartListNode=n.identity,this.transformEndedNode=n.identity,this.transformSwiftUriObjectNode=n.identity,this.transformSwiftNode=n.identity,this.transformAdaptiveCardNode=n.identity,this.transformScheduledCallInviteNode=n.identity,this.transformNgcUpgradeNode=n.identity,this.transformSuggestedTextHighlightNode=n.identity,this.transformPollNode=n.identity,this.transformCallerIDNode=n.identity,this.transformMediaAlbumNode=n.identity,this.transformTranslationNode=n.identity,this.transformDataNode=n.identity,this.transformHtmlNode=n.identity,this.transformGuestNameUpdateNode=n.identity,this.transformGuestNameUpdateTargetNode=n.identity,this.transformMagicBotToolboxNode=n.identity,this.transformImageCreatorPictureNode=n.identity}static addUtfLookup(e,t){e in h._utfLookup||(h._utfLookup[e]=t)}_default(e){const t=(0,r.chain)(e.children,(0,r.map)((e=>{const t=e&&e.accept(this);return t instanceof d.RootNode?n.compact(t.children):t})),(0,r.compact)(),(0,r.flatten)());return e.cloneWithChildren(t)}transform(e){return e.accept(this)}transformPlainTextNode(e){const t=e.getRawText(),s=this._parseText(t);if(1===s.length)return s[0];return d.RootNode.parse(s)}_parseText(e){if(-1===e.search(u))return[d.PlainTextNode.fromPlainText(e)];const t=[];let s,i=0;for(;s=u.exec(e);){i!==s.index&&t.push(d.PlainTextNode.fromPlainText(e.substring(i,s.index))),i=s.index+s[0].length;const o=e.substring(s.index,i);if(this._options.lookupEmoticons&&o in h._utfLookup){const e=h._utfLookup[o],s=d.PlainTextNode.fromPlainText(`(${e})`);t.push(new d.EmoticonNode(s,e,void 0))}else t.push(d.UnicodeEmojiNode.fromPlainText(o))}return i!==e.length&&t.push(d.PlainTextNode.fromPlainText(e.substring(i,e.length))),u.lastIndex=0,t}}t.UnicodeEmojiTransformer=h,h._utfLookup={}},117746:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WikiPrefix=void 0,t.splitWikiMarkupPrefix=function(e){const t=o.clone(e),s=t[0]instanceof r.UnhandledEntity?0:t.length>1&&t[0]instanceof r.QuoteEntity&&t[1]instanceof r.UnhandledEntity?1:-1;let i=c.None;if(s>-1){const e=t[s].text();T("!!",e,s,t.length)?i=c.DoNotFormat:T("@@",e,s,t.length)&&(i=c.NoWiki),i!==c.None&&(t[s]=new r.UnhandledEntity(e.substring(3)))}return{entities:t,prefix:i}},t.encodeWikiMarkupWithoutPrefix=function(e){if(!e||!e.length)return e;const t=function(e){const t=(0,n.chain)(e,(0,n.map)((e=>e instanceof r.UnhandledEntity?e.text():e)),(0,n.flatten)(),(0,n.map)((e=>{if(!o.isString(e)){const t=e;if(t instanceof r.QuoteEntity)return[{char:"h",data:t},{char:"\n",data:""}];if(t instanceof r.EditMessageMetaDataEntity||t instanceof r.ContextEntity)return{char:"w",data:t};const s=t.text();return{char:s&&g.test(s)?"\r":"h",data:t}}const t=e,s=[],i=t.length;for(let e=0;e<i;){let i;if(p.indexOf(t.charAt(e))>-1){const s=h.length;for(let o=0;o<s;o++){const s=h[o];if(s.raw_pre===t.substring(e,e+s.raw_pre.length)?i=s.raw_pre:s.raw_post===t.substring(e,e+s.raw_post.length)&&(i=s.raw_post),i)break}}if(i)s.push({char:t.charAt(e),data:i}),e+=i.length;else{const i=t.charAt(e),o={char:g.test(i)?"\n":m.test(i)?"!":S.test(i)?" ":"a",data:i};s.push(o),e++}}return s})),(0,n.flatten)(),(e=>{const t=[];return o.each(e,(e=>{const s=o.last(t);s&&s.char===e.char&&"\n! a".indexOf(e.char)>-1?s.data=s.data+e.data:t.push(e)})),t}));return t}(e);return C(t,[])};const i=s(197582),o=i.__importStar(s(496486)),n=s(284841),r=i.__importStar(s(626065)),a=i.__importDefault(s(114818));var l,d,c;!function(e){e[e.WT_BOLD=0]="WT_BOLD",e[e.WT_ITALIC=1]="WT_ITALIC",e[e.WT_CODE=2]="WT_CODE",e[e.WT_STRIKE=3]="WT_STRIKE"}(l||(l={})),function(e){e[e.MT_SPAN=0]="MT_SPAN",e[e.MT_ANY=1]="MT_ANY"}(d||(d={})),function(e){e[e.None=0]="None",e[e.DoNotFormat=1]="DoNotFormat",e[e.NoWiki=2]="NoWiki"}(c||(t.WikiPrefix=c={}));class u{constructor(e,t,s,i,o=i){this.type=e,this.matchType=t,this.tag=s,this.raw_pre=i,this.raw_post=o,this.tokenSymbol=this.raw_pre[0]}}const h=[new u(l.WT_BOLD,d.MT_SPAN,"b","*"),new u(l.WT_ITALIC,d.MT_SPAN,"i","_"),new u(l.WT_CODE,d.MT_ANY,"pre","{code}"),new u(l.WT_STRIKE,d.MT_SPAN,"s","~"),new u(l.WT_CODE,d.MT_ANY,"pre","```")],p=o.map(h,(e=>e.raw_pre[0])).join(""),g=/[\r\n]/,m=/[,.!?*_{}()]/,S=/[ \f\t\v​\u00a0\u1680​\u180e\u2000-\u200a​\u2028\u2029\u202f\u205f​\u3000\ufeff]/;function _(e,t){return 0===t||-1!=="w \n".indexOf(e[t-1].char)||"!"===e[t-1].char&&(1===t||-1!=="w \n".indexOf(e[t-2].char))||t===e.length-1||-1!=="w \n".indexOf(e[t+1].char)||"!"===e[t+1].char&&(t+2===e.length||-1!=="w \n".indexOf(e[t+2].char))}function f(e){const t=[];return o.each(e,(e=>{const s=o.last(t),i=e.data;if(s instanceof r.UnhandledEntity){if(o.isString(i))return void s.appendText(i);if(i instanceof r.UnhandledEntity)return void s.appendText(i.text())}o.isString(i)?t.push(new r.UnhandledEntity(i)):t.push(i)})),t}function y(e){const t=new r.UnhandledEntity;return o.each(e,(e=>{const s=e.data;o.isString(s)?t.appendText(s):t.appendText(s.text())})),[t]}function v(e,t){let s=t;for(;s+1<e.length&&(0,a.default)(e[s+1],e[s]);)s++;return s}function C(e,t){const s=[];let i=0;const n=e.length;for(let c=0;c<n;c++){const u=o.find(h,(s=>e[c].char===s.raw_pre[0]&&!o.includes(t,s)));if(u&&_(e,c)){for(let o=v(e,c)+1;o<n&&(u.matchType!==d.MT_SPAN||(a=e[o].char,!g.test(a)));o++)if(e[o].char===u.raw_post[0]&&_(e,o)){if(o=v(e,o),i<c){const t=e.slice(i,c);s.push(f(t))}if(c+1<o){const i=e.slice(c+1,o),n=u.type!==l.WT_CODE?C(i,t.concat(u)):y(i),a=new r.WikiMarkupEntity(n,u.tag,u.raw_pre,u.raw_post);s.push([a])}c=o,i=c+1;break}}}var a;return s.length?(i!==e.length&&s.push(f(e.slice(i))),o.flatten(s)):f(e)}function T(e,t,s,i){const o=new RegExp("^"+e+"\\s+\\S"),n=new RegExp("^"+e+"\\s+");return o.test(t)||n.test(t)&&s+1<i}},160560:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.messageSupportsReacting=t.SkypeConversationLocal=void 0;const i=s(197582);var o=s(370073);Object.defineProperty(t,"SkypeConversationLocal",{enumerable:!0,get:function(){return i.__importDefault(o).default}}),i.__exportStar(s(462478),t);var n=s(116205);Object.defineProperty(t,"messageSupportsReacting",{enumerable:!0,get:function(){return n.messageSupportsReacting}})},116205:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.messageSupportsReacting=function(e,{screenReaderEnabled:t}){return e&&!t}},303693:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CREATE_CLIPS_RECORDING_COMMAND=t.ADD_CELLULAR_SMS_CONVERSATION_COMMAND=t.ADD_CONVERSATION_PRIVATE_COMMAND=t.ADD_CONVERSATION_1ON1_COMMAND=t.ADD_CONTENT_CHANNEL_COMMAND=t.ADD_CONVERSATION_GROUP_COMMAND=t.ADD_CONVERSATION_MODERATED_GROUP_COMMAND=void 0,t.getExperimentCreateMenuItems=function({hasSMS:e,hasSkypeClips:s,hasNewChannel:i}){return[{key:"newChat",items:[{text:(0,n.getString)("Hub.New1on1ChatLabel"),command:t.ADD_CONVERSATION_1ON1_COMMAND,icon:a.SkypeIcon.Chat},{text:(0,n.getString)("Hub.NewGroupChatLabel"),command:t.ADD_CONVERSATION_GROUP_COMMAND,icon:a.SkypeIcon.PeopleAdd},i?{text:(0,n.getString)("Hub.NewChannelChatLabel"),command:t.ADD_CONTENT_CHANNEL_COMMAND,icon:a.SkypeIcon.Channel,postLabel:r.default.deburrUpperCase((0,n.getString)("Hub.NewChannelBetaLabel"))}:void 0].filter((e=>e))},s?{key:"newRecording",items:[{text:(0,n.getString)("Hub.RecordAClipLabel"),command:t.CREATE_CLIPS_RECORDING_COMMAND,icon:a.SkypeIcon.VideoChat}]}:void 0,{key:"meetNow",items:[{text:(0,n.getString)("MeetNow.HostAMeetingLabel"),command:o.MeetNowButtonActionCommands.CreateMeetNow,icon:a.SkypeIcon.MeetNow},{text:(0,n.getString)("MeetNow.JoinAMeetingLabel"),command:o.MeetNowButtonActionCommands.JoinMeetNow,icon:a.SkypeIcon.Link}]},{key:"others",items:[{text:(0,n.getString)("Hub.NewModeratedGroupChatLabel"),command:t.ADD_CONVERSATION_MODERATED_GROUP_COMMAND,icon:a.SkypeIcon.PeopleCommunity},{text:(0,n.getString)("Hub.NewPrivateChatLabel"),command:t.ADD_CONVERSATION_PRIVATE_COMMAND,icon:a.SkypeIcon.LockClosed},e?{text:(0,n.getString)("Hub.NewCellularSmsChatLabel"),command:t.ADD_CELLULAR_SMS_CONVERSATION_COMMAND,icon:a.SkypeIcon.PhoneChat}:void 0].filter((e=>e))}].filter((e=>e))};const i=s(197582),o=s(44557),n=s(704704),r=i.__importDefault(s(655192)),a=s(641400);t.ADD_CONVERSATION_MODERATED_GROUP_COMMAND="moderatedgroup",t.ADD_CONVERSATION_GROUP_COMMAND="group",t.ADD_CONTENT_CHANNEL_COMMAND="channel",t.ADD_CONVERSATION_1ON1_COMMAND="1on1",t.ADD_CONVERSATION_PRIVATE_COMMAND="private",t.ADD_CELLULAR_SMS_CONVERSATION_COMMAND="cellularSms",t.CREATE_CLIPS_RECORDING_COMMAND="recording"},280052:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OTHER_COMMANDS=t.SORT_COMMANDS=t.FILTER_COMMANDS=void 0,t.getFilterMenuItems=function({viewMode:e,sortBy:t,needActiveSort:s,hasArchivedConversations:n,hasUnread:d,shouldShowCategories:c}){const u=[];n&&u.push({key:"filterby",items:r(e)});e===i.ConversationsListMode.AllConversations&&u.push({key:"sortby",title:(0,o.getString)("DesktopRecentsFilter.SortBy"),items:a(t,s)});return u.push({key:"more",title:(0,o.getString)("Global.MoreButtonTitle"),items:l(e,d,c)}),u};const i=s(491839),o=s(704704),n=s(773151);function r(e){return[{text:(0,o.getString)("DesktopRecentsFilter.RecentConversations"),command:t.FILTER_COMMANDS.recents,selected:e===i.ConversationsListMode.AllConversations},{text:(0,o.getString)("DesktopRecentsFilter.HiddenConversations"),command:t.FILTER_COMMANDS.archived,selected:e===i.ConversationsListMode.ArchivedConversations}]}function a(e,s){const i=[{text:(0,o.getString)("DesktopRecentsFilter.Time"),command:t.SORT_COMMANDS.time,selected:e===n.RecentsSortBy.Time},{text:(0,o.getString)("DesktopRecentsFilter.Unread"),command:t.SORT_COMMANDS.unread,selected:e===n.RecentsSortBy.Unread}];return s&&i.push({text:(0,o.getString)("DesktopRecentsFilter.Active"),command:t.SORT_COMMANDS.active,selected:e===n.RecentsSortBy.Active}),i}function l(e,s,n){const r=[];return s&&e===i.ConversationsListMode.AllConversations&&r.push({text:(0,o.getString)("MobileRecentsFilter.MarkRead"),command:t.OTHER_COMMANDS.markAllRead}),r.push({text:(0,o.getString)(n?"DesktopRecentsFilter.HideFavorites":"DesktopRecentsFilter.ShowFavorites"),command:t.OTHER_COMMANDS.showCategoriesToggle}),r}t.FILTER_COMMANDS={recents:"recents",archived:"archived"},t.SORT_COMMANDS={time:"time",unread:"unread",active:"active"},t.OTHER_COMMANDS={markAllRead:"markAllRead",showCategoriesToggle:"showCategoriesToggle"}},123985:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582);i.__exportStar(s(303693),t),i.__exportStar(s(280052),t)},759714:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageComposerSendButtonTelemetry=void 0;const i=s(197582).__importStar(s(786531)),o=s(82485);t.MessageComposerSendButtonTelemetry=new class{constructor(){this._isActive=!1}activeAndTryTrack(){this._isActive||(o.Instrumentation.track(new i.MessageComposerControlEvent(i.MessageComposerControls.SendButton,i.MessageComposerControlAction.Active)),this._isActive=!0)}inactive(){this._isActive=!1}}},621991:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrouterDisconnectedTooLong=void 0;const i=s(240297);class o extends i.TelemetryEventBase{getEventName(){return"messaging_trouter"}getAttributes(){const e=super.getAttributes();return e.Action=this.getActionName(),e}}t.TrouterDisconnectedTooLong=class extends o{constructor(e){super(),this._timeoutInMilliseconds=e}getActionName(){return"TrouterDisconnectedTooLong"}getAttributes(){const e=super.getAttributes();return e.TimeoutInMilliseconds=this._timeoutInMilliseconds,e}}},14269:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlFormatterEvent=t.FormatterConsumedEvent=void 0;const i=s(240297),o=s(485692),n={[o.FormatterTypes.Bold]:"Bold",[o.FormatterTypes.Link]:"Link",[o.FormatterTypes.Code]:"Code",[o.FormatterTypes.Italic]:"Italic",[o.FormatterTypes.StrikeThrough]:"StrikeThrough"};class r extends i.TelemetryEventBase{getEventName(){return"messaging_rich_text_editor"}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{Action:this.getAction()})}}class a extends r{constructor(e){super(),this._source=e}getAttributes(){return Object.assign(Object.assign({},super.getAttributes()),{Source:this._source})}}t.FormatterConsumedEvent=class extends a{constructor(e){super(n[e])}getAction(){return"FormatterConsumed"}};t.HtmlFormatterEvent=class extends a{constructor(e){super(e)}getAction(){return"HtmlFormatter"}}},964647:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCorrelationIdForMessage=function(e){return d(e.creator,e.conversationId,e.getOriginalClientMessageId())},t.getCorrelationIdFromMessageParts=d;const i=s(197582),o=i.__importStar(s(496486)),n=s(284841),r=i.__importStar(s(44717)),a=i.__importStar(s(766698)),l=i.__importDefault(s(363091));function d(e,t,s){let i=t;r.isOneOnOneConversation(i)&&!r.isThread(i)&&(l.default.isMyMri(e)||(i=l.default.getSkypeMri()));const d=e+"|"+i+"|"+s;return(0,n.chain)(a.computeSHA256(d),(0,n.take)(16),(0,n.map)((e=>o.padStart(e.toString(16),2,"0"))),(0,n.join)(""))}},971988:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageAnnotations=t.MessageTypeGroups=t.UriObjectTypeSubTypes=t.UriObjectMessageTypes=t.MessageTypes=t.MessageBaseTypes=t.ContentTypes=t.TeamsMentionTypes=t.TeamsItemTypes=t.TeamsMessageProperties=t.MessageProperties=void 0,t.addEmotionMetadataForUser=function(e,s,i=t.MessageAnnotations.Like,o){return m(e,s,i,void 0,o)},t.removeEmotionMetadataForUser=function(e,s,i=t.MessageAnnotations.Like){const n=o.find(e,(e=>e.key===i));n&&(o.remove(n.users,(e=>e.mri===s)),0===n.users.length&&o.remove(e,(e=>e.key===i)));return e},t.addOrUpdateEmotionMetadataForUser=m,t.removeBookmarkMetadataForUser=function(e,s){const i=t.MessageAnnotations.Bookmark,n=o.find(e,(e=>e.key===i));n&&(o.remove(n.users,(e=>e.mri===s)),0===n.users.length&&o.remove(e,(e=>e.key===i)));return e},t.addOrUpdateBookmarkMetadataForUser=function(e,s,i){const n=t.MessageAnnotations.Bookmark;let r=o.find(e,(e=>e.key===n));r||(r={key:n,users:[]},e.push(r));const a=Date.now(),l=o.find(r.users,(e=>e.mri===s));l?(l.time=a,l.value=JSON.stringify(o.merge(u.default.parseJsonErrorToUndefined(l.value),i))):r.users.push({mri:s,value:JSON.stringify(i),time:a});return e},t.getBookmarkMetadataForUser=function(e,s){const i=v(e),n=o.find(i,(e=>e.key===t.MessageAnnotations.Bookmark));if(!n)return;const r=o.find(n.users,(e=>e.mri===s));if(!r)return;return u.default.parseJsonErrorToUndefined(r.value)},t.addOrUpdateVoteForUser=function(e,t,s){let i=o.find(e,(e=>e.key===s));i||(i={key:s,users:[]},e.push(i));const n=o.indexOf(e,i),r=Date.now();let a=o.find(i.users,(e=>e.mri===t));if(a)a=Object.assign(Object.assign({},a),{time:r});else{const e={mri:t,time:r},s=[...i.users,e];i=Object.assign(Object.assign({},i),{users:s})}return e[n]=i,e},t.removeVoteForUser=function(e,t,s){const i=o.find(e,(e=>e.key===s));if(i){o.find(i.users,(e=>e.mri===t))&&o.remove(i.users,(e=>e.mri===t))}return e},t.getJsonFromMessageProperty=S,t.getTeamsMentionProperties=function(e){return S(e,t.TeamsMessageProperties.Mentions)},t.getTeamsFileProperties=function(e){return S(e,t.TeamsMessageProperties.Files)},t.getForwardedTeamsProperties=function(e){return o.pick(e,[t.TeamsMessageProperties.Mentions,t.TeamsMessageProperties.Files])},t.getScheduledCallInviteData=_,t.getScheduledCallConsumptionHorizons=function(e){const t=_(e);if(t&&t.consumptionHorizons)return t.consumptionHorizons;return{}},t.getEmotionMetadata=f,t.getCleanedEmotionMetadata=function(e){return o.filter(f(e),(e=>e.key!==t.MessageAnnotations.ViewCount&&e.key!==t.MessageAnnotations.ReactionsConsumptionHorizon))},t.flattenEmotionMetadata=function(e){return(0,a.chain)(e,(0,a.map)((e=>o.map(e.users,(t=>({key:e.key,time:t.time||0,mri:t.mri}))))),(0,a.flatten)(),(0,a.sortBy)((e=>e.time)))},t.isPollUsingCustomProp=y,t.getBookmarkMetadata=function(e){return S(e,t.MessageProperties.Starred)},t.getBookmarkSourceMetadata=v,t.getPollMetadata=function(e){const s=y(e)?S(e,t.MessageProperties.PollData):S(e,t.MessageProperties.Emotions);return o.isArray(s)?s:[]},t.getScheduledCallMetadata=function(e){const s=S(e,t.MessageProperties.Emotions);return o.isArray(s)?s:[]},t.getSmsDeliveryReport=function(e){const s=S(e,t.MessageProperties.SmsDeliveryReports);if(s&&s.length>0&&s[0].users&&s[0].users.length>0)return u.default.parseJsonErrorToUndefined(s[0].users[0].value);return},t.getUrlPreviewMetadata=function(e){const s=S(e,t.MessageProperties.UrlPreviews);return o.isArray(s)?s:[]},t.getForwardMetadata=function(e){return S(e,t.MessageProperties.ForwardMetadata)||{isForwarded:!1}},t.getTranslationSettingsMetadata=C,t.getTranslationSettingsState=function(e){const t=C(e);if(t){const e=parseInt(r.TranslationState[t.newTranslationState],10);if(e in r.TranslationState)return e}return},t.getMessageTranslationMetadata=function(e){const t=u.default.parseJsonErrorToUndefined(e);if(t&&t.translations)return t;return},t.getEditTime=function(e){const s=S(e,t.MessageProperties.EditTime);if(!s)return;return s},t.isDeletedMessage=function(e){if(!e.content)return!0;if(!e.skypeeditoffset&&!e.skypeemoteoffset&&"<"!==e.content[0])return!1;const t=(0|Number(e.skypeeditoffset))+(0|Number(e.skypeemoteoffset));if(e.content.length<=t)return!0;if("<"!==e.content[t]||">"!==o.last(e.content))return!1;return 0===e.content.substring(t).replace(T,"").replace(M,"").length},t.isXmlMessageType=function(e){if(I(e))return!1;const s=(e||"").toLowerCase();return s!==t.MessageTypes.Text.toLowerCase()&&s!==t.MessageTypes.InviteFreeText.toLowerCase()&&!b(e)&&0!==s.indexOf("control")},t.isJsonMessageType=b,t.isHtmlMessageType=I,t.isThreadActivityType=function(e){return 0===(e||"").toLowerCase().indexOf("threadactivity")||R(e)},t.isScheduledCallMetadataType=function(e){return-1!==(e||"").toLowerCase().indexOf("scheduledcall")},t.isCallInfoMessageType=w,t.isCallInfoForCallMessageType=function(e){return w(e)&&-1!==e.content.indexOf('containerType="Call')},t.isCallMessageType=P,t.isContactMessageType=function(e){return e.messagetype===t.MessageTypes.Contacts},t.isAddMemberMessageType=function(e){return e===t.MessageTypes.AddMember},t.isJoinedCreatorMessageType=k,t.isHistoryDisclosedHiddenUpdateType=A,t.isTopicUpdateMessageType=x,t.isJoiningEnabledUpdateMessageType=function(e){return e===t.MessageTypes.JoiningEnabledUpdate},t.isMessageSms=D,t.isScheduledCallType=function(e){return e===t.MessageTypes.ScheduledCallInvite},t.isPollType=function(e){return e===t.MessageTypes.Poll},t.isCaptionMessageType=function(e){return e===t.MessageTypes.Caption||e===t.MessageTypes.SignalCaption},t.isTranslationMessageType=function(e){return e===t.MessageTypes.Translation},t.isGuestNameUpdateMessageType=R,t.isRichTextMessageType=function(e=""){return 0===e.indexOf("RichText")},t.isEncryptedMessageType=function(e=""){return 0===e.indexOf("EndToEndEncryption")},t.isCallOrSmsMessageType=function(e){return P(e)||D(e.messagetype)},t.isSmsDeliveredSuccessfully=function(e){const{status:t,errorCategory:s}=e;return t===c.SkypeSmsDeliveryStatus.Success&&(s===c.SkypeSmsErrorCategory.NoError||s===c.SkypeSmsErrorCategory.NoDeliveryReport)},t.hasAtMention=function(e){return/<at\s+id/.test(e)},t.hasQuote=function(e){return/<quote\s+author/.test(e)},t.hasAllAtMention=function(e){return/<at\s+id="\*"/.test(e)},t.contentContainsUriObject=L,t.contentContainsUriObjectExceptFile=function(e){return L(e)&&!/^[^>]+type=['"]File['"\.]/i.test(e)},t.hasEmoticons=function(e){return/<ss\s+type=\".*\"/.test(e)||/<span[^>]*>\s*<img[^>]*itemid=".*"/.test(e)},t.isEventCallStartedMessageType=function(e){return e&&e.messagetype===t.MessageTypes.Call&&(0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="started"',10)||0===e.content.indexOf('<partlist alt=""></partlist>'))},t.isEventCallEndedMessageType=function(e){return e&&""!==e.content&&e.messagetype===t.MessageTypes.Call&&0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="ended"',10)},t.isEventCallMissedMessageType=function(e){return e&&""!==e.content&&e.messagetype===t.MessageTypes.Call&&0===e.content.indexOf("<partlist ")&&-1!==e.content.indexOf('type="missed"',10)},t.isHighlightMessageType=function(e){const t=B(e);return t===g.Picture||t===g.Video},t.getMessageTypeGroup=B,t.isWrittenTextMessageType=function(e){return o.includes(F,e)},t.getUriObjectMessageTypeGroup=N,t.shouldServerMessageBeFilteredOut=function(e,t){const s=t.createdDate(),i=t.creator();if(s&&e.createdTime-s<n.default.getS4LCMCFeatures().serverMessagesAfterThreadCreationTimeWindow){const t=[k,x,A];return o.some(t,(t=>t(e.messagetype,e.content,i)))}return!1},t.shouldMediaBeSentAsync=function(e,t,s,i){return(t<e||!s)&&!i};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=s(619429),a=s(284841),l=s(815146),d=i.__importStar(s(85385)),c=s(120880),u=i.__importDefault(s(655192)),h=s(858098);var p,g;function m(e,s,i=t.MessageAnnotations.Like,n,r){let a=o.find(e,(e=>e.key===i));a||(a={key:i,users:[]},e.push(a));const l=Date.now(),d=o.isNumber(n)?n:l,c=o.find(a.users,(e=>e.mri===s));return c?(c.time=d,c.value=void 0===r?""+l:r):a.users.push({mri:s,value:void 0===r?""+l:r,time:d}),e}function S(e,t){const s=e?e[t]:void 0;if(s)return o.isString(s)?u.default.parseJsonErrorToUndefined(s):o.cloneDeep(s)}function _(e){return S(e,t.MessageProperties.ScheduledCallInviteData)}function f(e){const s=S(e,t.MessageProperties.Emotions);return o.isArray(s)?s:[]}function y(e){const s=S(e,t.MessageProperties.PollData);return!o.isUndefined(s)}function v(e){const s=S(e,t.MessageProperties.Poll);return o.isArray(s)?s:[]}function C(e){const t=u.default.parseJsonErrorToUndefined(e);if(t&&t.data)return t.data}t.MessageProperties={Emotions:"emotions",UrlPreviews:"urlpreviews",ForwardMetadata:"forwardMetadata",Prototype:"prototype_skypex",CastParentThreadId:"castParentThreadId",SuggestedActions:"suggestedActions",EditTime:"edittime",DeleteTime:"deletetime",SmsDeliveryReports:"smsdeliveryreports",CellularRelayStatus:"cellularRelayStatus",PollData:"inlinePollData",ScheduledCallInviteData:"scheduledCallInviteData",AlbumId:"albumId",Skypeemoteoffset:"skypeemoteoffset",EventId:"eventId",IsVideoCall:"isVideoCall",Poll:"poll",Starred:"starred",AdditionalData:"additionalData",BingImageTrackingMetadata:"additionalData"},t.TeamsMessageProperties={Mentions:"mentions",Files:"files"},t.TeamsItemTypes={Emoticon:"http://schema.skype.com/Emoji",Mention:"http://schema.skype.com/Mention",File:"http://schema.skype.com/File"},t.TeamsMentionTypes={Person:"person",Channel:"channel",Team:"team"},t.ContentTypes={Text:"text",Xml:"text/xml; charset=UTF-8",Event:"json/event"},t.MessageBaseTypes={Message:"Message",Event:"Event"},function(e){e.Text="Text",e.RichText="RichText",e.PopCard="PopCard",e.Notice="Notice",e.SignalRelay="Signal/Relay",e.LegacyNudge="Nudge",e.Poll="Poll",e.UriObject="RichText/UriObject",e.Media_Card="RichText/Media_Card",e.Media_GenericFile="RichText/Media_GenericFile",e.ScheduledCallInvite="RichText/ScheduledCallInvite",e.SkypeVideoMessage="Event/SkypeVideoMessage",e.Media_Video="RichText/Media_Video",e.VideoMessage="RichText/Media_Video",e.CastRecording="RichText/Media_CallRecording",e.Media_Audio="RichText/Media_AudioMsg",e.AudioMessage="RichText/Media_AudioMsg",e.VoiceMail="RichText/Media_VoiceMail",e.Call="Event/Call",e.Typing="Control/Typing",e.ClearTyping="Control/ClearTyping",e.LiveState="Control/LiveState",e.Contacts="RichText/Contacts",e.Files="RichText/Files",e.Sms="RichText/Sms",e.Mms="RichText/Mms",e.Location="RichText/Location",e.CallerID="RichText/CallerID",e.MediaAlbum="RichText/Media_Album",e.AddMember="ThreadActivity/AddMember",e.DeleteMember="ThreadActivity/DeleteMember",e.RoleUpdate="ThreadActivity/RoleUpdate",e.TopicUpdate="ThreadActivity/TopicUpdate",e.PictureUpdate="ThreadActivity/PictureUpdate",e.HistoryDisclosedUpdate="ThreadActivity/HistoryDisclosedUpdate",e.JoiningEnabledUpdate="ThreadActivity/JoiningEnabledUpdate",e.LegacyMemberAdded="ThreadActivity/LegacyMemberAdded",e.LegacyMemberUpgraded="ThreadActivity/LegacyMemberUpgraded",e.HighlightsFollow="ThreadActivity/HighlightsFollow",e.HighlightsAdd="ThreadActivity/HighlightsAdd",e.HighlightsRefuseFollow="ThreadActivity/HighlightsRefuseFollow",e.HighlightsRemoveFollow="ThreadActivity/HighlightsRemoveFollow",e.HighlightsRefuseAdd="ThreadActivity/HighlightsRefuseAdd",e.HighlightsRemoveAdd="ThreadActivity/HighlightsRemoveAdd",e.ScheduledCallNowReminder="ThreadActivity/ScheduledCallNowReminder",e.ScheduledCallUpdate="ThreadActivity/ScheduledCallUpdate",e.ScheduledCallCancellation="ThreadActivity/ScheduledCallCancellation",e.ScheduledCallRSVP="ThreadActivity/ScheduledCallRSVP",e.HandshakeInvite="ThreadActivity/E2EEHandshakeInvite",e.HandshakeAccept="ThreadActivity/E2EEHandshakeAccept",e.HandshakeComplete="ThreadActivity/E2EEHandshakeComplete",e.HandshakeReject="ThreadActivity/E2EEHandshakeReject",e.ModeratedThreadUpdate="ThreadActivity/ModeratedThreadUpdate",e.CallInfo="RichText/Cast",e.InviteFreeText="InviteFreeRelationshipChanged/Initialized",e.InviteFreeConversationAccepted="InviteFreeRelationshipChanged/ConversationAccepted",e.EncryptedText="EndToEndEncryption/EncryptedText",e.EncryptedMedia="EndToEndEncryption/EncryptedMedia",e.EncryptedCall="Event/EncryptedCall",e.TeamsHtml="RichText/Html",e.TeamsFile="Spaces/File",e.TeamsMeetingMemberLeft="ThreadActivity/MemberLeft",e.TeamsMeetingMemberJoined="ThreadActivity/MemberJoined",e.TeamsTabUpdated="ThreadActivity/TabUpdated",e.Caption="Caption",e.SignalCaption="Signal/Caption",e.Translation="Translation",e.Data="Data",e.TranslationSettings="TranslationSettings",e.HistoryActivityDeleteMessage="HistoryActivity/DeleteMessage",e.GuestNameUpdate="Guest/NameUpdate",e.MagicBotEvent="Event/BingBot",e.MagicBotToolbox="BingBotToolbox"}(p||(p={})),t.MessageTypes=p,t.UriObjectMessageTypes=[t.MessageTypes.UriObject,t.MessageTypes.EncryptedMedia,t.MessageTypes.Media_Card,t.MessageTypes.Media_GenericFile,t.MessageTypes.Media_Video,t.MessageTypes.Media_Audio,t.MessageTypes.VideoMessage,t.MessageTypes.CastRecording,t.MessageTypes.AudioMessage,t.MessageTypes.CallInfo,t.MessageTypes.ScheduledCallInvite,t.MessageTypes.Poll,t.MessageTypes.Data,t.MessageTypes.TranslationSettings,t.MessageTypes.MediaAlbum,t.MessageTypes.MagicBotToolbox],t.UriObjectTypeSubTypes={Picture:{Picture:"Picture",ImageCreator:"ImageCreator"},Video:{CallRecording:"CallRecording",Flik:"Flik",Message:"Message"},Audio:{Message:"Message"}},function(e){e[e.None=1]="None",e[e.Text=2]="Text",e[e.System=3]="System",e[e.Picture=4]="Picture",e[e.Video=5]="Video",e[e.Audio=6]="Audio",e[e.Calling=7]="Calling",e[e.UriFile=8]="UriFile",e[e.SwiftCard=9]="SwiftCard",e[e.Location=10]="Location",e[e.SMS=11]="SMS",e[e.CallerID=12]="CallerID",e[e.Sticker=13]="Sticker",e[e.CellularMessage=14]="CellularMessage",e[e.Contact=15]="Contact",e[e.ScheduledCallInvite=16]="ScheduledCallInvite",e[e.Poll=17]="Poll",e[e.Gif=18]="Gif",e[e.Engagement=19]="Engagement",e[e.MediaAlbum=20]="MediaAlbum",e[e.Translation=21]="Translation",e[e.MagicBotToolbox=22]="MagicBotToolbox"}(g||(t.MessageTypeGroups=g={})),t.MessageAnnotations={ReactionsConsumptionHorizon:"reactionsConsumptionHorizon",Like:"like",Heart:"heart",ViewCount:"viewCount",Bookmark:"bookmark",ScheduledCallInviteAccepted:"scheduledCallInviteAccepted",ScheduledCallInviteDeclined:"scheduledCallInviteDeclined"};const T=/<\/?e_m[^<>]*>/gi,M=/(<legacyquote[^>]*?\/>|<legacyquote[^>]*>[^]*?<\/legacyquote>)/gi;function b(e){const s=(e||"").toLowerCase();return o.includes([t.MessageTypes.Mms.toLowerCase(),t.MessageTypes.Translation.toLowerCase(),t.MessageTypes.Data.toLowerCase(),t.MessageTypes.TranslationSettings.toLowerCase()],s)}function I(e){if(!n.default.getS4LMessagingFeaturesNoSubscription().enableParsingHtmlMessages)return!1;return(e||"").toLowerCase()===t.MessageTypes.TeamsHtml.toLowerCase()}function w(e){return e.messagetype===t.MessageTypes.CallInfo}function P(e){return e.messagetype===t.MessageTypes.Call||e.messagetype===t.MessageTypes.EncryptedCall}function k(e,s,i){return e===t.MessageTypes.AddMember&&o.includes(s,`<target>${i}</target>`)}function A(e,s){return e===t.MessageTypes.HistoryDisclosedUpdate&&o.includes(s,"<value>false</value>")}function x(e){return e===t.MessageTypes.TopicUpdate}function D(e){return e===t.MessageTypes.Sms}function R(e){return e===t.MessageTypes.GuestNameUpdate}function L(e){return/<URIObject/.test(e)}function B(e){if(!e||!e.messagetype)return g.None;const s=e.messagetype;switch(s){case t.MessageTypes.UriObject:return N(e);case t.MessageTypes.Media_GenericFile:case t.MessageTypes.EncryptedMedia:return g.UriFile;case t.MessageTypes.Media_Video:case t.MessageTypes.VideoMessage:case t.MessageTypes.CastRecording:return g.Video;case t.MessageTypes.Media_Audio:case t.MessageTypes.AudioMessage:return g.Audio;case t.MessageTypes.MediaAlbum:return g.MediaAlbum;case t.MessageTypes.CallInfo:case t.MessageTypes.Call:case t.MessageTypes.EncryptedCall:return g.Calling;case t.MessageTypes.Media_Card:return g.SwiftCard;case t.MessageTypes.CallerID:return g.CallerID;case t.MessageTypes.RichText:case t.MessageTypes.Text:case t.MessageTypes.InviteFreeText:case t.MessageTypes.EncryptedText:case t.MessageTypes.ScheduledCallInvite:case t.MessageTypes.Poll:case t.MessageTypes.Caption:case t.MessageTypes.SignalCaption:case t.MessageTypes.MagicBotToolbox:return N(e);case t.MessageTypes.MagicBotEvent:return(i=e).messagetype===t.MessageTypes.MagicBotEvent&&Object.values(h.OneOnOneMagicBotControls).includes(i.content)?g.None:N(i);case t.MessageTypes.Location:return g.Location;case t.MessageTypes.Contacts:return g.Contact;case t.MessageTypes.Files:return g.Text;case t.MessageTypes.Sms:return g.SMS;case t.MessageTypes.Mms:return function(e){return-1!==e.content.indexOf('"object_id"')?g.Picture:g.SMS}(e);case t.MessageTypes.AddMember:case t.MessageTypes.DeleteMember:case t.MessageTypes.RoleUpdate:case t.MessageTypes.TopicUpdate:case t.MessageTypes.PictureUpdate:case t.MessageTypes.HistoryDisclosedUpdate:case t.MessageTypes.JoiningEnabledUpdate:case t.MessageTypes.LegacyMemberAdded:case t.MessageTypes.LegacyMemberUpgraded:case t.MessageTypes.HighlightsFollow:case t.MessageTypes.HighlightsRefuseFollow:case t.MessageTypes.HighlightsRemoveFollow:case t.MessageTypes.HighlightsRefuseAdd:case t.MessageTypes.HighlightsRemoveAdd:case t.MessageTypes.HandshakeInvite:case t.MessageTypes.HandshakeAccept:case t.MessageTypes.HandshakeComplete:case t.MessageTypes.HandshakeReject:case t.MessageTypes.ModeratedThreadUpdate:case t.MessageTypes.ScheduledCallNowReminder:case t.MessageTypes.ScheduledCallCancellation:case t.MessageTypes.ScheduledCallUpdate:case t.MessageTypes.ScheduledCallRSVP:case t.MessageTypes.Data:case t.MessageTypes.TranslationSettings:case t.MessageTypes.GuestNameUpdate:return g.System;case t.MessageTypes.HighlightsAdd:case t.MessageTypes.LegacyNudge:case t.MessageTypes.Typing:case t.MessageTypes.ClearTyping:case t.MessageTypes.SignalRelay:case t.MessageTypes.LiveState:case t.MessageTypes.SkypeVideoMessage:case t.MessageTypes.VoiceMail:case t.MessageTypes.InviteFreeConversationAccepted:return g.None;case t.MessageTypes.Notice:case t.MessageTypes.PopCard:return g.Engagement;case t.MessageTypes.Translation:return g.Translation;case t.MessageTypes.TeamsHtml:return g.Text;case t.MessageTypes.TeamsFile:case t.MessageTypes.TeamsMeetingMemberLeft:case t.MessageTypes.TeamsMeetingMemberJoined:case t.MessageTypes.TeamsTabUpdated:return d.log(l.LogTraceArea.ChatService,`Unsupported 'Teams' MessageType received: ${s}`),g.None;case t.MessageTypes.HistoryActivityDeleteMessage:return d.log(l.LogTraceArea.ChatService,`Unsupported 'Windows Phone' MessageType received: ${s}`),g.None;default:return d.error(l.LogTraceArea.ChatService,"Unhandled Message Type: "+e.messagetype),g.None}var i}const F=[t.MessageTypes.RichText,t.MessageTypes.Text,t.MessageTypes.InviteFreeText,t.MessageTypes.EncryptedText,t.MessageTypes.MagicBotEvent];function N(e){if(!e.content||!o.startsWith(e.content,"<URIObject"))return g.Text;const t=e.content.match(/<URIObject[^>]*?\stype=\"([^"]+?)\"/i),s=e.content.match(/<meta[^>]*?\stype=\"([^"]+?)\"/i);if(!t)return s&&"photo"===s[1]?g.Picture:e.content.match(/<Swift/)?g.SwiftCard:g.Text;const i=t[1].split(".")[0];return"File"===i?g.UriFile:"Picture"===i?g.Picture:"Video"===i?g.Video:"SWIFT"===i?g.SwiftCard:"Sticker"===i?g.Sticker:"ScheduledCallInvite"===i?g.ScheduledCallInvite:"Poll"===i?g.Poll:"MagicBotToolbox"===i?g.MagicBotToolbox:g.Text}},670573:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){const s=Object.keys(t).filter((t=>void 0!==e[t])).map((s=>({v1:e[s],v2:t[s]})));this._mappingToV1=s.reduce(((e,t)=>(e[t.v2]=t.v1,e)),{}),this._mappingToV2=s.reduce(((e,t)=>(e[t.v1]=t.v2,e)),{})}_doPropertyNamesOverlap(e,t){return Object.values(e).some((e=>Object.values(t).includes(e)))}mapToV1(e){const t=this._mappingToV1[e];return null!=t?t:e}mapToV2(e){const t=this._mappingToV2[e];return null!=t?t:e}}},44717:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelTypes=t.getRegistrationTokenFromHeader=t.getSkypetokenFromAuthenticationHeader=t.REGISTRATION_TOKEN_HEADER_PREFIX=t.SKYPE_TOKEN_HEADER_PREFIX=t.ThreadPropsInConversationView=t.ConnectorPrefixes=t.SubscriptionTypes=t.ServerUserProps=t.UserProps=t.ConversationPropsMapping=t.ConversationPropsV2=t.ConversationProps=t.ThreadPropsMapping=t.ThreadPropsV2=t.ThreadProps=t.ConnectorThreadPropPrefix=t.V2ThreadIdSuffix=t.BookmarksThreadId=t.P2PSkypeThreadIdSuffix=t.SkypeThreadIdSuffix=t.OneToOneThreadIdSuffix=t.EncryptedThreadIdSuffix=t.ReactionThreadIdSuffix=t.HighlightsThreadIdSuffix=t.AllGlobalClearMri=t.ThreadTypes=t.Namespaces=t.ChatServiceErrors=t.BotHighlightMessageContent=t.MaxChatServiceInitialPropsLoadTimeoutInMs=t.RecentMessageHistoryTimePeriodHighlights=t.RecentMessageHistoryTimePeriod=t.MinimumConversationsToTryToShow=t.BeginningOfTime=t.GuestUserMriPrefix=t.OrgIdUserPrefix=t.CIDPostfix=t.CIDPrefix=void 0,t.getThreadPropsInConversationView=function(){if(a.default.getS4LMessagingFeaturesNoSubscription().enableJoinEnabledThreadPropInConversationView)return[...t.ThreadPropsInConversationView,t.ThreadProps.JoinEnabled];return t.ThreadPropsInConversationView},t.skypeIdToMri=function(e){return I(e,T.SkypeId)},t.idAndNamespaceToMri=I,t.sanitizeMri=w,t.replaceNamespace=function(e,t,s){const i=B(e);return i.namespace===t?w(i.id,s):e},t.isMri=P,t.isSkypeId=function(e){return l.ValidSkypeIdRegExp.test(e)},t.asMriMaybe=k,t.asMri=A,t.asSkypeThreadIdMaybe=function(e){const t=k(e);return t&&H(t)?t:void 0},t.asSkypeThreadId=x,t.asSkypeId=D,t.isAllGlobalClearMri=function(e){return e===t.AllGlobalClearMri},t.isUserMri=function(e){return R(F(e))},t.isMriNamespaceUser=R,t.isOneToOneThreadUserMriNamespace=function(e){const t=F(e);return t===T.S4B_Bridge||t===T.PSTN||t===T.SkypeId||t===T.Bot},t.isPhoneMri=L,t.isConversationWithPhoneNumber=function(e){return L(e)},t.isDisplayableStrippedMri=function(e){const t=F(e);return t===T.MSA||t===T.S4B_Bridge||t===T.PSTN||t===T.SkypeId||t===T.OneToOneTextMessage},t.isMriWithUserMetadata=function(e){const t=F(e);return t===T.MSA||t===T.SkypeId||t===T.S4B_Bridge},t.isValidNamespaceMri=function(e){if(!P(e))return!1;return F(e)in T},t.isReadOnlyConversation=function(e){if(e===S.default.getEchoMri())return!0;return!1},t.isConciergeBotMri=function(e){return-1!==a.default.getEngagementFeaturesNoSubscription().engagementSenderIdentity.indexOf(e)},t.isHiddenBotMri=function(e){return-1!==a.default.getS4LCaapFeaturesNoSubscription().botIdsToHide.indexOf(e)},t.splitMri=B,t.splitSkypeId=function(e){const t=e.indexOf(":");if(t>=0)return{prefix:e.substring(0,t),suffix:e.substring(t+1)};return{suffix:e}},t.getMriNamespace=F,t.stripMriNamespace=N,t.isOneOnOneConversation=E,t.isBookmarkConversation=O,t.isMyBotConversation=U,t.getMyBotId=V,t.isGroupConversation=function(e){return!E(e)&&!O(e)},t.isThread=H,t.isAgent=j,t.isSearchInConversationSupported=function(e){return z(e)||Q(e)||q(e)},t.isGalleryInConversationSupported=function(e){return z(e)||K(e)||Q(e)||q(e)||U(e)},t.isConnector=function(e){return F(e)===T.Bot&&n.startsWith(N(e),t.ConnectorPrefixes.IntegrationNamespace)},t.isBotChat=function(e){return n.startsWith(e,`${T.Bot}:`)},t.isEcho=function(e){return S.default.getEchoMri()===e},t.isMurphyBot=function(e){return S.default.getMurphyMri()===e},t.isCallLog=function(e){return S.default.getCallLogMri()===e},t.isBlockedPSTNMri=function(e){return S.default.getBlockedPSTNMri()===e},t.isSkypeIdMri=z,t.isMsaMri=function(e){return F(e)===T.MSA},t.isS4BBridgeMri=function(e){return F(e)===T.S4B_Bridge},t.isGuestUserMri=W,t.isOrgIdUserMri=function(e){const s=B(e);return s.namespace===T.SkypeId&&n.startsWith(s.id,t.OrgIdUserPrefix)},t.getSkypeIdFromMri=function(e){if(F(e)===T.SkypeId)return N(e);return},t.getPhoneNumberFromMri=function(e){const t=B(e);if(t.namespace===T.PSTN||t.namespace===T.OneToOneTextMessage)return t.id;return},t.getMriFromPhoneNumber=function(e){return T.PSTN+":"+e.number},t.getMriFromPhoneNumberString=function(e){return T.PSTN+":"+e},t.getMriFromS4BId=function(e){return I(e,T.S4B_Bridge)},t.getConnectorIntegrationIdFromMri=function(e){const t=N(e),s=t.indexOf(":");return t.substring(s+1)},t.getCreatorMriForMessageFromLink=function(e){return n.first(n.last(e.split("/")).split(";"))},t.getConversationLinkWithNewId=function(e,t){const s=e.split("/");return s.pop(),n.join([...s,t],"/")},t.isHighlightsThread=G,t.isBotHighlightsThread=function(e){if(!G(e))return!1;const t=N(e);if(!P(t))return!1;return j(t)},t.isMergingBotHighlightMessageRaw=function(e,s){return j(e)&&-1!==s.content.indexOf(t.BotHighlightMessageContent)},t.isMyHighlightThread=function(e){if(!H(e))return!1;const t=Y(g.default.getSkypeId());return e===t},t.isReactionsThread=function(e){return H(e)&&n.endsWith(e,t.ReactionThreadIdSuffix)},t.isSmsMmsThread=function(e){const t=B(e);return t.namespace===T.OneToOneTextMessage||t.namespace===T.GroupTextMessage},t.isEncryptedThread=K,t.isOneToOneThread=q,t.isBrickedOneToOneThread=function(e){return a.default.getS4LMessagingFeaturesNoSubscription().enableBrickingOneToOneThreads&&q(e)},t.isSkypeThread=Q,t.isP2PSkypeThread=X,t.isV2Thread=$,t.isV2OneToOneThread=J,t.getSkypeMriFromBotHighlightsThreadMri=function(e){const s=e.indexOf(t.HighlightsThreadIdSuffix);if(F(e)!==T.Thread||-1===s||s!==e.length-t.HighlightsThreadIdSuffix.length)return;return N(e.substring(0,s))},t.getMemberMrisWithoutMe=function(e){return n.filter(e,(e=>!g.default.isMyMri(e)))},t.getHighlightsThreadMriForSkypeId=Y,t.getSkypeIdFromHighlightsThreadMri=function(e){const s=e.indexOf(t.HighlightsThreadIdSuffix);if(F(e)!==T.Thread||-1===s||s!==e.length-t.HighlightsThreadIdSuffix.length)return;return N(e.substring(0,s))},t.getReactionThreadIdForCallId=Z,t.getReactionsThreadMriForCallId=function(e){return I(Z(e)+t.ReactionThreadIdSuffix,T.Thread)},t.isComposingStateSupported=function(e,t){if(!t)return!1;const s=F(e);if(s===T.SkypeId)return e!==S.default.getEchoMri();if(s===T.Thread||s===T.MSA||s===T.Bot)return!0;if(s===T.S4B_Bridge)return t;return!1},t.buildOneOnOneThreadId=function(e){return te(T.Thread,ee(e,g.default.getSkypeMri()),t.OneToOneThreadIdSuffix)},t.buildOneOnOneEncryptedThreadId=function(e){return te(T.Thread,ee(e,g.default.getSkypeMri()),t.EncryptedThreadIdSuffix)},t.updateConsumptionHorizonWithCurrentClientTime=function(e){if(!e)return"0";const t=e.split(";");return t[0]+";"+Date.now()+";"+t[2]},t.getCuidForMessage=function(e){return se(e)},t.getCHIDForMessage=se,t.getConsumptionHorizonForMessage=function(e){return ie(e.id,se(e))},t.getConsumptionHorizonForMessageAndCHID=ie,t.getServerTimestampFromConsumptionHorizon=oe,t.getConsumptionHorizonUpdateTime=function(e){if(!e)return 0;const t=e.split(";")[1];return Number(t)},t.getCuidFromConsumptionHorizon=ne,t.isConsumptionHorizonNewer=re,t.getNewestConsumptionHorizon=function(e,t){return re(e,t)?t:e},t.parseConversationId=ae,t.getParsedConversationId=function(e){if(e.conversationLink){const t=n.last(e.conversationLink.split("/"));if(t){return ae(t)}}return},t.unescapeTextWithoutXml=function(e){if(!e)return"";const t=e.replace(le,"");return f.default.unescapeXml(t)},t.decodeSyncState=function(e){const t=e.match(/syncState=([^&]+)/);return t&&t.length>=2?t[1]:void 0},t.encodeSyncStateForLog=function(e){if(void 0===e)return String(e);const t=[];for(let s=0;s<e.length;s+=64)t.push(e.substring(s,s+64));return t.join("-")},t.encodeEndpointInfoForLog=function(e){const t=n.pick(e,["id","exists","featureFlags","presenceDocPublished","ecsEtag","reason","tcid","restEndpointUrl"]);return JSON.stringify(t)},t.filterMembersProp=function(e){return n.map(e,(e=>({id:e.id,role:e.role})))},t.getEndpointIdFromRegToken=function(e){return de(e,"endpointId")},t.getExpiresFromRegToken=function(e){const t=de(e,"expires");return t?Number(t):void 0},t.getEndpointFeaturesList=function(){const e=["Agent","Presence2015","MessageProperties","CustomUserProperties","Casts","ModernBots","AutoIdleForWebApi","secureThreads","notificationStream"];a.default.getS4LContactsFeatures().enableInviteFree&&e.push("InviteFree");a.default.getS4LMessagingFeaturesNoSubscription().enableReadReceipts&&e.push("SupportsReadReceipts");const t=a.default.getS4LMessagingFeaturesNoSubscription().ued;t&&t.enabled&&e.push("ued");return e.join(",")},t.getClientInfoString=function(){const e="skype4life",t=S.default.getClientVersionAndPlatform()+"//"+e,s=S.default.getPlatformType()===h.PlatformType.iOS||S.default.getPlatformType()===h.PlatformType.Android?2:1,i=a.default.getHeaders().CountryCode||"Unknown",o=r.default.getDefaultId();let n="os="+S.default.getPlatformTypeName()+"; osVer="+S.default.getOSVersion()+"; proc=x86; lcid="+p.getLocale()+"; deviceType="+s+"; country="+i+"; clientName="+e+"; clientVer="+t;o&&(n+="; timezone="+o);return n},t.getClientCapabilities=function(){const{enableParsingHtmlMessages:e}=a.default.getS4LMessagingFeaturesNoSubscription();return e?"RenderHtml":void 0},t.createPushSubscriptionParams=function(e,s,i){return{channelType:t.ChannelTypes.PushNotification,eventServiceName:"pnh",template:e,eventChannel:s,interestedResources:i,conversationType:c.DefaultConversationType}},t.createLongPollSubscriptionParams=function(e){return{channelType:t.ChannelTypes.HttpLongPoll,interestedResources:e,conversationType:c.DefaultConversationType}},t.findPushSubscriptionInfo=function(e){const s=n.find(e,(e=>e.channelType.toLowerCase()===t.ChannelTypes.PushNotification.toLowerCase()));return{pushSubscriptionId:s?s.id.toString():void 0,pushSubscriptionParams:s?{channelType:s.channelType,eventChannel:s.eventChannel,eventServiceName:s.eventServiceName,interestedResources:s.interestedResources,template:s.template}:void 0}},t.getEpidFromUri=function(e){const t=e.split("{");if(t.length>1){const e=t[1].split("}");if(e.length>1)return e[0]}return},t.isDogfoodCloudUrl=function(e){const t=_.default.getURIComponents(e);if(t&&t.host)return t.host.indexOf("df-")>=0;return!1},t.getThreadSuffix=function(e){if(H(e)){const t=n.split(e,";")[0],s=t.indexOf("@");return-1===s?"NoThreadSuffix":t.substring(s+1)}return},t.getMriTypeForTelemetry=function(e){if(H(e)){const t=n.split(e,";")[0],s=t.indexOf("@");return-1===s?"UnknownThread":t.substring(s+1)}{const t=F(e);return t in T?T[t]:"UnknownMri"}},t.areEndpointIdsEqual=function(e,t){if(void 0===e||void 0===t)return e===t;return ue(e)===ue(t)},t.formatEndpointId=ue,t.formatEndpointIdRemoveBrackets=function(e){return e&&n.trim(e,"{}")},t.getEndpointIdFromPresenceDoc=he,t.getTextualEndpointInfo=function(e,t=!1){let s=ue(he(e));t&&(s=s.substring(1,6));const i=e.publicInfo.skypeNameVersion.split("/"),o=Number(i[0]),r=o?n.findKey(m.default.platformId,(e=>e===o)):i.length>=3?i[2]:"undefined";return s+" ("+e.publicInfo.skypeNameVersion?r+": "+e.publicInfo.skypeNameVersion:e.privateInfo.epname+")"},t.isValidPresenceMri=function(e){return F(e)===T.MSA||F(e)===T.S4B_Bridge?l.ValidPresenceResourceRegExp.test(e):P(e)},t.getTcidDataFromServerMessageResponse=function(e){return{contextId:e.headers.contextid,date:e.headers.date}},t.getConnectionTypeFromUrl=function(e){if(/.*[/\.]messenger\..*/.test(e))return h.ChatServiceConnectionType.ChatServiceV1;if(/.*[/\.]msgapi\..*/.test(e))return h.ChatServiceConnectionType.MessagingApi;return h.ChatServiceConnectionType.Unknown},t.getEnvironmentNameFromUrl=function(e){if(!e)return"none";if(/.*[/\.]msgapi\.int\..*/.test(e))return"int";if(/.*[/\.]canary\.msgapi\..*/.test(e))return"canary";if(/.*[/\.]pilot1\.msgapi\..*/.test(e))return"pilot1";if(/.*[/\.]pilot2\.msgapi\..*/.test(e))return"pilot2";if(/.*[/]msgapi\..*/.test(e))return"prod";return"unknown"},t.isRedirect=function(e){return 404===e.statusCode&&pe(e)},t.isEndpointMissing=function(e){return 404===e.statusCode&&e.errorCode===C.EndpointMissing},t.getRedirectUrl=pe,t.isNotFound=function(e){return 404===e.statusCode&&!pe(e)},t.calculateEndpointUrl=function(e){const t=e.protocol||"https",s=function(e){if(e&&e.length>0&&"/"!==e.charAt(e.length-1))return e+"/";return e}(e.host),i=e.path||"";return t+"://"+s+i},t.isMessageFromOrigin=function(e,t){return n.some(e.details,(e=>e.origin===t))},t.getProperty=function(e,t,s,i){var n;if(!t)return;if(!a.default.getS4LMessagingFeaturesNoSubscription().enableV2PropMapping)return t[e];const r=s.mapToV2(e);r!==e&&void 0!==t[r]&&void 0!==t[e]&&v.Instrumentation.warn(h.LogTraceArea.ChatService,`Two versions of the same property are set for prop ${e} / ${r}, value is the same: ${t[r]===t[e]}, convId: ${o.pii.Omit(i)}`);return null!==(n=t[r])&&void 0!==n?n:t[e]},t.filterSkypeIdMris=function(e){return e.filter((e=>z(e)&&!W(e)))},t.getTcidFromChatServiceResponse=function(e){const t=null==e?void 0:e.contextid;if(!t)return"";const s=t.match(b);return s?s[1]:""};const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(336550)),a=i.__importDefault(s(150343)),l=s(137395),d=i.__importStar(s(971988)),c=s(135356),u=i.__importStar(s(766698)),h=s(815146),p=i.__importStar(s(704704)),g=i.__importDefault(s(363091)),m=i.__importDefault(s(808222)),S=i.__importDefault(s(139221)),_=i.__importDefault(s(220534)),f=i.__importDefault(s(760989)),y=i.__importDefault(s(670573)),v=s(82485);var C,T;t.CIDPrefix=":cid-(",t.CIDPostfix=")@outlook.com",t.OrgIdUserPrefix="orgid:",t.GuestUserMriPrefix="guest:",t.BeginningOfTime=2,t.MinimumConversationsToTryToShow=50,t.RecentMessageHistoryTimePeriod=12096e5,t.RecentMessageHistoryTimePeriodHighlights=6048e5,t.MaxChatServiceInitialPropsLoadTimeoutInMs=5e4,t.BotHighlightMessageContent='highlight="true"',function(e){e[e.AccessDenied=209]="AccessDenied",e[e.InvalidSyncToken=230]="InvalidSyncToken",e[e.ThreadAlreadyExists=409]="ThreadAlreadyExists",e[e.EndpointMissing=729]="EndpointMissing",e[e.InitiatorNotPartOfThread=730]="InitiatorNotPartOfThread",e[e.ThreadNotFound=732]="ThreadNotFound",e[e.UserInAnotherCloud=752]="UserInAnotherCloud",e[e.PerUserLoginLimitExceeded=803]="PerUserLoginLimitExceeded",e[e.QuarantineLimitExceeded=804]="QuarantineLimitExceeded",e[e.StaleUic=923]="StaleUic"}(C||(t.ChatServiceErrors=C={})),function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.PersonalUserStream=48]="PersonalUserStream"}(T||(t.Namespaces=T={}));const M="CallEnded_",b=/tcid=([^,]+)/;function I(e,t){return t+":"+e}function w(e,t){const s=e.replace("#T/","");return P(s)?s:I(s,t)}function P(e){return e.startsWith(`${T.PSTN}:`)?l.ValidPSTNMriRegExp.test(e):l.ValidMriRegExp.test(e)}function k(e){return e&&P(e)?e:void 0}function A(e){return e}function x(e){return e}function D(e){return e}function R(e){return e===T.MSA||e===T.S4B_Bridge||e===T.SkypeId||e===T.Bot||e===T.LegacyShortCircuit||e===T.PSTN}function L(e){if(!P(e))return!1;return F(e)===T.PSTN}function B(e){const t=e.indexOf(":"),s=e.substring(0,t);return{namespace:Number(s),id:e.substring(t+1)}}function F(e){return B(e).namespace}function N(e){return B(e).id}function E(e){const t=F(e);return R(t)||q(e)||J(e)||K(e)||L(e)||t===T.OneToOneTextMessage}function O(e){return e===t.BookmarksThreadId}function U(e){return a.default.getS4LMessagingFeaturesNoSubscription().enableMyBot&&e===V()}function V(){const e=a.default.getS4LMessagingFeaturesNoSubscription().myBotId;return e?w(e,T.Bot):e}function H(e){return F(e)===T.Thread}function j(e){return F(e)===T.Bot&&!n.startsWith(N(e),t.ConnectorPrefixes.IntegrationNamespace)}function z(e){return F(e)===T.SkypeId}function W(e){const s=B(e);return s.namespace===T.SkypeId&&n.startsWith(s.id,t.GuestUserMriPrefix)}function G(e){return H(e)&&n.endsWith(e,t.HighlightsThreadIdSuffix)}function K(e){return H(e)&&n.endsWith(e,t.EncryptedThreadIdSuffix)}function q(e){return H(e)&&n.endsWith(e,t.OneToOneThreadIdSuffix)}function Q(e){return H(e)&&n.endsWith(e,t.SkypeThreadIdSuffix)||$(e)||X(e)}function X(e){return H(e)&&n.endsWith(e,t.P2PSkypeThreadIdSuffix)}function $(e){return H(e)&&n.endsWith(e,t.V2ThreadIdSuffix)}function J(e){return/19:uni01_.+@thread.v2/.test(e)}function Y(e){return I(e+t.HighlightsThreadIdSuffix,T.Thread)}function Z(e){return e.replace(/-/g,"")}function ee(e,t){const s=e<t?e+"|"+t:t+"|"+e;return u.byteArrayToHexString(u.computeSHA256(s)).toLowerCase()}function te(e,t,s){return e+":"+t+s}function se(e){if(d.isEventCallEndedMessageType(e)){return(e.skypeguid?M+e.skypeguid:void 0)||e.clientmessageid||e.id}return e.skypeeditedid||e.clientmessageid||e.id}function ie(e,t){return e+";"+Date.now()+";"+t}function oe(e){if(!e)return 0;const t=e.split(";")[0];return Number(t)}function ne(e){if(!e)return"0";return e.split(";")[2]}function re(e,t){if(e===t)return!1;const s=oe(e),i=oe(t);return!(s>i)&&(s!==i||ne(e)!==ne(t))}function ae(e){return n.split(e,";")[0]}t.ThreadTypes={Reactions:"cast",Phone:"phone",LegacyMeetNow:"meeting"},t.AllGlobalClearMri="ALL",t.HighlightsThreadIdSuffix="@highlights.skype",t.ReactionThreadIdSuffix="@cast.skype",t.EncryptedThreadIdSuffix="@encrypted.skype",t.OneToOneThreadIdSuffix="@oneToOne.skype",t.SkypeThreadIdSuffix="@thread.skype",t.P2PSkypeThreadIdSuffix="@p2p.thread.skype",t.BookmarksThreadId="48:starred",t.V2ThreadIdSuffix="@thread.v2",t.ConnectorThreadPropPrefix="integration",t.ThreadProps={BannedUserList:"banneduserlist",ConvView_MemberCount:"membercount",ConvView_MemberListString:"members",Creator:"creator",CreatedAt:"createdat",DisableAnonymousJoin:"disableanonymousjoin",HistoryDisclosed:"historydisclosed",IsContentChannel:"isContentChannel",IsSticky:"isStickyThread",JoinEnabled:"joiningenabled",LastJoinAt:"lastjoinat",LastLeaveAt:"lastleaveat",LiveState:"awareness_conversationLiveState",MagicBotEnabled:"magicbotenabled",MessageTranslationLocale:"messageTranslationLocale",IsMigrated:"isMigrated",ModeratedThread:"moderatedthread",ParentThreadId:"castParentThreadId",Picture:"picture",SecureDeviceSwitch:"secureDeviceSwitch",SecureHandshake:"encryptionHandshake",SecureHandshakeOnceEstablished:"encryptionHandshakeOnceEstablished",Source:"source",ThreadDetailsVersion:"version",ThreadType:"threadType",TopicName:"topic",Translated:"translated"},t.ThreadPropsV2={LiveState:"awareness_conversationLiveState:0"},t.ThreadPropsMapping=new y.default(t.ThreadProps,t.ThreadPropsV2),t.ConversationProps={Alerts:"alerts",Archived:"archived",Color:"color",ConsumptionHorizon:"consumptionhorizon",ConversationBlocked:"conversationblocked",ConversationStatus:"conversationstatus",ConversationStatusProperties:"conversationstatusproperties",DeleteTimestamp:"clearedat",Favorite:"favorite",IsEmptyConversation:"isemptyconversation",LiveState:"awareness_conversationLiveState",MessageTranslationLocale:"messageTranslationLocale",OneToOneThreadId:"onetoonethreadid",Participants:"participants",Pinned:"pinned",Subscription:"subscription",SuggestedActions:"suggestedactions",SuggestionsAugmentation:"suggestionsaugmentation",Translated:"translated"},t.ConversationPropsV2={Pinned:"ispinned",DeleteTimestamp:"clearHistoryTime",LiveState:"awareness_conversationLiveState:0"},t.ConversationPropsMapping=new y.default(t.ConversationProps,t.ConversationPropsV2),t.UserProps={AlertsLastReadTime:"alertsLastReadTime",BingBackgroundsEffectDismissed:"bingBackgroundsEffectSeen",BingSearchHistoryEnabled:"bingSearchHistoryEnabled",BingSearchTrendingEnabled:"bingSearchTrendingEnabled",CallNotificationsWhileDND:"callNotificationsWhileDND",CallTranslatorAlwaysStart:"callTranslatorAlwaysStart",CallTranslatorBotSpokenLanguageLocale:"callTranslatorBotSpokenLanguageLocale",CallTranslatorBotSubtitleLanguageLocale:"callTranslatorBotSubtitleLanguageLocale",CallTranslatorBotTranslationVoice:"callTranslatorBotTranslationVoice",CallTranslatorCaptionsPositionMode:"callTranslatorCaptionsPositionMode",CallTranslatorPrivacyConsent:"callTranslatorPrivacyConsent",CallTranslatorSpokenLanguage:"callTranslatorSpokenLanguage",CallTranslatorTranslationConsent:"callTranslatorTranslationConsent",CallTranslatorTranslationConsentChangeDate:"callTranslatorTranslationConsentChangeDate",CallTranslatorTranslationAutoDetectEnabled:"callTranslatorTranslationAutoDetectEnabled",CallTranslatorTranslationAutoDetectOffered:"callTranslatorTranslationAutoDetectOffered",CallTranslatorTruVoiceConsent:"callTranslatorTruVoiceConsent",CallTranslatorTruVoiceConsentChangeDate:"callTranslatorTruVoiceConsentChangeDate",CallTranslatorTranslationEnabled:"callTranslatorTranslationEnabled",CallTranslatorTruVoiceOffered:"callTranslatorTruVoiceOffered",CaptureFirstRunLevel:"captureFirstRunLevel",CaptureMarkupTooltipDismissed:"captureMarkupTooltipDismissed",CelebrationNotificationLastShownTime:"celebrationNotificationLastShownTime",ChatNotificationsWhileDND:"chatNotificationsWhileDND",ChatServiceRingChangedManually:"dogfoodUserRingForced",AdsPersonalizationEnabled:"channelAdsPersonalizationEnabled",CoachMarksSeen:"coachMarksSeen",ContentChannelsFRECompleted:"contentChannelsFRECompleted",ContentChannelsUpsellCardDismiss:"channelsSuggestionCardTimestamp",ContentChannelsSimilarUpsellCardDismiss:"channelsSimilarCardTimestamp",DisplayUrlPreviewsEnabled:"displayUrlPreviewsEnabled",E911Acknowledged:"e911Acknowledged",EmergencyCallDefaultCountryChanged:"emergencyCallDefaultCountryChanged",EnableSubtitlesForAllCalls:"enableSubtitlesForAllCalls",OnlyShowSubtitlesForOtherParticipants:"onlyShowSubtitlesForOtherParticipants",IntegrationAuthConsent:"integrationAuthConsent",IntegrationIdAuthStatePairs:"integrationIdAuthStatePairs",InterstitialForLargeGroupRinglessCallsShown:"interstitialForLargeGroupRinglessCallsShown",InterstitialForSmallGroupRinglessCallsShown:"interstitialForSmallGroupRinglessCallsShown",InviteSharingDisabled:"inviteSharingDisabled",IsSetupWizardCompleted:"isSetupWizardCompleted",LastEngagementProcessedMessageOnWebTimestamp:"lastEngagementProcessedMessageOnWebTimestamp",MobileCurrentBadgingDismissals:"mobileCurrentBadgingDismissals",MobileLastTodayTabShownTimestamp:"mobileLastTodayTabShownTimestamp",DesktopCurrentBadgingDismissals:"desktopCurrentBadgingDismissals",DesktopLastTodayTabShownTimestamp:"desktopLastTodayTabShownTimestamp",Locale:"locale",MagicBotWelcomeCardSeen:"magicBotWelcomeCardSeen",MagicBotCampaignReceived:"magicBotCampaignReceived",MagicBotConsent:"magicBotConsent",MagicBotConvListUnpin:"magicBotConvListUnpin",MagicBotWaitlistStatus:"magicBotWaitlistStatus",ImageGenerationFreCompleted:"imageGenerationFreCompleted",Market:"market",MsaProfile:"msaProfile",MSNMarket:"msnMarket",MediaEditorFirstRunLevel:"mediaEditorFirstRunLevel",MessageHintsData:"messageHintsData",MiniContextMenuEnabled:"miniContextMenuEnabled",MybotBotConvListUnpin:"myBotConvListUnpin",NotifyOnPresenceChange:"notifyOnPresenceChange",OldFriendBackNotification:"oldFriendBackNotification",OnboardingUserProfileScreenSeen:"onboardingUserProfileScreenSeen",PresentDNDSetting:"presentDNDSetting",PstnTranslationSettings:"pstnTranslationSettings",ReadReceiptsEnabled:"readReceiptsEnabled",Reactions:"customReactions",CustomCallReactions:"customCallReactions",ReactionPushNotificationsEnabled:"reactionPushNotificationsEnabled",ReadReceiptsUserPreference:"readReceipsUserPreference",SendOptionalTelemetry:"sendOptionalTelemetry",ScheduledCallReminders:"scheduledCallReminders",ScheduleNextCallDisplayedTimes:"scheduleNextCallDisplayedTimes",ScheduleNextCallCurrentSuccessfulCalls:"scheduleNextCallCurrentSuccessfulCalls",ScheduledCallBannerDismissStates:"scheduledCallBannerDismissStates",SuggestionsEnabled:"suggestionsEnabled",ShowTodayBadge:"showTodayBadge",Timezone:"timezone",ToneRewriteSuggestionsEnabled:"toneRewriteSuggestionsEnabled",TranslatedConversationBannerDismissStates:"translatedConversationBannerDismissStates",UserAppearancePreferences:"userAppearancePreferences"},t.ServerUserProps={Cid:"cid",CidHex:"cidHex",UserRing:"userRing",SkypeName:"skypeName",UedPushEnabled:"uedPushEnabled"},t.SubscriptionTypes={Loud:"loud",Normal:"normal",Muted:"muted"},t.ConnectorPrefixes={IntegrationNamespace:"integration:"},t.ThreadPropsInConversationView=[t.ThreadProps.LastJoinAt,t.ThreadProps.LastLeaveAt,t.ThreadProps.ThreadDetailsVersion,t.ThreadProps.ThreadType,t.ThreadProps.ConvView_MemberCount,t.ThreadProps.ConvView_MemberListString,t.ThreadProps.LiveState];const le=/<[^<>]+>/g;function de(e,t){if(!e)return;const s=e.split(";");for(let e=0;e<s.length;e++){const i=s[e].split("=");if(2===i.length&&i[0].trim()===t)return i[1]}}function ce(e){return t=>{if(!t)return;const s=t.indexOf(e);return-1!==s?t.substring(s+e.length):void 0}}function ue(e){return"{"===e[0]?e:"{"+e+"}"}function he(e){const t=e.selfLink.split("/");return t[n.findIndex(t,(e=>"endpoints"===e))+1]}function pe(e){return e.headers.location}t.SKYPE_TOKEN_HEADER_PREFIX="skypetoken=",t.REGISTRATION_TOKEN_HEADER_PREFIX="registrationToken=",t.getSkypetokenFromAuthenticationHeader=ce(t.SKYPE_TOKEN_HEADER_PREFIX),t.getRegistrationTokenFromHeader=ce(t.REGISTRATION_TOKEN_HEADER_PREFIX),t.ChannelTypes={PushNotification:"PushNotification",HttpLongPoll:"HttpLongPoll"}},583506:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MaxUnreadMessageCount=t.BlankCounts=void 0,t.calculateCountsForConversation=f,t.validateUnreadMessageCounts=function(e){const t=n.keyBy(e,(e=>e.conv.id)),s=n.filter(n.keys(t),(e=>!!t[e]));return g.log(h.LogTraceArea.ConversationCalculations,"validateUnreadMessageCounts start"),a.all(n.map(s,(e=>f(t[e],!0)))).then((i=>{let a=0,d=0,c=!0;return n.each(s,((s,n)=>{const r=t[s].counts,u=i[n].counts;u&&(r&&function(e,t){if(!e)return!0;if(!t)return!1;if(e.unreadCount!==t.unreadCount||e.highPriorityUnreadCount!==t.highPriorityUnreadCount||e.hasUnread!==t.hasUnread)return!1;if(void 0!==e.unreadCountOverflowed&&void 0!==t.unreadCountOverflowed&&e.unreadCountOverflowed!==t.unreadCountOverflowed)return!1;return!0}(r,u)?(u.hasUnread&&g.log(h.LogTraceArea.ConversationCalculations,"Unread count for "+m.mriOrId(s)+" is "+u.unreadCount+" based on convHash "+u.convHashUsedForCalc),1===e.length&&g.log(h.LogTraceArea.ConversationCalculations,"  Current conversation "+o.pii.Omit(JSON.stringify(t[s])))):(g.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent unread message counts for conversation "+m.mriOrId(s)),g.log(h.LogTraceArea.ConversationCalculations,"  Saved "+JSON.stringify(r)),g.log(h.LogTraceArea.ConversationCalculations,"  Computed "+JSON.stringify(u)),g.log(h.LogTraceArea.ConversationCalculations,"  Conversation "+o.pii.Omit(JSON.stringify(t[s]))),c=!1),l.isHighlightsThread(s)||(r&&r.hasUnread&&a++,u.hasUnread&&d++))})),a!==d&&(g.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent unread conversation count. Was "+a+" but should be "+d),c=!1),r.default.getCount().then((e=>(a!==e&&(g.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent home screen badge count. Old was "+a+" but actual badge count was "+e),c=!1),d!==e&&(g.log(h.LogTraceArea.ConversationCalculations,"Found inconsistent home screen badge count. New was "+d+" but actual should be "+e),c=!1),c&&g.log(h.LogTraceArea.ConversationCalculations,"Message counts appear to be consistent"),c)))})).fail((()=>{g.log(h.LogTraceArea.ConversationCalculations,"validateUnreadMessageCounts failed")}))};const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(199118)),a=i.__importStar(s(397691)),l=i.__importStar(s(44717)),d=i.__importDefault(s(434343)),c=i.__importStar(s(596467)),u=i.__importStar(s(766698)),h=s(815146),p=i.__importStar(s(190209)),g=i.__importStar(s(85385)),m=i.__importStar(s(437782));t.BlankCounts={convHashUsedForCalc:void 0,consumptionHorizonTimestamp:0,unreadCount:0,unreadCountOverflowed:!1,highPriorityUnreadCount:0,hasUnread:0,lastHighlightMessage:void 0,numMessagesSentByUser:0};const S=2592e6,_=100;function f(e,s){const i=e.conv;if(!i.lastMessage&&!e.counts)return a.Resolved({counts:void 0,earlyExit:!0,msg:"Skipping due to no lastMessage"});const o=function(e){let t=e.conv.convViewVersion.toString()+";"+(e.conv.lastMessage?e.conv.lastMessage.createdTime.toString():"0")+";"+e.conv.getConsumptionHorizon()+";"+e.conv.getConversationProperty(l.ConversationProps.Alerts)+";"+e.conv.getConversationProperty(l.ConversationProps.Subscription)+";"+e.conv.getConversationProperty(l.ConversationProps.ConversationBlocked)+";"+e.conv.getConversationProperty(l.ConversationProps.ConversationStatus)+";"+(e.conv.isCurrentUserMember()?"1":"0");e.conv.isThread()&&(t+=";"+e.conv.getThreadProperty(l.ThreadProps.LastJoinAt)+";"+e.conv.getThreadProperty(l.ThreadProps.LastLeaveAt));e.syncInfo&&e.syncInfo.messageHistoryStartTime&&(t+=";"+e.syncInfo.messageHistoryStartTime.toString());e.conv.isHighlightsThread()&&(t+=";H1");e.conv.isMuted()&&(t+=";M2");const s=u.computeSHA256(t);return u.byteArrayToBase64String(s)}(e);if(!s&&e.counts&&e.counts.convHashUsedForCalc===o)return a.Resolved({counts:e.counts,earlyExit:!0,msg:"Skipping due to matching cache"});const n=c.isConversationDisplayable(i),r=n||i.isHighlightsThread(),h=n,g=i.getConsumptionHorizon();let m=l.getServerTimestampFromConsumptionHorizon(g);if(!n&&!i.isHighlightsThread()||i.isArchived()||i.isHighlightsThread()&&!i.isBotHighlightsThread()&&!i.isCurrentUserMember())return a.Resolved({counts:t.BlankCounts,earlyExit:!0,msg:"Skipping due to not caring about it"});const S=Date.now();let _;const f=l.getCuidFromConsumptionHorizon(g);return _=f?d.default.getMessageByCuid(i.id,f).then((e=>{e&&e.createdTime>m&&(m=e.createdTime)})):a.Resolved(),_.then((()=>{if(i.isHighlightsThread()&&!l.isMyHighlightThread(i.id)){const e=p.getHighlightTimeWindow();m<e&&(m=e)}const e=t.MaxUnreadMessageCount+1;return a.all([r?d.default.getCountOfMessagesForConversationAfterTimeNormalPri(i.id,m,e):0,h?d.default.getCountOfMessagesForConversationAfterTimeHighPri(i.id,m):0,n?y(i):0,i.isHighlightsThread()?v(i,m):void 0])})).then((([e,s,n,a])=>{const l=e+s,d="Recalculated ("+(Date.now()-S)+"ms): Unread: "+l+", HiPri: "+s+", MyMessages: "+n+(i.isHighlightsThread()?", lastHighlightMessage: "+(a?a.cuid:0):""),c=l>0&&r&&!i.isMuted();return{counts:{convHashUsedForCalc:o,consumptionHorizonTimestamp:m,unreadCount:Math.min(l,t.MaxUnreadMessageCount),unreadCountOverflowed:l>t.MaxUnreadMessageCount,highPriorityUnreadCount:s,lastHighlightMessage:a,hasUnread:c?1:0,numMessagesSentByUser:n},earlyExit:!1,msg:d}}))}function y(e){return e?d.default.getCountOfMessagesForConversationISentSinceTime(e.id,Date.now()-S):a.Rejected("Conversation null in getCountOfSentMessages")}function v(e,t){return d.default.getMessagesForConversationBeforeTime(e.id,Number.MAX_VALUE,_,!1).then((s=>{let i;return l.isMyHighlightThread(e.id)?i=n.find(s,(e=>e.isHighlightMessage()&&!e.isDeletedMessage())):n.each(s,(e=>{e.isHighlightMessage()&&!e.isDeletedMessage()&&(!i||e.createdTime>t)&&(i=e)})),i}))}t.MaxUnreadMessageCount=99},196509:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getReplyNodeRenderDimensions=t.ReplyNodeSizes=t.replyNodeWidthSmall=t.replyNodeWidth=t.getQuoteContentNodeRenderDimensions=t.getContactNodeRenderDimensions=t.ContactNodeSizes=t.contactNodeHeight=t.getUrlPreviewNodeRenderDimensions=t.UrlPreviewNodeSizes=t.getAudioNodeRenderDimensions=t.getFileNodeRenderDimensions=t.FileNodeSizes=t.fileNodeWidthSmall=t.fileNodeWidth=t.availableSpaceUtilization=t.ThumbnailMinHeight=t.ThumbnailMinWidth=t.ThumbnailMaxWidth=t.CompositeGalleryThumbnailWidth=t.CompositeGalleryThumbnailHeight=t.UndefinedDimensions=void 0,t.prepareMediaNodeDimensionsFunction=function(e){if(e.renderOrigin===n.MessageRenderOrigin.CompositeGalleryCanvas)return()=>a;const s=e.decodedNode.getFirstUriObjectChild(r.PictureNode),i=s&&s.getOriginalDimensions();let o;o=void 0===i||void 0===i.width||void 0===i.height?{width:t.CompositeGalleryThumbnailWidth,height:t.CompositeGalleryThumbnailHeight}:{width:i.width,height:i.height};return(e,t)=>d(o,e)},t.prepareSwiftCardNodeDimensionsFunction=function(e,s){let i;i=void 0===e||void 0===e.width||void 0===e.height?{width:t.CompositeGalleryThumbnailWidth,height:t.CompositeGalleryThumbnailHeight}:{width:e.width,height:e.height};return d(i,s)},t.getScaledThumbnailDimensions=d;const i=s(197582),o=i.__importDefault(s(751962)),n=i.__importStar(s(242561)),r=s(606933);t.UndefinedDimensions={width:void 0,height:void 0};t.CompositeGalleryThumbnailHeight=200,t.CompositeGalleryThumbnailWidth=300;const a={height:t.CompositeGalleryThumbnailHeight,width:t.CompositeGalleryThumbnailWidth};t.ThumbnailMaxWidth=300;const l=300;function d(e,s){const{width:i,height:n}=e;if(!i||!n)return t.UndefinedDimensions;const r=!s||void 0===s.width||s.width*t.availableSpaceUtilization>t.ThumbnailMaxWidth?t.ThumbnailMaxWidth:s.width*t.availableSpaceUtilization,a=!s||void 0===s.height||s.height>l?l:s.height,d=o.default.fitToContainer({width:i,height:n},{width:r,height:a});return d.width<t.ThumbnailMinWidth&&(d.width=t.ThumbnailMinWidth),d.height<t.ThumbnailMinHeight&&(d.height=t.ThumbnailMinHeight),d}t.ThumbnailMinWidth=60,t.ThumbnailMinHeight=60,t.availableSpaceUtilization=.55,t.fileNodeWidth=245,t.fileNodeWidthSmall=200,t.FileNodeSizes={Regular:{width:t.fileNodeWidth,height:void 0},Small:{width:t.fileNodeWidthSmall,height:void 0},Gallery:{width:void 0,height:void 0}};t.getFileNodeRenderDimensions=(e,s)=>{if(s===n.MessageRenderOrigin.CompositeGalleryCanvas||s===n.MessageRenderOrigin.StackGalleryCanvas)return t.FileNodeSizes.Gallery;let i=t.FileNodeSizes.Regular;return e&&e.width&&e.width<400&&(i=t.FileNodeSizes.Small),i},t.getAudioNodeRenderDimensions=t.getFileNodeRenderDimensions;t.UrlPreviewNodeSizes={Regular:{width:300,height:150},Small:{width:200,height:125},Gallery:{width:void 0,height:150}};t.getUrlPreviewNodeRenderDimensions=(e,s)=>{if(s===n.MessageRenderOrigin.CompositeGalleryCanvas||s===n.MessageRenderOrigin.StackGalleryCanvas)return t.UrlPreviewNodeSizes.Gallery;let i=t.UrlPreviewNodeSizes.Regular;return e&&e.width&&e.width<500&&(i=t.UrlPreviewNodeSizes.Small),i};t.contactNodeHeight=175,t.ContactNodeSizes={Regular:{width:214,height:t.contactNodeHeight},Small:{width:200,height:t.contactNodeHeight},Gallery:{width:void 0,height:150}};t.getContactNodeRenderDimensions=(e,s)=>e&&e.width&&e.width<400?t.ContactNodeSizes.Small:t.ContactNodeSizes.Regular;t.getQuoteContentNodeRenderDimensions=()=>c;const c={width:150,height:100};t.replyNodeWidth=245,t.replyNodeWidthSmall=200,t.ReplyNodeSizes={Regular:{width:t.replyNodeWidth,height:void 0},Small:{width:t.replyNodeWidthSmall,height:void 0},Gallery:{width:void 0,height:void 0}};t.getReplyNodeRenderDimensions=(e,s)=>e&&e.width&&e.width<400?t.ReplyNodeSizes.Small:t.ReplyNodeSizes.Regular},555078:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.forwardMessages=function(e,t,s,i,_,f){const y=1===e.length,v=[];let C;const T=m.default.newCauseId();let M,b=!0;const I=o.filter(e,(e=>!e.forwardAlbumId||e.message.isAlbum())).length;let w=d.getString("StreamItem.ForwardMessagesHeader",{count:I});e&&e.length>0&&(o.each(e,((e,i)=>{switch(C=(0,r.getMessageTypeGroup)(e.message),C){case r.MessageTypeGroups.MediaAlbum:e.forwardAlbumId&&v.push(h.default.getShareParametersForAlbumMsg(e.message,t,e.forwardAlbumId));break;case r.MessageTypeGroups.Location:y&&(w=d.getString("StreamItem.ForwardLocationMessageHeader")),v.push(h.default.getShareParametesForLocation(e.message,t)),M=u.SharePreviewType.Location;break;case r.MessageTypeGroups.Picture:S(e.message,t,y,v,_.rootViewId,e.forwardAlbumId),M=u.SharePreviewType.Photo;break;case r.MessageTypeGroups.Video:S(e.message,t,y,v,_.rootViewId,e.forwardAlbumId),M=u.SharePreviewType.Video;break;case r.MessageTypeGroups.Audio:S(e.message,t,y,v,_.rootViewId),M=v[i].fileType===g.UploadFileType.AudioMessage?u.SharePreviewType.AudioMessage:u.SharePreviewType.Audio;break;case r.MessageTypeGroups.UriFile:S(e.message,t,y,v,_.rootViewId),M=u.SharePreviewType.File;break;case r.MessageTypeGroups.SwiftCard:let o;if(M=u.SharePreviewType.SwiftCards,!p.default.isNodeTextMessage(e.node)){let i;n.default.isAdaptiveCard(e.node)?(i=h.default.getShareParametersForAdaptiveMessage(e.message,e.node,s),o=n.default.isAdaptiveCardCarousel(e.node)):(i=h.default.getShareParametersForSwiftMessage(e.message,e.node,t,s,T,y),o=p.default.isSwiftCarousel(e.node)),i&&v.push(i)}y&&o&&(w=d.getString("SwiftCard.ShareCards"));break;case r.MessageTypeGroups.Contact:y&&(w=d.getString("StreamItem.ForwardMessageContact"));const a=h.default.getShareParametesForContactMessage(e.message,t);if(!a)return;b=!1,v.push(a),M=u.SharePreviewType.Contact;break;case r.MessageTypeGroups.Text:v.push(h.default.getShareParametersForText(e.message,e.node,t)),M=u.SharePreviewType.Text}})),y||(M=u.SharePreviewType.MultipleMessages));y&&C?l.log(a.LogTraceArea.GenericUnsafe,`ShareMessageUtils.forwardMultipleMessages for single message of\n                message type , ${r.MessageTypeGroups[C]} causeId: ${T}`):l.log(a.LogTraceArea.GenericUnsafe,`ShareMessageUtils.forwardMultipleMessages for multiple messages\n              causeId: ${T}`);if(0===v.length)return void(i&&i());const P=function(e){return{[c.MessageActionOrigin.ImageCreator]:a.SharePanelEntryOrigin.ImageCreator,[c.MessageActionOrigin.StreamItemMultipleMessages]:a.SharePanelEntryOrigin.MultiSelect}[e]||a.SharePanelEntryOrigin.MessageActionMenu}(t);return h.default.shareMultipleMessages(v,w,T,P,i,_,M,b,f)};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(660324)),r=s(971988),a=s(815146),l=i.__importStar(s(85385)),d=i.__importStar(s(704704)),c=s(786531),u=s(113002),h=i.__importDefault(s(819549)),p=i.__importDefault(s(989314)),g=s(331079),m=i.__importDefault(s(760989));function S(e,t,s,i,o,n){const r=h.default.getShareParametersForMedia(e,t,s,o,n);r&&i.push(r)}},190209:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getHighlightTimeWindow=function(){return Date.now()-s};const s=6048e5},598178:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HtmlSanitizer=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(391036)),r=s(525097);class a{constructor(){this._defaultAllowedTags=[],this._defaultAllowedAttributes=[],this._addTags=[],this._addAttributes=[],this._allowedSrcProtocols=["data","cid","blob","http","https","ftp","ftps"],this._allowedHrefProtocols=["http","https","mailto","onenote","tel","ftp","ftps"],this._transformATag=(e,t={})=>(t.href&&(t.href=this.sanitizeHrefUrl(t.href),t.title=this._getIdnSafeTitle(t.href)),{tagName:e,attribs:t=this._addTargetAndRelAttributes(t)}),this._transformAllTags=(e,t)=>(t&&t.style&&(t.style=this._sanitizeStyle(t.style)),{tagName:e,attribs:t}),this._semanticObjectSchemas=o.values(r.SemanticObjectSchemas),this._initCustomData(),this._sanitizeHtmlConfig=this._buildSanitizeHtmlConfig()}sanitizeHtml(e){return e?(0,n.default)(e,this._sanitizeHtmlConfig):e}sanitizeHrefUrl(e,t=!1){return function(e,t){if(!e)return"";if(e.startsWith("/"))return e;const s=e.indexOf(":");if(s<=0)return"";e=e.replace(/(\')/g,"%27"),e=e.replace(/(\")/g,"%22");const i=e.substring(0,s).toLowerCase();for(const s of t)if(i===s)return e;if("http"===i)return`https${e.substring(s)}`;return""}(e,t?["mailto"]:this._allowedHrefProtocols)}_addTargetAndRelAttributes(e){return o.find(this._semanticObjectSchemas,(t=>t===e[r.Attributes.itemtype]))||(e.target="_blank",e.rel="noreferrer noopener"),e}_getIdnSafeTitle(e){let t=e;if(!e||e.startsWith("/"))return t;const s=function(e){try{const t=new URL(e);return t.hostname&&(t.hostname.startsWith("xn--")||t.hostname.indexOf(".xn--"))?t.href:void 0}catch(e){return}}(e);return s&&(t=s),t.toLowerCase()}_stripComments(e){let t="code";return o.reduce(e.split(""),((e,s,i,o)=>{switch(t){case"code":return"/"===s&&"*"===o[i+1]?(t="comment",e):`${e}${s}`;case"comment":return"/"===s&&"*"===o[i-1]&&(t="code"),e}}),"")}_sanitizeStyle(e){let t=e.replace(/(url|attr)\([^)]*\)?/gi,";");t=t.replace(/position\s*:\s*(\\66|f)\s*(\\69|i)\s*(\\78|x)\s*(\\65|e)\s*(\\64|d)\s*/gi,"position:absolute");const s=this._stripComments(t).split(";").filter((e=>{const t=e.split(":");return-1!==r.AllowedStyles.indexOf(t[0].trim())}));return o.join(s,";")}_initCustomData(){this._defaultAllowedTags=r.AllowedHtmlElements,this._defaultAllowedAttributes=r.AllowedHtmlAttributes,this._addTags=["URIObject","Title","Swift","Description","ended","partlist","part","name","duration","OriginalName","Identifiers","Id","RecordingContent","item","RecordingStatus","AddCustomApp","DeleteCustomApp","UpgradeCustomAppV2","eventtime","initiator","target","targetName","DeprecatedTargetName","UpdateFavDefault","isDefault"],this._addAttributes=[r.IgnoreSemanticLinkAttr,"url_thumbnail","b64","identity","uri","v"]}_buildSanitizeHtmlConfig(){return{allowedTags:this._defaultAllowedTags.concat(this._addTags),allowedAttributes:{"*":this._defaultAllowedAttributes.concat(this._addAttributes)},allowedSchemes:this._allowedHrefProtocols,allowedSchemesByTag:{img:this._allowedSrcProtocols},parser:{lowerCaseTags:!1},nonTextTags:["style","script","textarea","ts-hint"],transformTags:{a:this._transformATag,"*":this._transformAllTags}}}}t.HtmlSanitizer=a,t.default=new a},525097:(e,t)=>{var s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.AllowedStyles=t.AllowedHtmlAttributes=t.AllowedHtmlElements=t.Attributes=t.IgnoreSemanticLinkAttr=t.SemanticObjectSchemas=void 0,function(e){e.mention="http://schema.skype.com/Mention",e.inputExtension="http://schema.skype.com/InputExtension",e.amsVideo="http://schema.skype.com/AMSVideo",e.amsImage="http://schema.skype.com/AMSImage",e.emoji="http://schema.skype.com/Emoji",e.live="http://schema.skype.com/Live"}(s||(t.SemanticObjectSchemas=s={})),t.IgnoreSemanticLinkAttr="data-ignore-semantic-link",function(e){e.color="color",e.bgColor="background-color",e.itemProps="data-itemprops",e.itemtype="itemtype",e.mentionId="data-mention-id",e.height="height",e.itemid="itemid",e.itemscope="itemscope",e.src="src",e.style="style",e.width="width"}(i||(t.Attributes=i={}));t.AllowedHtmlElements=["a","abbr","acronym","address","area","article","aside","b","bdi","bdo","big","blockquote","br","caption","center","cite","code","col","colgroup","dd","del","dfn","dir","div","dl","dt","em","figcaption","figure","font","footer","h1","h2","h3","h4","h5","h6","header","hgroup","hr","i","img","img","ins","kbd","label","li","map","map","mark","menu","nav","ol","p","pre","q","rp","rp","rt","rt","ruby","s","samp","section","small","span","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var","wbr","mention","semantic-object","ss","at"];t.AllowedHtmlAttributes=["abbr","align","alt","axis","bgcolor","border","cellpadding","cellspacing","class","clear","color","cols","colspan","compact","content","contenteditable","coords","data-ams-src","data-itemprops","data-preview-src","data-src","data-ts-imgid","data-ts-imglen","dir","face","headers","height","href","hreflang","hspace","ismap","itemid","itemprop","itemscope","itemtype","lang","language","nohref","nowrap","rel","rev","rows","rowspan","rules","scope","scrolling","shape","size","span","src","start","style","summary","target","title","type","usemap","valign","value","vspace","width","mri","type","originalsrc","id","tone"],t.AllowedStyles=["@font-face","@font-feature-values","@keyframes","align-content","align-items","align-self","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","animation","background-attachment","background-blend-mode","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","background","border-bottom-color","border-bottom-left","border-bottom-right","border-bottom-style","border-bottom-width","border-bottom","border-collapse","border-color","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-image","border-left-color","border-left-style","border-left-width","border-left","border-radius","border-right-color","border-right-style","border-right-width","border-right","border-spacing","border-style","border-top-color","border-top-left","border-top-right","border-top-style","border-top-width","border-top","border-width","border","bottom","box-decoration-break","box-shadow","break-after","break-before","break-inside","caption-side","clear","clip","color","column-count","column-fill","column-gap","column-rule-color","column-rule-style","column-rule-width","column-rule","column-span","column-width","columns","counter-increment","counter-reset","direction","display","empty-cells","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","flex","float","font-family","font-feature-settings","font-kerning","font-language-override","font-size-adjust","font-size","font-stretch","font-style","font-synthesis","font-variant-alternates","font-variant-caps","font-variant-east","font-variant-ligatures","font-variant-numeric","font-variant-position","font-variant","font-weight","font","hanging-punctuation","height","hyphens","image-orientation","image-rendering","image-resolution","justify-content","left","letter-spacing","line-break","line-height","list-style-image","list-style-position","list-style-type","list-style","margin-bottom","margin-left","margin-right","margin-top","margin","marquee-direction","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","object-fit","object-position","opacity","order","overflow-wrap","overflow-x","overflow-y","overflow","padding-bottom","padding-left","padding-right","padding-top","padding","position","right","tab-size","table-layout","text-align-last","text-align","text-combine-upright","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-style","text-decoration","text-indent","text-justify","text-orientation","text-shadow","text-transform","text-underline-position","top","unicode-bidi","user-select","vertical-align","visibility","white-space","widows","width","word-break","word-spacing","word-wrap","writing-mode"]},368434:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.copyAllowed=void 0;const i=s(197582).__importStar(s(496486)),o=s(971988),n=[o.MessageTypes.Text,o.MessageTypes.RichText,o.MessageTypes.UriObject,o.MessageTypes.Sms,o.MessageTypes.EncryptedText,o.MessageTypes.MagicBotEvent];t.copyAllowed=(e,t)=>e&&i.includes(n,t)},422693:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMessageInSendingState=function(e,t){return t!==i.MessageRenderOrigin.CallCanvas&&e.isMessageLie()&&!e.isSendRejected()&&!e.isEphemeral()};const i=s(197582).__importStar(s(242561))},569269:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(974634)),n=s(815146),r=i.__importStar(s(85385));const a=new class{constructor(){this._focusMessageComposerEvent=new o.default}focusMessageComposerEvent(){return this._focusMessageComposerEvent}focusMessageComposer(){r.log(n.LogTraceArea.Navigation,"MobileContentPanelHelper focusMessageComposer"),this._focusMessageComposerEvent.fire(!0)}blurMessageComposer(){r.log(n.LogTraceArea.Navigation,"MobileContentPanelHelper blurMessageComposer"),this._focusMessageComposerEvent.fire(!1)}};t.default=a},780426:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.computeMarks=function(e,t){let s=0,i=-1;const a={},l=[],d=1e3*n.default.getS4LMessagingFeaturesNoSubscription().readReceiptsAllowedLieTime,c=(e,t,s)=>{if(!r.default.isMyMri(t)){const i=a[e]||{readReceipts:[]};i.readReceipts.push({mri:t,timestamp:s}),a[e]=i}};if(o.each(e,((e,n)=>{for(;s<t.length&&e.createdTime>t[s].consumptionHorizon;){if(i>=0){const e=t[s];c(i,e.id,e.consumptionHorizonUpdateTime)}s++}const r=o.find(t,(t=>t.id===e.creator)),u=r?r.consumptionHorizonUpdateTime:0,h=e.createdTime-u;return!o.includes(l,e.creator)&&a[i]&&h>0&&h<d&&!o.isEmpty(o.remove(a[i].readReceipts,(t=>t.mri===e.creator)))&&(o.isEmpty(a[i].readReceipts)&&delete a[i],l.push(e.creator),c(n,e.creator,e.createdTime)),s!==t.length&&(e.countsForReadReceipts()&&(i=n),!0)})),i>=0)for(;s<t.length;){const e=t[s];c(i,e.id,e.consumptionHorizonUpdateTime),s++}return a};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=i.__importDefault(s(363091))},463899:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(85385)),n=s(670873),r=s(773151),a=i.__importDefault(s(760989));class l{static trackSortByFilter(e){if(!l._isSortByFilterTracked){let t;switch(l._isSortByFilterTracked=!0,e){case r.RecentsSortBy.Time:t=n.RecentConversationsFilterAction.SortByTime;break;case r.RecentsSortBy.Unread:t=n.RecentConversationsFilterAction.SortByUnread;break;case r.RecentsSortBy.Active:t=n.RecentConversationsFilterAction.SortByActive;break;default:t=a.default.switchStatementExhaustiveChecking(e)}o.track(new n.RecentConversationsFilterEvent(t))}}static trackRowSize(e){if(!l._isRowSizeTracked){let t;switch(l._isRowSizeTracked=!0,e){case r.RowSize.Default:t=n.RecentConversationsFilterAction.RowSizeDefault;break;case r.RowSize.Compact:case r.RowSize.ExtraCompact:t=n.RecentConversationsFilterAction.RowSizeCompact;break;default:t=a.default.switchStatementExhaustiveChecking(e)}o.track(new n.RecentConversationsFilterEvent(t))}}static trackShowCategories(e){if(!l._isShowCategoriesTracked){l._isShowCategoriesTracked=!0;const t=e?n.RecentConversationsFilterAction.ShowCategories:n.RecentConversationsFilterAction.HideCategories;o.track(new n.RecentConversationsFilterEvent(t))}}}l._isSortByFilterTracked=!1,l._isRowSizeTracked=!1,l._isShowCategoriesTracked=!1,t.default=l},332065:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importStar(s(971988)),a=i.__importDefault(s(389659)),l=i.__importStar(s(463519)),d=s(815146),c=i.__importStar(s(85385)),u=s(606933),h=s(36381),p=i.__importDefault(s(374503)),g=i.__importDefault(s(655192)),m=i.__importDefault(s(760989));t.default=class{static _updateInvitations(e,t,s,i){const o=n.find(t,(e=>e.key===i));return o&&n.each(o.users,(t=>{const i=e[t.mri];(!i||t.time&&(!i.updatedTimeMs||t.time>i.updatedTimeMs))&&(e[t.mri]={invitationStatus:s,updatedTimeMs:t.time})})),e}static containsScheduledCallData(e){return!!e.properties}static extractScheduledCallFromMessage(e){const t=l.decode(e).getFirstUriObjectChild(u.ScheduledCallInviteNode);if(!t)return void c.error(d.LogTraceArea.ScheduleCall,"Received ScheduledCall message but it does not have a URIObject.");const s=e.properties&&e.properties[r.MessageProperties.ScheduledCallInviteData];if(!s)return void c.error(d.LogTraceArea.ScheduleCall,`Missing ScheduledCallInviteData property in scheduled call message,id: ${t.scheduledCallId},subject: ${t.subject?o.pii.Omit(t.subject):"''"},datetimeMs: ${a.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)}`);const i=g.default.parseJsonErrorToUndefined(s);if(!this._validateScheduledCallInviteData(i,t))return;const n=e.getScheduledCallsResponses();return i.invitations=this._updateInvitations(i.invitations,n,h.ScheduledCallInvitationStatus.Accepted,r.MessageAnnotations.ScheduledCallInviteAccepted),i.invitations=this._updateInvitations(i.invitations,n,h.ScheduledCallInvitationStatus.Declined,r.MessageAnnotations.ScheduledCallInviteDeclined),{id:t.scheduledCallId,convId:e.conversationId,cuid:e.cuid,organizer:e.creator,invitations:i.invitations,consumptionHorizons:i.consumptionHorizons,datetimeMs:t.datetimeMs,reminder:t.reminder,subject:t.subject?m.default.unescapeXml(t.subject):p.default.getScheduledCallSubject(t.subject),canceledTimeMs:t.canceledTimeMs,editedTimeMs:t.editedTimeMs}}static _validateScheduledCallInviteData(e,t){if(e&&void 0!==e.invitations&&void 0!==e.consumptionHorizons)return!0;if(!e)return c.error(d.LogTraceArea.ScheduleCall,`ScheduledCallInviteData property is undefined,id: ${t.scheduledCallId},subject: ${t.subject?o.pii.Omit(t.subject):"''"},datetimeMs: ${a.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)}`),!1;const s=`Unexpected content in the ScheduledCallInviteData property:id: ${t.scheduledCallId},subject: ${t.subject?o.pii.Omit(t.subject):"''"},datetimeMs: ${a.default.getAbsoluteDisplayDateTimeString(t.datetimeMs)},'invitations' property is undefined: ${!e.invitations},'consumptionHorizons' property is undefined: ${!e.consumptionHorizons}`;return c.error(d.LogTraceArea.ScheduleCall,s),!1}}},911016:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadActionType=t.PostingActionType=t.BackgroundTransferActionType=void 0,t.transferServicesMeta=function(e){const s={hasTransfer:!1,hasPost:!1,hasDownload:!1};return i.each(e,(e=>(e===t.BackgroundTransferActionType&&(s.hasTransfer=!0),e===t.PostingActionType&&(s.hasPost=!0),e===t.DownloadActionType&&(s.hasDownload=!0),!i.every(s)&&void 0))),s};const i=s(197582).__importStar(s(496486));t.BackgroundTransferActionType="backgroundTransfer",t.PostingActionType="messagePost",t.DownloadActionType="fileDownload"},942559:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(291498),o={asmImageProxy:"https://urlp.asm.skype.com/v1/url/content",audioSendTimeout:5e3,audioMessageMaxRecordingTimeMs:12e4,backgroundHeadlessPosting:!1,backgroundPostingOnPushDebounceTimeout:3e4,backgroundTransfersInFlightLimit:0,bingImageAppId:"NO_APP_ID",bingImageBaseUrl:"https://www.bingapis.com/api/v7/images",bingMapsImageryRestApiBaseUrl:"https://dev.virtualearth.net/REST/v1/Imagery/Map/CanvasLight",bingMapsLocationRestApiBaseUrl:"https://dev.virtualearth.net/REST/v1/Locations",bingMapsPoweredByImageUrl:"https://dev.virtualearth.net/Branding/logo_powered_by.png",bingMapsRestApiKey:"NO_API_KEY",bingPlacesAppId:"NO_APP_ID",bingSearch:{host:"https://www.bing.com/search?q=",tryOpenInAppBrowser:!0,clickLinkTenantIdRightClickSidebar:"SKCONS",clickLinkTenantIdRightClickBrowser:"SKCONB"},bingSearchMessageHint:{enabled:!1,maxShownTimes:1,timeToShowHintInMs:216e5},browserMultiTabNotifications:{enabled:!1,activeTabRefreshInterval:4e4,activeTabExpirationInterval:6e4},callingSendTimeout:3e3,captivePortalQuestionnaireFrequency:0,clearPushRegistrations:!1,composerAutoCompletionDelay:500,conversationLoadingThresholdInMS:800,consumePresenceFromPush:!1,contactSendTimeout:3e3,contextMenuMessageHint:{enabled:!1,maxShownTimes:1,timeToShowHintInMs:216e5},convPanelLoggingLevel:"on",disableGifsInMediaPicker:!1,emoticonForDefaultCard:"like",emoticonForEmptyCallsTab:"call",emoticonForEmptyChatsTab:"like",emoticonForEmptyContactsTab:"party",emoticonForEmptyNotificationsTab:"bell",emoticonForEmptyPhoneTab:"canyoutalk",emoticonForMeetNowCard:"mansurfer",emoticonForMeetNowExtendedCard:"mansurfer",emoticonForMobileLandlinesCard:"whosthis",emoticonForOnboardingContactsTab:"like",emoticonForOnboardingPermissionsTab:"camera",emoticonForOnboardingDiagnosticTab:"smilerobot",emoticonForSkypeToPhoneCard:"avocadolove",emoticonForSkypeNumberCard:"whosthis",emoticonForTelemetryConsentCard:"1fa7a_stethoscope",emoticonForWhatsNewCard:"launch",emoticonForClips:"movie",emoticonForSmsEntry:"speechbubble",emoticonsOnlyEmoticonSize:2,enableActionableCallSystemMessages:!1,enableActionableSystemMessages:!1,enableAudioMessageWaveAndSpeed:!1,enableAltMsgView:!1,enableAlwaysVisibleMagicBotToolboxGroups:!1,enableAdaptiveCardLibs:!1,enableAddAllDeviceContacts:!0,enableAndroidCustomDownloadFolder:!1,enableAndroidMessagingStyleNotifications:!1,enableAndroidRichContentHandling:!1,enableAIUnifiedConsent:!1,enableAutoDownloadFiles:!1,enableAutoDownloadFilesInCall:!1,enableAudioTranscription:!1,enableAutoDownloadOnDesktopAndMobile:!1,enableBingSearchMessages:!1,enableAutoPlayVoiceMessagesInRow:!1,enableBigUnicodeEmoticons:!0,enableBrickingOneToOneThreads:!0,enableContactAddDragAndDrop:!1,enableConversationsCategoriesIcon:!1,enableConversationContextMenuInBottomSheet:!1,enableConversationListFiltersInBottomSheet:!1,enableConversationLoadingSpinnerTracking:!1,enableConversationSwitchWithoutRemount:!1,enableConversationSyncLie:!1,enableConversationTabsDropdown:!1,enableConversationSearchInMobile:!1,enableConvListInitialRenderLimit:!1,enableCustomFileDownloadLocation:!1,enableDebugMessageActions:!1,enableDefaultOnForMultiDevicePushNotifications:!1,enableDefferedComposerOnAndroid:!1,enableDirectBookmarkDelete:!1,enableDisconnectedTrouterReporting:!1,enableDoubleTapReaction:!1,enableDraftMessagesPersistentStorage:!1,enableEdgeFeaturesForOpenLink:!1,enableFastMessageSendSuccessPropagation:!1,enableForwardingHtmlMessages:!1,enableForwardingQuotes:!1,enableForwardItemIconForStreamItems:!1,enableFullChatUx:!1,enableFullResolutionImageDownload:!0,enableGifOptimisation:!1,enableGifPlayer:!1,enableGroupedConversations:!0,enableHandlingHTMLonPaste:!1,enableHtmlComposer:!1,enableHtmlAndroidComposer:!1,enableImageForwarding:!1,enableImagePasteMobile:!1,enableIndividualPesItemTelemetry:!1,enableJoinEnabledThreadPropInConversationView:!1,enableKeepUnsentMessagesAtEndOfStream:!1,enableKeyboardNavigationBetweenConversations:!1,enableLocationSharingOnDesktopAndWeb:!1,enableFixingIncorrectBotNames:!0,enableMagicBot:!0,enableImageCreator:!1,filePickerMenuOrder:i.FilePickerMenuDefaultOrder,imageGenerationPrefillExperiment:"prefill",imageGenerationDefaultImagesBaseUrl:"https://az705183.vo.msecnd.net/dam/skype/media/engagement",enableImageCreatorHistory:!1,imageCreatorHistoryMaxItems:30,enableMarkAsReadNotificationAction:!1,enableMediaFileRedesign:!1,enableMediaPreviewDrafts:!1,enableMediaPreviewDraftsPersistentStorage:!1,enableMediaPreviewOnMobile:!1,enableMessageSendSuccessProcessing:!1,enableMessageSendE2EPerfTracking:!1,enableMiniContextMenu:!1,enableMobileSearchInConversation:!1,enableModeratedGroupChats:!1,enableMoreReactionsMsgMenu:!1,enableMoreReactionsMenuSelector:!1,enableNewCallsTabPanel:!1,enableNewCallsCreditOffers:!1,enableNewConversationCreation:!1,enableNewEmoticonBackgroundRenderLogic:!1,enableNoNetworkInfoOnSendingMessage:!1,enableNotificationPeriods:!1,enableNotificationPrompt:!1,enableOpenLocationCardInFindPanel:!1,enableOverflowMenuGrid:!1,enableParsingHtmlMessages:!1,enablePDFThumbnailPreview:!1,enablePesGifPagination:!1,enablePesGifs:!1,enableQuotingHtmlMessages:!1,enableReactionAnnouncements:!0,enableReactionBarExperienceFixInNarrowView:!1,enableReactionsInBottomSheet:!1,enableReadReceipts:!0,enableRecycleListInitialRenderLimit:!1,enableRecyclerListViewGlobal:!1,enableRecyclerListViewUseCases:[],enableRefreshedLandingPage:!1,enableReportMessage:!0,enableReportAnonymously:!1,enableReportExternallyWithUrl:!1,enableReplyMessageUnifiedUI:!1,enableRichTextPastingAndroid:!1,enableSafeDomainRendering:!1,enableSecureThreadsInsecureStorage:!1,enableMyBot:!1,enableShowFloatTooltips:!1,enableMyBotQRDialog:!1,enableSmallEmoticonsInDesktopPicker:!1,enableSmallEmoticonsInMobilePicker:!1,enableSmsFingerprintId:!1,enableSMSErrorCodeElaboration:!1,enableStackedMediaAlbum:!1,funReactionsPack:["cry","sarcastic","surprised","cwl","heart","yes","rock","facepalm","porgsurprised","monkey","star","no","bow","gran","dance","party","highfive","ttm"],enableSwiftNodeReplyMessageUnifiedUI:!1,enableSystemMessageJoinCallButton:!1,enableToneRewrite:!1,enableUpdateEarliestMessageTimeFromSync:!1,enableV2PropMapping:!0,enableMobileDownloadNotifications:!1,enableTryOpenConversationUrlWithInstalledEdge:!1,enableVerticalEmoticonPicker:!1,globalMessageSearch:{initialPageSize:30,nextPageSize:20},hideHeaderInLandscape:!1,hideConversationsListSectionHeaders:!1,hidePrivateConversationsOnOtherEndpoints:!1,hideReportedMessages:!1,imageCaching:{cachedStatusMaxAge:3600,prefetchRetryCount:3,prefetchRetryCountNoConnection:1,prefetchRetryLongDelay:3e5,prefetchRetryShortDelay:1e3,queryCacheInFlightLimit:32},inConversationMessageSearch:{initialPageSize:40,nextPageSize:0},limitForFilePicker:20,locationSendTimeout:3e3,locationMaxAgeInMinutes:20,myBotId:"28:e7a9407c-2467-4a04-9546-70081f4ea80d",magicBotId:"28:cf0e6215-34fe-409b-9e4b-135d7f3aa13b",magicBotCampaignId:"SkypeEngagementSystem-Test",magicBotWaitListRefreshIntervalInMinutes:720,magicBotCampaignImageUrl:"https://secure.skypeassets.com/content/dam/engagement/bingchatinskype/b4fb5623-5b04-4cd1-8929-27aaccc5e1eb_copilot-2.png",magicBotApi:"https://open-ai-connect.skype.com/api/",magicBotFallbackLocationApi:"https://www.bing.com/shop/",magicBotSuggestionshDebounceTimeout:5e3,magicBotToolboxTooltipOnInteractionCount:2,magicBotTelemetrySamplingOverride:!1,maxMessagesToLoadFromDBForMediaSearch:25,maxNumberEmoticonsPerMessage:50,maxNumberOfCustomReactions:60,maxRecentConversationsToShow:50,magicBotPreviewLink:"https://go.skype.com/bingchatlearnmore",mediaBarMenuOrder:i.MediaBarDefaultOrder,mediaBarNewItems:[],messageHintsPriority:[],messageReactionsHintsMaxShownTimes:0,messageReadDelay:750,messageReadEventTimeout:5e3,messageStreamFontSizeMultiplier:{smaller:.7,small:.85,normal:1,large:1.2,larger:1.45},messageStreamStoreCacheMaxMessageCount:300,messageStreamStoreCacheSize:10,modernizeSearchPanel:!1,nativeEmoticonCacheLoggingSampleRate:0,nativeEmoticonCacheTelemetrySampleRate:0,nonBlockingUploadsFromSize:3e6,noneGroupSendCallback:3e3,notifyForAdditionalReactions:!1,numberOfIconsInMediaBar:7,oldContentPanelForceHideTimeout:1e3,onlySendWithBackgroundSession:!1,openYouTubeLinksInPip:!1,openLinkWithEdgeSidebar:!1,overflowMenuOrder:i.OverflowMenuDefaultOrder,pesGifItemsLimit:20,pesPickerCategoryOrder:i.PesPickerCategoryDefaultOrder,personalizationPickerCategoryOrder:i.PersonalizationPickerCategoryDefaultOrder,pictureSendTimeout:5e3,pollCardSendTimeout:3e3,pollWinnerEmoticonName:"party",pollNoVotesEmoticonName:"tumbleweed",reactionPacks:[["cry","sarcastic","surprised","cwl","heart","yes"],["rock","facepalm","porgsurprised","monkey","star","no"],["bow","gran","dance","party","highfive","ttm"]],readReceiptsAllowedLieTime:60,recentConversationsIncrementor:20,reportExternallyPath:"https://report.skype.com/rac?report_context=%reportContext%&reporter_mri=%reporterMri%&spammer_mri=%spammerMri%%messageRelatedDetails%",reportExternallyMessageDetailsPath:"&messages_hash=%messagesHash%&conversation_id=%conversationId%&message_time=%messageTime%",retryAddMembersToThread:!1,safeDisplayDomains:["bot-framework.azureedge.net","avatar.skype.com","api.skype.com","botavatar.azureedge.net"],scdPingIntervalInDays:14,sendingLieMaxDuration:3e3,setOverflowMenuButtonToPlainColor:!1,showMediaPickerInRightControlsForMobile:!1,showNewChatFirstInPlusMenu:!1,singleEmoticonSize:2,skypetokenAllowedDomains:["avatar.skype.com"],smsFingerprintIdTag:"systemId",smsErrorCode:void 0,startBotIds:["28:f53e4183-c614-4b16-87bb-707c1def4034","28:35fc925b-a175-4e75-9463-82df3c540f2f"],staticSuggestions:[],staticSuggestionsDelay:2e3,stickerSendTimeout:3e3,stickersNotSupportedFallbackUrl:"https://go.skype.com/you.received.sticker",swiftCardSendTimeout:3e3,syncSettings:{skipConvTypeCast:!0,skipConvTypeSmsMms:!0,skipCastSync:!0,skipSmsMmsSync:!0,forceOnUiStarted:!1,forceOnForeground:!1},systemSendTimeout:3e3,tenorBaseUrl:"https://api.tenor.com/v1/",tenorApiKey:"NO_API_KEY",tenorSearchEndpoint:"search",tenorTrendingEndpoint:"trending",tenorContentFilter:"high",textSendTimeout:3e3,textSendTimeoutFineGrainedConfig:{enabled:!1,timeoutInMs:6e4},toneRewriteApi:"https://www.bing.com/api/swiftkey/v1",toneRewriteLoadingCaptionIntervalMs:3e3,toneRewriteTones:["professional","casual","funny","social post","witty","polite"],toneRewriteQueryMaxChars:200,toneRewriteQueryMaxWords:50,toneRewriteQueryMinChars:2,toneRewriteQueryMinWords:3,transformCorruptedMessages:!0,ued:{enabled:!1,consumeEvents:!1,isExclusive:!1,enablePush:!1},unsafeFiles:[],uriFileSendTimeout:3e3,useColorfulSendButton:!1,useNewVideoMessageIcon:!1,usePesForBingGifSuggestions:!1,videoSendTimeout:5e3};t.default=o},404547:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(331654)),a=i.__importDefault(s(819059)),l=i.__importDefault(s(55331)),d=i.__importStar(s(516778)),c=s(662783),u=i.__importDefault(s(974634)),h=i.__importStar(s(397691)),p=i.__importDefault(s(659938)),g=i.__importDefault(s(150343)),m=s(619429),S=i.__importDefault(s(859545)),_=i.__importStar(s(964647)),f=i.__importDefault(s(304623)),y=s(335103),v=s(135356),C=s(856339),T=i.__importDefault(s(780389)),M=i.__importStar(s(100166)),b=s(627414),I=i.__importDefault(s(614595)),w=i.__importStar(s(44717)),P=i.__importStar(s(473483)),k=i.__importDefault(s(615364)),A=s(815146),x=i.__importStar(s(85385)),D=i.__importDefault(s(652032)),R=i.__importDefault(s(114818)),L=i.__importDefault(s(510335)),B=s(786531),F=i.__importDefault(s(857981)),N=i.__importDefault(s(363091)),E=i.__importDefault(s(163374)),O=i.__importDefault(s(471782)),U=i.__importStar(s(506082)),V=i.__importDefault(s(782829)),H=i.__importDefault(s(902530)),j=s(370073),z=i.__importStar(s(446574)),W=i.__importDefault(s(655192)),G=s(331079),K=i.__importStar(s(442699)),q=i.__importDefault(s(601274)),Q=i.__importStar(s(517518)),X=i.__importStar(s(222420)),$=s(506240),J=s(593501),Y=s(534579),Z=i.__importStar(s(596467)),ee=i.__importStar(s(669431)),te={statusCode:0,statusText:"",errorMessage:"Endpoint does not exist.",headers:{},url:"",method:"",canceled:!1,timedOut:!1,body:void 0},se={statusCode:0,statusText:"",errorMessage:"Endpoing presence doc not published",headers:{},url:"",method:"",canceled:!1,timedOut:!1,body:void 0};t.default=new class{constructor(){this._requestingWakelock=!1,this._releasingWakelock=!1,this._restLongPollResult=v.LongPollResult.Success,this._restConnectionState=v.SubscriptionState.None,this.subscriptionStateChanged=new u.default,this.disconnected=new u.default,this.reconnected=new u.default,this._wasConnected=!1,this.controlMessagesReceived=new u.default,this.incomingCallMessageReceived=new u.default,this.userPresenceReceived=new u.default,this.extendedPresenceDocReceived=new u.default,this.inviteFreeQuarantineTriggered=new u.default,this._trackedConvPropSets={},this._trackedThreadPropSets={},this.releasingWakelock=new u.default,this._longRunningRequests={},this._loggingOut=!1,this._subscriptions=[],this._restConnectionStateChanged=(e,t)=>{this._restConnectionState=e,this._restLongPollResult=t,this._connectionStateChanged()},this.feedInitialEndpointUrl=e=>{this._initialEndpointUrl=e},this.handleLocationChange=(e,t,s)=>{t===A.ChatServiceConnectionType.MessagingApi?this._messagingRestClient.handleLocationChange(e):this._restTransport.handleLocationChange(e,s)},this._handleInviteFreeQuarantine=()=>{this.inviteFreeQuarantineTriggered.fire()},this.handleTrouterEvent=(e,t,s)=>{const i=A.MessageOrigin.Trouter,r=W.default.parseJsonErrorable(e);n.isError(r)?x.error(A.LogTraceArea.ChatService,"Failed to parse Trouter event."):(r.cv=t,r.messageStoreUsed=s,(0,$.transformEvent)(r)?this._handleEvents([r],i):x.warn(A.LogTraceArea.ChatService,`Event will be ignored - cv: ${r.cv}, event: ${o.pii.Omit(JSON.stringify(r))}`))},this._handleEvents=(e,t=A.MessageOrigin.LongPoll)=>{const s={},i=[],r={};n.each(e,(e=>{switch(x.log(A.LogTraceArea.ChatService,`handle ${A.MessageOrigin[t]} Event: ${e.resourceType} ${e.cv?" , MS-CV: "+e.cv:""}`),e.resourceType){case"CustomUserProperties":n.extend(s,e.resource);break;case"ConversationUpdate":{const t=e.resource;x.log(A.LogTraceArea.ChatService,`Conv: ${o.pii.Mri(t.id)}, Version: ${t.version}`),f.default.queueConvUpdate(t)}break;case"ThreadUpdate":{const t=e.resource;x.log(A.LogTraceArea.ChatService,`Conv: ${o.pii.Mri(t.id)}, Version: ${t.version}`),f.default.queueThreadUpdate(t)}break;case"NewMessage":case"MessageUpdate":const a=(0,Y.tweakMagicBotOneOnOneMessage)(e.resource);if(0===a.messagetype.indexOf("Control/")||(0,J.isMagicBotOneOnOneControlMessage)(a))i.push(a);else if(0===a.messagetype.indexOf("ThreadActivity/MemberConsumptionHorizonUpdate")){const e=w.getParsedConversationId(a);if(!e){x.log(A.LogTraceArea.ReadReceipts,"Failed to parse conversationLink: "+o.pii.Omit(a.conversationLink));break}const t=W.default.parseJsonErrorable(a.content);if(n.isError(t)){x.log(A.LogTraceArea.ReadReceipts,"Failed to parse consumptionHorizon: "+o.pii.Omit(a.content));break}const s={id:t.user,consumptionhorizon:t.consumptionhorizon};x.log(A.LogTraceArea.ReadReceipts,"Event: Message: Conv: "+o.pii.Mri(e)+", Id: "+a.id+", content: "+o.pii.Omit(a.content)+", consumptionHorizon: "+t.consumptionhorizon),f.default.queueMemberConsumptionHorizonUpdate(e,s)}else if(0===a.messagetype.indexOf("Signal/Flamingo"))x.log(A.LogTraceArea.ChatService,"Received Signal/Flamingo message, ID: "+a.id),this.incomingCallMessageReceived.fire(a);else{const s=w.getParsedConversationId(a);if(!s){x.log(A.LogTraceArea.ReadReceipts,"Failed to parse conversationLink: "+o.pii.Omit(a.conversationLink));break}const i=w.getCreatorMriForMessageFromLink(a.from),r=a.clientmessageid;x.log(A.LogTraceArea.ChatService,"Event: Message: Conv: "+o.pii.Mri(s)+", Id: "+a.id+", CMID: "+r+", CorrelationId:"+_.getCorrelationIdFromMessageParts(i,s,r)+", type: "+e.resourceType+", time: "+e.time);const l=Date.now().valueOf();x.log(A.LogTraceArea.LowBandwidth,"<NFR> || Receive_IM || Latency_Timestamp || "+l+" || Latency || "+(l-n.toNumber(a.id)));const d={message:a,origin:t,isOtherEndpointActive:!1,correlationVector:e.cv,messageStoreUsed:e.messageStoreUsed};f.default.queueMessagesForConversation(s,[d])}break;case"EndpointPresence":case"ReadReceipt":break;case"UserPresence":const l=e.resource,d=l.selfLink.split("/")[5];r[d]=l;break;default:x.warn(A.LogTraceArea.ChatService,`${t} Unhandled Event, MS-CV: ${e.cv}`,e)}})),n.isEmpty(s)||f.default.queuePartialUserPropertySet(s),i.length>0&&this.controlMessagesReceived.fire(i),n.isEmpty(r)||this.userPresenceReceived.fire(r),f.default.processQueuedBundle()},this._updateMyPropertiesRequestSuccessHandler=e=>(e&&(this._lastUserPropertiesUpdateTime=Date.now()),f.default.setNewUserPropertySet(e).then((()=>{if(this._fetchAndUpdatePropertiesDeferred){const e=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,e.resolve(void 0)}})).catch((e=>{if(this._fetchAndUpdatePropertiesDeferred){const t=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,t.reject(e)}}))),this._updateMyPropertiesRequestFailureHandler=e=>{if(!this._fetchPropertiesPromise&&this._fetchAndUpdatePropertiesDeferred){const t=this._fetchAndUpdatePropertiesDeferred;this._fetchAndUpdatePropertiesDeferred=void 0,t.reject(e)}},this.errorHandler=new y.ChatServiceErrorHandler(this.handleLocationChange,this._handleInviteFreeQuarantine),this._restTransport=new O.default(this,this._handleEvents,this._restConnectionStateChanged,this.errorHandler),this._messagingRestClient=new F.default(this.errorHandler),z.RegisterStartupable(this,"ChatService",[f.default,D.default,E.default,H.default,Q.default,V.default]),L.default.registerForLogout(this,"ChatService")}startup(){this._initialEndpointUrl&&V.default.setRestEndpointUrl(this._initialEndpointUrl);const e=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig;e.enabled&&e.isExclusive||V.default.endpointInfoChanged.subscribe(((e,t)=>{this._restTransport.endpointInfoUpdated(e,t),this._pushSubscription&&this._pushSubscription.endpointInfoUpdated(e,t),I.default.endpointInfoUpdated(e,t),this._checkTransportState();const s=t.id,i=e.id;i&&s&&!w.areEndpointIdsEqual(i,s)&&X.getDurableEndpointId().then((e=>{(w.areEndpointIdsEqual(e,i)||w.areEndpointIdsEqual(e,s))&&(x.log(A.LogTraceArea.ChatService,"Deleting old endpoint "+s),this.serviceDeleteEndpoint(s).then((()=>{x.log(A.LogTraceArea.ChatService,"Endpoint ID "+s+" successfully deleted")})).catch((e=>{x.log(A.LogTraceArea.ChatService,"Failed to delete endpoint ID "+s+": "+W.default.errorAsString(e))})))}))})),this._restTransport.startup(),this._messagingRestClient.startup(),this._pushSubscription=new T.default(this,"Push",X.calculatePnhInterestedResources());const t=f.default.conversationsUpdated.subscribe((e=>{this._receivedConversationUpdates(e)}));this._subscriptions.push(t);const s=f.default.getRawConversationMetaMemoryCache();this._receivedConversationUpdates(s),this._connectivitySubToken=E.default.subscribe((()=>{E.default.getPassedConnectivityCheck()?(E.default.isNetworkingAvailable()&&(x.log(A.LogTraceArea.ChatService,"ReportedConnectivityStore reported connectivity, kicking transports"),this._resetBackoffTimers()),this._checkTransportState()):x.log(A.LogTraceArea.ChatService,"ReportedConnectivityStore reported captive portal, no action")}));const i=p.default.subscribeForChanges("ChatService",(e=>{e===d.Types.AppActivationState.Active&&(x.log(A.LogTraceArea.ChatService,"ActivationState reported active, kicking transports"),this._resetBackoffTimers()),this._checkTransportState()}));this._subscriptions.push(i);const o=r.default.onResume.subscribe((e=>{x.log(A.LogTraceArea.ChatService,"Resuming from sleep, kicking transports causeId: "+e),this._resetBackoffTimers(),this._checkTransportState()}));return this._subscriptions.push(o),this._appConfigSubToken=g.default.subscribe((()=>{this._checkIsConnectedStatus(),this._checkTransportState(),this._updateUedPushPropIfNeeded()})),this._capabilitiesSubToken=S.default.subscribe((()=>{this._checkTransportState()})),this._tokenStoreSubToken=Q.default.subscribe((()=>{this._checkTransportState()}),Q.TriggerKeys.SkypeTokenKey),this._stateStoreSubToken=U.default.subscribe((()=>{this._checkTransportState()}),U.TriggerKeys.UIDisplayedKey),this._checkTransportState(),this._updateUedPushPropIfNeeded(),h.Resolved()}getRestTransport(){return this._restTransport}serviceSetActiveEndpointTimeout(e,t){const s=(new C.ChatServicePresenceRequestFactory).setActiveEndpointTimeout(e,t);return this.performRequest(s).then(n.noop)}_resetBackoffTimers(){this._restTransport.resetBackoffTimers(),this._messagingRestClient.resetBackoffTimers()}_checkTransportState(){if(!this._loggingOut&&Q.default.hasUsableSkypeToken()&&U.default.isUIDisplayed())d.App.getActivationState(),d.Types.AppActivationState.Active,this._restTransport.setConnectionEnabled(!0,"Foreground");else{const e=this._loggingOut?"logout":Q.default.hasUsableSkypeToken()?U.default.isUIDisplayed()?"test":"no UI":"no token";if(this._restTransport.setConnectionEnabled(!1,e),this._loggingOut)return}if(this.isConnected())this._wakelockId||this._requestingWakelock||(this._requestingWakelock=!0,x.log(A.LogTraceArea.ChatService,"Requesting Wakelock"),a.default.requestMaxTime("Transport").finally((()=>{this._requestingWakelock=!1})).then((e=>{x.log(A.LogTraceArea.ChatService,"Got Wakelock: "+e),this._wakelockId&&(x.error(A.LogTraceArea.ChatService,"Got wakelock when already had wakelock: "+this._wakelockId),a.default.release(this._wakelockId,"Transport:duplicate")),this._wakelockId=e,this._checkTransportState()}),(e=>{x.error(A.LogTraceArea.ChatService,"Failed to get wakelock - "+(e?W.default.errorAsString(e):""))})));else if(this._wakelockId&&!this._releasingWakelock){this._releasingWakelock=!0;const e=g.default.getConfigSettingsNoSubscription().chat.backgroundReleaseWakeLockTime,t=this._wakelockId;x.log(A.LogTraceArea.ChatService,"Releasing Wakelock: "+t),this.releasingWakelock.fire(),l.default.setTimeout((()=>{a.default.release(t,"Transport").finally((()=>{this._releasingWakelock=!1})).then((()=>{x.log(A.LogTraceArea.ChatService,"Released Wakelock: "+t),this._wakelockId===t?this._wakelockId=void 0:x.error(A.LogTraceArea.ChatService,"Released wakelock when we had a different wakelock: "+this._wakelockId),this._checkTransportState()}),(e=>{x.error(A.LogTraceArea.ChatService,"Failed to release wakelock ("+t+") - "+W.default.errorAsString(e))}))}),e)}}pokeLongRunningRequest(e){this._longRunningRequests[e]||(this._longRunningRequests[e]=!0,this._checkTransportState())}removeLongRunningRequest(e){this._longRunningRequests[e]&&(delete this._longRunningRequests[e],this._checkTransportState())}logout(e,t,s){this._loggingOut=!0,this._restTransport.logout(),f.default.setBundleProcessingEnabled(!1);const i=V.default.getEndpointId();V.default.logout(e);const o=H.default.deleteIds({chatServiceSessionInfo:!0},!s),r=[],a=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return!i||a.enabled&&a.isExclusive||r.push(this.serviceDeleteEndpoint(i)),o.always((()=>h.raceTimer(h.all(r),500))).then(n.noop)}_receivedConversationUpdates(e){n.each(n.toArray(e),(e=>{e&&(n.each(e.conv.getPendingConvPropLies(),((t,s)=>{this._trackConversationPropertySet(e.conv.id,s,t.value,t.additionalParams)})),n.each(e.conv.getPendingThreadPropLies(),((t,s)=>{this._isThreadIconLie(t,s)||j.ThreadPropLiesAllowed[s]!==j.PropLieType.Local&&this._trackThreadPropertySet(e.conv.id,s,t.value)})))}))}_isThreadIconLie(e,t){return e.value&&n.startsWith(e.value.toString(),"blob:")&&t===w.ThreadProps.Picture}_connectionStateChanged(){x.log(A.LogTraceArea.ChatService,"Connection State Changed: REST: "+v.SubscriptionState[this._restConnectionState]+", LP result: "+v.LongPollResult[this._restLongPollResult]),this._checkIsConnectedStatus(),this.subscriptionStateChanged.fire()}_checkIsConnectedStatus(){const e=this.isConnected();this._wasConnected!==e&&(x.log(A.LogTraceArea.ChatService,"IsConnected changed: "+this._wasConnected+" -> "+e),this._wasConnected=e,e?this.reconnected.fire():this.disconnected.fire())}_updateUedPushPropIfNeeded(){var e;const t=null===(e=g.default.getS4LMessagingFeaturesNoSubscription().ued)||void 0===e?void 0:e.enablePush;t!==this._prevUedPushFlag&&(this._prevUedPushFlag=t,this.serviceSetUedPush(t))}isConnected(){return this._restConnectionState===v.SubscriptionState.CreatedActive}getSubscriptionState(){return this._restConnectionState}getLongPollResult(){return this._restLongPollResult}debug_getCurrentCloudUrlV1(){return this._restTransport.debug_getCurrentCloudUrl()}debug_getCurrentCloudUrlV2(){return this._messagingRestClient.debug_getCurrentCloudUrl()}restoreEndpoints(e,t){return I.default.restoreEndpoint(e,this._restTransport,t)}fetchMemberConsumptionHorizon(e){this._serviceGetMemberConsumptionHorizons(e).then((t=>{x.log(A.LogTraceArea.ReadReceipts,"Fetched consumption horizons for: "+o.pii.Mri(e)+", content: ",n.map(t,(e=>({id:o.pii.Mri(e.id),consumptionhorizon:e.consumptionhorizon})))),n.each(t,(t=>{f.default.queueMemberConsumptionHorizonUpdate(e,t)})),f.default.processQueuedBundle()})).catch((t=>{x.warn(A.LogTraceArea.ChatService,"Failed to fetch consumption horizons for: "+o.pii.Mri(e)+" Error code: "+t.errorCode+" Message: "+t.errorMessage)}))}setConversationProperty(e,t,s,i){return x.log(A.LogTraceArea.ChatService,"setConversationProperty "+(j.ConvPropLiesAllowed[t]?"with":"without")+" lie: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))+(i?", params: "+JSON.stringify(i):"")),j.ConvPropLiesAllowed[t]?f.default.setConversationPropertyLie(e,t,s,i).then((()=>{const o=f.default.getLastConversationPropertyLie(e,t);return!o||o.value===s&&o.additionalParams===i||(s=o.value,i=o.additionalParams,x.log(A.LogTraceArea.ChatService,"setConversationProperty: lie updated to last know value")),this._trackConversationPropertySet(e,t,s,i)})):this._serviceSetConversationProperty(e,t,s,i)}_trackConversationPropertySet(e,t,s,i){const n=this._trackedConvPropSets[e]||(this._trackedConvPropSets[e]={});let r=n[t];return r&&(0,R.default)(r.value,s)&&(0,R.default)(r.additionalParams,i)||(r=n[t]={value:s,additionalParams:i,defer:h.Defer(),inFlight:!1},x.log(A.LogTraceArea.ChatService,"Tracking Conversation Property Set: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))+(i?", params: "+JSON.stringify(i):"")),this._checkOnConvPropSet(e,t,s,i)),r.defer.promise()}_checkOnConvPropSet(e,t,s,i){const n=this._trackedConvPropSets[e];if(!n)return;const r=n[t];r&&(0,R.default)(r.value,s)&&(0,R.default)(r.additionalParams,i)&&(r.inFlight||(r.waitUntil&&r.waitUntil>Date.now()?q.default.setExpiration((()=>{this._checkOnConvPropSet(e,t,s,i)}),r.waitUntil):(x.log(A.LogTraceArea.ChatService,"Setting Conversation Prop on Server: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))+(i?", params: "+o.pii.Omit(JSON.stringify(i)):"")),r.inFlight=!0,this._serviceSetConversationProperty(e,t,s,i).then((()=>{f.default.confirmConversationPropertyLie(e,t,s,i).then((()=>{x.log(A.LogTraceArea.ChatService,"Confirmed Setting Conversation Prop on Server: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))+(i?", params: "+o.pii.Omit(JSON.stringify(i)):"")),r.defer.resolve(void 0)})).always((()=>{delete n[t]}))}),(o=>{if(0===o.statusCode)return r.inFlight=!1,r.retryTimer?r.retryTimer.calculateNext():r.retryTimer=this._createNewPropExponentialTime(),r.waitUntil=Date.now()+r.retryTimer.getTime(),void this._checkOnConvPropSet(e,t,s,i);f.default.revertConversationPropertyLie(e,t,s,i).then((()=>{r.defer.reject("Error changing conversation property: "+W.default.errorAsString(o))})).always((()=>{delete n[t]}))})))))}_createNewPropExponentialTime(){return new c.ExponentialTime(1e3,6e4)}setThreadProperty(e,t,s){return x.log(A.LogTraceArea.ChatService,"setThreadProperty "+(j.ThreadPropLiesAllowed[t]?"with":"without")+" lie: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))),j.ThreadPropLiesAllowed[t]?f.default.setThreadPropertyLie(e,t,s).then((()=>this._trackThreadPropertySet(e,t,s))):this._serviceSetThreadProperty(e,t,s)}_trackThreadPropertySet(e,t,s){const i=this._trackedThreadPropSets[e]||(this._trackedThreadPropSets[e]={});let n=i[t];return n&&(0,R.default)(n.value,s)||(n=i[t]={value:s,defer:h.Defer(),inFlight:!1},x.log(A.LogTraceArea.ChatService,"Tracking Thread Property Set: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))),this._checkOnThreadPropSet(e,t,s)),n.defer.promise()}_checkOnThreadPropSet(e,t,s){const i=this._trackedThreadPropSets[e];if(!i)return;const n=i[t];n&&(0,R.default)(n.value,s)&&(n.inFlight||(n.waitUntil&&n.waitUntil>Date.now()?q.default.setExpiration((()=>{this._checkOnThreadPropSet(e,t,s)}),n.waitUntil):(x.log(A.LogTraceArea.ChatService,"Setting Thread Prop on Server: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))),n.inFlight=!0,this._serviceSetThreadProperty(e,t,s).then((()=>{f.default.confirmThreadPropertyLie(e,t,s).then((()=>{x.log(A.LogTraceArea.ChatService,"Confirmed setting Thread Prop on Server: "+o.pii.Mri(e)+": "+t+" => "+o.pii.Omit(JSON.stringify(s))),n.defer.resolve(void 0)})).always((()=>{delete i[t]}))}),(o=>{if(0===o.statusCode)return n.inFlight=!1,n.retryTimer?n.retryTimer.calculateNext():n.retryTimer=this._createNewPropExponentialTime(),n.waitUntil=Date.now()+n.retryTimer.getTime(),void this._checkOnThreadPropSet(e,t,s);f.default.revertThreadPropertyLie(e,t,s).then((()=>{n.defer.reject("Error changing Thread property: "+W.default.errorAsString(o))})).always((()=>{delete i[t]}))})))))}setMessageProperty(e,t,s,i,o){return(e.properties||{})[t]===s?h.Resolved():f.default.setMessagePropertyLie(e.conversationId,e.cuid,t,i).then((()=>this.serviceSetMessageProperty(e.conversationId,e.getServerIdForPropertyChanges(),t,s,o).catch((s=>(f.default.revertMessagePropertyLie(e.conversationId,e.cuid,t,i),h.Rejected("Error changing message property: "+W.default.errorAsString(s)))))))}setConversationIconLie(e,t){const s=w.ThreadProps.Picture;f.default.setThreadPropertyLie(e,s,t).then((()=>f.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&f.default.revertThreadPropertyLie(e,s,t)))}setConversationLiveStateLie(e,t){const s=w.ThreadProps.LiveState;f.default.setThreadPropertyLie(e,s,t).then((()=>f.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&f.default.revertThreadPropertyLie(e,s,t)))}setConversationLeaveTimeLie(e,t){const s=w.ThreadProps.LastLeaveAt;f.default.setThreadPropertyLie(e,s,t).then((()=>f.default.confirmThreadPropertyLie(e,s,t)),(i=>i&&f.default.revertThreadPropertyLie(e,s,t)))}setFakeConsumptionHorizonBeforeFirstEverMessage(e,t,s=!1){if(t.isEphemeral())return void x.warn(A.LogTraceArea.ConsumptionHorizon,"setFakeConsumptionHorizonBeforeFirstEverMessage "+o.pii.Mri(e)+" tried to set a consumption horizon on an ephemeral message "+t.getOriginalClientMessageId());const i=t.getOriginalServerId(),r=t.getCHID();if(!r||!i)return void x.warn(A.LogTraceArea.ConsumptionHorizon,"setFakeConsumptionHorizonBeforeFirstEverMessage "+o.pii.Mri(e)+" tried to set a consumption horizon on an incomplete message: clientMessageId:"+t.getOriginalClientMessageId()+", serverId: "+i+", chid: "+r);const a=(n.toNumber(i)-1).toString(),l=(n.toNumber(r)-1).toString(),d=w.getConsumptionHorizonForMessageAndCHID(a,l);this.setConsumptionHorizon(e,d,s)}setConsumptionHorizonToMessage(e,t,s=!1){const i=t.getConsumptionHorizonString();i&&this.setConsumptionHorizon(e,i,s)}setConsumptionHorizon(e,t,s=!1){const i=f.default.getConversationMetaFromMemoryCache(e);x.log(A.LogTraceArea.ConsumptionHorizon,"setConsumptionHorizon "+o.pii.Mri(e)+" to "+t+" canBeOlder="+s+" oldCH="+(i?i.conv.getConsumptionHorizon():"unknown"));const n={bookmark:s?"true":"false","x-ecs-etag":g.default.getCachedEcsConfigEtag()};return this.setConversationProperty(e,w.ConversationProps.ConsumptionHorizon,t,n)}setConversationAlerts(e,t){return this.setConversationProperty(e,w.ConversationProps.Alerts,t?"true":"false")}removeConversationIcon(e){return this.setThreadProperty(e,w.ThreadProps.Picture,null)}setThemeColor(e,t){return this.setConversationProperty(e,w.ConversationProps.Color,P.serializeColorInfo(t))}setJoinEnabled(e,t){return this.setThreadProperty(e,w.ThreadProps.JoinEnabled,t?"true":"false")}setMagicBotEnabled(e,t){return this.setThreadProperty(e,w.ThreadProps.MagicBotEnabled,t?"true":"false")}setBannedSkypeIds(e,t){const s=n.map(t,(e=>w.sanitizeMri(e,w.Namespaces.SkypeId)));return this.setThreadProperty(e,w.ThreadProps.BannedUserList,n.join(s,","))}discloseHistory(e,t){return this.setThreadProperty(e,w.ThreadProps.HistoryDisclosed,t?"true":"false")}setDisableGuestJoin(e,t){return this.setThreadProperty(e,w.ThreadProps.DisableAnonymousJoin,t?"true":"false")}setModeratedThreadProperty(e,t){return this.setThreadProperty(e,w.ThreadProps.ModeratedThread,t?"true":"false")}renameConversation(e,t){return this.setThreadProperty(e,w.ThreadProps.TopicName,t)}setConversationSubscription(e,t){return this.setConversationProperty(e,w.ConversationProps.Subscription,t).then((()=>this.setConversationAlerts(e,t!==w.SubscriptionTypes.Muted)))}setConversationArchived(e,t){return this.setConversationProperty(e,w.ConversationProps.Archived,t?Date.now():"")}setConversationPinned(e,t){return this.setConversationProperty(e,w.ConversationProps.Pinned,t?"true":"false")}setConversationFavorite(e,t){const s=this.setConversationProperty(e,w.ConversationProps.Favorite,t?"true":"false");return h.all([this.setConversationPinned(e,t),s]).then(n.noop)}setConversationStatus(e,t){return this.setConversationProperty(e,w.ConversationProps.ConversationStatus,A.ConversationStatus[t])}setConversationBlocked(e,t){return this.setConversationProperty(e,w.ConversationProps.ConversationBlocked,t?"true":"false")}setTranslationState(e,t){return w.isThread(e)?this.setThreadProperty(e,w.ThreadProps.Translated,m.TranslationState[t]):this.setConversationProperty(e,w.ConversationProps.Translated,m.TranslationState[t])}setMessageTranslationLocale(e,t){const s=!t||n.isEmpty(t)?null:t;return w.isThread(e)?this.setThreadProperty(e,w.ThreadProps.MessageTranslationLocale,s):this.setConversationProperty(e,w.ConversationProps.MessageTranslationLocale,s)}fetchAndUpdateMyProperties(e){if(this._fetchAndUpdatePropertiesDeferred)return this._fetchAndUpdatePropertiesDeferred.promise();if(!e&&this._lastUserPropertiesUpdateTime){const e=g.default.getConfigSettingsNoSubscription().chat.userPropertiesExpirationTime;if(e&&Date.now()<this._lastUserPropertiesUpdateTime+e)return h.Resolved()}const t=h.Defer();return this._fetchAndUpdatePropertiesDeferred=t,this._fetchPropertiesPromise=this.serviceGetMyProperties(),this._fetchPropertiesPromise.finally((()=>{this._fetchPropertiesPromise=void 0})).then(this._updateMyPropertiesRequestSuccessHandler,this._updateMyPropertiesRequestFailureHandler),t.promise()}getChatServiceErrorResponseMetadata(e){return y.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(e)}performRequest(e,t){if(e.requiresEndpoint&&!V.default.endpointExists())return x.log(A.LogTraceArea.ChatService,"Trying to perform a request: "+e.scenario+" that requires an endpoint , when the endpoint does not exist!"),x.track(new K.DevDebug("CSRequestNoEndpoint",e.scenario)),h.Rejected(te);if(g.default.getConfigSettingsNoSubscription().endpointPresence.ensurePresencePublished&&e.requirePresenceDocPublished&&!V.default.presenceDocPublished())return x.log(A.LogTraceArea.ChatService,"Trying to perform a request: "+e.scenario+" that requires presence doc to be published"),x.track(new K.DevDebug("CSRequestPresenceDocNotPublished",e.scenario)),h.Rejected(se);const s={telemetryAttributes:t,scenario:e.scenario,mriForTelemetry:e.mriForTelemetry,isLoginRequest:e.isLogin,isSkypetokenOnlyRequest:e.isSkypetokenOnlyRequest},i=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig,o=i&&i.enabled;return o&&e.conversationId&&(s.counterPartyMri=this._getP2PThreadCounterPartyMri(e.conversationId)),e.isV1OnlyRequest||!o?this._restTransport.performRequest(e,s):this._messagingRestClient.performRequest(e,s)}performPostingServiceMessageRequest(e,t){const s={source:b.PostMessageToConversationSource[t]};return this.performRequest(e,s)}performRequestBackground(e,t,s,i){const o={};s.endpointId&&(o.endpointId=s.endpointId);const r=n.extend(o,i),a=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig,l=a&&a.enabled;return l&&s.conversationId&&(o.counterPartyMri=this._getP2PThreadCounterPartyMri(s.conversationId)),s.isV1OnlyRequest||!l?this._restTransport.performRequestBackground(e,t,s,r):this._messagingRestClient.performRequestBackground(e,t,s,r)}serviceGetMyProperties(){return this.performRequest(M.getMyProperties()).then((e=>e.body))}serviceSetMyProperty(e,t){return this.performRequest(M.setMyProperty(e,t)).then(n.noop)}serviceSetUedPush(e){return this.serviceSetMyProperty(w.ServerUserProps.UedPushEnabled,e?"True":"false")}serviceSetMyUserRing(e){return this.performRequest(M.setMyUserRing(e)).then(n.noop)}serviceEnumerateEndpoints(){return this.performRequest(M.enumerateEndpoints()).then((e=>({endpoints:e.body,tcid:w.getTcidDataFromServerMessageResponse(e)})))}serviceCreateEndpoint(e){return this.performRequest(M.createEndpoint(e)).then((e=>{const t={CSScenario:M.CSRequestScenarios.createEndpoint};return{endpointId:this._getLastResourceIdFromServerMessageResponse(e,t),tcid:w.getTcidDataFromServerMessageResponse(e)}}))}serviceUpdateEndpoint(e,t){return this.performRequest(M.updateEndpoint(e,t)).then((e=>({endpoint:e.body,tcid:w.getTcidDataFromServerMessageResponse(e)})))}serviceDeleteEndpoint(e){return this.performRequest(M.deleteEndpoint(e)).then(n.noop)}serviceClearEndpoint(e){return this.performRequest(M.clearEndpoint(e)).then(n.noop)}servicePublishEndpointPresence(e,t){return this.performRequest(M.publishEndpointPresence(e,t)).then(n.noop)}serviceGetEndpointPresenceDoc(e){return this.performRequest(M.getEndpointPresenceDoc(e)).then((e=>e.body))}serviceCreateSubscription(e,t){return this.performRequest(M.createSubscription(e,t)).then((t=>{const s=w.getTcidDataFromServerMessageResponse(t),i={CSScenario:M.CSRequestScenarios.updateSubscription,Epid:e},o=this._getLastResourceIdFromServerMessageResponse(t,i);return o?{subscriptionId:o,tcid:s}:h.Rejected(t)}))}serviceDeleteSubscription(e,t){return this.performRequest(M.deleteSubscription(e,t)).then(n.noop)}serviceUpdateSubscriptionProperty(e,t,s,i){return this.performRequest(M.updateSubscriptionProperty(e,t,s,i)).then((e=>w.getTcidDataFromServerMessageResponse(e)))}servicePollSubscription(e,t,s){return this.performRequest(M.pollSubscription(e,t,s)).then((e=>e.body))}serviceGetMyConversations(e="All",t=1,s,i=100){return this.performRequest(M.getMyConversations(e,t,s,i)).then((e=>({body:e.body,headers:e.headers})))}_serviceSetConversationProperty(e,t,s,i){var o;(null===(o=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===o?void 0:o.enabled)&&(t=w.ConversationPropsMapping.mapToV2(t));const r=n.map(i,((e,t)=>"&"+encodeURIComponent(t)+"="+encodeURIComponent(e))).join(""),a="v1/users/ME/conversations/"+encodeURIComponent(e)+"/properties?name="+encodeURIComponent(t)+r;return this.performRequest({method:"PUT",path:a,passedData:{[t]:s},scenario:"setConversationProperty",conversationId:e}).then(n.noop)}serviceGetConversationMessages(e,t=1,s,i=100,o){let n="v1/users/ME/conversations/"+encodeURIComponent(e)+"/messages?view="+encodeURIComponent(M.calcMessagesViewParam());return n+="&pageSize="+Math.min(i,100),s&&(n+="&syncState="+encodeURIComponent(s)),n+="&startTime="+t,o&&o<=G.NumberShim.MAX_SAFE_INTEGER&&(n+="&endTime="+o),this.performRequest({method:"GET",path:n,scenario:"getConversationMessages",conversationId:e}).then((e=>e.body))}serviceGetConversationMessagesEarlierThanTime(e,t=1,s,i=100,o=Number.MAX_VALUE){return this._serviceLoopConversationMessagesEarlierThanTime(e,t,o,s,i,[],0)}_serviceLoopConversationMessagesEarlierThanTime(e,t,s,i,o,r,a){return this.serviceGetConversationMessages(e,t,i,o,s).then((i=>{i.messages.length&&r.push(i.messages);const l=a+i.messages.length;if(l<o&&i._metadata.backwardLink){const a=i.messages.length?Number(n.minBy(i.messages,(e=>e.version)).version):s,d=w.decodeSyncState(i._metadata.syncState);return this._serviceLoopConversationMessagesEarlierThanTime(e,t,a,d,o,r,l)}return{messages:n.flatten(r),_metadata:i._metadata}}))}serviceGetConversationMessagesLaterThanTime(e,t,s,i,o=100,n=!1){return n?this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,void 0,i,o):this._serviceLoopConversationMessagesLaterThanTime(e,t,s,i,o,[],0)}_serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,i,o,r=100){return this.serviceGetConversationMessages(e,t,o,r,s).then((a=>{if(a.messages.length){if(a.messages.length<r&&!a._metadata.backwardLink)return a;{const i=Math.min(Number(n.maxBy(a.messages,(e=>e.version)).version)+2,s),l=Math.floor((i+t)/2),d=s;return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,l,d,o,r)}}if(a._metadata.backwardLink){const o=w.decodeSyncState(a._metadata.syncState);return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,i,o,r)}if(i){const t=s,n=i<=G.NumberShim.MAX_SAFE_INTEGER?Math.floor((i+s)/2):i;return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,n,i,o,r)}return a}))}_serviceLoopConversationMessagesLaterThanTime(e,t,s,i,o,r,a){return this._serviceBinarySearchGetConversationMessagesLaterThanTime(e,t,s,void 0,i,o).then((i=>{if(i.messages.length){r.push(i.messages);const l=a+i.messages.length;if(l<o){const a=i.messages.length?Number(n.maxBy(i.messages,(e=>e.id)).id):t,d=w.decodeSyncState(i._metadata.syncState);return this._serviceLoopConversationMessagesLaterThanTime(e,a,s,d,o,r,l)}}return{messages:n.flatten(r),_metadata:i._metadata}}))}serviceGetConversationMessage(e,t){return this.performRequest(M.getConversationMessage(e,t)).then((e=>e.body))}servicePostMessageToConversation(e,t,s,i=M.CSRequestScenarios.postMessageToConversation){const o={source:b.PostMessageToConversationSource[s]},n=M.postMessageToConversation(e,t,i);return this.performRequest(n,o).then((e=>{const t={CSScenario:M.CSRequestScenarios.postMessageToConversation},s=this._getLastResourceIdFromServerMessageResponse(e,t);return Object.assign(Object.assign({},e),{body:{serverId:s}})}))}_isThreadCreationEnabledForMri(e){const t=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return!!(null==t?void 0:t.enabled)&&(t.enableP2PThreadsWithUsers&&w.isSkypeIdMri(e)||t.enableP2PThreadsWithBots&&w.isBotChat(e)||t.enableP2PThreadsWithPstn&&w.isPhoneMri(e)||t.enableP2PThreadsWithS4B&&w.isS4BBridgeMri(e))}_doesConversationExistOnV1(e){if(!(0,k.default)().isConversationKnownNoSubscription(e))return!1;const t=(0,k.default)().getConversation(e);return t&&!t.isFake}createThreadIfNeeded(e,t){const s=this._isThreadCreationEnabledForMri(e);if(x.log(A.LogTraceArea.ChatService,`[p2p chats] Is 1-1 thread creation enabled for conversation ${o.pii.Omit(e)}: ${s}`),!s)return h.Resolved({threadId:e});const i=(0,k.default)().getV2ThreadMapping().getThreadIdByMri(e);if(x.log(A.LogTraceArea.ChatService,`[p2p chats] Does 1-1 thread exist on v2: ${Boolean(i)}`),i){const t=(0,k.default)().getConversation(i);return t&&Z.isCorruptedThread(t)?(x.log(A.LogTraceArea.ChatService,`[p2p chats] Conv ${o.pii.Omit(t.id)} has isMigrated=false, this is unexpected for p2p threads.`),h.Resolved({threadId:e})):h.Resolved({threadId:i})}const n=this._doesConversationExistOnV1(e);x.log(A.LogTraceArea.ChatService,`[p2p chats] Does 1-1 chat exist on v1: ${n}`);const{enableP2PThreadsForExistingChats:r}=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return n&&!r?h.Resolved({threadId:e}):(x.log(A.LogTraceArea.ChatService,"[p2p chats] Creating a new 1-1 thread"),this._createP2PThread(e,t))}_createP2PThread(e,t){const s=N.default.getSkypeMri(),i=b.CreateThreadSource.CreateP2PChat,n={[s]:G.ThreadMemberAccessType.Admin,[e]:G.ThreadMemberAccessType.Admin};return this.serviceCreateThread(n,undefined,i,{},t,!0).then((e=>f.default.waitForJoinedKnowledgeOfConversation(e.threadId))).then((e=>(x.log(A.LogTraceArea.ChatService,`[p2p chats] Created p2p chat: ${o.pii.Omit(e.id)}`),{threadId:e.id})))}_getP2PThreadCounterPartyMri(e){var t;if(!(null===(t=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===t?void 0:t.enabled))return;const s=(0,k.default)().getConversation(e);if(s)return s.isV2OneToOneThread()?(0,k.default)().getV2ThreadMapping().getMriByThreadId(e):void 0;x.log(A.LogTraceArea.ChatService,`[p2p chats] Conversation not found in conversations store: ${e}`)}serviceDeleteMessage(e,t){const s=M.deleteMessage(e,t);return this.performRequest(s)}serviceSetMessageProperty(e,t,s,i,o=!1){const r={propKey:s},a=M.setMessageProperty(e,t,s,i,o);return this.performRequest(a,r).then(n.noop)}serviceSetMessagePropertyBackground(e,t,s,i,o,n,r=!1,a){return this.performRequestBackground(e,t,M.setMessageProperty(s,i,o,n,r),a)}_getAddMembersPartialFailures(e){return 207===e.statusCode&&e.body&&e.body.multipleStatus?n.filter(e.body.multipleStatus,(e=>0!==e.statusCode)):[]}serviceCreateThread(e,t,s,i={[w.ThreadProps.HistoryDisclosed]:"true",[w.ThreadProps.JoinEnabled]:"true"},o,r=!1){const a=g.default.getS4LMessagingFeaturesNoSubscription().retryAddMembersToThread,l={source:b.CreateThreadSource[s]};i[w.ThreadProps.ThreadType]&&(l[w.ThreadProps.ThreadType]=i[w.ThreadProps.ThreadType]),i[w.ThreadProps.Source]&&(l.Partner=i[w.ThreadProps.Source]);const d=M.createThread(e,t,r,i);return o&&(d.scenario=o),this.performRequest(d,l).then((t=>{const s=w.asSkypeThreadId(this._getLastResourceIdFromServerMessageResponse(t,{CSScenario:"createThread"})),i=this._getAddMembersPartialFailures(t);if(a&&i.length){const e={};return n.each(i,(t=>e[t.id]=G.ThreadMemberAccessType.User)),this.serviceAddMembersToThread(s,e,!1).then((e=>({threadId:s,failedMembers:e})))}let o;if(2===Object.keys(e).length){o=Object.keys(e).find((e=>e!==N.default.getSkypeMri()))}return x.track(new ee.ChatServiceConversationCreated(s,o)),{threadId:s,failedMembers:i}}))}serviceGetThread(e){return this.performRequest(M.getThread(e)).then((e=>e.body))}_serviceSetThreadProperty(e,t,s){var i;if(!w.isThread(e))return h.Rejected("ID passed isn't a thread");(null===(i=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===i?void 0:i.enabled)&&(t=w.ThreadPropsMapping.mapToV2(t));const o={propKey:t},r=M.setThreadProperty(e,t,s);return this.performRequest(r,o).then(n.noop)}serviceAddMemberToThread(e,t,s,i=!0){const o={source:b.AddMemberToThreadSource[s]},n=M.addMemberToThread(e,t,i);return this.performRequest(n,o).then((()=>{x.track(new B.AddContactsTelemetry(s,e))}),(o=>i?this.serviceAddMemberToThread(e,t,s,!1):h.Rejected(o)))}serviceAddMembersToThread(e,t,s=!1,i,o){const r=M.addMembersToThread(e,t);return o&&(r.scenario=o),this.performRequest(r,i).then((t=>{const i=this._getAddMembersPartialFailures(t);if(s&&i.length){const t={};return n.each(i,(e=>t[e.id]=G.ThreadMemberAccessType.User)),this.serviceAddMembersToThread(e,t,!1)}return i}))}serviceRemoveMemberFromThread(e,t,s){const i={source:b.RemoveMemberFromThreadSource[s]},o=M.removeMemberFromThread(e,t);return this.performRequest(o,i).then((()=>{if(N.default.isMyMri(t)){const t=(0,k.default)().getConversation(e);if(t){const s=t.getLastJoinAt();s&&this.setConversationLeaveTimeLie(e,String(s+1))}}})).catch((e=>404===e.statusCode&&e.errorCode&&736===e.errorCode?h.Resolved():h.Rejected(e)))}serviceDeleteConversation(e,t){var s;if(null===(s=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===s?void 0:s.enabled)return this.setConversationProperty(e,w.ConversationPropsV2.DeleteTimestamp,Date.now());const i={source:b.DeleteConversationSource[t]},o=M.deleteConversation(e);return this.performRequest(o,i).then(n.noop)}serviceInvokeAgent(e,t,s,i,o){const n={source:b.InvokeAgentSource[i]},r=M.invokeAgentRequest(e,t,s,o);return this.performRequest(r,n).then((e=>e.body))}serviceGetWebhookUrl(e,t){const s=M.getWebhookUrl(e,t);return this.performRequest(s).then((e=>e.body))}_serviceGetMemberConsumptionHorizons(e){return this.performRequest(M.getMemberConsumptionHorizons(e)).then((e=>e.body.consumptionhorizons))}_getLastResourceIdFromServerMessageResponse(e,t){const s=e.headers.location;if(!s){const s=w.getTcidDataFromServerMessageResponse(e),i=Object.assign({CSContextId:s.contextId,CSDate:s.date,StatusCode:e.statusCode},t);return x.track(new K.DevDebug("Empty location header",JSON.stringify(i))),""}return decodeURIComponent(n.last(s.split("/")))}serviceSendE2eeInvite(e,t,s,i){const o=M.e2eeInvite(s,e,t);return this.performRequest(o)}serviceSendE2eeReject(e){const t=M.e2eeReject(e);return this.performRequest(t)}serviceSendE2eeAccept(e,t,s){const i=M.e2eeAccept(s,e,t);return this.performRequest(i)}serviceSendE2eeConfirm(e){const t=M.e2eeConfirm(e);return this.performRequest(t)}serviceDeleteConnectors(e,t){const s=M.deleteConnectors(e,t);return this.performRequest(s).then(n.noop)}test_getRestTransport(){return this._restTransport}test_getTransport(){const e=g.default.getConfigSettingsNoSubscription().chat.msgApiConfig;return e&&e.enabled?this._messagingRestClient:this._restTransport}test_setPushSubscription(e){this._pushSubscription=e}test_reset(){this._loggingOut=!1,V.default.test_reset();const e=this._subscriptions;this._subscriptions=[],n.each(e,(e=>e.unsubscribe())),this._tokenStoreSubToken&&(Q.default.unsubscribe(this._tokenStoreSubToken),this._tokenStoreSubToken=void 0),this._appConfigSubToken&&(g.default.unsubscribe(this._appConfigSubToken),this._appConfigSubToken=void 0),this._capabilitiesSubToken&&(S.default.unsubscribe(this._capabilitiesSubToken),this._capabilitiesSubToken=void 0),this._connectivitySubToken&&(E.default.unsubscribe(this._connectivitySubToken),this._connectivitySubToken=void 0),this._stateStoreSubToken&&(U.default.unsubscribe(this._stateStoreSubToken),this._stateStoreSubToken=void 0)}}},304623:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(819059)),a=i.__importDefault(s(974634)),l=i.__importStar(s(397691)),d=i.__importStar(s(516778)),c=i.__importDefault(s(23551)),u=i.__importStar(s(485467)),h=s(22336),p=i.__importDefault(s(150343)),g=i.__importDefault(s(97572)),m=i.__importStar(s(964647)),S=i.__importStar(s(971988)),_=s(135356),f=i.__importStar(s(669431)),y=i.__importStar(s(44717)),v=i.__importStar(s(434343)),C=i.__importStar(s(583506)),T=i.__importStar(s(214189)),M=i.__importDefault(s(727433)),b=s(94618),I=i.__importDefault(s(379878)),w=s(224958),P=i.__importDefault(s(36615)),k=s(815146),A=s(120695),x=i.__importDefault(s(637961)),D=i.__importStar(s(85385)),R=i.__importDefault(s(652032)),L=i.__importDefault(s(114818)),B=i.__importDefault(s(463789)),F=i.__importDefault(s(221837)),N=i.__importDefault(s(201721)),E=i.__importDefault(s(363091)),O=i.__importStar(s(370073)),U=i.__importDefault(s(997226)),V=i.__importStar(s(446574)),H=i.__importDefault(s(655192)),j=s(331079),z=i.__importDefault(s(220534)),W=i.__importDefault(s(760989));t.default=new class{constructor(){this._lastFetchedTimestamp=j.NumberShim.MAX_SAFE_INTEGER,this._userProperties={},this.userPropertiesChanged=new a.default,this.messagesProcessed=new a.default,this.messagesProcessedWithBundleInfo=new a.default,this.conversationsUpdated=new a.default,this.alertsUpdated=new a.default,this.decryptionFailed=new a.default,this.callLogsReceived=new a.default,this.guestNameUpdate=new a.default,this._conversationMetaMap={},this._conversationMetaLoadPromises={},this._conversationIdsToEnsureLoaded=[],this._waitingForJoinedKnowledgeList={},this._waitingForJoinedAndRealKnowledgeList={},this._bundleProcessingEnabled=!0,this._alertsTrackedByAlertsStore=[],this._ensureConversationsLoadedDebounced=n.debounce((()=>{const e=this._conversationIdsToEnsureLoaded;this._conversationIdsToEnsureLoaded=[],D.log(k.LogTraceArea.GenericUnsafe,"Ensuring Conversations Loaded: "+n.join(n.map(e,(e=>o.pii.Mri(e))),", ")),this.getConversationMetasAsync(e).then((()=>{if(this._ensureConvLoadedDefer){const e=this._ensureConvLoadedDefer;this._ensureConvLoadedDefer=void 0,e.resolve(void 0)}}))})),this._setUpPendingBundle(),V.RegisterStartupable(this,"ChatServiceDataService",[g.default,P.default,R.default])}startup(){return this._userProperties=R.default.getData(v.InternalKeys.Prefs)||{},l.Resolved()}test_flushConversationCache(){this.conversationsUpdated.dispose(),this.messagesProcessed.dispose(),this.messagesProcessedWithBundleInfo.dispose(),this._loadingNeedsSyncConversationsPromise=void 0,this._conversationMetaMap={}}loadAndCacheAllNonHighlightsConversations(){const e=Date.now()-T.ConversationHistoryTimeSpanImportant;let t;return this._loadAndCacheAllConversationsPromise||(this._loadAndCacheAllConversationsPromise=v.default.getAllNonHighlightConversationMetas().then((t=>{this._lastFetchedTimestamp=Math.min(e,this._lastFetchedTimestamp),this._cacheLoadedConvs(t)})),t=this._loadAndCacheAllConversationsPromise,this._loadAndCacheAllConversationsPromise.finally((()=>{this._loadAndCacheAllConversationsPromise=void 0}))),t||this._loadAndCacheAllConversationsPromise}recalculateCountsForConversations(e){return n.each(e,(e=>{this._queueRecalculateConversationCounts(e)})),this.processQueuedBundle()}loadAndCacheNeedsSyncConversations(){return this._loadingNeedsSyncConversationsPromise||(this._loadingNeedsSyncConversationsPromise=v.default.getNeedsSyncConversations().then((e=>{this._cacheLoadedConvs(e)}))),this._loadingNeedsSyncConversationsPromise}setAlertsTrackedByAlertsStore(e){this._alertsTrackedByAlertsStore=e}_cacheLoadedConvs(e){e=n.compact(e),n.isEmpty(e)||(n.remove(e,(e=>e.conv&&e.conv.id in this._conversationMetaMap)),n.each(e,(e=>{this._conversationMetaMap[e.conv.id]=e})),this.conversationsUpdated.fire(e))}_checkJoinedConvUpdates(e){n.each(e,(e=>{if(!e)return;const t=this._waitingForJoinedKnowledgeList[e.conv.id];t&&e&&e.conv.isCurrentUserMember()&&(delete this._waitingForJoinedKnowledgeList[e.conv.id],t.resolve(e.conv));const s=this._waitingForJoinedAndRealKnowledgeList[e.conv.id];s&&e&&e.conv.isCurrentUserMember()&&!e.conv.isFake&&(delete this._waitingForJoinedAndRealKnowledgeList[e.conv.id],s.resolve(e.conv))}))}createFakeConversation(e){if(this._conversationMetaMap[e])return;const t=T.default.newFakeEmptyMeta(e);this._conversationMetaMap[e]=t,this.conversationsUpdated.fire([t])}ensureConversationLoadedOrFaked(e){return this.getConversationMetaAsync(e).then((t=>!t&&(this.createFakeConversation(e),!0)))}ensureConversationLoaded(e){return this.getConversationMetaFromMemoryCache(e)?l.Resolved():(this._conversationIdsToEnsureLoaded.push(e),this._ensureConvLoadedDefer||(this._ensureConvLoadedDefer=l.Defer()),this._ensureConversationsLoadedDebounced(),this._ensureConvLoadedDefer.promise())}waitForJoinedKnowledgeOfConversation(e){return this.getConversationMetaAsync(e).then((t=>t&&t.conv.isCurrentUserMember()?l.Resolved(t.conv):(this._waitingForJoinedKnowledgeList[e]||(this._waitingForJoinedKnowledgeList[e]=l.Defer()),this._waitingForJoinedKnowledgeList[e].promise())))}waitForJoinedKnowledgeOfRealConversation(e){return this.getConversationMetaAsync(e).then((t=>t&&t.conv.isCurrentUserMember()&&!t.conv.isFake?l.Resolved(t.conv):(this._waitingForJoinedAndRealKnowledgeList[e]||(this._waitingForJoinedAndRealKnowledgeList[e]=l.Defer()),this._waitingForJoinedAndRealKnowledgeList[e].promise())))}getUserProperties(){return this._userProperties}getUserProperty(e){return this._userProperties[e]}hasFetchedUserPropertiesAtLeastOnce(){return!n.isEmpty(this._userProperties)}getConversationMetaAsync(e,t=!0){return this.getConversationMetasAsync([e],t).then((t=>t[e]))}getConversationMetasAsync(e,t=!0){const s=n.uniq(n.filter(e,(e=>!(e in this._conversationMetaMap)))),[i,o]=n.partition(s,(e=>t&&this._conversationMetaLoadPromises[e])),r=n.map(i,(e=>{const t=this._conversationMetaLoadPromises[e];if(t)return t.then(n.noop);o.push(e)}));if(o.length>0){const e=v.default.getConversationMetas(o).then((e=>{const t=n.values(e);return this._cacheLoadedConvs(t),this._checkJoinedConvUpdates(t),n.each(o,(e=>{e in this._conversationMetaMap||(this._conversationMetaMap[e]=void 0);this._conversationMetaLoadPromises[e]&&delete this._conversationMetaLoadPromises[e]})),e}));n.each(o,(t=>{t in this._conversationMetaMap||(this._conversationMetaLoadPromises[t]=e.then((e=>e[t])))})),r.push(e.then(n.noop))}return l.all(r).then((()=>{const t={};return n.each(e,(e=>{t[e]=this._conversationMetaMap[e]})),t}))}getLastFetchedTimestamp(){return this._lastFetchedTimestamp}getConversationMetaFromMemoryCache(e){return this._conversationMetaMap[e]}getRawConversationMetaMemoryCache(){return this._conversationMetaMap}setBundleProcessingEnabled(e){this._bundleProcessingEnabled=e}processQueuedBundle(){return this._processBundle()}queueConvUpdate(e){const t=this._getPendingBundleConv(e.id);(!t.conversationUpdate||t.conversationUpdate.version<e.version)&&(t.conversationUpdate=e)}queueThreadUpdate(e){const t=this._getPendingBundleConv(e.id);(!t.threadUpdate||t.threadUpdate.version<e.version)&&(t.threadUpdate=e)}queueConvSyncInfoChange(e,t,s=!1){this._getPendingBundleConv(e).syncInfo=t}queueMessagesForConversation(e,t){const s=this._getPendingBundleConv(e);s.messageActions||(s.messageActions={}),n.each(t,(t=>{this._addServerMessageToPendingBundle(e,t)}))}queueMessagesForConversationAndWait(e,t){return this.queueMessagesForConversation(e,t),this._processBundle()}queuePartialUserPropertySet(e){let t;t=this._pendingBundle&&this._pendingBundle.newUserPropSet?this._pendingBundle.newUserPropSet:this._processingBundle&&this._processingBundle.newUserPropSet?this._processingBundle.newUserPropSet:this._userProperties;const s=n.extend({},t,e);(0,L.default)(this._pendingBundle.newUserPropSet||this._userProperties,s)||(this._pendingBundle.newUserPropSet=s)}queueMemberConsumptionHorizonUpdate(e,t){const s=this._getPendingBundleConv(e);s.memberConsumptionHorizons||(s.memberConsumptionHorizons={}),s.memberConsumptionHorizons[t.id]=t}setConvSyncInfo(e,t){return this.queueConvSyncInfoChange(e,t),this._processBundle()}setNewUserPropertySet(e){return e?(delete e.lastActivityAt,delete e.lastActivityAt2,(0,L.default)(this._pendingBundle.newUserPropSet||this._userProperties,e)?l.Resolved():(this._pendingBundle.newUserPropSet=e,this._processBundle())):l.Resolved()}setConvListSyncInfo(e){return this._pendingBundle.convListSyncInfo=e,this._processBundle()}brickConversation(e){return this._getPendingBundleConv(e).brickConversation=!0,this._processBundle()}setConversationPropertyLie(e,t,s,i){const o=this._getPendingBundleConv(e),n={value:s,additionalParams:i};return o.conversationPropLieInfo?o.conversationPropLieInfo[t]=n:o.conversationPropLieInfo={[t]:n},this._processBundle()}confirmConversationPropertyLie(e,t,s,i){const o=this._getPendingBundleConv(e),n={value:s,additionalParams:i};return o.conversationPropLieConfirms?o.conversationPropLieConfirms[t]=n:o.conversationPropLieConfirms={[t]:n},this._processBundle()}revertConversationPropertyLie(e,t,s,i){const o=this._getPendingBundleConv(e),n={value:s,additionalParams:i};return o.conversationPropLieReverts?o.conversationPropLieReverts[t]=n:o.conversationPropLieReverts={[t]:n},this._processBundle()}getLastConversationPropertyLie(e,t){const s=this._getPendingBundleConv(e);return s.conversationPropLieInfo&&s.conversationPropLieInfo[t]}setThreadPropertyLie(e,t,s){const i=this._getPendingBundleConv(e),o={value:s};return i.threadPropLieInfo?i.threadPropLieInfo[t]=o:i.threadPropLieInfo={[t]:o},this._processBundle()}confirmThreadPropertyLie(e,t,s){const i=this._getPendingBundleConv(e),o={value:s};return i.threadPropLieConfirms?i.threadPropLieConfirms[t]=o:i.threadPropLieConfirms={[t]:o},this._processBundle()}revertThreadPropertyLie(e,t,s){const i=this._getPendingBundleConv(e),o={value:s};return i.threadPropLieReverts?i.threadPropLieReverts[t]=o:i.threadPropLieReverts={[t]:o},this._processBundle()}processPushNotificationMessage(e,t,s,i){const o={message:e,origin:s,isOtherEndpointActive:!e.isactive,correlationVector:i,messageStoreUsed:!1};return this._addServerMessageToPendingBundle(t,o),this._processBundle()}processPushNotificationConsumptionHorizon(e,t,s){if(this._conversationMetaMap[e]&&s&&s<=this._conversationMetaMap[e].conv.convViewVersion)return l.Resolved();const i=this._getPendingBundleConv(e);return i.consumptionHorizonVersion&&s&&s<=i.consumptionHorizonVersion?l.Resolved():(i.consumptionHorizonUpdate=t,i.consumptionHorizonVersion=s,this._processBundle())}confirmMessageSend(e,t,s,i,n){if(D.log(k.LogTraceArea.ChatService,"confirmMessageSend: convId:"+o.pii.Mri(e)+" cuid:"+t+" serverId:"+s+" clientMessageId:"+i),p.default.getS4LMessagingFeaturesNoSubscription().enableMessageSendSuccessProcessing){c.default.dismissSpinner(t);const s=m.getCorrelationIdFromMessageParts(y.skypeIdToMri(E.default.getSkypeId()),e,i);s&&F.default.notifyMessageAcknowledgedByCS(i,s)}const r=this._getPendingBundleConvMessageActions(e,t);return r.confirmSendId=s,r.confirmSendCMID=i,r.confirmSendVersion=n,this._processBundle()}rejectMessageSend(e,t,s,i){const n=y.getCuidForMessage(t);D.log(k.LogTraceArea.ChatService,"rejectMessageSend: convId:"+o.pii.Mri(e)+" cuid:"+n);const r=this._getPendingBundleConvMessageActions(e,n);return r.rejectSendCMID=t.clientmessageid,r.rejectSendTimestamp=s,r.rejectSendRetryInfo=i,this._processBundle()}applyMessageLie(e,t){return F.default.notifyMessageLieReachedChatServiceDataService(t.clientmessageid),this._applyMessageLie(e,t)}applyMessageLieWithPropertyLie(e,t,s,i){return this._applyMessageLie(e,t,s,i)}markMessageAsReported(e,t,s){return this._getPendingBundleConvMessageActions(e,t).isReported=s,this._processBundle()}applyMessageLieAndNotifyPrematurely(e,t,s){F.default.notifyMessageLieReachedChatServiceDataService(s.clientmessageid);const i={message:U.default.fromFirstLie(s,e,E.default.getSkypeMri(),t),reactionUpdates:_.EmptyReactionsUpdate,isOtherEndpointActive:!1,details:[{origin:k.MessageOrigin.LocalChange,clientMessageId:s.clientmessageid,correlationVector:void 0,messageStoreUsed:void 0}]};return D.log(k.LogTraceArea.ChatService,`Sending premature message lie. ConvId: ${o.pii.Mri(e)} clientmessageid: ${s.clientmessageid}`),this.messagesProcessed.fire([i.message]),this.messagesProcessedWithBundleInfo.fire([i]),this._applyMessageLie(e,s)}_applyMessageLie(e,t,s,i){const n=y.getCuidForMessage(t);D.log(k.LogTraceArea.ChatService,"applyMessageLie: convId:"+o.pii.Mri(e)+" cuid:"+n);const r=this._getPendingBundleConvMessageActions(e,n);return r.applyMessageLies?r.applyMessageLies.push(t):r.applyMessageLies=[t],s?this.setMessagePropertyLie(e,n,s,i):this._processBundle()}revertMessageLie(e,t,s){const i=this._getPendingBundleConvMessageActions(e,t);return i.revertMessageLies?i.revertMessageLies.push(s):i.revertMessageLies=[s],this._processBundle()}setMessagePropertyLie(e,t,s,i){const o=this._getPendingBundleConvMessageActions(e,t);return o.setPropDeltas?o.setPropDeltas.push({key:s,value:i}):o.setPropDeltas=[{key:s,value:i}],this._processBundle()}revertMessagePropertyLie(e,t,s,i){const o=this._getPendingBundleConvMessageActions(e,t);return o.revertPropDeltas?o.revertPropDeltas.push({key:s,value:i}):o.revertPropDeltas=[{key:s,value:i}],this._processBundle()}setFileEncryptionKeys(e,t,s){return this._getPendingBundleConvMessageActions(e,t).fileEncryptionKeys=s,this._processBundle()}_setUpPendingBundle(){this._pendingBundle={}}_getPendingBundleConv(e){this._pendingBundle.convs||(this._pendingBundle.convs={});let t=this._pendingBundle.convs[e];return t||(t={},this._pendingBundle.convs[e]=t),t}_getPendingBundleConvMessageActions(e,t){const s=this._getPendingBundleConv(e);s.messageActions||(s.messageActions={});let i=s.messageActions[t];return i||(i={},s.messageActions[t]=i),i}_addServerMessageToPendingBundle(e,t){const s=y.getCuidForMessage(t.message);if(y.isEncryptedThread(e)){const e=t.message;if(I.default.shouldIgnoreMessage(e))return}const i=this._getPendingBundleConvMessageActions(e,s);i.serverMessages?i.serverMessages.push(t):i.serverMessages=[t]}_queueRecalculateConversationCounts(e){this._getPendingBundleConv(e).recalculateCounts=!0}test_processServerMessage(e,t=k.MessageOrigin.LongPoll,s=void 0){const i=n.isArray(e)?e:[e];return n.each(i,(e=>{const i=y.getParsedConversationId(e);if(i){const o={message:e,origin:t,isOtherEndpointActive:!1,messageStoreUsed:s};this._addServerMessageToPendingBundle(i,o)}})),this._processBundle()}_preProcessBundle(e){const t=[];return n.each(e.convs,((e,s)=>{if(y.isAllGlobalClearMri(s)||!y.isEncryptedThread(s))return;const i=[];n.each(e.messageActions,((e,t)=>{const o=[],r=[];n.each(e.serverMessages,(e=>{const i=e.message.messagetype,a=i===S.MessageTypes.EncryptedText,d=i===S.MessageTypes.EncryptedMedia,c=i===S.MessageTypes.EncryptedCall;if(!a&&!d&&!c)return;const u=e.message,h=u.fromdeviceid,p=u.content,g=u.encryptedkey,m=c?S.MessageTypes.Call:i;if(h&&g){let i,a;o.push(this.getConversationMetaAsync(s).then((o=>o?(i=o.conv.getLastEncryptionHandshakeChange(),a=Number(u.id),i&&a&&i>a?(r.push(e),void D.log(k.LogTraceArea.E2EEncryption,`Discarding CMID(${u.clientmessageid}), it's from older secure session`)):v.default.getMessageByCuid(o.conv.id,t).then((s=>{const i=y.getCreatorMriForMessageFromLink(u.from),a=E.default.isMyMri(i);if(s){if(a)return void(e.message=Object.assign(Object.assign({},e.message),{content:s.content,messagetype:m}));if(s.isKnownServerMessageVersion(e.message.version))return D.log(k.LogTraceArea.E2EEncryption,`Ignoring already known server message version ${e.message.version} for CMID ${u.clientmessageid}`),void r.push(e)}else if(a)return D.log(k.LogTraceArea.E2EEncryption,`Ignoring own server message with unprocessed lie, CMID ${u.clientmessageid}`),void r.push(e);return M.default.decryptMessageForConv(o.conv,p,g).then((s=>{let i;if(d){const e=H.default.parseJsonErrorable(s);if(n.isError(e))return l.Rejected(e);i=e.originalContent,this.setFileEncryptionKeys(o.conv.id,t,e)}else i=s;e.message=Object.assign(Object.assign({},e.message),{content:i,messagetype:m})}))}))):l.Rejected(`No meta found for conv id ${s}`))).catch((t=>{if(I.default.isFatalDecryptionError(t)){const e=H.default.errorAsString(t);D.error(k.LogTraceArea.E2EEncryption,`Failed to decrypt message, CMID(${u.clientmessageid}, arrival ts ${a}, handshake ts ${i}),`,e),D.track(new b.E2eeDecryptionFailure(e)),this.decryptionFailed.fire(s)}else D.log(k.LogTraceArea.E2EEncryption,`Non-fatal error decrypting message, probably a dupe, CMID(${u.clientmessageid}),`,H.default.errorAsString(t));r.push(e)})))}})),i.push(l.all(o).then((()=>{e.serverMessages=n.difference(e.serverMessages,r),n.isEmpty(e.serverMessages)&&delete e.serverMessages})))})),t.push(l.all(i).then((()=>{e.messageActions&&(e.messageActions=n.omitBy(e.messageActions,(e=>n.isEmpty(e))))})))})),l.all(t).then(n.noop)}_processBundle(){if(this._processingBundle||!this._bundleProcessingEnabled)return this._pendingBundle.deferral||(this._pendingBundle.deferral=l.Defer()),this._pendingBundle.deferral.promise();if(n.isEmpty(this._pendingBundle.convs)&&!this._pendingBundle.convListSyncInfo&&!this._pendingBundle.newUserPropSet)return l.Resolved();this._processingBundle=this._pendingBundle;const e=this._processingBundle;e.deferral||(e.deferral=l.Defer());const t=e.deferral;this._setUpPendingBundle();const s=Date.now();return D.log(k.LogTraceArea.ChatService,"Starting ProcessBundle: "+n.keys(e.convs).length+" Convs"+(e.convListSyncInfo?", ConvListSyncInfo":"")+(e.newUserPropSet?", NewUserPropSet":"")),x.default.indicateBusyOperation(),this._preProcessBundle(e).then((()=>{const i=Date.now(),a=[],c=[],M=new B.default((e=>e.guid)),b=[],I=[],P=this.getConversationMetasAsync(n.keys(e.convs)),x=n.map(e.convs,((e,t)=>{if(y.isAllGlobalClearMri(t))return;if(!y.isMri(t))return void D.error(k.LogTraceArea.ChatService,"Attempted to process a conversation with an invalid mri: "+o.pii.Mri(t));D.log(k.LogTraceArea.ChatService,"Processing ConvBundle: "+o.pii.Mri(t)+": "+n.compact([e.messageActions?n.keys(e.messageActions).length+" MessageActions":void 0,e.conversationUpdate?"ConversationUpdate":void 0,e.conversationPropLieInfo?n.keys(e.conversationPropLieInfo).length+" ConversationPropLieInfo":void 0,e.conversationPropLieConfirms?n.keys(e.conversationPropLieConfirms).length+" ConversationPropLieConfirms":void 0,e.conversationPropLieReverts?n.keys(e.conversationPropLieReverts).length+" ConversationPropLieReverts":void 0,e.threadUpdate?"ThreadUpdate":void 0,e.threadPropLieInfo?n.keys(e.threadPropLieInfo).length+" ThreadPropLieInfo":void 0,e.threadPropLieConfirms?n.keys(e.threadPropLieConfirms).length+" ThreadPropLieConfirms":void 0,e.threadPropLieReverts?n.keys(e.threadPropLieReverts).length+" ThreadPropLieReverts":void 0,e.syncInfo?"SyncInfo":void 0,e.brickConversation?"Brick":void 0,e.recalculateCounts?"RecalculateCounts":void 0]).join(", "));const s=P.then((e=>e[t])),i=e.conversationUpdate&&e.conversationUpdate.lastMessage&&y.getCuidForMessage(e.conversationUpdate.lastMessage),r=n.keys(e.messageActions);i&&!n.includes(r,i)&&r.push(i);const d=r.length?v.default.getMessagesByCuid(t,r):void 0,g=e.messageActions?v.default.getAlertsForConversation(t):void 0;return l.all([s,d,g]).then((([s,r,d])=>{let g=s?s.conv:void 0,P=!1,x=!1;const R=n.keyBy(r,(e=>e.cuid));let L=!!d;d&&M.trackOriginalItems(d.concat(this._alertsTrackedByAlertsStore));const B=[];let F=e.syncInfo||(s?s.syncInfo:void 0),V=!1;const H=e.conversationUpdate;if(H){let e;H.properties&&H.properties[y.ConversationProps.ConsumptionHorizon]&&D.log(k.LogTraceArea.ConsumptionHorizon,"Merging CH: "+H.properties[y.ConversationProps.ConsumptionHorizon]),i&&(e=R[i]),g?(D.log(k.LogTraceArea.ChatService,"Merging Conversation: "+o.pii.Mri(H.id)+", Version: "+g.convViewVersion+" => "+H.version+(g.isThread()?", ThreadVersion: "+g.getThreadProperty(y.ThreadProps.ThreadDetailsVersion)+" => "+H.threadProperties[y.ThreadProps.ThreadDetailsVersion]:"")),g=g.mergeConversationUpdate(H,e)):(D.log(k.LogTraceArea.ChatService,"New Conversation from ConvView: "+o.pii.Mri(H.id)+": Version: "+H.version+(y.isThread(H.id)?", ThreadVersion: "+H.threadProperties[y.ThreadProps.ThreadDetailsVersion]:"")),g=O.default.fromRawConversation(H,e)),P=!0}const j=[],z=e.threadUpdate;if(z&&(g?(D.log(k.LogTraceArea.ChatService,"Merging Thread: "+o.pii.Mri(z.id)+", Details Version: "+g.threadDetailsVersion+" => "+z.version),V=0!==g.threadDetailsVersion&&z.properties[y.ThreadProps.HistoryDisclosed]!==g.getThreadProperty(y.ThreadProps.HistoryDisclosed),g=g.mergeThreadUpdate(z)):(D.log(k.LogTraceArea.ChatService,"New Conversation from Thread: "+o.pii.Mri(z.id)+", Details Version: "+z.version),g=O.default.fromRawThread(z))),!g){if(e.consumptionHorizonUpdate&&!e.messageActions&&!e.brickConversation)return void D.log(k.LogTraceArea.ChatService,"Skipped creating empty conversation from CH push: "+o.pii.Mri(t));D.log(k.LogTraceArea.ChatService,"New Conversation from Nothing: "+o.pii.Mri(t)),g=O.default.newFakeEmptyConversation(t)}if(n.each(e.conversationPropLieConfirms,((e,t)=>{g=g.confirmConvPropertyLieApplied(t,e.value,e.additionalParams)})),n.each(e.conversationPropLieReverts,((e,t)=>{g=g.revertConvPropertyLie(t,e.value,e.additionalParams)})),n.each(e.conversationPropLieInfo,((e,t)=>{g=g.setConvPropertyLie(t,e.value,e.additionalParams)})),n.each(e.threadPropLieConfirms,((e,t)=>{g=g.confirmThreadPropertyLieApplied(t,e.value)})),n.each(e.threadPropLieReverts,((e,t)=>{g=g.revertThreadPropertyLie(t,e.value)})),n.each(e.threadPropLieInfo,((e,t)=>{g=g.setThreadPropertyLie(t,e.value)})),e.consumptionHorizonUpdate&&(g=g.mergeConsumptionHorizonPush(e.consumptionHorizonUpdate,e.consumptionHorizonVersion)),e.brickConversation&&(g=g.brickConversation(),F={messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}),e.memberConsumptionHorizons&&(g=g.mergeMemberConsumptionHorizons(n.values(e.memberConsumptionHorizons))),e.messageActions){this._remapCallEndedEventMessage(e.messageActions,R);let s=0;n.each(e.messageActions,((e,i)=>{let r;i in R&&(r=R[i]);let a=r,l=k.MessageOrigin.LocalChange,d=!1;const h=[];if(n.each(e.serverMessages,(e=>{if(l=e.origin,d=d||e.isOtherEndpointActive,h.push({origin:e.origin,clientMessageId:e.message.clientmessageid,correlationVector:e.correlationVector,messageStoreUsed:e.messageStoreUsed}),a)a=a.applyServerMessage(e.message);else if(a=U.default.fromFirstServerMessage(e.message),!a)return;if(l===k.MessageOrigin.PushNotification&&D.track(new A.FundamentalsMessagePushDebug(a.getLatestRelevantClientMessageId()||"",m.getCorrelationIdForMessage(a),"ServerMessageApplied")),y.isCallLog(t)){const e=S.getJsonFromMessageProperty(a.properties,"call-log");e?(e.messageCuid=a.cuid,b.push(e),D.log(k.LogTraceArea.Calling,`Accepted call-log ${e.callId} state: ${e.callState} direction:${e.callType}`)):D.warn(k.LogTraceArea.Calling,"Expected message with property: call-log")}})),n.isEmpty(h)&&h.push({origin:l,clientMessageId:a&&a.getLatestRelevantClientMessageId()||void 0,correlationVector:void 0,messageStoreUsed:void 0}),n.each(e.applyMessageLies,(e=>{a?a=a.applyMessageForPostingLie(e):(s=(s||Math.max(Date.now(),g.getTimestamp()))+1,a=U.default.fromFirstLie(e,t,E.default.getSkypeMri(),s))})),n.each(e.revertMessageLies,(e=>{a=a.revertMessageForPostingLie(e)})),n.each(e.setPropDeltas,(e=>{a=a.applyPropertyLie(e.key,e.value)})),n.each(e.revertPropDeltas,(e=>{a=a.revertPropertyLie(e.key,e.value)})),a&&e.confirmSendId&&e.confirmSendCMID&&(a=a.acknowledgeMessageLie(e.confirmSendCMID,e.confirmSendId,e.confirmSendVersion)),a&&e.rejectSendTimestamp&&e.rejectSendCMID&&(a=a.rejectMessageSend(e.rejectSendCMID,e.rejectSendTimestamp,e.rejectSendRetryInfo)),a&&y.isConciergeBotMri(a.creator)){const e=p.default.getEngagementFeatures();let t=!1;if(e.conciergeBotSettings.enableVisibility){const s=N.default.getUserPreferencesLocalNoSubscription(),i=s.enablePushEngagementNotifications&&s.enableInAppEngagementNotifications,o=n.some(e.conciergeBotSettings.allowedRecentMessageTypes,(e=>a&&e===a.messagetype));t=!i&&o}if(n.some(e.conciergeBlockedMessageTypes,(e=>a&&e===a.messagetype))||t)return void D.track(new w.EngagementMessageTelemetryEvent({eventType:w.EngagementMessageTelemetryEventType.ChatServiceBlockedMessage,messageType:a.messagetype,messageCorrelationId:m.getCorrelationIdFromMessageParts(a.creator,a.conversationId,a.cuid)}))}const{enableOneMessageTranslationDiscardUnwanted:_,enableMessageTranslation:f}=p.default.getS4LCMCFeaturesNoSubscription();if(_){const e=f&&a&&S.isTranslationMessageType(a.messagetype),t=null==g?void 0:g.isTranslated(),s=E.default.isMyMri(a.creator);if(e&&!t&&!s)return void D.log(k.LogTraceArea.ChatService,`Ignoring Translation message not for me. Conv: ${o.pii.Mri(a.conversationId)}, CUID: ${a.cuid}, Creator: ${o.pii.Mri(a.creator)}`)}if(e.fileEncryptionKeys&&(a=a.addFileKeyMaterial(e.fileEncryptionKeys)),n.isUndefined(e.isReported)||(a=a.markAsReported(e.isReported)),a!==r&&g.getDeletedTimestamp()<a.createdTime){const e={message:a,isOtherEndpointActive:d,reactionUpdates:a.getReactionUpdates(r),messageAlreadySeen:!!r,details:h};c.push(e),S.isGuestNameUpdateMessageType(a.messagetype)&&I.push(a),S.isCaptionMessageType(a.messagetype)||(B.push(a),g=g.mergeMessageLocal(a,!1)),u.calcAlertsForUpdatedMessage(g,a,M),n.some(h,(e=>e.origin===k.MessageOrigin.PushNotification))&&D.track(new A.FundamentalsMessagePushDebug(a.getLatestRelevantClientMessageId()||"",m.getCorrelationIdForMessage(a),"MessageUpdatePushed"))}else{const e=k.MessageOrigin[l]+(a===r?", NoChange":"");l===k.MessageOrigin.LocalChange&&a===r||D.track(new A.FundamentalsDebugEvent("MessageNotUpdated",e))}}))}if(B.length>0&&j.push(v.default.putMessages(B)),g.lastMessage&&!g.lastMessage.isShownInPreview(g.isTranslated())){const e=g.lastMessage.isReported();x=!e,j.push(this._getLastDisplayableMessage(Number.MAX_VALUE,g,c).then((e=>{g&&(e?(D.log(k.LogTraceArea.ChatService,`Bumped lastMessage for ${o.pii.Mri(g.id)} back to ${e.createdTime}`),g=g.mergeMessageLocal(e,!0)):(D.log(k.LogTraceArea.ChatService,`Removed lastMessage ${g.lastMessage&&g.lastMessage.cuid} for ${o.pii.Mri(g.id)}`),g=g.dropLastMessage()))})))}if(e.conversationUpdate&&g.isDeleted()){const e=v.default.getMessagesForConversationBeforeTime(g.id,g.getDeletedTimestamp(),void 0,!1).then((e=>v.default.removeMessages(e)));j.push(e)}return l.all(j).then((()=>{const i=g.lastMessage,r=i&&i.getLatestServerMessageVersion(),d=Math.max(r&&Number(r)||0,g.getTimestamp())>Date.now()-y.RecentMessageHistoryTimePeriod,c=g.isCurrentUserMember();if(s&&s.syncInfo&&!s.conv.isCurrentUserMember()&&c&&(F=void 0),F){const e=g&&g.isHistoryDisclosed(),s=V&&e?Math.max(F.messageHistoryStartTime,g.getThreadProperty(y.ThreadProps.LastJoinAt)||Number.MAX_VALUE):F.messageHistoryStartTime;if(!F.messagesStale&&P&&(d||x)){const e=d?_.MessagesStaleReason.NeedSync:_.MessagesStaleReason.ReceivedUnreconciledEdit;D.log(k.LogTraceArea.ChatService,"Need new messages sync for conv "+o.pii.Mri(t)+", messagesStaleReason: "+_.MessagesStaleReason[e]),F={messagesStale:!0,messagesStaleReason:e,messagesSyncState:F.messagesSyncState,messageHistoryStartTime:s}}else V&&e&&(D.log(k.LogTraceArea.ChatService,"History was "+(e?"disclosed":"hidden")+" for conv "+o.pii.Mri(t)),F={messagesStale:!0,messagesStaleReason:_.MessagesStaleReason.HistoryDisclosedChanged,messagesSyncState:F.messagesSyncState,messageHistoryStartTime:s})}else if(c){let e;d?e=_.MessagesStaleReason.NeedSync:x?e=_.MessagesStaleReason.ReceivedUnreconciledEdit:this._isConversationPossiblyUnread(g)&&(e=_.MessagesStaleReason.ConversationPossiblyUnread);const s=void 0!==e;D.log(k.LogTraceArea.ChatService,"No syncInfo for conv "+o.pii.Mri(t)+", messagesStale: "+s.toString()+", messagesStaleReason: "+(void 0===e?"undefined":_.MessagesStaleReason[e])),F={messagesStale:s,messagesStaleReason:e,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE}}else F={messagesStale:!1,messagesSyncState:void 0,messageHistoryStartTime:Number.MAX_VALUE};const u=s?s.updateConversationAndSyncInfo(g,F):T.default.firstTimeMeta(g,F,void 0);return C.calculateCountsForConversation(u,!!e.messageActions||!!e.recalculateCounts).then((e=>{e.earlyExit||D.log(k.LogTraceArea.ChatService,"Calculated counts: "+o.pii.Mri(t)+": "+e.msg);const i=u.updateCounts(e.counts);if(s&&s.syncInfo.messagesStaleReason===_.MessagesStaleReason.ConversationPossiblyUnread&&F&&!F.messagesStale){const e=!(!i.counts||!i.counts.hasUnread);D.log(k.LogTraceArea.ChatService,"Got counts for possibly unread conversation: "+o.pii.Mri(t)+"; Has unread messages: "+(e?"Yes":"No"));const s=new f.ChatServiceForceSyncConversationEvent("ConversationPossiblyUnread",e);D.track(s)}else if(s&&s.syncInfo.messagesStaleReason===_.MessagesStaleReason.ReceivedUnreconciledEdit&&F&&!F.messagesStale){const e=new f.ChatServiceForceSyncConversationEvent("ReceivedUnreconciledEdit",!0);D.track(e)}const r=!!s&&(s.conv.isCurrentUserMember()&&!s.conv.isDeleted()),d=!(i.conv.isCurrentUserMember()&&!i.conv.isDeleted())&&r,c=!!i.counts&&(!s||!s.counts||i.counts&&i.counts.consumptionHorizonTimestamp!==s.counts.consumptionHorizonTimestamp);let p;return p=L||!d&&!c?l.Resolved():v.default.getAlertsForConversation(i.conv.id).then((e=>{L=!0,M.trackOriginalItems(e.concat(this._alertsTrackedByAlertsStore))})),p.then((()=>{if(d&&n.each(M.getAllItems(),(e=>{e.message&&e.message.conversationId===t&&M.deleteItem(e)})),c){const e=n.filter(M.getAllItems(),(e=>!!e.message&&e.message.conversationId===t&&e.alertType===h.AlertType.HighPriorityMessage&&!!e.isRead!=e.message.createdTime<=i.counts.consumptionHorizonTimestamp));n.each(e,(e=>{const t=e.applyRead(e.message.createdTime<=i.counts.consumptionHorizonTimestamp);M.updateItem(t)}))}i!==s&&a.push(i)}))}))}))}))}));let L;l.all(x).then((()=>{let o;d.App.getActivationState()===d.Types.AppActivationState.Background&&p.default.getS4LNativePlatformsEcsConfig().enableIOSChatServiceBackgroundTask&&(o=r.default.requestMaxTime("ChatService:processBundle")),L=Date.now();const u=[];if(a.length>0){u.push(v.default.putConversationMetas(a));const e={};n.each(a,(t=>{const s=t.conv.getConversationBlocked();void 0!==s&&(e[t.conv.id]=s)})),n.isEmpty(e)||u.push(g.default.internal_updateConversationBlockStatus(e))}const h=M.getDeltas();return h.deletes.length>0&&u.push(v.default.removeAlerts(h.deletes)),(h.adds.length>0||h.updates.length>0)&&u.push(v.default.putAlerts(h.adds.concat(n.map(h.updates,(e=>e.updated))))),e.newUserPropSet&&u.push(R.default.putData(v.InternalKeys.Prefs,e.newUserPropSet)),e.convListSyncInfo&&u.push(R.default.putData(v.InternalKeys.ConversationListSyncInfo,e.convListSyncInfo)),n.isEmpty(b)||u.push(v.default.putCallLogs(b)),l.all(u).then((()=>{n.each(a,(e=>{this._conversationMetaMap[e.conv.id]=e}));const o=[];e.newUserPropSet&&(n.each(this._userProperties,((t,s)=>{this._userProperties[s]!==e.newUserPropSet[s]&&o.push(s)})),n.each(e.newUserPropSet,((e,t)=>{t in this._userProperties||o.push(t)})),this._userProperties=e.newUserPropSet);const r=i-s,l=L-i,d=Date.now()-L,u=l+d;if(D.log(k.LogTraceArea.ChatService,"Finished Processing Bundle: "+u+"ms ("+r+"ms OpenTransLock, "+l+"ms Processing, "+d+"ms Persisting): "+n.compact([a.length?a.length+" ConvMetas":void 0,c.length?c.length+" Messages":void 0,h.adds.length?h.adds.length+" New Alerts":void 0,h.updates.length?h.updates.length+" Changed Alerts":void 0,h.deletes.length?h.deletes.length+" Deleted Alerts":void 0,o.length?o.length+" UserPropKeys":void 0]).join(", ")),a.length>0&&(this.conversationsUpdated.fire(a),this._checkJoinedConvUpdates(a)),c.length>0){const e=n.map(c,(e=>e.message));this.messagesProcessedWithBundleInfo.fire(c),this.messagesProcessed.fire(e)}(h.adds.length>0||h.updates.length>0||h.deletes.length>0)&&this.alertsUpdated.fire(h),e.newUserPropSet&&this.userPropertiesChanged.fire(o),n.isEmpty(b)||this.callLogsReceived.fire(b),I.length>0&&this.guestNameUpdate.fire(I),t.resolve(void 0)})).always((()=>{null==o||o.then((e=>r.default.release(e,"ChatService:processBundle"))).catch(n.noop)}))})).catch((e=>{this._handleBundlingError(t,e,"processing")})).finally((()=>{this._finishProcessingBundle()}))})).catch((e=>{this._handleBundlingError(t,e,"PreProcessing"),this._finishProcessingBundle()})),t.promise()}_getLastDisplayableMessage(e,t,s){return v.default.getMessagesForConversationBeforeTime(t.id,e,25,!1).then((e=>{if(0===e.length)return l.Resolved(void 0);const i=n.map(n.filter(s,(e=>e.message.conversationId===t.id)),(e=>e.message)),o=n.filter(e,(e=>!n.find(i,(t=>t.cuid===e.cuid)))),r=n.filter([...i,...o],(e=>e.isShownInPreview(t.isTranslated())));if(r.length>0){const e=n.maxBy(r,(e=>e.createdTime));return l.Resolved(e)}{const i=Math.min.apply(Math,e.map((e=>e.createdTime)));return this._getLastDisplayableMessage(i-1,t,s)}}))}_handleBundlingError(e,t,s){const i="Error "+s+" bundle: "+H.default.errorAsString(t);D.error(k.LogTraceArea.ChatService,i),D.track(new f.ChatServiceBundleProcessingErrorEvent(i))}_finishProcessingBundle(){this._processingBundle=void 0,this._processBundle()}_isBundleActionable(e,t){return t||!!e.serverMessages||!!e.applyMessageLies}_remapCallEndedEventMessage(e,t){n.each(n.keys(e),(s=>{const i=e[s];if(!i.serverMessages)return;const o=i.serverMessages;n.each(o,(t=>{if(void 0===t)return;if(!S.isEventCallEndedMessageType(t.message))return;t.message=Object.assign(Object.assign({},t.message),{skypeeditedid:void 0,clientmessageid:W.default.newClientMessageId()});const r=y.getCuidForMessage(t.message);if(s===r)return;D.log(k.LogTraceArea.ChatService,`_remapCallEndedEventMessage moving end call event message from ${s} to ${r}`);r in e||(e[r]=Object.assign(Object.assign({},i),{serverMessages:[]}));const a=e[r];a.serverMessages||(a.serverMessages=[]),a.serverMessages.push(t),n.pull(o,t)})),n.isEmpty(o)&&(delete e[s].serverMessages,this._isBundleActionable(e[s],!!t[s])||(delete e[s],D.log(k.LogTraceArea.ChatService,`_remapCallEndedEventMessage removing bundle from ${s} since it is not actionable.`)))}))}_isConversationPossiblyUnread(e){if(e&&e.lastMessage){if(y.isConciergeBotMri(e.id))return!1;if(y.isHiddenBotMri(e.id))return!1;const t=e.getConsumptionHorizon(),s=y.getCuidFromConsumptionHorizon(t);if("0"!==s){const i=e.lastMessage.getOriginalClientMessageId();return!(y.getServerTimestampFromConsumptionHorizon(t)>=e.lastMessage.createdTime)&&(!!i&&s!==i)}}return!1}getChatServiceHost(){const e=this.getUserProperty(y.ServerUserProps.UserRing),t=n.isUndefined(e)?void 0:_.UserRing[n.toNumber(e)]||e;return t?t===_.UserRing.PROD?z.default.getHost(p.default.getConfigSettingsNoSubscription().chat.productionHost):z.default.getHost(p.default.getConfigSettingsNoSubscription().chat.dogfoodHost):void 0}}},335103:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChatServiceErrorHandler=t.RetryAfterTimer=t.BackoffTimerWrapper=t.ChatServiceErrorTypes=void 0;const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(55331)),a=s(662783),l=i.__importStar(s(397691)),d=i.__importDefault(s(150343)),c=i.__importStar(s(669431)),u=i.__importStar(s(44717)),h=s(815146),p=i.__importStar(s(85385)),g=i.__importDefault(s(163374)),m=i.__importDefault(s(782829)),S=i.__importDefault(s(601274)),_=i.__importDefault(s(517518)),f=i.__importStar(s(947786));var y;!function(e){e[e.EndpointMissing=0]="EndpointMissing",e[e.LocationChanged=1]="LocationChanged",e[e.InvalidRegToken=2]="InvalidRegToken",e[e.AuthenticationFailure=3]="AuthenticationFailure",e[e.TooManyRequests=4]="TooManyRequests",e[e.LoginRateLimitExceeded=5]="LoginRateLimitExceeded",e[e.LoginRequestError=6]="LoginRequestError",e[e.SkypeTokenRevoked=7]="SkypeTokenRevoked"}(y||(t.ChatServiceErrorTypes=y={}));const v="Unknown";class C{constructor(e,t){this._exponentialTimer=e,this._debugName=t,this._backoffMinTime=0,this._bumpCount=0}reset(){this._exponentialTimer.reset(),this._backoffMinTime=0,this._bumpCount=0}getPromise(){return Date.now()>=this._backoffMinTime?l.Resolved(void 0):(this._waitingForBackoff||(this._waitingForBackoff=l.Defer()),this._waitingForBackoff.promise())}bumpTimer(e){const t=Date.now()+this._exponentialTimer.getTimeAndCalculateNext();t>this._backoffMinTime&&(this._backoffMinTime=t,p.log(h.LogTraceArea.ChatServiceTransport,e+": "+this._debugName+" : Backing off until "+new Date(this._backoffMinTime)),this._checkBackoff()),this._bumpCount++}getBackoffMinTime(){return this._backoffMinTime}getBumpCount(){return this._bumpCount}_checkBackoff(){this._isSleepingUntilMinTime||(this._isSleepingUntilMinTime=!0,S.default.sleepUntil(this._backoffMinTime).then((()=>{if(this._isSleepingUntilMinTime=!1,Date.now()<this._backoffMinTime)this._checkBackoff();else if(this._waitingForBackoff){p.log(h.LogTraceArea.ChatServiceTransport,this._debugName+" timer reset, firing blocked requests.");const e=this._waitingForBackoff;this._waitingForBackoff=void 0,e.resolve(void 0)}})))}test_getTimer(){return this._exponentialTimer}test_setBackoffMinTime(e){this._backoffMinTime=e}}t.BackoffTimerWrapper=C;class T{constructor(){this._retryAfter={}}addBackoff(e,t){this._retryAfter[e]=Date.now()+t*f.SECOND,p.log(h.LogTraceArea.ChatService,`[${T.TAG}] Retry '${e}' in ${t} seconds`)}getPromise(e){const t=e.scenario,s=this._retryAfter[t];if(!s)return l.Resolved();if(Date.now()>=s)return delete this._retryAfter[t],l.Resolved();const i=s-Date.now();p.log(h.LogTraceArea.ChatService,`[${T.TAG}] Retry timer promise will resolve in ${i} ms`);const o=l.Defer();return r.default.setTimeout((()=>{p.log(h.LogTraceArea.ChatService,`[${T.TAG}] Retry timer promise resolved`),o.resolve(void 0)}),i),o.promise()}}t.RetryAfterTimer=T,T.TAG="retry-after";class M{constructor(e,t){this._handleLocationChange=e,this._handleInviteFreeQuarantine=t}getSkypetokenFromHeaders(e){const t=e.Authentication;return u.getSkypetokenFromAuthenticationHeader(t)}getRegistrationTokenFromHeaders(e){const t=e.RegistrationToken;return u.getRegistrationTokenFromHeader(t)?t:void 0}augmentErrorResponse(e,t){e.statusText=e.headers.statustext;let s="";if(!t&&e.body){const t=e;t.body.errorCode&&(t.errorCode=t.body.errorCode),t.body.message&&(t.errorMessage=t.body.message),s=", Body: "+t.errorCode+"/"+t.errorMessage}p.log(h.LogTraceArea.ChatService,"Chat Service Response: "+e.statusCode+"/"+e.statusText+o.pii.Omit(s)+", ContextId: "+e.headers.contextid+", Date: "+e.headers.date)}static getChatServiceErrorResponseMetadata(e){var t;let s,i;return e&&(s=e.errorMessage||e.errorInfo,!s&&e.timedOut&&(s="Request timeout"),e.headers&&(e.headers["ms-cv"]?i=e.headers["ms-cv"]:e.headers["MS-CV"]&&(i=e.headers["MS-CV"]))),{contextId:e&&e.headers&&e.headers.contextid?e.headers.contextid:v,date:e&&e.headers&&e.headers.date?e.headers.date:v,retryAfter:null===(t=null==e?void 0:e.headers)||void 0===t?void 0:t["retry-after"],errorCode:e&&void 0!==e.errorCode?e.errorCode:-1,errorMessage:s||v,statusCode:e&&void 0!==e.statusCode?e.statusCode:-1,statusText:e&&e.statusText?e.statusText:v,msCv:i,canceled:null==e?void 0:e.canceled,timedOut:null==e?void 0:e.timedOut}}handleChatServiceFailure(e,t,s,i,o,r,a,l){const S=M.getChatServiceErrorResponseMetadata(t);p.warn(h.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Failed to perform chat service request "+r.scenario+". "+JSON.stringify(S)+" "+JSON.stringify(r.telemetryAttributes));const f=r.mriForTelemetry?u.getMriTypeForTelemetry(r.mriForTelemetry):void 0,{reportInternalFailures:C,reportUnknownInternalFailures:T,reportSystemExceptionInternalFailures:b,chatServiceRedirectTimerEnabled:I}=d.default.getConfigSettingsNoSubscription().chat,w=r.mriForTelemetry&&u.isGroupConversation(r.mriForTelemetry),P=g.default.isNetworkingAvailable();if(!t.statusCode||u.isRedirect(t)||u.isEndpointMissing(t)){if(S&&C&&P||w){const e=new c.ChatServiceInternalFailureEvent(r.scenario,f,r.telemetryAttributes,S,a,g.default.getNetworkType(),P,l),t=S.errorMessage===v,s=n.startsWith(S.errorMessage,"System.Exception");(t&&T||s&&b||!t&&!s||w)&&p.track(e)}}else p.track(new c.ChatServiceFailureEvent(r.scenario,f,r.telemetryAttributes,S,a,l));const k=u.getTcidDataFromServerMessageResponse(t);if(t&&t.errorCode===u.ChatServiceErrors.EndpointMissing&&o&&m.default.markEndpointMissing(o,k),u.isRedirect(t)){const s=u.getRedirectUrl(t);return p.warn(h.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Chat Service is redirecting us to another cloud: "+s),this._handleLocationChange(s,a,k),I&&M._redirectTimer.bumpTimer(e),y.LocationChanged}if(M._redirectTimer.reset(),401===t.statusCode||403===t.statusCode){let o=!1;if(t.statusText){const e=t.statusText.toLowerCase();0!==e.indexOf("invalid registration token")&&-1===e.indexOf("registrationtoken and/or cookie must be set")&&-1===e.indexOf("registration token is expired")||(o=!0)}if(t.errorCode===u.ChatServiceErrors.StaleUic&&(o=!0),o)return p.warn(h.LogTraceArea.ChatService,e+": ChatServiceErrorHandler: Chat Service doesn't like our registration token -- "+(i?"Nuking and waiting for it to refresh.":"We didn't send one, ")+" Skypetoken: "+(s?"Sent with request":"Not sent with request")),i&&m.default.markRegistrationTokenExpired(i),y.InvalidRegToken}if(401===t.statusCode&&!t.errorCode){let o=!1;if(t.statusText){-1!==t.statusText.toLowerCase().indexOf("skypetokenrevoked")&&(o=!0)}const n=o||s;if(p.warn(h.LogTraceArea.ChatService,e+"ChatServiceErrorHandler: Got 401 from request -- "+(n?"nuking skypetoken":i?"nuking registration token":"but no token provided")),n){if(_.default.skypeTokenInvalid(s),o)return y.SkypeTokenRevoked}else if(i)return m.default.markRegistrationTokenExpired(i),y.InvalidRegToken;return y.AuthenticationFailure}return 429===t.statusCode?t.errorCode===u.ChatServiceErrors.PerUserLoginLimitExceeded?(M._loginTimer.bumpTimer(e),y.LoginRateLimitExceeded):(this._handleRetryAfter(t,r)||M._429Timer.bumpTimer(e),y.TooManyRequests):(403===t.statusCode&&t.errorCode===u.ChatServiceErrors.QuarantineLimitExceeded&&this._handleInviteFreeQuarantine(),r.isLoginRequest?(M._loginTimer.bumpTimer(e),y.LoginRequestError):void 0)}_handleRetryAfter(e,t){var s;if(!(null===(s=d.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===s?void 0:s.enabled))return!1;const i=t.scenario,o=e.headers["retry-after"],n=o?Number(o):void 0;return n?(M._retryAfterTimer.addBackoff(i,n),!0):(p.log(h.LogTraceArea.ChatService,`[${T.TAG}] retry-after header was not set for scenario '${i}'`),!1)}getLoginTimer(){return M._loginTimer}get429Timer(){return M._429Timer}getRedirectTimer(){return M._redirectTimer}getRetryAfterTimer(){return M._retryAfterTimer}}t.ChatServiceErrorHandler=M,M._429Timer=new C(new a.ExponentialTime(500,3e4),"429 timer"),M._loginTimer=new C(new a.ExponentialTime(500,1e5),"Login timer"),M._redirectTimer=new C(new a.ExponentialTime(500,6e4),"Redirect timer"),M._retryAfterTimer=new T},595835:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(404547)),a=i.__importStar(s(44717)),l=i.__importStar(s(235256)),d=i.__importDefault(s(114818)),c=i.__importDefault(s(565060)),u=i.__importDefault(s(782829)),h=i.__importStar(s(446574)),p=s(677982);t.default=new class{constructor(){this._checkState=()=>{if(this._blockUntilValidEndpointDefer&&this._hasPushEndpoint()){const e=this._blockUntilValidEndpointDefer;this._blockUntilValidEndpointDefer=void 0,e.resolve(void 0)}},this._cleanupPushEndpoints=()=>this._blockUntilValidEndpoint().then((()=>this._hasPushEndpoint()?r.default.serviceEnumerateEndpoints().then((e=>{const t=u.default.getEndpointInfo(),s=c.default.getPushTransportPath();return this._hasPushEndpoint(t,s)?n.all(o.map(e.endpoints,(i=>{if(a.areEndpointIdsEqual(i.id,t.id)){const t=a.findPushSubscriptionInfo(i.subscriptions),s=u.default.getEndpointInfo();if(s.pushSubscriptionId!==t.pushSubscriptionId||!(0,d.default)(s.pushSubscriptionParams,t.pushSubscriptionParams)){const s=o.assign({pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Endpoint cleanup",tcid:e.tcid},t);u.default.updateEndpointInfo(s)}return}if(!i.subscriptions||1!==i.subscriptions.length)return;const n=a.findPushSubscriptionInfo(i.subscriptions).pushSubscriptionParams;if(n&&this._isValidPushSubscription(n)&&n.eventChannel===s){const e=a.formatEndpointId(i.id);return r.default.serviceDeleteEndpoint(e).catch(o.noop)}}))):n.Rejected()})).then(o.noop):n.Rejected())),h.RegisterStartupable(this,"ChatServicePushEndpointCleanupService",[r.default,c.default])}startup(){u.default.endpointInfoChanged.subscribe(this._checkState),c.default.pushTransportPathChanged.subscribe(this._checkState);const e=p.AppConfigStore.getConfigSettingsNoSubscription().chat.msgApiConfig;return e.enabled&&e.isExclusive&&l.default.setRefreshOptions("ChatServicePushEndpointCleanupService",{interval:864e5,callback:this._cleanupPushEndpoints,taskTypeFlags:l.TaskTypeFlags.UsesNetworking}),Promise.resolve()}_blockUntilValidEndpoint(){if(this._hasPushEndpoint())return n.Resolved();this._blockUntilValidEndpointDefer||(this._blockUntilValidEndpointDefer=n.Defer());const e=this._blockUntilValidEndpointDefer.promise();return this._checkState(),e}_hasPushEndpoint(e=u.default.getEndpointInfo(),t=c.default.getPushTransportPath()){return!!(e.exists&&e.id&&e.pushSubscriptionParams&&this._isValidPushSubscription(e.pushSubscriptionParams))&&!!t}_isValidPushSubscription(e){return e.channelType===a.ChannelTypes.PushNotification&&!!e.eventChannel}}},780389:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(256468)),n=i.__importStar(s(44717)),r=i.__importDefault(s(565060)),a=i.__importDefault(s(782829));class l extends o.default{constructor(e,t,s){super(e,t),this._interestedResources=s,r.default.pushTransportPathChanged.subscribe((()=>{this._updateDesiredParams()}));const i=a.default.getEndpointInfo();this._subscriptionInfoUpdated(l._getSavedSubInfo(i)),this._updateDesiredParams()}static _getSavedSubInfo(e){if(e.pushSubscriptionId)return{endpointId:e.id,subscriptionId:e.pushSubscriptionId,params:e.pushSubscriptionParams}}endpointInfoUpdated(e,t){this._subscriptionInfoUpdated(l._getSavedSubInfo(e)),super.endpointInfoUpdated(e,t)}_updateDesiredParams(){const e=r.default.getPushTransportPath();e&&this._setDesiredSubParameters(n.createPushSubscriptionParams("Skype4Life",e,this._interestedResources))}_subscriptionAllowed(){return!!r.default.getPushTransportPath()&&super._subscriptionAllowed()}_updateActiveSubscriptionInfo(e,t,s){super._updateActiveSubscriptionInfo(e,t,s),a.default.setPushSubscriptionInfo(e,t,s)}}t.default=l},614595:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RestoreEndpointStatus=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(819059)),r=i.__importDefault(s(55331)),a=i.__importStar(s(397691)),l=i.__importDefault(s(150343)),d=s(815146),c=i.__importStar(s(85385)),u=i.__importDefault(s(782829)),h=i.__importDefault(s(922119)),p=i.__importDefault(s(517518));var g;!function(e){e[e.ChatServiceAndPushSubscriptionsRestored=0]="ChatServiceAndPushSubscriptionsRestored",e[e.ChatServiceSubscriptionOnlyRestored=1]="ChatServiceSubscriptionOnlyRestored",e[e.PushServiceSubscriptionOnlyRestored=2]="PushServiceSubscriptionOnlyRestored",e[e.FailedOrTimedOut=3]="FailedOrTimedOut",e[e.Unknown=4]="Unknown"}(g||(t.RestoreEndpointStatus=g={}));t.default=new class{restoreEndpoint(e,t,s){if(c.log(d.LogTraceArea.ChatService,"Received command to restore endpoints! ContextId: "+e),h.default.resume(),this._restoreEndpointDeferred)return c.log(d.LogTraceArea.ChatService,"Restore already in progress. Ignoring "+e),this._restoreEndpointDeferred.promise();const i=u.default.getEndpointInfo();this._restoreEndpointDeferred=a.Defer(),this._scenario=s,this._scenario.endpointMissing(i.id),i.id&&u.default.markEndpointMissing(i.id);const r=!p.default.hasUsableSkypeToken();p.default.skypeTokenInvalid(p.default.getRawSkypeToken()),p.default.performWhenValidSkypeTokenArrives().then((()=>(this._scenario&&this._scenario.gotSkypeToken(r),t.createOrUpdateEndpoint(i.id,i.ecsEtag||"").fail((e=>{this._scenario&&this._scenario.failed("Endpoint request failed",{statusCode:e.statusCode||"",contextId:e&&e.headers&&e.headers.contextid?e.headers.contextid:""})}))))).then((e=>{u.default.updateEndpointInfo(o.assign({},e,{reason:e.reason+" from restoreEndpoint"}))}));const m=n.default.requestMaxTime("RestoreEndpoint");return this._raceBackgroundTimer(this._restoreEndpointDeferred.promise(),l.default.getConfigSettingsNoSubscription().chat.restoreEndpointsTimeout).then((e=>{var t,s;if(this._restoreEndpointStatus=null!==(t=this._restoreEndpointStatus)&&void 0!==t?t:g.FailedOrTimedOut,this._scenario){if(e.timedOut){if(this._scenario.timedOut(),this._restoreEndpointDeferred){const e=this._restoreEndpointDeferred;this._restoreEndpointDeferred=void 0,e.reject(this._restoreEndpointStatus)}}else this._restoreEndpointStatus=null!==(s=e.result)&&void 0!==s?s:g.FailedOrTimedOut;this._scenario.finish()}return this._scenario=void 0,h.default.flush().then((()=>this._restoreEndpointStatus))})).always((e=>m.then((e=>n.default.release(e,"RestoreEndpoint"))).always((()=>e))))}endpointInfoUpdated(e,t){if(this._restoreEndpointDeferred&&(!t.exists&&e.exists&&this._scenario&&(this._scenario.endpointRestored(e.id),this._restoreEndpointStatus=g.ChatServiceSubscriptionOnlyRestored),!t.pushSubscriptionId&&e.pushSubscriptionId)){this._scenario&&this._scenario.pushSubscriptionRestored(e.pushSubscriptionId),this._restoreEndpointStatus=this._restoreEndpointStatus===g.ChatServiceSubscriptionOnlyRestored?g.ChatServiceAndPushSubscriptionsRestored:g.PushServiceSubscriptionOnlyRestored;const t=this._restoreEndpointDeferred;this._restoreEndpointDeferred=void 0,t.resolve(this._restoreEndpointStatus)}}_raceBackgroundTimer(e,t){const s=a.Defer(),i=r.default.setTimeout((()=>{s.resolve({timedOut:!0})}),t),o=e.then((e=>(r.default.clearTimeout(i),{timedOut:!1,result:e})));return a.race([o,s.promise()])}}},256468:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(331654)),a=s(662783),l=s(335103),d=s(135356),c=i.__importStar(s(44717)),u=s(815146),h=i.__importStar(s(85385)),p=i.__importDefault(s(114818)),g=i.__importStar(s(216030)),m=i.__importDefault(s(163374)),S=i.__importDefault(s(782829)),_=i.__importDefault(s(601274));t.default=class{constructor(e,t,s,i){this._restClient=e,this._subName=t,this._stateChangedCallback=s,this._longPollEventsCallback=i,this._checkStateRunning=!1,this._checkStateQueued=!1,this._exponentialTime=new a.ExponentialTime(1e3,3e5),this._dontCreateSubUntil=0,this._dontUpdateSubUntil=0,this._updateExponentialTime=new a.ExponentialTime(1e3,3e5),this._dontDeleteSubUntil=0,this._lastLongPollAttemptResult=d.LongPollResult.Success,this._dontLongPollUntil=0,this._longPollExponentialTime=new a.ExponentialTime(1e3,3e5),this._subscriptionState=d.SubscriptionState.None,this._checkState=()=>{this._checkStateKickTimer&&(_.default.clearTimeout(this._checkStateKickTimer),this._checkStateKickTimer=void 0),this._longPollEventsCallback&&(this._checkStateKickTimer=_.default.setTimeout((()=>{this._checkStateKickTimer=void 0,this._subscriptionAllowed()&&h.warn(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Kick Timer Activated..."),this._checkState()}),12e4)),this._checkStateRunning?this._checkStateQueued=!0:(this._checkStateRunning=!0,this._checkStateInner(),this._checkStateRunning=!1,this._checkStateQueued&&(this._checkStateQueued=!1,this._checkState()))},r.default.onResume.subscribe((e=>{h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" Resuming from sleep, kicking subscriptions causeId: "+e),this.cancelPendingLongPollRequest("DeviceUtilities.onResume"),this._resetBackoffs(),this._checkState()})),m.default.subscribe((()=>{m.default.isNetworkingAvailable()&&(this.cancelPendingLongPollRequest("Networking is available again"),this._resetBackoffs(),this._checkState())}));const o=S.default.getEndpointInfo();h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" started up with endpoint Info: "+c.encodeEndpointInfoForLog(o))}_subscriptionInfoUpdated(e){this._activeSub=e}endpointInfoUpdated(e,t){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" using new endpoint Info: "+c.encodeEndpointInfoForLog(e)),this._checkState()}_setDesiredSubParameters(e){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" got desired sub parameters: "+o.pii.Omit(JSON.stringify(e))),this._desiredSubParameters=e,this._checkState()}_subscriptionAllowed(){return S.default.endpointExists()?this._activeSub&&this._activeSub.endpointId!==S.default.getEndpointId()?(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: Endpoint Id Mismatch"),!1):0!==this._desiredSubParameters.interestedResources.length||(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: No interestedResources"),!1):(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" not allowed: Endpoint Doesn't exist"),!1)}_resetBackoffs(){this._dontCreateSubUntil=0,this._dontUpdateSubUntil=0,this._dontDeleteSubUntil=0,this._dontLongPollUntil=0,this._exponentialTime.reset(),this._updateExponentialTime.reset(),this._longPollExponentialTime.reset()}_updateActiveSubscriptionInfo(e,t,s){this._activeSub=e}_setState(e){this._subscriptionState!==e&&(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" state changed from: "+d.SubscriptionState[this._subscriptionState]+", to: "+d.SubscriptionState[e]),this._subscriptionState=e,this._stateChangedCallback&&this._stateChangedCallback(this._subscriptionState,this._lastLongPollAttemptResult))}_checkStateInner(){if(this._checkStateRerunTimer&&(_.default.clearExpiration(this._checkStateRerunTimer),this._checkStateRerunTimer=void 0),!this._desiredSubParameters)return void h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" skipping checkState: No Current Desired Subscription Parameters");if(!this._subscriptionAllowed()){if(this.cancelPendingLongPollRequest("subscription not allowed"),this._subscriptionCreationInFlight){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription creation in flight");const e=this._subscriptionCreationInFlight;this._subscriptionCreationInFlight=void 0,e.cancel()}if(this._subscriptionUpdateInterestedResourcesInFlight){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription update in flight");const e=this._subscriptionUpdateInterestedResourcesInFlight;this._subscriptionUpdateInterestedResourcesInFlight=void 0,e.cancel()}return this._activeSub?(this._setState(d.SubscriptionState.Deleting),this._subscriptionDeleteInFlight?void h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription delete in flight"):this._dontDeleteSubUntil>Date.now()?void(this._checkStateRerunTimer=_.default.setExpiration(this._checkState,this._dontDeleteSubUntil)):void this._checkState_deleteSubscription()):void this._setState(d.SubscriptionState.None)}if(!this._activeSub||!(0,p.default)(n.omit(this._desiredSubParameters,"interestedResources"),n.omit(this._activeSub.params,"interestedResources"))){if(this._setState(d.SubscriptionState.Creating),this._subscriptionDeleteInFlight){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription delete in flight for creation");const e=this._subscriptionDeleteInFlight;this._subscriptionDeleteInFlight=void 0,e.cancel()}if(this._subscriptionUpdateInterestedResourcesInFlight){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending subscription update in flight for creation");const e=this._subscriptionUpdateInterestedResourcesInFlight;this._subscriptionUpdateInterestedResourcesInFlight=void 0,e.cancel()}return this._subscriptionCreationInFlight?void h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription creation in flight"):this._dontCreateSubUntil>Date.now()?void(this._checkStateRerunTimer=_.default.setExpiration(this._checkState,this._dontCreateSubUntil)):void this._checkState_createSubscription()}if(!(0,p.default)(this._desiredSubParameters.interestedResources,this._activeSub.params?this._activeSub.params.interestedResources:[])&&(this._subscriptionCreationInFlight?h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription creation in flight"):this._subscriptionUpdateInterestedResourcesInFlight?h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending subscription update in flight"):this._dontUpdateSubUntil>Date.now()?this._checkStateRerunTimer=_.default.setExpiration(this._checkState,this._dontUpdateSubUntil):this._checkState_updateSubscriptionInterestedResources()),this._setState(this._lastLongPollAttemptResult===d.LongPollResult.Success?d.SubscriptionState.CreatedActive:d.SubscriptionState.CreatedLongPollTrouble),this._longPollEventsCallback){if(this._longPollInFlight)return void h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" waiting for pending long poll in flight");if(this._dontLongPollUntil>Date.now())return void(this._checkStateRerunTimer=_.default.setExpiration(this._checkState,this._dontLongPollUntil));this._checkState_startLongPoll()}}_checkState_deleteSubscription(){if(!S.default.endpointExists())return h.log(u.LogTraceArea.ChatServiceSubscriptions,"Endpoint missing, deleting subscription locally"),void this._updateActiveSubscriptionInfo(void 0,"Endpoint missing");h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" deleting subscription: "+this._activeSub.endpointId+"/"+this._activeSub.subscriptionId),this._subscriptionDeleteInFlight=this._restClient.serviceDeleteSubscription(this._activeSub.endpointId,this._activeSub.subscriptionId).then(n.noop),this._subscriptionDeleteInFlight.finally((()=>{this._subscriptionDeleteInFlight=void 0})).then((()=>{this.cancelPendingLongPollRequest("Delete subscription"),this._resetBackoffs(),h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" deleted subscription!"),this._updateActiveSubscriptionInfo(void 0,"Deleted subscription"),this._checkState()}),(e=>{e&&!e.canceled&&(404===e.statusCode?(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" failed to delete -- already missing!"),this._updateActiveSubscriptionInfo(void 0,"Failed to delete",c.getTcidDataFromServerMessageResponse(e))):403===e.statusCode?(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" access forbidden -- giving up!"),this._updateActiveSubscriptionInfo(void 0,"Access forbidden",c.getTcidDataFromServerMessageResponse(e))):(this._dontDeleteSubUntil=Date.now()+this._exponentialTime.getTimeAndCalculateNext(),0===e.statusCode?h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" Delete failed due to connectivity issues. Retrying at "+new Date(this._dontDeleteSubUntil)):h.warn(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Delete failure: "+e.statusCode+"/"+e.statusText+", "+e.errorCode+"/"+e.errorMessage+". Retrying at "+new Date(this._dontDeleteSubUntil))),this._checkState())}))}_checkState_createSubscription(){const e=S.default.getEndpointId(),t=this._desiredSubParameters;h.log(u.LogTraceArea.ChatServiceSubscriptions,"Creating subscription "+this._subName+". EndpointId: "+e+", Type: "+t.channelType+", Resources: "+o.pii.Omit(t.interestedResources.join(","))),this._subscriptionCreationInFlight=this._restClient.serviceCreateSubscription(e,t),this._subscriptionCreationInFlight.finally((()=>{this._subscriptionCreationInFlight=void 0})).then((s=>{this._resetBackoffs();const i=s.subscriptionId;h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Created: "+e+"/"+i),this._updateActiveSubscriptionInfo({endpointId:e,subscriptionId:i,params:t},"Subscription created",s.tcid),this._lastLongPollAttemptResult=d.LongPollResult.Success,this._checkState()}),(t=>{if(t&&!t.canceled)404===t.statusCode?(h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to create -- Endpoint is missing!",l.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),S.default.markEndpointMissing(e,c.getTcidDataFromServerMessageResponse(t))):201===t.errorCode?h.error(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+": Bad request body on subscription creation. Err: ",l.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)):(this._dontCreateSubUntil=Date.now()+this._exponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" creation failed due to connectivity issues. Retrying at "+new Date(this._dontCreateSubUntil)):h.warn(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Creation failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontCreateSubUntil))),this._checkState();else{const e=t&&t.canceled?"canceled":"no error";h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to create -- "+e)}}))}_checkState_updateSubscriptionInterestedResources(){const e=S.default.getEndpointId(),t=this._desiredSubParameters;h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updating. EndpointId: "+e+", Params: "+o.pii.Omit(JSON.stringify(t))),this._subscriptionUpdateInterestedResourcesInFlight=this._restClient.serviceUpdateSubscriptionProperty(e,this._activeSub.subscriptionId,"interestedResources",t.interestedResources),this._subscriptionUpdateInterestedResourcesInFlight.finally((()=>{this._subscriptionUpdateInterestedResourcesInFlight=void 0})).then((s=>{this._updateExponentialTime.reset(),this._activeSub?(h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updated: "+e+"/"+this._activeSub.subscriptionId),this._updateActiveSubscriptionInfo({endpointId:e,subscriptionId:this._activeSub.subscriptionId,params:t},"Subscription property updated",s)):h.warn(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Updated with dead activeSub"),this._checkState()}),(t=>{t.canceled||(404===t.statusCode?(h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failed to update -- Endpoint is missing!",l.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),S.default.markEndpointMissing(e,c.getTcidDataFromServerMessageResponse(t))):(this._dontUpdateSubUntil=Date.now()+this._updateExponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" update failed due to connectivity issues. Retrying at "+new Date(this._dontUpdateSubUntil)):h.warn(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Update failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontUpdateSubUntil))),this._checkState())}))}cancelPendingLongPollRequest(e){if(this._longPollInFlight){h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" killing pending long poll in flight: "+e);const t=this._longPollInFlight;this._longPollInFlight=void 0,t.cancel()}}_checkState_startLongPoll(){this._lastLongPollAttemptResult!==d.LongPollResult.Success&&h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" attempting long poll while in recovery mode...");const e=this._activeSub.endpointId,t=Date.now();let s;this._longPollInFlight=this._restClient.servicePollSubscription(e,this._activeSub.subscriptionId,this._lastLongPollAckId),this._longPollInFlight.finally((()=>{s=Date.now()-t,this._longPollInFlight=void 0})).then((e=>{const t=new g.KpiLongPoll(e&&e.eventMessages||[],s);t.markConfirmedGoodConnection(m.default.isNetworkingAvailable()),h.track(t),this._longPollExponentialTime.reset(),this._lastLongPollAttemptResult!==d.LongPollResult.Success&&(h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" long poll recovered"),this._lastLongPollAttemptResult=d.LongPollResult.Success),e&&e.eventMessages&&e.eventMessages.length>0&&(this._longPollEventsCallback(e.eventMessages),this._lastLongPollAckId=n.maxBy(e.eventMessages,(e=>e.id)).id),this._checkState()})).catch((t=>{if(t.canceled&&!t.timedOut)return;h.log(u.LogTraceArea.ChatServiceSubscriptions,"_checkState_startLongPoll error:",l.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t));const i=new g.KpiLongPollFailure(t.statusCode,s);i.markConfirmedGoodConnection(m.default.isNetworkingAvailable()),h.track(i),450===t.errorCode?(h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" backing subscription has gone away. Recreating."),this._updateActiveSubscriptionInfo(void 0,"Longpoll 450",c.getTcidDataFromServerMessageResponse(t))):201===t.errorCode||729===t.errorCode?(h.log(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" failure that indicates that the endpoint is gone. Recreating the endpoint...",l.ChatServiceErrorHandler.getChatServiceErrorResponseMetadata(t)),this._updateActiveSubscriptionInfo(void 0,"Longpoll 201 or 729",c.getTcidDataFromServerMessageResponse(t)),S.default.markEndpointMissing(e,c.getTcidDataFromServerMessageResponse(t))):(this._lastLongPollAttemptResult=0===t.statusCode?d.LongPollResult.FailureExternal:d.LongPollResult.FailureErrorCode,this._dontLongPollUntil=Date.now()+this._longPollExponentialTime.getTimeAndCalculateNext(),0===t.statusCode?h.log(u.LogTraceArea.ChatServiceSubscriptions,this._subName+" poll failed due to connectivity issues. Retrying at "+new Date(this._dontLongPollUntil)):h.warn(u.LogTraceArea.ChatServiceSubscriptions,"Subscription "+this._subName+" Poll failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying at "+new Date(this._dontLongPollUntil))),this._checkState()}))}}},556587:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=s(662783),l=i.__importDefault(s(974634)),d=i.__importStar(s(397691)),c=i.__importDefault(s(659938)),u=i.__importDefault(s(150343)),h=i.__importDefault(s(97572)),p=i.__importDefault(s(404547)),g=i.__importDefault(s(304623)),m=s(135356),S=i.__importStar(s(44717)),_=i.__importDefault(s(502339)),f=s(434343),y=s(185013),v=s(815146),C=s(120695),T=i.__importStar(s(85385)),M=i.__importDefault(s(652032)),b=i.__importStar(s(216030)),I=i.__importDefault(s(363091)),w=s(96575),P=i.__importDefault(s(506082)),k=i.__importStar(s(446574)),A=i.__importDefault(s(415933)),x=i.__importDefault(s(601274)),D=i.__importDefault(s(719006)),R=i.__importDefault(s(760989)),L=i.__importDefault(s(800449)),B=s(534579),F=i.__importDefault(s(163374)),N=18e5;t.default=new class{constructor(){this._syncDataAccumulator=new _.default,this.syncStarted=new l.default,this.syncComplete=new l.default,this._firstConversationListSync=!0,this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime=new a.ExponentialTime(1e3,3e5),this._conversationListStale=!1,this._conversationListSyncing=!1,this._conversationListSyncedAtLeastOnce=!1,this._conversationSyncInfoTransient={},this.conversationListSyncStarted=new l.default,this.conversationListSyncComplete=new l.default,this._messagesStale={},this._messagesSyncing={},this._waitingForMessageSync={},this._desiredMessageHistoryStartTime={},this._threadDetailsStale={},this._threadDetailsSyncing={},this._syncFailed={},this.startedSyncingConversation=new l.default,this.finishedSyncingConversation=new l.default,this._prioritizedConversationIds={},this._checkSyncProgressInside=!1,this._checkSyncProgressPending=!1,this._syncExponentialBackoff=new a.ExponentialTime(100,3e5),this._checkProgressAfter=0,this._receivedConversationUpdates=e=>{let t=!1;n.each(n.toArray(e),(e=>{if(e)if(0===e.conv.convViewVersion&&e.conv.threadDetailsVersion>0)this.forceConversationListSync();else{if(!e.conv.isCurrentUserMember()||I.default.isMyMri(e.conv.id))return delete this._messagesStale[e.conv.id],void delete this._threadDetailsStale[e.conv.id];if(e.syncInfo&&e.syncInfo.messagesSyncState||!e.needsSyncMessages()||(0,y.isConversationObjectBlocked)(e.conv)){const s=this._conversationSyncInfoTransient[e.conv.id];s&&(s.messages&&(s.messages.chatServiceErrorCount=0,t=!0,this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),s.thread&&(s.thread.chatServiceErrorCount=0,t=!0,this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0))}else this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0,t=!0}})),t&&(T.log(v.LogTraceArea.ChatService,"Kicking sync: _receivedConversationUpdates"),this._checkSyncProgress())},this._onConnected=()=>{this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime.reset(),this._resetBackoffTimer(),this._nextForcedConversationListSyncTimer&&(x.default.clearTimeout(this._nextForcedConversationListSyncTimer),this._nextForcedConversationListSyncTimer=void 0),n.each(g.default.getRawConversationMetaMemoryCache(),(e=>{e&&this._markMessagesAndDetailsStaleAsNeeded(e)})),T.log(v.LogTraceArea.ChatService,"Kicking sync: _onConnected"),this.forceConversationListSync()},this._onMessageLoss=()=>{T.log(v.LogTraceArea.ChatService,"Trouter reported a message loss, starting conversation sync"),this.forceConversationListSync()},this._markFullSyncOnce=n.once((e=>this._syncDataAccumulator.markFullSync(e))),this._markFirstSyncOnce=n.once((()=>this._syncDataAccumulator.markFirstSync())),k.RegisterStartupable(this,"ChatServiceSyncService",[h.default,g.default,M.default])}startup(){return this._conversationListSyncInfo=M.default.getData(f.InternalKeys.ConversationListSyncInfo),T.log(v.LogTraceArea.ChatService,"Sync state loaded: "+JSON.stringify(this._conversationListSyncInfo)),this._checkConversationListSyncInfo(),this._connectedSubToken=p.default.reconnected.subscribe(this._onConnected),this._convSubToken=g.default.conversationsUpdated.subscribe(this._receivedConversationUpdates),L.default.messageLost.subscribe(this._onMessageLoss),P.default.performAfterUIStarted((()=>{g.default.loadAndCacheNeedsSyncConversations(),T.log(v.LogTraceArea.ChatService,"Kicking sync: UI started");const e=u.default.getS4LMessagingFeatures().syncSettings;e&&e.forceOnUiStarted?this.forceConversationListSync():this._checkSyncProgress()})),this._appStateSubToken=c.default.subscribeForChanges("ChatServiceSyncService",(e=>{if(e===r.Types.AppActivationState.Active){this._conversationListExponentialTime.reset(),this._resetBackoffTimer(),T.log(v.LogTraceArea.ChatService,"Kicking sync: app foregrounded");const e=u.default.getS4LMessagingFeatures().syncSettings;e&&e.forceOnForeground?this.forceConversationListSync():this._checkSyncProgress()}else 0})),d.Resolved()}prioritizeMeetNowThreadDetails(e){this._meetNowThreadId=e,this._checkSyncProgress()}prioritizeConversation(e,t=!0,s=!1){let i=s,n=t;if(this._threadDetailsStale[e]||(i=!1),this._messagesStale[e]||(n=!1),i||n){this._prunePriorizedConvList();const t=Date.now(),s=this._prioritizedConversationIds[e];s?(s.priorityTime=t,n&&(s.needMessages=!0),i&&(s.needThreadDetails=!0)):this._prioritizedConversationIds[e]={priorityTime:t,needMessages:n,needThreadDetails:i},T.log(v.LogTraceArea.ChatService,`Kicking sync: prioritizeConversation for ${o.pii.Mri(e)}`),this._checkSyncProgress()}}haveAllMessagesForConversation(e){const t=g.default.getConversationMetaFromMemoryCache(e);return!!t&&t.syncInfo.messageHistoryStartTime===S.BeginningOfTime}getEarliestKnownMessageTime(e){const t=g.default.getConversationMetaFromMemoryCache(e);return t?t.syncInfo.messageHistoryStartTime:Number.MAX_VALUE}getSyncState(e){const t=g.default.getConversationMetaFromMemoryCache(e);return t&&t.syncInfo.messagesSyncState}syncBackwards(e){return T.log(v.LogTraceArea.ChatService,"SyncBackwards: "+o.pii.Mri(e)),g.default.getConversationMetaAsync(e).then((t=>{if(!t)return!1;if(t.conv.isBricked||t.syncInfo.messageHistoryStartTime===S.BeginningOfTime)return!1;if((0,y.isConversationObjectBlocked)(t.conv))return!1;this._checkSyncStartingForConversation(e),this._messagesStale[e]=!0;return this._getOrCreateSyncInfoTransient(e).nextSyncSinglePage=!0,T.log(v.LogTraceArea.ChatService,"Kicking sync: syncBackwards"),this._checkSyncProgress(),!0}))}forceConversationListSync(){this._checkSyncStartingForConversationList(),this._conversationListStale=!0,T.log(v.LogTraceArea.ChatService,"Kicking sync: forceConversationListSync"),this._checkSyncProgress()}forceResyncConversation(e){const t=g.default.getConversationMetaFromMemoryCache(e);t&&g.default.processQueuedBundle().then((()=>{this._forceResyncMeta(t,!0),g.default.processQueuedBundle(),T.log(v.LogTraceArea.ChatService,"Kicking sync: forceResyncConversation: "+o.pii.Mri(e)),this._checkSyncProgress()}))}forceResyncAllConversations(){g.default.processQueuedBundle().then((()=>{n.each(g.default.getRawConversationMetaMemoryCache(),(e=>this._forceResyncMeta(e))),g.default.processQueuedBundle(),T.log(v.LogTraceArea.ChatService,"Kicking sync: forceResyncAllConversations"),this._checkSyncProgress()}))}forceThreadDetailsFetchIfNeeded(e){const t=g.default.getConversationMetaFromMemoryCache(e);t&&t.conv.isThread()&&t.conv.areThreadDetailsStale()&&!t.conv.isBricked&&t.conv.isCurrentUserMember()&&(this._checkSyncStartingForConversation(t.conv.id),this._threadDetailsStale[t.conv.id]=!0,T.log(v.LogTraceArea.ChatService,"Kicking sync: forceThreadDetailsFetchIfNeeded"),this._checkSyncProgress())}waitForMessageSyncToFinish(e){this._waitingForMessageSync[e]||(this._waitingForMessageSync[e]=d.Defer());const t=this._waitingForMessageSync[e].promise(),s=this.waitForConversationListSyncToFinish().then((()=>this.isSyncingMessagesForConversation(e)&&this._waitingForMessageSync[e]?this._waitingForMessageSync[e].promise():this._syncFailed[e]?d.Rejected():d.Resolved()));return d.race([t,s]).then(n.noop)}waitForConversationListSyncToFinish(){return p.default.isConnected()&&!this._conversationListStale?d.Resolved():(this._waitingConversationListSync||(this._waitingConversationListSync=d.Defer()),this._waitingConversationListSync.promise())}isCurrentlySyncing(){return!!this._syncStartTime}isConversationListDirty(){return this._conversationListStale}hasConversationListSyncFinishedAtLeastOnce(){return this._conversationListSyncedAtLeastOnce}isSyncingMessages(){return!n.isEmpty(this._messagesStale)}isSyncingMessagesForConversation(e){return!!this._messagesStale[e]}isSyncingThreadDetailsForConversation(e){return!!this._threadDetailsStale[e]}_prunePriorizedConvList(){const e=Date.now()-6e4;n.each(this._prioritizedConversationIds,((t,s)=>{t.priorityTime<e&&delete this._prioritizedConversationIds[s]}))}_getOrCreateSyncInfoTransient(e){let t=this._conversationSyncInfoTransient[e];return t||(t={},this._conversationSyncInfoTransient[e]=t),t}_checkSyncInfoTransientForClearing(e){n.isEmpty(this._conversationSyncInfoTransient[e])&&delete this._conversationSyncInfoTransient[e]}_forceResyncMeta(e,t=!1){if(!e||!e.conv.isCurrentUserMember())return;const s=e.syncInfo.messagesStale||t||e.conv.getTimestamp()>Date.now()-S.RecentMessageHistoryTimePeriod,i={messagesStale:s,messagesStaleReason:s?m.MessagesStaleReason.NeedSync:void 0,messagesSyncState:"",messageHistoryStartTime:Number.MAX_VALUE};i.messagesStale&&!(0,y.isConversationObjectBlocked)(e.conv)&&(this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),e.conv.isThread()&&(this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0),g.default.queueConvSyncInfoChange(e.conv.id,i,!0)}_markMessagesAndDetailsStaleAsNeeded(e){I.default.isMyMri(e.conv.id)||(e.needsSyncMessages()&&!(0,y.isConversationObjectBlocked)(e.conv)&&(this._checkSyncStartingForConversation(e.conv.id),this._messagesStale[e.conv.id]=!0),e.needsSyncThreadDetails()&&(this._checkSyncStartingForConversation(e.conv.id),this._threadDetailsStale[e.conv.id]=!0))}_checkSyncStartingForConversationList(){this._conversationListStale||this._conversationListSyncing||(T.log(v.LogTraceArea.ChatService,"Conversation List Sync: Started"),this.conversationListSyncStarted.fire(),this._checkSyncStarting())}_checkSyncFinishedForConversationList(){if(!this._conversationListStale&&!this._conversationListSyncing){if(T.log(v.LogTraceArea.ChatService,"Conversation List Sync: Completed"),this.conversationListSyncComplete.fire(),this._conversationListSyncedAtLeastOnce=!0,this._waitingConversationListSync){const e=this._waitingConversationListSync;this._waitingConversationListSync=void 0,e.resolve(void 0)}this._checkSyncFinished()}}_checkSyncStartingForConversation(e){this._threadDetailsStale[e]||this._threadDetailsSyncing[e]||this._messagesStale[e]||this._messagesSyncing[e]||(T.log(v.LogTraceArea.ChatService,"Started syncing conversation: "+o.pii.Mri(e)),this.startedSyncingConversation.fire(e),this._checkSyncStarting())}_checkSyncFinishedForConversation(e){if(!this._messagesStale[e]&&!this._messagesSyncing[e]){if(this._waitingForMessageSync[e]){const t=this._waitingForMessageSync[e];delete this._waitingForMessageSync[e],this._syncFailed[e]?t.reject():t.resolve(void 0)}this._threadDetailsStale[e]||this._threadDetailsSyncing[e]||(T.log(v.LogTraceArea.ChatService,"Finished syncing conversation: "+o.pii.Mri(e)),this.finishedSyncingConversation.fire(e),this._checkSyncFinished())}}_checkSyncStarting(){this._syncStartTime||(T.log(v.LogTraceArea.ChatService,"Sync Starting"),this._syncStartTime=Date.now(),this._startTelemetry(),this.syncStarted.fire())}_checkSyncFinished(){this._syncStartTime&&!this._conversationListStale&&!this._conversationListSyncing&&n.isEmpty(this._messagesStale)&&n.isEmpty(this._messagesSyncing)&&n.isEmpty(this._threadDetailsStale)&&n.isEmpty(this._threadDetailsSyncing)&&(T.log(v.LogTraceArea.ChatService,`Sync Finished: ${(Date.now()-this._syncStartTime)/1e3}s`),this._syncStartTime=void 0,this._stopTelemetry(),this.syncComplete.fire())}_checkSyncProgress(){if(P.default.isUIDisplayed()){if(this._checkSyncProgressInside)return this._checkSyncProgressPending=!0,void T.log(v.LogTraceArea.ChatService,"Sync not kicked: Pending");this._checkSyncProgressInside=!0,this._checkSyncProgressInner(),this._checkSyncProgressInside=!1,this._checkSyncProgressPending&&(this._checkSyncProgressPending=!1,T.log(v.LogTraceArea.ChatService,"Kicking sync: Pending"),this._checkSyncProgress())}else T.log(v.LogTraceArea.ChatService,"Sync not kicked: UI not displayed")}_checkSyncProgressInner(){if(this._checkSyncProgressCallbackTimer&&(x.default.clearExpiration(this._checkSyncProgressCallbackTimer),this._checkSyncProgressCallbackTimer=void 0),!u.default.getConfigSettingsNoSubscription().chat.syncWhenNoSubscription&&!p.default.isConnected())return void T.log(v.LogTraceArea.ChatService,"Sync not kicked: no active transport");const e=Date.now();if(u.default.getConfigSettingsNoSubscription().chat.syncBackoffOnNoNetwork&&this._checkProgressAfter>e)return T.log(v.LogTraceArea.ChatService,"Sync not kicked: no network"),void(this._checkSyncProgressCallbackTimer=x.default.setExpiration((()=>this._checkSyncProgress()),this._checkProgressAfter));const t=u.default.getConfigSettingsNoSubscription().chat.syncFreeFetchesConfig,s=D.default.isUserComposing();let i=s?t.bandwidthAwareFetchesREST:t.maxFetchesREST;this._conversationListSyncing&&i--;const o=n.keys(this._messagesSyncing).length;i-=o;const r=n.keys(this._threadDetailsSyncing).length;if(i-=r,i<=0)return void T.log(v.LogTraceArea.ChatService,"Sync not kicked: no free fetches; Conv List Syncing: "+(this._conversationListSyncing?"Yes":"No")+"; Active message syncs: "+o+"; Active thread details syncs: "+r+"; MeetNow thread is syncing: "+!(!this._meetNowThreadId||!this._threadDetailsSyncing[this._meetNowThreadId])+"; User is composing: "+s);if(this._meetNowThreadId&&!this._threadDetailsSyncing[this._meetNowThreadId]){const e=this._meetNowThreadId;this._checkSyncStartingForConversation(e),this._threadDetailsSyncing[e]=!0,delete this._syncFailed[e],i--,this._fetchThreadDetails(e).finally((()=>{delete this._threadDetailsSyncing[e],this._meetNowThreadId=void 0,this._checkSyncFinishedForConversation(e),this._checkSyncProgress()}))}let a=Number.MAX_VALUE;if(this._conversationListStale&&!this._conversationListSyncing&&(this._nextForcedConversationListSyncTimer&&(x.default.clearTimeout(this._nextForcedConversationListSyncTimer),this._nextForcedConversationListSyncTimer=void 0),this._conversationListWaitForSyncUtc>e?(T.log(v.LogTraceArea.ChatService,"Conversation List Sync not kicked: need to wait "+(e-this._conversationListWaitForSyncUtc)+"ms"),a=Math.min(a,this._conversationListWaitForSyncUtc)):(this._checkSyncStartingForConversationList(),this._conversationListSyncing=!0,this._conversationListSyncStarted=Date.now(),i--,this._syncConversationList().finally((()=>{this._conversationListSyncing=!1;const e=this._conversationListSyncStarted?Date.now()-this._conversationListSyncStarted:0;this._conversationListSyncStarted=void 0,this._checkSyncFinishedForConversationList(),this._checkSyncProgress(),this._conversationListStale||(T.log(v.LogTraceArea.ChatService,"Conversation list sync done in "+e+" ms - all up to date: next run scheduled in "+N+"ms"),e>=N?(T.log(v.LogTraceArea.ChatService,"Restarting conversation list sync as last one took too long"),this.forceConversationListSync()):this._nextForcedConversationListSyncTimer=x.default.setTimeout((()=>this.forceConversationListSync()),N))})))),i<=0)return void T.log(v.LogTraceArea.ChatService,"Message/thread sync not kicked: no free fetches");const l=t=>{if(this._messagesSyncing[t])return;const s=this._conversationSyncInfoTransient[t];s&&s.messages&&s.messages.fetchAfterUtc>e?a=Math.min(a,s.messages.fetchAfterUtc):(this._checkSyncStartingForConversation(t),this._messagesSyncing[t]=!0,delete this._syncFailed[t],i--,this._startMessagesSync(t).finally((()=>{delete this._messagesSyncing[t],this._checkSyncFinishedForConversation(t),this._checkSyncProgress()})))},d=t=>{if(this._threadDetailsSyncing[t])return;const s=this._conversationSyncInfoTransient[t];s&&s.thread&&s.thread.fetchAfterUtc>e?a=Math.min(a,s.thread.fetchAfterUtc):(this._checkSyncStartingForConversation(t),this._threadDetailsSyncing[t]=!0,delete this._syncFailed[t],i--,this._fetchThreadDetails(t).finally((()=>{delete this._threadDetailsSyncing[t],this._checkSyncFinishedForConversation(t),this._checkSyncProgress()})))};if(!n.isEmpty(this._prioritizedConversationIds)){this._prunePriorizedConvList();const e=n.sortBy(n.keys(this._prioritizedConversationIds),(e=>-this._prioritizedConversationIds[e].priorityTime));n.each(e,(e=>(this._prioritizedConversationIds[e].needThreadDetails&&(this._threadDetailsStale[e]?d(e):this._prioritizedConversationIds[e].needThreadDetails=!1),this._prioritizedConversationIds[e].needMessages&&(this._messagesStale[e]?i>0&&l(e):this._prioritizedConversationIds[e].needMessages=!1),this._prioritizedConversationIds[e].needMessages||this._prioritizedConversationIds[e].needThreadDetails||delete this._prioritizedConversationIds[e],i>0)))}if(i>0){const e=n.sortBy(n.keys(this._messagesStale),(e=>-this._getConversationSyncSortRank(e)));n.each(e,(e=>(l(e),i>0)))}if(i>0){const e=n.sortBy(n.keys(this._threadDetailsStale),(e=>-this._getConversationSyncSortRank(e)));n.each(e,(e=>(d(e),i>0)))}T.log(v.LogTraceArea.ChatService,"CheckSyncProgress: Conversation List: "+(this._conversationListSyncing?"Syncing":this._conversationListStale?"Stale":"Done")+", Messages: "+n.keys(this._messagesStale).length+" Stale/"+n.keys(this._messagesSyncing).length+" Syncing, Details: "+n.keys(this._threadDetailsStale).length+" Stale/"+n.keys(this._threadDetailsSyncing).length+" Syncing"),a!==Number.MAX_VALUE&&(T.log(v.LogTraceArea.ChatService,"Next sync in "+(Date.now()-a)+"ms"),this._checkSyncProgressCallbackTimer=x.default.setExpiration((()=>this._checkSyncProgress()),a))}_getConversationSyncSortRank(e){return g.default.getConversationMetaFromMemoryCache(e).conv.getSortRank()}_syncConversationList(){const e=this._firstConversationListSync?25:100;this._firstConversationListSync=!1;const t=u.default.getS4LMessagingFeatures().syncSettings,s=["Passport","Skype","Lync","Thread","Agent","ShortCircuit","PSTN"];t&&t.skipConvTypeSmsMms||s.push("SmsMms"),s.push("Flxt","NotificationStream"),t&&!t.skipConvTypeCast&&s.push("Cast"),s.push("ModernBots","secureThreads"),u.default.getS4LContactsFeatures().enableInviteFree&&s.push("InviteFree");const i=s.join("|");this._checkConversationListSyncInfo();let r=this._conversationListSyncInfo?this._conversationListSyncInfo.state:"";return this._conversationListSyncInfo&&this._conversationListSyncInfo.types!==i&&(T.log(v.LogTraceArea.ChatService,"Flushing sync state due to changed conversation types list"),r=""),this._markFullSyncOnce(n.isEmpty(r)),T.log(v.LogTraceArea.ChatService,"Syncing Conversation List, sync state: "+S.encodeSyncStateForLog(r)),p.default.serviceGetMyConversations(i,1,r,e).then((e=>{var t;const s=e.body;if(!s||!s._metadata||n.isNil(s._metadata.syncState))return T.warn(v.LogTraceArea.ChatService,"Conversation List Sync: received empty response "+(s?s._metadata?"syncState":"metadata":"body")),void(this._conversationListWaitForSyncUtc=Date.now()+this._conversationListExponentialTime.getTimeAndCalculateNext());T.log(v.LogTraceArea.ChatService,"Conversation List Sync: "+(s.conversations?s.conversations.length:0)+" updated conversations: "+n.join(n.map(s.conversations,(e=>o.pii.Mri(e.id))),", ")+(s._metadata.backwardLink?", more available":"")),null===(t=this._syncScenario)||void 0===t||t.markStepCompleted("Fetched"),this._conversationListExponentialTime.reset(),n.each(s.conversations,(e=>{S.isAllGlobalClearMri(e.id)||g.default.queueConvUpdate(e)}));const r=u.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enabled,a={state:S.decodeSyncState(s._metadata.syncState),types:i,isMFE:r};return g.default.setConvListSyncInfo(a).always((()=>{var e;this._conversationListSyncInfo=a,n.each(s.conversations,(e=>{const t=g.default.getConversationMetaFromMemoryCache(e.id);t?this._markMessagesAndDetailsStaleAsNeeded(t):T.log(v.LogTraceArea.ChatService,"Cannot mark messages/details as stale - no cached conv meta: "+o.pii.Mri(e.id))})),null===(e=this._syncScenario)||void 0===e||e.markStepCompleted("BundleProcessed");!!s._metadata.backwardLink||(this._conversationListStale=!1,this._checkSyncFinishedForConversationList())}))})).catch((e=>{if(e.errorCode){const t=new b.KpiChatSyncFailure(e.errorCode.toString());t.markConfirmedGoodConnection(F.default.isNetworkingAvailableNoSubscription()),T.track(t)}e.errorCode===S.ChatServiceErrors.InvalidSyncToken?(T.warn(v.LogTraceArea.ChatService,"Conversation List Sync: Bad Sync key, resetting"),this._conversationListSyncInfo=void 0,M.default.putData(f.InternalKeys.ConversationListSyncInfo,this._conversationListSyncInfo),this._checkSyncStartingForConversationList(),this._conversationListStale=!0):(0===e.statusCode?T.log(v.LogTraceArea.ChatService,"Conversation List Sync: Failed due to connectivity issues. Retrying..."):T.warn(v.LogTraceArea.ChatService,"Conversation List Sync: Transient Error: "+e.statusCode+"/"+e.statusText+(e.errorCode?", "+e.errorCode+"/"+e.errorMessage:"")),this._conversationListWaitForSyncUtc=Date.now()+this._conversationListExponentialTime.getTimeAndCalculateNext())}))}_fetchThreadDetails(e){return T.log(v.LogTraceArea.ChatService,"Fetching Thread Details for: "+o.pii.Mri(e)),p.default.serviceGetThread(e).then((t=>(this._resetBackoffTimer(),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].thread,this._checkSyncInfoTransientForClearing(e)),g.default.queueThreadUpdate(t),g.default.processQueuedBundle().always((()=>{delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e)}))))).catch((t=>{if(t.errorCode){const e=new b.KpiChatSyncFailure(t.errorCode.toString());e.markConfirmedGoodConnection(F.default.isNetworkingAvailableNoSubscription()),T.track(e)}if(this._bumpBackoffTimerIfNeeded(t.statusCode),this._isPermanentError(e,t.errorCode))return T.log(v.LogTraceArea.ChatService,"Permanent Error on Thread Details: "+o.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:"")),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].thread,this._checkSyncInfoTransientForClearing(e)),g.default.brickConversation(e).always((()=>{delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e)}));{T.warn(v.LogTraceArea.ChatService,"Error Syncing Thread Details for "+o.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:""));const s=this._getOrCreateSyncInfoTransient(e);s.thread||(s.thread={fetchAfterUtc:0,exponentialTime:new a.ExponentialTime(3e3,3e5),chatServiceErrorCount:0}),s.thread.fetchAfterUtc=Date.now()+s.thread.exponentialTime.getTimeAndCalculateNext(),0!==t.statusCode&&s.thread.chatServiceErrorCount++,s.thread.chatServiceErrorCount>=3&&(T.log(v.LogTraceArea.ChatService,"Too many transient thread details fetch errors, giving up for now: "+o.pii.Mri(e)),this._syncFailed[e]=!0,delete this._threadDetailsStale[e],this._checkSyncFinishedForConversation(e))}}))}_getDesiredMessageHistoryStartTime(e,t){return this._desiredMessageHistoryStartTime[t]||e.messageHistoryStartTime}_startMessagesSync(e){const t=g.default.getConversationMetaFromMemoryCache(e);let s,i,r=!1;const a=!t.syncInfo.messagesSyncState,l=this._getDesiredMessageHistoryStartTime(t.syncInfo,e);this._conversationSyncInfoTransient[e]&&this._conversationSyncInfoTransient[e].nextSyncSinglePage?(s=S.BeginningOfTime,i=30,r=!0):a?(s=Date.now()-S.RecentMessageHistoryTimePeriod,i=20):(s=l,i=20);const d=t.conv.getConsumptionHorizonTimestamp(),c=d?d-1e3:Date.now();return c<s&&(s=c),T.log(v.LogTraceArea.ChatService,"Syncing Messages for "+o.pii.Mri(e)+", Lower bound: "+s+", PageSize "+i+", Stale: "+t.syncInfo.messagesStale+", HistoryStartTime: "+t.syncInfo.messageHistoryStartTime+", DesiredHistoryStartTime: "+l+", SyncState: "+S.encodeSyncStateForLog(t.syncInfo.messagesSyncState)+", StaleReason: "+(void 0===t.syncInfo.messagesStaleReason?"undefined":m.MessagesStaleReason[t.syncInfo.messagesStaleReason])),p.default.serviceGetConversationMessages(e,s,t.syncInfo.messagesSyncState,i).then((i=>{if(!i||!i._metadata||!i.messages)return T.warn(v.LogTraceArea.ChatService,"Syncing Messages for "+o.pii.Mri(e)+" received empty response "+(i?i._metadata?"messages":"metadata":"body")),void this._handleTransientMessageSyncError(e,0);this._resetBackoffTimer(),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].messages,delete this._conversationSyncInfoTransient[e].nextSyncSinglePage,this._checkSyncInfoTransientForClearing(e));const d=!!i._metadata.backwardLink;let u,h,p;if(i.messages.length>0){const t=e,s=n.map(i.messages,(e=>({message:(0,B.tweakMagicBotOneOnOneMessage)(e,!1),origin:v.MessageOrigin.ChatSync,isOtherEndpointActive:!1,reactionUpdates:m.EmptyReactionsUpdate,clientMessageIds:[e.clientmessageid],messageStoreUsed:!1})));g.default.queueMessagesForConversation(t,s),this._accumulateTelemetryData(e,i.messages.length),u=Number(n.minBy(i.messages,(e=>Number(e.version))).version)}d?(h=u||Number.MAX_VALUE,p=R.default.clampValue(l,Date.now()-S.RecentMessageHistoryTimePeriod,h)):(h=Math.min(u||Number.MAX_VALUE,s),p=h);const _=d&&!r&&(!a||h>c),f={messagesStale:_,messagesStaleReason:_?t.syncInfo.messagesStaleReason:void 0,messagesSyncState:S.decodeSyncState(i._metadata.syncState),messageHistoryStartTime:h};return T.log(v.LogTraceArea.ChatService,"Synced Messages for "+o.pii.Mri(e)+": More: "+d+", Count: "+i.messages.length+", Stale: "+_+", HistoryStartTime: "+h+", SyncState: "+S.encodeSyncStateForLog(f.messagesSyncState)),this._desiredMessageHistoryStartTime[e]=p,g.default.queueConvSyncInfoChange(e,f),g.default.processQueuedBundle().always((()=>{f.messagesStale||(delete this._messagesStale[e],this._checkSyncFinishedForConversation(e))}))})).catch((t=>{if(t.errorCode){const e=new b.KpiChatSyncFailure(t.errorCode.toString());e.markConfirmedGoodConnection(F.default.isNetworkingAvailableNoSubscription()),T.track(e)}if(this._bumpBackoffTimerIfNeeded(t.statusCode),this._isPermanentError(e,t.errorCode))return T.log(v.LogTraceArea.ChatService,"Permanent Error Syncing Messages: "+o.pii.Mri(e)+": "+t.statusCode+"/"+t.statusText+(t.errorCode?", "+t.errorCode+"/"+t.errorMessage:"")),this._conversationSyncInfoTransient[e]&&(delete this._conversationSyncInfoTransient[e].messages,delete this._conversationSyncInfoTransient[e].nextSyncSinglePage,this._checkSyncInfoTransientForClearing(e)),g.default.brickConversation(e).always((()=>{delete this._messagesStale[e],this._checkSyncFinishedForConversation(e)}));if(t.errorCode===S.ChatServiceErrors.InvalidSyncToken){T.log(v.LogTraceArea.ChatService,"Bad message sync key for conversation: ",o.pii.Mri(e));const t=g.default.getConversationMetaFromMemoryCache(e),s={messagesStale:!0,messagesStaleReason:m.MessagesStaleReason.NeedSync,messagesSyncState:void 0,messageHistoryStartTime:t.syncInfo.messageHistoryStartTime};return g.default.setConvSyncInfo(e,s)}T.warn(v.LogTraceArea.ChatService,"Error Syncing Messages for "+o.pii.Mri(e)+": "+t.errorCode+" - "+t.errorMessage+", "+t.statusCode+"/"+t.statusText),this._handleTransientMessageSyncError(e,t.statusCode)}))}_handleTransientMessageSyncError(e,t){const s=this._getOrCreateSyncInfoTransient(e);s.messages||(s.messages={fetchAfterUtc:0,exponentialTime:new a.ExponentialTime(3e3,3e5),chatServiceErrorCount:0}),s.messages.fetchAfterUtc=Date.now()+s.messages.exponentialTime.getTimeAndCalculateNext(),0!==t&&s.messages.chatServiceErrorCount++,s.messages.chatServiceErrorCount>=3&&(T.log(v.LogTraceArea.ChatService,"Too many transient message sync errors, giving up for now: "+o.pii.Mri(e)),this._syncFailed[e]=!0,delete this._messagesStale[e],this._checkSyncFinishedForConversation(e))}_isPermanentError(e,t){return!(t!==S.ChatServiceErrors.AccessDenied&&t!==S.ChatServiceErrors.InitiatorNotPartOfThread&&t!==S.ChatServiceErrors.ThreadNotFound)&&(!S.isOneOnOneConversation(e)||(T.track(new C.FundamentalsDebugEvent("BrickOneOnOne","Namespace: "+S.getMriNamespace(e))),!1))}_bumpBackoffTimerIfNeeded(e){(0===e||e>=500&&e<600)&&(this._checkProgressAfter=Date.now()+this._syncExponentialBackoff.getTimeAndCalculateNext())}_resetBackoffTimer(){this._syncExponentialBackoff.reset(),this._checkProgressAfter=0}_startTelemetry(){this._syncTelemetryEvent||(this._syncTelemetryEvent=new b.KpiChatSync),this._syncScenario||(this._syncScenario=new A.default(w.ScenarioName.InitialRecentsSync),this._syncScenario.start())}_stopTelemetry(){this._markFirstSyncOnce(),this._trackSyncTelemetry(),this._stopSyncScenario(),this._syncDataAccumulator.reset()}_stopSyncScenario(){this._syncScenario&&(this._syncScenario.finish(this._syncDataAccumulator.getData()),this._syncScenario=void 0)}_trackSyncTelemetry(){this._syncTelemetryEvent&&(this._syncTelemetryEvent.markConfirmedGoodConnection(F.default.isNetworkingAvailableNoSubscription()),this._syncTelemetryEvent.endSync(this._syncDataAccumulator.getData()),T.track(this._syncTelemetryEvent),this._syncTelemetryEvent=void 0)}_accumulateTelemetryData(e,t){this._syncDataAccumulator.accumulateData(e,t)}_checkConversationListSyncInfo(){const e=u.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enabled;this._conversationListSyncInfo&&this._conversationListSyncInfo.isMFE!==e&&(this._conversationListSyncInfo=void 0,M.default.putData(f.InternalKeys.ConversationListSyncInfo,this._conversationListSyncInfo))}test_reset(){this._appStateSubToken&&this._appStateSubToken.unsubscribe(),this._connectedSubToken&&this._connectedSubToken.unsubscribe(),this._convSubToken&&this._convSubToken.unsubscribe(),this._messagesStale={},this._threadDetailsStale={},this._messagesSyncing={},this._threadDetailsSyncing={},this._conversationSyncInfoTransient={},this._resetBackoffTimer(),this._conversationListWaitForSyncUtc=0,this._conversationListExponentialTime.reset()}}},756700:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importDefault(s(659938)),a=(i.__importDefault(s(150343)),i.__importDefault(s(256468))),l=i.__importStar(s(44717)),d=(s(815146),i.__importStar(s(85385)),i.__importDefault(s(114818)));class c extends a.default{constructor(e,t,s,i,a,l=o.noop){super(e,t,l,a),this._baseInterestedResources=s,this._enabled=i,this._presenceTrackedMrisDesired=[],r.default.subscribeForChanges("LongPollSubscription",(e=>{e===n.Types.AppActivationState.Active&&this._resetBackoffs(),this._checkState()})),this._updateDesiredParams()}logout(){this._subscriptionInfoUpdated(void 0),this.setEnabled(!1),this.cancelPendingLongPollRequest("logout")}setEnabled(e){this._enabled!==e&&(this._enabled=e,this._checkState())}setPresenceMriTrackingList(e){(0,d.default)(e,this._presenceTrackedMrisDesired)||(this._presenceTrackedMrisDesired=e,this._updateDesiredParams())}setInterestedResources(e){this._baseInterestedResources=e,this._updateDesiredParams()}_updateDesiredParams(){const e=this._baseInterestedResources.concat(o.map(this._presenceTrackedMrisDesired,(e=>"/v1/users/ME/contacts/"+e)));this._setDesiredSubParameters(l.createLongPollSubscriptionParams(e))}_subscriptionAllowed(){return!!this._enabled&&super._subscriptionAllowed()}}t.default=c},857981:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=s(662783),a=i.__importStar(s(397691)),l=i.__importDefault(s(150343)),d=s(335103),c=i.__importDefault(s(680954)),u=i.__importStar(s(44717)),h=s(815146),p=i.__importDefault(s(782829)),g=s(654519),m=i.__importStar(s(222420)),S=i.__importDefault(s(760989)),_=i.__importDefault(s(220534)),f=i.__importStar(s(85385)),y=s(120695),v=s(669431);class C extends g.SkypeRestClient{constructor(e){super(C._getEcsEndpointUrl()),this._errorHandler=e,this._lastEcsHostUrl=void 0,this._customErrorHandler=(e,t)=>{this._updateRegistrationToken(t);const s=e.getOptions(),i=t.requestOptions,o=this._customErrorHandlerHelper(t,e,s);switch(o){case r.ErrorHandlingType.DoNotRetry:i.reliabilityTracker.failed(t);break;case r.ErrorHandlingType.PauseUntilResumed:case r.ErrorHandlingType.RetryCountedWithBackoff:case r.ErrorHandlingType.RetryUncountedImmediately:case r.ErrorHandlingType.RetryUncountedWithBackoff:i.reliabilityTracker.retry(t);break;default:S.default.switchStatementExhaustiveChecking(o)}return o},this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.augmentErrorResponse=this._errorHandler.augmentErrorResponse}startup(){l.default.subscribe((()=>{this._resetEndpointUrlIfEcsChanged(!1)})),this._resetEndpointUrlIfEcsChanged(!0)}static _getEcsEndpointUrl(){var e,t;return null!==(t=null===(e=l.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===e?void 0:e.host)&&void 0!==t?t:""}_resetEndpointUrlIfEcsChanged(e){const t=C._getEcsEndpointUrl();t!==this._lastEcsHostUrl&&(f.log(h.LogTraceArea.ChatServiceTransport,"[MFE] ECS configuration of host URL have changed: "+o.pii.Omit(this._lastEcsHostUrl||"")+" => "+o.pii.Omit(t)),this._trackRedirectEvent(e?"startup":"ecs",this._lastEcsHostUrl,t),this._lastEcsHostUrl=t,this._endpointUrl=t)}handleLocationChange(e){const t=_.default.getURIComponents(e),s=_.default.getURIComponents(this._endpointUrl);if(!t||!s||!t.host)return void f.warn(h.LogTraceArea.ChatServiceTransport,"[MFE] failed to parse redirect url "+o.pii.Omit(e));const i=u.calculateEndpointUrl({protocol:t.protocol,host:t.host,path:s.pathname});if(this._endpointUrl===i)return f.warn(h.LogTraceArea.ChatServiceTransport,"[MFE] got redirected to the same location "+o.pii.Omit(i)),void f.track(new y.FundamentalsDebugEvent("MfeSameLocationRedirect",s.host+"/"));f.log(h.LogTraceArea.ChatServiceTransport,"[MFE] Endpoint URL changed: "+o.pii.Omit(this._endpointUrl)+" => "+o.pii.Omit(i)),this._trackRedirectEvent("service",this._endpointUrl,i),this._endpointUrl=i}resetBackoffTimers(){this._errorHandler.getLoginTimer().reset()}_trackRedirectEvent(e,t,s){f.track(new v.ChatServiceRedirectEvent({source:e,targetEnvironment:u.getEnvironmentNameFromUrl(s),previousEnvironment:u.getEnvironmentNameFromUrl(t),targetUrl:o.pii.Omit(s),previousUrl:t?o.pii.Omit(t):void 0}))}_getHeaders(e){const t=super._getHeaders(e);t.Authentication=m.getSkypetokenHeaderValue();const s=p.default.getRegistrationToken();l.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&s&&(t.RegistrationToken=s),t.ClientInfo=u.getClientInfoString(),t["X-ECS-Etag"]=l.default.getCachedEcsConfigEtag();const i=u.getClientCapabilities();return i&&(t["X-Client-Capabilities"]=i),t.BehaviorOverride="redirectAs404",t["MS-IC3-Product"]="Sfl",e.counterPartyMri&&(t["Counterparty-User-Id"]=e.counterPartyMri),t}_blockRequestUntil(e){const t=[super._blockRequestUntil(e)];return t.push(this._errorHandler.get429Timer().getPromise(),this._errorHandler.getRetryAfterTimer().getPromise(e)),e.isLoginRequest&&t.push(this._errorHandler.getLoginTimer().getPromise()),a.all(t).then(n.noop)}_customErrorHandlerHelper(e,t,s){const i=this._errorHandler.getRegistrationTokenFromHeaders(t.getRequestHeaders()),o=this._errorHandler.getSkypetokenFromHeaders(t.getRequestHeaders()),n=this._errorHandler.handleChatServiceFailure("MessagingRestClient",e,o,i,p.default.getEndpointInfo().id,s,h.ChatServiceConnectionType.MessagingApi);if(n===d.ChatServiceErrorTypes.LocationChanged&&e.headers.location)return t.setUrl(e.headers.location),r.ErrorHandlingType.RetryUncountedImmediately;switch(n){case d.ChatServiceErrorTypes.TooManyRequests:case d.ChatServiceErrorTypes.LoginRateLimitExceeded:case d.ChatServiceErrorTypes.LoginRequestError:return r.ErrorHandlingType.RetryUncountedWithBackoff}return e.statusCode>=500?r.ErrorHandlingType.RetryCountedWithBackoff:(0,r.DefaultErrorHandler)(t,e)}_processSuccessResponse(e){e.requestOptions.reliabilityTracker.succeeded(e),this._errorHandler.get429Timer().reset(),this._updateRegistrationToken(e)}_updateRegistrationToken(e){if(l.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&e.headers&&e.headers["set-registrationtoken"]){const t=e.headers["set-registrationtoken"];p.default.setRegistrationToken(t)}}debug_getCurrentCloudUrl(){return this._endpointUrl}performRequest(e,t){const s={scenario:e.scenario,reliabilityTracker:new c.default(e.scenario,h.ChatServiceConnectionType.MessagingApi),contentType:e.mediaType};return s.reliabilityTracker.begin(),m.applyRestRequestTimeoutOverride(e.scenario,s),super.performRequest(e,n.extend(s,t)).done((()=>{s.reliabilityTracker.ensureResolved()})).fail((e=>{e.invalidNullBody?s.reliabilityTracker.ensureResolved():s.reliabilityTracker.ensureRejected()}))}performRequestBackground(e,t,s,i){return i=i||{},m.applyRestRequestTimeoutOverride(s.scenario,i),super.performRequestBackground(e,t,s,i)}}t.default=C},471782:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=s(662783),a=i.__importStar(s(397691)),l=i.__importDefault(s(150343)),d=s(335103),c=s(135356),u=i.__importDefault(s(680954)),h=i.__importStar(s(44717)),p=s(815146),g=s(120695),m=i.__importStar(s(85385)),S=i.__importDefault(s(756700)),_=i.__importDefault(s(201721)),f=s(96575),y=i.__importDefault(s(782829)),v=s(654519),C=i.__importDefault(s(655192)),T=i.__importDefault(s(535775)),M=i.__importDefault(s(722538)),b=i.__importStar(s(517518)),I=i.__importStar(s(222420)),w=i.__importDefault(s(220534)),P=i.__importDefault(s(760989)),k=s(567567),A=new r.ExponentialTime(1e3,2e4);class x extends v.SkypeRestClient{constructor(e,t,s,i){super(y.default.calcChatV1EndpointUrl()),this._chatServiceClient=e,this._handleEvents=t,this._subscriptionStateChanged=s,this._errorHandler=i,this._connectivityEnabled=!1,this._checkStateInside=!1,this._checkStatePending=!1,this._timeToConnectedTelemetry=new T.default(f.ScenarioName.TimeToConnected),this._nextAllowedPresencePublish=0,this._uedIsExclusive=!1,this._restEndpointUrlChangedCallback=()=>{const e=y.default.calcChatV1EndpointUrl();m.log(p.LogTraceArea.ChatServiceTransport,"RestEndpointUrlChanged callback fired."),e!==this._endpointUrl&&(m.log(p.LogTraceArea.ChatServiceTransport,`Updating endpoint URL to ${o.pii.Omit(e)}`),this.handleLocationChange(e))},this._customErrorHandler=(e,t)=>{M.default.putCurrentServiceTime(Date.parse(t.headers.date),0),this._updateRegistrationToken(t);const s=e.getOptions(),i=t.requestOptions,o=this._customErrorHandlerHelper(t,e,s);switch(o){case r.ErrorHandlingType.DoNotRetry:i.reliabilityTracker.failed(t);break;case r.ErrorHandlingType.PauseUntilResumed:case r.ErrorHandlingType.RetryCountedWithBackoff:case r.ErrorHandlingType.RetryUncountedImmediately:case r.ErrorHandlingType.RetryUncountedWithBackoff:i.reliabilityTracker.retry(t);break;default:P.default.switchStatementExhaustiveChecking(o)}return o},this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.augmentErrorResponse=this._errorHandler.augmentErrorResponse}startup(){const{chatServiceHostRefreshEnabled:e,chatServiceHostRefreshInterval:t,authentication:s}=l.default.getConfigSettings().chat;e&&!t&&y.default.setRestEndpointUrl(y.default.calcChatV1EndpointUrl()),this._endpointUrl=y.default.getRestEndpointUrl()||y.default.calcChatV1EndpointUrl(),s.useRegToken||(m.log(p.LogTraceArea.ChatServiceTransport,"Registration token auth disabled, setting reg token to undefined"),y.default.setRegistrationToken(void 0)),b.default.subscribe((()=>{y.default.setRegistrationToken(void 0),this._checkState()}),b.TriggerKeys.SkypeTokenKey),l.default.subscribe((()=>{const{blacklistedHosts:e,chatServiceHostRefreshEnabled:t,authentication:s}=l.default.getConfigSettings().chat;s.useRegToken||(m.log(p.LogTraceArea.ChatServiceTransport,"Registration token auth disabled, setting reg token to undefined"),y.default.setRegistrationToken(void 0));const i=l.default.getS4LMessagingFeaturesNoSubscription().ued;this._uedIsExclusive!==(i&&i.isExclusive)&&(this._uedIsExclusive=i&&i.isExclusive,this._longPollSubscription&&this._longPollSubscription.setInterestedResources(this._calculateInterestedResources())),n.includes(e,this._endpointUrl)&&this.handleLocationChange(y.default.calcChatV1EndpointUrl()),t&&!this._handleLocationChange?this._handleLocationChange=y.default.restEndpointUrlChanged.subscribe(this._restEndpointUrlChangedCallback):!t&&this._handleLocationChange&&(this._handleLocationChange.unsubscribe(),this._handleLocationChange=void 0),this._checkState()}));const i=l.default.getConfigSettings().chat.blacklistedHosts;n.includes(i,this._endpointUrl)&&this.handleLocationChange(y.default.calcChatV1EndpointUrl());const o=y.default.getEndpointInfo(),r=l.default.getS4LMessagingFeaturesNoSubscription().ued;this._uedIsExclusive!==(r&&r.isExclusive)&&(this._uedIsExclusive=r&&r.isExclusive),_.default.subscribe((()=>{this._longPollSubscription&&(this._longPollSubscription.setInterestedResources(this._calculateInterestedResources()),m.log(p.LogTraceArea.ChatServiceTransport,"MyUserPreferencesLocalStore: kick checkState in RestTransport"),this._checkState())})),m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Started Up. EndpointInfo: "+h.encodeEndpointInfoForLog(o)),this._longPollSubscription=new S.default(this._chatServiceClient,"LongPoll",this._calculateInterestedResources(),this._connectivityEnabled,this._handleEvents,((e,t)=>{(e===c.SubscriptionState.CreatedActive||c.SubscriptionState.CreatedLongPollTrouble)&&this._timeToConnectedTelemetry.hasStarted()&&(this._timeToConnectedTelemetry.finish(),this._timeToConnectedTelemetry.reset()),this._subscriptionStateChanged(e,t)})),this._pendingPresenceMriTrackingList&&(this._longPollSubscription.setPresenceMriTrackingList(this._pendingPresenceMriTrackingList),this._pendingPresenceMriTrackingList=void 0)}logout(){this.setConnectionEnabled(!1,"logout"),this._longPollSubscription&&this._longPollSubscription.logout()}handleLocationChange(e,t){const s=w.default.getURIComponents(e),i=w.default.getURIComponents(this._endpointUrl);if(s&&i&&s.host){const e=h.calculateEndpointUrl({protocol:s.protocol,host:s.host,path:i.pathname});if(this._endpointUrl!==e)return m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint URL Changed: "+o.pii.Omit(this._endpointUrl)+" => "+o.pii.Omit(e)),this._endpointUrl=e,y.default.setRestEndpointUrl(e),!0;{m.warn(p.LogTraceArea.ChatServiceTransport,"RestTransport got response to change endpoint to the same thing: "+o.pii.Omit(e)),m.track(new g.FundamentalsDebugEvent("ChatServiceSameLocationRedirect",i.host+"/"));const s=l.default.getConfigSettingsNoSubscription().chat;if(s.recreateEndpointOnSameLocationRedirect&&(!s.msgApiConfig.enabled||!s.msgApiConfig.isExclusive)){const e=y.default.getEndpointInfo().id;I.getDurableEndpointId().then((s=>{let i;i=e&&h.areEndpointIdsEqual(e,s)?this._chatServiceClient.serviceDeleteEndpoint(e).then((()=>{m.warn(p.LogTraceArea.ChatServiceTransport,"Deleted endpoint ID "+e+" before recreating")})).catch((t=>{m.log(p.LogTraceArea.ChatServiceTransport,"Failed to delete endpoint ID "+e+" before recreating: "+C.default.errorAsString(t))})):a.Resolved(),i.then((()=>{const e=y.default.calcChatV1EndpointUrl();this._endpointUrl!==e&&(this._endpointUrl=e,y.default.setRestEndpointUrl(this._endpointUrl)),y.default.updateEndpointInfo({id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Redirect to same URL",tcid:t})}))}))}}}return!1}debug_getCurrentCloudUrl(){return this._endpointUrl}setPresenceMriTrackingList(e){this._longPollSubscription?this._longPollSubscription.setPresenceMriTrackingList(e):this._pendingPresenceMriTrackingList=e}resetBackoffTimers(){this._errorHandler.getLoginTimer().reset(),this._checkState()}isConnectionEnabled(){return this._connectivityEnabled}setConnectionEnabled(e,t){if(this._connectivityEnabled!==e){if(e){const e={ConnectionType:"REST",ReasonForConnecting:t};this._timeToConnectedTelemetry.start(e)}else this._timeToConnectedTelemetry.hasStarted()&&(this._timeToConnectedTelemetry.fail(t),this._timeToConnectedTelemetry.reset());this._connectivityChangeReason=t,m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport setConnectionEnabled: "+e+", reason: "+t),this._connectivityEnabled=e,this._longPollSubscription&&this._longPollSubscription.setEnabled(this._connectivityEnabled),this._checkState()}}endpointInfoUpdated(e,t){m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint Info Updated: "+h.encodeEndpointInfoForLog(e)),this._longPollSubscription&&this._longPollSubscription.endpointInfoUpdated(e,t),this._checkState()}_getEndpointFeaturesList(){return h.getEndpointFeaturesList()}_calculateInterestedResources(){return I.calculateInterestedResources(!this._uedIsExclusive)}_endpointPresencePublished(e,t){const s=y.default.getEndpointInfo();h.areEndpointIdsEqual(s.id,e)?s.exists?(m.log(p.LogTraceArea.ChatService,"Endpoint "+e+" presence published"),y.default.updateEndpointInfo({presenceDocPublished:t,reason:"Presence published"})):m.warn(p.LogTraceArea.ChatServiceTransport,"_endpointPresencePublished called with non-existing endpoint"):m.warn(p.LogTraceArea.ChatServiceTransport,"_endpointPresencePublished called with stale endpointid")}_checkState(){this._checkStateInside?this._checkStatePending=!0:(this._checkStateInside=!0,I.calculateDesiredEndpointId().then((e=>{this._checkStateInner(e),this._checkStateInside=!1,this._checkStatePending&&(this._checkStatePending=!1,this._checkState())})))}_checkStateInner(e){if(!(this._connectivityEnabled&&b.default.hasUsableSkypeToken())){if(m.log(p.LogTraceArea.ChatServiceTransport,"Cancelling requests in flight, reason: "+this._connectivityChangeReason),this._endpointCreationInFlight){const e=this._endpointCreationInFlight;this._endpointCreationInFlight=void 0,e.cancel()}if(this._presencePublishInFlight){const e=this._presencePublishInFlight;this._presencePublishInFlight=void 0,e.cancel()}return}const t=y.default.getEndpointInfo(),s=this._getEndpointFeaturesList(),i=l.default.getCachedEcsConfigEtag(),o=l.default.getConfigSettings().chat;if(!t.exists||!t.id||!h.areEndpointIdsEqual(t.id,e)||t.featureFlags!==s||o.updateEndpointOnEcsEtagChange&&t.ecsEtag!==i){if(this._endpointCreationInFlight||o.msgApiConfig.enabled&&o.msgApiConfig.isExclusive)return;return m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Creating/Updating Endpoint. Features: "+s+(t.id?", Given Id: "+t.id:"")+", Desired Id: "+e),this._endpointCreationInFlight=this.createOrUpdateEndpoint(e,i),void this._endpointCreationInFlight.finally((()=>{this._endpointCreationInFlight=void 0})).then((t=>(this._errorHandler.getLoginTimer().reset(),I.getDurableEndpointId().then((s=>{(!e||!y.default.endpointExists()||h.areEndpointIdsEqual(t.id,y.default.getEndpointId())||h.areEndpointIdsEqual(s,t.id)||h.areEndpointIdsEqual(s,y.default.getEndpointId()))&&(m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Endpoint Created/Updated: "+h.encodeEndpointInfoForLog(t)),y.default.updateEndpointInfo(t))}))))).catch((e=>{e&&0!==e.statusCode?m.warn(p.LogTraceArea.ChatServiceTransport,"Endpoint Creation failure: "+e.statusCode+"/"+e.statusText+", "+e.errorCode+"/"+e.errorMessage):m.log(p.LogTraceArea.ChatServiceTransport,"Endpoint Creation failure: Empty error or connectivity issues. Reconnecting.")})).finally((()=>{this._checkState()}))}const r=t.id,a=I.calculateDesiredEndpointPresenceDoc(),d=(0,k.areEndpointPresenceDocsEqual)(t.presenceDocPublished,a);if(!(d||o.msgApiConfig.enabled&&o.msgApiConfig.isExclusive)){if(this._presencePublishInFlight)return;if(Date.now()<this._nextAllowedPresencePublish){if(n.isUndefined(this._delayedPresencePublish)){const e=this._nextAllowedPresencePublish-Date.now();m.log(p.LogTraceArea.ChatServiceTransport,`Delaying presence publishing for ${e} ms`),this._delayedPresencePublish=n.delay((()=>this._checkState()),e)}return}return this._delayedPresencePublish=void 0,m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Publishing Presence on Endpoint: "+JSON.stringify(a)),void this._publishEndpointPresence(r,a)}}_publishEndpointPresence(e,t){this._presencePublishInFlight=this._chatServiceClient.servicePublishEndpointPresence(e,t),this._presencePublishInFlight.finally((()=>{this._presencePublishInFlight=void 0})).then((()=>{this._errorHandler.getLoginTimer().reset(),A.reset(),h.areEndpointIdsEqual(e,y.default.getEndpointId())?(m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Presence Published on Endpoint: "+e),this._endpointPresencePublished(e,t)):this._checkState()})).catch((t=>{if(this._nextAllowedPresencePublish=Date.now()+A.getTimeAndCalculateNext(),t&&404===t.statusCode)return m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Presence Publish reported missing endpoint: "+e),void y.default.markEndpointMissing(e,h.getTcidDataFromServerMessageResponse(t));t&&0!==t.statusCode?m.warn(p.LogTraceArea.ChatServiceTransport,"Presence Publish failure: "+t.statusCode+"/"+t.statusText+", "+t.errorCode+"/"+t.errorMessage+". Retrying..."):m.log(p.LogTraceArea.ChatServiceTransport,"Presence Publish failure: Empty error or connectivity issues. Retrying..."),this._checkState()}))}createOrUpdateEndpoint(e,t){const s=this._getEndpointFeaturesList();return m.log(p.LogTraceArea.ChatServiceTransport,"RestTransport Creating/Updating Endpoint. Features: "+s+(e?", Given Id: "+e:"")),e?this._chatServiceClient.serviceUpdateEndpoint(e,s).then((e=>{const i=h.findPushSubscriptionInfo(e.endpoint.subscriptions);return n.assign({id:e.endpoint.id,exists:!0,featureFlags:s,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,ecsEtag:t,reason:"REST update endpoint",tcid:e.tcid},i)})):this._chatServiceClient.serviceCreateEndpoint(s).then((e=>({id:e.endpointId,exists:!0,featureFlags:s,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,ecsEtag:t,reason:"REST create endpoint",tcid:e.tcid})))}_getHeaders(e){const t=super._getHeaders(e);t.Authentication=I.getSkypetokenHeaderValue();const s=l.default.getConfigSettingsNoSubscription().chat.authentication,i=y.default.getRegistrationToken();return s.useRegToken&&i&&!e.isSkypetokenOnlyRequest&&(t.RegistrationToken=i),e.endpointId&&(t.EndpointId=e.endpointId),t.ClientInfo=h.getClientInfoString(),t.BehaviorOverride="redirectAs404",t["X-ECS-Etag"]=l.default.getCachedEcsConfigEtag(),t}_blockRequestUntil(e){const t=[super._blockRequestUntil(e)];return t.push(this._errorHandler.get429Timer().getPromise()),this._errorHandler.getRedirectTimer().getBumpCount()>1&&t.push(this._errorHandler.getRedirectTimer().getPromise()),e.isLoginRequest&&t.push(this._errorHandler.getLoginTimer().getPromise()),a.all(t).then(n.noop)}_customErrorHandlerHelper(e,t,s){const i=this._errorHandler.getRegistrationTokenFromHeaders(t.getRequestHeaders()),o=this._errorHandler.getSkypetokenFromHeaders(t.getRequestHeaders()),n=this._errorHandler.handleChatServiceFailure("RestTransport",e,o,i,y.default.getEndpointInfo().id,s,p.ChatServiceConnectionType.ChatServiceV1);if(n===d.ChatServiceErrorTypes.LocationChanged&&e.headers.location)return t.setUrl(e.headers.location),r.ErrorHandlingType.RetryUncountedImmediately;switch(n){case d.ChatServiceErrorTypes.TooManyRequests:case d.ChatServiceErrorTypes.LoginRateLimitExceeded:case d.ChatServiceErrorTypes.LoginRequestError:return r.ErrorHandlingType.RetryUncountedWithBackoff}return(0,r.DefaultErrorHandler)(t,e)}_processSuccessResponse(e){e.requestOptions.reliabilityTracker.succeeded(e),M.default.putCurrentServiceTime(Date.parse(e.headers.date),0),this._errorHandler.get429Timer().reset(),this._errorHandler.getRedirectTimer().reset(),this._updateRegistrationToken(e)}_updateRegistrationToken(e){if(l.default.getConfigSettingsNoSubscription().chat.authentication.useRegToken&&e.headers&&e.headers["set-registrationtoken"]){const t=e.headers["set-registrationtoken"];y.default.setRegistrationToken(t)}}performRequest(e,t){const s={scenario:e.scenario,reliabilityTracker:new u.default(e.scenario,p.ChatServiceConnectionType.ChatServiceV1),contentType:e.mediaType};return s.reliabilityTracker.begin(),e.endpointId&&(s.endpointId=e.endpointId),I.applyRestRequestTimeoutOverride(e.scenario,s),super.performRequest(e,n.extend(s,t)).done((()=>{s.reliabilityTracker.ensureResolved()})).fail((e=>{e.invalidNullBody?s.reliabilityTracker.ensureResolved():s.reliabilityTracker.ensureRejected()}))}performRequestBackground(e,t,s,i){return i=i||{},I.applyRestRequestTimeoutOverride(s.scenario,i),super.performRequestBackground(e,t,s,i)}}t.default=x},222420:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calculateDesiredEndpointPresenceDoc=function(){return d.buildEndpointPresenceDocData(["Audio","Video"])},t.calculateInterestedResources=function(e,t){const s=o.map(t,(e=>"/v1/users/ME/contacts/"+e));if(e)return a.PrimaryResourcesToTrack.concat(s);const{enableE2eeRequests:i}=r.default.getConfigSettingsNoSubscription().chat.msgApiConfig;if(!i)return m.Instrumentation.log(g.LogTraceArea.ChatService,"Adding fake resource subscription to prevent endpoint expiration on CSv1"),[...s,a.EndpointExpirationWorkaroundResource];return s},t.calculateV2InterestedResources=function(){return a.PrimaryResourcesToTrack},t.calculatePnhInterestedResources=function(){return a.PnhResourcesToTrack},t.getDurableEndpointId=S,t.calculateDesiredEndpointId=function(){const e=r.default.getConfigSettingsNoSubscription().chat.durableEndpointId,t=c.default.getEndpointInfo().id;if(t)return e.recreateToMatchEnabled?S().then((s=>e.enabled?s||t:l.areEndpointIdsEqual(t,s)?void 0:t)):n.Resolved(t);return e.enabled?S().then((e=>e)):n.Resolved(void 0)},t.getSkypetokenHeaderValue=function(){return l.SKYPE_TOKEN_HEADER_PREFIX+h.default.getRawSkypeToken()},t.applyRestRequestTimeoutOverride=function(e,t){const s=r.default.getConfigSettingsNoSubscription().chat.RESTRequestTimeouts;s&&(t.timeout=s.scenarioTimeouts&&s.scenarioTimeouts[e]||t.timeout,t.timeout=t.timeout||s.defaultTimeout)};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(150343)),a=s(135356),l=i.__importStar(s(44717)),d=i.__importStar(s(567567)),c=i.__importDefault(s(782829)),u=i.__importDefault(s(902530)),h=i.__importDefault(s(517518)),p=i.__importDefault(s(760989)),g=s(815146),m=s(82485);function S(){return u.default.EdfRegistrationId.waitUntilSet().then((()=>{const e=u.default.EdfRegistrationId.get();return e&&p.default.isFormattedGuid(e)?l.formatEndpointId(e):void 0}))}},433614:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentToAccessibilityLabelTransformer=void 0,t.toAccessibilityLabel=function(e,t){const s=t.message;let i="";try{const s=o.defaults(t,{options:t,processing:{},onlyEmoticons:e.hasOnlyEmoticonsOrWhitespaceText(),utfFallback:!1,onlyQuotedContent:e.hasOnlyQuotedContent(),lineBreakString:"",includeSenderInformationInAccessibilityLabel:!0,includeReactionInformationInAccessibilityLabel:!0,includeMediaAlbumItemCountInAccessibilityLabel:!0,messageAccessibilityType:S.MessageAccessibilityType.Text}),n=new x(s);i=n.transform(e).value||""}catch(e){v.error(_.LogTraceArea.GenericUnsafe,"ContentToAccessibilityLabelTransformer: Failed to transform tree: "+k.default.errorAsString(e))}const n=s.isSendRejected(),r=s.isUnsent(),c=o.find(e.children,(e=>e instanceof M.PartListNode));if(c){const e=a.default.getCallLog(c.callId),t=l.default.calculateCallMarkerInfo(c,e);i=l.CallMarkerDisplayUtils.getTextForAccessibilityLabel(t.type)}t.message.isAlbum()&&!t.includeMediaAlbumItemCountInAccessibilityLabel&&(i=C.getString("AccessibilityLabel.MediaAlbumPhotosNoCount"));s.isReported()&&(i=C.getString("MessageContentNodes.ReportedMessageFallback"));if(!t.includeSenderInformationInAccessibilityLabel)return n?C.getString("AccessibilityLabel.FailedTextMessage",{messageContent:i}):r&&P.default.shouldAnnounceForAccessibility()?C.getString("AccessibilityLabel.TextMessageSending",{messageContent:i}):i;let h=s.creator,g=s.createdTime;const m=s.isBookmarkSourceForCurrentUser(),f=s.isBookmark();let y,T;if(f){const e=d.getBookmarkMetadata(s.properties),t=e&&e.bookmarkSourceCreatorId,i=e&&e.bookmarkSourceComposeTime;t&&(h=t,y=e&&e.bookmarkSourceConversationName),i&&(g=o.toNumber(i))}const I={senderName:(0,p.displayNameText)(h,h),timestamp:f?u.default.getDisplayDateStringDayMonthYearFormat(g):u.default.getDisplayTimeString(g),messageContent:i};if(f)I.receiverConversationName=!y&&b.default.isMyMri(s.creator)?C.getString("DisplayInfoStore.ListMyName"):y,T=C.getString("AccessibilityLabel.BookmarkMessage",I);else switch(t.messageAccessibilityType){case S.MessageAccessibilityType.Media:T=r?C.getString("AccessibilityLabel.MediaMessageSending",I):C.getString("AccessibilityLabel.MediaMessage",I);break;case S.MessageAccessibilityType.Call:T=C.getString("AccessibilityLabel.CallMessage",I);break;default:T=n?C.getString("AccessibilityLabel.FailedTextMessage",{messageContent:C.getString("AccessibilityLabel.TextMessage",I)}):r&&P.default.shouldAnnounceForAccessibility()?C.getString("AccessibilityLabel.TextMessageSending",{messageContent:C.getString("AccessibilityLabel.TextMessage",I)}):d.isThreadActivityType(s.messagetype)||s.isEmote()?C.getString("AccessibilityLabel.SystemMessage",I):s.isEdited()?C.getString("AccessibilityLabel.EditedTextMessage",I):s.messagetype===d.MessageTypes.CallerID?i:C.getString("AccessibilityLabel.TextMessage",I)}m&&(T=C.getString("AccessibilityLabel.BookmarkedMessage",{messageContent:T}));if(!t.includeReactionInformationInAccessibilityLabel)return T;const w=s.getReactions(),A=o.map(w,(e=>D(t.message.conversationId,e))).join("");return T+A},t.getAccessibilityLabelForReaction=D,t.toAccessibilityTraits=function(e){return};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=i.__importDefault(s(925494)),a=i.__importDefault(s(851692)),l=i.__importStar(s(788286)),d=i.__importStar(s(971988)),c=s(591312),u=i.__importDefault(s(389659)),h=i.__importDefault(s(601976)),p=s(229620),g=i.__importStar(s(732572)),m=i.__importDefault(s(794229)),S=i.__importStar(s(242561)),_=s(815146),f=i.__importDefault(s(61784)),y=i.__importDefault(s(532016)),v=i.__importStar(s(85385)),C=i.__importStar(s(704704)),T=i.__importDefault(s(656681)),M=s(606933),b=i.__importDefault(s(363091)),I=i.__importDefault(s(994962)),w=i.__importDefault(s(374503)),P=i.__importDefault(s(791384)),k=i.__importDefault(s(655192)),A=i.__importDefault(s(989314));class x extends c.ContentToTextTransformer{constructor(){super(...arguments),this.transformPictureNode=e=>({value:C.getString("AccessibilityLabel.Picture"),stopProcessing:!1}),this.transformMediaAlbumNode=e=>{const t=e.getAlbumId();let s="";if(t){const e=T.default.getAllMediaMessagesForAlbum(t).length;s=C.getString("AccessibilityLabel.Photos",{count:e})}return{value:s,stopProcessing:!1}},this.transformVideoNode=e=>({value:e.getSubType()===d.UriObjectTypeSubTypes.Video.CallRecording?C.getString("AccessibilityLabel.CallRecording",{numberOfDays:n.default.getS4LCMCFeatures().callRecorderRetentionDurationDays}):C.getString("AccessibilityLabel.Video"),stopProcessing:!1}),this.transformVideoMessageNode=e=>({value:C.getString("AccessibilityLabel.VideoMessage"),stopProcessing:!1}),this.transformAudioNode=e=>({value:C.getString("AccessibilityLabel.Audio"),stopProcessing:!1}),this.transformAudioMessageNode=e=>{const t=e.getAudioDurationMs(),s=t?Math.round(t/1e3):0,i=u.default.getFormattedDuration(s,!0);return{value:C.getString("AccessibilityLabel.AudioMessage",{duration:i}),stopProcessing:!1}},this.transformUriObjectFileNode=e=>{const t=new r.default(e.getFileContentUrlSanitized()).getDocumentId(),s=f.default.formatFileSize(e.getSizeInBytes(),1).formattedString;let i;i=t&&y.default.getLocalUri(t)?C.getString("AccessibilityLabel.OpenFile",{fileSize:s}):C.getString("AccessibilityLabel.DownloadFile",{fileSize:s});return{value:C.getString("AccessibilityLabel.Document",{documentName:e.getNameForUI(),fileLabel:i}),stopProcessing:!1}},this.transformLocationNode=e=>({value:C.getString("AccessibilityLabel.Location",{locationName:e.addressFriendlyNameSanitized,address:e.addressSanitized}),stopProcessing:!1}),this.transformStickerNode=e=>({value:C.getString("AccessibilityLabel.Sticker",{stickerName:e.getNameForUI()}),stopProcessing:!1}),this.transformAtMentionNode=e=>{const t=this._renderTextNodes(e.children);let s=t.value;return e.isAllMention()&&(s=e.getLocalizedAllMention()),{value:"("+s+")",stopProcessing:t.stopProcessing}},this.transformScheduledCallInviteNode=e=>{let t="";const s=I.default.getScheduledCallById(e.scheduledCallId);return s&&(t=w.default.getAccessibilityLabelForScheduledCall(s)),{value:t,stopProcessing:!1}},this.transformPollNode=e=>({value:C.getString("Poll.StreamItemAccessibilityLabel",{question:e.title}),stopProcessing:!1}),this.transformCallerIDNode=e=>({value:C.getString("CallerIdPrompt.CallerIDInChatIntro"),stopProcessing:!1})}_renderTextNodes(e){return super._renderTextNodes(e," ")}transformEmoticonNode(e){let t=e.type;const s=m.default.getEmoticonByName(e.type);s&&s.description&&(t=s.description);const i=g.getEmoticonAccessibilityLabel(t,e.tone);return{value:C.getString("AccessibilityLabel.Emoticon",{emoticonName:i}),stopProcessing:!1}}transformQuoteNode(e){const t=this._default(e);return{value:C.getString("AccessibilityLabel.QuotedMessage",{quotedName:e.getAuthorNameWithFallbackUnescaped(),quoteContent:t.value}),stopProcessing:!1}}transformWikiMarkupNode(e){return{value:this._default(e).value||"",stopProcessing:!1}}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformSwiftUriObjectNode(e){if(A.default.isUriNodeTextMessage(e))return this._renderTextNodes(A.default.getTextNodes(e));return{value:C.getString("AccessibilityLabel.Bot"),stopProcessing:!1}}transformPartListNode(e){let t;if(l.default.calculateCallMarkerInfo(e).type===l.CallMarkerType.Missed)t=C.getString("AccessibilityLabel.CallMissed");else t=C.getString("AccessibilityLabel.Call");return{value:t,stopProcessing:!1}}transformContactsNode(e){const t=this._renderTextNodes(e.children);return{value:C.getString("ContactCard.ContactCardAccessibilityLabel",{contactValue:t.value}),stopProcessing:t.stopProcessing}}}function D(e,t){const s=h.default.getMemberShortNameForConversation(e,t.users[0].mri);let i,o=0,n="AccessibilityLabel.Reactions1User";const r=t.users.length;r>1&&(i=h.default.getMemberShortNameForConversation(e,t.users[1].mri),n="AccessibilityLabel.Reactions2Users"),r>2&&(o=t.users.length-2,n="AccessibilityLabel.ReactionsMultipleUsers");const a=m.default.getEmoticonByName(t.key),l={count:t.users.length,firstUser:s,secondUser:i,remainingCount:o,reactionName:a&&a.description?a.description:t.key};return C.getString(n,l)}t.ContentToAccessibilityLabelTransformer=x},633949:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentToForwardMessageTransformer=void 0,t.toForwardQuoteMessageEntities=function(e){const t=h.default.getDisplayName(e.creator,!0),s=d.quoteMessage(e,t);return new g.QuoteEntity(s,t,e)},t.toForwardUrlInfo=function(e){const t=u.decode(e),s=v.getUrlPreviewInformationForMessage(e,t);if(v.hasOnlyWebLink(s,t)&&s[0].isValid)return s[0];return},t.toForwardLocationInfo=function(e){const t=u.decode(e),s=o.find(t.children,(e=>e instanceof _.LocationNode));if(s&&s.latitude&&s.longitude){let t;t=S.default.getImageUriForLocation(s.latitude,s.longitude,e.cuid);return{snapshotUri:t,topAddress:s.addressFriendlyNameSanitized,bottomAddress:s.shortAddressSanitized}}return},t.toForwardMediaInfo=function(e){const t=u.decode(e).getFirstUriObjectChild(_.UriObjectFileNode);let s,i;if(t)switch(t.getFileType()){case y.UploadFileType.Picture:case y.UploadFileType.ImageCreatorPicture:case y.UploadFileType.VideoMessage:case y.UploadFileType.Video:t instanceof _.DisplayableMediaWithThumbnail&&(i=t.getDisplayThumbnailUrlSanitized());break;case y.UploadFileType.AudioMessage:t instanceof _.AudioMessageNode&&(s=t.getAudioDurationMs())}const o=a.getMessageTypeGroup(e);if(!t||!t.getFileContentUrlSanitized)return void m.error(p.LogTraceArea.GenericUnsafe,"No url available for this media type message:",o,"most likely an issue from the sender");const r=t.getFileContentUrlSanitized(),l=r&&n.getDocumentId(r);if(!l)return void m.error(p.LogTraceArea.GenericUnsafe,"Invalid media entity document id being forwarded.");const d=t.getOriginalDimensions(),c=d&&d.height&&d.width?d:void 0;return{objectId:l,fileType:t.getFileType(),filename:t.getNameForUI(),dimensions:c,fileSize:t.getSizeInBytes(),localMediaThumbnailUri:i,durationMs:s}},t.toForwardContactInfo=function(e){const t=u.decode(e).getFirstContactNode();if(!t)return;let s;if(t.isPstn&&t.skypeId&&""!==t.skypeId){const e={number:f.default.normalizePartialNumberWithCountryCode(t.skypeId),type:y.PhoneNumberTypes.Other};s=l.getMriFromPhoneNumber(e)}else s=l.skypeIdToMri(t.skypeId);return{skypeId:t.skypeId||"",fullName:t.fullName||"",isPstn:t.isPstn,isS4B:t.isS4B,userMri:s}};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(987364)),r=s(284841),a=i.__importStar(s(971988)),l=i.__importStar(s(44717)),d=i.__importStar(s(559210)),c=i.__importStar(s(591312)),u=i.__importStar(s(463519)),h=i.__importDefault(s(601976)),p=s(815146),g=i.__importStar(s(626065)),m=i.__importStar(s(85385)),S=i.__importDefault(s(91258)),_=s(606933),f=i.__importDefault(s(808164)),y=s(331079),v=i.__importStar(s(277208)),C=i.__importDefault(s(760989));t.ContentToForwardMessageTransformer=class{constructor(){this.transformRootNode=this._default,this.transformHighlightedNode=this._default,this.transformEditMessageMetaDataNode=this._default,this.transformUserMriNode=this._default,this.transformEmoticonNode=this._toUnhandledEntity,this.transformFlagNode=this._toUnhandledEntity,this.transformLegacyQuoteNode=this._default,this.transformBingResponseNode=this._default,this.transformDeepLinkNode=this._default,this.transformAttributionsTextNode=this._default,this.transformAttributionsGroupNode=this._default,this.transformAtMentionNode=this._default,this.transformEmoteNode=this._toUnhandledEntity,this.transformSuggestedTextHighlightNode=this._toUnhandledEntity,this.transformContextNode=this._toUnhandledEntity,this.transformRosterContextNode=this._default,this.transformLocationContextNode=this._default,this.transformUnknownNode=this._default,this.transformSwiftNode=this._default,this.transformPollNode=this._default,this.transformCallerIDNode=this._default,this.transformHtmlNode=this._default}_default(e){return(0,r.chain)(e.children,(0,r.map)((e=>e&&e.accept(this))),(0,r.compact)(),(0,r.flatten)())}_toUnhandledEntity(e,t){return o.isString(t)||(t=c.renderText(e)),[new g.UnhandledEntity(t)]}transform(e){return e.accept(this)}transformPlainTextNode(e){return this._toUnhandledEntity(e,e.getRawText())}transformUnicodeEmojiNode(e){return this.transformPlainTextNode(e.emojiTextNode)}transformQuoteNode(e){return[new g.QuoteEntity(e)]}transformWikiMarkupNode(e){const t=this._default(e),s=C.default.unescapeXml(e.rawPre),i=e.rawPost&&C.default.unescapeXml(e.rawPost);return[new g.WikiMarkupEntity(t,e.getTag(),s,i)]}transformListWikiMarkupNode(e){return this.transformWikiMarkupNode(e)}transformLinkNode(e){const t=c.renderText(e);return[new g.LinkEntity(t,e.getSanitizedHref())]}transformAttributionNode(e){const t=c.renderText(e);return[new g.AttributionEntity(t,e.getSanitizedHref(),e.index)]}}},968739:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAvatarColors=void 0,t.canGenerateAvatars=function(){return!!HTMLCanvasElement.prototype.toBlob},t.getInputEntityUrl=function(e,t=r.EmoticonSize.ExtraExtraLarge,s=a.StickerSize.ThumbLarge){if(e instanceof o.EmoticonEntity)return(0,d.getEmoticonUrl)(e.emoticonName,t,!0,e.tone);if(e instanceof o.StickerEntity)return(0,a.getStickerUrl)(e.uri,s,!1,!0)||"";return""},t.getLocalizedColorName=function(e){switch(e){case"White":return n.getString("Color.White");case"Red":return n.getString("Color.Red");case"Orange":return n.getString("Color.Orange");case"Yellow":return n.getString("Color.Yellow");case"Yellowgreen":return n.getString("Color.Yellowgreen");case"Green":return n.getString("Color.Green");case"Bluegreen":return n.getString("Color.Bluegreen");case"Blue":return n.getString("Color.Blue");case"Blueviolet":return n.getString("Color.Blueviolet");case"Violet":return n.getString("Color.Violet");case"Redviolet":return n.getString("Color.Redviolet")}return""},t.getAvatarColorsFromMri=function(e){const s=e.includes("@")?e.indexOf("@"):e.length,i=e.substring(s-3,s);let o=0;for(const e of i)o+=e.charCodeAt(0);return t.defaultAvatarColors[o%t.defaultAvatarColors.length]};const i=s(197582),o=s(626065),n=i.__importStar(s(704704)),r=s(186907),a=s(785541),l=s(16549),d=s(157013);t.defaultAvatarColors=[{key:"Red",textColor:l.Color.avatarRed,background:[l.Color.avatarRedLighter,l.Color.avatarRedLight]},{key:"Orange",textColor:l.Color.avatarOrange,background:[l.Color.avatarOrangeLighter,l.Color.avatarOrangeLight]},{key:"brown",textColor:l.Color.avatarBrown,background:[l.Color.avatarBrownLighter,l.Color.avatarBrownLight]},{key:"Olive",textColor:l.Color.avatarOlive,background:[l.Color.avatarOliveLighter,l.Color.avatarOliveLight]},{key:"Green",textColor:l.Color.avatarGreen,background:[l.Color.avatarGreenLighter,l.Color.avatarGreenLight]},{key:"Teal",textColor:l.Color.avatarTeal,background:[l.Color.avatarTealLighter,l.Color.avatarTealLight]},{key:"Cyan",textColor:l.Color.avatarCyan,background:[l.Color.avatarCyanLighter,l.Color.avatarCyanLight]},{key:"Blue",textColor:l.Color.avatarBlue,background:[l.Color.avatarBlueLighter,l.Color.avatarBlueLight]},{key:"Blueviolet",textColor:l.Color.avatarBlueviolet,background:[l.Color.avatarBluevioletLighter,l.Color.avatarBlueLight]},{key:"purple",textColor:l.Color.avatarPurple,background:[l.Color.avatarPurpleLighter,l.Color.avatarPurpleLight]},{key:"Fuchsia",textColor:l.Color.avatarFuchsia,background:[l.Color.avatarFuchsiaLighter,l.Color.avatarFuchsiaLight]},{key:"Violet",textColor:l.Color.avatarViolet,background:[l.Color.avatarVioletLighter,l.Color.avatarVioletLight]}]},790330:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bookmarkMessageAction=function(e,t,s){return h.EnsureStarted(r.default).then((()=>n.all(o.map(e,(e=>{const s=e.message,i=s.isBookmarkSourceForCurrentUser();if(s.isBookmark()||i){let e=s.createdTime;if(i){const t=s.getBookmarkSourceMetadataForCurrentUser();t&&t.id&&(e=Number(t.id))}return r.default.deleteBookmark(s).then((()=>{u.default.maybeAnnounceForAccessibility(d.getString("StreamItem.RemoveBookmarkConfirmation")),l.track(new c.MessageActionTelemetry(s.conversationId,s,e,t,c.MessageActionType.RemoveBookmark))}))}return r.default.bookmarkMessage(s,e.forwardAlbumId).then((()=>{l.track(new c.MessageActionTelemetry(s.conversationId,s,s.createdTime,t,c.MessageActionType.AddBookmark))}))}))))).then((()=>{s&&s()}))},t.getSourceMessageDate=function(e){const t=a.getBookmarkMetadata(e);return t?t.bookmarkSourceComposeTime:void 0};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(93457)),a=i.__importStar(s(971988)),l=i.__importStar(s(85385)),d=i.__importStar(s(704704)),c=s(786531),u=i.__importDefault(s(791384)),h=i.__importStar(s(446574))},478193:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MagicBotToolboxRenderingOptions=t.ContactMessageRenderingOptions=t.SwiftMessageRenderingOptions=t.PollRenderingOptions=t.ScheduledCallRenderingOptions=t.CallInfoRenderingOptions=t.FileMessageRenderingOptions=t.LocationRenderingOptions=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importDefault(s(660324)),a=i.__importStar(s(63484)),l=s(971988),d=i.__importStar(s(44717)),c=s(939449),u=i.__importStar(s(196509)),h=i.__importStar(s(242561)),p=s(26703),g=s(606933),m=i.__importStar(s(676908)),S=s(206467),_=i.__importDefault(s(989314)),f=(0,p.lazyProperties)({radius:()=>(0,p.lazyProperties)({swiftCarousel:()=>n.Styles.createViewStyle({borderRadius:0})}),containerPadding:()=>(0,p.lazyProperties)({cardWithSender:()=>n.Styles.createViewStyle({paddingTop:10})})});class y extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showTouchFeedbackOnPress:!0,showLocationCard:!0,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media};return o.assign({},e,t)}getMessageActions(e){const t=this._outerButtonsFit,s=!this._outerButtonsFit,i=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&s;return{actionMenuCommands:this.getActionMenuCommands({supportsPostingReactions:i,supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsQuotes:!0,copyCommand:this._defaultSupportsCopy?S.CommandTypes.CopyLocation:void 0,supportsBookmarks:this._defaultSupportsBookmark}),outerButtonCommands:t?this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands):[]}}}t.LocationRenderingOptions=y,y.messageTypeGroup=l.MessageTypeGroups.Location;class v extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:u.getFileNodeRenderDimensions,isDraggingEnabled:this._defaultSupportsDragging,sendingStatus:a.getOverriddenFileSendingStatus(e.sendingStatus)};return o.assign({},e,t)}getMessageActions(e){const t=d.isEncryptedThread(this._messageProperties.skypeMessage.conversationId),s=a.isFileAvailable(this._messageProperties.skypeMessage.createdTime),i=this._supportsForward&&!t&&s,o=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&!this._outerButtonsFit;let n=this.getActionMenuCommands({supportsPostingReactions:o,supportsForward:i,supportsQuotes:!0,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,saveAsCommand:undefined,openFileLocationCommand:a.canOpenFileLocation(this._messageProperties.decodedNode)?S.CommandTypes.OpenFileLocation:void 0,supportsBookmarks:this._defaultSupportsBookmark});n=n.concat(e.actionMenuCommands);return{actionMenuCommands:n,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(i,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands):[]}}}t.FileMessageRenderingOptions=v,v.messageTypeGroup=l.MessageTypeGroups.UriFile;class C extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1,sendingStatus:e.sendingStatus===m.MessageRenderSendingStatus.Sending?m.MessageRenderSendingStatus.None:e.sendingStatus,removeMessageSpacer:!0,messageContentExpandedToAvailableArea:!0,accessibilityLabelType:h.MessageAccessibilityType.Call};return o.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsPostingReactions:!1,supportsBookmarks:!1});t=t.concat(e.actionMenuCommands);return{actionMenuCommands:t,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(!1,!1,!1).concat(e.outerButtonCommands):e.outerButtonCommands}}}t.CallInfoRenderingOptions=C,C.messageTypeGroup=l.MessageTypeGroups.Calling;class T extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===m.MessageRenderSendingStatus.Sending?m.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,includeAccessibilityPropertiesOnMessageHeader:!0},s=this._messageProperties.decodedNode.getFirstUriObjectChild(g.ScheduledCallInviteNode);return s&&!o.isUndefined(s.canceledTimeMs)&&(t.showMessageSender=!1,t.showMessageTimestamp=!1,t.showMessageSenderIcon=!1,t.showStreamItemAccessory=!1),o.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsQuotes:!0,supportsCancelScheduledCall:this._messageProperties.postedByCurrentUser,supportsEditScheduledCall:!0,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.ScheduledCallRenderingOptions=T,T.messageTypeGroup=l.MessageTypeGroups.ScheduledCallInvite;class M extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===m.MessageRenderSendingStatus.Sending?m.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,messageContainerStyle:f.containerPadding.cardWithSender,includeAccessibilityPropertiesOnMessageHeader:!0};return this._messageProperties.decodedNode.getFirstUriObjectChild(g.PollNode)&&(t.showStreamItemAccessory=!0),o.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsQuotes:!0,supportsCancelPoll:this._defaultSupportsRemove,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.PollRenderingOptions=M,M.messageTypeGroup=l.MessageTypeGroups.Poll;class b extends c.DefaultMessageRenderingOptions{constructor(e){super(e),this.messageProperties=e,this._isAdaptiveNodeCard=r.default.isAdaptiveCard(this._messageProperties.decodedNode),this._isAdaptiveNodeCarousel=r.default.isAdaptiveCardCarousel(this._messageProperties.decodedNode),this._isSwiftNodeCard=_.default.isSwiftCard(this._messageProperties.decodedNode),this._isSwiftNodeCarousel=_.default.isSwiftCarousel(this._messageProperties.decodedNode),this._showOuterButtons=!this._isSwiftNodeText&&(!this._isSwiftNodeCarousel||this._isSwiftNodeCarousel&&this.messageProperties.isNewsBot),this._isSwiftNodeText=_.default.isNodeTextMessage(this._messageProperties.decodedNode)&&!this._isSwiftNodeCarousel,this._swiftCardAttribution=_.default.getSwiftCardAttribution(this.messageProperties.decodedNode)}getMessageSpecificViewRenderingOptions(e){let t;return t=this._isAdaptiveNodeCard?{renderMessageBackground:!1,messageContentExpandedToAvailableArea:this._isAdaptiveNodeCarousel,showOuterButtons:!this._isAdaptiveNodeCarousel&&this._outerButtonsFit,showReactionButtonInsideMessageView:!this._showOuterButtons&&this._defaultSupportsAddReactionInMessageView,removeMessageSpacer:!0,includeAccessibilityPropertiesOnMessageHeader:!0,messageContainerStyle:f.containerPadding.cardWithSender,messageContainerRadiusStyle:this._isAdaptiveNodeCarousel?[f.radius.swiftCarousel]:void 0,contentScrollEnabled:this._isAdaptiveNodeCarousel}:{renderMessageBackground:this._messageProperties.isNewsBot||this._isSwiftNodeText,messageContentExpandedToAvailableArea:this._isSwiftNodeCarousel,showOuterButtons:this._showOuterButtons&&this._outerButtonsFit,showReactionButtonInsideMessageView:!this._showOuterButtons&&this._defaultSupportsAddReactionInMessageView,removeMessageSpacer:this._isSwiftNodeCard||this._isSwiftNodeCarousel,messageContainerRadiusStyle:this._isSwiftNodeCarousel&&!this._messageProperties.isNewsBot?[f.radius.swiftCarousel]:e.messageContainerRadiusStyle,includeAccessibilityPropertiesOnMessageHeader:this._isSwiftNodeCard||this._isSwiftNodeCarousel,messageContainerStyle:this._isSwiftNodeText?void 0:f.containerPadding.cardWithSender,contentScrollEnabled:this._isSwiftNodeCarousel,swiftCardAttribution:this._swiftCardAttribution,shouldAnimateEmoticons:!0,availableSpace:this._messageProperties.containerMaxDimensions,showReactionsOnMessage:e.showReactionsOnMessage,overlayReactionsOnMessage:e.overlayReactionsOnMessage},o.assign({},e,t)}getMessageActions(e){const t=this._supportsForward&&_.default.isShareable(this._messageProperties.decodedNode),s=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&this._showOuterButtons&&!this._outerButtonsFit,i=this._isSwiftNodeText&&this._defaultSupportsCopy?S.CommandTypes.Copy:void 0;let o=this.getActionMenuCommands({supportsPostingReactions:s,supportsForward:t,supportsRemove:this._defaultSupportsRemove,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages&&!this.messageProperties.isNewsBot,copyCommand:i,supportsQuotes:!this.messageProperties.isNewsBot,supportsViewLink:!1,supportsBookmarks:this._defaultSupportsBookmark});o=o.concat(e.actionMenuCommands);return{actionMenuCommands:o,outerButtonCommands:this._outerButtonsFit&&this._showOuterButtons?this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands):e.outerButtonCommands}}}t.SwiftMessageRenderingOptions=b,b.messageTypeGroup=l.MessageTypeGroups.SwiftCard;class I extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showOuterButtons:this._outerButtonsFit,accessibilityLabelType:h.MessageAccessibilityType.Media,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:u.getContactNodeRenderDimensions};return o.assign({},e,t)}getMessageActions(e){const t=this._supportsForward,s=this._defaultSupportsAddReactionsInActionMenu||this._defaultSupportsPostingReactions&&!this._outerButtonsFit;let i=this.getActionMenuCommands({supportsPostingReactions:s,supportsForward:t,supportsQuotes:!0,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsBookmarks:this._defaultSupportsBookmark});i=i.concat(e.actionMenuCommands);return{actionMenuCommands:i,outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(t,this._defaultSupportsAddReactionInMessageView,!1).concat(e.outerButtonCommands):[]}}}t.ContactMessageRenderingOptions=I,I.messageTypeGroup=l.MessageTypeGroups.Contact;class w extends c.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t={renderMessageBackground:!1,showReactionsOnMessage:!1,sendingStatus:e.sendingStatus===m.MessageRenderSendingStatus.Sending?m.MessageRenderSendingStatus.None:e.sendingStatus,accessibilityLabelType:h.MessageAccessibilityType.Media,messageContainerStyle:f.containerPadding.cardWithSender,includeAccessibilityPropertiesOnMessageHeader:!0};return o.assign({},e,t)}getMessageActions(e){let t=this.getActionMenuCommands({supportsRemove:!1,supportsQuotes:!1,supportsBookmarks:!1});return t=t.concat(e.actionMenuCommands),{actionMenuCommands:t,outerButtonCommands:e.outerButtonCommands}}}t.MagicBotToolboxRenderingOptions=w,w.messageTypeGroup=l.MessageTypeGroups.MagicBotToolbox},63484:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.canOpenFileLocation=function(e){return!1;const t=e.getFirstUriObjectChild(l.UriObjectFileNode);if(!t)return!1;const s=new n.default(t.getFileContentUrlSanitized()).getDocumentId();if(!s)return!1;return!!a.default.getLocalUri(s)},t.isFileAvailable=function(e){const t=o.default.getS4LCMCFeaturesNoSubscription().callRecorderRetentionDurationDays;return r.default.getDaysDifferenceToNow(e)<t},t.getOverriddenFileSendingStatus=function(e){return e===d.MessageRenderSendingStatus.Sending?d.MessageRenderSendingStatus.None:e};const i=s(197582),o=i.__importDefault(s(150343)),n=i.__importDefault(s(925494)),r=i.__importDefault(s(389659)),a=i.__importDefault(s(532016)),l=s(606933),d=s(676908)},506240:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.transformEvent=function(e){switch(e.resourceType){case"CustomUserProperties":case"ThreadUpdate":break;case"ConversationUpdate":const t=e.resource;if(d.isOneToOneThread(t.id)){const s=(0,u.default)().getOtherPartyMriFromOneToOneThreadId(t.id);if(o.isUndefined(s))return S("Missing 1:1 mapping",t.id,e.cv,e.resourceType),!1;t.id=s}t.lastMessage&&(!o.isEmpty(t.lastMessage)&&p(t.lastMessage,t.id,e.cv,e.resourceType)||m(t),function(e){if(!e.lastMessage)return;"0"===e.lastMessage.id&&m(e)}(t));break;case"NewMessage":case"MessageUpdate":const s=e.resource;let i;if(s.content.includes("messageVisibilityTime")&&"ThreadActivity/MemberConsumptionHorizonUpdate"===s.messagetype){const e=s.from.split("/").pop(),t=d.getParsedConversationId(s);e===t&&(i=t)}if(!p(s,i,e.cv,e.resourceType))return!1;break;default:return S("Unknown event resource type",void 0,e.cv,e.resourceType),!1}return!0};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(85385)),r=s(815146),a=i.__importDefault(s(655192)),l=s(971988),d=i.__importStar(s(44717)),c=i.__importDefault(s(363091)),u=i.__importDefault(s(615364)),h=s(669431);function p(e,t,s,i){try{const r=e,a=function(e,t){const s=null!=t?t:e.to;if(d.isOneToOneThread(s)){const t=d.getCreatorMriForMessageFromLink(e.from);let i=t;if((c.default.isMyMri(t)||d.isOneToOneThread(i))&&(i=(0,u.default)().getOtherPartyMriFromOneToOneThreadId(s),o.isUndefined(i)))return;return d.getConversationLinkWithNewId(e.conversationLink,i)}return e.conversationLink}(e,t);return void 0===a?(S("Empty transformed conversationLink",t,s,i),!1):(r.messagetype=(n=e.messagetype).endsWith("/None")?n.substring(0,n.indexOf("/None")):n,r.conversationLink=a,r.skypeemoteoffset=(0,l.getJsonFromMessageProperty)(e.properties,l.MessageProperties.Skypeemoteoffset),r.eventId=g(e.properties,l.MessageProperties.EventId),r.isVideoCall=g(e.properties,l.MessageProperties.IsVideoCall),!0)}catch(e){return S("Failed to transform a message",t,s,i,a.default.errorAsString(e)),!1}var n}function g(e,t){const s=null==e?void 0:e[t];if(s)return a.default.asString(s)}function m(e){e.lastMessage=null}function S(e,t,s,i,o){n.warn(r.LogTraceArea.ChatService,`Event transformation failed for reason: ${e}, cv: ${s}, eventType: ${i}, error: ${o}`),n.track(new h.ChatServiceTransformationFailureEvent({reason:e,cv:s,resourceType:i,error:o,threadSuffix:t?d.getThreadSuffix(t):void 0,mriNamespace:t?d.getMriNamespace(t):void 0}))}},172134:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.leaveConversationAsync=function(e,t){const s=(0,R.default)().getConversation(e);let i=l.default.getSkypeMri();if(s){const e=o.find(s.getThreadMembers(),(e=>l.default.isMyMri(e.id)&&w.getMriNamespace(e.id)!==w.Namespaces.MSA));e&&(i=e.id)}return v.default.deleteMyConfiguredConnectors(e).always((()=>{A.default.serviceRemoveMemberFromThread(e,i,t).fail((e=>{g.error(y.LogTraceArea.ChatService,"Error leaving conversation: "+_.default.errorAsString(e)),a.default.showErrorAlert(m.getString("InfoPanel.LeaveFailed"),f.MainRootViewId)}))}))},t.deleteConversationAsync=function(e,t,s){return A.default.serviceDeleteConversation(e,t).then((()=>{g.track(new B.ConversationDeleted(e,t,s)),C.setFocus(C.FocusEvent.ConversationDeleted)})).fail((i=>{g.error(y.LogTraceArea.ChatService,"Error deleting conversation: "+_.default.errorAsString(i)),g.track(new B.ConversationDeletionFailed(e,i.statusCode,t,s)),a.default.showErrorAlert(m.getString("InfoPanel.DeleteConversationFailed"),f.MainRootViewId)}))},t.removeParticipantFromConversation=function(e,t,s){let i=r.Rejected();t&&e?(0,R.default)().isConversationKnown(t)?i=w.isConnector(e)?v.default.deleteConnectorFromChatService(t,e):v.default.deleteConversationConfiguredConnectorsForUser(t,e).always((()=>A.default.serviceRemoveMemberFromThread(t,e,s))):g.error(y.LogTraceArea.ChatService,"We somehow don't know about the conversation..."):g.error(y.LogTraceArea.ChatService,"Could not remove user because conversation or user mri were not provided as a prop");return i},t.setUserComposingStateIfSupported=function(e,t){if(!w.isComposingStateSupported(t,e))return;const s=(0,R.default)().getConversation(t);if(!s||s.isFake)return;if(A.default.errorHandler.get429Timer().getBackoffMinTime()>Date.now())return void g.error(y.LogTraceArea.ChatService,"set UserComposingState - ignoring when throttled by chat service");const i={messagetype:e?I.MessageTypes.Typing:I.MessageTypes.ClearTyping,contenttype:"Application/Message",composetime:(new Date).toISOString(),content:"",properties:{}};A.default.servicePostMessageToConversation(t,i,P.PostMessageToConversationSource.UserComposingState,M.CSRequestScenarios.userComposingState).then(o.noop).catch(o.noop),g.track(new d.MessageTyping(t,p.default.EdfRegistrationId.get(),L.default.getEndpointId()))},t.getSkypeBotConversation=function(){const e=w.sanitizeMri(h.default.getConfigSettingsNoSubscription().feedbackBot.id,w.Namespaces.Bot);return x.default.getConversationMetaAsync(e).then((e=>e?e.conv:void 0))},t.didUserSendSmsInLast30Days=function(e){return r.fromThenable(F.MessagesRepository.getMessagesSentByMeSinceTime(e,Date.now()-2592e6,void 0,!1)).then((e=>o.some(e,(e=>I.getMessageTypeGroup(e)===I.MessageTypeGroups.SMS))))},t.markConversationRead=function(e){g.log(y.LogTraceArea.ConsumptionHorizon,"Marking conversation read "+S.mriOrId(e)),F.MessagesRepository.getMessagesForConversationBeforeTime(e,Number.MAX_VALUE,50,!1).then((t=>{const s=o.find(t,(e=>!!e.getOriginalServerId()));if(s){A.default.setConsumptionHorizonToMessage(e,s,!1);const t=s.getConsumptionHorizonString();g.track(new B.ConversationMarkedRead(e,t))}else{const t=(0,R.default)().getConversation(e);if(t&&t.lastMessage)if(t.lastMessage.getOriginalServerId()){A.default.setConsumptionHorizonToMessage(e,t.lastMessage,!1);const s=t.lastMessage.getConsumptionHorizonString();g.track(new B.ConversationMarkedRead(e,s))}else g.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark conversation read, as last message does not have a CH timestamp "+S.mriOrId(e));else g.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark conversation read, no last message "+S.mriOrId(e))}}))},t.markMessageUnread=function(e){const t=D.default.getPreviousConsumptionHorizon(e);if(t)A.default.setConsumptionHorizon(e,t,!0),D.default.onMarkConversationUnread(e);else{const t=(0,R.default)(),s=t.getConversation(e),i=s&&s.lastMessage||t.getFakeLastMessageFallback(e);i&&N(i).then((t=>{t&&D.default.onMarkConversationUnread(e)}))}},t.markMessageUnreadFromConversationLastMessage=N,t.markMessageUnreadFromGivenMessage=E,t.uploadConversationIcon=function(e,t,s){const i=T.default.newGuid();return k.default.createDocumentGetIdAsync([e],t.file.name,s,void 0,i).then((o=>k.default.uploadDocumentAsync(o,s,t.file,void 0,i).then((()=>{const t=b.getDocumentUrls(o,s);return A.default.setThreadProperty(e,w.ThreadProps.Picture,"URL@"+t.original)}))))},t.addEmotionAnnotation=O,t.removeEmotionAnnotation=U,t.changeEmotionAnnotation=V,t.markReactionsAsRead=function(e){const t=Date.now(),s=String(t),i=o.filter(I.getEmotionMetadata(e.properties),(e=>e.key!==I.MessageAnnotations.ReactionsConsumptionHorizon));i.push({key:I.MessageAnnotations.ReactionsConsumptionHorizon,users:[{mri:e.creator,value:s,time:t}]});const n=JSON.stringify({key:I.MessageAnnotations.ReactionsConsumptionHorizon,value:s,time:t});return A.default.setMessageProperty(e,I.MessageProperties.Emotions,n,JSON.stringify(i))},t.setVote=function(e,t,s){return I.isPollUsingCustomProp(e.properties)?H(e,t,s):z(e,t,s)},t.toggleVoteInPollCustomProp=H,t.toggleVoteInReactionsProp=z,t.respondToScheduledCallProp=function(e,t,s){if(!I.getScheduledCallMetadata(e.properties)||s===t)return r.Rejected();return j(e,s,t)},t.markScheduledCallAsRead=function(e){const t=I.getScheduledCallInviteData(e.properties),s=l.default.getSkypeMri(),i=Date.now(),n={consumptionHorizons:{[s]:i}},r=o.merge({},t,n),a=JSON.stringify(r);return A.default.setMessageProperty(e,I.MessageProperties.ScheduledCallInviteData,a,a)},t.markMessageReported=function(e,t){x.default.markMessageAsReported(e.conversationId,e.cuid,t)},t.markMessageBookmarked=function(e,t){const s=l.default.getSkypeMri(),i=I.MessageAnnotations.Bookmark,n=I.getBookmarkSourceMetadata(e.properties),a=I.addOrUpdateBookmarkMetadataForUser(o.cloneDeep(n),s,t);if(!a)return g.error(y.LogTraceArea.Bookmarks,"Failed to update bookmark annotations metadata."),r.Rejected();const d=o.find(a,(e=>e.key===i));if(!d)return g.error(y.LogTraceArea.Bookmarks,"Failed to find bookmark message annotation."),r.Rejected();const c=o.find(d.users,(e=>e.mri===s));if(!c)return g.error(y.LogTraceArea.Bookmarks,"Failed to find bookmark message annotation for current user."),r.Rejected();const u=JSON.stringify({key:i,value:c.value});return A.default.setMessageProperty(e,I.MessageProperties.Poll,u,JSON.stringify(a))},t.deleteBookmarkSource=function(e){if(!e)return g.log(y.LogTraceArea.ChatService,"SkypeMessageLocal needs to be provided for deleting bookmark source."),r.Rejected();const t=I.getBookmarkSourceMetadata(e.properties),s=l.default.getSkypeMri(),i=I.MessageAnnotations.Bookmark,n=I.removeBookmarkMetadataForUser(o.cloneDeep(t),s),a=o.find(n,(e=>e.key===i));if(a){if(o.find(a.users,(e=>e.mri===s)))return r.Resolved()}const d=JSON.stringify({key:i});return A.default.setMessageProperty(e,I.MessageProperties.Poll,d,JSON.stringify(n),!0)},t.deleteBookmark=function(e){if(!e)return g.error(y.LogTraceArea.ChatService,"Bookmark message ID is required for delete operation."),r.Rejected();const t=w.BookmarksThreadId,{enableDirectBookmarkDelete:s}=h.default.getS4LMessagingFeatures();if(g.log(y.LogTraceArea.ChatService,`Deleting bookmark message. id:${e} isDirectDelete:${s}`),s)return A.default.serviceDeleteMessage(t,e).then(o.noop).catch((e=>{g.error(y.LogTraceArea.ChatService,`There was an error while removing bookmark message. Error: ${_.default.errorAsString(e)}`)}));{const s=I.MessageProperties.DeleteTime,i=Date.now();return A.default.serviceSetMessageProperty(t,e,s,i).catch((e=>{g.error(y.LogTraceArea.ChatService,`There was an error while removing bookmark message. Error: ${_.default.errorAsString(e)}`)}))}},t.addMemberToThread=function(e,t,s){return A.default.serviceAddMemberToThread(e,t,s,!1)},t.setConversationSubscription=function(e,t){return A.default.setConversationSubscription(e,t).then((()=>{const s=u.getConversationTypeForTelemetry(e);g.track(new c.ChatNotificationsToggleSetting(t!==w.SubscriptionTypes.Muted,void 0,e,t,n.NotificationsSource.BotChatSettingsPanel,s))}))};const i=s(197582),o=i.__importStar(s(496486)),n=s(167606),r=i.__importStar(s(397691)),a=i.__importDefault(s(206483)),l=i.__importDefault(s(363091)),d=i.__importStar(s(786531)),c=s(196761),u=i.__importStar(s(340482)),h=i.__importDefault(s(150343)),p=i.__importDefault(s(902530)),g=i.__importStar(s(85385)),m=i.__importStar(s(704704)),S=i.__importStar(s(437782)),_=i.__importDefault(s(655192)),f=s(154235),y=s(815146),v=i.__importDefault(s(994831)),C=i.__importStar(s(800662)),T=i.__importDefault(s(760989)),M=s(100166),b=i.__importStar(s(987364)),I=i.__importStar(s(971988)),w=i.__importStar(s(44717)),P=s(627414),k=i.__importDefault(s(957867)),A=i.__importDefault(s(404547)),x=i.__importDefault(s(304623)),D=i.__importDefault(s(96309)),R=i.__importDefault(s(615364)),L=i.__importDefault(s(782829)),B=i.__importStar(s(823684)),F=s(123117);function N(e){if(e.countsForUnreadCounts())return E(e),r.Resolved(!0);return r.fromThenable(F.MessagesRepository.getMessagesNotSentByMe(e.conversationId,e.createdTime,10,!0)).then((t=>(function(e,t){const s=o.findIndex(e,(e=>e.countsForUnreadCounts()));if(s>=0&&e.length>s+1)return A.default.setConsumptionHorizonToMessage(t.conversationId,e[s+1],!0),!0;return!1}(t,e)||A.default.setFakeConsumptionHorizonBeforeFirstEverMessage(e.conversationId,e,!0),!0))).fail((t=>{g.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark message unread: "+S.mriOrId(e.conversationId)+" "+_.default.errorAsString(t))}))}function E(e){return r.fromThenable(F.MessagesRepository.getMessagesForConversationBeforeTime(e.conversationId,e.createdTime,1,!0)).then((t=>t.length>0?(A.default.setConsumptionHorizonToMessage(t[0].conversationId,t[0],!0),t[0].createdTime):(A.default.setFakeConsumptionHorizonBeforeFirstEverMessage(e.conversationId,e,!0),e.createdTime))).fail((t=>{g.warn(y.LogTraceArea.ConsumptionHorizon,"Could not mark message unread: "+S.mriOrId(e.conversationId)+" "+_.default.errorAsString(t))}))}function O(e,t,s){var i;const n=I.getEmotionMetadata(e.properties),a=l.default.getSkypeMri(),d=I.addEmotionMetadataForUser(o.cloneDeep(n),a,t,s);if(!d)return r.Rejected();const c=o.find(d,(e=>e.key===t));if(!c)return r.Rejected();if(!o.find(c.users,(e=>e.mri===a)))return r.Rejected();(null===(i=h.default.getConfigSettingsNoSubscription().chat.msgApiConfig)||void 0===i?void 0:i.enabled)&&void 0===s&&(s=String(Date.now()));const u=JSON.stringify({key:t,value:s});return A.default.setMessageProperty(e,I.MessageProperties.Emotions,u,JSON.stringify(d))}function U(e,t){const s=I.getEmotionMetadata(e.properties),i=l.default.getSkypeMri();if(t===I.MessageAnnotations.Heart){o.some(s,(e=>e.key===I.MessageAnnotations.Like&&o.some(e.users,(e=>e.mri===i))))&&(t=I.MessageAnnotations.Like)}const n=I.removeEmotionMetadataForUser(o.cloneDeep(s),i,t);if(!n)return r.Rejected();const a=o.find(n,(e=>e.key===t));if(a){if(o.find(a.users,(e=>e.mri===i)))return r.Rejected()}const d=JSON.stringify({key:t});return A.default.setMessageProperty(e,I.MessageProperties.Emotions,d,JSON.stringify(n),!0)}function V(e,t,s){const i=I.getEmotionMetadata(e.properties),n=l.default.getSkypeMri(),a=o.find(i,(e=>e.key===s));if(a){if(o.find(a.users,(e=>e.mri===n)))return r.Rejected()}let d=I.removeEmotionMetadataForUser(o.cloneDeep(i),n,t);if(!d)return r.Rejected();if(d=I.addEmotionMetadataForUser(o.cloneDeep(d),n,s),!d)return r.Rejected();const c=JSON.stringify({key:t}),u=JSON.stringify({key:s}),h=e.getServerIdForPropertyChanges();if(!h)return r.Rejected();const p=I.MessageProperties.Emotions;return x.default.setMessagePropertyLie(e.conversationId,e.cuid,p,JSON.stringify(d)).then((()=>{A.default.serviceSetMessageProperty(e.conversationId,h,p,c,!0).catch((()=>{const t=JSON.stringify(d);x.default.revertMessagePropertyLie(e.conversationId,e.cuid,p,t)})),A.default.serviceSetMessageProperty(e.conversationId,h,p,u).catch((()=>{const t=JSON.stringify(d);x.default.revertMessagePropertyLie(e.conversationId,e.cuid,p,t)}))}))}function H(e,t,s){let i=I.getPollMetadata(e.properties);if(!i)return r.Rejected();const o=l.default.getSkypeMri();t&&(i=I.removeVoteForUser(i,o,t)),s&&(i=I.addOrUpdateVoteForUser(i,o,s));const n=JSON.stringify(i);return A.default.setMessageProperty(e,I.MessageProperties.PollData,n,n)}function j(e,t,s){return t&&s?V(e,t,s):t?U(e,t):s?O(e,s):r.Rejected()}function z(e,t,s){return I.getPollMetadata(e.properties)&&t!==s?j(e,t,s):r.Rejected()}},185013:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isConversationBlockedAsync=function(e){return o.all([(0,a.default)().getConversationPotentiallyBeforeStartupAsync(e),l.EnsureStarted(n.default)]).then((([e])=>(0,a.default)().isConversationBlocked(e)))},t.isConversationBlocked=function(e){if(r.isGroupConversation(e))return n.default.isMriBlocked(e);if(r.isThread(e)){const t=(0,a.default)().getConversation(e),s=t?t.getOtherPartyMri():void 0;return!!s&&n.default.isMriBlocked(s)}return n.default.isMriBlocked(e)},t.isConversationObjectBlocked=function(e){return(0,a.default)().isConversationBlocked(e)};const i=s(197582),o=i.__importStar(s(397691)),n=i.__importDefault(s(97572)),r=i.__importStar(s(44717)),a=i.__importDefault(s(615364)),l=i.__importStar(s(446574))},908154:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(154235),r=i.__importDefault(s(306200)),a=i.__importDefault(s(615364)),l=s(535973);t.default=class{static rootViewIdForConversationMri(e){if(!e)return n.MainRootViewId;const t=(0,a.default)().getConversation(e),s=r.default.getAllSiblingConversations(e),i=l.ConversationUtils.getOrderedConversationIds(s,t);return i.length?o.first(i):e}}},535973:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationUtils=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=s(843890),d=s(284841),c=i.__importDefault(s(404547)),u=i.__importDefault(s(304623)),h=i.__importStar(s(172134)),p=s(627414),g=i.__importStar(s(44717)),m=i.__importDefault(s(434343)),S=s(214189),_=s(137092),f=i.__importStar(s(596467)),y=i.__importDefault(s(732028)),v=s(379878),C=i.__importStar(s(704704)),T=i.__importDefault(s(363091)),M=i.__importStar(s(808164)),b=s(641400),I=s(331079),w=i.__importDefault(s(220534)),P=i.__importDefault(s(685734));class k{static getPotentialExistingConversations(e,t=!1){return e&&1===e.length&&u.default.getConversationMetaAsync(e[0]).then((e=>e?[e.conv]:[])),k.getRecentConversationMetas().then((s=>(0,d.chain)(s,(0,d.filter)((s=>{if(t&&s.conv.topicName())return!1;const i=s.conv.getMemberMris();return i.length-1===e.length&&o.intersection(i,e).length===e.length})),(0,d.map)((e=>e.conv)))))}static getRecentConversationMetas(){const e=Date.now()-S.ConversationHistoryTimeSpanImportant;if(u.default.getLastFetchedTimestamp()<e){const e=u.default.getRawConversationMetaMemoryCache(),t=o.values(e).filter((e=>e&&f.isConversationDisplayable(e.conv)&&!e.conv.isHighlightsThread()));return r.Resolved(t)}return m.default.getRecentNonHighlightConversationMetas(g.MinimumConversationsToTryToShow).then((e=>o.filter(e,(e=>f.isConversationDisplayable(e.conv)))))}static createConversation(e,t,s,i=!1,n=p.CreateThreadSource.CreateNewConversation,l={[g.ThreadProps.HistoryDisclosed]:"false",[g.ThreadProps.JoinEnabled]:"true"},d){let h,m=[];return i&&(l[g.ThreadProps.ModeratedThread]="true"),c.default.serviceCreateThread(e,s,n,l,d).then((e=>{h=e.threadId;const s=0===o.size(t)?r.Resolved([]):c.default.serviceAddMembersToThread(h,t,a.default.getS4LMessagingFeaturesNoSubscription().retryAddMembersToThread,{},d);return c.default.discloseHistory(e.threadId,!0),s.then((e=>(m=e,u.default.waitForJoinedKnowledgeOfConversation(h))))})).then((()=>({threadId:h,failedMembers:m})))}static setConversationProps(e,t,s){if(t&&c.default.setThemeColor(e,t),s)return h.uploadConversationIcon(e,s,I.UploadFileType.GroupAvatar)}static getConversationTypeForUI(e){return g.isEncryptedThread(e)?_.ConversationUIType.Private:g.isConversationWithPhoneNumber(e)?_.ConversationUIType.Phone:g.isOneOnOneConversation(e)?_.ConversationUIType.OneOnOneSkype:g.isGroupConversation(e)?_.ConversationUIType.Group:_.ConversationUIType.Other}static getConversationNameForTab(e,t="",s){switch(k.getConversationTypeForUI(e)){case _.ConversationUIType.Private:return C.getString("ContentPanelHeader.PrivateConversationTab");case _.ConversationUIType.Phone:const e=t.slice(-2);return s?C.getString("ContentPanelHeader.SMSConversationTabWithNumber",{digits:e}):C.getString("ContentPanelHeader.SMSConversationTab");case _.ConversationUIType.OneOnOneSkype:return C.getString("ContentPanelHeader.SkypeConversationTab");default:return C.getString("ContentPanelHeader.GenericConversationTab")}}static getConversationForGivenType(e,t){return o.find(e,(e=>this.getConversationTypeForUI(e.id)===t))}static getDeleteConfirmationTitle(e){if(e.length>1)return C.getString("InfoPanel.DeleteAll");const t=e[0];switch(k.getConversationTypeForUI(t)){case _.ConversationUIType.Private:return C.getString("InfoPanel.DeleteConfirmationDialogTitleE2EE");case _.ConversationUIType.Phone:return C.getString("InfoPanel.DeleteConfirmationDialogTitleSMS");case _.ConversationUIType.OneOnOneSkype:return C.getString("InfoPanel.DeleteConfirmationDialogTitleSkype");default:return C.getString("InfoPanel.ClearGroupConfirmationDialogTitle")}}static getConversationTitleForSelection(e){switch(k.getConversationTypeForUI(e.mri)){case _.ConversationUIType.Private:return C.getString("InfoPanel.PrivateChat");case _.ConversationUIType.Phone:const t=g.getPhoneNumberFromMri(e.otherPartyMri||e.mri),s=(t?M.default.parseAndFormat(t,M.PhoneNumberFormat.INTERNATIONAL)||t:void 0)||"";return C.getString("InfoPanel.SMSChat",{phoneNumber:s});default:return C.getString("InfoPanel.SkypeChat")}}static getIconForConversation(e){if(!e)return b.SkypeIcon.Message;switch(k.getConversationTypeForUI(e.id)){case _.ConversationUIType.Private:return b.SkypeIcon.Lock;case _.ConversationUIType.Phone:return b.SkypeIcon.MobileSmsNew;default:return b.SkypeIcon.Message}}static getIconForConversationMri(e){return g.isPhoneMri(e)?b.SkypeIcon.MobileSmsNew:g.isEncryptedThread(e)?b.SkypeIcon.Lock:b.SkypeIcon.Message}static isPSTNGroup(e){if(e){const t=e.getMemberMrisWithoutMe();return t.length>0&&o.every(t,(e=>g.isPhoneMri(e)))}return!1}static getOrderedConversations(e,t){let s=o.find(e,(e=>e.isOneOnOne()&&!e.isEncryptedThread()&&!e.isLogicalOneOnOneSmsConversation())),i=o.find(e,(e=>e.isEncryptedThread()&&y.default.shouldShowPrivateConv(e.id))),n=o.filter(e,(e=>e.isLogicalOneOnOneSmsConversation()));if(t){const e=t.isOneOnOne()&&!t.isEncryptedThread()&&!t.isLogicalOneOnOneSmsConversation();!s&&e?s=t:!i&&t.isEncryptedThread()?i=t:o.isEmpty(n)&&t.isLogicalOneOnOneSmsConversation()&&(n=[t])}return o.compact([s,i,...n])}static getOrderedConversationIds(e,t){return this.getOrderedConversations(e,t).map((e=>e.id))}static hasMultipleAudioCallOptions(e){if(g.isOneOnOneConversation(e)&&!g.isEncryptedThread(e)){const t=P.default.getDisplayableUserByMri(e);if(g.isPhoneMri(e)){if(t.phoneNumbers&&t.phoneNumbers.length>1)return!0}else{if(t.getHasPhoneNumbers())return!0;if(l.CallingCapabilities.encryptedCallingSupported()&&g.isSkypeIdMri(e)){const t=g.buildOneOnOneEncryptedThreadId(e);if(y.default.getHandshakeState(t)===v.SecureHandshakeState.Completed)return!0}}}return!1}static createNewGroupConversationFromOneOnOne(e,t){return k.getPotentialExistingConversations(e).then((t=>{const s=o.first(t);if(s)return r.Resolved(s.id);const i={};i[T.default.getSkypeMri()]=I.ThreadMemberAccessType.Admin;const n={};let a;return o.each(e,(e=>{n[e]=g.isPhoneMri(e)?I.ThreadMemberAccessType.User:I.ThreadMemberAccessType.Admin})),k.createConversation(i,n,"",!1).then((e=>(a=e.threadId,k.setConversationProps(a,void 0,void 0)))).then((()=>r.Resolved(a)))}))}static openClearLeaveConversationLearnMore(){n.Linking.openUrl(w.default.appendLanguageUrlParameter(a.default.getConfigSettingsNoSubscription().chat.msgDeletionLearnMoreLink))}}t.ConversationUtils=k},596467:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isConversationDisplayable=function(e){return p(e).isDisplayable},t.getConversationDisplayableStatus=p,t.isCorruptedThread=g,t.getConversationAlwaysHiddenStatus=m;const i=s(197582),o=s(174958),n=s(167606),r=i.__importDefault(s(150343)),a=i.__importDefault(s(97572)),l=i.__importStar(s(44717)),d=i.__importDefault(s(363091)),c=i.__importDefault(s(615364)),u=s(82485),h={};function p(e){const t=m(e.id);if(t.hidden)return{isDisplayable:!1,debugReason:t.reason};if(e.isOneOnOne()){const t=e.getOtherPartyMri();if(!t)return{isDisplayable:!1,debugReason:"unknown other party"};if(a.default.isMriBlocked(t))return{isDisplayable:!1,debugReason:"contact blocked"};const s=r.default.getEngagementFeatures();if(l.isConciergeBotMri(e.id)&&!s.conciergeBotSettings.enableVisibility)return{isDisplayable:!1,debugReason:"hidden Skype Bot"};if(l.isHiddenBotMri(e.id))return{isDisplayable:!1,debugReason:"hidden bot"}}else{if(e.isThread()&&e.getThreadProperty(l.ThreadProps.ThreadType)===l.ThreadTypes.Reactions)return{isDisplayable:!1,debugReason:"reactions thread"};if(a.default.isMriBlocked(e.id))return{isDisplayable:!1,debugReason:"chat blocked"};if(!e.isCurrentUserMember())return{isDisplayable:!1,debugReason:"not a member"}}return e.isDeleted()&&!(0,c.default)().isClearApplicableAndKeepInRecents(e.id)?{isDisplayable:!1,debugReason:"conversation deleted"}:function(e){if(r.default.getConfigSettingsNoSubscription().chat.msgApiConfig.enabled){const t=(0,c.default)().getV2ThreadMapping();if(g(e))return u.Instrumentation.log(n.LogTraceArea.ChatService,`Conv ${o.pii.Omit(e.id)} has isMigrated=false, this is unexpected for p2p threads.`),!0;if(e.isOneToOneUserConvWithThreadIdSupport()){const s=t.getThreadIdByMri(e.id);if(!s)return!1;const i=(0,c.default)().getConversation(s);return!i||!g(i)}return!1}return e.isV2OneToOneThread()}(e)?{isDisplayable:!1,debugReason:"replicated chat"}:{isDisplayable:!0,debugReason:""}}function g(e){if(!e.isV2OneToOneThread())return!1;const t=e.getThreadProperty(l.ThreadProps.IsMigrated);return e.isV2OneToOneThread()&&"False"===t}function m(e){const t=l.getMriNamespace(e);return h[t]?l.isHighlightsThread(e)?{hidden:!0,reason:"Highlights thread"}:l.isReactionsThread(e)?{hidden:!0,reason:"Call reactions (cast) thread"}:l.isOneToOneThread(e)?{hidden:!0,reason:"OneToOne thread"}:d.default.isMyMri(e)?{hidden:!0,reason:"Conversation with self"}:e===r.default.getConfigSettingsNoSubscription().cortana.mri?{hidden:!0,reason:"Cortana conversation"}:{hidden:!1,reason:""}:{hidden:!0,reason:"Not visible thread namespace "+t}}h[l.Namespaces.MSA]=!1,h[l.Namespaces.S4B_Bridge]=!0,h[l.Namespaces.PSTN]=!0,h[l.Namespaces.SkypeId]=!0,h[l.Namespaces.Thread]=!0,h[l.Namespaces.OneToOneTextMessage]=!1,h[l.Namespaces.GroupTextMessage]=!1,h[l.Namespaces.Bot]=!0},459287:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createMessageInfoFromEscapedText=O,t.createMessageInfo=U,t.createMessageFromServerMessage=function(e,t,s,i,o){const n=K(s.content,!1,s.messagetype,void 0,void 0,e,void 0,i,o);return{conversationId:e,postSource:t,conversationOrigin:_.NavigationConversationOrigin.Unknown,messageForPosting:n}},t.createForwardMessageInfoFromEntities=function(e,t,s,i=c.MessageTypes.RichText,o){const n=V(e,s);return W(e,t,n,i,void 0,void 0,void 0,!0,o)},t.createEditMessageInfo=H,t.createDeleteMessageInfo=function(e,t){const s=[];if(e.isEmote()){const t=e.content.substring(0,e.skypeemoteoffset);s.push(new y.UnhandledEntity(t))}return o.assign(H(e,t,s),{isDelete:!0})},t.createCallMessageInfo=function(e,t,s,i,o,n){return W(e,t,s,i,n,void 0,o)},t.createCallerIdMessage=function(e,t,s=_.PostSource.EphemeralMessage){return W(e,s,[new y.CallerIDEntity(t)],c.MessageTypes.CallerID)},t.createMagicBotEventMessage=function(e,t,s){return W(e,t,s,c.MessageTypes.MagicBotEvent,void 0,1)},t.createEmoteMessageInfo=j,t.createP2PMessage=function(e,t,s){const i=w.default.getSkypeMri();return n.all([m.default.getDisplayableNamePotentiallyBeforeStartupAsync(i),m.default.getDisplayableNamePotentiallyBeforeStartupAsync(s)]).then((([s,i])=>j(e,t,[new y.UnhandledEntity(C.getString("Notifications.P2PCallMessage",{callee:s,caller:i}))],s.length+1)))},t.createLinkFakeMessage=function(e,t,s,i,o){const n=O(e,t,s);return A.default.fromFirstLie(n.messageForPosting,n.conversationId,i,o,!0)},t.createScheduledCallFakeMessage=function(e,t,s){return A.default.fromFirstLie(e.messageForPosting,e.conversationId,t,s,!0)},t.createScheduledCallFakeMessageInfo=function(e,t,s,i){const o=new y.UnhandledEntity(i);return W(e,s,[o],t)},t.createInviteFakeMessage=function(e,t,s,i,o){const n=s||C.getString("ContactsStore.DefaultInviteMessage"),r=O(e,t,n);return A.default.fromFirstLie(r.messageForPosting,r.conversationId,i,o,!0)},t.createFakeDraftMessage=function(e,t){const s=[new y.UnhandledEntity(C.getString("MessageComposer.DraftDecorator")),...t.inputEntities],i=U(e,_.PostSource.MessageComposer,s);return A.default.fromFirstLie(i.messageForPosting,i.conversationId,w.default.getSkypeMri(),t.timestamp||Date.now(),!0)},t.createFakeMediaDraftMessage=function(e,t,s){const i=B.default.getFileUrl(t.data),o=[];o.push(new y.UnhandledEntity(C.getString("MessageComposer.DraftDecorator")+" ")),o.push(new y.MediaEntity(i,void 0,i,void 0,R.UploadFileType.File,C.getString("MessageComposer.MediaDraftLabel"),void 0,void 0,void 0,void 0));const n=U(e,_.PostSource.MessageComposer,o,c.MessageTypes.UriObject,void 0,void 0,void 0);return A.default.fromFirstLie(n.messageForPosting,n.conversationId,w.default.getSkypeMri(),s||Date.now(),!0)},t.createMediaAlbumMessage=function(e,t,s,i,n){let r={};r[c.MessageProperties.AlbumId]=s,i&&(r=o.merge(i,r));return U(e,t,[new y.MediaAlbumEntity(s)],c.MessageTypes.MediaAlbum,r,void 0,n)},t.createSwiftFakeMessage=function(e,t,s){const i=D.getTestMessage(s);if(i){return W(e,t,[new y.SwiftUriObjectEntity(i,e,!0)],c.MessageTypes.Media_Card)}return},t.createScheduledCallInviteMessage=function(e,t,s,i,n,r,a,l,d){if(r&&r[e]&&u.isThread(e))return;const h=new y.ScheduledCallInviteUriObjectEntity(s,i.toString(),n.toString(),l,o.isUndefined(d)?void 0:d.toString()),p={invitations:r,consumptionHorizons:a},g={};g[c.MessageProperties.ScheduledCallInviteData]=JSON.stringify(p);return W(e,t,[h],c.MessageTypes.ScheduledCallInvite,void 0,void 0,void 0,void 0,g)},t.createPollMessage=function(e,t,s,i,o,n){const r=new y.PollInputEntity(s,o.toString(),i,n);return W(e,t,[r],c.MessageTypes.Poll,void 0,void 0,void 0,void 0,{})},t.createGuestNameUpdateMessage=function(e,t,s,i){const o=[new T.TextWrapperNode(T.PlainTextNode.fromPlainText(i),T.TextWrapperNode.tags.Initiator),new T.TextWrapperNode(T.PlainTextNode.fromPlainText(Date.now().toString()),T.TextWrapperNode.tags.EventTime),new T.GuestUpdateTargetNode(t,s)],n=new y.GuestNameUpdateEntity(o);return W(e,_.PostSource.GuestNameUpdate,[n],c.MessageTypes.GuestNameUpdate,void 0,void 0,void 0,void 0,undefined)},t.createAdaptiveFakeMessage=function(e,t,s){const i=r.getTestMessage(s);if(i){return W(e,t,[new y.AdaptiveUriObjectEntity(i,e,!0)],c.MessageTypes.Media_Card)}return},t.createMagicBotToolboxFakeMessage=function(e,t){const{enableImageCreator:s}=l.default.getS4LMessagingFeaturesNoSubscription(),i=(0,E.getDefaultEngagementApiSections)(s).map((e=>Object.assign(Object.assign({},e.items[0]),{color:e.color,icon:e.icon}))).slice(0,3);if(!(null==i?void 0:i.length))return;const o=C.getString("MagicBot.ToolboxMessageDefaultLabel"),n=new y.MagicBotToolboxInputEntity(i,!0,o);return W(e,t,[n],c.MessageTypes.MagicBotToolbox)},t.shouldAddExtraAtMention=z,t.createSwiftResponseMessageInfo=function(e,t,s,i,n,r){let l;if(n&&z(e,n,r)){const e=a.default.getAgentDescriptionForMri(n);l=new y.AtMentionEntity(e.getDisplayName(),e.getMri()),s=" "+s}let d=g.decodeFromContent(s);d=L.extraTextNodeParsing(d,!0,!0);const u=p.toEntities(d).concat(i);if(function(e,t){return o.some(e.children,(e=>e instanceof T.UnknownNode||e instanceof T.ContextNode))||o.some(t,(e=>e instanceof y.ContextEntity))}(d,u)){const s=l?v.encode([l],!0):"",i=o.filter(u,(e=>e instanceof y.ContextEntity)),n=v.encode(V(e,i),!0);o.remove(d.children,(e=>e instanceof T.ContextNode));return G(e,t,s+d.encodeToString()+n,c.MessageTypes.RichText)}l&&u.unshift(l);return U(e,t,u,c.MessageTypes.RichText)},t.hasDoNotFormatPrefixOrIsDoNotFormatEntity=function(e){return M.splitWikiMarkupPrefix(e).prefix===M.WikiPrefix.DoNotFormat||1===e.length&&e[0]instanceof y.DoNotFormatEntity},t.createForwardSwiftMessageInfo=function(e,t,s,i=c.MessageTypes.RichText,o,n){return G(e,t,s,i,void 0,void 0,void 0,!0,n,o)},t.createForwardMessageInfo=function(e,t,s,i=c.MessageTypes.RichText,o,n,r){return G(e,t,s,i,void 0,void 0,void 0,!0,o,void 0,n,r)},t.createSendCreditMessage=function(e,t,s,i,o){const n=k.getSwiftMessage(s,i,o),r=new y.SwiftUriObjectEntity(n,e,!0,n.summary);return W(e,t,[r],c.MessageTypes.Media_Card)},t.createSkypeClipsRecordMessage=function(e,t,s,i){const o=new y.LinkEntity(t,s);return W(e,i,[o],c.MessageTypes.RichText)},t.createNewsMessages=function(e,t,s){const i=l.default.getS4LCommerceFeatures().pullNewsConfig;return b.loadNews(s,i).then((s=>{const i=new Array;return s.forEach((s=>{const o={type:S.SwiftMessageTypes.card,summary:s.abstract,attachments:[{contentType:S.SwiftContentTypes.hero,content:{title:s.title,subtitle:s.abstract,image:{url:s.images[0].url,alt:s.title},tap:{type:S.SwiftActionTypes.openUrl,value:s.url}}}]},n=new y.SwiftUriObjectEntity(o,e,!0,o.summary),r=W(e,t,[n],c.MessageTypes.Media_Card);i.push(r)})),i}))},t.tests_createMessageFromContent=function(e,t,s,i,o,n,r,a,l,d,c){return G(e,t,s,i,o,n,r,a,l,d,void 0,c)},t.createTranslationSettingsMessage=function(e,t,s,i,o=!1,n=c.MessageTypes.TranslationSettings){const r={type:I.DataMessageContentType.TranslationSettings,data:{newTranslationState:d.TranslationState[i],messageTranslationLocale:s,isUpdate:o,isOldVersion:!1}},a=new y.TranslationSettingsEntity(I.DataMessageContentType[I.DataMessageContentType.TranslationSettings],x.default.asString(r),[]);return W(e,t,[a],n)},t.createTwincamSyncMessage=function(e,t){const s=new y.DataEntity(I.DataMessageContentType[I.DataMessageContentType.TwinCamSync],"{}",[]);return W(e,t,[s],c.MessageTypes.Data)};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importStar(s(238906)),a=i.__importDefault(s(179075)),l=i.__importDefault(s(150343)),d=s(619429),c=i.__importStar(s(971988)),u=i.__importStar(s(44717)),h=s(154235),p=i.__importStar(s(901782)),g=i.__importStar(s(463519)),m=i.__importDefault(s(601976)),S=i.__importStar(s(242561)),_=s(815146),f=i.__importDefault(s(804536)),y=i.__importStar(s(626065)),v=i.__importStar(s(7040)),C=i.__importStar(s(704704)),T=i.__importStar(s(606933)),M=i.__importStar(s(117746)),b=i.__importStar(s(128806)),I=s(203705),w=i.__importDefault(s(363091)),P=i.__importDefault(s(450312)),k=i.__importStar(s(709358)),A=i.__importDefault(s(997226)),x=i.__importDefault(s(655192)),D=i.__importStar(s(393762)),R=s(331079),L=i.__importStar(s(771369)),B=i.__importDefault(s(220534)),F=i.__importDefault(s(760989)),N=s(493680),E=s(952205);function O(e,t,s,i=!1,o){const n=V(e);if(!n.length&&i)return G(e,t,s,c.MessageTypes.Text,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o);const r=new y.UnhandledEntity(s);return n.unshift(r),W(e,t,n,c.MessageTypes.RichText)}function U(e,t,s,i=c.MessageTypes.RichText,o,n,r){return W(e,t,V(e,s),i,void 0,void 0,void 0,void 0,o,n,r)}function V(e,t=[]){const s=[];if(e===u.sanitizeMri(l.default.getConfigSettingsNoSubscription().feedbackBot.id,u.Namespaces.Bot)&&!o.some(t,(e=>e instanceof y.ContextEntity))){let e={};e={ClientLanguage:C.getLocale()};const t=f.default.getCurrentSessionId();t&&(e.feedbackId=t),s.push(new y.ContextEntity(e))}return t.concat(s)}function H(e,t,s,i=e.messagetype){return W(e.conversationId,t,s,i,e,e.skypeemoteoffset)}function j(e,t,s,i){return W(e,t,s,c.MessageTypes.RichText,void 0,i)}function z(e,t,s){const{enableMagicBot:i}=l.default.getS4LMessagingFeaturesNoSubscription(),o=i&&!(0,N.isMagicBotConversation)(e)&&(0,N.isMagicBotConversation)(t);return(u.isThread(e)||o)&&u.isAgent(t)&&!s}function W(e,t,s,i,n,r,a,l,d,u,p){const g=o.some(s,(e=>e instanceof y.AtMentionEntity));let m,S=i;if(n&&(i===c.MessageTypes.Text||i===c.MessageTypes.RichText)){const e=n.getOriginalServerMessage(),t=e&&new Date(e.originalarrivaltime).getTime()||n.createdTime;o.remove(s,(e=>e instanceof y.EditMessageMetaDataEntity));const i=new y.EditMessageMetaDataEntity(w.default.getSkypeId(),t);s.push(i),S=c.MessageTypes.RichText}return m=S===c.MessageTypes.Text&&o.every(s,(e=>e instanceof y.UnhandledEntity))?o.map(s,(e=>e.text())).join(""):v.encode(s,!!u),{conversationId:e,postSource:t,conversationOrigin:P.default.dangerouslyGetActiveConversationContextOrigin(h.MainRootViewId),messageForPosting:K(m,g,S,n?n.getOriginalClientMessageId():void 0,r,e,a,d,p),inputEntities:s,isForward:l,editedMessageCuid:n?n.cuid:void 0,previousMessageBeingEditedProperties:n?n.properties:void 0,editedMessageTimestamp:n?n.createdTime:void 0,editedMessageServerId:n?n.getOriginalServerId():void 0,editedMessageVersion:n?n.getLatestServerMessageVersion():void 0}}function G(e,t,s,i,n,r,a,l,d,u,p,g){let m={};p&&(m[c.MessageProperties.AlbumId]=p),g&&(m=o.merge(g,m));const S=c.hasAtMention(s);return{conversationId:e,postSource:t,conversationOrigin:P.default.dangerouslyGetActiveConversationContextOrigin(h.MainRootViewId),messageForPosting:K(s,S,i,n?n.getOriginalClientMessageId():void 0,r,e,a,m),editedMessageCuid:n?n.cuid:void 0,previousMessageBeingEditedProperties:n?n.properties:void 0,editedMessageTimestamp:n?n.createdTime:void 0,isForward:l,forwardMediaInfos:d,swiftMessageDecoded:u,editedMessageServerId:n?n.getOriginalServerId():void 0,editedMessageVersion:n?n.getLatestServerMessageVersion():void 0}}function K(e,t,s,i,o,n,r,a,l){let d;d=l||F.default.newClientMessageId();const h=Date.now(),p=new Date(h).toISOString();let g;n&&u.isOneOnOneConversation(n)&&!u.isAgent(n)&&(g=m.default.getDisplayName(n));return{clientmessageid:d,composetime:p,content:e,messagetype:s,contenttype:c.ContentTypes.Text,imdisplayname:m.default.getDisplayName(w.default.getSkypeMri()),receiverdisplayname:g,"Has-Mentions":t?"true":void 0,skypeemoteoffset:o?o.toString():void 0,skypeeditedid:i||void 0,skypeguid:r||void 0,properties:a||void 0,from:void 0,fromline:void 0}}},939449:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownMessageTypeRenderingOptions=t.DefaultMessageRenderingOptions=void 0;const i=s(197582),o=i.__importStar(s(516778)),n=i.__importDefault(s(150343)),r=s(843890),a=i.__importStar(s(971988)),l=i.__importStar(s(44717)),d=i.__importStar(s(242561)),c=s(26703),u=s(954225),h=i.__importStar(s(252531)),p=i.__importDefault(s(363091)),g=i.__importDefault(s(863132)),m=s(206467),S=i.__importDefault(s(139221)),_=i.__importDefault(s(827361)),f=s(717413),y=s(160560),v=s(676908),C=(0,c.lazyProperties)({radius:()=>(0,c.lazyProperties)({containerStyle:()=>o.Styles.createViewStyle({borderTopLeftRadius:u.messageBorderRadius,borderTopRightRadius:u.messageBorderRadius,borderBottomRightRadius:u.messageBorderRadius,borderBottomLeftRadius:u.messageBorderRadius}),othersMessageStyle:()=>o.Styles.createViewStyle({borderTopLeftRadius:0}),currentUserMessage:()=>o.Styles.createViewStyle({borderBottomRightRadius:0}),othersMessageRTL:()=>o.Styles.createViewStyle({borderTopRightRadius:0}),currentUserMessageRTL:()=>o.Styles.createViewStyle({borderBottomLeftRadius:0})}),containerPadding:()=>(0,c.lazyProperties)({firstInGroup:()=>o.Styles.createViewStyle({paddingTop:10}),notFirstInGroup:()=>o.Styles.createViewStyle({paddingTop:1})})});class T{constructor(e){this._messageProperties=e,this._getDefaultRadiusStylesForMessage=()=>{const e=[C.radius.containerStyle];if(!this.renderedInCompositeGallery()){const t=S.default.isRTL();this._messageProperties.postedByCurrentUser&&!this._isBookmark&&!this.renderedInStackGallery()?e.push(t?C.radius.currentUserMessageRTL:C.radius.currentUserMessage):e.push(t?C.radius.othersMessageRTL:C.radius.othersMessageStyle)}return e};const t=l.isEncryptedThread(this._messageProperties.skypeMessage.conversationId);this._messagingFeatures=n.default.getS4LMessagingFeaturesNoSubscription(),this._outerButtonsFit=!!this._messageProperties.layoutWidth&&this._messageProperties.layoutWidth>355;const s=l.isS4BBridgeMri(this._messageProperties.skypeMessage.conversationId),i=n.default.getEngagementFeatures().conciergeBotSettings.enableMessageReactions&&l.isConciergeBotMri(this._messageProperties.skypeMessage.conversationId),o=n.default.getS4LMessagingFeatures().enableMagicBot&&(0,f.getMagicBotId)()===this._messageProperties.skypeMessage.creator;this._defaultSupportsShowingReactionsSummary=!this._messageProperties.disableReactions&&!this._messageProperties.isReadOnly&&!t&&!this._messageProperties.isConversationBlocked&&(!this._messageProperties.postedByBot||i||o)&&!this._messageProperties.skypeMessage.isEmote()&&!s,this._defaultSupportsOverlayingReactionsSummary=!1,this._defaultSupportsPostingReactions=this._defaultSupportsShowingReactionsSummary&&!this._messageProperties.postedByCurrentUser,this._defaultSupportsAddReactionsInActionMenu=this._defaultSupportsPostingReactions&&!!this._messageProperties.screenReaderEnabled,this._defaultSupportsAddReactionInMessageView=(0,y.messageSupportsReacting)(this._defaultSupportsPostingReactions,this._messageProperties),this._isMessageSent=!this._messageProperties.skypeMessage.isSendRejected()&&!this._messageProperties.skypeMessage.isMessageLie()&&!this._messageProperties.skypeMessage.isEphemeral(),this._isBookmark=this._messageProperties.skypeMessage.isBookmark(),this._isBookmarkSource=this._messageProperties.skypeMessage.isBookmarkSourceForCurrentUser(),this._supportsForward=!this._messageProperties.disableForward&&this._isMessageSent&&!t,this._defaultSupportsEdit=!t&&!a.isHtmlMessageType(this._messageProperties.skypeMessage.messagetype),this._defaultSupportsSelectMultipleMessages=this._messageProperties.isSelectMultipleMessagesEnabled&&!l.isPhoneMri(this._messageProperties.skypeMessage.conversationId),this._defaultSupportsRemove=(!!this._messageProperties.postedByCurrentUser||!!this._messageProperties.isModerator)&&!this._messageProperties.isConversationBlocked&&this._isMessageSent&&!this._messageProperties.isReadOnly&&!s&&!t,this._defaultSupportsCopy=r.UICapabilities.copyTextToClipboardSupported(),this._defaultSupportsDragging=!t,this._defaultSupportsBookmark=this._isMessageSent,this._enableDebugMessageActions=this._messagingFeatures.enableDebugMessageActions}getRenderingOptions(){const e=this._getDefaultMessageViewRenderingOptions(),t=this._getDefaultMessageActions();return{messageViewRenderingOptions:this.getMessageSpecificViewRenderingOptions(e),messageActions:this.getMessageActions(this._getDefaultMessageActions()),renderOnlyUrlPreview:this.renderOnlyUrlPreview(),urlPreviewRenderInformation:this.getUrlPreviewRenderInformation(e,t)}}getActionMenuCommands(e){const t=[];if(this._isBookmark)return this.getActionMenuCommandsForBookmarkMessage(e);if(e.supportsSearchSelection&&t.push(m.CommandTypes.SearchSelection),e.supportsPostingReactions&&t.push(m.CommandTypes.AddReaction),e.supportsForward&&t.push(m.CommandTypes.Forward),e.supportsSave&&t.push(m.CommandTypes.SaveMedia),e.saveAsCommand&&t.push(e.saveAsCommand),e.openFileLocationCommand&&t.push(e.openFileLocationCommand),e.supportsRemove&&t.push(m.CommandTypes.Remove),e.supportsEdit&&t.push(m.CommandTypes.Edit),e.supportsQuotes&&t.push(m.CommandTypes.Quote),e.supportsBookmarks&&!this._isBookmark&&t.push(m.CommandTypes.Bookmark),e.supportsTranslation&&t.push(m.CommandTypes.Translate),e.supportsTranslateOne&&t.push(m.CommandTypes.TranslateOne),e.supportsQuotesSelection&&t.push(m.CommandTypes.QuoteSelection),e.copyCommand&&t.push(e.copyCommand),this._defaultSupportsSelectMultipleMessages){(e.copyCommand||e.supportsRemove||e.supportsForward)&&e.supportsSelectMessages&&t.push(m.CommandTypes.SelectMessages)}return e.supportsViewLink&&t.push(m.CommandTypes.ViewLink),e.supportsCancelScheduledCall&&t.push(m.CommandTypes.CancelScheduledCall),e.supportsEditScheduledCall&&t.push(m.CommandTypes.EditScheduledCall),e.supportsCancelPoll&&t.push(m.CommandTypes.CancelPoll),e.supportsWebSearchInMobile&&t.push(m.CommandTypes.WebSearch),this._enableDebugMessageActions&&(t.push(m.CommandTypes.DebugDumpMessage),t.push(m.CommandTypes.DebugDumpMessagePretty)),this._messagingFeatures.enableImageCreator&&e.supportsImageCreation&&t.push(m.CommandTypes.CreateImage),t}getActionsForButtonsToBeRenderedInMessageView(e,t,s){const i=[];return this._isBookmark||(e&&i.push(m.CommandTypes.Forward),t&&i.push(m.CommandTypes.AddReaction)),i}renderOnlyUrlPreview(){return!1}getUrlPreviewRenderInformation(e,t){return[]}getActionMenuCommandsForBookmarkMessage(e){const t=[];return e.supportsForward&&t.push(m.CommandTypes.Forward),e.supportsSave&&t.push(m.CommandTypes.SaveMedia),e.saveAsCommand&&t.push(e.saveAsCommand),t.push(m.CommandTypes.Bookmark),e.copyCommand&&t.push(e.copyCommand),t}_getDefaultMessageActions(){const e=[],t=this._messageProperties.skypeMessage.isEphemeral(),s=this._messageProperties.skypeMessage.isMessageLie(),i=this._messageProperties.skypeMessage.isSendRejected();return s&&!t&&(i?(g.default.canRetry(this._messageProperties.skypeMessage.getSendRetryInfo())&&e.push(m.CommandTypes.RetryFailedSend),e.push(m.CommandTypes.CancelFailedSend)):this._messageProperties.skypeMessage.isEdited()?e.push(m.CommandTypes.CancelEdit):e.push(m.CommandTypes.CancelSend)),s||t||i||this._isBookmark||(this._messageProperties.isReportEnabled&&!this._messageProperties.postedByCurrentUser&&e.push(m.CommandTypes.Report),this._messageProperties.postedByCurrentUser||a.isThreadActivityType(this._messageProperties.skypeMessage.messagetype)||this.renderedInCompositeGallery()||this.renderedInStackGallery()||e.push(m.CommandTypes.MarkReadToHere),(this.renderedInStackGallery()||this.renderedInCompositeGallery())&&e.push(m.CommandTypes.ViewInChat)),{actionMenuCommands:e,outerButtonCommands:[]}}_getDefaultMessageViewRenderingOptions(){const e=this._messageProperties.skypeMessage,t=!e.isEmote();let s,i=!!this._messageProperties.postedByCurrentUser;this._isBookmark&&(s=a.getBookmarkMetadata(e.properties)),s&&s.bookmarkSourceCreatorId&&(i=p.default.isMyMri(s.bookmarkSourceCreatorId));const o=this.renderedInCompositeGallery()||this.renderedInStackGallery()||this._isBookmark||this._isBookmarkSource&&!this._messageProperties.postedByCurrentUser||this._messageProperties.messageFirstInGroup&&!this._messageProperties.postedByCurrentUser&&t,n=o&&!this.renderedInCompositeGallery(),r=!this._messageProperties.postedByCurrentUser&&!this.renderedInCompositeGallery(),l=t&&(o||this._messageProperties.messageFirstInGroup&&this._messageProperties.postedByCurrentUser||this._messageProperties.messageFirstInGroup&&this._messageProperties.messageLastInGroup)||this._isBookmarkSource&&this._messageProperties.postedByCurrentUser;let c=v.MessageRenderSendingStatus.None;e.isSendRejected()?c=v.MessageRenderSendingStatus.Failed:this._messageProperties.renderOrigin!==d.MessageRenderOrigin.CallCanvas&&e.isMessageLie()&&!e.isEphemeral()&&(c=v.MessageRenderSendingStatus.Sending);const u={messageCreatorMri:e.creator,postedByBot:!!this._messageProperties.postedByBot,postedByCurrentUser:i,messageRenderOrigin:this._messageProperties.renderOrigin,theme:this._messageProperties.colorTheme,themeColors:this._messageProperties.themeColors,themeStyles:this._messageProperties.themeStyles,messageStreamHasUnderlay:!!this._messageProperties.hasUnderlay,flipBubbleColors:this._messageProperties.flipBubbleColors},g=h.getBackgroundColorStyleForMessage(u),m=this.renderedInCompositeGallery()||this.renderedInStackGallery()?_.default.flexOne:void 0;return{renderMessageBackground:!0,showMessageSender:o,showMessageSenderIcon:n,allowMarginForSenderIcon:r,showMessageTimestamp:l,alignHeaderLeft:this.renderedInCompositeGallery()||this.renderedInStackGallery(),showDesktopButton:!e.isEphemeral()&&!this.renderedInCompositeGallery(),showStreamItemAccessory:!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&!this.renderedInBookmarkConversationOnDesktop(),showReactionsOnMessage:this._defaultSupportsShowingReactionsSummary,overlayReactionsOnMessage:this._defaultSupportsOverlayingReactionsSummary,removeMessageSpacer:this.renderedInCompositeGallery()||this.renderedInStackGallery(),accessibilityLabelType:d.MessageAccessibilityType.Text,skipAccessibilityLabelForMessageView:!1,sendingStatus:c,shouldAnimateEmoticons:this._messageProperties.isCurrentUserActive&&(this._messageProperties.isLastMessage||!1),viewColorProperties:g,messageContainerStyle:this._messageProperties.messageFirstInGroup||o?C.containerPadding.firstInGroup:C.containerPadding.notFirstInGroup,messageContainerRadiusStyle:this._getDefaultRadiusStylesForMessage(),outerWrapperOverideStyle:m,showOuterButtons:this._defaultSupportsAddReactionInMessageView||this._isBookmark,showEditIndicator:!1,showDivider:this._isBookmark&&!this._messageProperties.isLastMessage}}renderedInStackGallery(){return this._messageProperties.renderOrigin===d.MessageRenderOrigin.StackGalleryCanvas}renderedInCompositeGallery(){return this._messageProperties.renderOrigin===d.MessageRenderOrigin.CompositeGalleryCanvas}renderedInBookmarkConversationOnDesktop(){return this._isBookmark&&!0}}t.DefaultMessageRenderingOptions=T;class M extends T{getMessageSpecificViewRenderingOptions(e){return e}getMessageActions(e){return e}}t.UnknownMessageTypeRenderingOptions=M,M.messageTypeGroup=a.MessageTypeGroups.None},119999:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(6625),r=i.__importDefault(s(974634)),a=s(897704),l=s(154235),d=i.__importDefault(s(892034)),c=s(78987),u=s(815146),h=i.__importDefault(s(606617)),p=s(7040),g=i.__importStar(s(85385)),m=i.__importDefault(s(740794)),S=i.__importDefault(s(450312)),_=s(848523),f=s(96575),y=i.__importDefault(s(760989)),v=i.__importDefault(s(884030));class C{static performShareNavigationAction(e,t="",s){let i=1;switch(e.type){case"text":e.text?this._processTextShareEvent(e.text,s):this._processShortcutShareEvent(s);break;case"media":if(!e.data||o.isEmpty(e.data))break;i=e.data.length,this._isFileTypeIncluded(e.data)?this._processFileShareEvent(e.data,s):1===e.data.length?this._processSingleMediaShareEvent(e.data[0],t,s):this._processMultipleMediaShareEvent(e.data,t,s);break;default:y.default.switchStatementExhaustiveChecking(e.type)}g.track(new c.DirectShareTelemetry(e.type,i))}static fileDirectShareEvent(){return this._fileShareEvent}static sendSharedFiles(e,t){v.default.postShareEventMediaSelections(e,[t],{name:f.ScenarioName.ShareToSkypeMedia},y.default.newCauseId())}static _processTextShareEvent(e,t){const s={entities:[{type:n.EditableEntityType.PlainText,displayText:e}],downStreamDataVersion:0},i={conversationId:t,inputEntities:(0,p.convertRawTextToInputEntities)(e),inputEntitiesDataVersion:0,messages:void 0,type:_.SavedMessageType.None,timestamp:Date.now()};d.default.saveMessageInput(t,i),d.default.updateInputEntitiesFromContent(t,s).commit(t).storeSavedMessage(t),m.default.navigateToConversation({convId:t,causeId:y.default.newCauseId(),shouldAutoFocusInput:!0})}static _processShortcutShareEvent(e){m.default.navigateToConversation({convId:e,causeId:y.default.newCauseId(),shouldAutoFocusInput:!0})}static _processSingleMediaShareEvent(e,t,s){const i=this._getCapturePreviewParams(e,t,s);m.default.navigateToCapturePreview(i)}static _processMultipleMediaShareEvent(e,t,s){const i={mediaPreviews:o.map(e,(e=>{const i=this._getCapturePreviewParams(e,t,s),n={mediaSelection:this._getMediaSelectionParams(e,t)};return o.extend(n,i)})),conversationId:s,onReject:()=>this._onMediaPreviewReject(s)};m.default.navigateToCaptureMultiPreview(i)}static _processFileShareEvent(e,t){const s=y.default.newCauseId();S.default.getActiveConversationId(l.MainRootViewId)!==t?m.default.navigateToConversation({convId:t,causeId:s,directShareEventData:e}):this._fileShareEvent.fire(e)}static _getCapturePreviewParams(e,t,s){return{capturedContentHandler:new a.CapturedContentHandlerForPosting(s),localMediaObjectUri:t+e.uri,localMediaThumbnailUri:t+(e.thumbnailUri||e.uri),width:e.width,height:e.height,fileSize:e.size,entryPoint:u.PostSource.DirectShare,skipShareWithPanel:!0,fileExtension:h.default.extractFileExtension(e.name),conversationId:s,localMediaIsVideo:"video"===e.type,onCaptureFlowComplete:()=>this._onSendFlowComplete(s),onReject:()=>this._onMediaPreviewReject(s)}}static _getMediaSelectionParams(e,t){return{fileName:e.name,id:e.uri,node:{node:{image:{contentType:e.type+"/"+h.default.extractFileExtension(e.uri),duration:0,height:e.height,size:e.size,thumbnailUri:t+(e.thumbnailUri||e.uri),uri:t+e.uri,width:e.width},isPhoto:"image"===e.type,timestamp:Date.now()}}}}static _onSendFlowComplete(e){const t=y.default.newCauseId();g.log(u.LogTraceArea.DirectShareUtils,"DirectShareUtils._onSendFlowComplete: Sending selected files",t),m.default.navigateToConversation({convId:e,causeId:t})}static _onMediaPreviewReject(e){const t=y.default.newCauseId();g.log(u.LogTraceArea.DirectShareUtils,"DirectShareUtils._onMediaPreviewReject: Rejecting selected files",t),m.default.navigateToConversation({convId:e,causeId:t})}static _isFileTypeIncluded(e){return o.some(e,(e=>"image"!==e.type&&"video"!==e.type))}}C._fileShareEvent=new r.default,t.default=C},46209:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DropTargetOrigin=t.DragDropType=t.DropEffect=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(762595),r=i.__importStar(s(971988)),a=i.__importStar(s(44717)),l=i.__importStar(s(633949)),d=i.__importStar(s(459287)),c=s(693352),u=s(815146),h=i.__importStar(s(85385)),p=s(786531),g=i.__importDefault(s(863132)),m=i.__importDefault(s(655192)),S=s(331079),_=i.__importDefault(s(685734)),f=i.__importDefault(s(892034)),y=i.__importDefault(s(760989)),v=i.__importDefault(s(740794));var C,T;t.DropEffect="copy",function(e){e.FileFromDesktop="filefromdesktop",e.FileFromConversationToRecents="filefromconversationtorecents",e.ContactFromRecentsToConversation="contactfromrecentstoconversation",e.Unknown="unknown",e.TextOrLink="textorlink"}(C||(t.DragDropType=C={})),function(e){e[e.AvatarPicker=0]="AvatarPicker",e[e.MessagePanel=1]="MessagePanel",e[e.DesktopGalleryPanel=2]="DesktopGalleryPanel",e[e.ConversationListItem=3]="ConversationListItem"}(T||(t.DropTargetOrigin=T={}));t.default=new class{getDataTransferType(e){return n.DragDropEvent.isContactEntityInDataTransfer(e)?C.ContactFromRecentsToConversation:this.isDataTransferFileFromConversationToRecents(e)?C.FileFromConversationToRecents:this.isTextOrLink(e)?C.TextOrLink:this.isDataTransferFilesFromDesktop(e)?C.FileFromDesktop:C.Unknown}isDataTransferFilesFromDesktop(e){return!(e.dataTransfer&&!e.dataTransfer.items||0===e.dataTransfer.items.length||o.every(e.dataTransfer.items,(e=>"string"===e.kind)))}isDataTransferFileFromConversationToRecents(e){return e.dataTransfer&&e.dataTransfer.items&&1===e.dataTransfer.items.length&&e.dataTransfer.items[0].type===C.FileFromConversationToRecents}isTextOrLink(e){var t;return(null===(t=null==e?void 0:e.dataTransfer)||void 0===t?void 0:t.items)&&e.dataTransfer.items.length>0&&o.every(e.dataTransfer.items,(e=>{if("string"===e.kind)return!0;if("file"===e.kind){const t=e.getAsFile();return null==t?void 0:t.name.endsWith(".url")}return!1}))}isDragAndDropContactsEnabled(){return!0}addDragAndDropContactInformation(e,t,s,i){const o=a.isPhoneMri(t),r=a.isS4BBridgeMri(t),l={skypeId:a.stripMriNamespace(t),fullName:s,isPstn:o,isS4B:r,userMri:t};n.DragDropEvent.addDragAndDropContactInformation(e,l),h.track(new c.DragAndDropTelemetry(c.DragAction.DragStart,i,c.DragType.Contact))}isContactEntityInDataTransfer(e){return n.DragDropEvent.isContactEntityInDataTransfer(e)}extractContactEntityFromDataTransfer(e){if(!n.DragDropEvent.isContactEntityInDataTransfer(e))return;const t=e.dataTransfer.getData(C.ContactFromRecentsToConversation),s=m.default.parseJsonErrorToUndefined(t);if(!s)return void h.error(u.LogTraceArea.MessagePanel,"Failed to create information for dropping message of type");const{userMri:i}=s;if(!i||!a.isMri(i))return;const o=_.default.getDisplayableUserByMri(i);return o?{skypeId:a.stripMriNamespace(i),fullName:o.getDisplayName(),isPstn:a.isPhoneMri(i),isS4B:a.isS4BBridgeMri(i),userMri:o.getMri()}:void 0}addDragAndDropFileInformation(e,s){e.dataTransfer.effectAllowed=t.DropEffect,e.dataTransfer.dropEffect=t.DropEffect;const i=l.toForwardMediaInfo(s);if(!i)return void h.error(u.LogTraceArea.MessagePanel,"Failed to create information for dragging message of type"+s.messagetype);const o={message:s,forwardInfo:i};e.dataTransfer.setData(C.FileFromConversationToRecents,JSON.stringify(o)),h.track(new c.DragAndDropTelemetry(c.DragAction.DragStart,c.DragOrigin.MessageStream,this._convertMessageTypeToTelemetryType(i)))}dropFileFromConversationToRecents(e,t,s){let i=s;t&&(i=t.getData(C.FileFromConversationToRecents));const n=m.default.parseJsonErrorToUndefined(i);if(!n||o.isEmpty(n))return void h.error(u.LogTraceArea.MessagePanel,"Failed to create information for dropping message of type");const{message:a,forwardInfo:l}=n;if(!(o.isEmpty(l)||o.isEmpty(a)||o.isEmpty(a.content))&&o.isString(a.content)&&o.includes(r.UriObjectMessageTypes,a.messagetype)){try{g.default.postMessage(d.createForwardMessageInfo(e,u.PostSource.DragDropFromConversationToRecentLists,n.message.content,n.message.messagetype,[n.forwardInfo]))}catch(e){return void h.error(u.LogTraceArea.MessagePanel,"Failed to post message after dropping file to recents - "+m.default.errorAsString(e))}h.track(new p.MessageActionTelemetry(e,n.message,n.message.createdTime,p.MessageActionOrigin.MessageStream,p.MessageActionType.DragDropFromConversationToRecentLists))}}isFileEntityFromConversationInDataTransfer(e){return this.getDataTransferType(e)===C.FileFromConversationToRecents}isDragAndDropFilesFromConversationToRecentListsEnabled(){return!0}dropTextOrLinkToConversation(e,t){const s={entities:t.extractedEntities,downStreamDataVersion:0,pastedTextType:t.pastedTextType};f.default.clearMessageInput(e),f.default.updateInputEntitiesFromContent(e,s).commit(e).storeSavedMessage(e),v.default.navigateToConversation({convId:e,causeId:y.default.newCauseId(),shouldAutoFocusInput:!0})}_convertMessageTypeToTelemetryType(e){switch(e.fileType){case S.UploadFileType.Picture:case S.UploadFileType.ImageCreatorPicture:return c.DragType.Picture;case S.UploadFileType.Video:return c.DragType.Video}return c.DragType.File}}},60771:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createAndNavigateToPrivateConversation=function(e,t,s){const i=T.default.newCauseId();p.log(h.LogTraceArea.Navigation,"E2eeUIUtils.createAndNavigateToPrivateConversation, causeId: "+i);const I=_.rootViewIdForComponentContext(s),w=l.buildOneOnOneEncryptedThreadId(e);return a.default.getConversationMetaAsync(w).then((l=>{l||S.default.navigateToLoadingPanel(m.getString("SetConversationParticipantsPanel.CreatingNewConversation"),I);const _=l&&d.default.getHandshakeState(w)!==u.SecureHandshakeState.None?n.Resolved(w):c.default.sendInvite(e,t),T=e=>{f.default.isMobileScreenReaderEnabled()?o.delay(e,b):e()},P=e=>{S.default.navigateToHub(i),T((()=>r.default.showErrorAlert(e,I)))};return _.then((()=>n.race([a.default.waitForJoinedKnowledgeOfConversation(w),v.default.sleep(M)]))).then((e=>{e?S.default.navigateToConversation({convId:w,origin:h.NavigationConversationOrigin.NewPrivateConversation,causeId:i}):P(m.getString("E2eeNewConversation.ConversationInvitationTimedOut"))})).catch((t=>{if(405===t.statusCode){p.log(h.LogTraceArea.Navigation,"E2eeUIUtils.createAndNavigateToPrivateConversation error, causeId: "+i),S.default.goBack(i,s);const t=C.default.getFullUserProfileByMri(e),o=t.firstName||t.getDisplayName(),n=g.getLocalizeParamForGender(t.gender);T((()=>{r.default.showOKAlert(m.getString("E2eeNewConversation.InvitationNotSent"),m.getString("E2eeNewConversation.UpgradeNeeded",{buddy:o,gender:n}),I)}))}else if(409===t.statusCode&&666===t.errorCode)c.default.sendAccept(w,h.E2EEAcceptOrigin.Invitation).then((()=>{S.default.navigateToConversation({convId:w,origin:h.NavigationConversationOrigin.NewPrivateConversation,causeId:i})}));else{const e=m.getString("E2eeNewConversation.ConversationInvitationFailed",{reason:y.default.errorAsString(t)});T((()=>P(e)))}}))}))},t.getEstablishedEncryptedThreadId=function(e){const t=l.buildOneOnOneEncryptedThreadId(e);return a.default.getConversationMetaAsync(t).then((e=>{if(e&&d.default.getHandshakeState(t)===u.SecureHandshakeState.Completed)return t}))};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(206483)),a=i.__importDefault(s(304623)),l=i.__importStar(s(44717)),d=i.__importDefault(s(732028)),c=i.__importDefault(s(109367)),u=s(379878),h=s(815146),p=i.__importStar(s(85385)),g=i.__importStar(s(147286)),m=i.__importStar(s(704704)),S=i.__importDefault(s(740794)),_=i.__importStar(s(757838)),f=i.__importDefault(s(791384)),y=i.__importDefault(s(655192)),v=i.__importDefault(s(601274)),C=i.__importDefault(s(685734)),T=i.__importDefault(s(760989)),M=15e3,b=250},91258:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MapHeight=t.LocationHeight=t.FooterHeight=t.LocationSuffix=t.MapWidth=t.LatitudeLongitudeDelta=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(380157),r=i.__importDefault(s(150343)),a=i.__importDefault(s(265847)),l=s(389896),d=i.__importDefault(s(201721)),c=i.__importDefault(s(251733)),u=i.__importDefault(s(220534));t.LatitudeLongitudeDelta=3/69,t.MapWidth=200,t.LocationSuffix="_location_snapshot",t.FooterHeight=62,t.LocationHeight=182,t.MapHeight=t.LocationHeight-t.FooterHeight;const h=1e6;t.default=new class{getBingMapsImageUrl(e,t,s){const{urlBase:i,apiKey:o}=r.default.getBingMapsConfig();if("NO_API_KEY"!==o)return u.default.addUrlParameters(i,{key:o,mapSize:`${t},${s}`,mapArea:`${e.latitude-e.latitudeDelta/2},${e.longitude-e.longitudeDelta/2},${e.latitude+e.latitudeDelta/2},${e.longitude+e.longitudeDelta/2}`})}getBingMapsLocationUrl(e,t){const s={cp:e.latitude+"~"+e.longitude,dir:"0",lvl:"15",where1:t?encodeURI(t):e.latitude+","+e.longitude};return u.default.addUrlParameters("https://www.bing.com/maps/default.aspx",s)}getImageUriForLocation(e,s,i){const o=this.getFileIdForLocation(i);return a.default.isKnown(o)?a.default.getLocalUri(o):this.getBingMapsImageUrl(this.getLocationRegionFromLatLong(e,s),t.MapWidth,t.MapHeight)}getImageUriForLocationForwardAndroid(e,s){return this.getBingMapsImageUrl(this.getLocationRegionFromLatLong(e,s),t.MapWidth,t.MapHeight)}getLocationRegionFromLatLong(e,s){return{latitude:o.toNumber(e)/h,longitude:o.toNumber(s)/h,latitudeDelta:t.LatitudeLongitudeDelta,longitudeDelta:t.LatitudeLongitudeDelta*(t.MapWidth/t.MapHeight)}}getFileIdForLocation(e){return e+t.LocationSuffix}getLocationPermissionStatus(e){var t;const s=null===(t=d.default.getUserPreferencesLocal().msaProfileKey)||void 0===t?void 0:t.ageGroup;return l.MsaProfileHelper.isChild(s)?n.PermissionStatus.Denied:c.default.permissionStatus(e)}}},500983:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getEditableEntityFromInputEntityAndConsiderAlternatives=S,t.getEditableContentFromEditableEntities=function(e,t){return{entities:e,downStreamDataVersion:t}},t.getEditableEntitiesFromInputEntitiesAndConsiderAlternatives=function(e,t){return e.map(((e,s)=>S(e,t,s)))},t.getConversationMaxMessageLength=function(e){return e?g:m},t.maybeRefreshCallerIdData=function(e,t){const{callerId:s}=d.AppConfigStore.getS4LCommerceFeaturesNoSubscription().callingSettingsPanel;if(!(s.refreshInfoOnSmsComposer&&t&&e))return;c.default.maybeRefreshCallerIdData()},t.shouldHideComposer=function(e,t){const s=!(0,h.isEncryptedThread)(e.id)&&(p.default.isIncomingContactInvitePending(e.id)||!!t&&!!(0,h.isOneOnOneConversation)(e.id)&&!p.default.isContact(e.id));return(0,h.isReadOnlyConversation)(e.id)||(0,u.isContentChannel)(e)||(0,u.isTodayBot)(e.id)||(0,h.isBookmarkConversation)(e.id)||(0,h.isConciergeBotMri)(e.id)||s};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(157013)),r=i.__importDefault(s(671210)),a=i.__importStar(s(626065)),l=i.__importStar(s(7040)),d=s(677982),c=i.__importDefault(s(879248)),u=s(803193),h=s(44717),p=i.__importDefault(s(555436)),g=25e3,m=400;function S(e,t,s){const i=l.getEditableEntityFromInputEntity(e,t,s);if(!(e instanceof a.EmoticonEntity))return i;const o=i;return Object.assign(Object.assign({},o),{url:_(o.url)})}function _(e){if(o.isUndefined(e))return;const t=n.parseUrl(e);if(o.isUndefined(t))return e;const s=r.default.requestEmoticon(e,t).result;return o.isUndefined(s)?e:n.getUrl(s.icon)}},405640:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLatestMessageTimestamp=w,t.getNotificationAction=function(e,t,s){return T.EnsureStarted([S.default]).then((()=>{const i=S.default.getUserPreferencesLocal(),o=i.ignoreActiveEndpointFiltering||a.default.getS4LMessagingFeaturesNoSubscription().enableDefaultOnForMultiDevicePushNotifications&&void 0===i.ignoreActiveEndpointFiltering;if(e&&!o)return g.log(p.LogTraceArea.Notifications,"Notification ignored, there is an active endpoint on another device"),P;{const e=t.getSubscription(),i=s.getMessageNotificationClass();return e===d.SubscriptionTypes.Muted?(g.log(p.LogTraceArea.Notifications,"Notification ignored, current chat is muted"),P):l.isAddMemberMessageType(s.messagetype)?{action:_.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:_.MessageNotificationType.AddToConversation}:i!==b.MessageNotificationClass.SystemInformational||t.isEncryptedThread()&&s.isE2eeHandshakeTypeAllowedForNotification()?t.isReactionsThread()?(g.log(p.LogTraceArea.Notifications,"Notification ignored, reactions thread"),P):t.isOneOnOne()||e!==d.SubscriptionTypes.Normal||i===b.MessageNotificationClass.MentionedOrQuoted||(0,f.isLastMessageUpdateReaction)(s)?l.isScheduledCallType(s.messagetype)?(g.log(p.LogTraceArea.Notifications,"Notification is from a scheduled call, inform user."),{action:_.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:_.MessageNotificationType.ScheduledCall}):c.default.getConversationMeta(t.id).then((e=>{if(!e||!e.counts)return g.log(p.LogTraceArea.Notifications,"Notification ignored, no counts"),P;const t=Number(e.counts.consumptionHorizonTimestamp),i=w(s);if(t>=i)return g.log(p.LogTraceArea.Notifications,"Notification ignored, message already viewed, consumptionHorizonTime ("+t+") >= newMessageTimestamp ("+i+")"),P;{const e=k(s);return g.log(p.LogTraceArea.Notifications,"Previous message is old, preparing to display current notification to user"),{action:_.MessageNotificationAction.InterruptUser,snoozeUntil:void 0,notificationType:e}}})).catch((()=>(g.log(p.LogTraceArea.Notifications,"Notification ignored, unknown failure"),P))):(g.log(p.LogTraceArea.Notifications,'Notification ignored, group message notification with no mention or quote ("smart" setting turned on)'),P):(g.log(p.LogTraceArea.Notifications,"Notification ignored, system info"),P)}}))},t.getMessageNotificationType=k,t.recomputeAndroidNotifications=function(e,t,s){if(M.default.getPlatformType()!==p.PlatformType.Android)return r.Resolved();if(A)return r.Resolved();s&&(s.enableExpandedNotifications=!0);let i;if(A=!0,1!==e.length||t)if(0===e.length)n.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER});else{if(!t){const t=e[e.length-1];n.LocalNotifications.cancel({id:t.conversationId+t.messageTimestamp}),n.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER})}const a=[],l=[];let d,c="",u=!1,h=0;o.each(e,(e=>{const t={category:e.category,title:e.title,message:e.message,id:e.id};e.messageTimestamp>h&&(c=e.messageCreatorName||"",h=e.messageTimestamp,e.serviceSpecificData&&(u=e.serviceSpecificData.eventType===p.NotificationTypeAppLaunched.Reaction)),a.push(t),l.push(e.conversationId)}));let g=!1;s&&!t&&(s.sound&&(d=s.sound),void 0!==s.enableVibration&&(g=s.enableVibration));const S={category:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER,id:t?y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER:I.default.newGuid(),priority:n.NotificationPriority.Max,sound:d,silent:!d,enableVibration:g,enableExpandedNotifications:!!t,messageTimestamp:h};S.groupedNotifications=a,S.title=m.getString("Notifications.MultiNotificationTitle",{count:o.size(o.uniq(l))}),S.message=m.getString(u?"Notifications.MultiReactionNotificationMessage":"Notifications.MultiNotificationMessage",{creator:c||m.getString("Notifications.UnknownUser")}),S.enableLight=!0,S.icon=void 0,t&&s&&(v.printNotificationTrace(s,"recomputeAndroidNotification grouped current"),i=n.LocalNotifications.show(s)),v.printNotificationTrace(S,"recomputeAndroidNotification grouped");const _=n.LocalNotifications.show(S);i=i?r.all([_,i]).then(o.noop):_}else{const t=s||e[0];v.printNotificationTrace(t,"recomputeAndroidNotification single"),n.LocalNotifications.cancel({id:y.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER}),i=n.LocalNotifications.show(t)}return A=!1,i||r.Resolved()},t.sendRawMessage=function(e,t){return x(e,t,void 0)},t.sendRawMessageFromEntities=function(e,t){return x(e,void 0,t)},t.getLastReactionUserMri=function(e){const t=e.getCleanedEmotionAnnotations(),s=o.maxBy(o.flatMap(t,(e=>o.map(e.users,(e=>e)))),(e=>e.time||Number.MAX_VALUE));if(s)return s.mri;return},t.getReasonForNotificationsDisabled=D,t.areNotificationsEnabled=function(){return void 0===D()};const i=s(197582),o=i.__importStar(s(496486)),n=s(279211),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=i.__importStar(s(971988)),d=i.__importStar(s(44717)),c=i.__importDefault(s(434343)),u=i.__importStar(s(459287)),h=i.__importDefault(s(794229)),p=s(815146),g=i.__importStar(s(85385)),m=i.__importStar(s(704704)),S=i.__importDefault(s(201721)),_=s(395617),f=s(995276),y=s(528196),v=i.__importStar(s(528196)),C=i.__importDefault(s(863132)),T=i.__importStar(s(446574)),M=i.__importDefault(s(139221)),b=s(331079),I=i.__importDefault(s(760989));function w(e){if((0,f.isLastMessageUpdateReaction)(e)){const t=e.getLastReactionTimeExcludingCurrentUser();if(t)return t}return e.createdTime}const P={action:_.MessageNotificationAction.Ignore,snoozeUntil:void 0,notificationType:_.MessageNotificationType.RegularMessage};function k(e){return(0,f.isLastMessageUpdateReaction)(e)?_.MessageNotificationType.Reaction:e.isCurrentUserQuoted()?_.MessageNotificationType.Quote:e.isCurrentUserMentioned()?_.MessageNotificationType.Mention:_.MessageNotificationType.RegularMessage}let A=!1;function x(e,t,s){1!==o.sum(o.map([t,s],(e=>void 0===e)))&&g.error(p.LogTraceArea.Notifications,"sendMessageInternal received invalid input");const i=r.Defer();return T.EnsureStarted([C.default,h.default]).then((()=>{const r=p.PostSource.ReplyFromNotification;let a;a=void 0!==t?u.createMessageInfoFromEscapedText(e,r,t):u.createMessageInfo(e,r,s);const l=a.messageForPosting.clientmessageid,d=C.default.postUpdated.subscribe((e=>{e.isFinished&&o.each(e.messagesForPosting,((e,t)=>{const s=e.clientmessageid;s===l&&(d.unsubscribe(),i.resolve(s))}))})),c={category:v.LocalNotificationIds.CHAT_ERROR_CATEGORY_IDENTIFIER,id:I.default.newGuid(),message:m.getString("Notifications.ReplyNotSent"),priority:n.NotificationPriority.Max};C.default.postMessage(a,c)})),i.promise()}function D(e=!1){const t=S.default.getUserPreferencesLocal();if(!t.enableChatNotifications)return p.MessageProcessResult.ChatNotificationsDisabled;t.disableChatNotificationsUntil}},152010:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAddCurrentUserThreadActivity=function(e){if(!n.isAddMemberMessageType(e.messagetype))return!1;const t=r.decode(e),s=o.first(t.children);if(s instanceof a.AddMemberNode)return!!o.find(s.content,(e=>l.default.isMyMri(e.getRawText())));return!1},t.getMessageInitiator=function(e){const t=r.decode(e),s=t.children&&t.children.length>0?t.children[0]:void 0;if(s instanceof a.ThreadActivity){const e=s.initiator.getRawText();return e||void 0}return};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(971988)),r=i.__importStar(s(463519)),a=s(606933),l=i.__importDefault(s(363091))},598040:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageRenderingOptions=function(e){if(e.skypeMessage.isReported())return l.getReportedMessageRenderingOptions(e);const t=n.getMessageTypeGroup(e.skypeMessage);return function(e,t){switch(t){case a.PictureMessageRenderingOptions.messageTypeGroup:return new a.PictureMessageRenderingOptions(e);case a.VideoMessageRenderingOptions.messageTypeGroup:return new a.VideoMessageRenderingOptions(e);case a.AudioMessageRenderingOptions.messageTypeGroup:return new a.AudioMessageRenderingOptions(e);case a.StickerRenderingOptions.messageTypeGroup:return new a.StickerRenderingOptions(e);case a.MediaAlbumRenderingOptions.messageTypeGroup:return new a.MediaAlbumRenderingOptions(e);case o.ScheduledCallRenderingOptions.messageTypeGroup:return new o.ScheduledCallRenderingOptions(e);case o.PollRenderingOptions.messageTypeGroup:return new o.PollRenderingOptions(e);case o.LocationRenderingOptions.messageTypeGroup:return new o.LocationRenderingOptions(e);case o.CallInfoRenderingOptions.messageTypeGroup:return new o.CallInfoRenderingOptions(e);case o.FileMessageRenderingOptions.messageTypeGroup:return new o.FileMessageRenderingOptions(e);case o.SwiftMessageRenderingOptions.messageTypeGroup:return new o.SwiftMessageRenderingOptions(e);case o.ContactMessageRenderingOptions.messageTypeGroup:return new o.ContactMessageRenderingOptions(e);case l.TextMessageRenderingOptions.messageTypeGroup:return new l.TextMessageRenderingOptions(e);case l.SystemMessageRenderingOptions.messageTypeGroup:return new l.SystemMessageRenderingOptions(e);case l.SMSMessageRenderingOptions.messageTypeGroup:return new l.SMSMessageRenderingOptions(e);case l.CallerIDRenderingOptions.messageTypeGroup:return new l.CallerIDRenderingOptions(e);case l.EngagementMessageRenderingOptions.messageTypeGroup:return new l.EngagementMessageRenderingOptions(e);case o.MagicBotToolboxRenderingOptions.messageTypeGroup:return new o.MagicBotToolboxRenderingOptions(e);case r.UnknownMessageTypeRenderingOptions.messageTypeGroup:default:return new r.UnknownMessageTypeRenderingOptions(e)}}(e,t).getRenderingOptions()};const i=s(197582),o=i.__importStar(s(478193)),n=i.__importStar(s(971988)),r=(s(971988),s(939449)),a=i.__importStar(s(477066)),l=i.__importStar(s(998157))},140304:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageTimestamp=function(e,t){const s=e.MessageId,i=e.ServerMessageId?Number(e.ServerMessageId):void 0;if(!s)return o.Resolved({timestamp:i});return o.fromThenable(d.MessagesRepository.getMessageByCuid(t,s)).then((e=>e?{timestamp:e.createdTime}:o.Rejected(void 0))).catch((e=>{const d=e?`err=${a.default.errorAsString(e)}`:"";return r.log(n.LogTraceArea.ContentPanel,`_getMessageTimestamp could not fetch message conversationId=${l.mriOrId(t)} cuid=${s} id=${i} ${d}`),o.Resolved({timestamp:i,cuid:s})}))},t.getGalleryItemTimestamp=function(e,t,s){if(!e)return o.Resolved({timestamp:s});return o.fromThenable(d.MessagesRepository.getMessageByCuid(t,e)).then((e=>e?{timestamp:e.createdTime}:o.Rejected(void 0))).catch((i=>{const d=i?`err=${a.default.errorAsString(i)}`:"";return r.log(n.LogTraceArea.ContentPanel,`_getMessageTimestamp could not fetch message conversationId=${l.mriOrId(t)} cuid=${e} id=${s} ${d}`),o.Resolved({timestamp:s,cuid:e})}))};const i=s(197582),o=i.__importStar(s(397691)),n=(i.__importStar(s(496486)),s(815146)),r=i.__importStar(s(85385)),a=i.__importDefault(s(655192)),l=i.__importStar(s(437782)),d=s(123117)},632655:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldCancelMessageSelection=function(e,t){return t!==e}},172792:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setFontSize=function(e,t){c.default.setUserPreferencesLocal({messageStreamFontSize:e}),a.track(new d.FontSizeSetting(e,t))},t.getMultiplier=u,t.getSize=h,t.getStyleFromStyle=function(e,t){const s=o.default.getFontSize(e);if(s)return p(s,t);return},t.getStyle=p,t.isFontSmall=function(e){return e===l.MessageStreamFontSize.Small||e===l.MessageStreamFontSize.Smaller},t.isFontLarge=function(e){return e===l.MessageStreamFontSize.Large||e===l.MessageStreamFontSize.Larger};const i=s(197582),o=i.__importDefault(s(672205)),n=i.__importStar(s(516778)),r=i.__importDefault(s(150343)),a=i.__importStar(s(85385)),l=s(954225),d=s(196761),c=i.__importDefault(s(201721));function u(e){const t=r.default.getS4LMessagingFeaturesNoSubscription().messageStreamFontSizeMultiplier;switch(e){case l.MessageStreamFontSize.Smaller:return t.smaller;case l.MessageStreamFontSize.Small:return t.small;case l.MessageStreamFontSize.Large:return t.large;case l.MessageStreamFontSize.Larger:return t.larger;case l.MessageStreamFontSize.Normal:default:return t.normal}}function h(e,t){return Math.round(e*u(t))}function p(e,t){return n.Styles.createTextStyle({fontSize:h(e,t)},!1)}},321783:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importDefault(s(150343)),a=i.__importDefault(s(304623)),l=s(815146),d=i.__importStar(s(85385)),c=s(156057),u=s(842267),h=i.__importStar(s(437782)),p=i.__importStar(s(446574));t.default=new class{constructor(){this._stores=new c.LinkedHashMap,this._removeLastCachedConversationOnGet=!1,this._conversationUpdatedCallback=e=>{o.each(e,(e=>{if(e.conv.isDeleted())if(e.conv.id===this._lastCachedConversationId)d.log(l.LogTraceArea.MessageStreamStoreCache,"Conversation updated callback for conversation delete"+h.mriOrId(e.conv.id)),this._removeLastCachedConversationOnGet=!0;else{const t=this._stores.remove(e.conv.id);t&&(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+h.mriOrId(e.conv.id)+" as conversation got deleted"),t.destroy())}}))},this._updateSettings=()=>{const e=r.default.getS4LMessagingFeaturesNoSubscription();this._maxCacheSize=e.messageStreamStoreCacheSize,this._maxMessageCountPerStore=e.messageStreamStoreCacheMaxMessageCount},this._destroyAllUnusedStores=()=>{for(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying unused cached stores because of low memory");this._stores.length()>1;){this._stores.removeFirst().destroy()}},p.RegisterStartupable(this,"MessageStreamStoreCache",[a.default])}startup(){return r.default.subscribe(this._updateSettings),a.default.conversationsUpdated.subscribe(this._conversationUpdatedCallback),n.App.memoryWarningEvent.subscribe(this._destroyAllUnusedStores),this._updateSettings(),Promise.resolve()}cachedStoreFor(e,t){if(this._removeLastCachedConversationOnGet){this._removeLastCachedConversationOnGet=!1;const e=this._stores.removeLast();e&&(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+h.mriOrId(e.getConversationId())+" as _removeLastCachedConversationOnGet == true for "+h.mriOrId(this._lastCachedConversationId)),e.destroy())}let s=this._stores.remove(e);const i=h.mriOrId(e)+" at="+(t||"EndOfTime");return s&&this._isCachedItemUseableFor(s,t)?d.log(l.LogTraceArea.MessageStreamStoreCache,"Reusing existing MessageStreamStore for "+i):(s&&s.destroy(),d.log(l.LogTraceArea.MessageStreamStoreCache,"Creating new MessageStreamStore for "+i+", was cached before: "+!!s),s=new u.MessageStreamStore(e,t)),this._removeStoresThatAreTooBigToBeCached(),this._removeFirstStoreIfNotEnoughSpace(),this._lastCachedConversationId=e,this._stores.addLast(e,s),s}_isCachedItemUseableFor(e,t){const s=e.getMessages();return 0===s.length?e.getTargetMessageTimestamp()===t:!(t&&o.first(s).createdTime>t||t&&o.last(s).createdTime<t||!t&&!e.isLatestMessageTheEnd())&&(!e.probablyShouldNotCache()||(d.log(l.LogTraceArea.MessageStreamStoreCache,"Invalidating MessageStreamStore for "+h.mriOrId(e.getConversationId())+" because it has a possible gap."),!1))}_removeStoresThatAreTooBigToBeCached(){const e=this._stores;for(this._stores=new c.LinkedHashMap;e.length()>0;){const t=e.removeFirst(),s=t.getMessages().length;s>this._maxMessageCountPerStore?(d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+h.mriOrId(t.getConversationId())+" because its too big ("+s+" > "+this._maxMessageCountPerStore+" messages)"),t.destroy()):this._stores.addLast(t.getConversationId(),t)}}_removeFirstStoreIfNotEnoughSpace(){if(this._stores.length()>this._maxCacheSize){const e=this._stores.removeFirst();d.log(l.LogTraceArea.MessageStreamStoreCache,"Destroying MessageStreamStore for "+h.mriOrId(e.getConversationId())+" to free up space in the cache (max "+this._maxCacheSize+")"),e.destroy()}}}},375230:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetEmoticonSuggestions=function(e,t,s){const i=[];if(!t)return i;if(1===(e=e.toLowerCase()).length&&e[0]>="a"&&e[0]<="z")return i;const d=n.default.getEmoticonsNoSubscription(),c={};o.each(d,((t,s)=>{e.length>=s.length||0!==s.indexOf(e)||c[t.id]||(c[t.id]=s)}));let u=o.sortBy(c,(e=>e.length));if(0===u.length&&"("===o.first(e))if(o.last(e)===l.DiverseToneSeparator){const t=e.slice(0,-1)+")",s=d[t];if(s&&s.diverse)return o.each(l.DiverseToneSuffixes,(o=>{const n=new r.EmoticonEntity(t,s.id,o);i.push({entity:n,charsToReplace:e.length,replacementText:n.text()})})),i}else if(e.length>1&&":"===e.charAt(e.length-2)){const t=e.slice(0,-2)+")",s=d[t];if(s&&s.diverse){const n=a.default.getItemToneFromString(e.charAt(e.length-1));if(o.includes(l.DiverseToneSuffixes,n)){const o=new r.EmoticonEntity(t,s.id,n);i.push({entity:o,charsToReplace:e.length,replacementText:o.text()})}return i}}u.length>s&&(u=u.slice(0,s));return o.each(u,(t=>{const s=n.default.getEmoticonByShortcutNoSubscription(t);if(!s)return;const o=new r.EmoticonEntity(t,s.id,s.tone);i.push({entity:o,charsToReplace:e.length,replacementText:t})})),i};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(794229)),r=i.__importStar(s(626065)),a=i.__importDefault(s(336817)),l=s(186907)},252531:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBackgroundColorStyleForMessage=function(e){let t,s;e.postedByCurrentUser||e.theme===d.Theme.Mono?(t=a.default.getColorInfo(),s=a.default.getPrimaryColor()):(t=n.default.getColorInfo(e.messageCreatorMri),s=n.default.getPrimaryColor(e.messageCreatorMri));const i=function(e,t){if("classic"===t.key)return!1;return e}(!!e.flipBubbleColors,t),h=!i,p=e.messageRenderOrigin!==r.MessageRenderOrigin.StackGalleryCanvas&&e.messageRenderOrigin!==r.MessageRenderOrigin.CompositeGalleryCanvas,g=u(e,i)||(m=e.theme,c.isAccessibleTheme(m));var m;let S,_;const f=e.themeStyles.secondaryTextColorStyle;S=e.postedByBot&&e.themeStyles.bubbleTextColorBotStyle?e.themeColors.bubbleTextColorBot:e.postedByCurrentUser&&p&&!h||e.postedByCurrentUser&&!p&&c.isAccessibleTheme(e.theme)||!e.postedByCurrentUser&&i?e.themeColors.bubbleTextColorSelf:e.themeStyles.bubbleTextColorOtherStyle?e.themeColors.textChat:e.themeColors.textPrimary;const y=(!e.postedByCurrentUser&&!i||e.postedByCurrentUser&&i)&&c.isDarkTheme(e.theme)&&"classic"!==a.default.getColorInfo().key?l.Color.white:e.themeColors.textPrimary,v=o.Styles.createTextStyle({color:y},!1);e.postedByCurrentUser||c.isDelphiTheme(e.theme)||(_=e.theme===d.Theme.AccessibleDark?v:o.Styles.createTextStyle({color:l.Color.white},!1));const C=e.messageStreamHasUnderlay?l.Color.transparent:e.themeColors.messageStreamBackgroundColor,T=function(e,t){const s=!u(e,t);if(!s)return e.themeColors.surfaceSecondary;return e.themeColors.bubble}(e,i);return{messageTextOverrideColorStyle:v,linkOverrideColorStyle:_,quoteAttributeOverrideColorStyle:f,userIconBackgroundColor:C,bubbleColor:T,disableGradient:g,userPrimaryColor:s,quoteColor:S}};const i=s(197582),o=i.__importStar(s(516778)),n=i.__importDefault(s(734468)),r=s(242561),a=i.__importDefault(s(252089)),l=s(16549),d=s(206197),c=i.__importStar(s(972830));function u({postedByCurrentUser:e,postedByBot:t},s){return!!t||(e&&s||!e&&!s)}},50369:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(815063)),n=i.__importDefault(s(150343)),r=s(968739),a=i.__importDefault(s(48076)),l=i.__importDefault(s(942724));t.default=new class{canSetEmoticonAvatarForGroupProfile(){const e=n.default.getS4LMeetNowFeatures().mobileMeetingAvatarAndTitlePickerEnabled,t=(0,r.canGenerateAvatars)();return l.default.isMobileEnvironmentWithStackNavigation()&&t?!e&&a.default.isTabletNoSubscription():t}modernizeChatHeaderMobileVersion(){return this._isSupportedPlatform()&&!(a.default.isTablet()&&!l.default.isUsingStackNavigationContext())}_isSupportedPlatform(){return o.default.isMobile()}}},675862:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isRegularMemberInModeratedGroup=t.isCurrentUserAdminInModeratedGroup=t.isModerated=void 0;const i=s(197582),o=i.__importDefault(s(150343)),n=i.__importDefault(s(363091));t.isModerated=e=>o.default.getS4LMessagingFeaturesNoSubscription().enableModeratedGroupChats&&!!(null==e?void 0:e.isModerated());t.isCurrentUserAdminInModeratedGroup=e=>(0,t.isModerated)(e)&&!!(null==e?void 0:e.isAdmin(n.default.getSkypeMri()));t.isRegularMemberInModeratedGroup=e=>(0,t.isModerated)(e)&&!(null==e?void 0:e.isAdmin(n.default.getSkypeMri()))},183363:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MriThreadMapping=void 0;const i=s(197582).__importStar(s(496486));t.MriThreadMapping=class{constructor(){this._threadIdByMri={},this._mriByThreadId={}}add(e,t){this._threadIdByMri[e]=t,this._mriByThreadId[t]=e}hasThreadId(e){return!i.isUndefined(this._mriByThreadId[e])}getMriByThreadId(e){return this._mriByThreadId[e]}getThreadIdByMri(e){return this._threadIdByMri[e]}}},434364:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shouldShowFreHeader=function(e,t){if(!e)return!1;return!t||t!==o.default.getAppVersion()},t.canDeleteMyBotContact=function(e,t=!1,s=!1){const i=!!e&&n.isMyBotConversation(e);return!t&&s&&!i};const i=s(197582),o=i.__importDefault(s(139221)),n=i.__importStar(s(44717))},750822:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.shareContact=function(e,t,s){const i=new r.ContactEntity(e.skypeId,e.fullName,e.isPstn,e.skypeId,e.isS4B),a=n.createMessageInfo(t,s,[i],o.MessageTypes.Contacts);l.default.postMessage(a)},t.forwardContact=function(e,t,s){const i=a.encode([new r.ContactEntity(e.skypeId,e.fullName,e.isPstn,e.skypeId,e.isS4B)],!1),d=n.createForwardMessageInfo(t,s,i,o.MessageTypes.Contacts);l.default.postMessage(d)};const i=s(197582),o=i.__importStar(s(971988)),n=i.__importStar(s(459287)),r=i.__importStar(s(626065)),a=i.__importStar(s(7040)),l=i.__importDefault(s(863132))},819549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(633788)),r=i.__importDefault(s(206483)),a=i.__importStar(s(971988)),l=i.__importStar(s(633949)),d=i.__importStar(s(459287)),c=s(815146),u=s(626065),h=i.__importStar(s(626065)),p=i.__importStar(s(85385)),g=i.__importStar(s(704704)),m=i.__importStar(s(606933)),S=s(786531),_=i.__importDefault(s(503411)),f=i.__importDefault(s(740794)),y=s(113002),v=i.__importStar(s(757838)),C=i.__importDefault(s(863132)),T=s(928722),M=i.__importDefault(s(989314)),b=i.__importDefault(s(760989));class I{static getShareParametersForAdaptiveMessage(e,t,s){const i=t.getFirstUriObjectChild(m.SwiftUriObjectNode);if(i){const t=o.find(i.children,(e=>e instanceof m.AdaptiveCardNode));if(t&&t.adaptiveCardMessage){const i=()=>{n.TrackForwarding(e.creator)};return{messageContent:e.content,messageType:e.messagetype,adaptiveCardMessage:t.adaptiveCardMessage,conversationId:s,onShareCompleteForMessage:i}}}}static forwardDocument(e,t,s){const i=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.forwardMediaMessage, causeId: "+i);const o=this.getShareParametersForMedia(e,t,!0,s.rootViewId);o&&f.default.navigateToShareWithPanel({multipleMessagesParameters:[o],shareMessageTitle:g.getString("StreamItem.ForwardMessagesHeader",{count:1}),navigationDirection:T.StackNavigationDirection.Present,causeId:i,entryPoint:c.SharePanelEntryOrigin.DocumentActionMenu,sharePreviewType:y.SharePreviewType.File},s)}static showErrorForForwardMedia(e){r.default.showOKAlert(g.getString("ShareMessageUtils.FailedForwardMediaTitle"),g.getString("ShareMessageUtils.FailedFowardMediaDescription"),e)}static getShareParametersForSwiftMessage(e,t,s,i,n,r){const a=t.getFirstUriObjectChild(m.SwiftUriObjectNode);if(a){let s;const l=o.find(a.children,(e=>e instanceof m.SwiftNode));if(l&&l.swiftMessage){const a=o.map(l.swiftMessage.attachments,(e=>e.unsanitizedAttachment)),d={type:l.swiftMessage.type,summary:l.swiftMessage.summary,attachments:a},u=o.flatMap(a,(e=>M.default.getForwardMediaInfos(e))),h=()=>{i&&r&&f.default.navigateToConversation({convId:i,origin:c.NavigationConversationOrigin.SwiftForwardComplete,causeId:n})};if(!M.default.isSwiftCarousel(t)){const e=l.swiftMessage.attachments;e&&e.length&&(s=M.default.getImageUrl(e[0]))}return{messageContent:e.content,messageType:e.messagetype,swiftMessage:d,forwardMediaInfos:u,conversationId:i,onShareCompleteForMessage:h,localMediaThumbnailUri:s}}}}static shareSwiftMessageWithConfig(e){this._shareSwiftMessage(e.message,e.shareMessageTitle,e.sharePanelEntryOrigin,e.onShareComplete,e.onPostComplete,e.onShareCancel,e.conversationId,e.componentContext,e.isMagicBotShare,e.channelShortId,e.channelId,e.isChannelShare)}static getShareParametersForText(e,t,s){let i,o,n;const r=l.toForwardUrlInfo(e);return r?i=r.url:(n=t.hasOnlyQuotedContent(),o=l.toForwardQuoteMessageEntities(e)),{message:e,inputEntities:o,messageType:a.MessageTypes.RichText,onShareCompleteForMessage:t=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,s,S.MessageActionType.Forward,t);p.track(i)},urlPreviewData:r,url:i,sendAsForwardedQuote:n}}static getShareParametersForAlbumMsg(e,t,s){return{messageContent:d.createMediaAlbumMessage(e.conversationId,c.PostSource.ForwardAlbum,s).messageForPosting.content,messageType:a.MessageTypes.MediaAlbum,onShareCompleteForMessage:s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)},albumId:s}}static shareMultipleMessages(e,t,s,i,o,n,r,a,l){f.default.navigateToShareWithPanel({multipleMessagesParameters:e,shareMessageTitle:t,navigationDirection:T.StackNavigationDirection.Present,onShareComplete:o,causeId:s,sharePreviewType:r,showForwardPreview:a,entryPoint:i,onExternalShare:l},n)}static getShareParametesForLocation(e,t){const s=l.toForwardLocationInfo(e);return{messageContent:e.content,messageType:a.MessageTypes.Location,onShareCompleteForMessage:s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)},locationInfo:s,localMediaThumbnailUri:s?s.snapshotUri:void 0}}static shareLocation(e,t,s){const i=[this.getShareParametesForLocation(e,t)],o=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareLocation, causeId: "+o),f.default.navigateToShareWithPanel({multipleMessagesParameters:i,shareMessageTitle:g.getString("StreamItem.ForwardLocationMessageHeader"),navigationDirection:T.StackNavigationDirection.Present,causeId:o,entryPoint:c.SharePanelEntryOrigin.LocationActionMenu,sharePreviewType:y.SharePreviewType.Location},s)}static getShareParametesForContactEntity(e,t,s){return{messageType:a.MessageTypes.Contacts,onShareCompleteForMessage:s||void 0,inputEntities:e,contactInfo:{skypeId:e.getSkypeId(),fullName:e.getFullName(),isPstn:e.isPstn(),isS4B:e.isS4B(),userMri:t}}}static getShareParametesForContactMessage(e,t,s){const i=l.toForwardContactInfo(e);if(!i)return;const o=new u.ContactEntity(i.skypeId,i.fullName,i.isPstn,i.isPstn?i.skypeId:"",i.isS4B);return{messageType:a.MessageTypes.Contacts,onShareCompleteForMessage:s||(s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)}),inputEntities:o,contactInfo:{skypeId:o.getSkypeId(),fullName:o.getFullName(),isPstn:o.isPstn(),userMri:i.userMri,isS4B:o.isS4B()}}}static shareContact(e,t,s,i){const o=b.default.newCauseId(),n=[this.getShareParametesForContactEntity(e,s,i)];f.default.navigateToShareWithPanel({multipleMessagesParameters:n,shareMessageTitle:g.getString("StreamItem.ForwardMessageContact"),navigationDirection:T.StackNavigationDirection.Present,causeId:o,entryPoint:c.SharePanelEntryOrigin.UserProfile,sharePreviewType:y.SharePreviewType.Contact,showForwardPreview:!1},t,!0)}static shareSwiftMessageToConversation(e,t,s){const i=new h.SwiftUriObjectEntity(e,t,!0,e.summary),o=d.createMessageInfo(t,c.PostSource.ShareSwiftMessage,[i],a.MessageTypes.Media_Card);C.default.postMessage(o),s&&s(e,{clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareAdaptiveMessageToConversation(e,t,s){const i=new h.AdaptiveUriObjectEntity(e,t,!0),o=d.createMessageInfo(t,c.PostSource.ShareSwiftMessage,[i],a.MessageTypes.Media_Card);C.default.postMessage(o),s&&s(e,{clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareMessageFromBrowser(e,t,s){const i=b.default.newCauseId();p.log(c.LogTraceArea.Navigation,"ShareMessageUtils.shareMessageFromBrowser, causeId: "+i),e.forward||!e.conversationId?I.shareSwiftMessageWithConfig({message:e.swiftMessage,shareMessageTitle:g.getString("InAppWebBrowser.ShareCardPanelTitle"),sharePanelEntryOrigin:c.SharePanelEntryOrigin.AddInMenu,onShareComplete:()=>{if(e.shareAndStay||f.default.closeInAppBrowser(i,s),e.showCompleteToast){const e=v.rootViewIdForComponentContext(s);_.default.scheduleTextMessage(g.getString("InAppWebBrowser.CardSharedTitle"),void 0,e)}},onPostComplete:t=>{e.onCardPostComplete&&e.onCardPostComplete(e,t)},onShareCancel:()=>{e.onShareCancel&&e.onShareCancel()},componentContext:s}):(e.shareAndStay||f.default.closeInAppBrowser(i,s),t?I.shareAdaptiveMessageToConversation(e.adaptiveMessage,e.conversationId,((t,s)=>{e.onCardPostComplete&&e.onCardPostComplete(e,[s])})):e.swiftMessage&&I.shareSwiftMessageToConversation(e.swiftMessage,e.conversationId,((t,s)=>{e.onCardPostComplete&&e.onCardPostComplete(e,[s])})))}static shareText(e,t,s,i,o,n,r,l,d){s=s||g.getString("StreamItem.ForwardMessagesHeader",{count:1});const u=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareText, causeId: "+u);const h={messageContent:e,messageType:a.MessageTypes.Text,conversationId:r};f.default.navigateToShareWithPanel({multipleMessagesParameters:[h],shareMessageTitle:s,navigationDirection:T.StackNavigationDirection.Present,onShareComplete:i,onPostComplete:o,onShareCancel:n,causeId:u,entryPoint:t||c.SharePanelEntryOrigin.InAppBrowserActionMenu,sharePreviewType:y.SharePreviewType.Text,onExternalShare:d},l)}static shareUrl(e,t,s,i,o,n,r,l,d){const u=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareUrl, causeId: "+u);const h={url:e,messageType:a.MessageTypes.RichText,conversationId:n};f.default.navigateToShareWithPanel({multipleMessagesParameters:[h],shareMessageTitle:t,navigationDirection:T.StackNavigationDirection.Present,onShareComplete:s,onPostComplete:i,onShareCancel:o,causeId:u,entryPoint:l||c.SharePanelEntryOrigin.InAppBrowserActionMenu,sharePreviewType:y.SharePreviewType.Text,onExternalShare:d},r)}static shareUrlToConversation(e,t,s){const i=new h.LinkEntity(e,e),o=d.createMessageInfo(t,c.PostSource.ShareUrl,[i],a.MessageTypes.RichText);C.default.postMessage(o),s&&s({clientMessageId:o.messageForPosting.clientmessageid,conversationId:o.conversationId})}static shareUrlFromInAppBrowser(e,t){const s=b.default.newCauseId();p.log(c.LogTraceArea.Navigation,"ShareMessageUtils.shareUrlFromInAppBrowser, causeId: "+s),e.forward||!e.conversationId?I.shareUrl(e.url,g.getString("InAppWebBrowser.ShareLinkPanelTitle"),(()=>{var i;if(e.shareAndStay||f.default.closeInAppBrowser(s,t),e.showCompleteToast){const e=v.rootViewIdForComponentContext(t);_.default.scheduleTextMessage(g.getString("InAppWebBrowser.LinkSharedTitle"),void 0,e)}null===(i=e.onShareComplete)||void 0===i||i.call(e)}),(t=>{e.onUrlPostComplete&&e.onUrlPostComplete(e,t)}),(()=>{e.onShareCancel&&e.onShareCancel()}),void 0,t,e.sharePanelEntryOrigin,e.onExternalShare):(e.shareAndStay||f.default.closeInAppBrowser(s,t),I.shareUrlToConversation(e.url,e.conversationId,(t=>{e.onUrlPostComplete&&e.onUrlPostComplete(e,[t])})))}static sharePhoto(e,t,s,i,o,n,r,l,d,u){const h=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.sharePhoto, causeId: "+h);const g={localMediaObjectUri:e,localMediaThumbnailUri:t,fileSize:s,width:i,height:o,messageType:a.MessageTypes.UriObject,conversationId:l,cameraMode:d};f.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:n,navigationDirection:T.StackNavigationDirection.Push,onShareComplete:r,causeId:h,entryPoint:c.SharePanelEntryOrigin.CapturePhotoOrVideo},u)}static shareVideo(e,t,s,i,o,n,r,l,d,u){const h=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareVideo, causeId: "+h);const g={localMediaObjectUri:e,localMediaThumbnailUri:t,fileSize:s,width:i,height:o,messageType:a.MessageTypes.Media_Video,conversationId:l,cameraMode:d};f.default.navigateToShareWithPanel({multipleMessagesParameters:[g],shareMessageTitle:n,navigationDirection:T.StackNavigationDirection.Push,onShareComplete:r,causeId:h,entryPoint:c.SharePanelEntryOrigin.CapturePhotoOrVideo},u)}static shareMediaSelection(e,t,s,i,o){const n=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareMediaSelection, causeId: "+n);const r={mediaSelection:e,messageType:e.node.node.isPhoto?a.MessageTypes.UriObject:a.MessageTypes.Media_Video,conversationId:i};f.default.navigateToShareWithPanel({multipleMessagesParameters:[r],shareMessageTitle:t,navigationDirection:T.StackNavigationDirection.Push,onShareComplete:s,causeId:n,entryPoint:c.SharePanelEntryOrigin.MessageActionMenu},o)}static _shareSwiftMessage(e,t,s,i,n,r,l,d,u,h,g,m){const S=b.default.newCauseId();p.log(c.LogTraceArea.GenericUnsafe,"ShareMessageUtils.shareSwiftMessage, causeId: "+S);const _=o.flatMap(e.attachments,(e=>M.default.getForwardMediaInfos(e))),y={swiftMessage:e,messageType:a.MessageTypes.Media_Card,forwardMediaInfos:_,conversationId:l,onShareCompleteForMessage:i};f.default.navigateToShareWithPanel({multipleMessagesParameters:[y],shareMessageTitle:t,navigationDirection:T.StackNavigationDirection.Present,onPostComplete:n,onShareCancel:r,causeId:S,entryPoint:s,isMagicBotShare:u,channelShortId:h,channelId:g,isChannelShare:m},d)}}I.getShareParametersForMedia=(e,t,s,i,o)=>{const n=l.toForwardMediaInfo(e);if(s&&!n)return void I.showErrorForForwardMedia(i);const r=Object.assign({},n);return{messageContent:e.content,messageType:e.messagetype,forwardMediaInfos:[r],onShareCompleteForMessage:s=>{const i=new S.ForwardedMessageTelemetry(e.conversationId,e,e.createdTime,t,S.MessageActionType.Forward,s);p.track(i)},localMediaThumbnailUri:r&&r.localMediaThumbnailUri,fileName:r&&r.filename,fileSize:r&&r.fileSize,fileType:r&&r.fileType,audioMessageDuration:r&&r.durationMs,albumId:o}},t.default=I},110895:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importStar(s(971988)),a=i.__importStar(s(459287)),l=s(815146),d=i.__importStar(s(626065)),c=i.__importStar(s(704704)),u=i.__importDefault(s(884030)),h=s(113002),p=i.__importDefault(s(863132)),g=s(96575),m=i.__importDefault(s(760989)),S="image",_="video";class f{static processShareEvent(e,t=""){switch(e.type){case"text":return this._processTextShareEvent(e);case"media":return this._processMediaShareEvent(e,t);default:return m.default.switchStatementExhaustiveChecking(e.type)}}static _processTextShareEvent(e){return{multipleMessagesParameters:[{messageContent:e.text}],sharePreviewType:h.SharePreviewType.Text,directShareMri:e.directShareMri}}static _processMediaShareEvent(e,t){if(!e.data||o.isEmpty(e.data))return;return{multipleMessagesParameters:this._formatMediaMessageParameters(e.data,t),sharePreviewType:this._findMediaPreviewType(e.data),directShareMri:e.directShareMri}}static _formatMediaMessageParameters(e,t){return o.map(e,(e=>({localMediaThumbnailUri:t+(e.thumbnailUri||e.uri),fileName:e.name,fileSize:e.size})))}static _findMediaPreviewType(e){return o.every(e,(e=>e.type===S))?h.SharePreviewType.Photo:o.every(e,(e=>e.type===_))?h.SharePreviewType.Video:o.every(e,(e=>e.type===_||e.type===S))?h.SharePreviewType.MixedVideoAndPhoto:o.some(e,(e=>"file"===e.type))?h.SharePreviewType.File:h.SharePreviewType.Text}static postSharedMessage(e,t,s){return"media"===e.type?this._postSharedMedia(e.data,t,s):n.Resolved()}static _postSharedMedia(e,t,s){return u.default.postShareEventMediaSelections(e,t,{name:g.ScenarioName.ShareToSkypeMedia},s)}static getPreviewInfoTitle(e,t){return e&&1===e.length?e[0].fileName||"":this._getTitleWithShareItemsCount(e,t)}static _getTitleWithShareItemsCount(e,t){let s;switch(t){case h.SharePreviewType.Photo:s=c.getString("ShareWithPanel.PhotoCount",{count:e.length});break;case h.SharePreviewType.Video:s=c.getString("ShareWithPanel.VideoCount",{count:e.length});break;default:s=c.getString("ShareWithPanel.GenericCount",{count:e.length})}return s}static getPreviewInfoSizeInBytes(e){let t=0;return o.each(e,(e=>{e.fileSize&&(t+=e.fileSize)})),t}static sendPreviewTextMessage(e,t){const s=[new d.UnhandledEntity(t)];o.each(e,(e=>{p.default.postMessageFromInput(e,l.PostSource.ShareToSkype,s,r.MessageTypes.RichText,{name:g.ScenarioName.ForwardAdditionalText})}))}static shareMessageEntities(e,t,s,i=r.MessageTypes.RichText){const o=s?r.getForwardedTeamsProperties(s.properties):void 0,n=a.createForwardMessageInfoFromEntities(e,l.PostSource.ShareWith,t,i,o);return p.default.postMessage(n),{clientMessageId:n.messageForPosting.clientmessageid||"",conversationId:e}}static sendUrlAsLink(e,t){const s=[new d.LinkEntity(e,e)];return f.shareMessageEntities(t,s,void 0)}static sendUrlAsLinkMultipleConvs(e,t){o.each(t,(t=>{this.sendUrlAsLink(e,t)}))}}t.default=f},848267:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(150343)),n=i.__importDefault(s(606617)),r=i.__importDefault(s(201721)),a=3600;t.default=class{static changeExtensionForTelemetry(e){const t=o.default.getAsyncMediaFeatures().max_extension_length;return e?e.length<=t?e:"..."+e.substring(e.length-t).toLowerCase():""}static extractExtensionForTelemetry(e){const t=n.default.extractFileExtension(e,!0);return this.changeExtensionForTelemetry(t)}static currentMediaProfile(){const e=o.default.getS4LCMCFeatures().picturePrefetch,t=r.default.getUserPreferencesLocal().picturePrefetchMode||o.default.getS4LCMCFeatures().picturePrefetch.status;let s="ppref_"+t;if("Off"!==t){const t=Math.round(e.maxTimeIntervalPriorToStartupSec/a);s=s+"_"+e.maxQueuedEntriesCount+"_"+t+"h"}return s+"_"+("pcache_"+Math.round(o.default.getS4LCMCFeatures().picturePrefetchCacheExpiryTimeSec/a)+"h_vcache_"+Math.round(o.default.getS4LCMCFeatures().videoPrefetchCacheExpiryTimeSec/a)+"h")}}},998157:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EngagementMessageRenderingOptions=t.CallerIDRenderingOptions=t.SMSMessageRenderingOptions=t.SystemMessageRenderingOptions=t.TextMessageRenderingOptions=void 0,t.getReportedMessageRenderingOptions=function(e){const t=new P(e);return Object.assign(Object.assign({},t.getRenderingOptions()),{renderOnlyUrlPreview:void 0,urlPreviewRenderInformation:[]})};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importDefault(s(150343)),a=i.__importStar(s(971988)),l=i.__importStar(s(44717)),d=s(939449),c=i.__importStar(s(196509)),u=i.__importStar(s(242561)),h=i.__importStar(s(7040)),p=s(26703),g=i.__importStar(s(704704)),m=i.__importStar(s(606933)),S=i.__importStar(s(676908)),_=s(954225),f=s(206467),y=i.__importDefault(s(139221)),v=i.__importDefault(s(48076)),C=i.__importStar(s(277208)),T=(0,p.lazyProperties)({radius:()=>(0,p.lazyProperties)({currentUserUrlPreviewThumbnail:()=>n.Styles.createViewStyle({borderTopLeftRadius:_.messageBorderRadius,borderTopRightRadius:_.messageBorderRadius}),otherUserUrlPreviewThumbnail:()=>n.Styles.createViewStyle({borderTopLeftRadius:0,borderTopRightRadius:_.messageBorderRadius}),currentUserSubsequentMessage:()=>n.Styles.createViewStyle({borderTopRightRadius:0,borderBottomRightRadius:0}),currentUserSubsequentMessageRTL:()=>n.Styles.createViewStyle({borderTopLeftRadius:0,borderBottomLeftRadius:0}),othersSubsequentMessage:()=>n.Styles.createViewStyle({borderBottomLeftRadius:0}),othersSubsequentMessageRTL:()=>n.Styles.createViewStyle({borderBottomRightRadius:0})})});class M extends d.DefaultMessageRenderingOptions{constructor(e){super(e),this.messageProperties=e,e.isDisplayUrlPreviewsEnabled&&(this._urlPreviewData=C.getUrlPreviewInformationForMessage(e.skypeMessage,e.decodedNode),this._hasOnlyOneWebLink=C.hasOnlyWebLink(this._urlPreviewData,e.decodedNode),this._renderOnlyUrlPreview=this._hasOnlyOneWebLink&&this._urlPreviewData[0].isValid&&!e.decodedNode.isOnlyHyperLink())}_getTextMessageRadiusStyle(e){const t=y.default.isRTL();return this._messageProperties.skypeMessage.isBookmark()||(this._messageProperties.postedByCurrentUser?this._messageProperties.messageFirstInGroup||e.push(t?T.radius.currentUserSubsequentMessageRTL:T.radius.currentUserSubsequentMessage):this._messageProperties.messageLastInGroup||e.push(t?T.radius.othersSubsequentMessageRTL:T.radius.othersSubsequentMessage)),e}getMessageSpecificViewRenderingOptions(e){const t=this._messageProperties.skypeMessage.isEmote(),s=this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText(),i=r.default.getS4LMessagingFeaturesNoSubscription().enableNewEmoticonBackgroundRenderLogic?this._messageProperties.decodedNode.hasOnlyEmoticonsOrSpaceChars():s,o=this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),n=this._messageProperties.decodedNode.getNumberOfEmoticons(),l=this._messageProperties.decodedNode.getNumberOfUnicodeEmoji(),d=!(t||i&&n<=3||o&&l<=3),u=a.hasQuote(this._messageProperties.skypeMessage.content),h=this._messageProperties.skypeMessage.isEdited(),p=this._defaultSupportsShowingReactionsSummary&&!s&&!o;const g=Object.assign(Object.assign({},e),{renderMessageBackground:d,messageContentCentered:t,messageContainerRadiusStyle:e.messageContainerRadiusStyle&&this._getTextMessageRadiusStyle(e.messageContainerRadiusStyle),showReactionsOnMessage:p,overlayReactionsOnMessage:p,overrideLongPressForLinks:!1,showEditIndicator:h,availableSpace:this._messageProperties.containerMaxDimensions});return u&&(g.calcRenderDim=r.default.getS4LMessagingFeaturesNoSubscription().enableReplyMessageUnifiedUI?c.getReplyNodeRenderDimensions:c.prepareMediaNodeDimensionsFunction(this._messageProperties)),this._messageProperties.decodedNode.hasHtmlContent()&&(g.calcRenderDim=(e,t)=>e),g}getMessageActions(e){const t=this._defaultSupportsAddReactionsInActionMenu&&!this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText()&&!this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),s=!this._messageProperties.skypeMessage.isEmote(),i=this._messageProperties.decodedNode.hasOnlyQuotedContent(),o=this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText(),n=this._messageProperties.decodedNode.hasOnlyUnicodeEmoji(),r=this._defaultSupportsAddReactionInMessageView&&this._defaultSupportsShowingReactionsSummary&&!o&&!n,a=this._messageProperties.hasTranslation,l=this._messageProperties.decodedNode.hasHtmlContent(),d=!i&&s&&!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&(!l||this._messagingFeatures.enableQuotingHtmlMessages),c=super.getActionMenuCommands({supportsPostingReactions:t&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),supportsForward:this._supportsForward&&(!i||this._messagingFeatures.enableForwardingQuotes)&&(!l||this._messagingFeatures.enableForwardingHtmlMessages)&&s,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsEdit:this.supportsEdit(),supportsQuotes:d,supportsQuotesSelection:d&&!a,supportsSearchSelection:this.supportsSearchSelection(),copyCommand:this._defaultSupportsCopy?f.CommandTypes.Copy:void 0,supportsBookmarks:!0,supportsTranslation:this._messageProperties.hasTranslation&&v.default.isTablet(),supportsTranslateOne:!0,supportsWebSearchInMobile:this._messageProperties.enableConversationSearchInMobile&&!1,supportsImageCreation:this._messageProperties.isConversationAccepted&&!this._messageProperties.isReadOnly&&!this._messageProperties.isNewsBot&&!this._isBookmark});return e.actionMenuCommands=c.concat(e.actionMenuCommands),r&&(e.outerButtonCommands=this.getActionsForButtonsToBeRenderedInMessageView(!1,this._defaultSupportsAddReactionInMessageView,!0).concat(e.outerButtonCommands)),e}supportsSearchSelection(){return r.default.getS4LMessagingFeaturesNoSubscription().enableBingSearchMessages&&!this._messageProperties.decodedNode.hasOnlyEmoticonsOrWhitespaceText()&&!this._messageProperties.skypeMessage.isEmote()&&!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&(!this._messageProperties.decodedNode.hasHtmlContent()||this._messagingFeatures.enableQuotingHtmlMessages)}renderOnlyUrlPreview(){return this._renderOnlyUrlPreview}supportsEdit(){const e=this._messageProperties.decodedNode instanceof m.NgcUpgradeSystemMessageNode;return this._defaultSupportsEdit&&(!!this._messageProperties.postedByCurrentUser||!!this._messageProperties.isModerator)&&!this.renderedInStackGallery()&&!this.renderedInCompositeGallery()&&!e&&!this._messageProperties.isReadOnly&&!l.isS4BBridgeMri(this._messageProperties.skypeMessage.conversationId)}getUrlPreviewRenderInformation(e,t){if(o.isEmpty(this._urlPreviewData)||this._messageProperties.skypeMessage.isEmote())return[];const s=[],i=this._defaultSupportsPostingReactions&&this._renderOnlyUrlPreview,n=this._defaultSupportsShowingReactionsSummary&&this._renderOnlyUrlPreview,r=e.sendingStatus===S.MessageRenderSendingStatus.Sending;return o.each(this._urlPreviewData,(a=>{if(a&&a.isValid){const l={renderMessageBackground:!1,showMessageSender:e.showMessageSender&&this._renderOnlyUrlPreview,showMessageSenderIcon:e.showMessageSenderIcon&&this._renderOnlyUrlPreview,showMessageTimestamp:e.showMessageTimestamp&&this._renderOnlyUrlPreview,sendingStatus:!this._renderOnlyUrlPreview&&r?S.MessageRenderSendingStatus.None:e.sendingStatus,obfuscateUrlPreview:!this._messageProperties.postedByCurrentUser&&!this._messageProperties.isConversationAccepted,urlPreviewThumbnailRadiusStyle:this._messageProperties.postedByCurrentUser&&!this.renderedInStackGallery()?T.radius.currentUserUrlPreviewThumbnail:T.radius.otherUserUrlPreviewThumbnail,showOuterButtons:this._outerButtonsFit,skipAccessibilityLabelForMessageView:!0,accessibilityLabelType:u.MessageAccessibilityType.Url,showReactionsOnMessage:n,overlayReactionsOnMessage:n,availableSpace:this._messageProperties.containerMaxDimensions,calcRenderDim:c.getUrlPreviewNodeRenderDimensions},d=this._defaultSupportsCopy?f.CommandTypes.CopyLink:void 0,h=this.getActionMenuCommands({copyCommand:d,supportsBookmarks:this._defaultSupportsBookmark}),p=this._renderOnlyUrlPreview?this.getActionMenuCommands({supportsPostingReactions:i&&(this._messageProperties.screenReaderEnabled||!this._outerButtonsFit),supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,supportsRemove:this._defaultSupportsRemove,supportsEdit:this.supportsEdit(),supportsQuotes:!this.renderedInCompositeGallery()&&!this.renderedInStackGallery()&&!this._messageProperties.isReadOnly,copyCommand:d,supportsBookmarks:this._defaultSupportsBookmark}).concat(t.actionMenuCommands):h,m=o.truncate(a.url,{length:100,omission:g.getString("Global.TruncationText")}),_={outerButtonCommands:this._outerButtonsFit?this.getActionsForButtonsToBeRenderedInMessageView(this._supportsForward&&this._renderOnlyUrlPreview,this._defaultSupportsAddReactionInMessageView&&this._renderOnlyUrlPreview,!0).concat(t.outerButtonCommands):[],actionMenuCommands:p,actionMenuTitle:m},y={viewRenderOptions:Object.assign(Object.assign({},e),l),urlPreviewActions:_,urlPreviewData:a};s.push(y)}})),s}}t.TextMessageRenderingOptions=M,M.messageTypeGroup=a.MessageTypeGroups.Text;class b extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return Object.assign(Object.assign({},e),{renderMessageBackground:!1,messageContentCentered:!0,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1})}getMessageActions(e){}}t.SystemMessageRenderingOptions=b,b.messageTypeGroup=a.MessageTypeGroups.System;class I extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){const t=a.getSmsDeliveryReport(this._messageProperties.skypeMessage.properties);if(this._messageProperties.decodedNode.children.length>0){const s=!h.hasOnlyEmoticonsOrWhitespaceText(this._messageProperties.decodedNode.children[0]);return Object.assign(Object.assign({},e),{renderMessageBackground:s,smsDeliveryStatus:t})}return e}getMessageActions(e){const t=!this._messageProperties.isReadOnly&&!this.renderedInCompositeGallery()&&!this.renderedInStackGallery(),s=a.getSmsDeliveryReport(this._messageProperties.skypeMessage.properties),i=s&&!a.isSmsDeliveredSuccessfully(s),o=super.getActionMenuCommands({supportsForward:this._supportsForward,supportsSelectMessages:this._defaultSupportsSelectMultipleMessages,copyCommand:this._defaultSupportsCopy?f.CommandTypes.Copy:void 0,supportsQuotes:t,supportsQuotesSelection:t,supportsRemove:i,supportsBookmarks:this._defaultSupportsBookmark});return e.actionMenuCommands=o.concat(e.actionMenuCommands),e}}t.SMSMessageRenderingOptions=I,I.messageTypeGroup=a.MessageTypeGroups.SMS;class w extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return Object.assign(Object.assign({},e),{renderMessageBackground:!1,messageContentCentered:!0,showReactionsOnMessage:!1,showMessageSender:!1,showMessageSenderIcon:!1,showMessageTimestamp:!1,messageContentExpandedToAvailableArea:!0,includeAccessibilityPropertiesOnMessageHeader:!1,skipAccessibilityLabelForMessageView:!1})}getMessageActions(e){const t=super.getActionMenuCommands({supportsForward:!1,supportsSelectMessages:!1,copyCommand:void 0,supportsQuotes:!1,supportsQuotesSelection:!1,supportsRemove:!1,supportsBookmarks:!1});return e.actionMenuCommands=t.concat(e.actionMenuCommands),e}}t.CallerIDRenderingOptions=w,w.messageTypeGroup=a.MessageTypeGroups.CallerID;class P extends M{getMessageSpecificViewRenderingOptions(e){return Object.assign(Object.assign({},e),{renderMessageBackground:!0})}getMessageActions(e){return{actionMenuCommands:[f.CommandTypes.ShowReported],outerButtonCommands:[]}}}class k extends d.DefaultMessageRenderingOptions{getMessageSpecificViewRenderingOptions(e){return e}getMessageActions(e){return e}}t.EngagementMessageRenderingOptions=k,k.messageTypeGroup=a.MessageTypeGroups.Engagement},681679:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isUserInputEmptyOrHasWhitespaceOnly=function(e){return e.every((e=>e instanceof i.UnhandledEntity&&!e.text().trim()))};const i=s(197582).__importStar(s(626065))},751930:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybeAddMyBotToRecents=function(e,t){if(!t)return;const s=(0,l.getMyBotId)(),i=(0,c.default)().getConversation(s);(function(e,t,s){const i=r.default.isContact(e),o=d.default.isMriBlocked(e),n=!!(null==s?void 0:s.isDeleted()),a=!t.some((t=>t.id===e)),l=null==s?void 0:s.isArchived();if((0===t.length||a)&&i&&!o&&!n&&!l)return!0;return!1})(s,e,i)&&(i?e.push(i):e.push(a.SkypeConversationLocal.newFakeEmptyConversation(s,void 0)),o.Instrumentation.log(n.LogTraceArea.ConversationsListItem,"[ConversationsListHelper] [_maybeAddMyBotToRecents] adding my bot conversation to recents list"))};const i=s(197582),o=s(82485),n=s(815146),r=i.__importDefault(s(555436)),a=s(160560),l=s(44717),d=i.__importDefault(s(97572)),c=i.__importDefault(s(615364))},861216:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppActivity=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importDefault(s(659938)),a=s(434343),l=i.__importDefault(s(652032)),d=s(822701),c=i.__importDefault(s(139221));class u{constructor(e){this._maxValues=e,this._history=[]}getHistory(){return this._history}setHistory(e){this._history=o.takeRight(e,this._maxValues)}addActivity(e,t=Date.now()){this._history.push({timestamp:t,activity:e}),this.setHistory(this._history)}getDuration(e,t,s,i){let n=0,r=0;return s<=e?0:(o.each(this._history,(a=>{if(!n&&a.timestamp<s&&o.includes(t,a.activity))n=a.timestamp;else if(n&&o.includes(i,a.activity)){if(a.timestamp>=e){const t=a.timestamp<=s?a.timestamp:s;r+=e>n?t-e:t-n}n=0}})),n&&n<s&&(r+=s-(e>n?e:n)),r)}hasActivity(e,t,s){return o.some(this._history,(i=>i.timestamp>=e&&i.timestamp<=t&&o.includes(s,i.activity)))}}var h;!function(e){e[e.Start=1]="Start",e[e.Exit=2]="Exit",e[e.Foreground=3]="Foreground",e[e.Background=4]="Background"}(h||(t.AppActivity=h={}));t.default=new class{constructor(){this._history=new u(10)}init(e,t,s,i){const o=l.default.getDataExclusive(a.InternalKeys.AppActivity);this._history.setHistory(o?o.slice():[]),this._postingTrigger=d.PostingTrigger.None,e.subscribe((()=>{this._appStateSub||this._subscribeAppState()})),t.subscribe((()=>{const e=i();e&&!this._appStateSub?this._subscribeAppState():!e&&this._appStateSub&&(this._appStateSub.unsubscribe(),this._appStateSub=void 0,this._history.setHistory([]),this._lastActivity=void 0)})),s.subscribe((()=>{this._postingTrigger=d.PostingTrigger.None}))}getBackgroundTime(e,t=Date.now()){return this._history.getDuration(e,[h.Background],t,[h.Foreground,h.Exit])}hasAppStart(e,t=Date.now()){const s=c.default.getAppInitTime();return s>=e&&s<=t}getPostingTrigger(){return this._postingTrigger}setPostingTrigger(e){this._postingTrigger=e}test_setData(e){this._history.setHistory(e)}_subscribeAppState(){this._addActivity(this._fromActivationState(n.App.getActivationState())),this._appStateSub=r.default.subscribeForChanges("AppActivityHistoryService",(e=>{this._addActivity(this._fromActivationState(e)),e===n.Types.AppActivationState.Active&&(this._postingTrigger=d.PostingTrigger.None)}))}_fromActivationState(e){return e===n.Types.AppActivationState.Background?h.Background:h.Foreground}_addActivity(e){e!==this._lastActivity&&(this._lastActivity=e,this._history.addActivity(e),l.default.putData(a.InternalKeys.AppActivity,this._history.getHistory()))}}},805121:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importStar(s(516778)),a=i.__importStar(s(397691)),l=s(823684),d=i.__importDefault(s(791384)),c=i.__importDefault(s(150343)),u=i.__importDefault(s(601976)),h=i.__importStar(s(85385)),p=i.__importStar(s(704704)),g=i.__importDefault(s(503411)),m=i.__importStar(s(446574)),S=s(815146),_=i.__importDefault(s(404547)),f=i.__importDefault(s(304623)),y=i.__importDefault(s(306200)),v=i.__importDefault(s(615364));t.default=new class{constructor(){m.RegisterStartupable(this,"ArchiveConversationService",[f.default,u.default,v.default,y.default])}startup(){return Promise.resolve()}_setConversationArchived(e,t){if(e.isOneOnOne()&&c.default.getS4LMessagingFeatures().enableGroupedConversations&&!e.isMyBotThread()){const s=n.map(y.default.getAllSiblingConversations(e.id),(e=>_.default.setConversationArchived(e.id,t)));return a.all(s).then(n.noop)}return _.default.setConversationArchived(e.id,t)}_announceForAccessibility(e,t){if(d.default.shouldAnnounceForAccessibility()){const s=u.default.getDisplayName(e)||"",i=p.getString("AccessibilityLabel.ConversationHiddenAnnouncement",{conversationName:s}),o=p.getString("AccessibilityLabel.ConversationUnhiddenAnnouncement",{conversationName:s}),n=t?i:o;r.Accessibility.announceForAccessibility(n)}}_showUndoArchiveToast(e,t){const s={duration:5e3,textMessage:p.getString("HideConversation.ToastMessage"),actionLabel:p.getString("HideConversation.ToastUndoLabel"),key:"undo_archive_conversation",onPress:this.unarchiveConversation.bind(this,e,S.UnarchiveConversationOrigin.UndoPill),rootViewId:t};g.default.scheduleMessage(s)}_trackConversationArchived(e,t){h.track(new l.ConversationArchived(e.id,t,e.isOneOnOne()))}_trackConversationUnarchived(e,t){h.track(new l.ConversationUnarchived(e.id,t,e.isOneOnOne()))}archiveConversation(e,t,s){h.log(S.LogTraceArea.ArchiveConversation,"Attempting to archive "+o.pii.Mri(e)+" origin: "+S.ArchiveConversationOrigin[t]);const i=(0,v.default)().getConversation(e);i&&this._setConversationArchived(i,!0).then((()=>{this._announceForAccessibility(e,!0),this._showUndoArchiveToast(e,s),this._trackConversationArchived(i,t)}))}unarchiveConversation(e,t){h.log(S.LogTraceArea.ArchiveConversation,"Attempting to unarchive "+o.pii.Mri(e)+" origin: "+S.UnarchiveConversationOrigin[t]);const s=(0,v.default)().getConversation(e);s&&this._setConversationArchived(s,!1).then((()=>{this._announceForAccessibility(e,!1),this._trackConversationUnarchived(s,t)}))}}},433035:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BING_CATEGORY_NAME=t.subscriberType=void 0;const i=s(197582),o=s(662783),n=i.__importStar(s(496486)),r=i.__importStar(s(397691)),a=s(398861),l=i.__importDefault(s(150343)),d=i.__importDefault(s(327130)),c=i.__importDefault(s(532803)),u=i.__importDefault(s(369347)),h=s(873324),p=i.__importStar(s(766698)),g=s(815146),m=i.__importDefault(s(532016)),S=i.__importStar(s(47013)),_=i.__importStar(s(85385)),f=i.__importStar(s(704704)),y=i.__importDefault(s(363091)),v=i.__importDefault(s(163374)),C=i.__importStar(s(446574)),T=i.__importDefault(s(655192)),M=i.__importDefault(s(601274));t.subscriberType="bingBackgroundEffects_downloader",t.BING_CATEGORY_NAME="bing";class b{constructor(){this._queue={},this._allItems={},this._items=[],this._imageInfos={},this._itemsRemoved=[],this._apiCallErrorCount=0,this._maybeDownloadItem=e=>{if(!v.default.isNetworkConnected())return;const s=t.BING_CATEGORY_NAME,i=this._getFileName(e),o=this._getImageUrl(e),r=n.filter(this._items,(e=>e.originalUrl===o));if(n.isEmpty(r)){const t=d.default.getPredefinedImagesTempFolderPath(i);if(!t)return;const n={fileUri:t};S.fileExists(n).then((n=>{if(n){const n=m.default.getBackgroundEffectPrefix(t);m.default.addFileInformationForTracking(n,t,i,{originalUrl:o,category:s,order:parseInt(e.isoDate,10),isoDate:e.isoDate})}else this._queueItem(e)}))}},this._queueItem=e=>{const s=this._getFileName(e),i=this._getImageUrl(e),o=c.default.startTransfer({subscriberType:t.subscriberType,context:void 0,action:"GET",downloadToPublicFolder:!0,downloadToUri:!0,url:i,filename:d.default.getPredefinedImagesTempFolderPath(s)});this._queue[o]=Object.assign({},e)},this._bingHost=l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host,this._httpClient=new o.GenericRestClient(this._bingHost),C.RegisterStartupable(this,"BingBackgroundEffectsProviderService",[c.default,m.default,v.default])}refreshInitiatedEvent(){return this._refreshInitiatedEvent||(this._refreshInitiatedEvent=new a.SubscribableEvent),this._refreshInitiatedEvent}startup(){return l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.enableImageDownload&&this._isBackgroundReplacementCapable()?(this._connectivityStoreSubscription=v.default.subscribe((()=>{v.default.isNetworkingAvailable()&&this._refresh()})),c.default.subscribe(t.subscriberType,((e,s,i,o)=>{if(this._isBackgroundReplacementCapable()&&this._queue[e]){const s=this._queue[e],n=t.BING_CATEGORY_NAME,r=this._getFileName(s),a=this._getImageUrl(s);if(i&&o.body){const{uri:e}=o.body,t=m.default.getBackgroundEffectPrefix(e);if(this._allItems[t])return;m.default.addFileInformationForTracking(t,e,r,{originalUrl:a,category:n,order:parseInt(s.isoDate,10),isoDate:s.isoDate}),_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [startup] download success for Bing background effect filename: ${r}, url: ${a}, date: ${s.isoDate}`)}i||_.error(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [startup]  download failed for background effect filename: ${r}, url: ${a}, date: ${s.isoDate}`)}})),this._fileTrackerSubscription=m.default.subscribe((()=>{_.log(g.LogTraceArea.Calling,"[BingBackgroundEffectsProviderService] [startup] FileTrackerStore callback"),this._getBingBackgroundEffects(),this._changeActiveBackgroundIfNeeeded(),this._startupDone||(this._refresh(),this._startupDone=!0)})),f.localeChangedEvent.subscribe((()=>{this._refresh()})),r.Resolved()):r.Resolved()}test_reset(){this._connectivityStoreSubscription&&(v.default.unsubscribe(this._connectivityStoreSubscription),this._connectivityStoreSubscription=void 0),this._fileTrackerSubscription&&(m.default.unsubscribe(this._fileTrackerSubscription),this._fileTrackerSubscription=void 0),this._rescheduleTimer&&(M.default.clearTimeout(this._rescheduleTimer),this._rescheduleTimer=void 0),this._itemsRemoved=[],this._imageInfos={},this._apiCallErrorCount=0}_refresh(){this._apiCallErrorCount=0,this._getPicturesFromBing()}_getBingBackgroundEffects(){this._allItems=m.default.getAllBackgroundEffectsFiles(),this._items=n.filter(this._allItems,(e=>e.category===t.BING_CATEGORY_NAME)),_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_getBingBackgroundEffects] Available ${this._items.length} Bing images`)}_getFileName(e){let t=e.caption.replace(/[^a-zA-Z ]/g,"");return t&&""!==t||(t=e.isoDate),`Bing - ${t}.jpg`}_getImageUrl(e){return this._bingHost+e.imageUrls.landscape.highDef}static _getMarket(){var e;let t=f.getLocale();if(f.isEnglishLanguage()){const s=f.getLanguageFromLocale(),i=null===(e=l.default.getHeaders().CountryCode)||void 0===e?void 0:e.toLowerCase();if(!i)return;t=`${s}-${i}`}return t}_getPicturesFromBing(){this._rescheduleTimer&&M.default.clearTimeout(this._rescheduleTimer);if(!v.default.isNetworkConnected())return;const e=b._getMarket();if(!e)return void _.warn(g.LogTraceArea.Calling,"[BingBackgroundEffectsProviderService] [_getPicturesFromBing] market is undefined, ignoring the request to fetch background");const t=l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,s=t.path.replace("[LOCALE]",e);this._httpClient.performApiGet(s).then((s=>{if(!s||!s.statusCode||200!==s.statusCode){const t=T.default.errorAsString(s);return void this._handleApiDownloadError(t,(null==s?void 0:s.statusCode)||0,0,e)}let i;_.track(new h.BingBackgroundsDownloadApiEvent(e,this._apiCallErrorCount,s.statusCode,s.data.images.length,void 0)),this._apiCallErrorCount=0;let o=[];if(s.data.images.length>0){let e=0;if(l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.pickImageBasedOnUserIdHash){const t=y.default.getSkypeId(),i=p.hashCode(t);e=Math.abs(i)%s.data.images.length}i=s.data.images[e]}if(this._resetImages(),i){this._addImage(i,e),_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_getPicturesFromBing] Will download image. IsoDate: ${i.isoDate}, Caption: ${i.caption}, Market: ${e}`);const t=this._getImageUrl(i);o=[...n.filter(this._items,(e=>e.originalUrl===t)),...o]}const r=n.differenceWith(this._items,o,n.isEqual);_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_getPicturesFromBing] Will remove ${r.length} images. (${r.map((e=>e.isoDate)).join(", ")})`);for(const e of r)_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_getPicturesFromBing] Removing image. IsoDate: ${e.isoDate}, Path: ${e.localFileName}`),this._itemsRemoved.push(e.id),m.default.removeTrackedFile(m.default.getBackgroundEffectPrefix(e.localUri),!0);i&&this._maybeDownloadItem(i),this.refreshInitiatedEvent().fire(n.values(this._imageInfos),o,r),this._rescheduleTimer=M.default.setTimeout((()=>{this._getPicturesFromBing()}),t.syncIntervalMs)})).catch((t=>{const s=T.default.errorAsString(t);this._handleApiDownloadError(s,void 0,void 0,e)}))}_handleApiDownloadError(e,t,s,i){this._apiCallErrorCount+=1;const o=this._apiCallErrorCount*this._apiCallErrorCount*1e3;_.error(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_handleApiDownloadError] bing images query failed. Error count: ${this._apiCallErrorCount}. Error: ${e}`);const n=l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;this._apiCallErrorCount<n.maxImageDownloadRetries?this._rescheduleTimer=M.default.setTimeout((()=>{this._getPicturesFromBing()}),o):_.track(new h.BingBackgroundsDownloadApiEvent(i,this._apiCallErrorCount,t,s,e))}_changeActiveBackgroundIfNeeeded(){if(0===this._items.length)return;const e=u.default.DeviceStore.getBackgroundEffectType(),t=this._itemRemoved(e);_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_changeActiveBackgroundIfNeeeded] current background: ${e}, itemRemoved: ${t}`),e&&t&&this._setNewBackgroundEffect()}_setNewBackgroundEffect(){const e=this.getNextIsoDate();if(_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_setNewBackgroundEffect] next isoDate: ${e}`),e){const t=this.getImageIdFromIsoDate(e);t&&(_.log(g.LogTraceArea.Calling,`[BingBackgroundEffectsProviderService] [_setNewBackgroundEffect] setting new bg effect: ${t}`),u.default.DeviceStore.setBackgroundEffectType(t))}else _.log(g.LogTraceArea.Calling,"[BingBackgroundEffectsProviderService] [_setNewBackgroundEffect] setting bg effect Blur"),u.default.DeviceStore.setBackgroundEffectType(g.BackgroundEffect.Blur)}getNextIsoDate(e){const t=n.sortBy(n.keys(this._imageInfos),(e=>e));if(e){const s=n.indexOf(t,e);let i=s;return i=s+1===t.length?0:s+1,n.nth(t,i)}return n.last(t)}getPreviousIsoDate(e){const t=n.sortBy(n.keys(this._imageInfos),(e=>e));if(e){const s=n.indexOf(t,e);let i=s;return i=0===s?t.length-1:s-1,n.nth(t,i)}return n.first(t)}_isBackgroundReplacementCapable(){return l.default.getS4LCMCFeaturesNoSubscription().enableBackgroundReplacement}_getImageMetadataFromId(e){if(!e)return;const t=n.filter(this._items,(t=>t.id===e))[0];return(null==t?void 0:t.originalUrl)?t:void 0}_itemRemoved(e){return!!n.includes(this._itemsRemoved,e)}getImageIsoDateFromId(e){const t=this._getImageMetadataFromId(e);if(t)return t.isoDate}getImageIdFromIsoDate(e){const t=n.filter(this._items,(t=>t.isoDate===e))[0];if(t)return t.id}_resetImages(){this._imageInfos={},this._itemsRemoved=[]}_addImage(e,t){const s=e;s.market=t,this._imageInfos[e.isoDate]=s}getImageFromId(e){const t=this.getImageIsoDateFromId(e);if(t)return this._imageInfos[t]}getBingBackgroundImageInfoFromId(e,t,s){const i=this.getImageFromId(e);if(i)return{callId:t,userId:s,caption:i.caption,copyright:i.copyright,isoDate:i.isoDate,market:i.market,link:i.clickUrl}}}t.default=new b},151522:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(815063),n=s(496486),r=i.__importDefault(s(150343)),a=s(44717),l=s(446802),d=i.__importStar(s(704704)),c=s(536748),u=i.__importDefault(s(341994)),h=i.__importDefault(s(363091)),p=s(641400);class g extends l.HintsProvider{constructor(){super(...arguments),this._timeBeforeShowHintAgain=r.default.getS4LMessagingFeatures().bingSearchMessageHint.timeToShowHintInMs}getHint(){if(!o.BrowserEnvironment.isMobile())return u.default.getMessageHintsUserData(c.MessageHintsTypes.HighlightToBingSearch)}getMessageToShowHint(e,t){const s=Date.now(),i=this._getMessageToShowHint(e);if(!(i&&(null==t?void 0:t.hintLastShownTime)&&s-t.hintLastShownTime<this._timeBeforeShowHintAgain))return i||void 0}_getMessageToShowHint(e){const t=e.getItemList().filter((e=>e instanceof c.MessageViewItemInfo&&!h.default.isMyMri(e.skypeMessage.creator)&&("Text"===e.skypeMessage.messagetype||"RichText"===e.skypeMessage.messagetype)&&!(0,a.isBotChat)(e.skypeMessage.conversationId)));return(0,n.last)(t)}updateHint(e,t,s){const i=r.default.getS4LMessagingFeatures().bingSearchMessageHint.maxShownTimes,o=c.MessageHintsTypes.HighlightToBingSearch,n=this._updateHintDataForMessage(e,null==s?void 0:s.skypeMessage.cuid,t,i);return u.default.setMessagesHintData(o,n),n}_updateHintDataForMessage(e,t,s,i){if(s.wasFeatureUsedByUser)return s;const o=Date.now(),n=Object.assign({},s);if(n.hintWasShownTimes>=i)return n.wasFeatureUsedByUser=!0,n;return(!n.hintLastShownTime||o-n.hintLastShownTime>this._timeBeforeShowHintAgain)&&(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o,n.hintWasShownTimes++),n}getMessageHintDataToDisplay(){return{icon:p.SkypeIcon.Highlight,hintMessage:d.getString("MessageStream.HighlightAndRightClick")}}}t.default=new g},93457:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(150343)),a=i.__importDefault(s(304623)),l=i.__importStar(s(172134)),d=i.__importStar(s(971988)),c=i.__importDefault(s(556587)),u=s(44717),h=i.__importDefault(s(615364)),p=i.__importStar(s(459287)),g=i.__importDefault(s(601976)),m=s(815146),S=i.__importStar(s(85385)),_=i.__importDefault(s(363091)),f=i.__importDefault(s(863132)),y=i.__importStar(s(437782)),v=i.__importStar(s(446574)),C=i.__importDefault(s(685734)),T=i.__importDefault(s(760989)),M=s(123117);t.default=new class{constructor(){this._appConfigChanged=()=>{this._messagesProcessedToken?(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0):(this._messagesProcessedToken=a.default.messagesProcessed.subscribe(this._chatServiceDataServiceMessagesProcessed),c.default.prioritizeConversation(u.BookmarksThreadId,!0,!1))},this._chatServiceDataServiceMessagesProcessed=e=>n.all(o.map(o.filter(e,(e=>e.isBookmark()||e.isBookmarkSourceDeletedMessageForCurrentUser())),(e=>e.isBookmark()?this._processBookmarkMsgUpdate(e):e.isBookmarkSourceDeletedMessageForCurrentUser()?this._processBookmarkSourceMsgDeletion(e):void 0))),v.RegisterStartupable(this,"BookmarksService",[a.default,h.default,g.default,C.default])}startup(){return r.default.subscribe(this._appConfigChanged),this._appConfigChanged(),n.Resolved()}bookmarkMessage(e,t){const s=e.getLatestServerMessage();if(!s)return S.error(m.LogTraceArea.Bookmarks,"Cannot bookmark message without having server message"),n.Resolved();const i={};t&&(i[d.MessageProperties.AlbumId]=t);const r=o.cloneDeep(s),a=T.default.newClientMessageId();return l.markMessageBookmarked(e,{cuid:a}).then((()=>{S.log(m.LogTraceArea.Bookmarks,"Bookmarking new message."),this._traceBookmarkSourceMessage(e);const s={bookmarkSourceClientMessageId:e.cuid,bookmarkSourceServerMessageId:e.getLatestServerMessageId(),bookmarkSourceComposeTime:e.createdTime,bookmarkSourceConversationId:e.conversationId,bookmarkSourceCreatorId:e.creator},o=(0,h.default)().getConversation(e.conversationId);if(o&&(o.isThread()||_.default.isMyMri(e.creator))&&(s.bookmarkSourceConversationName=g.default.getDisplayName(C.default.getConversationOwner(e.conversationId))),o&&o.isV2OneToOneThread()){const e=o.getOtherPartyMriForOneToOneThread();s.bookmarkCounterPartyMri=e}let n;i[d.MessageProperties.Starred]=JSON.stringify(s),n=t&&e.isAlbum()?p.createMediaAlbumMessage(u.BookmarksThreadId,m.PostSource.Bookmarks,t,i,a):p.createMessageFromServerMessage(u.BookmarksThreadId,m.PostSource.Bookmarks,r,i,a),f.default.postMessage(n)}))}deleteBookmark(e){let t,s;return n.Resolved().then((()=>{if(e.isBookmark()){const i=d.getBookmarkMetadata(e.properties);if(t=e.getOriginalServerId(),i){const{bookmarkSourceConversationId:e,bookmarkSourceClientMessageId:t}=i;return n.fromThenable(M.MessagesRepository.getMessageByCuid(e,t)).then((e=>{s=e}))}}else{s=e;const i=e.getBookmarkSourceMetadataForCurrentUser();if(!i)return;i.cuid&&i.id&&(t=i.id)}})).then((()=>n.all([l.deleteBookmark(t),l.deleteBookmarkSource(s)])))}_processBookmarkMsgUpdate(e){const t=d.getBookmarkMetadata(e.properties);if(this._traceBookmarkMessage(e,t),!t)return n.Resolved();const s=t.bookmarkSourceClientMessageId,i=t.bookmarkSourceConversationId;if(!s||!i)return n.Resolved();const o=e.getLatestServerMessageId();return o?n.fromThenable(M.MessagesRepository.getMessageByCuid(i,s)).then((e=>{if(!e)return;const t=e.getBookmarkSourceMetadataForCurrentUser();return t&&t&&!t.id?l.markMessageBookmarked(e,{id:o}):void 0})):n.Resolved()}_processBookmarkSourceMsgDeletion(e){const t=e.getBookmarkSourceMetadataForCurrentUserFromPreviousMessage();return this._traceBookmarkSourceMessage(e),t&&t.id?(S.log(m.LogTraceArea.Bookmarks,"Bookmark source deleted, deleting bookmark."),l.deleteBookmark(t.id)):(S.log(m.LogTraceArea.Bookmarks,"Bookmark source message metadata not found for current user"),n.Resolved())}_traceBookmarkSourceMessage(e){S.log(m.LogTraceArea.Bookmarks,`BookmarkSourceMessage(cuid:${e.cuid} id:${e.getLatestServerMessageId()})`)}_traceBookmarkMessage(e,t){S.log(m.LogTraceArea.Bookmarks,`BookmarkMessage(cuid:${e.cuid} id:${e.getLatestServerMessageId()} sourceConversationId:${y.mriOrId(null==t?void 0:t.bookmarkSourceConversationId)}, sourceMessageCreatorId:${y.mriOrId(null==t?void 0:t.bookmarkSourceCreatorId)})`)}test_reset(){this._messagesProcessedToken=void 0}}},618629:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeToMessageComposerFocusRequest=t.subscribeToContentSetEvent=t.triggerContentSetEvent=void 0,t.requestMessageComposerFocus=function(){r.log(n.LogTraceArea.MessageComposer,"ComposerSubscribableEvents.requestMessageComposerFocus"),l.fire()};const i=s(197582),o=i.__importDefault(s(974634)),n=s(167606),r=i.__importStar(s(85385)),a=new o.default,l=new o.default;t.triggerContentSetEvent=(e,t=!1)=>{r.log(n.LogTraceArea.MessageComposer,"ComposerSubscribableEvents.triggerContentSetEvent"),a.fire(e,t)};t.subscribeToContentSetEvent=e=>a.subscribe(e);t.subscribeToMessageComposerFocusRequest=e=>l.subscribe(e)},96309:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(974634)),n=i.__importStar(s(44717));t.default=new class{constructor(){this._consumptionHorizons={},this._markConversationUnreadCallbacks={},this.markConversationUnreadCallback=(e,t)=>(this._markConversationUnreadCallbacks[e]=new o.default,this._markConversationUnreadCallbacks[e].subscribe(t)),this.onMarkConversationUnread=e=>{const t=this._markConversationUnreadCallbacks[e];t&&t.fire()}}setPreviousConsumptionHorizon(e,t){this._consumptionHorizons[e]=t}getPreviousConsumptionHorizon(e){if(this._consumptionHorizons[e])return n.updateConsumptionHorizonWithCurrentClientTime(this._consumptionHorizons[e])}}},583127:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(496486),n=s(446802),r=i.__importStar(s(704704)),a=s(536748),l=i.__importDefault(s(341994)),d=i.__importDefault(s(150343)),c=i.__importDefault(s(363091));class u extends n.HintsProvider{constructor(){super(...arguments),this._timeBeforeShowHintAgain=d.default.getS4LMessagingFeatures().contextMenuMessageHint.timeToShowHintInMs}getHint(){}getMessageToShowHint(e,t){const s=Date.now(),i=this._getMessageToShowHint(e);if(!(i&&(null==t?void 0:t.hintLastShownTime)&&s-t.hintLastShownTime<this._timeBeforeShowHintAgain))return i||void 0}_getMessageToShowHint(e){const t=e.getItemList().filter((e=>e instanceof a.MessageViewItemInfo&&!c.default.isMyMri(e.skypeMessage.creator)&&"Event/Call"!==e.skypeMessage.messagetype));return(0,o.last)(t)}updateHint(e,t,s){const i=d.default.getS4LMessagingFeatures().contextMenuMessageHint.maxShownTimes,o=this._updateHintDataForMessage(e,null==s?void 0:s.skypeMessage.cuid,t,i);return t.hintMessageId!==o.hintMessageId&&l.default.setMessagesHintData(a.MessageHintsTypes.ContextMenuHint,o),o}_updateHintDataForMessage(e,t,s,i){if(s.wasFeatureUsedByUser)return s;const o=Date.now(),n=Object.assign({},s);void 0!==n.hintMessageId&&void 0!==n.hintConversationId||(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o);const r=o-(void 0!==n.hintLastShownTime?n.hintLastShownTime:o)>864e5;return n.hintWasShownTimes>=i?(n.wasFeatureUsedByUser=!0,n):(r&&(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o,n.hintWasShownTimes++),n)}getMessageHintDataToDisplay(){return{icon:"laugh",hintMessage:r.getString("MessageStream.MessageLongPressHint")}}}t.default=new u},419779:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationLoadingPerfRecordStore=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=i.__importStar(s(85385)),a=s(306194),l=s(938827),d=s(815146);class c{constructor(){this._perfRecords={}}notifyConversationLoadingStarted(e,t,s){n.default.getS4LMessagingFeaturesNoSubscription().enableConversationLoadingSpinnerTracking&&(this._perfRecords[e]={loadingStartTime:Date.now(),isUsingStackNavigation:t,confirmedGoodConnection:s,interrupted:!1})}notifyConversationLoadedAndSpinnerDismissed(e){const t=this._perfRecords[e];t&&(t.loadingFinishTime=Date.now(),this._finalize(t,e))}notifyConversationLoadingInterrupted(e){if(e){const t=this._perfRecords[e];t&&(t.interrupted=!0,t.loadingFinishTime=Date.now(),this._finalize(t,e))}}_finalize(e,t){const s=e.loadingStartTime,i=e.loadingFinishTime;if(i){const t=i-s,o=t/l.SECOND;t>n.default.getS4LMessagingFeaturesNoSubscription().conversationLoadingThresholdInMS&&r.track(new a.ConversationLoadingPerf(i-s,e.isUsingStackNavigation,e.confirmedGoodConnection,e.interrupted)),o>10?r.log(d.LogTraceArea.MessageStream,"Conversation navigation spinner took extremely long: "+o+"s"):o>5&&r.log(d.LogTraceArea.MessageStream,"Conversation navigation spinner took too long: "+o+"s")}delete this._perfRecords[t],this._cleanupStaleRecords()}_cleanupStaleRecords(){const e=Date.now();this._perfRecords=o.omitBy(this._perfRecords,(t=>t.loadingStartTime+6e4<e))}}t.ConversationLoadingPerfRecordStore=c,t.default=new c},557997:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConversations=function(...e){const{recentsSortedBy:t=a.RecentsSortBy.Time}=r.default.getUserPreferencesLocalNoSubscription();return e.reduce(((e,t)=>e.concat(t)),[]).sort(((e,s)=>c(e,t)-c(s,t)))};const i=s(197582),o=i.__importDefault(s(615364)),n=s(803193),r=i.__importDefault(s(201721)),a=s(773151),l=s(318315),d=s(370073);function c(e,t){let s=(0,o.default)().recentConversationsSortRank(e);if((0,n.isFakeContentChannelConversation)(e)&&t===a.RecentsSortBy.Unread){const t=(0,n.stripFakeContentChannelConversationPrefix)(e.id),{unreadCount:i}=(0,l.getContentChannelsStore)().getChannelWithFetch(t)||{};return i&&(s-=d.MagicUnreadPinnedNumber),s}return s}},257603:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getConversationsListStore=function(){o||(o=new i.ConversationsListWithFiltersStore);return o},t.destroyConversationsListStore=function(){o=void 0};const i=s(241876);let o},764318:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(288354),n=i.__importDefault(s(487110)),r=i.__importDefault(s(151938)),a=i.__importStar(s(595392)),l=s(815146),d=i.__importStar(s(85385)),c=i.__importStar(s(437782)),u=i.__importStar(s(446574));t.default=new class{constructor(){this._failedTransfers={},u.RegisterStartupable(this,"DownloadTelemetryService",[r.default])}startup(){return r.default.transferFinished.subscribe(((e,t,s,i,o)=>{const r=this._getTransferId(e,t),u=this._getErrorMetadata(t,i,o);if(n.default.isTransferPermanentFailure(s.transfer)){d.warn(l.LogTraceArea.DownloadService,"Permanent failure: "+e.id+", source: "+l.DownloadTransferSource[t]+", status code: "+i.statusCode+", metadata: "+c.dev_unknownOmit(JSON.stringify(u)));const o=new a.PermanentDownloadFailure(t,e.startTime,s.transfer.finishedAttemptsSoFarCount,i.statusCode,i.statusText,u);d.track(o)}else if(s.transfer.success){if(this._failedTransfers[r]){const o=new a.DownloadRecovered(t,e.startTime,s.transfer.finishedAttemptsSoFarCount,i.statusCode,i.statusText,u);d.track(o),delete this._failedTransfers[r]}}else this._failedTransfers[r]={transferInfo:s,response:i}})),Promise.resolve()}_getErrorMetadata(e,t,s){switch(e){case l.DownloadTransferSource.AmsDownload:case l.DownloadTransferSource.AMSGetStatus:const e=o.ASMClient.getTracingHeaders(s);return{requestId:e.requestId,correlationId:e.correlationId,transactionId:e.transactionId};default:return}}_getTransferId(e,t){return e.id+"_"+l.DownloadTransferSource[t]}}},835095:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(848523),n=s(123117),r=i.__importDefault(s(150343));t.default=new class{storeSavedMessage(e,t){const s=(0,o.convertSavedMessageInputToDbSkypeDraftsInput)(e,t);return n.DraftsRepository.putDraftMessage(s)}deleteSavedMessage(e){return n.DraftsRepository.deleteDraftMessage(e)}loadSavedMessageInputs(){const{enableHtmlComposer:e,enableHtmlAndroidComposer:t}=r.default.getS4LMessagingFeatures();return n.DraftsRepository.getAllDraftMessages().then((s=>s.map((s=>(0,o.convertDbSkypeDraftsInputToSavedMessageInput)(s,e||t)))))}}},727433:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_E2eeCipherService=void 0;const i=s(197582),o=s(358072),n=i.__importStar(s(496486)),r=i.__importStar(s(760249)),a=i.__importStar(s(775463)),l=i.__importStar(s(397691)),d=i.__importStar(s(766698)),c=s(748622),u=i.__importDefault(s(379878)),h=i.__importStar(s(841460)),p=i.__importDefault(s(36615)),g=i.__importDefault(s(363091)),m=i.__importStar(s(446574)),S=i.__importDefault(s(655192)),_=a.subtle,f="aes-cbc",y=32,v=32;class C{constructor(){m.RegisterStartupable(this,"E2eeCipherService",[u.default,p.default])}startup(){return this._storage=c.E2eeSessionStorage.getStorage(g.default.getSkypeId()),o.SignalProtocolLib.initialize(r),Promise.resolve()}encryptMessageForConv(e,t){const s=e.getEncryptionHandshake();if(!s)return l.Rejected("No secure handshake in conversation");const i=u.default.getBuddyAddress(s);if(i.mri&&i.devId){const e=a.getRandomValues(new Array(16)),s=a.getRandomValues(new Array(y)),o=a.getRandomValues(new Array(v));return this._encryptWithAes(t,s,e).then((t=>this._signWithHMAC(new Uint8Array(o).buffer,new Uint8Array(e).buffer,t).then((n=>this._computeDigest(new Uint8Array(e).buffer,t,n).then((r=>{const a=d.mergeArrays([new Uint8Array(s).buffer,new Uint8Array(o).buffer,r,new Uint8Array(e).buffer,n]);return this._encryptBufferWithSignal(i,a.buffer).then((e=>{const s={[i.devId]:e};return{ciphertext:d.Uint8ArrayToBase64String(new Uint8Array(t)),keys:s}}))}))))))}return l.Rejected("Missing receiver information in handshake")}decryptMessageForConv(e,t,s){const i=e.getEncryptionHandshake();if(!i)return l.Rejected("No secure handshake in conversation");const o=u.default.getBuddyAddress(i),n=u.default.getDeviceId();if(o.mri&&o.devId){if(!(n in s))return l.Rejected("Missing message key");const e=s[n];return this._decryptBufferWithSignal(o,e).then((e=>{const s=new Uint8Array(e);if(144!==s.length)return l.Rejected("Unsupported message key length");const[i,o,n,r,a]=this._splitKeyMaterial(s),c=d.base64StringToUint8Array(t);return this._computeDigest(r,c.buffer,a).then((e=>this._compareArrays(e,n)?this._signWithHMAC(o,r,c.buffer).then((e=>this._compareArrays(e,a)?this._decryptWithAes(c,i,r):l.Rejected("HMAC mismatch"))):l.Rejected("Hash mismatch")))}))}return l.Rejected("Missing receiver information in handshake")}encryptMessage(e,t){return this._encryptBufferWithSignal(e,new Uint8Array(a.textToBytes(t)).buffer)}decryptMessage(e,t){return this._decryptBufferWithSignal(e,t).then((e=>a.bytesToText(n.toArray(new Uint8Array(e)))))}_encryptBufferWithSignal(e,t){const s=new o.SignalProtocolAddress(e.mri,e.devId),i=new o.SessionCipher(this._storage,s);try{return l.fromThenable(i.encrypt(t,"binary")).then((e=>d.btoaUtf8(JSON.stringify(e))))}catch(e){return l.Rejected(e)}}_decryptBufferWithSignal(e,t){const s=new o.SignalProtocolAddress(e.mri,e.devId),i=new o.SessionCipher(this._storage,s),r=d.atobUtf8(t),a=S.default.parseJsonErrorable(r);if(n.isError(a))return l.Rejected(a);try{const e=3===a.type?i.decryptPreKeyWhisperMessage(a.body,"binary"):i.decryptWhisperMessage(a.body,"binary");return l.fromThenable(e)}catch(e){return l.Rejected(e)}}_encryptWithAes(e,t,s){const i={name:f,iv:s,length:t.length};return l.fromThenable(_.importKey("raw",new Uint8Array(t),i,!1,["encrypt"])).then((t=>l.fromThenable(_.encrypt(i,t,new Uint8Array(a.textToBytes(e))))))}_decryptWithAes(e,t,s){const i={name:f,iv:s,length:t.byteLength};return l.fromThenable(_.importKey("raw",t,i,!1,["decrypt"])).then((t=>l.fromThenable(_.decrypt(i,t,e)).then((e=>a.bytesToText(n.toArray(new Uint8Array(e)))))))}_signWithHMAC(e,t,s){return l.fromThenable(_.importKey("raw",e,h.HMAC_ALGO,!1,["sign"])).then((e=>{const i=d.mergeArrays([t,s]);return l.fromThenable(_.sign(h.HMAC_ALGO,e,i))}))}_computeDigest(e,t,s){const i=d.mergeArrays([e,t,s]);return l.fromThenable(_.digest(h.DIGEST_ALGO,i))}_splitKeyMaterial(e){return[new Uint8Array(e.subarray(0,y)).buffer,new Uint8Array(e.subarray(y,64)).buffer,new Uint8Array(e.subarray(64,96)).buffer,new Uint8Array(e.subarray(96,112)).buffer,new Uint8Array(e.subarray(112,144)).buffer]}_compareArrays(e,t){if(e.byteLength!==t.byteLength)return!1;const s=new Uint8Array(e),i=new Uint8Array(t);let o=!0;for(let e=0;e<s.byteLength;++e)o=o&&s[e]===i[e];return o}}t.Test_E2eeCipherService=C;const T=new C;t.default=new class{encryptMessageForConv(e,t){return this._ensureServiceStarted().then((()=>T.encryptMessageForConv(e,t)))}decryptMessageForConv(e,t,s){return this._ensureServiceStarted().then((()=>T.decryptMessageForConv(e,t,s)))}encryptMessage(e,t){return this._ensureServiceStarted().then((()=>T.encryptMessage(e,t)))}decryptMessage(e,t){return this._ensureServiceStarted().then((()=>T.decryptMessage(e,t)))}_ensureServiceStarted(){return m.EnsureStarted(T)}}},378868:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(775463)),n=i.__importStar(s(397691)),r=i.__importDefault(s(304623)),a=i.__importStar(s(766698)),l=i.__importDefault(s(727433)),d=i.__importDefault(s(109367)),c=i.__importDefault(s(379878)),u=s(815146),h=i.__importStar(s(437782)),p=i.__importStar(s(446574));t.default=new class{constructor(){p.RegisterStartupable(this,"E2eeMediaCipherService",[c.default,r.default])}startup(){return Promise.resolve()}generateCallKey(e){return a.byteArrayToBase64String(o.getRandomValues(new Array(48)))}encryptCallKeyForThread(e,t){return this._getReceiverAddress(e).then((s=>l.default.encryptMessage(s,t).catch((t=>(d.default.sendReject(e,u.E2EERejectionReason.EncryptionFailed),n.Rejected(t))))))}decryptCallKeyForThread(e,t){return this._getReceiverAddress(e).then((e=>l.default.decryptMessage(e,t)))}_getReceiverAddress(e){return r.default.getConversationMetaAsync(e).then((t=>{if(!t)return n.Rejected(`No conversation found for ${h.mriOrId(e)}`);const s=t.conv.getEncryptionHandshake();if(!s)return n.Rejected(`No secure handshake in conversation ${h.mriOrId(e)}`);const i=c.default.getBuddyAddress(s);return i.mri&&i.devId?i:n.Rejected(`Missing receiver information in handshake for ${h.mriOrId(e)}`)}))}}},109367:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_E2eeSessionService=void 0;const i=s(197582),o=i.__importDefault(s(727484)),n=i.__importDefault(s(201646)),r=s(358072),a=i.__importStar(s(496486)),l=i.__importStar(s(760249)),d=i.__importDefault(s(974634)),c=i.__importStar(s(397691)),u=i.__importDefault(s(404547)),h=i.__importDefault(s(304623)),p=i.__importDefault(s(556587)),g=i.__importDefault(s(615364)),m=i.__importStar(s(766698)),S=i.__importDefault(s(389659)),_=s(748622),f=s(94618),y=i.__importStar(s(379878)),v=s(815146),C=i.__importStar(s(85385)),T=i.__importDefault(s(201721)),M=i.__importDefault(s(363091)),b=i.__importStar(s(446574)),I=i.__importDefault(s(655192)),w=i.__importDefault(s(601274));o.default.extend(n.default);class P{constructor(){this._loadingPrivateConvs={},this.identityUpdated=new d.default,this.conversationStored=new d.default,b.RegisterStartupable(this,"E2eeSessionService",[u.default,h.default,p.default,g.default,y.default,T.default])}startup(){return this._storage=_.E2eeSessionStorage.getStorage(M.default.getSkypeId()),h.default.decryptionFailed.subscribe((e=>{this.sendReject(e,v.E2EERejectionReason.DecryptionFailed)})),r.SignalProtocolLib.initialize(l),Promise.resolve()}sendInvite(e,t){let s;return this._ensureInit().then((()=>this._getInviteKeyBundle(e).then((t=>(s=t.PreKeyId,u.default.serviceSendE2eeInvite([t],e,y.default.getDeviceId()).then((e=>e.body.ThreadId))))).done((e=>{this._addLocalPrivateConversations(e,!0),C.track(new f.E2eeInvite(t))})).fail((e=>{C.track(new f.E2eeInvite(t,!0,I.default.errorAsString(e))),this._storage.removePreKey(s)}))))}sendAccept(e,t,s=!1){let i;return this._ensureInit().then((()=>this._getHandshake(e).then((o=>this._processInvite(o).then((n=>(i=n.PreKeyId,u.default.serviceSendE2eeAccept(o.InviteId,[n],y.default.getDeviceId()).then(a.noop,(i=>s||!this._shouldRefreshProperties(i)?c.Rejected(i):this._refreshInviteIdIfNeeded(o.InviteId,e,f.E2eeAction.Accept).then((()=>this.sendAccept(e,t,!0)))))))))).done((()=>{this._addLocalPrivateConversations(e,!0),C.track(new f.E2eeAccept(t))})).fail((e=>{C.track(new f.E2eeAccept(t,!0,I.default.errorAsString(e))),this._storage.removePreKey(i)}))))}sendConfirm(e,t=!1,s=!1){return this._ensureInit().then((()=>this._getHandshake(e).then((i=>this._processAccept(i).then((()=>u.default.serviceSendE2eeConfirm(i.InviteId).then(a.noop,(o=>s||!this._shouldRefreshProperties(o)?c.Rejected(o):this._refreshInviteIdIfNeeded(i.InviteId,e,f.E2eeAction.Confirm).then((()=>this.sendConfirm(e,t,!0))))))))).done((()=>{this._addLocalPrivateConversations(e,!0),C.track(new f.E2eeConfirm(t))})).fail((e=>{C.track(new f.E2eeConfirm(t,!0,I.default.errorAsString(e)))}))))}sendReject(e,t,s=!1){return this._ensureInit().then((()=>this._getHandshake(e).then((i=>u.default.serviceSendE2eeReject(i.InviteId).then(a.noop,(o=>s||!this._shouldRefreshProperties(o)?c.Rejected(o):this._refreshInviteIdIfNeeded(i.InviteId,e,f.E2eeAction.Reject).then((()=>this.sendReject(e,t,!0))))))).done((()=>{C.track(new f.E2eeReject(t))})).fail((e=>{C.track(new f.E2eeReject(t,!0,I.default.errorAsString(e)))})).then(a.noop)))}getFingerprint(e){return this._getHandshake(e).then((e=>{const t=y.default.getBuddyBundle(e),s=y.default.getBuddyAddress(e);if(s.mri&&s.devId){if(t){const e=this._toSignalPrekeyBundle(t);return this._getFingerprintFor(s.mri,e.identityKey)}const e=new r.SignalProtocolAddress(s.mri,s.devId);return c.fromThenable(this._storage.loadIdentity(e.toString())).then((e=>e?this._getFingerprintFor(s.mri,e):c.fromThenable(this._storage.loadIdentity(s.mri)).then((e=>e?this._getFingerprintFor(s.mri,e):c.Rejected("No identity available")))))}return c.Rejected("No fingerprint available")}))}isPrivateConvStoredLocally(e){if(this._loadingPrivateConvs[e])return this._loadingPrivateConvs[e];const t=c.fromThenable(this._storage.loadLocalPrivateConversations(e));return this._loadingPrivateConvs[e]=t,t.always((()=>delete this._loadingPrivateConvs[e])),t}forgetPrivateConversation(e){return this._addLocalPrivateConversations(e,!1)}terminateSession(e){return this._cleanupSession(e)}resetIdentity(){return T.default.setUserPreferencesLocal({e2eeV1Initialised:!1}),this._initEncryptionState().then((()=>{this.identityUpdated.fire()}))}_addLocalPrivateConversations(e,t){return c.fromThenable(this._storage.addLocalPrivateConversations(e,t)).then((()=>this.conversationStored.fire(e,t)))}_refreshInviteIdIfNeeded(e,t,s){return this._getHandshake(t).then((i=>{e===i.InviteId?(C.log(v.LogTraceArea.E2EEncryption,"_refreshInviteIdIfNeeded: Refreshing thread properties"),C.track(new f.E2eeRetry(s,f.E2eeRetryType.ForceInviteIdRefresh)),p.default.forceThreadDetailsFetchIfNeeded(t)):(C.log(v.LogTraceArea.E2EEncryption,"_refreshInviteIdIfNeeded: New handshake received in meantime - retry"),C.track(new f.E2eeRetry(s,f.E2eeRetryType.NewInviteIdSynced)))}))}_shouldRefreshProperties(e){return e&&410===e.statusCode&&667===e.errorCode}_getFingerprintFor(e,t){const s=new r.FingerprintGenerator(3);return this._ensureInit().then((()=>c.fromThenable(s.createFor(M.default.getSkypeMri(),this._pubIdentityKey.buffer,e,t))))}_processInvite(e){const t=y.default.getBestBundleMatch(e.APartyPreKeyBundle);return t?this._processInviteBundle(e.AParty,e.APartyDeviceId,e.BParty,t):c.Rejected(`No matching key bundle from AParty, was looking for algo ${y.PREFERRED_HANDSHAKE_ALGO}`)}_processInviteBundle(e,t,s,i){const o=new r.SignalProtocolAddress(e,t),n=new r.SessionBuilder(this._storage,o),a=this._toSignalPrekeyBundle(i);return c.fromThenable(n.processPreKey(a)).then((()=>this._getInviteKeyBundle(e)))}test_processInviteBundle(e,t,s,i){return this._ensureInit().then((()=>this._processInviteBundle(e,t,s,i)))}_processAccept(e){const t=y.default.getBestBundleMatch(e.BPartyPreKeyBundle);return e.BPartyDeviceId&&t?this._processAcceptBundle(e.BParty,e.BPartyDeviceId,e.AParty,t):c.Rejected(`No matching key bundle from BParty, was looking for algo ${y.PREFERRED_HANDSHAKE_ALGO}`)}_processAcceptBundle(e,t,s,i){const o=new r.SignalProtocolAddress(e,t),n=new r.SessionBuilder(this._storage,o),a=this._toSignalPrekeyBundle(i);return c.fromThenable(n.processPreKey(a))}test_processAcceptBundle(e,t,s,i){return this._ensureInit().then((()=>this._processAcceptBundle(e,t,s,i)))}_initEncryptionState(){return(T.default.getUserPreferencesLocal().e2eeV1Initialised?this._loadEncryptionState():this._generateAndStoreRegId().then((()=>this._generateAndStoreIdentityKey())).then((e=>this._generateAndStoreSignedPreKey(e))).then((()=>{T.default.setUserPreferencesLocal({e2eeV1Initialised:!0}),C.log(v.LogTraceArea.E2EEncryption,"Initialized e2e encryption state")}))).then((()=>{w.default.setTimeout((()=>this._checkSignedPreKeyRenewal(this._signedPreKeyExpiration)),432e5)}))}_generateAndStoreRegId(){return C.log(v.LogTraceArea.E2EEncryption,"Registration id generated"),c.fromThenable(this._storage.setLocalRegistrationId(r.KeyHelper.generateRegistrationId()))}_generateAndStoreIdentityKey(){return c.fromThenable(r.KeyHelper.generateIdentityKeyPair().then((e=>(C.log(v.LogTraceArea.E2EEncryption,"Indentity keypair generated"),this._pubIdentityKey=new Uint8Array(e.pubKey),this._storage.storeIdentityKeyPair(e).then((()=>e))))))}_generateAndStoreSignedPreKey(e){return c.fromThenable(r.KeyHelper.generateSignedPreKey(e,_.NOP_KEY_ID).then((e=>(C.log(v.LogTraceArea.E2EEncryption,"SignedPreKey keypair generated"),this._pubSignedPreKey=new Uint8Array(e.keyPair.pubKey),this._signedPreKeySignature=new Uint8Array(e.signature),this._signedPreKeyExpiration=S.default.add(Date.now(),0,14),this._storage.storeSignedPreKey(_.NOP_KEY_ID,e.keyPair).then((()=>this._storage.storeSignedPreKeySignature(_.NOP_KEY_ID,e.signature))).then((()=>this._storage.storeSignedPreKeyExpiration(_.NOP_KEY_ID,this._signedPreKeyExpiration)))))))}_loadEncryptionState(){return c.all([c.fromThenable(this._storage.getIdentityKeyPair()),c.fromThenable(this._storage.loadSignedPreKey(_.NOP_KEY_ID)),c.fromThenable(this._storage.loadSignedPreKeySignature(_.NOP_KEY_ID)),c.fromThenable(this._storage.loadSignedPreKeyExpiration(_.NOP_KEY_ID))]).then((([e,t,s,i])=>(e&&(this._pubIdentityKey=new Uint8Array(e.pubKey)),t&&(this._pubSignedPreKey=new Uint8Array(t.pubKey)),s&&(this._signedPreKeySignature=new Uint8Array(s)),i&&(this._signedPreKeyExpiration=i),this._pubIdentityKey&&this._pubSignedPreKey&&this._signedPreKeySignature&&this._signedPreKeyExpiration?(C.log(v.LogTraceArea.E2EEncryption,"Loaded e2e encryption state"),this._checkSignedPreKeyRenewal(this._signedPreKeyExpiration)):(C.error(v.LogTraceArea.E2EEncryption,"Failed to load encryption state, reinitializing"),this.resetIdentity()))))}_checkSignedPreKeyRenewal(e){return Date.now()>e?(C.log(v.LogTraceArea.E2EEncryption,"Renewing signed pre key"),c.fromThenable(this._storage.getIdentityKeyPair()).then((e=>e?this._generateAndStoreSignedPreKey(e):c.Rejected("Could not load identity key")))):c.Resolved()}test_forceSignedPreKeyRenewal(){return this._checkSignedPreKeyRenewal(0)}_getHandshake(e){const t=(0,g.default)().getConversation(e);if(!t)return c.Rejected(`No conv ${e} found`);const s=t.getEncryptionHandshake();return s?c.Resolved(s):c.Rejected(`No handshake in conv ${e}`)}_getInviteKeyBundle(e){const t=m.getRandomInt32();return c.fromThenable(r.KeyHelper.generatePreKey(t).then((e=>this._storage.storePreKey(t,e.keyPair).then((()=>this._getPreKeyBundle(t,e.keyPair.pubKey))))))}test_getInviteKeyBundle(e){return this._ensureInit().then((()=>this._getInviteKeyBundle(e)))}_ensureInit(){return this._lazyInitTask||(this._lazyInitTask=this._initEncryptionState()),this._lazyInitTask}test_init(){return this._lazyInitTask=void 0,this._ensureInit()}_getPreKeyBundle(e,t){const s=o.default.duration(this._signedPreKeyExpiration).subtract(Date.now(),"ms");return{IdentityKeyBase64:this._toBase64(this._pubIdentityKey),SignedPreKeyBase64:this._toBase64(this._pubSignedPreKey),PreKeySignatureBase64:this._toBase64(this._signedPreKeySignature),PreKeyBase64:this._toBase64(new Uint8Array(t)),ValidityPeriod:s.toISOString(),AlgorithmId:y.CURVE25519_ALGO_ID,SignedPreKeyId:_.NOP_KEY_ID,PreKeyId:e}}_toSignalPrekeyBundle(e){return{registrationId:_.NOP_KEY_ID,identityKey:this._fromBase64(e.IdentityKeyBase64),signedPreKey:{keyId:e.SignedPreKeyId,publicKey:this._fromBase64(e.SignedPreKeyBase64),signature:this._fromBase64(e.PreKeySignatureBase64)},preKey:{keyId:e.PreKeyId,publicKey:this._fromBase64(e.PreKeyBase64)}}}_cleanupSession(e){const t=y.default.getBuddyAddress(e);if(t.devId){const e=new r.SignalProtocolAddress(t.mri,t.devId);return c.all([c.fromThenable(this._storage.saveIdentity(e.getName(),void 0)),c.fromThenable(this._storage.saveIdentity(e.toString(),void 0)),c.fromThenable(this._storage.storeSession(e.toString(),void 0))]).then(a.noop)}return c.Resolved()}_toBase64(e){return m.Uint8ArrayToBase64String(e)}_fromBase64(e){return m.base64StringToUint8Array(e).buffer}}t.Test_E2eeSessionService=P;const k=new P;t.default=new class{constructor(){this.identityUpdated=k.identityUpdated,this.conversationStored=k.conversationStored}sendInvite(e,t){return this._ensureServiceStarted().then((()=>k.sendInvite(e,t)))}sendAccept(e,t){return this._ensureServiceStarted().then((()=>k.sendAccept(e,t)))}sendConfirm(e,t=!1){return this._ensureServiceStarted().then((()=>k.sendConfirm(e,t)))}sendReject(e,t){return this._ensureServiceStarted().then((()=>k.sendReject(e,t)))}getFingerprint(e){return this._ensureServiceStarted().then((()=>k.getFingerprint(e)))}terminateSession(e){return this._ensureServiceStarted().then((()=>k.terminateSession(e)))}resetIdentity(){return this._ensureServiceStarted().then((()=>k.resetIdentity()))}isPrivateConvStoredLocally(e){return this._ensureServiceStarted().then((()=>k.isPrivateConvStoredLocally(e)))}forgetPrivateConversation(e){return this._ensureServiceStarted().then((()=>k.forgetPrivateConversation(e)))}_ensureServiceStarted(){return b.EnsureStarted(k)}}},748622:(e,t,s)=>{var i=s(348764).Buffer;Object.defineProperty(t,"__esModule",{value:!0}),t.E2eeSessionStorage=t.NOP_KEY_ID=void 0;const o=s(197582),n=o.__importStar(s(496486)),r=o.__importDefault(s(872397)),a=o.__importStar(s(397691)),l=(o.__importDefault(s(150343)),s(434343)),d=o.__importStar(s(766698)),c=s(815146),u=o.__importStar(s(85385)),h=o.__importDefault(s(652032)),p=o.__importStar(s(437782)),g=o.__importDefault(s(655192)),m=o.__importDefault(s(139221)),S="Skype",_={IdentityKeyPair:S+"IdentityKeyPair",LocalRegistrationId:S+"LocalRegistrationId",Identity:S+"Identity",PreKey:S+"PreKey",Session:S+"Session",SessionBase64:S+"B64Session",SignedPreKey:S+"SignedPreKey",SignedPreKeySignature:S+"SignedPreKeySignature",SignedPreKeyExpiration:S+"SignedPreKeyExpiration",Fingerprints:S+"Fingerprints",DeviceId:S+"SecureDeviceId",LocalPrivateConversations:S+"LocalPrivateConversations"};t.NOP_KEY_ID=42;const f={},y="Unsupported storage type!";class v{static getStorage(e){return f[e]||(f[e]=new v(e)),f[e]}constructor(e){this._storageKey=e,this._data={},this._testUseInsecureStorage=!0,this.Direction={SENDING:1,RECEIVING:2}}storeIdentityKeyPair(e){return this._storeKeyPair(_.IdentityKeyPair,e)}loadIdentity(e){return this._loadString(_.Identity+e).then((e=>e?d.base64StringToUint8Array(e).buffer:void 0))}storeSignedPreKeySignature(e,t){const s=d.Uint8ArrayToBase64String(new Uint8Array(t));return this._storeString(_.SignedPreKeySignature+e,s)}loadSignedPreKeySignature(e){return this._loadString(_.SignedPreKeySignature+e).then((e=>e?d.base64StringToUint8Array(e).buffer:void 0))}setLocalRegistrationId(e){return this._storeString(_.LocalRegistrationId,e.toString())}storeDeviceId(e){return this._storeString(_.DeviceId,e)}loadDeviceId(){return this._loadString(_.DeviceId)}storePreKey(e,t){return this._storeKeyPair(_.PreKey+e,t)}storeSignedPreKey(e,t){return this._storeKeyPair(_.SignedPreKey+e,t)}storeSignedPreKeyExpiration(e,t){return this._storeString(_.SignedPreKeyExpiration+e,t.toString())}loadSignedPreKeyExpiration(e){return this._loadString(_.SignedPreKeyExpiration+e).then((e=>e?parseInt(e,10):void 0))}storeFingerprints(e,t){return this._storeString(_.Fingerprints+e,JSON.stringify(t))}loadFingerprints(e){return this._loadString(_.Fingerprints+e).then((e=>g.default.parseJsonErrorToUndefined(e)))}addLocalPrivateConversations(e,t){return this._storeString(_.LocalPrivateConversations+e,t.toString())}loadLocalPrivateConversations(e){return this._loadString(_.LocalPrivateConversations+e).then((e=>!!e&&"true"===e))}getIdentityKeyPair(){return this._loadKeyPair(_.IdentityKeyPair)}getLocalRegistrationId(){return this._loadString(_.LocalRegistrationId).then((e=>e?parseInt(e,10):void 0))}isTrustedIdentity(e,t){return new Promise(((e,t)=>{e(!0)}))}saveIdentity(e,t){const s=t?"string"==typeof t?d.byteArrayToBase64String(d.binaryStringToBytes(t)):d.Uint8ArrayToBase64String(new Uint8Array(t)):void 0;return this._storeString(_.Identity+e,s)}loadPreKey(e){return this._loadKeyPair(_.PreKey+e)}removePreKey(e){return this._removeEntry(_.PreKey+e)}loadSignedPreKey(e){return this._loadKeyPair(_.SignedPreKey+e)}loadSession(e){return m.default.isElectronLinux()?this._loadString(_.SessionBase64+e).then((t=>t?Promise.resolve(d.atobUtf8(t)):this._loadString(_.Session+e))):this._loadString(_.Session+e)}storeSession(e,t){if(m.default.isElectronLinux()){const s=[];return s.push(this._storeString(_.SessionBase64+e,t?d.btoaUtf8(t):void 0)),void 0===t&&s.push(this._storeString(_.Session+e,t)),Promise.all(s).then((e=>n.first(e)))}return this._storeString(_.Session+e,t)}_removeEntry(e){if(this._shouldUseInsecureStorage()){const t=n.cloneDeep(this._data);return delete t[e],this._data=t,this._toThenable(h.default.putData(l.InternalKeys.EndToEndEncryptionData,t))}return m.default.isElectronWindows()?this._toThenable(this._removeEntryWindowsHelper(e)):Promise.reject(y)}_storeKeyPair(e,t){const s={pubKey:d.Uint8ArrayToBase64String(new Uint8Array(t.pubKey)),privKey:d.Uint8ArrayToBase64String(new Uint8Array(t.privKey))},i=JSON.stringify(s);return this._storeString(e,i)}_loadKeyPair(e){return this._loadString(e).then((e=>{if(e){const t=g.default.parseJsonWithDefault(e,void 0);if(t)return Promise.resolve({pubKey:d.base64StringToUint8Array(t.pubKey).buffer,privKey:d.base64StringToUint8Array(t.privKey).buffer})}return Promise.resolve(void 0)}))}_storeString(e,t){if(!t)return this._removeEntry(e);if(u.log(c.LogTraceArea.E2EEncryption,`Storing credentials, service:${p.mriOrId(e)} data length:${t.length}`),this._shouldUseInsecureStorage()){const s=n.cloneDeep(this._data);return s[e]=t,this._data=s,this._toThenable(h.default.putData(l.InternalKeys.EndToEndEncryptionData,s))}return m.default.isElectronWindows()?this._toThenable(this._storeStringWindowsHelper(e,t)):Promise.reject(y)}_loadString(e){let t;return this._shouldUseInsecureStorage()?(n.isEmpty(this._data)&&(this._data=h.default.getData(l.InternalKeys.EndToEndEncryptionData)||{}),t=Promise.resolve(this._data[e])):t=m.default.isElectronWindows()?this._toThenable(this._loadStringWindowsHelper(e)):Promise.reject(y),t.catch((e=>{}))}_storeStringWindowsHelper(e,t){const s=2560;if(i.from(t).length<=s)return a.all([r.default.setPassword(e,this._storageKey,t),this._deleteSegments(e,0)]).then(n.noop);const o=[];let l;for(let e=0;e<t.length;e+=l){l=n.floor(1280);let r=t.substring(e,e+l);i.from(r).length>s&&(l=n.floor(s/3),r=t.substring(e,e+l)),o.push(r)}u.log(c.LogTraceArea.E2EEncryption,`Splitting credentials into ${o.length} segments, service:${p.mriOrId(e)}`);const d=n.map(o,((t,s)=>r.default.setPassword(this._createWindowsServiceKey(e,s),this._storageKey,t)));return d.push(r.default.deletePassword(e,this._storageKey).then(n.noop)),d.push(this._deleteSegments(e,o.length)),a.all(d).then(n.noop)}_removeEntryWindowsHelper(e){return a.all([r.default.deletePassword(e,this._storageKey),this._deleteSegments(e,0)]).then(n.noop)}_loadStringWindowsHelper(e){return r.default.getPassword(e,this._storageKey).catch((()=>{const t=(s,i)=>r.default.getPassword(this._createWindowsServiceKey(e,s),this._storageKey).then((e=>t(++s,i=i?i+e:e))).catch((()=>({loadedSegments:s,data:i})));return t(0,void 0).then((t=>(void 0!==t.data&&u.log(c.LogTraceArea.E2EEncryption,`Loaded credentials from ${t.loadedSegments} segments, service:${p.mriOrId(e)}`),t.data)))}))}_createWindowsServiceKey(e,t){return e+"_"+t}_deleteSegments(e,t){const s=t=>r.default.deletePassword(this._createWindowsServiceKey(e,t),this._storageKey).then((e=>e?s(++t):a.Resolved(t)));return s(t).then((s=>{u.log(c.LogTraceArea.E2EEncryption,`Deleted credentials in ${s-t} segments, service:${p.mriOrId(e)}`)}))}test_resetStorage(e=!0){h.default.putData(l.InternalKeys.EndToEndEncryptionData,void 0),this._data={},this._testUseInsecureStorage=e}_toThenable(e){return new Promise(((t,s)=>e.then(t,s)))}_shouldUseInsecureStorage(){return!0}}t.E2eeSessionStorage=v},379878:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PREFERRED_HANDSHAKE_ALGO=t.CURVE25519_ALGO_ID=t.SecureHandshakeState=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(971988)),r=i.__importStar(s(44717)),a=s(434343),l=i.__importDefault(s(652032)),d=i.__importDefault(s(363091)),c=i.__importStar(s(446574)),u=i.__importDefault(s(760989));var h;!function(e){e[e.None=1]="None",e[e.OtherEndpointInUse=2]="OtherEndpointInUse",e[e.SentInvite=3]="SentInvite",e[e.GotInvite=4]="GotInvite",e[e.SentAccept=5]="SentAccept",e[e.GotAccept=6]="GotAccept",e[e.SentSwitch=7]="SentSwitch",e[e.GotSwitch=8]="GotSwitch",e[e.Completed=9]="Completed"}(h||(t.SecureHandshakeState=h={})),t.CURVE25519_ALGO_ID=2,t.PREFERRED_HANDSHAKE_ALGO=t.CURVE25519_ALGO_ID;const p=[t.PREFERRED_HANDSHAKE_ALGO],g=[n.MessageTypes.EncryptedText,n.MessageTypes.EncryptedMedia,n.MessageTypes.EncryptedCall],m=g.concat([n.MessageTypes.HandshakeInvite,n.MessageTypes.HandshakeAccept,n.MessageTypes.HandshakeComplete,n.MessageTypes.HandshakeReject,n.MessageTypes.Typing,n.MessageTypes.ClearTyping]);t.default=new class{constructor(){c.RegisterStartupable(this,"E2eeUtils",[l.default])}startup(){return Promise.resolve()}getDeviceId(){if(this._cachedDeviceId)return this._cachedDeviceId;if(this._cachedDeviceId=l.default.getData(a.InternalKeys.SecureDeviceId),!this._cachedDeviceId){const e=l.default.getData(a.InternalKeys.DeviceId);e&&u.default.isFormattedGuid(e)?this._cachedDeviceId=e:this._cachedDeviceId=u.default.newGuid(),l.default.putData(a.InternalKeys.SecureDeviceId,this._cachedDeviceId)}return this._cachedDeviceId}shouldIgnoreMessage(e){if(!o.includes(m,e.messagetype))return!0;if(!o.includes(g,e.messagetype))return!1;const t=e.encryptedkey;if(!t)return!0;const s=r.getCreatorMriForMessageFromLink(e.from),i=d.default.isMyMri(s),n=i&&e.fromdeviceid!==this.getDeviceId(),a=!i&&!t[this.getDeviceId()];return n||a}isMyDeviceId(e){return!e||e===this.getDeviceId()}isInitiatedByMe(e){return d.default.isMyMri(e.AParty)}getBuddyAddress(e){return this.isInitiatedByMe(e)?{mri:e.BParty,devId:e.BPartyDeviceId}:{mri:e.AParty,devId:e.APartyDeviceId}}getBuddyBundle(e){return this.isInitiatedByMe(e)?this.getBestBundleMatch(e.BPartyPreKeyBundle):this.getBestBundleMatch(e.APartyPreKeyBundle)}getBestBundleMatch(e){const s=o.find(e,(e=>e.AlgorithmId===t.PREFERRED_HANDSHAKE_ALGO));return s||o.find(e,(e=>e.AlgorithmId in p))}getDetailedHandshakeState(e){const t=e.getEncryptionHandshake();if(!t)return h.None;const s=this.isInitiatedByMe(t),i=s?this.isMyDeviceId(t.APartyDeviceId):this.isMyDeviceId(t.BPartyDeviceId),o=e.isSwitchingSecureDevice();switch(t.HandshakeState){case"None":return h.None;case"Invited":case"Accepted":return i?"Invited"===t.HandshakeState?o?s?h.SentSwitch:h.GotSwitch:s?h.SentInvite:h.GotInvite:s?h.GotAccept:h.SentAccept:h.OtherEndpointInUse;case"Completed":return i?h.Completed:h.OtherEndpointInUse}}isAccepted(e){return"Accepted"===e.HandshakeState}isFatalDecryptionError(e){return!(e&&e.name&&"MessageCounterError"===e.name)}}},606320:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(880963)),r=i.__importStar(s(397691)),a=i.__importDefault(s(678247)),l=i.__importStar(s(964647)),d=s(815146),c=i.__importStar(s(235256)),u=i.__importStar(s(85385)),h=i.__importStar(s(44717)),p=i.__importDefault(s(505382)),g=i.__importStar(s(437782)),m=i.__importStar(s(887117)),S=i.__importStar(s(446574)),_=i.__importDefault(s(655192)),f=i.__importDefault(s(115961)),y=(i.__importDefault(s(150343)),s(224958)),v="ExtensionTelemetryService";t.default=new class{constructor(){this._extensionTelemetryServiceScheduleInterval=void 0,S.RegisterStartupable(this,v)}startup(){return Promise.resolve()}_setUpExtensionTelemetryServiceServiceInterval(){void 0!==this._extensionTelemetryServiceScheduleInterval&&c.default.setRefreshOptions(v,{interval:this._extensionTelemetryServiceScheduleInterval,taskTypeFlags:c.TaskTypeFlags.UsesNetworking,callback:()=>(this._postShareExtensionTelemetryData(),this._postNotificationExtensionTelemetryData(),this._postSiriExtensionTelemetryData(),this._postCalendarExtensionTelemetryData(),r.Resolved())})}_postShareExtensionTelemetryData(){n.default.getShareExtensionTelemetryData().then((e=>{if(u.log(d.LogTraceArea.ShareToSkype,"Processing share extension telemetry data: "+e.length),e.length){const t=this._reportSharedTelemetryEvents(e);t&&u.error(d.LogTraceArea.ShareToSkype,"Failed to report "+t+" events")}}),(e=>{u.error(d.LogTraceArea.ShareToSkype,"Failed to get telemetry data from share extension: "+_.default.errorAsString(e))}))}_postNotificationExtensionTelemetryData(){n.default.getNotificationExtensionTelemetryData().then((e=>{if(u.log(d.LogTraceArea.Notifications,"Processing notification extension telemetry data: "+e.length),e.length){const t=this._reportNotificationTelemetryEvents(e);t&&u.error(d.LogTraceArea.Notifications,"Failed to report "+t+" events")}}),(e=>{u.error(d.LogTraceArea.Notifications,"Failed to get telemetry data from notification extension: "+_.default.errorAsString(e))}))}_postSiriExtensionTelemetryData(){n.default.getSiriExtensionTelemetryData().then((e=>{if(u.log(d.LogTraceArea.NativeCodeTelemetry,"Processing siri extension telemetry data: "+e.length),e.length){const t=this._reportSiriTelemetryEvents(e);t&&u.error(d.LogTraceArea.NativeCodeTelemetry,"Failed to report "+t+" events")}}),(e=>{u.error(d.LogTraceArea.NativeCodeTelemetry,"Failed to get telemetry data from siri extension: "+_.default.errorAsString(e))}))}_postCalendarExtensionTelemetryData(){n.default.getCalendarExtensionTelemetryData().then((e=>{if(u.log(d.LogTraceArea.NativeCodeTelemetry,`Processing calendar extension telemetry data: ${e.length}`),e.length){const t=this._reportCalendarTelemetryEvents(e);t&&u.error(d.LogTraceArea.NativeCodeTelemetry,`Failed to report ${t} events`)}}),(e=>{u.error(d.LogTraceArea.NativeCodeTelemetry,"Failed to get telemetry data from calendar extension: "+_.default.errorAsString(e))}))}isSupportedTelemetryEventTypes(e){return"ShareToSkypeEventActions.completed"===e||"ShareToSkypeEventActions.opened"===e||"ShareToSkypeEventActions.posted"===e||"ShareToSkypeEventActions.failed"===e}isSiriSupportedTelemetryEventTypes(e){return"SiriCallSearch"===e||"SiriCallStart"===e}isCalendarSupportedTelemetryEventTypes(e){return"CalendarEventShown"===e||"CalendarEventSelected"===e}isSupportedEventType(e){return"text"===e||"media"===e}isSupportedDataType(e){return"image"===e||("video"===e||"file"===e)}isSupportedNotificationTelemetryEventTypes(e){return"push_notification"===e||"engagement_push_notification_event"===e}getShareEventFromData(e,t){if(!this.isSupportedEventType(t))return null;const s=[];o.each(e,(e=>{if(!this.isSupportedDataType(e))return void u.error(d.LogTraceArea.ShareToSkype,"Share Extension - Incorrect DataType "+e);const t={uri:"",name:"",width:0,height:0,size:0,type:e,thumbnailUri:"",thumbnailWidth:0,thumbnailHeight:0,thumbnailSize:0};s.push(t)}));return{type:t,data:s.length?s:void 0}}_getSharedTelemetryEventFromData(e){const t=_.default.parseJsonErrorable(e);return o.isError(t)?(u.error(d.LogTraceArea.ShareToSkype,"Share Extension - Failed to parse telemetryData "+g.dev_unknownOmit(e)),null):t}_getNotificationTelemetryEventFromData(e){const t=_.default.parseJsonErrorable(e);if(!o.isError(t))return t;u.error(d.LogTraceArea.Notifications,"Notification Extension - Failed to parse telemetryData "+g.dev_unknownOmit(e))}_getSiriTelemetryEventFromData(e){const t=_.default.parseJsonErrorable(e);if(!o.isError(t))return t;u.error(d.LogTraceArea.Notifications,"Siri Extension - Failed to parse telemetryData "+g.dev_unknownOmit(e))}_getCalendarTelemetryEventFromData(e){const t=_.default.parseJsonErrorable(e);if(!o.isError(t))return t;u.error(d.LogTraceArea.Notifications,"Calendar Extension - Failed to parse telemetryData "+g.dev_unknownOmit(e))}test_getTelemetryEventFromData(e){return this._getSharedTelemetryEventFromData(e)}test_reportSharedTelemetryEvents(e){return this._reportSharedTelemetryEvents(e)}test_reportNotificationTelemetryEvents(e){return this._reportNotificationTelemetryEvents(e)}_reportSharedTelemetryEvents(e){const t=this._getSharedTelemetryEventFromData(e);if(!t)return 1;u.log(d.LogTraceArea.ShareToSkype,(t.events,t.events.length));return o.sumBy(t.events,(e=>{if(!e)return u.error(d.LogTraceArea.ShareToSkype,"Share Extension - telemetryEvent.events contains undefined events"),1;if(!e.shareToSkypeEvent)return u.error(d.LogTraceArea.ShareToSkype,"Share Extension - telemetryEventItem.shareToSkypeEvent is undefined"),1;const t=e.shareToSkypeEvent.event;if(!this.isSupportedEventType(t.type))return u.error(d.LogTraceArea.ShareToSkype,"Share Extension - Incorrect EventType "+e.shareToSkypeEvent.event.type),1;const s=this.getShareEventFromData(t.data,t.type);if(!s)return 1;const i=e.eventType;if(!this.isSupportedTelemetryEventTypes(i))return u.error(d.LogTraceArea.ShareToSkype,"Share Extension - Incorrect Telemetry Event Type "+i),1;if(u.log(d.LogTraceArea.ShareToSkype,"Reporting Share Extension Telemetry for "+i),"ShareToSkypeEventActions.opened"===i){const t=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventOpened(s,t)}else if("ShareToSkypeEventActions.completed"===i||"ShareToSkypeEventActions.failed"===i){const t=e.shareToSkypeEvent.conversationsCount,i=e.shareToSkypeEvent.messageAdded,o=e.shareToSkypeEvent.errorCode,n=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventCompleted(s,t,i,n,o)}else if("ShareToSkypeEventActions.posted"===i){const t=e.shareToSkypeEvent.conversationsCount,i=e.shareToSkypeEvent.messageAdded,o=e.shareToSkypeEvent.errorCode,n=e.shareToSkypeEvent.isSharedToContact;this._reportSharedTelemetryEventPosted(s,t,i,n,o)}return 0}))}_reportNotificationTelemetryEvents(e){const t=this._getNotificationTelemetryEventFromData(e);if(!t)return 1;u.log(d.LogTraceArea.Notifications,(t.events,t.events.length));return o.sumBy(t.events,(e=>{if(!e)return u.error(d.LogTraceArea.Notifications,"Notification Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;if(!this.isSupportedNotificationTelemetryEventTypes(t))return u.error(d.LogTraceArea.Notifications,"Notification Extension - Incorrect Telemetry Event Type "+t),1;const s=this._getMessageCorrelationId(e);return u.log(d.LogTraceArea.Notifications,"Notification Extension Telemetry for "+t),this._reportNotificationEvent(e,s),0}))}_getMessageCorrelationId(e){if(!e.from||0===e.from.length)return"";const t=h.getCreatorMriForMessageFromLink(e.from);return l.getCorrelationIdFromMessageParts(t,e.conversationId,e.clientMessageId)}_reportSiriTelemetryEvents(e){const t=this._getSiriTelemetryEventFromData(e);if(!t)return 1;u.log(d.LogTraceArea.NativeCodeTelemetry,(t.events,t.events.length));return o.sumBy(t.events,(e=>{if(!e)return u.error(d.LogTraceArea.NativeCodeTelemetry,"Siri Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;return this.isSiriSupportedTelemetryEventTypes(t)?(u.log(d.LogTraceArea.NativeCodeTelemetry,"Siri Extension Telemetry for "+t),this._reportSiriTelemetryEvent(t),0):(u.error(d.LogTraceArea.NativeCodeTelemetry,"Siri Extension - Incorrect Telemetry Event Type "+t),1)}))}_reportCalendarTelemetryEvents(e){const t=this._getCalendarTelemetryEventFromData(e);if(!t)return 1;u.log(d.LogTraceArea.NativeCodeTelemetry,(t.events,t.events.length));return o.sumBy(t.events,(e=>{if(!e)return u.error(d.LogTraceArea.NativeCodeTelemetry,"Calendar Extension - telemetryEvent.events contains undefined events"),1;const t=e.eventType;return this.isCalendarSupportedTelemetryEventTypes(t)?(u.log(d.LogTraceArea.NativeCodeTelemetry,"Calendar Extension Telemetry for "+t),this._reportCalendarTelemetryEvent(t),0):(u.error(d.LogTraceArea.NativeCodeTelemetry,"Calendar Extension - Incorrect Telemetry Event Type "+t),1)}))}_reportCalendarTelemetryEvent(e){u.track(new a.default(e))}_reportSiriTelemetryEvent(e){u.track(new f.default({action:e}))}_reportSharedTelemetryEventOpened(e,t){u.track(new m.default({action:m.ShareToSkypeEventActions.opened,isSharedToContact:t,event:e}))}_reportSharedTelemetryEventCompleted(e,t,s,i,o){u.track(new m.default({action:m.ShareToSkypeEventActions.completed,event:e,conversationsCount:t,messageAdded:s,isSharedToContact:i,errorCode:o}))}_reportSharedTelemetryEventPosted(e,t,s,i,o){u.track(new m.default({action:m.ShareToSkypeEventActions.posted,event:e,conversationsCount:t,messageAdded:s,isSharedToContact:i,errorCode:o}))}_reportNotificationEvent(e,t){switch(e.eventType){case"push_notification":u.track(new p.default({eventType:e.eventType,eventCode:e.eventCode,conversationId:e.conversationId,messageId:e.messageId,clientMessageId:e.clientMessageId,isMyMessage:e.isMyMessage,result:e.result,messageCorrelationId:t,correlationVector:e.cv,insertedMessageToDB:e.insertedMessageToDB,createdMessageFromNotification:e.createdMessageFromNotification,updatedConversationFromNotification:e.updatedConversationFromNotification,updatedConversationFromCS:e.updatedConversationFromCS}));break;case"engagement_push_notification_event":u.track(new y.EngagementPushNotificationTelemetryEvent({eventType:y.EngagementTelemetryEventType.PushNotificationDisplayed,campaignId:e.campaignId}))}}}},446802:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HintsProvider=void 0;const i=s(536748);class o{getDefaultMessageHintObject(){return{hintWasShownTimes:0,wasFeatureUsedByUser:!1}}updateAllUserHintsDataWithDefaultValuesIfNeeded(e){const t=Object.assign({},e);return t[i.MessageHintsTypes.ContextMenuHint]||(t[i.MessageHintsTypes.ContextMenuHint]=this.getDefaultMessageHintObject()),t[i.MessageHintsTypes.DoubleTapMessageToLike]||(t[i.MessageHintsTypes.DoubleTapMessageToLike]=this.getDefaultMessageHintObject()),t[i.MessageHintsTypes.TapOnReactionToReactTheSame]||(t[i.MessageHintsTypes.TapOnReactionToReactTheSame]=this.getDefaultMessageHintObject()),t[i.MessageHintsTypes.HighlightToBingSearch]||(t[i.MessageHintsTypes.HighlightToBingSearch]=this.getDefaultMessageHintObject()),t}getUserHintsDataWithDefaultValues(){return{[i.MessageHintsTypes.ContextMenuHint]:this.getDefaultMessageHintObject(),[i.MessageHintsTypes.DoubleTapMessageToLike]:this.getDefaultMessageHintObject(),[i.MessageHintsTypes.TapOnReactionToReactTheSame]:this.getDefaultMessageHintObject(),[i.MessageHintsTypes.HighlightToBingSearch]:this.getDefaultMessageHintObject()}}}t.HintsProvider=o,t.default=new o},495712:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(304623)),d=i.__importStar(s(971988)),c=i.__importStar(s(44717)),u=s(154235),h=i.__importStar(s(433614)),p=i.__importDefault(s(615364)),g=i.__importDefault(s(389659)),m=i.__importStar(s(463519)),S=i.__importDefault(s(601976)),_=i.__importDefault(s(794229)),f=s(815146),y=i.__importStar(s(704704)),v=i.__importStar(s(405640)),C=i.__importDefault(s(363091)),T=i.__importDefault(s(942724)),M=i.__importDefault(s(450312)),b=i.__importDefault(s(332065)),I=s(36381),w=i.__importDefault(s(994962)),P=i.__importDefault(s(374503)),k=i.__importDefault(s(791384)),A=i.__importStar(s(446574)),x=i.__importDefault(s(601274));t.default=new class{constructor(){A.RegisterStartupable(this,"IncomingMessageAnnouncementService",[l.default,S.default,M.default,p.default])}startup(){const e={},t={};return l.default.messagesProcessedWithBundleInfo.subscribe((s=>{if(k.default.shouldAnnounceForAccessibility()){const i=M.default.getActiveConversationId(u.MainRootViewId)||M.default.getActiveCallConversationId();o.each(s,(s=>{const o=s.message.cuid;if(o){if(this._shouldAnnounceMessage(s,i))if(s.message.isMutated()&&!this._isCurrentUserMessageReactionUpdate(s)||s.message.isDeletedMessage()){if(s.message.isDeletedMessage()&&!t[o]){const e=this.getAnnouncementText(s,!0);e&&(t[o]=x.default.setTimeout((()=>{delete t[o]}),1e4),n.Accessibility.announceForAccessibility(e))}}else{const t=this.getAnnouncementText(s);t&&!e[o]&&(e[o]=x.default.setTimeout((()=>{delete e[o]}),1e4),n.Accessibility.announceForAccessibility(t,!1,o))}s.message.isDeletedMessage()&&n.Accessibility.removeAnnouncementClass(o)}}))}})),r.Resolved()}getAnnouncementText(e,t){const s=e.message,i=(0,p.default)().getConversation(s.conversationId),n=i&&i.isThread()||!1,r=c.isEncryptedThread(s.conversationId);let a="";if(!r&&!t){const e=m.decode(s);a=h.toAccessibilityLabel(e,{message:s,includeSenderInformationInAccessibilityLabel:!1,includeReactionInformationInAccessibilityLabel:!1,includeMediaAlbumItemCountInAccessibilityLabel:!1})}let l="";C.default.isMyMri(s.creator)||(l=S.default.getDisplayName(s.creator)||"");const u={senderName:l,messageContent:a,timestamp:g.default.getDisplayTimeString(s.createdTime)};if(r){if(o.startsWith(s.content,"<handshakeinvite>"))return;return y.getString("AccessibilityLabel.NewPrivateMessage",u)}if(d.isScheduledCallType(s.messagetype))return this._getScheduledCallUpdateAnnouncement(s);if(o.isEmpty(e.reactionUpdates.added)){if(o.isEmpty(e.reactionUpdates.removed))return n?(u.threadName=S.default.getDisplayName(s.conversationId)||"",t?y.getString("AccessibilityLabel.RemovedMessageThreadAnnouncement",u):y.getString("AccessibilityLabel.NewThreadMessage",u)):t?y.getString("AccessibilityLabel.RemovedMessageConversationAnnouncement",u):y.getString("AccessibilityLabel.NewConversationMessage",u);{const t=o.last(e.reactionUpdates.removed);if(!t)return;u.senderName=S.default.getDisplayName(t.mri)||"";const s=_.default.getEmoticonByShortcutNoSubscription(t.key);return u.reaction=s&&s.description||t.key,y.getString("AccessibilityLabel.RemovedReactionToMessage",u)}}{const t=o.last(e.reactionUpdates.added);if(!t)return;u.senderName=S.default.getDisplayName(t.mri)||"";const s=_.default.getEmoticonByShortcutNoSubscription(t.key);return u.reaction=s&&s.description||t.key,y.getString("AccessibilityLabel.NewReactionToMessage",u)}}_isCurrentUserMessageReactionUpdate(e){const t=C.default.isMyMri(e.message.creator);return a.default.getS4LMessagingFeaturesNoSubscription().enableReactionAnnouncements&&t&&(!o.isEmpty(e.reactionUpdates.added)||!o.isEmpty(e.reactionUpdates.removed))}_isReactionUpdate(e){return!o.isEmpty(e.reactionUpdates.added)||!o.isEmpty(e.reactionUpdates.removed)}_isComingFromLongPollOrTrouter(e){return o.some(e.details,(e=>e.origin===f.MessageOrigin.LongPoll||e.origin===f.MessageOrigin.Trouter))}_shouldAnnounceMessage(e,t){const s=this._isComingFromLongPollOrTrouter(e),i=!o.isUndefined(t)&&t===e.message.conversationId,n=this._isComingFromEngagementSystem(e),r=this._isComingFromHiddenBot(e);if(!s||e.message.isDeletedMessage()&&!i||n||r)return!1;const a=(0,p.default)().getConversation(e.message.conversationId);if(a&&d.shouldServerMessageBeFilteredOut(e.message,a))return!1;const l=C.default.isMyMri(e.message.creator),c=this._isCurrentUserMessageReactionUpdate(e),u=v.areNotificationsEnabled(),h=a&&a.isMuted(),g=this._isReactionUpdate(e);return!e.message.isAlbumItem()&&(i?!l||c:T.default.isUsingStackNavigationContext()?!l&&u&&!h&&!g:!l&&!h&&!g)}_isComingFromEngagementSystem(e){const t=a.default.getEngagementFeatures().engagementSenderIdentity;return!!o.some(t,(t=>t===e.message.creator))}_isComingFromHiddenBot(e){const t=a.default.getS4LCaapFeatures().botIdsToHide;return!!o.some(t,(t=>t===e.message.creator))}_getScheduledCallUpdateAnnouncement(e){const t=b.default.extractScheduledCallFromMessage(e);if(!t)return;const s=w.default.getScheduledCallById(t.id),i=w.default.getScheduledCallUpdatesDeltas(e.creator,s,t);if(o.isEmpty(i.invitations)){if(i.wasCanceled){const s=S.default.getDisplayName(e.creator)||"";return y.getString("Notifications.ScheduledCallDeletedBody",{displayName:s,subject:P.default.getScheduledCallSubject(t.subject)})}}else{let e="";if(o.forOwn(i.invitations,((s,i)=>{const o=S.default.getDisplayName(i)||"";e+=(s.invitationStatus===I.ScheduledCallInvitationStatus.Accepted?y.getString("Notifications.ScheduledCallAcceptedBody",{displayName:o,subject:P.default.getScheduledCallSubject(t.subject)}):y.getString("Notifications.ScheduledCallDeclinedBody",{displayName:o,subject:P.default.getScheduledCallSubject(t.subject)}))+" "})),e)return e}}}},91385:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalMessageNotificationsService=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(331654)),r=s(380157),a=s(279211),l=(s(720415),i.__importStar(s(397691))),d=(i.__importStar(s(516778)),i.__importDefault(s(150343))),c=i.__importDefault(s(97572)),u=s(284841),h=i.__importDefault(s(304623)),p=i.__importStar(s(971988)),g=i.__importStar(s(44717)),m=s(154235),S=(i.__importDefault(s(555436)),i.__importStar(s(185013))),_=i.__importDefault(s(574489)),f=i.__importDefault(s(493129)),y=i.__importDefault(s(306200)),v=i.__importStar(s(596467)),C=i.__importDefault(s(999261)),T=(i.__importStar(s(463519)),i.__importDefault(s(601976))),M=i.__importStar(s(320820)),b=i.__importStar(s(82121)),I=i.__importDefault(s(18026)),w=i.__importDefault(s(794229)),P=s(815146),k=i.__importDefault(s(524526)),A=i.__importStar(s(85385)),x=i.__importDefault(s(652032)),D=i.__importStar(s(704704)),R=(s(606933),i.__importStar(s(405640))),L=i.__importStar(s(152010)),B=s(480327),F=i.__importDefault(s(201721)),N=i.__importDefault(s(341994)),E=i.__importDefault(s(363091)),O=i.__importStar(s(812822)),U=i.__importDefault(s(942724)),V=i.__importDefault(s(450312)),H=s(395617),j=i.__importDefault(s(921691)),z=i.__importStar(s(995276)),W=i.__importStar(s(528196)),G=i.__importDefault(s(684604)),K=i.__importDefault(s(960282)),q=i.__importStar(s(437782)),Q=s(229179),X=i.__importDefault(s(332065)),$=s(36381),J=i.__importDefault(s(994962)),Y=i.__importDefault(s(374503)),Z=i.__importDefault(s(393443)),ee=i.__importStar(s(446574)),te=i.__importDefault(s(655192)),se=i.__importDefault(s(139221)),ie=i.__importDefault(s(705676)),oe=s(305360),ne=i.__importDefault(s(685734)),re=i.__importDefault(s(760989)),ae=s(843890),le=(s(44717),s(593501)),de=s(123117);class ce{constructor(){this._recentlyNotifiedKeys=[],ee.RegisterStartupable(this,"LocalMessageNotificationsService",[G.default,F.default])}startup(){return Promise.resolve()}_getAppLaunchedNotificationType(e){const t=p.getMessageTypeGroup(e);if(e.isCurrentUserQuoted())return P.NotificationTypeAppLaunched.Quote;if(e.isCurrentUserMentioned())return P.NotificationTypeAppLaunched.Mention;switch(t){case p.MessageTypeGroups.MediaAlbum:return P.NotificationTypeAppLaunched.MediaAlbum;case p.MessageTypeGroups.Picture:return P.NotificationTypeAppLaunched.Photo;case p.MessageTypeGroups.Video:return P.NotificationTypeAppLaunched.Video;case p.MessageTypeGroups.UriFile:return P.NotificationTypeAppLaunched.File;case p.MessageTypeGroups.Sticker:return P.NotificationTypeAppLaunched.Sticker;case p.MessageTypeGroups.ScheduledCallInvite:return P.NotificationTypeAppLaunched.ScheduledCallInvite;case p.MessageTypeGroups.Location:return P.NotificationTypeAppLaunched.Location;case p.MessageTypeGroups.Text:return z.isLastMessageUpdateReaction(e)?P.NotificationTypeAppLaunched.Reaction:P.NotificationTypeAppLaunched.Text;default:return}}_shouldProcessReactionNotification(e){return z.isLastMessageUpdateReaction(e)?ee.EnsureStarted(N.default).then((()=>N.default.getReactionNotificationsEnabled())):l.Resolved(!1)}_tryProcessingScheduledCallNotification(e){return p.isScheduledCallType(e.messagetype)?ee.EnsureStarted(J.default).then((()=>J.default.processScheduledCallMessage(e))):l.Resolved(void 0)}processMessageInfoForNotifications(e){const t=e.message;return o.some(e.details,(e=>e.origin===P.MessageOrigin.ChatSync||e.origin===P.MessageOrigin.LocalChange))||(0,oe.isForceUpdateEnabled)()?l.Resolved(P.MessageProcessResult.CameFromSyncOrLocal):l.all([this._shouldProcessReactionNotification(t),this._tryProcessingScheduledCallNotification(t)]).then((([s,i])=>{const o=!(!i||!i.hasUpdates);if(E.default.isMyMri(t.creator)&&!s&&!o&&!(0,le.isMagicBotOneOnOneMessage)(t))return l.Resolved(P.MessageProcessResult.MyMessage);if((0,le.isMagicBotOneOnOneControlMessage)(t))return l.Resolved(P.MessageProcessResult.BingControl);if(t.isDeletedMessage())return G.default.cancelNotificationById(t.conversationId+t.createdTime),l.Resolved(P.MessageProcessResult.DeletedMessage);if(t.isHiddenTranslationSettingsMessage())return l.Resolved(P.MessageProcessResult.TranslationSettingsSuppressed);if(d.default.getS4LCMCFeatures().enableMessageTranslation&&k.default.isConversationTranslated(t.conversationId)&&p.isWrittenTextMessageType(t.messagetype)&&!s)return l.Resolved(P.MessageProcessResult.OriginalForTranslatedConversationSuppressed);if(t.isEdited()&&!s&&!o)return l.Resolved(P.MessageProcessResult.EditedMessage);if(t.messagetype===p.MessageTypes.PopCard||t.messagetype===p.MessageTypes.Notice)return l.Resolved(P.MessageProcessResult.EngagementNotificationSuppressed);if(t.isMutated()&&!s&&!o)return l.Resolved(P.MessageProcessResult.MutatedMessage);if(p.isCallMessageType(t)||p.isCallInfoMessageType(t))return l.Resolved(P.MessageProcessResult.CallMessage);const n=p.isAddMemberMessageType(t.messagetype);if(p.isThreadActivityType(t.messagetype)&&!n&&!t.isE2eeHandshakeTypeAllowedForNotification())return A.log(P.LogTraceArea.Notifications,"Suppress all thread activity messages except e2e actions"),l.Resolved(P.MessageProcessResult.ThreadActivitySuppressed);if(n){const e=L.getMessageInitiator(t);if(!L.isAddCurrentUserThreadActivity(t)||v.getConversationAlwaysHiddenStatus(t.conversationId).hidden||e&&E.default.isMyMri(e))return A.log(P.LogTraceArea.Notifications,"Suppress add member to thread activity"),l.Resolved(P.MessageProcessResult.ThreadActivitySuppressed)}if(t.hasAlbumId()){if(!t.isAlbum()&&!s)return l.Resolved(P.MessageProcessResult.Filtered)}const r=R.getReasonForNotificationsDisabled(!0);return void 0!==r?l.Resolved(r):l.all([h.default.getConversationMetaAsync(t.conversationId),b.isDisabledChatNotification(),ee.EnsureStartedExclusive([C.default,c.default,x.default])]).then((s=>{const o=s[0];return s[1]?l.Resolved(P.MessageProcessResult.DoNotDisturbEnabled):g.isUserMri(t.conversationId)&&S.isConversationObjectBlocked(o.conv)?l.Resolved(P.MessageProcessResult.FromBlockedUser):(A.log(P.LogTraceArea.Notifications,"Processed message info, deciding if we need to show a new notification"),R.getNotificationAction(e.isOtherEndpointActive,o.conv,t).then((e=>e.action!==H.MessageNotificationAction.InterruptUser&&e.action!==H.MessageNotificationAction.InformUserExternal?l.Resolved(P.MessageProcessResult.Filtered):(A.log(P.LogTraceArea.Notifications,"Preparing to present local message notification"),this._presentMessageNotification(t,o,e,i)))))}))}))}_presentMessageNotification(e,t,s,i){const r=F.default.getUserPreferencesLocal();let a=!1;const c=C.default.isCurrentUserActive();let u;if(ee.HasStarted(V.default)&&(u=V.default.getActiveConversationId(m.MainRootViewId)),c){if(u!==e.conversationId){const t=y.default.getAllSiblingConversations(e.conversationId);if(d.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations&&o.some(t,(e=>e.id===u)))return l.Resolved(P.MessageProcessResult.SiblingConversationInTabActive)}if(!(u?u!==e.conversationId:this._shouldAllowChatNotificationsWhenNotInConversation()))return l.Resolved(P.MessageProcessResult.IsForegroundedInConversation);ae.UICapabilities.inAppBrowserNotificationsSupported()&&K.default.isTinyScreenSizeNoSubscription(m.MainRootViewId)||(a=!0)}else if(a=!0,!r.enableScheduledCallNotifications&&s.notificationType===H.MessageNotificationType.ScheduledCall)return l.Resolved(P.MessageProcessResult.ScheduleCallNotificationsDisabled);if(!i||!i.hasUpdates){let t=e.cuid;if(s.notificationType===H.MessageNotificationType.Reaction&&(t+=e.getLastReactionTimeExcludingCurrentUser()),o.includes(this._recentlyNotifiedKeys,t))return l.Resolved(P.MessageProcessResult.RecentlyNotified);this._recentlyNotifiedKeys.push(t),this._recentlyNotifiedKeys.length>50&&this._recentlyNotifiedKeys.splice(0,this._recentlyNotifiedKeys.length-50)}if(a)return A.log(P.LogTraceArea.Notifications,"Presenting system notification"),this._showSystemLocalNotificationForMessage(e,t,s,i);{if(!r.enableInAppScheduledCallNotifications&&s.notificationType===H.MessageNotificationType.ScheduledCall)return l.Resolved(P.MessageProcessResult.InAppScheduleCallNotificationsDisabled);if(!r.enableInAppNotifications)return l.Resolved(P.MessageProcessResult.InAppNotificationsDisabled);const t=re.default.newCauseId();A.log(P.LogTraceArea.Notifications,"Presenting in-app notification causeId: "+t),s.notificationType===H.MessageNotificationType.ScheduledCall?i&&this._showScheduledCallToast(e,i.updatesDelta):ie.default.scheduleSkypeMessage(e);const o=new B.MessagingToastShowEvent(e,s.notificationType,s.action,!1,!1,void 0);return A.track(o),r.enableNotificationSounds&&n.default.getRingerMode().then((e=>{e!==n.DeviceRingerMode.Silent&&e!==n.DeviceRingerMode.Vibrate&&Z.default.SkypeInAppNotification.playOnce(t)})),l.Resolved(P.MessageProcessResult.NotifiedInApp)}}_shouldAllowChatNotificationsWhenNotInConversation(){if(ee.HasStarted(V.default)){if(U.default.isUsingStackNavigationContext())return ie.default.showMessageForScreenReaders();return V.default.getCompositeMainStageNavViewMode()===O.MainStageNavViewMode.WelcomeScreen}return!0}_showSystemLocalNotificationForMessage(e,t,s,i){if(I.default.isMandatoryUpdate())return l.Resolved(P.MessageProcessResult.MandatoryElectronUpdate);if(s.notificationType===H.MessageNotificationType.AddToConversation)return this._populateSystemLocalNotification(e.creator,e,t,void 0,s,void 0);if(s.notificationType===H.MessageNotificationType.Reaction){const i=R.getLastReactionUserMri(e);return i?T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(i).then((i=>this._populateSystemLocalNotification(e.creator,e,t,i,s,void 0))):(A.warn(P.LogTraceArea.Notifications,"Could not find last notification user even though this is reaction notification."),l.Resolved(P.MessageProcessResult.LastReactionUserNotFound))}if(s.notificationType===H.MessageNotificationType.ScheduledCall){if(!i)return l.Resolved(P.MessageProcessResult.ScheduledCallInvitationUnknown);const n=Y.default.getScheduledCallSubject(i.scheduledCall.subject);if(i.updatesDelta.invitations&&!o.isEmpty(i.updatesDelta.invitations)){const o=this._getUserInvitationInfo(i.updatesDelta.invitations);if(!o)return l.Resolved(P.MessageProcessResult.ScheduledCallInvitationUnknown);const r=t.conv.isOneOnOne()&&t.conv.getOtherPartyMri()||e.creator;return T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(r).then((r=>this._populateSystemLocalNotification(e.creator,e,t,r,s,{userMri:o.initiator,subject:n,invitationStatus:o.invitationStatus,scheduledCallId:i.scheduledCall.id,datetimeMs:i.scheduledCall.datetimeMs,hasNewResponses:!0})))}return T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(e.creator).then((o=>{const r={userMri:e.creator,subject:n,wasCanceled:i.updatesDelta.wasCanceled,scheduledCallId:i.scheduledCall.id,hasUpdates:i.hasUpdates,datetimeMs:i.scheduledCall.datetimeMs};return this._populateSystemLocalNotification(e.creator,e,t,o,s,r)}))}{const i=ee.HasStarted(ne.default)?ne.default.getConversationOwner(e.creator):e.creator;return T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(i).then((o=>this._populateSystemLocalNotification(i,e,t,o,s)))}}_getUserInvitationInfo(e){let t;const s=o.keys(e),i=o.first(s);if(e[i]&&(t=e[i].invitationStatus),!o.isUndefined(t)&&t!==$.ScheduledCallInvitationStatus.Unknown)return{initiator:i,invitationStatus:t}}_showScheduledCallToast(e,t){let s,i;if(t)if(o.isUndefined(t.invitations)||o.isEmpty(t.invitations)){if(!t.hasSubjectOrDateTimeChanged&&!t.wasCanceled)return;s=e.creator,i=t.wasCanceled?Q.ScheduleCallAlertTypes.Canceled:Q.ScheduleCallAlertTypes.Edited}else{const e=this._getUserInvitationInfo(t.invitations);if(!e)return;s=e.initiator,i=e.invitationStatus===$.ScheduledCallInvitationStatus.Accepted?Q.ScheduleCallAlertTypes.InvitationAccepted:Q.ScheduleCallAlertTypes.InvitationDeclined}else s=e.creator,i=Q.ScheduleCallAlertTypes.Received;const n=X.default.extractScheduledCallFromMessage(e);n&&ie.default.scheduleMessageForScheduledCall(e,i,s,n.subject)}_populateSystemLocalNotification(e,t,s,i,o,n){return ee.EnsureStarted([j.default,w.default]).then((()=>{const d=j.default.getShowNotificationPermissionStatus();if(d===r.PermissionStatus.Denied||d===r.PermissionStatus.Unavailable)return l.Resolved(P.MessageProcessResult.SystemMessagePermissionsDenied);const c=new f.default(t.conversationId,s.conv),u=t.push_getSenderDisplayName(),h=i&&i.getDisplayName(u),p=i&&i.getShortName(),m=g.unescapeTextWithoutXml(t.push_getThreadTopic()),S=c.getDisplayName(m),y=z.getNotificationIcon(i,c),v={conversationId:t.conversationId,messageTimestamp:t.createdTime,senderId:e,eventType:this._getAppLaunchedNotificationType(t),scheduledCallId:n?n.scheduledCallId:void 0,consumptionHorizon:t.getConsumptionHorizonString()};return M.getCompactNotificationDisplayInfoPotentiallyBeforeStartupAsync(t,s.conv,o.notificationType,h,p,S,n).then((s=>{let i;i=t.isE2eeHandshakeTypeAllowedForNotification()?W.LocalNotificationIds.E2EE_CATEGORY_IDENTIFIER:o.notificationType===H.MessageNotificationType.ScheduledCall?n&&n.hasNewResponses?W.LocalNotificationIds.SCHEDULED_CALL_INVITE_RESPONSE:n&&n.hasUpdates?W.LocalNotificationIds.SCHEDULED_CALL_INVITE_EDIT:W.LocalNotificationIds.SCHEDULED_CALL_INVITE:W.LocalNotificationIds.CHAT_CATEGORY_IDENTIFIER;const c=F.default.getUserPreferencesLocal(),u=o.action===H.MessageNotificationAction.InterruptUser&&c.enablePushNotificationSounds,p=_.default.getActiveRecentsConversationCount(),g={conversationId:t.conversationId,messageTimestamp:R.getLatestMessageTimestamp(t),messageCreatorName:h,timestamp:Date.now(),category:i,message:s.body,title:s.title,serviceSpecificData:v,id:t.conversationId+t.createdTime,icon:y,priority:a.NotificationPriority.Max,silent:!u,senderId:e,applicationIconBadgeNumber:p};u&&(g.sound=se.default.getSoundPath("Skype_Notification.m4a"));const m=[];let S;return W.printNotificationTrace(g,"default"),m.push(G.default.saveLocalNotification(g,!0)),m.push(a.LocalNotifications.show(g)),o.snoozeUntil&&(A.log(P.LogTraceArea.Notifications,"Suppressing notifications for "+q.mriOrId(t.conversationId)+" until "+o.snoozeUntil),G.default.snoozeConversation(t.conversationId,{createdAt:R.getLatestMessageTimestamp(t),until:o.snoozeUntil})),l.all(m).then((()=>{const e=new B.MessagingToastShowEvent(t,o.notificationType,o.action,!0,false,S);return A.track(e),d===r.PermissionStatus.Granted?P.MessageProcessResult.NotifiedSystemMessage:P.MessageProcessResult.SystemMessagePermissionsUnknown})).catch((e=>(A.warn(P.LogTraceArea.Notifications,"Local notification failure: "+te.default.errorAsString(e)),P.MessageProcessResult.SystemMessageFailure)))}))}))}_createAndroidNotification(e,t,s,i,n){if(!d.default.getS4LMessagingFeaturesNoSubscription().enableAndroidMessagingStyleNotifications||g.isEncryptedThread(e.conv.id)||n===H.MessageNotificationType.Reaction||p.isScheduledCallType(t.messagetype))return l.Resolved(s);const r=e.counts&&e.counts.unreadCount||1,a=re.default.clampValue(r,1,5);return l.fromThenable(de.MessagesRepository.getMessagesForConversationBeforeTime(e.conv.id,Number.MAX_VALUE,a,!1)).then((n=>(n=o.filter(n,(e=>!e.hasAlbumId()||t.isAlbum())))?this._getFormattedMessages(e.conv,n).then((t=>{const o=D.getString("Notifications.MultiMessageTitleSingleConversation",{title:i,count:r});return Object.assign(Object.assign({messages:t,title:o,conversationName:i,conversationTitle:o},s),{isOneOnOne:e.conv.isOneOnOne(),id:e.conv.id})})):l.Resolved(s)))}_getFormattedMessages(e,t){t=o.orderBy(t,(e=>e.createdTime));const s=(0,u.chain)(t,(0,u.map)((e=>e.creator)),(0,u.uniq)()),i=o.map(s,(e=>T.default.getDisplayableProfilePotentiallyBeforeStartupAsync(e).then((t=>({creator:e,userDisplayable:t})))));return l.all(i).then((s=>o.map(t,(t=>{const i=o.find(s,(e=>e.creator===t.creator));return M.formatPreviousMessagePotentiallyBeforeStartup(e,t,null==i?void 0:i.userDisplayable,null==i?void 0:i.creator)}))))}}t.LocalMessageNotificationsService=ce,t.default=new ce},484700:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(150343)),n=i.__importDefault(s(151522)),r=i.__importDefault(s(280468)),a=i.__importDefault(s(583127));t.default=new class{hintShownAndUsed(){this._hintShownAndUsed=!0}getHint(e,t){if(t&&(this._hintType=void 0,this._hintShownAndUsed=!1,this._isOneToOne=e.isOneOnOne(),this._messageHintsPriorityList=o.default.getS4LMessagingFeatures().messageHintsPriority),this._hintShownAndUsed)return;const s=this._getPriorityHintType(this._hintType?this._messageHintsPriorityList.indexOf(this._hintType):void 0);if(s){this._hintType=s;const e=this._getHintType(this._hintType);return e&&!e.wasFeatureUsedByUser?e:this.getNextPriorityHint()}}_getHintType(e){switch(e){case"ContextMenu":return a.default.getHint();case"Reactions":return r.default.getHint(this._isOneToOne);case"BingSearch":return n.default.getHint();default:return}}getNextPriorityHint(){if(this._hintShownAndUsed)return;if(void 0!==this._hintType&&this._messageHintsPriorityList.indexOf(this._hintType)===this._messageHintsPriorityList.length-1)return;const e=this._getPriorityHintType(void 0!==this._hintType?this._messageHintsPriorityList.indexOf(this._hintType)+1:void 0);if(e){this._hintType=e;return this._getHintType(this._hintType)}}_getPriorityHintType(e){return(e?this._messageHintsPriorityList.slice(e,this._messageHintsPriorityList.length):this._messageHintsPriorityList).find((e=>this._isHintTypeEnabled(e)))}_isHintTypeEnabled(e){const t=o.default.getS4LMessagingFeatures();let s=!1;switch(e){case"ContextMenu":s=t.contextMenuMessageHint.enabled;break;case"Reactions":s=!0;break;case"BingSearch":s=t.bingSearchMessageHint.enabled}return s}getMessageToShowHint(e,t){let s;switch(this._hintType){case"ContextMenu":s=a.default.getMessageToShowHint(e,t);break;case"Reactions":s=r.default.getMessageToShowHint(this._isOneToOne,e);break;case"BingSearch":s=n.default.getMessageToShowHint(e,t)}return s}updateHintData(e,t,s){let i;switch(this._hintType){case"ContextMenu":i=a.default.updateHint(e,t,s);break;case"Reactions":i=r.default.updateHint(e,t,s,this._isOneToOne);break;case"BingSearch":i=n.default.updateHint(e,t,s)}return i}getMessageHintDataToDisplay(){let e;switch(this._hintType){case"ContextMenu":e=a.default.getMessageHintDataToDisplay();break;case"Reactions":const t=r.default.getHintObjectType(this._isOneToOne);e=r.default.getMessageHintDataToDisplay(t);break;case"BingSearch":e=n.default.getMessageHintDataToDisplay()}return e}}},221837:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageSendPerfRecordStore=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(150343)),r=s(815146),a=i.__importStar(s(85385)),l=s(306194);class d{constructor(){this._perfRecords={}}notifyMessageSubmittedToPostingService(e,t,s){n.default.getS4LMessagingFeatures().enableMessageSendSuccessProcessing&&(this._perfRecords[e]&&a.error(r.LogTraceArea.MessageComposer,"MessageSendPerfRecordStore: Msg for this clientMessageId already notified!"),this._perfRecords[e]={submittedToPostingServiceTime:Date.now(),isUsingStackNavigation:t,confirmedGoodConnection:s,interrupted:!1})}notifyMessageReachedPostingTransferService(e){const t=this._perfRecords[e];t&&!t.reachedPostingTransferServiceTime&&(t.reachedPostingTransferServiceTime=Date.now())}notifyMessageLieReachedChatServiceDataService(e){const t=this._perfRecords[e];t&&!t.lieReachedChatServiceDataServiceTime&&(t.lieReachedChatServiceDataServiceTime=Date.now())}notifyMessagePickedFromMessageViewStoreIntoView(e){const t=this._perfRecords[e];t&&!t.messagPickedFromViewStoreIntoViewTime&&(t.messagPickedFromViewStoreIntoViewTime=Date.now())}notifyMessageRendered(e){const t=this._perfRecords[e];t&&(t.messageLieRenderedTime=Date.now())}notifyMessageRenderInterrupted(e){if(e){const t=this._perfRecords[e];t&&(t.interrupted=!0,t.timePassedTillinteruption=Date.now()-t.submittedToPostingServiceTime)}}notifyMessageAcknowledgedByCS(e,t){const s=this._perfRecords[e];s&&(s.messageSentTime=Date.now(),this._finalize(s,e,t))}_finalize(e,t,s){const i=e.submittedToPostingServiceTime;a.track(new l.SendTextMessageUI(e.messageSentTime?e.messageSentTime-i:0,e.isUsingStackNavigation,e.confirmedGoodConnection,e.interrupted,e.timePassedTillinteruption||0,s,t)),delete this._perfRecords[t],this._cleanupStaleRecords()}_cleanupStaleRecords(){const e=Date.now();this._perfRecords=o.omitBy(this._perfRecords,(t=>t.submittedToPostingServiceTime+6e4<e))}}t.MessageSendPerfRecordStore=d,t.default=new d},531904:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(150343)),a=i.__importStar(s(971988)),l=s(971988),d=i.__importDefault(s(615364)),c=i.__importStar(s(463519)),u=s(815146),h=i.__importDefault(s(524526)),p=i.__importStar(s(85385)),g=s(606933),m=i.__importDefault(s(355103)),S=i.__importDefault(s(363091)),_=i.__importDefault(s(517518)),f="Skype",y="translate";t.default=new class{constructor(){this._endpointUrlOverride=void 0}setEndpointUrlOverride(e){n.isEmpty(e)||(this._endpointUrlOverride=e,p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.setEndpointUrlOverride: "+o.pii.Omit(e)))}getEndpointUrl(){return this._endpointUrlOverride&&!n.isEmpty(this._endpointUrlOverride)?this._endpointUrlOverride:r.default.getS4LCMCFeatures().messageTranslatorEndpointUrl}clearEndpointUrlOverride(){this._endpointUrlOverride=void 0,p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.clearEndpointUrlOverride")}maybeRequestTranslation(e,t,s,i){if(!r.default.getS4LCMCFeatures().enableMessageTranslation)return;if(!s&&!i)return;if(s){if(n.isEmpty(s.content))return;if(s.contenttype!==a.ContentTypes.Text)return;if(s.messagetype!==l.MessageTypes.RichText)return}const o=(0,d.default)().getConversation(e);if(!o||!h.default.isConversationTranslated(e))return;const g=o.getMessageTranslationLocale();if(!g||n.isEmpty(g))return void p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translation locale is undefined");const v=this.getEndpointUrl();if(n.isEmpty(v))return void p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translator endpoint is undefined");const C=S.default.getSkypeMri();let T=i;s&&(T=c.decode(s,C,e).children);const M=this._getRawText(T);if(!M)return void p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: unable to extract raw text from message");const b={text:M,loc:g,chatThreadId:e,oid:t},I={provider:f,parameters:{token:_.default.getRawSkypeToken(),identity:S.default.getSkypeId()}},w={type:y,auth:I,request:b};m.default.requestTranslation(v,w)}_canTranslateOne(e){return e&&!n.isEmpty(e.content)&&e.messagetype===l.MessageTypes.RichText}requestTranslation(e,t,s){if(!this._canTranslateOne(s))return;const i=h.default.getLocalCallTranslatorBotSubtitleLanguageLocale();if(!i||n.isEmpty(i))return void p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translation locale is undefined");const o=this.getEndpointUrl();if(n.isEmpty(o))return void p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.maybeRequestTranslation: translator endpoint is undefined");const r=S.default.getSkypeMri(),a=c.decode(s,r,e).children,l=this._getRawText(a);if(!l)return void p.log(u.LogTraceArea.MessageStream,"MessageTranslatorService.requestTranslation: unable to extract raw text from message");const d={type:y,auth:{provider:f,parameters:{token:_.default.getRawSkypeToken(),identity:S.default.getSkypeId()}},request:{text:l,loc:i,chatThreadId:e,oid:t}};m.default.requestTranslation(o,d)}_getRawText(e){const t=n.compact(n.map(e,(e=>{const t=e;if(t)return e instanceof g.PlainTextNode?t.getRawText?t.getRawText():this._getRawText(t.children):e instanceof g.BingResponseNode?this._getRawText(t.children):void 0})));return n.isEmpty(t)?void 0:t.join(" ")}}},146258:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(150343)),a=s(619429),l=i.__importDefault(s(404547)),d=i.__importDefault(s(304623)),c=i.__importStar(s(971988)),u=i.__importDefault(s(615364)),h=i.__importStar(s(459287)),p=s(815146),g=i.__importDefault(s(524526)),m=i.__importStar(s(85385)),S=i.__importStar(s(341994)),_=i.__importDefault(s(363091)),f=i.__importDefault(s(863132)),y=i.__importStar(s(446574));t.default=new class{constructor(){this._onAppConfigChange=()=>{const{enableMessageTranslation:e}=r.default.getS4LCMCFeatures();e&&!this._messagesProcessedToken?this._messagesProcessedToken=d.default.messagesProcessedWithBundleInfo.subscribe(this._messagesProcessed):!e&&this._messagesProcessedToken&&(this._messagesProcessedToken.unsubscribe(),this._messagesProcessedToken=void 0)},this._messagesProcessed=e=>n.all(o.map(o.filter(e,(e=>e.message.isTranslationSettings())),(e=>{if(e.messageAlreadySeen||o.includes(e.details.map((e=>e.origin)),p.MessageOrigin.LocalChange))return n.Resolved();const t=(0,u.default)().getConversation(e.message.conversationId);if(!t)return n.Resolved();const s=t.getConsumptionHorizonTimestamp();if(e.message.createdTime<=s)return n.Resolved();const i=c.getTranslationSettingsMetadata(e.message.content),r=g.default.getConversationTranslationState(e.message.conversationId)||a.TranslationState.Disabled;if(!i)return m.warn(p.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: translationSettings could not be parsed"),n.Resolved();const d=this._getNextTranslationState(i),h=d!==r,f=e.message.conversationId,y=_.default.isMyMri(e.message.creator);return this._isSettingsMessageValid(i,f,y)?l.default.setMessageTranslationLocale(f,i.messageTranslationLocale).then((()=>(d===a.TranslationState.Disabled&&S.default.deleteTranslationBannerDismissStates(f),h?l.default.setTranslationState(f,d):n.Resolved()))):n.Resolved()}))),this._getNextTranslationState=e=>{const{newTranslationState:t}=e,s=parseInt(a.TranslationState[t],10);return s===a.TranslationState.Cancelled||s===a.TranslationState.Declined?a.TranslationState.Disabled:s||a.TranslationState.Disabled},this._isSettingsMessageValid=(e,t,s)=>{const i=g.default.getConversationTranslationState(t)||a.TranslationState.Disabled,o=this._getNextTranslationState(e),n=o!==i;return m.log(p.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: currentState - "+i+", nextState - "+o+", ownMessage - "+s),!s&&(!(o===a.TranslationState.Enabled&&!e.messageTranslationLocale||!n&&i===a.TranslationState.Disabled)||(m.warn(p.LogTraceArea.ChatServiceSubscriptions,"MessageTranslatorSettingsService: failed to be Enabled - no messageTranslationLocale"),!1))},this._updateTranslationSettings=()=>{const e=g.default.getLocalCallTranslatorBotSpokenLanguageLocale();return n.all(o.map((0,u.default)().getTranslatedConversations(),(t=>{const s=g.default.getConversationTranslationState(t.id)||a.TranslationState.Disabled;if(s===a.TranslationState.Disabled)return n.Resolved();const i=h.createTranslationSettingsMessage(t.id,p.PostSource.MessagePanel,e||"",s,!0);return i?f.default.postMessage(i):m.log(p.LogTraceArea.ChatServiceSubscriptions,"_updateTranslationSettings failed to update setting for %s",t.id),n.Resolved()})))},y.RegisterStartupable(this,"MessageTranslatorSettingsService",[l.default,S.default])}startup(){return r.default.subscribe(this._onAppConfigChange),this._onAppConfigChange(),this._myUserPreferencesStoreSubscription&&S.default.unsubscribe(this._myUserPreferencesStoreSubscription),this._myUserPreferencesStoreSubscription=S.default.subscribe(this._updateTranslationSettings,S.TriggerKeys.CallTranslatorBotSpokenLanguageLocale),n.Resolved()}test_reset(){this._messagesProcessedToken&&this._messagesProcessedToken.unsubscribe(),this._myUserPreferencesStoreSubscription=void 0,this._messagesProcessedToken=void 0}}},331219:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(279211),n=i.__importDefault(s(150343)),r=s(154235),a=s(815146),l=i.__importStar(s(85385)),d=i.__importDefault(s(363091)),c=i.__importDefault(s(450312)),u=i.__importStar(s(437782)),h=i.__importDefault(s(782829)),p=i.__importStar(s(446574)),g=i.__importDefault(s(601274));t.default=new class{constructor(){this._multiTabNotificationsEnabled=!1,p.RegisterStartupable(this,"MultiTabNotificationService",[c.default,h.default])}startup(){return c.default.subscribe((()=>this._refreshActiveConversation("NavigationStateStore"))),n.default.subscribe((()=>{const e=n.default.getS4LMessagingFeatures().browserMultiTabNotifications.enabled;e!==this._multiTabNotificationsEnabled&&(this._multiTabNotificationsEnabled=e,this._refreshActiveConversation("AppConfigStore"))})),this._multiTabNotificationsEnabled=n.default.getS4LMessagingFeatures().browserMultiTabNotifications.enabled,this._refreshActiveConversation("startup"),Promise.resolve()}_refreshActiveConversation(e){if(this._activeConversationRefreshTimer&&(g.default.clearTimeout(this._activeConversationRefreshTimer),this._activeConversationRefreshTimer=void 0),this._multiTabNotificationsEnabled){const t=c.default.getActiveConversationId(r.MainRootViewId),s=n.default.getS4LMessagingFeatures().browserMultiTabNotifications;l.log(a.LogTraceArea.Notifications,"Refreshing active conversation to "+u.mriOrId(t)+", reason: "+e),o.LocalNotifications.setActiveConversation(d.default.getSkypeMri(),t,s.activeTabExpirationInterval),this._activeConversationRefreshTimer=g.default.setTimeout((()=>{this._refreshActiveConversation("Timer"),this._activeConversationRefreshTimer=void 0}),s.activeTabRefreshInterval)}}}},863132:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostMessageScenarioStep=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(264596)),r=i.__importDefault(s(212042)),a=i.__importDefault(s(819059)),l=i.__importStar(s(397691)),d=i.__importDefault(s(150343)),c=i.__importDefault(s(304623)),u=i.__importStar(s(971988)),h=i.__importStar(s(44717)),p=s(154235),g=i.__importStar(s(459287)),m=i.__importDefault(s(393921)),S=s(815146),_=i.__importDefault(s(804536)),f=i.__importDefault(s(606617)),y=i.__importDefault(s(128522)),v=i.__importStar(s(626065)),C=i.__importStar(s(85385)),T=i.__importStar(s(704704)),M=s(943610);Object.defineProperty(t,"PostMessageScenarioStep",{enumerable:!0,get:function(){return M.PostMessageScenarioStep}});const b=s(822701),I=i.__importStar(s(857962)),w=i.__importDefault(s(235972)),P=s(96575),k=i.__importStar(s(446574)),A=i.__importDefault(s(139221)),x=s(331079),D=i.__importDefault(s(404547)),R=s(100166),L=s(437782),B=i.__importDefault(s(206483)),F=S.LogTraceArea.PostingService;t.default=new class{constructor(){this.postCreated=w.default.postCreated,this.postUpdated=w.default.postUpdated,this.transferFinished=w.default.transferFinished,this.allPostsFinished=w.default.allPostsFinished,this.foregroundUploadProgress=M.foregroundUploadProgress,this.serverTranscodingProgress=M.serverTranscodingProgress,k.RegisterStartupable(this,"PostingService",[m.default,y.default,w.default])}startup(){return Promise.resolve()}setDiagnosticCallInfoCallbacks(e){this._diagnosticCallInfo=e}setDiagnosticDevicesInfoCallbacks(e){this._diagnosticDevicesInfo=e}postFeedbackStringThenAttachments(e,t,s,i,r,l,c){const u=a.default.requestMaxTime("posting:feedback"),p=k.EnsureStarted(this);_.default.startNewSession(),C.track(new I.FeedbackInititated),this._getLogCount(t,s).then((a=>{const u=h.sanitizeMri(d.default.getConfigSettingsNoSubscription().feedbackBot.id,h.Namespaces.Bot),f=A.default.getIOSModel()===S.IOSModel.iPad?"iPad":A.default.getPlatformTypeName(),y=A.default.getSkypePlatformId().toString(),C=A.default.getAppShellTypeName(),M=A.default.getAppVersion(),b=[];b.push(new v.UnhandledEntity("Sending feedback details..."));let I={};I={Platform:f+" - "+C,PlatformID:y,AppVersion:M,Attachments:a,OS:A.default.getOSVersion(),Device:A.default.getSystemModel(),ClientLanguage:T.getLocale(),BrbEnabled:d.default.getDebugabilitySquad().brb_enabled},r&&(I.Tags=r.toString());const k=n.default.getVersion();if(I.CallingVersion=k.build,I.OvbRevision=k.ovb,this._diagnosticCallInfo){const e=this._diagnosticCallInfo.getOngoingCallId();e&&(I.OngoingCallID=e);const t=this._diagnosticCallInfo.getLastCallId();t&&(I.LastCallID=t);const s=this._diagnosticCallInfo.getParticipantId(e||t);s&&(I.ParticipantId=s)}if(this._diagnosticDevicesInfo){const e=[{name:"Speakers",selectedDeviceId:e=>e.speaker,callback:e=>e.getSpeakers()},{name:"Microphones",selectedDeviceId:e=>e.microphone,callback:e=>e.getMicrophones()},{name:"Cameras",selectedDeviceId:e=>e.camera,callback:e=>e.getCameras()}],t=this._diagnosticDevicesInfo,s=this._diagnosticDevicesInfo.getSelectedDevices();o.each(e,(e=>{const i=e.callback(t),n=e.selectedDeviceId(s);I[e.name]=o.isEmpty(i)?"None":o.map(i,(e=>`${e.label}${e.id===n?" (selected)":""}`)).join(", ")}))}const x=_.default.getCurrentSessionId();x&&(I.feedbackId=x);const D=A.default.getSystemManufacturer();D&&(I.Manufacturer=D),l&&(I.Title=d.default.getConfigSettings().brb.extendReportTitle,I.ReportId=l),i&&(I.Title=(I.Title||"")+i.replace(/\n/g," ").replace(/"/g,"“")),c&&(I.ReportCategory=c),b.push(new v.ContextEntity(I));const R=g.createMessageInfo(u,S.PostSource.FeedbackString,b);return p.then((()=>m.default.createMessageInfo(R,{shouldSendLogs:t,shouldSendScreenshot:s,screenshotUri:e}).then((e=>{w.default.startPost(e,{name:P.ScenarioName.SendTextMessage})}))))})).finally((()=>{u.then((e=>a.default.release(e,"posting:feedback")))}))}_getLogCount(e,t){return(e||t)&&r.default.supportsLogs()?r.default.allRecentLogFileUris(d.default.getDebugabilitySquad().brb_logs_history_secs).then((e=>e&&e.length?1:0)):l.Resolved(0)}postMessageFromInput(e,t,s,i=u.MessageTypes.RichText,o,n,r){const a=g.createMessageInfo(e,t,s,i,n);this.postMessage(a,void 0,o,r)}postMessage(e,t,s,i,o){D.default.createThreadIfNeeded(e.conversationId,R.CSRequestScenarios.createThreadOnMessagePost).then((n=>{e.conversationId=n.threadId,this._postMessage(e,t,s,i,o)})).fail((()=>{C.error(S.LogTraceArea.Navigation,`Failed to get thread id for convId: ${(0,L.mriOrId)(e.conversationId)}`),B.default.showErrorAlert(T.getString("InfoPanel.CreateChatFailed"),p.MainRootViewId)}))}_postMessage(e,t,s,i,o){const n=a.default.requestMaxTime("posting:message");k.EnsureStarted(this).then((()=>m.default.createMessageInfo(e,{showLocalNotificationOnFailure:t}).then((e=>{w.default.startPost(e,s,i,o)})))).finally((()=>{n.then((e=>a.default.release(e,"posting:message")))}))}editMessageFromInput(e,t,s){this.postMessage(g.createEditMessageInfo(e,t,s))}deleteMessage(e,t){this.postMessage(g.createDeleteMessageInfo(e,t))}postVideoWithThumbnail(e,t,s,i,o,n,r,l,d){const c=a.default.requestMaxTime("posting:video+thumb"),u=k.EnsureStarted(this),h={isRecorded:i,copyThumbnail:!0,copyUploadMedia:n,shouldTrackUpload:!0,overlayUrl:r,properties:l};return u.then((()=>m.default.createUploadInfo(e,t,s,h).then((e=>(w.default.startPost(e,o,d),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{c.then((e=>a.default.release(e,"posting:video+thumb")))}))}postUploadAndShowFeedbackToast(e,t,s,i=!1,n,r="CapturePanel.MediaPostedFailed",l,d){const c=a.default.requestMaxTime("posting:upload+toast"),u=k.EnsureStarted(this),h=t.extension.length?t.extension:o.last(t.file.name.split(".")),p={isRecorded:i,callId:n,toastMessageToShowOnFailure:r,properties:d,shouldTrackUpload:!o.isUndefined(h)&&f.default.isImageExtension(h)};return u.then((()=>m.default.createUploadInfo(e,t,s,p).then((e=>(w.default.startPost(e,l),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{c.then((e=>a.default.release(e,"posting:upload+toast")))}))}postUpload(e,t,s,i=!1,n={},r,l){const d=a.default.requestMaxTime("posting:upload"),c=k.EnsureStarted(this),u=t.extension.length?t.extension:o.last(t.file.name.split(".")),h={isRecorded:i,callId:n.callId,properties:n.properties,shouldTrackUpload:!o.isUndefined(u)&&f.default.isImageExtension(u),durationMs:o.isNil(l)?void 0:l.messageDurationMs,toastMessageToShowOnFailure:n.toastMessageToShowOnFailure,whiteboardContainerId:n.whiteboardContainerId};return c.then((()=>m.default.createUploadInfo(e,t,s,h).then((e=>(w.default.startPost(e,n.scenarioInfo,r,l),this._correlationMessageInfo(e))),(()=>[])))).finally((()=>{d.then((e=>a.default.release(e,"posting:upload")))}))}_correlationMessageInfo(e){return o.map(e.conversationIds,(t=>({clientMessageId:e.messagesForPosting[t].clientmessageid,conversationId:t})))}canRetry(e){return!!e&&(e.kind!==b.PostUploadInfoKind||(!k.HasStarted(y.default)||o.every([e.amsFullDataCacheInfo,e.amsThumbnailCacheInfo],(e=>!e||y.default.isKnown(e.name)))))}retry(e,t){let s;if(C.log(F,"Retry "+e.kind),e.kind===b.PostUploadInfoKind){s={name:P.ScenarioName.SendFile,failedAmsDocumentId:t};const i=o.first(e.amsUploads);i&&(i.amsUploadFileType===x.UploadFileType.Video||i.amsUploadFileType===x.UploadFileType.VideoMessage?s.name=P.ScenarioName.SendVideo:[x.UploadFileType.Picture,x.UploadFileType.ImageCreatorPicture].includes(i.amsUploadFileType)&&(s.name=P.ScenarioName.SendPicture))}k.EnsureStarted(this).then((()=>w.default.startPost(e,s)))}cancelFailedPost(e){const t=e.getSendRetryInfo();if(t&&t.kind===b.PostUploadInfoKind&&k.EnsureStarted(y.default).then((()=>{t.amsFullDataCacheInfo&&y.default.abandon(t.amsFullDataCacheInfo.name),t.amsThumbnailCacheInfo&&y.default.abandon(t.amsThumbnailCacheInfo.name)})),e.isEdited()){const t=e.getSendRejectedCMID();t?c.default.revertMessageLie(e.conversationId,e.cuid,t):C.warn(S.LogTraceArea.PostingService,"Tried to revert a failed message that did not fail?",e.cuid)}else{const t=g.createDeleteMessageInfo(e,S.PostSource.CancelFailedPost),s=Object.assign(Object.assign({},t.messageForPosting),{version:e.getLatestServerMessageVersion()});c.default.applyMessageLie(e.conversationId,s)}}getPostByLocalUrl(e){return w.default.getPostByLocalUrl(e)}getLocalUrlsForPost(e){return w.default.getLocalUrlsForPost(e)}debug_allPosts(){return w.default.debug_allPosts()}debug_allPostsCleaningUp(){return w.default.debug_allPostsCleaningUp()}debug_allPostsFailedRetryInfo(){return w.default.debug_allPostsFailedRetryInfo()}test_resetBackoff(){w.default.test_resetBackoff()}test_cancelPost(e){return w.default.test_cancelPost(e)}cancelPostMessage(e,t){return w.default.cancelPostMessage(e,t)}}},785306:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(861216)),r=s(288354),a=i.__importDefault(s(404547)),l=i.__importStar(s(44717)),d=i.__importDefault(s(393921)),c=s(815146),u=i.__importStar(s(85385)),h=i.__importDefault(s(863132)),p=i.__importStar(s(857962)),g=i.__importStar(s(446574)),m=s(796967),S=s(971988),_=i.__importDefault(s(363091)),f=i.__importStar(s(964647));t.default=new class{constructor(){this._failedTransfers={},g.RegisterStartupable(this,"PostingTelemetryService",[h.default])}startup(){return h.default.transferFinished.subscribe(((e,t,s,i,r,a,d)=>{var h;const g=this._getTransferId(e,t,a),y=this._getErrorMetadata(t,i,r),v=e.instrumentation_postSource,C=e.instrumentation_conversationOrigin,T=a?l.getMriTypeForTelemetry(a):void 0,M=e.id,b=n.default.getPostingTrigger(),I=e.originalUploadFileType,w=l.getTcidFromChatServiceResponse(i.headers);let P,k,A,x;if(a&&(null===(h=e.messagesForPosting)||void 0===h?void 0:h[a])){const{clientmessageid:t,content:s,messagetype:i}=e.messagesForPosting[a];k=t,A=(0,m.getRequestId)(s),x=i,P=f.getCorrelationIdFromMessageParts(_.default.getSkypeMri(),a,k)}const D=this._getIsConversationAcceptedMetadata(t,e,a);if(D&&o.extend(y,D),s.success){if(this._failedTransfers[g]){const t=new p.PostingRecovered(e.conversationIds,v,C,e.postTime,i.statusCode,i.statusText,d,I,b,M,k,A,P,w,x,T);u.track(t),delete this._failedTransfers[g]}else if(x===S.MessageTypes.Sms){const t=new p.PostingSuccess(e.conversationIds,v,C,e.postTime,i.statusCode,i.statusText,d,I,b,M,k,A,P,w,x,T);u.track(t)}}else{u.warn(c.LogTraceArea.PostingService,"Posting failure: "+e.id+", permanent: "+s.permanentFailure+" source: "+c.PostingTransferSource[t]+", status code: "+i.statusCode+", metadata: "+JSON.stringify(y));const o=new p.PostingFailure(s.permanentFailure,e.conversationIds,v,C,e.postTime,i.statusCode,i.statusText,d,I,b,M,k,A,P,w,x,T,t,s.finishedAttemptsSoFarCount,y);u.track(o),s.permanentFailure||(this._failedTransfers[g]={transferInfo:s,response:i})}})),Promise.resolve()}_getErrorMetadata(e,t,s){switch(e){case c.PostingTransferSource.ChatService:const e=a.default.getChatServiceErrorResponseMetadata(t);return{error_code:e.errorCode,error_message:e.errorMessage,context_id:e.contextId,date:e.date};case c.PostingTransferSource.AMSCreate:case c.PostingTransferSource.AMSForward:case c.PostingTransferSource.AMSGetStatus:case c.PostingTransferSource.AMSUploadContent:case c.PostingTransferSource.AMSUploadThumbnail:case c.PostingTransferSource.URLPreview:if(!s)return;const i=r.ASMClient.getTracingHeaders(s);return{requestId:i.requestId,correlationId:i.correlationId,transactionId:i.transactionId};default:return}}_getIsConversationAcceptedMetadata(e,t,s){if(e===c.PostingTransferSource.ChatService){const e=t.conversationAcceptedInfos&&t.conversationAcceptedInfos[s],i=d.default.getConversationAcceptedInfo(s);return{conv_accepted_before:""+(e&&(e.hasConvInMemory?e.isAccepted:void 0)),conv_accepted_now:""+(i.hasConvInMemory?i.isAccepted:void 0),conv_syncing_before:""+(e&&e.isSyncingConv),conv_syncing_now:""+i.isSyncingConv,has_all_messages_before:""+(e&&e.hasAllMessages),has_all_messages_now:""+i.hasAllMessages}}}_getTransferId(e,t,s){let i=e.id+"_"+c.PostingTransferSource[t];return s&&(i+="_"+s),i}}},280468:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(446802),r=i.__importStar(s(704704)),a=s(536748),l=i.__importDefault(s(341994)),d=i.__importDefault(s(363091)),c=s(641400),u=i.__importDefault(s(150343));class h extends n.HintsProvider{constructor(){super(...arguments),this._getMessageStringToLocalize=e=>e===a.MessageHintsTypes.TapOnReactionToReactTheSame?"MessageStream.ClickToReactTheSame":e===a.MessageHintsTypes.DoubleTapMessageToLike?"MessageStream.DoubleTapMessageToLike":void 0,this._getMessageHintIcon=e=>e===a.MessageHintsTypes.TapOnReactionToReactTheSame?c.SkypeIcon.Click:e===a.MessageHintsTypes.DoubleTapMessageToLike?"yes":void 0}getHint(e){const t=this.getHintObjectType(e);if(t!==a.MessageHintsTypes.DoubleTapMessageToLike)return l.default.getMessageHintsUserData(t)}getMessageToShowHint(e,t){if(this.getHintObjectType(e)===a.MessageHintsTypes.DoubleTapMessageToLike)return;const s=this._getMessageToShowHint(e,t);return s||void 0}_getMessageToShowHint(e,t){const s=this.getHintObjectType(e),i=d.default.getSkypeMri(),n=t.getItemList().filter((e=>e instanceof a.MessageViewItemInfo&&!d.default.isMyMri(e.skypeMessage.creator)&&"Event/Call"!==e.skypeMessage.messagetype&&!e.skypeMessage.hasUserReactedOnMessage(i)));return s===a.MessageHintsTypes.DoubleTapMessageToLike?o.last(n):o.findLast(n,(e=>e.skypeMessage.hasReactions()))}updateHint(e,t,s,i){const o=u.default.getS4LMessagingFeatures().messageReactionsHintsMaxShownTimes,n=this.getHintObjectType(i),r=this._updateHintDataForMessage(e,null==s?void 0:s.skypeMessage.cuid,t,o);return t.hintMessageId!==r.hintMessageId&&l.default.setMessagesHintData(n,r),r}_updateHintDataForMessage(e,t,s,i){if(s.wasFeatureUsedByUser)return s;const o=Date.now(),n=Object.assign({},s);void 0!==n.hintMessageId&&void 0!==n.hintConversationId||(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o);const r=o-(void 0!==n.hintLastShownTime?n.hintLastShownTime:o)>864e5;return n.hintWasShownTimes>=i?(n.wasFeatureUsedByUser=!0,n):(r&&(n.hintMessageId=t,n.hintConversationId=e,n.hintLastShownTime=o,n.hintWasShownTimes++),n)}getMessageHintDataToDisplay(e){if(e===a.MessageHintsTypes.DoubleTapMessageToLike)return;const t=e&&this._getMessageStringToLocalize(e);if(e&&t){return{icon:this._getMessageHintIcon(e),hintMessage:r.getString(t)}}}getHintObjectType(e){return e?a.MessageHintsTypes.DoubleTapMessageToLike:a.MessageHintsTypes.TapOnReactionToReactTheSame}}t.default=new h},503149:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(150343)),n=s(434343),r=s(154235),a=s(815146),l=i.__importStar(s(85385)),d=i.__importDefault(s(652032)),c=s(196761),u=i.__importDefault(s(341994)),h=i.__importDefault(s(683395)),p=i.__importDefault(s(740794)),g=i.__importDefault(s(450312)),m=i.__importStar(s(446574)),S=s(15752);t.default=new class{constructor(){this._isOptingIn=!1,this._appConfigChanged=()=>{const e=o.default.getS4LMessagingFeatures().enableReadReceipts;this._readReceiptsPreviouslyEnabled!==e&&(this._readReceiptsPreviouslyEnabled=e,this._shouldOptInForReadReceipts()?(l.log(a.LogTraceArea.ReadReceipts,"[AppConfigChanged]We should opt in based on local data. Refresh user props and check again"),this._isOptingIn=!0,u.default.fetchAndUpdateProperties(!0).always((()=>{const e=this._shouldOptInForReadReceipts();if(l.log(a.LogTraceArea.ReadReceipts,"[AppConfigChanged]User props refreshed, shouldOptIn="+e),e){const e=h.default.getStatus()!==S.UserStatus.Hidden;u.default.setReadReceiptsEnabled(e,c.ReadReceiptsSettingOrigin.OptIn)}this._isOptingIn=!1}))):this._shouldOptOutFromReadReceipts()?(l.log(a.LogTraceArea.ReadReceipts,"[AppConfigChanged]We should opt out based on local data. Refresh user props and check again"),u.default.fetchAndUpdateProperties(!0).always((()=>{const e=this._shouldOptOutFromReadReceipts();l.log(a.LogTraceArea.ReadReceipts,"[AppConfigChanged]User props refreshed, shouldOptOut="+e),e&&(u.default.setReadReceiptsEnabled(!1,c.ReadReceiptsSettingOrigin.OptOut),this._fetchMemberConsumptionHorizon())}))):l.log(a.LogTraceArea.ReadReceipts,"[AppConfigChanged]No opt in or opt out needed"))},this._userPresenceChanged=()=>{if(this._isOptingIn||!o.default.getS4LMessagingFeatures().enableReadReceipts||!u.default.getUserPreferenceForReadReceipts())return void l.log(a.LogTraceArea.ReadReceipts,"[UserPresenceChanged]Bailing out, isOptingIn="+this._isOptingIn+";ecsEnableReadReceipts"+o.default.getS4LMessagingFeatures().enableReadReceipts+";userPreferenceForReadReceipts="+u.default.getUserPreferenceForReadReceipts());const e=h.default.getStatus()===S.UserStatus.Hidden,t=u.default.getReadReceiptsEnabled();e&&t?(u.default.setReadReceiptsEnabled(!1,c.ReadReceiptsSettingOrigin.UserStatusUpdate),this._fetchMemberConsumptionHorizon()):e||t||u.default.setReadReceiptsEnabled(!0,c.ReadReceiptsSettingOrigin.UserStatusUpdate)},m.RegisterStartupable(this,"ReadReceiptsStateService",[d.default,u.default,h.default,g.default])}startup(){const e=d.default.getData(n.InternalKeys.EcsConfig);return e&&e.config&&e.config.S4L_Messaging&&(this._readReceiptsPreviouslyEnabled=e.config.S4L_Messaging.enableReadReceipts),o.default.subscribe(this._appConfigChanged),h.default.subscribe(this._userPresenceChanged),this._appConfigChanged(),this._userPresenceChanged(),Promise.resolve()}_fetchMemberConsumptionHorizon(){const e=g.default.getActiveConversationId(r.MainRootViewId);e&&p.default.fetchMemberConsumptionHorizon(e)}_shouldOptInForReadReceipts(){const e=u.default.getReadReceiptsEnabled(),t=u.default.getUserPreferenceForReadReceipts();return o.default.getS4LMessagingFeatures().enableReadReceipts&&!e&&t}_shouldOptOutFromReadReceipts(){const e=u.default.getReadReceiptsEnabled();return!o.default.getS4LMessagingFeatures().enableReadReceipts&&e}}},684552:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentsFilterStore=function(){if(!n){const e=(0,i.getHeaderUXStore)();n=new o.RecentsFilterStore(e.arePillsAvailableNoSubscription())}return n};const i=s(318315),o=s(241876);let n},72605:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importDefault(s(941259)),n=(i.__importStar(s(516778)),i.__importStar(s(397691))),r=(i.__importDefault(s(659938)),i.__importDefault(s(150343))),a=i.__importStar(s(44717)),l=i.__importDefault(s(734468)),d=i.__importDefault(s(493129)),c=i.__importDefault(s(393921)),u=i.__importDefault(s(119999)),h=i.__importDefault(s(601976)),p=s(815146),g=i.__importDefault(s(61784)),m=i.__importDefault(s(606617)),S=i.__importStar(s(85385)),_=i.__importStar(s(704704)),f=i.__importDefault(s(510335)),y=(i.__importDefault(s(363091)),i.__importDefault(s(740794))),v=i.__importDefault(s(657764)),C=i.__importStar(s(887117)),T=i.__importDefault(s(110895)),M=s(928722),b=i.__importStar(s(446574)),I=i.__importDefault(s(760989)),w="file://";t.default=new class{constructor(){this._processShareEvent=e=>{const t=I.default.newCauseId();S.log(p.LogTraceArea.ShareToSkype,"Processing event with type: "+e.type+" causeId:"+t),S.track(new C.default({action:C.ShareToSkypeEventActions.started,event:e}));const s=T.default.processShareEvent(e,w);s&&this._navigateToSharePanel(((s,i)=>{T.default.postSharedMessage(e,s,t)}),s,((t,s)=>{this._onShareCompleteReportTelemetryAndNavigateIfNeeded(e,t,s)}))},this._onShareCompleteReportTelemetryAndNavigateIfNeeded=(e,t,s)=>{if(this._reportSharedTelemetryEvent(e,t,s),1===t.length){const e=t[0];if(!a.isHighlightsThread(e)){const t=I.default.newCauseId();S.log(p.LogTraceArea.Navigation,"ShareToSkypeService._reportTelemetryAndNavigateIfNeeded, causeId: "+t),y.default.navigateToConversation({convId:e,origin:p.NavigationConversationOrigin.ShareToSkype,causeId:t})}}},b.RegisterStartupable(this,"ShareToSkypeService",[l.default,h.default]),f.default.registerForLogout(this,"ShareToSkypeService")}startup(){return o.default.setListener(this._processShareEvent,this._fileSizeLimit),Promise.resolve()}setMaximumFileSizeLimitInBytes(e){this._fileSizeLimit=e}_exposeDirectShareShortcuts(){void 0===this._searchStore&&(this._searchStore=new v.default,this._searchStore.updateConfig({rawQuery:"",trimmedNormalizedQuery:"",excludeBots:!0,excludePstn:!0,onlyGroupCapable:!1,onlyCallCapable:!1,excludeShortCircuitMatches:!0},[p.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations]));const e=this._searchStore.getSuggestedContactsAndConversationsResults(p.SearchResultsListGroup.SuggestedRecentConversationsWithEstablishedPrivateConversations);if(e){const t=e.map((e=>{const t=h.default.getDisplayableProfile(e);return t&&t.getDisplayName()?{mri:e,displayName:t.getDisplayName(),isGroup:t instanceof d.default,avatarUrl:t.getAvatarUrl(),initials:t.getInitials(),color:l.default.getPrimaryColor(e)}:void 0})).filter((e=>e));o.default.exposeDirectShareShortcuts(t)}}_processDirectShareEvent(e,t){u.default.performShareNavigationAction(e,w,t)}_navigateToSharePanel(e,t,s){const i=I.default.newCauseId();S.log(p.LogTraceArea.Navigation,"ShareToSkypeService._navigateToSharePanel, causeId: "+i),t.multipleMessagesParameters||(t.multipleMessagesParameters=[]),t.multipleMessagesParameters.length||t.multipleMessagesParameters.push({}),t.multipleMessagesParameters[0].onShareCompleteForMessage=e,y.default.navigateToSelectConversationsForSharingOrScheduleNavigationOnLaunch({isExternalShare:!0,navigationDirection:M.StackNavigationDirection.Present,onShareComplete:s,shareMessageTitle:_.getString("ShareWithPanel.ShareToSkypeHeader"),accessibilityLabelTitle:_.getString("ShareWithPanel.ShareToSkypeAccessibilityHeader"),multipleMessagesParameters:t.multipleMessagesParameters,sharePreviewType:t.sharePreviewType,enableMediaPreview:!0,causeId:i,entryPoint:p.SharePanelEntryOrigin.External,directShareMri:t.directShareMri})}_reportSharedTelemetryEvent(e,t,s){S.track(new C.default({action:C.ShareToSkypeEventActions.completed,event:e,conversationsCount:t.length,messageAdded:s}))}logout(e,t,s){return o.default.removeListener(),n.Resolved()}_shareElectronFile(e){const t=I.default.newCauseId();S.error(p.LogTraceArea.Navigation,"ShareToSkypeService._onShareFile, eventId: "+t);let s=!0;if(e.data){const t=r.default.getS4LMessagingFeaturesNoSubscription().limitForFilePicker;if(e.data.length>t)return window.electronApi.ipcProvider.dialog.showMessageBox.send({title:_.getString("ShareWithPanel.ShareWithHeader"),content:_.getString("FilePicker.LimitExceededContent",{value:t}),type:"warning"}),void S.track(new C.default({action:C.ShareToSkypeEventActions.cancelledFileCountLimit,event:e}));for(const t of e.data){const i=m.default.extractFileNameWithExtension(t.name),o=m.default.extractFileExtension(i),n=c.default.determineUploadFileType({extension:o,file:{uri:t.uri,size:t.size,name:t.name,type:""}},!1),r=g.default.getMaximumFileSizeForType(n);if(t.size>r){s=!1;const t=_.getString("Global.FileTooBigContent",{maxSizeFormatted:g.default.formatFileSize(r,0).formattedString});window.electronApi.ipcProvider.dialog.showMessageBox.send({title:_.getString("ShareWithPanel.ShareWithHeader"),content:t,type:"warning"}),S.track(new C.default({action:C.ShareToSkypeEventActions.cancelledFileSizeLimit,event:e}));break}}}s&&o.default.open(e,_.getString("ShareWithPanel.ShareWithHeader"))}}},612753:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(397691)),r=i.__importDefault(s(150343)),a=s(815146),l=i.__importStar(s(85385)),d=i.__importDefault(s(363091)),c=i.__importStar(s(334318));c.default.setThrottled((()=>r.default.getS4LFeatures().scheduler.enableSmsPriceThrottling));t.default=class{static getSmsPrice(e){const t=d.default.getSkypeId();return t?c.default.getPrice(e,t).then((t=>{const s=this._handleAPIReturn(t,e);return l.log(a.LogTraceArea.SMSClient,"Successfully got price for SMS. Returning: "+JSON.stringify(s)),s})).catch((e=>(l.log(a.LogTraceArea.SMSClient,"Getting price for SMS failed. Returning: "+JSON.stringify(e)),{rate:void 0,currency:void 0,failureReason:c.FailureReason.Other}))):n.Rejected("Unable to get User ID")}static _handleAPIReturn(e,t){return l.log(a.LogTraceArea.SMSClient,"Handled SMS Rate from new API"),{rate:o.isEmpty(e)?void 0:e[0].price,currency:o.isEmpty(e)?void 0:e[0].currency,failureReason:o.isEmpty(e)?c.FailureReason.Other:this._mapFailureReasons(e[0].status),fullRateInfo:o.isEmpty(e)?void 0:e[0]}}static _mapFailureReasons(e){switch(e){case 200:return;case 407:case 405:return c.FailureReason.InsufficientFunds;default:return c.FailureReason.Other}}}},160049:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SmsFlowId=void 0;const i=s(197582),o=s(815146),n=i.__importStar(s(85385)),r=i.__importStar(s(437782));var a;!function(e){e.Default="skype.S4L.client.sms.1way",e.Contacts="skype.S4L.client.sms.1way.contacts",e.CallList="skype.S4L.client.sms.1way.callList",e.UserProfile="skype.S4L.client.sms.1way.userProfile",e.Dialer="skype.S4L.client.sms.1way.pstnDialer",e.QuickCallPanelCallingOptions="skype.S4L.client.sms.1way.quickCallPanelCallingOptions",e.NewSms="skype.S4L.client.sms.1way.newSms",e.SmsMediaItem="skype.S4L.client.sms.1way.smsMediaItem"}(a||(t.SmsFlowId=a={}));t.default=new class{constructor(){this.setDefault()}setNextFlowId(e){this._nextFlowId=e,n.log(o.LogTraceArea.SkypeSmsFlowIdStore,"Setting NEXT Flow ID to "+e)}commitNextFlowId(){n.log(o.LogTraceArea.SkypeSmsFlowIdStore,"Committing flow id "+r.dev_unknownOmit(this._nextFlowId)),this._nextFlowId&&(this.setFlowId(this._nextFlowId),this.clearNextFlowId())}clearNextFlowId(){n.log(o.LogTraceArea.SkypeSmsFlowIdStore,"Clearing next flow id"),this._nextFlowId=void 0}setFlowId(e){n.log(o.LogTraceArea.SkypeSmsFlowIdStore,"Setting flow ID to "+e),this._currentFlowId=e}getFlowId(){return n.log(o.LogTraceArea.SkypeSmsFlowIdStore,"RETURNING FLOW ID "+this._currentFlowId),this._currentFlowId}setDefault(){this.setFlowId(a.Default)}test_dontCallThis_getNextFlowId(){return this._nextFlowId}}},295939:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentsFilterStore=t.mergeConversations=void 0;s(197582).__exportStar(s(257603),t);var i=s(557997);Object.defineProperty(t,"mergeConversations",{enumerable:!0,get:function(){return i.mergeConversations}});var o=s(684552);Object.defineProperty(t,"getRecentsFilterStore",{enumerable:!0,get:function(){return o.getRecentsFilterStore}})},393921:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importStar(s(397691)),a=i.__importDefault(s(206483)),l=i.__importDefault(s(150343)),d=i.__importStar(s(987364)),c=i.__importStar(s(971988)),u=i.__importDefault(s(556587)),h=i.__importStar(s(44717)),p=s(154235),g=i.__importDefault(s(555436)),m=i.__importDefault(s(615364)),S=i.__importStar(s(459287)),_=i.__importStar(s(242561)),f=s(815146),y=i.__importDefault(s(61784)),v=i.__importDefault(s(606617)),C=i.__importDefault(s(128522)),T=s(49463),M=i.__importStar(s(626065)),b=i.__importStar(s(7040)),I=i.__importStar(s(85385)),w=i.__importStar(s(704704)),P=s(345500),k=i.__importDefault(s(503411)),A=i.__importDefault(s(450312)),x=s(822701),D=i.__importDefault(s(668301)),R=i.__importStar(s(118837)),L=i.__importStar(s(446574)),B=i.__importDefault(s(655192)),F=s(331079),N=s(845270),E=i.__importDefault(s(220534)),O=i.__importDefault(s(760989)),U=i.__importStar(s(340482)),V=i.__importDefault(s(282650)),H=s(606933),j=s(123117),z=f.LogTraceArea.PostingService;t.default=new class{constructor(){L.RegisterStartupable(this,"CreatePostInfoUtils",[C.default,D.default])}startup(){return Promise.resolve()}createMessageInfo(e,t={}){let s;e.inputEntities&&D.default.registerEntities(e.inputEntities);const i={},a={};let d=0;const u=c.getMessageTypeGroup(e.messageForPosting),p=e.conversationId;if(u===c.MessageTypeGroups.Text&&e.inputEntities&&!h.isEncryptedThread(p)){const t=n.flatMap(b.handleLinks(e.inputEntities),(e=>e instanceof M.HtmlEntity?e.extractLinks().map((e=>new M.LinkEntity("",O.default.unescapeXml(e)))):e));if(t&&t.length>0){const o=e.previousMessageBeingEditedProperties?e.previousMessageBeingEditedProperties:void 0;s=c.getJsonFromMessageProperty(o,c.MessageProperties.UrlPreviews),n.each(t,(e=>{if(e instanceof M.LinkEntity){const t=e.computeType();if(n.isNumber(t)&&t===N.UrlType.Web){const t=e.href;a[t]=!0,s&&n.some(s,(e=>e.key===t))||(i[t]=t)}}}))}d=b.getRawText(e.inputEntities).length}let g=n.values(i);const m=l.default.getConfigSettingsNoSubscription().urlPreview.maxPreviewsPerMessage;if(!n.isUndefined(m)){const e=m-(s?s.length:0);g.length>e&&(I.log(z,"Limiting URL previews to fetch to "+e),g=n.take(g,e))}g.length&&I.log(z,"Adding urls to the queue of URL previews: "+o.pii.Omit(g.join(", "))),u===c.MessageTypeGroups.SMS&&e.inputEntities&&(d=b.getRawText(e.inputEntities).length);return(e.editedMessageCuid?r.fromThenable(j.MessagesRepository.getMessageByCuid(p,e.editedMessageCuid)):r.Resolved(void 0)).then((i=>{var r;const l=!!s;let u;if(i&&s){const e=n.remove(s,(e=>!(e.key in a)));u=s.length?JSON.stringify(s):void 0,e.length>0&&I.log(z,"Message edit: removing unecessary urlpreviews: "+o.pii.Omit(u||""))}let m,S=e.messageForPosting;if(n.isEmpty(e.forwardMediaInfos))if(i)(g.length||u||l)&&(m={messageId:i.getServerIdForPropertyChanges(),urlPreviewJson:u});else if(u||e.isForward){const t=n.cloneDeep(S);if(t.properties=t.properties||{},u&&(t.properties[c.MessageProperties.UrlPreviews]=u),e.isForward){const e={isForwarded:!0};t.properties[c.MessageProperties.ForwardMetadata]=JSON.stringify(e)}S=t}const _=n.find(e.inputEntities,(e=>e instanceof M.QuoteEntity)),f=_&&_.quoteNode&&_.quoteNode.author&&h.skypeIdToMri(_.quoteNode.author),y=_&&_.quotesTriggerType,v=_&&_.quotedMessage?U.getMessageTypeName(_.quotedMessage):void 0,C=null===(r=null==_?void 0:_.quoteNode.children.find((e=>e instanceof H.RootNode)))||void 0===r?void 0:r.children.map((e=>null==e?void 0:e.encode())).join(),T=!!e.isForward;return{kind:x.PostMessageInfoKind,editedMessageCuid:e.editedMessageCuid,conversationId:p,postSource:e.postSource,conversationOrigin:e.conversationOrigin,messageForPosting:S,urlPreviewPropSet:m,forwardMediaInfos:e.forwardMediaInfos,swiftMessageDecoded:e.swiftMessageDecoded,urlPreviewEndpoints:g,rawContentLength:d,quoteAuthor:f,quotesTriggerType:y,quotesMessageType:v,quotesRawMessageContent:C,isForward:T,showLocalNotificationOnFailure:t.showLocalNotificationOnFailure,shouldSendLogs:t.shouldSendLogs,shouldSendScreenshot:t.shouldSendScreenshot,screenshotUri:t.screenshotUri,conversationAcceptedInfo:this.getConversationAcceptedInfo(p),isDelete:!!e.isDelete,editedMessageServerId:e.editedMessageServerId,editedMessageVersion:e.editedMessageVersion}}))}createUploadInfo(e,t,s,i={}){return this.createUploadAndTextInfo(e,[{data:t,overlayUrl:i.overlayUrl}],s,i)}createUploadAndTextInfo(e,t,s,i={}){n.defaults(i,{copyUploadMedia:!0,copyThumbnail:!0});let a=!1;if(e.length&&n.some(e,(e=>h.isEncryptedThread(e)))){if(1!==e.length){const e="Encrypted files can be sent only to one thread at a time";return I.warn(z,e),this.alertOneThreadOnly(),r.Rejected(e)}a=!0}const d=[];let c=[];const u=[];return n.reduce(t,((e,t)=>e.then((()=>{if(n.isString(t))return c.push(t),void u.push(new M.UnhandledEntity(t));const{data:e,overlayUrl:h}=t;let p=this.determineUploadFileType(e,a,i),g=e.thumbnail;if(v.default.isThumbnailSupportedFileType(p)||(g=void 0),!this.canUploadFile(e.file.size)){const t="Ignoring upload of empty file: "+o.pii.Omit(e.file.name);return I.warn(z,t),r.Rejected(t)}const m=V.default.shouldReencodeUpload(p,i.overlayUrl),S=m&&l.default.getS4LCMCFeaturesNoSubscription().disableCopyingOriginalVideoToCache;if(n.isNumber(e.file.size)&&!m){const t=y.default.getMaximumFileSizeForType(p);if(e.file.size>t){this.alertSizeTooBig(t,e.file.size,s,p);const i=`File is too large to upload: ${p} ${e.file.size} bytes`;return r.Rejected(i)}}const _=i.filename||e.file.name;let f,b,w,P;if(!S&&C.default.isLocalCacheSupported()){const t=this.generateLocalCacheName(e,p,_);f={name:t,asCopy:i.copyUploadMedia},b=T.FileUploadCacheUtils.getLocalCacheUri(t)}else b=E.default.getFileUrl(e);if(g)if(C.default.isLocalCacheSupported()){const e=this.generateLocalCacheName(g,F.UploadFileType.Thumbnail);w={name:e,asCopy:i.copyThumbnail},P=T.FileUploadCacheUtils.getLocalCacheUri(e)}else P=E.default.getFileUrl(g);return(S?r.Resolved():C.default.saveFileIfSupported(e,f)).then((()=>{let t=e.file.size;if(!n.isNumber(t)&&f){const o=C.default.getSize(f.name);if(n.isNumber(o)){t=o,p=this.determineUploadFileType(e,a,i,o);const n=y.default.getMaximumFileSizeForType(p);if(o>n&&!V.default.shouldReencodeUpload(p,i.overlayUrl)){this.alertSizeTooBig(n,t,s,p);const e=`File is too large to upload: ${p} ${n} bytes`;return r.Rejected(e)}}}v.default.isThumbnailSupportedFileType(p)||(g=void 0);const o=P||b,l=this.getMediaEntity(b,o,o,void 0,p,i.title,_,t,e.dimensions,void 0,i.durationMs,i.whiteboardContainerId);return u.push(l),c.push(d.length),d.push({amsUploadFullData:e,amsFullDataCacheInfo:f,amsFullDataLocalUrl:b,amsUploadFilename:_,amsUploadThumbnailData:g,amsThumbnailCacheInfo:w,amsThumbnailLocalUrl:P,amsUploadFileType:p,videoOverlayUrl:h,audioDurationMs:i.durationMs}),C.default.saveFileIfSupported(g,w)}))}))),r.Resolved()).then((()=>{n.some(c,n.isString)||(c=void 0);const o=d[0]?d[0].amsUploadFileType:void 0,r=this.determineChatMessageType(t,i,o);i.callId&&u.push(new M.CallReactionMetadataEntity(i.callId));const a={};n.each(e,(e=>{const t=S.createMessageInfo(e,s,u,r,i.properties,!!c);a[e]=t.messageForPosting}));return{kind:x.PostUploadInfoKind,conversationIds:e,amsUploads:d,textWithUploadIndexes:c,messagesForPosting:a,callId:i.callId,title:i.title,uploadSource:s,conversationOrigin:A.default.dangerouslyGetActiveConversationContextOrigin(p.MainRootViewId),toastMessageToShowOnSuccess:i.toastMessageToShowOnSuccess,toastMessageToShowOnFailure:i.toastMessageToShowOnFailure,shouldTrackUpload:i.shouldTrackUpload,conversationAcceptedInfos:n.mapValues(a,((e,t)=>this.getConversationAcceptedInfo(t)))}})).catch((t=>{if(I.warn(z,'Failed to start upload: ConvIds: "'+n.map(e,(e=>o.pii.Mri(e))).join(", ")+'", error: '+B.default.errorAsString(t)),n.each(d,(e=>{const{amsFullDataCacheInfo:t,amsThumbnailCacheInfo:s}=e;t&&C.default.abandon(t.name),s&&C.default.abandon(s.name)})),i.toastMessageToShowOnFailure){const e=w.getString(i.toastMessageToShowOnFailure);k.default.scheduleTextMessage(e,void 0,p.MainRootViewId)}return r.Rejected()}))}canUploadFile(e){return void 0===e||e>0}determineChatMessageType(e,t,s){if(e.length>1)return c.MessageTypes.RichText;if(t.title)switch(s){case F.UploadFileType.Picture:case F.UploadFileType.ImageCreatorPicture:return c.MessageTypes.Media_Card}if(!s)return c.MessageTypes.Text;switch(s){case F.UploadFileType.Picture:case F.UploadFileType.ImageCreatorPicture:return c.MessageTypes.UriObject;case F.UploadFileType.Video:return c.MessageTypes.Media_Video;case F.UploadFileType.VideoMessage:return c.MessageTypes.VideoMessage;case F.UploadFileType.Audio:case F.UploadFileType.AudioMessage:return c.MessageTypes.AudioMessage;case F.UploadFileType.Thumbnail:case F.UploadFileType.GroupAvatar:case F.UploadFileType.Excel:case F.UploadFileType.OneNote:case F.UploadFileType.Powerpoint:case F.UploadFileType.Word:case F.UploadFileType.PDF:case F.UploadFileType.File:case F.UploadFileType.AVI:case F.UploadFileType.Zip:return c.MessageTypes.Media_GenericFile;default:return O.default.switchStatementExhaustiveChecking(s)}}determineUploadFileType(e,t,s={},i){if(t)return F.UploadFileType.File;let o=F.UploadFileType.File;if(v.default.isImageExtension(e.extension)){if(e.dimensions){o=F.UploadFileType.Picture,e.originator===f.PostSource.ImageCreator&&(o=F.UploadFileType.ImageCreatorPicture);const t=y.default.getMaximumLimitsForType(o);t&&t.width&&t.height&&(e.dimensions.width>t.width||e.dimensions.height>t.height)&&(o=F.UploadFileType.File)}}else v.default.isVideoExtension(e.extension)?(this.isAmsVideoMessageExtension(e.extension)&&s.isRecorded?o=F.UploadFileType.VideoMessage:this.isAmsVideoExtension(e.extension)&&(o=F.UploadFileType.Video),e.thumbnail||(o=F.UploadFileType.File)):v.default.isAudioExtension(e.extension)&&(s.isRecorded?o=F.UploadFileType.AudioMessage:this.isAmsAudioExtension(e.extension)&&(o=F.UploadFileType.Audio));const{enableMediaFileRedesign:r}=l.default.getS4LMessagingFeaturesNoSubscription();r&&(v.default.isPDFExtension(e.extension)?o=F.UploadFileType.PDF:v.default.isWordExtension(e.extension)?o=F.UploadFileType.Word:v.default.isExcelExtension(e.extension)?o=F.UploadFileType.Excel:v.default.isPowerPointExtension(e.extension)?o=F.UploadFileType.Powerpoint:v.default.isAVIExtension(e.extension)&&(o=F.UploadFileType.AVI));const a=n.isNumber(e.file.size)?e.file.size:i;if(n.isNumber(a)&&o!==F.UploadFileType.File){if(l.default.getAsyncMediaFeatures().fallback_to_file){a>y.default.getMaximumFileSizeForType(o)&&(o=F.UploadFileType.File)}}return o}isAmsVideoExtension(e){const t=l.default.getAsyncMediaFeatures().storage_limits.video.format;return n.includes(t,e.toLowerCase())}isAmsVideoMessageExtension(e){return n.includes(["mp4","webm"],e.toLowerCase())}isAmsAudioExtension(e){const t=l.default.getAsyncMediaFeatures().storage_limits,s=t.audio?t.audio.format:[];return n.includes(s,e.toLowerCase())}alertSizeTooBig(e,t,s,i,o=!1){const r=[{text:w.getString("Global.OkLabel"),isCancel:!0,onPress:n.noop}],l=w.getString("Global.FileTooBigContent",{maxSizeFormatted:y.default.formatFileSize(e,0).formattedString});a.default.showWithOptions({title:w.getString("Global.FileTooBig"),dialogAccessibilityTitle:l,message:l,buttons:r,rootViewId:p.MainRootViewId,useFocussedWindowFallback:!0});const d=new P.FileRejectedByClient(i,s,P.FileRejectedReason.FileSize);d.setFileSizeDetails(e,t),d.setIsRejectedFromPost(o),I.track(d)}alertOneThreadOnly(){const e=[{text:w.getString("Global.OkLabel"),isCancel:!0,onPress:n.noop}],t=w.getString("Global.OneThreadATimeContent");a.default.showWithOptions({title:w.getString("Global.OneThreadATime"),dialogAccessibilityTitle:t,message:t,buttons:e,rootViewId:p.MainRootViewId,useFocussedWindowFallback:!0})}getMediaEntity(e,t,s,i,o,n,r,a,l,d,c,u){let h;if(n){const t=this._getSwiftPictureMessage(e,n,d);h=new M.SwiftUriObjectEntity(t,void 0,!0,n)}else h=new M.MediaEntity(e,t,s,i,o,r,a,l,d,c,u);return h}_getSwiftPictureMessage(e,t,s){s||(s=d.getDocumentId(e));const i={images:[{url:s?d.getDisplayUrl(s,F.UploadFileType.Picture,F.MediaViewSize.MobilePreview):"",tap:{type:_.SwiftActionTypes.showImage}}],title:t},o={contentType:_.SwiftContentTypes.hero,content:i};return{type:_.SwiftMessageTypes.card,attachments:[o]}}generateLocalCacheName(e,t,s){let i=s?v.default.extractFileExtension(s):e.extension||v.default.extractFileExtension(e.file.name);if(!i)switch(t){case F.UploadFileType.File:case F.UploadFileType.Excel:case F.UploadFileType.OneNote:case F.UploadFileType.Powerpoint:case F.UploadFileType.Word:case F.UploadFileType.PDF:i="";break;case F.UploadFileType.Picture:case F.UploadFileType.ImageCreatorPicture:case F.UploadFileType.Thumbnail:case F.UploadFileType.GroupAvatar:i="jpeg";break;case F.UploadFileType.Video:i="mp4";break;case F.UploadFileType.VideoMessage:i="webm";break;case F.UploadFileType.AVI:i="avi";break;case F.UploadFileType.Audio:case F.UploadFileType.AudioMessage:i="mp3"}const o=O.default.newGuid()+(i?"."+i:"");return R.lossyForUserFile(o)}getConversationAcceptedInfo(e){return{hasConvInMemory:!!(0,m.default)().getConversation(e),isAccepted:g.default.isConversationAccepted(e),isSyncingConv:u.default.isSyncingMessagesForConversation(e),hasAllMessages:u.default.haveAllMessagesForConversation(e)}}}},943610:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_CheckForUpdate=t.CheckForNeededWorkResult=t.PostMessageScenarioStep=t.TransferTypeToPostingTransferSource=t.ChatPostActionNames=t.AllForegroundTransferTypes=t.AllBackgroundTransferTypes=t.feedbackGathered=t.pokePost=t.serverTranscodingProgress=t.foregroundUploadProgress=t.foregroundResponse=t.Post=t.TranscodingState=t.EncryptionState=void 0,t.postIdFromContext=function(e){return n.isString(e)?e:e.postId},t.test_setForegroundPostEnabled=function(e){dt=e};const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=s(426433),a=i.__importDefault(s(212042)),l=s(279211),d=i.__importStar(s(775463)),c=i.__importStar(s(516778)),u=s(168409),h=s(662783),p=i.__importDefault(s(974634)),g=i.__importStar(s(397691)),m=i.__importDefault(s(861216)),S=i.__importDefault(s(150343)),_=s(288354),f=i.__importDefault(s(957867)),y=i.__importStar(s(987364)),v=i.__importDefault(s(782649)),C=i.__importDefault(s(532803)),T=i.__importDefault(s(404547)),M=i.__importStar(s(964647)),b=i.__importDefault(s(304623)),I=i.__importStar(s(971988)),w=i.__importStar(s(100166)),P=s(627414),k=i.__importStar(s(44717)),A=s(154235),x=i.__importStar(s(487110)),D=i.__importDefault(s(393921)),R=i.__importStar(s(766698)),L=i.__importDefault(s(727433)),B=i.__importDefault(s(109367)),F=s(94618),N=i.__importDefault(s(379878)),E=i.__importStar(s(841460)),O=s(815146),U=i.__importDefault(s(804536)),V=i.__importDefault(s(61784)),H=i.__importDefault(s(606617)),j=(i.__importDefault(s(128522)),s(49463)),z=i.__importStar(s(626065)),W=i.__importStar(s(7040)),G=i.__importStar(s(85385)),K=i.__importStar(s(216030)),q=i.__importStar(s(704704)),Q=s(345500),X=s(786531),$=i.__importDefault(s(531904)),J=s(480327),Y=i.__importDefault(s(503411)),Z=i.__importDefault(s(363091)),ee=s(96575),te=i.__importDefault(s(506082)),se=i.__importDefault(s(782829)),ie=i.__importDefault(s(902530)),oe=i.__importDefault(s(655192)),ne=i.__importDefault(s(139221)),re=s(331079),ae=i.__importStar(s(340482)),le=i.__importDefault(s(535775)),de=i.__importDefault(s(848267)),ce=i.__importDefault(s(229634)),ue=i.__importStar(s(553397)),he=i.__importDefault(s(220534)),pe=i.__importDefault(s(760989)),ge=i.__importStar(s(657705)),me=i.__importDefault(s(282650)),Se=i.__importDefault(s(163374)),_e=s(606933),fe=(i.__importStar(s(265847)),i.__importDefault(s(634376))),ye=(i.__importDefault(s(389659)),s(123117)),ve=s(55544),Ce=i.__importDefault(s(615364)),Te=O.LogTraceArea.PostingService,Me={priority:h.WebRequestPriority.High,timeout:6e4},be={priority:h.WebRequestPriority.High,timeout:3e4},Ie={priority:h.WebRequestPriority.High,progressTimeout:6e4,timeout:0};var we,Pe;!function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(we||(t.EncryptionState=we={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Failure=4]="Failure"}(Pe||(t.TranscodingState=Pe={}));let ke="";class Ae{constructor(e,t,s){if(this.findAnythingBlockingPost=s,this.persisted=e,this.persisted.scenarioInfo&&n.size(e.amsUploads)<=1){const s=e.amsUploads&&e.amsUploads[0];this.telemetryScenarios=n.mapValues(this.persisted.messagesForPosting,((i,o)=>{const r=k.getCuidForMessage(i),a=M.getCorrelationIdFromMessageParts(Z.default.getSkypeMri(),o,i.clientmessageid);let l=this.persisted.scenarioInfo.name;const d={};if(d.message_cuid=r,d.message_correlationId=a,d.message_type=ae.getMessageTypeName(i,Z.default.getSkypeMri(),o),d.message_rawtype=ae.getMessageRawTypeName(i,Z.default.getSkypeMri(),o),d.transaction_id=e.transactionId||"",s){if(s.amsUploadFullData.file&&(d.size=V.default.getAmsUploadFileSize(s)||0),s.amsUploadFullData.dimensions&&(d.width=s.amsUploadFullData.dimensions.width,d.height=s.amsUploadFullData.dimensions.height),d.extension=de.default.changeExtensionForTelemetry(s.amsUploadFullData.extension),s.amsUploadFullData.isAlbumItem){const{albumItemCount:e,albumTotalSize:t,albumId:i,albumType:o}=s.amsUploadFullData;i!==ke&&(ke=i,l=ee.ScenarioName.SendMediaAlbum,d.album_size=t||0,d.album_item_count=e,d.album_type=o,d.album_id=i)}d.album_item=!!s.amsUploadFullData.isAlbumItem}this.persisted.scenarioInfo&&this.persisted.scenarioInfo.failedAmsDocumentId&&(d.failed_docId=this.persisted.scenarioInfo.failedAmsDocumentId);const c=l===ee.ScenarioName.SendPicture||l===ee.ScenarioName.SendVideo||l===ee.ScenarioName.SendFile,u=new le.default(l,a,d,void 0,c);return u.setDuplicateStepMarkingEnabled(),u.setScenarioTimeout((()=>(G.track(new X.MessageSendTimeout(i,o)),!1)),Ae._getInstrumentationTimeout(i)),t?(u.start(),n.each(this.persisted.scenarioInfo.secondaryScenariosToSpawnAtCreation,(e=>{const t=u.spawnSecondaryScenario(e.name,e.timeout),s={confirmedGoodConnection:Se.default.isNetworkingAvailableNoSubscription()};t.start(s)}))):(u.resume(this.persisted.scenarioInfo.startTime),u.markStepCompleted("msg_restored",void 0,void 0,!0)),u}))}this._postSubSteps=Le.PostSubSteps.forPost(this,e),n.isUndefined(this.persisted.nonBlocking)&&(this.persisted.nonBlocking=!Ae._shouldBlock(e)),this._postSubSteps.redoLostTransfers()}markTelemetryStepCompleted(e,t,s,i=void 0){n.each(this.telemetryScenarios,((o,r)=>{if((!t||n.includes(t,r))&&n.size(this.persisted.amsUploads)<=1){const t=Qe[e],n={},r=this._postSubSteps.amsManyData&&this._postSubSteps.amsManyData.amsSingleDatas[0];r&&(n.amsDocumentId=r.amsCreate.persisted.amsDocumentIds&&r.amsCreate.persisted.amsDocumentIds[0]),i&&(n[t+"_finished_attempts"]=i),o.extendProperties(n),o.markStepCompleted(t,s,void 0,!0)}}))}static _shouldBlock(e){const t=S.default.getS4LMessagingFeaturesNoSubscription().nonBlockingUploadsFromSize;if(n.isNumber(t)&&n.size(e.amsUploads)){let s=0;n.each(e.amsUploads,(e=>{var t;e&&((null===(t=e.amsUploadFullData)||void 0===t?void 0:t.isAlbumItem)?s=e.amsUploadFullData.albumTotalSize||0:(n.isNumber(e.amsUploadFullData.file.size)&&(s+=e.amsUploadFullData.file.size),e.amsUploadThumbnailData&&n.isNumber(e.amsUploadThumbnailData.file.size)&&(s+=e.amsUploadThumbnailData.file.size)))}));const i=n.some(e.messagesForPosting,((e,t)=>k.isAgent(t)));return!I.shouldMediaBeSentAsync(s,t,Se.default.isNetworkingAvailable(),i)}return!0}static _getInstrumentationTimeout(e){const t=I.getMessageTypeGroup(e);let s=0;const i=S.default.getS4LMessagingFeatures();switch(t){case I.MessageTypeGroups.Location:s=i.locationSendTimeout;break;case I.MessageTypeGroups.ScheduledCallInvite:s=S.default.getS4LCMCFeatures().scheduledCallInviteSendTimeout;break;case I.MessageTypeGroups.Poll:s=i.pollCardSendTimeout;break;case I.MessageTypeGroups.Sticker:s=i.stickerSendTimeout;break;case I.MessageTypeGroups.SwiftCard:s=i.swiftCardSendTimeout;break;case I.MessageTypeGroups.Text:case I.MessageTypeGroups.SMS:case I.MessageTypeGroups.CallerID:case I.MessageTypeGroups.MediaAlbum:case I.MessageTypeGroups.Translation:s=i.textSendTimeoutFineGrainedConfig.enabled?i.textSendTimeoutFineGrainedConfig.timeoutInMs:i.textSendTimeout;break;case I.MessageTypeGroups.UriFile:s=i.uriFileSendTimeout;break;case I.MessageTypeGroups.Audio:s=i.audioSendTimeout;break;case I.MessageTypeGroups.Picture:s=i.pictureSendTimeout;break;case I.MessageTypeGroups.Video:s=i.videoSendTimeout;break;case I.MessageTypeGroups.Calling:s=i.callingSendTimeout;break;case I.MessageTypeGroups.System:s=i.systemSendTimeout;break;case I.MessageTypeGroups.Contact:s=i.contactSendTimeout;break;case I.MessageTypeGroups.None:case I.MessageTypeGroups.Engagement:case I.MessageTypeGroups.MagicBotToolbox:s=i.noneGroupSendCallback;break;default:pe.default.switchStatementExhaustiveChecking(t)}return s}getPersistedActionData(){return this.persisted}isUploadNeeded(){return!n.isEmpty(this.persisted.amsUploads)}doWorkIfNeeded(){const e=this._postSubSteps.checkForUpdate();let t;switch(e.kind){case Xe.Finished:case Xe.GiveUp:case Xe.Blocked:t=!1;break;case Xe.InProgress:case Xe.Update:const{backgroundWakeLockWhilePostWaitingForTransfer:s}=S.default.getConfigSettingsNoSubscription().chat,i=e=>s?!n.isEmpty(e):!n.every(e,(e=>e instanceof xe));t=i(e.inProgress)||i(e.start);break;default:return pe.default.switchStatementExhaustiveChecking(e.kind)}switch(e.kind){case Xe.Finished:this._finished();break;case Xe.Blocked:case Xe.InProgress:break;case Xe.Update:n.each(e.start,(e=>{e.start()}));break;case Xe.GiveUp:const t=n.first(e.failure).stepType,s=$e.getFailureReason(e);this._removeWithoutSuccess(t,s);break;default:return pe.default.switchStatementExhaustiveChecking(e.kind)}return{updateKind:e.kind,isActivelyWorking:t}}_finished(){if(this.persisted.shouldTrackUpload&&n.size(this.persisted.amsUploads)<=1){const e=this.persisted.amsUploads&&this.persisted.amsUploads[0];if(e){const t=Q.MediaUploadBase.mediaActionForFileType(e.amsUploadFileType);if(t){const s=this._postSubSteps.amsManyData,i=s&&s.amsSingleDatas[0],o=this.persisted.conversationIds&&this.persisted.conversationIds[0],n=o?k.isGroupConversation(o):void 0;G.track(new Q.MediaUploadBase(t,!0,O.MessagingFailureReason.None,Date.now()-this.persisted.postTime,e.amsUploadFileType,e.amsUploadFullData.dimensions,i?i.amsCreate.persisted.transactionId:void 0,i&&i.amsCreate.persisted.amsDocumentIds?i.amsCreate.persisted.amsDocumentIds[0]:void 0,n))}}}if(this.persisted.toastMessageToShowOnSuccess){const e=q.getString(this.persisted.toastMessageToShowOnSuccess);Y.default.scheduleTextMessage(e,void 0,A.MainRootViewId)}}_removeWithoutSuccess(e,t){switch(t){case x.FailureReason.Permanent:this.persisted.permanentFailureTransferType=e;break;case x.FailureReason.MaxElapsedTimeExceeded:this.persisted.maxElapsedTimeExceededTransferType=e;break;case x.FailureReason.MaxRetriesExceeded:this.persisted.maxRetriesExceededTransferType=e;break;case x.FailureReason.None:break;default:pe.default.switchStatementExhaustiveChecking(t)}if(G.log(Te,"Giving up: "+this.persisted.id+", transferType: "+e+", failureReason: "+x.FailureReason[t]),this.persisted.showLocalNotificationOnFailure){if(l.LocalNotifications.show(this.persisted.showLocalNotificationOnFailure),!n.isEmpty(this.persisted.conversationIds)){const e=new J.MessagingToastAlertEvent(J.MessagingToastAlertType.ReplyNotSent,this.persisted.conversationIds[0]);G.track(e)}this.persisted.showLocalNotificationOnFailure=void 0}}handleResponse(e,t,s,i,o,r){if(r===qe.UrlPreviewsType&&n.isString(t)&&this._postSubSteps.urlPreview){const s=n.find(this._postSubSteps.urlPreview.steps,(t=>{const s=t,i=s.persisted&&s.persisted.urlPreviewBackgroundTransfer&&s.persisted.urlPreviewBackgroundTransfer[s.endpoint];return!!i&&i.id===e}));t={postId:t,endpoint:s&&s.endpoint}}const a=function(e,t){const s=e;switch(s){case qe.AmsCreateType:case qe.AmsThumbnailType:case qe.AmsFullDataType:case qe.AzureDataType:return n.isString(t)?{postId:t,stepSelector:0}:t;case qe.AmsGetStatusForwardType:return Oe.parseBackgroundContextForForward(t);case qe.AmsGetStatusForwardUploadType:return Oe.parseBackgroundContextForUpload(t);case qe.AmsForwardContentType:return Ue.parseBackgroundContextForForward(t);case qe.AmsForwardContentUploadType:return Ue.parseBackgroundContextForUpload(t);case qe.UrlPreviewsType:return Ve.parseBackgroundContext(t);case qe.ChatPostType:return We.parseBackgroundContext(t);case qe.MessagePropSetType:return Ge.parseBackgroundContext(t);case qe.AmsCreateForegroundType:case qe.AmsThumbnailForegroundType:case qe.AmsFullDataForegroundType:case qe.ChatPostForegroundType:return t;default:return void pe.default.switchStatementExhaustiveChecking(s)}}(r,t);if(a)return this._postSubSteps.handleResponse(e,t,s,i,o,r,a.stepSelector)}resetBackoffs(){this._postSubSteps.resetBackoffs()}cleanup(){this._postSubSteps.cleanup()}updateTotalElapsedTime(e,t){const s=e?Date.now()-e:0;this.persisted.totalElapsedTime?this.persisted.totalElapsedTime+=s:this.persisted.totalElapsedTime=s,G.log(Te,`Post ${this.persisted.id} ${t} elapsedTime to handleResponse: ${s} total post elapsedTime: ${this.persisted.totalElapsedTime}`)}isMyLocalUrl(e){return n.includes(this.getMyLocalUrls(),e)}getMyLocalUrls(){const e=[];return n.each(this.persisted.amsUploads,(t=>{e.push(t.amsThumbnailLocalUrl,this._getCurrentFileUri(t.amsThumbnailCacheInfo)),e.push(t.amsFullDataLocalUrl,t.originalFullDataLocalUrl,this._getCurrentFileUri(t.amsFullDataCacheInfo))})),n.compact(e)}getMyLocalCacheNames(){const e=[];return n.each(this.persisted.amsUploads,(t=>{t.amsThumbnailCacheInfo&&e.push(t.amsThumbnailCacheInfo.name),t.amsFullDataCacheInfo&&e.push(t.amsFullDataCacheInfo.name)})),n.compact(e)}_getCurrentFileUri(e){return e?j.FileUploadCacheUtils.getAbsoluteUriForName(e.name):void 0}isPostedToChat(e){return this._postSubSteps.chatPosts.isPostedToChat(e)}debug_allPostsFailedRetryInfo(){return this._postSubSteps.debug_retryInfo()}}t.Post=Ae;class xe extends x.default{constructor(e,t,s,i){super([s],Te),this.post=e,this.persisted=t,this.stepType=s,this.stepSelector=i}checkForUpdate(){const e=this.transfer(),{needValidSkypeToken:t}=this._config();if(this._isTransferCompletedSuccessfully(e))return $e.Finished;if(this._isTransferCompletedWithoutSuccess(this.post.persisted.id,e,this.stepType)){const t=(null==e?void 0:e.failureReason)?e.failureReason:x.FailureReason.None;return $e.NeedTo.giveUpBecauseStep(this,t)}return this._isTransferReadyToStart(this.post.persisted.id,e,this.stepType,t)?$e.NeedTo.startSteps(this):e&&e.finished?$e.NeedTo.waitBecauseBlocked(this):$e.NeedTo.waitForProgress(this)}start(){this._startTime=Date.now(),this._start()}handleResponse(e,t,s,i){this.post.updateTotalElapsedTime(this._startTime,this.stepType);const o=this.transfer();if(!o||o.id!==i)return void G.warn(Te,"Got "+this.stepType+(this.stepSelector?" ("+this.stepSelector+")":"")+" for known post: "+this.post.persisted.id+", but transfer id mismatch, expected: "+i+", current: "+(o&&o.id));const{emptyResponse:r,shimChatServiceResponse:a,canBlockOthersInConv:l,convId:d,fileSize:c}=this._config();e&&!r&&n.isEmpty(t.body)&&(G.log(Te,this.stepType+" missing body, success = false: "+this.post.persisted.id),e=!1),e=this._overrideSuccess(e,t),a&&T.default.errorHandler.augmentErrorResponse(t,e);const u=this._isPermanentFailure(e,t),h=this.post.persisted.totalElapsedTime||0,p=this._handleTransferFinished(this.post.persisted.id,o,this.stepType,e,u,h,t);e=!!p.transfer.success;const g=this._telemetryInfo(e),m={success:e,permanentFailure:x.default.isTransferPermanentFailure(p.transfer),finishedAttemptsSoFarCount:p.transfer.finishedAttemptsSoFarCount,retryInfo:p.retryInfo,canRetry:p.canRetry,mightUnblockOthersInConv:l&&(e||!p.canRetry),telemetryInfo:g,convId:d,fileSize:c};return m.mightUnblockOthersInConv&&!d&&(m.mightUnblockOthersInConv=void 0),this._handleResponse(e,t,s),m}_overrideSuccess(e,t){return e}_getMaxRetries(e,t){const s=S.default.getS4LCMCFeatures().retryPolicy;return n.isNumber(s.maxRetries[t])?s.maxRetries[t]:s.maxRetriesDefault}_getMaxTransferTime(e,t){const s=S.default.getS4LCMCFeatures().retryPolicy;return n.isNumber(s.maxTransferTime[t])?s.maxTransferTime[t]:s.maxPostElapsedTime}_isPermanentFailure(e,t){const{fileSize:s,uploadFileType:i}=this._config();return ot(e,t,s,i)}resetBackoffs(){this._resetBackoffs()}stop(e){const t=pe.default.newCauseId();G.log(Te,"stop, causeId: "+t);const s=this.transfer();s&&s.id&&(!s.finished&&C.default.transferIsTracked(s.id)&&C.default.cancelTransfer(s.id,t),e&&x.default.redoTransfer(s))}cleanup(){this.stop(!1),this._cleanupRetryInfo(this.post.persisted.id)}debug_retryInfo(){return this._getRetryInfo(this.post.persisted.id,this.stepType)}}class De{constructor(e,t,s,i){this.post=e,this.persisted=t,this.stepType=s,this.stepSelector=i}checkForUpdate(){const e=this._status();return e&&e.permanentFailure?$e.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent):e&&e.finished?$e.Finished:this._foregroundRequest?$e.NeedTo.waitForProgress(this):$e.NeedTo.startSteps(this)}start(){this._startTime=Date.now();this._status();const e=this._startForegroundRequestOrFinish();if(!e)return void this._immediatelyFail();this._foregroundRequest=e,this._releasingWakeLockSubscription||(this._releasingWakeLockSubscription=T.default.releasingWakelock.subscribe((()=>{this._status(!0).finished||this._immediatelyFail()})));let s=!1;this._foregroundRequest.done((e=>{s=!0})).always((i=>{if(this._foregroundRequest!==e)return;this._foregroundRequest=void 0,this._releasingWakeLockSubscription&&(this._releasingWakeLockSubscription.unsubscribe(),this._releasingWakeLockSubscription=void 0);const o={postId:this.post.persisted.id,stepSelector:this.stepSelector},n=i.requestHeaders;t.foregroundResponse.fire(void 0,o,s,i,n,this.stepType)}))}_immediatelyFail(){this.stop(!1);const e=this._status(!0);e.finished=!0,e.finishedSuccess=!1;const{canBlockOthersInConv:s,convId:i}=this._config();t.pokePost.fire(this.post.persisted.id,s?i:void 0)}handleResponse(e,t,s,i){this.post.updateTotalElapsedTime(this._startTime,this.stepType);const o=this._status(!0);o.finished=!0,o.finishedSuccess=e,o.permanentFailure=this._isPermanentFailure(e,t),this._handleResponse(e,t,s);const{canBlockOthersInConv:n,convId:r,fileSize:a}=this._config(),l={success:e,permanentFailure:o.permanentFailure,finishedAttemptsSoFarCount:1,canRetry:!1,mightUnblockOthersInConv:n&&e,telemetryInfo:this._telemetryInfo(e),convId:r,fileSize:a};return l.mightUnblockOthersInConv&&!r&&(l.mightUnblockOthersInConv=void 0),l}_overrideSuccess(e,t){return e}_isPermanentFailure(e,t){const{fileSize:s,uploadFileType:i}=this._config();return ot(e,t,s,i)}stop(e){if(this._foregroundRequest){const e=this._foregroundRequest;this._foregroundRequest=void 0,e.cancel()}if(e){const e=this._status(!0);e.finished=!0,e.finishedSuccess=!1}this._releasingWakeLockSubscription&&(this._releasingWakeLockSubscription.unsubscribe(),this._releasingWakeLockSubscription=void 0)}cleanup(){this.stop(!1)}}var Re,Le,Be,Fe,Ne,Ee,Oe,Ue,Ve,He,je,ze,We,Ge,Ke,qe,Qe,Xe,$e,Je,Ye;function Ze(e,t){return!k.isEncryptedThread(e)&&(k.isThread(e)?S.default.getConfigSettings().chat.serverSideEdits:!I.isEventCallEndedMessageType(t)&&S.default.getConfigSettings().chat.serverSideEdits1to1)}function et(e){const t=S.default.getConfigSettingsNoSubscription().chat;return!e||t.backgroundWaitForAmsUpload}function tt(){if(dt&&c.App.getActivationState()===c.Types.AppActivationState.Active){const e=S.default.getConfigSettingsNoSubscription().chat.enableForegroundMessagePostWithREST;if(e["*"]||e[ne.default.getOSVersion()])return!0}return!1}function st(e){const[t,...s]=e;return{uploadConvIds:[t],forwardConvIds:s}}function it(e){return e instanceof xe?"background transfer":e instanceof De?"foreground request":"other kind of Step"}function ot(e,t,s,i){return x.default.isPermanentFailure(t)}function nt(e){if(e.body&&e.body.errorCode)return e.body.errorCode}function rt(e,t){const s=j.FileUploadCacheUtils.getAbsoluteFromLocalCacheUri(t),i=e.file.uri;if(!i||i===s)return e;const o=n.cloneDeep(e);return o.file.uri=s,o}function at(e,t,s,i,o,n,r){return Object.assign(Object.assign({},e),{originalFileName:e.amsUploadFilename,originalFullDataLocalUrl:e.amsFullDataLocalUrl,originalUploadFileType:e.amsUploadFileType,amsFullDataLocalUrl:t,amsUploadFilename:i||e.amsUploadFilename,amsUploadFullData:s,amsUploadFileType:o||e.amsUploadFileType,amsThumbnailLocalUrl:n,amsUploadThumbnailData:r})}function lt(e,s,i,o,n,r){const a=i?o?1:0:r&&r.total?r.loaded/r.total:0;t.foregroundUploadProgress.fire(e,s,n,{finished:i,success:o,progress:a})}t.foregroundResponse=new p.default,t.foregroundUploadProgress=new p.default,t.serverTranscodingProgress=new p.default,function(e){const t="_CONTAINER_";class s{constructor(e,s){this.post=e,this.stepType=t,this.steps=n.compact(s)}redoLostTransfers(){n.each(this.steps,(e=>{if(e.stepType===t)e.redoLostTransfers();else{const t=e;if(t&&n.isFunction(t.transfer)){const e=t.transfer();e&&x.default.isTransferLost(e)&&x.default.redoTransfer(e)}}}))}handleResponse(e,s,i,o,n,r,a){const l=this._findSubStep(r,a);if(l){if(l.stepType===t)return l.handleResponse(e,s,i,o,n,r,a);{const t=l;if(t.handleResponse)return t.handleResponse(i,o,n,e)}}}_findSubStep(e,s){let i;return n.each(this.steps,(o=>(o.stepType===t?o._findSubStep(e,s)&&(i=o):o.stepType===e&&o.stepSelector===s&&(i=o),!i&&void 0))),i}resetBackoffs(){n.each(this.steps,(e=>{if(e.stepType===t)e.resetBackoffs();else{const t=e;t&&t.resetBackoffs&&t.resetBackoffs()}}))}debug_retryInfo(){const e=n.map(this.steps,(e=>{if(e.stepType===t)return e.debug_retryInfo();{const t=e;if(t.debug_retryInfo)return t.debug_retryInfo()}}));return n.merge({},...e)}stop(e){n.each(this.steps,(t=>{t.stop(e)}))}cleanup(){n.each(this.steps,(e=>{e.cleanup()}))}}e.InSequence=class extends s{checkForUpdate(){return $e.findWorkWithLowPriorityFinished(this.steps)}};e.InParallel=class extends s{checkForUpdate(){const e=n.map(this.steps,(e=>e.checkForUpdate()));return this._giveUpUpdateHasLowPriority?$e.reduceWithLowPriorityGiveUp(e):$e.reduceWithHighPriorityGiveUp(e)}}}(Re||(Re={})),function(e){class t extends Re.InSequence{static forPost(e,i){const o=s.forPost(e,i),n=r.forPost(e,i),a=c.forPost(e,i),l=h.forPost(e,i),d=p.forPost(e,i),u=Ke.FeedbackStep.forPost(e,i);return new t(e,o,n,a,l,d,u)}constructor(e,t,s,i,o,n,r){super(e,[t,s,i,o,n,r]),this.amsManyData=t,this.amsForward=s,this.urlPreview=i,this.chatPosts=o,this.propSets=n,this.feedback=r}}e.PostSubSteps=t;class s extends Re.InSequence{static forPost(e,t){if(t.amsUploads&&t.amsUploads.length){const o=n.map(t.amsUploads,((s,o)=>i.forPost(e,t,o))),r=ze.TranscodeVideoStep.forPost(e,t),a=je.EncryptFileStep.forPost(e,t),d=l.forPost(e,t);return new s(e,r,a,o,d)}}constructor(e,t,s,i,o){super(e,[t,s,...i,o]),this.post=e,this.transcodeVideo=t,this.encryptFile=s,this.amsSingleDatas=i,this.amsForwardUpload=o}}class i extends Re.InSequence{static forPost(e,t,s){if(t.amsUploads&&t.amsUploads[s]){const o=Be.AmsCreateForegroundStep.forPost(e,t,s),n=Be.AmsCreateStep.forPost(e,t,s),r=Fe.AmsThumbnailForegroundStep.forPost(e,t,s),a=Fe.AmsThumbnailStep.forPost(e,t,s),l=Ne.AmsFullDataForegroundStep.forPost(e,t,s),d=Ne.AmsFullDataStep.forPost(e,t,s);if(n&&(a||r||d||l))return new i(e,o,n,r,a,l,d,void 0)}}constructor(e,t,s,i,o,n,r,a){super(e,[t,s,i,o,n,r,a]),this.amsCreateForeground=t,this.amsCreate=s,this.amsThumbnailForeground=i,this.amsThumbnail=o,this.amsFullDataForeground=n,this.amsFullData=r,this.azureData=a}handleResponse(e,t,s,i,o,n,r){const a=super.handleResponse(e,t,s,i,o,n,r),l=o&&f.default.checkAuthFailure(i.statusCode,o,!1);return(307===i.statusCode||l)&&(G.log(Te,"Will redo Upload: "+this.post.persisted.id+", "+(l?"auth failure (possible redirect)":"redirect")),this.stop(!0)),a}}class r extends Re.InParallel{static forPost(e,t){if(t.forwardMediaInfos&&t.forwardMediaInfos.length>0){const s=n.map(e.persisted.forwardMediaInfos,(s=>a.forPost(e,t,s)));return new r(e,s)}}constructor(e,t){super(e,t),this.post=e,this._giveUpUpdateHasLowPriority=!1}}class a extends Re.InSequence{static forPost(e,t,s){if(t.forwardMediaInfos&&t.forwardMediaInfos.length>0){const i=Oe.AmsGetStatusForwardStep.forPost(e,t,s),o=Ue.AmsForwardContentStep.forPost(e,t,s);if(i&&o)return new a(e,s,i,o)}}constructor(e,t,s,i){super(e,[s,i]),this.post=e,this.info=t,this.amsGetStatusForward=s,this.amsForwardContent=i}handleResponse(e,t,s,i,o,n,r){const a=super.handleResponse(e,t,s,i,o,n,r),l=o&&f.default.checkAuthFailure(i.statusCode,o,!1);return(307===i.statusCode||l)&&(G.log(Te,"Will redo Forward: "+this.post.persisted.id+", objectId: "+this.info.objectId+", "+(l?"auth failure (possible redirect)":"redirect")),this.stop(!0)),a}}class l extends Re.InParallel{static forPost(e,t){const{forwardConvIds:s}=st(t.conversationIds);if(e.isUploadNeeded()&&s.length){const i=n.map(s,(s=>d.forPost(e,t,s)));return new l(e,i)}}constructor(e,t){super(e,t),this.post=e,this._giveUpUpdateHasLowPriority=!1}}class d extends Re.InSequence{static forPost(e,t,s){if(e.isUploadNeeded()){const i=Oe.AmsGetStatusForUploadStep.forPost(e,t,s),o=Ue.AmsForwardContentForUploadStep.forPost(e,t,s);if(i&&o)return new d(e,s,i,o)}}constructor(e,t,s,i){super(e,[s,i]),this.post=e,this.convId=t,this.amsGetStatusForward=s,this.amsForwardContent=i}handleResponse(e,t,s,i,n,r,a){const l=super.handleResponse(e,t,s,i,n,r,a),d=n&&f.default.checkAuthFailure(i.statusCode,n,!1);return(307===i.statusCode||d)&&(G.log(Te,"Will redo Forward: "+this.post.persisted.id+", convId: "+o.pii.Mri(this.convId)+", "+(d?"auth failure (possible redirect)":"redirect")),this.stop(!0)),l}}class c extends Re.InParallel{static forPost(e,t){if(t.urlPreviewEndpoints&&t.urlPreviewEndpoints.length>0){const s=n.uniq(t.urlPreviewEndpoints),i=n.map(s,(s=>Ve.UrlPreviewsStep.forPost(e,t,s)));return new c(e,i)}}constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!1}checkForUpdate(){const e=super.checkForUpdate();return e.kind===Xe.GiveUp&&this.stop(!1),$e.dontGiveUp(e)}}class u extends Re.InSequence{static forPost(e,t,s){return new u(e,s,He.EncryptMessageStep.forPost(e,t,s),We.ChatPostForegroundStep.forPost(e,t,s),We.ChatPostTransferStep.forPost(e,t,s))}constructor(e,t,s,i,o){super(e,[s,i,o]),this.convId=t,this.encryptMessage=s,this.chatPostForegroundStep=i,this.chatPostTransferStep=o}}class h extends Re.InParallel{static forPost(e,t){const s=n.map(e.persisted.conversationIds,(s=>u.forPost(e,t,s)));return new h(e,s)}constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!0,this.chatPostInConv={},this.chatPostInConv=n.keyBy(t,(e=>e?e.convId:"undefined"))}isPostedToChat(e){const t=this.chatPostInConv[e];return!!t&&t.checkForUpdate().kind===Xe.Finished}handleResponse(e,t,s,i,o,r,a){const l=super.handleResponse(e,t,s,i,o,r,a);return n.every(this.chatPostInConv,(e=>{if(e){const t=e.checkForUpdate();switch(t.kind){case Xe.Finished:case Xe.GiveUp:return!0;case Xe.InProgress:case Xe.Blocked:case Xe.Update:return!1;default:pe.default.switchStatementExhaustiveChecking(t.kind)}}return!0}))&&G.log(Te,"Finished posting to Chat Service: "+this.post.persisted.id),l}}class p extends Re.InParallel{static forPost(e,t){if(t.urlPreviewPropSet){const s=n.map(e.persisted.conversationIds,(s=>Ge.MessagePropSetStep.forPost(e,t,s)));return new p(e,s)}}constructor(e,t){super(e,t),this._giveUpUpdateHasLowPriority=!0}checkForUpdate(){const e=super.checkForUpdate();return $e.dontGiveUp(e)}}}(Le||(Le={})),t.pokePost=new p.default,function(e){function t(e,t){return!(!e.amsUploads||!e.amsUploads[t])}function s(e){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:V.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}function i(e){return e.body&&e.body.id}function o(e,t,s,o){const n=o&&_.ASMClient.getTracingHeaders(o);if(G.log(Te,"AmsCreateDocument completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", Document ID: "+i(s)+", from "+it(e)+", tracing:"+JSON.stringify(n)),t){e.persisted.amsDocumentIds||(e.persisted.amsDocumentIds=[]);const t=i(s);e.persisted.amsDocumentIds[e.amsUploadIndex]=t,t?Je.updateAmsCreateReferences(e.post):G.warn(Te,"was not given amsDocumentId for successfully created document")}else f.default.checkAuthFailure(s.statusCode,o)}function n(e,t){e&&t.persisted.amsDocumentIds&&(t.persisted.amsDocumentIds[t.amsUploadIndex]=void 0)}function r(e){return{step:Qe.AmsDocumentCreated}}e.AmsCreateForegroundStepType="postingService_amsCreateForeground",e.AmsCreateTransferType="postingService_amsCreate";class a extends De{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o)&&et(!0))return new a(s,i,e.AmsCreateForegroundStepType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsCreateDocumentForegroundRequests||(this.persisted.amsCreateDocumentForegroundRequests={}),this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsCreateDocumentForegroundRequests&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!tt())return;this.persisted.amsCreateDocumentBackgroundIds||(this.persisted.amsCreateDocumentBackgroundIds={}),this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]||(this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.getAmsUpload(),{uploadConvIds:t}=st(this.post.persisted.conversationIds);return f.default.createDocumentAsync(t,e.amsUploadFilename,e.amsUploadFileType,void 0,this.persisted.transactionId,this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex],Me.timeout)}_overrideSuccess(e,t){return e&&!!i(t)}_handleResponse(e,t,s){o(this,e,t,s)}stop(e){super.stop(e),n(e,this)}_telemetryInfo(e){return r()}}e.AmsCreateForegroundStep=a;class l extends xe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new l(s,i,e.AmsCreateTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.stepSelector]}_config(){return s(this.getAmsUpload())}transfer(){return this.persisted.amsCreateDocumentBackgroundTransfers&&this.persisted.amsCreateDocumentBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsCreateDocumentForegroundRequests&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsCreateDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?$e.Finished:super.checkForUpdate()}_start(){this.persisted.amsCreateDocumentBackgroundIds||(this.persisted.amsCreateDocumentBackgroundIds={}),this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]||(this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsCreateDocumentBackgroundTransfers||(this.persisted.amsCreateDocumentBackgroundTransfers={});const e=Object.assign(Object.assign({},Me),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsCreateDocumentBackgroundIds[this.amsUploadIndex]}),t=this.getAmsUpload(),{uploadConvIds:s}=st(this.post.persisted.conversationIds),i=this.transfer(),o=f.default.createDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},s,t.amsUploadFilename,t.amsUploadFileType,void 0,e);this.persisted.amsCreateDocumentBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(o,i)}_overrideSuccess(e,t){return e&&!!i(t)}_handleResponse(e,t,s){o(this,e,t,s)}stop(e){super.stop(e),n(e,this)}_telemetryInfo(e){return r()}}e.AmsCreateStep=l}(Be||(Be={})),function(e){function t(e,t){return!(!e.amsUploads||!e.amsUploads[t])&&!!e.amsUploads[t].amsUploadThumbnailData}function s(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:e.amsUploadThumbnailData.file.size,uploadFileType:re.UploadFileType.Thumbnail}}function i(e,t,s,i){const o=i&&_.ASMClient.getTracingHeaders(i);G.log(Te,"AmsUploadThumbContent completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", from "+it(e)+", tracing:"+JSON.stringify(o)),t||f.default.checkAuthFailure(s.statusCode,i),lt(e.post.persisted.id,e.amsUploadIndex,!0,t,!1)}function o(e){return{step:Qe.AmsThumbContentUploaded,attributes:{success:e}}}e.AmsThumbnailTransferType="postingService_amsUpThumbContent",e.AmsThumbnailForegroundStepType="postingService_amsUpThumbContentForeground";class n extends De{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o)&&et(!0))return new n(s,i,e.AmsThumbnailForegroundStepType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsThumbnailDocumentForegroundRequests||(this.persisted.amsThumbnailDocumentForegroundRequests={}),this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsThumbnailDocumentForegroundRequests&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!tt())return;this.persisted.amsThumbnailBackgroundIds||(this.persisted.amsThumbnailBackgroundIds={}),this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]||(this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.persisted.amsDocumentIds[this.amsUploadIndex],t=this.getAmsUpload();return lt(this.post.persisted.id,this.amsUploadIndex,!1,!1,!1),f.default.uploadDocumentAsync(e,re.UploadFileType.Thumbnail,rt(t.amsUploadThumbnailData,t.amsThumbnailLocalUrl).file,(e=>lt(this.post.persisted.id,this.amsUploadIndex,!1,!1,!1,e)),this.persisted.transactionId,this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex])}_handleResponse(e,t,s){i(this,e,t,s)}stop(e){super.stop(e)}_telemetryInfo(e){return o(e)}}e.AmsThumbnailForegroundStep=n;class r extends xe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new r(s,i,e.AmsThumbnailTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return s(this.getAmsUpload())}transfer(){return this.persisted.amsThumbnailBackgroundTransfers&&this.persisted.amsThumbnailBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsThumbnailDocumentForegroundRequests&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsThumbnailDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?$e.Finished:super.checkForUpdate()}_start(){this.persisted.amsThumbnailBackgroundIds||(this.persisted.amsThumbnailBackgroundIds={}),this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]||(this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsThumbnailBackgroundTransfers||(this.persisted.amsThumbnailBackgroundTransfers={});const e=Object.assign(Object.assign({},Ie),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsThumbnailBackgroundIds[this.amsUploadIndex]}),t=this.persisted.amsDocumentIds[this.amsUploadIndex],s=this.getAmsUpload(),i=this.transfer(),o=f.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},t,re.UploadFileType.Thumbnail,rt(s.amsUploadThumbnailData,s.amsThumbnailLocalUrl).file,e);this.persisted.amsThumbnailBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(o,i)}_handleResponse(e,t,s){i(this,e,t,s)}stop(e){super.stop(e)}_telemetryInfo(e){return o(e)}}e.AmsThumbnailStep=r}(Fe||(Fe={})),function(e){function t(e,t){return!!(e.amsUploads&&e.amsUploads[t]&&e.amsUploads[t].amsUploadFullData)}function s(e,t){const s=e&&e[t],i=S.default.getS4LCMCFeatures();return!!(s&&s.amsUploadFileType&&i.resumableUploads.enabled)&&n.some(i.resumableUploads.types,(e=>s.amsUploadFileType===re.UploadFileType[e]))}function i(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:V.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}function o(e,t,s,i,o){const r=i&&_.ASMClient.getTracingHeaders(i);G.log(Te,"AmsUploadFullContent completed: "+e.post.persisted.id+", for: "+e.stepSelector+", success: "+t+", from "+it(e)+", tracing:"+JSON.stringify(r));const a=e.persisted.amsDocumentIds[e.amsUploadIndex],l=e.getAmsUpload(),d=e.persisted.instrumentation_uploadStartTimes[e.amsUploadIndex],c=Date.now()-d,u=H.default.extractFileExtension(l.amsUploadFilename,!0),h=y.getDownloadViewId(l.amsUploadFileType,re.MediaViewSize.Full),p=t?O.MessagingFailureReason.None:O.MessagingFailureReason.AMSFailure,g=V.default.getAmsUploadFileSize(l),m=new K.FileSent(e.post.persisted.conversationIds,e.persisted.instrumentation_postSource,de.default.changeExtensionForTelemetry(u),g,h,a,e.post.persisted.messagesForPosting);m.setSuccess(t,p,o,s.statusCode,d,c),G.track(m),t?(Ye.updateMessageUrls(e.post,a,void 0),n.each(e.post.persisted.messagesForPosting,((e,t)=>{b.default.applyMessageLie(t,e)}))):f.default.checkAuthFailure(s.statusCode,i),lt(e.post.persisted.id,e.amsUploadIndex,!0,t,!0)}function r(e){return{step:Qe.AmsFullContentUploaded,attributes:{success:e}}}e.AmsFullDataTransferType="postingService_amsUpFullContent",e.AmsFullDataForegroundStepType="postingService_amsUpFullContentForeground";class a extends De{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(i,o,n){if(t(o,n)&&et(!0)&&!s(o.amsUploads,n))return new a(i,o,e.AmsFullDataForegroundStepType,n)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return i(this.getAmsUpload())}_status(e){return e&&(this.persisted.amsFullDataDocumentForegroundRequests||(this.persisted.amsFullDataDocumentForegroundRequests={}),this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]||(this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]={finished:!1,finishedSuccess:!1})),this.persisted.amsFullDataDocumentForegroundRequests&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]}_startForegroundRequestOrFinish(){if(!tt())return;this.persisted.instrumentation_uploadStartTimes||(this.persisted.instrumentation_uploadStartTimes={}),this.persisted.instrumentation_uploadStartTimes[this.amsUploadIndex]=Date.now(),this.persisted.amsFullDataBackgroundIds||(this.persisted.amsFullDataBackgroundIds={}),this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]||(this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]=pe.default.newGuid());const e=this.persisted.amsDocumentIds[this.amsUploadIndex],t=this.getAmsUpload();return lt(this.post.persisted.id,this.amsUploadIndex,!1,!1,!0),f.default.uploadDocumentAsync(e,t.amsUploadFileType,rt(t.amsUploadFullData,t.amsFullDataLocalUrl).file,(e=>lt(this.post.persisted.id,this.amsUploadIndex,!1,!1,!0,e)),this.persisted.transactionId,this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex])}_handleResponse(e,t,s){o(this,e,t,s,1)}stop(e){super.stop(e)}_telemetryInfo(e){return r(e)}}e.AmsFullDataForegroundStep=a;class l extends xe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}static forPost(s,i,o){if(t(i,o))return new l(s,i,e.AmsFullDataTransferType,o)}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){return i(this.getAmsUpload())}transfer(){return this.persisted.amsFullDataBackgroundTransfers&&this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex]}checkForUpdate(){return this.persisted.amsFullDataDocumentForegroundRequests&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex]&&this.persisted.amsFullDataDocumentForegroundRequests[this.amsUploadIndex].finishedSuccess?$e.Finished:super.checkForUpdate()}_start(){this.persisted.instrumentation_uploadStartTimes||(this.persisted.instrumentation_uploadStartTimes={}),this.persisted.instrumentation_uploadStartTimes[this.amsUploadIndex]=Date.now(),this.persisted.amsFullDataBackgroundIds||(this.persisted.amsFullDataBackgroundIds={}),this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]||(this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex]=pe.default.newGuid()),this.persisted.amsFullDataBackgroundTransfers||(this.persisted.amsFullDataBackgroundTransfers={});const e=this.getAmsUpload(),t=this.persisted.amsDocumentIds[this.amsUploadIndex],i=s(this.persisted.amsUploads,this.amsUploadIndex),o=y.getUploadStatusUrl(t,e.amsUploadFileType),n=this.persisted.amsFullDataBackgroundTransfers&&this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex],r=n?n.finishedAttemptsSoFarCount:0,a=Object.assign(Object.assign({},Ie),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsFullDataBackgroundIds[this.amsUploadIndex],resumable:i,resumableUploadStatusUrl:o,resumableAttemptsSoFar:r}),l=this.transfer(),d=f.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},t,e.amsUploadFileType,rt(e.amsUploadFullData,e.amsFullDataLocalUrl).file,a);this.persisted.amsFullDataBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(d,l)}_handleResponse(e,t,s){o(this,e,t,s,this.transfer().finishedAttemptsSoFarCount)}stop(e){super.stop(e)}_telemetryInfo(e){return r(e)}}e.AmsFullDataStep=l}(Ne||(Ne={})),function(e){e.AzureDataTransferType="postingService_azureUp";e.AzureDataStep=class extends xe{constructor(){super(...arguments),this.amsUploadIndex=this.stepSelector}getAmsUpload(){return this.persisted.amsUploads[this.amsUploadIndex]}_config(){const e=this.getAmsUpload();return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1,fileSize:V.default.getAmsUploadFileSize(e),uploadFileType:e.amsUploadFileType}}transfer(){return this.persisted.azureBackgroundTransfers&&this.persisted.azureBackgroundTransfers[this.amsUploadIndex]}_start(){this.persisted.azureBackgroundTransfers||(this.persisted.azureBackgroundTransfers={});const e=this.getAmsUpload(),t=this.transfer(),s=v.default.uploadDocumentBackground(this.stepType,{postId:this.post.persisted.id,stepSelector:this.stepSelector},rt(e.amsUploadFullData,e.amsFullDataLocalUrl).file,Ie);this.persisted.azureBackgroundTransfers[this.amsUploadIndex]=this._createTrackedBackgroundTransfer(s,t)}_handleResponse(e,t,s){if(G.log(Te,"AzureUpload completed: "+this.post.persisted.id+", for: "+this.stepSelector+", success: "+e+", videoId: "+(e&&t.body?t.body.id:void 0)),e){this.persisted.azureMSUrls||(this.persisted.azureMSUrls={});const e=t.body;this.persisted.azureMSUrls[this.amsUploadIndex]=v.default.getVideoUrl(e.id);const s=this.persisted.amsDocumentIds[this.amsUploadIndex];Ye.updateMessageUrls(this.post,s,this.persisted.azureMSUrls[this.amsUploadIndex]),n.each(this.post.persisted.messagesForPosting,((e,t)=>{b.default.applyMessageLie(t,e)}))}else f.default.checkAuthFailure(t.statusCode,s)}stop(e){super.stop(e),this.persisted.azureMSUrls&&(this.persisted.azureMSUrls[this.amsUploadIndex]=void 0)}_telemetryInfo(e){return{step:Qe.AzureUploadCompleted,attributes:{success:e}}}}}(Ee||(Ee={})),function(e){e.AmsGetStatusForwardTransferType="postingService_getStatusForward",e.AmsGetStatusForwardUploadTransferType="postingService_getStatusForwardUpload",e.parseBackgroundContextForForward=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:e.objectId}},e.parseBackgroundContextForUpload=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}},e.parseBackgroundContextForServerTranscoding=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:"0"}};class t extends xe{_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.amsGetStatusBackgroundTransfers||(this.persisted.amsGetStatusBackgroundTransfers={}),this.persisted.amsGetStatusBackgroundTransfers[this.stepSelector]}_start(){const e=this.objectId();this.persisted.amsGetStatusBackgroundIds||(this.persisted.amsGetStatusBackgroundIds={}),this.persisted.amsGetStatusBackgroundIds[this.stepSelector]||(this.persisted.amsGetStatusBackgroundIds[this.stepSelector]=pe.default.newGuid()),this.persisted.amsGetStatusBackgroundTransfers||(this.persisted.amsGetStatusBackgroundTransfers={});const t=this.context(),s=this.getDownloadViewId(),i=Object.assign(Object.assign({},Me),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsGetStatusBackgroundIds[this.stepSelector]}),o=this.transfer(),n=f.default.getStatusBackground(this.stepType,t,e,s,i);this.persisted.amsGetStatusBackgroundTransfers[this.stepSelector]=this._createTrackedBackgroundTransfer(n,o)}_handleResponse(e,t,s){const i=s&&_.ASMClient.getTracingHeaders(s);G.log(Te,"AmsGetStatus completed: "+this.post.persisted.id+", for: "+this.stepSelector+", objectId: "+this.objectId()+", success: "+e+", amsStatusLocation: "+(e&&t.body?t.body.status_location:void 0)+", tracing:"+JSON.stringify(i)),e?(this.persisted.amsStatusLocations||(this.persisted.amsStatusLocations={}),this.persisted.amsStatusLocations[this.stepSelector]=t.body.status_location):f.default.checkAuthFailure(t.statusCode,s)}_makeExponentialTime(e,t){const s=S.default.getS4LCMCFeatures().retryPolicy.constantPollTime[t];return n.isNumber(s)?new h.ExponentialTime(s,this._getMaxTransferTime(e,t),0):super._makeExponentialTime(e,t)}stop(e){super.stop(e),this.persisted.amsStatusLocations&&delete this.persisted.amsStatusLocations[this.stepSelector]}}class s extends t{constructor(){super(...arguments),this.forwardMediaInfo=Ye.getForwardMessageMediaInfo(this.post.persisted.forwardMediaInfos,this.objectId())}static forPost(t,i,o){if(i.forwardMediaInfos&&i.forwardMediaInfos.length>0)return new s(t,i,e.AmsGetStatusForwardTransferType,o.objectId)}objectId(){return this.stepSelector}getDownloadViewId(){return this.forwardMediaInfo.viewId||y.getDownloadViewId(this.forwardMediaInfo.fileType)}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_telemetryInfo(e){return{step:Qe.AmsGotStatusForward,attributes:{success:e}}}}e.AmsGetStatusForwardStep=s;class i extends t{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,o){const{forwardConvIds:r}=st(s.conversationIds);if(t.isUploadNeeded()&&n.includes(r,o))return new i(t,s,e.AmsGetStatusForwardUploadTransferType,o)}objectId(){return this.persisted.amsDocumentIds[0]}getDownloadViewId(){return y.getDownloadViewId(this.persisted.amsUploads[0].amsUploadFileType)}context(){return{postId:this.post.persisted.id,convId:this.convId}}_telemetryInfo(e){return{step:Qe.AmsGotStatusForwardUpload,attributes:{success:e}}}}e.AmsGetStatusForUploadStep=i}(Oe||(Oe={})),function(e){e.AmsForwardContentTransferType="postingService_amsForward",e.AmsForwardContentUploadTransferType="postingService_amsForwardUpload",e.parseBackgroundContextForForward=function(e){if(e.postId&&e.objectId)return{postId:e.postId,stepSelector:e.objectId}},e.parseBackgroundContextForUpload=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class t extends xe{_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.amsForwardBackgroundTransfers||(this.persisted.amsForwardBackgroundTransfers={}),this.persisted.amsForwardBackgroundTransfers[this.stepSelector]}_start(){const e=this.objectId();this.persisted.amsForwardBackgroundIds||(this.persisted.amsForwardBackgroundIds={}),this.persisted.amsForwardBackgroundIds[this.stepSelector]||(this.persisted.amsForwardBackgroundIds[this.stepSelector]=pe.default.newGuid()),this.persisted.amsForwardBackgroundTransfers||(this.persisted.amsForwardBackgroundTransfers={});const t=this.context(),s=Object.assign(Object.assign({},Me),{transactionId:this.persisted.transactionId,correlationId:this.persisted.amsForwardBackgroundIds[this.stepSelector]}),i=this.persisted.amsStatusLocations[this.stepSelector],o=this.transfer(),n=f.default.forwardMediaBackground(this.stepType,t,i,[this.convId],e,s);this.persisted.amsForwardBackgroundTransfers[this.stepSelector]=this._createTrackedBackgroundTransfer(n,o)}_handleResponse(e,t,s){const i=s&&_.ASMClient.getTracingHeaders(s);if(G.log(Te,"AmsForwardDocument completed: "+this.post.persisted.id+", for: "+this.stepSelector+", objectId: "+this.objectId()+", success: "+e+", Document ID: "+(e&&t.body?t.body.id:void 0)+", tracing:"+JSON.stringify(i)),e){this.persisted.amsForwardDocumentIds||(this.persisted.amsForwardDocumentIds={});const e=t.body.id;this.persisted.amsForwardDocumentIds[this.stepSelector]=e,Ye.updateMessageUrls(this.post,this.persisted.amsForwardDocumentIds[this.stepSelector],void 0,this.objectId(),this.convId)}else f.default.checkAuthFailure(t.statusCode,s)}stop(e){super.stop(e),this.persisted.amsForwardDocumentIds&&delete this.persisted.amsForwardDocumentIds[this.stepSelector]}}class s extends t{constructor(){super(...arguments),this.convId=this.post.persisted.conversationIds[0]}static forPost(t,i,o){if(i.forwardMediaInfos&&i.forwardMediaInfos.length>0)return new s(t,i,e.AmsForwardContentTransferType,o.objectId)}objectId(){return this.stepSelector}context(){return{postId:this.post.persisted.id,objectId:this.objectId()}}_handleResponse(e,t,s){super._handleResponse(e,t,s),e&&(Je.updateAmsForwardObjectsReferences(this.post),n.each(this.post.persisted.messagesForPosting,((e,t)=>{b.default.applyMessageLie(t,e)})))}_telemetryInfo(e){return{step:Qe.Forwarded,attributes:{success:e}}}}e.AmsForwardContentStep=s;class i extends t{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,o){const{forwardConvIds:r}=st(s.conversationIds);if(t.isUploadNeeded()&&n.includes(r,o))return new i(t,s,e.AmsForwardContentUploadTransferType,o)}objectId(){return this.persisted.amsDocumentIds[0]}context(){return{postId:this.post.persisted.id,convId:this.convId}}_handleResponse(e,t,s){super._handleResponse(e,t,s),e&&(Je.updateAmsForwardUploadReferences(this.post,this.convId),b.default.applyMessageLie(this.convId,this.post.persisted.messagesForPosting[this.convId]))}_telemetryInfo(e){return{step:Qe.ForwardedUpload,attributes:{success:e}}}}e.AmsForwardContentForUploadStep=i}(Ue||(Ue={})),function(e){e.UrlPreviewsTransferType="postingService_urlPreviewFetching",e.parseBackgroundContext=function(e){if(e.postId&&e.endpoint)return{postId:e.postId,stepSelector:e.endpoint}};class t extends xe{constructor(){super(...arguments),this.endpoint=this.stepSelector}static forPost(s,i,o){if(i.urlPreviewEndpoints&&i.urlPreviewEndpoints.length>0)return new t(s,i,e.UrlPreviewsTransferType,o)}_config(){return{needValidSkypeToken:!0,emptyResponse:!1,shimChatServiceResponse:!1,canBlockOthersInConv:!1}}transfer(){return this.persisted.urlPreviewBackgroundTransfer||(this.persisted.urlPreviewBackgroundTransfer={}),this.persisted.urlPreviewBackgroundTransfer[this.endpoint]}_start(){this.persisted.urlPreviewBackgroundId||(this.persisted.urlPreviewBackgroundId={}),this.persisted.urlPreviewBackgroundId[this.endpoint]||(this.persisted.urlPreviewBackgroundId[this.endpoint]=pe.default.newGuid()),this.persisted.urlPreviewBackgroundTransfer||(this.persisted.urlPreviewBackgroundTransfer={}),n.each(this.post.telemetryScenarios,(e=>{const t="UrlPreviewFetchingStarted";e.isStepMarked(t)||e.markStepCompleted(t)}));const e=Object.assign(Object.assign({},Me),{timeout:void 0,transactionId:this.persisted.transactionId,correlationId:this.persisted.urlPreviewBackgroundId[this.endpoint]}),t={postId:this.post.persisted.id,endpoint:this.endpoint};this._requestStartTimes||(this._requestStartTimes={});const s=this.transfer(),i=Date.now(),o=ce.default.getUrlInfoBackground(this.stepType,t,this.endpoint,e);this._requestStartTimes[o]=i,this.persisted.urlPreviewBackgroundTransfer[this.endpoint]=this._createTrackedBackgroundTransfer(o,s)}_handleResponse(e,t,s){const i=s&&_.ASMClient.getTracingHeaders(s);G.log(Te,"UrlPreviewFetching completed: "+this.post.persisted.id+", endpoint: "+o.pii.Omit(this.endpoint)+", success: "+e+", url:"+(e&&t.body?o.pii.Omit(t.body.url):void 0)+", tracing:"+JSON.stringify(i));const r=this.transfer(),a=r.finishedAttemptsSoFarCount;e?n.each(this.post.persisted.messagesForPosting,((e,s)=>{this._updateMessagePropertiesWithUrlPreviewMetadata(s,e,{key:t.body.url,value:t.body});const i=this.post.telemetryScenarios&&this.post.telemetryScenarios[s];let o;this._requestStartTimes&&void 0!==r.id&&(o=Date.now()-this._requestStartTimes[r.id]);const n=new ue.UrlPreviewReceived(t.url,t.body,a-1,o);G.track(n);const l="UrlPreviewFetchingFinished";i&&!i.isStepMarked(l)&&i.markStepCompleted(l)})):this._getRetryInfo(this.post.persisted.id,this.stepType)&&n.each(this.post.persisted.messagesForPosting,((e,s)=>{const i=t.errorInfo||"Unknown",o=new ue.UrlPreviewFailed(t.url,a,i);G.track(o)}))}_updateMessagePropertiesWithUrlPreviewMetadata(e,t,s){const i=this.post.persisted.urlPreviewPropSet,r=n.cloneDeep(t);r.properties||(r.properties={});const a=I.MessageProperties.UrlPreviews,l=i?{[a]:i.urlPreviewJson}:r.properties;let d=I.getJsonFromMessageProperty(l,a);s&&(d?d.push(s):d=[s]);const c=JSON.stringify(d);if(G.log(Te,"Updating message properties with URLP metadata: "+this.post.persisted.id+(s&&s.value?", Initializing with:"+o.pii.Omit(JSON.stringify(s.value)):", Initializing with no data")),i){i.urlPreviewJson=c;const s=k.getCuidForMessage(t);b.default.setMessagePropertyLie(e,s,a,c)}else{r.properties[I.MessageProperties.UrlPreviews]=c;const t=r;this.post.persisted.messagesForPosting[e]=t,b.default.applyMessageLie(e,t)}}stop(e){super.stop(e)}_telemetryInfo(e){}}e.UrlPreviewsStep=t}(Ve||(Ve={})),function(e){e.EncryptionStepType="postingService_encryptPost";class s{static forPost(e,t,i){return k.isEncryptedThread(i)?new s(e,t,i):void 0}constructor(t,s,i){this.post=t,this.persisted=s,this.convId=i,this.stepType=e.EncryptionStepType,this.stepSelector=this.convId}checkForUpdate(){this.persisted.encryptionStatus||(this.persisted.encryptionStatus={}),this.persisted.encryptionStatus[this.convId]||(this.persisted.encryptionStatus[this.convId]=we.NotStarted);const e=this.persisted.encryptionStatus[this.convId];switch(e){case we.Success:return $e.Finished;case we.NotStarted:return $e.NeedTo.startSteps(this);case we.InProgress:return $e.NeedTo.waitForProgress(this);case we.Failure:return $e.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.encryptionStatus||(this.persisted.encryptionStatus={}),this.persisted.encryptionStatus[this.convId]||(this.persisted.encryptionStatus[this.convId]=we.NotStarted);const e=this.convId;this.persisted.encryptionStatus[this.convId]=we.InProgress,this._encryptPromise=b.default.getConversationMetaAsync(e).then((t=>{if(!t)return g.Rejected();const s=this.post.persisted.messagesForPosting[e];if(!s)return g.Rejected(`Can't find message for posting in conversation ${e}`);const i=this._mapToEncryptedType(s.messagetype);let o;if(i===I.MessageTypes.EncryptedMedia){const t=this.persisted.amsUploadEncryptionKey64,i=this.persisted.amsUploadEncryptionIV64,n=this.persisted.amsUploadEncryptionAuthKey64,r=this.persisted.amsUploadEncryptionHMAC64,a=this.persisted.amsUploadEncryptionHash64;if(!(t&&i&&n&&r&&a))return g.Rejected("Missing key material for encrypted media");const l={originalContent:s.content,fileKey64:t,fileIv64:i,fileAuthKey64:n,fileHMAC64:r,fileHash64:a};o=JSON.stringify(l),this._updateMessageWithFileKeys(e,this.post.persisted.messagesForPosting[e],{fileKey64:t,fileIv64:i,fileAuthKey64:n,fileHMAC64:r,fileHash64:a})}else o=s.content;return L.default.encryptMessageForConv(t.conv,o).then((t=>{const o=Object.assign(Object.assign({},s),{content:t.ciphertext,messagetype:i,fromdeviceid:N.default.getDeviceId(),encryptedkey:t.keys});this.post.persisted.messagesForPosting[e]=o,this.persisted.encryptionStatus[this.convId]=we.Success}))})).catch((t=>{const s=oe.default.errorAsString(t);this.persisted.encryptionStatus[this.convId]=we.Failure,G.error(Te,`Failed to encrypt post ${this.post.persisted.id} for conversation ${o.pii.Mri(e)}`,s),G.track(new F.E2eeEncryptionFailure(s)),B.default.sendReject(e,O.E2EERejectionReason.EncryptionFailed)})).finally((()=>{t.pokePost.fire(this.post.persisted.id)}))}stop(e){this._encryptPromise&&(this._encryptPromise.cancel(),this._encryptPromise=void 0),e&&this.persisted.encryptionStatus&&(this.persisted.encryptionStatus[this.convId]=we.NotStarted)}cleanup(){this.stop(!1)}_updateMessageWithFileKeys(e,t,s){const i=k.getCuidForMessage(t);b.default.setFileEncryptionKeys(e,i,s)}_mapToEncryptedType(e){switch(e){case I.MessageTypes.Media_GenericFile:case I.MessageTypes.UriObject:return I.MessageTypes.EncryptedMedia;case I.MessageTypes.Call:return I.MessageTypes.EncryptedCall;default:return I.MessageTypes.EncryptedText}}}e.EncryptMessageStep=s}(He||(He={})),function(e){e.FileEncryptionStepType="postingService_encryptFile";class s{static forPost(e,t){return k.isEncryptedThread(t.conversationIds[0])&&t.amsUploads&&t.amsUploads[0]?new s(e,t):void 0}constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.FileEncryptionStepType,this.persisted.fileEncryptionStatus=we.NotStarted}getAmsUpload(){return this.persisted.amsUploads[0]}checkForUpdate(){const e=this.persisted.fileEncryptionStatus;switch(e){case we.Success:return $e.Finished;case we.NotStarted:return $e.NeedTo.startSteps(this);case we.InProgress:return $e.NeedTo.waitForProgress(this);case we.Failure:return $e.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){this.persisted.fileEncryptionStatus=we.InProgress;const e=this.getAmsUpload(),s=rt(e.amsUploadFullData,e.amsFullDataLocalUrl).file,i=void 0===s.uri,o=i?s.path:s.uri,r=pe.default.newGuid()+".bin";this._encryptPromise=u.FileEncryption.getTempLocation(r).then((t=>{const a=new Uint8Array(d.getRandomValues(new Array(16))),l=new Uint8Array(d.getRandomValues(new Array(32))),c=new Uint8Array(d.getRandomValues(new Array(32))),h=n.toArray(l),p=n.toArray(a),g=n.toArray(c);let m;const S=Date.now();return(i?E.encryptFileInMemory(s,"aes-cbc",a,l,c).then((e=>(m=e.validation,new File([e.blob],r)))):u.FileEncryption.encryptFile(o,t,u.FileEncryption.getDefaultAlgo(),p,h,g).then((s=>(m=s,Object.assign(Object.assign({},e.amsUploadFullData.file),{name:r,type:"blob",uri:t}))))).then((e=>{G.log(Te,`File encryption took ${Date.now()-S}ms`),this.persisted.amsUploads=n.map(this.persisted.amsUploads,((s,i)=>0===i?at(s,t,{file:e,extension:"bin"},r,re.UploadFileType.File):s)),this.persisted.amsUploadEncryptionKey64=R.byteArrayToBase64String(h),this.persisted.amsUploadEncryptionIV64=R.byteArrayToBase64String(p),this.persisted.amsUploadEncryptionAuthKey64=R.byteArrayToBase64String(g),this.persisted.amsUploadEncryptionHMAC64=R.byteArrayToBase64String(m.hmac),this.persisted.amsUploadEncryptionHash64=R.byteArrayToBase64String(m.hash),this.persisted.fileEncryptionStatus=we.Success}))})).catch((e=>{const t=oe.default.errorAsString(e);this.persisted.fileEncryptionStatus=we.Failure,G.error(Te,`Failed to encrypt file for post ${this.post.persisted.id}`,t),G.track(new F.E2eeEncryptionFailure(t))})).finally((()=>{t.pokePost.fire(this.post.persisted.id)}))}stop(e){this._encryptPromise&&(this._encryptPromise.cancel(),this._encryptPromise=void 0),e&&(this.persisted.fileEncryptionStatus=we.NotStarted)}cleanup(){this.stop(!1)}}e.EncryptFileStep=s}(je||(je={})),function(e){e.VideoTranscodingStepType="postingService_transcodeVideo";class s{static forPost(e,t){const i=t.amsUploads&&t.amsUploads[0];return i&&me.default.shouldReencodeUpload(i.amsUploadFileType,i.videoOverlayUrl)?new s(e,t):void 0}constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.VideoTranscodingStepType,this._onReencodingProgressUpdate=(e,t)=>{this.persisted.transcodingSessionId===e&&(this.persisted.estimatedVideoUploadSize=t.estimatedSize,t.type===r.ReencodeProgressType.Fetch&&t.progress>0&&t.progress<1&&(this.persisted.wasFetchedFromiCloud=!0))},this.persisted.transcodingStatus&&this.persisted.transcodingStatus===Pe.Success||(this.persisted.transcodingStatus=Pe.NotStarted)}getAmsUpload(){return this.persisted.amsUploads[0]}setAmsUpload(e){this.persisted.amsUploads[0]=e}checkForUpdate(){const e=this.persisted.transcodingStatus;switch(e){case void 0:case Pe.Success:return $e.Finished;case Pe.NotStarted:return $e.NeedTo.startSteps(this);case Pe.InProgress:return $e.NeedTo.waitForProgress(this);case Pe.Failure:return $e.NeedTo.giveUpBecauseStep(this,x.FailureReason.Permanent);default:return pe.default.switchStatementExhaustiveChecking(e)}}start(){const e=pe.default.newCauseId();G.log(Te,"TranscodeVideoStep.start causeId:",e),this.persisted.transcodingStatus=Pe.InProgress;const s=this.getAmsUpload();if(me.default.shouldReencodeUpload(s.amsUploadFileType,s.videoOverlayUrl)){this._reencodeProgressSubscription=ge.videoManipulationProgressChangedEvent.subscribe(this._onReencodingProgressUpdate);const i=new Q.ReencodeSession;i.setTransactionID(this.persisted.transactionId),i.setVideoDuration(this.persisted.videoDuration||0),s.amsUploadFullData.dimensions&&i.setSourceDimensions(s.amsUploadFullData.dimensions),i.setSourceFileSize(s.amsUploadFullData.file.size||0),i.setHasOverlay(!!s.videoOverlayUrl);const o=rt(s.amsUploadFullData,s.amsFullDataLocalUrl).file,a=void 0===o.uri?o.path:o.uri,l=s.videoOverlayUrl||a,d=me.default.reencodeOptions(),c=ge.default.saveVideoWithoutView(a,l,d,e,i);this.persisted.transcodingSessionId=c.sessionId,c.manipulationPromise.then((t=>{t.sourceFileSize!==t.fileSize?(G.log(Te,`TranscodeVideoStep.start reencodeVideo success causeId: ${e}`),n.each(this.post.telemetryScenarios,(e=>{t.scenarioAttributes&&e.extendProperties(t.scenarioAttributes)}))):G.log(Te,"TranscodeVideoStep.start encoding looked like a noop");const i=Object.assign(Object.assign({},s.amsUploadFullData),{file:Object.assign(Object.assign({},s.amsUploadFullData.file),{uri:t.uri,size:t.fileSize}),dimensions:t.width&&t.height?{width:t.width,height:t.height}:void 0}),o=t.thumbnailUri?{file:{uri:t.thumbnailUri,name:H.default.extractFileName(s.amsUploadFilename)+"-thumbnail.jpg",size:void 0,type:"image/jpg"},extension:"jpg",dimensions:t.width&&t.height?{width:t.width,height:t.height}:void 0}:void 0;this.setAmsUpload(at(s,t.uri,i,void 0,void 0,t.thumbnailUri,o)),this.persisted.transcodingStatus=Pe.Success})).catch((t=>(G.warn(Te,oe.default.errorAsString(t)),G.log(Te,`TranscodeVideoStep.start error causeId: ${e}`),t&&t.code===r.ReencodeErrorType.TooLargeFile&&!n.isUndefined(d.maxFileSize)?(D.default.alertSizeTooBig(d.maxFileSize,s.amsUploadFullData.file.size||0,this.persisted.instrumentation_postSource,s.amsUploadFileType,!0),this.persisted.transcodingStatus=Pe.Failure,g.Resolved()):this._handleSkippedOrFailedTranscoding(s)))).finally((()=>{this._reencodeProgressSubscription&&this._reencodeProgressSubscription.unsubscribe(),G.log(Te,"TranscodeVideoStep success ",this.post.persisted.id),t.pokePost.fire(this.post.persisted.id)}))}else G.log(Te,"TranscodeVideoStep.start skipped reencoding"),this._handleSkippedOrFailedTranscoding(s).finally((()=>{t.pokePost.fire(this.post.persisted.id)}));t.pokePost.fire(this.post.persisted.id)}stop(e){this.persisted.transcodingStatus===Pe.InProgress&&this.persisted.transcodingSessionId&&ge.default.cancelSession(this.persisted.transcodingSessionId),this._reencodeProgressSubscription&&this._reencodeProgressSubscription.unsubscribe(),e&&(this.persisted.transcodingStatus=Pe.NotStarted)}cleanup(){this.stop(!1)}_handleSkippedOrFailedTranscoding(e){const t=V.default.getMaximumFileSizeForType(e.amsUploadFileType);return e.amsUploadFullData.file.size&&e.amsUploadFullData.file.size>t?(D.default.alertSizeTooBig(t,e.amsUploadFullData.file.size,this.persisted.instrumentation_postSource,e.amsUploadFileType,!0),G.warn(Te,"TranscodeVideoStep failing post because the file exceeds max size"),this.persisted.transcodingStatus=Pe.Failure,g.Resolved()):(this.persisted.transcodingStatus=Pe.Success,g.Resolved())}}e.TranscodeVideoStep=s}(ze||(ze={})),function(e){function t(e){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!0,canBlockOthersInConv:!0,convId:e}}function s(e,t,s){return $e.stepsToStartMightBeBlocked(t,(t=>{const n=t;if(n.stepType!==e.stepType)return!1;const r=n.post.findAnythingBlockingPost(n.post,n.convId);if(r){const t=function(e,t,s,i){const n=i.persisted.messagesForPosting[t]&&i.persisted.messagesForPosting[t].clientmessageid;return"Waiting to "+e+": "+s.persisted.id+", ConvId: "+o.pii.Mri(t)+", CMID: "+s.persisted.messagesForPosting[t].clientmessageid+", postTime: "+s.persisted.postTime+", blocked because post: "+i.persisted.id+", for CMID: "+n}(s,e.convId,e.post,r);G.log(Te,t)}const a=i(n.persisted,e.convId);if(r)void 0===a.lastBlockedStartTime&&(a.lastBlockedStartTime=Date.now());else if(void 0!==a.lastBlockedStartTime){const e=Date.now()-a.lastBlockedStartTime;a.totalBlockedTime=(a.totalBlockedTime||0)+e,a.lastBlockedStartTime=void 0}return!!r}))}function i(e,t){return e.messageSendingInfos||(e.messageSendingInfos={}),e.messageSendingInfos[t]||(e.messageSendingInfos[t]={}),e.messageSendingInfos[t]}function r(e){if(e.headers.location)return n.last(e.headers.location.split("/"))}function a(e,t,s,i,r,a,l,d){if(G.log(Te,t+" completed: "+e.post.persisted.id+", ConvId: "+o.pii.Mri(e.convId)+", success: "+a+", statustext: "+l.statusText+", from "+it(e)),a){const{contextId:t,date:o}=k.getTcidDataFromServerMessageResponse(l);!function(e,t,s,i,o,r,a,l,d){const c=e.persisted.messagesForPosting[s],u=k.getCuidForMessage(c),h=Date.now();g.all([g.fromThenable(ye.MessagesRepository.getMessageByCuid(s,u)),b.default.getConversationMetaAsync(s)]).then((([p,g])=>{if(o){if(b.default.confirmMessageSend(s,u,o,c.clientmessageid,r),!t.isForward&&!c.skypeeditedid&&S.default.getConfigSettingsNoSubscription().chat.forceChSetOnSend){const e=k.getCHIDForMessage(c),t=k.getConsumptionHorizonForMessageAndCHID(o,e);T.default.setConsumptionHorizon(s,t,!1)}if(!t.isForward&&!t.isDelete){const e=k.getCuidForMessage(c);$.default.maybeRequestTranslation(s,e,c)}}else G.warn(Te,"Was not given server ID for successfully posted message");const _=g?g.conv.getMemberCount():1;if(p&&p.isDeletedMessage())G.track(new X.MessageActionTelemetry(s,c,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Delete));else if(p&&p.isEdited())G.track(new X.MessageActionTelemetry(s,c,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Edit));else{let n=t.transmitStartTime,r=0,u=O.ChatServiceConnectionType.Unknown;t.messageSendingInfos&&t.messageSendingInfos[s]&&(n=t.messageSendingInfos[s].transmitStartTime,r=t.messageSendingInfos[s].totalBlockedTime||0,u=t.messageSendingInfos[s].connectionType||k.getConnectionTypeFromUrl(d));const p=e.persisted.postTime,g=n?n-p:0,S=n?h-n:h-p,f=i-1,y=se.default.getEndpointInfo(),v=(0,Ce.default)().getConversationNoSubscription(s),C=k.isOneOnOneConversation(s)&&v?v.getOtherPartyMri():void 0;G.track(new K.KpiMessageSent(s,c,_,g,r,S,f,t.rawContentLength,ie.default.EdfRegistrationId.get(),y,a,l,o,te.default.isInCall(),m.default.getBackgroundTime(p,h),m.default.hasAppStart(p,h),u,m.default.getPostingTrigger(),C))}p&&t.quoteAuthor&&!n.isUndefined(t.quotesTriggerType)&&G.track(new X.QuotesEventTelemetry(s,p,p.createdTime,X.MessageActionOrigin.PostingService,X.MessageActionType.Quote,t.quotesTriggerType,t.quotesMessageType))}))}(e.post,e.persisted,e.convId,s,i,r,t,o,l.url)}}function l(e){const t=function(e){if(404===e.statusCode&&e.headers&&e.headers.location)return!1;if(403===e.statusCode){const t=e.statusText||e.headers.statustext,s=t&&t.toLowerCase();if(!s||-1===s.indexOf("registration"))return!0}else if(nt(e)===k.ChatServiceErrors.UserInAnotherCloud)return!1;return}(e);if(void 0!==t)return t;const s=nt(e);return s===k.ChatServiceErrors.AccessDenied||s===k.ChatServiceErrors.InitiatorNotPartOfThread||s===k.ChatServiceErrors.ThreadNotFound||(404!==e.statusCode||s!==k.ChatServiceErrors.EndpointMissing)&&void 0}function d(e,t){return{step:Qe.MessagePosted,conversationIds:[t],attributes:{success:e}}}e.ChatPostTransferType="postingService_postChatMessage",e.ChatPostForegroundStepType="postingService_postChatMessageForeground",e.ActionNames={post:"PostChatMessage",edit:"EditChatMessage",delete:"DeleteChatMessage"},e.parseBackgroundContext=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class c extends De{constructor(){super(...arguments),this.convId=this.stepSelector,this.mightUnblockOthersInConv=this.convId}static forPost(t,s,i){if(et(!1)){if(Ze(i,s.messagesForPosting[i])){if(s.isDelete)return new p(t,s,e.ChatPostForegroundStepType,i);if(s.editedMessageServerId)return new h(t,s,e.ChatPostForegroundStepType,i)}return new u(t,s,e.ChatPostForegroundStepType,i)}}checkForUpdate(){return s(this,super.checkForUpdate(),this._actionName)}_config(){return t(this.convId)}_status(e){return e&&(this.persisted.messageForegroundRequests||(this.persisted.messageForegroundRequests={}),this.persisted.messageForegroundRequests[this.convId]||(this.persisted.messageForegroundRequests[this.convId]={finished:!1,finishedSuccess:!1})),this.persisted.messageForegroundRequests&&this.persisted.messageForegroundRequests[this.convId]}_startForegroundRequestOrFinish(){if(!tt())return;G.log(Te,this._actionName+": "+this.post.persisted.id+", ConvId: "+o.pii.Mri(this.convId)+", CMID: "+this.post.persisted.messagesForPosting[this.convId].clientmessageid+", in foreground");const e=this._createChatServiceReq(),t=i(this.persisted,this.convId);return t.scenario=e.scenario,t.transmitStartTime=Date.now(),T.default.performPostingServiceMessageRequest(e,P.PostMessageToConversationSource.MessagePost)}_handleResponse(e,t,s){if(e){i(this.persisted,this.convId).connectionType=k.getConnectionTypeFromUrl(t.url)}a(this,this._actionName,1,e?this._getMessageServerId(t):void 0,e?this._getMessageServerVersion(t):void 0,e,t)}_telemetryInfo(e){return d(e,this.convId)}_isPermanentFailure(e,t){const s=l(t);return void 0!==s?s:super._isPermanentFailure(e,t)}stop(e){super.stop(e)}}e.ChatPostForegroundStep=c;class u extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.post}_createChatServiceReq(){const e=this.post.persisted.messagesForPosting[this.convId];return w.postMessageToConversation(this.convId,e)}_getMessageServerId(e){return r(e)}_getMessageServerVersion(e){return this._getMessageServerId(e)}}e.ChatPostCreateForegroundStep=u;class h extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.edit}_createChatServiceReq(){const e=this.post.persisted.messagesForPosting[this.convId];return w.editMessage(this.convId,this.persisted.editedMessageServerId,e.messagetype,e.content)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.edittime:void 0}}e.ChatEditForegroundStep=h;class p extends c{constructor(){super(...arguments),this._actionName=e.ActionNames.delete}_createChatServiceReq(){return w.deleteMessage(this.convId,this.persisted.editedMessageServerId)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.deletetime:void 0}}e.ChatDeleteForegroundStep=p;class _ extends xe{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(t,s,i){if(Ze(i,s.messagesForPosting[i])){if(s.isDelete)return new v(t,s,e.ChatPostTransferType,i);if(s.editedMessageServerId)return new y(t,s,e.ChatPostTransferType,i)}return new f(t,s,e.ChatPostTransferType,i)}_config(){return t(this.convId)}transfer(){return this.persisted.messageBackgroundTransfers||(this.persisted.messageBackgroundTransfers={}),this.persisted.messageBackgroundTransfers[this.convId]}checkForUpdate(){if(this.persisted.messageForegroundRequests&&this.persisted.messageForegroundRequests[this.convId]&&this.persisted.messageForegroundRequests[this.convId].finishedSuccess)return $e.Finished;return s(this,super.checkForUpdate(),this._actionName)}_start(){this.persisted.messageBackgroundTransfers||(this.persisted.messageBackgroundTransfers={});const e=this.post.persisted.messagesForPosting[this.convId];G.log(Te,"Posting Message: "+this.post.persisted.id+", ConvId: "+o.pii.Mri(this.convId)+", CMID: "+this.post.persisted.messagesForPosting[this.convId].clientmessageid+", in background");const t=this.transfer(),s=this._createChatServiceReq(e),n=i(this.persisted,this.convId);n.scenario=s.scenario,n.transmitStartTime=Date.now();const r=T.default.performRequestBackground(this.stepType,{postId:this.post.persisted.id,convId:this.convId},s,be);this.persisted.messageBackgroundTransfers[this.convId]=this._createTrackedBackgroundTransfer(r,t)}_handleResponse(e,t,s){const i=this.transfer().finishedAttemptsSoFarCount,o=e?this._getMessageServerId(t):void 0,n=e?this._getMessageServerVersion(t):void 0;if(a(this,this._actionName,i,o,n,e,t),!e){const e=this.persisted.messageSendingInfos&&this.persisted.messageSendingInfos[this.convId]&&this.persisted.messageSendingInfos[this.convId].scenario||"postMessageToConversation",i={source:P.PostMessageToConversationSource[P.PostMessageToConversationSource.MessagePost]},o=k.getConnectionTypeFromUrl(t.url),n=s&&T.default.errorHandler.getRegistrationTokenFromHeaders(s),r=s&&T.default.errorHandler.getSkypetokenFromHeaders(s),a=(0,Ce.default)().getConversationNoSubscription(this.convId);T.default.errorHandler.handleChatServiceFailure("PostingServicePostMessage",t,r,n,void 0,{scenario:e,telemetryAttributes:i},o,a)}}stop(e){super.stop(e)}_isPermanentFailure(e,t){const s=l(t);return void 0!==s?s:super._isPermanentFailure(e,t)}_telemetryInfo(e){return d(e,this.convId)}}e.ChatPostTransferStep=_;class f extends _{constructor(){super(...arguments),this._actionName=e.ActionNames.post}_createChatServiceReq(e){return w.postMessageToConversation(this.convId,e)}_getMessageServerId(e){return r(e)}_getMessageServerVersion(e){return this._getMessageServerId(e)}}e.ChatPostCreateTransferStep=f;class y extends _{constructor(){super(...arguments),this._actionName=e.ActionNames.edit}_createChatServiceReq(e){return w.editMessage(this.convId,this.persisted.editedMessageServerId,e.messagetype,e.content)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.edittime:void 0}}e.ChatEditTransferStep=y;class v extends _{constructor(){super(...arguments),this._actionName=e.ActionNames.delete}_createChatServiceReq(e){return w.deleteMessage(this.convId,this.persisted.editedMessageServerId)}_getMessageServerId(e){return this.persisted.editedMessageServerId}_getMessageServerVersion(e){return e.body?e.body.deletetime:void 0}}e.ChatDeleteTransferStep=v}(We||(We={})),function(e){e.MessagePropSetTransferType="postingService_updateChatMessageProperties",e.parseBackgroundContext=function(e){if(e.postId&&e.convId)return{postId:e.postId,stepSelector:e.convId}};class t extends xe{constructor(){super(...arguments),this.convId=this.stepSelector}static forPost(s,i,o){if(i.urlPreviewPropSet)return new t(s,i,e.MessagePropSetTransferType,o)}_config(){return{needValidSkypeToken:!0,emptyResponse:!0,shimChatServiceResponse:!0,canBlockOthersInConv:!1,convId:this.convId}}transfer(){return this.persisted.urlPreviewPropSetTransfers||(this.persisted.urlPreviewPropSetTransfers={}),this.persisted.urlPreviewPropSetTransfers[this.convId]}_start(){this.persisted.urlPreviewPropSetTransfers||(this.persisted.urlPreviewPropSetTransfers={});const e=this.post.persisted.urlPreviewPropSet,t=this.transfer(),s=T.default.serviceSetMessagePropertyBackground(this.stepType,{postId:this.post.persisted.id,convId:this.convId},this.convId,e.messageId,I.MessageProperties.UrlPreviews,e.urlPreviewJson,!e.urlPreviewJson,Me);this.persisted.urlPreviewPropSetTransfers[this.convId]=this._createTrackedBackgroundTransfer(s,t)}_handleResponse(e,t,s){if(G.log(Te,"UpdateChatMessageProperties completed: "+this.post.persisted.id+", ConvId: "+o.pii.Mri(this.convId)+", success: "+e+", statustext: "+t.statusText),!e){const e=k.getConnectionTypeFromUrl(t.url),i=s&&T.default.errorHandler.getRegistrationTokenFromHeaders(s),o=s&&T.default.errorHandler.getSkypetokenFromHeaders(s),n=(0,Ce.default)().getConversationNoSubscription(this.convId);T.default.errorHandler.handleChatServiceFailure("PostingServiceMessagePropSet",t,o,i,void 0,{scenario:"setMessageProperty"},e,n)}}stop(e){super.stop(e)}_telemetryInfo(e){}}e.MessagePropSetStep=t}(Ge||(Ge={})),function(e){e.feedbackGathered=new p.default,e.FeedbackStepType="postingService_feedbackGatherLogs";class t{static forPost(e,s){if(s.feedbackSendLogs||s.feedbackSendScreenshot)return new t(e,s)}constructor(t,s){this.post=t,this.persisted=s,this.stepType=e.FeedbackStepType,this.persisted.isCollectingFeedbackFiles=!1}checkForUpdate(){return this.persisted.feedbackUploadMetadata?$e.Finished:this.persisted.isCollectingFeedbackFiles?$e.NeedTo.waitForProgress(this):$e.NeedTo.startSteps(this)}start(){this.persisted.isCollectingFeedbackFiles=!0;const e=[];let t;if(G.log(Te,"FeedbackHelper: attaching logs and/or screenshot"),a.default.supportsLogs()){const s=this._getScreenshotPathFromUri(this.persisted.feedbackScreenshotUri);t=a.default.zippedLogFileBundle(S.default.getDebugabilitySquad().brb_logs_history_secs,this.persisted.feedbackSendLogs,this.persisted.feedbackSendScreenshot,s).then((t=>{if(!t)return e;const s={file:t,extension:"blog"};return e.push({fileData:s,uploadSource:O.PostSource.Logs}),G.log(Te,"FeedbackHelper: Added Uri logs"),e}))}else t=g.Resolved([]);this._collectingFeedbackPromise=t,t.thenAsync((e=>{this._collectingFeedbackPromise===t&&this._handleResponse(e)}))}_getScreenshotPathFromUri(e){const t=he.default.getURIComponents(e);return e&&t&&t.pathname?"/"+t.pathname.slice(0,-1):e}_handleResponse(t){this.persisted.feedbackUploadMetadata=t;const s=[];n.each(t,(e=>{if(e.fileData){const t=U.default.encodeSessionContextInFilename(e.fileData.file.name,this.persisted.feedbackSessionId,e.fileData.extension);s.push(D.default.createUploadInfo(this.post.persisted.conversationIds,e.fileData,e.uploadSource,{filename:t}))}else G.error(Te,"Incorrect fileMetadata object")})),e.feedbackGathered.fire(this.post.persisted.id,s)}stop(e){this.persisted.isCollectingFeedbackFiles=!1,this._collectingFeedbackPromise&&(this._collectingFeedbackPromise.cancel(),this._collectingFeedbackPromise=void 0)}cleanup(){this.stop(!1)}}e.FeedbackStep=t}(Ke||(Ke={})),t.feedbackGathered=Ke.feedbackGathered,function(e){e.AmsCreateType=Be.AmsCreateTransferType,e.AmsCreateForegroundType=Be.AmsCreateForegroundStepType,e.AmsThumbnailType=Fe.AmsThumbnailTransferType,e.AmsThumbnailForegroundType=Fe.AmsThumbnailForegroundStepType,e.AmsFullDataType=Ne.AmsFullDataTransferType,e.AmsFullDataForegroundType=Ne.AmsFullDataForegroundStepType,e.AzureDataType=Ee.AzureDataTransferType,e.AmsGetStatusForwardType=Oe.AmsGetStatusForwardTransferType,e.AmsGetStatusForwardUploadType=Oe.AmsGetStatusForwardUploadTransferType,e.AmsForwardContentType=Ue.AmsForwardContentTransferType,e.AmsForwardContentUploadType=Ue.AmsForwardContentUploadTransferType,e.UrlPreviewsType=Ve.UrlPreviewsTransferType,e.EncryptMessageType=He.EncryptionStepType,e.FileEncryptionStepType=je.FileEncryptionStepType,e.VideoTranscodingStepType=ze.VideoTranscodingStepType,e.ChatPostType=We.ChatPostTransferType,e.ChatPostForegroundType=We.ChatPostForegroundStepType,e.MessagePropSetType=Ge.MessagePropSetTransferType,e.FeedbackType=Ke.FeedbackStepType}(qe||(qe={})),t.AllBackgroundTransferTypes=[qe.AmsCreateType,qe.AmsThumbnailType,qe.AmsFullDataType,qe.AzureDataType,qe.AmsGetStatusForwardType,qe.AmsGetStatusForwardUploadType,qe.AmsForwardContentType,qe.AmsForwardContentUploadType,qe.UrlPreviewsType,qe.ChatPostType,qe.MessagePropSetType],t.AllForegroundTransferTypes=[qe.AmsCreateForegroundType,qe.AmsThumbnailForegroundType,qe.AmsFullDataForegroundType,qe.ChatPostForegroundType],t.ChatPostActionNames=We.ActionNames,t.TransferTypeToPostingTransferSource={[qe.AmsCreateType]:O.PostingTransferSource.AMSCreate,[qe.AmsCreateForegroundType]:O.PostingTransferSource.AMSCreate,[qe.AmsThumbnailType]:O.PostingTransferSource.AMSUploadThumbnail,[qe.AmsThumbnailForegroundType]:O.PostingTransferSource.AMSUploadThumbnail,[qe.AmsFullDataType]:O.PostingTransferSource.AMSUploadContent,[qe.AmsFullDataForegroundType]:O.PostingTransferSource.AMSUploadContent,[qe.AzureDataType]:O.PostingTransferSource.Azure,[qe.AmsGetStatusForwardType]:O.PostingTransferSource.AMSGetStatus,[qe.AmsGetStatusForwardUploadType]:O.PostingTransferSource.AMSGetStatus,[qe.AmsForwardContentType]:O.PostingTransferSource.AMSForward,[qe.AmsForwardContentUploadType]:O.PostingTransferSource.AMSForward,[qe.UrlPreviewsType]:O.PostingTransferSource.URLPreview,[qe.ChatPostType]:O.PostingTransferSource.ChatService,[qe.ChatPostForegroundType]:O.PostingTransferSource.ChatService,[qe.MessagePropSetType]:O.PostingTransferSource.ChatServiceUpdateProperties},function(e){e[e.GotPostFromPersistentStore=0]="GotPostFromPersistentStore",e[e.AmsDocumentCreated=1]="AmsDocumentCreated",e[e.AmsFullContentUploaded=2]="AmsFullContentUploaded",e[e.AmsThumbContentUploaded=3]="AmsThumbContentUploaded",e[e.AzureUploadCompleted=4]="AzureUploadCompleted",e[e.Forwarded=5]="Forwarded",e[e.ForwardedUpload=6]="ForwardedUpload",e[e.AmsGotStatusForward=7]="AmsGotStatusForward",e[e.AmsGotStatusForwardUpload=8]="AmsGotStatusForwardUpload",e[e.AmsGotStatusServerTranscoding=9]="AmsGotStatusServerTranscoding",e[e.MessagePosted=10]="MessagePosted",e[e.MessagePostingFailed=11]="MessagePostingFailed"}(Qe||(t.PostMessageScenarioStep=Qe={})),function(e){e[e.Finished=0]="Finished",e[e.InProgress=1]="InProgress",e[e.Blocked=2]="Blocked",e[e.Update=3]="Update",e[e.GiveUp=4]="GiveUp"}(Xe||(t.CheckForNeededWorkResult=Xe={})),function(e){const t={kind:Xe.Finished};function s(...e){return{kind:Xe.Blocked,blocked:e}}function i(t,s){if(0===t.length)return e.Finished;return t.reduce(((e,t)=>{let i;e.kind===Xe.Finished?i=!0:t.kind===Xe.Finished?i=!1:e.kind===Xe.GiveUp?i=s:t.kind===Xe.GiveUp?i=!s:e.kind===Xe.InProgress?i=!0:t.kind===Xe.InProgress?i=!1:e.kind===Xe.Blocked?i=!0:t.kind===Xe.Blocked?i=!1:e.kind!==Xe.Update?(pe.default.switchStatementExhaustiveChecking(e.kind),i=!0):t.kind!==Xe.Update?(pe.default.switchStatementExhaustiveChecking(t.kind),i=!1):i=!1;return o(i?t:e,i?e:t)}))}function o(e,t){return Object.assign(Object.assign({},e),{inProgress:n.union(e.inProgress,t.inProgress),blocked:n.union(e.blocked,t.blocked),start:n.union(e.start,t.start),failure:n.union(e.failure,t.failure)})}e.Finished=t,e.NeedTo={waitForProgress:function(...e){return{kind:Xe.InProgress,inProgress:e}},waitBecauseBlocked:s,startSteps:function(...e){return{kind:Xe.Update,start:e}},giveUpBecauseStep:function(e,t){return{kind:Xe.GiveUp,failure:[{stepType:e.stepType,failureReason:t}]}}},e.stepsToStartMightBeBlocked=function(e,t){if(!e.start)return e;const[r,a]=n.partition(e.start,(e=>t(e)));if(0===r.length)return e;const l=Object.assign(Object.assign({},e),{start:a});return e.kind===Xe.Update&&0===a.length?o(s(...r),l):i([l,s(...r)],!1)},e.dontGiveUp=function(t){return t.kind===Xe.GiveUp?o(e.Finished,t):t},e.findWorkWithLowPriorityFinished=function(t){let s;return n.each(t,(e=>(s=e.checkForUpdate(),s.kind===Xe.Finished&&void 0))),s||e.Finished},e.reduceWithLowPriorityGiveUp=function(e){return i(e,!0)},e.reduceWithHighPriorityGiveUp=function(e){return i(e,!1)},e.getFailureReason=function(e){const t=n.maxBy(e.failure,(e=>e.failureReason));return t?t.failureReason:x.FailureReason.None}}($e||(t.Test_CheckForUpdate=$e={})),function(e){function t(e,t,s){const i=e.persisted.messagesForPosting[t],o=Object.assign(Object.assign({},i),{amsreferences:s});e.persisted.messagesForPosting[t]=o}e.updateAmsCreateReferences=function(e){const s=e.getPersistedActionData(),i=s.amsDocumentIds&&n.compact(n.values(s.amsDocumentIds));n.each(e.persisted.conversationIds,(s=>{t(e,s,i)}))},e.updateAmsForwardUploadReferences=function(e,s){const i=e.getPersistedActionData(),o=i.amsForwardDocumentIds&&i.amsForwardDocumentIds[s];t(e,s,o?[o]:void 0)},e.updateAmsForwardObjectsReferences=function(e){const s=e.getPersistedActionData(),i=n.compact(n.values(s.amsForwardDocumentIds));n.each(e.persisted.conversationIds,(s=>{t(e,s,i)}))}}(Je||(Je={})),function(e){function t(e,t){return n.find(e,(e=>e.objectId===t))}e.updateMessageUrls=function(e,s,i,o,r){var a,l;const d=e.getPersistedActionData();let c;const u=e.isUploadNeeded();if(u||!d.swiftMessageDecoded&&!n.isEmpty(d.forwardMediaInfos)){let r,h=!1;if(u){if(n.size(n.compact(n.values(d.amsDocumentIds)))!==n.size(d.amsUploads))return;const{enableMediaFileRedesign:t}=S.default.getS4LMessagingFeaturesNoSubscription(),s=n.map(d.amsUploads,((s,o)=>{var n,r;const a=d.amsDocumentIds[o],l=y.getDocumentUrls(a,s.amsUploadFileType),c=s.originalFileName||s.amsUploadFilename,u=s.originalUploadFileType||s.amsUploadFileType,h=V.default.getAmsUploadFileSize(s);let p,g=_e.UriObjectNode.sanitizeUrl(s.originalFullDataLocalUrl||s.amsFullDataLocalUrl,!0);t&&g&&fe.default.addFileInformationForTracking(a,g,c),s.amsUploadFileType===re.UploadFileType.AudioMessage&&(p=s.audioDurationMs);const m=null===(r=e.persisted.messagesForPosting[null===(n=null==e?void 0:e.persisted.conversationIds)||void 0===n?void 0:n[0]])||void 0===r?void 0:r.content,S=(0,ve.getContainerIdFromContent)(m);return D.default.getMediaEntity(l.original,l.preview,l.fallback,i,u,e.persisted.title,c,h,s.amsUploadFullData.dimensions,a,p,S)}));d.textWithUploadIndexes?(r=n.map(d.textWithUploadIndexes,(e=>n.isString(e)?new z.UnhandledEntity(e):n.isNumber(e)?s[e]:pe.default.switchStatementExhaustiveChecking(e))),h=!0):r=s}else{const n=t(d.forwardMediaInfos,o),c=y.getDocumentUrls(s,n.fileType),u=null===(l=e.persisted.messagesForPosting[null===(a=null==e?void 0:e.persisted.conversationIds)||void 0===a?void 0:a[0]])||void 0===l?void 0:l.content,h=(0,ve.getContainerIdFromContent)(u);r=[D.default.getMediaEntity(c.original,c.preview,c.fallback,i,n.fileType,e.persisted.title,n.filename,n.fileSize,n.dimensions,s,n.durationMs,h)]}const p=e.persisted.callId?[new z.CallReactionMetadataEntity(e.persisted.callId)]:[],g=r.concat(p),m=W.encode(g,h);c={},n.each(e.persisted.messagesForPosting,((e,t)=>{c[t]=m}))}else c=d.swiftMessageDecoded?function(e,t,s,i){n.each(s.attachments,(e=>{!function(e,t,s){n.each(e.content.images,(e=>{e.url&&(e.url=e.url.replace(t,s))})),e.content.image&&e.content.image.url&&(e.content.image.url=e.content.image.url.replace(t,s));n.each(e.content.items,(e=>{e.image&&e.image.url&&(e.image.url=e.image.url.replace(t,s))})),n.each(e.content.media,(e=>{e.url&&(e.url=e.url.replace(t,s))}))}(e,t.objectId,i)}));const o={};return n.each(e.persisted.messagesForPosting,((e,t)=>{o[t]=W.encode([new z.SwiftUriObjectEntity(s,t,!0,s.summary)],!1)})),o}(e,t(d.forwardMediaInfos,o),d.swiftMessageDecoded,s):{};r&&(c={[r]:c[r]}),n.each(c,((t,s)=>{const i=n.cloneDeep(e.persisted.messagesForPosting[s]);i.content=c[s],e.persisted.messagesForPosting[s]=i}))},e.getForwardMessageMediaInfo=t}(Ye||(Ye={}));let dt=!0},235972:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.test_migrateAmsUploadIfNeeded=ee;const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(819059)),a=(s(279211),i.__importDefault(s(22404))),l=(i.__importStar(s(516778)),i.__importDefault(s(974634))),d=i.__importStar(s(397691)),c=i.__importDefault(s(861216)),u=i.__importDefault(s(150343)),h=i.__importDefault(s(532803)),p=i.__importDefault(s(404547)),g=i.__importStar(s(964647)),m=i.__importDefault(s(304623)),S=i.__importStar(s(971988)),_=i.__importStar(s(44717)),f=s(154235),y=i.__importDefault(s(487110)),v=i.__importDefault(s(615364)),C=i.__importDefault(s(393921)),T=i.__importDefault(s(601976)),M=i.__importDefault(s(36615)),b=s(815146),I=i.__importDefault(s(804536)),w=i.__importDefault(s(606617)),P=i.__importDefault(s(128522)),k=i.__importStar(s(85385)),A=i.__importDefault(s(353010)),x=s(943610),D=i.__importDefault(s(221837)),R=i.__importStar(s(786531)),L=i.__importDefault(s(363091)),B=s(352549),F=i.__importDefault(s(591371)),N=s(822701),E=i.__importDefault(s(163374)),O=i.__importDefault(s(960282)),U=i.__importDefault(s(782829)),V=i.__importDefault(s(902530)),H=i.__importStar(s(446574)),j=s(331079),z=i.__importStar(s(340482)),W=i.__importDefault(s(601274)),G=i.__importStar(s(517518)),K=s(911016),q=i.__importDefault(s(685734)),Q=i.__importDefault(s(760989)),X=i.__importDefault(s(400836)),$=s(717413),J=i.__importDefault(s(92477)),Y=s(922069),Z=b.LogTraceArea.PostingService;function ee(e){if(e.amsUploadFileType&&!e.amsUploads){e.amsUploads=[{originalUploadFileType:e.originalUploadFileType,originalFileName:e.originalFileName,amsUploadFileType:e.amsUploadFileType,amsUploadFilename:e.amsUploadFilename,amsUploadFullData:e.amsUploadFullData,amsFullDataLocalUrl:e.amsFullDataLocalUrl,amsFullDataCacheInfo:e.amsFullDataCacheInfo,amsUploadThumbnailData:e.amsUploadThumbnailData,amsThumbnailLocalUrl:e.amsThumbnailLocalUrl,amsThumbnailCacheInfo:e.amsThumbnailCacheInfo}];const t=e;delete t.amsUploadFileType,delete t.originalFileName,delete t.originalUploadFileType,delete t.amsUploadFilename,delete t.amsUploadFullData,delete t.amsFullDataLocalUrl,delete t.amsFullDataCacheInfo,delete t.amsUploadThumbnailData,delete t.amsThumbnailLocalUrl,delete t.amsThumbnailCacheInfo;const s=[["amsCreateDocumentBackgroundId","amsCreateDocumentBackgroundIds"],["amsCreateDocumentForegroundRequest","amsCreateDocumentForegroundRequests"],["amsCreateDocumentBackgroundTransfer","amsCreateDocumentBackgroundTransfers"],["amsDocumentId","amsDocumentIds"],["amsThumbnailBackgroundId","amsThumbnailBackgroundIds"],["amsThumbnailDocumentForegroundRequest","amsThumbnailDocumentForegroundRequests"],["amsThumbnailBackgroundTransfer","amsThumbnailBackgroundTransfers"],["amsFullDataBackgroundId","amsFullDataBackgroundIds"],["amsFullDataDocumentForegroundRequest","amsFullDataDocumentForegroundRequests"],["amsFullDataBackgroundTransfer","amsFullDataBackgroundTransfers"],["instrumentation_uploadStartTime","instrumentation_uploadStartTimes"],["azureBackgroundTransfer","azureBackgroundTransfers"],["azureMSUrl","azureMSUrls"]];n.each(s,(t=>{const[s,i]=t;s in e&&(e[i]||(e[i]={}),e[i][0]=e[s],delete e[s])}))}return e}t.default=new class{constructor(){this._lastPostTime=0,this._posts={},this._postsActivelyWorking={},this._postsCleaningUp={},this._postStartTimeThisRun={},this._scenarioCache={},this._checkForNeededWorkQueue={},this.postCreated=new l.default,this.postUpdated=new l.default,this.transferFinished=new l.default,this.allPostsFinished=new l.default,this.getPostByLocalUrl=e=>{const t=n.find(this._posts,(t=>t.isMyLocalUrl(e)));return t&&t.getPersistedActionData()},this.getLocalUrlsForPost=e=>{const t=this._posts[e];return t&&t.getMyLocalUrls()},this.debug_allPosts=()=>this._posts,this.debug_allPostsCleaningUp=()=>n.mapValues(this._postsCleaningUp,(e=>e.post)),this.debug_allPostsFailedRetryInfo=()=>{const e={};return n.each(this._posts,(t=>{const s=t.debug_allPostsFailedRetryInfo();s&&(e[t.persisted.id]=s)})),e},this.test_resetBackoff=()=>{this._resetBackoffs("Tests"),this._seeIfAnythingNeedsDoing()},this.cancelPostMessage=(e,t)=>{const s=n.find(this._posts,(s=>n.some(s.persisted.messagesForPosting,((s,i)=>i===e&&s.clientmessageid===t))));return s?(k.log(Z,"Canceling CMID: "+t+", ConvId: "+o.pii.Mri(e)+", found post: "+s.persisted.id),this._cancel(s),!0):(k.warn(Z,"Attempted to cancel CMID "+t+" but no pending message post found!"),!1)},this.test_cancelPost=e=>{const t=this._posts[e]||this._postsCleaningUp[e]&&this._postsCleaningUp[e].post;return k.log(Z,"Test canceling post: "+e+", found: "+!!t+", during cleanup: "+!(!t||!t.persisted.isCleaningUp)),t&&this._cancel(t)},H.RegisterStartupable(this,"PostingTransferService",[h.default,p.default,m.default,C.default,M.default,P.default,F.default,E.default,G.default])}startup(){c.default.init(this.postCreated,this.postUpdated,this.allPostsFinished,(()=>!n.isEmpty(this._posts))),E.default.subscribe((()=>{E.default.isNetworkingAvailable()&&(this._resetBackoffs("ReportedConnectivityStore"),this._seeIfAnythingNeedsDoing())})),p.default.reconnected.subscribe((()=>{this._resetBackoffs("ChatService.reconnected"),this._seeIfAnythingNeedsDoing()})),G.default.subscribe((()=>{G.default.hasUsableSkypeToken()&&this._seeIfAnythingNeedsDoing()}),G.TriggerKeys.SkypeTokenKey);const e=(e,t)=>n.find(this._posts,(s=>s!==e&&(!(s.persisted.postTime>e.persisted.postTime)&&!(!n.some(s.persisted.conversationIds,(e=>e===t&&!s.isPostedToChat(t)))||s.persisted.nonBlocking))));F.default.subscribe(K.PostingActionType,((t,s)=>{const i=n.sortBy(t,(e=>e.postTime));if(n.each(i,(t=>{k.log(Z,"Tracking Post: "+t.id+(s?", "+this._logStringForMessagePost(t,s):"")),t.postTime||(t.postTime=this._getNextPostTime()),t.forwardMediaInfo&&!t.forwardMediaInfos&&(t.forwardMediaInfos=[t.forwardMediaInfo]),t.instrumentation_uploadSource&&(t.instrumentation_postSource=t.instrumentation_uploadSource,t.instrumentation_uploadSource=void 0),function(e){!e.feedbackSendLogsAndScreenshot||e.feedbackSendLogs||e.feedbackSendScreenshot||(e.feedbackSendLogs=e.feedbackSendLogsAndScreenshot,e.feedbackSendScreenshot=e.feedbackSendLogsAndScreenshot)}(t),ee(t),function(e){const t=[e.amsCreateDocumentBackgroundTransfers,e.amsForwardBackgroundTransfers,e.amsFullDataBackgroundTransfers,e.amsGetStatusBackgroundTransfers,e.amsThumbnailBackgroundTransfers,e.azureBackgroundTransfers,e.messageBackgroundTransfers,e.urlPreviewBackgroundTransfer];n.each(t,(e=>{n.each(e,(e=>{y.default.migrateTransfer(e)}))}))}(t);const i=new x.Post(t,!s,e);if(this._postStartTimeThisRun[i.persisted.id]=Date.now(),i.persisted.isCleaningUp)return i.persisted.isCleaningUp=!1,void this._removeAndCheckForNeededCleanup(i);this._pruneScenarioCache(),n.each(i.telemetryScenarios,((e,t)=>{const s=i.persisted.messagesForPosting[t],o=_.getCuidForMessage(s);this._scenarioCache[t]?this._scenarioCache[t][o]=e:this._scenarioCache[t]={[o]:e}})),this._posts[i.persisted.id]=i,this._checkForNeededWork(i.persisted.id),i.markTelemetryStepCompleted(x.PostMessageScenarioStep.GotPostFromPersistentStore),this.postUpdated.fire(i.getPersistedActionData())})),s&&t.length){const t=n.mapValues(this._posts,(t=>n.filter(t.persisted.conversationIds,(s=>!e(t,s))))),s=n.pickBy(t,(e=>e.length));k.log(Z,"Earliest post to convs: "+n.map(s,((e,t)=>t+": ["+n.map(e,(e=>o.pii.Mri(e)))+"]")).join(", "))}}));const t=(e,t,i,n,r,a)=>{const l=(0,x.postIdFromContext)(t);if(!l)return void(this._postsCleaningUp[t]||k.warn(Z,"Failed to parse context for "+a+" (probably old -> ignoring): "+o.pii.Omit(JSON.stringify(t))));const d=this._posts[l];if(!d)return void(this._postsCleaningUp[l]||k.warn(Z,"Got "+a+" for missing Post: "+l+", context: "+o.pii.Omit(JSON.stringify(t))));const c=d.handleResponse(e,t,i,n,r,a);if(!c)return void(this._postsCleaningUp[l]||k.warn(Z,"Got "+a+" for known post but failed to update: "+l+", context: "+o.pii.Omit(JSON.stringify(t))));if(!(i=c.success)&&c.canRetry&&c.retryInfo&&W.default.setExpiration((()=>{this._posts[d.persisted.id]&&this._checkForNeededWork(d.persisted.id)}),c.retryInfo.nextAttempt),c.permanentFailure){if(c.convId){const e=p.default.getChatServiceErrorResponseMetadata(n),t=c.convId&&d.persisted.messagesForPosting[c.convId],s={message_type:t&&z.getMessageTypeName(t,L.default.getSkypeMri(),c.convId),error_code:e.errorCode,status_code:n.statusCode};d.markTelemetryStepCompleted(x.PostMessageScenarioStep.MessagePostingFailed,[c.convId],s,c.finishedAttemptsSoFarCount)}this.postUpdated.fire(d.getPersistedActionData())}const u=x.TransferTypeToPostingTransferSource[a];this.transferFinished.fire(d.getPersistedActionData(),u,c,n,r,c.convId,c.fileSize),c.telemetryInfo&&d.markTelemetryStepCompleted(c.telemetryInfo.step,c.telemetryInfo.conversationIds,c.telemetryInfo.attributes,c.finishedAttemptsSoFarCount),s(d,c.mightUnblockOthersInConv?c.convId:void 0)},s=(e,t)=>{this._postUpdated(e),this._checkForNeededWork(e.persisted.id),t&&this._seeIfAnythingElseInConvNeedsDoing(e,t)};return n.each(x.AllBackgroundTransferTypes,(e=>{h.default.subscribe(e,t)})),x.foregroundResponse.subscribe(t),x.pokePost.subscribe(((e,t)=>{const i=this._posts[e];i&&s(i,t)})),x.feedbackGathered.subscribe(((e,t)=>{const s=this._posts[e];if(s){const e=n.map(t,(e=>e.then((e=>e),(()=>{}))));d.all(e).then((e=>{n.each(e,(e=>{e&&this.startPost(e,{name:B.ScenarioName.SendMessage})}))})),this._postUpdated(s),this._checkForNeededWork(s.persisted.id)}})),Promise.resolve()}_pruneScenarioCache(){n.each(this._scenarioCache,((e,t)=>{n.each(e,((t,s)=>{t.isResolved()&&!t.hasUnresolvedSecondaryScenarios()&&delete e[s]})),n.isEmpty(e)&&delete this._scenarioCache[t]}))}getTelemetryScenarioForMessage(e,t){this._pruneScenarioCache();const s=this._scenarioCache[e];return s&&s[t]}startPost(e,t,s,i){let r;if(e.kind===N.PostMessageInfoKind)D.default.notifyMessageReachedPostingTransferService(e.messageForPosting.clientmessageid),r=this._postMessageFromInfo(e);else{if(e.kind!==N.PostUploadInfoKind)return k.error(Z,"Unknown retry info",o.pii.Omit(e)),Q.default.switchStatementExhaustiveChecking(e);t&&e.amsUploads&&e.amsUploads.length>0&&e.amsUploads[0].amsUploadFileType===j.UploadFileType.File&&(t.name=B.ScenarioName.SendFile),r=this._postUploadFromInfo(e,t&&t.transactionId)}t&&(r.scenarioInfo=Object.assign(Object.assign({},t),{startTime:Date.now()})),this.postCreated.fire(r);F.default.persistAndStartAction(K.PostingActionType,r);let a;e.kind===N.PostMessageInfoKind?a=e.postSource:e.kind===N.PostUploadInfoKind&&(a=e.uploadSource),n.each(r.conversationIds,(e=>{this._donateConversationForShareSuggestions(e),this._trackMessageSent(e,r.messagesForPosting[e],r,a,s,i)}))}_donateConversationForShareSuggestions(e){const t=T.default.getDisplayableProfile(e);if(t){const s=t.getDisplayName(),i=t.getAvatarUrl(),o=_.isEncryptedThread(e),n=_.isConversationWithPhoneNumber(e),r=_.isAgent(e);!s||o||n||r||a.default.donateConversationForShareSuggestion(e,s,i)}}_trackMessageSent(e,t,s,i,o,n){var r,a;if(t.skypeeditedid)return;const l=(0,v.default)().getConversation(e),d=(0,$.isMagicBotContainingConversation)(l),c=this._getMessageReceiverMri(l),u=!!c&&this._isReceiverShortCircuitContact(c);let h;c&&(h=_.splitMri(c).id);const p=_.isOneOnOneConversation(e)&&l?l.getOtherPartyMri():void 0;k.track(new R.MessageSent(e,t,u,s.rawContentLength||0,i,V.default.EdfRegistrationId.get(),U.default.getEndpointId(),c,h,s.nonBlocking,o,O.default.getDeviceOrientation(f.MainRootViewId),A.default.isPiPEnabled()?!!A.default.getContentProps():void 0,n&&n.messageComposerAction,n&&n.contentType,n&&n.messageDurationMs,d,null!==(a=null===(r=s.quotesRawMessageContent)||void 0===r?void 0:r.length)&&void 0!==a?a:0,p)),J.default.addAppRatingMetric(1,Y.AppRatingMetric.MESSAGE_SENT),S.isMessageSms(t.messagetype)&&X.default.trackCallerIdOnSMSSent(t)}_postMessageFromInfo(e){const{conversationId:t,messageForPosting:s}=e,i={postTime:this._getNextPostTime(),editedMessageCuid:e.editedMessageCuid,conversationIds:[t],conversationAcceptedInfos:{[t]:e.conversationAcceptedInfo},instrumentation_postSource:e.postSource,instrumentation_conversationOrigin:e.conversationOrigin,messagesForPosting:{[t]:s},urlPreviewPropSet:e.urlPreviewPropSet,transactionId:Q.default.newGuid(),forwardMediaInfo:e.forwardMediaInfo,forwardMediaInfos:e.forwardMediaInfos,swiftMessageDecoded:e.swiftMessageDecoded,urlPreviewEndpoints:e.urlPreviewEndpoints,rawContentLength:e.rawContentLength,quoteAuthor:e.quoteAuthor,quotesTriggerType:e.quotesTriggerType,quotesMessageType:e.quotesMessageType,quotesRawMessageContent:e.quotesRawMessageContent,isForward:e.isForward,showLocalNotificationOnFailure:e.showLocalNotificationOnFailure,editedMessageServerId:e.editedMessageServerId,editedMessageVersion:e.editedMessageVersion,isDelete:e.isDelete},o=e.shouldSendLogsAndScreenshot||e.shouldSendLogs,r=e.shouldSendLogsAndScreenshot||e.shouldSendScreenshot;let a;if((o||r)&&(i.feedbackSessionId=I.default.getCurrentSessionId(),i.feedbackScreenshotUri=e.screenshotUri,i.feedbackSendLogs=o,i.feedbackSendScreenshot=r),k.log(Z,this._logStringForMessagePost(i,!1)),a=S.isEventCallEndedMessageType(s)?Object.assign(Object.assign({},s),{skypeeditedid:void 0,version:i.editedMessageVersion}):Object.assign(Object.assign({},s),{version:i.editedMessageVersion}),e.editedMessageCuid&&e.urlPreviewPropSet)m.default.applyMessageLieWithPropertyLie(t,a,S.MessageProperties.UrlPreviews,e.urlPreviewPropSet.urlPreviewJson);else if(n.isUndefined(e.editedMessageCuid)&&n.isUndefined(e.editedMessageServerId)&&n.isUndefined(e.editedMessageVersion)){const e=(0,v.default)().getConversation(t),s=Math.max(Date.now(),e?e.getTimestamp()+1:0);m.default.applyMessageLieAndNotifyPrematurely(t,s,a)}else m.default.applyMessageLie(t,a);return i}_postUploadFromInfo(e,t){const s=e.amsUploads?[...e.amsUploads]:[{amsUploadFileType:e.amsUploadFileType,amsUploadFilename:e.amsUploadFilename,amsUploadFullData:e.amsUploadFullData,amsFullDataLocalUrl:e.amsFullDataLocalUrl,amsFullDataCacheInfo:e.amsFullDataCacheInfo,amsUploadThumbnailData:e.amsUploadThumbnailData,amsThumbnailLocalUrl:e.amsThumbnailLocalUrl,amsThumbnailCacheInfo:e.amsThumbnailCacheInfo}],i={postTime:this._getNextPostTime(),conversationIds:e.conversationIds,conversationAcceptedInfos:e.conversationAcceptedInfos,amsUploads:s,textWithUploadIndexes:e.textWithUploadIndexes,transactionId:t||Q.default.newGuid(),messagesForPosting:e.messagesForPosting,rawContentLength:0,callId:e.callId,title:e.title,instrumentation_postSource:e.uploadSource,instrumentation_conversationOrigin:e.conversationOrigin};return e.toastMessageToShowOnSuccess&&(i.toastMessageToShowOnSuccess=e.toastMessageToShowOnSuccess),e.toastMessageToShowOnFailure&&(i.toastMessageToShowOnFailure=e.toastMessageToShowOnFailure),e.shouldTrackUpload&&(i.shouldTrackUpload=e.shouldTrackUpload),k.log(Z,this._logStringForMessagePost(i,!1)),n.each(e.conversationIds,(e=>{m.default.applyMessageLie(e,i.messagesForPosting[e])})),i}_logStringForMessagePost(e,t){const s=n.find(e.messagesForPosting),i=s&&s.skypeeditedid,r=e.isDelete,a=r||!(!e.editedMessageServerId&&!i),l=n.map(e.amsUploads,(e=>{let t="";const s=e.amsUploadFullData;if(s){t+=", amsUploadFileSize: "+s.file.size+", ams upload ext: "+(s.extension||w.default.extractFileExtension(e.amsUploadFilename))}let i="";const o=e.amsUploadThumbnailData;if(o){i+=", amsThumbnailFileSize: "+o.file.size+", ams thumbnail ext: "+(o.extension||w.default.extractFileExtension(o.file.name))}return"(amsUploadFileType: "+e.amsUploadFileType+t+i+")"}));return(t?"Restored ":"New ")+(l.length?"upload":"message")+": ConvId/CMID: ["+n.map(e.messagesForPosting,((e,t)=>o.pii.Mri(t)+"/"+e.clientmessageid)).join(", ")+"], message action: "+(a?r?x.ChatPostActionNames.delete:x.ChatPostActionNames.edit:x.ChatPostActionNames.post)+(a?", previous message ids: "+i+"|"+e.editedMessageServerId:"")+(l.length?", uploads: ["+l.join(", ")+"]":"")}_isReceiverShortCircuitContact(e){const t=q.default.getFullUserProfileByMri(e);return!!t&&!!t.isSuggested}_getMessageReceiverMri(e){if(e&&e.isOneOnOne())return e.getOtherPartyMri()}_getPostInfo(e){if(e.persisted.permanentFailureTransferType)return;const t=e.getPersistedActionData();if(e.isUploadNeeded()){const e=t.amsUploads;return{kind:"postUpload",conversationIds:t.conversationIds,amsUploads:e,textWithUploadIndexes:t.textWithUploadIndexes,messagesForPosting:t.messagesForPosting,callId:t.callId,title:t.title,uploadSource:t.instrumentation_postSource,conversationOrigin:t.instrumentation_conversationOrigin,toastMessageToShowOnSuccess:t.toastMessageToShowOnSuccess,toastMessageToShowOnFailure:t.toastMessageToShowOnFailure,shouldTrackUpload:t.shouldTrackUpload,conversationAcceptedInfos:t.conversationAcceptedInfos}}return{kind:"postMessage",conversationId:t.conversationIds[0],postSource:t.instrumentation_postSource,conversationOrigin:t.instrumentation_conversationOrigin,messageForPosting:n.find(t.messagesForPosting),editedMessageCuid:t.editedMessageCuid,forwardMediaInfo:t.forwardMediaInfo,forwardMediaInfos:t.forwardMediaInfos,swiftMessageDecoded:t.swiftMessageDecoded,shouldSendLogs:t.feedbackSendLogs,shouldSendScreenshot:t.feedbackSendScreenshot,screenshotUri:t.feedbackScreenshotUri,showLocalNotificationOnFailure:t.showLocalNotificationOnFailure,urlPreviewPropSet:t.urlPreviewPropSet,urlPreviewEndpoints:t.urlPreviewEndpoints,rawContentLength:t.rawContentLength,quoteAuthor:t.quoteAuthor,quotesTriggerType:t.quotesTriggerType,quotesMessageType:t.quotesMessageType,isForward:t.isForward,editedMessageServerId:t.editedMessageServerId,editedMessageVersion:t.editedMessageVersion,isDelete:t.isDelete,quotesRawMessageContent:t.quotesRawMessageContent,conversationAcceptedInfo:t.conversationAcceptedInfos&&t.conversationAcceptedInfos[t.conversationIds[0]]}}_cancel(e){return e.persisted.isCanceled=!0,this._removeAndCheckForNeededCleanup(e)}_postUpdated(e,t=!1){const s=e.getPersistedActionData(),i=F.default.updateAction(s);return t||this.postUpdated.fire(s),i}_getNextPostTime(){let e=Date.now();return n.each(this._posts,(t=>{t.persisted.postTime>=e&&(e=t.persisted.postTime+1)})),e<=this._lastPostTime&&(e=this._lastPostTime+1),this._lastPostTime=e,e}_resetBackoffs(e){k.log(Z,"Resetting backoffs due to: "+e),n.each(this._posts,(e=>{e.resetBackoffs()}))}_seeIfAnythingNeedsDoing(){const e=n.keys(this._posts);n.each(e,(e=>{this._posts[e]&&this._checkForNeededWork(e)}))}_seeIfAnythingElseInConvNeedsDoing(e,...t){const s=n.keys(this._posts);n.each(s,(s=>{const i=this._posts[s];i&&n.intersection(i.persisted.conversationIds,t).length&&(!e||i!==e&&i.persisted.postTime>e.persisted.postTime)&&this._checkForNeededWork(s)}))}_checkForNeededWork(e){if(this._checkForNeededWorkQueue[e])return void this._checkForNeededWorkQueue[e]++;this._checkForNeededWorkQueue[e]=1;const t=this._posts[e];this._doWorkIfNeeded(t);const s=this._posts[e]&&this._checkForNeededWorkQueue[e]>1;delete this._checkForNeededWorkQueue[e],s&&this._checkForNeededWork(e)}_doWorkIfNeeded(e){n.some(e.persisted.conversationIds,(e=>!e))&&k.error(Z,"Null conversationId in postingService. Cleaning up PostId: "+e.persisted.id);const{updateKind:t,isActivelyWorking:s}=e.doWorkIfNeeded();switch(this._updateIsActivelyWorking(e,s),t){case x.CheckForNeededWorkResult.Finished:case x.CheckForNeededWorkResult.GiveUp:return void this._removeAndCheckForNeededCleanup(e);case x.CheckForNeededWorkResult.InProgress:case x.CheckForNeededWorkResult.Blocked:return;case x.CheckForNeededWorkResult.Update:return void this._postUpdated(e);default:return Q.default.switchStatementExhaustiveChecking(t)}}_updateIsActivelyWorking(e,t){t?(this._postsActivelyWorking[e.persisted.id]=!0,!this._wakeLockPromise&&u.default.getConfigSettingsNoSubscription().chat.backgroundPostingHoldOwnWakeLockEnabled&&(this._wakeLockPromise=r.default.requestMaxTime("posting:active")),p.default.pokeLongRunningRequest(e.persisted.id)):(delete this._postsActivelyWorking[e.persisted.id],this._wakeLockPromise&&n.isEmpty(this._postsActivelyWorking)&&(this._wakeLockPromise.then((e=>{r.default.release(e,"posting:active")})),this._wakeLockPromise=void 0),p.default.removeLongRunningRequest(e.persisted.id))}_removeAndCheckForNeededCleanup(e){e.persisted.isFinished=!0;const t=!!this._posts[e.persisted.id];if(e.persisted.isCleaningUp)return this._postsCleaningUp[e.persisted.id]&&this._postsCleaningUp[e.persisted.id].defer.promise();e.persisted.isCleaningUp=!0;{const s=Date.now()-e.persisted.postTime,i=Date.now()-this._postStartTimeThisRun[e.persisted.id];k.log(Z,"Cleaning up:",e.persisted.id,"reportedPostTimeTotalMs",s,"actualPostTimeThisRunMs",i,"isCanceled",!!e.persisted.isCanceled,"justFinished",t,"permanentFailureTransferType",e.persisted.permanentFailureTransferType||"none","maxRetriesExceededTransferType",e.persisted.maxRetriesExceededTransferType||"none","maxElapsedTimeExceededTransferType",e.persisted.maxElapsedTimeExceededTransferType||"none")}this._updateIsActivelyWorking(e,!1),delete this._posts[e.persisted.id],delete this._postStartTimeThisRun[e.persisted.id],this._postsCleaningUp[e.persisted.id]={post:e,defer:d.Defer()};const s=this._postUpdated(e,!0).always((()=>{let s;return e.cleanup(),t&&(n.each(e.telemetryScenarios,((t,s)=>{const i=e.persisted.messagesForPosting[s],o={conversations_count:e.persisted.conversationIds.length,correlationId:g.getCorrelationIdFromMessageParts(L.default.getSkypeMri(),s,i.clientmessageid)};if(e.persisted.isCanceled)t.fail("user_cancelled",o);else if(e.persisted.permanentFailureTransferType)o.transfer_type=e.persisted.permanentFailureTransferType,t.fail("permanent_failure",o);else if(e.persisted.maxElapsedTimeExceededTransferType)o.transfer_type=e.persisted.maxElapsedTimeExceededTransferType,t.fail("max_transfer_time_exceeded",o);else if(e.persisted.maxRetriesExceededTransferType)o.transfer_type=e.persisted.maxRetriesExceededTransferType,t.fail("max_retries_exceeded",o);else{const{enabled:e,timeoutInMs:n}=u.default.getS4LMessagingFeaturesNoSubscription().textSendTimeoutFineGrainedConfig;if(e&&t.getScenarioName()===B.ScenarioName[B.ScenarioName.SendTextMessage]){const e=t.getCurrentDuration();e>=u.default.getS4LMessagingFeaturesNoSubscription().textSendTimeout&&e<=n&&k.track(new R.MessageSendTimeout(i,s,e))}t.finish(o)}})),this.postUpdated.fire(e.getPersistedActionData())),e.persisted.isCanceled&&(s=n.map(e.persisted.messagesForPosting,((e,t)=>{const s=_.getCuidForMessage(e);return m.default.revertMessageLie(t,s,e.clientmessageid)}))),d.all(s||[]).then((()=>{let s,i,r=!1;if(e.persisted.permanentFailureTransferType||e.persisted.maxRetriesExceededTransferType||e.persisted.maxElapsedTimeExceededTransferType){const t=Date.now();i=n.map(e.persisted.messagesForPosting,((i,o)=>{if(!e.isPostedToChat(o))return s=s||this._getPostInfo(e),r=r||!(e.persisted.permanentFailureTransferType||!s),m.default.rejectMessageSend(o,i,t,s)}))}return d.all(i||[]).then((()=>{const s=e.getMyLocalCacheNames();if(0===s.length)return;let i;return k.log(Z,"Keeping in cache for a while: "+e.persisted.id+", names: "+o.pii.Omit(s.join(", "))),i=r?n.map(s,(e=>P.default.finishedButKeepForRetry(e))):t?n.map(s,(e=>P.default.finished(e))):n.map(s,(e=>P.default.abandon(e))),d.all(i).then(n.noop)})).always((()=>{F.default.removeAction(e.persisted.id);const t=this._postsCleaningUp[e.persisted.id];delete this._postsCleaningUp[e.persisted.id],t.defer.resolve(void 0)}))}))}));this._seeIfAnythingElseInConvNeedsDoing(e,...e.persisted.conversationIds);{const t=n.filter(e.persisted.conversationIds,(e=>!n.some(this._posts,(t=>n.includes(t.persisted.conversationIds,e)))));n.isEmpty(t)||k.log(Z,"Cleaning up convs: ["+n.map(t,(e=>o.pii.Mri(e))).join(", ")+"]"),n.isEmpty(this._posts)&&k.log(Z,"Cleaning up everything!")}return s.finally((()=>{n.isEmpty(this._posts)&&n.isEmpty(this._postsCleaningUp)&&this.allPostsFinished.fire()})),s}}},97572:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=s(217041),a=i.__importStar(s(397691)),l=i.__importStar(s(44717)),d=s(434343),c=i.__importStar(s(85385)),u=i.__importDefault(s(652032)),h=i.__importStar(s(446574)),p=i.__importStar(s(442699));let g=class extends r.StoreBase{constructor(){super(),this._contactsBlockStatus={},this._conversationBlockStatus={},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={},h.RegisterStartupable(this,"BlockedMriStore",[u.default])}startup(){const e=u.default.getDataExclusive(d.InternalKeys.BlockedMriStoreCache);return this._contactsBlockStatus=e?e.contactsBlockStatus:{},this._conversationBlockStatus=e?e.conversationBlockStatus:{},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={},a.Resolved()}isMriBlocked(e){return this._isMriBlocked(e)}isMriBlockedNoSubscription(e){return this._isMriBlocked(e)}isContactBlocked(e){return!!this._contactsBlockStatus[e]}getBlockedMris(){const e=n.mergeWith(this._conversationBlockStatus,this._contactsBlockStatus,((e,t)=>!(!1===e||!1===t))),t=n.pickBy(e,(e=>e));return Object.keys(t)}internal_updateContactsBlockStatus(e,t){return this._updateSet(e,this._contactsBlockStatusOriginal,this._contactsBlockStatus,t)}internal_updateConversationBlockStatus(e){return this._updateSet(e,this._conversationBlockStatusOriginal,this._conversationBlockStatus,!0)}test_reset_store(){u.default.deleteKeys([d.InternalKeys.BlockedMriStoreCache]).then((()=>{const e=u.default.getDataExclusive(d.InternalKeys.BlockedMriStoreCache);this._contactsBlockStatus=e?e.contactsBlockStatus:{},this._conversationBlockStatus=e?e.conversationBlockStatus:{},this._contactsBlockStatusOriginal={},this._conversationBlockStatusOriginal={}}))}_isMriBlocked(e){if(l.isOneToOneThread(e)){const t="BlockedMriStore:isMriBlocked doesn't support oneOnOneThreads: "+o.pii.Mri(e);return c.error(void 0,t),c.track(new p.DevDebug("IsMriBlockedOneOnOneThreads",t)),!1}let t=!1;return!(e in this._contactsBlockStatus&&(t=!0,!this._contactsBlockStatus[e]))&&(!(e in this._conversationBlockStatus&&(t=!0,!this._conversationBlockStatus[e]))&&!!t)}_updateSet(e,t,s,i){const o=[];let r=!1;if(n.each(e,((e,n)=>{if(e!==s[n]){const a=this.isMriBlocked(n);i||n in t||(n in s?t[n]=s[n]:e&&(t[n]=!1)),s[n]=e,r=!0,this.isMriBlocked(n)!==a&&o.push(n)}})),i&&n.each(e,((e,s)=>{s in t&&delete t[s]})),r||i){const e={contactsBlockStatus:n.assign({},this._contactsBlockStatus,this._contactsBlockStatusOriginal),conversationBlockStatus:n.assign({},this._conversationBlockStatus,this._conversationBlockStatusOriginal)};return(i?u.default.putData(d.InternalKeys.BlockedMriStoreCache,e):a.Resolved()).then((()=>{o.length>0&&this.trigger(o)}))}return a.Resolved()}};i.__decorate([r.autoSubscribe,i.__param(0,r.key)],g.prototype,"isMriBlocked",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],g.prototype,"isContactBlocked",null),i.__decorate([r.autoSubscribe],g.prototype,"getBlockedMris",null),g=i.__decorate([r.AutoSubscribeStore],g),t.default=new g},804144:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(397691)),a=i.__importDefault(s(304623)),l=i.__importDefault(s(135372)),d=s(815146),c=i.__importStar(s(85385)),u=i.__importDefault(s(201721)),h=i.__importStar(s(446574)),p=s(123117);var g;!function(e){e[e.BookmarkAddedKey=0]="BookmarkAddedKey"}(g||(t.TriggerKeys=g={}));let m=class extends n.StoreBase{constructor(){super(),this._bookmarkAdded=!1,this._updatedBookmarks={},this._chatServiceDataServiceMessagesProcessed=e=>r.all(o.map(e,(e=>{if(e.isBookmarkSourceForCurrentUser()){const t=e.getBookmarkSourceMetadataForCurrentUser();if(!t||!t.cuid)return;this._maybeStoreUpdatedBookmarkTrigger(t.cuid,e)}}))),h.RegisterStartupable(this,"BookmarksStore",[u.default,a.default])}startup(){return a.default.messagesProcessed.subscribe(this._chatServiceDataServiceMessagesProcessed),r.Resolved()}isBookmarkAdded(){return this._bookmarkAdded}setBookmarkAdded(){this._bookmarkAdded=!0,this.trigger(g.BookmarkAddedKey)}bookmarkTooltipDisplayed(){this._bookmarkAdded=!1,this.trigger(g.BookmarkAddedKey)}shouldDisplayTooltipOnMobile(e){return!(u.default.getUserPreferencesLocal().notifiedAboutBookmarks||!this._bookmarkAdded||!e||l.default.isCoachMarkBeingShown())&&(u.default.setUserPreferencesLocal({notifiedAboutBookmarks:!0}),!0)}getBookmarkEditedMessage(e,t){if(o.has(this._updatedBookmarks,e))return this._updatedBookmarks[e];this._checkIfBookmarkContentUpdated(t)}_checkIfBookmarkContentUpdated(e){if(!e.isBookmark())return r.Resolved();const t=e.getBookmarkMetadata();return t?r.fromThenable(p.MessagesRepository.getMessageByCuid(t.bookmarkSourceConversationId,t.bookmarkSourceClientMessageId)).then((t=>{t?e.content!==t.content&&(c.log(d.LogTraceArea.Bookmarks,"Newer bookmark source message found in local DB."),this._maybeStoreUpdatedBookmarkTrigger(e.cuid,t)):this._updatedBookmarks[e.cuid]=void 0})):r.Resolved()}_maybeStoreUpdatedBookmarkTrigger(e,t){const s=this._updatedBookmarks[e];if(!s)return c.log(d.LogTraceArea.Bookmarks,"Caching newer version bookmark source message."),this._updatedBookmarks[e]=t,void this.trigger(e);const i=s.getLatestServerMessageVersion(),o=t.getLatestServerMessageVersion();if(i&&o)return o>i&&s.content!==t.content?(c.log(d.LogTraceArea.Bookmarks,"Received new version of bookmark with new content."),this._updatedBookmarks[e]=t,void this.trigger(e)):void 0;c.log(d.LogTraceArea.Bookmarks,`Unable to compare versions of updated bookmarks. Local version:${i} Incoming update:${o}`)}test_reset(){this._bookmarkAdded=!1,this._updatedBookmarks={}}test_getUpdatedBookmarks(){return this._updatedBookmarks}};i.__decorate([(0,n.autoSubscribeWithKey)(g.BookmarkAddedKey)],m.prototype,"isBookmarkAdded",null),i.__decorate([(0,n.autoSubscribeWithKey)(g.BookmarkAddedKey)],m.prototype,"shouldDisplayTooltipOnMobile",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getBookmarkEditedMessage",null),m=i.__decorate([n.AutoSubscribeStore],m),t.default=new m},235549:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(404547)),a=i.__importDefault(s(304623)),l=i.__importStar(s(971988)),d=i.__importStar(s(44717)),c=i.__importDefault(s(615364)),u=i.__importStar(s(446574)),h=i.__importDefault(s(601274)),p=s(593501),g=s(717413);let m=class extends n.StoreBase{constructor(){super(),this._conversationMap={},u.RegisterStartupable(this,"ComposingStore",[r.default,a.default,c.default])}startup(){return r.default.controlMessagesReceived.subscribe((e=>{o.each(e,(e=>{const t=d.getParsedConversationId(e),s=this._getCreatorMri(e);t&&(this._shouldAddComposingUserData(e)?this.addComposingUserData(t,s):this._shouldClearComposingUserData(e)&&this.clearComposingUserData(t,s))}))})),a.default.messagesProcessed.subscribe((e=>{o.each(e,(e=>{(0,p.isMagicBotOneOnOneControlMessage)(e)||this.clearComposingUserData(e.conversationId,(0,p.isMagicBotOneOnOneMessage)(e)?(0,g.getMagicBotId)():e.creator)}))})),(0,c.default)().subscribe((e=>{o.each(e,(e=>{if(this._conversationMap[e]){(0,c.default)().getConversation(e).isCurrentUserMember()||(delete this._conversationMap[e],this.trigger(e))}}))})),Promise.resolve()}addComposingUserData(e,t){this._conversationMap[e]||(this._conversationMap[e]=[]),this._conversationMap[e]=o.filter(this._conversationMap[e],(e=>e.mri!==t));const s=Date.now();this._conversationMap[e].push({mri:t,startTypingTime:s}),h.default.setTimeout((()=>{this.clearComposingUserData(e,t,s)}),2e4),this.trigger(e)}clearComposingUserData(e,t,s=0){if(this._conversationMap[e]){let i=!1;this._conversationMap[e]=o.filter(this._conversationMap[e],(e=>e.mri!==t||0!==s&&e.startTypingTime!==s||(i=!0,!1))),i&&this.trigger(e)}}getComposingUsers(e){return this._conversationMap[e]?o.map(this._conversationMap[e],(e=>e.mri)):[]}_getCreatorMri(e){return(0,p.isMagicBotOneOnOneMessage)(e)?(0,g.getMagicBotId)():d.getCreatorMriForMessageFromLink(e.from)}_shouldAddComposingUserData(e){return e.messagetype===l.MessageTypes.Typing||e.messagetype===l.MessageTypes.MagicBotEvent&&(0,p.isMagicBotOneOnOneTypingIndicator)(e)}_shouldClearComposingUserData(e){return e.messagetype===l.MessageTypes.ClearTyping||e.messagetype===l.MessageTypes.MagicBotEvent&&(0,p.isMagicBotOneOnOneClearTypingIndicator)(e)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getComposingUsers",null),m=i.__decorate([n.AutoSubscribeStore],m),t.default=new m},574489:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationCalculationStore=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(819059)),r=i.__importDefault(s(199118)),a=i.__importStar(s(516778)),l=s(217041),d=i.__importStar(s(397691)),c=i.__importDefault(s(659938)),u=i.__importDefault(s(150343)),h=i.__importDefault(s(369347)),p=i.__importDefault(s(304623)),g=i.__importStar(s(44717)),m=i.__importDefault(s(434343)),S=i.__importStar(s(583506)),_=i.__importDefault(s(306200)),f=s(815146),y=i.__importStar(s(85385)),v=i.__importStar(s(437782)),C=i.__importDefault(s(506082)),T=i.__importStar(s(446574)),M=s(803193),b=s(318315);var I;!function(e){e[e.ActiveConversationCount=0]="ActiveConversationCount",e[e.ZeroCountChanged=1]="ZeroCountChanged"}(I||(I={}));let w=class extends l.StoreBase{constructor(){super(200),this._notificationPromises=[],this._messageCounts={},this._activeConversationCount=0,this._contentChannelIds=new Set,this._onAppStateChange=e=>{e===a.Types.AppActivationState.Active&&this._recomputeActiveConversationCounts()},T.RegisterStartupable(this,"ConversationCalculationStore",[p.default])}setupPreStartupSubscriptions(){this._csdsToken&&this._csdsToken.unsubscribe(),this._csdsToken=p.default.conversationsUpdated.subscribe((e=>{const t=[];let s=!1;if(o.each(e,(e=>{const i=e.counts;if(i&&this._messageCounts[e.conv.id]!==i){const o=this._messageCounts[e.conv.id]||S.BlankCounts;this._messageCounts[e.conv.id]=i;let n=!1;0===o.unreadCount!=(0===i.unreadCount)&&(s=!0),o.unreadCount===i.unreadCount&&o.unreadCountOverflowed===i.unreadCountOverflowed&&o.highPriorityUnreadCount===i.highPriorityUnreadCount&&o.hasUnread===i.hasUnread&&o.numMessagesSentByUser===i.numMessagesSentByUser&&o.consumptionHorizonTimestamp===i.consumptionHorizonTimestamp||(t.push(e.conv.id),n=!0),(o.unreadCount!==i.unreadCount||i.unreadCount>0)&&y.log(f.LogTraceArea.ConversationCalculations,"Conversation count - changed: "+n+" value: "+i.unreadCount+" for "+v.mriOrId(e.conv.id)),(0,M.isContentChannel)(e.conv)&&this._contentChannelIds.add(e.conv.id)}})),t.length>0){T.HasStarted(this)&&this.trigger(t);const e=this._recomputeActiveConversationCounts();this._notificationPromises.push(e),e.always((()=>{o.pull(this._notificationPromises,e)})),y.log(f.LogTraceArea.ConversationCalculations,"Unread conversation count: "+o.filter(this._messageCounts,(e=>e.unreadCount>0)).length)}s&&this.trigger(I.ZeroCountChanged)})),this._ucsToken&&(0,b.getUnreadCountStore)().unsubscribe(this._ucsToken),this._ucsToken=(0,b.getUnreadCountStore)().subscribe((()=>{this._recomputeActiveConversationCounts()}))}startup(){return o.each(p.default.getRawConversationMetaMemoryCache(),(e=>{e&&e.counts&&(this._messageCounts[e.conv.id]=e.counts)})),C.default.performAfterUIStarted((()=>{o.defer((()=>{this._recomputeActiveConversationCounts()}))})),c.default.subscribeForChanges("ConversationCalculationStore",(e=>this._onAppStateChange(e))),Promise.resolve()}test_reset(){this._messageCounts={},this._activeConversationCount=0}flushNotificationProcessingPromises(){const e=this._notificationPromises;return this._notificationPromises=[],d.all(e).then(o.noop)}getMessageCountsForConversation(e,t){if(t&&u.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations){const t=_.default.getAllSiblingConversations(e);if(t.length>1){let s=0,i=0;return o.each(t,(e=>{if(h.default.ActiveCallUIHelper.hasActiveCall(e.id))return;const t=this._messageCounts[e.id];t&&(s+=t.unreadCount,i+=t.highPriorityUnreadCount)})),o.assign({},this._messageCounts[e],{hasUnread:s>0?1:0,unreadCount:s,highPriorityUnreadCount:i,unreadCountOverflowed:s>S.MaxUnreadMessageCount})}}return this._messageCounts[e]||S.BlankCounts}getConversationsWithUnreadCounts(){const e={};return o.each(this._messageCounts,((t,s)=>{t.unreadCount&&(e[s]=t)})),e}getSortedFrequentConversationMris(){const e=[];return o.each(this._messageCounts,((t,s)=>{t.numMessagesSentByUser>0&&(g.isUserMri(s)||g.isThread(s)||g.isAgent(s))&&e.push(s)})),o.sortBy(e,(e=>-this._messageCounts[e].numMessagesSentByUser))}getActiveRecentsConversationCount(){return this._activeConversationCount}_recomputeActiveConversationCounts(){const e=n.default.requestMaxTime("ConvCounts"),t=[];let s;const i=u.default.getConfigSettingsNoSubscription().cortana.mri;if(T.HasStarted(this)){let e=0;o.each(this._messageCounts,((t,s)=>{s!==i&&(this._contentChannelIds.has(s)||t.hasUnread&&(g.isHighlightsThread(s)||e++))})),e+=(0,b.getUnreadCountStore)().getUnreadCount(),s=d.Resolved(e)}else s=m.default.getCountOfUnreadConversations(!1);return s.then((e=>(this._activeConversationCount!==e&&(this._activeConversationCount=e,t.push("activeConversationCount updated to "+e),this.trigger(I.ActiveConversationCount)),r.default.getCount().then((e=>{const s=this._activeConversationCount;e!==s&&(t.push("Home screen badge count: "+e+" => "+s),r.default.setCount(s)),t.length>0&&y.log(f.LogTraceArea.ConversationCalculations,"_recomputeActiveConversationCounts: "+t.join(", "))}))))).always((()=>{e.then((e=>n.default.release(e,"ConvCounts"))).catch(o.noop)}))}};t.ConversationCalculationStore=w,i.__decorate([l.autoSubscribe,i.__param(0,l.key)],w.prototype,"getMessageCountsForConversation",null),i.__decorate([(0,l.autoSubscribeWithKey)(I.ZeroCountChanged)],w.prototype,"getConversationsWithUnreadCounts",null),i.__decorate([l.autoSubscribe],w.prototype,"getSortedFrequentConversationMris",null),i.__decorate([(0,l.autoSubscribeWithKey)(I.ActiveConversationCount)],w.prototype,"getActiveRecentsConversationCount",null),t.ConversationCalculationStore=w=i.__decorate([l.AutoSubscribeStore],w),t.default=new w},734468:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(725674)),a=i.__importStar(s(473483)),l=i.__importDefault(s(601976)),d=s(815146),c=i.__importStar(s(85385)),u=i.__importDefault(s(252089)),h=i.__importDefault(s(363091)),p=i.__importStar(s(446574)),g=i.__importDefault(s(266872));let m=class extends n.StoreBase{constructor(){super(),this._colorInfoByMri={},p.RegisterStartupable(this,"ConversationColorStore",[l.default,g.default])}startup(){return this._overrideColorInfo=g.default.shouldOverrideColors(),l.default.subscribe((e=>{this._handleDisplayInfoStoreUpdates(e)})),u.default.subscribe((()=>{this._overrideColorInfo&&(c.log(d.LogTraceArea.ConversationColorStore,"Triggering color update for my user color change"),this.trigger())})),g.default.subscribe((()=>{const e=g.default.shouldOverrideColors();e!==this._overrideColorInfo&&(c.log(d.LogTraceArea.ConversationColorStore,"Triggering color update for theme change"),this._overrideColorInfo=e,this.trigger())})),Promise.resolve()}getColorInfo(e,t=!1){return this.getColorInfoNoSubscription(e,t)}getColorInfoNoSubscription(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getColorInfoNoSubscription();if(!e)return a.getDefaultUnknownColorInfo();let s=this._colorInfoByMri[e];return s||(s=this._getColorInfoWithDefault(e)),s||a.getDefaultUnknownColorInfo()}getPrimaryColor(e,t=!1){return this.getPrimaryColorNoSubscription(e,t)}getPrimaryColorNoSubscription(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getPrimaryColorNoSubscription();const s=this.getColorInfoNoSubscription(e,t);return r.accentColor(s)}getGradientColors(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getGradientColors();const s=this.getColorInfo(e,t);return a.gradientColorsForColorInfo(s)}getSubtleGradientColors(e,t=!1){if(this._overrideColorInfo&&!t)return u.default.getSubtleGradientColors();const s=this.getColorInfo(e,t);return a.subtleGradientColorsForColorInfo(s)}_getColorInfoWithDefault(e){const t=l.default.getDisplayableProfile(e);let s=t?t.getColor():void 0;return a.isMatchingColorInfo(s,a.SerializedColorByNumber.Rainbow)&&(s=void 0),s||(s=a.getDefaultColorInfo(e)),this._colorInfoByMri[e]&&this._colorInfoByMri[e]===s||(this._colorInfoByMri[e]=s),s}_handleDisplayInfoStoreUpdates(e){const t=o.filter(e,(e=>{if(h.default.isMyMri(e))return!1;const t=this._colorInfoByMri[e],s=this._getColorInfoWithDefault(e);return!t||t!==s}));t.length>0&&this.trigger(t)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getColorInfo",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getPrimaryColor",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getGradientColors",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],m.prototype,"getSubtleGradientColors",null),m=i.__decorate([n.AutoSubscribeStore],m),t.default=new m},306200:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(150343)),a=i.__importStar(s(172134)),l=i.__importStar(s(44717)),d=i.__importDefault(s(615364)),c=i.__importStar(s(596467)),u=i.__importDefault(s(732028)),h=s(815146),p=i.__importDefault(s(458910)),g=i.__importStar(s(85385)),m=i.__importStar(s(437782)),S=i.__importStar(s(446574)),_=i.__importDefault(s(685734));let f=class extends n.StoreBase{constructor(){super(),this._conversations={},this._updateConversations=e=>{const t=[];o.each(e,(e=>{const s=(0,d.default)().getConversation(e);if(s){const e=this._checkAndAddConversationMri(s);e&&t.push(e)}})),t.length&&this.trigger(t)},this._updateUsers=e=>{const t=[];o.each(e,(e=>{const s=_.default.getFullUserProfileByMri(e);s&&o.each(s.phones,(e=>{const s=l.sanitizeMri(e.number,l.Namespaces.PSTN),i=(0,d.default)().getConversation(s);if(i){const e=this._checkAndAddConversationMri(i);e&&t.push(e)}}))})),t.length&&this.trigger(t)},S.RegisterStartupable(this,"ConversationGroupingStore",[d.default,_.default])}_getPairedUserMri(e){const t=e.getOtherPartyMri();if(t)return _.default.getConversationOwner(t);g.log(h.LogTraceArea.ConversationGroupingStore,"_getPairedUserMri: getOtherPartyMri returned undefined")}_checkAndAddConversationMri(e){if(e.isOneOnOne()){const t=this._getPairedUserMri(e);if(t){this._conversations[t]||(this._conversations[t]=[]);const s=-1!==this._conversations[t].indexOf(e.id);if(s&&c.isConversationDisplayable(e))return t;if(!s)return this._conversations[t].push(e.id),t}}}startup(){const e=(0,d.default)();return o.each(e.getAllConversationsInMemory(),(e=>{e&&this._checkAndAddConversationMri(e)})),e.subscribe(this._updateConversations),_.default.subscribe(this._updateUsers),Promise.resolve()}test_resetConversations(){this._conversations={}}getConversationsForUser(e,t=!0){if(this._conversations&&this._conversations[e]&&this._conversations[e].length)return o.compact(o.map(this._conversations[e],(e=>{const s=(0,d.default)().getConversation(e);if(!(t&&s&&s.isEncryptedThread())||u.default.shouldShowPrivateConv(e))return s})))}getDisplayableConversationsForUser(e){return o.filter(this.getAllSiblingConversations(e),(e=>c.isConversationDisplayable(e)))}getAllSiblingConversations(e){const t=(0,d.default)().getConversation(e);if(t||g.log(h.LogTraceArea.ConversationGroupingStore,"original conversation for "+m.mriOrId(e)+" does not exist"),!t&&l.isPhoneMri(e)){const t=this.getConversationsForUser(_.default.getConversationOwner(e));return this._maybeLogConversationsForUser(t,!0),t||[]}if(!t||t&&!t.isOneOnOne())return[];const s=this.getConversationsForUser(this._getPairedUserMri(t));return this._maybeLogConversationsForUser(s,!1),s||[]}_maybeLogConversationsForUser(e,t){if(o.isUndefined(e)||0===e.length){const s=o.isUndefined(e)?"undefined":"zero length",i=t?"PSTN case, ":"";g.log(h.LogTraceArea.ConversationGroupingStore,"getAllSiblingConversations: "+i+"conversationsForUser is "+s)}}isGroupMarkedAsFavorite(e){return o.some(this.getAllSiblingConversations(e),(e=>e.isFavorite()))}filterGrouped1on1s(e){return e&&r.default.getS4LMessagingFeaturesNoSubscription().enableGroupedConversations?o.uniqBy(e,(e=>{if(!e.isOneOnOne())return e.id;let t=e.getOtherPartyMri();return t&&(t=_.default.getConversationOwner(t)),t})):e}markGroupAsRead(e){o.each(this.getAllSiblingConversations(e),(e=>{a.markConversationRead(e.id)}))}removeFromFavorites(e){o.each(this.getAllSiblingConversations(e),(e=>{e.isFavorite()&&p.default.removeConversation(e.id)}))}addToFavorites(e){const t=(0,d.default)().getConversation(e);if(t){const e=this._getPairedUserMri(t);e&&p.default.addConversation(e)}}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],f.prototype,"getConversationsForUser",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],f.prototype,"getDisplayableConversationsForUser",null),i.__decorate([n.autoSubscribe],f.prototype,"getAllSiblingConversations",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],f.prototype,"isGroupMarkedAsFavorite",null),i.__decorate([n.autoSubscribe],f.prototype,"filterGrouped1on1s",null),f=i.__decorate([n.AutoSubscribeStore],f),t.default=new f},581163:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return n||(n=new r)};const i=s(197582),o=s(217041);let n,r=class extends o.StoreBase{constructor(){super(...arguments),this._highlightedButtons=new Set}markButtonAsHighlighted(e){this._highlightedButtons.add(e),this.trigger()}unmarkButtonAsHighlighted(e){this._highlightedButtons.delete(e),this.trigger()}isButtonHighlighted(e){return this._highlightedButtons.has(e)}};i.__decorate([o.autoSubscribe],r.prototype,"isButtonHighlighted",null),r=i.__decorate([o.AutoSubscribeStore],r)},365730:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=(i.__importStar(s(516778)),s(217041)),n=(i.__importDefault(s(659938)),i.__importDefault(s(999261))),r=(i.__importStar(s(812822)),i.__importDefault(s(450312))),a=i.__importStar(s(446574));let l=class extends o.StoreBase{constructor(){super(100),this._appActive=!1,this._isVisible=!1,this._isUserActive=!1,this._shouldAnimate=!1,a.RegisterStartupable(this,"ConversationListAnimationStore",[r.default,n.default])}startup(){return this._appActive=!0,this._activitySubToken=n.default.subscribe((()=>{const e=n.default.isCurrentUserActive();e!==this._isUserActive&&(this._isUserActive=e,this._recalc())})),this._isUserActive=n.default.isCurrentUserActive(),this._isVisible=!0,this._recalc(),Promise.resolve()}destroy(){this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),this._navigationSubToken&&(r.default.unsubscribe(this._navigationSubToken),this._navigationSubToken=void 0),this._activitySubToken&&(n.default.unsubscribe(this._activitySubToken),this._activitySubToken=void 0)}_recalc(){const e=this._isVisible&&this._appActive&&this._isUserActive;e!==this._shouldAnimate&&(this._shouldAnimate=e,this.trigger())}shouldAnimate(){return this._shouldAnimate}};i.__decorate([o.autoSubscribe],l.prototype,"shouldAnimate",null),l=i.__decorate([o.AutoSubscribeStore],l),t.default=new l},915305:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RetrievalMask=t.RetrievalState=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=s(284841),d=i.__importDefault(s(304623)),c=i.__importStar(s(971988)),u=i.__importDefault(s(556587)),h=i.__importDefault(s(434343)),p=i.__importDefault(s(399599)),g=s(815146),m=i.__importStar(s(85385)),S=i.__importDefault(s(114818)),_=i.__importDefault(s(519093)),f=i.__importStar(s(437782)),y=i.__importDefault(s(262834)),v=i.__importDefault(s(760989)),C=s(123117);var T,M;!function(e){e[e.None=0]="None",e[e.Retrieving=1]="Retrieving",e[e.Failed=2]="Failed",e[e.Retrieved=3]="Retrieved"}(T||(t.RetrievalState=T={})),function(e){e[e.Files=1]="Files",e[e.Media=2]="Media",e[e.Links=4]="Links",e[e.All=7]="All"}(M||(t.RetrievalMask=M={}));const b=e=>e||[];let I=class extends n.StoreBase{constructor(){super(...arguments),this._conversations={},this._populateSurroundMediaInProgress={},this._fetchFilesLinksMediaForConversation=(e,t)=>{this._needsMoreFileMessages(e)&&this._getFilesForConversation(e,t),this._needsMoreLinksMessages(e)&&this._getLinksForConversation(e,t),this._needsMoreMediaMessages(e)&&this._getMediaForConversation(e,t)},this._processNextConversationMessagesFromDb=(e,t)=>{if(!e||!e.length)return m.log(g.LogTraceArea.ConversationMediaStore,"_processNextConversationMessages() No more messages proccessed. causeId:"+t),r.Resolved();const s=o.filter(e,(e=>this._isSupportedMessage(e))),i=s.length,n=o.last(e).conversationId;return m.log(g.LogTraceArea.ConversationMediaStore,"_processNextConversationMessages() conversationId: "+f.mriOrId(n)+" numMediaMessages: "+i+", causeId: "+t),this._conversations[n]&&i?this._putMessages(n,s,!1,t):r.Resolved()},this._processPreviousConversationMessagesFromDb=(e,t,s)=>{if(!this._conversations[t])return r.Resolved();let i=r.Resolved();if(e.length){const n=o.filter(e,(e=>this._isSupportedMessage(e))),r=o.last(e).createdTime;m.log(g.LogTraceArea.ConversationMediaStore,"_processPreviousConversationMessages() conversationId: "+f.mriOrId(t)+" supportedMessages: "+n.length+" causeId: "+s),this._conversations[t].lastPreviousItemTime&&r<this._conversations[t].lastPreviousItemTime&&e.length&&(this._conversations[t].lastPreviousItemTime=r),i=this._putMessages(t,n,!1,s)}return!this._needsMoreMessages(t,!1)||this._conversations[t].retrievedFromService||this._retrievalFromServiceFailedInTheLastMinute(t)||(m.log(g.LogTraceArea.ConversationMediaStore,"_processPreviousConversationMessages() Fetching items"),this._fetchFilesLinksMediaForConversation(t,s)),i},this._processSuccessfulSearchResults=(e,t,s)=>{const i=[],n=(0,l.chain)(e,(0,l.map)((e=>p.default.simulateFullMessage(e,c.MessageTypes.UriObject,t))),(0,l.compact)(),(0,l.filter)((e=>!(!e.cuid||!this._isSupportedMessage(e))&&(i.push(e.cuid),!0))));m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Processing "+n.length+" results conversationId: "+f.mriOrId(t)+", causeId: "+s),m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Getting local messages conversationId: "+f.mriOrId(t));const a=d.default.getConversationMetaAsync(t,!1),u=h.default.getMessagesByCuid(t,i);r.all([a,u]).then((([e,i])=>{const r=o.map(i,(e=>e.cuid)),a=e?e.conv.getDeletedTimestamp():0,l=o.filter(n,(e=>e.createdTime>a));this._putMessages(t,l,!0,s),m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Found "+r.length+" messages stored locally for  conversationId: "+f.mriOrId(t));let d=l;r&&r.length&&(d=o.filter(l,(e=>-1===o.indexOf(r,e.cuid)))),d.length&&(m.log(g.LogTraceArea.ConversationMediaStore,"_processSuccessfulSearchResults() Putting "+d.length+" messages locally for  conversationId: "+f.mriOrId(t)),h.default.putMessages(d))}))}}_startedTrackingKey(e){this._conversations[e]||(m.log(g.LogTraceArea.ConversationMediaStore,"_startedTrackingKey() New conversationId: "+f.mriOrId(e)),0===o.size(this._conversations)&&(this._messagesProcessedSubscriptionToken=d.default.messagesProcessed.subscribe((e=>{const t=v.default.newCauseId();m.log(g.LogTraceArea.ConversationMediaStore,"messagesProcessed: causeId: "+t),(0,l.chain)(e,(0,l.filter)((e=>e.conversationId in this._conversations&&this._isSupportedMessage(e)&&!e.isMessageLie())),(0,l.groupBy)((e=>e.conversationId)),(0,l.eachWithKey)(((e,s)=>{this._putMessages(s,e,!1,t)})))})),this._conversationsUpdatedSubscriptionToken=d.default.conversationsUpdated.subscribe((e=>{const t=v.default.newCauseId();m.log(g.LogTraceArea.ConversationMediaStore,"conversationsUpdated: causeId: "+t),o.each(e,(e=>{e.conv.isDeleted()&&this._conversations[e.conv.id]&&(this._conversations[e.conv.id].media.messages=[],this._conversations[e.conv.id].files.messages=[],this._conversations[e.conv.id].links.messages=[],this._conversations[e.conv.id].retrievedFromService=!0,this._conversations[e.conv.id].lastNextItemTime=void 0,this._conversations[e.conv.id].lastPreviousItemTime=void 0,m.log(g.LogTraceArea.ConversationMediaStore,"conversationsUpdated: triggering: "+f.mriOrId(e.conv.id)+" causeId: "+t),this.trigger(e.conv.id))}))}))),this._conversations[e]={media:{messages:[],minResults:5,searchBase:0},files:{messages:[],minResults:5,searchBase:0},links:{messages:[],minResults:5,searchBase:0},isReverse:!1,lastNextItemTime:void 0,lastPreviousItemTime:void 0,retrievedFromService:!1,mediaRetrievalState:T.None,filesRetrievalState:T.None,linksRetrievalState:T.None})}_stoppedTrackingKey(e){m.log(g.LogTraceArea.ConversationMediaStore,"_stoppedTrackingKey() Stop tracking conversationId: "+f.mriOrId(e)),delete this._conversations[e],0===o.size(this._conversations)&&(this._messagesProcessedSubscriptionToken.unsubscribe(),this._messagesProcessedSubscriptionToken=void 0,this._conversationsUpdatedSubscriptionToken.unsubscribe(),this._conversationsUpdatedSubscriptionToken=void 0)}_isSupportedMessage(e){return _.default.isMediaItem(e)||_.default.isFile(e)||_.default.isLink(e)||_.default.isSwiftCardWithLink(e)||e.isDeletedMessage()}_putMessages(e,t,s,i){if(!this._conversations[e])return r.Resolved();let n=[];const a=[],d=[],c=[];let u=[];[u,n]=o.partition(t,(e=>e.isDeletedMessage())),o.each(n,(e=>{_.default.isFile(e)?a.push(e):_.default.isMediaItem(e)?c.push(e):d.push(e)})),m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() conversationId: "+f.mriOrId(e)+" filesToAdd: "+a.length+" linksToAdd: "+d.length+" mediaToAdd: "+c.length+" messagesToDelete: "+u.length+" causeId: "+i);let h=!1;u.length&&o.each(u,(t=>{let s,i;switch(o.each([this._conversations[e].files.messages,this._conversations[e].links.messages,this._conversations[e].media.messages],((e,n)=>(s=o.find(e,(e=>e.cuid===t.cuid)),!s||(i=n,h=!0,!1)))),i){case 0:this._conversations[e].files.messages=o.without(this._conversations[e].files.messages,s);break;case 1:this._conversations[e].links.messages=o.without(this._conversations[e].links.messages,s);break;case 2:this._conversations[e].media.messages=o.without(this._conversations[e].media.messages,s)}}));const p=this._conversations[e].isReverse,y=[a,d,c];return o.each(y,((t,i)=>{let n=[];0===i?(n=this._conversations[e].files.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() FILES existingItems: "+n.length)):1===i?(n=this._conversations[e].links.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() LINKS existingItems: "+n.length)):2===i&&(n=this._conversations[e].media.messages,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() mediaToAdd existingItems: "+n.length)),t=o.filter(t,(e=>!o.some(n,(t=>t.cuid===e.cuid&&(s||(0,S.default)(t,e)))))),h=h||t.length>0;const r=(0,l.chain)(n,(0,l.concat)(t),(0,l.uniqBy)((e=>e.cuid)),(0,l.sortBy)((e=>(p?-1:1)*e.createdTime)),(0,l.filter)((e=>!e.isDeletedMessage())));0===i?(this._conversations[e].files.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() FILES mergedUniqueSortedItems: "+r.length)):1===i?(this._conversations[e].links.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() LINKS mergedUniqueSortedItems: "+r.length)):2===i&&(this._conversations[e].media.messages=r,m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() MEDIA mergedUniqueSortedItems: "+r.length))})),h&&(m.log(g.LogTraceArea.ConversationMediaStore,"_putMessages() triggering "+f.mriOrId(e)+" causeId: "+i),this.trigger(e)),r.Resolved()}_needsMoreMessages(e,t){return this._needsMoreFileMessages(e)||this._needsMoreLinksMessages(e)||this._needsMoreMediaMessages(e,t)}_needsMoreFileMessages(e){return this._conversations[e].files.messages.length<this._conversations[e].files.minResults}_needsMoreLinksMessages(e){return this._conversations[e].links.messages.length<this._conversations[e].links.minResults}_needsMoreMediaMessages(e,t=!1){const s=this._conversations[e].media.messages.length;return!t&&s<this._conversations[e].media.minResults||t&&s===this._conversations[e].media.minResults}_getFilesForConversation(e,t){if(this._conversations[e].filesRetrievalState===T.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getFilesForConversation - retrieval in progress. causeId: "+t);this._conversations[e].filesRetrievalState=T.Retrieving;const s=this._conversations[e].files.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation Fetching FILES conversationId: "+f.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),y.default.getFilesForConversation(e,s).then(b).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].filesRetrievalState=T.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation retrieved FILES conversationId: "+f.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((t=>{this._conversations[e]&&(this._conversations[e].filesRetrievalState=T.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getFilesForConversation failed to retrieve FILES conversationId: "+f.mriOrId(e)+" error: "+t.statusCode+" - "+t.statusText))}))}_getLinksForConversation(e,t){if(this._conversations[e].linksRetrievalState===T.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getLinksForConversation - retrieval in progress. causeId: "+t);this._conversations[e].linksRetrievalState=T.Retrieving;const s=this._conversations[e].links.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation Fetching LINKS conversationId: "+f.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),y.default.getLinksAndCardsForConversation(e,s).then(b).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].linksRetrievalState=T.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation retrieved LINKS conversationId: "+f.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((s=>{this._conversations[e]&&(this._conversations[e].linksRetrievalState=T.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getLinksForConversation failed to retrieve LINKS conversationId: "+f.mriOrId(e)+" error: "+s.statusCode+" - "+s.statusText+" causeId: "+t))}))}_getMediaForConversation(e,t){if(this._conversations[e].mediaRetrievalState===T.Retrieving)return void m.log(g.LogTraceArea.ConversationMediaStore,"ignoring _getMediaForConversation - retrieval in progress. causeId: "+t);this._conversations[e].mediaRetrievalState=T.Retrieving;const s=this._conversations[e].media.searchBase;m.log(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation Fetching MEDIA conversationId: "+f.mriOrId(e)+" searchOffset: "+s+", causeId: "+t),y.default.getMediaForConversation(e,s).then(b).then((s=>{this._conversations[e]&&(this._conversations[e].retrievedFromService=!0,this._conversations[e].mediaRetrievalState=T.Retrieved,this.trigger(e),m.log(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation retrieved MEDIA conversationId: "+f.mriOrId(e)+" results: "+s.length+" causeId: "+t),this._processSuccessfulSearchResults(s,e,t))})).catch((s=>{this._conversations[e]&&(this._conversations[e].mediaRetrievalState=T.Failed,this._conversations[e].retrievalFailedTimestamp=Date.now(),this.trigger(e),m.warn(g.LogTraceArea.ConversationMediaStore,"_getMediaForConversation failed to retrieve MEDIA conversationId: "+f.mriOrId(e)+" error: "+s.statusCode+" - "+s.statusText+" causeId: "+t))}))}_retrievalFromServiceFailedInTheLastMinute(e){const t=this._conversations[e],s=Date.now()-6e4;return!!t.retrievalFailedTimestamp&&t.retrievalFailedTimestamp>s}_initMinResults(e,t,s,i){this._conversations[e].files.minResults=t,this._conversations[e].links.minResults=s,this._conversations[e].media.minResults=i}_initConversation(e,t,s,i,o,n){m.log(g.LogTraceArea.ConversationMediaStore,"_initConversation conversationId: "+f.mriOrId(e)+", causeId: "+n);const r=this._conversations[e];r.isReverse=i,r.lastNextItemTime||r.lastPreviousItemTime?s&&(r.retrievedFromService=!1,m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (3) causeId: "+n),this.populateSurroundMediaForConversation(e,!0,n)):(this._conversations[e].lastNextItemTime=t,this._conversations[e].lastPreviousItemTime=t,o?o.then((()=>{m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (1) causeId: "+n),this.populateSurroundMediaForConversation(e,!1,n)})):(m.log(g.LogTraceArea.ConversationMediaStore,"_initConv: getting more (2) causeId: "+n),this.populateSurroundMediaForConversation(e,!1,n)))}getCombinedRetrievalState(e){let t=T.None;const s=this._conversations[e].mediaRetrievalState,i=this._conversations[e].filesRetrievalState,o=this._conversations[e].linksRetrievalState;return s===i&&i===o?t=s:s===T.Failed||i===T.Failed||o===T.Failed?t=T.Failed:s===T.Retrieving||i===T.Retrieving||o===T.Retrieving?t=T.Retrieving:s!==T.Retrieved&&i!==T.Retrieved&&o!==T.Retrieved||(t=T.Retrieved),m.log(g.LogTraceArea.ConversationMediaStore,"getCombinedRetrievalState() combinedRetrievalState: "+t),t}getMediaRetrievalState(e){const t=this._conversations[e].mediaRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getMediaRetrievalState() mediaRetrievalState: "+t),t}getFilesRetrievalState(e){const t=this._conversations[e].filesRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getFilesRetrievalState() filesRetrievalState: "+t),t}getLinksRetrievalState(e){const t=this._conversations[e].linksRetrievalState;return m.log(g.LogTraceArea.ConversationMediaStore,"getLinksRetrievalState() linksRetrievalState: "+t),t}getMediaForConversation(e,t,s=5,i=!1,n,r){const a=v.default.newCauseId(),l=this._conversations[e].media.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getMediaForConversation() MEDIA mediaMessages: "+l.length+", causeId: "+a),this._initMinResults(e,0,0,s),this._initConversation(e,t,i,!!n,r,a),o.sortBy(l,(e=>(n?-1:1)*e.createdTime))}getFilesForConversation(e,t,s=5,i=!1,n){const r=v.default.newCauseId(),a=this._conversations[e].files.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getFilesForConversation() FILES fileMessages: "+a.length+", causeId: "+r),this._initMinResults(e,s,0,0),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a,(e=>(n?-1:1)*e.createdTime))}getLinksForConversation(e,t,s=5,i=!1,n){const r=v.default.newCauseId(),a=this._conversations[e].links.messages;return m.log(g.LogTraceArea.ConversationMediaStore,"getLinksForConversation() LINKS linkMessages: "+a.length+", causeId: "+r),this._initMinResults(e,0,s,0),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a,(e=>(n?-1:1)*e.createdTime))}getCombinedItemsForConversation(e,t,s=5,i=!1,n){const r=v.default.newCauseId(),a=this._conversations[e].files.messages,l=this._conversations[e].links.messages,d=this._conversations[e].media.messages,c=this._conversations[e].isReverse;return m.log(g.LogTraceArea.ConversationMediaStore,"getCombinedItemsForConversation(): "+f.mriOrId(e)+" causeId: "+r),this._initMinResults(e,s,s,s),this._initConversation(e,t,i,!!n,void 0,r),o.sortBy(a.concat(l,d),(e=>(c?-1:1)*e.createdTime))}fetchMoreMessages(e,t){if(!this._conversations[e])return;const s=v.default.newCauseId();if(m.log(g.LogTraceArea.ConversationMediaStore,"fetchMoreMessages("+t+"): conversationId: "+f.mriOrId(e)+" causeId: "+s),t&M.Media){const t=this._conversations[e].media.messages.length;t>0&&t-1>this._conversations[e].media.searchBase?(this._conversations[e].media.searchBase=t-1,this._getMediaForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more media to get. causeId: "+s)}if(t&M.Links){const t=this._conversations[e].links.messages.length;t>0&&t-1>this._conversations[e].links.searchBase?(this._conversations[e].links.searchBase=t-1,this._getLinksForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more links to get. causeId: "+s)}if(t&M.Files){const t=this._conversations[e].files.messages.length;t>0&&t-1>this._conversations[e].files.searchBase?(this._conversations[e].files.searchBase=t-1,this._getFilesForConversation(e,s)):m.log(g.LogTraceArea.ConversationMediaStore,"no more files to get. causeId: "+s)}}isPopulatingOfSurroundMediaInProgressForConversation(e){return this._populateSurroundMediaInProgress[e]}populateSurroundMediaForConversation(e,t,s){return s=s+":"+v.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populateSurroundMediaForConversation() conversationId: "+f.mriOrId(e)+" causeId: "+s),this._populateSurroundMediaInProgress[e]&&!t?r.Resolved():(this._populateSurroundMediaInProgress[e]=!0,r.all([this.populateNextMediaForConversation(e,s),this.populatePreviousMediaForConversation(e,s)]).then((()=>{this._populateSurroundMediaInProgress[e]=!1,this.trigger(e)})))}populateNextMediaForConversation(e,t){return t=t+":"+v.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populateNextMediaForConversation() conversationId: "+f.mriOrId(e)+" causeId: "+t),this._conversations[e]?(m.log(g.LogTraceArea.ConversationMediaStore,"populateNextMediaForConversation() lastNextItemTime: "+new Date(this._conversations[e].lastNextItemTime).toString()+", causeId: "+t),r.fromThenable(C.MessagesRepository.getMessagesForConversationAfterTime(e,this._conversations[e].lastNextItemTime,this._getMaxMessagesToLoad(),!1)).then((e=>this._processNextConversationMessagesFromDb(e,t)))):r.Resolved()}populatePreviousMediaForConversation(e,t){if(t=t+":"+v.default.newCauseId(),m.log(g.LogTraceArea.ConversationMediaStore,"populatePreviousMediaForConversation() conversationId: "+f.mriOrId(e)+", causeId: "+t),this._conversations[e]){const s=this._conversations[e].lastPreviousItemTime;m.log(g.LogTraceArea.ConversationMediaStore,"populatePreviousMediaForConversation() lastPreviousItemTime: "+new Date(s).toString()+", causeId: "+t);const i=u.default.getEarliestKnownMessageTime(e);return i===Number.MAX_VALUE||s<i?r.fromThenable(C.MessagesRepository.getMessagesForConversationBeforeTime(e,s,25,!1)).then((s=>this._processPreviousConversationMessagesFromDb(s,e,t))):r.fromThenable(C.MessagesRepository.getMessagesForConversationAndTimeRange(e,i,s,!0,this._getMaxMessagesToLoad())).then((s=>this._processPreviousConversationMessagesFromDb(s,e,t)))}return r.Resolved()}_getMaxMessagesToLoad(){return a.default.getS4LMessagingFeatures().maxMessagesToLoadFromDBForMediaSearch||25}test_setIsPopulatingOfSurroundMediaInProgressForConversation(e,t){this._populateSurroundMediaInProgress[e]=t}};i.__decorate([n.disableWarnings],I.prototype,"_startedTrackingKey",null),i.__decorate([n.disableWarnings],I.prototype,"_stoppedTrackingKey",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getCombinedRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getMediaRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getFilesRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getLinksRetrievalState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getMediaForConversation",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getFilesForConversation",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getLinksForConversation",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"getCombinedItemsForConversation",null),i.__decorate([n.autoSubscribe],I.prototype,"fetchMoreMessages",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],I.prototype,"isPopulatingOfSurroundMediaInProgressForConversation",null),I=i.__decorate([n.AutoSubscribeStore],I),t.default=new I},202617:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOT_FOUND=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=s(44717),d=i.__importDefault(s(615364)),c=i.__importDefault(s(389659)),u=s(815146),h=i.__importStar(s(85385)),p=i.__importDefault(s(114818)),g=s(777745),m=i.__importDefault(s(262834)),S=i.__importDefault(s(760989)),_=s(309515),f=s(306194);var y;t.NOT_FOUND=-1,function(e){e[e.SearchVisibility=0]="SearchVisibility",e[e.Timestamp=1]="Timestamp",e[e.Loading=2]="Loading",e[e.FocusedMessageIndex=3]="FocusedMessageIndex",e[e.Results=4]="Results",e[e.Query=5]="Query",e[e.Highlight=6]="Highlight"}(y||(y={}));const v={query:"",messageId:void 0};let C=class extends n.StoreBase{constructor(){super(...arguments),this._results=[],this._focusedMessageIndex=t.NOT_FOUND,this._isLoading=!1,this._resultMessageIds=[]}getSearchQuery(){return this._searchConversationQuery}findQuery(e,t,s){if(this._querySessionId=s,(0,p.default)(this._searchConversationQuery,e))return r.Resolved(this._results.length);if(this._searchConversationQuery=e,this._conversationId=t,0!==o.trim(e.query).length){this._isLoading=!0;const e=this._search(this._searchConversationQuery,t);return this.trigger([y.Query,y.Loading]),e}return this._clearData(),r.Resolved(0)}resetSearch(){this._searchConversationQuery=v,h.log(u.LogTraceArea.MessageSearch,"Reset search"),this._clearData()}cancelSearch(){this._searchConversationQuery=void 0,this._conversationId=void 0,h.log(u.LogTraceArea.MessageSearch,"Cancel search"),this._clearData()}getResults(){return this._results}isLoadingResults(){return this._isLoading}isMessageInConvSearchResults(e){return o.includes(this._resultMessageIds,e)}setTimestamp(e,t,s,i){e&&(o.isUndefined(this._conversationId)||(0,_.markMessageSearchScenarioResultMessageTimestamp)(this._querySessionId,e,this._conversationId),this._scrollRequest=e?{id:s||S.default.newGuid(),messageTimestamp:e,zeroTermSearch:!!i,cuid:t}:void 0,h.log(u.LogTraceArea.MessageSearch,`Search for message with timestamp: ${e}, cuid: ${t}`),this.trigger(y.Timestamp))}getTimestamp(){return this._scrollRequest}focusMessage(e){if(this._resultMessageIds){const t=this._resultMessageIds.indexOf(e);t>=0&&(this._focusedMessageIndex=t,this.trigger(y.FocusedMessageIndex))}}focusPreviousMessage(){this._focusedMessageIndex<this._results.length-1&&(this._focusedMessageIndex++,h.log(u.LogTraceArea.MessageSearch,"Navigating to previous result. Current message index: "+this._focusedMessageIndex),h.track(new g.NavigatedToPrevResult),(0,_.invalidateSearchScenario)(f.ScenarioSearchTypes.MessageInConversation,this._querySessionId),this.trigger(y.FocusedMessageIndex))}focusNextMessage(){this._focusedMessageIndex>0&&(this._focusedMessageIndex--,h.log(u.LogTraceArea.MessageSearch,"Navigating to next result. Current message index: "+this._focusedMessageIndex),h.track(new g.NavigatedToNextResult),(0,_.invalidateSearchScenario)(f.ScenarioSearchTypes.MessageInConversation,this._querySessionId),this.trigger(y.FocusedMessageIndex))}isFocusingNextDisabled(){return 0===this._focusedMessageIndex||0===this._results.length}isFocusingPreviousDisabled(){return 0===this._results.length||this._focusedMessageIndex+1===this._results.length}getFocusedMessageIndex(){return this._focusedMessageIndex}isMessageFocused(e){if(this._focusedMessageIndex!==t.NOT_FOUND){const t=this._results[this._focusedMessageIndex];return!!t&&t.MessageId===e}return!1}_search(e,t){return m.default.getSearchResults({query:e.query,limit:a.default.getS4LMessagingFeaturesNoSubscription().inConversationMessageSearch.initialPageSize,conversationId:t}).then((s=>{if(!this._searchConversationQuery||this._searchConversationQuery.query!==e.query||t!==this._conversationId)return r.Rejected();let i=s;const n=(0,d.default)().getConversation(t);if(n){const e=n.getConversationProperty(l.ConversationProps.DeleteTimestamp);e&&(i=o.filter(s,(t=>this._isResultDisplayable(t,e))))}return this._updateResults(i,e),this._results.length}))}_updateResults(e,s){if(e.length>0&&s.messageId){const t=o.findIndex(e,(e=>e.MessageId===s.messageId));this._focusedMessageIndex=t,h.log(u.LogTraceArea.MessageSearch,"Updating current message index: "+this._focusedMessageIndex)}else this._focusedMessageIndex=e.length?0:t.NOT_FOUND;this._results=e,this._isLoading=!1,this._resultMessageIds=e.map((e=>e.MessageId)),h.log(u.LogTraceArea.MessageSearch,"Updating search results. Count: "+this._results.length+". Current message index: "+this._focusedMessageIndex),this.trigger([y.Results,y.FocusedMessageIndex,y.Loading])}_isResultDisplayable(e,t){return c.default.getUnixMillisecondsTimestamp(e.CreationDate)>t}_clearData(){this._focusedMessageIndex=t.NOT_FOUND,this._results=[],this._resultMessageIds=[],this._isLoading=!1,this._scrollRequest=void 0,this.trigger([y.FocusedMessageIndex,y.Results,y.Loading,y.Query,y.Timestamp])}};i.__decorate([(0,n.autoSubscribeWithKey)(y.Query)],C.prototype,"getSearchQuery",null),i.__decorate([n.disableWarnings],C.prototype,"findQuery",null),i.__decorate([(0,n.autoSubscribeWithKey)(y.Results)],C.prototype,"getResults",null),i.__decorate([(0,n.autoSubscribeWithKey)(y.Loading)],C.prototype,"isLoadingResults",null),i.__decorate([(0,n.autoSubscribeWithKey)(y.Results)],C.prototype,"isMessageInConvSearchResults",null),i.__decorate([(0,n.autoSubscribeWithKey)(y.Timestamp)],C.prototype,"getTimestamp",null),i.__decorate([n.disableWarnings],C.prototype,"focusMessage",null),i.__decorate([(0,n.autoSubscribeWithKey)([y.FocusedMessageIndex,y.Results])],C.prototype,"isFocusingNextDisabled",null),i.__decorate([(0,n.autoSubscribeWithKey)([y.FocusedMessageIndex,y.Results])],C.prototype,"isFocusingPreviousDisabled",null),i.__decorate([(0,n.autoSubscribeWithKey)(y.FocusedMessageIndex)],C.prototype,"getFocusedMessageIndex",null),i.__decorate([(0,n.autoSubscribeWithKey)([y.FocusedMessageIndex,y.Results])],C.prototype,"isMessageFocused",null),C=i.__decorate([n.AutoSubscribeStore],C),t.default=C},349004:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041);let r=class extends n.StoreBase{constructor(){super(...arguments),this._selectedConversations=[]}getSelectedConversations(){return this._selectedConversations}addConversation(e){this._selectedConversations=this._selectedConversations.concat(e),this.trigger()}removeConversation(e){this._selectedConversations=o.without(this._selectedConversations,e),this.trigger()}};i.__decorate([n.autoSubscribe],r.prototype,"getSelectedConversations",null),r=i.__decorate([n.AutoSubscribeStore],r),t.default=r},776546:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041),n=i.__importDefault(s(114818));let r=class extends o.StoreBase{constructor(){super(...arguments),this._spacerWidths={left:0,right:0}}storeSpacerWidths(e){(0,n.default)(this._spacerWidths,e)||(this._spacerWidths=e,this.trigger())}getSpacerWidths(){return this._spacerWidths}setRightPositionForJumpToBottomButton(e){this._jumpToBottomRightPosition!==e&&(this._jumpToBottomRightPosition=e,this.trigger())}getRightPositionForJumpToBottomButton(){return this._jumpToBottomRightPosition}};i.__decorate([o.autoSubscribe],r.prototype,"getSpacerWidths",null),i.__decorate([o.autoSubscribe],r.prototype,"getRightPositionForJumpToBottomButton",null),r=i.__decorate([o.AutoSubscribeStore],r),t.default=new r},892034:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(167606),r=s(6625),a=s(217041),l=i.__importDefault(s(974634)),d=i.__importStar(s(397691)),c=i.__importDefault(s(150343)),u=i.__importDefault(s(615364)),h=i.__importDefault(s(835095)),p=s(472110),g=i.__importStar(s(637961)),m=s(626065),S=i.__importStar(s(7040)),_=i.__importStar(s(85385)),f=i.__importDefault(s(114818)),y=i.__importStar(s(437782)),v=s(848523),C=i.__importStar(s(446574));let T=class extends a.StoreBase{constructor(){super(),this.onInputEntitiesUpdatedEvent=new l.default,this._conversations={},this._conversationsBuffer={},this.saveMessageInput=(e,t)=>{if(!this._conversations[e]||!(0,f.default)(this._conversations[e].messages,t.messages)||this._conversations[e].type!==t.type){const s=o.join(o.map(t.messages,(e=>e.cuid)));_.log(n.LogTraceArea.ConversationsDraftStore,`saveMessageInput for conversation: ${y.mriOrId(e)}, messageType: ${v.SavedMessageType[t.type]}`+(o.isEmpty(s)?"":`, message ids: ${s}`)+`, currently stored: ${this.getConversationsNumber()}`)}this._conversationsBuffer[e]=Object.assign({},t)},this.clearMessageInput=e=>{this.getSavedMessageInput(e)&&(_.log(n.LogTraceArea.ConversationsDraftStore,`clearMessageInput for conversation: ${y.mriOrId(e)}, still stored: ${Object.keys(this._conversations).length}`),c.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&h.default.deleteSavedMessage(e).catch(o.noop)),delete this._conversations[e],delete this._conversationsBuffer[e],this.trigger(e)},this.storeSavedMessage=e=>{const t=this._conversations[e];return t?d.fromThenable(h.default.storeSavedMessage(e,t)):d.Resolved()},this._setSavedMessageInputs=e=>{_.log(n.LogTraceArea.ConversationsDraftStore,`onLoadSavedMessageInputs for conversationsloaded: ${e.length}`),e.forEach((e=>{const t=e&&e.conversationId?e.conversationId:void 0;t&&(this._conversations[t]=e)})),this._cleanupBlankEntries()},this._updateInputEntities=e=>{const t=e.forCustomContext,s=this._conversationsBuffer[t]||this._conversations[t];if(s)s.inputEntitiesDataVersion<=e.newContent.downStreamDataVersion&&(this._conversationsBuffer[t]=Object.assign(Object.assign({},s),{inputEntities:S.applyEditableContentToInputEntities(e.newContent,s.inputEntities),pastedTextType:e.newContent.pastedTextType}),_.log(n.LogTraceArea.ConversationsDraftStore,`_updateInputEntities for conversation:${y.mriOrId(t)}, updated entry count: ${this._conversationsBuffer[t].inputEntities.length}`));else{const s=S.applyEditableContentToInputEntities(e.newContent,[]);_.log(n.LogTraceArea.ConversationsDraftStore,`_updateInputEntities for conversation: ${y.mriOrId(t)}, created entry count: ${s.length}`),o.size(s)>0&&(this._conversationsBuffer[t]={inputEntities:s,inputEntitiesDataVersion:e.newContent.downStreamDataVersion,messages:void 0,type:v.SavedMessageType.None,timestamp:Date.now(),pastedTextType:e.newContent.pastedTextType},_.track(new p.DraftMessageCreated))}},this._cleanupBlankEntries=()=>{const e=[];o.each(this._conversations,((t,s)=>{0!==t.inputEntities.length&&!this._isOnlySpaces(t.inputEntities)||!o.isEmpty(t.messages)&&!o.includes([v.SavedMessageType.None,v.SavedMessageType.Edited],t.type)||(e.push(s),delete this._conversations[s],c.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&h.default.deleteSavedMessage(s).catch(o.noop))})),e.length>0&&(_.log(n.LogTraceArea.ConversationsDraftStore,`_cleanupBlankEntries deleted ${e.length} entries, still stored: ${o.size(this._conversations)}`),this.trigger(e))},C.RegisterStartupable(this,"ConversationsDraftStore")}startup(){return r.dataUpdateReceivedEvent.subscribe((e=>{this._updateInputEntities(e)})),c.default.getS4LMessagingFeaturesNoSubscription().enableDraftMessagesPersistentStorage&&g.default.queueIdleTask("ConversationsDraftStore",g.TaskTypeFlags.CpuIntensive,(()=>{h.default.loadSavedMessageInputs().then(this._setSavedMessageInputs)}),g.Priority.High),Promise.resolve()}getSavedMessageInput(e){return this._conversations[e]}getDraftTimestampForConversation(e){const t=this.getSavedMessageInput(e);return t&&t.timestamp?t.timestamp:void 0}getConversationsWithDraft(){const e=[];return o.each(this._conversations,((t,s)=>{const i=(0,u.default)().getConversation(s);i&&e.push(i)})),e}getConversationsNumber(){return o.size(this._conversations)}updateInputEntitiesFromContent(e,t){return this._updateInputEntities({forCustomContext:e,newContent:t}),this}test_reset(){this._conversations={}}commit(e){return this._conversationsBuffer[e]&&(this._conversations[e]=Object.assign(Object.assign({},this._conversationsBuffer[e]),{timestamp:Date.now()}),delete this._conversationsBuffer[e],this.trigger(e),this.onInputEntitiesUpdatedEvent.fire(e)),this._cleanupBlankEntries(),this}_isOnlySpaces(e){return 1===e.length&&e[0]instanceof m.UnhandledEntity&&0===e[0].text().trim().length}};i.__decorate([a.autoSubscribe,i.__param(0,a.key)],T.prototype,"getSavedMessageInput",null),i.__decorate([a.autoSubscribe,i.__param(0,a.key)],T.prototype,"getDraftTimestampForConversation",null),i.__decorate([a.autoSubscribe],T.prototype,"getConversationsWithDraft",null),T=i.__decorate([a.AutoSubscribeStore],T),t.default=new T},710427:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(150343)),a=i.__importStar(s(44717)),l=i.__importDefault(s(892034)),d=i.__importDefault(s(615364)),c=i.__importDefault(s(732028)),u=i.__importDefault(s(574818)),h=s(491839);var p;!function(e){e[e.LastVisited=0]="LastVisited",e[e.ListMode=1]="ListMode",e[e.ConversationsLoading=2]="ConversationsLoading",e[e.ConversationsLoaded=3]="ConversationsLoaded"}(p||(p={}));let g=class extends n.StoreBase{constructor(){super(...arguments),this._listMode=h.ConversationsListMode.AllConversations,this._conversationsAreLoading=!1}setConversationsListMode(e){e!==this._listMode&&(this._listMode=e,this.trigger(p.ListMode))}getConversationsListMode(){return this._listMode}getConversationCountByFilterMode(e){return this.getShownConversations().length}_setConversationsLoadingStatus(e){this._conversationsAreLoading!==e&&(this._conversationsAreLoading=e,this.trigger(p.ConversationsLoading))}areConversationsLoading(){return this._conversationsAreLoading}loadMoreConversations(e){o.isUndefined(e)&&(e=r.default.getS4LMessagingFeaturesNoSubscription().recentConversationsIncrementor);const t=(0,d.default)();t.canPossiblyShowMoreRecentConversations()?(this._setConversationsLoadingStatus(!0),t.increaseLimitOfRecentJoinedConversationsSorted(e).then((e=>{e?this.trigger(p.ConversationsLoaded):this._setConversationsLoadingStatus(!1)}))):this._setConversationsLoadingStatus(!1)}getShownConversations(){let e=(0,d.default)().getDisplayableRecentConversationsSortedLimited();const t=r.default.getS4LMessagingFeatures();let s=l.default.getConversationsWithDraft(),i=t.enableMediaPreviewDrafts?u.default.getConversationsWithMediaDraft():[];return s=s.filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(l.default.getDraftTimestampForConversation(e.id)||0)))),i=s.filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(u.default.getDraftPreviewTimestamp(e.id)||0)))),e=o.unionBy(e,s,i,(e=>e.id)),o.compact(o.filter(e,(e=>(!e.isEncryptedThread()||c.default.shouldShowPrivateConv(e.id))&&!e.isArchived())))}setLastVisitedConversationId(e){this._lastVisitedConversationId===e||a.isBookmarkConversation(e)||(this._lastVisitedConversationId=e,this.trigger(p.LastVisited))}getLastVisitedConversationId(){return this._lastVisitedConversationId}test_reset_store(){this._listMode=h.ConversationsListMode.AllConversations,this._conversationsAreLoading=!1,this._lastVisitedConversationId=void 0}};i.__decorate([(0,n.autoSubscribeWithKey)(p.ListMode)],g.prototype,"getConversationsListMode",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.ConversationsLoaded)],g.prototype,"getConversationCountByFilterMode",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.ConversationsLoading)],g.prototype,"areConversationsLoading",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.ConversationsLoaded)],g.prototype,"getShownConversations",null),i.__decorate([(0,n.autoSubscribeWithKey)(p.LastVisited)],g.prototype,"getLastVisitedConversationId",null),g=i.__decorate([n.AutoSubscribeStore],g),t.default=new g},611439:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationsListWithFiltersStore=void 0;const i=s(197582),o=s(496486),n=s(217041),r=s(803193),a=i.__importDefault(s(150343)),l=s(85385),d=i.__importDefault(s(760989)),c=i.__importDefault(s(892034)),u=i.__importDefault(s(615364)),h=i.__importDefault(s(732028)),p=s(295939),g=s(318315),m="ConversationsListWithFiltersStore";var S;!function(e){e[e.ConversationsLoading=0]="ConversationsLoading",e[e.ConversationsLoaded=1]="ConversationsLoaded"}(S||(S={}));let _=class extends n.StoreBase{constructor(){super(),this._filterModeStore=(0,p.getRecentsFilterStore)(),this._numberOfConversationsToShow=a.default.getS4LMessagingFeaturesNoSubscription().maxRecentConversationsToShow,this._updateSortedLists();const e=e=>{const t=d.default.newCauseId();(0,l.debug)((()=>[`${m} For keys:`,(null==e?void 0:e.join(";"))||"NO_KEYS",t])),this._updateSortedLists(),(0,l.debug)((()=>[`${m} Recalculated`,t])),this.trigger(S.ConversationsLoaded)};a.default.subscribe(e),(0,u.default)().subscribe(e),(0,g.getContentChannelsStore)().subscribe(e),this._filterModeStore.subscribe((()=>{this.trigger()}))}getConversationCountByFilterMode(e){return this._getConversations(e).length}areConversationsLoading(){return this._isLoading}getShownConversations(){const e=this._getConversations(this._filterModeStore.getFilterModeNoSubscription()),t="channels"===this._filterModeStore.getFilterModeNoSubscription()?[]:c.default.getConversationsWithDraft().filter((e=>e.isCurrentUserMember()&&(!e.isDeleted()||e.getDeletedTimestamp()<(c.default.getDraftTimestampForConversation(e.id)||0))));return(0,o.unionBy)(e,t,(e=>e.id)).filter((e=>(!e.isEncryptedThread()||h.default.shouldShowPrivateConv(e.id))&&!e.isArchived()))}loadMoreConversations(e){void 0===e&&(e=a.default.getS4LMessagingFeaturesNoSubscription().recentConversationsIncrementor),this._canShowMoreFilteredConversations(this._filterModeStore.getFilterModeNoSubscription())?(this._setConversationsLoadingStatus(!0),this._increaseNumberOfConversationsToShow(e)):this._setConversationsLoadingStatus(!1)}_increaseNumberOfConversationsToShow(e){this._numberOfConversationsToShow+=e,this.trigger(S.ConversationsLoaded)}_canShowMoreFilteredConversations(e){return this._numberOfConversationsToShow<this._sortedListsByFilter[e].length}_getConversations(e){return this._sortedListsByFilter[e].slice(0,this._numberOfConversationsToShow)}_setConversationsLoadingStatus(e){this._isLoading!==e&&(this._isLoading=e,this.trigger(S.ConversationsLoading))}_updateSortedLists(){this._sortedListsByFilter=this._mergeConversationsWithChannels()}_mergeConversationsWithChannels(){const e=(0,u.default)().getDisplayableRecentConversationsSortedAll().filter((e=>!(0,r.isContentChannel)(e))),t=(0,g.getContentChannelsStore)().getFollowedChannels().map(r.mapToSkypeConversationLocal);return{all:(0,p.mergeConversations)(e,t),channels:t,chats:e}}};t.ConversationsListWithFiltersStore=_,i.__decorate([(0,n.autoSubscribeWithKey)(S.ConversationsLoaded)],_.prototype,"getConversationCountByFilterMode",null),i.__decorate([(0,n.autoSubscribeWithKey)(S.ConversationsLoading)],_.prototype,"areConversationsLoading",null),i.__decorate([(0,n.autoSubscribeWithKey)(S.ConversationsLoaded)],_.prototype,"getShownConversations",null),i.__decorate([n.disableWarnings],_.prototype,"_updateSortedLists",null),t.ConversationsListWithFiltersStore=_=i.__decorate([n.AutoSubscribeStore],_)},615364:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0,t.default=function(){return P||(P=new k)};const i=s(197582),o=i.__importStar(s(496486)),n=i.__importDefault(s(720415)),r=s(217041),a=i.__importStar(s(397691)),l=i.__importDefault(s(150343)),d=i.__importDefault(s(97572)),c=i.__importDefault(s(304623)),u=i.__importStar(s(596467)),h=s(815146),p=i.__importStar(s(85385)),g=i.__importDefault(s(201721)),m=i.__importDefault(s(363091)),S=i.__importStar(s(437782)),_=s(370073),f=i.__importDefault(s(306214)),y=i.__importStar(s(446574)),v=i.__importStar(s(442699)),C=s(773151),T=s(183363),M=s(742403),b=s(88766),I=!0,w=C.RecentsSortBy.Time;t.TriggerKeys={AllConversations:"all",RecentDisplayed:"recentDisplayed",RecentDisplayedLimited:"recentDisplayedLimited"};let P,k=class extends r.StoreBase{constructor(){super(300),this._allConversations={},this._allOneToOneThreadIdsByUserMri={},this._allUserMriByOneOnOneThreadIds={},this._mriThreadMapping=new T.MriThreadMapping,this._fakedTimestamps={},this._fakedLastMessages={},this._showFavorites=I,this._recentsSortedBy=w,this._sortedRecentConversations=new f.default((e=>e.id),(e=>this.recentConversationsSortRank(e))),this.recentConversationsSortRank=e=>{let t=-this._getConvTimestamp(e);if(this._showFavorites&&e.isFavorite()&&(t-=_.MagicFavoritesPinnedNumber),this._recentsSortedBy===C.RecentsSortBy.Unread){const s=c.default.getConversationMetaFromMemoryCache(e.id);s&&s.counts&&1===s.counts.hasUnread&&(t-=_.MagicUnreadPinnedNumber)}return t},this._onCallUpdate=(0,b.createCallStateListener)((e=>[e.getConversationMri(),Boolean(e.getJoinContext())]),((e,t)=>e[0]===t[0]&&e[1]===t[1]),((e,t)=>{if(l.default.getS4LCMCFeaturesNoSubscription().enableCallRegistry){const s=[e.getConversationMri(),null==t?void 0:t[0]].filter(Boolean);s.length>0&&this.trigger(s)}})),y.RegisterStartupable(this,"ConversationsStore",[d.default,c.default,g.default])}_getConvTimestamp(e){return this._fakedTimestamps[e.id]||e.getTimestamp()}resortRecentConversations(){const{recentsShowCategories:e,recentsSortedBy:s}=g.default.getUserPreferencesLocal();this._showFavorites=null!=e?e:I,this._recentsSortedBy=null!=s?s:w,p.log(h.LogTraceArea.ConversationStore,"_getSortedRecentsConversations called ShowFavorites:"+this._showFavorites),this._sortedRecentConversations.sort(this.recentConversationsSortRank),this.trigger([t.TriggerKeys.RecentDisplayed,t.TriggerKeys.RecentDisplayedLimited])}startup(){this._maxRecentConversationsToShow=l.default.getS4LMessagingFeatures().maxRecentConversationsToShow;const{recentsShowCategories:e,recentsSortedBy:t}=g.default.getUserPreferencesLocal();return this._showFavorites=null!=e?e:I,this._recentsSortedBy=null!=t?t:w,this._conversationsUpdatedSubscription=c.default.conversationsUpdated.subscribe((e=>{const t=o.uniq(o.flatten(o.map(e,(e=>this._updateConversation(e.conv)))));t.length>0&&this.trigger(t)})),this._blockedMriStoreSubscription=d.default.subscribe((e=>{let t=[];o.each(e,(e=>{const s=this.getConversation(e);if(s&&(t=this._updateConversation(s,!1)),s&&this._allOneToOneThreadIdsByUserMri[e]){const s=this._allOneToOneThreadIdsByUserMri[e],i=this.getConversation(s);i&&t.push(...this._updateConversation(i,!1))}})),t=o.uniq(t),t.length>0&&this.trigger(t)})),b.callRegistry.addListener("call",this._onCallUpdate),c.default.loadAndCacheAllNonHighlightsConversations()}test_reset_store(){this._allConversations={},this._allOneToOneThreadIdsByUserMri={},this._allUserMriByOneOnOneThreadIds={},this._fakedTimestamps={},this._fakedLastMessages={},this._maxRecentConversationsToShow=0,this._showFavorites=I,this._recentsSortedBy=w,this._sortedRecentConversations=new f.default((e=>e.id),this.recentConversationsSortRank),this._conversationsUpdatedSubscription&&(this._conversationsUpdatedSubscription.unsubscribe(),this._conversationsUpdatedSubscription=void 0),this._blockedMriStoreSubscription&&(d.default.unsubscribe(this._blockedMriStoreSubscription),this._blockedMriStoreSubscription=void 0),b.callRegistry.removeListener("call",this._onCallUpdate)}_updateConversation(e,s=!0){const i=[];if(!e)return i;if(m.default.isMyMri(e.id))return p.log(h.LogTraceArea.ConversationStore,"Ignoring conversation with self: "+S.mriOrId(e.id)),i;const n=this._allConversations[e.id],r=n===e;if(s&&r)return i;l.default.getS4LCMCFeaturesNoSubscription().enableCallRegistry&&this._updateCallRetention(e,n),this._allConversations[e.id]=e,i.push(t.TriggerKeys.AllConversations);if(!this._getConvTimestamp(e)&&!e.isDeleted())return i;if(e.isOneToOneUserConvWithThreadIdSupport()){const t=e.getOneOnOneThreadId();t&&(this._allOneToOneThreadIdsByUserMri[e.id]=t,this._allUserMriByOneOnOneThreadIds[t]=e.id)}else if(e.isOneToOneThread()&&o.isUndefined(this._allUserMriByOneOnOneThreadIds[e.id])){const t=e.getOtherPartyMriForOneToOneThread();t?(this._allOneToOneThreadIdsByUserMri[t]=e.id,this._allUserMriByOneOnOneThreadIds[e.id]=t):(p.log(h.LogTraceArea.ConversationStore,"Can not tell other party from 1:1 thread "+e.id),p.track(new v.DevDebug("ConversationsStore","Can not tell other party from 1:1 thread")))}else if(e.isV2OneToOneThread()&&!this._mriThreadMapping.hasThreadId(e.id)){const t=e.getOtherPartyMriForOneToOneThread();t?this._mriThreadMapping.add(t,e.id):(p.warn(h.LogTraceArea.ConversationStore,`Failed to get counter-party mri for v2 1:1 thread: ${e.id}`),p.track(new v.DevDebug("ConversationsStore","Failed to get counter-party mri for v2 1:1 thread")))}const a=e.getTimestamp();this._fakedTimestamps[e.id]&&a>this._fakedTimestamps[e.id]&&delete this._fakedTimestamps[e.id],this._fakedLastMessages[e.id]&&e.lastMessage&&(this._fakedLastMessages[e.id].isLastChangeScheduledCallMetadata()&&this._fakedLastMessages[e.id].createdTime>e.lastMessage.createdTime||delete this._fakedLastMessages[e.id]);const d=this._updateDisplayableList(e);return i.push(...d.triggerKeys),s&&r&&!d.displayabilityChanged||i.push(e.id),i}_updateDisplayableList(e){if(!e)return{displayabilityChanged:!1,triggerKeys:[]};let s,i;const o=[],r=this._sortedRecentConversations.contains(e.id),a=u.getConversationDisplayableStatus(e);return r&&!a.isDisplayable&&n.default.closeSplitView(e.id),r&&(s=a.isDisplayable?this._sortedRecentConversations.getIndex(e.id):this._sortedRecentConversations.remove(e.id)),a.isDisplayable&&(this._sortedRecentConversations.put(e),i=this._sortedRecentConversations.getIndex(e.id)),(void 0!==i&&i!==s&&i<this._maxRecentConversationsToShow||void 0!==s&&s<this._maxRecentConversationsToShow&&!a.isDisplayable)&&o.push(t.TriggerKeys.RecentDisplayedLimited),r!==a.isDisplayable&&o.push(t.TriggerKeys.RecentDisplayed),{displayabilityChanged:r!==a.isDisplayable,triggerKeys:o}}_updateCallRetention(e,t){var s;const i=e.liveState(),o=null==i?void 0:i.conversationId,n=o?b.callRegistry.getCall(o):null,r=null===(s=null==t?void 0:t.liveState())||void 0===s?void 0:s.conversationId;r!==o&&(r&&b.callRegistry.getCall(r).release(b.CallRetainer.LiveStatePrefix+t.id),null==n||n.retain(b.CallRetainer.LiveStatePrefix+e.id)),n&&(n.setConversationMri(e.id),i&&n.setJoinContext(i))}fakeConversationTime(e,t){this._fakedTimestamps[e]=t;const s=this.getConversation(e),i=[e];s&&i.push(...this._updateConversation(s,!1)),this.trigger(o.uniq(i))}fakeLastMessage(e,t){this._fakedLastMessages[e]=t,this.trigger(e)}getConversationPotentiallyBeforeStartupAsync(e){const t=this._allConversations[e];return t?a.Resolved(t):c.default.getConversationMetaAsync(e).then((e=>{if(e)return this.trigger(this._updateConversation(e.conv)),e.conv}))}getConversationNoSubscription(e){const t=this._allConversations[e];if(!t){const t=c.default.getConversationMetaFromMemoryCache(e);return null==t?void 0:t.conv}return t}getConversation(e){const t=this._allConversations[e];if(!t){const t=c.default.getConversationMetaFromMemoryCache(e);if(t)return this.trigger(this._updateConversation(t.conv)),t.conv;c.default.ensureConversationLoaded(e)}return t}isConversationKnownNoSubscription(e){return!!this._allConversations[e]}isConversationKnown(e){return!!this._allConversations[e]}isClearApplicableAndKeepInRecents(e){const t=this._allConversations[e];return!!t&&(t.isThread()&&!t.isOneOnOne())}ableToViewConversation(e){const t=this._allConversations[e];return t?p.log(h.LogTraceArea.ConversationStore,"ableToViewConversation: "+S.mriOrId(e)+"isCurrentUserMember: ",t.isCurrentUserMember()," is Blocked: ",this.isConversationBlocked(t)):p.log(h.LogTraceArea.ConversationStore,"conversation not found in this._allConversations"),t&&t.isCurrentUserMember()&&!this.isConversationBlocked(t)}getAllConversationsInMemory(){return this._allConversations}getFakeTimestamp(e){return this._fakedTimestamps[e]}getFakeLastMessageFallback(e){return this._fakedLastMessages[e]}hasJoinedConversationsWithCall(){return!!o.find(this._allConversations,(e=>e.isCurrentUserMember()&&!!e.lastCallTime))}getMostRecentJoinedConversationId(e){const t=this.getDisplayableRecentConversationsSortedAll(),s=e?o.find(t,(t=>t.id!==e)):o.head(t);return s?s.id:void 0}isConversationBlocked(e){return!!e&&d.default.isMriBlocked(e.getOtherPartyMriOrConvId())}getSortedArchivedConversations(){return o.sortBy(this.getArchivedConversations(),(e=>-this._getConvTimestamp(e)))}getArchivedConversations(){return o.filter(this._allConversations,(e=>e.isArchived()&&u.isConversationDisplayable(e)))}getArchivedChats(){return this.getSortedArchivedConversations().filter((e=>!(0,M.isContentChannel)(e)&&!(0,M.isTodayBot)(e.id)))}getArchivedChannels(){return this.getSortedArchivedConversations().filter((e=>(0,M.isContentChannel)(e)||(0,M.isTodayBot)(e.id)))}getDisplayableRecentConversationsSortedAll(){return this._sortedRecentConversations.getSortedArray()}getDisplayableRecentConversationsSortedLimited(){return this._sortedRecentConversations.getSortedArray().slice(0,this._maxRecentConversationsToShow)}canPossiblyShowMoreRecentConversations(){return this._maxRecentConversationsToShow<this._sortedRecentConversations.getLength()}increaseLimitOfRecentJoinedConversationsSorted(e){return this.canPossiblyShowMoreRecentConversations()?(p.log(h.LogTraceArea.ConversationStore,"Expanding displayable recent list limit, increase from "+this._maxRecentConversationsToShow+" by increment "+e),this._maxRecentConversationsToShow+=e,this.trigger(t.TriggerKeys.RecentDisplayedLimited),a.Resolved(!0)):a.Resolved(!1)}getTranslatedConversations(){return o.filter(this._allConversations,(e=>!e.isTranslationDisabled()))}getOtherPartyMriFromOneToOneThreadId(e){const t=this._allUserMriByOneOnOneThreadIds[e];return o.isUndefined(t)&&p.warn(h.LogTraceArea.ConversationStore,"Could not find otherPartyMri for OneOnOneThreadId"),t}getV2ThreadMapping(){return this._mriThreadMapping}};i.__decorate([r.disableWarnings],k.prototype,"getConversationNoSubscription",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],k.prototype,"getConversation",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],k.prototype,"isConversationKnown",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],k.prototype,"isClearApplicableAndKeepInRecents",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],k.prototype,"ableToViewConversation",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],k.prototype,"getAllConversationsInMemory",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],k.prototype,"getFakeTimestamp",null),i.__decorate([r.autoSubscribe,i.__param(0,r.key)],k.prototype,"getFakeLastMessageFallback",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],k.prototype,"hasJoinedConversationsWithCall",null),i.__decorate([r.autoSubscribe],k.prototype,"getMostRecentJoinedConversationId",null),i.__decorate([r.autoSubscribe],k.prototype,"isConversationBlocked",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],k.prototype,"getSortedArchivedConversations",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],k.prototype,"getArchivedConversations",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],k.prototype,"getArchivedChats",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.AllConversations)],k.prototype,"getArchivedChannels",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.RecentDisplayed)],k.prototype,"getDisplayableRecentConversationsSortedAll",null),i.__decorate([(0,r.autoSubscribeWithKey)(t.TriggerKeys.RecentDisplayedLimited)],k.prototype,"getDisplayableRecentConversationsSortedLimited",null),i.__decorate([(0,r.autoSubscribeWithKey)([t.TriggerKeys.RecentDisplayed])],k.prototype,"canPossiblyShowMoreRecentConversations",null),k=i.__decorate([r.AutoSubscribeStore],k)},363394:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomCallReactionsStore=void 0,t.default=function(){return u||(u=new h)};const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(150343)),a=s(841646),l=i.__importStar(s(704704)),d=i.__importDefault(s(341994)),c=i.__importStar(s(446574));let u,h=class extends a.CustomReactionsStoreBase{constructor(){super(),c.RegisterStartupable(this,"CustomCallReactionsStore",[d.default])}startup(){var e;super.startup();const t=null===(e=r.default.getS4LCMCFeatures())||void 0===e?void 0:e.customCallReactions;return this._enabled=null==t?void 0:t.enabled,this._maxReactionsNumber=null==t?void 0:t.maxNumberOfCustomReactions,this._initialTabId=null==t?void 0:t.initialTabId,r.default.subscribe((()=>{const{enabled:e,maxNumberOfCustomReactions:t,initialTabId:s}=r.default.getS4LCMCFeatures().customCallReactions;let i=!1;this._enabled!==e&&(this._enabled=e,i=!0),this._maxReactionsNumber!==t&&(this._maxReactionsNumber=t,i=!0),this._initialTabId=s,i&&this.trigger()})),Promise.resolve()}getDefaultReactions(){var e;return o.assign([],null===(e=r.default.getS4LCMCFeatures())||void 0===e?void 0:e.customCallReactions.defaultPack)}getSavedReactions(){return d.default.getCustomCallReactions()||[]}saveCurrentReactions(){d.default.setCustomCallReactions(this._localReactions),super.saveCurrentReactions()}getInitialTabId(){return this._initialTabId}isFeatureEnabled(){return this._enabled}getMaxReactionsCount(){return this._maxReactionsNumber}getModalTitle(){return l.getString("ReactionsPanel.CustomCallReactionsTitle")}};t.CustomCallReactionsStore=h,t.CustomCallReactionsStore=h=i.__decorate([n.AutoSubscribeStore],h)},841646:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsStoreBase=t.TriggerKeys=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(516778)),r=s(217041),a=i.__importStar(s(704704));var l;!function(e){e[e.CurrentReactions=0]="CurrentReactions",e[e.SavedReactions=1]="SavedReactions"}(l||(t.TriggerKeys=l={}));let d=class extends r.StoreBase{startup(){return Promise.resolve()}getCurrentReactions(){return this._loadCurrentReactionsPack()}getCustomReactions(){return this._getSavedOrDefaultReactions()}addReactions(e){const t=this._loadCurrentReactionsPack();this._localReactions&&this._localReactions.length<this.getMaxReactionsCount()&&(this._setLocalReactions(o.uniq([...e,...t])),this._getScreenReaderAnnouncement(e,"ReactionsPanel.AddedCustomReactios"),this.trigger(l.CurrentReactions))}removeReactions(e){const t=this._loadCurrentReactionsPack();this._setLocalReactions(t.filter((t=>!o.includes(e,t)))),this._getScreenReaderAnnouncement(e,"ReactionsPanel.RemovedCustomReactios"),this.trigger(l.CurrentReactions)}removeReactionsAt(e){const t=this._loadCurrentReactionsPack();this._setLocalReactions(t.filter(((t,s)=>!o.includes(e,s)))),this.trigger(l.CurrentReactions)}resetUnsavedReactions(){this._localReactions=void 0,this.trigger(l.CurrentReactions)}isCustomReaction(e){return!o.includes(this.getDefaultReactions(),e)}isLocalReaction(e){return o.includes(this._localReactions,e)}getLocalReactionsCount(){var e;return null===(e=this._localReactions)||void 0===e?void 0:e.length}getCustomReactionsCount(){return this.getMaxReactionsCount()}getCustomReactionsModalTitle(){return this.getModalTitle()}hasBeenCustomized(){return this.isFeatureEnabled()&&0!==this.getSavedReactions().length}saveCurrentReactions(){this._localReactions&&0===this._localReactions.length&&(this._localReactions=void 0),this.trigger(l.SavedReactions)}_loadCurrentReactionsPack(){return this._localReactions||(this._localReactions=this._getSavedOrDefaultReactions()),this._localReactions}_getScreenReaderAnnouncement(e,t){n.Accessibility.announceForAccessibility(a.getString(t,{name:e.join(", ")}))}_setLocalReactions(e){this._localReactions=e}_getSavedOrDefaultReactions(){const e=this.getSavedReactions();return this.isFeatureEnabled()&&0!==e.length?e:this.getDefaultReactions()||[]}};t.CustomReactionsStoreBase=d,i.__decorate([(0,r.autoSubscribeWithKey)(l.CurrentReactions)],d.prototype,"getCurrentReactions",null),i.__decorate([(0,r.autoSubscribeWithKey)(l.SavedReactions)],d.prototype,"getCustomReactions",null),i.__decorate([r.autoSubscribe],d.prototype,"getCustomReactionsCount",null),i.__decorate([(0,r.autoSubscribeWithKey)(l.SavedReactions)],d.prototype,"hasBeenCustomized",null),t.CustomReactionsStoreBase=d=i.__decorate([r.AutoSubscribeStore],d)},732028:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=i.__importDefault(s(304623)),d=i.__importDefault(s(556587)),c=i.__importDefault(s(615364)),u=i.__importDefault(s(109367)),h=i.__importStar(s(379878)),p=s(815146),g=i.__importStar(s(85385)),m=i.__importDefault(s(114818)),S=i.__importDefault(s(363091)),_=i.__importDefault(s(901005)),f=i.__importStar(s(437782)),y=i.__importStar(s(446574)),v=i.__importDefault(s(655192)),C=[h.SecureHandshakeState.None,h.SecureHandshakeState.OtherEndpointInUse];let T=class extends n.StoreBase{constructor(){super(),this._handshakeStates={},this._localPrivateConvs={},this._updateLocalPrivateConvs=(e,t)=>{this._localPrivateConvs[e]=t},this._conversationUpdated=e=>{o.each(e,(e=>{if(e.conv.isEncryptedThread()){this._updatePrivateConvStoredLocaly(e.conv.id);const t=e.conv.getEncryptionHandshake();this._processHandshakeForConv(e.conv)&&h.default.isAccepted(t)&&h.default.isInitiatedByMe(t)&&o.defer((()=>{u.default.sendConfirm(e.conv.id,!0).catch((e=>{g.warn(p.LogTraceArea.E2EEncryption,"Auto accept failed with error: ",v.default.errorAsString(e))}))}))}}))},this._rejectActiveConversations=()=>{const e=_.default.getAllPrivateConversationMris(),t=o.filter(e,(e=>!o.includes(C,this.getHandshakeState(e)))),s=o.map(t,(e=>u.default.sendReject(e,p.E2EERejectionReason.IdentityLost).catch(o.noop)));return r.all(s)},y.RegisterStartupable(this,"E2eeHandshakeStore",[l.default,c.default,h.default])}startup(){return l.default.conversationsUpdated.subscribe(this._conversationUpdated),u.default.identityUpdated.subscribe(this._rejectActiveConversations),u.default.conversationStored.subscribe(this._updateLocalPrivateConvs),Promise.resolve()}getHandshakeState(e){let t=this._handshakeStates[e];if(!t){const s=(0,c.default)().getConversation(e);s?(this._processHandshakeForConv(s),t=this._handshakeStates[e]):l.default.getConversationMetaAsync(e).then((e=>{e&&this._processHandshakeForConv(e.conv)}))}return t||h.SecureHandshakeState.None}shouldShowPrivateConv(e){if(!a.default.getS4LMessagingFeatures().hidePrivateConversationsOnOtherEndpoints)return!0;return this.getHandshakeState(e)!==h.SecureHandshakeState.OtherEndpointInUse||this._getLocalPrivateConv(e)}_getLocalPrivateConv(e){let t=this._localPrivateConvs[e];return o.isUndefined(t)&&(this._updatePrivateConvStoredLocaly(e),t=this._localPrivateConvs[e]),t||!1}test_resetSubscriptions(){l.default.conversationsUpdated.unsubscribe(this._conversationUpdated),u.default.identityUpdated.unsubscribe(this._rejectActiveConversations)}_updatePrivateConvStoredLocaly(e){u.default.isPrivateConvStoredLocally(e).then((t=>this._localPrivateConvs[e]=t))}_processHandshakeForConv(e){const t=e.getEncryptionHandshake(),s=e.id;if(!t)return g.warn(p.LogTraceArea.E2EEncryption,`Secure thread ${f.mriOrId(s)} with no handshake info`),d.default.forceThreadDetailsFetchIfNeeded(s),!1;if(!S.default.isMyMri(t.AParty)&&!S.default.isMyMri(t.BParty))return g.warn(p.LogTraceArea.E2EEncryption,"Got unrelated handshake"),d.default.forceThreadDetailsFetchIfNeeded(s),!1;const i=this._handshakeStates[s],o=h.default.getDetailedHandshakeState(e);return!(0,m.default)(i,o)&&(this._handshakeStates[s]=o,g.log(p.LogTraceArea.E2EEncryption,`Handshake for ${f.mriOrId(s)} changed state - ${h.SecureHandshakeState[o]}`),this.trigger(s),o===h.SecureHandshakeState.None&&u.default.terminateSession(t),!0)}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],T.prototype,"getHandshakeState",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],T.prototype,"shouldShowPrivateConv",null),T=i.__decorate([n.AutoSubscribeStore],T),t.default=new T},463171:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041);let n=class extends o.StoreBase{constructor(){super(...arguments),this._limitOfListItemsToDisplayEmptyState=2,this._limitOfNotificationListItemsToDisplayEmptyState=0,this._recentsEmpty=!1,this._callsEmpty=!0,this._phoneCallsEmpty=!0,this._contactsEmpty=!0,this._notificationsEmpty=!0}getRecentsEmpty(){return this._recentsEmpty}getCallsEmpty(){return this._callsEmpty}getPhoneCallsEmpty(){return this._phoneCallsEmpty}getContactsEmpty(){return this._contactsEmpty}getNotificationsEmpty(){return this._notificationsEmpty}setRecentsEmpty(){this._recentsEmpty=!0,this.trigger()}setCallsEmpty(e){this._callsEmpty=this._shouldShowEmptyStateIllustrationScreen(e),this.trigger()}setPhoneCallsEmpty(e){this._phoneCallsEmpty=this._shouldShowEmptyStateIllustrationScreen(e),this.trigger()}setContactsEmpty(e){this._contactsEmpty=this._shouldShowEmptyStateIllustrationScreen(e),this.trigger()}setNotificationsEmpty(e){this._notificationsEmpty=this._shouldShowEmptyStateIllustrationScreen(e,!0),this.trigger()}_shouldShowEmptyStateIllustrationScreen(e,t){return e<=(t?this._limitOfNotificationListItemsToDisplayEmptyState:this._limitOfListItemsToDisplayEmptyState)}};i.__decorate([o.autoSubscribe],n.prototype,"getRecentsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getCallsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getPhoneCallsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getContactsEmpty",null),i.__decorate([o.autoSubscribe],n.prototype,"getNotificationsEmpty",null),n=i.__decorate([o.AutoSubscribeStore],n),t.default=new n},784151:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ForwardMessageState=void 0;const i=s(197582),o=s(217041),n=i.__importStar(s(704704));var r;!function(e){e[e.NotSent=0]="NotSent",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent"}(r||(t.ForwardMessageState=r={}));let a=class extends o.StoreBase{getStateForMri(e){return this._forwardMessageState[e]?this._forwardMessageState[e]:r.NotSent}updateSendingStatus(e,t){this._forwardMessageState[e]=t,this.trigger(e)}reset(){this._forwardMessageState={}}getAccessibilityLabelForMRI(e,t){const s=this._forwardMessageState[e];let i="ShareWithPanel.SendToAccessibilityLabel";return s&&s===r.Sent&&(i="ShareWithPanel.SentToAccessibilityLabel"),n.getString(i,{displayName:t})}};i.__decorate([o.autoSubscribe,i.__param(0,o.key)],a.prototype,"getStateForMri",null),i.__decorate([o.autoSubscribe,i.__param(0,o.key)],a.prototype,"getAccessibilityLabelForMRI",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},557153:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041),n=i.__importDefault(s(114818));var r;!function(e){e[e.Query=0]="Query"}(r||(r={}));let a=class extends o.StoreBase{resetSearchQuery(){this._searchConversationQuery=void 0}getSearchQuery(){return this._searchConversationQuery}setSearchQuery(e){(0,n.default)(this._searchConversationQuery,e)||(this._searchConversationQuery=e,this.trigger(r.Query))}};i.__decorate([o.disableWarnings],a.prototype,"resetSearchQuery",null),i.__decorate([(0,o.autoSubscribeWithKey)(r.Query)],a.prototype,"getSearchQuery",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},265609:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(126740)),a=s(380157),l=s(217041),d=i.__importStar(s(397691)),c=i.__importDefault(s(150343)),u=s(154235),h=i.__importDefault(s(389659)),p=s(815146),g=i.__importStar(s(85385)),m=i.__importStar(s(576047)),S=s(389896),_=i.__importDefault(s(201721)),f=i.__importDefault(s(251733)),y=i.__importDefault(s(246230)),v=i.__importStar(s(446574)),C=s(331079),T={enableHighAccuracy:!0,maximumAge:6e5},M={enableHighAccuracy:!1,timeout:5e3,maximumAge:6e5};let b=class extends l.StoreBase{constructor(){super(),this._locationPermissionStatus={},this._bingLocationConsentGranted=!1,v.RegisterStartupable(this,"LocationStore",[_.default,f.default])}startup(){return this._bingLocationConsentGranted=!!_.default.getUserPreferencesLocal().bingLocationConsentGranted,this._highAccuracyTimeout=c.default.getS4LCaapFeatures().highAccuracyLocationTimeout,this._updateLocationPermission(C.PermissionType.Location),this._updateLocationPermission(C.PermissionType.LocationAlways),f.default.subscribe((()=>{this._updateLocationPermission(C.PermissionType.Location)&&this.updateLocation(p.LocationUpdateReason.PermissionUpdate,!0)}),C.PermissionType.Location),f.default.subscribe((()=>{this._updateLocationPermission(C.PermissionType.LocationAlways)&&this.updateLocation(p.LocationUpdateReason.PermissionUpdate,!0)}),C.PermissionType.LocationAlways),_.default.subscribe((()=>{const e=!!_.default.getUserPreferencesLocal().bingLocationConsentGranted;this._bingLocationConsentGranted!==e&&(this._bingLocationConsentGranted=e,this._bingLocationConsentGranted&&this.updateLocation(p.LocationUpdateReason.BingConsentUpdate,!0))})),Promise.resolve()}getLocation(){return this._lastPosition&&this._lastPosition.coords?this._lastPosition:void 0}getLocationNoSubscription(){return this._lastPosition&&this._lastPosition.coords?this._lastPosition:void 0}getLocationForBing(){return!this._isChild()&&this._bingLocationConsentGranted?this.getLocation():void 0}needBingLocationConsentPrompt(){return!this._isChild()&&!this._bingLocationConsentGranted&&this.canPromptLocationAgain(C.PermissionType.Location)}bingLocationConsentAndPermissionGranted(){return!this._isChild()&&this._bingLocationConsentGranted&&this.locationPermissionGranted()}locationPermissionGranted(){return this._locationPermissionStatus[C.PermissionType.Location]===a.PermissionStatus.Granted||this._locationPermissionStatus[C.PermissionType.LocationAlways]===a.PermissionStatus.Granted}canPromptLocationAgain(e){if(e===C.PermissionType.Location){const e=_.default.getUserPreferencesLocal().locationStoreLastPromptTime;return!e||h.default.add(e,void 0,3)<Date.now()}{const e=n.max([_.default.getUserPreferencesLocal().locationStoreLastPromptTime,_.default.getUserPreferencesLocal().locationStoreLastPromptTimeAlways]);return!e||h.default.add(e,void 0,3)<Date.now()}}updateLocation(e,t=!1){var s;if(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation requested, reason: "+p.LocationUpdateReason[e]),!this._canUpdateLocationForReason(e))return g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.updateLocation not allowed"),Promise.resolve(void 0);if(this._locationPermissionStatus[C.PermissionType.Location]!==a.PermissionStatus.Granted)return g.log(p.LogTraceArea.GenericUnsafe,`LocationStore.updateLocation locationPermissionStatus: ${this._locationPermissionStatus[C.PermissionType.Location]}, bingLocationConsentGranted: ${this._bingLocationConsentGranted}`),this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1,Promise.resolve(void 0);const i=this._isLastPositionHighAccuracy?T.maximumAge:M.maximumAge;if((null===(s=this._lastPosition)||void 0===s?void 0:s.coords)&&Date.now()<this._lastPosition.timestamp+i&&(!t||this._isLastPositionHighAccuracy))return Promise.resolve(this._lastPosition);if(this._updatingLocation)return Promise.resolve(this._lastPosition);this._updatingLocation=!0;const n=Date.now();return r.default.getCurrentPosition(M).then((e=>(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore: Low accuracy location retrieved: "+o.pii.Omit(JSON.stringify(e))),this._lastPosition=e,this._isLastPositionHighAccuracy=!1,g.track(new m.LocationStoreGeolocationFetched(!1,Date.now()-n)),this.trigger(),t?this._updateHighAccuracyLocation():(this._updatingLocation=!1,e)))).catch((e=>(e.code===e.PERMISSION_DENIED&&(this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1),g.track(new m.LocationStoreGeolocationFetchedFailed(!1,Date.now()-n,e.code===e.TIMEOUT,e.code===e.PERMISSION_DENIED,e.code===e.POSITION_UNAVAILABLE)),e.code===e.PERMISSION_DENIED?(g.warn(p.LogTraceArea.GenericUnsafe,`LocationStore: Permission to retrieve low accuracy location denied: ${e.code} - ${e.message}`),this._updatingLocation=!1,this._locationPermissionStatus[C.PermissionType.Location]=a.PermissionStatus.Denied,void this.trigger()):t?this._updateHighAccuracyLocation():(g.warn(p.LogTraceArea.GenericUnsafe,`LocationStore: Unable to retrieve low accuracy location: ${e.code} - ${e.message}`),this._updatingLocation=!1,void this.trigger()))))}_updateHighAccuracyLocation(){const e=Date.now();return r.default.getCurrentPosition(Object.assign(Object.assign({},T),{timeout:this._highAccuracyTimeout})).then((t=>(this._lastPosition=t,this._isLastPositionHighAccuracy=!0,this._updatingLocation=!1,g.log(p.LogTraceArea.GenericUnsafe,"LocationStore: High accuracy location retrieved: "+o.pii.Omit(JSON.stringify(t))),g.track(new m.LocationStoreGeolocationFetched(!0,Date.now()-e)),this.trigger(),t)),(t=>(this._updatingLocation=!1,g.track(new m.LocationStoreGeolocationFetchedFailed(!0,Date.now()-e,t.code===t.TIMEOUT,t.code===t.PERMISSION_DENIED,t.code===t.POSITION_UNAVAILABLE)),g.warn(p.LogTraceArea.GenericUnsafe,`LocationStore: Unable to retrieve high accuracy location: ${t.code} - ${t.message}`),this.trigger(),this._lastPosition)))}updateLocationWithPermission(e,t=!1,s=!0,i=C.PermissionType.Location){return this.getLocationPermission(s,i).then((()=>this.updateLocation(e,t)))}getLocationPermission(e,t){if(this._locationPermissionStatus[C.PermissionType.LocationAlways]===a.PermissionStatus.Granted)return Promise.resolve();if(t===C.PermissionType.Location&&this._locationPermissionStatus[C.PermissionType.Location]===a.PermissionStatus.Granted)return Promise.resolve();let s=e?C.PermissionPromptOptions.SkipPrePrompt:void 0;this.canPromptLocationAgain(t)&&(s=s?s|C.PermissionPromptOptions.PromptAgainIfDenied:C.PermissionPromptOptions.PromptAgainIfDenied);const i=f.default.permissionStatus(t);return f.default.requestPermission(t,s).then((e=>e===a.PermissionStatus.Granted?d.Resolved():(t===C.PermissionType.Location&&(this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1),this.canPromptLocationAgain(t)&&(t===C.PermissionType.Location?_.default.setUserPreferencesLocal({locationStoreLastPromptTime:Date.now()}):_.default.setUserPreferencesLocal({locationStoreLastPromptTimeAlways:Date.now()}),i===e&&y.default.showDeniedPromptWithSettingsOption(t,u.MainRootViewId)),d.Rejected()))).catch((e=>(g.log(p.LogTraceArea.GenericUnsafe,"LocationStore.getLocationPermission: error, permissionStatus = "+e),this._lastPosition=void 0,this._isLastPositionHighAccuracy=!1,d.Rejected()))).toEs6Promise()}_updateLocationPermission(e){let t=!1;const s=f.default.permissionStatus(e);return s===a.PermissionStatus.Granted&&this._locationPermissionStatus[e]!==a.PermissionStatus.Granted&&(_.default.setUserPreferencesLocal({locationStoreLastPromptTime:0,locationStoreLastPromptTimeAlways:0}),t=!0),this._locationPermissionStatus[e]=s,t}_isChild(){var e;const t=null===(e=_.default.getUserPreferencesLocal().msaProfileKey)||void 0===e?void 0:e.ageGroup;return S.MsaProfileHelper.isChild(t)}_canUpdateLocationForReason(e){switch(e){case p.LocationUpdateReason.PermissionUpdate:case p.LocationUpdateReason.SlashCommand:case p.LocationUpdateReason.E911Startup:case p.LocationUpdateReason.E911NetworkChange:case p.LocationUpdateReason.E911ConsentUpdate:return!0;default:return!this._isChild()}}};i.__decorate([l.autoSubscribe],b.prototype,"getLocation",null),i.__decorate([l.disableWarnings],b.prototype,"getLocationNoSubscription",null),i.__decorate([l.autoSubscribe],b.prototype,"getLocationForBing",null),i.__decorate([l.autoSubscribe],b.prototype,"needBingLocationConsentPrompt",null),i.__decorate([l.autoSubscribe],b.prototype,"bingLocationConsentAndPermissionGranted",null),i.__decorate([l.autoSubscribe],b.prototype,"locationPermissionGranted",null),b=i.__decorate([l.AutoSubscribeStore],b),t.default=new b},58606:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=i.__importStar(s(459287)),r=s(815146),a=s(902940),l=i.__importDefault(s(655192)),d=i.__importDefault(s(139221)),c="skype/messages";t.default=new class{constructor(){this._selection=[],this._plainSelection=""}add(e,t,s,i){i?(this._newCopyChainStarted(i)&&this._cleanStore(),this._storeToStore(e,t,s),this._storeToClipboard(i)):this._storeToStore(e,t,s)}get(e){if(e){const t=this._getFromClipboard(e);return o.isEmpty(t)?this._getFromStore():t}return this._getFromStore()}hasContent(e){if(e.clipboardData){const t=e.clipboardData.getData("text/plain")||"";return(e.clipboardData.getData(c)||"").length>0&&t.length>0&&this._plainSelection===t}return!1}_newCopyChainStarted(e){return e.clipboardData&&!o.includes(e.clipboardData.types,c)}_getFromStore(){return this._selection}_cleanStore(){this._selection=[],this._plainSelection=""}_storeToStore(e,t,s){this._selection=o.sortBy([...this._selection,t],(e=>e.createdTime)),this._plainSelection=this._mapToPlainText(s)}_getFromClipboard(e){return e.clipboardData?this._mapToSelectionMeta(e.clipboardData.getData(c)):[]}_storeToClipboard(e){e.clipboardData&&(e.clipboardData.setData("text/plain",this._plainSelection),e.clipboardData.setData(c,this._mapToClipboardData(this._selection)))}_mapToClipboardData(e){return JSON.stringify(e.map((e=>(0,a.toClipboardObject)(e))))}_mapToSelectionMeta(e){return l.default.parseJsonWithDefault(e,[]).map((e=>{const t=n.createMessageInfoFromEscapedText(e.conversationId,r.PostSource.Clipboard,e.content).messageForPosting;return e.content=t.content,(0,a.fromClipboardObject)(e)}))}_mapToPlainText(e){return d.default.getPlatformType()===r.PlatformType.Windows?e.replace(/\r\n?|\n/g,"\r\n"):e}}},23551:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(197582),o=s(217041),n=i.__importDefault(s(601274));var r;!function(e){e[e.SpinnerToShowUp=0]="SpinnerToShowUp"}(r||(t.TriggerKeys=r={}));let a=class extends o.StoreBase{constructor(){super(),this._targetMessages={},this._timerId=0}signupForSpinner(e,t,s,i=!1){!e||this._instanceExists(e)&&!i||(this._targetMessages[e]={clientMessageId:e,lieTimePassed:!1,confirmedAsSent:!1},t>0&&s?this._timerId=n.default.setTimeout((()=>{this._showSpinner(e),this.trigger(r.SpinnerToShowUp)}),t):(this._showSpinner(e),this.trigger(r.SpinnerToShowUp)))}dismissSpinner(e){this._spinnerToShow(e)?(this._removeMessageId(e),this.trigger(r.SpinnerToShowUp),this.clearTimer()):this._instanceExists(e)&&(this._targetMessages[e].confirmedAsSent=!0)}shouldShowSpinner(e,t=!1){return e&&this._targetMessages[e]?!this._targetMessages[e].confirmedAsSent&&this._targetMessages[e].lieTimePassed:t}clearTimer(){n.default.clearTimeout(this._timerId)}_removeMessageId(e){this._targetMessages[e].confirmedAsSent=!0,this._targetMessages[e].lieTimePassed=!1}_showSpinner(e){this._targetMessages[e]&&(this._targetMessages[e].lieTimePassed=!0)}_instanceExists(e){return this._targetMessages[e]}_spinnerToShow(e){return this._targetMessages[e]&&this._targetMessages[e].lieTimePassed&&!this._targetMessages[e].confirmedAsSent}};i.__decorate([(0,o.autoSubscribeWithKey)(r.SpinnerToShowUp),i.__param(0,o.key)],a.prototype,"shouldShowSpinner",null),a=i.__decorate([o.AutoSubscribeStore],a),t.default=new a},842267:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStreamStore=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(397691)),a=i.__importDefault(s(150343)),l=i.__importStar(s(790330)),d=i.__importDefault(s(404547)),c=i.__importDefault(s(304623)),u=i.__importStar(s(971988)),h=i.__importDefault(s(556587)),p=i.__importStar(s(44717)),g=i.__importDefault(s(555436)),m=i.__importDefault(s(615364)),S=s(815146),_=i.__importStar(s(85385)),f=i.__importDefault(s(303577)),y=i.__importDefault(s(656681)),v=i.__importStar(s(786531)),C=i.__importDefault(s(682432)),T=i.__importDefault(s(363091)),M=i.__importStar(s(437782)),b=i.__importDefault(s(994962)),I=i.__importDefault(s(997226)),w=i.__importDefault(s(655192)),P=s(331079),k=s(309515),A=s(306194),x=s(123117),D=Number.MAX_VALUE;var R;!function(e){e[e.None=0]="None",e[e.Database=1]="Database",e[e.ChatService=2]="ChatService",e[e.WaitForSync=3]="WaitForSync",e[e.WaitForInit=4]="WaitForInit"}(R||(R={}));class L{constructor(e,t,s){this.messages={},this.messagesOutOfSyncWindow={},this.isEarliestTimeTheTopOfSyncWindow=!1,this.cannotSyncButNotAtBeginning=!1,this.isOutsideSyncWindow=!1,this.persistedMessagesFromQueries={},this.isLoadingEarlier=R.None,this.isLoadingLater=R.None,this.fetchedMessages=0,this.syncedBackwards=!1,this.conversationId=e,this.earliestMessageTime=t,this.latestMessageTime=s}_updateWindow(e,t=!1){let s=!1;const i=this.earliestMessageTime,n=this.latestMessageTime,r=a.default.getS4LMessagingFeaturesNoSubscription().enableUpdateEarliestMessageTimeFromSync&&this.earliestMessageTime===D;if(!t&&2!==this.earliestMessageTime||t&&r){const n=o.map(e,(e=>e.createdTime)),r=o.min(n);r<this.earliestMessageTime&&(this.earliestMessageTime=Math.max(r,2),s=!0,E(this.conversationId,`fromSync: ${t}, old earliestMessageTime: ${i}, new earliestMessageTime: ${this.earliestMessageTime}`))}if(!t&&this.latestMessageTime!==D){const t=o.maxBy(e,(e=>e.createdTime)).createdTime;t>this.latestMessageTime&&(this.latestMessageTime=t>P.NumberShim.MAX_SAFE_INTEGER?D:t,s=!0)}return{windowChanged:s,oldEarliestMessageTime:i,oldLatestMessageTime:n}}updateWindowAndMessages(e,t,s){if(0===e.length)return{windowChanged:!1,messagesChanged:!1};const{windowChanged:i,oldEarliestMessageTime:o,oldLatestMessageTime:n}=this._updateWindow(e,t),{messagesChanged:r,visibleMessages:a,visibleMessagesInWindow:l,otherMessages:d}=this._updateMessageCache(e);if(e.length){let e="["+s+"] Message cache update:";if(r||!i){const t=a.length-l.length;e+=" "+l.length+" applied, "+t+" dropped, "+d.length+" other. "}if(i){e+=" "+this._getTraceWindowUpdateString(o,n)}E(this.conversationId,e)}return{windowChanged:i,messagesChanged:r}}updateWindowFromEmptyEarlierDBQuery(e){return e<this.earliestMessageTime&&(this.earliestMessageTime=Math.max(e,2),!0)}updateWindowToBeginningOfTime(){if(2===this.earliestMessageTime)return!1;const e=this.earliestMessageTime;return this.earliestMessageTime=2,E(this.conversationId,this._getTraceWindowUpdateString(e,this.latestMessageTime)),!0}updateWindowToEndOfTime(){if(this.latestMessageTime===D)return!1;const e=this.latestMessageTime;return this.latestMessageTime=D,E(this.conversationId,this._getTraceWindowUpdateString(this.earliestMessageTime,e)),!0}updateWindowHandleHistoryDisclosed(){if(!this.isEarliestTimeTheTopOfSyncWindow){const e=this.earliestMessageTime,t=o.values(this.messages);return t.length>0&&(this.earliestMessageTime=o.minBy(t,(e=>e.createdTime)).createdTime),e!==this.earliestMessageTime}const e=this.earliestMessageTime,t=h.default.getEarliestKnownMessageTime(this.conversationId);return this.earliestMessageTime=Math.max(t,e),e!==this.earliestMessageTime}_getTraceTimeString(e){return 2===e?"Beginning":e===D?"End":e.toString()}_getTraceWindowUpdateString(e,t){return"Window updated from ["+this._getTraceTimeString(e)+", "+this._getTraceTimeString(t)+"] to ["+this._getTraceTimeString(this.earliestMessageTime)+", "+this._getTraceTimeString(this.latestMessageTime)+"]"}_updateMessageCache(e){let t=!1;const s=e,[i,n]=o.partition(s,(e=>e.isShownInStream())),[r,a]=o.partition(i,(e=>this.isTimeInWindow(e.createdTime)||this.latestMessageTime===D&&e.isMessageLie()));if(a.length&&o.extend(this.messagesOutOfSyncWindow,o.keyBy(a,(e=>e.cuid))),r.length){this.sortedMessages=void 0;const e=o.keyBy(r,(e=>e.cuid));o.extend(this.messages,e),t=!0}return o.each(n,(e=>{this.isTimeInWindow(e.createdTime)&&(e.isDeletedMessage()||e.isCanceledScheduledCall())&&this.messages[e.cuid]&&(delete this.messages[e.cuid],this.sortedMessages=void 0,t=!0)})),y.default.updateMessages(e),C.default.updateMessages(e),{messagesChanged:t,visibleMessages:i,visibleMessagesInWindow:r,otherMessages:n}}setAsNoLongerOutsideSyncWindow(){this.isOutsideSyncWindow=!1,this.localSyncState=void 0,E(this.conversationId,"No longer outside Sync window")}isTimeInWindow(e){return e>=this.earliestMessageTime&&e<=this.latestMessageTime}getLatestKnownMessage(){return o.last(this.sortedMessages)||o.maxBy(o.toArray(this.messages),(e=>e.createdTime))}checkForOutSideSyncWindowMessages(){o.each(this.messagesOutOfSyncWindow,(e=>{this.isTimeInWindow(e.createdTime)&&(this.messages[e.cuid]=this.messagesOutOfSyncWindow[e.cuid],delete this.messagesOutOfSyncWindow[e.cuid],this.sortedMessages=void 0)}))}}const B=55;class F extends n.StoreBase{constructor(e,t){super(0,!0),this._targetMessageTimestamp=t,this._isInitialized=!1,this._isInitialMessagesLoaded=!1,this._isRealConversationKnown=!1,this._syncCompleteCallback=()=>{if(this._conversationInfo){if(this._conversationInfo.isOutsideSyncWindow){h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId)<=this._conversationInfo.earliestMessageTime&&this._conversationInfo.setAsNoLongerOutsideSyncWindow()}if(this._waitForSyncCompleteDeferred){const e=this._waitForSyncCompleteDeferred;this._waitForSyncCompleteDeferred=void 0,e.resolve(void 0)}}else U(this._debug_convId,"Store was destroyed but got a callback for sync completed")},this._conversationUpdatedCallback=e=>{if(!this._isInitialized)return;if(!this._conversationInfo)return void U(this._debug_convId,"Store was destroyed but got a callback for conv updated");const t=o.find(e,(e=>e.conv.id===this._conversationInfo.conversationId));if(t){const e=this._conversationInfo.isHistoryDisclosed;this._conversationInfo.isHistoryDisclosed=t.conv.isHistoryDisclosed(),!e&&this._conversationInfo.isHistoryDisclosed&&(E(this._debug_convId,"History disclosed"),this._conversationInfo.updateWindowHandleHistoryDisclosed()&&(this._conversationInfo.checkForOutSideSyncWindowMessages(),this.fetchEarlierMessages()))}if(!this._conversationInfo.isOutsideSyncWindow){const e=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId),t=this._conversationInfo.getLatestKnownMessage();t&&t.createdTime<e&&(E(this._debug_convId,"Invalidating store for future caching because it has a possible gap."),this._probablyShouldNotCache=!0)}},this._messagesUpdatedCallback=e=>{if(!this._conversationInfo)return void U(this._debug_convId,"Store was destroyed but got a callback for new messages");if(!this._isInitialized)return;const t=o.map(o.filter(e,(e=>e.conversationId===this._conversationInfo.conversationId))),{windowChanged:s,messagesChanged:i}=this._conversationInfo.updateWindowAndMessages(t,!0,"messagesUpdated");this._conversationInfo.checkForOutSideSyncWindowMessages(),(s||i)&&this.trigger()},this._updateContactInviteMessages=()=>{if(!this._conversationInfo)return void U(this._debug_convId,"Store was destroyed but got a callback for contact invite messages");const e=g.default.getInviteMessagesForConversation(this._conversationInfo.conversationId),t=o.filter(e,(e=>!o.some(this._conversationInfo.messages,(t=>t.createdTime===e.createdTime))));if(t.length>0){const{windowChanged:e,messagesChanged:s}=this._conversationInfo.updateWindowAndMessages(t,!1,"updateContactInvites");this._conversationInfo.checkForOutSideSyncWindowMessages(),(e||s)&&this.trigger()}},this._updateScheduledCallMessages=()=>{if(!this._conversationInfo)return void U(this._debug_convId,"Store was destroyed but got a callback for scheduled call messages");const e=b.default.getSystemMessagesForConversation(this._conversationInfo.conversationId);if(e.length>0){const{windowChanged:t,messagesChanged:s}=this._conversationInfo.updateWindowAndMessages(e,!1,"updateScheduledCalls");this._conversationInfo.checkForOutSideSyncWindowMessages(),(t||s)&&this.trigger()}},this._wrapWithTriggerLogic=e=>{if(!this._conversationInfo)return;const t=this.isLoadingItems(),s=this.isEarliestMessageTheBeginning(),i=this.isLatestMessageTheEnd(),o=e(),n=this.isLoadingItems(),r=this.isEarliestMessageTheBeginning(),a=this.isLatestMessageTheEnd();t===n&&s===r&&i===a||this.trigger();let l=!0;o.then((()=>{l||this._conversationInfo&&(n===this.isLoadingItems()&&r===this.isEarliestMessageTheBeginning()&&a===this.isLatestMessageTheEnd()||this.trigger())})),l=!1},this._debug_convId=e;const s=t||D;let i=Math.max(s,2);i>P.NumberShim.MAX_SAFE_INTEGER&&(i=D),this._conversationInfo=new L(e,i,i);const n=h.default.getEarliestKnownMessageTime(e);E(this._debug_convId,'Initializing at "'+i+'"'+(i<n?' (earlier than Sync at "'+n+'")':"")),this._messagesUpdatedSubscriptionToken=c.default.messagesProcessed.subscribe(this._messagesUpdatedCallback),this._conversationsUpdatedSubscriptionToken=c.default.conversationsUpdated.subscribe(this._conversationUpdatedCallback),this._syncCompleteSubscriptionToken=h.default.syncComplete.subscribe(this._syncCompleteCallback),this._initialize()}subscribe(e,t){const s=super.subscribe(e,t),i=this._waitForSubscribersDeferred;return i&&(this._waitForSubscribersDeferred=void 0,i.resolve(void 0)),s}_initialize(){this._conversationInfo&&this._wrapWithTriggerLogic((()=>this._conversationInfo?(this._conversationInfo.isLoadingEarlier=R.WaitForInit,this._conversationInfo.isLoadingLater=R.WaitForInit,r.Resolved().thenAsync((()=>this._initializeAfterWaitingForRealConversation())).then((()=>{if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");this._conversationInfo.isLoadingEarlier=R.None,this._conversationInfo.isLoadingLater=R.None;const e=c.default.getConversationMetaFromMemoryCache(this._conversationInfo.conversationId);return e&&(this._conversationInfo.isHistoryDisclosed=e.conv.isHistoryDisclosed()),this._isInitialized=!0,this._fetchInitialMessages()})).then((()=>this._conversationInfo?!this._conversationInfo.isOutsideSyncWindow&&this._isRealConversationKnown||!o.isEmpty(this._conversationInfo.messages)||this._conversationInfo.earliestMessageTime!==this._conversationInfo.latestMessageTime?void 0:(this._reinitializeAtEndOfTime(),this._fetchInitialMessages()):r.Rejected("Store was destroyed: nothing to do."))).then((()=>{if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");this._updateContactInviteMessages(),this._contactsStoreSubscriptionToken=g.default.subscribe(this._updateContactInviteMessages),this._updateScheduledCallMessages(),this._scheduledCallsStoreSubscriptionToken=b.default.subscribe(this._updateScheduledCallMessages)})).catch((e=>{this._conversationInfo&&U(this._debug_convId,"Unhandled error while store is alive: "+w.default.errorAsString(e))}))):r.Rejected("Store was destroyed: nothing to do.")))}_initializeAfterWaitingForRealConversation(){if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");const e=this._conversationInfo.conversationId;return c.default.waitForJoinedKnowledgeOfConversation(e).then((t=>{if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");if(!t.isFake)return this._isRealConversationKnown=!0,void E(this._debug_convId,"Conversation is known from the get-go");E(this._debug_convId,"Unknown conversation: waiting to hear about it or Sync finishing");const s=c.default.waitForJoinedKnowledgeOfRealConversation(e);let i;return h.default.isCurrentlySyncing()?(this._waitForSyncCompleteDeferred=r.Defer(),i=this._waitForSyncCompleteDeferred.promise()):i=r.Resolved(),r.race([s,i]).then((()=>{if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");const t=(0,m.default)().getConversation(e);if(t&&!t.isFake)return this._isRealConversationKnown=!0,void E(this._debug_convId,"Conversation became known while waiting: normal init");this._reinitializeAtEndOfTime(),s.then((()=>{this._conversationInfo&&(this._isRealConversationKnown=!0,E(this._debug_convId,"Conversation became known: attempting to fix our window"),this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1,this._conversationInfo.earliestMessageTime=D,this.fetchEarlierMessages())}))}))}))}_reinitializeAtEndOfTime(){E(this._debug_convId,"Could not initialize: jumping to EndOfTime."+(this._isRealConversationKnown?"":" (Conversation is unknown.)")),this._conversationInfo&&(this._conversationInfo.isOutsideSyncWindow=!1,this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1,this._conversationInfo.earliestMessageTime=D,this._conversationInfo.latestMessageTime=D)}isLoadingItems(){return this._conversationInfo?this._conversationInfo.isLoadingEarlier!==R.None||this._conversationInfo.isLoadingLater!==R.None:(U(this._debug_convId,"Store is already destroyed"),!1)}isLoadingItemsFromNetwork(){return this._conversationInfo?this._conversationInfo.isLoadingEarlier===R.ChatService||this._conversationInfo.isLoadingEarlier===R.WaitForSync||this._conversationInfo.isLoadingLater===R.ChatService||this._conversationInfo.isLoadingLater===R.WaitForSync:(U(this._debug_convId,"Store is already destroyed"),!1)}isInitialMessagesLoaded(){return this._conversationInfo?this._isInitialMessagesLoaded:(U(this._debug_convId,"Store is already destroyed"),!0)}cannotGetEarlierMessages(){return this._conversationInfo?this._conversationInfo.cannotSyncButNotAtBeginning:(U(this._debug_convId,"Store is already destroyed"),!0)}isEarliestMessageTheBeginning(){return this._conversationInfo?2===this._conversationInfo.earliestMessageTime:(U(this._debug_convId,"Store is already destroyed"),!0)}isLatestMessageTheEnd(){return this._conversationInfo?this._conversationInfo.latestMessageTime===D:(U(this._debug_convId,"Store is already destroyed"),!0)}getMessages(){var e;if(!this._conversationInfo)return U(this._debug_convId,"Store is already destroyed"),[];if(!this._conversationInfo.sortedMessages){let e;if(p.isBookmarkConversation(this._conversationInfo.conversationId))e=o.sortBy(this._conversationInfo.messages,(e=>l.getSourceMessageDate(e.properties)));else if(a.default.getS4LMessagingFeatures().enableKeepUnsentMessagesAtEndOfStream){const[t,s]=o.partition(this._conversationInfo.messages,(e=>e.isUnsent()&&!e.isSendRejected()&&!e.isEdited()&&(u.isEncryptedMessageType(e.messagetype)||u.isRichTextMessageType(e.messagetype)||u.isWrittenTextMessageType(e.messagetype)))),i=o.sortBy(s,(e=>e.createdTime)),n=o.sortBy(t,(e=>e.composeTime));e=i.concat(n)}else e=o.sortBy(this._conversationInfo.messages,(e=>e.createdTime));this._conversationInfo.sortedMessages=e}return(0,m.default)().isClearApplicableAndKeepInRecents(this._conversationInfo.conversationId)&&(null===(e=(0,m.default)().getConversation(this._conversationInfo.conversationId))||void 0===e?void 0:e.isDeleted())&&(this._conversationInfo.sortedMessages=[],this._conversationInfo.messages={}),this._conversationInfo.sortedMessages}getConversationId(){if(this._conversationInfo)return this._conversationInfo.conversationId;U(this._debug_convId,"Store is already destroyed")}getTargetMessageTimestamp(){if(this._conversationInfo)return this._targetMessageTimestamp;U(this._debug_convId,"Store is already destroyed")}probablyShouldNotCache(){return this._probablyShouldNotCache}fetchEarlierMessages(){this._wrapWithTriggerLogic((()=>this._fetchEarlierMessagesIfNeeded(B,!0)))}fetchLaterMessages(){this._wrapWithTriggerLogic((()=>this._fetchLaterMessagesIfNeeded(B,!0)))}feedEphemeralMessage(e){if(!this._conversationInfo)return;const t=this._conversationInfo.getLatestKnownMessage(),s=Math.max(t&&t.createdTime||0,Date.now())+1,i=I.default.fromFirstLie(e.messageForPosting,e.conversationId,T.default.getSkypeMri(),s,!0);this._messagesUpdatedCallback([i])}destroy(){this._syncCompleteSubscriptionToken&&this._syncCompleteSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken&&this._messagesUpdatedSubscriptionToken.unsubscribe(),this._conversationsUpdatedSubscriptionToken&&this._conversationsUpdatedSubscriptionToken.unsubscribe(),this._contactsStoreSubscriptionToken&&g.default.unsubscribe(this._contactsStoreSubscriptionToken),this._scheduledCallsStoreSubscriptionToken&&b.default.unsubscribe(this._scheduledCallsStoreSubscriptionToken);const e=this.getConversationId();e&&y.default.cleanupConversation(e),this._conversationInfo=void 0;const t=this._waitForSubscribersDeferred;t&&(this._waitForSubscribersDeferred=void 0,t.resolve(void 0))}isDestroyed(){return!this._conversationInfo}_fetchInitialMessages(){if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");const e=this._conversationInfo.conversationId;this._conversationInfo.isOutsideSyncWindow=this._isRealConversationKnown&&this._conversationInfo.latestMessageTime<h.default.getEarliestKnownMessageTime(e);const t=this._conversationInfo.isOutsideSyncWindow?h.default.waitForMessageSyncToFinish(this._conversationInfo.conversationId).catch(o.noop):r.Resolved();return this._conversationInfo.isLoadingEarlier=R.WaitForSync,this._conversationInfo.isLoadingLater=R.WaitForSync,t.then((()=>{if(!this._conversationInfo)return;this._conversationInfo.isLoadingEarlier=R.None,this._conversationInfo.isLoadingLater=R.None,this._conversationInfo.isOutsideSyncWindow=this._isRealConversationKnown&&this._conversationInfo.latestMessageTime<h.default.getEarliestKnownMessageTime(e),E(this._debug_convId,"Fetching initial messages");const t=Date.now(),s=this._fetchEarlierMessagesIfNeeded(Math.floor(27.5),!1),i=this._fetchLaterMessagesIfNeeded(Math.ceil(27.5),!1);return r.all([s,i]).then((()=>{this._isInitialMessagesLoaded=!0,this._conversationInfo&&(this._conversationInfo.fetchedMessages||this._conversationInfo.syncedBackwards)&&_.track(new v.MessagesFetched(e,this._conversationInfo.fetchedMessages,this._conversationInfo.syncedBackwards,Date.now()-t)),this.isDestroyed()||this.trigger()}))}))}_fetchEarlierMessagesIfNeeded(e,t){return this._conversationInfo?this._fetchEarlierMessagesIfNeededInternal(e,t,this._conversationInfo.earliestMessageTime):r.Rejected("Store was destroyed: nothing to do.")}_fetchEarlierMessagesIfNeededInternal(e,t,s){if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");const i=this._conversationInfo.conversationId;if(this._conversationInfo.isLoadingEarlier||2===this._conversationInfo.earliestMessageTime||this._conversationInfo.cannotSyncButNotAtBeginning||!this._isInitialized)return O(this._debug_convId,"_fetchEarlierMessages no need"),r.Resolved();if(this._conversationInfo.isOutsideSyncWindow){const n=this._conversationInfo.earliestMessageTime;return O(this._debug_convId,"_fetchEarlierMessages request more messages from ChatService, Max messages: "+e+", Earlier than: "+n+", SyncState: "+p.encodeSyncStateForLog(this._conversationInfo.localSyncState)),this._conversationInfo.isLoadingEarlier=R.ChatService,o.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(i,this._targetMessageTimestamp,A.AdditionalLoading.ChatService),d.default.serviceGetConversationMessagesEarlierThanTime(i,2,this._conversationInfo.localSyncState,e,n).then((i=>{if(this._conversationInfo)return this._handleChatServiceResponse(i).then((o=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const{windowChanged:n,messagesChanged:r}=this._conversationInfo.updateWindowAndMessages(o,!1,"fetchEarlierCS");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),i.messages.length<e)this._conversationInfo.updateWindowToBeginningOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages();else if(n&&!r)return O(this._debug_convId,"_fetchEarlierMessages no visible messages within the updated window: try again"),this._fetchEarlierMessagesIfNeededInternal(e,t,s)}}))}),(e=>{this._conversationInfo&&(this._conversationInfo.isLoadingEarlier=R.None),U(this._debug_convId,'Failed to load earlier messages from the Chat Service (end time "'+n+'")',w.default.errorAsString(e))}))}if(this._conversationInfo.isEarliestTimeTheTopOfSyncWindow){O(this._debug_convId,"_fetchEarlierMessages use Sync to fetch");const n=o.clone(this._conversationInfo.messages),r=o.clone(this._conversationInfo.messagesOutOfSyncWindow),a=this._conversationInfo.earliestMessageTime;let l=!1;return this._conversationInfo.isLoadingEarlier=R.WaitForSync,this._syncBackwardsAndWait(i).then((()=>{if(this._conversationInfo){const t=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId);return O(this._debug_convId,"_fetchEarlierMessages fetching from db between "+t+" and "+s+", max messages: "+e),this._getMessagesInRange(i,t,s,e).then((e=>{if(this._conversationInfo){const s=this._conversationInfo.updateWindowAndMessages(e,!1,"fetchEarlierSyncThenDB");l=s.messagesChanged,0===e.length&&this._conversationInfo.updateWindowFromEmptyEarlierDBQuery(t),this._conversationInfo.checkForOutSideSyncWindowMessages()}}))}})).then((()=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const o=c.default.getConversationMetaFromMemoryCache(i);if(o)if(o.conv.isBricked)O(this._debug_convId,"_fetchEarlierMessages conversation bricked"),this._conversationInfo.cannotSyncButNotAtBeginning=!0;else{h.default.haveAllMessagesForConversation(i)&&(O(this._debug_convId,"_fetchEarlierMessages sync has everything"),this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!1);const o=!this._haveMessagesChanged(n,this._conversationInfo.messages);if(O(this._debug_convId,"_fetchEarlierMessages finished sync"+(o?" without changes - refetching":" and got message updates")),o){const i=this._haveMessagesChanged(r,this._conversationInfo.messagesOutOfSyncWindow);this._conversationInfo.earliestMessageTime!==a||!this._conversationInfo.isEarliestTimeTheTopOfSyncWindow||i||l?this._fetchEarlierMessagesIfNeededInternal(e,t,s):O(this._debug_convId,"_fetchEarlierMessages sync gave us nothing")}}else O(this._debug_convId,"_fetchEarlierMessages conversation not known")}}))}{const n=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId);return O(this._debug_convId,"_fetchEarlierMessages Fetch from the DB between "+n+" and "+s+", max messages: "+e),this._conversationInfo.isLoadingEarlier=R.Database,o.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(i,this._targetMessageTimestamp,A.AdditionalLoading.IndexedDB),this._getMessagesInRange(i,n,s,e).then((o=>{if(this._conversationInfo){this._conversationInfo.isLoadingEarlier=R.None;const{windowChanged:n,messagesChanged:r}=this._conversationInfo.updateWindowAndMessages(o,!1,"fetchEarlierDB");if(o.length<e){if(!this._isRealConversationKnown)return void this._conversationInfo.updateWindowToBeginningOfTime();h.default.haveAllMessagesForConversation(i)?(this._conversationInfo.updateWindowToBeginningOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages()):this._conversationInfo.isEarliestTimeTheTopOfSyncWindow=!0}const a=n||2===s;if(0===o.length||a&&!r&&e<550)return o.length===e&&(e+=Math.floor(27.5)),O(this._debug_convId,"_fetchEarlierMessages no visible messages within the updated window: try again, new maxMessages: "+e),this._fetchEarlierMessagesIfNeededInternal(e,t,s)}}))}}_haveMessagesChanged(e,t){return!(0,f.default)(e,t,((e,t,s)=>s?e===t:void 0))}_fetchLaterMessagesIfNeeded(e,t){if(!this._conversationInfo)return r.Rejected("Store was destroyed: nothing to do.");const s=this._conversationInfo.conversationId;if(this._conversationInfo.isLoadingLater||this._conversationInfo.latestMessageTime===D||!this._isInitialized)return O(this._debug_convId,"_fetchLaterMessages no need"),r.Resolved();if(this._conversationInfo.isOutsideSyncWindow){const i=this._conversationInfo.latestMessageTime,n=h.default.getEarliestKnownMessageTime(s);return O(this._debug_convId,"_fetchLaterMessages request more messages from ChatService, Max messages: "+e+", Start time: "+i+", Later than: "+n+", SyncState: "+p.encodeSyncStateForLog(this._conversationInfo.localSyncState)),this._conversationInfo.isLoadingLater=R.ChatService,o.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(s,this._targetMessageTimestamp,A.AdditionalLoading.ChatService),d.default.serviceGetConversationMessagesLaterThanTime(s,i,n,this._conversationInfo.localSyncState,e,!1).then((s=>{if(this._conversationInfo)return this._handleChatServiceResponse(s,e).then((i=>{if(this._conversationInfo){this._conversationInfo.isLoadingLater=R.None;const{windowChanged:o,messagesChanged:n}=this._conversationInfo.updateWindowAndMessages(i,!1,"fetchLaterCS");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),s.messages.length,0===i.length||o&&!n)return O(this._debug_convId,"_fetchLaterMessages mo visible messages within the updated window: try again"),this._fetchLaterMessagesIfNeeded(e,t)}}))}),(e=>{this._conversationInfo&&(this._conversationInfo.isLoadingLater=R.None),U(this._debug_convId,'Failed to load later messages from the Chat Service (start time "'+i+'")',w.default.errorAsString(e))}))}return O(this._debug_convId,"_fetchLaterMessages Fetch from the DB after "+this._conversationInfo.latestMessageTime),this._conversationInfo.isLoadingLater=R.Database,o.isUndefined(this._targetMessageTimestamp)||(0,k.markMessageSearchAdditionalMessageLoading)(s,this._targetMessageTimestamp,A.AdditionalLoading.IndexedDB),r.fromThenable(x.MessagesRepository.getMessagesForConversationAfterTime(s,this._conversationInfo.latestMessageTime,e,t)).then((s=>{if(this._conversationInfo){this._conversationInfo.isLoadingLater=R.None;const{windowChanged:i,messagesChanged:o}=this._conversationInfo.updateWindowAndMessages(s,!1,"fetchLaterDB");if(this._conversationInfo.checkForOutSideSyncWindowMessages(),s.length<e)this._conversationInfo.updateWindowToEndOfTime(),this._conversationInfo.checkForOutSideSyncWindowMessages();else if(i&&!o)return O(this._debug_convId,"_fetchLaterMessages no visible messages within the updated window: try again"),this._fetchLaterMessagesIfNeeded(e,t)}}))}_getMessagesInRange(e,t,s,i){return t>s?r.Resolved([]):r.fromThenable(x.MessagesRepository.getMessagesForConversationAndTimeRange(e,t,s,!0,i))}_handleChatServiceResponse(e,t=0){if(!this._conversationInfo)return r.Resolved([]);if(this._conversationInfo.fetchedMessages+=e.messages.length,this._conversationInfo.isOutsideSyncWindow){let s=!1;if(e.messages.length<t)s=!0;else if(e.messages.length){s=Number(o.maxBy(e.messages,(e=>e.id)).id)>=h.default.getEarliestKnownMessageTime(this._conversationInfo.conversationId)}s?this._conversationInfo.setAsNoLongerOutsideSyncWindow():this._conversationInfo.localSyncState=p.decodeSyncState(e._metadata.syncState)}let s;const i=this._conversationInfo.conversationId;if(p.isEncryptedThread(i)){const t=o.map(e.messages,(e=>({message:e,origin:S.MessageOrigin.ChatSync,isOtherEndpointActive:!1,messageStoreUsed:!1})));s=c.default.queueMessagesForConversationAndWait(i,t).then((()=>{const t=o.map(e.messages,(e=>p.getCuidForMessage(e)));return r.fromThenable(x.MessagesRepository.getMessagesByCuid(i,t))}))}else{const t=o.compact(o.map(e.messages,(e=>{const t=p.getCuidForMessage(e);return this._conversationInfo.persistedMessagesFromQueries[t]?this._conversationInfo.persistedMessagesFromQueries[t].applyServerMessage(e):I.default.fromFirstServerMessage(e)})));o.extend(this._conversationInfo.persistedMessagesFromQueries,o.keyBy(t,(e=>e.cuid))),s=r.Resolved(t)}return s}_syncBackwardsAndWait(e){return h.default.syncBackwards(e).then((t=>{if(this._conversationInfo){const s=t?h.default.waitForMessageSyncToFinish(this._conversationInfo.conversationId):r.Resolved();return!this._conversationInfo.syncedBackwards&&t&&(this._conversationInfo.syncedBackwards=!0),s.then(o.noop,(t=>{if(!this._conversationInfo)return;let s;return 0===this._getSubscriptionKeys().length?(E(this._debug_convId,"Failed to wait for message sync to finish, postponing retries due to no subscribers"),this._waitForSubscribersDeferred||(this._waitForSubscribersDeferred=r.Defer()),s=this._waitForSubscribersDeferred.promise()):s=r.Resolved(),s.thenAsync((()=>{if(this._conversationInfo)return E(this._debug_convId,"Failed to wait for message sync to finish, retrying"),this._syncBackwardsAndWait(e)}))}))}}))}}function N(e){return'For conv "'+M.mriOrId(e)+'"'}function E(e,...t){_.log(S.LogTraceArea.MessageStreamStore,N(e),...t)}function O(e,...t){_.log(S.LogTraceArea.MessageStreamStoreDebug,N(e),...t)}function U(e,...t){_.error(S.LogTraceArea.MessageStreamStore,N(e),...t)}t.MessageStreamStore=F},682432:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(150343)),a=s(971988),l=i.__importDefault(s(531904)),d=i.__importDefault(s(363091)),c=i.__importDefault(s(615364));let u=class extends n.StoreBase{constructor(){super(...arguments),this._translatedMessages={},this._hiddenTranslations={}}getTranslatedMessage(e,t){return this._translatedMessages[e]&&this._translatedMessages[e][t]}hasTranslatedMessage(e,t){return!(!this._translatedMessages[e]||!this._translatedMessages[e][t])}updateMessages(e){if(!r.default.getS4LCMCFeatures().enableMessageTranslation)return;const t=[];o.each(e,(e=>{const s=e.conversationId,i=(0,c.default)().getConversation(s),o=null==i?void 0:i.isTranslated();if((d.default.isMyMri(e.creator)||o)&&s&&(0,a.isTranslationMessageType)(e.messagetype)){const i=(0,a.getMessageTranslationMetadata)(e.content);e.isDeletedMessage()||!i?delete this._translatedMessages[s]:(this._translatedMessages[s]||(this._translatedMessages[s]={}),(!this._translatedMessages[s][i.oid]||e.createdTime>this._translatedMessages[s][i.oid].createdTime)&&(this._translatedMessages[s][i.oid]=e,t.push(s)))}else this._requestNewTranslationWhenEdited(e,s)&&l.default.requestTranslation(s,e.cuid,e)})),o.isEmpty(t)||this.trigger(o.uniq(t))}_requestNewTranslationWhenEdited(e,t){var s;return t&&!(0,a.isTranslationMessageType)(e.messagetype)&&!o.isEmpty(e.content)&&!!(null===(s=this._translatedMessages[t])||void 0===s?void 0:s[e.cuid])&&Number(e.getLatestServerMessageVersion()||0)>Number(this._translatedMessages[t][e.cuid].getLatestServerMessageVersion()||0)}hasHiddenTranslation(e,t){var s,i;return!(null===(s=this._translatedMessages[e])||void 0===s?void 0:s[t])||!!(null===(i=this._hiddenTranslations[e])||void 0===i?void 0:i[t])}setHidden(e,t,s=!0){var i,o;(null===(i=this._translatedMessages[e])||void 0===i?void 0:i[t])&&(!s&&(null===(o=this._hiddenTranslations[e])||void 0===o?void 0:o[t])?(delete this._hiddenTranslations[e][t],this.trigger(e)):s&&(this._hiddenTranslations[e]||(this._hiddenTranslations[e]={}),this._hiddenTranslations[e][t]||(this._hiddenTranslations[e][t]=!0,this.trigger(e))))}test_reset(){this._translatedMessages={},this._hiddenTranslations={}}test_getUpdatedTranslationMessages(){return this._translatedMessages}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],u.prototype,"getTranslatedMessage",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],u.prototype,"hasTranslatedMessage",null),i.__decorate([n.autoSubscribe,i.__param(0,n.key)],u.prototype,"hasHiddenTranslation",null),u=i.__decorate([n.AutoSubscribeStore],u),t.default=new u},793778:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(197582),o=s(217041);var n;!function(e){e[e.ShowMybotFloatToolTip=0]="ShowMybotFloatToolTip",e[e.MyBotItemReady=1]="MyBotItemReady",e[e.MyBotToolTipOffset=2]="MyBotToolTipOffset",e[e.MyBotItemIndexChanged=3]="MyBotItemIndexChanged"}(n||(t.TriggerKeys=n={}));let r=class extends o.StoreBase{constructor(){super(...arguments),this._showMybotFloatToolTip=!1,this._myBotItemReady=!1,this._myBotToolTipOffset=0,this._myBotIndex=0}isMyBotItemReady(){return this._myBotItemReady}shouldShowMyBotFloatToolTip(){return this._showMybotFloatToolTip}getToolTipOffset(){return this._myBotToolTipOffset}getMyBotItemIndex(){return this._myBotIndex}setShowMyBotFloatToolTip(e){this._showMybotFloatToolTip=e,this.trigger(n.ShowMybotFloatToolTip)}setMyBotItemReady(){this._myBotItemReady=!0,this.trigger(n.MyBotItemReady)}setToolTipOffset(e){this._myBotToolTipOffset=e,this.trigger(n.MyBotToolTipOffset)}setMyBotItemIndex(e){this._myBotIndex!==e&&(this._myBotIndex=e,this.trigger(n.MyBotItemIndexChanged))}};i.__decorate([(0,o.autoSubscribeWithKey)(n.MyBotItemReady)],r.prototype,"isMyBotItemReady",null),i.__decorate([(0,o.autoSubscribeWithKey)(n.ShowMybotFloatToolTip)],r.prototype,"shouldShowMyBotFloatToolTip",null),i.__decorate([(0,o.autoSubscribeWithKey)(n.MyBotToolTipOffset)],r.prototype,"getToolTipOffset",null),i.__decorate([(0,o.autoSubscribeWithKey)(n.MyBotItemIndexChanged)],r.prototype,"getMyBotItemIndex",null),r=i.__decorate([o.AutoSubscribeStore],r),t.default=new r},901005:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importStar(s(397691)),a=i.__importDefault(s(304623)),l=i.__importStar(s(44717)),d=s(434343),c=i.__importDefault(s(379878)),u=s(815146),h=i.__importStar(s(85385)),p=i.__importDefault(s(652032)),g=i.__importStar(s(437782)),m=i.__importStar(s(446574));let S=class extends n.StoreBase{constructor(){super(),this._privateConversations={},this._conversationsUpdated=e=>{o.each(e,(e=>{const t=e.conv.isEncryptedThread()?e.conv.getEncryptionHandshake():void 0;if(t){const s=c.default.getBuddyAddress(t).mri;this._savePrivateConversationMri(s,l.asSkypeThreadId(e.conv.id))}}))},m.RegisterStartupable(this,"PrivateConversationsStore",[a.default,p.default])}startup(){return this._privateConversations=p.default.getDataExclusive(d.InternalKeys.PrivateConversations)||{},a.default.conversationsUpdated.subscribe(this._conversationsUpdated),r.Resolved()}getPrivateConversationMriForContactMri(e){return this._privateConversations[e]}getAllPrivateConversationMris(){return o.values(this._privateConversations)}_savePrivateConversationMri(e,t){this._privateConversations[e]||(this._privateConversations[e]=t,p.default.putData(d.InternalKeys.PrivateConversations,this._privateConversations),h.log(u.LogTraceArea.PrivateConversationsStore,"Saving private conversation mri "+g.mriOrId(t)+" with contact mri "+g.mriOrId(e)),this.trigger(e))}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],S.prototype,"getPrivateConversationMriForContactMri",null),i.__decorate([n.autoSubscribe],S.prototype,"getAllPrivateConversationMris",null),S=i.__decorate([n.AutoSubscribeStore],S),t.default=new S},233277:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ReactionsStore=void 0,t.default=function(){return h||(h=new p)};const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(150343)),a=s(284841),l=s(841646),d=i.__importStar(s(704704)),c=i.__importDefault(s(341994)),u=i.__importStar(s(446574));let h,p=class extends l.CustomReactionsStoreBase{constructor(){super(),this._defaultReactions=[],u.RegisterStartupable(this,"ReactionsStore",[c.default])}startup(){super.startup();const e=r.default.getS4LMessagingFeatures();return this._maxReactionsNumber=e.maxNumberOfCustomReactions,this._initialTabId=e.customReactionsInitialTabId,this._setDefaultReactions(),r.default.subscribe((()=>{const{customReactionsInitialTabId:e}=r.default.getS4LMessagingFeatures();this._initialTabId=e,this._setDefaultReactions()})),Promise.resolve()}_setDefaultReactions(){this._defaultReactions=(0,a.chain)(o.assign({},r.default.getS4LMessagingFeatures().reactionPacks),(0,a.map)(o.toArray),o.flatten)}getDefaultReactions(){return this._defaultReactions}getSavedReactions(){return c.default.getReactions()||[]}saveCurrentReactions(){c.default.setReactions(this._localReactions),super.saveCurrentReactions()}getInitialTabId(){return this._initialTabId}isFeatureEnabled(){return!0}getMaxReactionsCount(){return this._maxReactionsNumber}getModalTitle(){return d.getString("ReactionsPanel.Title")}};t.ReactionsStore=p,t.ReactionsStore=p=i.__decorate([n.AutoSubscribeStore],p)},815905:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_RecentAssetStore=t.TriggerKeys=void 0;const i=s(197582),o=i.__importDefault(s(883596)),n=s(380157),r=i.__importStar(s(516778)),a=s(217041),l=i.__importDefault(s(659938)),d=s(815146),c=i.__importStar(s(85385)),u=i.__importDefault(s(251733)),h=i.__importStar(s(437782)),p=i.__importStar(s(446574)),g=s(331079),m=s(444314);var S;!function(e){e[e.RecentAssetThumbnail=0]="RecentAssetThumbnail",e[e.RecentAssetTimestamp=1]="RecentAssetTimestamp",e[e.HasFreshRecentAsset=2]="HasFreshRecentAsset"}(S||(t.TriggerKeys=S={}));let _=class extends a.StoreBase{getRecentAssetThumbnail(){return this._recentAssetThumbnail}getRecentAssetTimestamp(){return this._recentAssetTimestamp}hasRecentAsset(){return this._hasFreshRecentAsset}constructor(){super(),this._gettingRecentAssetThumbnail=!1,p.RegisterStartupable(this,"RecentAssetStore",[u.default])}startup(){return o.default.setRecentAssetThumbnailChangedEventEnabled(!0),o.default.recentAssetThumbnailChangedEvent.subscribe((e=>{c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore recentAssetThumbnailChangedEvent"),this._updateRecentAssetProps(e)})),l.default.subscribeForChanges("RecentAssetStore",(e=>{e===r.Types.AppActivationState.Active&&(c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore AppActivationState become active"),this._getRecentAssetThumbnail())})),u.default.subscribe((()=>{c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore permission for camera roll changed"),this._getRecentAssetThumbnail()}),g.PermissionType.CameraRoll),m.LocalStorage.getItem(m.StorageKeys.RecentAssetTimestampKeyId).then((e=>{c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore watched asset timestamp from local storage:"+e),this._storedRecentAssetTimestamp=e?Number(e):void 0,this._getRecentAssetThumbnail()})),Promise.resolve()}_startedTrackingKey(e){p.EnsureStarted(this)}markAsWatched(){c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore markAsWatched"),this._recentAssetTimestamp&&m.LocalStorage.setItem(m.StorageKeys.RecentAssetTimestampKeyId,String(this._recentAssetTimestamp)).then((()=>{this._storedRecentAssetTimestamp=this._recentAssetTimestamp,this._updateHasFreshRecentAsset()}))}forceRecentAssetCheck(){c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore forceRecentAssetCheck"),this._getRecentAssetThumbnail()}test_setRecentAssetTimestamp(e){this._recentAssetTimestamp=e}_getRecentAssetThumbnail(){c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore _getRecentAssetThumbnail"),this._gettingRecentAssetThumbnail||u.default.permissionStatus(g.PermissionType.CameraRoll)!==n.PermissionStatus.Granted||(this._gettingRecentAssetThumbnail=!0,o.default.getRecentAssetThumbnail().then((e=>{this._updateRecentAssetProps(e)})).finally((()=>{this._gettingRecentAssetThumbnail=!1})))}_updateRecentAssetProps(e){e.thumbnail===this._recentAssetThumbnail&&e.timestamp===this._recentAssetTimestamp||(c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore update recent asset data thumbnail("+h.dev_unknownOmit(e.thumbnail)+"), timestamp("+e.timestamp+")"),this._recentAssetThumbnail=e.thumbnail,this._recentAssetTimestamp=e.timestamp,this.trigger([S.RecentAssetThumbnail,S.RecentAssetTimestamp]),this._updateHasFreshRecentAsset())}_updateHasFreshRecentAsset(){const e=this._recentAssetTimestamp||0,t=this._storedRecentAssetTimestamp||0,s=Date.now()/1e3-604800,i=e>t,o=e>s,n=i&&o;c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore hasFreshRecentAsset check: recentTimestamp("+e+") storedTimestamp("+t+") minAllowedTimestamp("+s+") hasNewAsset("+i+") newAssetIsNotVeryOld("+o+") hasFreshAsset("+n+")"),this._hasFreshRecentAsset!==n&&(c.log(d.LogTraceArea.MediaPrefetchService,"RecentAssetStore triggers HasFreshRecentAsset change"),this._hasFreshRecentAsset=n,this.trigger(S.HasFreshRecentAsset))}};t.Test_RecentAssetStore=_,i.__decorate([(0,a.autoSubscribeWithKey)(S.RecentAssetThumbnail)],_.prototype,"getRecentAssetThumbnail",null),i.__decorate([(0,a.autoSubscribeWithKey)(S.RecentAssetTimestamp)],_.prototype,"getRecentAssetTimestamp",null),i.__decorate([(0,a.autoSubscribeWithKey)(S.HasFreshRecentAsset)],_.prototype,"hasRecentAsset",null),t.Test_RecentAssetStore=_=i.__decorate([a.AutoSubscribeStore],_),t.default=new _},886928:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecentsFilterStore=void 0;const i=s(197582),o=s(217041);let n=class extends o.StoreBase{constructor(e){super(),this._arePillsAvailable=e,this._filterMode="all"}getFilterMode(){return this._getFilterMode()}getFilterModeNoSubscription(){return this._getFilterMode()}setFilterMode(e){this._arePillsAvailable&&(this._filterMode=e,this.trigger())}_getFilterMode(){return this._arePillsAvailable?this._filterMode:"all"}};t.RecentsFilterStore=n,i.__decorate([o.autoSubscribe],n.prototype,"getFilterMode",null),i.__decorate([o.disableWarnings],n.prototype,"getFilterModeNoSubscription",null),t.RecentsFilterStore=n=i.__decorate([o.AutoSubscribeStore],n)},249156:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041),n=i.__importStar(s(446574)),r={isOpen:!1,popupPosition:{bottom:0,height:0,left:0,right:0,top:0,width:0}};var a;!function(e){e.ShowRichtextEditor="ShowRichtextEditor",e.PopupPositionUpdated="PopupPositionUpdated"}(a||(a={}));let l=class extends o.StoreBase{constructor(){super(),this._richTextEditorInfo=new Map,this._getRichTextEditorConfig=e=>this._richTextEditorInfo.get(e)||r,this._setRichTextEditorConfig=(e,t)=>{this._richTextEditorInfo.set(e,Object.assign(Object.assign({},this._richTextEditorInfo.get(e)||r),t))},n.RegisterStartupable(this,"RichtextEditorStore")}startup(){return Promise.resolve()}setVisibility(e,t){t!==this._getRichTextEditorConfig(e).isOpen&&(this._setRichTextEditorConfig(e,{isOpen:t}),this.trigger((0,o.formCompoundKey)(e,a.ShowRichtextEditor)))}clear(e){this._richTextEditorInfo.delete(e),this.trigger((0,o.formCompoundKey)(e,a.ShowRichtextEditor))}panelOpened(e){return this._getRichTextEditorConfig(e).isOpen}};i.__decorate([o.disableWarnings],l.prototype,"clear",null),i.__decorate([(0,o.autoSubscribeWithKey)(a.ShowRichtextEditor),i.__param(0,o.key)],l.prototype,"panelOpened",null),l=i.__decorate([o.AutoSubscribeStore],l),t.default=new l},253905:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=i.__importDefault(s(114818));let a=class extends n.StoreBase{constructor(){super(...arguments),this._allMris=[],this._selectedMris=[]}isMriSelected(e){return o.includes(this._selectedMris,e)}getSelectedMris(){return this._getSelectedMris()}toggleMriSelection(e){o.includes(this._selectedMris,e)?this._removeMri(e):this._addMri(e),this.trigger([e])}createMriSelectionRange(e){const t=o.last(this._selectedMris);if(!t)return this._addMri(e),void this.trigger(e);const s=this._allMris.indexOf(e),i=this._allMris.indexOf(t),n=s>i?this._allMris.slice(i,s+1):this._allMris.slice(s,i+1);this._selectedMris=o.merge(this._selectedMris,n),this.trigger(this._selectedMris)}resetSelectedMris(){const e=[...this._selectedMris];this._selectedMris=[],this.trigger(e)}setAllMris(e){(0,r.default)(e,this._allMris)||(this._allMris=[...e])}_addMri(e){this._selectedMris=[...this._selectedMris,e]}_removeMri(e){this._selectedMris.splice(this._selectedMris.indexOf(e),1)}_getSelectedMris(){return[...this._selectedMris||[]]}};i.__decorate([n.autoSubscribe,i.__param(0,n.key)],a.prototype,"isMriSelected",null),i.__decorate([n.autoSubscribe],a.prototype,"getSelectedMris",null),a=i.__decorate([n.AutoSubscribeStore],a),t.default=new a},468492:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(217041),r=s(154235);var a;!function(e){e[e.SpacerWidthUpdates=0]="SpacerWidthUpdates"}(a||(t.TriggerKeys=a={}));let l=class extends n.StoreBase{constructor(){super(...arguments),this._selectedMessages=[],this._isSelectMessagesModeActive=!1,this._selectedMessagesScope=r.MainRootViewId}deactivateSelectMessagesMode(){this._isSelectMessagesModeActive&&(this._isSelectMessagesModeActive=!1,this._selectedMessages=[],this._selectedMessagesScope=r.MainRootViewId,this.trigger())}activateSelectMessagesMode(e){const t=e!==this._selectedMessagesScope;this._isSelectMessagesModeActive&&!t||(this._isSelectMessagesModeActive=!0,this._selectedMessagesScope=e,t&&(this._selectedMessages=[]),this.trigger())}addOrUpdateSelectedMessage(e){this._selectedMessages=o.filter(this._selectedMessages,(t=>!(t.message.cuid===e.message.cuid&&t.urlPreviewId===e.urlPreviewId))),this._selectedMessages=o.sortBy(this._selectedMessages.concat(e),(e=>e.message.createdTime)),this.trigger()}removeSelectedMessage(e){this._selectedMessages=o.filter(this._selectedMessages,(t=>!(t.message.cuid===e.message.cuid&&t.urlPreviewId===e.urlPreviewId))),this.trigger()}isMessageSelected(e){return o.some(this._selectedMessages,(t=>t.message.cuid===e))}isSelectMessagesModeActive(e){return this._isSelectMessagesModeActive&&this._selectedMessagesScope===e}getSelectedMessages(){return this._selectedMessages}};i.__decorate([n.autoSubscribe],l.prototype,"isSelectMessagesModeActive",null),i.__decorate([n.autoSubscribe],l.prototype,"getSelectedMessages",null),l=i.__decorate([n.AutoSubscribeStore],l),t.default=new l},782829:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(174958),n=i.__importStar(s(496486)),r=i.__importDefault(s(974634)),a=i.__importStar(s(397691)),l=i.__importDefault(s(150343)),d=s(135356),c=i.__importStar(s(44717)),u=s(815146),h=s(120695),p=i.__importStar(s(235256)),g=i.__importStar(s(85385)),m=i.__importDefault(s(114818)),S=i.__importDefault(s(565060)),_=i.__importDefault(s(902530)),f=i.__importStar(s(446574)),y=i.__importDefault(s(139221)),v=i.__importDefault(s(517518)),C=i.__importDefault(s(220534)),T="SessionInfoStore";t.default=new class{constructor(){this._sessionInfo={id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,restEndpointUrl:void 0,ecsEtag:void 0,registrationToken:void 0},this.endpointInfoChanged=new r.default,this.restEndpointUrlChanged=new r.default,this._loggingOut=!1,this._appConfigStoreChanged=()=>{const{chatServiceHostRefreshEnabled:e,chatServiceHostRefreshInterval:t}=l.default.getConfigSettings().chat;e&&!this._chatServiceHostRefreshEnabled?t>0&&t!==this._chatServiceHostRefreshInterval?(this._chatServiceHostRefreshInterval=t,g.log(u.LogTraceArea.ChatService,`SessionInfoStore chatServiceHostRefreshInterval set to ${this._chatServiceHostRefreshInterval} s`),p.default.setRefreshOptions(T,{interval:l.default.getConfigSettings().chat.chatServiceHostRefreshInterval,taskTypeFlags:p.TaskTypeFlags.UsesNetworking,callback:()=>(g.log(u.LogTraceArea.ChatService,"SessionInfoStore restEndpointUrlChanged fire."),this.restEndpointUrlChanged.fire(),a.Resolved())})):this.restEndpointUrlChanged.fire():!e&&this._chatServiceHostRefreshEnabled&&p.default.setRefreshOptions(T,{interval:0,taskTypeFlags:p.TaskTypeFlags.UsesNetworking,callback:()=>{}})},f.RegisterStartupable(this,"SessionInfoStore",[_.default])}calcChatV1EndpointUrl(){switch(l.default.getS4LFeatures().chatFeatures.recommendedRing){case d.UserRing.DailyDF:case d.UserRing.MasterDF:return l.default.getConfigSettingsNoSubscription().chat.dogfoodHost;default:return l.default.getConfigSettingsNoSubscription().chat.productionHost}}startup(){if(!l.default.getConfigSettings().chat.dontPersistSessionInfoOnWeb){const e=n.cloneDeep(_.default.ChatServiceSessionInfo.get());e&&(this._sessionInfo=e,y.default.setChatEndpointId(c.formatEndpointIdRemoveBrackets(this._sessionInfo.id)))}return g.log(u.LogTraceArea.ChatService,"Startup: Stored Endpoint Info: "+c.encodeEndpointInfoForLog(this._sessionInfo)),l.default.subscribe(this._appConfigStoreChanged),this._appConfigStoreChanged(),a.Resolved(void 0)}setRestEndpointUrl(e){this._sessionInfo.restEndpointUrl!==e&&C.default.isUrlValid(e)&&(this._sessionInfo=Object.assign(Object.assign({},this._sessionInfo),{restEndpointUrl:e}),this._persistSessionInfo())}setRegistrationToken(e){if(this._sessionInfo.registrationToken===e)return;const t=c.getExpiresFromRegToken(e),s=v.default.getSkypeToken();g.log(u.LogTraceArea.ChatServiceTransport,"Registration token updated to "+(e?"using new":"undefined")+", Expires: "+(t?new Date(1e3*t):"undefined")+", EndpointId: "+c.getEndpointIdFromRegToken(e)+", SkypeToken valid: "+(s&&!s.isTokenExpired())+", SkypeToken expiration: "+(s?new Date(s.expiration):"undefined")),this._sessionInfo=Object.assign(Object.assign({},this._sessionInfo),{registrationToken:e}),this._persistSessionInfo()}markRegistrationTokenExpired(e){this._sessionInfo.registrationToken&&this._sessionInfo.registrationToken!==e?g.log(u.LogTraceArea.ChatServiceTransport,"RegistrationToken reported invalid, but it doesn't match our stored one -- ignoring!"):this.setRegistrationToken(void 0)}setPushSubscriptionInfo(e,t,s){!e||this._sessionInfo.exists&&c.areEndpointIdsEqual(this._sessionInfo.id,e.endpointId)?(e?g.log(u.LogTraceArea.ChatService,"Push Subscription Updated: "+e.endpointId+"/"+e.subscriptionId+", Params: "+o.pii.Omit(JSON.stringify(e.params))):g.log(u.LogTraceArea.ChatService,"Push Subscription Cleared"),this.updateEndpointInfo({pushSubscriptionId:e?e.subscriptionId:void 0,pushSubscriptionParams:e?e.params:void 0,reason:t,tcid:s})):g.log(u.LogTraceArea.ChatService,"pushSubscriptionUpdated called with stale endpointId")}markEndpointMissing(e,t){c.areEndpointIdsEqual(this._sessionInfo.id,e)?(g.log(u.LogTraceArea.ChatService,"Endpoint "+e+" reported missing"),this.updateEndpointInfo({exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,reason:"Endpoint missing",tcid:t})):g.log(u.LogTraceArea.ChatService,"endpointMissing called with stale endpointId")}updateEndpointInfo(e){if(this._loggingOut)return;const t=n.assign({},this._sessionInfo,e);if((0,m.default)(this._sessionInfo,t))return;this._sessionInfo.exists&&!this._sessionInfo.id&&g.track(new h.FundamentalsDebugEvent("EndpointIdEmpty",e.reason)),this._sessionInfo.id&&this._sessionInfo.pushSubscriptionId&&!t.pushSubscriptionId&&g.track(new h.MissingPushSubscription(t.id||"None",this._sessionInfo.id,this._sessionInfo.pushSubscriptionId,S.default.getRegistrationId(),e.reason,e.tcid)),g.log(u.LogTraceArea.ChatService,"UpdateEndpointInfo: "+c.encodeEndpointInfoForLog(t));const s=this._sessionInfo;this._sessionInfo=t,this._persistSessionInfo(),this.endpointInfoChanged.fire(t,s)}getEndpointInfo(){return this._sessionInfo}getEndpointId(){return this._sessionInfo.exists?this._sessionInfo.id:void 0}endpointExists(){return this._sessionInfo.exists}presenceDocPublished(){return!!this.getEndpointInfo().presenceDocPublished}getRestEndpointUrl(){return this._sessionInfo.restEndpointUrl}getRegistrationToken(){return this._sessionInfo.registrationToken}logout(e){return this._loggingOut=!0,y.default.setChatEndpointId(void 0),_.default.deleteIds({chatServiceSessionInfo:!0})}_persistSessionInfo(){this._loggingOut||(y.default.setChatEndpointId(c.formatEndpointIdRemoveBrackets(this._sessionInfo.id)),l.default.getConfigSettings().chat.dontPersistSessionInfoOnWeb||_.default.setChatServiceSessionInfo(this._sessionInfo))}test_reset(){this._sessionInfo={id:void 0,exists:!1,featureFlags:void 0,presenceDocPublished:void 0,pushSubscriptionId:void 0,pushSubscriptionParams:void 0,restEndpointUrl:void 0,ecsEtag:void 0,registrationToken:void 0}}}},400836:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041),n=i.__importStar(s(603094)),r=i.__importDefault(s(37679)),a=i.__importDefault(s(879248)),l=s(384860),d=i.__importStar(s(85385)),c=s(796967),u=i.__importDefault(s(127336)),h=i.__importDefault(s(808164));let p=class extends o.StoreBase{constructor(){super(),r.default.subscribe((()=>this.trigger()))}isPaidUser(){const e=r.default.getCreditEntitlement();return n.hasUsableCredit(e)||r.default.userHasSubscriptions()}trackCallerIdOnSMSSent(e){a.default.maybeRefreshCallerIdData().finally((()=>{var t,s;const i=(0,c.getPhoneNumberFromMessageContent)(e.content),o=u.default.getSmsRateByPhoneNumberSafely(i),n=(0,c.getDestinationCountryFromSmsRateInfo)(null==o?void 0:o.fullRateInfo),{isValidNumber:r,possibleCountry:p}=h.default.getPhoneNumberDetails(i);d.track(new l.SmsSent(r,null===(t=a.default.getCallerIdPrimaryNumber())||void 0===t?void 0:t.type,e.clientmessageid,(0,c.getRequestId)(e.content),n||p,null===(s=null==o?void 0:o.fullRateInfo)||void 0===s?void 0:s.callerCountry))}))}};i.__decorate([o.autoSubscribe],p.prototype,"isPaidUser",null),p=i.__decorate([o.AutoSubscribeStore],p),t.default=new p},127336:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041),n=i.__importDefault(s(612753)),r=i.__importStar(s(85385)),a=s(815146),l=i.__importDefault(s(655192));let d=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._lookups={}}_startedTrackingKey(e){this._lookups[e]||(this._lookups[e]=n.default.getSmsPrice(e).finally((()=>{delete this._lookups[e]})).then((t=>{t&&(this._phoneNumberRates[e]=t,this.trigger(e))})))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e]}updateData(e){return n.default.getSmsPrice(e).then((t=>{t&&(this._phoneNumberRates[e]=t,this.trigger(e))})).catch((t=>{r.error(a.LogTraceArea.SMSClient,"Update SMS Rate failed for "+e+": "+l.default.errorAsString(t))}))}getSmsRateByPhoneNumber(e){return this._phoneNumberRates[e]}getSmsRateByPhoneNumberSafely(e){if(e&&0!==e.length)return this.getSmsRateByPhoneNumber(e)}};i.__decorate([o.disableWarnings],d.prototype,"_startedTrackingKey",null),i.__decorate([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),i.__decorate([o.autoSubscribe,i.__param(0,o.key)],d.prototype,"getSmsRateByPhoneNumber",null),i.__decorate([o.autoSubscribe],d.prototype,"getSmsRateByPhoneNumberSafely",null),d=i.__decorate([o.AutoSubscribeStore],d),t.default=new d},460403:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(217041),n=i.__importDefault(s(298757)),r=i.__importDefault(s(150343)),a=i.__importStar(s(987364)),l=i.__importStar(s(446574)),d=i.__importStar(s(517518));let c=class extends o.StoreBase{constructor(){super(),this._hasCdnToken=!1,this._hasCdnTokenCookie=!1,this._hasAmsCookie=!1,l.RegisterStartupable(this,"UrlAuthStore",[n.default,d.default])}startup(){return d.default.subscribe((()=>{const e=this._hasCdnToken,t=this._hasCdnTokenCookie;this._hasCdnToken=!!d.default.getCdnToken(),this._hasCdnTokenCookie=d.default.usingCdnCookie();let s=!1;e!==this._hasCdnToken&&(s=!0),t!==this._hasCdnTokenCookie&&(s=!0),s&&this.trigger()}),d.TriggerKeys.CdnTokenKey),d.default.subscribe((()=>{const e=this._hasAmsCookie;this._hasAmsCookie=d.default.getAmsCookieSet(),e!==this._hasAmsCookie&&this.trigger()}),d.TriggerKeys.AmsTokenKey),this._hasCdnToken=!!d.default.getCdnToken(),this._hasCdnTokenCookie=d.default.usingCdnCookie(),this._hasAmsCookie=d.default.getAmsCookieSet(),Promise.resolve()}getAuthenticatedUrl(e){if(e)return a.isAsyncMediaUrl(e)?this._hasAmsCookie?e:void 0:this._isStaticAmsUrl(e)?this._hasCdnTokenCookie?e:this._hasCdnToken?e+"?"+d.default.getCdnToken():void 0:e}_isStaticAmsUrl(e){return 0===e.indexOf(r.default.getConfigSettingsNoSubscription().pes.skypeServiceHost)}};i.__decorate([o.autoSubscribe],c.prototype,"getAuthenticatedUrl",null),c=i.__decorate([o.AutoSubscribeStore],c),t.default=new c},719006:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UserComposingStateStore=void 0;const i=s(197582).__importStar(s(172134));class o{constructor(){this._composingStates={}}isUserComposing(){return Object.keys(this._composingStates).length>0}setComposingState(e,t){if(e)this._composingStates[t]=!0;else{if(!this._composingStates[t])return;delete this._composingStates[t]}i.setUserComposingStateIfSupported(e,t)}test_reset(){this._composingStates={}}}t.UserComposingStateStore=o,t.default=new o},241876:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecentsFilterStore=t.ConversationsListWithFiltersStore=void 0;var i=s(611439);Object.defineProperty(t,"ConversationsListWithFiltersStore",{enumerable:!0,get:function(){return i.ConversationsListWithFiltersStore}});var o=s(886928);Object.defineProperty(t,"RecentsFilterStore",{enumerable:!0,get:function(){return o.RecentsFilterStore}})},632964:(e,t)=>{var s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonStatus=t.HeaderButtonKey=void 0,function(e){e.VideoCallButton="videocallbutton",e.CallButton="callbutton",e.CallButtonConnected="callbutton_connected",e.CallButtonOnHold="callbutton_onhold",e.MoreOptionsButton="moreoptionsbutton",e.StartCallButton="startcallbutton",e.FindButton="findbutton",e.GalleryButton="gallerybutton",e.ModernizedAddContactsButton="modernizedaddcontactsbutton",e.ImageCreatorButton="imagecreatorbutton",e.UnsubscribeButton="unsubscribebutton"}(s||(t.HeaderButtonKey=s={})),function(e){e[e.Selected=0]="Selected",e[e.Unselected=1]="Unselected",e[e.Disabled=2]="Disabled"}(i||(t.ButtonStatus=i={}))},511134:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationType=void 0,function(e){e[e.OneOnOneSkype=0]="OneOnOneSkype",e[e.Encrypted=1]="Encrypted",e[e.PSTN=2]="PSTN",e[e.Group=3]="Group",e[e.Bot=4]="Bot",e[e.Other=5]="Other",e[e.NewsChannel=6]="NewsChannel",e[e.NewsBot=7]="NewsBot"}(s||(t.ConversationType=s={}))},137092:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationUIType=void 0,function(e){e[e.OneOnOneSkype=0]="OneOnOneSkype",e[e.Private=1]="Private",e[e.Phone=2]="Phone",e[e.Group=3]="Group",e[e.Other=4]="Other"}(s||(t.ConversationUIType=s={}))},729827:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CustomReactionsType=void 0,function(e){e[e.Message=0]="Message",e[e.Call=1]="Call"}(s||(t.CustomReactionsType=s={}))},146412:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCountryCodes=function(){return["eu","uk","af","ax","al","dz","as","ad","ao","ai","aq","ag","ar","am","aw","au","at","az","bs","bh","bd","bb","by","be","bz","bj","bm","bt","bo","ba","bw","bv","br","io","bn","bg","bf","bi","kh","cm","ca","cv","ky","cf","td","cl","cn","cx","cc","co","km","cg","cd","ck","cr","ci","hr","cu","cy","cz","dk","dj","dm","do","ec","eg","sv","gq","er","ee","et","fk","fo","fj","fi","fr","gf","pf","tf","ga","gm","ge","de","gh","gi","gr","gl","gd","gp","gu","gt","gg","gn","gw","gy","ht","hm","va","hn","hk","hu","is","in","id","ir","iq","ie","im","il","it","jm","jp","je","jo","kz","ke","ki","kp","kr","kw","kg","la","lv","lb","ls","lr","ly","li","lt","lu","mo","mk","mg","mw","my","mv","ml","mt","mh","mq","mr","mu","yt","mx","fm","md","mc","mn","me","ms","ma","mz","mm","na","nr","np","nl","an","nc","nz","ni","ne","ng","nu","nf","mp","no","om","pk","pw","ps","pa","pg","py","pe","ph","pn","pl","pt","pr","qa","re","ro","ru","rw","bl","sh","kn","lc","mf","pm","vc","ws","sm","st","sa","sn","rs","sc","sl","sg","sk","si","sb","so","za","gs","es","lk","sd","sr","sj","sz","se","ch","sy","tw","tj","tz","th","tl","tg","tk","to","tt","tn","tr","tm","tc","tv","ug","ua","ae","gb","us","um","uy","uz","vu","ve","vn","vg","vi","wf","ye","zm","zw"]}},929418:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ShareContactOrigin=void 0,function(e){e[e.MessageComposer=0]="MessageComposer",e[e.DragAndDrop=1]="DragAndDrop",e[e.Deeplink=2]="Deeplink"}(s||(t.ShareContactOrigin=s={}))},289054:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},997380:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OverflowItemSizeInList=t.OverflowItemSizeInGridOrCarousel=void 0,t.OverflowItemSizeInGridOrCarousel=60,t.OverflowItemSizeInList=40},676908:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.UrlPreviewRenderInformation=t.MessageRenderSendingStatus=void 0,function(e){e[e.None=0]="None",e[e.Sending=1]="Sending",e[e.NoNetwork=2]="NoNetwork",e[e.Failed=3]="Failed"}(s||(t.MessageRenderSendingStatus=s={}));t.UrlPreviewRenderInformation=class{}},954225:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.MessageStreamFontSize=t.newsDigestArticleContentLeftMargin=t.swiftCardHorizontalMargin=t.newsDigestArticleImageSize=t.newsChannelMediaCardMaxWidth=t.streamItemOptionsMenuWidthInDesktopSubview=t.streamItemOptionsMenuWidth=t.streamItemOptionsMenuHeight=t.messageTextLineHeight=t.messageStreamMaxContentWidth=t.messageStreamOverflowWidth=t.messageBorderRadius=t.maxStreamContentWidth=t.headerTextHeight=t.addInsButtonWidth=t.adaptiveCardMessageFixedWidth=void 0,t.adaptiveCardMessageFixedWidth=240,t.addInsButtonWidth=44,t.headerTextHeight=18,t.maxStreamContentWidth=960,t.messageBorderRadius=10,t.messageStreamOverflowWidth=50,t.messageStreamMaxContentWidth=t.maxStreamContentWidth+2*t.messageStreamOverflowWidth,t.messageTextLineHeight=22,t.streamItemOptionsMenuHeight=30,t.streamItemOptionsMenuWidth=50,t.streamItemOptionsMenuWidthInDesktopSubview=32,t.newsChannelMediaCardMaxWidth=500,t.newsDigestArticleImageSize=46,t.swiftCardHorizontalMargin=9,t.newsDigestArticleContentLeftMargin=12,function(e){e[e.Smaller=1]="Smaller",e[e.Small=2]="Small",e[e.Normal=3]="Normal",e[e.Large=4]="Large",e[e.Larger=5]="Larger"}(s||(t.MessageStreamFontSize=s={}))},203705:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.DataMessageContentType=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.TranslationSettings=1]="TranslationSettings",e[e.TwinCamSync=2]="TwinCamSync"}(s||(t.DataMessageContentType=s={}))},113002:(e,t)=>{var s,i,o,n,r,a,l;Object.defineProperty(t,"__esModule",{value:!0}),t.ModalNavigatorPrefix=t.SplitViewDefaultWindowDimensions=t.NavigationSettingsItem=t.NavigationSettingsOrigin=t.ContactsPanelV2=t.WizardSteps=t.SharePreviewType=t.CompositeNavigationType=t.TriggerKeys=void 0,function(e){e[e.NavigationAndTabs=1]="NavigationAndTabs",e[e.HubTab=2]="HubTab",e[e.RejoinCallOperation=3]="RejoinCallOperation",e[e.ModalNavigation=4]="ModalNavigation",e[e.DesktopSidebar=5]="DesktopSidebar",e[e.ReactNavigation=6]="ReactNavigation"}(s||(t.TriggerKeys=s={})),function(e){e[e.Default=0]="Default",e[e.MainContent=1]="MainContent",e[e.LeftSidebar=2]="LeftSidebar",e[e.RightSidebar=3]="RightSidebar",e[e.Modal=4]="Modal"}(i||(t.CompositeNavigationType=i={})),function(e){e[e.Photo=0]="Photo",e[e.Video=1]="Video",e[e.MixedVideoAndPhoto=2]="MixedVideoAndPhoto",e[e.Text=3]="Text",e[e.File=4]="File",e[e.MultipleMessages=5]="MultipleMessages",e[e.SwiftCards=6]="SwiftCards",e[e.Location=7]="Location",e[e.Audio=8]="Audio",e[e.AudioMessage=9]="AudioMessage",e[e.Contact=10]="Contact"}(o||(t.SharePreviewType=o={})),function(e){e[e.setConvInfo=0]="setConvInfo",e[e.setConvParticipants=1]="setConvParticipants"}(n||(t.WizardSteps=n={})),function(e){e[e.Skype=0]="Skype",e[e.All=1]="All"}(r||(t.ContactsPanelV2=r={})),function(e){e[e.ApplicationMenu=0]="ApplicationMenu",e[e.ApplicationSettings=1]="ApplicationSettings",e[e.DesktopOverflowMenu=2]="DesktopOverflowMenu",e[e.HelpAndFeedbackMenu=3]="HelpAndFeedbackMenu",e[e.MySettingsPanel=4]="MySettingsPanel",e[e.NotificationsPanel=5]="NotificationsPanel",e[e.LandingScreen=6]="LandingScreen",e[e.KeyboardShortcut=7]="KeyboardShortcut",e[e.WebFooter=8]="WebFooter",e[e.AppRatingDialog=9]="AppRatingDialog"}(a||(t.NavigationSettingsOrigin=a={})),function(e){e[e.BrowseKnownIssues=0]="BrowseKnownIssues",e[e.GetHelp=1]="GetHelp",e[e.GoToSupport=2]="GoToSupport",e[e.HelpAndFeedback=3]="HelpAndFeedback",e[e.RateUs=4]="RateUs",e[e.ReportAProblem=5]="ReportAProblem",e[e.SendFeedback=6]="SendFeedback",e[e.SkypeStatus=7]="SkypeStatus",e[e.UserVoice=8]="UserVoice",e[e.CheckAccount=9]="CheckAccount",e[e.AccountReadMore=10]="AccountReadMore"}(l||(t.NavigationSettingsItem=l={})),t.SplitViewDefaultWindowDimensions={width:460,height:600,x:void 0,y:void 0},t.ModalNavigatorPrefix="modal_"},395617:(e,t)=>{var s,i,o,n;Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationPeriodsCommands=t.MessageNotificationActionResult=t.MessageNotificationType=t.MessageNotificationNotifyReason=t.MessageNotificationAction=void 0,function(e){e[e.InterruptUser=0]="InterruptUser",e[e.InformUserExternal=1]="InformUserExternal",e[e.Ignore=2]="Ignore"}(s||(t.MessageNotificationAction=s={})),function(e){e[e.NotifySilent=0]="NotifySilent",e[e.AlwaysRing=1]="AlwaysRing",e[e.PreviousMessageIsOld=2]="PreviousMessageIsOld",e[e.ScheduledCall=3]="ScheduledCall"}(i||(t.MessageNotificationNotifyReason=i={})),function(e){e[e.Quote=0]="Quote",e[e.Mention=1]="Mention",e[e.RegularMessage=2]="RegularMessage",e[e.SystemAlert=3]="SystemAlert",e[e.Reaction=4]="Reaction",e[e.AddToConversation=5]="AddToConversation",e[e.ScheduledCall=6]="ScheduledCall"}(o||(t.MessageNotificationType=o={}));t.MessageNotificationActionResult=class{},function(e){e.oneHourPeriod="oneHour",e.eightHoursPeriod="eightHours",e.oneDayPeriod="oneDay",e.oneWeekPeriod="oneWeek",e.indefinitelyPeriod="indefinitely"}(n||(t.NotificationPeriodsCommands=n={}))},859993:(e,t)=>{var s,i,o,n;Object.defineProperty(t,"__esModule",{value:!0}),t.EmailMissedRemindersOptionValue=t.OptionServiceOptions=t.ProfileInformedUserOptionName=t.AvatarPolicyOptionName=t.SkypeGraphSearchPolicy=t.OptionsServiceAvatarPolicyValueType=t.CallingOptionValues=t.VoicemailOptionName=t.CallForwardingOptionName=t.UiColorOptionName=void 0,t.UiColorOptionName="ui.color",t.CallForwardingOptionName="calling.call-forwarding",t.VoicemailOptionName="calling.voice-mail",t.CallingOptionValues={Disabled:"disable",Enabled:"enabled"},function(e){e.BUDDIES_OR_AUTHORIZED_CAN_SEE="BUDDIES_OR_AUTHORIZED_CAN_SEE",e.OBSOLETE_BUDDIES_CAN_SEE="BUDDIES_OR_AUTHORIZED_CAN_SEE",e.EVERYONE_CAN_SEE="EVERYONE_CAN_SEE"}(s||(t.OptionsServiceAvatarPolicyValueType=s={})),function(e){e.SEARCHABLE="SEARCHABLE",e.NOT_SEARCHABLE="NOT_SEARCHABLE",e.NOT_SEARCHABLE_RECOMMENDABLE="NOT_SEARCHABLE_RECOMMENDABLE",e.SEARCHABLE_NOT_RECOMMENDABLE="SEARCHABLE_NOT_RECOMMENDABLE",e.NOT_SEARCHABLE_NOT_RECOMMENDABLE="NOT_SEARCHABLE_NOT_RECOMMENDABLE"}(i||(t.SkypeGraphSearchPolicy=i={})),t.AvatarPolicyOptionName="profile.show-avatar-policy",t.ProfileInformedUserOptionName="profile.informed-user",function(e){e.EmailMissedCallReminders="reminders.missed-call.email",e.EmailMissedMessageReminders="reminders.missed-message.email"}(o||(t.OptionServiceOptions=o={})),function(e){e.Enabled="ENABLED",e.Disabled="DISABLED"}(n||(t.EmailMissedRemindersOptionValue=n={}))},822701:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PostingTrigger=t.PostUploadInfoKind=t.PostMessageInfoKind=void 0,t.PostMessageInfoKind="postMessage",t.PostUploadInfoKind="postUpload",function(e){e[e.None=1]="None",e[e.BackgroundTask=2]="BackgroundTask",e[e.Push=3]="Push"}(s||(t.PostingTrigger=s={}))},136464:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.PrefetchMode=void 0,function(e){e.On="On",e.Off="Off",e.Wifi="Wifi"}(s||(t.PrefetchMode=s={}))},485692:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.FormatterTypes=void 0,function(e){e.Italic="_",e.Bold="*",e.StrikeThrough="~",e.Code="```",e.Link="</>"}(s||(t.FormatterTypes=s={}))},120880:(e,t)=>{var s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.SkypeSmsErrorCategory=t.SkypeSmsDeliveryStatus=void 0,function(e){e[e.Success=6]="Success",e[e.Expired=7]="Expired",e[e.Failed=8]="Failed",e[e.InsufficientFunds=9]="InsufficientFunds",e[e.Rejected=16]="Rejected"}(s||(t.SkypeSmsDeliveryStatus=s={})),function(e){e[e.NoError=0]="NoError",e[e.MiscError=1]="MiscError",e[e.ServerConnectFailed=2]="ServerConnectFailed",e[e.InsufficientFunds=4]="InsufficientFunds",e[e.UserBlocked=6]="UserBlocked",e[e.RecipientBlocked=10]="RecipientBlocked",e[e.SenderBlockedByRecipient=11]="SenderBlockedByRecipient",e[e.SmsVelocityReached=13]="SmsVelocityReached",e[e.NoDeliveryReport=16]="NoDeliveryReport",e[e.BrokenDeliveryReport=17]="BrokenDeliveryReport",e[e.InvalidSourceAddress=100]="InvalidSourceAddress",e[e.InvalidDestinationAddress=101]="InvalidDestinationAddress",e[e.DestinationNotSupported=102]="DestinationNotSupported",e[e.NumberDoesNotExist=103]="NumberDoesNotExist",e[e.NumberBlocked=104]="NumberBlocked",e[e.NumberUnreachable=105]="NumberUnreachable",e[e.MessageExpiredAtOperator=200]="MessageExpiredAtOperator",e[e.MessageExpiredAtBackend=201]="MessageExpiredAtBackend",e[e.OperatorMiscError=202]="OperatorMiscError",e[e.TransientServiceError=300]="TransientServiceError",e[e.PermanentServiceError=301]="PermanentServiceError",e[e.SmsInfraInternalError=303]="SmsInfraInternalError"}(i||(t.SkypeSmsErrorCategory=i={}))},206467:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.CommandTypes=void 0,function(e){e[e.SearchSelection=0]="SearchSelection",e[e.EditScheduledCall=1]="EditScheduledCall",e[e.Edit=2]="Edit",e[e.Copy=3]="Copy",e[e.CopyImage=4]="CopyImage",e[e.CopyLink=5]="CopyLink",e[e.CopyLocation=6]="CopyLocation",e[e.Quote=7]="Quote",e[e.QuoteSelection=8]="QuoteSelection",e[e.QuoteFromSwipe=9]="QuoteFromSwipe",e[e.WebSearch=10]="WebSearch",e[e.Announce=11]="Announce",e[e.RemoveAnnouncement=12]="RemoveAnnouncement",e[e.SaveMedia=13]="SaveMedia",e[e.SaveAsFile=14]="SaveAsFile",e[e.SaveAsMedia=15]="SaveAsMedia",e[e.OpenFileLocation=16]="OpenFileLocation",e[e.OpenMediaLocation=17]="OpenMediaLocation",e[e.Forward=18]="Forward",e[e.Translate=19]="Translate",e[e.TranslateOne=20]="TranslateOne",e[e.Bookmark=21]="Bookmark",e[e.AddReaction=22]="AddReaction",e[e.ViewInChat=23]="ViewInChat",e[e.SelectMessages=24]="SelectMessages",e[e.MarkReadToHere=25]="MarkReadToHere",e[e.CancelSend=26]="CancelSend",e[e.CancelEdit=27]="CancelEdit",e[e.CancelFailedSend=28]="CancelFailedSend",e[e.RetryFailedSend=29]="RetryFailedSend",e[e.ViewLink=30]="ViewLink",e[e.Remove=31]="Remove",e[e.Report=32]="Report",e[e.CancelScheduledCall=33]="CancelScheduledCall",e[e.ShowReported=34]="ShowReported",e[e.CancelPoll=35]="CancelPoll",e[e.DebugDumpMessage=36]="DebugDumpMessage",e[e.DebugDumpMessagePretty=37]="DebugDumpMessagePretty",e[e.CreateImage=38]="CreateImage"}(s||(t.CommandTypes=s={}))},137395:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValidSMSMessageFromSkype=t.ValidPSTNMriRegExp=t.ValidPresenceResourceRegExp=t.ValidSkypeIdRegExp=t.ValidMriRegExp=void 0,t.ValidMriRegExp=/^[0-9][0-9]?:[^<>\*\{\}&'\"\/\\?^`|~\s]+$/,t.ValidSkypeIdRegExp=/^[^<>\*\{\}&'\"\/\\?^`|~\s]+$/,t.ValidPresenceResourceRegExp=/^[a-zA-Z0-9_\-\.\+:,@=;]+$/,t.ValidPSTNMriRegExp=/^4:[^<>\*\{\}&'\"\/\\?^`|~]+$/,t.ValidSMSMessageFromSkype=/<skype>(.+?)<\/skype>/},135356:(e,t)=>{var s,i,o,n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultConversationType=t.UserRingChangedManually=t.UserRing=t.EndpointExpirationWorkaroundResource=t.PnhResourcesToTrack=t.PrimaryResourcesToTrack=t.MessagesStaleReason=t.ThreadMemberRoles=t.EmptyReactionsUpdate=t.LongPollResult=t.SubscriptionState=void 0,function(e){e[e.Creating=0]="Creating",e[e.CreatedActive=1]="CreatedActive",e[e.CreatedLongPollTrouble=2]="CreatedLongPollTrouble",e[e.Deleting=3]="Deleting",e[e.None=4]="None"}(s||(t.SubscriptionState=s={})),function(e){e[e.Success=0]="Success",e[e.FailureErrorCode=1]="FailureErrorCode",e[e.FailureExternal=2]="FailureExternal"}(i||(t.LongPollResult=i={})),t.EmptyReactionsUpdate={added:[],removed:[]},t.ThreadMemberRoles={Admin:"Admin",User:"User"},function(e){e[e.NeedSync=0]="NeedSync",e[e.HistoryDisclosedChanged=1]="HistoryDisclosedChanged",e[e.ReceivedUnreconciledEdit=2]="ReceivedUnreconciledEdit",e[e.ConversationPossiblyUnread=3]="ConversationPossiblyUnread"}(o||(t.MessagesStaleReason=o={})),t.PrimaryResourcesToTrack=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL"],t.PnhResourcesToTrack=["/v1/users/ME/conversations/ALL/messages","/v1/users/ME/conversations/ALL/properties?view=consumptionHorizon"],t.EndpointExpirationWorkaroundResource="/v1/users/ME/contacts/8:_endpoint_expiration_workaround_",function(e){e[e.PROD=0]="PROD",e[e.DailyDF=1]="DailyDF",e[e.MasterDF=2]="MasterDF"}(n||(t.UserRing=n={})),t.UserRingChangedManually="true2",function(e){e[e.None=0]="None",e[e.Passport=1]="Passport",e[e.Lync=2]="Lync",e[e.Skype=4]="Skype",e[e.Room=8]="Room",e[e.Thread=16]="Thread",e[e.ShortCircuit=32]="ShortCircuit",e[e.PSTN=64]="PSTN",e[e.Facebook=128]="Facebook",e[e.GTalk=256]="GTalk",e[e.Flxt=512]="Flxt",e[e.SmsMms=1024]="SmsMms",e[e.Agent=2048]="Agent",e[e.NotificationStream=4096]="NotificationStream",e[e.Cast=8192]="Cast",e[e.InviteFree=16384]="InviteFree",e[e.Highlights=32768]="Highlights",e[e.ModernBots=131072]="ModernBots",e[e.OneToOneThreads=262144]="OneToOneThreads",e[e.SecureThreads=524288]="SecureThreads",e[e.PhoneThreads=1048576]="PhoneThreads",e[e.Default=1023]="Default",e[e.All=2047]="All"}(r||(r={})),t.DefaultConversationType=r.All},627414:(e,t)=>{var s,i,o,n,r,a,l,d;Object.defineProperty(t,"__esModule",{value:!0}),t.InvokeAgentSource=t.AddNewContactSource=t.BlockConversationSource=t.DeleteConversationSource=t.RemoveMemberFromThreadSource=t.AddMemberToThreadSource=t.CreateThreadSource=t.PostMessageToConversationSource=void 0,function(e){e[e.UserComposingState=0]="UserComposingState",e[e.MessagePost=1]="MessagePost"}(s||(t.PostMessageToConversationSource=s={})),function(e){e[e.CreateNewConversation=0]="CreateNewConversation",e[e.EscalateOneOnOneToGroupCall=1]="EscalateOneOnOneToGroupCall",e[e.ReactionThread=2]="ReactionThread",e[e.StartNewGroupCall=3]="StartNewGroupCall",e[e.CreateAadConversation=4]="CreateAadConversation",e[e.CreateP2PChat=5]="CreateP2PChat"}(i||(t.CreateThreadSource=i={})),function(e){e[e.AddUserToGroupCall=0]="AddUserToGroupCall",e[e.AddUserToGroupCallDragAndDrop=1]="AddUserToGroupCallDragAndDrop",e[e.InviteUsersWorkflowStore=2]="InviteUsersWorkflowStore",e[e.JoiningConversation=3]="JoiningConversation",e[e.SetRoleCommand=4]="SetRoleCommand",e[e.SwiftCard=5]="SwiftCard",e[e.BotAutoAdd=6]="BotAutoAdd"}(o||(t.AddMemberToThreadSource=o={})),function(e){e[e.ConversationListItem=0]="ConversationListItem",e[e.GroupChatSettings=1]="GroupChatSettings",e[e.GroupProfile=2]="GroupProfile",e[e.KickCommand=3]="KickCommand",e[e.LeaveCommand=4]="LeaveCommand",e[e.SkypeUserListItem=5]="SkypeUserListItem",e[e.LobbyButton=6]="LobbyButton"}(n||(t.RemoveMemberFromThreadSource=n={})),function(e){e[e.BotChatSettingsPanel=0]="BotChatSettingsPanel",e[e.ConversationListItem=1]="ConversationListItem",e[e.UserChatSettingsPanel=2]="UserChatSettingsPanel",e[e.TabSwitcher=3]="TabSwitcher",e[e.CellularRelayAgent=4]="CellularRelayAgent"}(r||(t.DeleteConversationSource=r={})),function(e){e[e.BotChatSettingsPanel=0]="BotChatSettingsPanel",e[e.ConversationListItem=1]="ConversationListItem",e[e.BlockedUsersListPanel=2]="BlockedUsersListPanel"}(a||(t.BlockConversationSource=a={})),function(e){e[e.AcceptContactInvite=0]="AcceptContactInvite",e[e.AddContact=1]="AddContact"}(l||(t.AddNewContactSource=l={})),function(e){e[e.SwiftQuickReply=0]="SwiftQuickReply",e[e.PermanentMenuRequest=1]="PermanentMenuRequest"}(d||(t.InvokeAgentSource=d={}))},993277:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationCommands=void 0,t.ConversationCommands={Unfavorite:"unfavorite",Favorite:"favorite",Unblock:"unblock",BlockContact:"block",Call:"call",AudioCall:"audioCall",ClearConversation:"clearConversation",DeleteConversation:"deleteConversation",DeleteBotFromContacts:"deleteBotFromContacts",AddBotToContacts:"addBotToContacts",LeaveConversation:"leave",MarkRead:"markRead",MarkUnread:"markUnread",Profile:"profile",ManageGroup:"settings",Archive:"archive",Unarchive:"unarchive",Mute:"mute",Unmute:"unmute",More:"more",CopyLink:"copyLink",MagicBotPin:"magicBotPin",MagicBotUnpin:"magicBotUnpin"}},904927:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},799296:(e,t)=>{var s;Object.defineProperty(t,"__esModule",{value:!0}),t.ConversationListItemNames=t.ConversationsListMode=void 0,function(e){e[e.AllConversations=0]="AllConversations",e[e.ArchivedConversations=1]="ArchivedConversations"}(s||(t.ConversationsListMode=s={})),t.ConversationListItemNames={searchBar:"clp_searchBar",header:"clp_header_",oneOnOneConv:"clp_1:1",groupChat:"clp_groupChat",topSpacer:"clp_topSpacer",itemSpacer:"clp_itemSpacer",bottomSpacer:"clp_bottomSpacer",notificationsPrompt:"clp_notificationsPrompt",emptyState:"clp_emptyState",finishSetupPrompt:"clp_finishSetupPrompt",nativeAd:"clp_nativeAd",loadingIndicator:"clp_loadingIndicator",engagementBanner:"clp_engagementBanner",conversationsListBanner:"clp_conversationsListBanner",divider:"clp_divider_",seeMore:"clp_see_more",contentChannel:"clp_contentChannel",upsellChannel:"clp_upsellChannel",upsellCard:"clp_upsellCard"}},74939:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contextTagName=void 0,t.contextTagName="context"},242561:(e,t)=>{var s,i,o,n,r,a,l;Object.defineProperty(t,"__esModule",{value:!0}),t.MediaAlbumItemPositionStyleAttributes=t.MediaAlbumItemIndex=t.MediaAlbumItemCount=t.PipContentType=t.SwiftMediaProfiles=t.SwiftAspectRatios=t.SwiftSuggestionProviders=t.SwiftSuggestionTypes=t.SwiftInvokeActionIntents=t.SwiftActionTypes=t.SwiftContentTypes=t.SwiftMessageTypes=t.multiTargetsTagName=t.targetTagName=t.rootTagName=t.MessageRenderOrigin=t.ProcessingDefaults=t.MediaProvider=t.MessageAccessibilityType=t.ProcessingLevel=void 0,function(e){e[e.None=0]="None",e[e.Full=1]="Full",e[e.Stripped=2]="Stripped"}(s||(t.ProcessingLevel=s={})),function(e){e[e.Text=0]="Text",e[e.Media=1]="Media",e[e.Url=2]="Url",e[e.Call=3]="Call"}(i||(t.MessageAccessibilityType=i={})),t.MediaProvider={AMS:"AMS",AzureMS:"AzureMS",FileCache:"FileCache",Preview:"Preview",Capture:"Capture"},t.ProcessingDefaults={All:{emoticons:s.Full,quotes:s.Full,wikiMarkup:s.Full,links:s.Full,atMentions:s.Full},Stripped:{emoticons:s.Stripped,quotes:s.Stripped,wikiMarkup:s.Stripped,links:s.Stripped,atMentions:s.Stripped},Preview:{emoticons:s.Full,quotes:s.None,wikiMarkup:s.Stripped,links:s.Stripped,atMentions:s.Stripped}},function(e){e[e.ChatCanvas=0]="ChatCanvas",e[e.StackGalleryCanvas=1]="StackGalleryCanvas",e[e.CompositeGalleryCanvas=2]="CompositeGalleryCanvas",e[e.CallCanvas=3]="CallCanvas",e[e.ForwardCanvas=4]="ForwardCanvas",e[e.MessageComposerCanvas=5]="MessageComposerCanvas",e[e.MessageComposerPreviewCanvas=6]="MessageComposerPreviewCanvas"}(o||(t.MessageRenderOrigin=o={})),t.rootTagName="_root",t.targetTagName="target",t.multiTargetsTagName="targets",t.SwiftMessageTypes={card:"message/card",carousel:"message/card.carousel",signin:"message/card.signin",receipt:"message/card.receipt"},t.SwiftContentTypes={hero:"application/vnd.microsoft.card.hero",flex:"application/vnd.microsoft.card.flex",thumbnail:"application/vnd.microsoft.card.thumbnail",animation:"application/vnd.microsoft.card.animation",audio:"application/vnd.microsoft.card.audio",video:"application/vnd.microsoft.card.video",signin:"application/vnd.microsoft.card.signin",receipt:"application/vnd.microsoft.card.receipt",unsupported:"application/vnd.microsoft.card.unsupported"},t.SwiftActionTypes={openUrl:"openUrl",imBack:"imBack",call:"call",signin:"signin",showImage:"showImage",showVideo:"showVideo",learnMore:"learnMore",invoke:"invoke",openView:"openView",reportAProblem:"reportAProblem",playGif:"playGif"},t.SwiftInvokeActionIntents={luSuggestionDisplay:"lu_suggestion_display",cardsDisplay:"card_display",reminderStartFlow:"reminder_start_flow",reminderSet:"reminder_set",startOptIn:"start_opt_in",calendarSchedule:"calendar_schedule_reply",calendarAvailability:"calendar_availability_reply",instrumentation:"instrumentation"},t.SwiftSuggestionTypes={Default:"Default",Static:"Static"},t.SwiftSuggestionProviders={Dorado:"dorado",Skype:"skype"},t.SwiftAspectRatios={landscape:"16:9",portrait:"9:16",square:"1:1"},t.SwiftMediaProfiles={animation:"animation",audio:"audio",sd:"sd",hd:"hd",video:"video"},function(e){e[e.Youtube=0]="Youtube"}(n||(t.PipContentType=n={})),function(e){e[e.one=1]="one",e[e.two=2]="two",e[e.three=3]="three",e[e.four=4]="four",e[e.more=5]="more"}(r||(t.MediaAlbumItemCount=r={})),function(e){e[e.first=0]="first",e[e.second=1]="second",e[e.third=2]="third",e[e.fourth=3]="fourth"}(a||(t.MediaAlbumItemIndex=a={})),function(e){e.oneItem="oneItem",e.desktopLeftTopOfTwoItems="desktopLeftTopOfTwoItems",e.desktopRightBottomOfTwoItems="desktopRightBottomOfTwoItems",e.mobileLeftTopOfTwoItems="mobileLeftTopOfTwoItems",e.mobileRightBottomOfTwoItems="mobileRightBottomOfTwoItems",e.desktopTopLeftOfThreeItems="desktopTopLeftOfThreeItems",e.desktopMiddleOfThreeItems="desktopMiddleOfThreeItems",e.desktopRightBottomOfThreeItems="desktopRightBottomOfThreeItems",e.mobileTopLeftOfThreeItems="mobileTopLeftOfThreeItems",e.mobileMiddleOfThreeItems="mobileMiddleOfThreeItems",e.mobileRightBottomOfThreeItems="mobileRightBottomOfThreeItems",e.desktopTopLeftOfFourItems="desktopTopLeftOfFourItems",e.desktopMiddleLeftOfFourItems="desktopMiddleLeftOfFourItems",e.desktopMiddleRightOfFourItems="desktopMiddleRightOfFourItems",e.desktopRightBottomOfFourItems="desktopRightBottomOfFourItems",e.mobileTopLeftOfFourItems="mobileTopLeftOfFourItems",e.mobileMiddleLeftOfFourItems="mobileMiddleLeftOfFourItems",e.mobileMiddleRightOfFourItems="mobileMiddleRightOfFourItems",e.mobileRightBottomOfFourItems="mobileRightBottomOfFourItems"}(l||(t.MediaAlbumItemPositionStyleAttributes=l={}))},491839:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582);i.__exportStar(s(799296),t),i.__exportStar(s(904927),t),i.__exportStar(s(289054),t),i.__exportStar(s(632964),t)},74213:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(192478),a=s(385855),l=s(375258),d=s(26703),c=i.__importStar(s(704704)),u=i.__importDefault(s(566153)),h=i.__importDefault(s(710427)),p=i.__importDefault(s(615364)),g=i.__importDefault(s(740794)),m=s(491839),S=(0,d.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1})});class _ extends r.BaseNavigationView{constructor(){super(...arguments),this._onCloseButtonPressed=e=>{e.stopPropagation(),this._close()}}_buildState(){return{archivedConversationsCount:(0,p.default)().getSortedArchivedConversations().length}}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.archivedConversationsCount<1&&this._close()}_close(){this._isPresentedInTabletLeftNav()?h.default.setConversationsListMode(m.ConversationsListMode.AllConversations):g.default.navigateToRecentsTab()}render(){const e={closeButtonType:this._isPresentedInTabletLeftNav()?l.CloseButtonType.Back:l.CloseButtonType.Close,onPress:this._onCloseButtonPressed},t=this.props.navigation?void 0:(0,o.jsx)(l.SimplePanelHeader,{panelName:c.getString("ArchivedConversationsPanel.Title"),leftButton:e});return(0,o.jsxs)(n.View,{style:[S.panel,this._getContext().themeStyles.primaryBackgroundColorStyle],children:[t,(0,o.jsx)(u.default,{topInset:a.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT,useMobileView:!0,hideSearchBar:!0,isScrollToTopTarget:!0,viewType:m.ConversationsListMode.ArchivedConversations})]})}}t.default=_},650312:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(496486),r=s(331654),a=i.__importStar(s(516778)),l=i.__importDefault(s(206483)),d=i.__importDefault(s(150343)),c=s(808467),u=s(284841),h=i.__importStar(s(44717)),p=i.__importDefault(s(721657)),g=i.__importDefault(s(633958)),m=s(154235),S=i.__importDefault(s(615364)),_=i.__importDefault(s(601976)),f=s(815146),y=s(932836),v=i.__importStar(s(85385)),C=i.__importDefault(s(402447)),T=i.__importStar(s(209674)),M=s(26703),b=i.__importDefault(s(969004)),I=i.__importStar(s(704704)),w=i.__importDefault(s(363091)),P=i.__importDefault(s(740794)),k=i.__importDefault(s(942724)),A=s(113002),x=i.__importStar(s(511592)),D=i.__importDefault(s(569817)),R=i.__importDefault(s(244466)),L=i.__importDefault(s(960282)),B=i.__importDefault(s(117475)),F=i.__importDefault(s(377556)),N=i.__importDefault(s(421334)),E=i.__importDefault(s(283385)),O=s(376229),U=s(240804),V=i.__importDefault(s(657764)),H=i.__importDefault(s(268505)),j=i.__importDefault(s(817672)),z=s(375258),W=s(928722),G=i.__importDefault(s(827361)),K=i.__importDefault(s(685734)),q=i.__importDefault(s(760989)),Q=i.__importDefault(s(139825)),X=i.__importStar(s(972830)),$=s(844086),J=s(503308),Y=(0,M.lazyProperties)({panel:()=>a.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,alignSelf:"stretch"}),contentContainerInner:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",flexDirection:"column"}),participantsInputFrame:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),participantsInputContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"column"}),suggestionsContainer:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch",flexDirection:"row",justifyContent:"center"}),headerShadow:()=>a.Styles.createViewStyle({position:"absolute",left:0,right:0,top:0,height:1}),searchBoxContainerCompositeNav:()=>a.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:O.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1})});class Z extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._isScrolledToTop=!0,this._shadowOpacityValue=new a.Animated.Value(0),this._shadowOpacityStyle=a.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._resetTransitionTransformValue=new a.Animated.Value(0),this._resetTransitionOpacityValue=new a.Animated.Value(1),this._resetSearchTransitionStyle=a.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._onInputChanged=e=>{this.isComponentMounted()&&this.setState({inputText:e})},this._goBack=e=>{var t;v.log(f.LogTraceArea.Navigation,"SetConversationParticipantsPanel._goBack, causeId: "+e);const s=this._getInvitedUserMris();return null===(t=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===t||t.setParticipantCount(s.length),this.props.route.params.navigator.extendContext({invitedUsersMris:s}),this.props.route.params.navigator.goBack(),!0},this._onShareLinkToggleChange=e=>{this.setState({shareLink:e})},this._onInviteSuggestionsListRef=e=>{this._inviteSuggestionsListRef=e||void 0},this._onProfileSelectionInputRef=e=>{this._profileSelectionInputRef=e||void 0},this._renderSuperComposerHeader=(e,t)=>{const s=e?F.default.horizontalPaddingStyle(e):void 0;let i=(0,o.jsx)(E.default,{buttonOnly:!0,horizontalButtonPadding:0,placeholderText:this.state.isUsingStackNavigationContext?I.getString("SearchInputControl.PlaceHolderTextShort"):I.getString("ConversationsListPanel.SearchPeopleGroupsMessagesButtonTitle"),accessibilityLabel:this.state.isMobileScreenReaderEnabled?I.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,useIOSStyles:!this.state.isUsingStackNavigationContext&&this.state.useIOSSearchStyles,secondaryBackground:!0,safeAreaPaddingStyle:s,showSearchIcon:this._getContext().isPresentedInGenericDesktopModal,onPress:this._handleSuperComposerSearchButtonClick},"search");if(this._getContext().isPresentedInDesktopSubview){const{searchBoxColorStyle:e}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);i=(0,o.jsx)(a.View,{style:[Y.searchBoxContainerCompositeNav,e],children:i})}if(e&&t){const t=a.Styles.createViewStyle({marginLeft:-1*e.left,marginRight:-1*e.right},!1);i=(0,o.jsx)(a.View,{style:t,children:i})}const n=a.Styles.createViewStyle({height:D.default.calculateHeight(this._newChatMenuCommands.length)},!1);return(0,o.jsxs)(a.View,{style:[G.default.overflowVisible],children:[i,(0,o.jsx)(a.View,{style:n,children:(0,o.jsx)(D.default,{commands:this._newChatMenuCommands})})]})},this._handleSuperComposerSearchButtonClick=()=>{const e=q.default.newCauseId();v.log(f.LogTraceArea.Navigation,"SetConversationParticipantsPanel._handleSuperComposerSearchButtonClick, causeId: "+e),v.track(new J.PressAction(J.PressScenario.SearchNavigation,f.SearchPanelInitiator.SuperComposer)),this._getContext().isPresentedInDesktopSubview?P.default.navigateToSearchInModal({searchOrigin:f.SearchPanelInitiator.SuperComposer,modalTitle:this._getHeaderText(this.state)},e,this._getContext()):P.default.navigateToSearch({searchOrigin:f.SearchPanelInitiator.SuperComposer},e)},this._onContentWrapperRef=e=>{this._wrappedContentTransitionView=e||void 0},this._getHeader=()=>(0,o.jsx)(z.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderLeftButton(),hideBottomBorder:!0,delayHeaderFocus:!1}),this._getHeaderRightButton=()=>{if(!this.props.route.params.navigator.context.creating1on1Conversation){return{text:(0,n.last)(this.props.route.params.navigator.context.wizardSteps)===A.WizardSteps.setConvParticipants?I.getString("SetConversationParticipantsPanel.DoneButtonLabel"):I.getString("Global.NextButtonTitle"),disabled:this.props.route.params.navigator.context.convId&&this.state.numberOfInvitees<1,onPress:this._handleNextButtonClick}}},this._onScroll=(e,t)=>{const s=e<=0;this._isScrolledToTop!==s&&(this._shadowOpacityValue.setValue(s?0:1),this._isScrolledToTop=s)},this._onProfileRemoved=()=>{this._inviteSuggestionsListRef?this._inviteSuggestionsListRef.focusFirst():this._profileSelectionInputRef&&this._profileSelectionInputRef.requestFocus()},this._handleBackButtonClick=()=>{const e=q.default.newCauseId();v.log(f.LogTraceArea.Navigation,"SetConversationParticipantsPanel._handleBackButtonClick,  causeId: "+e),this._goBack(e)},this._handleNextButtonClick=()=>{if(!this.state.navButtonsDisabled)if(this.state.panelSearchType===f.SearchResultsListOrigin.NewCellularSmsConversation)this._getInvitedUsersPhoneNumbersAsMris().then((e=>{this._completeNextButtonClick(e)}));else{const e=this._getInvitedUserMris();this._completeNextButtonClick(e)}},this._headerHeight=()=>(this.state.deviceOrientation!==r.DeviceOrientation.Landscape?this.state.isSmallDevice?z.HeaderHeightSmall:z.HeaderHeight:this.state.isSmallDevice?z.HeaderHeightLandscapeSmall:z.HeaderHeightLandscape)+this.state.statusBarPadding}_buildState(e,t){var s;const i=e.route.params.navigator.context.convId&&(0,S.default)().getConversation(e.route.params.navigator.context.convId),o=k.default.isUsingStackNavigationContext(),n=this._getPanelSearchType(e.route.params.navigator.context),r=this._getRootViewId(),a={statusBarPadding:this._getContext().isPresentedInDesktopSubview?0:B.default.statusBarPadding(),deviceOrientation:L.default.getDeviceOrientation(r),isSmallDevice:L.default.isSmallDevice(r),contentSizeMultiplier:Math.min(L.default.getContentSizeMultiplier(),m.MaxContentSizeMultiplier),excludeGroups:!0,excludeEncrypted:n===f.SearchResultsListOrigin.NewPrivateChat||n===f.SearchResultsListOrigin.NewCellularSmsConversation,excludeS4B:n===f.SearchResultsListOrigin.NewGroup||n===f.SearchResultsListOrigin.AddingParticipantsToGroup||n===f.SearchResultsListOrigin.NewPrivateChat,useIOSSearchStyles:!this._getContext().isPresentedInDesktopSubview&&p.default.shouldUseIOSSearchStyles(),panelSearchType:n,isUsingStackNavigationContext:o,isModeratedThread:!!i&&i.isModerated(),isMobileScreenReaderEnabled:N.default.isMobileScreenReaderEnabled(),enableNewConversationCreation:d.default.getS4LMessagingFeatures().enableNewConversationCreation};return t&&(this._inviteFlowController=new T.default,a.showLoadingMessage=!1,a.inputText="",a.shareLink=!1,this._searchController=new V.default,null===(s=e.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setVisitedParticipantPicker(),this._newChatMenuCommands=[y.HubCommands.NewMeetNowCommand,y.HubCommands.AddConversationGroupCommand,y.HubCommands.NewGroupCallCommand,...e.route.params.navigator.context.showModeratedGroupOption?[y.HubCommands.AddConversationModeratedGroupCommand]:[],y.HubCommands.AddConversationPrivateCommand,y.HubCommands.NewCellularSmsConversationCommand,...d.default.getS4LCaapFeatures().botDiscoveryEnabled?[y.HubCommands.AddBotCommand]:[]]),a.invitingState=this._inviteFlowController.getState(),a.numberOfInvitees=this._inviteFlowController.getSelectedProfiles().length,a}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight},this.props.route.params.isSuperComposer&&(this._transitionSubscriptionToken=x.default.transitionInfoEvent().subscribe((e=>{if(x.default.isSearchTransition()&&e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===x.RouteType.Search?e.fromRoute.index:e.toRoute.index;void 0!==t?this._setAnimatedValues(e.progress,t):this._clearAnimatedValues()}else this._clearAnimatedValues()})))}componentWillUnmount(){var e,t;super.componentWillUnmount(),null===(e=this._searchController)||void 0===e||e.destroy(),null===(t=this._transitionSubscriptionToken)||void 0===t||t.unsubscribe()}componentDidMount(){var e;super.componentDidMount(),null===(e=this.props.route.params.navigator.context.invitedUsersMris)||void 0===e||e.forEach((e=>{const t=_.default.getDisplayableProfile(e);t&&this._inviteFlowController.addProfile(t)}))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),[T.InvitingUsersState.FinishedSuccess,T.InvitingUsersState.FinishedFail].indexOf(this.state.invitingState)>=0&&(this.props.route.params.navigator.goNext(),this.state.invitingState===T.InvitingUsersState.FinishedFail&&l.default.showErrorAlert(I.getString("InviteUsersWorkflowStore.CannotAddUser"),m.MainRootViewId)),this._inviteFlowController.getSelectedProfiles().length>0&&this.props.route.params.navigator&&this.props.route.params.navigator.context.creating1on1Conversation&&this._handleNextButtonClick()}render(){const{primaryBackgroundColorStyle:e}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),t=[Y.panel,e];let s;if(this.state.showLoadingMessage){const e=this.props.route.params.navigator.context.convId?I.getString("SetConversationParticipantsPanel.AddingContactsToConversation"):I.getString("SetConversationParticipantsPanel.CreatingNewConversation");s=(0,o.jsx)(b.default,{message:e})}else s=this._getContentForSelectingPeople();return(0,o.jsx)(g.default,{goBack:this._goBack,children:(0,o.jsx)(Q.default,{ref:this._onContentWrapperRef,style:t,children:(0,o.jsx)($.KeyboardAvoidingView,{children:s})})})}_getPanelSearchType(e){return d.default.getS4LMessagingFeatures().enableNewConversationCreation&&e.navigationOrigin===f.NavigationConversationOrigin.Recents?f.SearchResultsListOrigin.NewChat:e.useSuperComposerFor1on1Conversation&&e.navigationOrigin===f.NavigationConversationOrigin.SuperComposer?f.SearchResultsListOrigin.SuperComposer:e.createCellularSmsConversation?f.SearchResultsListOrigin.NewCellularSmsConversation:e.creating1on1Conversation?e.navigationOrigin===f.NavigationConversationOrigin.NewPrivateChat?f.SearchResultsListOrigin.NewPrivateChat:f.SearchResultsListOrigin.NewChat:e.peopleType===U.PeopleType.Bots?f.SearchResultsListOrigin.FindBots:e.convId||e.navigationOrigin!==f.NavigationConversationOrigin.NewGroup&&e.navigationOrigin!==f.NavigationConversationOrigin.UserProfileNewGroupWithUser&&e.navigationOrigin!==f.NavigationConversationOrigin.KeyboardShortcutNewGroupWithUser?f.SearchResultsListOrigin.AddingParticipantsToGroup:f.SearchResultsListOrigin.NewGroup}_componentId(){return"SetConversationParticipantsPanel"}_getContentForSelectingPeople(){this._getContext().isPresentedInDesktopSubview;const e=(0,o.jsx)(C.default,{ref:this._onInviteSuggestionsListRef,conversationId:this.props.route.params.navigator.context.convId,inviteFlowController:this._inviteFlowController,searchController:this._searchController,peopleType:this.props.route.params.navigator.context.peopleType,filterPeopleType:this.props.route.params.navigator.context.filterPeopleType,excludeGroups:this.state.excludeGroups,excludeEncrypted:this.state.excludeEncrypted,excludeS4B:this.state.excludeS4B,isSingleContactSelect:!!this.props.route.params.navigator.context.isSingleContactSelect,navigationOrigin:this.props.route.params.navigator.context.navigationOrigin,parentPanelOrigin:this.state.panelSearchType,headerViewConfig:this._optionalSuperComposerHeaderConfig(),inputText:this.state.inputText,suppressPseudoFocus:!0,onScroll:this.props.route.params.isSuperComposer?this._onScroll:void 0}),t=[Y.contentContainerInner],s=[Y.suggestionsContainer],i=[Y.participantsInputContainer],n=this.props.route.params.isSuperComposer?void 0:(0,o.jsx)(R.default,{ref:this._onProfileSelectionInputRef,selectorController:this._inviteFlowController,searchController:this._searchController,headerConfig:this._headerConfig,allowSubmitWithNoProfile:!0,peopleType:this.props.route.params.navigator.context.peopleType,autoFocusOnInput:!a.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,useCollapsableHeader:!1,inputText:this.state.inputText,onInputChanged:this._onInputChanged,onCancel:this._handleBackButtonClick,onProfileRemoved:this._onProfileRemoved},"peopleInput"),r=this.props.route.params.navigator.context.navigationOrigin===f.NavigationConversationOrigin.Recents&&this.state.enableNewConversationCreation?(0,o.jsx)(H.default,{shareLink:this.state.shareLink,onChange:this._onShareLinkToggleChange}):void 0,l=this.props.route.params.isSuperComposer?this._getHeader():void 0,d=this._getFooter(),{headerShadowColorStyle:c}=X.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),u=l?(0,o.jsx)(a.Animated.View,{style:[Y.headerShadow,c,this._shadowOpacityStyle]}):void 0;return(0,o.jsx)(a.View,{style:G.default.flexOne,children:(0,o.jsx)(a.View,{style:t,children:(0,o.jsx)(a.View,{style:Y.participantsInputFrame,children:(0,o.jsxs)(a.View,{style:i,children:[n,l,(0,o.jsxs)(a.View,{style:s,children:[e,u]}),r,d]})})})})}_optionalSuperComposerHeaderConfig(){if(this.props.route.params.isSuperComposer)return{renderItem:this._renderSuperComposerHeader,isNavigable:!0,isHoverable:!1,height:D.default.calculateHeight(this._newChatMenuCommands.length)}}_getHeaderText(e){let t="";switch(e.panelSearchType){case f.SearchResultsListOrigin.NewChat:case f.SearchResultsListOrigin.SuperComposer:t=I.getString("SetConversationParticipantsPanel.NewChatTitle");break;case f.SearchResultsListOrigin.NewPrivateChat:t=I.getString("SetConversationParticipantsPanel.NewPrivateChatTitle");break;case f.SearchResultsListOrigin.FindBots:t=I.getString("SetConversationParticipantsPanel.FindBotTitle");break;case f.SearchResultsListOrigin.NewGroup:t=I.getString("SetConversationParticipantsPanel.CreateNewGroupTitle");break;case f.SearchResultsListOrigin.AddingParticipantsToGroup:t=I.getString("SetConversationParticipantsPanel.AddPeopleTitle");break;case f.SearchResultsListOrigin.NewCellularSmsConversation:t=I.getString("SetConversationParticipantsPanel.CreateNewCellularSmsConversation");break;default:q.default.switchStatementExhaustiveChecking(e.panelSearchType)}return t}_getFooter(){const e=this._getHeaderRightButton();if(e)return(0,o.jsx)(j.default,{button:e})}_getHeaderLeftButton(){var e;const t=(null===(e=this.props.route.params.navigator.context.wizardSteps)||void 0===e?void 0:e[0])===A.WizardSteps.setConvParticipants;let s=z.CloseButtonType.Back;return(this.props.route.params.navigationDirection===W.StackNavigationDirection.Present||this.props.route.params.navigator.context.creating1on1Conversation||!this.state.isUsingStackNavigationContext&&t)&&(s=z.CloseButtonType.Close),{closeButtonType:s,onPress:this._handleBackButtonClick}}_getInvitedUserMris(){const e=this._inviteFlowController.getSelectedProfiles(),t=(0,u.chain)(e,(0,u.map)((e=>e.getMri())),(0,u.filter)((e=>!!e&&!w.default.isMyMri(e))));return(0,n.compact)(t)}_getInvitedUsersPhoneNumbersAsMris(){const e=this._inviteFlowController.getSelectedProfiles(),t=[],s=[];return e.forEach((e=>{const i=e.getMri();i&&(h.isPhoneMri(i)||h.getMriNamespace(i)===h.Namespaces.OneToOneTextMessage?t.push(i):s.push(i))})),K.default.getFullUserProfileByMrisAsync(s).then((e=>(e.forEach((e=>{if(e&&e.phones&&e.phones.length>0){const s=h.idAndNamespaceToMri(e.phones[0].number.toString(),h.Namespaces.PSTN);t.push(s)}})),t)))}_completeNextButtonClick(e){var t,s,i;if(null===(t=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===t||t.setParticipantCount(e.length),null===(i=(s=this.props.route.params.navigator.context).onParticipantsAdded)||void 0===i||i.call(s,e.length),this.state.panelSearchType===f.SearchResultsListOrigin.NewCellularSmsConversation&&0===e.length)return;this.props.route.params.navigator.extendContext({invitedUsersMris:e});(0,n.last)(this.props.route.params.navigator.context.wizardSteps)===A.WizardSteps.setConvParticipants&&this.setState({showLoadingMessage:!0,navButtonsDisabled:!0}),this.props.route.params.navigator.context.convId?this._inviteFlowController.sendConversationInvitation(this.props.route.params.navigator.context.convId,!this.state.isModeratedThread||!!this.props.route.params.navigator.context.addAsAdmininModeratedGroup):(this.props.route.params.navigator.context.shareLink=this.state.shareLink,this.props.route.params.navigator.goNext())}_setAnimatedValues(e,t){if(this._wrappedContentTransitionView){const s=a.Styles.createAnimatedViewStyle({opacity:e.interpolate({inputRange:[t-1,t,t+.5,t+1],outputRange:[1,1,0,0]}),transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[0,0,-100]})}]});this._wrappedContentTransitionView.setAnimatedStyle(s)}}_clearAnimatedValues(){this._wrappedContentTransitionView&&this._wrappedContentTransitionView.setAnimatedStyle(this._resetSearchTransitionStyle)}}t.default=Z},670238:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(496486),a=i.__importDefault(s(165986)),l=i.__importDefault(s(187140)),d=i.__importDefault(s(428231)),c=s(808467),u=i.__importDefault(s(683236)),h=i.__importStar(s(473483)),p=i.__importDefault(s(633958)),g=s(154235),m=s(214189),S=i.__importStar(s(170881)),_=s(815146),f=i.__importStar(s(85385)),y=i.__importDefault(s(214295)),v=i.__importDefault(s(54945)),C=s(26703),T=i.__importDefault(s(969004)),M=i.__importStar(s(704704)),b=i.__importDefault(s(252089)),I=i.__importDefault(s(942724)),w=s(113002),P=i.__importDefault(s(625586)),k=i.__importDefault(s(960282)),A=i.__importDefault(s(117475)),x=i.__importDefault(s(377556)),D=i.__importDefault(s(791384)),R=s(375258),L=s(928722),B=s(16549),F=i.__importDefault(s(20758)),N=s(641400),E=i.__importStar(s(179582)),O=i.__importDefault(s(760989)),U=i.__importStar(s(972830)),V=s(844086),H=(0,C.lazyProperties)({panel:()=>n.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,alignSelf:"stretch"}),panelContent:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),contentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center"}),avatarPicker:()=>n.Styles.createButtonStyle({marginTop:20,alignSelf:"center"}),conversationNameInputContainer:()=>n.Styles.createViewStyle({backgroundColor:B.Color.transparent,borderBottomWidth:1,alignSelf:"stretch",borderStyle:"solid",marginHorizontal:40,marginTop:20}),conversationNameInputIOS:()=>n.Styles.createTextInputStyle({height:72}),conversationNameInput:()=>n.Styles.createTextInputStyle({alignSelf:"stretch",paddingVertical:16,backgroundColor:B.Color.transparent,textAlign:"center"}),nextButton:()=>n.Styles.createViewStyle({position:"absolute",bottom:10,right:10}),hiddenHeader:()=>n.Styles.createViewStyle({opacity:0})});class j extends c.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._goBack=e=>(f.log(_.LogTraceArea.Navigation,"SetConversationInfoPanel._goBack, causeId: "+e),this.props.route.params.navigator.goBack(),!0),this._onConversationNameActiveStateChange=e=>{e&&(0,r.delay)((()=>{var e;return null===(e=this._textInput)||void 0===e?void 0:e.requestFocus()}),300)},this._onAvatarSelected=(e,t)=>{var s;this._conversationImage=e,this._conversationImageUrl=t,null===(s=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setAvatarSelection(!!e)},this._onAvatarRemoved=()=>{var e;this._conversationImage=void 0,null===(e=this.props.route.params.navigator.context.newGroupTelemetryScenario)||void 0===e||e.setAvatarSelection(!1)},this._onBackButtonClick=e=>{e.stopPropagation();const t=O.default.newCauseId();f.log(_.LogTraceArea.Navigation,"SetConversationInfoPanel._onBackButtonClick, causeId: "+t),this._goBack(t)},this._onConversationNameChanged=e=>{this.isComponentMounted()&&this.setState({conversationName:e})},this._onNextButtonClick=e=>{e.stopPropagation(),this._handleNext()},this._onKeyPress=e=>{e.keyCode!==v.default.ENTER&&e.keyCode!==v.default.RETURN||(e.stopPropagation(),this._handleNext())},this._onBeforeOpeningCameraOrPicker=()=>{S.dismissAll()},this._onTextInputRef=e=>{this._textInput=e||void 0}}static getHeaderText(e){return e?M.getString("Hub.NewModeratedGroupChatShortLabel"):M.getString("SetConversationInfoPanel.Title")}_buildState(e,t){var s;const i=this._getRootViewId(),o={isUsingStackNavigationContext:I.default.isUsingStackNavigationContext(),safeAreaHorizontalInsets:A.default.horizontalInsets(g.HorizontalInsetDefault),safeAreaBottomInset:A.default.bottomSafeAreaInset(),bigAvatarHelper:new u.default(i),isSmallDevice:k.default.isSmallDevice(i)};return t&&(o.conversationColor=b.default.getColorInfo(),o.conversationName=e.route.params.navigator.context.convName||"",this._conversationImage=e.route.params.navigator.context.convAvatar,this._conversationImageUrl=e.route.params.navigator.context.convAvatarUrl,o.showLoadingPanel=!1,null===(s=e.route.params.navigator.context.newGroupTelemetryScenario)||void 0===s||s.setVisitedSetConvInfoPanel()),o}render(){let e;if(this.state.showLoadingPanel){const t=this.props.route.params.navigator.context.convId?M.getString("SetConversationParticipantsPanel.AddingContactsToConversation"):M.getString("SetConversationParticipantsPanel.CreatingNewConversation");e=(0,o.jsx)(T.default,{message:t})}else e=this._getContent();const{primaryBackgroundColorStyle:t}=U.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,o.jsx)(p.default,{goBack:this._goBack,children:(0,o.jsxs)(V.KeyboardAvoidingView,{style:[H.panel,t],children:[this._getHeader(this.state.showLoadingPanel),e]})})}_componentId(){return"SetConversationInfoPanel"}_getHeader(e){return(0,o.jsx)(R.SimplePanelHeader,{style:e?H.hiddenHeader:void 0,blockPointerEvents:e,panelName:this._getHeaderText(this.state),leftButton:this._getHeaderLeftButton(),hideBottomBorder:!0})}_getHeaderText(e){return j.getHeaderText(this.props.route.params.navigator.context.navigationOrigin===_.NavigationConversationOrigin.NewModeratedGroup)}_getHeaderLeftButton(){var e;const t=(null===(e=this.props.route.params.navigator.context.wizardSteps)||void 0===e?void 0:e[0])===w.WizardSteps.setConvInfo&&this.props.route.params.navigationDirection!==L.StackNavigationDirection.Push&&(!this._getContext().isPresentedInDesktopSubview||this.props.route.params.isAloneInNavStack);return{closeButtonType:t?R.CloseButtonType.Close:R.CloseButtonType.Back,title:t?M.getString("Global.CloseButtonTitle"):M.getString("Global.BackButtonTitle"),onPress:this._onBackButtonClick}}_getContent(){const{dividerBorderColorStyle:e}=U.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{secondaryTextColor:t}=U.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),s=U.currentTheme(this._getContext(),this.props.route.params.colorThemeOverride),i=[F.default.messagingHeaderFontStyle(!1,this.state.isSmallDevice,s),H.conversationNameInput],r=[H.conversationNameInputContainer,e],c=h.gradientColorsForColorInfo(this.state.conversationColor);let u;const p=[H.nextButton];x.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&(u=x.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets),r.push(u),p.push(n.Styles.createViewStyle({right:this.state.safeAreaHorizontalInsets.right},!1))),this.state.safeAreaBottomInset&&p.push(n.Styles.createViewStyle({bottom:this.state.safeAreaBottomInset},!1));const g=(0,o.jsx)(d.default,{style:[H.avatarPicker],onAvatarSelected:this._onAvatarSelected,onAvatarRemoved:this._onAvatarRemoved,iconSize:N.IconSize.size120,accessibilityLabel:M.getString("SetConversationInfoPanel.SelectGroupAvatarAccessibilityLabel"),onBeforeExecuteMenuCommand:this._onBeforeOpeningCameraOrPicker,initialAvatar:this._conversationImageUrl,showAltViewAsMediaIcon:!0,origin:_.AvatarPickerOrigin.ConversationInfoPanel}),S=N.IconSize.size120,f=M.getString("SetConversationInfoPanel.GroupConversationNameAccessibilityLabel",{conversationName:this.state.conversationName});return(0,o.jsxs)(n.View,{style:H.panelContent,children:[(0,o.jsxs)(n.View,{style:H.contentContainer,children:[(0,o.jsx)(P.default,{backgroundHeight:S,gradientColors:c,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,children:this.state.bigAvatarHelper.maybeWrapAvatar(g)}),(0,o.jsx)(n.View,{style:r,children:(0,o.jsx)(a.default,{ref:this._onTextInputRef,autoFocusable:!0,style:i,placeholder:M.getString("SetConversationInfoPanel.ConversationNamePlaceHolder"),placeholderTextColor:t,onChangeText:this._onConversationNameChanged,onKeyPress:this._onKeyPress,value:this.state.conversationName,autoFocus:!D.default.isMobileScreenReaderEnabled(),accessibilityLabel:f,returnKeyType:"done",maxLength:m.MaximumGroupConversationNameLength,clearButtonMode:"never",blurOnSubmit:!0,onActiveStateChange:this._onConversationNameActiveStateChange})})]}),(0,o.jsx)(l.default,{style:p,icon:E.forwardIcon(),title:M.getString("Global.NextButtonTitle"),disabled:!this._canGoNext(),onPress:this._onNextButtonClick,userColor:this.state.conversationColor})]})}_handleNext(){var e;if(!this._canGoNext())return;y.default.immediatelyResetUpdateInfo(),null===(e=this._textInput)||void 0===e||e.blur();const t=O.default.escapeXml(this.state.conversationName);this.props.route.params.navigator.extendContext({convAvatar:this._conversationImage,convAvatarUrl:this._conversationImageUrl,convColor:this.state.conversationColor,convName:t}),this.props.route.params.navigator.goNext();(0,r.last)(this.props.route.params.navigator.context.wizardSteps)===w.WizardSteps.setConvInfo&&this.setState({showLoadingPanel:!0})}_canGoNext(){const{conversationName:e}=this.state;return!!e&&!/^\s*$/.test(e)}}t.default=j},682500:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=i.__importStar(s(516778)),r=s(808467),a=i.__importDefault(s(76596)),l=s(815146),d=i.__importStar(s(85385)),c=i.__importDefault(s(114818)),u=s(26703),h=i.__importStar(s(704704)),p=i.__importStar(s(920710)),g=s(73018),m=i.__importDefault(s(817672)),S=i.__importDefault(s(597285)),_=s(375258),f=i.__importDefault(s(760989)),y=i.__importDefault(s(827361)),v=(0,u.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"stretch"})});class C extends r.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._shouldDisableDone=e=>this._reactionsListChanged(e),this._updateTelemetryData=({toggledEmoticonCount:e,searchInitiatedCount:t})=>{this._searchTelemetryData={toggledEmoticonCount:e,searchInitiatedCount:t}},this._onDonePress=()=>{const e=this._getAddedReactions();d.track(new g.CustomReactionsManipulationTelemetry(g.CustomReactionsManipulationAction.ReactionsSavedOnDoneButton,{numberOfReactions:this.state.selectedReactions.length,numberOfAddedReactions:this.state.selectedReactions.length-this._initialSelectedReactions.length,customReactionsType:this.props.route.params.origin,numberOfAnimatedReactions:S.default.superAnimationReactionsNumber(e),searchData:this._searchTelemetryData})),this._reactionsStore.saveCurrentReactions(),this._closeCustomReactionPanel()},this._onClosePressed=()=>{d.track(new g.CustomReactionsManipulationTelemetry(g.CustomReactionsManipulationAction.ReactionsNotSavedOnCloseButton,{numberOfReactions:this.state.selectedReactions.length,numberOfNotSavedReactions:this.state.selectedReactions.length-this._initialSelectedReactions.length,customReactionsType:this.props.route.params.origin,searchData:this._searchTelemetryData})),this._reactionsStore.resetUnsavedReactions(),this._closeCustomReactionPanel()},this._closeCustomReactionPanel=()=>{const e=f.default.newCauseId();d.log(l.LogTraceArea.Navigation,"SimplePanelHeader.onPress, causeId: "+e),super._goBack(e)}}_buildState(e,t){this._reactionsStore=this._getReactionsStore(e.route.params.origin);const s=this._reactionsStore.getCurrentReactions();return t&&(this._initialSelectedReactions=s),{selectedReactions:s,isPackChanged:!t&&this._shouldDisableDone(s)}}_getReactionsStore(e){return p.getCustomReactionsStore(e)}render(){return(0,o.jsxs)(n.View,{style:[y.default.flexOne,v.panel,this._getContext().themeStyles.primaryBackgroundColorStyle],children:[(0,o.jsx)(_.SimplePanelHeader,{panelName:this._getHeaderText(),leftButton:{closeButtonType:_.CloseButtonType.Close,onPress:this._onClosePressed}}),(0,o.jsx)(a.default,{origin:this.props.route.params.origin,updateTelemetryData:this._updateTelemetryData}),(0,o.jsx)(m.default,{button:this._getHeaderDoneButton()})]})}_reactionsListChanged(e){return!!e.length&&!(0,c.default)(e,this._initialSelectedReactions)}_getHeaderDoneButton(){return{text:h.getString("Global.DoneButtonTitle"),accessibilityLabel:h.getString("Global.DoneButtonTitle"),disabled:!this.state.isPackChanged,onPress:this._onDonePress}}_getAddedReactions(){return this.state.selectedReactions.filter((e=>-1===this._initialSelectedReactions.indexOf(e)))}_getHeaderText(){return this._reactionsStore.getCustomReactionsModalTitle()}}t.default=C},733900:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(192478),n=i.__importDefault(s(969004));t.default=(0,o.forNavigation)(n.default)},840115:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(496486),r=s(380157),a=s(857969),l=i.__importDefault(s(336550)),d=i.__importDefault(s(126740)),c=i.__importStar(s(516778)),u=s(808467),h=s(262725),p=s(375258),g=s(16549),m=s(270127),S=s(641400),_=s(313599),f=s(26703),y=s(331079),v=s(815146),C=s(389896),T=s(815146),M=s(96575),b=s(154235),I=i.__importStar(s(971988)),w=i.__importStar(s(626065)),P=i.__importStar(s(85385)),k=i.__importStar(s(704704)),A=i.__importDefault(s(206483)),x=i.__importDefault(s(633958)),D=i.__importDefault(s(453761)),R=i.__importDefault(s(970035)),L=i.__importDefault(s(114818)),B=i.__importStar(s(576047)),F=i.__importDefault(s(91258)),N=i.__importDefault(s(252089)),E=i.__importDefault(s(201721)),O=i.__importDefault(s(363091)),U=i.__importDefault(s(453353)),V=i.__importDefault(s(251733)),H=i.__importDefault(s(246230)),j=i.__importDefault(s(863132)),z=i.__importDefault(s(960282)),W=i.__importDefault(s(791384)),G=i.__importDefault(s(799585)),K=i.__importDefault(s(827361)),q=i.__importDefault(s(760989)),Q=i.__importDefault(s(740794)),X=6e4,$="permissionDenied",J="permissionGranted",Y=(0,f.lazyProperties)({locationPicker:()=>(0,f.lazyProperties)({mapContainer:()=>c.Styles.createViewStyle({backgroundColor:g.Color.gray100})}),locationPickerPin:()=>(0,f.lazyProperties)({container:()=>c.Styles.createViewStyle({top:-m.CurrentLocationPinHeight/2,alignSelf:"stretch",alignItems:"center",justifyContent:"center"}),containerNonCurrentLocation:()=>c.Styles.createViewStyle({top:-m.NonCurrentLocationPinHeight/2}),containerSpinner:()=>c.Styles.createViewStyle({top:0}),pinContentAligment:()=>c.Styles.createViewStyle({justifyContent:"flex-end"}),currentLocationPinHeight:()=>c.Styles.createViewStyle({height:m.CurrentLocationPinHeight}),nonCurrentLocationPinHeight:()=>c.Styles.createViewStyle({height:m.NonCurrentLocationPinHeight}),goToMyLocationButton:()=>c.Styles.createButtonStyle({alignItems:"center",justifyContent:"center",position:"absolute",width:S.IconSize.default,height:S.IconSize.default,borderRadius:S.IconSize.default/2,bottom:12,right:12,backgroundColor:g.Color.gray400})}),map:()=>(0,f.lazyProperties)({mapStyle:()=>c.Styles.createViewStyle({flex:1,alignSelf:"stretch"})}),spinnerContainer:()=>c.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",backgroundColor:g.Color.transparent}),error:()=>(0,f.lazyProperties)({container:()=>c.Styles.createViewStyle({flex:1,backgroundColor:g.Color.gray100Overlay30,borderWidth:1,borderColor:g.Color.gray100Overlay30,borderStyle:"solid",alignItems:"center",justifyContent:"center"}),iconContainer:()=>c.Styles.createViewStyle({flex:1,opacity:.15,alignItems:"center",marginBottom:30,justifyContent:"flex-end"}),textStyle:()=>c.Styles.createTextStyle({flex:1,paddingHorizontal:16,textAlignVertical:"top",textAlign:"center",alignItems:"center",justifyContent:"center"})})});class Z extends u.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._mapViewRef=e=>{this._mapView=e},this._onSearchClick=()=>{if(!this.state.currentSelectedLocation)return;const{latitude:e,longitude:t}=this.state.currentSelectedLocation;Q.default.navigateToNearByPlaces({latitude:e,longitude:t,locationType:this.state.locationType,onNearByPlaceSelect:this._onNearByPlaceSelect}),P.track(new B.LocationPickerSearchStart(this.state.locationType))},this._onMapPanelLayout=e=>{this.isComponentMounted()&&e.height!==this.state.mapViewHeight&&this.setState({mapViewHeight:e.height}),this.state.isPermissionUnknown&&!this.state.isChild&&V.default.requestPermission(y.PermissionType.Location,y.PermissionPromptOptions.SkipPrePrompt)},this._onNearByPlaceSelect=e=>{const t={latitude:e.latitude,longitude:e.longitude,latitudeDelta:this.state.currentSelectedLocation?this.state.currentSelectedLocation.latitudeDelta:0,longitudeDelta:this.state.currentSelectedLocation?this.state.currentSelectedLocation.longitudeDelta:0};this.setState({animatingPlace:e,animatingLocation:t,animatingLocationType:y.LocationType.Search}),P.track(new B.LocationPickerNearbyClicked(y.LocationType.Search))},this._onGoToMyLocation=()=>{this._refreshUserLocation("goToMyLocationButton",!1,X,!0)},this._onRegionChangeComplete=e=>{if(!this.state.initialRegionChangeComplete)return void(this.isComponentMounted()&&this.setState({initialRegionChangeComplete:!0}));if(this.state.animatingLocationType)return;if(this.state.currentSelectedLocation&&Z._linearDistanceBetweenCoordinates(e.latitude,e.longitude,this.state.currentSelectedLocation.latitude,this.state.currentSelectedLocation.longitude,"km")<=.01)return;let t=-1,s=!1;this.state.currentUserLocation&&(t=Z._linearDistanceBetweenCoordinates(e.latitude,e.longitude,this.state.currentUserLocation.latitude,this.state.currentUserLocation.longitude,"km"),s=t<=.1),this.isComponentMounted()&&this.setState({locationType:s?y.LocationType.Current:y.LocationType.Custom,currentSelectedLocation:e})},this._onClose=()=>{this._goBack(q.default.newCauseId())},this._onSendPress=(e,t,s)=>{const i=q.default.newCauseId();P.log(v.LogTraceArea.LocationPicker,"LocationPicker._onSendPress causeId: "+i);let o=t;o||(o=k.getString("LocationPicker.LocationSharedFallback"));const r=this._getShownLocation(),a=new w.GeoLocationEntity(this.state.locationType===y.LocationType.Current,O.default.getSkypeMri(),r?r.latitude:void 0,r?r.longitude:void 0,void 0,(new Date).getTime(),l.default.getDefaultId(),void 0,k.getLocale(),k.getLanguageFromLocale(),o,void 0,void 0,e,s,r?[new w.LinkEntity(o,F.default.getBingMapsLocationUrl(r,e))]:void 0);j.default.postMessageFromInput(this.props.route.params.conversationId,T.PostSource.LocationPicker,[a],I.MessageTypes.Location,{name:M.ScenarioName.SendLocation}),P.track(new B.LocationPickerSend(this.state.locationType)),W.default.maybeAnnounceForAccessibility(k.getString("LocationPicker.LocationSent")),W.default.isMobileScreenReaderEnabled()?(0,n.delay)((()=>this._goBack(i)),1e3):this._goBack(i)},this._goBack=e=>(P.log(v.LogTraceArea.Navigation,"LocationPicker._goBack causeId: "+e),P.track(new B.LocationPickerNavigationClose(this.state.locationType)),super._goBack(e))}_buildState(e,t){var s;const i=null===(s=E.default.getUserPreferencesLocal().msaProfileKey)||void 0===s?void 0:s.ageGroup,o=C.MsaProfileHelper.isChild(i),n=F.default.getLocationPermissionStatus(y.PermissionType.Location),a=this._getRootViewId(),l={isPermissionUnavailable:n===r.PermissionStatus.Unavailable,isPermissionDenied:n===r.PermissionStatus.Denied,isPermissionUnknown:n===r.PermissionStatus.Unknown,isPermissionGranted:n===r.PermissionStatus.Granted,deviceOrientation:z.default.getDeviceOrientation(a),screenHeight:z.default.getHeight(a),isConnected:U.default.isConnected(),isChild:o};return t&&(l.locationType=y.LocationType.None),l}componentDidMount(){super.componentDidMount(),this.state.isConnected&&(this.state.isPermissionDenied&&(P.track(new B.LocationPickerPermissionsChanged(this.state.locationType,"none",$)),H.default.showDeniedPromptWithSettingsOption(y.PermissionType.Location,this._getRootViewId())),this._refreshUserLocation("componentDidMount",!1,X,!0)),P.track(new B.LocationPickerNavigationOpen(this.state.locationType))}componentDidUpdate(e,t,s){super.componentDidUpdate(e,t,s),this.state.isConnected&&(!t.isPermissionDenied&&this.state.isPermissionDenied&&(P.track(new B.LocationPickerPermissionsChanged(this.state.locationType,J,$)),H.default.showDeniedPromptWithSettingsOption(y.PermissionType.Location,this._getRootViewId())),(t.isPermissionDenied&&!this.state.isPermissionDenied&&!this.state.isPermissionUnknown||t.isPermissionUnknown&&!this.state.isPermissionUnknown&&!this.state.isPermissionDenied)&&(P.track(new B.LocationPickerPermissionsChanged(this.state.locationType,$,J)),this._refreshUserLocation("componentDidUpdate",!1,X,!0)));const i=this.state.initialRegionChangeComplete&&!t.initialRegionChangeComplete,o=!(0,L.default)(this.state.animatingLocation,t.animatingLocation)&&this.state.initialRegionChangeComplete;if(this.state.animatingLocationType&&(o||i)){if(!this.state.animatingLocation)return;const e=this.state.initialLocationFetchComplete?750:1500;this._animateToRegion(this.state.animatingLocation,e)}}_refreshUserLocation(e,t=!0,s=6e4,i=!1){const o=!0;if(this.state.isPermissionGranted){t&&this.isComponentMounted()&&this.setState({isLoadingLocation:!0});const n=(new Date).getTime();d.default.getCurrentPosition({maximumAge:0,enableHighAccuracy:o,timeout:s}).then((t=>{const s=this.isComponentMounted(),r=(new Date).getTime();if(P.track(new B.LocationPickerGeolocationFetched(y.LocationType.Current,e,o,s,r-n)),s){const e={latitude:t.coords.latitude,longitude:t.coords.longitude,latitudeDelta:_.LatitudeDelta,longitudeDelta:_.LongitudeDelta};i?this.setState({animatingLocation:e,animatingLocationType:y.LocationType.Current}):this.setState({locationType:y.LocationType.Current,currentUserLocation:e,currentSelectedLocation:e,isLoadingLocation:!1})}})).catch((t=>{P.warn(v.LogTraceArea.LocationPicker,"Was not possible to get the location; Error:"+t.message+";Code:"+t.code);const s=this.isComponentMounted(),i=(new Date).getTime();throw P.track(new B.LocationPickerGeolocationFetchedFailed(this.state.locationType,e,o,s,i-n,t.code===t.TIMEOUT,t.code===t.PERMISSION_DENIED,t.code===t.POSITION_UNAVAILABLE)),A.default.showOKAlert(k.getString("LocationPicker.UnableToFetchLocationTitle"),k.getString("LocationPicker.UnableToFetchLocationMessage"),this._getRootViewId()),s&&this.setState({isPermissionDenied:t.code===t.PERMISSION_DENIED,isLoadingLocation:!1}),t}))}}isNavigatingAwayOnPress(){return!0}render(){if(!this.state.isConnected)return(0,o.jsx)(x.default,{goBack:this._goBack,children:this._getPickerErrorScreen(S.SkypeIcon.EmoticonNotPresent,k.getString("LocationPicker.NoConnection"))});const e=this._getHeaderElement(),t=this._getMapOverlay(),s=(0,o.jsx)(a.MapView,{ref:this._mapViewRef,showsMyLocationButton:!1,region:this.state.animatingLocationType?void 0:this.state.currentSelectedLocation,rotateEnabled:!1,onRegionChangeComplete:this._onRegionChangeComplete,style:Y.map.mapStyle,showsUserLocation:!this.state.isLoadingLocation});return(0,o.jsx)(x.default,{goBack:this._goBack,children:(0,o.jsxs)(c.View,{style:K.default.flexOne,children:[e,(0,o.jsxs)(c.View,{style:[K.default.flexOne,Y.locationPicker.mapContainer],onLayout:this._onMapPanelLayout,children:[s,t]})]})})}_getMapOverlay(){if(!this.state.mapViewHeight)return null;const e=this.state.isPermissionGranted?(0,o.jsx)(c.View,{style:Y.locationPickerPin.goToMyLocationButton,children:(0,o.jsx)(D.default,{title:k.getString("AccessibilityLabel.MyLocation"),size:S.IconSize.size24,onPress:this._onGoToMyLocation,color:g.Color.white,hoverColor:g.Color.whiteOverlay70,icon:S.SkypeIcon.MyLocation,activeOpacity:.6})},"goToMyLocationButton"):void 0;let t;const s=[K.default.absoluteFill,Y.locationPickerPin.container,this._getHeightStyle(this.state.mapViewHeight)];if(this.state.isLoadingLocation)s.push(Y.locationPickerPin.containerSpinner),t=(0,o.jsx)(c.View,{style:[Y.spinnerContainer,K.default.absoluteFill],children:(0,o.jsx)(G.default,{size:b.SXActivityIndicatorSize.Medium,tintColor:N.default.getPrimaryColorNoSubscription()})});else if(this._getShownLocation()){const e=this.state.locationType===y.LocationType.Current;let i;e||s.push(Y.locationPickerPin.containerNonCurrentLocation);const n=this._getShownPlace(),r=this._getShownLocation();n&&r&&n.latitude===r.latitude&&n.longitude===r.longitude&&(i={addressFriendlyName:n.name,address:n.address}),t=(0,o.jsx)(m.LocationPickerPin,{style:[Y.locationPickerPin.pinContentAligment,e?Y.locationPickerPin.currentLocationPinHeight:Y.locationPickerPin.nonCurrentLocationPinHeight],location:this.state.currentSelectedLocation,userMri:O.default.getSkypeMri(),overrideAddress:i,locationType:this.state.locationType,hideLocationPin:this.state.locationType===y.LocationType.Current,showSendPopover:!0,onPressPopupOver:this._onSendPress})}return(0,o.jsxs)(c.View,{style:K.default.absoluteFill,ignorePointerEvents:!0,children:[(0,o.jsx)(c.View,{style:s,ignorePointerEvents:!0,children:t}),e]})}_getShownLocation(){return this.state.animatingLocation||this.state.currentSelectedLocation}_getShownPlace(){return this.state.animatingPlace||this.state.selectedPlace}_animateToRegion(e,t){this._mapView?this._mapView.animateToRegion(e,t).then((()=>{this.isComponentMounted()&&(this._completeAnimation(),!this.state.initialLocationFetchComplete&&this.isComponentMounted()&&this.setState({initialLocationFetchComplete:!0}))})).catch((e=>{P.warn(v.LogTraceArea.LocationPicker,"Animation was not completed",e),this.isComponentMounted()&&this._completeAnimation()})):P.warn(v.LogTraceArea.LocationPicker,"unable to animate to selected location since map is null")}_getHeightStyle(e){let t=Z._cachedHeightStyles[e];return t||(t=c.Styles.createViewStyle({height:e}),Z._cachedHeightStyles[e]=t),t}_getHeaderElement(){return(0,o.jsx)(p.SimplePanelHeader,{panelName:k.getString("LocationPicker.SendLocation"),leftButton:this._getHeaderLeftButton(),rightButtons:this._getHeaderRightButton(),hideBottomBorder:!0})}_getHeaderLeftButton(){return{closeButtonType:p.CloseButtonType.Close,title:k.getString("Global.CloseButtonTitle"),onPress:this._onClose}}_getHeaderRightButton(){return this.state.currentSelectedLocation?{icon:S.SkypeIcon.Search,title:k.getString("LocationPicker.SearchPlacesPlaceholder"),onPress:this._onSearchClick}:void 0}static _linearDistanceBetweenCoordinates(e,t,s,i,o){const n=Math.PI*e/180,r=Math.PI*s/180,a=t-i,l=Math.PI*a/180;let d=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos(l);return d=Math.acos(d),d=180*d/Math.PI,d=60*d*1.1515,"km"===o&&(d*=1.609344),d}_completeAnimation(){switch(this.state.animatingLocationType){case y.LocationType.NearBy:case y.LocationType.Search:this.isComponentMounted()&&this.setState({selectedPlace:this.state.animatingPlace,currentSelectedLocation:this.state.animatingLocation,locationType:this.state.animatingLocationType,animatingLocation:void 0,animatingPlace:void 0,animatingLocationType:void 0});break;case y.LocationType.Current:this.isComponentMounted()&&this.setState({locationType:y.LocationType.Current,currentUserLocation:this.state.animatingLocation,currentSelectedLocation:this.state.animatingLocation,isLoadingLocation:!1,animatingLocation:void 0,animatingPlace:void 0,animatingLocationType:void 0});break;default:P.warn(v.LogTraceArea.LocationPicker,"No state change for "+this.state.locationType+"is defined")}}_getPickerErrorScreen(e,t){return(0,o.jsxs)(c.View,{style:K.default.flexOne,children:[this._getHeaderElement(),(0,o.jsxs)(c.View,{style:Y.error.container,children:[(0,o.jsx)(c.View,{style:Y.error.iconContainer,children:(0,o.jsx)(R.default,{icon:e,size:S.IconSize.size80,color:g.Color.gray300})}),(0,o.jsx)(h.BodyText,{style:Y.error.textStyle,textThemeColor:h.TextThemeColor.Secondary,children:t})]})]})}_getHeaderText(e){}}Z._cachedHeightStyles={},t.default=Z},797746:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLocationViewerNavigationHeaderTitle=function(e){let t="";e.isUserLocation?e.postedByCurrentUser?t=p.getString("LocationPicker.SharedCurrentLocationYou"):e.senderName&&(t=p.getString("LocationPicker.SharedCurrentLocation",{userName:e.senderName})):e.postedByCurrentUser?t=p.getString("LocationPicker.SharedByYou"):e.senderName&&(t=p.getString("LocationPicker.SharedLocation",{userName:e.senderName}));return t};const i=s(197582),o=s(785893),n=s(380157),r=s(857969),a=i.__importStar(s(516778)),l=s(808467),d=i.__importDefault(s(601976)),c=s(815146),u=i.__importStar(s(85385)),h=s(26703),p=i.__importStar(s(704704)),g=s(313599),m=i.__importDefault(s(91258)),S=s(270127),_=i.__importStar(s(576047)),f=s(786531),y=i.__importDefault(s(363091)),v=i.__importDefault(s(819549)),C=s(375258),T=i.__importStar(s(888500)),M=s(16549),b=i.__importDefault(s(139221)),I=i.__importStar(s(179582)),w=s(331079),P=i.__importDefault(s(220534)),k=i.__importDefault(s(760989)),A=s(240265),x=i.__importDefault(s(827361)),D="OpenInMaps",R="OpenInGoogleMaps",L="Copy",B="Forward",F=(0,h.lazyProperties)({panel:()=>a.Styles.createViewStyle({alignSelf:"stretch"}),mapContainer:()=>a.Styles.createViewStyle({backgroundColor:M.Color.gray100})});class N extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onShareIconRef=e=>{this._shareIconButton=e||void 0},this._onShare=e=>{const t={anchor:()=>this._shareIconButton,message:this.props.route.params.fullAddress,buttons:[{text:p.getString("LocationPicker.Copy"),command:L},{text:p.getString("LocationPicker.ShareCommandForward"),command:B}]};T.default.showWithActionMenuConfig({options:t,callback:this._handleShareCommands,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleShareCommands=e=>{switch(e){case B:v.default.shareLocation(this.props.route.params.message,f.MessageActionOrigin.LocationViewer,this._getContext());break;case L:(0,A.writeTextToClipboard)(this.props.route.params.fullAddress),u.track(new f.MessageActionTelemetry(this.props.route.params.message.conversationId,this.props.route.params.message,this.props.route.params.message.createdTime,f.MessageActionOrigin.LocationViewer,f.MessageActionType.Copy));case T.SXActionMenuCancel:}},this._onClose=()=>{const e=k.default.newCauseId();u.log(c.LogTraceArea.Navigation,"LocationViewer._onClose causeId: "+e),this._goBack(e)},this._onPinPress=e=>{const t={anchor:()=>this._locationPickerPin,buttons:[]};b.default.getPlatformType()===c.PlatformType.iOS&&t.buttons.push({text:p.getString("LocationPicker.OpenInMaps"),command:D}),t.buttons.push({text:p.getString("LocationPicker.OpenInGoogleMaps"),command:R}),T.default.showWithActionMenuConfig({options:t,callback:this._handleGetDirectionsCommands,rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleGetDirectionsCommands=e=>{switch(e){case D:let e;e=this.props.route.params.addressFriendlyName?{q:encodeURIComponent(this.props.route.params.addressFriendlyName),ll:this._getLatLongString()}:this.props.route.params.shortAddress?{q:encodeURIComponent(this.props.route.params.shortAddress),ll:this._getLatLongString()}:{q:this._getLatLongString()},a.Linking.openUrl(P.default.addUrlParameters("https://maps.apple.com",e)),u.track(new _.LocationViewerOpenMaps);break;case R:let t;t=this.props.route.params.addressFriendlyName?{q:encodeURIComponent(this.props.route.params.addressFriendlyName),center:this._getLatLongString()}:this.props.route.params.shortAddress?{q:encodeURIComponent(this.props.route.params.shortAddress),center:this._getLatLongString()}:{q:this._getLatLongString()},a.Linking.openUrl(P.default.addUrlParameters("https://maps.google.com/maps",t)),u.track(new _.LocationViewerOpenGoogleMaps);case T.SXActionMenuCancel:}},this._onLocationPickerPinRef=e=>{this._locationPickerPin=e||void 0}}_buildState(e){const t=m.default.getLocationPermissionStatus(w.PermissionType.Location),s={postedByCurrentUser:y.default.isMyMri(e.route.params.userMri),region:{latitude:e.route.params.latitude,longitude:e.route.params.longitude,latitudeDelta:g.LongitudeDelta,longitudeDelta:g.LatitudeDelta},isPermissionGranted:t===n.PermissionStatus.Granted};return s.postedByCurrentUser||(s.senderName=d.default.getDisplayableProfile(e.route.params.userMri).getShortName()),s}render(){const e=this.props.route.params.isUserLocation?S.CurrentLocationPinHeight:S.NonCurrentLocationPinHeight;return(0,o.jsxs)(a.View,{style:[x.default.flexOne,F.panel],children:[this.props.navigation?void 0:this._getHeader(),(0,o.jsx)(a.View,{style:[x.default.flexOne,F.mapContainer],children:(0,o.jsx)(r.MapView,{region:this.state.region,style:[x.default.flexOne,F.panel],rotateEnabled:!1,showsUserLocation:this.state.isPermissionGranted,loadingIndicatorColor:M.Color.blue,showsMyLocationButton:!1,children:(0,o.jsx)(r.MapMarker,{centerOffset:{y:-e/2,x:0},coordinate:this.state.region,onPress:this._onPinPress,children:(0,o.jsx)(S.LocationPickerPin,{ref:this._onLocationPickerPinRef,conversationId:this.props.route.params.message.conversationId,userMri:this.props.route.params.userMri,locationType:this.props.route.params.isUserLocation?w.LocationType.Current:w.LocationType.None,overrideAddress:{addressFriendlyName:this.props.route.params.addressFriendlyName||"",address:this.props.route.params.shortAddress||""},showViewerPopover:!0})})},"map-view")})]})}_getHeader(){let e="";return this.props.route.params.isUserLocation?this.state.postedByCurrentUser?e=p.getString("LocationPicker.SharedCurrentLocationYou"):this.state.senderName&&(e=p.getString("LocationPicker.SharedCurrentLocation",{userName:this.state.senderName})):this.state.postedByCurrentUser?e=p.getString("LocationPicker.SharedByYou"):this.state.senderName&&(e=p.getString("LocationPicker.SharedLocation",{userName:this.state.senderName})),(0,o.jsx)(C.SimplePanelHeader,{panelName:e,leftButton:this._getHeaderLeftButton(),rightButtons:this._getHeaderRightButton(),hideBottomBorder:!0})}_getHeaderLeftButton(){return{closeButtonType:C.CloseButtonType.Close,title:p.getString("Global.BackButtonTitle"),onPress:this._onClose}}_getHeaderRightButton(){return{icon:I.shareIcon(),title:p.getString("LocationPicker.ShareButtonTitle"),onPress:this._onShare,setButtonRef:this._onShareIconRef}}_getLatLongString(){return this.props.route.params.latitude+","+this.props.route.params.longitude}_getHeaderText(e){}}t.default=N},606463:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(667294),r=i.__importStar(s(516778)),a=i.__importDefault(s(827361)),l=s(736267),d=i.__importDefault(s(740794)),c=i.__importDefault(s(98794)),u=i.__importDefault(s(760989)),h=i.__importDefault(s(817198));t.default=e=>{const{latitude:t,longitude:s,locationType:i,onNearByPlaceSelect:p}=e.route.params,g=(0,l.useCommonContext)(),[m,S]=(0,n.useState)(),_=(0,n.useCallback)((e=>{S(e)}),[]),f=(0,n.useCallback)((()=>{d.default.goBack(u.default.newCauseId(),g)}),[g]),y=(0,n.useCallback)((e=>{d.default.goBack(u.default.newCauseId(),g),p(e)}),[g,p]);return(0,o.jsxs)(r.View,{style:a.default.absoluteFill,children:[(0,o.jsx)(c.default,{initialValue:0,blurOnSubmit:!0,rawSearchQuery:m,onInputTextChange:_,cancelSearch:f},"searchInputControl"),(0,o.jsx)(r.View,{style:a.default.flexOne,children:(0,o.jsx)(h.default,{locationType:i,style:a.default.flexOne,query:m,searchModeOn:!0,latitude:t,longitude:s,onItemSelected:y})})]})}},354595:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getLocationViewerNavigationHeaderTitle=t.NearByPlacesNavigation=t.LocationViewerNavigation=t.LocationPickerNavigation=void 0;const i=s(197582);var o=s(840115);Object.defineProperty(t,"LocationPickerNavigation",{enumerable:!0,get:function(){return i.__importDefault(o).default}});var n=s(797746);Object.defineProperty(t,"LocationViewerNavigation",{enumerable:!0,get:function(){return i.__importDefault(n).default}});var r=s(606463);Object.defineProperty(t,"NearByPlacesNavigation",{enumerable:!0,get:function(){return i.__importDefault(r).default}});var a=s(797746);Object.defineProperty(t,"getLocationViewerNavigationHeaderTitle",{enumerable:!0,get:function(){return a.getLocationViewerNavigationHeaderTitle}})},219667:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(785893),n=s(331654),r=s(149374),a=i.__importStar(s(516778)),l=i.__importDefault(s(974634)),d=s(496486),c=i.__importDefault(s(150343)),u=s(808467),h=i.__importStar(s(44717)),p=i.__importDefault(s(349004)),g=i.__importDefault(s(601976)),m=s(815146),S=s(929418),_=i.__importStar(s(85385)),f=i.__importDefault(s(214295)),y=s(26703),v=i.__importStar(s(704704)),C=s(786531),T=i.__importDefault(s(740794)),M=i.__importDefault(s(942724)),b=i.__importDefault(s(244466)),I=i.__importDefault(s(960282)),w=i.__importDefault(s(117475)),P=s(286517),k=s(240804),A=i.__importDefault(s(657764)),x=i.__importStar(s(750822)),D=i.__importDefault(s(817672)),R=s(375258),L=s(928722),B=i.__importDefault(s(760989)),F=i.__importStar(s(972830)),N=s(844086),E=(0,y.lazyProperties)({container:()=>a.Styles.createViewStyle({flex:1,alignSelf:"stretch"})}),O={[m.SearchType.ZeroInput]:[{groupType:m.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:m.SearchResultsListGroup.CombinedContactsWithoutAddressBookOrAlphaHeaders}],[m.SearchType.ShortQuery]:[{groupType:m.SearchResultsListGroup.AllPeople},{groupType:m.SearchResultsListGroup.PublicDirectory}],[m.SearchType.LongQuery]:[{groupType:m.SearchResultsListGroup.AllPeople},{groupType:m.SearchResultsListGroup.PublicDirectory}]};class U extends u.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onKeyDownEvent=new l.default,this._keyboardAnimatedHeightValue=new a.Animated.Value(0),this._keyboardAnimatedHeightStyle=a.Styles.createAnimatedViewStyle({height:this._keyboardAnimatedHeightValue}),this._hasUsedSearch=!1,this._onSearchResultsListRef=e=>{this._searchResultsListRef=e||void 0},this._onProfileRemoved=()=>{this._searchResultsListRef&&this._searchResultsListRef.focusFirst()},this._onInputChanged=e=>{this.isComponentMounted()&&(!1===this._hasUsedSearch&&e.length>0&&(this._hasUsedSearch=!0),this.setState({inputText:e}))},this._getHeader=()=>{const e={closeButtonType:this.props.route.params.navigationDirection===L.StackNavigationDirection.Push?R.CloseButtonType.Back:R.CloseButtonType.Close,onPress:this._cancelShare,title:v.getString("ShareWithPanel.CloseButtonTitle")},t=this._getHeaderText(this.state),s=this.props.route.params.accessibilityLabelTitle||(0,d.trimEnd)(t,".");return(0,o.jsx)(a.View,{children:(0,o.jsx)(R.SimplePanelHeader,{panelName:t,accessibleName:s,leftButton:e,allowTextWrap:!0})})},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onSelectableItemClick=(e,t)=>{const s=this._conversationSelectionController.getSelectedConversations(),i=g.default.getDisplayableProfile(t);(0,d.includes)(s,t)?(this._conversationSelectionController.removeConversation(t),a.Accessibility.announceForAccessibility(v.getString("ShareWithPanel.ShareTargetRemovedAnnouncement",{displayName:i.getDisplayName()}))):(this._conversationSelectionController.addConversation(t),a.Accessibility.announceForAccessibility(v.getString("ShareWithPanel.ShareTargetSelectedAnnouncement",{displayName:i.getDisplayName()})))},this._onSendButtonPress=()=>{if(this._sendButtonPressed)return;this._sendButtonPressed=!0;const e=B.default.newCauseId();_.log(m.LogTraceArea.Contacts,"ShareContactsToConversationPanel._onSendButtonPress,  causeId: "+e);const t=this._conversationSelectionController.getSelectedConversations();this._completeSharingProcess(t,e)},this._cancelShare=()=>{const e=B.default.newCauseId();_.log(m.LogTraceArea.Contacts,"ShareContactsToConversationPanel._cancelShare,  causeId: "+e),this._goBack(e)},this._headerHeight=()=>(this.state.deviceOrientation!==n.DeviceOrientation.Landscape?this.state.isSmallDevice?R.HeaderHeightSmall:R.HeaderHeight:this.state.isSmallDevice?R.HeaderHeightLandscapeSmall:R.HeaderHeightLandscape)+this.state.statusBarPadding}_buildState(e,t){const s=this._getRootViewId(),i={statusBarPadding:w.default.statusBarPadding(),deviceOrientation:I.default.getDeviceOrientation(s),isSmallDevice:I.default.isSmallDevice(s)};return t&&(this._conversationSelectionController=new p.default,i.inputText=""),i.isUsingStackNavigationContext=M.default.isUsingStackNavigationContext(),i.keyboardUpdateInfo=f.default.getUpdateInfo(),i.keyboardResizeMode=f.default.getResizeMode(),i.selectedMris=this._conversationSelectionController.getSelectedConversations(),i.canSubmit=this._conversationSelectionController.getSelectedConversations().length>0,i.headerConfig={getHeader:this._getHeader,getHeaderHeight:this._headerHeight,key:"header"},i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._searchController=new A.default}UNSAFE_componentWillUpdate(e,t,s){super.UNSAFE_componentWillUpdate(e,t,s),this.state.keyboardUpdateInfo.height!==t.keyboardUpdateInfo.height&&this._keyboardAnimatedHeightValue.setValue(t.keyboardUpdateInfo.height)}componentWillUnmount(){super.componentWillUnmount(),this._searchController&&this._searchController.destroy();let e=0,t=0;this.state.selectedMris.forEach((s=>{h.isPhoneMri(s)?e++:t++})),_.track(new C.ShareContactsTelemetry(this.props.route.params.entryPoint,this.props.route.params.conversationId,e,t,this._hasUsedSearch))}render(){const e=this.state.keyboardResizeMode===r.KeyboardAwareResizeMode.None?(0,o.jsx)(a.Animated.View,{style:this._keyboardAnimatedHeightStyle}):void 0,{primaryBackgroundColorStyle:t}=F.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,o.jsxs)(N.KeyboardAvoidingView,{style:[E.container,t],children:[(0,o.jsxs)(a.View,{style:E.container,children:[(0,o.jsx)(b.default,{searchController:this._searchController,headerConfig:this.state.headerConfig,onCancel:this._cancelShare,peopleType:k.PeopleType.AllExcludingBots,includeGroups:!0,autoFocusOnInput:!a.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,selectorController:this._conversationSelectionController,useCollapsableHeader:!1,onKeyDown:this._onSearchInputKeyDown,inputText:this.state.inputText,onInputChanged:this._onInputChanged,colorThemeOverride:this.props.route.params.colorThemeOverride,onProfileRemoved:this._onProfileRemoved,noFixedHeight:!1},"peopleInput"),(0,o.jsx)(P.SearchResultsList,{ref:this._onSearchResultsListRef,rawSearchQuery:this.state.inputText,origin:m.SearchResultsListOrigin.ContactsPanel,searchResultGroups:this._getSearchResultsGroup(),searchController:this._searchController,arePeopleSelectableForInvite:!0,onListItemClick:this._onSelectableItemClick,selectedMris:this.state.selectedMris,peopleType:k.PeopleType.AllExcludingBots,maxNumberOfSuggestedContacts:20,excludePstn:!1,excludeGroups:!0,userMrisToExclude:this.props.route.params.userMrisToExclude,keyDownEvent:this._onKeyDownEvent,colorThemeOverride:this.props.route.params.colorThemeOverride})]}),(0,o.jsx)(D.default,{button:this._getActionSendButton()}),e]})}_componentId(){return"ShareContactsToConversationPanel"}_getActionSendButton(){return{onPress:this._onSendButtonPress,disabled:!this.state.canSubmit,text:v.getString("ShareWithPanel.SendButton"),accessibilityLabel:v.getString("ShareWithPanel.SendButton")}}_getSearchResultsGroup(){const e=this.state.inputText.trim();return 0===e.length?O[m.SearchType.ZeroInput]:e.length<c.default.getConfigSettingsNoSubscription().search.longQueryCharCount?O[m.SearchType.ShortQuery]:O[m.SearchType.LongQuery]}_completeSharingProcess(e,t){_.log(m.LogTraceArea.Contacts,"ShareContactsToConversationPanel._completeSharingProcess,  causeId: "+t),e.forEach((e=>{const t={skypeId:h.stripMriNamespace(e),isPstn:h.isPhoneMri(e),isS4B:h.isS4BBridgeMri(e),fullName:g.default.getDisplayName(e)||"",userMri:e};x.forwardContact(t,this.props.route.params.conversationId,m.PostSource.MessageComposer)})),this.props.route.params.entryPoint&&this.props.route.params.entryPoint===S.ShareContactOrigin.Deeplink&&M.default.isUsingStackNavigationContext()?T.default.navigateToConversation({convId:this.props.route.params.conversationId,origin:m.NavigationConversationOrigin.SharedContactCard,causeId:t}):(this._goBack(t),this.props.route.params.onShareComplete&&this.props.route.params.onShareComplete())}_getHeaderText(e){return this.props.route.params.panelTitle}}t.default=U},942631:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0});const i=s(197582),o=s(192478),n=i.__importDefault(s(510404));t.default=(0,o.forNavigation)(n.default)},583793:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackGalleryNavigation=t.ShareWithNavigation=t.ShareContactsToConversationNavigation=t.MediaPickerNavigation=t.getLocationViewerNavigationHeaderTitle=t.NearByPlacesNavigation=t.LocationViewerNavigation=t.LocationPickerNavigation=t.LoadingNavigation=t.GifPreviewNavigation=t.DocumentViewerNavigation=t.CustomReactionsNavigation=t.CreateConversationNavigation=t.ConversationParticipantsNavigation=t.CaptureComboViewNavigation=t.ArchivedConversationsNavigation=void 0;const i=s(197582);var o=s(74213);Object.defineProperty(t,"ArchivedConversationsNavigation",{enumerable:!0,get:function(){return i.__importDefault(o).default}});var n=s(899497);Object.defineProperty(t,"CaptureComboViewNavigation",{enumerable:!0,get:function(){return i.__importDefault(n).default}});var r=s(650312);Object.defineProperty(t,"ConversationParticipantsNavigation",{enumerable:!0,get:function(){return i.__importDefault(r).default}});var a=s(670238);Object.defineProperty(t,"CreateConversationNavigation",{enumerable:!0,get:function(){return i.__importDefault(a).default}});var l=s(682500);Object.defineProperty(t,"CustomReactionsNavigation",{enumerable:!0,get:function(){return i.__importDefault(l).default}});var d=s(336970);Object.defineProperty(t,"DocumentViewerNavigation",{enumerable:!0,get:function(){return i.__importDefault(d).default}});var c=s(939687);Object.defineProperty(t,"GifPreviewNavigation",{enumerable:!0,get:function(){return i.__importDefault(c).default}});var u=s(733900);Object.defineProperty(t,"LoadingNavigation",{enumerable:!0,get:function(){return i.__importDefault(u).default}});var h=s(354595);Object.defineProperty(t,"LocationPickerNavigation",{enumerable:!0,get:function(){return h.LocationPickerNavigation}}),Object.defineProperty(t,"LocationViewerNavigation",{enumerable:!0,get:function(){return h.LocationViewerNavigation}}),Object.defineProperty(t,"NearByPlacesNavigation",{enumerable:!0,get:function(){return h.NearByPlacesNavigation}}),Object.defineProperty(t,"getLocationViewerNavigationHeaderTitle",{enumerable:!0,get:function(){return h.getLocationViewerNavigationHeaderTitle}});var p=s(552180);Object.defineProperty(t,"MediaPickerNavigation",{enumerable:!0,get:function(){return i.__importDefault(p).default}});var g=s(219667);Object.defineProperty(t,"ShareContactsToConversationNavigation",{enumerable:!0,get:function(){return i.__importDefault(g).default}});var m=s(942631);Object.defineProperty(t,"ShareWithNavigation",{enumerable:!0,get:function(){return i.__importDefault(m).default}});var S=s(958841);Object.defineProperty(t,"StackGalleryNavigation",{enumerable:!0,get:function(){return i.__importDefault(S).default}})},334318:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TestSMSClient=t.FailureReason=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(662783),r=i.__importStar(s(397691)),a=i.__importStar(s(135041)),l=i.__importDefault(s(150343)),d=s(815146),c=i.__importStar(s(71380)),u=i.__importStar(s(85385)),h=i.__importStar(s(437782)),p=s(654519),g=i.__importDefault(s(160049)),m=i.__importDefault(s(517518)),S=i.__importDefault(s(139221)),_=s(135041),f=i.__importStar(s(796967));var y;!function(e){e.InsufficientFunds="InsufficientFunds",e.Other="Other"}(y||(t.FailureReason=y={}));const v=()=>!1;class C extends p.SkypeRestClient{constructor(){super(l.default.getConfigSettingsNoSubscription().sms.host),this._throttled=v,this._customErrorHandler=(e,t)=>(u.log(d.LogTraceArea.SMSClient,`Server returned ${t.statusCode}: ${h.dev_unknownOmit(JSON.stringify(t.body))}`),400===t.statusCode||401===t.statusCode||403===t.statusCode||404===t.statusCode?n.ErrorHandlingType.DoNotRetry:n.ErrorHandlingType.RetryCountedWithBackoff),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler,this._defaultOptions.retries=3}_performApiCall(e,t,s,i){return super._performApiCall(e,t,s,i).finally((e=>{if(i&&i.telemetryEvent){let s="NO_RESPONSE";e&&(s=e.statusCode?e.statusCode.toString():"NO_STATUS_CODE");const o={method:t?t.toString():"",acceptType:i.acceptType||"",endpointUrl:l.default.getConfigSettingsNoSubscription().sms.host,statusCode:s,stratusStatusCode:"NO_STRATUS_STATUS_CODE"};i.telemetryEvent.stopTimer().addAttributes(o),u.track(i.telemetryEvent)}return e}))}_blockRequestUntil(e){const t=super._blockRequestUntil(e),s=r.Defer();return this._throttled()?c.default.queueIdleTask("SMSClient",c.TaskTypeFlags.UsesNetworking,(()=>{s.resolve(void 0)}),c.Priority.Normal):s.resolve(void 0),r.all([t,s.promise()]).then(o.noop)}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=m.default.getRawSkypeToken(),t}getPrice(e,t){return this._setGateway(),u.log(d.LogTraceArea.SMSClient,"Calling SMS Rates API"),this._getPrice(e,t)}_getPrice(e,t){const s=encodeURIComponent(t),i=l.default.getConfigSettingsNoSubscription().sms.organizationId,o=g.default.getFlowId(),n=encodeURIComponent(f.removeLeadingPlus(e)),r=`users/${s}/sms-rates?platform=${S.default.getSkypePlatformId()}&number=${n}&organizationId=${i}&flowId=${o}`,d={acceptType:"application/json; ver=1.0",telemetryEvent:new a.CommerceStratusRequest(_.StratusApiTelemetry.GetSMSRates)};return this.performApiGet(r,d)}_setGateway(){this._endpointUrl=l.default.getConfigSettingsNoSubscription().sms.host}setThrottled(e){this._throttled=e}}t.TestSMSClient=C,t.default=new C},262834:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentQueryType=void 0;const i=s(197582),o=i.__importStar(s(496486)),n=s(217003),r=s(662783),a=i.__importStar(s(397691)),l=i.__importDefault(s(150343)),d=i.__importStar(s(44717)),c=i.__importDefault(s(615364)),u=s(815146),h=s(120695),p=i.__importStar(s(85385)),g=i.__importDefault(s(363091)),m=s(654519),S=i.__importDefault(s(655192)),_=i.__importDefault(s(517518)),f=i.__importDefault(s(760989));var y;!function(e){e[e.Media=0]="Media",e[e.Files=1]="Files",e[e.LinksAndSwiftCards=2]="LinksAndSwiftCards",e[e.ScheduledCallInvites=3]="ScheduledCallInvites"}(y||(t.ContentQueryType=y={}));const v=e=>(0,n.replaceNotMatching)(n.Patterns.MATCH_LETTER," ",e),C=e=>({Content:e}),T="x-ms-correlation-id";class M extends m.SkypeRestClient{constructor(){super(l.default.getConfigSettingsNoSubscription().messageSearch.host),this._customErrorHandler=(e,t)=>(0,r.DefaultErrorHandler)(e,t),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler}_getHeaders(e){const t=super._getHeaders(e);t["Cache-Control"]="no-cache",t["X-Skypetoken"]=_.default.getRawSkypeToken();const s=f.default.newGuid().replace(new RegExp("-","g"),"");return t[T]=s,t}_getQueryPostObject(e){return{OPTION:{RESULTBASE:e.offset||0,RESULTCOUNT:e.limit},QUERYSTRING:{}}}getSearchResults(e){const t=S.default.deburrLowerCase(e.query),s={OR:o.uniq([e.query,v(e.query),t,v(t)]).filter((e=>!!e&&!!e.trim())).map(C)},i=this._getQueryPostObject(e);if(e.conversationId)if(d.isThread(e.conversationId)){i.QUERYSTRING={AND:[s,{ThreadId:e.conversationId}]};const t=(0,c.default)().getConversation(e.conversationId);if(null==t?void 0:t.isOneOnOne()){const o=t.getOtherPartyMri()||e.conversationId;i.QUERYSTRING={AND:[s,{OR:[{AND:[{From:o},{To:g.default.getSkypeMri()}]},{AND:[{To:o},{From:g.default.getSkypeMri()}]}]}]}}}else i.QUERYSTRING={AND:[s,{OR:[{AND:[{From:e.conversationId},{To:g.default.getSkypeMri()}]},{AND:[{To:e.conversationId},{From:g.default.getSkypeMri()}]}]}]};else i.QUERYSTRING=s;return this._post(i,"getSearchResults")}getZeroTermResults(e){const t=this._getQueryPostObject(e),s={OR:[{Annotation:{TYPE:"at",VALUE:{id:g.default.getSkypeMri()}}},{Annotation:{TYPE:"quote",VALUE:{author:g.default.getSkypeId()}}}]};return e.conversationId?t.QUERYSTRING={AND:[{ThreadId:e.conversationId},s]}:t.QUERYSTRING=s,this._post(t,"getZeroTermResults")}getScheduledCalls(){const e=l.default.getS4LCMCFeaturesNoSubscription().scheduledCallSearchBatchSize;return this._recursivelyGetBatchedScheduledCalls(0,e,[])}_recursivelyGetBatchedScheduledCalls(e,t,s){const i=this._generateScheduledCallQuery(e,t);return this._endpointUrl=l.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",i).then((i=>{if(!i)return[];const n=this._filterScheduledCallResults(i);return s=o.concat(s,n),i.length<t?(p.log(u.LogTraceArea.ScheduleCall,`Retrieved a total of ${i.length} scheduled calls.`),s):(e+=t,this._recursivelyGetBatchedScheduledCalls(e,t,s))}))}_filterScheduledCallResults(e){return o.filter(e,(e=>"0"!==e.ClientMessageId))}_generateScheduledCallQuery(e,t){return{OPTION:{RESULTBASE:e,RESULTCOUNT:t},QUERYSTRING:{AND:[{ContentType:"ScheduledCallInvite"}]}}}getLinksAndCardsForConversation(e,t){const s=this._formulateContentQuery(e,y.LinksAndSwiftCards,t);return this._endpointUrl=l.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",s)}getFilesForConversation(e,t,s=""){const i=this._formulateContentQuery(e,y.Files,t,s);return this._endpointUrl=l.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",i)}getMediaForConversation(e,t){const s=this._formulateContentQuery(e,y.Media,t);return this._endpointUrl=l.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPost("query",s)}_post(e,t){return this._endpointUrl=l.default.getConfigSettingsNoSubscription().messageSearch.host,this.performApiPostDetailed("query",e).then((e=>200===e.statusCode&&e.body?e.body:(e.body||p.track(new h.FundamentalsDebugEmptyBodyEvent("SkypeMessageSearch",t,e.requestHeaders[T],e.statusCode,e.statusText)),a.Rejected(e))))}_formulateContentQuery(e,t,s,i="",n=20){let r;o.isEmpty(i)||(r={Content:i});const a=(0,c.default)().getConversation(e);let l=e;if(a&&a.isOneOnOne()&&!a.isThread()){const t=g.default.getSkypeMri();l=t<e?t+":"+e:e+":"+t}const d=[{ThreadId:l}];switch(t){case y.Media:d.push({OR:[{ContentType:"image"},{ContentType:"video"}]});break;case y.Files:d.push({Annotation:{TYPE:"URIObject",VALUE:{type:"File.1"}}});break;case y.LinksAndSwiftCards:d.push({OR:[{Annotation:{TYPE:"URIObject",VALUE:{type:"SWIFT.1"}}},{Annotation:{TYPE:"a",VALUE:{domain:"*"}}}]});break;case y.ScheduledCallInvites:d.push({ContentType:"ScheduledCallInvite"})}return r&&d.push(r),{OPTION:{RESULTBASE:s,RESULTCOUNT:n},QUERYSTRING:{AND:d}}}}t.default=new M}}]);